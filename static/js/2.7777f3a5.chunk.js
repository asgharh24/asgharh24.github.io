/*! For license information please see 2.7777f3a5.chunk.js.LICENSE.txt */
(this["webpackJsonpstarter-kit-rainbow"]=this["webpackJsonpstarter-kit-rainbow"]||[]).push([[2],[function(e,t,n){e.exports=n(108)},function(e,t,n){"use strict";e.exports=n(103)},function(e,t,n){"use strict";e.exports=n(110)},function(e,t,n){"use strict";function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(33);function i(e,t){if(null==e)return{};var n,i,a=Object(r.a)(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}},function(e,t,n){"use strict";function r(e){var t,n,i="";if("string"===typeof e||"number"===typeof e)i+=e;else if("object"===typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=r(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}t.a=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=r(e))&&(i&&(i+=" "),i+=t);return i}},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=n.n(a),s=(n(7),n(83)),c=n.n(s),l=n(117),u=n(152),d=n(118),h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var a=t.defaultTheme,s=t.withTheme,h=void 0!==s&&s,f=t.name,p=Object(i.a)(t,["defaultTheme","withTheme","name"]);var m=f,v=Object(l.a)(e,Object(r.a)({defaultTheme:a,Component:n,name:f||n.displayName,classNamePrefix:m},p)),g=o.a.forwardRef((function(e,t){e.classes;var s,c=e.innerRef,l=Object(i.a)(e,["classes","innerRef"]),p=v(Object(r.a)({},n.defaultProps,e)),m=l;return("string"===typeof f||h)&&(s=Object(d.a)()||a,f&&(m=Object(u.a)({theme:s,name:f,props:l})),h&&!m.theme&&(m.theme=s)),o.a.createElement(n,Object(r.a)({ref:c||t,classes:p},m))}));return c()(g,n),g}},f=n(51);t.a=function(e,t){return h(e,Object(r.a)({defaultTheme:f.a},t))}},function(e,t,n){e.exports=n(111)()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(50);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(e,t)||Object(r.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(93);function i(e){if("string"!==typeof e)throw new Error(Object(r.a)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},function(e,t,n){"use strict";var r=n(43),i=n(22);function a(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){a(o,r,i,s,c,"next",e)}function c(e){a(o,r,i,s,c,"throw",e)}s(void 0)}))}}var s=n(8);function c(e){throw new Error('"'+e+'" is read-only')}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t,n){return(u="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function f(e){return(f="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){return!t||"object"!==f(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p(this,n)}}var v=n(50);function g(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Object(v.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}var y=n(0),b=n.n(y);function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n){return t&&_(e.prototype,t),n&&_(e,n),e}var w=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=423)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(t,n,i,a){S(this,e),this.isVm=!1,this.remoteMedia=0,this.localMedia=0,this.isEscalated=!1,this.isError=!1,this.startDate=new Date,this.isInitiator=!1,this.participants=null,this.isRemoteVideoMuted=!1,this.isConference=!1,this.subject=void 0,this.currentCalled={contactPhoneNumber:"",contact:null,participantsPhoneNumbers:[],participants:[]},this.fullJid="",this.mediaPillarCall=null,this.isSecondary=!1,this.relevant=!0,this.relevantEquipmentId="unknown",this.deviceId=null,this.isOwner=void 0,this.pbxConnectionDown=void 0,this.isMuted=!1,this.duration=0,this.durationTimer=null,this.unifiedPlanActivated=!1,this.globalCallId=null,this.correlatorData=null,this.activeControl=!1,this.hasRemoteControlling=!1,this.networkQuality=0,this.sipWiseData=null,this.errorMessage=null,this.lastCause=null,this.rxSubject=new r.Subject,this.status=t,this.type=i,this.id=n,this.conversationId=null,this.connectionId=null,this.isVm=null,this.contact=a,this.remoteMedia=0,this.localMedia=0,this.isEscalated=!1,this.startDate=new Date,this.isInitiator=!1,this.participants=null,this.isRemoteVideoMuted=!1,this.isConference=!1,this.avatars=a&&a.avatar?[this.contact.avatar.src]:[],this.subject=void 0,this.currentCalled={contactPhoneNumber:"",contact:null,participantsPhoneNumbers:[],participants:[]},this.fullJid="",this.mediaPillarCall=null,this.isSecondary=!1,this.relevant=!1,this.relevantEquipmentId="unknown",this.deviceId=null,this.isOwner=void 0,this.pbxConnectionDown=void 0,this.isMuted=!1,this.duration=0,this.statusInfo=null,this.globalCallId=void 0,this.correlatorData=void 0,this.activeControl=!1,this.hasRemoteControlling=!1,this.networkQuality=0,this.sipWiseData={initCause:"",direction:"",called:{phoneNumber:"",displayName:""}}}return C(e,[{key:"setCallId",value:function(e){this.id=e}},{key:"getGlobalCallId",value:function(e){return this.globalCallId}},{key:"setGlobalCallId",value:function(e){this.globalCallId=e}},{key:"setConversationId",value:function(e){this.conversationId=e}},{key:"setStatus",value:function(e){this.status=e}},{key:"setCorrelatorData",value:function(e){this.correlatorData=e}},{key:"setType",value:function(e){this.type=e}},{key:"setIsVm",value:function(e){this.isVm=e}},{key:"setContact",value:function(e){this.contact=e,this.avatars=[this.contact.avatar.src]}},{key:"getCurrentCalled",value:function(){return this.currentCalled}},{key:"setSubject",value:function(e){this.subject=e}},{key:"setCurrentCalledContactNumber",value:function(e){this.currentCalled.contactPhoneNumber=e}},{key:"setRelevantEquipmentId",value:function(e){this.relevantEquipmentId=e}},{key:"setParticipants",value:function(e){var t=this;this.participants=e,this.avatars=[],this.participants.forEach((function(e){t.avatars.push(e.avatar.src)}))}},{key:"setConnectionId",value:function(t){this.connectionId=t,this.id=e.getIdFromConnectionId(t)}},{key:"isInConversationWithMobile",value:function(){return!!this.fullJid&&(-1!==this.fullJid.indexOf("mobile_android")||-1!==this.fullJid.indexOf("mobile_ios"))}},{key:"isInConversationWithDesktopApp",value:function(){return!!this.fullJid&&-1!==this.fullJid.indexOf("desk_")}},{key:"setCurrentCalled",value:function(e){e?this.contact&&this.contact.id?(this.currentCalled.contactPhoneNumber=e.contactPhoneNumber&&""!==e.contactPhoneNumber?e.contactPhoneNumber:"",this.currentCalled.contact=e.contact?e.contact:null,this.currentCalled.participantsPhoneNumbers=null,this.currentCalled.participants=null):(this.currentCalled.contactPhoneNumber="",this.currentCalled.contact=null,this.currentCalled.participantsPhoneNumbers=e.participantsPhoneNumbers&&e.participantsPhoneNumbers.length>0?e.participantsPhoneNumbers:null,this.currentCalled.participants=e.participants&&e.participants.length>0?e.participants:null):(this.currentCalled.contactPhoneNumber="",this.currentCalled.contact=null,this.currentCalled.participantsPhoneNumbers=null,this.currentCalled.participants=null)}},{key:"isMediaPillarCall",value:function(){return null!==this.mediaPillarCall}},{key:"getMediaPillarCall",value:function(){return this.mediaPillarCall}},{key:"setMediaPillarCall",value:function(e){this.mediaPillarCall=e||null}},{key:"setDeviceIdSipWise",value:function(e){this.deviceId=e||null}},{key:"getDeviceIdSipWise",value:function(){return this.deviceId}},{key:"setConnectionIdSipWise",value:function(e){this.connectionId=e}},{key:"getConnectionIdSipWise",value:function(){return this.connectionId}},{key:"resetSipWiseData",value:function(){this.sipWiseData={initCause:"",direction:"",called:{phoneNumber:"",displayName:""}}}},{key:"setInitCauseSipWiseData",value:function(e){this.sipWiseData.initCause=e,this.lastCause=e}},{key:"getInitCauseSipWiseData",value:function(){return this.sipWiseData.initCause}},{key:"setDirectionSipWiseData",value:function(e){this.sipWiseData.direction=e}},{key:"getDirectionSipWiseData",value:function(){return this.sipWiseData.direction}},{key:"setCalledSipWiseData",value:function(e){this.sipWiseData.called=e}},{key:"getCalledSipWiseData",value:function(){return this.sipWiseData.called}},{key:"isHuntingGroupCallSipWise",value:function(){return"distributed"===this.sipWiseData.initCause}},{key:"getHuntingGroupCalledInfo",value:function(){return this.isHuntingGroupCallSipWise()?this.getCalledSipWiseData():null}},{key:"getDeviceIdFromConnectionIdFromCall",value:function(){return this.deviceId?this.deviceId:this.connectionId?this.connectionId.split("#")[1]:null}},{key:"startDuration",value:function(){var e=this;this.durationTimer||(this.durationTimer=r.interval(1e3).subscribe((function(){e.duration++})))}},{key:"stopDuration",value:function(){this.durationTimer&&(this.durationTimer.unsubscribe(),this.durationTimer=null)}},{key:"toString",value:function(){return"(type:"+this.type.value+", id:"+this.id+", status:"+this.status.value+(this.isConference?" conference":"")+")"}},{key:"isInCallWithMediaPillar",value:function(){return this.fullJid&&-1!==this.fullJid.indexOf("mp_")}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"publish",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next({name:e,value:t})}}],[{key:"create",value:function(t,n,r,i){return new e(t,n,r,i)}},{key:"getIdFromConnectionId",value:function(e){return e}},{key:"getCallIdFromConnectionId",value:function(e){return e?e.split("#")[0]:null}},{key:"getDeviceIdFromConnectionId",value:function(e){return(e?e.split("#")[1]:null)||null}}]),e}();i.Status={UNKNOWN:{key:0,value:"Unknown"},DIALING:{key:1,value:"dialing"},QUEUED_INCOMMING:{key:2,value:"queuedIncomming"},QUEUED_OUTGOING:{key:10,value:"queuedOutGoing"},RINGING_INCOMMING:{key:3,value:"incommingCall"},RINGING_OUTGOING:{key:4,value:"ringingOutgoing"},ACTIVE:{key:5,value:"active"},HOLD:{key:6,value:"held"},PUT_ON_HOLD:{key:7,value:"putOnHold"},RELEASING:{key:8,value:"releasing"},ANSWERING:{key:9,value:"answering"},CONNECTING:{key:12,value:"connecting"},ERROR:{key:11,value:"error"}},i.Type={WEBRTC:{key:1,value:"Video"},PHONE:{key:2,value:"Phone"}},i.Media={AUDIO:1,VIDEO:2,PHONE:4,SHARING:8},t.Call=i},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),a=n(26),o=n(15),s=n(37),c=n(5),l=n(2),u=n(38),d=n(59),h=n(4),f=n(14),p=n(49),m=n(43),v=n(10),g=n(24),y=n(74),_=n(60),w=n(3),E=function(){function e(){S(this,e),this.userContact=null,this.contacts={},this.dbContacts={},this.jtelContacts={},this.currentLanguage=null,this.eventService=i.default,this.settingsService=c.default,this.mainService=a.default,this.logger=o.default,this.errorHelperService=s.default,this.authService=l.default,this.i18nService=u.default,this.companyService=d.default,this.xmppService=h.default,this.rxSubject=new v.Subject,this.subscriptions=[],this._displayOrder=null,this.contactLastActivityInterval=null,this.calendarPresenceEventHandlerCleaner=null,this.xmppConnectionSubscription=null,this.presentationModeEventHandlerCleaner=null,this.subscriptionPromiseQueue=p.PromiseQueue.create(),this.getContactPromises=[],this.contactConfigRef=null,this.lastUpdatePresentationMode=null,this.presentationModeTimeout=null,this.presentationModeActive=!1,this.awayStateActive=!1,this.busyState={status:null,message:null},this.manualState=!1}return C(e,[{key:"displayOrder",get:function(){return this._displayOrder},set:function(e){var t=this;this._displayOrder=e,Object.keys(this.contacts).forEach((function(n){var r=t.contacts[n];r.displayOrder=e,r.computeDisplayName()}))}},{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentLanguage=this.settingsService.getSetting("lang"),this.displayOrder=this.settingsService.getSetting("displayOrder"),this.settingsService.subscribeUpdateEvent("SETTINGS_UPDATED",(function(){i.currentLanguage=i.settingsService.getSetting("lang"),i.displayOrder=i.settingsService.getSetting("displayOrder"),i.updateContactsLastActivityMessage()})),this.subscriptions.push(this.xmppService.subscribeToContactEvents((function(e){switch(e.name){case"ON_CONTACT_PRESENCE_EVENT":i.contactPresenceChangedHandler(e.data);break;case"ON_CONTACT_UPDATE_EVENT":i.onContactChangeEvent(e.data.from,e.data.type);break;case"ON_ROSTER_CHANGED_EVENT":i.subscriptionPromiseQueue.add((function(){return i.rosterChangedHandlerPromise(e.data)}))}}))),this.xmppService.contactServiceReady=!0,this.calendarPresenceEventHandlerCleaner&&this.calendarPresenceEventHandlerCleaner(),this.calendarPresenceEventHandlerCleaner=this.eventService.subscribe("ON_CONTACT_CALENDAR_STATUS_CHANGE",(function(e,t){i.updateContactCalendarPresenceInfo(t)})),this.presentationModeEventHandlerCleaner&&this.presentationModeEventHandlerCleaner(),this.presentationModeEventHandlerCleaner=this.eventService.subscribe("ON_PRESENTATION_MODE_CHANGED_EVENT",(function(e,t){i.onPresentationModeChangedEvent(t)})),this.logger.info("[contactService] Create userContact ("+this.xmppService.jid+")"),this.userContact=this.createContact(),this.userContact.ask=null,this.userContact.subscription=null,this.userContact.id=this.xmppService.jid,this.userContact.jid=this.xmppService.jid,this.userContact.fullJid=this.xmppService.fullJid,this.userContact.language=this.currentLanguage,this.userContact.updateFromUserData(this.authService.loggedInUser),this.userContact.getAvatar(),this.updateContactRichStatus(this.userContact),this.dbContacts[this.userContact.dbId]=this.userContact,this.contacts[this.userContact.id]=this.userContact,this.jtelContacts[this.userContact.jidtel]=this.userContact,this.authService.loggedInUser.language||(t=this.settingsService.getAppliLanguageCodeForServer(),this.updateUserContact({language:t})),e.next=3,this.getUserSettings();case 3:return n=e.sent,this.manageCalendarPresencePrompt(n),this.settingsService.setSetting("activeAlarm",n.activeAlarm),this.settingsService.setSetting("activeNotif",n.activeNotif),this.settingsService.setSetting("protectionAgainstMailTypeOffline",n.protectionAgainstMailTypeOffline),this.settingsService.setSetting("applyCalendarPresence",String(n.applyCalendarPresence)),this.logger.info("[contactService] Get alarm & notif data ("+n.activeAlarm+" / "+n.activeNotif+")"),this.logger.info("[contactService] Get mail setting data ("+n.protectionAgainstMailTypeOffline+")"),r=!1,void 0===this.userContact.customData.pushToTalkEnabled&&(r=!0,this.userContact.customData.pushToTalkEnabled=!1),void 0===this.userContact.customData.pushToTalkKey&&(r=!0,this.userContact.customData.pushToTalkKey="Shift"),void 0===this.userContact.customData.pushToTalkDelay&&(r=!0,this.userContact.customData.pushToTalkDelay=0),void 0===this.userContact.customData.enablePushToTalkTone&&(r=!0,this.userContact.customData.enablePushToTalkTone=!1),r&&this.updateUserContact({customData:this.userContact.customData}),e.next=13,this.companyService.getCompanyById(this.userContact.company.id);case 13:return this.userContact.company=e.sent,e.next=16,this.companyService.getCompanyAlertNotificationState(this.userContact.company);case 16:return this.userContact.alertNotificationEnabledForMyCompany=e.sent,this.attachHandlers(),e.next=20,this.getNetwork();case 20:return e.next=22,this.updateNetworkWithRosterInfo();case 22:this.subscriptions.push(this.mainService.subscribe((function(e){return i.logger.info("[contactService] AppActive changed : "+e),!e&&i.userContact&&"online"===i.userContact.status&&(i.awayStateActive=!0),e&&i.awayStateActive&&(i.awayStateActive=!1),i.updatePresence(!0),!0}))),this.getMissedPresenceMessages(),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((function(e){i.onConnectionStateChangeEvent(e)})),this.contactLastActivityInterval=setInterval((function(){i.updateContactsLastActivityMessage()}),6e4);case 27:case"end":return e.stop()}}),e,this)})))}},{key:"attachHandlers",value:function(){var e=this;this.logger.info("[contactService] AttachHandlers"),this.contactConfigRef&&(this.xmppService.deleteHandler(this.contactConfigRef),this.contactConfigRef=null),this.contactConfigRef=this.xmppService.addHandler((function(t){return e.onUserManagementEvent(t)}),null,"message","management")}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.userContact=null,this.contacts={},this.dbContacts={},this.jtelContacts={},this.presentationModeActive=!1,this.awayStateActive=!1,this.busyState={status:null,message:null},this.manualState=!1,this.contactLastActivityInterval&&(clearInterval(this.contactLastActivityInterval),this.contactLastActivityInterval=null),this.subscriptions&&this.subscriptions.forEach((function(e){e.unsubscribe()})),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.calendarPresenceEventHandlerCleaner&&(this.calendarPresenceEventHandlerCleaner(),this.calendarPresenceEventHandlerCleaner=null);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next(g.RBEvent.create(e,t))}},{key:"sendUpdateEvent",value:function(e){e.rxSubject.next({name:"update",data:e});var t=this.isUserContact(e)?"ON_USER_CONTACT_UPDATED_EVENT":"ON_CONTACT_UPDATED_EVENT";this.eventService.publish(t,e)}},{key:"onConnectionStateChangeEvent",value:function(e){var t=this;"ON_XMPP_DISCONNECTED"===e.name&&this.userContact&&(this.userContact.resources={},Object.keys(this.contacts).forEach((function(e){var n=t.contacts[e];n.isBot||(n.resources={},"unknown"!==n.status&&"none"!==n.subscription&&(n.status="offline",n.imStatusStamp=[]))})),this.presentationModeActive=!1,this.awayStateActive=!1,this.busyState={status:null,message:null},this.manualState=!1)}},{key:"createContact",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=new m.Contact(e,null,r);return a.login=i,a.avatarServerURL=this.mainService.cdn?this.mainService.cdnServer:config.webservices.protocol+"://"+config.webservices.currentServer,a.firstname=t,a.lastname=n,a.displayOrder=this.displayOrder,a.computeDisplayName(),a}},{key:"createBotContact",value:function(e,t,n,r,i){var a=this.contacts[e];return a||((a=new m.Contact(e)).botDetails="emilyDetails"),a.displayOrder=this.displayOrder,a.lastname=t,a.isBot=!0,a.status="online",a.imStatus="online",a.subscription="both",a.computeDisplayName(),a.avatar=window.rainbowSDK?null:{src:r},a.dbId=n,a.isBotSharing=!!i&&i.some((function(e){return"SHARING"===e})),this.contacts[a.id]=this.dbContacts[n]=a,a}},{key:"isMediaPillarJid",value:function(e){return e&&0===e.indexOf("mp_")}},{key:"isUserContactJid",value:function(e){return!(!this.userContact||!e||0===e.length)&&e.startsWith(this.userContact.jid)}},{key:"isUserContact",value:function(e){return!(!e||!e.jid)&&this.isUserContactJid(e.jid)}},{key:"searchContacts",value:function(e){var t=this;return this.getContacts().filter((function(n){return(n.roster||n.isBot)&&!n.isTerminated&&t.contactMatcher(n,e)}))}},{key:"contactMatcher",value:function(e,t){var n=e.firstname+" "+e.lastname,r=t.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ ]+/),i=n.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ ]+/);return r.every((function(e){return i.some((function(t,n){return!(!t.length||0!==t.indexOf(e))&&(i[n]="",!0)}))}))}},{key:"getContacts",value:function(){var e=this;return Object.keys(this.contacts).map((function(t){return e.contacts[t]}))}},{key:"getContact",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e||t;return this.isUserContactJid(n)?this.userContact:this.contacts[n]}},{key:"getContactByJid",value:function(e){return this.getContact(e)}},{key:"getContactById",value:function(e){return this.dbContacts[e]}},{key:"getContactByEmail",value:function(e){var t=this,n=Object.keys(this.contacts).find((function(n){return t.contacts[n].containsEmail(e)}));return n?this.contacts[n]:null}},{key:"getContactByPhoneNumber",value:function(e){var t=this,n=Object.keys(this.contacts).find((function(n){return t.contacts[n].containsPhoneNumber(e)}));return n?this.contacts[n]:null}},{key:"getContactByDBId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,r=this.dbContacts[e],t||!r){n.next=4;break}return n.abrupt("return",r);case 4:if(this.getContactPromises[e]){n.next=16;break}return i="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(e,"?format=full"),n.next=8,fetch(i,{method:"GET",headers:this.authService.getRequestHeader()});case 8:if((a=n.sent).ok){n.next=11;break}throw a;case 11:return n.next=13,a.json();case 13:return o=n.sent.data,s=r||this.createBasicContact(o.jid_im),n.abrupt("return",(s.updateFromUserData(o),s.getAvatar(),this.dbContacts[s.dbId]=s,this.jtelContacts[s.jidtel]=s,delete this.getContactPromises[e],this.logger.info("[contactService] GetContactByDBId ("+e+") -- "+o.jid_im+" -- success"),s));case 16:return n.abrupt("return",this.getContactPromises[e]);case 19:return n.prev=19,n.t0=n.catch(0),delete this.getContactPromises[e],n.next=24,this.errorHelperService.getErrorInfo(n.t0,"getContactByDBId");case 24:throw c=n.sent,this.logger.error(c.message),c.error;case 26:case"end":return n.stop()}}),n,this,[[0,19]])})))}},{key:"getContactsByEmails",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c,l=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[contactService] getContactsByEmails with ["+e.join()+"]"),n=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/loginemails",r=e.map((function(e){return e.toLowerCase()})),t.next=6,fetch(n,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify({loginEmail:r})});case 6:if((i=t.sent).ok){t.next=9;break}throw i;case 9:return t.next=11,i.json();case 11:return a=t.sent,o={},s=a.data.map((function(e){var t=l.dbContacts[e.id];return t||(t=l.createContact(),l.contacts[t.id]=t,l.dbContacts[t.dbId]=t,l.jtelContacts[t.jidtel]=t),t.updateFromUserData(e),t.getAvatar(),o[t.loginEmail]=t,r.splice(r.indexOf(t.loginEmail.toLowerCase()),1),t})),t.abrupt("return",{contacts:o,contactsArray:s,emails:r});case 17:return t.prev=17,t.t0=t.catch(0),t.next=21,this.errorHelperService.getErrorInfo(t.t0,"getContactsByEmails");case 21:throw c=t.sent,this.logger.error(c.message),c.error;case 23:case"end":return t.stop()}}),t,this,[[0,17]])})))}},{key:"getContactsByJids",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[contactService] getContactsByJids with [".concat(e.join(),"]")),n=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/jids?limit=1000",t.next=5,fetch(n,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify({jid_im:e})});case 5:if((r=t.sent).ok){t.next=8;break}throw r;case 8:return t.next=10,r.json();case 10:t.sent.data.forEach((function(e){var t=a.getContact(e.jid_im);t||(t=a.createContact()),t.updateFromUserData(e),t.isAnonymousGuest()||(a.contacts[t.id]=t,a.dbContacts[t.dbId]=t,a.jtelContacts[t.jidtel]=t,t.getAvatar(),t.temp=!1)})),t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(0),t.next=17,this.errorHelperService.getErrorInfo(t.t0,"getContactsByJids");case 17:throw i=t.sent,this.logger.error(i.message),i.error;case 19:case"end":return t.stop()}}),t,this,[[0,13]])})))}},{key:"createBasicContact",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger.debug("[contactService] CreateContact ".concat(e," ").concat(f.default(t)));var r=this.createContact();if(!e)return r.id=t,r.initials="?",r.displayName=t||"Unknown contact",r.lastname=t||"Unknown contact",r.firstname="",r.phoneProCan=t||"",r.phonePro=r.phoneProCan,r.temp=!0,r.avatar={src:"/resources/skins/rainbow/images/conversations/unknownUser.jpeg"},r.nameUpdatePrio=m.Contact.NameUpdatePrio.NO_UPDATE_PRIO,r;var i=e;return i||(i=t,r.phoneProCan=t),i||(i="anonymous"),r.jid=e,r.id=i,r.ask="none",r.subscription="none",this.updateContactRichStatus(r),!1!==n&&(this.contacts[r.id]=r),r}},{key:"createEmptyContact",value:function(e){var t=this.createBasicContact(e);return t.initials="?",t.displayName="Unknown contact",t.lastname="Unknown contact",t.firstname="",t.temp=!0,t.avatar={src:"/resources/skins/rainbow/images/conversations/unknownUser.jpeg"},t}},{key:"getOrCreateContact",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e&&!n)return Promise.reject(new Error("No jid or no phoneNumber"));var r=this.getContact(e,n);if(r)return Promise.resolve(r);if(e&&-1===e.indexOf("@"))throw new Error("Invalid jid "+e);var i=e||n;return e?(this.getContactPromises[i]||(this.getContactPromises[i]=new Promise((function(r,a){var o=t.createBasicContact(e,n,!1);t.updateContactFromServer(o).then((function(){t.contacts[o.id]=o,t.dbContacts[o.dbId]=o,t.jtelContacts[o.jidtel]=o,delete t.getContactPromises[i],r(o)})).catch((function(e){t.logger.error("[contactService] getOrCreateContact -- failure -- "+e.message),delete t.getContactPromises[i],a(e)}))}))),this.getContactPromises[i]):Promise.resolve(this.createBasicContact(null,n))}},{key:"updateContactFromServer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/jids/").concat(e.jid),n.next=4,fetch(r,{headers:this.authService.getRequestHeader()});case 4:if((i=n.sent).ok){n.next=7;break}throw i;case 7:return n.next=9,i.json();case 9:a=n.sent,e.updateFromUserData(a.data),this.updateContactRichStatus(e,this.isUserContactJid(e.jid)),t||e.getAvatar(),this.sendUpdateEvent(e),n.next=19;break;case 13:return n.prev=13,n.t0=n.catch(0),n.next=17,this.errorHelperService.getErrorInfo(n.t0,"updateContactFromServer");case 17:throw o=n.sent,this.logger.error(o.message),o.error;case 19:case"end":return n.stop()}}),n,this,[[0,13]])})))}},{key:"getContactInfoByEmail",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/loginemails?format=full",t.next=4,fetch(n,{method:"POST",headers:this.authService.getRequestHeader(),body:JSON.stringify({loginEmail:[e]})});case 4:if((r=t.sent).ok){t.next=7;break}throw r;case 7:return t.next=9,r.json();case 9:return t.abrupt("return",t.sent.data);case 12:return t.prev=12,t.t0=t.catch(0),t.next=16,this.errorHelperService.getErrorInfo(t.t0,"getContactInfoByEmail");case 16:throw i=t.sent,this.logger.error(i.message),i.error;case 18:case"end":return t.stop()}}),t,this,[[0,12]])})))}},{key:"onContactChangeEvent",value:function(e,t){var n=this;this.logger.info("[contactService] onContactChangeEvent event: "+event+" || status: "+e+" || type: "+t),setTimeout((function(){return r(n,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.getContact(e),n.t0=r,!n.t0){n.next=7;break}return n.next=5,this.updateContactFromServer(r,!0);case 5:"avatar"===t&&r.getAvatar(256,!0),this.sendUpdateEvent(r);case 7:case"end":return n.stop()}}),n,this)})))}),2e3)}},{key:"onUserManagementEvent",value:function(e){try{var t=$(e).find("usersettings");if(t.length&&"update"===t.attr("action"))return this.logger.info("[contactService] onUserManagementEvent - should update the presence"),this.sendPresenceFromConfiguration(),!0;var n=$(e).find("userpassword");return!n.length||"update"!==n.attr("action")||(this.logger.info("[contactService] onUserManagementEvent - userPassword updated"),this.xmppService.changePasswordInfo||(this.xmppService.changePasswordInfo={fromThirdParty:!0}),!0)}catch(r){return!0}}},{key:"sendPresenceFromConfiguration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.info("(with auth info)"),t.prev=1,t.next=4,this.getUserSettings();case 4:n=t.sent,r="","invisible"===(i=n.presence)?i="xa":"away"===i&&(i="xa",r="away"),this.logger.info("[contactService] sendPresenceFromConfiguration -> getUserSettings are "+i+" || message : "+r),this.userContact&&this.userContact.resources&&this.userContact.resources[this.userContact.fullJid]?(a=this.userContact.resources[this.userContact.fullJid])&&(a.show!==i||"xa"===a.show&&a.status!==r)?this.busyState&&"dnd"===this.busyState.status&&!this.manualState||(this.logger.info("[contactService] sendPresenceFromConfiguration should update my status from "+a.show+" to "+i+" ("+r+")"),o={im:this.userContact.instantMessagesEnabled,alert:this.userContact.alertNotificationEnabledForMyCompany},this.setUserContactStatus(i,r,e,o)):this.eventService.publish("ON_RELOAD_CAPABILITIES_FOR_MY_CONYTACT"):(s={im:this.userContact.instantMessagesEnabled,alert:this.userContact.alertNotificationEnabledForMyCompany},this.logger.info("[contactService] sendPresenceFromConfiguration set initial presence "),this.setUserContactStatus(i,r,e,s)),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),this.logger.info("[contactService] sendPresenceFromConfiguration failure, send online"),this.setUserContactStatus("online",null,e);case 12:case"end":return t.stop()}}),t,this,[[1,9]])})))}},{key:"changeMyPresence",value:function(e){var t=this;if(this.logger.info("[contactService] changeMyPresence "+e+" "+this.userContact.message),("dnd"!==e||"presentation"!==this.userContact.message)&&"busy"!==e){var n="";"online"===e&&(n="mode=auto"),"away"===e&&(e="xa",n="away"),this.setUserContactStatus(e,n),"online"===e&&setTimeout((function(){t.manualState=!1,t.updatePresence()}),1e3);var r="online";"xa"===e&&"away"===n?r="away":"dnd"===e?r="dnd":"xa"===e&&(r="invisible"),this.setUserSettings({presence:r})}}},{key:"updateUserContact",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=null,t.prev=1,this.logger.info("[contactService] updateUserContact"),r="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.authService.userId),i=this.authService.getPostHeader(),t.next=7,fetch(r,{method:"PUT",headers:i,body:JSON.stringify(e)});case 7:if((a=t.sent).ok){t.next=10;break}throw a;case 10:return t.next=12,a.json();case 12:n=t.sent.data,this.userContact.updateFromUserData(n),this.authService.loggedInUser=n,this.logger.info("[contactService] updateUserContact successfully"),t.next=24;break;case 18:return t.prev=18,t.t0=t.catch(1),t.next=22,this.errorHelperService.getErrorInfo(t.t0,"updateUserContact");case 22:throw o=t.sent,this.logger.error(o.message),o.error;case 24:case"end":return t.stop()}}),t,this,[[1,18]])})))}},{key:"updateUserContactFullJid",value:function(){this.userContact.fullJid=this.xmppService.fullJid,this.attachHandlers()}},{key:"completeContactPhoneNumbers",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isBot){t.next=2;break}throw new Error("No phone numbers for bot contacts");case 2:if(!e.phoneNumbersInitialized){t.next=4;break}return t.abrupt("return",e);case 4:if(!e.dbId){t.next=14;break}return t.prev=5,t.next=8,this.getContactByDBId(e.dbId,!0);case 8:return t.abrupt("return",t.sent);case 11:throw t.prev=11,t.t0=t.catch(5),new Error(t.t0.message);case 14:return t.abrupt("return",e);case 15:case"end":return t.stop()}}),t,this,[[5,11]])})))}},{key:"updateUserPassword",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(a,o){var s=n.userContact.loginEmail;n.xmppService.changePasswordInfo={resolve:i?a:null,login:s,newPassword:t};var c="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(n.authService.userId,"/change-password"),l=n.authService.getPostHeader();fetch(c,{method:"PUT",headers:l,body:JSON.stringify({oldPassword:e,newPassword:t})}).then((function(e){if(!e.ok)throw e;i||a()})).catch((function(e){return r(n,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.xmppService.changePasswordInfo=null,t.next=3,this.errorHelperService.getErrorInfo(e,"updateUserPassword");case 3:n=t.sent,this.logger.error(n.message),o(n.error);case 5:case"end":return t.stop()}}),t,this)})))}))}))}},{key:"getNetwork",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,o=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/networks?limit=2000&format=full",n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:return e.next=10,r.json();case 10:i=e.sent,this.logger.info("[contactService] GetNetwork success -- find ".concat(i.data.length," contact(s)")),i.data.forEach((function(e){var t=o.createContact();t.updateFromUserData(e),o.contacts[t.id]=t,o.dbContacts[t.dbId]=t,o.jtelContacts[t.jidtel]=t,o.updateContactRichStatus(t),t.getAvatar(),o.sendUpdateEvent(t)})),e.next=20;break;case 14:return e.prev=14,e.t0=e.catch(0),e.next=18,this.errorHelperService.getErrorInfo(e.t0,"getNetwork");case 18:throw a=e.sent,this.logger.error(a.message),a.error;case 20:case"end":return e.stop()}}),e,this,[[0,14]])})))}},{key:"updateNetworkWithRosterInfo",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.xmppService.sendIQ($iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}));case 3:t=e.sent,this.logger.info("[contactService] Get rosters info successfully"),$(t).find("item").each((function(e,t){var r=$(t),i=n.xmppService.getBareJidFromJid(r.attr("jid"));if(i&&i.length&&!n.isTelJid(i)){var a=n.contacts[i];if(a){var o=r.attr("ask"),s=r.attr("subscription");a.ask=o||"none",a.subscription=s||"none",a.roster=!0,n.updateContactRichStatus(a),n.logger.info("[contactService] Update contact from roster ("+a.ask+", "+a.subscription+") "+i)}}})),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),this.logger.error("[contactService] Get rosters failure : "+e.t0.message),new Error(e.t0.message);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))}},{key:"getUserSettings",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,o,s,c,l,u,d;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userContact.dbId,"/settings"),n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:return e.next=10,r.json();case 10:return i=e.sent,a=i.data.presence&&this.userContact.changePresenceEnabled?i.data.presence:"online",o=i.data.activeAlarm||"relax1",s=i.data.activeNotif||"notif1",c=i.data.promptForCalendarPresence,l=i.data.protectionAgainstMailTypeOffline,u=Boolean(i.data.applyCalendarPresence),e.abrupt("return",(this.logger.info("[contactService] GetUserSettings success"),{presence:a,activeAlarm:o,activeNotif:s,promptForCalendarPresence:c,protectionAgainstMailTypeOffline:l,applyCalendarPresence:u}));case 20:return e.prev=20,e.t0=e.catch(0),e.next=24,this.errorHelperService.getErrorInfo(e.t0,"getUserSettings");case 24:return d=e.sent,e.abrupt("return",(this.logger.error(d.message),{presence:"online",activeAlarm:"relax1",activeNotif:"notif1",promptForCalendarPresence:!1}));case 26:case"end":return e.stop()}}),e,this,[[0,20]])})))}},{key:"setUserSettings",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userContact.dbId,"/settings"),r=this.authService.getPostHeader(),t.next=5,fetch(n,{method:"PUT",headers:r,body:JSON.stringify(e)});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:this.logger.info("[contactService] SetUserSettings ".concat(JSON.stringify(e)," -- success")),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(0),t.next=15,this.errorHelperService.getErrorInfo(t.t0,"setUserSettings");case 15:throw a=t.sent,this.logger.error(a.message),a.error.errorDetailsCode&&403153===a.error.errorDetailsCode&&(this.setUserContactStatus("online","mode=auto"),this.eventService.publish("ON_OPEN_GLOBAL_POPUP",{popupTitle:"presence",popupBody:"changePresenceDisabled",okLabel:"ok"})),a.error;case 17:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"manageCalendarPresencePrompt",value:function(e){if(void 0!==e.promptForCalendarPresence)this.settingsService.setSetting("disableCalendarPresence",e.promptForCalendarPresence?"false":"true"),this.logger.info("[contactService] promptForCalendarPresence -- "+e.promptForCalendarPresence);else{var t="true"!==this.settingsService.getSetting("disableCalendarPresence");this.logger.info("[contactService] MIGRATION NECESSARY -- promptForCalendarPresence : "+t),this.setUserSettings({promptForCalendarPresence:t})}}},{key:"updateContactCalendarPresenceInfo",value:function(e){var t=e.calendarState,n=null,r=null;t.iconId=null;var i=null;if(t.autoReplyOn)t.iconId="calendar--busy",r="<div style='text-align:left'>"+_(t.autoReplyInfos.message).replace(/\n/g,"<br/>")+"</div>",n={meetingDate:t.autoReplyInfos.until,message:r},i=t.autoReplyInfos.until?t.autoReplyInfos.untilDate?"calendarAutoReply-date":"calendarAutoReply":"calendarAutoReplySimple";else{if("busy"===t.message)t.iconId="calendar--ok",i=t.untilDate?"calendar-busy-date":"calendar-busy";else if("out_of_office"===t.message)t.iconId="calendar--busy",i=t.untilDate?"calendar-outofoffice-date":"calendar-outofoffice";else if("online"===t.status){var a=t.mdate&&t.mdate.isSame(w(),"d");t.tooltip=a?this.i18nService.translate("calendar-free",{meetingDate:t.until}):this.i18nService.translate("calendar-noappointment")}n={meetingDate:t.until}}i&&(t.tooltip=this.i18nService.translate(i,{meetingDate:n.meetingDate}),n.message&&(n.message=n.message.replace(/<script>/g,""),n.message=n.message.replace(/(?:<br?\/?>\s*){2,}/g,"<br/>"),t.tooltip=t.tooltip+" "+n.message)),this.updateContactRichStatus(e,this.isUserContactJid(e.jid))}},{key:"isTelJid",value:function(e){return 0===e.indexOf("tel_")}},{key:"getResourceFromJid",value:function(e){return this.xmppService.getResourceFromJid(e)}},{key:"getImJid",value:function(e){var t=this.xmppService.getBareJidFromJid(e);if(this.isTelJid(t)){var n=this.jtelContacts[t];return n?n.jid:(this.logger.warn("[contactService] -- getIMJid("+e+") -- failure -- no associated contact"),null)}return t}},{key:"rosterChangedHandlerPromise",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isTelJid(e.jid)){t.next=3;break}return t.abrupt("return",void this.logger.debug("[contactService] Contact changed ("+e.jid+") ignored"));case 3:return t.next=5,this.getOrCreateContact(e.jid);case 5:n=t.sent,"remove"===e.subscription?(n.ask="none",n.subscription="none",n.roster=!1):(n.ask=e.ask,n.subscription=e.subscription,n.roster=!0,"both"===e.subscription&&this.updatePresence(!0)),this.updateContactRichStatus(n),this.sendUpdateEvent(n),this.sendEvent("ON_CONTACT_ROSTER_UPDATE_EVENT"),this.logger.info("[contactService] rosterChangedHandler - contact "+e.jid+" changed ("+e.ask+", "+e.subscription+") success"),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),this.logger.error("[contactService] rosterChangedHandler - contact "+e.jid+" failure - "+t.t0.message);case 12:case"end":return t.stop()}}),t,this,[[0,9]])})))}},{key:"contactPresenceChangedHandler",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("calendar"!==(n=this.getResourceFromJid(e.jid))){t.next=3;break}return t.abrupt("return");case 3:if(r=this.getImJid(e.jid)){t.next=6;break}return t.abrupt("return");case 6:if(!r.startsWith("room")){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,this.getOrCreateContact(r);case 10:i=t.sent,a=this.isUserContact(i),this.isTelJid(e.jid)?(this.logger.info("[contactService] Update telephony presence ("+r+") source: "+n),this.logger.info("[contactService] Update telephony presence ("+r+") msg: "+e.message+" / status: "+e.status),this.updateContactTelephonyStatus(i,e,a)):(this.logger.info("[contactService] Update im presence contact ("+r+") status: "+e.status+" "+e.stamp),this.isUserContact(i)&&"mode=auto"===e.message&&"online"!==i.status&&i.resources.hasOwnProperty(e.jid)&&e.jid!==i.fullJid&&"EVT_SERVICE_INITIATED"!==i.telStatus&&"EVT_ESTABLISHED"!==i.telStatus&&(i.resources[i.fullJid]&&"online"===i.resources[i.fullJid].show?this.logger.info("[contactService] Current ressource is already online, ignore message!"):(this.manualState&&(this.logger.info("[contactService] User is in manual state, leave it"),this.setUserContactStatus("online","mode=auto")),this.busyState&&"dnd"===this.busyState.status&&"busy"!==this.userContact.status&&(this.logger.info("[contactService] User is in call, re-update presence state"),setTimeout((function(){o.updatePresence(!0)}),500)))),this.updateContactIMStatus(i,e,this.isUserContact(i)),this.updateLastActivity(i)),this.sendUpdateEvent(i);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"getMissedPresenceMessages",value:function(){this.logger.info("[contactService] GetMissedPresenceMessages");try{var e=this.xmppService.getPresenceWaitingList();if(e.length){for(this.logger.info("[contactService] GetMissedPresenceMessages length "+e.length);e.length>0;){var t=e.pop();this.contactPresenceChangedHandler(t)}this.xmppService.resetPresenceWaitingList()}}catch(n){this.logger.error("[contactService] GetMissedPresenceMessages error "+n)}}},{key:"computeStatusList",value:function(){var e=[];return this.userContact&&this.userContact.status&&(this.logger.info("[contactService] computeStatusList "+this.userContact.status+" "+this.userContact.message),e=this.userContact.changePresenceEnabled?"offline"===this.userContact.status?["online"]:"busy"===this.userContact.status?["busy"]:"dnd"===this.userContact.status&&"presentation"===this.userContact.message?["dnd"]:["online","away","xa","dnd"]:[]),e}},{key:"resetBusyState",value:function(){this.logger.info("[contactService] resetBusyState"),this.setBusyState(null,null,!0),this.sendPresenceFromConfiguration()}},{key:"setBusyState",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.logger.info("[contactService] setBusyState -- "+e+" -- "+t),this.busyState={status:e,message:t},n||this.updatePresence()}},{key:"contactCalendarPresenceChangedHandler",value:function(){}},{key:"updateContactRichStatus",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("EVT_SERVICE_INITIATED"===e.telStatus||"EVT_ESTABLISHED"===e.telStatus)e.status="busy",e.message="audioPhone";else{if("subscribe"===e.ask)e.status="wait";else if("none"===e.subscription||"from"===e.subscription)e.status="unknown";else{var n=this.calculateContactStatusFromResources(e,t);"xa"===n.presence&&(""!==n.message||t?"away"===n.message&&(n.presence="away",n.message=""):n.presence="offline"),e.calendarState.applyCalendarPresence&&"busy"===e.calendarState.message&&(n.presence="dnd",n.message="appointment"),e.status=n.presence,e.message=n.message,this.logger.info("[contactService] updateContactRichStatus ".concat(t?"MY ":"USER"," PRESENCE : ").concat(n.presence," || message : ").concat(n.message))}this.updateContactStatusMessage(e)}t&&this.eventService.publish("ON_UPDATE_MYCONTACT_EVENT"),this.eventService.publish("ON_UPDATE_CONTACT_RICH_STATUS_EVENT",e)}},{key:"calculateContactStatusFromResources",value:function(e,t){var n="offline",r="",i=null,a=null,o=e.fullJid,s=!1,c=config.webrtcWithMobiles;for(var l in e.resources)if(e.resources.hasOwnProperty(l)){var u=e.resources[l];if("dnd"===u.show&&"phone"===u.status){n="busy",r="audioPhone",s=!0,o=l;break}if("xa"===u.show||"dnd"===u.show&&""===u.status){var d=!1;u.initStamp?i?u.initStamp.getTime()>i.getTime()&&(i=u.initStamp,d=!0):(i=u.initStamp,d=!0):a?u.stamp.getTime()>a.getTime()&&(a=u.stamp,i=u.stamp,d=!0):(a=u.stamp,i=u.stamp,d=!0),d&&(n=u.show,r=u.status)}else"xa"!==n&&("dnd"!==n||"dnd"===n&&""!==r)&&"dnd"===u.show&&""!==u.status?("presentation"===u.status?(n=u.show,r="presentation"):(n="busy",r=u.status),o=l,s=!0):t&&"online"===u.show&&"mode=auto"===u.status&&l===e.fullJid?"busy"!==n&&"dnd"!==n&&"presentation"!==r&&(n="online",r="",u.status="",this.xmppService.isMobileResource(l)?n="online-mobile":s=!0):"online"===u.show&&"xa"!==n&&"dnd"!==n&&"busy"!==n?(r="","online-mobile"!==n&&(n="online"),u.status="",this.xmppService.isMobileResource(l)?n="online-mobile":(o=l,s=!0),c&&(o=l)):"away"===u.show&&"offline"===n&&(n="away",r="",o=l);"mode=auto"===u.status&&(u.status="")}for(var h in e.resources)e.resources.hasOwnProperty(h)&&"mode=auto"===e.resources[h].status&&(e.resources[h].status="");return t||e.fullJid||(e.fullJid=o),"online-mobile"===n&&s?(n="online",r=""):"online-mobile"!==n||t||c||(e.fullJid=null,r=""),{presence:n,message:r}}},{key:"updatePresence",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger.info("[contactService] updatePresence"),this.manualState?(this.logger.info("[contactService] updatePresence manualState"),"away"===this.userContact.status&&this.busyState&&"dnd"===this.busyState.status&&(this.setUserContactStatus("online","mode=auto"),setTimeout((function(){e.updatePresence()}),1e3))):!this.presentationModeActive||this.busyState&&this.busyState.status?this.busyState&&"dnd"===this.busyState.status?(this.logger.info("[contactService] updatePresence dnd "+this.busyState.message),this.xmppService.sendPresence("dnd",this.busyState.message)):this.awayStateActive?(this.logger.info("[contactService] updatePresence away"),this.xmppService.sendPresence("away","")):this.userContact&&"online"!==this.userContact.status?(this.logger.info("[contactService] updatePresence online"),this.setUserContactStatus("online")):t&&this.userContact&&"online"===this.userContact.status&&(this.logger.info("[contactService] updatePresence forced online"),this.setUserContactStatus("online")):(this.logger.info("[contactService] updatePresence dnd presentation"),this.xmppService.sendPresence("dnd","presentation"))}},{key:"setUserContactStatus",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;try{this.logger.info("[contactService] Set userContact status : "+e+(t?"("+t+")":"")),this.xmppService.started&&("online"===e?(this.manualState=!1,this.xmppService.sendPresence(null,t,n,r)):(this.manualState=!0,"away"===e?this.xmppService.sendPresence("away",t,n,r):"dnd"===e?this.xmppService.sendPresence("dnd",t,n,r):"xa"===e&&this.xmppService.sendPresence("xa",t,n,r)))}catch(i){this.logger.error("[contactService] Set userContact status error : "+i)}}},{key:"updateContactTelephonyStatus",value:function(e,t,n){var r=e.telStatus;if("pcg2"===this.getResourceFromJid(t.jid))switch(t.status){case"offline":e.telStatus="";break;case"online":e.telStatus="EVT_CONNECTION_CLEARED";break;case"dnd":e.telStatus="EVT_ESTABLISHED";break;default:e.telStatus=""}else e.telStatus=t.message;this.updateContactRichStatus(e,n),n&&r!==e.telStatus&&this.eventService.publish("ON_UPDATE_MYTELEPHONY_STATUS_EVENT")}},{key:"updateContactIMStatus",value:function(e,t,n){if(e.imStatusStamp[t.jid]&&e.imStatusStamp[t.jid]>t.stamp)this.logger.info("[contactService] Ignore obsolete presence message for contact "+e.jid);else{this.logger.info("[contactService] updateIMStatus "+JSON.stringify(t)),e.imStatusStamp[t.jid]=t.stamp,t.status&&(e.imStatus=t.status);var r=t.message?t.message:"";if("offline"===e.imStatus?(e.fullJid===t.jid&&(e.fullJid=null),delete e.resources[t.jid],delete e.imStatusStamp[t.jid],0===e.resources.length&&(e.message="")):(e.resources[t.jid]?(e.resources[t.jid].show=e.imStatus,e.resources[t.jid].status=r,e.resources[t.jid].stamp=t.stamp):e.resources[t.jid]={show:e.imStatus,status:r,initStamp:t.stamp,stamp:t.stamp},this.logger.info("[Contact] updateIMStatus user resources after update "+JSON.stringify(e.resources)),this.xmppService.isMobileResource(t.jid)||n||(e.fullJid=t.jid),!n&&config.webrtcWithMobiles&&(e.fullJid=t.jid)),this.updateContactRichStatus(e,n),n&&this.xmppService.isMobileResource(t.jid)&&("offline"!==t.status&&null===e.mobileResource&&(e.mobileResource=t.jid,this.logger.info("[Contact] updateIMStatus: post event ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT"),this.eventService.publish("ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT","started")),"offline"===t.status)){var i=null;for(var a in e.resources)if(e.resources.hasOwnProperty(a)&&this.xmppService.isMobileResource(a)){i=a;break}e.mobileResource=i,null===e.mobileResource&&this.eventService.publish("ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT","stopped")}}}},{key:"getContactLastActivityMessage",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.lastActivityMessage){t.next=3;break}return t.abrupt("return");case 3:this.xmppService.connection.lastactivity.query(e.jid,{onResponse:function(t){var r=1e3*Number.parseInt($(t).find("query").attr("seconds"),10),i=(new Date).getTime(),a=new Date(i-r);n.updateContactLastActivityDate(e,a)}}),t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),new Error("[contactService] getInitialContactLastActivityMessage -- Failure -- "+t.t0.message);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"updateContactsLastActivityMessage",value:function(){var e=this;this.contacts&&Object.keys(this.contacts).forEach((function(t){e.updateContactStatusMessage(e.contacts[t])}))}},{key:"updateLastActivity",value:function(e){var t=null;"offline"!==e.status&&"away"!==e.status||Object.keys(e.imStatusStamp).forEach((function(n){var r=e.imStatusStamp[n];(!t||t<r)&&(t=r)})),this.updateContactLastActivityDate(e,t)}},{key:"updateContactLastActivityDate",value:function(e,t){e.lastActivityDate=t,this.updateContactStatusMessage(e)}},{key:"updateContactStatusMessage",value:function(e){if(e.lastActivityDate){var t=w(e.lastActivityDate);w.locale().startsWith("de")?(e.lastActivityMessage=t.fromNow(!0).replace("Tage","Tagen"),e.lastActivityMessage=e.lastActivityMessage.replace("eine Stunde","einer Stunde")):e.lastActivityMessage=t.fromNow(!0)}else e.lastActivityMessage="";if("unknown"===e.status?e.statusMessage=this.i18nService.translate("unknown"):"offline"===e.status&&""===e.lastActivityMessage?e.statusMessage=this.i18nService.translate("offlineFilter"):"away"===e.status&&""===e.lastActivityMessage?e.statusMessage=this.i18nService.translate("shortAway"):e.statusMessage=this.i18nService.translate(e.status,{offlineDate:e.lastActivityMessage}),e.message){var n=this.i18nService.translate(e.message);"("!==n.charAt(0)&&(n="("+n+")"),e.statusMessage+=" "+n}}},{key:"deleteUserAccount",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.logger.info("[contactService] deleteUserAccount"),t="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userContact.dbId),e.next=5,fetch(t,{method:"DELETE",headers:this.authService.getRequestHeader()});case 5:if((n=e.sent).ok){e.next=8;break}throw n;case 8:return e.next=10,n.json();case 10:e.next=18;break;case 12:return e.prev=12,e.t0=e.catch(0),e.next=16,this.errorHelperService.getErrorInfo(e.t0,"deleteUserAccount");case 16:throw r=e.sent,this.logger.error(r.message),r.error;case 18:case"end":return e.stop()}}),e,this,[[0,12]])})))}},{key:"removeContact",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.dbId){t.next=3;break}throw new Error("[contactService] removeContact : wrongContact");case 3:return n="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/networks/").concat(e.dbId),t.next=6,fetch(n,{method:"DELETE",headers:this.authService.getRequestHeader()});case 6:if((r=t.sent).ok){t.next=9;break}throw r;case 9:return t.next=11,r.json();case 11:this.logger.info("[contactService] removeContact ".concat(e.dbId," -- SUCCESS")),t.next=20;break;case 14:return t.prev=14,t.t0=t.catch(0),t.next=18,this.errorHelperService.getErrorInfo(t.t0,"removeContact");case 18:throw i=t.sent,this.logger.error(i.message),i.error;case 20:case"end":return t.stop()}}),t,this,[[0,14]])})))}},{key:"pushAvatarImage",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.userContact.avatar,t.prev=1,this.logger.info("[contactService] Push avatar image"),t.next=5,y.resizeImage(e,512,512);case 5:return r=t.sent,i=y.getBinaryData(r),a="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userContact.dbId,"/avatar"),o=this.authService.getPostHeader("image/"+i.type),t.next=11,fetch(a,{method:"POST",headers:o,body:i.data});case 11:if((s=t.sent).ok){t.next=14;break}throw s;case 14:return t.next=16,s.json();case 16:t.next=25;break;case 18:return t.prev=18,t.t0=t.catch(1),this.userContact.avatar=n,t.next=23,this.errorHelperService.getErrorInfo(t.t0,"pushAvatarImage");case 23:throw c=t.sent,this.logger.error(c.message),c.error;case 25:case"end":return t.stop()}}),t,this,[[1,18]])})))}},{key:"notifyImByEmail",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=null,t.prev=1,r=config.restServerUrl+"/api/rainbow/enduser/v1.0/notifications/emails/offline",i=this.authService.getRequestHeader(),t.next=6,fetch(r,{method:"POST",headers:i,body:JSON.stringify({userId:e.dbId})});case 6:if((a=t.sent).ok){t.next=9;break}throw a;case 9:return t.next=11,a.json();case 11:n=t.sent,o="",n.data&&n.data.email&&(o=n.data.email.substr(0,3)+"***"+n.data.email.substr(-3)),this.logger.info("[contactService] notifyImByEmail "+o+" - success"),t.next=22;break;case 16:return t.prev=16,t.t0=t.catch(1),t.next=20,this.errorHelperService.getErrorInfo(t.t0,"notifyImByEmail");case 20:throw s=t.sent,this.logger.error(s.message),s.error;case 22:case"end":return t.stop()}}),t,this,[[1,16]])})))}},{key:"myMobileAvailable",value:function(){return this.userContact?this.userContact.mobileResource:null}},{key:"sendSubscribeInvitation",value:function(e){return this.logger.info("[contactService] Send subscribe invitation to "+e),this.xmppService.send($pres({to:e,type:"subscribe"}))}},{key:"onPresentationModeChangedEvent",value:function(e){"active"===e?this.presentationModeActive=!0:"disable"===e&&(this.presentationModeActive=!1),null===this.lastUpdatePresentationMode&&(this.logger.debug("[contactService] onPresentationModeChangedEvent '".concat(e,"' request presence update")),this.lastUpdatePresentationMode=this.presentationModeActive,this.updatePresence()),this.startUpdatePresentationModeRefreshTimer()}},{key:"startUpdatePresentationModeRefreshTimer",value:function(){var e=this;this.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer"),null!==this.presentationModeTimeout&&(clearTimeout(this.presentationModeTimeout),this.presentationModeTimeout=null),this.presentationModeTimeout=setTimeout((function(){e.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval reach"),e.lastUpdatePresentationMode!==e.presentationModeActive?(e.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval - request presence update"),e.lastUpdatePresentationMode=e.presentationModeActive,e.updatePresence(),e.startUpdatePresentationModeRefreshTimer()):(e.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval - no presence update needed"),e.lastUpdatePresentationMode=null)}),1e3)}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.contactService||(t.rainbow.contactService=new e),t.rainbow.contactService}}]),e}();t.ContactService=E,t.default=E.getInstance()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),a=n(5),o=n(32),s=n(18),c=n(300),l=n(301),u=n(304),d=n(10),h=n(24);window.moduleIds.push("$$APP_PWD_PART1$$"),window.moduleIds.push("$$APP_PWD_PART2$$"),window.moduleIds.push("$$APP_PWD_PART3$$"),window.moduleIds.push("$$APP_PWD_PART4$$");var f=function(){function e(){S(this,e),this.SSO_LOGIN_POPUP_WINDOW_NAME="Single Sign-On Login",this.token=null,this.appToken=null,this.login=null,this.userId=null,this.jidIm=null,this.jidTel=null,this.jidPwd=null,this.xmppDomain=null,this.companyId=null,this.firstUseNewVersion=!1,this.initialized=!1,this.isGuest=!1,this.authType="RAINBOW",this.fromSDK=!1,this.authSettings=null,this.browserFingerprint=null,this.visibilityHandlerRemoval=null,this.renewTokenInterval=null,this.renewAppTokenInterval=null,this.sdkHostForced=null,this.win=window,this.rxSubject=new d.Subject;var t=localStorage.getItem("version"),n=this.getMajorVersion(t),r=this.getMajorVersion(this.win.version);config.appModuleKey||(config.appModuleKey=this.win.moduleIds?this.win.moduleIds.join(""):"default"),n!==r&&(this.firstUseNewVersion=!0),localStorage.setItem("version",this.win.version),this.getServerApiUrls()}return C(e,[{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"emitEvent",value:function(e){this.rxSubject.next(h.RBEvent.create(e))}},{key:"logon",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return r(this,void 0,void 0,b.a.mark((function r(){var o,c,l,d,h,f,p,m,v,g;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,-1!==e.indexOf("@")){r.next=3;break}throw this.createError("Wrong login format '".concat(e,"'"),"errorUnauthorized",401500,void 0,!0);case 3:return o=config.restServerUrl+"/api/rainbow/authentication/v1.0/login",a&&("RAINBOW"===a.type?o=a.loginUrl:a.safetyUrl&&(o=a.safetyUrl,this.authType=a.type)),(c={}).Authorization="Basic "+window.btoa(unescape(encodeURIComponent(e+":"+t))),c.Accept="application/json",this.setInformationHeaders(c),l=null,config.rainbowApiClientKey&&(l=config.rainbowApiClientKey+":"+s.SHA256(config.appModuleKey+t)),this.fromSDK&&this.appToken&&this.appToken.appID&&(l=this.appToken.appID+":"+s.SHA256(this.appToken.appSecret+t)),l&&(c["x-rainbow-app-auth"]="Basic "+window.btoa(unescape(encodeURIComponent(l)))),r.next=11,u.default(o,{method:"GET",headers:c,credentials:"include"});case 11:if((d=r.sent).ok){r.next=14;break}throw d;case 14:return r.next=16,d.json();case 16:h=r.sent,this.token=h.token,this.extractUserInfo(h.loggedInUser),n?(i.default.info("[AuthService] Store authentication info in local storage"),localStorage.setItem("login",this.login),localStorage.setItem("id",this.userId),localStorage.setItem("token",this.token),localStorage.setItem("authType",this.authType)):this.removeCredentials(),localStorage.setItem("firstUse","false"),i.default.info("[AuthService] Authenticate with ".concat(e," -- SUCCESS")),this.registerEventsHandler(),this.startTokenSurvey(),r.next=35;break;case 20:if(r.prev=20,r.t0=r.catch(0),f="authenticate for login ".concat(e," -- FAILURE -- "),!r.t0.localError){r.next=25;break}throw i.default.error("[AuthService] ".concat(f," ").concat(r.t0)),r.t0;case 25:if(p="errorUltimateUnknownError",m=null,v=null,0!==r.t0.status&&-1!==r.t0.status){r.next=30;break}f+="No server response",p="errorNoServerResponse",r.next=34;break;case 30:return r.next=32,r.t0.json();case 32:g=r.sent,401===r.t0.status?(this.removeCredentials(),f+=g.errorDetails,m=g.errorDetailsCode,401500===g.errorDetailsCode?p="errorUnauthorized":401501===g.errorDetailsCode&&(p="errorLoginForbidden",g.errorDetailsData&&(v={delay:g.errorDetailsData.forbiddenDelay}))):500===r.t0.status&&(f+=g.errorDetails,p="errorInternalServerError");case 34:throw i.default.error("[AuthService] "+f),this.createError(f,p,m,v);case 35:case"end":return r.stop()}}),r,this,[[0,20]])})))}},{key:"logonWithToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,i.default.info("[authService] logonWithToken -- "+e),e||(e=localStorage.getItem("token")),e){t.next=3;break}throw new Error("No token");case 3:return n=l(e),this.token=e,this.login=n.user.loginEmail,this.userId=n.user.id,this.authType="RAINBOW",n.saml&&(this.authType="SAML"),n.oidc&&(this.authType="OIDC"),localStorage.setItem("token",this.token),localStorage.setItem("login",this.login),localStorage.setItem("id",this.userId),localStorage.setItem("authType",this.authType),t.next=16,this.getUserData();case 16:return t.next=18,this.startTokenSurvey();case 18:return t.next=20,this.getUserAuthenticationSettings(this.login);case 20:this.authSettings=t.sent,this.registerEventsHandler(),t.next=28;break;case 24:throw t.prev=24,t.t0=t.catch(0),"No token"===(r=t.t0?t.t0.message:"Unknown error")?i.default.debug("[AuthService] AuthenticateWithToken -- No available token"):i.default.error("[AuthService] AuthenticateWithToken -- FAILURE -- "+r),new Error(r);case 28:case"end":return t.stop()}}),t,this,[[0,24]])})))}},{key:"sdkLogOn",value:function(e,t,n,i,a){return r(this,void 0,void 0,b.a.mark((function r(){return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(this.sdkHostForced=n,this.appToken=i,this.fromSDK=!0,this.getServerApiUrls(),a?this.logonWithToken(a):this.logon(e,t,!1)));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"logout",value:function(){var e=this;return this.removeCredentials(),this.authSettings&&this.authSettings.logoutUrl&&"RAINBOW"!==this.authType?(i.default.info("[authService] Logout -- "+this.authType),this.authSettings.setParameter("token",(function(){return e.token})),this.authSettings.logoutUrl):(i.default.info("[AuthService] Logout -- SUCCESS"),null)}},{key:"getUserAuthenticationSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(this,void 0,void 0,b.a.mark((function n(){var r,a,o,s,l,d,h,f,p,m,v=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,r=config.restServerUrl+"/api/rainbow/authentication/v1.0/login",config.disableSSO&&(t=!0),!t){n.next=4;break}return n.abrupt("return",c.AuthSettings.createFromData([{type:"RAINBOW",loginUrl:r}]));case 4:return a="".concat(config.restServerUrl,"/api/rainbow/authentication/v1.0/urls?uid=").concat(encodeURIComponent(e)),o={},this.setInformationHeaders(o),n.next=8,u.default(a,{method:"GET",headers:o});case 8:if((s=n.sent).ok){n.next=11;break}throw s;case 11:return n.next=13,s.json();case 13:return l=n.sent,d=c.AuthSettings.createFromData(l.data),n.abrupt("return",(d.setParameter("uid",(function(){return e})),d.setParameter("x-rainbow-app-auth",(function(e){return v.getRainbowAppAuth(config.rainbowApiClientKey,config.appModuleKey,e)})),!window||-1===window.location.href.indexOf("localhost")&&-1===window.location.href.indexOf("openrainbow.red")||d.setParameter("safetyUrl",(function(){return r})),d));case 18:if(n.prev=18,n.t0=n.catch(0),h='authenticate for login "'+e+'" failure : ',f="errorUltimateUnknownError",0!==n.t0.status&&-1!==n.t0.status){n.next=25;break}h+="No server response",f="errorNoServerResponse",n.next=29;break;case 25:return n.next=27,n.t0.json();case 27:p=n.sent,400===n.t0.status||404===n.t0.status?(h+=p.errorDetails,f="noMatchingAccount"):500===n.t0.status&&(h+=p.errorDetails,f="errorInternalServerError");case 29:throw i.default.info("[authService] "+h),(m=new Error(h)).details=f,m;case 32:case"end":return n.stop()}}),n,this,[[0,18]])})))}},{key:"removeCredentials",value:function(){this.authType="RAINBOW",localStorage.removeItem("id"),localStorage.removeItem("token"),localStorage.removeItem("authType"),localStorage.removeItem("token"),this.isGuest&&(localStorage.removeItem("login"),this.isGuest=!1),this.resetUserEnvironment(),i.default.debug("[AuthService] removeCredentials -- SUCCESS")}},{key:"resetUserEnvironment",value:function(){config.defaultEnvironment&&(config.xmpp.currentServer=config.defaultEnvironment,config.xmpp.server=config.defaultEnvironment,config.webservices.currentServer=config.defaultEnvironment,config.webservices.server=config.defaultEnvironment)}},{key:"getRequestHeader",value:function(e){return{Authorization:"Bearer "+this.token,Accept:e||"application/json"}}},{key:"getRequestHeaderWithRange",value:function(e){var t=this.getRequestHeader();return t.Range=e,t}},{key:"getPostHeader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getRequestHeader(t);return n["Content-Type"]=e||"application/json",n}},{key:"getPostHeaderWithRange",value:function(e,t){var n=this.getPostHeader(t);return n["Content-Range"]=e,n}},{key:"setInformationHeaders",value:function(e){e["x-rainbow-client"]=this.getInformationHeadersApp(),e["x-rainbow-client-version"]=this.getInformationHeadersAppVersion()}},{key:"getInformationHeadersApp",value:function(){return"web_sdk"}},{key:"getInformationHeadersAppVersion",value:function(){var e=window;return e.sdkversion?e.sdkversion:"9.9.99"}},{key:"startTokenSurvey",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.startAppTokenSurvey();case 3:return e.next=5,this.startUserTokenSurvey();case 5:i.default.debug("[AuthService] StartTokenSurvey -- SUCCESS"),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),t=e.t0&&e.t0.message?e.t0:new Error("Unknown error"),i.default.error("[AuthService] StartTokenSurvey -- FAILURE -- "+t.message),t;case 12:case"end":return e.stop()}}),e,this,[[0,8]])})))}},{key:"getRainbowAppAuth",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return window.btoa(unescape(encodeURIComponent((e||"")+":"+s.SHA256((t||"")+(n||"")))))}},{key:"registerEventsHandler",value:function(){var e=this;this.visibilityHandlerRemoval&&this.visibilityHandlerRemoval(),this.visibilityHandlerRemoval=o.default.subscribe("ON_APP_VISIBLE_CHANGE_EVENT",(function(t,n){n&&e.startTokenSurvey()}))}},{key:"getMajorVersion",value:function(e){if(!e)return null;var t=/\d+\.\d+/g.exec(e);return t&&t.length>0?t[0]:null}},{key:"getServerApiUrls",value:function(){var e=localStorage.getItem("server");e&&"null"!==e&&"undefined"!==e?(i.default.debug("[AuthService] getServerApiUrls -- Find server data from local storage -- "+e),config.xmpp.currentServer=config.webservices.currentServer=e,"openrainbow.net"===e&&(config.appModuleKey=config.dotNetAppModuleKey,config.rainbowApiClientKey=config.dotNetRainbowApiClientKey,config.multiEnvServer="openrainbow.net"),"openrainbow.com"===e&&(config.appModuleKey=config.dotComAppModuleKey,config.rainbowApiClientKey=config.dotComRainbowApiClientKey,config.multiEnvServer="openrainbow.com"),"openrainbow.red"===e&&(config.appModuleKey=config.dotComAppModuleKey,config.rainbowApiClientKey=config.dotComRainbowApiClientKey,config.multiEnvServer="openrainbow.com"),config.defaultEnvironment||(config.defaultEnvironment=config.xmpp.currentServer)):this.sdkHostForced?(config.xmpp.currentServer=config.webservices.currentServer=this.sdkHostForced,i.default.debug("[AuthService] getServerApiUrls -- Use forced sdk server -- "+this.sdkHostForced)):config.xmpp&&(config.xmpp.currentServer=config.xmpp.server,config.webservices.currentServer=config.webservices.server,i.default.debug("[AuthService] getServerApiUrls -- Use default config server -- "+config.xmpp.server)),config.webservices&&(config.restServerUrl="".concat(config.webservices.protocol,"://").concat(config.webservices.currentServer,":").concat(config.webservices.port))}},{key:"startAppTokenSurvey",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,a,o,s=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appToken&&"string"==typeof this.appToken&&this.appToken.length){e.next=2;break}return e.abrupt("return",void i.default.info("[AuthService] startAppTokenSurvey -- No application token."));case 2:if(t=l(this.appToken),n=1e3*t.exp,r=new Date(n),a=n-(new Date).valueOf(),this.renewAppTokenInterval&&clearTimeout(this.renewAppTokenInterval),i.default.info("[AuthService] startAppTokenSurvey -- Extract application token info (countRenewed: "+t.countRenewed+", maxTokenRenew: "+t.maxTokenRenew+")"),!(a<0)){e.next=8;break}return i.default.info("[AuthService] startAppTokenSurvey -- Application token has already expired, re-new it immediately"),e.next=7,this.renewAppToken();case 7:return e.abrupt("return",void e.sent);case 8:if(!(a<3e4)){e.next=13;break}return i.default.info("[AuthService] startAppTokenSurvey -- Application token will expire in less 5 minutes, re-new it immediately"),e.next=12,this.renewAppToken();case 12:return e.abrupt("return",void e.sent);case 13:o=a-24e3,i.default.info("[authService] startAppTokenSurvey -- Start application token survey (expirationDate: "+r+" tokenExpirationDuration: "+a+"ms usedExpirationDuration: "+o+"ms)"),this.renewAppTokenInterval=setTimeout((function(){s.renewAppToken()}),o);case 15:case"end":return e.stop()}}),e,this)})))}},{key:"renewAppToken",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,a,o,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=config.restServerUrl+"/api/rainbow/applications/v1.0/authentication/renew",e.next=4,u.default(t,{method:"GET",headers:this.getRequestHeader()});case 4:if((n=e.sent).ok){e.next=7;break}throw n;case 7:return e.next=9,n.json();case 9:r=e.sent,i.default.info("[AuthService] renewAppToken -- Renew application token success"),this.appToken=r.token,localStorage.setItem("appToken",this.appToken),this.emitEvent("ON_APP_TOKEN_RENEW"),this.startAppTokenSurvey(),e.next=22;break;case 13:return e.prev=13,e.t0=e.catch(0),this.renewAppTokenInterval&&clearTimeout(this.renewAppTokenInterval),e.next=18,e.t0.json();case 18:throw a=e.sent,o="Renew application token failure -- "+(a&&a.errorDetails?a.errorDetails:"no details"),(s=new Error(o)).details="APP_TOKEN_EXPIRED",i.default.error("[AuthService] renewAppToken -- FAILURE --"+o),this.emitEvent("ON_APP_TOKEN_EXPIRE"),s;case 22:case"end":return e.stop()}}),e,this,[[0,13]])})))}},{key:"startUserTokenSurvey",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,a,o,s,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.token&&"string"==typeof this.token&&this.token.length){e.next=2;break}return e.abrupt("return",void i.default.info("[AuthService] No token."));case 2:if(t=l(this.token),n=1e3*t.exp,r=(n-1e3*t.iat)/2,a=new Date(n),o=n-(new Date).valueOf(),this.renewTokenInterval&&clearTimeout(this.renewTokenInterval),i.default.info("[AuthService] startUserTokenSurvey -- Extract auth token info (countRenewed: "+t.countRenewed+", maxTokenRenew: "+t.maxTokenRenew+", tokenExpirationDuration: "+o+")"),!(o<0)){e.next=5;break}throw i.default.info("[AuthService] startUserTokenSurvey --  Auth token has already expired, display login page"),this.token=null,this.emitEvent("ON_AUTH_TOKEN_EXPIRE"),new Error("Token expired");case 5:if(!(o<r)){e.next=10;break}return i.default.info("[AuthService] startUserTokenSurvey -- Auth token will expire in less "+r/1e3+" seconds, re-new it immediately"),e.next=9,this.renewAuthToken();case 9:return e.abrupt("return",void e.sent);case 10:s=o-r,i.default.info("[AuthService] startUserTokenSurvey -- Start auth token survey (expirationDate: "+a+" tokenExpirationDuration: "+o+"ms usedExpirationDuration: "+s+"ms)"),this.renewTokenInterval=setTimeout((function(){c.renewAuthToken()}),s);case 12:case"end":return e.stop()}}),e,this)})))}},{key:"renewAuthToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r(this,void 0,void 0,b.a.mark((function t(){var n,r,a,o,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=config.restServerUrl+"/api/rainbow/authentication/v1.0/renew",t.next=4,u.default(n,{method:"GET",headers:this.getRequestHeader()});case 4:if((r=t.sent).ok){t.next=7;break}throw r;case 7:return t.next=9,r.json();case 9:a=t.sent,i.default.info("[AuthService] renewAuthToken -- Renew authentication token success"),this.token=a.token,localStorage.setItem("token",this.token),this.emitEvent("ON_AUTH_TOKEN_RENEW"),e&&!0!==e||this.startTokenSurvey(),t.next=22;break;case 13:return t.prev=13,t.t0=t.catch(0),this.renewTokenInterval&&clearTimeout(this.renewTokenInterval),t.next=18,t.t0.json();case 18:throw o=t.sent,s="Renew authentication token failure -- "+(o&&o.errorDetails?o.errorDetails:"no details"),(c=new Error(s)).details="AUTH_TOKEN_EXPIRED",i.default.error("[AuthService] renewAuthToken -- FAILURE -- "+s),this.emitEvent("ON_AUTH_TOKEN_EXPIRE"),c;case 22:case"end":return t.stop()}}),t,this,[[0,13]])})))}},{key:"getUserData",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userId),e.next=4,u.default(t,{method:"GET",headers:this.getRequestHeader()});case 4:if((n=e.sent).ok){e.next=7;break}throw n;case 7:return e.next=9,n.json();case 9:r=e.sent,this.extractUserInfo(r.data),e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(0),this.removeCredentials(),!(e.t0 instanceof Response)){e.next=17;break}throw new Error("Wrong token -- "+e.t0.statusText);case 17:throw new Error("Wrong token -- "+e.t0.message);case 18:case"end":return e.stop()}}),e,this,[[0,13]])})))}},{key:"getUserEnvironments",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,config.multiEnvServer){t.next=3;break}return t.abrupt("return",[{environmentApiUrl:"https://"+config.xmpp.currentServer}]);case 3:return config.defaultEnvironment||(config.defaultEnvironment=config.xmpp.server),n=config.webservices.protocol+"://"+config.multiEnvServer+":"+config.webservices.port+"/api/rainbow/multienvironments/v1.0/environments?loginEmail="+encodeURIComponent(e),t.next=7,u.default(n,{method:"GET"});case 7:if((r=t.sent).ok){t.next=10;break}throw r;case 10:return t.next=12,r.json();case 12:return t.abrupt("return",t.sent.data);case 15:if(t.prev=15,t.t0=t.catch(0),a='getUserEnvironments for login "'+e+'" failure : ',0!==t.t0.status&&-1!==t.t0.status){t.next=22;break}a+="No server response",t.next=27;break;case 22:if(500!==t.t0.status){t.next=27;break}return t.t1=a,t.next=26,t.t0.json();case 26:a=t.t1+=t.sent.errorDetails;case 27:return t.abrupt("return",(i.default.info("[authService] "+a),i.default.info("[authService] getUserEnvironment -- continue with default environment"),null));case 28:case"end":return t.stop()}}),t,null,[[0,15]])})))}},{key:"getCompanySAMLConfiguration",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(config.restServerUrl,"/api/rainbow/authentication/v1.0/saml/").concat(e,"/metadata.xml"),t.next=4,u.default(n,{method:"GET",headers:this.getRequestHeader()});case 4:if((r=t.sent).ok){t.next=7;break}throw r;case 7:return i.default.debug("[AuthService] getCompanySAMLConfiguration -- SUCCESS"),t.next=10,r.text();case 10:return t.abrupt("return",t.sent);case 13:throw t.prev=13,t.t0=t.catch(0),i.default.error("[AuthService] getCompanySAMLConfiguration -- FAILURE -- "+JSON.stringify(t.t0)),new Error("getCompanySAMLConfiguration failure");case 16:case"end":return t.stop()}}),t,this,[[0,13]])})))}},{key:"getFingerPrint",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.browserFingerprint){e.next=5;break}return t=["audio","availableScreenResolution","canvas","colorDepth","cookies","cpuClass","deviceDpi","doNotTrack","indexedDb","installedFonts","language","localStorage","pixelRatio","platform","plugins","processorCores","screenResolution","sessionStorage","timezoneOffset","touchSupport","userAgent","webGl"],e.next=4,imprint.test(t);case 4:this.browserFingerprint=e.sent;case 5:return e.abrupt("return",this.browserFingerprint);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"handleUserLanguage",value:function(){var e=this.loggedInUser.language;e&&a.default.setAppliLangageCodeFromServer(e)}},{key:"createError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=new Error(e);return a.details=t,a.detailsCode=n,a.detailsData=r,a.localError=i,a}},{key:"extractUserInfo",value:function(e){this.loggedInUser=e,this.login=this.loggedInUser.loginEmail,this.userId=this.loggedInUser.id,this.jidIm=this.loggedInUser.jid_im,this.jidPwd=this.loggedInUser.jid_password,this.jidTel=this.loggedInUser.jid_tel,this.initialized=this.loggedInUser.isInitialized,this.isGuest=this.loggedInUser.guestMode,this.companyId=this.loggedInUser.companyId,this.xmppDomain=this.jidIm.split("@")[1],this.handleUserLanguage()}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.authService||(t.rainbow.authService=new e),t.rainbow.authService}}]),e}();t.AuthService=f,t.default=f.getInstance()},function(e,t,n){(function(e){e.exports=function(){var t,r;function i(){return t.apply(null,arguments)}function a(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function o(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(s(e,t))return!1;return!0}function l(e){return void 0===e}function u(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function d(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function h(e,t){var n,r=[];for(n=0;n<e.length;++n)r.push(t(e[n],n));return r}function f(e,t){for(var n in t)s(t,n)&&(e[n]=t[n]);return s(t,"toString")&&(e.toString=t.toString),s(t,"valueOf")&&(e.valueOf=t.valueOf),e}function p(e,t,n,r){return Tt(e,t,n,r,!0).utc()}function m(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function v(e){if(null==e._isValid){var t=m(e),n=r.call(t.parsedDateParts,(function(e){return null!=e})),i=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(i=i&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return i;e._isValid=i}return e._isValid}function g(e){var t=p(NaN);return null!=e?f(m(t),e):m(t).userInvalidated=!0,t}r=Array.prototype.some?Array.prototype.some:function(e){var t,n=Object(this),r=n.length>>>0;for(t=0;t<r;t++)if(t in n&&e.call(this,n[t],t,n))return!0;return!1};var y=i.momentProperties=[],b=!1;function S(e,t){var n,r,i;if(l(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),l(t._i)||(e._i=t._i),l(t._f)||(e._f=t._f),l(t._l)||(e._l=t._l),l(t._strict)||(e._strict=t._strict),l(t._tzm)||(e._tzm=t._tzm),l(t._isUTC)||(e._isUTC=t._isUTC),l(t._offset)||(e._offset=t._offset),l(t._pf)||(e._pf=m(t)),l(t._locale)||(e._locale=t._locale),y.length>0)for(n=0;n<y.length;n++)l(i=t[r=y[n]])||(e[r]=i);return e}function _(e){S(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===b&&(b=!0,i.updateOffset(this),b=!1)}function C(e){return e instanceof _||null!=e&&null!=e._isAMomentObject}function w(e){!1===i.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function E(e,t){var n=!0;return f((function(){if(null!=i.deprecationHandler&&i.deprecationHandler(null,e),n){var r,a,o,c=[];for(a=0;a<arguments.length;a++){if(r="","object"==typeof arguments[a]){for(o in r+="\n["+a+"] ",arguments[0])s(arguments[0],o)&&(r+=o+": "+arguments[0][o]+", ");r=r.slice(0,-2)}else r=arguments[a];c.push(r)}w(e+"\nArguments: "+Array.prototype.slice.call(c).join("")+"\n"+(new Error).stack),n=!1}return t.apply(this,arguments)}),t)}var T,k={};function M(e,t){null!=i.deprecationHandler&&i.deprecationHandler(e,t),k[e]||(w(t),k[e]=!0)}function D(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function x(e,t){var n,r=f({},e);for(n in t)s(t,n)&&(o(e[n])&&o(t[n])?(r[n]={},f(r[n],e[n]),f(r[n],t[n])):null!=t[n]?r[n]=t[n]:delete r[n]);for(n in e)s(e,n)&&!s(t,n)&&o(e[n])&&(r[n]=f({},r[n]));return r}function R(e){null!=e&&this.set(e)}function O(e,t,n){var r=""+Math.abs(e),i=t-r.length;return(e>=0?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+r}i.suppressDeprecationWarnings=!1,i.deprecationHandler=null,T=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)s(e,t)&&n.push(t);return n};var I=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,P=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,A={},L={};function N(e,t,n,r){var i=r;"string"==typeof r&&(i=function(){return this[r]()}),e&&(L[e]=i),t&&(L[t[0]]=function(){return O(i.apply(this,arguments),t[1],t[2])}),n&&(L[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function j(e,t){return e.isValid()?(t=U(t,e.localeData()),A[t]=A[t]||function(e){var t,n,r,i=e.match(I);for(t=0,n=i.length;t<n;t++)L[i[t]]?i[t]=L[i[t]]:i[t]=(r=i[t]).match(/\[[\s\S]/)?r.replace(/^\[|\]$/g,""):r.replace(/\\/g,"");return function(t){var r,a="";for(r=0;r<n;r++)a+=D(i[r])?i[r].call(t,e):i[r];return a}}(t),A[t](e)):e.localeData().invalidDate()}function U(e,t){var n=5;function r(e){return t.longDateFormat(e)||e}for(P.lastIndex=0;n>=0&&P.test(e);)e=e.replace(P,r),P.lastIndex=0,n-=1;return e}var F={};function H(e,t){var n=e.toLowerCase();F[n]=F[n+"s"]=F[t]=e}function W(e){return"string"==typeof e?F[e]||F[e.toLowerCase()]:void 0}function Y(e){var t,n,r={};for(n in e)s(e,n)&&(t=W(n))&&(r[t]=e[n]);return r}var B={};function V(e,t){B[e]=t}function $(e){return e%4==0&&e%100!=0||e%400==0}function G(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function z(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=G(t)),n}function q(e,t){return function(n){return null!=n?(K(this,e,n),i.updateOffset(this,t),this):J(this,e)}}function J(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function K(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&$(e.year())&&1===e.month()&&29===e.date()?(n=z(n),e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),Ce(n,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](n))}var Q,X=/\d/,Z=/\d\d/,ee=/\d{3}/,te=/\d{4}/,ne=/[+-]?\d{6}/,re=/\d\d?/,ie=/\d\d\d\d?/,ae=/\d\d\d\d\d\d?/,oe=/\d{1,3}/,se=/\d{1,4}/,ce=/[+-]?\d{1,6}/,le=/\d+/,ue=/[+-]?\d+/,de=/Z|[+-]\d\d:?\d\d/gi,he=/Z|[+-]\d\d(?::?\d\d)?/gi,fe=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function pe(e,t,n){Q[e]=D(t)?t:function(e,r){return e&&n?n:t}}function me(e,t){return s(Q,e)?Q[e](t._strict,t._locale):new RegExp(ve(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(e,t,n,r,i){return t||n||r||i}))))}function ve(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}Q={};var ge,ye={};function be(e,t){var n,r=t;for("string"==typeof e&&(e=[e]),u(t)&&(r=function(e,n){n[t]=z(e)}),n=0;n<e.length;n++)ye[e[n]]=r}function Se(e,t){be(e,(function(e,n,r,i){r._w=r._w||{},t(e,r._w,r,i)}))}function _e(e,t,n){null!=t&&s(ye,e)&&ye[e](t,n._a,n,e)}function Ce(e,t){if(isNaN(e)||isNaN(t))return NaN;var n=(t%12+12)%12;return e+=(t-n)/12,1===n?$(e)?29:28:31-n%7%2}ge=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},N("M",["MM",2],"Mo",(function(){return this.month()+1})),N("MMM",0,0,(function(e){return this.localeData().monthsShort(this,e)})),N("MMMM",0,0,(function(e){return this.localeData().months(this,e)})),H("month","M"),V("month",8),pe("M",re),pe("MM",re,Z),pe("MMM",(function(e,t){return t.monthsShortRegex(e)})),pe("MMMM",(function(e,t){return t.monthsRegex(e)})),be(["M","MM"],(function(e,t){t[1]=z(e)-1})),be(["MMM","MMMM"],(function(e,t,n,r){var i=n._locale.monthsParse(e,r,n._strict);null!=i?t[1]=i:m(n).invalidMonth=e}));var we="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Ee="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Te=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,ke=fe,Me=fe;function De(e,t,n){var r,i,a,o=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)a=p([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(a,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(a,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=ge.call(this._shortMonthsParse,o))?i:null:-1!==(i=ge.call(this._longMonthsParse,o))?i:null:"MMM"===t?-1!==(i=ge.call(this._shortMonthsParse,o))||-1!==(i=ge.call(this._longMonthsParse,o))?i:null:-1!==(i=ge.call(this._longMonthsParse,o))||-1!==(i=ge.call(this._shortMonthsParse,o))?i:null}function xe(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=z(t);else if(!u(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),Ce(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Re(e){return null!=e?(xe(this,e),i.updateOffset(this,!0),this):J(this,"Month")}function Oe(){function e(e,t){return t.length-e.length}var t,n,r=[],i=[],a=[];for(t=0;t<12;t++)n=p([2e3,t]),r.push(this.monthsShort(n,"")),i.push(this.months(n,"")),a.push(this.months(n,"")),a.push(this.monthsShort(n,""));for(r.sort(e),i.sort(e),a.sort(e),t=0;t<12;t++)r[t]=ve(r[t]),i[t]=ve(i[t]);for(t=0;t<24;t++)a[t]=ve(a[t]);this._monthsRegex=new RegExp("^("+a.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+r.join("|")+")","i")}function Ie(e){return $(e)?366:365}N("Y",0,0,(function(){var e=this.year();return e<=9999?O(e,4):"+"+e})),N(0,["YY",2],0,(function(){return this.year()%100})),N(0,["YYYY",4],0,"year"),N(0,["YYYYY",5],0,"year"),N(0,["YYYYYY",6,!0],0,"year"),H("year","y"),V("year",1),pe("Y",ue),pe("YY",re,Z),pe("YYYY",se,te),pe("YYYYY",ce,ne),pe("YYYYYY",ce,ne),be(["YYYYY","YYYYYY"],0),be("YYYY",(function(e,t){t[0]=2===e.length?i.parseTwoDigitYear(e):z(e)})),be("YY",(function(e,t){t[0]=i.parseTwoDigitYear(e)})),be("Y",(function(e,t){t[0]=parseInt(e,10)})),i.parseTwoDigitYear=function(e){return z(e)+(z(e)>68?1900:2e3)};var Pe=q("FullYear",!0);function Ae(e,t,n,r,i,a,o){var s;return e<100&&e>=0?(s=new Date(e+400,t,n,r,i,a,o),isFinite(s.getFullYear())&&s.setFullYear(e)):s=new Date(e,t,n,r,i,a,o),s}function Le(e){var t,n;return e<100&&e>=0?((n=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,n)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function Ne(e,t,n){var r=7+t-n;return-(7+Le(e,0,r).getUTCDay()-t)%7+r-1}function je(e,t,n,r,i){var a,o,s=1+7*(t-1)+(7+n-r)%7+Ne(e,r,i);return s<=0?o=Ie(a=e-1)+s:s>Ie(e)?(a=e+1,o=s-Ie(e)):(a=e,o=s),{year:a,dayOfYear:o}}function Ue(e,t,n){var r,i,a=Ne(e.year(),t,n),o=Math.floor((e.dayOfYear()-a-1)/7)+1;return o<1?r=o+Fe(i=e.year()-1,t,n):o>Fe(e.year(),t,n)?(r=o-Fe(e.year(),t,n),i=e.year()+1):(i=e.year(),r=o),{week:r,year:i}}function Fe(e,t,n){var r=Ne(e,t,n),i=Ne(e+1,t,n);return(Ie(e)-r+i)/7}function He(e,t){return e.slice(t,7).concat(e.slice(0,t))}N("w",["ww",2],"wo","week"),N("W",["WW",2],"Wo","isoWeek"),H("week","w"),H("isoWeek","W"),V("week",5),V("isoWeek",5),pe("w",re),pe("ww",re,Z),pe("W",re),pe("WW",re,Z),Se(["w","ww","W","WW"],(function(e,t,n,r){t[r.substr(0,1)]=z(e)})),N("d",0,"do","day"),N("dd",0,0,(function(e){return this.localeData().weekdaysMin(this,e)})),N("ddd",0,0,(function(e){return this.localeData().weekdaysShort(this,e)})),N("dddd",0,0,(function(e){return this.localeData().weekdays(this,e)})),N("e",0,0,"weekday"),N("E",0,0,"isoWeekday"),H("day","d"),H("weekday","e"),H("isoWeekday","E"),V("day",11),V("weekday",11),V("isoWeekday",11),pe("d",re),pe("e",re),pe("E",re),pe("dd",(function(e,t){return t.weekdaysMinRegex(e)})),pe("ddd",(function(e,t){return t.weekdaysShortRegex(e)})),pe("dddd",(function(e,t){return t.weekdaysRegex(e)})),Se(["dd","ddd","dddd"],(function(e,t,n,r){var i=n._locale.weekdaysParse(e,r,n._strict);null!=i?t.d=i:m(n).invalidWeekday=e})),Se(["d","e","E"],(function(e,t,n,r){t[r]=z(e)}));var We="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Ye="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Be="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ve=fe,$e=fe,Ge=fe;function ze(e,t,n){var r,i,a,o=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)a=p([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(a,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(a,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(a,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=ge.call(this._weekdaysParse,o))?i:null:"ddd"===t?-1!==(i=ge.call(this._shortWeekdaysParse,o))?i:null:-1!==(i=ge.call(this._minWeekdaysParse,o))?i:null:"dddd"===t?-1!==(i=ge.call(this._weekdaysParse,o))||-1!==(i=ge.call(this._shortWeekdaysParse,o))||-1!==(i=ge.call(this._minWeekdaysParse,o))?i:null:"ddd"===t?-1!==(i=ge.call(this._shortWeekdaysParse,o))||-1!==(i=ge.call(this._weekdaysParse,o))||-1!==(i=ge.call(this._minWeekdaysParse,o))?i:null:-1!==(i=ge.call(this._minWeekdaysParse,o))||-1!==(i=ge.call(this._weekdaysParse,o))||-1!==(i=ge.call(this._shortWeekdaysParse,o))?i:null}function qe(){function e(e,t){return t.length-e.length}var t,n,r,i,a,o=[],s=[],c=[],l=[];for(t=0;t<7;t++)n=p([2e3,1]).day(t),r=ve(this.weekdaysMin(n,"")),i=ve(this.weekdaysShort(n,"")),a=ve(this.weekdays(n,"")),o.push(r),s.push(i),c.push(a),l.push(r),l.push(i),l.push(a);o.sort(e),s.sort(e),c.sort(e),l.sort(e),this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+o.join("|")+")","i")}function Je(){return this.hours()%12||12}function Ke(e,t){N(e,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)}))}function Qe(e,t){return t._meridiemParse}N("H",["HH",2],0,"hour"),N("h",["hh",2],0,Je),N("k",["kk",2],0,(function(){return this.hours()||24})),N("hmm",0,0,(function(){return""+Je.apply(this)+O(this.minutes(),2)})),N("hmmss",0,0,(function(){return""+Je.apply(this)+O(this.minutes(),2)+O(this.seconds(),2)})),N("Hmm",0,0,(function(){return""+this.hours()+O(this.minutes(),2)})),N("Hmmss",0,0,(function(){return""+this.hours()+O(this.minutes(),2)+O(this.seconds(),2)})),Ke("a",!0),Ke("A",!1),H("hour","h"),V("hour",13),pe("a",Qe),pe("A",Qe),pe("H",re),pe("h",re),pe("k",re),pe("HH",re,Z),pe("hh",re,Z),pe("kk",re,Z),pe("hmm",ie),pe("hmmss",ae),pe("Hmm",ie),pe("Hmmss",ae),be(["H","HH"],3),be(["k","kk"],(function(e,t,n){var r=z(e);t[3]=24===r?0:r})),be(["a","A"],(function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e})),be(["h","hh"],(function(e,t,n){t[3]=z(e),m(n).bigHour=!0})),be("hmm",(function(e,t,n){var r=e.length-2;t[3]=z(e.substr(0,r)),t[4]=z(e.substr(r)),m(n).bigHour=!0})),be("hmmss",(function(e,t,n){var r=e.length-4,i=e.length-2;t[3]=z(e.substr(0,r)),t[4]=z(e.substr(r,2)),t[5]=z(e.substr(i)),m(n).bigHour=!0})),be("Hmm",(function(e,t,n){var r=e.length-2;t[3]=z(e.substr(0,r)),t[4]=z(e.substr(r))})),be("Hmmss",(function(e,t,n){var r=e.length-4,i=e.length-2;t[3]=z(e.substr(0,r)),t[4]=z(e.substr(r,2)),t[5]=z(e.substr(i))}));var Xe,Ze=q("Hours",!0),et={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:we,monthsShort:Ee,week:{dow:0,doy:6},weekdays:We,weekdaysMin:Be,weekdaysShort:Ye,meridiemParse:/[ap]\.?m?\.?/i},tt={},nt={};function rt(e,t){var n,r=Math.min(e.length,t.length);for(n=0;n<r;n+=1)if(e[n]!==t[n])return n;return r}function it(e){return e?e.toLowerCase().replace("_","-"):e}function at(t){var r=null;if(void 0===tt[t]&&void 0!==e&&e&&e.exports)try{r=Xe._abbr,n(271)("./"+t),ot(r)}catch(i){tt[t]=null}return tt[t]}function ot(e,t){var n;return e&&((n=l(t)?ct(e):st(e,t))?Xe=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),Xe._abbr}function st(e,t){if(null!==t){var n,r=et;if(t.abbr=e,null!=tt[e])M("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=tt[e]._config;else if(null!=t.parentLocale)if(null!=tt[t.parentLocale])r=tt[t.parentLocale]._config;else{if(null==(n=at(t.parentLocale)))return nt[t.parentLocale]||(nt[t.parentLocale]=[]),nt[t.parentLocale].push({name:e,config:t}),null;r=n._config}return tt[e]=new R(x(r,t)),nt[e]&&nt[e].forEach((function(e){st(e.name,e.config)})),ot(e),tt[e]}return delete tt[e],null}function ct(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Xe;if(!a(e)){if(t=at(e))return t;e=[e]}return function(e){for(var t,n,r,i,a=0;a<e.length;){for(t=(i=it(e[a]).split("-")).length,n=(n=it(e[a+1]))?n.split("-"):null;t>0;){if(r=at(i.slice(0,t).join("-")))return r;if(n&&n.length>=t&&rt(i,n)>=t-1)break;t--}a++}return Xe}(e)}function lt(e){var t,n=e._a;return n&&-2===m(e).overflow&&(t=n[1]<0||n[1]>11?1:n[2]<1||n[2]>Ce(n[0],n[1])?2:n[3]<0||n[3]>24||24===n[3]&&(0!==n[4]||0!==n[5]||0!==n[6])?3:n[4]<0||n[4]>59?4:n[5]<0||n[5]>59?5:n[6]<0||n[6]>999?6:-1,m(e)._overflowDayOfYear&&(t<0||t>2)&&(t=2),m(e)._overflowWeeks&&-1===t&&(t=7),m(e)._overflowWeekday&&-1===t&&(t=8),m(e).overflow=t),e}var ut=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,dt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ht=/Z|[+-]\d\d(?::?\d\d)?/,ft=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],pt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],mt=/^\/?Date\((-?\d+)/i,vt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,gt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function yt(e){var t,n,r,i,a,o,s=e._i,c=ut.exec(s)||dt.exec(s);if(c){for(m(e).iso=!0,t=0,n=ft.length;t<n;t++)if(ft[t][1].exec(c[1])){i=ft[t][0],r=!1!==ft[t][2];break}if(null==i)return void(e._isValid=!1);if(c[3]){for(t=0,n=pt.length;t<n;t++)if(pt[t][1].exec(c[3])){a=(c[2]||" ")+pt[t][0];break}if(null==a)return void(e._isValid=!1)}if(!r&&null!=a)return void(e._isValid=!1);if(c[4]){if(!ht.exec(c[4]))return void(e._isValid=!1);o="Z"}e._f=i+(a||"")+(o||""),wt(e)}else e._isValid=!1}function bt(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function St(e){var t,n,r,i,a,o,s,c,l=vt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(l){if(n=l[4],r=l[3],i=l[2],a=l[5],o=l[6],s=l[7],c=[bt(n),Ee.indexOf(r),parseInt(i,10),parseInt(a,10),parseInt(o,10)],s&&c.push(parseInt(s,10)),t=c,!function(e,t,n){return!e||Ye.indexOf(e)===new Date(t[0],t[1],t[2]).getDay()||(m(n).weekdayMismatch=!0,n._isValid=!1,!1)}(l[1],t,e))return;e._a=t,e._tzm=function(e,t,n){if(e)return gt[e];if(t)return 0;var r=parseInt(n,10),i=r%100;return(r-i)/100*60+i}(l[8],l[9],l[10]),e._d=Le.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),m(e).rfc2822=!0}else e._isValid=!1}function _t(e,t,n){return null!=e?e:null!=t?t:n}function Ct(e){var t,n,r,a,o,s=[];if(!e._d){for(r=function(e){var t=new Date(i.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}(e),e._w&&null==e._a[2]&&null==e._a[1]&&function(e){var t,n,r,i,a,o,s,c,l;null!=(t=e._w).GG||null!=t.W||null!=t.E?(a=1,o=4,n=_t(t.GG,e._a[0],Ue(kt(),1,4).year),r=_t(t.W,1),((i=_t(t.E,1))<1||i>7)&&(c=!0)):(a=e._locale._week.dow,o=e._locale._week.doy,l=Ue(kt(),a,o),n=_t(t.gg,e._a[0],l.year),r=_t(t.w,l.week),null!=t.d?((i=t.d)<0||i>6)&&(c=!0):null!=t.e?(i=t.e+a,(t.e<0||t.e>6)&&(c=!0)):i=a),r<1||r>Fe(n,a,o)?m(e)._overflowWeeks=!0:null!=c?m(e)._overflowWeekday=!0:(s=je(n,r,i,a,o),e._a[0]=s.year,e._dayOfYear=s.dayOfYear)}(e),null!=e._dayOfYear&&(o=_t(e._a[0],r[0]),(e._dayOfYear>Ie(o)||0===e._dayOfYear)&&(m(e)._overflowDayOfYear=!0),n=Le(o,0,e._dayOfYear),e._a[1]=n.getUTCMonth(),e._a[2]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=s[t]=r[t];for(;t<7;t++)e._a[t]=s[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[3]&&0===e._a[4]&&0===e._a[5]&&0===e._a[6]&&(e._nextDay=!0,e._a[3]=0),e._d=(e._useUTC?Le:Ae).apply(null,s),a=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[3]=24),e._w&&void 0!==e._w.d&&e._w.d!==a&&(m(e).weekdayMismatch=!0)}}function wt(e){if(e._f!==i.ISO_8601)if(e._f!==i.RFC_2822){e._a=[],m(e).empty=!0;var t,n,r,a,o,s,c=""+e._i,l=c.length,u=0;for(r=U(e._f,e._locale).match(I)||[],t=0;t<r.length;t++)a=r[t],(n=(c.match(me(a,e))||[])[0])&&((o=c.substr(0,c.indexOf(n))).length>0&&m(e).unusedInput.push(o),c=c.slice(c.indexOf(n)+n.length),u+=n.length),L[a]?(n?m(e).empty=!1:m(e).unusedTokens.push(a),_e(a,n,e)):e._strict&&!n&&m(e).unusedTokens.push(a);m(e).charsLeftOver=l-u,c.length>0&&m(e).unusedInput.push(c),e._a[3]<=12&&!0===m(e).bigHour&&e._a[3]>0&&(m(e).bigHour=void 0),m(e).parsedDateParts=e._a.slice(0),m(e).meridiem=e._meridiem,e._a[3]=function(e,t,n){var r;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((r=e.isPM(n))&&t<12&&(t+=12),r||12!==t||(t=0),t):t}(e._locale,e._a[3],e._meridiem),null!==(s=m(e).era)&&(e._a[0]=e._locale.erasConvertYear(s,e._a[0])),Ct(e),lt(e)}else St(e);else yt(e)}function Et(e){var t=e._i,n=e._f;return e._locale=e._locale||ct(e._l),null===t||void 0===n&&""===t?g({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),C(t)?new _(lt(t)):(d(t)?e._d=t:a(n)?function(e){var t,n,r,i,a,o,s=!1;if(0===e._f.length)return m(e).invalidFormat=!0,void(e._d=new Date(NaN));for(i=0;i<e._f.length;i++)a=0,o=!1,t=S({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],wt(t),v(t)&&(o=!0),a+=m(t).charsLeftOver,a+=10*m(t).unusedTokens.length,m(t).score=a,s?a<r&&(r=a,n=t):(null==r||a<r||o)&&(r=a,n=t,o&&(s=!0));f(e,n||t)}(e):n?wt(e):function(e){var t=e._i;l(t)?e._d=new Date(i.now()):d(t)?e._d=new Date(t.valueOf()):"string"==typeof t?function(e){var t=mt.exec(e._i);null===t?(yt(e),!1===e._isValid&&(delete e._isValid,St(e),!1===e._isValid&&(delete e._isValid,e._strict?e._isValid=!1:i.createFromInputFallback(e)))):e._d=new Date(+t[1])}(e):a(t)?(e._a=h(t.slice(0),(function(e){return parseInt(e,10)})),Ct(e)):o(t)?function(e){if(!e._d){var t=Y(e._i),n=void 0===t.day?t.date:t.day;e._a=h([t.year,t.month,n,t.hour,t.minute,t.second,t.millisecond],(function(e){return e&&parseInt(e,10)})),Ct(e)}}(e):u(t)?e._d=new Date(t):i.createFromInputFallback(e)}(e),v(e)||(e._d=null),e))}function Tt(e,t,n,r,i){var s={};return!0!==t&&!1!==t||(r=t,t=void 0),!0!==n&&!1!==n||(r=n,n=void 0),(o(e)&&c(e)||a(e)&&0===e.length)&&(e=void 0),s._isAMomentObject=!0,s._useUTC=s._isUTC=i,s._l=n,s._i=e,s._f=t,s._strict=r,function(e){var t=new _(lt(Et(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}(s)}function kt(e,t,n,r){return Tt(e,t,n,r,!1)}i.createFromInputFallback=E("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))})),i.ISO_8601=function(){},i.RFC_2822=function(){};var Mt=E("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=kt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:g()})),Dt=E("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=kt.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:g()}));function xt(e,t){var n,r;if(1===t.length&&a(t[0])&&(t=t[0]),!t.length)return kt();for(n=t[0],r=1;r<t.length;++r)t[r].isValid()&&!t[r][e](n)||(n=t[r]);return n}var Rt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ot(e){var t=Y(e),n=t.year||0,r=t.quarter||0,i=t.month||0,a=t.week||t.isoWeek||0,o=t.day||0,c=t.hour||0,l=t.minute||0,u=t.second||0,d=t.millisecond||0;this._isValid=function(e){var t,n,r=!1;for(t in e)if(s(e,t)&&(-1===ge.call(Rt,t)||null!=e[t]&&isNaN(e[t])))return!1;for(n=0;n<Rt.length;++n)if(e[Rt[n]]){if(r)return!1;parseFloat(e[Rt[n]])!==z(e[Rt[n]])&&(r=!0)}return!0}(t),this._milliseconds=+d+1e3*u+6e4*l+1e3*c*60*60,this._days=+o+7*a,this._months=+i+3*r+12*n,this._data={},this._locale=ct(),this._bubble()}function It(e){return e instanceof Ot}function Pt(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function At(e,t){N(e,0,0,(function(){var e=this.utcOffset(),n="+";return e<0&&(e=-e,n="-"),n+O(~~(e/60),2)+t+O(~~e%60,2)}))}At("Z",":"),At("ZZ",""),pe("Z",he),pe("ZZ",he),be(["Z","ZZ"],(function(e,t,n){n._useUTC=!0,n._tzm=Nt(he,e)}));var Lt=/([\+\-]|\d\d)/gi;function Nt(e,t){var n,r,i=(t||"").match(e);return null===i?null:0===(r=60*(n=((i[i.length-1]||[])+"").match(Lt)||["-",0,0])[1]+z(n[2]))?0:"+"===n[0]?r:-r}function jt(e,t){var n,r;return t._isUTC?(n=t.clone(),r=(C(e)||d(e)?e.valueOf():kt(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+r),i.updateOffset(n,!1),n):kt(e).local()}function Ut(e){return-Math.round(e._d.getTimezoneOffset())}function Ft(){return!!this.isValid()&&this._isUTC&&0===this._offset}i.updateOffset=function(){};var Ht=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Wt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Yt(e,t){var n,r,i,a,o,c,l=e,d=null;return It(e)?l={ms:e._milliseconds,d:e._days,M:e._months}:u(e)||!isNaN(+e)?(l={},t?l[t]=+e:l.milliseconds=+e):(d=Ht.exec(e))?(n="-"===d[1]?-1:1,l={y:0,d:z(d[2])*n,h:z(d[3])*n,m:z(d[4])*n,s:z(d[5])*n,ms:z(Pt(1e3*d[6]))*n}):(d=Wt.exec(e))?(n="-"===d[1]?-1:1,l={y:Bt(d[2],n),M:Bt(d[3],n),w:Bt(d[4],n),d:Bt(d[5],n),h:Bt(d[6],n),m:Bt(d[7],n),s:Bt(d[8],n)}):null==l?l={}:"object"==typeof l&&("from"in l||"to"in l)&&(a=kt(l.from),o=kt(l.to),i=a.isValid()&&o.isValid()?(o=jt(o,a),a.isBefore(o)?c=Vt(a,o):((c=Vt(o,a)).milliseconds=-c.milliseconds,c.months=-c.months),c):{milliseconds:0,months:0},(l={}).ms=i.milliseconds,l.M=i.months),r=new Ot(l),It(e)&&s(e,"_locale")&&(r._locale=e._locale),It(e)&&s(e,"_isValid")&&(r._isValid=e._isValid),r}function Bt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Vt(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function $t(e,t){return function(n,r){var i;return null===r||isNaN(+r)||(M(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),i=n,n=r,r=i),Gt(this,Yt(n,r),e),this}}function Gt(e,t,n,r){var a=t._milliseconds,o=Pt(t._days),s=Pt(t._months);e.isValid()&&(r=null==r||r,s&&xe(e,J(e,"Month")+s*n),o&&K(e,"Date",J(e,"Date")+o*n),a&&e._d.setTime(e._d.valueOf()+a*n),r&&i.updateOffset(e,o||s))}Yt.fn=Ot.prototype,Yt.invalid=function(){return Yt(NaN)};var zt=$t(1,"add"),qt=$t(-1,"subtract");function Jt(e){return"string"==typeof e||e instanceof String}function Kt(e){return C(e)||d(e)||Jt(e)||u(e)||function(e){var t=a(e),n=!1;return t&&(n=0===e.filter((function(t){return!u(t)&&Jt(e)})).length),t&&n}(e)||function(e){var t,n=o(e)&&!c(e),r=!1,i=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"];for(t=0;t<i.length;t+=1)r=r||s(e,i[t]);return n&&r}(e)||null==e}function Qt(e){var t,n=o(e)&&!c(e),r=!1,i=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"];for(t=0;t<i.length;t+=1)r=r||s(e,i[t]);return n&&r}function Xt(e,t){if(e.date()<t.date())return-Xt(t,e);var n=12*(t.year()-e.year())+(t.month()-e.month()),r=e.clone().add(n,"months");return-(n+(t-r<0?(t-r)/(r-e.clone().add(n-1,"months")):(t-r)/(e.clone().add(n+1,"months")-r)))||0}function Zt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=ct(e))&&(this._locale=t),this)}i.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",i.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var en=E("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(e){return void 0===e?this.localeData():this.locale(e)}));function tn(){return this._locale}function nn(e,t){return(e%t+t)%t}function rn(e,t,n){return e<100&&e>=0?new Date(e+400,t,n)-126227808e5:new Date(e,t,n).valueOf()}function an(e,t,n){return e<100&&e>=0?Date.UTC(e+400,t,n)-126227808e5:Date.UTC(e,t,n)}function on(e,t){return t.erasAbbrRegex(e)}function sn(){var e,t,n=[],r=[],i=[],a=[],o=this.eras();for(e=0,t=o.length;e<t;++e)r.push(ve(o[e].name)),n.push(ve(o[e].abbr)),i.push(ve(o[e].narrow)),a.push(ve(o[e].name)),a.push(ve(o[e].abbr)),a.push(ve(o[e].narrow));this._erasRegex=new RegExp("^("+a.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+r.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+n.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+i.join("|")+")","i")}function cn(e,t){N(0,[e,e.length],0,t)}function ln(e,t,n,r,i){var a;return null==e?Ue(this,r,i).year:(t>(a=Fe(e,r,i))&&(t=a),un.call(this,e,t,n,r,i))}function un(e,t,n,r,i){var a=je(e,t,n,r,i),o=Le(a.year,0,a.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}N("N",0,0,"eraAbbr"),N("NN",0,0,"eraAbbr"),N("NNN",0,0,"eraAbbr"),N("NNNN",0,0,"eraName"),N("NNNNN",0,0,"eraNarrow"),N("y",["y",1],"yo","eraYear"),N("y",["yy",2],0,"eraYear"),N("y",["yyy",3],0,"eraYear"),N("y",["yyyy",4],0,"eraYear"),pe("N",on),pe("NN",on),pe("NNN",on),pe("NNNN",(function(e,t){return t.erasNameRegex(e)})),pe("NNNNN",(function(e,t){return t.erasNarrowRegex(e)})),be(["N","NN","NNN","NNNN","NNNNN"],(function(e,t,n,r){var i=n._locale.erasParse(e,r,n._strict);i?m(n).era=i:m(n).invalidEra=e})),pe("y",le),pe("yy",le),pe("yyy",le),pe("yyyy",le),pe("yo",(function(e,t){return t._eraYearOrdinalRegex||le})),be(["y","yy","yyy","yyyy"],0),be(["yo"],(function(e,t,n,r){var i;n._locale._eraYearOrdinalRegex&&(i=e.match(n._locale._eraYearOrdinalRegex)),n._locale.eraYearOrdinalParse?t[0]=n._locale.eraYearOrdinalParse(e,i):t[0]=parseInt(e,10)})),N(0,["gg",2],0,(function(){return this.weekYear()%100})),N(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),cn("gggg","weekYear"),cn("ggggg","weekYear"),cn("GGGG","isoWeekYear"),cn("GGGGG","isoWeekYear"),H("weekYear","gg"),H("isoWeekYear","GG"),V("weekYear",1),V("isoWeekYear",1),pe("G",ue),pe("g",ue),pe("GG",re,Z),pe("gg",re,Z),pe("GGGG",se,te),pe("gggg",se,te),pe("GGGGG",ce,ne),pe("ggggg",ce,ne),Se(["gggg","ggggg","GGGG","GGGGG"],(function(e,t,n,r){t[r.substr(0,2)]=z(e)})),Se(["gg","GG"],(function(e,t,n,r){t[r]=i.parseTwoDigitYear(e)})),N("Q",0,"Qo","quarter"),H("quarter","Q"),V("quarter",7),pe("Q",X),be("Q",(function(e,t){t[1]=3*(z(e)-1)})),N("D",["DD",2],"Do","date"),H("date","D"),V("date",9),pe("D",re),pe("DD",re,Z),pe("Do",(function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient})),be(["D","DD"],2),be("Do",(function(e,t){t[2]=z(e.match(re)[0])}));var dn=q("Date",!0);N("DDD",["DDDD",3],"DDDo","dayOfYear"),H("dayOfYear","DDD"),V("dayOfYear",4),pe("DDD",oe),pe("DDDD",ee),be(["DDD","DDDD"],(function(e,t,n){n._dayOfYear=z(e)})),N("m",["mm",2],0,"minute"),H("minute","m"),V("minute",14),pe("m",re),pe("mm",re,Z),be(["m","mm"],4);var hn=q("Minutes",!1);N("s",["ss",2],0,"second"),H("second","s"),V("second",15),pe("s",re),pe("ss",re,Z),be(["s","ss"],5);var fn,pn,mn=q("Seconds",!1);for(N("S",0,0,(function(){return~~(this.millisecond()/100)})),N(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),N(0,["SSS",3],0,"millisecond"),N(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),N(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),N(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),N(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),N(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),N(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),H("millisecond","ms"),V("millisecond",16),pe("S",oe,X),pe("SS",oe,Z),pe("SSS",oe,ee),fn="SSSS";fn.length<=9;fn+="S")pe(fn,le);function vn(e,t){t[6]=z(1e3*("0."+e))}for(fn="S";fn.length<=9;fn+="S")be(fn,vn);pn=q("Milliseconds",!1),N("z",0,0,"zoneAbbr"),N("zz",0,0,"zoneName");var gn=_.prototype;function yn(e){return e}gn.add=zt,gn.calendar=function(e,t){1===arguments.length&&(arguments[0]?Kt(arguments[0])?(e=arguments[0],t=void 0):Qt(arguments[0])&&(t=arguments[0],e=void 0):(e=void 0,t=void 0));var n=e||kt(),r=jt(n,this).startOf("day"),a=i.calendarFormat(this,r)||"sameElse",o=t&&(D(t[a])?t[a].call(this,n):t[a]);return this.format(o||this.localeData().calendar(a,this,kt(n)))},gn.clone=function(){return new _(this)},gn.diff=function(e,t,n){var r,i,a;if(!this.isValid())return NaN;if(!(r=jt(e,this)).isValid())return NaN;switch(i=6e4*(r.utcOffset()-this.utcOffset()),t=W(t)){case"year":a=Xt(this,r)/12;break;case"month":a=Xt(this,r);break;case"quarter":a=Xt(this,r)/3;break;case"second":a=(this-r)/1e3;break;case"minute":a=(this-r)/6e4;break;case"hour":a=(this-r)/36e5;break;case"day":a=(this-r-i)/864e5;break;case"week":a=(this-r-i)/6048e5;break;default:a=this-r}return n?a:G(a)},gn.endOf=function(e){var t,n;if(void 0===(e=W(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?an:rn,e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=36e5-nn(t+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":t=this._d.valueOf(),t+=6e4-nn(t,6e4)-1;break;case"second":t=this._d.valueOf(),t+=1e3-nn(t,1e3)-1}return this._d.setTime(t),i.updateOffset(this,!0),this},gn.format=function(e){e||(e=this.isUtc()?i.defaultFormatUtc:i.defaultFormat);var t=j(this,e);return this.localeData().postformat(t)},gn.from=function(e,t){return this.isValid()&&(C(e)&&e.isValid()||kt(e).isValid())?Yt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},gn.fromNow=function(e){return this.from(kt(),e)},gn.to=function(e,t){return this.isValid()&&(C(e)&&e.isValid()||kt(e).isValid())?Yt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},gn.toNow=function(e){return this.to(kt(),e)},gn.get=function(e){return D(this[e=W(e)])?this[e]():this},gn.invalidAt=function(){return m(this).overflow},gn.isAfter=function(e,t){var n=C(e)?e:kt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=W(t)||"millisecond")?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},gn.isBefore=function(e,t){var n=C(e)?e:kt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=W(t)||"millisecond")?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},gn.isBetween=function(e,t,n,r){var i=C(e)?e:kt(e),a=C(t)?t:kt(t);return!!(this.isValid()&&i.isValid()&&a.isValid())&&("("===(r=r||"()")[0]?this.isAfter(i,n):!this.isBefore(i,n))&&(")"===r[1]?this.isBefore(a,n):!this.isAfter(a,n))},gn.isSame=function(e,t){var n,r=C(e)?e:kt(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=W(t)||"millisecond")?this.valueOf()===r.valueOf():(n=r.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},gn.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},gn.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},gn.isValid=function(){return v(this)},gn.lang=en,gn.locale=Zt,gn.localeData=tn,gn.max=Dt,gn.min=Mt,gn.parsingFlags=function(){return f({},m(this))},gn.set=function(e,t){if("object"==typeof e){var n,r=function(e){var t,n=[];for(t in e)s(e,t)&&n.push({unit:t,priority:B[t]});return n.sort((function(e,t){return e.priority-t.priority})),n}(e=Y(e));for(n=0;n<r.length;n++)this[r[n].unit](e[r[n].unit])}else if(D(this[e=W(e)]))return this[e](t);return this},gn.startOf=function(e){var t,n;if(void 0===(e=W(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?an:rn,e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=nn(t+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":t=this._d.valueOf(),t-=nn(t,6e4);break;case"second":t=this._d.valueOf(),t-=nn(t,1e3)}return this._d.setTime(t),i.updateOffset(this,!0),this},gn.subtract=qt,gn.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},gn.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},gn.toDate=function(){return new Date(this.valueOf())},gn.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||n.year()>9999?j(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):D(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",j(n,"Z")):j(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},gn.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t,n,r="moment",i="";return this.isLocal()||(r=0===this.utcOffset()?"moment.utc":"moment.parseZone",i="Z"),e="["+r+'("]',t=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n=i+'[")]',this.format(e+t+"-MM-DD[T]HH:mm:ss.SSS"+n)},"undefined"!=typeof Symbol&&null!=Symbol.for&&(gn[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),gn.toJSON=function(){return this.isValid()?this.toISOString():null},gn.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},gn.unix=function(){return Math.floor(this.valueOf()/1e3)},gn.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},gn.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},gn.eraName=function(){var e,t,n,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),r[e].since<=n&&n<=r[e].until)return r[e].name;if(r[e].until<=n&&n<=r[e].since)return r[e].name}return""},gn.eraNarrow=function(){var e,t,n,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),r[e].since<=n&&n<=r[e].until)return r[e].narrow;if(r[e].until<=n&&n<=r[e].since)return r[e].narrow}return""},gn.eraAbbr=function(){var e,t,n,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),r[e].since<=n&&n<=r[e].until)return r[e].abbr;if(r[e].until<=n&&n<=r[e].since)return r[e].abbr}return""},gn.eraYear=function(){var e,t,n,r,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e)if(n=a[e].since<=a[e].until?1:-1,r=this.clone().startOf("day").valueOf(),a[e].since<=r&&r<=a[e].until||a[e].until<=r&&r<=a[e].since)return(this.year()-i(a[e].since).year())*n+a[e].offset;return this.year()},gn.year=Pe,gn.isLeapYear=function(){return $(this.year())},gn.weekYear=function(e){return ln.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},gn.isoWeekYear=function(e){return ln.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},gn.quarter=gn.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},gn.month=Re,gn.daysInMonth=function(){return Ce(this.year(),this.month())},gn.week=gn.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},gn.isoWeek=gn.isoWeeks=function(e){var t=Ue(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},gn.weeksInYear=function(){var e=this.localeData()._week;return Fe(this.year(),e.dow,e.doy)},gn.weeksInWeekYear=function(){var e=this.localeData()._week;return Fe(this.weekYear(),e.dow,e.doy)},gn.isoWeeksInYear=function(){return Fe(this.year(),1,4)},gn.isoWeeksInISOWeekYear=function(){return Fe(this.isoWeekYear(),1,4)},gn.date=dn,gn.day=gn.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=function(e,t){return"string"!=typeof e?e:isNaN(e)?"number"==typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}(e,this.localeData()),this.add(e-t,"d")):t},gn.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},gn.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=function(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},gn.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},gn.hour=gn.hours=Ze,gn.minute=gn.minutes=hn,gn.second=gn.seconds=mn,gn.millisecond=gn.milliseconds=pn,gn.utcOffset=function(e,t,n){var r,a=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=Nt(he,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(r=Ut(this)),this._offset=e,this._isUTC=!0,null!=r&&this.add(r,"m"),a!==e&&(!t||this._changeInProgress?Gt(this,Yt(e-a,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,i.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?a:Ut(this)},gn.utc=function(e){return this.utcOffset(0,e)},gn.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ut(this),"m")),this},gn.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Nt(de,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},gn.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?kt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},gn.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},gn.isLocal=function(){return!!this.isValid()&&!this._isUTC},gn.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},gn.isUtc=Ft,gn.isUTC=Ft,gn.zoneAbbr=function(){return this._isUTC?"UTC":""},gn.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},gn.dates=E("dates accessor is deprecated. Use date instead.",dn),gn.months=E("months accessor is deprecated. Use month instead",Re),gn.years=E("years accessor is deprecated. Use year instead",Pe),gn.zone=E("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",(function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()})),gn.isDSTShifted=E("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",(function(){if(!l(this._isDSTShifted))return this._isDSTShifted;var e,t={};return S(t,this),(t=Et(t))._a?(e=t._isUTC?p(t._a):kt(t._a),this._isDSTShifted=this.isValid()&&function(e,t,n){var r,i=Math.min(e.length,t.length),a=Math.abs(e.length-t.length),o=0;for(r=0;r<i;r++)z(e[r])!==z(t[r])&&o++;return o+a}(t._a,e.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}));var bn=R.prototype;function Sn(e,t,n,r){var i=ct(),a=p().set(r,t);return i[n](a,e)}function _n(e,t,n){if(u(e)&&(t=e,e=void 0),e=e||"",null!=t)return Sn(e,t,n,"month");var r,i=[];for(r=0;r<12;r++)i[r]=Sn(e,r,n,"month");return i}function Cn(e,t,n,r){"boolean"==typeof e?(u(t)&&(n=t,t=void 0),t=t||""):(n=t=e,e=!1,u(t)&&(n=t,t=void 0),t=t||"");var i,a=ct(),o=e?a._week.dow:0,s=[];if(null!=n)return Sn(t,(n+o)%7,r,"day");for(i=0;i<7;i++)s[i]=Sn(t,(i+o)%7,r,"day");return s}bn.calendar=function(e,t,n){var r=this._calendar[e]||this._calendar.sameElse;return D(r)?r.call(t,n):r},bn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.match(I).map((function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e})).join(""),this._longDateFormat[e])},bn.invalidDate=function(){return this._invalidDate},bn.ordinal=function(e){return this._ordinal.replace("%d",e)},bn.preparse=yn,bn.postformat=yn,bn.relativeTime=function(e,t,n,r){var i=this._relativeTime[n];return D(i)?i(e,t,n,r):i.replace(/%d/i,e)},bn.pastFuture=function(e,t){var n=this._relativeTime[e>0?"future":"past"];return D(n)?n(t):n.replace(/%s/i,t)},bn.set=function(e){var t,n;for(n in e)s(e,n)&&(D(t=e[n])?this[n]=t:this["_"+n]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},bn.eras=function(e,t){var n,r,a,o=this._eras||ct("en")._eras;for(n=0,r=o.length;n<r;++n){switch(typeof o[n].since){case"string":a=i(o[n].since).startOf("day"),o[n].since=a.valueOf()}switch(typeof o[n].until){case"undefined":o[n].until=1/0;break;case"string":a=i(o[n].until).startOf("day").valueOf(),o[n].until=a.valueOf()}}return o},bn.erasParse=function(e,t,n){var r,i,a,o,s,c=this.eras();for(e=e.toUpperCase(),r=0,i=c.length;r<i;++r)if(a=c[r].name.toUpperCase(),o=c[r].abbr.toUpperCase(),s=c[r].narrow.toUpperCase(),n)switch(t){case"N":case"NN":case"NNN":if(o===e)return c[r];break;case"NNNN":if(a===e)return c[r];break;case"NNNNN":if(s===e)return c[r]}else if([a,o,s].indexOf(e)>=0)return c[r]},bn.erasConvertYear=function(e,t){var n=e.since<=e.until?1:-1;return void 0===t?i(e.since).year():i(e.since).year()+(t-e.offset)*n},bn.erasAbbrRegex=function(e){return s(this,"_erasAbbrRegex")||sn.call(this),e?this._erasAbbrRegex:this._erasRegex},bn.erasNameRegex=function(e){return s(this,"_erasNameRegex")||sn.call(this),e?this._erasNameRegex:this._erasRegex},bn.erasNarrowRegex=function(e){return s(this,"_erasNarrowRegex")||sn.call(this),e?this._erasNarrowRegex:this._erasRegex},bn.months=function(e,t){return e?a(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Te).test(t)?"format":"standalone"][e.month()]:a(this._months)?this._months:this._months.standalone},bn.monthsShort=function(e,t){return e?a(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Te.test(t)?"format":"standalone"][e.month()]:a(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},bn.monthsParse=function(e,t,n){var r,i,a;if(this._monthsParseExact)return De.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(i=p([2e3,r]),n&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[r]||(a="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[r]=new RegExp(a.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(n&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!n&&this._monthsParse[r].test(e))return r}},bn.monthsRegex=function(e){return this._monthsParseExact?(s(this,"_monthsRegex")||Oe.call(this),e?this._monthsStrictRegex:this._monthsRegex):(s(this,"_monthsRegex")||(this._monthsRegex=Me),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},bn.monthsShortRegex=function(e){return this._monthsParseExact?(s(this,"_monthsRegex")||Oe.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(s(this,"_monthsShortRegex")||(this._monthsShortRegex=ke),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},bn.week=function(e){return Ue(e,this._week.dow,this._week.doy).week},bn.firstDayOfYear=function(){return this._week.doy},bn.firstDayOfWeek=function(){return this._week.dow},bn.weekdays=function(e,t){var n=a(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"];return!0===e?He(n,this._week.dow):e?n[e.day()]:n},bn.weekdaysMin=function(e){return!0===e?He(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},bn.weekdaysShort=function(e){return!0===e?He(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},bn.weekdaysParse=function(e,t,n){var r,i,a;if(this._weekdaysParseExact)return ze.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(i=p([2e3,1]).day(r),n&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(a="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[r]=new RegExp(a.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[r].test(e))return r;if(n&&"ddd"===t&&this._shortWeekdaysParse[r].test(e))return r;if(n&&"dd"===t&&this._minWeekdaysParse[r].test(e))return r;if(!n&&this._weekdaysParse[r].test(e))return r}},bn.weekdaysRegex=function(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||qe.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(s(this,"_weekdaysRegex")||(this._weekdaysRegex=Ve),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},bn.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||qe.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(s(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=$e),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},bn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||qe.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(s(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ge),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},bn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},bn.meridiem=function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},ot("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===z(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),i.lang=E("moment.lang is deprecated. Use moment.locale instead.",ot),i.langData=E("moment.langData is deprecated. Use moment.localeData instead.",ct);var wn=Math.abs;function En(e,t,n,r){var i=Yt(t,n);return e._milliseconds+=r*i._milliseconds,e._days+=r*i._days,e._months+=r*i._months,e._bubble()}function Tn(e){return e<0?Math.floor(e):Math.ceil(e)}function kn(e){return 4800*e/146097}function Mn(e){return 146097*e/4800}function Dn(e){return function(){return this.as(e)}}var xn=Dn("ms"),Rn=Dn("s"),On=Dn("m"),In=Dn("h"),Pn=Dn("d"),An=Dn("w"),Ln=Dn("M"),Nn=Dn("Q"),jn=Dn("y");function Un(e){return function(){return this.isValid()?this._data[e]:NaN}}var Fn=Un("milliseconds"),Hn=Un("seconds"),Wn=Un("minutes"),Yn=Un("hours"),Bn=Un("days"),Vn=Un("months"),$n=Un("years"),Gn=Math.round,zn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function qn(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}var Jn=Math.abs;function Kn(e){return(e>0)-(e<0)||+e}function Qn(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n,r,i,a,o,s,c=Jn(this._milliseconds)/1e3,l=Jn(this._days),u=Jn(this._months),d=this.asSeconds();return d?(e=G(c/60),t=G(e/60),c%=60,e%=60,n=G(u/12),u%=12,r=c?c.toFixed(3).replace(/\.?0+$/,""):"",i=d<0?"-":"",a=Kn(this._months)!==Kn(d)?"-":"",o=Kn(this._days)!==Kn(d)?"-":"",s=Kn(this._milliseconds)!==Kn(d)?"-":"",i+"P"+(n?a+n+"Y":"")+(u?a+u+"M":"")+(l?o+l+"D":"")+(t||e||c?"T":"")+(t?s+t+"H":"")+(e?s+e+"M":"")+(c?s+r+"S":"")):"P0D"}var Xn=Ot.prototype;return Xn.isValid=function(){return this._isValid},Xn.abs=function(){var e=this._data;return this._milliseconds=wn(this._milliseconds),this._days=wn(this._days),this._months=wn(this._months),e.milliseconds=wn(e.milliseconds),e.seconds=wn(e.seconds),e.minutes=wn(e.minutes),e.hours=wn(e.hours),e.months=wn(e.months),e.years=wn(e.years),this},Xn.add=function(e,t){return En(this,e,t,1)},Xn.subtract=function(e,t){return En(this,e,t,-1)},Xn.as=function(e){if(!this.isValid())return NaN;var t,n,r=this._milliseconds;if("month"===(e=W(e))||"quarter"===e||"year"===e)switch(t=this._days+r/864e5,n=this._months+kn(t),e){case"month":return n;case"quarter":return n/3;case"year":return n/12}else switch(t=this._days+Math.round(Mn(this._months)),e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return 24*t+r/36e5;case"minute":return 1440*t+r/6e4;case"second":return 86400*t+r/1e3;case"millisecond":return Math.floor(864e5*t)+r;default:throw new Error("Unknown unit "+e)}},Xn.asMilliseconds=xn,Xn.asSeconds=Rn,Xn.asMinutes=On,Xn.asHours=In,Xn.asDays=Pn,Xn.asWeeks=An,Xn.asMonths=Ln,Xn.asQuarters=Nn,Xn.asYears=jn,Xn.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*z(this._months/12):NaN},Xn._bubble=function(){var e,t,n,r,i,a=this._milliseconds,o=this._days,s=this._months,c=this._data;return a>=0&&o>=0&&s>=0||a<=0&&o<=0&&s<=0||(a+=864e5*Tn(Mn(s)+o),o=0,s=0),c.milliseconds=a%1e3,e=G(a/1e3),c.seconds=e%60,t=G(e/60),c.minutes=t%60,n=G(t/60),c.hours=n%24,o+=G(n/24),s+=i=G(kn(o)),o-=Tn(Mn(i)),r=G(s/12),s%=12,c.days=o,c.months=s,c.years=r,this},Xn.clone=function(){return Yt(this)},Xn.get=function(e){return e=W(e),this.isValid()?this[e+"s"]():NaN},Xn.milliseconds=Fn,Xn.seconds=Hn,Xn.minutes=Wn,Xn.hours=Yn,Xn.days=Bn,Xn.weeks=function(){return G(this.days()/7)},Xn.months=Vn,Xn.years=$n,Xn.humanize=function(e,t){if(!this.isValid())return this.localeData().invalidDate();var n,r,i=!1,a=zn;return"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(i=e),"object"==typeof t&&(a=Object.assign({},zn,t),null!=t.s&&null==t.ss&&(a.ss=t.s-1)),r=function(e,t,n,r){var i=Yt(e).abs(),a=Gn(i.as("s")),o=Gn(i.as("m")),s=Gn(i.as("h")),c=Gn(i.as("d")),l=Gn(i.as("M")),u=Gn(i.as("w")),d=Gn(i.as("y")),h=a<=n.ss&&["s",a]||a<n.s&&["ss",a]||o<=1&&["m"]||o<n.m&&["mm",o]||s<=1&&["h"]||s<n.h&&["hh",s]||c<=1&&["d"]||c<n.d&&["dd",c];return null!=n.w&&(h=h||u<=1&&["w"]||u<n.w&&["ww",u]),(h=h||l<=1&&["M"]||l<n.M&&["MM",l]||d<=1&&["y"]||["yy",d])[2]=t,h[3]=+e>0,h[4]=r,qn.apply(null,h)}(this,!i,a,n=this.localeData()),i&&(r=n.pastFuture(+this,r)),n.postformat(r)},Xn.toISOString=Qn,Xn.toString=Qn,Xn.toJSON=Qn,Xn.locale=Zt,Xn.localeData=tn,Xn.toIsoString=E("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Qn),Xn.lang=en,N("X",0,0,"unix"),N("x",0,0,"valueOf"),pe("x",ue),pe("X",/[+-]?\d+(\.\d{1,3})?/),be("X",(function(e,t,n){n._d=new Date(1e3*parseFloat(e))})),be("x",(function(e,t,n){n._d=new Date(z(e))})),i.version="2.29.1",t=kt,i.fn=gn,i.min=function(){var e=[].slice.call(arguments,0);return xt("isBefore",e)},i.max=function(){var e=[].slice.call(arguments,0);return xt("isAfter",e)},i.now=function(){return Date.now?Date.now():+new Date},i.utc=p,i.unix=function(e){return kt(1e3*e)},i.months=function(e,t){return _n(e,t,"months")},i.isDate=d,i.locale=ot,i.invalid=g,i.duration=Yt,i.isMoment=C,i.weekdays=function(e,t,n){return Cn(e,t,n,"weekdays")},i.parseZone=function(){return kt.apply(null,arguments).parseZone()},i.localeData=ct,i.isDuration=It,i.monthsShort=function(e,t){return _n(e,t,"monthsShort")},i.weekdaysMin=function(e,t,n){return Cn(e,t,n,"weekdaysMin")},i.defineLocale=st,i.updateLocale=function(e,t){if(null!=t){var n,r,i=et;null!=tt[e]&&null!=tt[e].parentLocale?tt[e].set(x(tt[e]._config,t)):(null!=(r=at(e))&&(i=r._config),t=x(i,t),null==r&&(t.abbr=e),(n=new R(t)).parentLocale=tt[e],tt[e]=n),ot(e)}else null!=tt[e]&&(null!=tt[e].parentLocale?(tt[e]=tt[e].parentLocale,e===ot()&&ot(e)):null!=tt[e]&&delete tt[e]);return tt[e]},i.locales=function(){return T(tt)},i.weekdaysShort=function(e,t,n){return Cn(e,t,n,"weekdaysShort")},i.normalizeUnits=W,i.relativeTimeRounding=function(e){return void 0===e?Gn:"function"==typeof e&&(Gn=e,!0)},i.relativeTimeThreshold=function(e,t){return void 0!==zn[e]&&(void 0===t?zn[e]:(zn[e]=t,"s"===e&&(zn.ss=t-1),!0))},i.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},i.prototype=gn,i.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},i}()}).call(this,n(270)(e))},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=n(24),o=n(15),s=n(5),c=n(2),l=n(219),u=n(26),d=n(14),h=n(305),f=function(){function e(){S(this,e),this.rxConnectionSubject=new i.Subject,this.rxContactSubject=new i.Subject,this.showBodyMessage=!1,this.presenceWaitingList=[],this.xmppServerURL=null,this.stropheStatus=null,this.presenceStatus="offline",this.pingTimeout=null,this.connecting=!1,this.disconnectInfo=null,this.connectionWatcherTimout=null,this.isInitialPresenceSent=!1,this.historyHandler=null,this.bulkHistoryHandler=null,this.searchTextHandler=null,this.callLogHandler=null,this.reconnectInProgress=!1,this.reconnectionDelay=250,this.reconnectTimeout=null,this.connectivityEventSubscription=null,this.lastPingDate=null,this.started=!1,this.connection=null,this.jid=null,this.fullJid=null,this.changePasswordInfo=null,this.contactServiceReady=!1,this.connected=!1}return C(e,[{key:"onHandleConnectivity",value:function(e){e?(o.default.info("[xmppService] -- onHandleConnectivityEvent -- retrieve connectivity"),this.autoReconnect(!0)):(o.default.info("[xmppService] -- onHandleConnectivityEvent -- lost connectivity"),this.stropheStatus===Strophe.Status.CONNECTED&&(this.interruptAutoReconnect(),this.disconnect("NO_NETWORK")))}},{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.connectivityEventSubscription=u.default.subscribeToConnectivityEvents((function(e){t.onHandleConnectivity(e)})),c.default.jidIm&&c.default.jidPwd){e.next=3;break}throw new Error("No valid XMPP credentials");case 3:return this.xmppServerURL="".concat(config.xmpp.protocol,"://").concat(config.xmpp.currentServer,":").concat(config.xmpp.port,"/websocket"),this.showBodyMessage=s.default.getBooleanSetting("showBodyMessage"),this.pingTimeout=config.xmpp.pingInterval?2*parseInt(config.xmpp.pingInterval,10):12e4,e.next=8,this.connect();case 8:this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"LOGIN"}),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(0),o.default.error("[xmppService] start -- FAILURE -- "+e.t0.message),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,11]])})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.disconnect("LOGOUT");case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:this.started=!1,this.connected=!1,this.stropheStatus=null,this.presenceStatus="offline",this.fullJid=null,this.lastPingDate=null,this.connectivityEventSubscription&&(this.connectivityEventSubscription.unsubscribe(),this.connectivityEventSubscription=null);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})))}},{key:"connect",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,s=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.stropheStatus!==Strophe.Status.CONNECTING&&this.stropheStatus!==Strophe.Status.CONNECTED&&this.stropheStatus!==Strophe.Status.AUTHENTICATING){e.next=4;break}throw(t=new Error("XMPP service already connected or connecting")).details=this.stropheStatus===Strophe.Status.CONNECTING?"XMPP_IN_CONNECTING_STATE":"XMPP_ALREADY_CONNECTED",t;case 4:if(n=c.default.getInformationHeadersApp(),r=c.default.getInformationHeadersAppVersion(),i=c.default.xmppDomain,null!==n&&null!==r&&null!==i){e.next=7;break}throw new Error("XMPP service -- Missing connection data");case 7:return this.connection=new Strophe.Connection("".concat(this.xmppServerURL,"?x-rainbow-client=").concat(n,"&x-rainbow-client-version=").concat(r,"&x-rainbow-xmpp-dom=").concat(i)),this.connection.rawInput=function(e){s.handleRawXmppMessage(e,"Recv: ")},this.connection.rawOutput=function(e){s.handleRawXmppMessage(e,"Sent: ")},this.jid=c.default.jidIm,this.fullJid||(this.fullJid=this.generateRandomFullJid(this.jid)),e.next=14,this.stropheConnect();case 14:this.connected=!0,this.connection.ping.addPingHandler((function(e){return o.default.info("[xmppService] -- onKeepAlivePingEvent (".concat(new Date,")")),s.connected&&(s.connection.ping.pong(e),s.lastPingDate=new Date),!0})),this.addHandler((function(e){return s.onRosterChangedMessageReceived(e)}),"jabber:iq:roster","iq","set"),this.addHandler((function(e){return s.onMamMessageReceived(e)}),Strophe.NS.MAM,"message",null),this.addHandler((function(e){return s.onMamMessageReceived(e)}),Strophe.NS.MAM,"iq",null),this.addHandler((function(e){return s.onMamBulkMessageReceived(e)}),"urn:xmpp:mam:1:bulk","message",null),this.addHandler((function(e){return s.onMamBulkMessageReceived(e)}),"urn:xmpp:mam:1:bulk","iq",null),this.addHandler((function(e){return s.onSearchTextMessageReceived(e)}),"urn:xmpp:mam:tmp","message",null),this.addHandler((function(e){return s.onPresenceMessageReceived(e)}),null,"presence"),this.connection.jingle&&this.connection.jingle.attachHandlers(),this.presenceWaitingList=[],(a=$iq({type:"set"})).c("enable",{xmlns:"urn:xmpp:carbons:2"}),this.sendIQ(a),this.started=!0,e.next=32;break;case 29:throw e.prev=29,e.t0=e.catch(0),o.default.error("[xmppService] connect -- FAILURE -- "+e.t0.message),e.t0;case 32:case"end":return e.stop()}}),e,this,[[0,29]])})))}},{key:"disconnect",value:function(e){var t=this;return new Promise((function(n){t.connected?t.stropheStatus===Strophe.Status.CONNECTED&&(o.default.info("[xmppService] disconnect -- "+e),t.disconnectInfo={reason:e,resolve:n},t.connection.disconnect(e)):(o.default.info("[xmppService] disconnect - service is not started"),n())}))}},{key:"stropheConnect",value:function(){var e=this;return new Promise((function(t,n){e.connecting=!0,e.connection.connect(e.fullJid,c.default.jidPwd,(function(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(e.stropheStatus=r,r){case Strophe.Status.CONNECTING:e.publishConnectionEvent("ON_XMPP_CONNECTING");break;case Strophe.Status.AUTHFAIL:o.default.error("[xmppService] -- onAuthenticationFailureEvent -- ".concat(i," -- ").concat(e.fullJid)),e.connecting=!1,n(new Error("Authentication failure -- "+i));break;case Strophe.Status.CONNFAIL:if(!e.connecting)break;o.default.error("[xmppService] -- onConnectionFailureEvent -- ConnectionFail -- "+e.fullJid),e.connecting=!1,n(new Error("Connection failure -- "+i));break;case Strophe.Status.CONNECTED:o.default.info("[xmppService] -- onConnectedEvent -- "+e.fullJid),e.connecting=!1,t();break;case Strophe.Status.DISCONNECTED:if(e.connecting){o.default.error("[xmppService] -- onConnectionFailureEvent -- Disconnected -- "+e.fullJid),n(new Error("Connection failure -- "+i));break}e.reconnectInProgress||e.onDisconnectEvent(i)}}))}))}},{key:"connectionWatcher",value:function(){try{if(o.default.error("[xmppService] -- Connection watcher : so bad, no message since "+this.pingTimeout/1e3+" seconds (no ping)"),this.connection){var e=this.stropheStatus===Strophe.Status.CONNECTED?"Have lost connectivity":"Stuck in reconnecting state";o.default.info("[xmppService] -- Connection watcher -- "+e),this.stropheStatus=null,this.connection.disconnect("No ping")}}catch(t){o.default.error("connectionWatcher error "+t)}}},{key:"generateRandomFullJid",value:function(e){var t=navigator.platform.toUpperCase().indexOf("MAC")>=0?"osx":"win",n="desk_"+t;return u.default.isDesktopApp()||(n=c.default.fromSDK?"web_sdk":"web_"+t),"".concat(e,"/").concat(n,"_").concat(version,"_").concat(l.default(8))}},{key:"handleRawXmppMessage",value:function(e,t){var n=this;if(this.connectionWatcherTimout&&clearTimeout(this.connectionWatcherTimout),this.connectionWatcherTimout=setTimeout((function(){n.connectionWatcher()}),this.pingTimeout),!(e.indexOf("<PHOTO>")>-1)){var r=t;if(e.indexOf("urn:xmpp:mam:1:bulk")>-1)"true"===s.default.getSetting("devMode")&&"true"===s.default.getSetting("showBodyMessage")?r+=e:r+="Hidden content -- bulk";else if(e.indexOf("xmlns='jabber:x:bubble:conference'")>-1&&(e.indexOf("name='invitation'")>-1||e.indexOf("name='conferenceAdd'")>-1||e.indexOf("name='conferenceRemove'")>-1))r+="Hidden content";else if(e.indexOf("xmlns='urn:xmpp:jingle:1'")>-1&&(e.indexOf("displayname")>-1||e.indexOf("number")>-1))r+="Hidden content";else if(e.indexOf("urn:xmpp:janus:1")>-1&&(e.indexOf("displayName")>-1||e.indexOf("displayname")>-1||e.indexOf("number")>-1))r+="Hidden content";else if(e.indexOf("<message")>-1&&(e.indexOf("<body")>-1||e.indexOf("<content>")>-1||e.indexOf("<thumbnail")>-1))r+=this.messageBodyDiscretion(e);else{var i=e,a=h(e).find("data");if(a&&"http://jabber.org/protocol/ibb"===a.attr("xmlns")&&(a.html("Encoded file in base 64"),r+=a.html()),!this.showBodyMessage){if(-1!==e.indexOf("<identity")){var c=e.indexOf("firstName="),l=e.indexOf("'",c);if(-1!==c&&-1!==l){var u=e.indexOf("'",l+1);l+1!==u&&(i=e.substr(0,l+2)+"***"+e.substr(u))}var f=i.indexOf("lastName="),p=i.indexOf("'",f);if(-1!==f&&-1!==p){var m=i.indexOf("'",p+1);p+1!==m&&(i=i.substr(0,p+2)+"***"+i.substr(m))}}if(-1!==i.indexOf("<caller_info")||-1!==i.indexOf("<callee_info")){var v=i.indexOf("number="),g=i.indexOf("'",v);if(-1!==v&&-1!==g){var y=i.indexOf("'",g+1);if(g+1!==y){var b=i.substr(g+1,y-g-1);i=i.substr(0,g+1)+d.default(b)+i.substr(y)}}}if(-1!==i.indexOf("<caller>")){var S=i.indexOf("<caller>"),_=i.indexOf("</caller>",S),C=i.substring(S+8,_);-1===C.indexOf("@")&&-1===C.indexOf("janus")&&(i=i.substr(0,S+8)+d.default(C)+i.substr(_))}if(-1!==i.indexOf("<callee>")){var w=i.indexOf("<callee>"),E=i.indexOf("</callee>",w),T=i.substring(w+8,E);-1===T.indexOf("@")&&-1===T.indexOf("janus")&&(i=i.substr(0,w+8)+d.default(T)+i.substr(E))}if(-1!==i.indexOf("<event")){var k=i.indexOf("<message>"),M=i.indexOf("</message>",k);i=i.substr(0,k+9)+"***"+i.substr(M)}var D=i.indexOf("endpointTel='");if(-1!==D){var x=i.indexOf("'",D+13),R=i.substring(D+13,x);i=i.substr(0,D+13)+d.default(R)+i.substr(x)}var O=i.indexOf("destination='");if(-1!==O){var I=i.indexOf("'",O+13),P=i.substring(O+13,I);i=i.substr(0,O+13)+d.default(P)+i.substr(I)}if(-1!==i.indexOf("<name>")){var A=i.indexOf("<name>"),L=i.indexOf("</name>",A);i=i.substr(0,A+6)+"***"+i.substr(L)}}r+=i}o.default.debug(r)}}},{key:"messageBodyDiscretion",value:function(e){return this.showBodyMessage?e:(e=this.messageTagDiscretion("content",e),e=this.messageTagDiscretion("body",e),e=this.messageTagDiscretion("subject",e),e=this.messageTagDiscretion("filename",e))}},{key:"messageTagDiscretion",value:function(e,t){var n=t.indexOf("<"+e);if(-1!==n){var r=t.indexOf(">",n),i=t.indexOf("/>",n);if(-1!==r&&r!==i+1)return t.substr(0,r+2)+"***"+t.substr(t.indexOf("</"+e+">")-1)}return t}},{key:"onDisconnectEvent",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionWatcherTimout&&clearTimeout(this.connectionWatcherTimout),this.isInitialPresenceSent=!1,!this.started){t.next=23;break}if(!this.disconnectInfo){t.next=3;break}return t.abrupt("return",(o.default.info("[xmppService] -- onDisconnectEvent -- Expected disconnection -- ".concat(this.disconnectInfo.reason," -- ").concat(this.fullJid)),this.connected=!1,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:this.disconnectInfo.reason}),this.disconnectInfo.resolve(),void(this.disconnectInfo=null)));case 3:if(!this.changePasswordInfo){t.next=20;break}if(this.connected=!1,!this.changePasswordInfo.fromThirdParty){t.next=8;break}o.default.error("[xmppService] -- onDisconnectEvent -- Expected disconnection -- change password from third party -- "+this.fullJid),this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"3RD_PARTY_CHANGE_PWD"}),t.next=18;break;case 8:return o.default.error("[xmppService] -- onDisconnectEvent -- Expected disconnection -- change password -- "+this.fullJid),t.prev=9,t.next=12,c.default.logon(this.changePasswordInfo.login,this.changePasswordInfo.newPassword,!0);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(9),this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"CHANGE_PWD_ERROR"});case 17:this.changePasswordInfo.resolve&&this.changePasswordInfo.resolve(),this.changePasswordInfo=null,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"CHANGE_PWD"}),this.autoReconnect();case 18:t.next=21;break;case 20:o.default.error("[xmppService] -- onDisconnectEvent -- Unexpected disconnection -- ".concat(e," -- ").concat(this.fullJid)),this.connected=!1,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"UNKNOWN"}),this.autoReconnect();case 21:t.next=24;break;case 23:o.default.info("[xmppService] -- onDisconnectEvent -- service not started -- ignored");case 24:case"end":return t.stop()}}),t,this,[[9,14]])})))}},{key:"interruptAutoReconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.reconnectInProgress||e)&&(o.default.info("[xmppService] interrupt auto-reconnection"),this.reconnectionDelay=250,this.reconnectInProgress=!1,this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.connectionWatcherTimout&&(o.default.info("[xmppService] Clear connection watcher timeout"),clearTimeout(this.connectionWatcherTimout)))}},{key:"autoReconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r(this,void 0,void 0,b.a.mark((function t(){var n,r=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.interruptAutoReconnect(e),o.default.info("[xmppService] autoReconnect"),this.reconnectInProgress=!0,t.next=6,c.default.startTokenSurvey();case 6:return t.next=8,this.connect();case 8:this.reconnectionDelay=250,this.reconnectInProgress=!1,o.default.info("[xmppService] autoReconnect -- SUCCESS"),this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"RECONNECTION",lastActivityDate:this.lastPingDate}),t.next=27;break;case 14:t.prev=14,t.t0=t.catch(0),n=t.t0,t.t1=(t.t0&&t.t0.details||((n=new Error).details="UNKNOWN"),n.details),t.next="AUTH_TOKEN_EXPIRED"===t.t1?20:"XMPP_ALREADY_CONNECTED"===t.t1?22:"XMPP_IN_CONNECTING_STATE"===t.t1?24:26;break;case 20:return o.default.error("[xmppService] Impossible to renew token, redirect to login page"),this.interruptAutoReconnect(),c.default.logout(),this.reconnectInProgress=!1,t.abrupt("break",27);case 22:return o.default.error("[xmppService] In auto-reconnect, but already connected -- ignore"),this.reconnectInProgress=!1,t.abrupt("break",27);case 24:return o.default.error("[xmppService] xmpp is still connecting -- wait"),t.abrupt("break",27);case 26:this.reconnectInProgress&&(this.reconnectionDelay=2*this.reconnectionDelay,this.reconnectionDelay>15e3&&(this.reconnectionDelay=15e3),o.default.info("[xmppService] Auto-reconnection failure (next try in "+this.reconnectionDelay+"ms)"),this.reconnectTimeout=setTimeout((function(){r.autoReconnect()}),this.reconnectionDelay)),this.reconnectInProgress=!1;case 27:case"end":return t.stop()}}),t,this,[[0,14]])})))}},{key:"subscribeToContactEvents",value:function(e){return this.rxContactSubject.subscribe(e)}},{key:"subscribeToConnectionEvents",value:function(e){return this.rxConnectionSubject.subscribe(e)}},{key:"publishContactEvent",value:function(e,t){this.rxContactSubject.next(a.RBEvent.create(e,t))}},{key:"publishConnectionEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxConnectionSubject.next(a.RBEvent.create(e,t))}},{key:"onRosterChangedMessageReceived",value:function(e){var t=this;try{return h(e).find("item").each((function(e,n){var r=h(n),i=t.getBareJidFromJid(r.attr("jid")),a="favorites"===r.find("group").first().text(),o=r.attr("subscription"),s=r.attr("ask");t.publishContactEvent("ON_ROSTER_CHANGED_EVENT",{jid:i,subscription:o||"none",favorite:a,ask:s||"none"})})),!0}catch(n){return!0}}},{key:"sendPresence",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(this.connection&&this.connection.send&&this.stropheStatus===Strophe.Status.CONNECTED)try{o.default.info("Send presence "+e+" - "+t+" ("+this.jid+")");var i=$pres();i.c("priority").t("5"),i.up(),e&&"online"!==e&&i.c("show").t(e),!t||e&&"online"!==e?t&&i.up().c("status").t(t):i.c("status").t(t),!0===n&&(e&&"online"!==e&&i.up(),i.c("application",{xmlns:"jabber:iq:application"}),i.c("appid").t(config.rainbowApiClientKey).up(),i.c("userid").t(c.default.userId).up().up(),i.c("parameters",{xmlns:"jabber:iq:configuration"}),i.c("user_options",{alert:r.alert,im:r.im})),this.connection.send(i)}catch(a){return void o.default.error("this.connection.send error : "+a)}else o.default.error('[xmppService] Try to send "presence IQ" but no xmpp connection')}},{key:"resetPresence",value:function(e){o.default.info("Reset presence to ".concat(this.presenceStatus," (").concat(this.jid,")")),this.sendPresence(e.show,e.status)}},{key:"onPresenceMessageReceived",value:function(e){try{var t=h(e),n=t.attr("from"),r=this.getBareJidFromJid(n),i=t.find("x").attr("xmlns"),a=t.attr("type");if(i&&0===i.indexOf(Strophe.NS.MUC))return!0;if(t.find("actor").length>0&&"jabber:iq:configuration"===t.find("actor").attr("xmlns")&&(t.find("avatar").length>0?this.publishContactEvent("ON_CONTACT_UPDATE_EVENT",{from:r,type:"avatar"}):t.find("data").length>0&&this.publishContactEvent("ON_CONTACT_UPDATE_EVENT",{from:r,type:"data"}),t.find("x").length&&"vcard-temp:x:update"===t.find("x").attr("xmlns")&&!t.find("delay").length))return!0;if("error"===a)o.default.error("Receive error presence message");else if("subscribe"===a)o.default.info("Receive subscribe from ("+r+")");else{var s="offline",c="";if("unavailable"!==a){var l=t.find("show").text();c=t.find("status").text(),s=""===l||"chat"===l?"online":"dnd"===l?"dnd":"xa"===l?"xa":"away"}var u=t.find("applyCalendarPresence").text(),d=t.find("delay").attr("stamp"),f=d?new Date(d):new Date,p=t.find("until").text(),m={jid:n,status:s,message:c,stamp:f,until:p=p?new Date(p):null,applyCalendarPresence:u};this.isConnectedJid(n)&&!this.isInitialPresenceSent&&(this.isInitialPresenceSent=!0,this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"PRESENCE"})),this.contactServiceReady?this.publishContactEvent("ON_CONTACT_PRESENCE_EVENT",m):(o.default.info("[xmppService] Receive presence message but contact service is not ready yet"),this.presenceWaitingList.push(m))}return!0}catch(v){return!0}}},{key:"getPresenceWaitingList",value:function(){return this.presenceWaitingList}},{key:"resetPresenceWaitingList",value:function(){this.presenceWaitingList=[]}},{key:"addHistoryHandler",value:function(e){this.historyHandler=e}},{key:"addBulkHistoryHandler",value:function(e){this.bulkHistoryHandler=e}},{key:"addSearchTextHandler",value:function(e){this.searchTextHandler=e}},{key:"addHistoryCallLogsHandler",value:function(e){this.callLogHandler=e}},{key:"onMamBulkMessageReceived",value:function(e){try{this.bulkHistoryHandler(e)}catch(t){return!0}return!0}},{key:"onMamMessageReceived",value:function(e){try{var t=h(e).find("result").attr("queryid");return t||(t=h(e).find("fin").attr("queryid")),t&&(-1!==t.indexOf("tel_")||-1!==t.indexOf("cache_"))&&this.historyHandler?this.historyHandler(e):this.callLogHandler&&this.callLogHandler(e),!0}catch(n){return!0}}},{key:"onSearchTextMessageReceived",value:function(e){try{var t=angular.element(e).find("result").attr("queryid");return t||(t=angular.element(e).find("fin").attr("queryid")),this.searchTextHandler&&this.searchTextHandler(t,e),!0}catch(n){return!0}}},{key:"getBareJidFromJid",value:function(e){return Strophe.getBareJidFromJid(e)}},{key:"getResourceFromJid",value:function(e){return Strophe.getResourceFromJid(e)}},{key:"isMobileResource",value:function(e){return-1!==e.indexOf("mobile_")}},{key:"addHandler",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this.connection.addHandler(e,t,n,r)}},{key:"deleteHandler",value:function(e){this.connection&&this.connection.deleteHandler(e)}},{key:"isConnectedJid",value:function(e){return!(!e||0===e.length)&&e.startsWith(this.jid)}},{key:"send",value:function(e){var t=this;return new Promise((function(n){try{if(!t.connection&&t.stropheStatus!==Strophe.Status.CONNECTED)throw o.default.error('[xmppService] Try to send "stanza" but no xmpp connection'),new Error("No XMPP connection");t.connection.send(e)}catch(r){o.default.error("[xmppService] this.connection.send error : "+r)}n()}))}},{key:"sendIQ",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(i,a){try{if(!n.connection&&n.stropheStatus!==Strophe.Status.CONNECTED)throw o.default.error('[xmppService] Try to send "iq" but no xmpp connection'),new Error("No XMPP connection");n.connection.sendIQ(t,(function(e){i(e)}),(function(e){a(new Error(e?e.innerHTML:"XMPP request timeout"))}),r&&r>e.REQUEST_TIMEOUT?r:e.REQUEST_TIMEOUT)}catch(s){o.default.error("[xmppService] this.connection.sendIQ error : "+s),a(new Error("this.connection.sendIQ error"))}}))}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.xmppService||(t.rainbow.xmppService=new e),t.rainbow.xmppService}}]),e}();f.REQUEST_TIMEOUT=1e4,t.XmppService=f,t.default=f.getInstance()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(24),a=function(){function e(){S(this,e),this.redirectVoIP=!1,this.automaticHookOff=!1,this.automaticHookOffTime=0,this.languageCodes=null,this.defaultLanguage={label:"English",settingCode:"en",code:"en",isoCode:"en",codeMoment:"en",unicode:"1f1ec-1f1e7"},this.languages=[this.defaultLanguage,{label:"Fran\xe7ais",settingCode:"fr",code:"fr",isoCode:"fr",codeMoment:"fr",unicode:"1f1eb-1f1f7"},{label:"Catal\xe0",settingCode:"ca",code:"ca",isoCode:"ca",codeMoment:"ca",unicode:"1f1ea-1f1f8"},{label:"Czech",settingCode:"cs",code:"cs",isoCode:"cs",codeMoment:"cs",unicode:"1F1E8-1F1FF"},{label:"Deutsch",settingCode:"de",code:"de",isoCode:"de",codeMoment:"de",unicode:"1f1e9-1f1ea"},{label:"Espa\xf1ol",settingCode:"es-es",code:"es-es",isoCode:"es-ES",codeMoment:"es",unicode:"1f1ea-1f1f8"},{label:"Suomi",settingCode:"fi",code:"fi",isoCode:"fi",codeMoment:"fi",unicode:"1f1eb-1f1ee"},{label:"Italiano",settingCode:"it",code:"it",isoCode:"it",codeMoment:"it",unicode:"1f1ee-1f1f9"},{label:"\u05e2\u05d1\u05e8\u05d9\u05ea",settingCode:"he",code:"he",isoCode:"he",codeMoment:"he",unicode:"1f1ee-1f1f1"},{label:"\u65e5\u672c\u8a9e",settingCode:"ja",code:"ja",isoCode:"ja",codeMoment:"ja",unicode:"1f1ef-1f1f5"},{label:"\ud55c\uad6d\uc5b4",settingCode:"ko",code:"ko",isoCode:"ko",codeMoment:"ko",unicode:"1f1f0-1f1f7"},{label:"Nederlands",settingCode:"nl",code:"nl",isoCode:"nl",codeMoment:"nl",unicode:"1F1F3-1F1F1"},{label:"Nynorsk",settingCode:"no",code:"no",isoCode:"no",codeMoment:"nn",unicode:"1F1F3-1F1F4"},{label:"Portugu\xeas do Brasil",settingCode:"pt-br",code:"pt-BR",isoCode:"pt-BR",codeMoment:"pt-br",unicode:"1F1E7-1F1F7"},{label:"Portugu\xeas",settingCode:"pt-pt",code:"pt-PT",isoCode:"pt-PT",codeMoment:"pt",unicode:"1F1F5-1F1F9"},{label:"Polski",settingCode:"pl",code:"pl",isoCode:"pl",codeMoment:"pl",unicode:"1F1F5-1F1F1"},{label:"P\u0443\u0441\u0441\u043a\u0438\u0439",settingCode:"ru",code:"ru",isoCode:"ru",codeMoment:"ru",unicode:"1F1F7 1F1FA"},{label:"Svenskt",settingCode:"sv-se",code:"sv-SE",isoCode:"sv-SE",codeMoment:"sv",unicode:"1F1F8-1F1EA"},{label:"T\xfcrk\xe7e",settingCode:"tr",code:"tr",isoCode:"tr",codeMoment:"tr",unicode:"1f1f9-1f1f7"},{label:"\u4e2d\u6587",settingCode:"zh-cn",code:"zh-cn",isoCode:"zh-CN",codeMoment:"zh-cn",unicode:"1f1e8-1f1f3"},{label:"\u7e41\u9ad4\u4e2d\u6587",settingCode:"zh-tw",code:"zh-TW",isoCode:"zh-TW",codeMoment:"zh-tw",unicode:"1F1F9-1F1FC"},{label:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",settingCode:"ar",code:"ar",isoCode:"ar",codeMoment:"ar",unicode:"0600\u201306FF"}],this.settings={init:!0,lang:"en",imSound:"true",imNotif:"true",displayOrder:"FL",nbMaxConversations:"100",microphone:"default",headsetMicrophone:null,speakerphoneMicrophone:null,customMicrophone:null,headsetDeviceName:null,speakerphoneDeviceName:null,speaker:"default",headsetSpeaker:null,speakerphoneSpeaker:null,customSpeaker:null,ringingSpeaker:"default",ringingSpeakerName:"",camera:"default",cameraUsed:"",audioProfile:"handfree",currentDevice:null,iceConfig:null,sdk:!1,userWiewOrderType:"lastname",userWiewFilterType:"all",autoStartAnimatedGif:"false",fixedLayout:"false",theme:"default",translationMsg:"false",newUI:"false",autoAcceptRoomInvite:"false",server:null,activeAlarm:"relax1",activeNotif:"stairs",devMode:"false",hasSecondRinger:"false",validationMode:"false",disableCalendarPresence:"false",deviceList:"[]",displayFilesType:"filesListCell--as-grid",displayRoomsAsGrid:"true",handFreeInputDeviceName:null,handFreeOutputDeviceName:null,customSpeakerName:null,customMicrophoneName:null,showBodyMessage:"false",bubblesFilterType:"all",bubblesOrderType:"lastActivityDate",webinarsFilterType:"all",webinarsOrderType:"lastActivityDate",displayWebinarsAsGrid:"false",protectionAgainstMailTypeOffline:!1,channelMarkdown:"false",chrisPrankMode:"true",joinSfuSound:"true",searchFilterValue:"NoFiltering",enableSingleSignOnWebAuthPopup:"false",enableSingleSignOnConfig:"false",extension:"false",enableDSCP:!1,filterIce:!1,dtx:!1,simulcast:!1,debugWebRTC:!1,unifiedPlan:!1,sipWiseMode:"false",fontSize:"62.5%",lastInactiveBubbleShownDate:null,meetingsOrderType:"lastActivityDate",meetingsFilterType:"all",filesOrderBy:"date",filesFilterBy:"all",enterKeyAction:"enterSend",activeTalker:!1,forceConsoleLog:!1,sfuJoinBundle:!1,geoip:"",applyCalendarPresence:!1,informationImSound:"ding",importantImSound:"important",emergencyImSound:"emergency"},this.updateSubject=new r.Subject}return C(e,[{key:"configure",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.redirectVoIP="true"===localStorage.getItem("redirectVoIP"),this.languageCodes=this.languages.map((function(e){return e.settingCode}));var n=this.getLocalStorageSettings();if(n.init)t&&(n.lang=this.getMappedLanguage(t),this.setAppliLanguageCode(n.lang)),Object.keys(n).forEach((function(t){null!==n[t]&&(e.settings[t]=n[t])}));else{var r=navigator,a=r.languages?r.languages[0]:r.language||r.userLanguage,o=t||a;this.settings.lang=this.getMappedLanguage(o),this.setAppliLanguageCode(this.settings.lang),Object.keys(this.settings).forEach((function(t){localStorage.setItem(t,e.settings[t])}))}this.sendUpdateEvent(i.RBEvent.create("SETTINGS_UPDATED"))}},{key:"setSetting",value:function(e,t){this.settings[e]=t,localStorage.setItem(e,t)}},{key:"getSetting",value:function(e){return this.settings[e]}},{key:"getBooleanSetting",value:function(e){return"true"===this.settings[e]}},{key:"sendUpdateEvent",value:function(e){this.updateSubject.next(e)}},{key:"subscribeUpdateEvent",value:function(e,t){return this.updateSubject.subscribe((function(n){n.name===e&&t(n.data)}))}},{key:"getLocalStorageSettings",value:function(){var e={};return Object.keys(this.settings).forEach((function(t){e[t]=localStorage.getItem(t)})),e.nbMaxConversations?parseInt(e.nbMaxConversations,10)<15&&this.setSetting("nbMaxConversations","15"):e.nbMaxConversations=this.settings.nbMaxConversations,"default"===e.headsetMicrophone&&(e.headsetMicrophone=null),"default"===e.headsetSpeaker&&(e.headsetSpeaker=null),"default"===e.speakerphoneMicrophone&&(e.speakerphoneMicrophone=null),"default"===e.speakerphoneSpeaker&&(e.speakerphoneSpeaker=null),"default"===e.customMicrophone&&(e.customMicrophone=null),"default"===e.customSpeaker&&(e.customSpeaker=null),e}},{key:"getRedirectVoIP",value:function(){return this.redirectVoIP}},{key:"setRedirectVoIP",value:function(e){this.redirectVoIP=e,localStorage.setItem("redirectVoIP",e.toString())}},{key:"isAutomaticHookOff",value:function(){return this.automaticHookOff}},{key:"setAutomaticHookOff",value:function(e){this.automaticHookOff=e}},{key:"getAutomaticHookOffTime",value:function(){return this.automaticHookOffTime}},{key:"setAutomaticHookOffTime",value:function(e){this.automaticHookOffTime=e}},{key:"setIceConfig",value:function(e){this.settings.iceConfig=e}},{key:"getAvailableLanguages",value:function(){return this.languages}},{key:"getAppliLanguage",value:function(){var e=this;return this.languages.filter((function(t){return t.settingCode===e.settings.lang}))[0]||this.defaultLanguage}},{key:"getAppliLanguageCodeForServer",value:function(){var e=this.settings.lang.split("-");return 1===e.length?this.settings.lang:e[0]+"-"+e[1].toUpperCase()}},{key:"setAppliLangageCodeFromServer",value:function(e){var t=e.split("-"),n=t[0];n&&(n=n.toLowerCase()),2===t.length&&(n+="-"+t[1].toLowerCase()),n=this.getMappedLanguage(n),n=this.languageCodes.indexOf(n)>=0?n:"en",this.setAppliLanguageCode(n)}},{key:"setAppliLanguageCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?this.setSetting("lang",e):this.settings.lang=e,this.sendUpdateEvent(i.RBEvent.create("LANGUAGE_UPDATED",e))}},{key:"getBestLanguageForIsoCode",value:function(e){var t=this.getLanguageByIsoCode(e);if(t)return t;if(-1!==e.indexOf("-")){var n=e.split("-")[0];return this.getLanguageByIsoCode(n)}return this.getLanguageByIsoCode("en")}},{key:"getLanguageByIsoCode",value:function(e){return this.languages.find((function(t){return t.isoCode===e}))}},{key:"getMappedLanguage",value:function(e){if(!e)return"en";var t=e.toLowerCase();switch(t.split("-")[0]){case"ar":return"ar";case"ca":return"ca";case"cs":return"cs";case"en":return"en";case"fr":return"fr";case"de":return"de";case"es":return"es-es";case"fi":return"fi";case"it":return"it";case"he":return"he";case"ja":return"ja";case"ko":return"ko";case"nl":return"nl";case"no":return"no";case"pt":return"pt-br"===t?"pt-br":"pt-pt";case"pl":return"pl";case"ru":return"ru";case"sv":return"sv-se";case"tr":return"tr";case"zh":return["zh-cn","zh-tw"].indexOf(t)>=0?t:"zh-cn";default:return"en"}}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.settingsService||(t.rainbow.settingsService=new e),t.rainbow.settingsService}}]),e}();t.SettingsService=a,t.default=a.getInstance()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=n(4),o=n(15),s=n(10),c=n(24),l=n(315),u=n(1),d=function(){function e(){S(this,e),this.FeaturesEnum={COMPANY_ADMIN_COUNT:"COMPANY_ADMIN_COUNT",COMPANY_LOGO_MODIFICATION:"COMPANY_LOGO_MODIFICATION",COMPANY_DOMAIN_NAME_MODIFICATION:"COMPANY_DOMAIN_NAME_MODIFICATION",COMPANY_DETAILS_MODIFICATION:"COMPANY_DETAILS_MODIFICATION",COMPANY_SINGLE_SIGN_ON_SAML:"COMPANY_SINGLE_SIGN_ON_SAML",COMPANY_SINGLE_SIGN_ON_OIDC:"COMPANY_SINGLE_SIGN_ON_OIDC",WEBRTC_FOR_MOBILE:"WEBRTC_FOR_MOBILE",BUBBLE_PARTICIPANT_COUNT:"BUBBLE_PARTICIPANT_COUNT",TELEPHONY_BASIC_CALL:"TELEPHONY_BASIC_CALL",TELEPHONY_SECOND_CALL:"TELEPHONY_SECOND_CALL",TELEPHONY_TRANSFER_CALL:"TELEPHONY_TRANSFER_CALL",TELEPHONY_CONFERENCE_CALL:"TELEPHONY_CONFERENCE_CALL",TELEPHONY_DEFLECT_CALL:"TELEPHONY_DEFLECT_CALL",TELEPHONY_PHONE_BOOK:"TELEPHONY_PHONE_BOOK",TELEPHONY_VOICE_MAIL:"TELEPHONY_VOICE_MAIL",TELEPHONY_CALL_FORWARD:"TELEPHONY_CALL_FORWARD",TELEPHONY_NOMADIC:"TELEPHONY_NOMADIC",CONFERENCE_PARTICIPANT_COUNT:"CONFERENCE_PARTICIPANT_COUNT",WEBRTC_CONFERENCE_ALLOWED:"WEBRTC_CONFERENCE_ALLOWED",WEBRTC_CONFERENCE_PARTICIPANT_COUNT:"WEBRTC_CONFERENCE_PARTICIPANT_COUNT",WEBRTC_PARTICIPANT_ALLOWED:"WEBRTC_PARTICIPANT_ALLOWED",CONFERENCE_ALLOWED:"CONFERENCE_ALLOWED",CONFERENCE_DIAL_OUT:"CONFERENCE_DIAL_OUT",CONFERENCE_RECORDING:"CONFERENCE_RECORDING",MSO365_CALENDAR_PRESENCE:"MSO365_CALENDAR_PRESENCE",MSO365_DIRECTORY_PROVISIONING:"MSO365_DIRECTORY_PROVISIONING",MSO365_DIRECTORY_SEARCH:"MSO365_DIRECTORY_SEARCH",MSO365_CONTACT_SEARCH:"MSO365_CONTACT_SEARCH",MS_OUTLOOK_PLUGIN:"MS_OUTLOOK_PLUGIN",MS_SKYPE_PLUGIN:"MS_SKYPE_PLUGIN",FILE_SHARING_QUOTA_GB:"FILE_SHARING_QUOTA_GB",GOOGLE_CALENDAR_PRESENCE:"GOOGLE_CALENDAR_PRESENCE",WEBRTC_P2P_RECORDING:"WEBRTC_P2P_RECORDING",BUBBLE_PROMOTE_MEMBER:"BUBBLE_PROMOTE_MEMBER",BUBBLE_GUESTS_ALLOWED:"BUBBLE_GUESTS_ALLOWED",BUBBLE_ACTIVE_SPEAKER:"BUBBLE_ACTIVE_SPEAKER",TELEPHONY_WEBRTC_GATEWAY:"TELEPHONY_WEBRTC_GATEWAY",TELEPHONY_WEBRTC_PSTN_CALLING:"TELEPHONY_WEBRTC_PSTN_CALLING",ANALYTICS_DASHBOARD_EC:"ANALYTICS_DASHBOARD_EC",ANALYTICS_DASHBOARD_BP:"ANALYTICS_DASHBOARD_BP",TELEPHONY_CALL_SUBJECT:"CALL_SUBJECT",CHANNEL_CREATE:"CHANNEL_CREATE",CHANNEL_CREATE_ADMIN_ROLE_BYPASS:"CHANNEL_CREATE_ADMIN_ROLE_BYPASS",CHANNEL_ACTIVATED:"CHANNEL_ACTIVATED",MANAGE_ANDROID_TV:"MANAGE_ANDROID_TV",USE_ANDROID_TV:"USE_ANDROID_TV",MASSPRO_USER_PROVISIONING_CSV:"MASSPRO_USER_PROVISIONING_CSV",SEARCH_BY_TAGS:"SEARCH_BY_TAGS",TELEPHONY_3DPARTY_ASSOC:"TELEPHONY_3DPARTY_ASSOC",WEBCLIENT_UI_2_0:"WEBCLIENT_UI_2_0",WEBRTC_UNIFIED_PLAN:"WEBRTC_UNIFIED_PLAN",WEBRTC_CONFERENCE_SIMULCAST:"WEBRTC_CONFERENCE_SIMULCAST",USE_CLOUD_PBX:"USE_CLOUD_PBX",USE_OXO_MANAGED_PBX:"USE_OXO_MANAGED_PBX",SOFTPHONE_MODE_ONLY:"SOFTPHONE_MODE_ONLY",GIVE_REQUEST_REMOTE_CONTROL:"GIVE_REQUEST_REMOTE_CONTROL",BUBBLE_MAX_LOAD_STARTUP:"BUBBLE_MAX_LOAD_STARTUP",BUBBLE_COUNT:"BUBBLE_COUNT",BUBBLE_MEETING_SCHEDULER:"BUBBLE_MEETING_SCHEDULER",BUBBLE_TALKING_TIME:"BUBBLE_TALKING_TIME",APP_PERMISSIONS:"APP_PERMISSIONS",FREE_UI_CUSTOMIZATION:"FREE_UI_CUSTOMIZATION",PREMIUM_UI_CUSTOMIZATION:"PREMIUM_UI_CUSTOMIZATION",TELEPHONY_MAKE_CALL_CTI_APP:"TELEPHONY_MAKE_CALL_CTI_APP",CLOUD_PBX_WELCOME:"CLOUD_PBX_WELCOME",BUBBLE_TAG_COUNT:"BUBBLE_TAG_COUNT",TELEPHONY_CCD_AGENT:"TELEPHONY_CCD_AGENT",ALERT_NOTIFICATIONS_ALLOWED:"ALERT_NOTIFICATIONS_ALLOWED",BUBBLE_FOLDER_COUNT:"BUBBLE_FOLDER_COUNT"},this.started=!1,this.features={},this.profiles=[],this.mainOffers=[],this.thirdPartyApps=null,this.profileEventHandler=null,this.rxSubject=new s.Subject,this.timer=null,this.contactService=u.default}return C(e,[{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o.default.info(""),o.default.info("[profileService] === STARTING ==="),this.attachHandlers(),e.next=6,this.getServerProfile();case 6:this.started=!0,o.default.info("[profileService] === STARTED ==="),this.rxSubject.next(c.RBEvent.create("ON_PROFILE_FEATURES_UPDATED")),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(0),o.default.info("[profileService] === STARTING FAILURE === "+e.t0.message),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,11]])})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.default.info("[profileService] === STOPPING ==="),this.detachHandlers(),this.started=!1,o.default.info("[profileService] === STOPPED ===");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"restart",value:function(){o.default.info("[profileService] === RESTART ==="),this.attachHandlers(),this.onUserUpdateNeeded()}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"attachHandlers",value:function(){var e=this;this.detachHandlers(),o.default.info("[profileService] attachHandlers"),this.profileEventHandler=a.default.addHandler((function(t){return e.onManagementMessageReceived(t)}),null,"message","management")}},{key:"detachHandlers",value:function(){o.default.info("[profileService] detachHandlers"),this.profileEventHandler&&(a.default.deleteHandler(this.profileEventHandler),this.profileEventHandler=null)}},{key:"onManagementMessageReceived",value:function(e){try{var t=$(e).find("userprofile");if(o.default.info("[profileService] onManagementMessageReceived  -- on userprofile management message received"),t.length)switch(t.attr("action")){case"create":case"update":case"delete":this.onUserUpdateNeeded();break;default:o.default.info("[profileService] onManagementMessageReceived  -- unknown action")}return!0}catch(n){return o.default.error("[profileService] onManagementMessageReceived ERROR "+n),!0}}},{key:"onUserUpdateNeeded",value:function(){var e=this;this.timer||(this.timer=setTimeout((function(){return r(e,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getServerProfile();case 3:this.rxSubject.next(c.RBEvent.create("ON_PROFILE_FEATURES_UPDATED")),this.timer=null,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.timer=null,o.default.info("[profileService] === onUserUpdateNeeded FAILURE === "+e.t0.message);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))}),3e3))}},{key:"getServerProfile",value:function(){return Promise.all([this.getServerProfiles(),this.getServerProfilesFeatures()])}},{key:"getServerProfiles",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,a,s,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/profiles"),n=i.default.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:return e.next=10,r.json();case 10:a=e.sent,this.profiles=[],this.mainOffers=[],a.data.forEach((function(e){o.default.debug("[profileService] getServerProfiles === response === "+e),c.profiles.push(e);var t=l.Offer.createFromProfileData(e);(t.isExclusive||t.isDefault)&&c.mainOffers.push(t)})),this.mainOffers.sort(l.Offer.offerComparator),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(0),s="getServerProfiles failure: no server response",e.t0&&(s="getServerProfiles failure: "+JSON.stringify(e.t0)),o.default.error("[profileService] "+s),new Error(s);case 18:case"end":return e.stop()}}),e,this,[[0,14]])})))}},{key:"getServerProfilesFeatures",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,a,s,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/profiles/features"),n=i.default.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:return e.next=10,r.json();case 10:a=e.sent,this.features={},a.data.forEach((function(e){o.default.debug("[profileService] getServerProfilesFeatures === response === "+JSON.stringify(e)),e.hasOwnProperty("featureUniqueRef")&&(c.features[e.featureUniqueRef]=e)})),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(0),s="getServerProfilesFeatures failure: no server response",e.t0&&(s="getServerProfilesFeatures failure: "+JSON.stringify(e.t0)),o.default.error("[profileService] "+s),new Error(s);case 18:case"end":return e.stop()}}),e,this,[[0,14]])})))}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t||(t=this.features),!(!config.urgencyNotifReceptionForced||"ALERT_NOTIFICATIONS_ALLOWED"!==e)||(this.started&&t.hasOwnProperty(e)&&t[e].hasOwnProperty("featureType")&&"boolean"===t[e].featureType&&t[e].hasOwnProperty("isEnabled")?t[e].isEnabled:(o.default.info("[profileService] isFeatureEnabled("+e+"): service not started or feature not enabled"),!1))}},{key:"getFeatureLimitMax",value:function(e){if(this.started&&this.features.hasOwnProperty(e)&&this.features[e].hasOwnProperty("featureType")&&"number"===this.features[e].featureType&&this.features[e].hasOwnProperty("limitMax")){var t=this.features[e].limitMax;return o.default.debug("[profileService] getFeatureLimitMax("+e+"): "+t),t}return o.default.info("[profileService] getFeatureLimitMax("+e+"): service not started or feature not enabled"),0}},{key:"getFeatureLimitMin",value:function(e){if(this.started&&this.features.hasOwnProperty(e)&&this.features[e].hasOwnProperty("featureType")&&"number"===this.features[e].featureType&&this.features[e].hasOwnProperty("limitMin")){var t=this.features[e].limitMin;return o.default.debug("[profileService] getFeatureLimitMin("+e+"): "+t),t}return o.default.info("[profileService] getFeatureLimitMin("+e+"): service not started or feature not enabled"),0}},{key:"getMyProfileOffer",value:function(){return this.mainOffers.length>0?this.mainOffers.slice(-1)[0]:null}},{key:"getMyProfileName",value:function(){var e=this.getMyProfileOffer();return e?e.name:null}},{key:"getMyProfiles",value:function(){var e=[];return this.started?e=this.profiles:o.default.warn("[profileService] getMyProfiles(): service not started"),e}},{key:"getMyProfileFeatures",value:function(){var e=this,t={};return this.started?Object.keys(this.features).forEach((function(n){var r=e.features[n],i={};Object.keys(r).filter((function(e){return"featureUniqueRef"===e||"featureType"===e||"limitMin"===e||"limitMax"===e||"isEnabled"===e})).forEach((function(e){i[e]=r[e]})),t[n]=i})):o.default.warn("[profileService] getMyProfileFeatures(): service not started"),t}},{key:"getThirdPartyApps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r(this,void 0,void 0,b.a.mark((function t(){var n,r,a,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,null===this.thirdPartyApps||e){t.next=3;break}return t.abrupt("return",(o.default.info("[profileService] getThirdPartyApps -- from cache"),this.thirdPartyApps));case 3:return n=config.restServerUrl+"/api/rainbow/authentication/v1.0/oauth/tokens?format=medium",r=i.default.getRequestHeader(),t.next=7,fetch(n,{method:"GET",headers:r});case 7:if((a=t.sent).ok){t.next=10;break}throw a;case 10:return t.next=12,a.json();case 12:return s=t.sent,t.abrupt("return",(o.default.info("[profileService] getThirdPartyApps from server -- success"),this.thirdPartyApps=s&&s.data?s.data:[],this.thirdPartyApps));case 16:throw t.prev=16,t.t0=t.catch(0),c="getThirdPartyApps from server failed -- no answer from server",t.t0&&(c="getThirdPartyApps from server failed -- "+JSON.stringify(t.t0)),o.default.error("[profileService] "+c),new Error(c);case 20:case"end":return t.stop()}}),t,this,[[0,16]])})))}},{key:"revokeThirdPartyAccess",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,a,s,c,l=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}throw o.default.warn("[profileService] revokeThirdPartyAccess missing token"),new Error("No tokenId");case 3:return o.default.info("[profileService] revokeThirdPartyAccess with token -- "+e),n="".concat(config.restServerUrl,"/api/rainbow/authentication/v1.0/oauth/tokens/").concat(e),r=i.default.getRequestHeader(),t.next=8,fetch(n,{method:"DELETE",headers:r});case 8:if((a=t.sent).ok){t.next=11;break}throw a;case 11:return t.next=13,a.json();case 13:return s=t.sent,t.abrupt("return",(o.default.info("[profileService] revokeThirdPartyAccess -- success"),this.thirdPartyApps=s&&s.data?s.data:[],this.thirdPartyApps.forEach((function(t,n){t.id===e&&l.thirdPartyApps.splice(n,1)})),this.thirdPartyApps));case 17:throw t.prev=17,t.t0=t.catch(0),c="revokeThirdPartyAccess from server failed -- no answer from server",t.t0&&(c="revokeThirdPartyAccess from server failed -- "+JSON.stringify(t.t0)),o.default.error("[profileService] "+c),new Error(c);case 21:case"end":return t.stop()}}),t,this,[[0,17]])})))}},{key:"getProfilesByName",value:function(e){return this.profiles.filter((function(t){return-1!==t.profileName.toLowerCase().indexOf(e)}))}},{key:"setUserData",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,a,s,c,l;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(u.default.userContact.dbId),r=i.default.getPostHeader(),a=JSON.stringify(e),t.next=6,fetch(n,{method:"PUT",headers:r,body:a});case 6:if((s=t.sent).ok){t.next=9;break}throw s;case 9:return t.next=11,s.json();case 11:return c=t.sent,t.abrupt("return",(o.default.info("[profileService] setUserData ".concat(a," -- success")),c));case 15:throw t.prev=15,t.t0=t.catch(0),l="setUserData failure: no server response",t.t0&&(l="setUserData failure: "+JSON.stringify(t.t0)),o.default.error("[profileService] "+l),new Error(l);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.profileService||(t.rainbow.profileService=new e),t.rainbow.profileService}}]),e}();t.ProfileService=d,t.default=d.getInstance()},function(e,t,n){n.d(t,"a",(function(){return i}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}},function(e,t,n){var r=n(51),i=n(11),a=n(41),o=n(53),s=n(29),c=n(62),l=n(21);n.d(t,"a",(function(){return u}));var u=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,s=function(e,t,n){if(e){if(e instanceof i.a)return e;if(e[a.a])return e[a.a]()}return e||t||n?new i.a(e,t,n):new i.a(o.a)}(e,t,n);if(r?s.add(r.call(s,this.source)):s.add(this.source||l.a.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),l.a.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){l.a.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),Object(r.a)(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=d(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(n){r(n),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[s.a]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Object(c.b)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=d(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function d(e){if(e||(e=l.a.Promise||Promise),!e)throw new Error("no Promise impl found");return e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(39),i=new(function(){function e(){S(this,e)}return C(e,[{key:"sdk",value:function(e){if(r.sdkConfig.verboseLog){var t=(new Date).toUTCString();e=e||"",console.log("%c"+t+" | Rainbow Web SDK  | "+e,"color:green")}}},{key:"webrtc",value:function(e){if(r.sdkConfig.verboseLog){var t=(new Date).toUTCString();console.log("%c"+t+" | RTCWEB | "+e,"color:green")}}},{key:"info",value:function(e){if(r.sdkConfig.verboseLog){var t=(new Date).toUTCString();console.info("%c"+t+" | Rainbow Web SDK  | "+e,"color:green")}}},{key:"error",value:function(e){if(r.sdkConfig.verboseLog){var t=(new Date).toUTCString();console.error("%c"+t+" | Rainbow Web SDK  | "+e,"color:green")}}},{key:"debug",value:function(e){if(r.sdkConfig.verboseLog){var t=(new Date).toUTCString();console.debug("%c"+t+" | Rainbow Web SDK  | "+e,"color:green")}}},{key:"time",value:function(e){r.sdkConfig.measurePerformance&&console.time(e)}},{key:"timeLog",value:function(e){r.sdkConfig.measurePerformance&&console.timeLog(e)}},{key:"timeEnd",value:function(e){r.sdkConfig.measurePerformance&&console.timeEnd(e)}}]),e}());t.rainbowLogger=i},function(e,t,n){n.r(t);var r=n(8),i=n(7),a=n(23),o=n(11),s=n(13),c=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new l(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return i.a(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(o.a),u=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return i.a(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new s.a).add(this.source.subscribe(new d(this.getSubject(),this))),e.closed&&(this._connection=null,e=s.a.EMPTY)),e},t.prototype.refCount=function(){return(e=this).lift(new c(e));var e},t}(r.a),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return i.a(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(a.b);o.a,o.a;!function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}i.a(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)}}(o.a);var h=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return i.a(t,e),t.prototype._subscribe=function(e){var t=new s.a,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new f(n)),t.add(r.subscribe(e)),t},t}(r.a),f=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return i.a(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(s.a),p=n(29),m=n(77),v=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return i.a(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return i.a(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(s.a)),g=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return i.a(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(v),y=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),b=function(e){function t(n,r){void 0===r&&(r=y.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return i.a(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(y),S=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.a(t,e),t}(b))(g),_=S,C=new r.a((function(e){return e.complete()}));function w(e){return e?function(e){return new r.a((function(t){return e.schedule((function(){return t.complete()}))}))}(e):C}function E(e){return e&&"function"==typeof e.schedule}var T,k=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}};function M(e,t){return new r.a((function(n){var r=new s.a,i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function D(e,t){return t?M(e,t):new r.a(k(e))}function x(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return E(n)?(e.pop(),M(e,n)):D(e)}function R(e,t){return t?new r.a((function(n){return t.schedule(O,0,{error:e,subscriber:n})})):new r.a((function(t){return t.error(e)}))}function O(e){var t=e.error;e.subscriber.error(t)}T||(T={});var I=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return x(this.value);case"E":return R(this.error);case"C":return w()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),P=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return i.a(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new A(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(I.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(I.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(I.createComplete()),this.unsubscribe()},t}(o.a),A=function(e,t){this.notification=e,this.destination=t},L=n(30),N=n(63),j=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return i.a(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new U(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,a=r.length;if(this.closed)throw new L.a;if(this.isStopped||this.hasError?t=s.a.EMPTY:(this.observers.push(e),t=new N.a(this,e)),i&&e.add(e=new P(e,i)),n)for(var o=0;o<a&&!e.closed;o++)e.next(r[o]);else for(o=0;o<a&&!e.closed;o++)e.next(r[o].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||_).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,a=0;a<i&&!(e-r[a].time<n);)a++;return i>t&&(a=Math.max(a,i-t)),a>0&&r.splice(0,a),r},t}(a.a),U=function(e,t){this.time=e,this.value=t},F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return i.a(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),s.a.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),s.a.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(a.a),H=1,W=Promise.resolve(),Y={};function B(e){return e in Y&&(delete Y[e],!0)}var V=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return i.a(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=function(e){var t=H++;return Y[t]=!0,W.then((function(){return B(t)&&e()})),t}(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(B(n),t.scheduled=void 0)},t}(v),$=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.a(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(b))(V),G=$,z=new b(v),q=z,J=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return i.a(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(v),K=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.a(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(b))(J),Q=K,X=function(e){function t(t,n){void 0===t&&(t=Z),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return i.a(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(b),Z=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return i.a(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(v),ee=n(62);function te(){}var ne=n(34);function re(e){return!!e&&(e instanceof r.a||"function"==typeof e.lift&&"function"==typeof e.subscribe)}var ie=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),ae=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),oe=n(42),se=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}();function ce(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new le(e,t))}}var le=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ue(e,this.project,this.thisArg))},e}(),ue=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return i.a(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(o.a),de=n(51),he=n(17);function fe(e,t,n){if(t){if(!E(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return fe(e,n).apply(void 0,r).pipe(ce((function(e){return Object(he.a)(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var a,o=this,s={context:o,subject:a,callbackFunc:e,scheduler:n};return new r.a((function(r){if(n){var i={args:t,subscriber:r,params:s};return n.schedule(pe,0,i)}if(!a){a=new F;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a.next(e.length<=1?e[0]:e),a.complete()}]))}catch(c){Object(de.a)(a)?a.error(c):console.warn(c)}}return a.subscribe(r)}))}}function pe(e){var t=this,n=e.args,r=e.subscriber,i=e.params,a=i.callbackFunc,o=i.context,s=i.scheduler,c=i.subject;if(!c){c=i.subject=new F;try{a.apply(o,n.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.length<=1?e[0]:e;t.add(s.schedule(me,0,{value:r,subject:c}))}]))}catch(l){c.error(l)}}this.add(c.subscribe(r))}function me(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function ve(e,t,n){if(t){if(!E(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return ve(e,n).apply(void 0,r).pipe(ce((function(e){return Object(he.a)(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var a={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new r.a((function(r){var i=a.context,o=a.subject;if(n)return n.schedule(ge,0,{params:a,subscriber:r,context:i});if(!o){o=a.subject=new F;try{e.apply(i,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.shift();n?o.error(n):(o.next(e.length<=1?e[0]:e),o.complete())}]))}catch(s){Object(de.a)(o)?o.error(s):console.warn(s)}}return o.subscribe(r)}))}}function ge(e){var t=this,n=e.params,r=e.subscriber,i=e.context,a=n.callbackFunc,o=n.args,s=n.scheduler,c=n.subject;if(!c){c=n.subject=new F;try{a.apply(i,o.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.shift();if(r)t.add(s.schedule(be,0,{err:r,subject:c}));else{var i=e.length<=1?e[0]:e;t.add(s.schedule(ye,0,{value:i,subject:c}))}}]))}catch(l){this.add(s.schedule(be,0,{err:l,subject:c}))}}this.add(c.subscribe(r))}function ye(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function be(e){var t=e.err;e.subject.error(t)}var Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(o.a),_e=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return i.a(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(o.a),Ce=n(36);var we="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Ee=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Te(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var ke=n(50),Me=function(e){if(e&&"function"==typeof e[p.a])return r=e,function(e){var t=r[p.a]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(Ee(e))return k(e);if(Te(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Ce.a),e};if(e&&"function"==typeof e[we])return t=e,function(e){for(var n=t[we]();;){var r=void 0;try{r=n.next()}catch(i){return e.error(i),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,i=Object(ke.a)(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function De(e,t,n,i,a){if(void 0===a&&(a=new _e(e,n,i)),!a.closed)return t instanceof r.a?t.subscribe(a):Me(t)(a)}var xe={};function Re(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=void 0,r=void 0;return E(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Object(he.a)(e[0])&&(e=e[0]),D(e,r).lift(new Oe(n))}var Oe=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ie(e,this.resultSelector))},e}(),Ie=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return i.a(t,e),t.prototype._next=function(e){this.values.push(xe),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(De(this,r,void 0,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=this.values,i=r[n],a=this.toRespond?i===xe?--this.toRespond:this.toRespond:0;r[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(Se);function Pe(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[p.a]}(e))return function(e,t){return new r.a((function(n){var r=new s.a;return r.add(t.schedule((function(){var i=e[p.a]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(Te(e))return function(e,t){return new r.a((function(n){var r=new s.a;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(Ee(e))return M(e,t);if(function(e){return e&&"function"==typeof e[we]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new r.a((function(n){var r,i=new s.a;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[we](),i.add(t.schedule((function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(a){return void n.error(a)}t?n.complete():(n.next(e),this.schedule())}})))}))),i}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function Ae(e,t){return t?Pe(e,t):e instanceof r.a?e:new r.a(Me(e))}var Le=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return i.a(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(o.a),Ne=(o.a,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.a(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(o.a));function je(e,t){if(!t.closed)return e instanceof r.a?e.subscribe(t):Me(e)(t)}function Ue(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(Ue((function(n,r){return Ae(e(n,r)).pipe(ce((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new Fe(e,n))})}o.a;var Fe=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new He(e,this.project,this.concurrent))},e}(),He=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return i.a(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new Le(this),n=this.destination;n.add(t);var r=je(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(Ne);function We(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),Ue(ne.a,e)}function Ye(){return We(1)}function Be(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ye()(x.apply(void 0,e))}function Ve(e){return new r.a((function(t){var n;try{n=e()}catch(r){return void t.error(r)}return(n?Ae(n):w()).subscribe(t)}))}function $e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(Object(he.a)(n))return Ge(n,null);if(Object(ke.a)(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return Ge(r.map((function(e){return n[e]})),r)}}if("function"==typeof e[e.length-1]){var i=e.pop();return Ge(e=1===e.length&&Object(he.a)(e[0])?e[0]:e,null).pipe(ce((function(e){return i.apply(void 0,e)})))}return Ge(e,null)}function Ge(e,t){return new r.a((function(n){var r=e.length;if(0!==r)for(var i=new Array(r),a=0,o=0,s=function(s){var c=Ae(e[s]),l=!1;n.add(c.subscribe({next:function(e){l||(l=!0,o++),i[s]=e},error:function(e){return n.error(e)},complete:function(){++a!==r&&l||(o===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)s(c);else n.complete()}))}var ze=n(35);function qe(e,t,n,i){return Object(ze.a)(n)&&(i=n,n=void 0),i?qe(e,t,n).pipe(ce((function(e){return Object(he.a)(e)?i.apply(void 0,e):i(e)}))):new r.a((function(r){!function e(t,n,r,i,a){var o;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){var s=t;t.addEventListener(n,r,a),o=function(){return s.removeEventListener(n,r,a)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){var c=t;t.on(n,r),o=function(){return c.off(n,r)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){var l=t;t.addListener(n,r),o=function(){return l.removeListener(n,r)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var u=0,d=t.length;u<d;u++)e(t[u],n,r,i,a)}i.add(o)}(e,t,(function(e){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function Je(e,t,n){return n?Je(e,t).pipe(ce((function(e){return Object(he.a)(e)?n.apply(void 0,e):n(e)}))):new r.a((function(n){var r,i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{r=e(i)}catch(a){return void n.error(a)}if(Object(ze.a)(t))return function(){return t(i,r)}}))}function Ke(e,t,n,i,a){var o,s;if(1==arguments.length){var c=e;s=c.initialState,t=c.condition,n=c.iterate,o=c.resultSelector||ne.a,a=c.scheduler}else void 0===i||E(i)?(s=e,o=ne.a,a=i):(s=e,o=i);return new r.a((function(e){var r=s;if(a)return a.schedule(Qe,0,{subscriber:e,iterate:n,condition:t,resultSelector:o,state:r});for(;;){if(t){var i=void 0;try{i=t(r)}catch(l){return void e.error(l)}if(!i){e.complete();break}}var c=void 0;try{c=o(r)}catch(l){return void e.error(l)}if(e.next(c),e.closed)break;try{r=n(r)}catch(l){return void e.error(l)}}}))}function Qe(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(a){return void t.error(a)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(a){return void t.error(a)}if(!r)return void t.complete();if(t.closed)return}var i;try{i=e.resultSelector(e.state)}catch(a){return void t.error(a)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function Xe(e,t,n){return void 0===t&&(t=C),void 0===n&&(n=C),Ve((function(){return e()?t:n}))}function Ze(e){return!Object(he.a)(e)&&e-parseFloat(e)+1>=0}function et(e,t){return void 0===e&&(e=0),void 0===t&&(t=q),(!Ze(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=q),new r.a((function(n){return n.add(t.schedule(tt,e,{subscriber:n,counter:0,period:e})),n}))}function tt(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}function nt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,i=null,a=e[e.length-1];return E(a)?(i=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof a&&(n=e.pop()),null===i&&1===e.length&&e[0]instanceof r.a?e[0]:We(n)(D(e,i))}var rt=new r.a(te);function it(){return rt}function at(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return C;var n=e[0],i=e.slice(1);return 1===e.length&&Object(he.a)(n)?at.apply(void 0,n):new r.a((function(e){var t=function(){return e.add(at.apply(void 0,i).subscribe(e))};return Ae(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function ot(e,t){return t?new r.a((function(n){var r=Object.keys(e),i=new s.a;return i.add(t.schedule(st,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i})):new r.a((function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()}))}function st(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription,a=e.obj;if(!r.closed)if(n<t.length){var o=t[n];r.next([o,a[o]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:a}))}else r.complete()}function ct(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function lt(e,t){return function(n){return n.lift(new ut(e,t))}}var ut=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new dt(e,this.predicate,this.thisArg))},e}(),dt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return i.a(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)},t}(o.a);function ht(e,t,n){return[lt(t,n)(new r.a(Me(e))),lt(ct(t,n))(new r.a(Me(e)))]}function ft(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Object(he.a)(e[0]))return e[0];e=e[0]}return D(e,void 0).lift(new pt)}var pt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new mt(e))},e}(),mt=function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return i.a(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=De(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){this.hasFirst=!0;for(var r=0;r<this.subscriptions.length;r++)if(r!==n){var i=this.subscriptions[r];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(t)},t}(Se);function vt(e,t,n){return void 0===e&&(e=0),new r.a((function(r){void 0===t&&(t=e,e=0);var i=0,a=e;if(n)return n.schedule(gt,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(a++),r.closed)break}}))}function gt(e){var t=e.start,n=e.index,r=e.count,i=e.subscriber;n>=r?i.complete():(i.next(t),i.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function yt(e,t,n){void 0===e&&(e=0);var i=-1;return Ze(t)?i=Number(t)<1?1:Number(t):E(t)&&(n=t),E(n)||(n=q),new r.a((function(t){var r=Ze(e)?e:+e-n.now();return n.schedule(bt,r,{index:0,period:i,subscriber:t})}))}function bt(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function St(e,t){return new r.a((function(n){var r,i;try{r=e()}catch(o){return void n.error(o)}try{i=t(r)}catch(o){return void n.error(o)}var a=(i?Ae(i):C).subscribe(n);return function(){a.unsubscribe(),r&&r.unsubscribe()}}))}function _t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),D(e,void 0).lift(new Ct(n))}var Ct=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new wt(e,this.resultSelector))},e}(),wt=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.resultSelector=n,i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:void 0,i}return i.a(t,e),t.prototype._next=function(e){var t=this.iterators;Object(he.a)(e)?t.push(new Tt(e)):"function"==typeof e[we]?t.push(new Et(e[we]())):t.push(new kt(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++)if("function"==typeof(o=e[r]).hasValue&&!o.hasValue())return;var i=!1,a=[];for(r=0;r<t;r++){var o,s=(o=e[r]).next();if(o.hasCompleted()&&(i=!0),s.done)return void n.complete();a.push(s.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),i&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(o.a),Et=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return Boolean(e&&e.done)},e}(),Tt=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[we]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),kt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return i.a(t,e),t.prototype[we]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return je(this.observable,new Le(this))},t}(Ne),Mt=n(21);n.d(t,"Observable",(function(){return r.a})),n.d(t,"ConnectableObservable",(function(){return u})),n.d(t,"GroupedObservable",(function(){return h})),n.d(t,"observable",(function(){return p.a})),n.d(t,"Subject",(function(){return a.a})),n.d(t,"BehaviorSubject",(function(){return m.a})),n.d(t,"ReplaySubject",(function(){return j})),n.d(t,"AsyncSubject",(function(){return F})),n.d(t,"asap",(function(){return G})),n.d(t,"asapScheduler",(function(){return $})),n.d(t,"async",(function(){return q})),n.d(t,"asyncScheduler",(function(){return z})),n.d(t,"queue",(function(){return _})),n.d(t,"queueScheduler",(function(){return S})),n.d(t,"animationFrame",(function(){return Q})),n.d(t,"animationFrameScheduler",(function(){return K})),n.d(t,"VirtualTimeScheduler",(function(){return X})),n.d(t,"VirtualAction",(function(){return Z})),n.d(t,"Scheduler",(function(){return y})),n.d(t,"Subscription",(function(){return s.a})),n.d(t,"Subscriber",(function(){return o.a})),n.d(t,"Notification",(function(){return I})),n.d(t,"NotificationKind",(function(){return T})),n.d(t,"pipe",(function(){return ee.a})),n.d(t,"noop",(function(){return te})),n.d(t,"identity",(function(){return ne.a})),n.d(t,"isObservable",(function(){return re})),n.d(t,"ArgumentOutOfRangeError",(function(){return ie})),n.d(t,"EmptyError",(function(){return ae})),n.d(t,"ObjectUnsubscribedError",(function(){return L.a})),n.d(t,"UnsubscriptionError",(function(){return oe.a})),n.d(t,"TimeoutError",(function(){return se})),n.d(t,"bindCallback",(function(){return fe})),n.d(t,"bindNodeCallback",(function(){return ve})),n.d(t,"combineLatest",(function(){return Re})),n.d(t,"concat",(function(){return Be})),n.d(t,"defer",(function(){return Ve})),n.d(t,"empty",(function(){return w})),n.d(t,"forkJoin",(function(){return $e})),n.d(t,"from",(function(){return Ae})),n.d(t,"fromEvent",(function(){return qe})),n.d(t,"fromEventPattern",(function(){return Je})),n.d(t,"generate",(function(){return Ke})),n.d(t,"iif",(function(){return Xe})),n.d(t,"interval",(function(){return et})),n.d(t,"merge",(function(){return nt})),n.d(t,"never",(function(){return it})),n.d(t,"of",(function(){return x})),n.d(t,"onErrorResumeNext",(function(){return at})),n.d(t,"pairs",(function(){return ot})),n.d(t,"partition",(function(){return ht})),n.d(t,"race",(function(){return ft})),n.d(t,"range",(function(){return vt})),n.d(t,"throwError",(function(){return R})),n.d(t,"timer",(function(){return yt})),n.d(t,"using",(function(){return St})),n.d(t,"zip",(function(){return _t})),n.d(t,"scheduled",(function(){return Pe})),n.d(t,"EMPTY",(function(){return C})),n.d(t,"NEVER",(function(){return rt})),n.d(t,"config",(function(){return Mt.a}))},function(e,t,n){n.d(t,"a",(function(){return u}));var r=n(7),i=n(35),a=n(53),o=n(13),s=n(41),c=n(21),l=n(36),u=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=a.a;break;case 1:if(!n){o.destination=a.a;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new d(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new d(o,n,r,i)}return o}return r.a(t,e),t.prototype[s.a]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(o.a),d=function(e){function t(t,n,r,o){var s,c=e.call(this)||this;c._parentSubscriber=t;var l=c;return Object(i.a)(n)?s=n:n&&(s=n.next,r=n.error,o=n.complete,n!==a.a&&(l=Object.create(n),Object(i.a)(l.unsubscribe)&&c.add(l.unsubscribe.bind(l)),l.unsubscribe=c.unsubscribe.bind(c))),c._context=l,c._next=s,c._error=r,c._complete=o,c}return r.a(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;c.a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=c.a.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Object(l.a)(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Object(l.a)(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};c.a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),c.a.useDeprecatedSynchronousErrorHandling)throw n;Object(l.a)(n)}},t.prototype.__tryOrSetError=function(e,t,n){if(!c.a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return c.a.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(Object(l.a)(r),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(u)},function(e,t,n){var r;e.exports=r=r||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},i=r.lib={},a=i.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var a=0;a<i;a++){var o=n[a>>>2]>>>24-a%4*8&255;t[r+a>>>2]|=o<<24-(r+a)%4*8}else for(a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],i=function(t){t=t;var n=987654321,r=4294967295;return function(){var i=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},a=0;a<t;a+=4){var s=i(4294967296*(n||e.random()));n=987654071*s(),r.push(4294967296*s()|0)}return new o.init(r,t)}}),s=r.enc={},c=s.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var a=t[i>>>2]>>>24-i%4*8&255;r.push((a>>>4).toString(16)),r.push((15&a).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},l=s.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var a=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(a))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},u=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,l=e.min(4*c,i);if(c){for(var u=0;u<c;u+=a)this._doProcessBlock(r,u);var d=r.splice(0,c);n.sigBytes-=l}return new o.init(d,l)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(i.Hasher=d.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math)},function(e,t,n){n.d(t,"a",(function(){return s}));var r=n(17),i=n(50),a=n(35),o=n(42),s=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this._parentOrParents,s=this._ctorUnsubscribe,l=this._unsubscribe,u=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var d=0;d<n.length;++d)n[d].remove(this);if(Object(a.a)(l)){s&&(this._unsubscribe=void 0);try{l.call(this)}catch(p){t=p instanceof o.a?c(p.errors):[p]}}if(Object(r.a)(u)){d=-1;for(var h=u.length;++d<h;){var f=u[d];if(Object(i.a)(f))try{f.unsubscribe()}catch(p){t=t||[],p instanceof o.a?t=t.concat(c(p.errors)):t.push(p)}}}if(t)throw new o.a(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var a=this._subscriptions;return null===a?this._subscriptions=[n]:a.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=((t=new e).closed=!0,t),e}();function c(e){return e.reduce((function(e,t){return e.concat(t instanceof o.a?t.errors:t)}),[])}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e)return null;if(config&&config.debug)return e;var t="";return 0===e.indexOf("+")&&(t="+"),t=e.length>4?t+"*".repeat(e.length-4-t.length)+e.slice(e.length-4):e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=function(){function e(){var t=this;S(this,e),this.colors={trace:"blue",debug:"gray",info:"teal",log:"teal",warn:"red",error:"red",webrtc:"green"},this.logsBuffer=[],this.enableConsoleLog=!1,this.desktopMode=!1,window.LoggerService=this,this.computeConsoleStatus(),r.default.subscribeUpdateEvent("SETTINGS_UPDATED",(function(){t.computeConsoleStatus()}));var n=navigator.userAgent.toLowerCase();this.desktopMode=n.indexOf("qtwebengine")>-1||n.indexOf("electron/")>-1}return C(e,[{key:"computeConsoleStatus",value:function(){"true"===r.default.getSetting("forceConsoleLog")?this.enableConsoleLog=!0:this.enableConsoleLog=window.config&&window.config.consoleLog||!1}},{key:"error",value:function(e){this.logger("error",e)}},{key:"warn",value:function(e){this.logger("warn",e)}},{key:"info",value:function(e){this.logger("info",e)}},{key:"log",value:function(e){this.logger("log",e)}},{key:"debug",value:function(e){this.logger("debug",e)}},{key:"getLogs",value:function(){return this.logsBuffer}},{key:"logger",value:function(e,t){if(this.desktopMode)console[e]("".concat(e.toUpperCase()," ").concat(t));else{var n=6e4*(new Date).getTimezoneOffset(),r="".concat(new Date(Date.now()-n).toISOString().slice(0,-1)," ").concat(e.toUpperCase()," ").concat(t);this.enableConsoleLog&&console[e]("%c "+r,"color:"+this.colors[e]),6e3===this.logsBuffer.length&&this.logsBuffer.shift(),this.logsBuffer.push(r+"\n")}}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.loggerService||(t.rainbow.loggerService=new e),t.rainbow.loggerService}}]),e}();t.LoggerService=i,t.default=i.getInstance()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(222),a=function(){function e(t,n,i,a,o,s,c){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,m=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,v=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null,g=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null,y=arguments.length>16&&void 0!==arguments[16]?arguments[16]:null;S(this,e),this.urgencyAck=!1,this.urgencyHandler=null,this.translatedText=null,this.historyIndex=null,this.fileErrorMsg=null,this.attachedMsgId=null,this.forwardedMsg=null,this.id=t,this.type=n,this.date=i,this.from=a,this.side=o;var b=emojione?emojione.toShort:function(e){return e};this.data=b(s),this.status=c,this.fileId=l,this.isMarkdown=u,this.additionalContent=d,this.subject=h,this.fileName=f,this.answeredMsgId=p,this.answeredMsgDate=m,this.geoloc=v,this.alternativeContent=g,this.mentions=y,this.receiptStatus=e.ReceiptStatus.NONE,this.serverAckTimer=null,this.index=null,this.showCorrectedMessages=!1,this.replaceMsgs=[],this.rxSubject=new r.Subject,this.isMerged=!1}return C(e,[{key:"sendUpdateEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.rxSubject.next(e)}},{key:"listenUpdateEvent",value:function(e){return this.rxSubject.subscribe(e)}},{key:"isTextModified",value:function(){return this.replaceMsgs.length>0}},{key:"isModified",value:function(){return this.replaceMsgs.length>0&&""!==this.getLastTextModified()}},{key:"isDeleted",value:function(){return 0===this.getLastTextModified().length}},{key:"getLastTextModified",value:function(){return this.replaceMsgs.length>0?this.replaceMsgs[this.replaceMsgs.length-1].body:this.data}},{key:"addReplaceMsg",value:function(e,t){var n=i.ReplaceMsg.create(e,t);this.replaceMsgs.push(n)}},{key:"setReceiptStatus",value:function(t){return this.serverAckTimer&&t>e.ReceiptStatus.IN_PROGRESS&&(clearTimeout(this.serverAckTimer),this.serverAckTimer=null),t>this.receiptStatus&&(this.receiptStatus=t),this.sendUpdateEvent(),this}},{key:"getInfoForLogs",value:function(){var e=this.data.length?this.data.substr(0,1)+"***"+this.data.substr(this.data.length-1):"";return"Id "+this.id+", type "+this.type.value+", side "+this.side+", date "+this.date+" and data "+e}}],[{key:"create",value:function(t,n,r,i,a,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,p=c&&c["form/json"]?e.Type.FORM:e.Type.CHAT;return new e(t,p,n,r,i,a,o,null,s,c,l,null,u,d,null,h,f)}},{key:"createFromMsg",value:function(t){var n=e.create(t.id,t.date,t.from,t.side,t.data,t.status,t.isMarkdown);return t.fileId&&(n.type=e.Type.FS,n.fileId=t.fileId,n.fileName=t.fileName),t.geoloc&&(n.geoloc=t.geoloc),n}},{key:"createFileSharingMessage",value:function(t,n,r,i,a,o,s,c,l,u){var d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,h=new e(t,e.Type.FS,n,r,i,a,o,s,null,null,null,c,null,null,u,null,d);return l&&(h.attachedMsgId=l.attachedMsgId,h.attachIndex=l.index,h.attachNumber=l.number),h}},{key:"createFileMessage",value:function(t,n,r,i,a,o){return new e(t,e.Type.FILE,n,r,i,a,o)}},{key:"createWebRTCMessage",value:function(t,n,r,i,a,o){return new e(t,e.Type.WEBRTC,n,r,i,a,o)}},{key:"createBubbleAdminMessage",value:function(t,n,r,i){return new e(t,e.Type.CHAT,n,r,e.Side.ADMIN,i+"MsgRoom",null)}},{key:"createRecordingAdminMessage",value:function(t,n,r,i,a){return new e(t,e.Type.RECORDING,n,r,e.Side.ADMIN,a+"Recording",null)}}]),e}();a.Type={CHAT:{key:0,value:"Chat"},FILE:{key:1,value:"File"},FS:{key:2,value:"FileSharing"},WEBRTC:{key:4,value:"WebRTC CAll"},RECORDING:{key:5,value:"Recording"},FORM:{key:6,value:"FORM"},FORWARD:{key:7,value:"FORWARD"}},a.ReceiptStatus={NONE:0,ERROR:1,IN_PROGRESS:2,SENT:3,UNREAD:4,READ:5},a.ReceiptStatusText=["close","error--filled","calllog","check","done","read"],a.Side={LEFT:"L",RIGHT:"R",ADMIN:"ADMIN"},t.Message=a,t.AnswerMessage=function(){return function e(t,n,r){S(this,e),this.name=t,this.messageAnswered=n,this.answeredMessageData=r}}()},function(e,t,n){n.d(t,"a",(function(){return r}));var r=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,n){var r;e.exports=(r=n(12),n(61),n(277),n(278),n(46),n(47),n(72),n(217),n(279),n(218),n(280),n(281),n(282),n(73),n(283),n(40),n(20),n(284),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),r)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(t){var n=this;S(this,e),this.logo=null,this.nameForLogs="",this.banner=null,this.office365ScopesGranted=[],this.visibility="public",e.attributes.forEach((function(e){void 0!==t[e.name]?n[e.name]=t[e.name]:void 0!==e.defaultValue&&(n[e.name]=e.defaultValue)})),this.state=t.state?t.state:"USA"===t.country?"AL":"CAN"===t.country?"AB":null,this.name&&(this.filterName=this.name.toLowerCase()),this.rxSubject=new r.Subject}return C(e,[{key:"updateFromData",value:function(t){var n=this;e.attributes.forEach((function(e){void 0!==t[e.name]&&(n[e.name]=t[e.name])}))}},{key:"getNameForLogs",value:function(){return!this.nameForLogs&&this.name&&(this.nameForLogs=this.name.charAt(0)+this.name.replace(/[^\s](?=.{1,}$)/g,"*").substr(1)),this.nameForLogs}},{key:"isActive",value:function(){return"active"===this.status}},{key:"isInitializing",value:function(){return"initializing"===this.status}},{key:"isInvited",value:function(){return"invited"===this.status}},{key:"isFreemium",value:function(){return"freemium"===this.offerType}},{key:"isPremium",value:function(){return"premium"===this.offerType}},{key:"isVAD",value:function(){return this.isBP&&"VAD"===this.bpType}},{key:"isIR",value:function(){return this.isBP&&"IR"===this.bpType}},{key:"isDR",value:function(){return this.isBP&&"DR"===this.bpType}},{key:"isEC",value:function(){return!this.isBP}},{key:"onChange",value:function(e){return this.rxSubject.subscribe(e)}},{key:"sendChangeEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next({type:e,value:t})}}],[{key:"create",value:function(t,n){return new e({id:t,name:n})}},{key:"createFromData",value:function(t){return new e(t)}},{key:"prune",value:function(e,t){var n=Object.assign({},e);return delete n.dataLocation,delete n.businessSpecific,delete n.giphyEnabled,n.isBP||(delete n.bpType,delete n.bpBusinessModel,delete n.bpApplicantNumber,delete n.bpCRDid,delete n.bpHasRightToSell,delete n.bpHasRightToConnect,delete n.bpIsContractAccepted),""===n.economicActivityClassification&&delete n.economicActivityClassification,t&&(t.isSuperadmin()||t.isBPAdminFinance())||(delete n.bpType,delete n.adminHasRightToUpdateSubscriptions,delete n.adminAllowedUpdateSubscriptionsOps),t&&t.isSuperadmin()||delete n.superadminComment,t&&(t.isSuperadmin()||null!==n.supportEmail&&""!==n.supportEmail)||delete n.supportEmail,t&&(t.isSuperadmin()||null!==n.privateDC&&""!==n.privateDC)||delete n.privateDC,n}}]),e}();i.StatusValues=["initializing","active","alerting","hold","terminated"],i.VisibilityValuesWithOrganization=["public","private","organization","closed","isolated"],i.VisibilityValues=["public","private","closed","isolated"],i.SizeValues=["self-employed","1-10 employees","11-50 employees","51-200 employees","201-500 employees","501-1000 employees","1001-5000 employees","5001-10,000 employees","10,001+ employees"],i.OfferTypes=["freemium","premium"],i.BPTypes=["VAD","DR","IR"],i.BPTypeLabels={IR:"Indirect Reseller",VAD:"Value Added Distributor",DR:"Direct Reseller"},i.BPBusinessModels=["resell"],i.BPBusinessModelLabels={resell:"Resell",referral:"Referral"},i.adminAllowedUpdateSubscriptionsOperations=["all","increase_only"],i.BPBusinessTypes={DEFAULT:"default",VOICE_BY_ALE:"voice_by_ale",VOICE_BY_PARTNER:"voice_by_partner",CONFERENCE:"conference"},i.EconomicActivityClassificationTypes={NONE:"notDefined-f",A:"agriculture",B:"mining",C:"manufacturing",D:"electricity",E:"water supply",F:"construction",G:"wholesale",H:"transportation",I:"accommodation",J:"information and communication",K:"financial",L:"real estate activities",M:"professional",N:"administrative",O:"public administration",P:"education",Q:"human health",R:"arts",S:"other service activities",T:"activities of households as employer",U:"activities of extraterritorial organisations and bodies"},i.PrivateDCValues=["HDS"],i.attributes=[{name:"id",defaultValue:void 0},{name:"name",defaultValue:""},{name:"creationDate",defaultValue:void 0},{name:"companyContactId",defaultValue:void 0},{name:"adminEmail",defaultValue:""},{name:"supportEmail",defaultValue:void 0},{name:"status",defaultValue:"active"},{name:"economicActivityClassification",defaultValue:"NONE"},{name:"website",defaultValue:void 0},{name:"description",defaultValue:void 0},{name:"visibility",defaultValue:"private"},{name:"visibleBy",defaultValue:[]},{name:"organisationId",defaultValue:""},{name:"userSelfRegisterEnabled",defaultValue:!1},{name:"userSelfRegisterAllowedDomains",defaultValue:[]},{name:"offerType",defaultValue:"freemium"},{name:"street",defaultValue:void 0},{name:"city",defaultValue:void 0},{name:"postalCode",defaultValue:void 0},{name:"country",defaultValue:void 0},{name:"state",defaultValue:null},{name:"size",defaultValue:void 0},{name:"slogan",defaultValue:void 0},{name:"isBP",defaultValue:!1},{name:"bpType",defaultValue:void 0},{name:"bpBusinessModel",defaultValue:void 0},{name:"bpApplicantNumber",defaultValue:void 0},{name:"bpCRDid",defaultValue:void 0},{name:"bpHasRightToSell",defaultValue:void 0},{name:"bpId",defaultValue:void 0},{name:"bpHasRightToConnect",defaultValue:void 0},{name:"adminHasRightToUpdateSubscriptions",defaultValue:!1},{name:"adminAllowedUpdateSubscriptionsOps",defaultValue:"all"},{name:"externalReference",defaultValue:void 0},{name:"externalReference2",defaultValue:void 0},{name:"lastAvatarUpdateDate",defaultValue:null},{name:"lastBannerUpdateDate",defaultValue:null},{name:"avatarShape",defaultValue:"circle"},{name:"catalogId",defaultValue:void 0},{name:"office365Tenant",defaultValue:void 0},{name:"office365ScopesGranted",defaultValue:void 0},{name:"isCentrex",defaultValue:void 0},{name:"tenantCallNumber",defaultValue:void 0},{name:"tenantName",defaultValue:void 0},{name:"numberUsers",defaultValue:void 0},{name:"dataLocation",defaultValue:void 0},{name:"privateDC",defaultValue:void 0},{name:"businessSpecific",defaultValue:void 0},{name:"superadminComment",defaultValue:void 0},{name:"bpBusinessType",defaultValue:[]},{name:"voIPSettings",defaultValue:void 0},{name:"allowUsersSelectTheme",defaultValue:!0},{name:"allowUsersSelectPublicTheme",defaultValue:!0},{name:"selectedTheme",defaultValue:void 0},{name:"tryNewUiCustomisation",defaultValue:void 0},{name:"softphoneOnlyCustomisation",defaultValue:void 0},{name:"fileSharingCustomisation",defaultValue:"enabled"},{name:"userTitleNameCustomisation",defaultValue:void 0},{name:"useRoomCustomisation",defaultValue:"enabled"},{name:"phoneMeetingCustomisation",defaultValue:"enabled"},{name:"useChannelCustomisation",defaultValue:"enabled"},{name:"useWebRTCVideoCustomisation",defaultValue:"enabled"},{name:"useWebRTCAudioCustomisation",defaultValue:"enabled"},{name:"instantMessagesCustomisation",defaultValue:"enabled"},{name:"userProfileCustomisation",defaultValue:"enabled"},{name:"fileStorageCustomisation",defaultValue:"enabled"},{name:"overridePresenceCustomisation",defaultValue:"enabled"},{name:"changeSettingsCustomisation",defaultValue:"enabled"},{name:"changeTelephonyCustomisation",defaultValue:"enabled"},{name:"recordingConversationCustomisation",defaultValue:"enabled"},{name:"useGifCustomisation",defaultValue:"enabled"},{name:"useDialOutCustomisation",defaultValue:"enabled"},{name:"selectedAppCustomisationTemplate",defaultValue:void 0},{name:"mobilePermanentConnectionMode",defaultValue:void 0},{name:"allowCloudPbxRecording",defaultValue:void 0},{name:"defaultLicenseGroup",defaultValue:void 0}],t.Company=i},function(e,t,n){var r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,b,S,_;e.exports=(r=n(12),n(40),void(r.lib.Cipher||(i=r,a=i.lib,o=a.Base,s=a.WordArray,c=a.BufferedBlockAlgorithm,l=i.enc,l.Utf8,u=l.Base64,d=i.algo.EvpKDF,h=a.Cipher=c.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?_:b}return function(t){return{encrypt:function(n,r,i){return e(r).encrypt(t,n,r,i)},decrypt:function(n,r,i){return e(r).decrypt(t,n,r,i)}}}}()}),a.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),f=i.mode={},p=a.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),m=f.CBC=function(){var e=p.extend();function t(e,t,n){var r=this._iv;if(r){var i=r;this._iv=void 0}else i=this._prevBlock;for(var a=0;a<n;a++)e[t+a]^=i[a]}return e.Encryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize;t.call(this,e,n,i),r.encryptBlock(e,n),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize,a=e.slice(n,n+i);r.decryptBlock(e,n),t.call(this,e,n,i),this._prevBlock=a}}),e}(),v=(i.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,i=r<<24|r<<16|r<<8|r,a=[],o=0;o<r;o+=4)a.push(i);var c=s.create(a,r);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},a.BlockCipher=h.extend({cfg:h.cfg.extend({mode:m,padding:v}),reset:function(){h.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=n.createEncryptor;else r=n.createDecryptor,this._minBufferSize=1;this._mode&&this._mode.__creator==r?this._mode.init(this,t&&t.words):(this._mode=r.call(n,this,t&&t.words),this._mode.__creator=r)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4}),g=a.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=(i.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var r=s.create([1398893684,1701076831]).concat(n).concat(t);else r=t;return r.toString(u)},parse:function(e){var t=u.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var r=s.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return g.create({ciphertext:t,salt:r})}},b=a.SerializableCipher=o.extend({cfg:o.extend({format:y}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r),a=i.finalize(t),o=i.cfg;return g.create({ciphertext:a,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),S=(i.kdf={}).OpenSSL={execute:function(e,t,n,r){r||(r=s.random(8));var i=d.create({keySize:t+n}).compute(e,r),a=s.create(i.words.slice(t),4*n);return i.sigBytes=4*t,g.create({key:i,iv:a,salt:r})}},_=a.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:S}),encrypt:function(e,t,n,r){var i=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize);r.iv=i.iv;var a=b.encrypt.call(this,e,t,i.key,r);return a.mixIn(i),a},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var i=r.kdf.execute(n,e.keySize,e.ivSize,t.salt);return r.iv=i.iv,b.decrypt.call(this,e,t,i.key,r)}}))))},function(e,t,n){n.d(t,"a",(function(){return i}));var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack,r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=new(function(){function e(){S(this,e)}return C(e,[{key:"dispatchEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;document.dispatchEvent(new CustomEvent(e,{detail:t}))}}]),e}());t.eventsService=r},function(e,t,n){n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return d}));var r=n(7),i=n(8),a=n(11),o=n(13),s=n(30),c=n(63),l=n(41),u=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return r.a(t,e),t}(a.a),d=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r.a(t,e),t.prototype[l.a]=function(){return new u(this)},t.prototype.lift=function(e){var t=new h(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new s.a;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new s.a;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new s.a;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new s.a;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new s.a;return this.hasError?(e.error(this.thrownError),o.a.EMPTY):this.isStopped?(e.complete(),o.a.EMPTY):(this.observers.push(e),new c.a(this,e))},t.prototype.asObservable=function(){var e=new i.a;return e.source=this,e},t.create=function(e,t){return new h(e,t)},t}(i.a),h=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return r.a(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):o.a.EMPTY},t}(d)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n){S(this,e),this.name=null,this.data=null,this.name=t,this.data=n}return C(e,null,[{key:"create",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new e(t,n)}}]),e}();t.RBEvent=r},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(54),a=n(71),o=n(10),s=n(330),c=n(75),l=n(15),u=n(1),d=n(2),h=n(32),f=n(37),p=function(){function e(){S(this,e),this.started=!1,this.listeners=[],this.currentOrder="date",this.voiceMessageFileDescriptors=[],this.fileDescriptors=[],this.receivedFileDescriptors=[],this.mergedFileDescriptors=[],this.contactService=u.default,this.logger=l.default,this.errorHelperService=f.default,this.eventService=h.default,this.deleteFileWoConfirm=!1,this.fileDescriptorsSubject=null,this.publicFileDownload=[],this.publicFileDownloadSubject=null,this.startedSubject=new o.BehaviorSubject(!1),this.retrieveFileDescriptorPromises=[],this.authService=d.default}return C(e,[{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.started=!1,this.portalURL=config.restServerUrl+"/api/rainbow/filestorage/v1.0/files",this.fileDescriptors=[],this.receivedFileDescriptors=[],this.mergedFileDescriptors=[],this.voiceMessageFileDescriptors=[],this.fileDescriptorsSubject=new o.Subject,this.publicFileDownload=[],this.publicFileDownloadSubject=new o.Subject,this.contactService.userContact.fileStorageEnabledSubject.pipe(c.distinctUntilChanged()).subscribe((function(e){return r(t,void 0,void 0,b.a.mark((function t(){var n=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=18;break}return this.logger.info("[FileStorageService] === STARTING ==="),t.prev=2,this.consumptionData={},t.next=6,this.getFileDescriptorsFromServer();case 6:this.started=!0,this.logger.info("[FileStorageService] === STARTED ==="),this.startedSubject.next(!0),this.contactService.userContact.fileStorageEnabledSubject.pipe(c.distinctUntilChanged()).subscribe((function(e){e||n.stop()})),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),this.logger.error("[FileStorageService] === STARTING === failure -- "+t.t0.message),this.startedSubject.next(!1);case 15:this.retrieveUserConsumption(),this.retrieveVoiceMessageFileDescriptorsListPerOwner().then((function(){n.logger.info("[FileStorageService] === STARTED (retrieveVoiceMessageFileDescriptorsListPerOwner)")})).catch((function(){n.logger.error("[FileStorageService] === STARTING === failure -- (retrieveVoiceMessageFileDescriptorsListPerOwner)")})),this.listeners.push(this.eventService.subscribe("ROOM_UPDATE_EVENT",(function(e,t,r){r&&"remove"===r&&(n.logger.info("[FileStorageService] ROOM_UPDATE_EVENT REMOVED for roomId="+t.dbId),n.removeRoomFileViewer(t))}))),t.next=19;break;case 18:this.logger.info("start skipped - fileStorageEnabled : false");case 19:case"end":return t.stop()}}),t,this,[[2,12]])})))}));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("[FileStorageService] === STOPPING ==="),this.started&&(this.started=!1),this.listeners&&this.listeners.forEach((function(e){e()})),this.logger.info("[FileStorageService] === STOPPED ==="),this.startedSubject.next(!1);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"reinit",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.fileStorageEnabled){t.next=4;break}this.logger.info("reinit skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled),t.next=10;break;case 4:if(!e){t.next=9;break}return t.next=7,this.reinitInternal();case 7:t.next=10;break;case 9:this.reinitInternal();case 10:case"end":return t.stop()}}),t,this)})))}},{key:"reinitInternal",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.retrieveFileDescriptorsListPerOwner();case 3:return e.next=5,this.retrieveReceivedFiles(this.contactService.userContact.dbId);case 5:this.orderDocuments(),this.logger.info("[FileStorageService] reinitInternal done"),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),this.logger.error("[FileStorageService] reinitInternal failure -- "+e.t0.message),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,9]])})))}},{key:"removeRoomFileViewer",value:function(e){if(this.contactService&&this.contactService.userContact&&!this.contactService.userContact.fileStorageEnabled)this.logger.info("removeRoomFileViewer skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled);else{var t;this.logger.info("[FileStorageService] >removeRoomFileViewer: "+e.dbId);do{if(t=this.getFileDescriptorByViewerId(e.dbId)){var n=t.viewers.find((function(t){return t.viewerId===e.dbId}));n&&(this.logger.info("[FileStorageService] >viewer found delete it"),t.viewers.splice(t.viewers.indexOf(n),1))}}while(t)}}},{key:"getNewDocuments",value:function(e){switch(e){case"mine":return this.fileDescriptors;case"received":return this.receivedFileDescriptors;default:return this.mergedFileDescriptors}}},{key:"getDocuments",value:function(e,t){return this.currentOrder!==e&&(this.currentOrder=e,this.orderDocuments()),t?this.receivedFileDescriptors:this.fileDescriptors}},{key:"getFileDescriptorById",value:function(e){var t,n=g(this.fileDescriptors);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.id===e)return r}}catch(s){n.e(s)}finally{n.f()}var i,a=g(this.receivedFileDescriptors);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.id===e)return o}}catch(s){a.e(s)}finally{a.f()}return null}},{key:"getFileDescriptorByViewerId",value:function(e){var t,n=g(this.fileDescriptors);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,a=g(i.viewers);try{for(a.s();!(r=a.n()).done;){if(r.value.viewerId===e)return i}}catch(l){a.e(l)}finally{a.f()}}}catch(l){n.e(l)}finally{n.f()}var o,s=g(this.receivedFileDescriptors);try{for(s.s();!(o=s.n()).done;){var c=o.value;if(c.id===e)return c}}catch(l){s.e(l)}finally{s.f()}return null}},{key:"getReceivedFileDescriptorsFromConversation",value:function(e){var t=this;return e.contact?this.receivedFileDescriptors.filter((function(n){return e.contact.dbId===n.ownerId&&void 0!==n.viewers.find((function(e){return e.viewerId===t.contactService.userContact.dbId}))}))||[]:e.room&&this.receivedFileDescriptors.filter((function(n){return n.ownerId!==t.contactService.userContact.dbId&&void 0!==n.viewers.find((function(t){return t.viewerId===e.room.dbId}))}))||[]}},{key:"getReceivedFilesFromContact",value:function(e){return this.receivedFileDescriptors.filter((function(t){return t.ownerId===e}))}},{key:"getSentFilesToContact",value:function(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.fileStorageEnabled?(this.logger.info("getSentFilesToContact skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled),[]):this.fileDescriptors.filter((function(t){for(var n=0;n<t.viewers.length;n++)if(t.viewers[n].viewerId===e)return!0;return!1}))}},{key:"getReceivedFilesForRoom",value:function(e){var t=this;return this.receivedFileDescriptors.filter((function(n){for(var r=0;r<n.viewers.length;r++)if(n.viewers[r].viewerId===e&&n.ownerId!==t.contactService.userContact.dbId)return!0;return!1}))}},{key:"getConsumptionData",value:function(){return this.consumptionData}},{key:"getVoiceMessageFileDescriptorByMsgId",value:function(e){return this.voiceMessageFileDescriptors.find((function(t){return null!==t.tags&&t.tags.msgId===e}))}},{key:"createFileDescriptor",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return r(this,void 0,void 0,b.a.mark((function r(){var o,s,c,l,u,d,h,f;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o={fileName:e,extension:t,size:n,viewers:i},a&&(o.voicemessage=!0,o.encoding=!0,o.duration=a.duration),s=this.portalURL,c=this.authService.getPostHeader(),l=JSON.stringify(o),r.next=8,fetch(s,{method:"POST",headers:c,body:l});case 8:if((u=r.sent).ok){r.next=11;break}throw u;case 11:return r.next=13,u.json();case 13:return d=r.sent.data,h=this.createFileDescriptorFromData(d),r.abrupt("return",(h&&this.fileDescriptors.push(h),this.logger.info("[FileStorageService] createFileDescriptor -- "+h.id+" -- success"),this.orderDocuments(),h));case 18:return r.prev=18,r.t0=r.catch(0),r.next=22,this.errorHelperService.getErrorInfo(r.t0,"createFileDescriptor");case 22:throw 403153===(f=r.sent).error.errorDetailsCode&&(this.contactService.userContact.fileSharingEnabled=!1,this.contactService.userContact.rxSubject.next()),this.logger.error("[fileStorageService] "+f.message),f.error;case 24:case"end":return r.stop()}}),r,this,[[0,18]])})))}},{key:"createFileDescriptorFromData",value:function(e){if(e){var t=[];e.viewers&&(t=a.FileViewer.createFromData(e.viewers));var n=e.url;n||(n=config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+e.id);var r,o=e.isUploaded?"uploaded":"not_uploaded",s=e.tags&&"voicemail"===e.tags.purpose;return r=null===e.isClean?"notScanned":!0===e.isClean?"isClean":"isInfected",i.FileDescriptor.create(e.id,n,e.ownerId,e.fileName,e.extension,e.typeMIME,e.size,e.registrationDate,e.uploadedDate,e.dateToSort,t,o,e.thumbnail,e.orientation,e.original_w,e.original_h,e.tags,r,s)}return null}},{key:"deleteFileDescriptor",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"/").concat(e),r=this.authService.getRequestHeader(),t.next=5,fetch(n,{method:"DELETE",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:this.logger.info("[FileStorageService] deleteFileDescriptor -- SUCCESS"),this.deleteFileDescriptorFromCache(e),this.eventService.publish("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:e}),this.retrieveUserConsumption(),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(0),t.next=15,this.errorHelperService.getErrorInfo(t.t0,"deleteFileDescriptor");case 15:throw a=t.sent,this.logger.error("[fileStorageService] "+a.message),a.error;case 17:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"deleteAllFileDescriptor",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.portalURL+"/all",n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"DELETE",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:this.logger.info("[FileStorageService] deleteAllFileDescriptor -- success"),this.deleteAllFilesDescriptorsFromCache(),this.retrieveUserConsumption(),e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(0),e.next=15,this.errorHelperService.getErrorInfo(e.t0,"deleteAllFileDescriptor");case 15:throw i=e.sent,this.logger.error("[fileStorageService] "+i.message),i.error;case 17:case"end":return e.stop()}}),e,this,[[0,11]])})))}},{key:"getFileDescriptorsFromServer",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([this.retrieveFileDescriptorsListPerOwner(),this.retrieveReceivedFiles(this.contactService.userContact.dbId)]);case 3:this.orderDocuments(),e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:case"end":return e.stop()}}),e,this,[[0,6]])})))}},{key:"retrieveFileDescriptorsListPerOwner",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,y;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.fileDescriptors=[],t=this.portalURL+"?format=full&limit=1000",n=this.authService.getRequestHeader(),e.next=6,fetch(t,{method:"GET",headers:n});case 6:if((r=e.sent).ok){e.next=9;break}throw r;case 9:return e.next=11,r.json();case 11:if(i=e.sent,a=i.data){e.next=15;break}return e.abrupt("return",this.fileDescriptors);case 15:if(o=i.limit,s=i.total,c=null,s<=o)c=Promise.resolve([]);else{for(l=o,u=s/o,d=[],h=1;h<u;h++)d.push(this.retrieveFileDescriptorsListPerOwnerwithOffset(l,o)),l+=o;c=Promise.all(d)}return e.next=20,c;case 20:e.sent.forEach((function(e){a=a.concat(e)})),f=g(a);try{for(f.s();!(p=f.n()).done;)m=p.value,v=this.createFileDescriptorFromData(m),this.fileDescriptors.push(v)}catch(b){f.e(b)}finally{f.f()}return e.abrupt("return",(this.logger.info("[FileStorageService] retrieveFileDescriptorsListPerOwner -- success"),this.fileDescriptors));case 26:return e.prev=26,e.t0=e.catch(0),e.next=30,this.errorHelperService.getErrorInfo(e.t0,"retrieveFileDescriptorsListPerOwner");case 30:throw y=e.sent,this.logger.error("[fileStorageService] "+y.message),y.error;case 32:case"end":return e.stop()}}),e,this,[[0,26]])})))}},{key:"retrieveFileDescriptorsListPerOwnerwithOffset",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r="".concat(this.portalURL,"?format=full&limit=").concat(t,"&offset=").concat(e),i=this.authService.getRequestHeader(),n.next=4,fetch(r,{method:"GET",headers:i});case 4:if((a=n.sent).ok){n.next=7;break}throw a;case 7:return n.next=9,a.json();case 9:return n.abrupt("return",n.sent.data);case 10:case"end":return n.stop()}}),n,this)})))}},{key:"retrieveVoiceMessageFileDescriptorsListPerOwner",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,o=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.portalURL+"?format=full&path=/voice-messages",n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:return e.next=10,r.json();case 10:return i=e.sent.data,e.abrupt("return",i?(this.voiceMessageFileDescriptors=i.reduce((function(e,t){var n=o.createFileDescriptorFromData(t);return"not_uploaded"===n.state?(o.logger.info("[FileStorageService] file ".concat(n.fileName," not uploaded")),n.ownerId===o.contactService.userContact.dbId?(o.logger.info("[FileStorageService] file ".concat(n.fileName," is our property, we can delete it")),o.deleteFileDescriptor(n.id)):o.logger.info("[FileStorageService] file ".concat(n.fileName," is NOT our property, we CANNOT delete it"))):e.push(n),e}),[]),this.logger.info("[FileStorageService] retrieveVoiceMessageFileDescriptorsListPerOwner -- success"),this.voiceMessageFileDescriptors):[]);case 14:return e.prev=14,e.t0=e.catch(0),e.next=18,this.errorHelperService.getErrorInfo(e.t0,"retrieveVoiceMessageFileDescriptorsListPerOwner");case 18:throw a=e.sent,this.logger.error("[fileStorageService] "+a.message),a.error;case 20:case"end":return e.stop()}}),e,this,[[0,14]])})))}},{key:"retrieveFilesReceivedFromPeer",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r="".concat(this.portalURL,"/viewers/").concat(e,"?ownerId=").concat(t,"&format=full"),i=this.authService.getRequestHeader(),n.next=5,fetch(r,{method:"GET",headers:i});case 5:if((a=n.sent).ok){n.next=8;break}throw a;case 8:return n.next=10,a.json();case 10:return o=n.sent.data.map((function(e){return c.createFileDescriptorFromData(e)})),n.abrupt("return",(this.logger.info("[FileStorageService] retrieveFilesReceivedFromPeer success"),o));case 14:return n.prev=14,n.t0=n.catch(0),n.next=18,this.errorHelperService.getErrorInfo(n.t0,"retrieveFilesReceivedFromPeer");case 18:throw s=n.sent,this.logger.error("[fileStorageService] "+s.message),s.error;case 20:case"end":return n.stop()}}),n,this,[[0,14]])})))}},{key:"retrieveSentFiles",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,a,o,s=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[FileStorageService] >retrieveSentFiles"),n="".concat(this.portalURL,"?format=full&viewerId=").concat(e),r=this.authService.getRequestHeader(),t.next=6,fetch(n,{method:"GET",headers:r});case 6:if((a=t.sent).ok){t.next=9;break}throw a;case 9:return t.next=11,a.json();case 11:return t.abrupt("return",t.sent.data.reduce((function(e,t){var n=s.createFileDescriptorFromData(t);return n.state===i.FileState.NOT_UPLOADED?s.logger.warn("[FileStorageService] file ".concat(n.fileName," not uploaded")):e.push(n),e}),[]));case 14:return t.prev=14,t.t0=t.catch(0),t.next=18,this.errorHelperService.getErrorInfo(t.t0,"retrieveSentFiles");case 18:throw o=t.sent,this.logger.error("[fileStorageService] "+o.message),o.error;case 20:case"end":return t.stop()}}),t,this,[[0,14]])})))}},{key:"retrieveReceivedFilesForRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,o,s,c=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"/viewers/").concat(e,"?format=full"),r=this.authService.getRequestHeader(),t.next=5,fetch(n,{method:"GET",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:return t.next=10,i.json();case 10:return o=t.sent.data,t.abrupt("return",o?o.reduce((function(t,n){if(n.ownerId!==c.contactService.userContact.dbId){n.viewers=[];var r=c.createFileDescriptorFromData(n);if(!r.viewers.length){var i=a.FileViewer.createFromData([{viewerId:e,type:"room"}])[0];r.viewers.push(i)}t.push(r),c.receivedFileDescriptors.find((function(e){return e.id===n.id}))||c.receivedFileDescriptors.push(r)}return t}),[]):[]);case 14:return t.prev=14,t.t0=t.catch(0),t.next=18,this.errorHelperService.getErrorInfo(t.t0,"retrieveReceivedFilesForRoom");case 18:throw s=t.sent,this.logger.error("[fileStorageService] "+s.message),s.error;case 20:case"end":return t.stop()}}),t,this,[[0,14]])})))}},{key:"retrieveReceivedFiles",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c,l,u,d,h,f,p,m=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.receivedFileDescriptors=[],n="".concat(this.portalURL,"/viewers/").concat(e,"?format=full&limit=1000"),r=this.authService.getRequestHeader(),t.next=6,fetch(n,{method:"GET",headers:r});case 6:if((i=t.sent).ok){t.next=9;break}throw i;case 9:return t.next=11,i.json();case 11:if(a=t.sent,o=a.data){t.next=15;break}return t.abrupt("return",this.receivedFileDescriptors);case 15:if(s=a.limit,c=a.total,l=null,c<=s)l=Promise.resolve([]);else{for(u=s,d=c/s,h=[],f=1;f<d;f++)h.push(this.retrieveReceivedFilesWithOffset(e,u,s)),u+=s;l=Promise.all(h)}return t.next=20,l;case 20:return t.sent.forEach((function(e){o=o.concat(e)})),this.receivedFileDescriptors=o.reduce((function(e,t){var n=m.createFileDescriptorFromData(t);if(n.ownerId!==m.contactService.userContact.dbId){var r=m.getFileDescriptorById(n.id);r&&(n.previewBlob=r.previewBlob,n.previewBlobSubject.next(URL.createObjectURL(n.previewBlob))),e.push(n)}return e}),[]),this.logger.info("[FileStorageService] retrieveReceivedFiles -- success"),t.abrupt("return",this.receivedFileDescriptors);case 26:return t.prev=26,t.t0=t.catch(0),t.next=30,this.errorHelperService.getErrorInfo(t.t0,"retrieveReceivedFiles");case 30:throw p=t.sent,this.logger.error("[fileStorageService] "+p.message),p.error;case 32:case"end":return t.stop()}}),t,this,[[0,26]])})))}},{key:"retrieveReceivedFilesWithOffset",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,a,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i="".concat(this.portalURL,"/viewers/").concat(e,"?format=full&limit=1000&limit=").concat(n,"&offset=").concat(t),a=this.authService.getRequestHeader(),r.next=4,fetch(i,{method:"GET",headers:a});case 4:return o=r.sent,r.next=7,o.json();case 7:return r.abrupt("return",r.sent.data);case 8:case"end":return r.stop()}}),r,this)})))}},{key:"retrieveUserConsumption",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=config.restServerUrl+"/api/rainbow/filestorage/v1.0/users/consumption",n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:return e.next=10,r.json();case 10:return this.consumptionData=e.sent.data,this.logger.info("[FileStorageService] retrieveUserConsumption success"),this.eventService.publish("ON_CONSUMPTION_DATA_UPDATED_EVENT"),e.abrupt("return",this.consumptionData);case 16:return e.prev=16,e.t0=e.catch(0),e.next=20,this.errorHelperService.getErrorInfo(e.t0,"retrieveUserConsumption");case 20:throw i=e.sent,this.logger.error("[fileStorageService] "+i.message),i.error;case 22:case"end":return e.stop()}}),e,this,[[0,16]])})))}},{key:"deleteFileViewer",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r="".concat(this.portalURL,"/").concat(t,"/viewers/").concat(e),i=this.authService.getRequestHeader(),n.next=5,fetch(r,{method:"DELETE",headers:i});case 5:if((a=n.sent).ok){n.next=8;break}throw a;case 8:this.logger.info("[FileStorageService] deleteFileViewer "+a.statusText),(o=this.getFileDescriptorById(t))&&-1!==(s=o.viewers.findIndex((function(t){return t.viewerId===e})))&&o.viewers.splice(s,1),n.next=19;break;case 13:return n.prev=13,n.t0=n.catch(0),n.next=17,this.errorHelperService.getErrorInfo(n.t0,"deleteFileViewer");case 17:throw c=n.sent,this.logger.error("[fileStorageService] "+c.message),c.error;case 19:case"end":return n.stop()}}),n,this,[[0,13]])})))}},{key:"addFileViewer",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,o,s,c,l,u,d;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=this.getFileDescriptorById(e))){r.next=24;break}if(!i.isAlreadyFileViewer(t)){r.next=4;break}return r.abrupt("return",i);case 4:return r.prev=4,o="".concat(this.portalURL,"/").concat(e,"/viewers"),s=this.authService.getPostHeader(),c=JSON.stringify({viewerId:t,type:n}),r.next=10,fetch(o,{method:"POST",headers:s,body:c});case 10:if((l=r.sent).ok){r.next=13;break}throw l;case 13:return this.logger.info("[FileStorageService] addFileViewer success"),u=a.FileViewer.createFromData([{viewerId:t,type:n}])[0],r.abrupt("return",(i.viewers.push(u),i));case 18:return r.prev=18,r.t0=r.catch(4),r.next=22,this.errorHelperService.getErrorInfo(r.t0,"addFileViewer");case 22:throw d=r.sent,this.logger.error("[fileStorageService] "+d.message),d.error;case 24:return r.abrupt("return",null);case 25:case"end":return r.stop()}}),r,this,[[4,18]])})))}},{key:"copyFileToUserCloudStorage",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"/").concat(e,"/copy"),r=this.authService.getPostHeader(),t.next=5,fetch(n,{method:"POST",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:return t.next=10,i.json();case 10:return a=t.sent.data,this.logger.info("[FileStorageService] copyFileToUserCloudStorage | copyFile ".concat(e," -- success")),t.next=14,this.retrieveAndStoreOneFileDescriptor(a.id,!0);case 14:return t.abrupt("return",t.sent);case 17:return t.prev=17,t.t0=t.catch(0),t.next=21,this.errorHelperService.getErrorInfo(t.t0,"copyFileToUserCloudStorage");case 21:throw o=t.sent,this.logger.error("[fileStorageService] "+o.message),o.error;case 23:case"end":return t.stop()}}),t,this,[[0,17]])})))}},{key:"retrieveOneFileDescriptor",value:function(e){var t=this;return this.retrieveFileDescriptorPromises[e]?(this.logger.info("[FileStorageService] retrieveOneFileDescriptor for ".concat(e," already lauched")),this.retrieveFileDescriptorPromises[e]):(this.retrieveFileDescriptorPromises[e]=r(t,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[FileStorageService] retrieveOneFileDescriptor "+e),n="".concat(this.portalURL,"/").concat(e,"?format=full"),r=this.authService.getRequestHeader(),t.next=6,fetch(n,{method:"GET",headers:r});case 6:if((i=t.sent).ok){t.next=9;break}throw i;case 9:return t.next=11,i.json();case 11:return a=t.sent.data,o=this.createFileDescriptorFromData(a),t.abrupt("return",(this.logger.info("[FileStorageService] retrieveOneFileDescriptor ".concat(e," -- success")),delete this.retrieveFileDescriptorPromises[e],o));case 16:return t.prev=16,t.t0=t.catch(0),t.next=20,this.errorHelperService.getErrorInfo(t.t0,"retrieveOneFileDescriptor");case 20:throw s=t.sent,this.logger.error("[fileStorageService] "+s.message),s.error;case 22:case"end":return t.stop()}}),t,this,[[0,16]])}))),this.retrieveFileDescriptorPromises[e])}},{key:"retrieveAndStoreOneFileDescriptor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getFileDescriptorById(e);return r&&!n?(this.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- return existing fileDescriptor "+e),Promise.resolve(r)):this.retrieveOneFileDescriptor(e).then((function(e){r&&r.isImage()&&(e.previewBlob=r.previewBlob,e.previewBlobSubject.next(e.previewBlob));var n=t.fileDescriptors.find((function(t){return t.id===e.id}));n&&n.update(e);var i=t.receivedFileDescriptors.find((function(t){return t.id===e.id}));return i&&i.update(e),n||i||(e.ownerId===t.contactService.userContact.dbId?(t.fileDescriptors.push(e),t.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- fileDescriptor "+e.id+" -- now stored in my files")):(t.receivedFileDescriptors.push(e),t.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- fileDescriptor "+e.id+" -- now stored in received files")),t.fileDescriptorsSubject.next({action:"new",fd:e})),t.orderDocuments(),t.eventService.publish("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:e.id}),Promise.resolve(e)})).catch((function(e){return t.logger.warn("[FileStorageService] Error on getting FileDescriptor: "+e.errorDetailsCode),e.status>=400&&e.status<500&&r&&(404===e.status&&t.deleteFileDescriptorFromCache(r.id),t.orderDocuments(),t.logger.debug("[FileStorageService] Sending ON_FILE_REMOVED_FROM_STORE_EVENT"),t.eventService.publish("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:r.id})),Promise.reject(e)}))}},{key:"deleteFileDescriptorFromCache",value:function(e){this.logger.info("[FileStorageService] deleteFileDescriptorFromCache "+e);for(var t=0;t<this.receivedFileDescriptors.length;t++){var n=this.receivedFileDescriptors[t];if(n.id===e){this.receivedFileDescriptors.splice(t,1),n.setState(i.FileState.DELETED);break}}for(var r=0;r<this.fileDescriptors.length;r++){var a=this.fileDescriptors[r];if(a.id===e){this.fileDescriptors.splice(r,1),a.setState(i.FileState.DELETED);break}}this.orderDocuments()}},{key:"deleteAllFilesDescriptorsFromCache",value:function(){var e=this;this.logger.info("[FileStorageService] deleteAllFilesDesceiptorsFromCache"),this.fileDescriptors.forEach((function(t){t.setState(i.FileState.DELETED),e.receivedFileDescriptors.forEach((function(n,r){n.id===t.id&&e.receivedFileDescriptors.splice(r,1)}))})),this.fileDescriptors=[],this.orderDocuments(),this.fileDescriptorsSubject.next({action:"listUpdate"})}},{key:"orderDocuments",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";this.logger.debug("[FileStorageService] orderDocuments");var t=null;switch(e){case"mine":t=this.fileDescriptors;break;case"received":t=this.receivedFileDescriptors;break;default:this.mergedFileDescriptors=this.fileDescriptors.concat(this.receivedFileDescriptors),t=this.mergedFileDescriptors}switch(this.currentOrder){default:t.sort((function(e,t){return t.time-e.time}));break;case"name":t.sort((function(e,t){return e.fileName.localeCompare(t.fileName)}));break;case"size":t.sort((function(e,t){return e.size-t.size}))}}},{key:"extractFileIdFromUrl",value:function(e){var t=e.split("/");return t.pop()||t.pop()}},{key:"retrieveAndStoreOneVoiceMessageFileDescriptor",value:function(e){var t=this;this.retrieveOneFileDescriptor(e).then((function(n){if(n.tags&&"/voice-messages"===n.tags.path)if(void 0!==t.voiceMessageFileDescriptors.find((function(t){return t.id===e}))){var r=t.voiceMessageFileDescriptors.findIndex((function(e){return e.id===n.id}));r>-1&&t.voiceMessageFileDescriptors.splice(r,1,n),t.logger.info("[FileStorageService] getRetrieveAndStoreOneVoiceMessageFileDescriptor "+e+" -- success")}else t.voiceMessageFileDescriptors.push(n)}))}},{key:"deleteVoiceMessageFileDescriptor",value:function(e){this.logger.info("[FileStorageService] deleteVoiceMessageFileDescriptore "+e);var t=this.voiceMessageFileDescriptors.find((function(t){return t.id===e}));if(void 0!==t){var n=this.voiceMessageFileDescriptors.findIndex((function(e){return e.id===t.id}));n>-1&&this.voiceMessageFileDescriptors.splice(n,1)}}},{key:"getPublicFileDownloads",value:function(){return this.publicFileDownload}},{key:"clearPublicFileDownloads",value:function(){this.publicFileDownload=[]}},{key:"findPublicFileDownload",value:function(e){return this.publicFileDownload.find((function(t){return t.url===e}))}},{key:"updatePublicFileDownloadArray",value:function(e,t){var n=this;this.logger.info("[FileStorageService] >updatePublicFileDownloadArray"),e.forEach((function(e){var r=n.findPublicFileDownload(e.url);if(r)n.logger.info("[FileStorageService] file ("+e.url+") Found - to update"),r.receivedBytes=e.receivedBytes,r.savePath=e.savePath,r.isDownloadFinished()&&r.openFolderOnceDownloadFinished&&(n.logger.debug("[FileStorageService] showItemInFolder auto on download completion"),t.showItemInFolder(r.savePath)),n.logger.debug("[FileStorageService] fileName="+r.fileName),n.logger.debug("[FileStorageService] file receivedBytes="+r.receivedBytes),n.logger.debug("[FileStorageService] file totalBytes="+r.totalBytes),n.logger.debug("[FileStorageService] file savePath="+r.savePath),r.progressSubject.next();else{n.logger.info("[FileStorageService] file Not Found");var i=s.FilePublicDownload.create(e.url,e.fileName,e.totalBytes,e.receivedBytes,e.savePath);n.publicFileDownload.unshift(i)}n.publicFileDownloadSubject.next()}))}},{key:"removePublicFileDownload",value:function(e){if(e&&e.url){var t=this.publicFileDownload.indexOf(e);t>=0&&(this.publicFileDownload.splice(t,1),this.publicFileDownloadSubject.next())}}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.fileStorageService||(t.rainbow.fileStorageService=new e),t.rainbow.fileStorageService}}]),e}();t.FileStorageService=p,t.default=p.getInstance()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(15),a=function(){function e(){var t=this;S(this,e),this.appActive=!0,this.appActiveSubject=null,this.detectionInterval=180,this.detectionTimeout=null,this.onActivityListener=null,this.appConnectivitySubject=null,this.connectivityTimeout=null,this.connectivityUp=!1,this.cdn="",this.cdnImages="",this.cdnServer="";var n=window;n.moduleIds||(n.moduleIds=[]),n.config||(n.config={xmpp:{protocol:"wss",currentServer:null,port:"443",pingInterval:"60000"},webservices:{protocol:"https",currentServer:null,port:"443"}}),this.updateCDN(),this.appActiveSubject=new r.Subject,this.onActivityListener=function(){t.appActive||t.onStateChanged("active"),t.detectionTimeout&&(clearTimeout(t.detectionTimeout),t.detectionTimeout=null),window.document.removeEventListener("mousemove",t.onActivityListener),window.document.removeEventListener("keypress",t.onActivityListener),setTimeout((function(){t.startTimer()}),2e3)},this.appConnectivitySubject=new r.Subject,this.connectivityUp=navigator.onLine,window.addEventListener("offline",(function(){i.default.debug("[MainService] Connectivity change : down"),t.connectivityTimeout&&(clearInterval(t.connectivityTimeout),t.connectivityTimeout=null),t.connectivityUp&&(t.connectivityUp=!1,t.connectivityTimeout=setTimeout((function(){t.appConnectivitySubject.next(!1)}),2500))})),window.addEventListener("online",(function(){i.default.debug("[MainService] Connectivity change : up"),t.connectivityTimeout&&(clearInterval(t.connectivityTimeout),t.connectivityTimeout=null),t.connectivityUp||(t.connectivityUp=!0,t.connectivityTimeout=setTimeout((function(){t.appConnectivitySubject.next(!0)}),1e3))}))}return C(e,[{key:"configure",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i.default.info("[MainService] STARTED"),t&&t.isDesktopApp()?(t.idle.setDetectionInterval(this.detectionInterval),t.idle.onStateChanged.addListener((function(t){e.onStateChanged(t)}))):this.startTimer()}},{key:"subscribe",value:function(e){return this.appActiveSubject.subscribe(e)}},{key:"subscribeToConnectivityEvents",value:function(e){return this.appConnectivitySubject.subscribe(e)}},{key:"updateCDN",value:function(){}},{key:"onStateChanged",value:function(e){this.appActive="active"===e,this.appActiveSubject.next(this.appActive)}},{key:"startTimer",value:function(){var e=this;this.detectionTimeout&&(clearTimeout(this.detectionTimeout),this.detectionTimeout=null),this.detectionTimeout=setTimeout((function(){e.onStateChanged("idle")}),1e3*this.detectionInterval),window.document.addEventListener("mousemove",this.onActivityListener),window.document.addEventListener("keypress",this.onActivityListener)}},{key:"isDesktopApp",value:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("qtwebengine")>-1||e.indexOf("electron/")>-1}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.mainService||(t.rainbow.mainService=new e),t.rainbow.mainService}}]),e}();t.MainService=a,t.default=a.getInstance()},function(e,t,n){var r=n(310),i=n(311),a=i;a.v1=r,a.v4=i,e.exports=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SDK={OK:1,ERROR:-1,ERRORUNAUTHORIZED:-2,ERRORXMPP:-4,ERRORXMPPJID:-8,ERRORBADREQUEST:-16,ERRORUNSUPPORTED:-32,ERRORNOTFOUND:-64}},function(e,t,n){n.d(t,"a",(function(){return r}));var r="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(e,t,n){n.d(t,"a",(function(){return r}));var r=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(18),a=n(5),o=n(26),s=n(15),c=function(){function e(){S(this,e),this.userColors=["#ca8741","#e44647","#c62582","#9b4ce7","#6573ee","#1b70e0","#6ec7d9","#98d1b1","#7fbd40","#b2d334","#dcd232","#f1be00"],this.userColorNames=["purple-lavender","purple-violet","red-coral","blue-jeanlouisdavid","green-mint","green-yellow","orange-jade","pink-lady","yellow-submarine","blue-teal"]}return C(e,[{key:"getAvatarImage",value:function(e,t,n,a,s){if(!(s=void 0!==s&&s))return t?this.createDefaultAvatarImage(t,n):null;var c=config.webservices.protocol+"://"+config.webservices.currentServer;o.default.cdn&&(c=o.default.cdnServer);var l=c+"/api/avatar/"+e+"?size="+(a||256);return s&&(l+="&update="+r.MD5(i.enc.Latin1.parse(s)).toString(i.enc.Hex)),{src:l}}},{key:"getNameInformation",value:function(e,t){var n={displayName:"",initials:""};return 1!==t.length&&2!==e.length?"FL"===a.default.getSetting("displayOrder")?(n.displayName=e+" "+t,n.initials=e.charAt(0).toUpperCase()+t.charAt(0).toUpperCase()):(n.displayName=t+" "+e,n.initials=t.charAt(0).toUpperCase()+e.charAt(0).toUpperCase()):("FL"===a.default.getSetting("displayOrder")?n.displayName=e+" "+t:n.displayName=t+" "+e,n.initials=e.charAt(0).toUpperCase()+e.charAt(1).toUpperCase()),n}},{key:"createDefaultAvatarImage",value:function(e,t){var n=new Image,r=document.createElement("canvas");r.width=n.width=225,r.height=n.height=225;var i=r.getContext("2d");return i.rect(0,0,225,225),i.fillStyle=t,i.fill(),i.font="bold 100px Helvetica",i.textAlign="center",i.fillStyle="white",i.fillText(e,110,150),n.src=r.toDataURL("image/png"),n}},{key:"computeUserColor",value:function(e){var t={colorIndex:0,color:this.userColors[0],colorName:this.userColorNames[0]};try{for(var n=e.toUpperCase(),r=0,i=0;i<n.length;i++)r+=n.charCodeAt(i);t.colorIndex=r%12,t.color=this.userColors[t.colorIndex],t.colorName=this.userColorNames[t.colorIndex]}catch(a){s.default.error("[UserInfoService] computeUserColor failure"),t.colorIndex=1,t.color=this.userColors[t.colorIndex],t.colorName=this.userColorNames[t.colorIndex]}return t}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.userInfoService||(t.rainbow.userInfoService=new e),t.rainbow.userInfoService}}]),e}();t.UserInfoService=c,t.default=c.getInstance()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){S(this,e),this.$rootScope=null}return C(e,[{key:"configure",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.$rootScope=e}},{key:"subscribe",value:function(e,t){return this.$rootScope?this.$rootScope.$on(e,t):function(){}}},{key:"unsubscribe",value:function(e){e()}},{key:"publish",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.$rootScope&&(t=this.$rootScope).$broadcast.apply(t,[e].concat(r))}},{key:"publishWithApply",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.$rootScope&&this.$rootScope.$apply((function(){var n;(n=t.$rootScope).$broadcast.apply(n,[e].concat(r))}))}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.eventService||(t.rainbow.eventService=new e),t.rainbow.eventService}}]),e}();t.EventService=r,t.default=r.getInstance()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),a=n(18),o=n(226),s=n(10),c=n(76),l=n(24),u=n(74),d=n(10),f=n(5),p=n(2),v=n(26),g=n(4),y=n(6),_=n(1),w=n(25),E=n(15),T=n(38),k=n(219),M=n(32),D=n(37),x=function e(){S(this,e)};t.AbstractRoomService=x;var R=function(e){h(n,e);var t=m(n);function n(){var e;return S(this,n),(e=t.call(this)).ROOM_UPDATE_EVENT="ROOM_UPDATE_EVENT",e.ROOM_USER_UPDATE_EVENT="ROOM_USER_UPDATE_EVENT",e.ROOM_AVATAR_UPDATE_EVENT="ROOM_AVATAR_UPDATE_EVENT",e.ROOM_HISTORY_UPDATE_EVENT="ROOM_HISTORY_UPDATE_EVENT",e.ROOM_ADMIN_MESSAGE_EVENT="ROOM_ADMIN_MESSAGE_EVENT",e.ROOM_INVITATION="ROOM_INVITATION",e.ROOM_ADD_CONF_ENDPOINT_EVENT="ROOM_ADD_CONF_ENDPOINT_EVENT",e.ROOM_REMOVE_CONF_ENDPOINT_EVENT="ROOM_REMOVE_CONF_ENDPOINT_EVENT",e.ROOM_ADD_USERS_EVENT="ROOM_ADD_USERS_EVENT",e.ROOM_DELETE_USERS_EVENT="ROOM_DELETE_USERS_EVENT",e.RoomUserStatus={INVITED:"invited",ACCEPTED:"accepted",UNSUBSCRIBED:"unsubscribed",REJECTED:"rejected",DELETED:"deleted"},e.openInviteIdByRoomIdSubject=new s.Subject,e.rxSubject=new s.Subject,e.portalURL=null,e.listeners=[],e.xmppConnectionSubscription=null,e.roomPresenceWaitingList=[],e.userContact=null,e.invitationCounter=0,e.meetingInvitationCounter=0,e._rooms={},e.roomsByJids={},e.roomsInProgress={},e.updateLater={},e.maxRoomsUsers=0,e.maxRoomsStartupLoad=0,e.personalAudioRoomId="",e.currentPersonalAudioRoomId="",e.openInviteIdByRoomId={},e.getRoomByJidPromises={},e._roomTags=[],e.roomPresenceRef=null,e.roomMessageRef=null,e.roomInfoMessageRef=null,e.roomMessageConfigRef=null,e.roomHistoryInfoRef=null,e.roomNotificationRef=null,e.settingsService=f.default,e.contactService=_.default,e.profileService=y.default,e.authService=p.default,e.eventService=M.default,e.logger=E.default,e.xmppService=g.default,e.fileStorageService=w.default,e.errorHelperService=D.default,e.i18n=T.default,e}return C(n,[{key:"rooms",get:function(){return this._rooms},set:function(e){this._rooms=e}},{key:"roomTags",get:function(){return this._roomTags},set:function(e){this._roomTags=e}},{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.userContact=this.contactService.userContact,!this.userContact||this.userContact.roomsEnabled){e.next=3;break}return e.abrupt("return",void this.logger.info("[roomService] === Start skipped - roomsEnabled : false"));case 3:return this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/",this.invitationCounter=0,this.meetingInvitationCounter=0,this.rooms={},this.roomsByJids={},this.roomsInProgress={},this.updateLater={},this.maxRoomsUsers=y.default.getFeatureLimitMax(y.default.FeaturesEnum.BUBBLE_PARTICIPANT_COUNT),this.maxRoomsStartupLoad=y.default.getFeatureLimitMax(y.default.FeaturesEnum.BUBBLE_MAX_LOAD_STARTUP),this.personalAudioRoomId="",this.currentPersonalAudioRoomId="",this.openInviteIdByRoomId={},this.getRoomByJidPromises={},this.roomTags=[],this.logger.info(""),this.logger.info("[roomService] === STARTING ==="),this.attachHandlers(),e.next=22,this.getServerRooms();case 22:this.computeInvitationCounter(),this.retrieveOpenInviteData(),this.profileService.isFeatureEnabled(y.default.FeaturesEnum.CONFERENCE_ALLOWED)&&(this.retrievePersonalAudioRoom(),this.retrieveCurrentPersonalAudioRoom()),this.logger.info("[roomService] === STARTED ==="),e.next=31;break;case 28:e.prev=28,e.t0=e.catch(0),this.logger.error("[roomService] === STARTING FAILURE === "+e.t0.message),this.computeInvitationCounter(),this.reconnect();case 31:case"end":return e.stop()}}),e,this,[[0,28]])})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info(""),this.logger.info("[roomService] === STOPPING ==="),this.listeners.forEach((function(e){e()})),this.rooms={},this.roomsByJids={},this.roomPresenceWaitingList=[],this.logger.info("[roomService] === STOPPED ===");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"attachHandlers",value:function(){var e=this;this.logger.info("[roomService] attachHandlers"),this.roomPresenceRef&&(this.xmppService.connection.deleteHandler(this.roomPresenceRef),this.roomPresenceRef=null),this.roomPresenceRef=this.xmppService.connection.addHandler((function(t){return e.onRoomPresence(t)}),"http://jabber.org/protocol/muc#user","presence"),this.roomMessageRef&&(this.xmppService.connection.deleteHandler(this.roomMessageRef),this.roomMessageRef=null),this.roomMessageRef=this.xmppService.connection.addHandler((function(t){return e.onRoomMessage(t)}),"jabber:x:conference","message"),this.roomInfoMessageRef&&(this.xmppService.connection.deleteHandler(this.roomInfoMessageRef),this.roomInfoMessageRef=null),this.roomInfoMessageRef=this.xmppService.connection.addHandler((function(t){return e.onRoomInfoMessage(t)}),null,"message","groupchat"),this.roomMessageConfigRef&&(this.xmppService.connection.deleteHandler(this.roomMessageConfigRef),this.roomMessageConfigRef=null),this.roomMessageConfigRef=this.xmppService.connection.addHandler((function(t){return e.onRoomMessageConfig(t)}),null,"message","management"),this.roomHistoryInfoRef&&(this.xmppService.connection.deleteHandler(this.roomHistoryInfoRef),this.roomHistoryInfoRef=null),this.roomHistoryInfoRef=this.xmppService.connection.addHandler((function(t){return e.onRoomHistoryInfoMessage(t)}),"jabber:iq:notification","message"),this.roomNotificationRef&&(this.xmppService.connection.deleteHandler(this.roomNotificationRef),this.roomNotificationRef=null),this.roomNotificationRef=this.xmppService.connection.addHandler((function(t){return e.onRoomNotificationMessage(t)}),"jabber:x:bubble:conference","message"),this.listeners.forEach((function(e){e()})),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((function(t){e.onConnectionStateChange(t)}))}},{key:"reconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.userContact&&!this.userContact.roomsEnabled){t.next=18;break}return t.prev=1,this.logger.info("[roomService] reconnect"),e++,this.attachHandlers(),t.next=7,this.getServerRooms();case 7:this.computeInvitationCounter(),this.retrieveOpenInviteData(),this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED)&&(this.retrievePersonalAudioRoom(),this.retrieveCurrentPersonalAudioRoom()),this.logger.info("[roomService] reconnect success"),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),this.logger.error("[roomService] reconnect failure -- "+t.t0.message),1===e&&this.reconnect(e);case 16:t.next=19;break;case 18:this.logger.info("[roomService] === Reconnect skipped - roomsEnabled : false");case 19:case"end":return t.stop()}}),t,this,[[1,13]])})))}},{key:"onConnectionStateChange",value:function(e){var t=this;this.logger.info("[roomService] onConnectionStateChange status:"+e.name),"ON_XMPP_DISCONNECTED"===e.name&&this.rooms&&(Object.keys(this.rooms).forEach((function(e){var n=t.rooms[e];n&&(n.initPresenceAck=!1,n.initPresInterval&&(t.logger.info("[roomService] onConnectionStateChange cancel initPresence retryer for room: "+n.jid+" "+n.getNameForLogs()),n.initPresInterval.unsubscribe(),n.initPresInterval=null),n.initPresPromise&&(t.logger.info("[roomService] onConnectionStateChange remove initPresPromise for room: "+n.jid+" "+n.getNameForLogs()),n.initPresPromise=null,n.initPresPromiseResolve=null))})),this.roomPresenceWaitingList=[])}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"sendEvent",value:function(e,t){this.rxSubject.next({type:e,value:t})}},{key:"getRooms",value:function(){var e=this,t=[];return Object.keys(this.rooms).forEach((function(n){t.push(e.rooms[n])})),t}},{key:"searchRooms",value:function(e){var t=e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return this.getRooms().filter((function(e){if(!_.default.userContact.phoneMeetingsEnabled&&e.isMeetingRoom())return!1;if("accepted"!==e.status)return!1;e.filterName=e.name.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"");var n=e.filterName.split(/[ -]+/);return t.every((function(e){return n.some((function(t,r){return!(!t.length||-1===t.indexOf(e))&&(n[r]="",!0)}))}))}))}},{key:"getRoomInvitations",value:function(){return this.getRooms().filter((function(e){return"invited"===e.status&&"Rainbow_OutlookCreation_InternalUseOnly"!==e.desc&&!e.isMeetingRoom()&&!e.isWebinarRoom()}))}},{key:"getMeetingInvitations",value:function(){return this.getRooms().filter((function(e){return!e.isWebinarRoom()&&"invited"===e.status&&"Rainbow_OutlookCreation_InternalUseOnly"!==e.desc&&e.isMeetingRoom()&&!e.isWebinarRoom()}))}},{key:"getWebinarInvitations",value:function(){return this.getRooms().filter((function(e){return"invited"===e.status&&e.isWebinarRoom()&&null!==e.webinarId}))}},{key:"getMyRooms",value:function(){return this.getRooms().filter((function(e){return e.owner}))}},{key:"getRoomById",value:function(e){return this.rooms[e]}},{key:"getRoomByJid",value:function(e){return this.roomsByJids[e]}},{key:"getRoomsByContainerId",value:function(e){return this.getRooms().filter((function(t){return t.containerId===e}))}},{key:"computeInvitationCounter",value:function(){var e=this;this.invitationCounter=0,this.meetingInvitationCounter=0,Object.keys(this.rooms).forEach((function(t){var n=e.rooms[t];"invited"===n.status&&(n.isMeetingRoom()?e.meetingInvitationCounter+=1:e.invitationCounter+=1)}))}},{key:"getOrderedRooms",value:function(e){var t=this.getRooms();switch(e){case"lastActivityDate":return t.sort((function(e,t){return t.getLastActivityDate().getTime()-e.getLastActivityDate().getTime()}));case"creationDate":return t.sort((function(e,t){return t.getCreationDate().getTime()-e.getCreationDate().getTime()}));default:return t.sort((function(e,t){return e.name.localeCompare(t.name)}))}}},{key:"getMyOrderedRooms",value:function(e){var t=this.getMyRooms();switch(e){case"lastActivityDate":return t.sort((function(e,t){return t.getLastActivityDate().getTime()-e.getLastActivityDate().getTime()}));case"creationDate":return t.sort((function(e,t){return t.getCreationDate().getTime()-e.getCreationDate().getTime()}));default:return t.sort((function(e,t){return e.name.localeCompare(t.name)}))}}},{key:"updateRoomFromServer",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.info("updateRoomFromServer(".concat(e.dbId,")")),t.prev=1,t.next=4,fetch("".concat(this.portalURL,"rooms/").concat(e.dbId,"?format=full"),{headers:p.default.getRequestHeader()});case 4:return n=t.sent,t.next=7,n.json();case 7:return r=t.sent.data,t.next=10,this.getAllRoomsParticipants([r]);case 10:this.updateRoomData(e,r),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),this.logger.error("updateRoomFromServer -- FAILURE -- "+t.t0.message);case 16:case"end":return t.stop()}}),t,this,[[1,13]])})))}},{key:"updateRoomData",value:function(e,t){if(e.name=t.name,e.desc=t.topic,e.users=[],t.users.forEach((function(t){var n=_.default.getContactById(t.userId);n&&(e.users.push({contact:n,status:t.status,date:new Date(t.additionDate),privilege:t.privilege}),_.default.isUserContact(n)&&(e.status=t.status))})),this.refreshMemberAndOrganizerLists(e),e.isModerator=e.status!==this.RoomUserStatus.UNSUBSCRIBED&&e.isUserModerator(_.default.userContact),t.lastAvatarUpdateDate&&t.lastAvatarUpdateDate!==e.lastAvatarUpdate){e.lastAvatarUpdate=t.lastAvatarUpdateDate;var n=v.default.cdn?v.default.cdnServer:config.restServerUrl,r=i.MD5(a.enc.Latin1.parse(e.lastAvatarUpdate)).toString(a.enc.Hex);e.avatar="".concat(n,"/api/room-avatar/").concat(e.dbId,"?size=512&update=").concat(r)}e.updateAvatarInfo(),e.guestEmails=t.guestEmails,e.confEndpoints=t.confEndpoints}},{key:"getServerRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"rooms/").concat(e,"?format=full"),r=this.authService.getRequestHeader(),t.next=5,fetch(n,{method:"GET",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:return t.next=10,i.json();case 10:return a=t.sent.data,this.logger.info("[roomService] getServerRoom(".concat(e,") -- SUCCESS")),t.next=14,this.getAllRoomsParticipants([a]);case 14:return o=t.sent,t.abrupt("return",this.createRoomFromData(o[0]));case 18:return t.prev=18,t.t0=t.catch(0),t.next=22,this.errorHelperService.getErrorInfo(t.t0,"getServerRoom");case 22:throw s=t.sent,this.logger.error("[roomService] "+s.message),s.error;case 24:case"end":return t.stop()}}),t,this,[[0,18]])})))}},{key:"getServerRoomByJid",value:function(e){var t=this;return this.logger.info("[roomService] getServerRoomByJid(".concat(e,")")),this.getRoomByJidPromises[e]||(this.getRoomByJidPromises[e]=r(t,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"rooms/jids/").concat(e,"?format=full"),r=this.authService.getRequestHeader(),t.next=5,fetch(n,{method:"GET",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:return t.next=10,i.json();case 10:return a=t.sent.data,this.logger.info("[roomService] getServerRoomByJid(".concat(e,") -- SUCCESS")),t.next=14,this.getAllRoomsParticipants([a]);case 14:return o=t.sent,t.abrupt("return",(delete this.getRoomByJidPromises[e],this.createRoomFromData(o[0])));case 18:return t.prev=18,t.t0=t.catch(0),t.next=22,this.errorHelperService.getErrorInfo(t.t0,"getServerRoomByJid");case 22:throw s=t.sent,this.logger.error("[roomService] "+s.message),delete this.getRoomByJidPromises[e],s.error;case 24:case"end":return t.stop()}}),t,this,[[0,18]])})))),this.getRoomByJidPromises[e]}},{key:"getServerRooms",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,i,a,o=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function e(t,n,i){return r(o,void 0,void 0,b.a.mark((function r(){var a,o,s,c;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,a="".concat(this.portalURL,"rooms?format=full&userId=").concat(this.userContact.dbId,"&sortField=lastActivityDate&status=invited&status=accepted&status=unsubscribed&offset=").concat(t,"&limit=").concat(n),o=this.authService.getRequestHeader(),r.next=5,fetch(a,{method:"GET",headers:o});case 5:if((s=r.sent).ok){r.next=8;break}throw s;case 8:return r.next=10,s.json();case 10:if(c=r.sent,i=i.concat(c.data),this.logger.info("[roomService] getServerRooms retrieved ".concat(c.data.length," rooms, total ").concat(i.length,", existing ").concat(c.total)),i.length!==c.total){r.next=17;break}r.t0=(this.logger.info("[roomService] getServerRooms no need to loop again. All rooms retrieved..."),i),r.next=22;break;case 17:return t+=n,this.logger.info("[roomService] getServerRooms need another loop to get more rooms... "),r.next=21,e(t,n,i);case 21:r.t0=r.sent;case 22:return r.abrupt("return",r.t0);case 25:return r.prev=25,r.t1=r.catch(0),r.next=29,this.errorHelperService.getErrorInfo(r.t1,"getSetOfRooms");case 29:throw r.sent.error;case 30:case"end":return r.stop()}}),r,this,[[0,25]])})))},e.prev=1,n=this.maxRoomsStartupLoad?this.maxRoomsStartupLoad:1e3,e.next=5,t(0,n,[]);case 5:return i=e.sent,this.logger.info("[roomService] getServerRooms successfully: find ".concat(i.length," room(s)")),e.prev=7,e.next=10,this.getAllRoomsParticipants(i);case 10:e.sent.forEach((function(e){o.createRoomFromData(e,!0)})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),this.logger.info("[roomService] getServerRooms issue while retrieving all participant"),i.forEach((function(e){o.createRoomFromData(e,!0)}));case 16:this.sendInitialPresenceForAllRooms(),e.next=23;break;case 19:throw e.prev=19,e.t1=e.catch(1),a="getServerRooms failure: "+(e.t1.data?e.t1.data.errorDetails:e.t1.message),this.logger.error("[roomService] "+a),new Error(a);case 23:case"end":return e.stop()}}),e,this,[[1,19],[7,13]])})))}},{key:"getRoomParticipants",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c,l,u;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=100,r=e.id,i=e.activeUsersCounter,a=e.users.concat(),!(i>n)){t.next=13;break}for(a=[],o=i/n+1,s=0,c=[],l=1;l<o;l++)c.push(this.getRoomParticipantPage(r,s,n)),s+=n;return t.next=11,Promise.all(c);case 11:t.sent.forEach((function(e){a=a.concat(e.data)})),e.users=a;case 13:return t.abrupt("return",a);case 16:return t.prev=16,t.t0=t.catch(0),t.next=20,this.errorHelperService.getErrorInfo(t.t0,"getSetOfUsers");case 20:throw u=t.sent,this.logger.error("[roomService] "+u.message),u.error;case 22:case"end":return t.stop()}}),t,this,[[0,16]])})))}},{key:"getRoomParticipantPage",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,a,o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i="".concat(this.portalURL,"rooms/").concat(e,"/users?format=full&offset=").concat(t,"&limit=").concat(n),a=p.default.getRequestHeader(),r.next=5,fetch(i,{method:"GET",headers:a});case 5:if((o=r.sent).ok){r.next=8;break}throw o;case 8:return r.next=10,o.json();case 10:return r.abrupt("return",r.sent);case 13:return r.prev=13,r.t0=r.catch(0),r.next=17,this.errorHelperService.getErrorInfo(r.t0,"getRoomParticipantPage");case 17:throw s=r.sent,this.logger.error("[roomService] "+s.message),s.error;case 19:case"end":return r.stop()}}),r,this,[[0,13]])})))}},{key:"getAllRoomsParticipants",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=performance.now(),t.next=4,Promise.all(e.map((function(e){return o.getRoomParticipants(e)})));case 4:if(r=t.sent.reduce((function(e,t){return t.forEach((function(t){e[t.jid_im]||(e[t.jid_im]=!0)})),e}),{}),i=Object.keys(r).filter((function(e){var t=_.default.getContactByJid(e);return!t||t.temp})),t.t0=i&&i.length,!t.t0){t.next=10;break}return t.next=10,_.default.getContactsByJids(i);case 10:return t.next=12,Promise.all(e.map((function(e){return _.default.getContactByDBId(e.creator)})));case 12:return a=performance.now(),t.abrupt("return",(this.logger.info('[roomService] getAllRoomsParticipants - get "'.concat(i.length," participants in ").concat(Math.round(a-n)," ms")),e));case 16:throw t.prev=16,t.t1=t.catch(0),this.logger.error("[roomService] "+t.t1.message),t.t1;case 19:case"end":return t.stop()}}),t,this,[[0,16]])})))}},{key:"createRoomFromData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=o.Room.create(e.id,e.jid,e.name,e.topic,e.creationDate,e.confEndpoints,e.history,e.customData,e.conference,e.avatar,e.isActive,e.lastActivityDate,e.autoRegister,e.autoAcceptInvitation,e.tags,e.containerId,e.containerName),r=_.default.dbContacts[e.creator];r?(n.ownerContact=r,n.owner=r.jid===_.default.userContact.jid):this.logger.warn("[roomService] createRoomFromData -- failure -- Impossible to find owner of room "+e.name+" --- ignored"),e.users.forEach((function(e){var t=_.default.getContactById(e.userId);t&&(n.users.push({contact:t,status:e.status,date:new Date(e.additionDate),privilege:e.privilege}),_.default.isUserContact(t)&&(n.status=e.status))})),n.guestEmails=e.guestEmails,this.refreshMemberAndOrganizerLists(n);var s=n.getUserByJid(_.default.userContact.jid);if(n.isModerator=s&&s.status!==this.RoomUserStatus.UNSUBSCRIBED&&n.isUserModerator(_.default.userContact),this.rooms[n.dbId]&&(this.rooms[n.dbId].initPresPromise&&(n.initPresPromise=this.rooms[n.dbId].initPresPromise,n.initPresInterval=this.rooms[n.dbId].initPresInterval,n.initPresPromiseResolve=this.rooms[n.dbId].initPresPromiseResolve),n.rxSubject=this.rooms[n.dbId].rxSubject,n.initPresenceAck=this.rooms[n.dbId].initPresenceAck),n.updateAvatarInfo(),e.lastAvatarUpdateDate){var c=v.default.cdn?v.default.cdnServer:config.restServerUrl;n.avatar=c+"/api/room-avatar/"+e.id+"?size=512&update="+i.MD5(a.enc.Latin1.parse(e.lastAvatarUpdateDate)).toString(a.enc.Hex)}return n.conference&&n.conference.webinarId&&(n.webinarId=n.conference.webinarId),this.rooms[n.dbId]=n,this.roomsByJids[n.jid]=n,this.eventService.publish(this.ROOM_UPDATE_EVENT,n),this.sendEvent(this.ROOM_UPDATE_EVENT,n),"accepted"!==n.status||!n.isActive||n.initPresenceAck||t||this.sendInitialRoomPresenceSync(n),n}},{key:"refreshMemberAndOrganizerLists",value:function(e){var t=this;e.organizers=[],e.members=[],e.users.forEach((function(n){(n.status===t.RoomUserStatus.ACCEPTED||n.status===t.RoomUserStatus.INVITED||e.ownerContact&&n.contact.jid===e.ownerContact.jid)&&(n.privilege===o.Room.Privilege.MODERATOR?e.organizers.push(n):e.members.push(n))}))}},{key:"equalContactsArrayByDbId",value:function(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n].dbId!==t[n].dbId)return!1;return!0}},{key:"getOrCreateRoomWithContacts",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c,l,u=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,r=null,i=[].concat([_.default.userContact],e).sort(this.sortObjectByProperty("dbId")),this.getMyRooms().some((function(e){return!(!e||e.status!==u.RoomUserStatus.ACCEPTED||!u.equalContactsArrayByDbId(e.users.map((function(e){return e.contact})).sort(u.sortObjectByProperty("dbId")),i))&&(r=e,u.logger.debug("[roomService] getOrCreateRoomWithContacts - Found Room "+e.getNameForLogs()),!0)})),!r){n.next=9;break}if(n.t0=t.length,!n.t0){n.next=8;break}return n.next=8,this.addRoomUsers(r,null,t);case 8:return n.abrupt("return",r);case 9:return n.next=11,this.retrieveRoomConsumption();case 11:if(!(n.sent>y.default.getFeatureLimitMax(y.default.FeaturesEnum.BUBBLE_COUNT))){n.next=14;break}return n.abrupt("return",(this.eventService.publish("ON_OPEN_GLOBAL_POPUP",{popupTitle:"createBubble",popupBody:"maxCollabSpaceReached",okLabel:"ok"}),null));case 14:for(a=_.default.userContact.initials+" "+this.i18n.translate("new")+" "+this.i18n.translate("bubble")+" ",o=this.getMyRooms().filter((function(e){return e&&0===e.name.indexOf(a)})),s=null,c=1,l=function(){var e=a+c.toString();o.sort(u.sortObjectByProperty("name")).some((function(t){return t&&t.name===e}))||(s=e),c++};!s;)l();return n.next=20,this.createRoomWithContacts(s,"",e,t);case 20:return n.abrupt("return",n.sent);case 23:throw n.prev=23,n.t1=n.catch(0),this.logger.error("[roomService] getOrCreateRoomWithContacts failure"),n.t1;case 26:case"end":return n.stop()}}),n,this,[[0,23]])})))}},{key:"createRoomWithContacts",value:function(e,t,n,i){return r(this,void 0,void 0,b.a.mark((function r(){var a,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.createRoom(e,t,!0,null,!0,null,!0);case 3:return a=r.sent,r.next=6,this.addRoomUsers(a,n,i);case 6:return r.abrupt("return",a);case 9:throw r.prev=9,r.t0=r.catch(0),o=r.t0&&r.t0.message?"createRoomWithContacts failure: "+r.t0.message:"createRoomWithContacts failure",this.logger.error("[roomService] "+o),r.t0&&r.t0.errorDetailsLabel?r.t0:new Error(o);case 13:case"end":return r.stop()}}),r,this,[[0,9]])})))}},{key:"setAvatarRoom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512;return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s,c,l,d;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=2;break}return r.abrupt("return",e);case 2:return r.prev=2,r.next=5,u.resizeImage(t,n,i);case 5:return a=r.sent,o=u.getBinaryData(a),s="".concat(this.portalURL,"rooms/").concat(e.id,"/avatar"),c=this.authService.getPostHeader("image/"+o.type),r.next=11,fetch(s,{method:"POST",headers:c,body:o.data});case 11:if((l=r.sent).ok){r.next=14;break}throw l;case 14:return r.next=16,l.json();case 16:return this.logger.info("[roomService] setAvatarRoom -- SUCCESS"),e.avatar="".concat(config.restServerUrl,"/api/room-avatar/").concat(e.id,"?size=512&rand=").concat(k.default()),r.abrupt("return",e);case 21:return r.prev=21,r.t0=r.catch(2),r.next=25,this.errorHelperService.getErrorInfo(r.t0,"setAvatarRoom");case 25:throw d=r.sent,this.logger.error("[roomService] "+d.message),d.error;case 27:case"end":return r.stop()}}),r,this,[[2,21]])})))}},{key:"deleteAvatarRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.portalURL,"rooms/").concat(e,"/avatar"),r=this.authService.getRequestHeader(),t.next=4,fetch(n,{method:"DELETE",headers:r});case 4:if((i=t.sent).ok){t.next=7;break}throw i;case 7:this.logger.info("[roomService] avatar room sucessfully deleted");case 8:case"end":return t.stop()}}),t,this)})))}},{key:"pushContactInRoom",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.contactService.getContactByDBId(e.userId);case 3:r=n.sent,t.users.push({contact:r,status:e.status,date:new Date(e.additionDate),privilege:e.privilege}),this.contactService.isUserContact(r)&&(t.status=e.status),this.logger.info("[roomService] pushContactInRoom success"),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),this.logger.info("[roomService] pushContactInRoom failure : "+n.t0.message);case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"addRoomUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return r(this,void 0,void 0,b.a.mark((function r(){var s,c,l,u,d,h,f,p,m,v,g,y=this;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!e.users.some((function(e){return(e.status===y.RoomUserStatus.INVITED||e.status===y.RoomUserStatus.ACCEPTED||e.status===y.RoomUserStatus.REJECTED)&&e.contact.dbId===t.dbId}))){r.next=3;break}return r.abrupt("return",(this.logger.debug("[roomService] user: ".concat(t.dbId," already invited or accepted, will not be added")),e));case 3:if(!(e.users.filter((function(e){return e.status!==y.RoomUserStatus.DELETED})).length>=this.maxRoomsUsers)){r.next=6;break}throw(s=new Error("addRoomUser failure - Not Allowed : Participants max limit has been reached: "+this.maxRoomsUsers)).status=s.errorDetailsCode="403",s.errorDetailsLabel="MaximumNumberRoomUsersReach",s.errorDetailsCode="403620",this.logger.error("[roomService] "+s.message),s;case 6:return c="boolean"==typeof a&&a?this.RoomUserStatus.ACCEPTED:this.RoomUserStatus.INVITED,l=n||"JustForFun",u=i||o.Room.Privilege.USER,d="".concat(this.portalURL,"rooms/").concat(e.dbId,"/users"),h=this.authService.getPostHeader(),f=JSON.stringify({userId:t.dbId,privilege:u,reason:l,status:c}),r.next=14,fetch(d,{method:"POST",headers:h,body:f});case 14:if((p=r.sent).ok){r.next=17;break}throw p;case 17:return this.logger.info("[roomService] addRoomUser ".concat(t.nameForLogs," to room ").concat(e.dbId," (").concat(e.getNameForLogs(),") success")),r.next=20,p.json();case 20:return m=r.sent.data,v=e.getUserByJid(m.jid_im),r.abrupt("return",(v?(v.status=m.status,v.date=new Date,v.privilege=m.privilege):e.users.push({contact:t,status:c,date:new Date,privilege:u}),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e));case 25:return r.prev=25,r.t0=r.catch(0),r.next=29,this.errorHelperService.getErrorInfo(r.t0,"addRoomUser");case 29:throw g=r.sent,this.logger.error("[roomService] "+g.message),g.error;case 31:case"end":return r.stop()}}),r,this,[[0,25]])})))}},{key:"addRoomUsers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return r(this,void 0,void 0,b.a.mark((function r(){var i,a,o=this;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=[],t.forEach((function(t){e.users.some((function(n){if(n.contact.dbId===t.dbId){switch(n.status){case o.RoomUserStatus.REJECTED:case o.RoomUserStatus.UNSUBSCRIBED:i.push(o.ownerReinviteRejectedUser(e,t));break;case o.RoomUserStatus.DELETED:i.push(o.ownerReinviteDeletedUser(e,t))}return!0}return!1}))||i.push(o.addRoomUser(e,t))})),r.next=5,Promise.all(i);case 5:this.logger.info("[roomService] addRoomUsers success"),this.eventService.publish(this.ROOM_ADD_USERS_EVENT,e),this.inviteGuestEmailToJoinRoom(e,n),r.next=14;break;case 10:throw r.prev=10,r.t0=r.catch(0),a="addRoomUsers failure: "+r.t0.message,this.logger.error("[roomService] "+a),r.t0;case 14:case"end":return r.stop()}}),r,this,[[0,10]])})))}},{key:"deleteRoomUsers",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=[],t.forEach((function(t){e.users.some((function(e){return e.contact.dbId===t.dbId}))&&r.push(a.ownerDeletesUserFromRoom(e,t))})),n.next=5,Promise.all(r);case 5:return this.logger.info("[roomService] deleteRoomUsers success"),this.eventService.publish(this.ROOM_DELETE_USERS_EVENT,e),n.abrupt("return",e);case 10:throw n.prev=10,n.t0=n.catch(0),i="deleteRoomUsers failure: "+n.t0.message,this.logger.error("[roomService] "+i),new Error(i);case 14:case"end":return n.stop()}}),n,this,[[0,10]])})))}},{key:"addRoomAndroidTVs",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=[],t.forEach((function(t){null!==t&&r.push(a.addRoomAndroidTV(e,t))})),n.next=5,Promise.all(r);case 5:return this.logger.info("[roomService] addRoomAndroidTVs success"),this.eventService.publish(this.ROOM_ADD_USERS_EVENT,e),n.abrupt("return",e);case 10:throw n.prev=10,n.t0=n.catch(0),i="addRoomAndroidTVs failure: "+n.t0.message,this.logger.error("[roomService] "+i),new Error(i);case 14:case"end":return n.stop()}}),n,this,[[0,10]])})))}},{key:"addRoomAndroidTV",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c,l,u,d,h;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,"androidtv",r="moderator",i="accepted",a="".concat(this.portalURL,"rooms/").concat(e.dbId,"/users"),o=this.authService.getPostHeader(),s=JSON.stringify({userId:t.dbId,privilege:r,reason:"androidtv",status:i}),n.next=9,fetch(a,{method:"POST",headers:o,body:s});case 9:if((c=n.sent).ok){n.next=12;break}throw c;case 12:return this.logger.info("[roomService] addRoomAndroidTV ".concat(t.nameForLog," to room ").concat(e.dbId," (").concat(e.getNameForLogs(),") success")),n.next=15,c.json();case 15:return l=n.sent.data,u=e.getUserByJid(l.jid_im),n.abrupt("return",(u?(u.status=l.status,u.date=new Date,u.privilege=l.privilege):e.users.push({contact:t,status:i,date:new Date,privilege:r}),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),e));case 20:if(n.prev=20,n.t0=n.catch(0),!n.t0.data||!n.t0.data.errorDetails){n.next=25;break}throw d="addRoomAndroidTV ".concat(t.nameForLog," to room ").concat(e.dbId," (").concat(e.getNameForLogs(),") failure: ").concat(n.t0.data.errorDetails),this.logger.error("[roomService] "+d),new Error(d);case 25:return n.next=27,this.errorHelperService.getErrorInfo(n.t0,"addRoomAndroidTV");case 27:throw h=n.sent,this.logger.error("[roomService] "+h.message),h.error;case 29:case"end":return n.stop()}}),n,this,[[0,20]])})))}},{key:"sendInitialPresenceForAllRooms",value:function(){var e=this;Object.keys(this.rooms).forEach((function(t){var n=e.rooms[t];n&&!n.initPresPromise&&!n.initPresenceAck&&"accepted"===n.status&&n.isActive&&e.roomPresenceWaitingList.push(n)})),this.sendInitialPresenceForRoomsByParts(15)}},{key:"allSettled",value:function(e){var t=e.map((function(e){return Promise.resolve(e).then((function(e){return{status:"fulfilled",value:e}}),(function(e){return{status:"rejected",reason:e}}))}));return Promise.all(t)}},{key:"sendInitialPresenceForRoomsByParts",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.roomPresenceWaitingList&&this.roomPresenceWaitingList.length){this.logger.info("[roomService] sendInitialPresenceForRoomsByParts");for(var r=this.roomPresenceWaitingList.length,i=[],a=n?3e4:7500,o=0;o<t;o++)this.roomPresenceWaitingList[o]&&i.push(this.sendInitialRoomPresenceSync(this.roomPresenceWaitingList[o],a));i.length&&this.allSettled(i).then((function(){e.logger.info("[roomService] sendInitialPresenceForRoomsByParts -- done for group -- presences remaining "+e.roomPresenceWaitingList.length);var t=r===e.roomPresenceWaitingList.length;e.sendInitialPresenceForRoomsByParts(15,t)}))}}},{key:"sendInitialRoomPresence",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t?" -- attempt "+t:"";this.logger.info("[roomService] sendInitialRoomPresence "+n+" -- "+e.getNameForLogs()+" -- "+e.dbId);var r=c.$pres({to:e.jid+"/"+this.xmppService.fullJid});r.c("x",{xmlns:"http://jabber.org/protocol/muc"}).c("history",{maxchars:"0"}),this.xmppService.send(r)}},{key:"sendInitialRoomPresenceSync",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7500;return e.initPresPromise?e.initPresPromise:e.initPresenceAck?(this.logger.info("[roomService] sendInitialRoomPresenceSync -- ".concat(e.getNameForLogs()," -- ").concat(e.dbId," -- room already activated")),Promise.resolve()):(e.initPresPromise=new Promise((function(r,i){e.initPresPromiseResolve=r,t.sendInitialRoomPresence(e,0);var a=0;e.initPresInterval=d.interval(n).subscribe((function(){a<3?(a+=1,t.sendInitialRoomPresence(e,a)):(t.logger.error("[roomService] sendInitialRoomPresenceSync : no response after "+a+" retries => clean presence promise and interval for "+e.getNameForLogs()+" -- "+e.jid),i("[roomService] sendInitialRoomPresenceSync : no response"),e.initPresPromise=null,e.initPresInterval&&(e.initPresInterval.unsubscribe(),e.initPresInterval=null),e=t.rooms[e.dbId],t.eventService.publish(t.ROOM_UPDATE_EVENT,e))}))})),e.initPresPromise)}},{key:"sendUnavailableRoomPresence",value:function(e){var t=c.$pres({to:e.jid+"/"+_.default.userContact.jid,type:"unavailable"});t.c("x",{xmlns:"http://jabber.org/protocol/muc"}),this.xmppService.send(t)}},{key:"sendAvailableRoomPresence",value:function(e){var t=c.$pres({to:e.jid+"/"+_.default.userContact.jid,type:"available"});t.c("x",{xmlns:"http://jabber.org/protocol/muc"}),this.xmppService.send(t)}},{key:"createRoom",value:function(e,t,n,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],d=arguments.length>9&&void 0!==arguments[9]&&arguments[9];return r(this,void 0,void 0,b.a.mark((function r(){var h,f,p,m,v,g,y,S,C,w,E;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return h=e.charAt(0)+"***"+e.slice(-1),r.prev=1,this.logger.info('[roomService] createRoom "'+h+'"'),(void 0===a||a&&"boolean"!=typeof a)&&(a=!0),c=c||"true",f=n?"all":"none",p=Boolean(l),m={name:e,topic:t,history:f,disableNotifications:a,mediaType:null,createConversation:c,autoAcceptInvitation:p,muteUponEntry:u,disableTimeStats:!1},s&&(m.mediaType=s),d&&(m.disableTimeStats=d),v=this.portalURL+"rooms/",g=this.authService.getPostHeader(),y=JSON.stringify(m),r.next=10,fetch(v,{method:"POST",headers:g,body:y});case 10:if((S=r.sent).ok){r.next=13;break}throw S;case 13:return r.next=15,S.json();case 15:return C=r.sent.data,r.prev=16,r.next=19,this.setAvatarRoom(C,i);case 19:r.next=23;break;case 21:r.prev=21,r.t0=r.catch(16);case 23:if(!this.rooms[C.id]){r.next=25;break}return r.abrupt("return",(this.logger.info('[roomService] createRoom -- room "'+h+'" already exists'),this.rooms[C.id]));case 25:return(w=o.Room.create(C.id,C.jid,C.name,C.topic,C.creationDate,C.confEndpoints,C.history,C.customData,C.conference,C.avatar,C.isActive,C.lastActivityDate,C.autoRegister,C.autoAcceptInvitation,C.tags,C.containerId,C.containerName)).ownerContact=_.default.userContact,w.owner=!0,w.isModerator=!0,w.status="accepted",C.users.forEach((function(e){var t=_.default.getContactById(e.userId);t&&(w.users.push({contact:t,status:e.status,date:new Date(e.additionDate),privilege:e.privilege}),_.default.isUserContact(t)&&(w.status=e.status))})),this.refreshMemberAndOrganizerLists(w),this.rooms[w.dbId]=w,this.roomsByJids[w.jid]=w,this.logger.info('[roomService] createRoom "'+h+'" -- success'),r.next=37,this.sendInitialRoomPresenceSync(w);case 37:return r.abrupt("return",this.rooms[w.dbId]);case 40:return r.prev=40,r.t1=r.catch(1),r.next=44,this.errorHelperService.getErrorInfo(r.t1,"getServerInvitation");case 44:throw E=r.sent,this.logger.error("[invitationService] "+E.message),E.error;case 46:case"end":return r.stop()}}),r,this,[[1,40],[16,21]])})))}},{key:"updateRoomUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s,c,l,u,d,h;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,a={status:void 0,privilege:void 0},n&&(a.status=n),i&&(a.privilege=i),o="".concat(this.portalURL,"rooms/").concat(e.dbId,"/users/").concat(t.dbId),s=this.authService.getPostHeader(),c=JSON.stringify(a),r.next=8,fetch(o,{method:"PUT",headers:s,body:c});case 8:if((l=r.sent).ok){r.next=11;break}throw l;case 11:return this.logger.info("[roomService] updateRoomUser ".concat(t.nameForLogs," to room ").concat(e.dbId," (").concat(e.getNameForLogs(),") success")),r.next=14,l.json();case 14:return u=r.sent.data,r.abrupt("return",(e.users.forEach((function(e){e.contact.jid===u.jid_im&&(e.privilege=u.privilege,e.status=u.status)})),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e));case 18:if(r.prev=18,r.t0=r.catch(0),!r.t0.data||!r.t0.data.errorDetails){r.next=23;break}throw d="updateRoomUser "+t.nameForLogs+" to room "+e.dbId+"("+e.getNameForLogs()+") failure: "+r.t0.data.errorDetails,this.logger.error("[roomService] "+d),new Error(d);case 23:return r.next=25,this.errorHelperService.getErrorInfo(r.t0,"updateRoomUser");case 25:throw h=r.sent,this.logger.error("[roomService] "+h.message),h.error;case 27:case"end":return r.stop()}}),r,this,[[0,18]])})))}},{key:"ownerArchiveRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.info("[roomService] ownerArchiveRoom"),n=[],e.users.forEach((function(t){_.default.isUserContact(t.contact)||t.status===r.RoomUserStatus.DELETED||t.status===r.RoomUserStatus.REJECTED||n.push(r.unsubscribeUserFromRoom(e,t.contact))})),t.prev=3,t.next=6,Promise.all(n);case 6:return this.logger.info("[roomService] unsubscribe all other users successfully"),t.next=9,this.unsubscribeMeFromRoom(e);case 9:this.logger.info("[roomService] ownerArchiveRoom successfully"),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),this.logger.error("[roomService] ownerArchiveRoom failure "+t.t0.message);case 15:case"end":return t.stop()}}),t,this,[[3,12]])})))}},{key:"unsubscribeUserFromRoom",value:function(e,t){return this.updateRoomUser(e,t,this.RoomUserStatus.UNSUBSCRIBED)}},{key:"ownerDeletesUserFromRoom",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,this.logger.info("[roomService] ownerDeletesUserFromRoom"),r="".concat(this.portalURL,"rooms/").concat(e.dbId,"/users/").concat(t.dbId),i=this.authService.getRequestHeader(),n.next=6,fetch(r,{method:"DELETE",headers:i});case 6:if((a=n.sent).ok){n.next=9;break}throw a;case 9:return n.abrupt("return",(this.logger.info("[roomService] ownerDeletesUserFromRoom ".concat(t.dbId," from room ").concat(e.dbId," (").concat(e.getNameForLogs(),") success")),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e));case 12:if(n.prev=12,n.t0=n.catch(0),!n.t0.data||!n.t0.data.errorDetails){n.next=17;break}throw o="ownerDeletesUserFromRoom "+t.dbId+" from room "+e.dbId+"("+e.getNameForLogs()+") failure: "+n.t0.data.errorDetails,this.logger.error("[roomService] "+o),new Error(o);case 17:return n.next=19,this.errorHelperService.getErrorInfo(n.t0,"ownerDeletesUserFromRoom");case 19:throw s=n.sent,this.logger.error("[roomService] "+s.message),s.error;case 21:case"end":return n.stop()}}),n,this,[[0,12]])})))}},{key:"ownerReinviteRejectedUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return r(this,void 0,void 0,b.a.mark((function r(){var o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.ownerDeletesUserFromRoom(e,t);case 3:return r.next=5,this.addRoomUser(e,t,n,i,a);case 5:return this.logger.info("[roomService] ownerReinviteRejectedUser "+t.dbId+" from room "+e.dbId+"("+e.getNameForLogs()+") success"),r.abrupt("return",e);case 9:throw r.prev=9,r.t0=r.catch(0),o="ownerReinviteRejectedUser failure: "+r.t0.message,this.logger.error("[roomService] "+o),new Error(o);case 13:case"end":return r.stop()}}),r,this,[[0,9]])})))}},{key:"ownerReinviteDeletedUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return r(this,void 0,void 0,b.a.mark((function r(){var o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.addRoomUser(e,t,n,i,a);case 3:return this.logger.info("[roomService] ownerReinviteDeletedUser "+t.dbId+" from room "+e.dbId+"("+e.getNameForLogs()+") success"),r.abrupt("return",e);case 7:throw r.prev=7,r.t0=r.catch(0),o="ownerReinviteDeletedUser failure: "+r.t0.message,this.logger.error("[roomService] "+o),new Error(o);case 11:case"end":return r.stop()}}),r,this,[[0,7]])})))}},{key:"ownerDeleteRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.dbId,t.prev=1,n){t.next=4;break}return t.abrupt("return",(this.logger.error("[roomService] ownerDeleteRoom failure because the roomId is empty ..."),null));case 4:return r="".concat(this.portalURL,"rooms/").concat(n),i=this.authService.getRequestHeader(),t.next=8,fetch(r,{method:"DELETE",headers:i});case 8:if((a=t.sent).ok){t.next=11;break}throw a;case 11:return t.abrupt("return",(this.logger.info("[roomService] ownerDeleteRoom "+e.dbId+"("+e.getNameForLogs()+") success"),delete this.rooms[e.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e.rxSubject.next(),e));case 14:throw t.prev=14,t.t0=t.catch(1),o="ownerDeleteRoom ("+n+") failure: unknown error occurred",t.t0&&t.t0.data&&(o="ownerDeleteRoom ("+n+") failure: "+t.t0.data.errorDetails),t.t0&&404===t.t0.status&&(this.logger.info("[roomService] ownerDeleteRoom "+e.dbId+"("+e.getNameForLogs()+") not found, deleting it from local storage"),delete this.rooms[e.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e)),this.logger.error("[roomService] "+o),new Error(o);case 18:case"end":return t.stop()}}),t,this,[[1,14]])})))}},{key:"ownerUpdateRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[roomService] ownerUpdateRoom"),n="".concat(this.portalURL,"rooms/").concat(e.dbId),r=this.authService.getPostHeader(),i=JSON.stringify({name:e.name,topic:e.desc,visibility:e.type?"public":"private"}),t.next=7,fetch(n,{method:"PUT",headers:r,body:i});case 7:if((a=t.sent).ok){t.next=10;break}throw a;case 10:return t.next=12,a.json();case 12:return s=t.sent.data,t.abrupt("return",(this.rooms[s.id].desc=s.topic,this.rooms[s.id].type="private"===s.visibility?o.Room.Type.PRIVATE:o.Room.Type.PUBLIC,this.logger.info("[roomService] ownerUpdateRoom successfully ("+s.id+", "+s.jid+")"),this.rooms[s.id]));case 16:throw t.prev=16,t.t0=t.catch(0),c="ownerUpdateRoom failure: "+t.t0.data.errorDetails,this.logger.error("[roomService] "+c),new Error(c);case 20:case"end":return t.stop()}}),t,this,[[0,16]])})))}},{key:"checkPromoteOwner",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c,l,u,d,h=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r="".concat(this.portalURL,"rooms/").concat(e.dbId,"/owners/").concat(t.dbId,"/check"),i=this.authService.getPostHeader(),n.next=5,fetch(r,{method:"GET",headers:i});case 5:if((a=n.sent).ok){n.next=8;break}throw a;case 8:this.logger.info("[roomService] checkPromoteOwner "+t.nameForLogs+" to room "+e.dbId+"("+e.getNameForLogs()+") success"),n.next=21;break;case 11:return n.prev=11,n.t0=n.catch(0),n.next=15,n.t0.json();case 15:throw o=n.sent,this.logger.error("[roomService] Error checkPromoteOwner"),s=o.errorDetailsCode,c=null,l=null,u=null,d=new RBError(""),409002===s&&o.errorDetailsData&&(Array.isArray(o.errorDetailsData)?(o.errorDetailsData.forEach((function(e){"BUBBLE_PARTICIPANT_COUNT"===e.feature?c=h.i18n.translate("promoteToOwnerFailureParticipantCountReached",{name:t.displayName,maxValue:e.maxValue}):"WEBRTC_CONFERENCE_ALLOWED"===e.feature?u=h.i18n.translate("promoteToOwnerFailureWebRtcConferenceAllowed",{name:t.displayName}):"BUBBLE_PROMOTE_MEMBER"===e.feature&&(l=h.i18n.translate("promoteToOwnerFailureBubblePromoteMember",{name:t.displayName}))})),c?(d.message=c,d.details={promotePossible:!1}):u?(d.message=this.i18n.translate("promoteOrganizerToOwnerMsg",{name:t.displayName}),d.details={promotePossible:!0,secondMessage:u}):l&&(d.message=this.i18n.translate("promoteOrganizerToOwnerMsg",{name:t.displayName}),d.details={promotePossible:!0,secondMessage:l})):(d.message=this.i18n.translate("promoteToOwnerFailureNotInRoom",{name:t.displayName}),d.details={promotePossible:!1})),d;case 21:case"end":return n.stop()}}),n,this,[[0,11]])})))}},{key:"getCheckPromoteErrorMsg",value:function(e,t){var n=this,r="";return e&&e.errorDetailsData&&e.errorDetailsData.length>0&&e.errorDetailsData.every((function(e){return"BUBBLE_PARTICIPANT_COUNT"===e.feature&&(r=n.i18n.translate("promoteToOwnerFailureParticipantCountReached",{name:t.displayName}),!0)})),r}},{key:"changeRoomOwner",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c,l,u;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this.logger.info("[roomService] changeRoomOwner"),e&&t){n.next=4;break}throw r="changeRoomOwner error: - missing room or new owner",this.logger.error("[roomService] "+r),new Error(r);case 4:return i=e.confEndpoints&&e.confEndpoints.length?e.confEndpoints[0].confEndpointId:"",n.next=7,this.deleteRoomConferenceEndPoint(e,i);case 7:return a="".concat(this.portalURL,"rooms/").concat(e.dbId),o=this.authService.getPostHeader(),s=JSON.stringify({owner:t.dbId}),n.next=12,fetch(a,{method:"PUT",headers:o,body:s});case 12:if((c=n.sent).ok){n.next=15;break}throw c;case 15:return n.abrupt("return",(e.ownerContact=t,e.owner=t.jid===_.default.userContact.jid,this.logger.info("[roomService] changeRoomOwner successfully ("+e.dbId+")"),this.rooms[e.dbId]));case 18:if(n.prev=18,n.t0=n.catch(0),!n.t0.data||!n.t0.data.errorDetails){n.next=23;break}throw l="changeRoomOwner failure: "+n.t0.data.errorDetails,this.logger.error("[roomService] "+l),new Error(l);case 23:return n.next=25,this.errorHelperService.getErrorInfo(n.t0,"changeRoomOwner");case 25:throw u=n.sent,this.logger.error("[roomService] "+u.message),u.error;case 27:case"end":return n.stop()}}),n,this,[[0,18]])})))}},{key:"ownerUpdateRoomCustomData",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[roomService] ownerUpdateRoomCustomData"),n="".concat(this.portalURL,"rooms/").concat(e.dbId,"/custom-data"),r=this.authService.getPostHeader(),i=JSON.stringify({customData:e.customData}),t.next=7,fetch(n,{method:"PUT",headers:r,body:i});case 7:if((a=t.sent).ok){t.next=10;break}throw a;case 10:return t.next=12,a.json();case 12:return o=t.sent.data,t.abrupt("return",(this.logger.info("[roomService] ownerUpdateRoomCustomData successfully got ("+JSON.stringify(o,null,4)+")"),o.customData||{}));case 16:if(t.prev=16,t.t0=t.catch(0),!t.t0.data||!t.t0.data.errorDetails){t.next=21;break}throw s="ownerUpdateRoomCustomData failure: "+t.t0.data.errorDetails,this.logger.error("[roomService] "+s),new Error(s);case 21:return t.next=23,this.errorHelperService.getErrorInfo(t.t0,"ownerUpdateRoomCustomData");case 23:throw c=t.sent,this.logger.error("[roomService] "+c.message),c.error;case 25:case"end":return t.stop()}}),t,this,[[0,16]])})))}},{key:"ownerUpdateRoomNameAndDescription",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,s,c,l;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[roomService] ownerUpdateRoomNameAndDescription"),n="".concat(this.portalURL,"rooms/").concat(e.dbId),r=this.authService.getPostHeader(),i=JSON.stringify({name:e.name,topic:e.desc,visibility:e.type?"public":"private"}),t.next=7,fetch(n,{method:"PUT",headers:r,body:i});case 7:if((a=t.sent).ok){t.next=10;break}throw a;case 10:return t.next=12,a.json();case 12:return s=t.sent.data,t.abrupt("return",(this.rooms[s.id].desc=s.topic,this.rooms[s.id].type="private"===s.visibility?o.Room.Type.PRIVATE:o.Room.Type.PUBLIC,(s.conference||s.confEndpoints)&&(this.rooms[s.id].conference=s.conference?s.conference:null,this.rooms[s.id].confEndpoints=s.confEndpoints?s.confEndpoints:[]),this.logger.info("[roomService] ownerUpdateRoomNameAndDescription successfully ("+s.id+", "+s.jid+")"),this.rooms[s.id]));case 16:return t.prev=16,t.t0=t.catch(0),t.t0.data&&t.t0.data.errorDetails&&(c="ownerUpdateRoomNameAndDescription failure: "+t.t0.data.errorDetails,this.logger.error("[roomService] "+c)),t.next=21,this.errorHelperService.getErrorInfo(t.t0,"ownerUpdateRoomNameAndDescription");case 21:throw l=t.sent,this.logger.error("[roomService] "+l.message),l.error;case 23:case"end":return t.stop()}}),t,this,[[0,16]])})))}},{key:"ownerUpdateAutoRegister",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,s,c,l;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[roomService] ownerUpdateAutoRegister"),n="".concat(this.portalURL,"rooms/").concat(e.dbId),r=this.authService.getPostHeader(),i=JSON.stringify({autoRegister:e.getAutoRegister()}),t.next=7,fetch(n,{method:"PUT",headers:r,body:i});case 7:if((a=t.sent).ok){t.next=10;break}throw a;case 10:return t.next=12,a.json();case 12:return s=t.sent.data,t.abrupt("return",(this.rooms[s.id].setAutoRegister(s.autoRegister),this.rooms[s.id].desc=s.topic,this.rooms[s.id].type="private"===s.visibility?o.Room.Type.PRIVATE:o.Room.Type.PUBLIC,(s.conference||s.confEndpoints)&&(this.rooms[s.id].conference=s.conference?s.conference:null,this.rooms[s.id].confEndpoints=s.confEndpoints?s.confEndpoints:[]),this.logger.info("[roomService] ownerUpdateAutoRegister successfully ("+s.id+", "+s.jid+")"),this.rooms[s.id]));case 16:if(t.prev=16,t.t0=t.catch(0),!t.t0.data||!t.t0.data.errorDetails){t.next=21;break}throw c="ownerUpdateAutoRegister failure: "+t.t0.data.errorDetails,this.logger.error("[roomService] "+c),new Error(c);case 21:return t.next=23,this.errorHelperService.getErrorInfo(t.t0,"ownerUpdateAutoRegister");case 23:throw l=t.sent,this.logger.error("[roomService] "+l.message),l.error;case 25:case"end":return t.stop()}}),t,this,[[0,16]])})))}},{key:"moderatorUpdateRoomConfig",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[roomService] moderatorUpdateRoomConfig"),n="".concat(this.portalURL,"rooms/").concat(e.dbId),r=this.authService.getPostHeader(),i=JSON.stringify({muteUponEntry:e.getMuteUponEntry(),disableTimeStats:e.getDisableTimeStats()}),t.next=7,fetch(n,{method:"PUT",headers:r,body:i});case 7:if((a=t.sent).ok){t.next=10;break}throw a;case 10:return t.next=12,a.json();case 12:return o=t.sent.data,t.abrupt("return",((o.conference||o.confEndpoints)&&(this.rooms[o.id].conference=o.conference?o.conference:null,this.rooms[o.id].confEndpoints=o.confEndpoints?o.confEndpoints:[]),this.logger.info("[roomService] moderatorUpdateRoomConfig successfully ("+o.id+", "+o.jid+")"),this.rooms[o.id]));case 16:if(t.prev=16,t.t0=t.catch(0),!t.t0.data||!t.t0.data.errorDetails){t.next=21;break}throw s="moderatorUpdateRoomConfig failure: "+t.t0.data.errorDetails,this.logger.error("[roomService] "+s),new Error(s);case 21:return t.next=23,this.errorHelperService.getErrorInfo(t.t0,"ownerUpdateAutoRegister");case 23:throw c=t.sent,this.logger.error("[roomService] "+c.message),c.error;case 25:case"end":return t.stop()}}),t,this,[[0,16]])})))}},{key:"updateMyRoomUser",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r="".concat(this.portalURL,"rooms/").concat(e.dbId,"/users/").concat(_.default.userContact.dbId),i=this.authService.getPostHeader(),a=JSON.stringify({status:t}),n.next=6,fetch(r,{method:"PUT",headers:i,body:a});case 6:if((o=n.sent).ok){n.next=9;break}throw o;case 9:return n.abrupt("return",(this.logger.info("[roomService] updateMyRoomUser "+_.default.userContact.nameForLogs+" to room "+e.dbId+"("+e.getNameForLogs()+") success"),e));case 12:if(n.prev=12,n.t0=n.catch(0),!n.t0.data||!n.t0.data.errorDetails){n.next=17;break}throw s="updateMyRoomUser "+_.default.userContact.nameForLogs+" to room "+e.dbId+"("+e.getNameForLogs()+") failure: "+n.t0.data.errorDetails,this.logger.error("[roomService] "+s),new Error(s);case 17:return n.next=19,this.errorHelperService.getErrorInfo(n.t0,"ownerUpdateAutoRegister");case 19:throw c=n.sent,this.logger.error("[roomService] "+c.message),c.error;case 21:case"end":return n.stop()}}),n,this,[[0,12]])})))}},{key:"unsubscribeMeFromRoom",value:function(e){return this.updateMyRoomUser(e,this.RoomUserStatus.UNSUBSCRIBED)}},{key:"participantCloseRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=_.default.userContact.dbId,t.prev=1,this.logger.info("[roomService] participantCloseRoom"),r="".concat(this.portalURL,"rooms/").concat(e.dbId,"/users/").concat(n),i=this.authService.getRequestHeader(),t.next=7,fetch(r,{method:"DELETE",headers:i});case 7:if((a=t.sent).ok){t.next=10;break}throw a;case 10:return t.abrupt("return",(this.logger.info("[roomService] participantCloseRoom "+n+" from room "+e.dbId+"("+e.getNameForLogs()+") success"),delete this.rooms[e.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e));case 13:if(t.prev=13,t.t0=t.catch(1),!t.t0.data||!t.t0.data.errorDetails){t.next=18;break}throw o="participantCloseRoom "+n+" from room "+e.dbId+"("+e.getNameForLogs()+") failure: "+t.t0.data.errorDetails,this.logger.error("[roomService] "+o),new Error(o);case 18:return t.next=20,this.errorHelperService.getErrorInfo(t.t0,"participantCloseRoom");case 20:throw s=t.sent,this.logger.error("[roomService] "+s.message),s.error;case 22:case"end":return t.stop()}}),t,this,[[1,13]])})))}},{key:"acceptRoomInvitation",value:function(e){return this.updateMyRoomUser(e,this.RoomUserStatus.ACCEPTED)}},{key:"declineRoomInvitation",value:function(e){return this.updateMyRoomUser(e,this.RoomUserStatus.REJECTED)}},{key:"getRoomConferenceEndPoint",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,this.logger.info("[roomService] getRoomConferenceEndPoint"),r="".concat(this.portalURL,"rooms/").concat(e.dbId,"/conference/").concat(t),i=this.authService.getRequestHeader(),n.next=6,fetch(r,{method:"GET",headers:i});case 6:if((a=n.sent).ok){n.next=9;break}throw a;case 9:return n.next=11,a.json();case 11:return o=n.sent.data,n.abrupt("return",(this.logger.info("[roomService] getRoomConferenceEndPoint "+t+" from room "+e.dbId+"success"),o));case 15:if(n.prev=15,n.t0=n.catch(0),!n.t0.data||!n.t0.data.errorDetails){n.next=20;break}throw s="getRoomConferenceEndPoint "+t+" from room "+e.dbId+"failure: "+n.t0.data.errorDetails,this.logger.error("[roomService] "+s),new Error(s);case 20:return n.next=22,this.errorHelperService.getErrorInfo(n.t0,"getRoomConferenceEndPoint");case 22:throw c=n.sent,this.logger.error("[roomService] "+c.message),c.error;case 24:case"end":return n.stop()}}),n,this,[[0,15]])})))}},{key:"addRoomConferenceEndPoint",value:function(e,t,n,i){return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s,c,l,u,d,h;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,this.logger.info("[roomService] addRoomConferenceEndPoint"),t){r.next=3;break}throw new Error("No ConferenceEndPoint to associate with Room");case 3:if(a=!1,e.confEndpoints.forEach((function(e){e.confEndpointId===t.id&&(a=!0)})),!a){r.next=6;break}return r.abrupt("return",(this.logger.info("[roomService] addRoomConferenceEndPoint : already attached to room !"),e));case 6:return o=[],n&&"pstnAudio"===n&&Object.keys(this.rooms).forEach((function(e){this.rooms[e].conference&&!this.rooms[e].conference.scheduled&&this.rooms[e].getPstnConfEndpointId()===t.id&&o.push(this.deleteRoomConferenceEndPoint(this.rooms[e],t.id))})),r.next=10,Promise.all(o);case 10:return s="".concat(this.portalURL,"rooms/").concat(e.dbId,"/conferences"),c=this.authService.getPostHeader(),l=JSON.stringify({confId:t.id,createConversation:i||"true"}),r.next=15,fetch(s,{method:"POST",headers:c,body:l});case 15:if((u=r.sent).ok){r.next=18;break}throw u;case 18:return r.next=20,u.json();case 20:return d=r.sent.data,r.abrupt("return",(this.logger.debug("[roomService] addRoomConferenceEndPoint response data:"+JSON.stringify(d)),e.confEndpoints.push(d),this.logger.info("[roomService] addRoomConferenceEndPoint "+t.id+" to room "+e.dbId+"success"),this.eventService.publish(this.ROOM_ADD_CONF_ENDPOINT_EVENT,e),this.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",e),e));case 24:return r.prev=24,r.t0=r.catch(0),r.next=28,this.errorHelperService.getErrorInfo(r.t0,"addRoomConferenceEndPoint");case 28:throw h=r.sent,this.logger.error("[roomService] "+h.message),h.error;case 30:case"end":return r.stop()}}),r,this,[[0,24]])})))}},{key:"deleteRoomConferenceEndPoint",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c,l;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this.logger.info("[roomService] deleteRoomConferenceEndPoint"),e&&t){n.next=3;break}return n.abrupt("return",void this.logger.info("[roomService] deleteRoomConferenceEndPoint : missing parameters "));case 3:if(r=!1,!e.confEndpoints||!e.confEndpoints.length){n.next=13;break}i=0;case 6:if(!(i<e.confEndpoints.length)){n.next=13;break}if(e.confEndpoints[i].confEndpointId!==t){n.next=10;break}return r=!0,n.abrupt("break",13);case 10:i++,n.next=6;break;case 13:if(r){n.next=15;break}return n.abrupt("return",void this.logger.info("[roomService] deleteRoomConferenceEndPoint : room has no such conference attached"));case 15:return a="".concat(this.portalURL,"rooms/").concat(e.dbId,"/conferences/").concat(t),o=this.authService.getRequestHeader(),n.next=19,fetch(a,{method:"DELETE",headers:o});case 19:if((s=n.sent).ok){n.next=22;break}throw s;case 22:return n.next=24,s.json();case 24:e.confEndpoints=n.sent.data,this.logger.info("[roomService] deleteRoomConferenceEndPoint "+t+" from room "+e.dbId+"success"),this.eventService.publish(this.ROOM_REMOVE_CONF_ENDPOINT_EVENT,e),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",e),n.next=39;break;case 30:return n.prev=30,n.t0=n.catch(0),n.next=34,n.t0.json();case 34:if(c=n.sent.data,l="deleteRoomConferenceEndPoint "+t+" from room "+e.dbId+"failure: "+c.errorDetails,this.logger.error("[roomService] "+l),404===n.t0.status){n.next=38;break}throw new Error(l);case 38:e.confEndpoints=[],this.eventService.publish(this.ROOM_REMOVE_CONF_ENDPOINT_EVENT,e),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",e);case 39:case"end":return n.stop()}}),n,this,[[0,30]])})))}},{key:"inviteGuestEmailToJoinRoom",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,t&&t.length){n.next=3;break}return n.abrupt("return",null);case 3:return this.logger.info("[roomService] inviteGuestEmailToJoinRoom"),r="".concat(this.portalURL,"rooms/").concat(e.dbId,"/invitations"),i=this.authService.getPostHeader(),a=JSON.stringify({scenario:"chat",emails:t,lang:_.default.userContact.language}),n.next=9,fetch(r,{method:"POST",headers:i,body:a});case 9:if((o=n.sent).ok){n.next=12;break}throw o;case 12:return n.next=14,o.json();case 14:return e.guestEmails=n.sent.data.guestEmails,this.eventService.publish("ROOM_UPDATE_EVENT",e),n.abrupt("return",e);case 19:return n.prev=19,n.t0=n.catch(0),n.next=23,this.errorHelperService.getErrorInfo(n.t0,"inviteGuestEmailToJoinRoom");case 23:throw s=n.sent,this.logger.error("[roomService] "+s.message),s.error;case 25:case"end":return n.stop()}}),n,this,[[0,19]])})))}},{key:"ownerCancelGuestFromRoom",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this.logger.info("[roomService] ownerCancelGuestFromRoom"),t&&t.length){n.next=3;break}return n.abrupt("return",Promise.resolve(e));case 3:return r={emails:t,scenario:"chat",lang:_.default.userContact.language},e&&e.isMyPersonalMeetingRoom()&&e.getPstnConfEndpointId()&&(r.scenario="pstn-conference",r.confId=e.getPstnConfEndpointId()),i="".concat(this.portalURL,"rooms/").concat(e.dbId,"/invitations/cancel"),a=this.authService.getPostHeader(),o=JSON.stringify(r),n.next=10,fetch(i,{method:"POST",headers:a,body:o});case 10:if((s=n.sent).ok){n.next=13;break}throw s;case 13:return n.next=15,s.json();case 15:return e.guestEmails=n.sent.guestEmails,this.eventService.publish("ROOM_UPDATE_EVENT",e),n.abrupt("return",e);case 20:return n.prev=20,n.t0=n.catch(0),n.next=24,this.errorHelperService.getErrorInfo(n.t0,"ownerCancelGuestFromRoom");case 24:throw c=n.sent,this.logger.error("[roomService] "+c.message),c.error;case 26:case"end":return n.stop()}}),n,this,[[0,20]])})))}},{key:"notifyRoomUsersJoinConference",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,a,o,s,c,l,u,d,h;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.getPstnConfEndpointId(),r.prev=1,this.logger.info("[roomService] notifyRoomUsersJoinConference"),i){r.next=4;break}return r.abrupt("return",e);case 4:return a=e.desc,o={scenario:"pstn-conference",confId:i,noMail:"false",update:"false",users:t?t.map((function(e){return e.dbId})):void 0,emails:n,instantMessage:a,lang:_.default.userContact.language},s="".concat(this.portalURL,"rooms/").concat(e.dbId,"/invitations"),c=this.authService.getPostHeader(),l=JSON.stringify(o),r.next=11,fetch(s,{method:"POST",headers:c,body:l});case 11:if((u=r.sent).ok){r.next=14;break}throw u;case 14:return r.abrupt("return",(this.logger.info("[roomService] notifyRoomUsersJoinConference "+i+" from room "+e.dbId+"success"),this.rooms[e.dbId].guestEmails=n,this.eventService.publish("ROOM_UPDATE_EVENT",this.rooms[e.dbId]),this.rooms[e.dbId]));case 17:if(r.prev=17,r.t0=r.catch(1),!r.t0.data||!r.t0.data.errorDetails){r.next=22;break}throw d="notifyRoomUsersJoinConference "+i+" from room "+e.dbId+"failure: "+r.t0.data.errorDetails,this.logger.error("[roomService] "+d),new Error(d);case 22:return r.next=24,this.errorHelperService.getErrorInfo(r.t0,"notifyRoomUsersJoinConference");case 24:throw h=r.sent,this.logger.error("[roomService] "+h.message),h.error;case 26:case"end":return r.stop()}}),r,this,[[1,17]])})))}},{key:"notifyUsersCancelConference",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,a,o,s,c,l,u,d;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.getPstnConfEndpointId(),r.prev=1,this.logger.debug("[roomService] notifyUsersCancelConference"),i){r.next=4;break}return r.abrupt("return",e);case 4:return a={scenario:"pstn-conference",confId:i,noMail:"false",users:t?t.map((function(e){return e.dbId})):void 0,emails:n,lang:_.default.userContact.language},o="".concat(this.portalURL,"rooms/").concat(e.dbId,"/invitations"),s=this.authService.getPostHeader(),c=JSON.stringify(a),r.next=10,fetch(o,{method:"DELETE",headers:s,body:c});case 10:if((l=r.sent).ok){r.next=13;break}throw l;case 13:return r.abrupt("return",(this.logger.info("[roomService] notifyUsersCancelConference "+i+" from room "+e.dbId+"success"),this.rooms[e.dbId].guestEmails=this.rooms[e.dbId].guestEmails.filter((function(e){return-1===n.indexOf(e)})),this.eventService.publish("ROOM_UPDATE_EVENT",this.rooms[e.dbId]),this.rooms[e.dbId]));case 16:if(r.prev=16,r.t0=r.catch(1),!r.t0.data||!r.t0.data.errorDetails){r.next=21;break}throw u="notifyUsersCancelConference "+i+" from room "+e.dbId+"failure: "+r.t0.data.errorDetails,this.logger.error("[roomService] "+u),new Error(u);case 21:return r.next=23,this.errorHelperService.getErrorInfo(r.t0,"notifyUsersCancelConference");case 23:throw d=r.sent,this.logger.error("[roomService] "+d.message),d.error;case 25:case"end":return r.stop()}}),r,this,[[1,16]])})))}},{key:"getRoomByConferenceEndpointId",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.info("[roomService] getRoomFromConferenceEndpointId"),n="".concat(this.portalURL,"rooms?userId=").concat(_.default.userContact.dbId,"&confId=").concat(e,"&format=full"),r=this.authService.getRequestHeader(),t.next=6,fetch(n,{method:"GET",headers:r});case 6:if((i=t.sent).ok){t.next=9;break}throw i;case 9:return this.logger.info("[roomService] getRoomFromConferenceEndpointId -- "+e+" -- success"),t.next=12,i.json();case 12:if(!(a=t.sent.data).length){t.next=15;break}return t.abrupt("return",(this.getRoomById(a[0].id)||this.createRoomFromData(a[0]),this.getRoomById(a[0].id)));case 15:throw this.logger.info("[roomService] getRoomFromConferenceEndpointId -- no room with confId "+e),new Error("no room with confId "+e);case 18:if(t.prev=18,t.t0=t.catch(0),!t.t0.data||!t.t0.data.errorDetails){t.next=23;break}throw o="getRoomFromConferenceEndpointId -- "+e+" -- failure: "+t.t0.data.errorDetails,this.logger.error("[roomService] "+o),new Error(o);case 23:return t.next=25,this.errorHelperService.getErrorInfo(t.t0,"getRoomByConferenceEndpointId");case 25:throw s=t.sent,this.logger.error("[roomService] "+s.message),s.error;case 27:case"end":return t.stop()}}),t,this,[[0,18]])})))}},{key:"onRoomMessage",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.info("[roomService] onRoomMessage"),t.prev=1,!((n=$(e).find("event")).length>0)){t.next=7;break}if("conferenceAdd"!==(r=n.attr("name"))&&"conferenceRemove"!==r&&"invitation"!==r){t.next=7;break}return t.abrupt("return",!0);case 7:return i=$(e).find("x").attr("thread"),t.next=10,this.getServerRoom(i);case 10:return a=t.sent,t.abrupt("return",(a.isMeetingRoom()&&this.eventService.publish("MEETING_CREATED_EVENT",a),this.computeInvitationCounter(),this.eventService.publish(this.ROOM_INVITATION,a),this.eventService.publish(this.ROOM_UPDATE_EVENT,a),this.sendEvent(this.ROOM_UPDATE_EVENT,a),!0));case 14:return t.prev=14,t.t0=t.catch(1),t.abrupt("return",(this.logger.error("[roomService] onRoomMessage error "+t.t0),!0));case 17:case"end":return t.stop()}}),t,this,[[1,14]])})))}},{key:"onRoomNotificationMessage",value:function(e){var t=this;try{var n=$(e),r=n.find("x");if(n.find("event").length&&r.length){var i=n.find("event").attr("name");if(!i||"invitation"!==i)return!0;var a=$(r[0]).attr("roomid");if(!a)return this.logger.info("[roomService] onRoomNotificationMessage error -- missing roomId"),!0;this.logger.info("[roomService] onRoomNotificationMessage : room event message with roomId "+a+" and event name "+i),this.getServerRoom(a).then((function(e){e.isMeetingRoom()&&t.eventService.publish("MEETING_CREATED_EVENT",e),e.isWebinarRoom()&&(e.webinarId=n.find("x[webinarid]").attr("webinarid")),"true"===t.settingsService.getSetting("autoAcceptRoomInvite")?t.acceptRoomInvitation(e):(t.computeInvitationCounter(),t.eventService.publish(t.ROOM_INVITATION,e),t.eventService.publish(t.ROOM_UPDATE_EVENT,e),t.sendEvent(t.ROOM_UPDATE_EVENT,e),"accepted"===e.status&&e.confEndpoints&&e.confEndpoints.length&&"webrtc"===e.confEndpoints[0].mediaType&&t.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",e),t.logger.info("[roomService] onRoomNotificationMessage -- get server room success for roomId "+e.dbId+" and roomJid"+e.jid+" and name "+e.getNameForLogs()))})).catch((function(e){t.logger.error("[roomService] onRoomNotificationMessage failure :  impossible to get associated room : "+e.message)}))}return!0}catch(o){return this.logger.error("[roomService] onRoomNotificationMessage error "+o),!0}}},{key:"onRoomInfoMessage",value:function(e){var t=this;this.logger.info("[roomService] onRoomInfoMessage");try{if($(e).find("event").length>0){this.logger.info("[roomService] onRoomInfoMessage : room event message");var n=$(e).attr("from"),r=this.xmppService.getBareJidFromJid(n),i=$(e).find("event").attr("jid"),a=$(e).find("event").attr("name"),o=$(e).attr("id");if(this.logger.info("[roomService] onRoomInfoMessage : room event message with parameters "+r+" || "+i+" || "+a+" || "+o),r&&i&&a&&o){var s=this.getRoomByJid(r);if(!s)return this.manageEventForNonExistingRoom(r,a,i),!0;var c=s.getUserByJid(i);switch(c&&"deleted"!==c.status&&this.eventService.publish(this.ROOM_ADMIN_MESSAGE_EVENT,r,i,a,o),a){case"conferenceAdd":setTimeout((function(){t.getServerRoom(s.dbId).then((function(e){var n=e.confEndpoints&&e.confEndpoints[0]?e.confEndpoints[0].confEndpointId:void 0;e.getPstnConfEndpointId()&&e.isMeetingRoom()&&(t.currentPersonalAudioRoomId=s.dbId),(e.isMeetingRoom()||_.default.userContact.webrtcAudioEnabled)&&(t.logger.info("[roomService] onRoomInfoMessage : conferenceAdd event with conferenceObject related to room : "+n),t.eventService.publish("ROOM_UPDATE_CONFID",e),t.eventService.publish("ROOM_ADD_CONF_ENDPOINT_EVENT",e),t.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",e),e.rxSubject.next(l.RBEvent.create("ROOM_ADD_CONF_ENDPOINT_EVENT")),t.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",e,c))}))}),1e3);break;case"conferenceRemove":this.getServerRoom(s.dbId).then((function(e){s.getPstnConfEndpointId()&&!e.getPstnConfEndpointId()&&(t.currentPersonalAudioRoomId=""),t.logger.info("[roomService] onRoomInfoMessage : conferenceRemove event"),t.eventService.publish("ROOM_REMOVE_CONF_ENDPOINT_EVENT",e),t.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",e),e.rxSubject.next(l.RBEvent.create("ROOM_REMOVE_CONF_ENDPOINT_EVENT")),t.eventService.publish("ON_CONFERENCE_ENDED_INVITATION",e)}));break;case"invitation":!s.isUserModerator(_.default.userContact)||c&&c.status!==this.RoomUserStatus.DELETED||this.getServerRoom(s.dbId).then((function(e){t.eventService.publish(t.ROOM_UPDATE_EVENT,e),t.sendEvent(t.ROOM_UPDATE_EVENT,s)}))}}}else if($(e).find("subject").length>0){var u=$(e).attr("from"),d=this.xmppService.getBareJidFromJid(u),h=this.getRoomByJid(d),f=$(e).find("subject").text();h&&f&&(this.logger.info("[roomService] onRoomInfoMessage : update subject of room"),h.desc=f,this.eventService.publish(this.ROOM_UPDATE_EVENT,h),this.sendEvent(this.ROOM_UPDATE_EVENT,h))}return!0}catch(p){return this.logger.error("[roomService] onRoomInfoMessage error "+p),!0}}},{key:"onRoomHistoryInfoMessage",value:function(e){var t=$(e).find("changed");if(t.length>0){var n=t.attr("with"),r=this.getRoomByJid(n);this.logger.debug("[roomService] onRoomHistoryInfoMessage with "+n),this.eventService.publish(this.ROOM_HISTORY_UPDATE_EVENT,r)}return!0}},{key:"onRoomMessageConfig",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,S,C,w,E,T,k,M,D,x,R,O,I,P,A,L,N,j,U,F,H,W,Y,B,V,G,z,q,J=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=$(e),r=n.find("room"),i=r.attr("userjid"),a=r.attr("status"),!((o=n.find("delay")).length>0&&"Offline Storage"===o.text())){t.next=4;break}return t.abrupt("return",!0);case 4:if(!(r.length>0)){t.next=45;break}if(s=r.attr("roomid"),c="[roomService] onRoomMessageConfig -- management -- ".concat(s," --"),l=this.getRoomById(s),u=!1,!l){t.next=36;break}if(d=r.attr("topic"),((h=r.attr("name"))||d)&&(this.logger.info(c+" update name or topic"),l.name=h,l.desc=d||""),(f=r.find("guests")).length>0&&"update"===f.attr("action")&&(this.logger.info(c+" update guests"),l.guestEmails=[],$(f).find("email").each((function(e,t){l.guestEmails.push(t.textContent)}))),p=r.attr("customData"))try{m=this.extractHtmlContent(p),l.customData=JSON.parse(m),this.logger.info(c+" handle customData")}catch(b){this.logger.error("".concat(c," handle customData -- FAILURE -- ").concat(b.message)),l.customData="{}"}if(v=n.find("avatar"),g=r.attr("lastAvatarUpdateDate"),y=v.length>0&&"delete"===v.attr("action")?"delete":"update",l&&(g||"delete"===y)&&(this.logger.info(c+" update avatar"),u=!0),a&&(this.logger.info(c+" update user status"),(S=l.getUserByJid(i))?this.updateUserStatus(l,S,a):(this.logger.info(c+" update user status -- room exists, but user not. Update the room"),u=!0)),!(C=r.attr("privilege"))){t.next=25;break}if(this.logger.info("".concat(c," update user's privilege ").concat(C)),w=i?l.getUserByJid(i):null,u=!0,"owner"===C&&w&&w.contact&&w.contact.jid===_.default.userContact.jid&&(l.ownerContact=w.contact,l.owner=!0,E=this.i18n.translate("promotedToOwner",{name:escape(l.name)}),this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",E)),t.t0=w&&w.contact,!t.t0){t.next=25;break}return t.next=25,_.default.getContactByDBId(w.contact.dbId,!0);case 25:if((T=r.find("tags"))&&T.length&&(this.logger.info(c+" update room tags"),k=T.attr("action"),this.logger.info("".concat(c," action = ").concat(k)),M=T.find("tag"),"update"===k&&(l.tags=[],M&&M.length&&M.each((function(e,t){var n=t.getAttribute("value"),r=t.getAttribute("color"),i=t.getAttribute("emoji"),a={};n&&(a.tag=n),r&&(a.color=r),i&&(a.emoji=i),l.tags.push(a)})))),t.t1=u,!t.t1){t.next=31;break}return t.next=31,this.updateRoomFromServer(l);case 31:this.eventService.publish(this.ROOM_UPDATE_EVENT,l),this.sendEvent(this.ROOM_UPDATE_EVENT,l),l.rxSubject.next(),t.next=45;break;case 36:if(void 0!==l||!s||this.roomsInProgress[s]||"deleted"===a||"rejected"===a){t.next=44;break}return this.logger.info(c+" room does not exist, create new one"),this.roomsInProgress[s]=!0,t.next=40,this.getServerRoom(s);case 40:D=t.sent,delete this.roomsInProgress[s],this.logger.info(c+" sendInitialRoomPresence to the new room"),this.sendInitialRoomPresence(D),this.updateLater[s]&&(delete this.updateLater[s],this.logger.info("[roomService] onRoomMessageConfig -- later update of the new room"),this.getServerRoom(s).then((function(e){e.updateAvatarInfo()}))),t.next=45;break;case 44:this.roomsInProgress[s]&&(this.updateLater[s]=s);case 45:if(!((x=n.find("openinvite")).length>0)){t.next=59;break}this.logger.info("[roomService] onRoomMessageConfig -- openinvite"),R=x.attr("action"),O=x.find("roomid").text(),I=x.find("openinviteid").text(),P=x.find("roomType").text(),t.t2=R,t.next="update"===t.t2?52:"create"===t.t2?54:"delete"===t.t2?56:58;break;case 52:A=!1,"personal_audio_room"!==P||O||(A=!0),Object.keys(this.openInviteIdByRoomId).forEach((function(e){this.openInviteIdByRoomId[e]&&this.openInviteIdByRoomId[e].openInviteId===I&&e!==O&&(this.logger.info("[roomService] onRoomMessageConfig -- openinviteId removed from "+e),delete this.openInviteIdByRoomId[e],this.openInviteIdByRoomIdSubject.next({openInviteId:I,roomType:P,id:O,action:"deleted"})),A&&"personal_audio_room"===this.openInviteIdByRoomId[e].roomType&&delete this.openInviteIdByRoomId[e]}));case 54:return O&&I&&(this.openInviteIdByRoomId[O]={},this.openInviteIdByRoomId[O].roomType=P,this.openInviteIdByRoomId[O].openInviteId=I,this.openInviteIdByRoomId[O].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+I,this.openInviteIdByRoomIdSubject.next({openInviteId:I,roomType:P,id:O,action:"updated"}),this.logger.info("[roomService] onRoomMessageConfig -- openinviteId "+I+" assigned to room "+O),this.eventService.publish("ON_OPEN_INVITE_ID_UPDATED_EVENT",this.rooms[O]),"personal_audio_room"===P&&this.eventService.publish("ON_PERSONAL_MEETING_OPEN_INVITE_ID_UPDATED_EVENT")),t.abrupt("break",59);case 56:return Object.keys(this.openInviteIdByRoomId).forEach((function(e){this.openInviteIdByRoomId[e]&&this.openInviteIdByRoomId[e].openInviteId===I&&e===O&&(this.logger.info("[roomService] onRoomMessageConfig -- openinviteId removed from "+e),delete this.openInviteIdByRoomId[e],this.openInviteIdByRoomIdSubject.next({openInviteId:I,roomType:P,id:O,action:"deleted"}),this.eventService.publish("ON_OPEN_INVITE_ID_DELETED_EVENT",this.rooms[O]))})),t.abrupt("break",59);case 58:this.logger.info("[roomService] onRoomMessageConfig -- openinviteId - unkown action : "+R);case 59:if(L=n.find("meeting"),!("management"===n.attr("type")&&L.length>0)){t.next=73;break}this.logger.debug("[roomService] onRoomMessageConfig -- management meeting event"),N=L.attr("action"),j=L.find("roomid").length?L.find("roomid").text():"",t.t3=N,t.next="saved"===t.t3?66:"deleted"===t.t3?68:"created"===t.t3?70:"updated"===t.t3?72:73;break;case 66:return this.currentPersonalAudioRoomId="",this.logger.debug("meeting saved: "+j),this.sendEvent("ON_MEETING_SAVED_EVENT",j),t.abrupt("break",73);case 68:return this.logger.debug("meeting deleted: "+j),this.currentPersonalAudioRoomId="",this.sendEvent("ON_MEETING_DELETED_EVENT",j),t.abrupt("break",73);case 70:return this.logger.debug("meeting created: "+j),this.personalAudioRoomId=j,this.currentPersonalAudioRoomId=j,this.sendEvent("ON_MEETING_CREATED_EVENT",j),t.abrupt("break",73);case 72:this.logger.debug("meeting updated: "+j),this.personalAudioRoomId=j,this.currentPersonalAudioRoomId=j,this.sendEvent("ON_MEETING_UPDATED_EVENT",j);case 73:if(U=n.find("roomscontainer"),!("management"===n.attr("type")&&U.length>0)){t.next=90;break}F=U.attr("containerid"),H=U.attr("name"),t.t4=U.attr("action"),t.next="update"===t.t4?79:"create"===t.t4?84:"delete"===t.t4?87:90;break;case 79:return W=[],(Y=U.find("added")).length&&(Y.find("roomid").each((function(e,t){W.push(t.textContent)})),W.forEach((function(e){J.rooms[e]&&(J.rooms[e].containerId=F,J.rooms[e].containerName=H)}))),B=[],(V=U.find("removed")).length&&(V.find("roomid").each((function(e,t){B.push(t.textContent)})),B.forEach((function(e){J.rooms[e]&&(J.rooms[e].containerId="",J.rooms[e].containerName="")}))),(W.length||B.length)&&this.sendEvent(this.ROOM_UPDATE_EVENT,null),t.abrupt("break",90);case 84:return G=[],(z=U.find("added")).length&&(z.find("roomid").each((function(e,t){G.push(t.textContent)})),G.forEach((function(e){J.rooms[e]&&(J.rooms[e].containerId=F,J.rooms[e].containerName=H)}))),G.length&&this.sendEvent(this.ROOM_UPDATE_EVENT,null),t.abrupt("break",90);case 87:return(q=this.getRoomsByContainerId(F)).forEach((function(e){J.rooms[e.dbId].containerId="",J.rooms[e.dbId].containerName=""})),q.length&&this.sendEvent(this.ROOM_UPDATE_EVENT,null),t.abrupt("break",90);case 90:return t.abrupt("return",!0);case 93:return t.prev=93,t.t5=t.catch(0),t.abrupt("return",(this.logger.info("[roomService] onRoomMessageConfig  -- failure -- "+t.t5.message),!0));case 96:case"end":return t.stop()}}),t,this,[[0,93]])})))}},{key:"extractHtmlContent",value:function(e){var t=new DOMParser,n="{}";try{n=t.parseFromString(e,"text/html").documentElement.textContent}catch(r){this.logger.error("[roomService] error in extractHtmlContent:"+r.message),n="{}"}return n}},{key:"onRoomPresence",value:function(e){var t=this;try{var n=$(e),r=n.attr("from"),i=this.xmppService.getBareJidFromJid(r),a=this.xmppService.getResourceFromJid(r),o=n.find("status"),s=null;o.each((function(e,t){"332"===$(t).attr("code")&&(s="332"),"338"===$(t).attr("code")&&(s="338"),"339"===$(t).attr("code")&&(s="339")}));var c=this.getRoomByJid(i);return c&&("338"===s?(this.logger.info("[roomService] onRoomPresence - "+c.dbId+"- Deactivated"),c.isActive=!1,this.eventService.publish(this.ROOM_UPDATE_EVENT,c),this.sendEvent(this.ROOM_UPDATE_EVENT,c)):"339"===s?(this.logger.info("[roomService] onRoomPresence - "+c.dbId+"- Reactivated"),c.initPresenceAck=!1,this.sendInitialRoomPresenceSync(c),c.isActive=!0,this.eventService.publish(this.ROOM_UPDATE_EVENT,c),this.sendEvent(this.ROOM_UPDATE_EVENT,c)):(this.logger.info("[roomService] onRoomPresence -- "+c.dbId),-1!==a.indexOf("/")&&(a=this.xmppService.getBareJidFromJid(a)),_.default.isUserContactJid(a)?"332"===s?(this.logger.error("[roomService] disconnected from room "+c.getNameForLogs()+" because of a system shutdown"),c.initPresenceAck=!1,this.sendInitialRoomPresenceSync(c)):(c.initPresenceAck=!0,this.roomPresenceWaitingList&&this.roomPresenceWaitingList.length&&this.roomPresenceWaitingList.forEach((function(e,n){e.dbId===c.dbId&&t.roomPresenceWaitingList.splice(n,1)})),c.initPresPromise&&(this.logger.info("[roomService] onRoomPresence - initPresPromise resolved"),c.initPresPromiseResolve(c),c.initPresInterval&&(c.initPresInterval.unsubscribe(),c.initPresInterval=null),c.initPresPromise=null,c.initPresPromiseResolve=null,this.eventService.publish(this.ROOM_UPDATE_EVENT,c),this.sendEvent(this.ROOM_UPDATE_EVENT,c))):c.dbId&&!this.rooms[c.dbId]&&this.getServerRoom(c.dbId))),!0}catch(l){return this.logger.error("[roomService] onRoomPresence error "+l),!0}}},{key:"updateUserStatus",value:function(e,t,n){var r=this;if(this.logger.info("[roomService] "+t.status+" || "+n),_.default.isUserContactJid(t.contact.jid)&&t.status!==n)switch(this.logger.info("[roomService] my new status "+n),n){case"deleted":delete this.roomsByJids[e.jid],delete this.rooms[e.dbId],this.logger.info("[roomService] deleteRoom successfully ("+e.dbId+")"),this.sendUnavailableRoomPresence(e),this.computeInvitationCounter(),e.isMeetingRoom()&&this.eventService.publish("MEETING_DELETE_EVENT",e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e,"remove"),this.sendEvent(this.ROOM_UPDATE_EVENT,e);break;case"unsubscribed":this.logger.info("[roomService] unsubscribed successfully ("+e.dbId+")"),this.sendUnavailableRoomPresence(e),e.status=this.RoomUserStatus.UNSUBSCRIBED,t.status=n,e.updateAvatarInfo(),e.isModerator=!1,e.initPresenceAck=!1,this.computeInvitationCounter(),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e);break;case"accepted":e.status=this.RoomUserStatus.ACCEPTED,t.status=n,this.fileStorageService.retrieveReceivedFilesForRoom(e.dbId).then((function(){r.sendInitialRoomPresenceSync(e),e.updateAvatarInfo(),r.computeInvitationCounter(),r.eventService.publish(r.ROOM_UPDATE_EVENT,e),r.sendEvent(r.ROOM_UPDATE_EVENT,e),r.getServerRoom(e.dbId).then((function(e){r.eventService.publish(r.ROOM_UPDATE_EVENT,e),r.sendEvent(r.ROOM_UPDATE_EVENT,e),e.confEndpoints&&e.confEndpoints.length&&"webrtc"===e.confEndpoints[0].mediaType&&r.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",e)})).catch((function(){this.logger.warn("[roomService] getServerRoom "+e.dbId+" failed")}))}));break;case"rejected":delete this.roomsByJids[e.jid],delete this.rooms[e.dbId],e.status=this.RoomUserStatus.REJECTED,t.status=n,this.computeInvitationCounter(),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e)}else t&&!_.default.isUserContactJid(t.contact.jid)&&(this.logger.info("[roomService] Update user with status "+n),t.status===this.RoomUserStatus.DELETED&&n===this.RoomUserStatus.ACCEPTED&&(t.date=new Date,t.privilege===o.Room.Privilege.MODERATOR&&(t.privilege=o.Room.Privilege.USER)),t.status=n,e.updateAvatarInfo(),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_USER_UPDATE_EVENT,{room:e,user:t}))}},{key:"findRoomsWithConfId",value:function(e){return this.getRooms().filter((function(t){return!(!t.confEndpoints||!t.confEndpoints.length)&&t.confEndpoints.some((function(t){return t.confEndpointId===e}))}))}},{key:"removeConfIdInAllRooms",value:function(e){var t=this,n=[];return e.forEach((function(e){e.confEndpoints&&e.confEndpoints.length>0&&n.push(t.deleteRoomConferenceEndPoint(e,e.confEndpoints[0].confEndpointId))})),Promise.all(n)}},{key:"resetOpenInviteId",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="{this.portalURL}users/".concat(_.default.userContact.dbId,'"/public-links/reset'),r=p.default.getRequestHeader(),i=JSON.stringify({roomId:e}),t.next=6,fetch(n,{method:"PUT",headers:r,body:i});case 6:if((a=t.sent).ok){t.next=9;break}throw a;case 9:return t.next=11,a.json();case 11:return o=t.sent.data,t.abrupt("return",(o&&o.openInviteId&&o.roomId&&(this.logger.info("[roomService] resetOpenInviteId success - openinviteId "+o.openInviteId+" bound to room "+e),this.openInviteIdByRoomId[o.roomId]={},this.openInviteIdByRoomId[o.roomId].roomType=o.roomType,this.openInviteIdByRoomId[o.roomId].openInviteId=o.openInviteId,this.openInviteIdByRoomId[o.roomId].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+o.openInviteId),o.openInviteId));case 15:throw t.prev=15,t.t0=t.catch(0),s="resetOpenInviteId failure",this.logger.error("[contactService] "+s),new Error(s);case 19:case"end":return t.stop()}}),t,this,[[0,15]])})))}},{key:"bindOpenInviteIdToRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"users/").concat(_.default.userContact.dbId,"/public-links/bind"),r=this.authService.getPostHeader(),i=JSON.stringify({roomId:e.dbId}),t.next=6,fetch(n,{method:"POST",headers:r,body:i});case 6:if((a=t.sent).ok){t.next=9;break}throw a;case 9:return t.next=11,a.json();case 11:if(!((o=t.sent.data)&&o.roomId&&o.roomType&&o.openInviteId)){t.next=14;break}return t.abrupt("return",(this.logger.info("[roomService] createRoomOpenInviteId -- SUCCESS - room ".concat(o.roomId," with type ").concat(o.roomType," bound to openInviteId ").concat(o.openInviteId)),this.openInviteIdByRoomId[o.roomId]={},this.openInviteIdByRoomId[o.roomId].roomType=o.roomType,this.openInviteIdByRoomId[o.roomId].openInviteId=o.openInviteId,this.openInviteIdByRoomId[o.roomId].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+o.openInviteId,this.rooms[e.dbId]));case 14:throw new Error("[roomService] No or unvalid openInviteData");case 17:return t.prev=17,t.t0=t.catch(0),t.next=21,this.errorHelperService.getErrorInfo(t.t0,"bindOpenInviteIdToRoom");case 21:throw s=t.sent,this.logger.error("[roomService] "+s.message),s.error;case 23:case"end":return t.stop()}}),t,this,[[0,17]])})))}},{key:"unbindOpenInviteFromRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"users/").concat(_.default.userContact.dbId,"/public-links/unbind"),r=this.authService.getPostHeader(),i=JSON.stringify({roomId:e}),t.next=6,fetch(n,{method:"PUT",headers:r,body:i});case 6:if((a=t.sent).ok){t.next=9;break}throw a;case 9:return t.abrupt("return",void this.logger.info("[roomService] openInvite successfully unbound"));case 12:return t.prev=12,t.t0=t.catch(0),t.next=16,this.errorHelperService.getErrorInfo(t.t0,"unbindOpenInviteFromRoom");case 16:throw o=t.sent,this.logger.error("[roomService] "+o.message),o.error;case 18:case"end":return t.stop()}}),t,this,[[0,12]])})))}},{key:"joinRoomUsingOpenInviteId",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=config.restServerUrl+"/api/rainbow/enduser/v1.0/rooms/open-invites",r=this.authService.getPostHeader(),i=JSON.stringify({openInviteId:e}),t.next=6,fetch(n,{method:"POST",headers:r,body:i});case 6:if((a=t.sent).ok){t.next=9;break}throw a;case 9:return t.next=11,a.json();case 11:if(!(o=t.sent.data)||!o.roomId){t.next=14;break}return t.abrupt("return",o.roomId);case 14:throw new Error("No roomId info in openInvitation");case 17:return t.prev=17,t.t0=t.catch(0),t.next=21,this.errorHelperService.getErrorInfo(t.t0,"unbindOpenInviteFromRoom");case 21:throw s=t.sent,this.logger.error("[roomService] "+s.message),s.error;case 23:case"end":return t.stop()}}),t,this,[[0,17]])})))}},{key:"retrieveOpenInviteData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c,l=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.logger.debug("[roomService] retrieveOpenInviteData - type: "+e+" - roomId: "+t),n.prev=1,r="",t&&(r+="?roomId="+t),e&&(r+=r?"&type="+e:"?type="+e),i=this.portalURL+"users/"+_.default.userContact.dbId+"/public-links"+r,a=this.authService.getRequestHeader(),n.next=8,fetch(i,{method:"GET",headers:a});case 8:if((o=n.sent).ok){n.next=11;break}throw o;case 11:return n.next=13,o.json();case 13:(s=n.sent.data)&&s.length?(this.logger.debug("[roomService] retrieveOpenInviteData -- SUCCESS - found "+s.length),s.forEach((function(e){e.roomId&&(l.openInviteIdByRoomId[e.roomId]={},l.openInviteIdByRoomId[e.roomId].roomType=e.roomType,l.openInviteIdByRoomId[e.roomId].openInviteId=e.openInviteId,l.openInviteIdByRoomId[e.roomId].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+e.openInviteId,l.logger.debug("[roomService] retrieveOpenInviteData - openInviteId "+e.openInviteId+" set for room "+e.roomId))}))):this.logger.debug("[roomService] retrieveOpenInviteData -- FAILURE - none found"),n.next=23;break;case 17:return n.prev=17,n.t0=n.catch(1),n.next=21,this.errorHelperService.getErrorInfo(n.t0,"retrieveOpenInviteData");case 21:throw c=n.sent,this.logger.error("[roomService] "+c.message),c.error;case 23:case"end":return n.stop()}}),n,this,[[1,17]])})))}},{key:"retrieveOpenInviteIdForRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.debug("[roomService] retrieveOpenInviteIdForRoom - roomId: "+e),t.prev=1,n="".concat(this.portalURL,"rooms/").concat(e,"/public-links"),r=this.authService.getRequestHeader(),t.next=6,fetch(n,{method:"GET",headers:r});case 6:if((i=t.sent).ok){t.next=9;break}throw i;case 9:return t.next=11,i.json();case 11:return a=t.sent.data,t.abrupt("return",(a.openInviteId&&(this.openInviteIdByRoomId[e]={},this.openInviteIdByRoomId[e].roomType="default",this.openInviteIdByRoomId[e].openInviteId=a.openInviteId,this.openInviteIdByRoomId[e].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+a.openInviteId,this.logger.debug("[roomService] retrieveOpenInviteIdForRoom - openInviteId "+a.openInviteId+" set for room "+e)),a.openInviteId));case 15:return t.prev=15,t.t0=t.catch(1),t.next=19,this.errorHelperService.getErrorInfo(t.t0,"retrieveOpenInviteIdForRoom");case 19:throw o=t.sent,this.logger.error("[roomService] "+o.message),o.error;case 21:case"end":return t.stop()}}),t,this,[[1,15]])})))}},{key:"updateRoomConfEndpoint",value:function(e,t){var n=this,r=this.findRoomsWithConfId(e);r&&r.length&&r.forEach((function(r){r.confEndpoints.forEach((function(n){n.confEndpointId===e&&(n.confEndpointId=t)})),n.getServerRoom(r.dbId).then((function(e){n.eventService.publish(n.ROOM_UPDATE_EVENT,e)})),n.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",r)}))}},{key:"retrievePersonalAudioRoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e||!this.personalAudioRoomId||!this.getRoomById(this.personalAudioRoomId)){t.next=2;break}return t.abrupt("return",(this.logger.debug("[roomService] retrievePersonalAudioRoom from service data"),this.getRoomById(this.personalAudioRoomId)));case 2:return t.prev=2,this.logger.debug("[roomService] retrievePersonalAudioRoom from server"),n=this.portalURL+"meetings/personal",r=this.authService.getRequestHeader(),t.next=8,fetch(n,{method:"GET",headers:r});case 8:if((i=t.sent).ok){t.next=11;break}throw i;case 11:return t.next=13,i.json();case 13:if(!(a=t.sent.data).id){t.next=18;break}return this.personalAudioRoomId=a.id,o=this.getRoomById(a.id),t.abrupt("return",(o?this.updateRoomData(o,a):this.createRoomFromData(a),this.getRoomById(a.id)));case 18:throw new Error("Wrong data from server");case 21:return t.prev=21,t.t0=t.catch(2),t.next=25,this.errorHelperService.getErrorInfo(t.t0,"retrievePersonalAudioRoom");case 25:throw s=t.sent,this.logger.error("[roomService] "+s.message),s.error;case 27:case"end":return t.stop()}}),t,this,[[2,21]])})))}},{key:"retrieveCurrentPersonalAudioRoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e||!this.currentPersonalAudioRoomId||!this.getRoomById(this.currentPersonalAudioRoomId)){t.next=2;break}return t.abrupt("return",(this.logger.debug("[roomService] retrieveCurrentPersonalAudioRoom from service data"),this.getRoomById(this.currentPersonalAudioRoomId)));case 2:return t.prev=2,this.logger.debug("[roomService] retrieveCurrentPersonalAudioRoom from server"),n=this.portalURL+"meetings/current",r=this.authService.getRequestHeader(),t.next=8,fetch(n,{method:"GET",headers:r});case 8:if((i=t.sent).ok){t.next=11;break}throw i;case 11:return t.next=13,i.json();case 13:if(!(a=t.sent.data).id){t.next=18;break}return this.currentPersonalAudioRoomId=a.id,o=this.getRoomById(a.id),t.abrupt("return",(o?this.updateRoomData(o,a):this.createRoomFromData(a),this.getRoomById(a.id)));case 18:throw s=new Error("Wrong data from server"),this.logger.info("[roomService] "+s.message),s;case 22:return t.prev=22,t.t0=t.catch(2),t.next=26,this.errorHelperService.getErrorInfo(t.t0,"retrieveCurrentPersonalAudioRoom");case 26:throw c=t.sent,this.logger.error("[roomService] "+c.message),c.error;case 28:case"end":return t.stop()}}),t,this,[[2,22]])})))}},{key:"reUseMeetingRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c,l;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.debug("[roomService] reUseMeetingRoom - "+e),e){t.next=3;break}throw n=new Error("reUseMeetingRoom - missing parameter"),this.logger.error(n.message),n;case 3:return(r=this.getRoomById(e))&&!r.isActive&&this.sendAvailableRoomPresence(r),t.prev=5,i="".concat(this.portalURL,"meetings/").concat(e,"/reuse"),a=this.authService.getRequestHeader(),t.next=10,fetch(i,{method:"GET",headers:a});case 10:if((o=t.sent).ok){t.next=13;break}throw o;case 13:return t.next=15,o.json();case 15:if(!(s=t.sent.data).id){t.next=20;break}return this.currentPersonalAudioRoomId=s.id,c=this.getRoomById(s.id),t.abrupt("return",(c?this.updateRoomData(c,s):this.createRoomFromData(s),this.getRoomById(s.id)));case 20:throw new Error("Wrong data from server");case 23:return t.prev=23,t.t0=t.catch(5),t.next=27,this.errorHelperService.getErrorInfo(t.t0,"reUseMeetingRoom");case 27:throw l=t.sent,this.logger.error("[roomService] "+l.message),l.error;case 29:case"end":return t.stop()}}),t,this,[[5,23]])})))}},{key:"deletePersonalMeetingRoom",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.debug("[roomService] deletePersonalMeetingRoom"),e.prev=1,t=this.portalURL+"meetings/delete",n=this.authService.getPostHeader(),e.next=6,fetch(t,{method:"PUT",headers:n});case 6:if((r=e.sent).ok){e.next=9;break}throw r;case 9:return e.next=11,r.json();case 11:if(!(i=e.sent.data).id){e.next=15;break}return a=this.getRoomById(i.id),e.abrupt("return",(a?this.updateRoomData(a,i):this.createRoomFromData(i),this.currentPersonalAudioRoomId=i.id,this.personalAudioRoomId=i.id,this.eventService.publish("ON_MEETING_CREATED_EVENT",i.id),a=this.getRoomById(i.id)));case 15:throw new Error("Wrong data from server");case 18:return e.prev=18,e.t0=e.catch(1),e.next=22,this.errorHelperService.getErrorInfo(e.t0,"deletePersonalMeetingRoom");case 22:throw o=e.sent,this.logger.error("[roomService] "+o.message),o.error;case 24:case"end":return e.stop()}}),e,this,[[1,18]])})))}},{key:"saveCurrentPersonalMeetingRoom",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.debug("[roomService] saveCurrentPersonalMeetingRoom"),t.prev=1,n=this.portalURL+"meetings/save",r=this.authService.getPostHeader(),t.next=6,fetch(n,{method:"PUT",headers:r,body:JSON.stringify({name:e})});case 6:if((i=t.sent).ok){t.next=9;break}throw i;case 9:return t.next=11,i.json();case 11:if(!(a=t.sent.data).id){t.next=16;break}return this.currentPersonalAudioRoomId=a.id,o=this.getRoomById(a.id),t.abrupt("return",(o?this.updateRoomData(o,a):this.createRoomFromData(a),this.currentPersonalAudioRoomId=a.id,this.personalAudioRoomId=a.id,this.eventService.publish("ON_MEETING_CREATED_EVENT",a.id),o=this.getRoomById(a.id)));case 16:throw new Error("Wrong data from server");case 19:return t.prev=19,t.t0=t.catch(1),t.next=23,this.errorHelperService.getErrorInfo(t.t0,"saveCurrentPersonalMeetingRoom");case 23:throw s=t.sent,this.logger.error("[roomService] "+s.message),s.error;case 25:case"end":return t.stop()}}),t,this,[[1,19]])})))}},{key:"getPersonalAudioRoomOpenInviteIdLink",value:function(){return this.getOpenInviteIdLinkForRoom(this.personalAudioRoomId)}},{key:"getOpenInviteIdLinkForRoom",value:function(e){return this.openInviteIdByRoomId[e]?this.openInviteIdByRoomId[e].openInviteLink:null}},{key:"getOpenInviteIdForRoom",value:function(e){return this.openInviteIdByRoomId[e]?this.openInviteIdByRoomId[e].openInviteId:null}},{key:"getName",value:function(e){return e.name}},{key:"sortObjectByProperty",value:function(e){return function(t,n){return t[e]<n[e]?-1:t[e]>n[e]?1:0}}},{key:"retrieveRoomConsumption",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.debug("[roomService] retrieveRoomConsumption"),e.prev=1,t=this.portalURL+"rooms/consumption",n=this.authService.getRequestHeader(),e.next=6,fetch(t,{method:"GET",headers:n});case 6:if((r=e.sent).ok){e.next=9;break}throw r;case 9:return e.next=11,r.json();case 11:return i=e.sent.data,e.abrupt("return",(this.logger.debug("[roomService] retrieveRoomConsumption -- SUCCESS -- "+i.currentValue),i.currentValue));case 15:return e.prev=15,e.t0=e.catch(1),e.next=19,this.errorHelperService.getErrorInfo(e.t0,"retrieveRoomConsumption");case 19:throw a=e.sent,this.logger.error("[roomService] "+a.message),a.error;case 21:case"end":return e.stop()}}),e,this,[[1,15]])})))}},{key:"startAdHocConference",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.logger.debug("[roomService] startAdHocConference with ".concat(e," and ").concat(t)),n.prev=1,r=this.portalURL+"adhoc",i=p.default.getPostHeader(),n.next=6,fetch(r,{method:"PUT",headers:i,body:JSON.stringify({calleeId:e,participantIds:t})});case 6:if((a=n.sent).ok){n.next=9;break}throw a;case 9:return n.next=11,a.json();case 11:return o=n.sent.data,n.abrupt("return",(this.logger.debug("[roomService] startAdHocConference -- SUCCESS -- "),o));case 15:return n.prev=15,n.t0=n.catch(1),n.next=19,this.errorHelperService.getErrorInfo(n.t0,"startAdHocConference");case 19:throw s=n.sent,this.logger.error("[roomService] "+s.message),s.error;case 21:case"end":return n.stop()}}),n,this,[[1,15]])})))}},{key:"manageEventForNonExistingRoom",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function i(){var a,o=this;return b.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:i.prev=0,setTimeout((function(){return r(o,void 0,void 0,b.a.mark((function r(){var i,a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.logger.debug("[roomService] manageEventForNonExistingRoom for "+e),i=this.getRoomByJid(e),r.t0=i,r.t0){r.next=7;break}return r.next=6,this.getServerRoomByJid(e);case 6:i=r.sent;case 7:if(a=i.getUserByJid(n),"conferenceAdd"!==t){r.next=12;break}if(i.isMeetingRoom()||_.default.userContact.webrtcAudioEnabled){r.next=11;break}return r.abrupt("return",i);case 11:this.eventService.publish("ROOM_ADD_CONF_ENDPOINT_EVENT",i),this.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",i),this.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",i,a);case 12:return r.abrupt("return",i);case 13:case"end":return r.stop()}}),r,this)})))}),4e3),i.next=10;break;case 4:return i.prev=4,i.t0=i.catch(0),i.next=8,this.errorHelperService.getErrorInfo(i.t0,"manageEventForNonExistingRoom");case 8:throw a=i.sent,this.logger.error("[roomService] "+a.message),a.error;case 10:case"end":return i.stop()}}),i,this,[[0,4]])})))}}],[{key:"getInstance",value:function(){var e=window;return e.rainbow||(e.rainbow={}),e.rainbow.roomService||(e.rainbow.roomService=new n),e.rainbow.roomService}}]),n}(x);t.RoomService=R,t.default=R.getInstance()},function(e,t,n){function r(e){return e}n.d(t,"a",(function(){return r}))},function(e,t,n){function r(e){return"function"==typeof e}n.d(t,"a",(function(){return r}))},function(e,t,n){function r(e){setTimeout((function(){throw e}),0)}n.d(t,"a",(function(){return r}))},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(38),a=function e(){S(this,e),this.message="",this.error=null};t.ErrorHelperInfo=a;var o=function(){function e(){S(this,e)}return C(e,[{key:"getErrorInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return r(this,void 0,void 0,b.a.mark((function r(){var i,o,s,c,l,u,d;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=new a,e instanceof Error&&(i.message=e.message,i.error=e),!(e instanceof Response)){r.next=11;break}return r.next=4,e.json();case 4:o=r.sent,s=o&&o.errorDetailsCode?o.errorDetailsCode:e.status,c=this.getStatusText(o,e),l=this.getErrorText(o),u=e.url?e.url.match(/api\/rainbow\/(\w+)\//)[1]:void 0,d=e.headers&&e.headers.get("x-rainbow-request-id")?" (x-rainbow-request-id:".concat(e.headers.get("x-rainbow-request-id"),")"):"",t&&(i.message=t+" -- "),i.message+="".concat(c," -- ").concat(l),d&&(i.message+=d),i.error=new Error(i.message),i.error.status=e.status,i.error.fieldErrors=this.getBadRequestFieldErrors(o,e),i.error.errorDetails=l,i.error.errorDetailsCode=s,i.error.errorDetailsLabel=this.getErrorCodeLabel(s,u),i.error.translatedMessage=this.getTranslatedErrorMessage(i.error,n,u),i.error.portal=u;case 11:return r.abrupt("return",i);case 12:case"end":return r.stop()}}),r,this)})))}},{key:"getTranslatedErrorMessage",value:function(e,t,n){var r="";return e.errorDetailsCode&&(r=this.getLocalizedError(e.errorDetailsCode,t,n)),r}},{key:"getLocalizedError",value:function(e,t,n){var r="",a=this.getErrorCodeLabel(e,n);if(a){var o=i.default.translate(a,t);o!==a&&(r=o)}return r}},{key:"getErrorText",value:function(e){if(!e)return"Unknow error - Something goes really wrong";var t="";return e.errorDetails?e.errorDetails instanceof Array?e.errorDetails.forEach((function(e){t+=e.msg})):e.errorDetails.msg?t+=JSON.stringify(e.errorDetails.msg):t+=e.errorDetails:e.errorMsg&&(t+=e.errorMsg),t}},{key:"getStatusText",value:function(e,t){switch(e){case-1:return"Service unavailable";case 400:return"Bad request";case 401:return"Authorization failure";case 403:return"Access is forbidden";case 404:return"Resource not found";case 413:return"Request Entity Too Large";case 415:return"Unsupported Media Type";case 500:return"Internal server error";default:return t.statusText?t.statusText:"Unknown error"}}},{key:"getBadRequestFieldErrors",value:function(t,n){var r={},i=t?t.errorDetails:null;return 400===n.status&&i&&(i instanceof Array?i.forEach((function(e){r[e.param]||(r[e.param]={ok:!1,message:e.msg,value:e.value})})):i.param&&(r[i.param]={ok:!1,message:i.msg,value:i.value}),t&&400511===t.errorDetailsCode&&(r.office365Tenant={ok:!1,message:e.ERROR_CODE_LABELS[400511]}),t&&400601===t.errorDetailsCode&&(r.outgoingPrefix={ok:!1,message:e.ERROR_CODE_LABELS[400601]},r.numberingPrefix={ok:!1,message:e.ERROR_CODE_LABELS[400601]})),r}},{key:"getErrorCodeLabel",value:function(t,n){return n&&e.PORTAL_ERROR_CODE_LABELS[n]&&e.PORTAL_ERROR_CODE_LABELS[n][t]?e.PORTAL_ERROR_CODE_LABELS[n][t]:e.ERROR_CODE_LABELS[t]}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.errorHelperService||(t.rainbow.errorHelperService=new e),t.rainbow.errorHelperService}}]),e}();o.ERROR_CODE_LABELS={"-1":"unknownError",0:"errorNoServerResponse",400:"Bad request",4e5:"Bad request",400210:"invalidPhoneNumber",400400:"errorWrongPassword",400500:"invalidFile",400504:"companyNameAlreadyExist",400505:"BPCompanyWithoutPaymentConfigurationData",400506:"NoActiveSubscriptionToOffer",400509:"errorDecreaseSubscriptionForbidden",400511:"ActiveDirectoryDomainAlreadyUsed",400552:"BPCompanyAndECCompanyMustNotBeSame",400601:"outboundAndInternalPrefixesCantBeIdentical",400973:"noCreateUserPermission",400975:"userAlreadyExistsInOtherCompany",400983:"userAlreadyExistsInOtherCompany",400990:"noUserFound",400993:"noUserFound",401:"Authorization failure",401102:"Authorization failure",401202:"errorInvalidToken",401500:"errorUnauthorized",401501:"errorLoginForbidden",401510:"errorUnauthorized",401520:"errorUserNotActive",401521:"errorUserNotActive",403:"Forbidden",403e3:"accessDeniedNotRequiredRole",403001:"accessDeniedNotOwner",403034:"cantDeselectDefaultWebRTCGateway",403035:"cantDeleteDefaultWebRTCGateway",403060:"confLockMsg",403072:"errorIsoMd5Mismatch",403153:"notAllowedToAccessMeeting",403154:"notAllowedToAccessMeeting",403200:"notAllowedToChangeRole",403203:"notAllowedToChangeRole",403204:"notAllowedToMoveExistingUserToThisCompany",403205:"notAllowedToManageUser",403301:"notAllowedToManageCompany",403304:"notAllowedToAddAnotherAdmin",403311:"errorRemoveSyncOngoingSubscriptionForbidden",403315:"errorRemoveSubscriptionForbidden",403316:"errorRemoveAdminAllocatedSubscriptionForbidden",403317:"errorRemoveClientAllocatedSubscriptionForbidden",403400:"notAllowedDeleteAppOwner",403500:"notAllowedBlacklistedEmail",403501:"notAllowedBlacklistedEmail",403503:"NotAllowedSelfRegistrationEmail",403504:"notAllowedLoggedInUserEmail",403507:"notAllowedSupportEmail",403513:"companyNotABpCompany",403516:"companyNotABpCompany",403517:"companySeenAsTerminated",403518:"companyBpTypeIncompatible",403519:"companyAlreadyLinkedToBp",403520:"companyNotVadBp",403526:"isolatedUser",403531:"resetPasswordBlocked",403532:"resetPasswordForbidden",403608:"errorAssignSubscriptionSyncOngoing",403609:"errorAssignSubscriptionSyncOngoing",403610:"maxSubscriptionAllocationReached",403611:"notAllowedToCreateAnEquipment",403615:"maximumNumberConferenceParticipantsReach",403616:"subscriptionCompanyAdminEssentialAlreadyExists",403617:"roleCompanyAdminEssentialAlreadyExists",403620:"MaximumNumberRoomUsersReach",403621:"MaximumNumberConvUsersReach",403624:"notAllowedRemoveService",403625:"errorAllocatedSubscriptionRemoveForbidden",403626:"restrictedConvAccess",403630:"uploadErrorMaxQuotaReached",403655:"userAlreadyCompanyMember",403670:"errorOperationForbiddenOnGuest",403700:"errorDeleteSiteWithSystems",403701:"errorDeleteOrganisationLinkedCompany",403702:"errorDeleteCompanyWithSubscriptions",403703:"errorDeleteCompanyWithSites",403704:"errorDeleteCompanyWithUsers",403705:"errorDeleteCompanyStillTerminated",403706:"errorRemoveBusinessPartnerRole",403719:"externalTrunkChangeForbidden",403721:"numberingPlanCantBeUpdated",403722:"outgoingPrefixChangeForbidden",403723:"cannotRemoveCompanyPublicNumber",403724:"notAllowedDeleteCloudPbxWithPublicNumbers",403725:"notAllowedDeleteCloudPbxWithUsedExtensions",404:"resourceNotFound",404e3:"resourceNotFound",404001:"resourceNotFoundUpdateImpossible",404002:"resourceNotFoundDeleteImpossible",404116:"archivedOrDeletedConversation",404300:"noValidOfferReferenceInACTISFile",404301:"offerNotFound",409e3:"userAlreadyCreated",409005:"inviteUsersError",409011:"noMessagesToExport",409251:"DDIAlreadyAssociatedToCompany",409552:"internalNumberAlreadyUsed",409555:"publicNumberAlreadyExists",409557:"notAllowedDeleteUserAssociatedToCloudPbx",409600:"userAlreadyExist",409601:"invitationReSentConflict",409602:"userAlreadyNetworkMember",409603:"invitationReSentConflict",409620:"offerAlreadySubscribed",409623:"conferenceOfferAlreadySubscribed",409625:"errorUpdateSyncOngoingSubscriptionForbidden",409800:"companyNotIrBp",409801:"companyNotLinkedToBp",409802:"actisCompanyAdminMismatch",409803:"actisCompanyNameMismatch",413e3:"uploadErrorTooLarge",500:"errorInternalServerError",1001:"extensionNotLinkedToEquipment",1002:"extensionHasNoIdentifier",1003:"extensionDoesNotExist",1004:"extensionLookupFailure",1005:"extensionConflict",1006:"nonUniqueEquipmentForExtension",1007:"userAlreadyAssociatedToExtension",1008:"extensionAssociatedToAnotherUser",1009:"failedToAttachExtension",1010:"userHasNoExtension",1011:"userHasTooManyExtensions",1012:"failedToDetachExtension"},o.PORTAL_ERROR_CODE_LABELS={massprovisioning:{4e5:"invalidValue",400501:"invalidFile",400502:"invalidColumnName",400504:"invalidFile",400506:"invalidValueInActionColumn",400600:"deviceTypeCannotBeUpdated",400601:"duplicateDeviceIds",400602:"duplicateMacAdresses",400603:"invalidDeviceTypes",400604:"missingDeviceTypeInLines",400605:"invalidEquipment",403610:"errorMaxSubscriptionReached",404600:"deviceDoesNotExist",404601:"noCloudPbxInCompany"},rvcpprovisioning:{403e3:"overflowConfigurationChangesStillInProgress",403622:"noVoiceLicenceAllocatedToUser",403694:"forbiddenOperationEquipmentHasGroups",403699:"forbiddenOperationEquipmentHasWelcomeService",403728:"forbiddenOperationEquipmentHasDevices",409556:"companyHasAlreadyACloudPbx",409560:"macAddressAlreadyUsed",409561:"deviceStillUsedByUser",409562:"deviceAlreadyUsed",409563:"deviceAlreadyUsedByAnotherSystem",403739:"forbiddenOperationWelcomeServiceUsed",413e3:"fileTooLarge",415e3:"audioFileTypeNotSupported"},authentication:{401102:"Authorization failure",401103:"Authorization failure",401500:"Authorization failure",401520:"Forbidden",401521:"Forbidden",401522:"Forbidden",401523:"Forbidden",401530:"Authorization failure",401600:"Authorization failure",401700:"Authorization failure",403e3:"Authorization failure",5e5:"errorInternalServerError",503e3:"resourceNotFound"},webinar:{403135:"WebinarInvalidRegistrationId"}},t.ErrorHelperService=o,t.default=o.getInstance()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),a=n(15),o=n(3),s=n(10),c=function(){function e(){var t=this;S(this,e),this.isInitialized=!1,this.subject=new s.Subject,this.subscription=i.default.subscribeUpdateEvent("LANGUAGE_UPDATED",(function(){t.updateTranslationLanguage()}))}return C(e,[{key:"subscribe",value:function(e){return this.subject.subscribe(e)}},{key:"configure",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.translator=e,t.next=3,this.updateTranslationLanguage();case 3:case"end":return t.stop()}}),t,this)})))}},{key:"translate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.translator?this.translator.instant(e,t):e}},{key:"getCurrentLanguage",value:function(){return this.translator?this.translator.use():"en"}},{key:"updateTranslationLanguage",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=i.default.getAppliLanguage(),!this.translator){e.next=7;break}return e.next=5,this.translator.use(t.code);case 5:n=e.sent,a.default.info('[I18nService] updateTranslationLanguage -- "'.concat(n,'" labels are loaded')),this.isInitialized=!0,this.subject.next();case 7:o.locale(t.codeMoment),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),a.default.error("[I18nService] updateTranslationLanguage -- failure");case 13:case"end":return e.stop()}}),e,this,[[0,10]])})))}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.i18nService||(t.rainbow.i18nService=new e),t.rainbow.i18nService}}]),e}();t.I18nService=c,t.default=c.getInstance()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.sdkConfig={verboseLog:!0,measurePerformance:!1,unifiedPlan:!1,credentials:{appID:"",appSecret:"",host:"openrainbow.com"},startService:{connection:!0,presence:!0,contacts:!0,conversations:!0,im:!0,telephony:!0,webRTC:!0,bubbles:!0,groups:!0,callsLog:!0,userProfile:!0,favorites:!0,fileStorage:!0,caps:!0,channels:!0,admin:!0},features:{bots:!0,channels:!0,conference:!0,telephony:!0,profileService:!0,roomService:!0,favoriteService:!0,conversationService:!0}}},function(e,t,n){var r,i,a,o,s,c,l,u;e.exports=(u=n(12),n(72),n(73),a=(i=(r=u).lib).Base,o=i.WordArray,c=(s=r.algo).MD5,l=s.EvpKDF=a.extend({cfg:a.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=n.hasher.create(),i=o.create(),a=i.words,s=n.keySize,c=n.iterations;a.length<s;){l&&r.update(l);var l=r.update(e).finalize(t);r.reset();for(var u=1;u<c;u++)l=r.finalize(l),r.reset();i.concat(l)}return i.sigBytes=4*s,i}}),r.EvpKDF=function(e,t,n){return l.create(n).compute(e,t)},u.EvpKDF)},function(e,t,n){n.d(t,"a",(function(){return r}));var r="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},function(e,t,n){n.d(t,"a",(function(){return r}));var r=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(19),a=n(18),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S(this,e),this.id=null,this.dbId=null,this.jid=null,this.fullJid=null,this.jidtel=null,this.login=null,this.temp=!1,this.roster=!1,this.initialized=!1,this.isTerminated=!1,this.ask=null,this.subscription=null,this.guest=!1,this.guestMode=!1,this.confId=null,this.conversation=null,this.personalAudioRoomOpenInviteId=null,this.personalAudioRoomOpenInviteIdSubject=null,this.capabilities=null,this.groups=null,this.nameUpdatePrio=null,this.rxSubject=new r.Subject,this.isBot=!1,this.isBotSharing=!1,this.status=null,this.telStatus=null,this.imStatus=null,this.oldImStatus=null,this.imStatusStamp=null,this.resources=null,this.lastActivityDate=null,this.lastActivityMessage=null,this.statusMessage=null,this.message=null,this.loginEmail=null,this.lastname=null,this.firstname=null,this.initials=null,this.name=null,this.nickname=null,this.title=null,this.jobTitle=null,this.company=null,this.isInDefaultCompany=!1,this.language=null,this.country=null,this.timezone=null,this.tags=null,this._displayName=null,this.nameForLogs=null,this.displayShortName=null,this.displayOrder="FL",this._avatar=null,this.defaultAvatar=null,this.avatarSrc=null,this.calendarState=null,this.phoneProCan=null,this.pbxId=null,this.organisationId=null,this.siteId=null,this.systemId=null,this.phoneNumberId=null,this.phonePbx=null,this.phoneInternalNumber=null,this.mobilePro=null,this.mobileProCan=null,this.isMobileProShared=!1,this.phonePerso=null,this.phonePersoCan=null,this.isPhonePersoShared=!1,this.mobilePerso=null,this.mobilePersoCan=null,this.isMobilePersoShared=!1,this.isVirtualTerm=!1,this.systDeviceName=null,this.voicemailNumber=null,this.hasPhoneNumber=!1,this.hasPhoneProDdiNumber=!1,this.phoneNumbersInitialized=!1,this.isCCDAgentEnabled=!1,this.emailPro=null,this.emailPerso=null,this.note1=null,this.note2=null,this.department=null,this.otherPhoneNumbers=null,this.postalCode=null,this.state=null,this.street=null,this.city=null,this.businessCompanyId=null,this.companyName=null,this.isTv=!1,this.rainbowTvData=null,this.roles=null,this.adminType=null,this.customData=null,this.userTitleNameEnabled=!1,this.alertNotificationEnabledForMyCompany=!1,this.giphyEnabled=!0,this.telephonySettingsEnabled=!0,this.recordConversationEnabled=!0,this.changeSettingsEnabled=!0,this.newUiEnabled=!1,this.denySelfRegister=!1,this._fileSharingEnabled=!1,this._fileStorageEnabled=!1,this._instantMessagesEnabled=!1,this._changePresenceEnabled=!1,this._phoneMeetingsEnabled=!1,this._channelsEnabled=!1,this._roomsEnabled=!1,this._webrtcAudioEnabled=!1,this._webrtcVideoEnabled=!1,this._modifyProfileEnabled=!1,this._useDialOutEnabled=!1,this.id=t,this.dbId=null,this.jid=t,this.fullJid=null,this.jidtel=null,this.login=null,this.temp=!1,this.roster=!1,this.initialized=!1,this.ask="none",this.subscription="none",this.guest=!1,this.confId="",this.conversation=null,this.personalAudioRoomOpenInviteId=null,this.personalAudioRoomOpenInviteIdSubject=new r.BehaviorSubject(this.personalAudioRoomOpenInviteId),this.capabilities=null,this.groups=null,this.nameUpdatePrio=e.NameUpdatePrio.MAX_UPDATE_PRIO,this.status="unknown",this.telStatus="",this.imStatus="offline",this.oldImStatus=null,this.imStatusStamp=[],this.resources={},this.mobileResource=null,this.lastActivityDate=null,this.lastActivityMessage=null,this.statusMessage=null,this.message="",this.loginEmail="",this.lastname="",this.firstname="",this.initials="",this.name={value:this._displayName},this.nameForLogs="",this._displayName=n||t,this.nickname="",this.title="",this.jobTitle="",this.company=i,this.isInDefaultCompany=!1,this.language=null,this.country="",this.timezone="",this.tags=null,this.defaultAvatar=null,this._avatar=null,this.avatarSrc=null,this.calendarState={},this.phonePro="",this.phoneProCan="",this.pbxId="",this.phonePbx="",this.phoneInternalNumber="",this.mobilePro="",this.mobileProCan="",this.isMobileProShared=!1,this.phonePerso="",this.phonePersoCan="",this.isPhonePersoShared=!1,this.mobilePerso="",this.mobilePersoCan="",this.isMobilePersoShared=!1,this.isVirtualTerm=!1,this.systDeviceName=null,this.emailPro="",this.emailPerso="",this.note1="",this.note2="",this.department="",this.otherPhoneNumbers=[],this.postalCode="",this.state="",this.street="",this.city="",this.businessCompanyId="",this.companyName="",this.isTv=!1,this.rainbowTvData={},this.roles=null,this.adminType=null,this.newUiEnabled=!1,this._fileSharingEnabled=!0,this._fileStorageEnabled=!0,this.fileStorageEnabledSubject=new r.BehaviorSubject(!0),this._instantMessagesEnabled=!0,this._changePresenceEnabled=!0,this._phoneMeetingsEnabled=!0,this.phoneMeetingsEnabledSubject=new r.BehaviorSubject(!0),this._channelsEnabled=!0,this._roomsEnabled=!0,this._webrtcAudioEnabled=!0,this._webrtcVideoEnabled=!0,this._modifyProfileEnabled=!0,this._useDialOutEnabled=!0,this.userTitleNameEnabled=!0,this.giphyEnabled=!0,this.isCCDAgentEnabled=!1,this.denySelfRegister=!1}return C(e,[{key:"updateFromUserData",value:function(e){this.dbId=e.id,this.loginEmail=e.loginEmail,this.firstname=e.firstName,this.lastname=e.lastName,this.nickname=e.nickName?e.nickName:"",this.title=e.title?e.title:"",this.jobTitle=e.jobTitle?e.jobTitle:"",this.organisationId=e.organisationId,this.siteId=e.siteId,this.country=e.country?e.country:"FRA",this.timezone=e.timezone,this.roles=e.roles,this.adminType=e.adminType,this.isBot=!1,this.isBotSharing=!1,this.isTerminated=e.isTerminated,this.isInDefaultCompany=e.isInDefaultCompany,this.lastAvatarUpdateDate=e.lastAvatarUpdateDate,this.initialized=e.isInitialized,this.guestMode=!!e.guestMode&&e.guestMode,this.personalAudioRoomOpenInviteId=e.personalAudioRoomOpenInviteId?e.personalAudioRoomOpenInviteId:this.personalAudioRoomOpenInviteId,this.personalAudioRoomOpenInviteIdSubject.next(this.personalAudioRoomOpenInviteId),this.isTv=e.isTv,this.tags=e.tags,this.department=e.department,this.customData=e.customData,this.denySelfRegister=e.denySelfRegister,e.jid_im&&(this.id=e.jid_im,this.jid=e.jid_im,this.jidtel=e.jid_tel),this.company&&this.company.id===e.companyId||(this.company=i.Company.create(e.companyId,e.companyName)),e.fileSharingCustomisation&&(this._fileSharingEnabled="enabled"===e.fileSharingCustomisation),e.fileStorageCustomisation&&(this.fileStorageEnabled="enabled"===e.fileStorageCustomisation),e.userTitleNameCustomisation&&(this.userTitleNameEnabled="enabled"===e.userTitleNameCustomisation),e.instantMessagesCustomisation&&(this._instantMessagesEnabled="enabled"===e.instantMessagesCustomisation),e.overridePresenceCustomisation&&(this._changePresenceEnabled="enabled"===e.overridePresenceCustomisation),e.phoneMeetingCustomisation&&(this.phoneMeetingsEnabled="enabled"===e.phoneMeetingCustomisation),e.useChannelCustomisation&&(this._channelsEnabled="enabled"===e.useChannelCustomisation),e.useRoomCustomisation&&(this._roomsEnabled="enabled"===e.useRoomCustomisation),e.useWebRTCAudioCustomisation&&(this._webrtcAudioEnabled="enabled"===e.useWebRTCAudioCustomisation),e.useWebRTCVideoCustomisation&&(this._webrtcVideoEnabled="enabled"===e.useWebRTCVideoCustomisation),e.userProfileCustomisation&&(this._modifyProfileEnabled="enabled"===e.userProfileCustomisation),e.useGifCustomisation&&(this.giphyEnabled="enabled"===e.useGifCustomisation),e.changeTelephonyCustomisation&&(this.telephonySettingsEnabled="enabled"===e.changeTelephonyCustomisation),e.recordingConversationCustomisation&&(this.recordConversationEnabled="enabled"===e.recordingConversationCustomisation),e.changeSettingsCustomisation&&(this.changeSettingsEnabled="enabled"===e.changeSettingsCustomisation),e.useDialOutCustomisation&&(this.useDialOutEnabled="enabled"===e.useDialOutCustomisation),e.tryNewUiCustomisation&&(this.newUiEnabled="enabled"===e.tryNewUiCustomisation),this.phonePro=this.phoneProCan="",this.phonePbx="",this.phoneInternalNumber="",this.pbxId="",this.mobilePro=this.mobileProCan="",this.phonePerso=this.phonePersoCan="",this.mobilePerso=this.mobilePersoCan="",this.voicemailNumber="",this.systemId="",this.phoneNumberId="",this.hasPhoneNumber=!1,this.hasPhoneProDdiNumber=!1,this.isCCDAgentEnabled=!1,this.customData||(this.customData={});var t=this;e.emails&&(t.emailPerso="",e.emails.forEach((function(e){switch(e.type){case"work":t.emailPro=e.email;break;case"home":t.emailPerso=e.email}}))),e.phoneNumbers&&(e.phoneNumbers.forEach((function(e){var n=e.number,r=e.numberE164,i=e.deviceType;switch(t.hasPhoneNumber=!0,e.type){case"work":"landline"===i&&(e.isCloudPbxDDI?(t.phonePro=e.number,t.phoneProCan=e.numberE164,t.hasPhoneProDdiNumber=!0):t.hasPhoneProDdiNumber||(t.phonePro=n,t.phoneProCan=r),e.isFromSystem&&(t.phonePbx=e.shortNumber,t.isCCDAgentEnabled="CCD agent"===e.userType,e.internalNumber&&(t.phoneInternalNumber=e.internalNumber,"Remote Extension"===e.deviceName||"Any Device"===e.deviceName||0===e.deviceName.search("UA VIRTUAL")?t.isVirtualTerm=!0:t.isVirtualTerm=!1),t.systDeviceName=e.deviceName?e.deviceName:null,t.pbxId=e.pbxId,t.voicemailNumber=e.voiceMailNumber,t.systemId=e.systemId,t.phoneNumberId=e.phoneNumberId)),"mobile"===i&&(t.mobilePro=n,t.isMobileProShared=e.isVisibleByOthers,t.mobileProCan=r);break;case"home":"landline"===i&&(t.phonePerso=n,t.isPhonePersoShared=e.isVisibleByOthers,t.phonePersoCan=r),"mobile"===i&&(t.mobilePerso=n,t.isMobilePersoShared=e.isVisibleByOthers,t.mobilePersoCan=r)}})),this.phoneNumbersInitialized=!0),this.computeDisplayName()}},{key:"containsEmail",value:function(e){var t=e.toLowerCase();return!(!this.loginEmail||this.loginEmail.toLowerCase()!==t)||!(!this.emailPro||this.emailPro.toLowerCase()!==t)||!(!this.emailPerso||this.emailPerso.toLowerCase()!==t)}},{key:"containsPhoneNumber",value:function(e){return!!e&&[this.phonePbx,this.phoneInternalNumber,this.phonePro,this.phoneProCan,this.mobilePro,this.mobileProCan,this.phonePerso,this.phonePersoCan,this.mobilePerso,this.mobilePersoCan].includes(e)}},{key:"getGroups",value:function(){return this.groups}},{key:"setGroups",value:function(e){this.groups=e}},{key:"getPersonalAudioRoomOpenInviteId",value:function(){return this.personalAudioRoomOpenInviteId}},{key:"setPersonalAudioRoomOpenInviteId",value:function(e){this.personalAudioRoomOpenInviteId=e,this.personalAudioRoomOpenInviteIdSubject.next(this.personalAudioRoomOpenInviteId)}},{key:"avatar",get:function(){return this._avatar?this._avatar:this.avatarSrc?(this._avatar={src:this.avatarSrc},this.defaultAvatar=null,this.rxSubject.next({name:"avatar"}),this._avatar):this.defaultAvatar},set:function(e){this._avatar=e}},{key:"getAvatarInBase64",value:function(){var e=this;return new Promise((function(t){try{if(e&&e.avatar&&e.avatar.src||t(),e.avatar.src&&!e.avatar.src.startsWith("data:image/png")){var n=new Image,r=document.createElement("canvas");r.width=120,r.height=120;var i=r.getContext("2d");i.rect(0,0,120,120),i.fillStyle=e.color,i.fill(),n.onload=function(){i.drawImage(n,0,0,120,120),t(r.toDataURL("image/png"))},n.src=e.avatar.src}else t(e.avatar.src)}catch(a){t()}}))}},{key:"getAvatar",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dbId&&this.lastAvatarUpdateDate){var n=a.MD5(a.enc.Latin1.parse(this.lastAvatarUpdateDate)).toString(a.enc.Hex);this.avatarSrc="".concat(this.avatarServerURL,"/api/avatar/").concat(this.dbId,"?size=").concat(e,"&update=").concat(n)}this.createTextAvatarImage(),this.isTv&&(this.defaultAvatar={src:"/resources/skins/rainbow/images/misc/androidtv.svg"}),!t&&this.lastAvatarUpdateDate||(this.avatar=null)}},{key:"createTextAvatarImage",value:function(){var e=new Image,t=document.createElement("canvas");t.width=e.width=225,t.height=e.height=225;var n=t.getContext("2d");n.rect(0,0,225,225),n.fillStyle=this.color,n.fill(),n.font="bold 100px Helvetica",n.textAlign="center",n.fillStyle="white",n.fillText(this.initials,110,150),e.src=t.toDataURL("image/png"),this.defaultAvatar=e}},{key:"displayName",get:function(){return this._displayName},set:function(e){this._displayName=e,this.nameForLogs=config&&config.debug?e:e.charAt(0)+e.replace(/[^\s](?=.{1,}$)/g,"*").substr(1),this.name.value=e,this.rxSubject.next({name:"displayName"})}},{key:"updateName",value:function(e,t){this.firstname=e,this.lastname=t,this.computeDisplayName(),this.getAvatar()}},{key:"computeDisplayName",value:function(){var t=this.firstname?this.firstname.charAt(0).toUpperCase()+this.firstname.slice(1):null,n=this.lastname?this.lastname.charAt(0).toUpperCase()+this.lastname.slice(1):null,r=this.nickname?this.nickname.charAt(0).toUpperCase()+this.nickname.slice(1):null;this.isTv?(this.displayName=t||n,this.initials=this.displayName.charAt(0)):n&&t?"FL"===this.displayOrder?(this.displayName=t+" "+n,this.displayShortName=t+" "+n.charAt(0),this.initials=t.charAt(0)+n.charAt(0)):(this.displayName=n+" "+t,this.displayShortName=n+" "+t.charAt(0),this.initials=n.charAt(0)+t.charAt(0)):n&&!t?(this.displayName=this.displayShortName=n,this.initials=n.charAt(0)):r?(this.displayName=r,this.displayShortName=r,this.initials=r.charAt(0)):this.loginEmail?(this.displayName=this.loginEmail,this.displayShortName=this.loginEmail,this.initials=this.loginEmail.substring(0,2).toUpperCase()):t?(this.displayName=t,this.initials=t.charAt(0)):(this.displayName="Anonymous",this.displayShortName="Anonymous",this.initials="A");for(var i=this.displayName.toUpperCase(),a=0,o=0;o<i.length;o++)a+=i.charCodeAt(o);this.colorIndex=a%12,this.color=e.textAvatarColor[this.colorIndex],this.colorName=e.textAvatarName[this.colorIndex]}},{key:"isCPaaSGuest",value:function(){return this.roles.indexOf("guest")>=0}},{key:"isGuest",value:function(){return this.guestMode}},{key:"isAnonymousGuest",value:function(){return"A"===this.initials||"Anonymous"===this.displayName}},{key:"isBadGuest",value:function(){return this.displayName.startsWith("__guest__")||this.displayName.startsWith("__##__guest__##__")}},{key:"isGuestInitialized",value:function(){return null!==this.firstname&&this.firstname.length>0&&null!==this.lastname&&this.lastname.length>0&&"__##__guest__##__"!==this.firstname}},{key:"hasAdminRights",value:function(){return this.isSuperadmin()||this.isBusinessAdmin()||this.isAdmin()||this.isBPAdmin()}},{key:"isSuperadmin",value:function(){return this.roles.indexOf("superadmin")>=0}},{key:"isBusinessAdmin",value:function(){return this.roles.indexOf("business_admin")>=0}},{key:"isOrganizationAdmin",value:function(){return this.roles.indexOf("admin")>=0&&this.adminType===e.AdminType.ORGANIZATION_ADMIN}},{key:"isCompanyAdmin",value:function(){return this.roles.indexOf("admin")>=0&&this.adminType===e.AdminType.COMPANY_ADMIN}},{key:"isSiteAdmin",value:function(){return this.roles.indexOf("admin")>=0&&this.adminType===e.AdminType.SITE_ADMIN}},{key:"isAdmin",value:function(){return this.roles.indexOf("admin")>=0&&(!this.isOrganizationAdmin()||!this.isBPAdmin())}},{key:"isECAdmin",value:function(){return this.company&&!this.company.isBP&&this.isAdmin()}},{key:"isBPAdmin",value:function(){return this.isBPAdminOperations()||this.isBPAdminFinance()}},{key:"isBPAdminOperations",value:function(){return this.company&&this.company.isBP&&this.roles.indexOf("bp_admin")>=0}},{key:"isBPAdminFinance",value:function(){return this.company&&this.company.isBP&&this.roles.indexOf("bp_finance")>=0}},{key:"isBPAdminDR",value:function(){return this.isBPAdmin()&&this.company.isDR()}},{key:"isBPAdminVAD",value:function(){return this.isBPAdmin()&&this.company.isVAD()}},{key:"isBPAdminIR",value:function(){return this.isBPAdmin()&&this.company.isIR()}},{key:"isDirectoryAdmin",value:function(){return this.roles.indexOf("directory_admin")>=0}},{key:"getAdminType",value:function(){return this.roles.indexOf("admin")>=0?this.adminType:e.AdminType.UNDEFINED}},{key:"fileSharingEnabled",get:function(){return this._fileSharingEnabled},set:function(e){this._fileSharingEnabled=e,this.rxSubject.next({name:"fileSharingEnabled"})}},{key:"fileStorageEnabled",get:function(){return this._fileStorageEnabled},set:function(e){this._fileStorageEnabled=e,this.fileStorageEnabledSubject.next(this._fileStorageEnabled),this.rxSubject.next({name:"fileStorageEnabled"})}},{key:"instantMessagesEnabled",get:function(){return this._instantMessagesEnabled},set:function(e){this._instantMessagesEnabled=e,this.rxSubject.next({name:"instantMessagesEnabled"})}},{key:"changePresenceEnabled",get:function(){return this._changePresenceEnabled},set:function(e){this._changePresenceEnabled=e,this.rxSubject.next({name:"changePresenceEnabled"})}},{key:"phoneMeetingsEnabled",get:function(){return this._phoneMeetingsEnabled},set:function(e){this._phoneMeetingsEnabled=e,this.phoneMeetingsEnabledSubject.next(this._phoneMeetingsEnabled),this.rxSubject.next({name:"phoneMeetingsEnabled"})}},{key:"channelsEnabled",get:function(){return this._channelsEnabled},set:function(e){this._channelsEnabled=e,this.rxSubject.next({name:"channelsEnabled"})}},{key:"roomsEnabled",get:function(){return this._roomsEnabled},set:function(e){this._roomsEnabled=e,this.rxSubject.next({name:"roomsEnabled"})}},{key:"webrtcAudioEnabled",get:function(){return this._webrtcAudioEnabled},set:function(e){this._webrtcAudioEnabled=e,this.rxSubject.next({name:"webrtcAudioEnabled"})}},{key:"webrtcVideoEnabled",get:function(){return this._webrtcVideoEnabled},set:function(e){this._webrtcVideoEnabled=e,this.rxSubject.next({name:"webrtcVideoEnabled"})}},{key:"modifyProfileEnabled",get:function(){return this._modifyProfileEnabled},set:function(e){this._modifyProfileEnabled=e,this.rxSubject.next({name:"modifyProfileEnabled"})}},{key:"useDialOutEnabled",get:function(){return this._useDialOutEnabled},set:function(e){this._useDialOutEnabled=e,this.rxSubject.next({name:"useDialOutEnabled"})}},{key:"toString",value:function(){return this.nameForLogs}}]),e}();o.AdminType={ORGANIZATION_ADMIN:"organization_admin",COMPANY_ADMIN:"company_admin",SITE_ADMIN:"site_admin",UNDEFINED:"undefined"},o.NameUpdatePrio={NO_UPDATE_PRIO:0,OUTLOOK_UPDATE_PRIO:1,SERVER_UPDATE_PRIO:2,MAX_UPDATE_PRIO:99},o.textAvatarColor=["#ca8741","#e44647","#c62582","#9b4ce7","#6573ee","#1b70e0","#6ec7d9","#98d1b1","#7fbd40","#b2d334","#dcd232","#f1be00"],o.textAvatarName=["purple-lavender","purple-violet","red-coral","blue-jeanlouisdavid","green-mint","green-yellow","orange-jade","pink-lady","yellow-submarine","blue-teal"],t.Contact=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];S(this,e),this.isFavorite=!1,this.users=[],this.sortedUserList=[],this.id=t,this.name=n,this.comment=r,this.isFavorite=i}return C(e,null,[{key:"createFromData",value:function(t){return new e(t.id,t.name,t.comment,t.isFavorite)}}]),e}();t.Group=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(263),i=n(264),a=n(78),o=n(265),s=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this._parentOrParents,s=this._ctorUnsubscribe,l=this._unsubscribe,u=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var d=0;d<n.length;++d)n[d].remove(this);if(a.isFunction(l)){s&&(this._unsubscribe=void 0);try{l.call(this)}catch(p){t=p instanceof o.UnsubscriptionError?c(p.errors):[p]}}if(r.isArray(u)){d=-1;for(var h=u.length;++d<h;){var f=u[d];if(i.isObject(f))try{f.unsubscribe()}catch(p){t=t||[],p instanceof o.UnsubscriptionError?t=t.concat(c(p.errors)):t.push(p)}}}if(t)throw new o.UnsubscriptionError(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var a=this._subscriptions;return null===a?this._subscriptions=[n]:a.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=((t=new e).closed=!0,t),e}();function c(e){return e.reduce((function(e,t){return e.concat(t instanceof o.UnsubscriptionError?t.errors:t)}),[])}t.Subscription=s},function(e,t,n){var r,i,a;e.exports=(a=n(12),i=(r=a).lib.WordArray,r.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],a=0;a<n;a+=3)for(var o=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<n;s++)i.push(r.charAt(o>>>6*(3-s)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var a=0;a<n.length;a++)r[n.charCodeAt(a)]=a}var o=n.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return function(e,t,n){for(var r=[],a=0,o=0;o<t;o++)if(o%4){var s=n[e.charCodeAt(o-1)]<<o%4*2,c=n[e.charCodeAt(o)]>>>6-o%4*2;r[a>>>2]|=(s|c)<<24-a%4*8,a++}return i.create(r,a)}(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},a.enc.Base64)},function(e,t,n){var r;e.exports=(r=n(12),function(e){var t=r,n=t.lib,i=n.WordArray,a=n.Hasher,o=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=o.MD5=a.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var a=this._hash.words,o=e[t+0],c=e[t+1],f=e[t+2],p=e[t+3],m=e[t+4],v=e[t+5],g=e[t+6],y=e[t+7],b=e[t+8],S=e[t+9],_=e[t+10],C=e[t+11],w=e[t+12],E=e[t+13],T=e[t+14],k=e[t+15],M=a[0],D=a[1],x=a[2],R=a[3];M=l(M,D,x,R,o,7,s[0]),R=l(R,M,D,x,c,12,s[1]),x=l(x,R,M,D,f,17,s[2]),D=l(D,x,R,M,p,22,s[3]),M=l(M,D,x,R,m,7,s[4]),R=l(R,M,D,x,v,12,s[5]),x=l(x,R,M,D,g,17,s[6]),D=l(D,x,R,M,y,22,s[7]),M=l(M,D,x,R,b,7,s[8]),R=l(R,M,D,x,S,12,s[9]),x=l(x,R,M,D,_,17,s[10]),D=l(D,x,R,M,C,22,s[11]),M=l(M,D,x,R,w,7,s[12]),R=l(R,M,D,x,E,12,s[13]),x=l(x,R,M,D,T,17,s[14]),M=u(M,D=l(D,x,R,M,k,22,s[15]),x,R,c,5,s[16]),R=u(R,M,D,x,g,9,s[17]),x=u(x,R,M,D,C,14,s[18]),D=u(D,x,R,M,o,20,s[19]),M=u(M,D,x,R,v,5,s[20]),R=u(R,M,D,x,_,9,s[21]),x=u(x,R,M,D,k,14,s[22]),D=u(D,x,R,M,m,20,s[23]),M=u(M,D,x,R,S,5,s[24]),R=u(R,M,D,x,T,9,s[25]),x=u(x,R,M,D,p,14,s[26]),D=u(D,x,R,M,b,20,s[27]),M=u(M,D,x,R,E,5,s[28]),R=u(R,M,D,x,f,9,s[29]),x=u(x,R,M,D,y,14,s[30]),M=d(M,D=u(D,x,R,M,w,20,s[31]),x,R,v,4,s[32]),R=d(R,M,D,x,b,11,s[33]),x=d(x,R,M,D,C,16,s[34]),D=d(D,x,R,M,T,23,s[35]),M=d(M,D,x,R,c,4,s[36]),R=d(R,M,D,x,m,11,s[37]),x=d(x,R,M,D,y,16,s[38]),D=d(D,x,R,M,_,23,s[39]),M=d(M,D,x,R,E,4,s[40]),R=d(R,M,D,x,o,11,s[41]),x=d(x,R,M,D,p,16,s[42]),D=d(D,x,R,M,g,23,s[43]),M=d(M,D,x,R,S,4,s[44]),R=d(R,M,D,x,w,11,s[45]),x=d(x,R,M,D,k,16,s[46]),M=h(M,D=d(D,x,R,M,f,23,s[47]),x,R,o,6,s[48]),R=h(R,M,D,x,y,10,s[49]),x=h(x,R,M,D,T,15,s[50]),D=h(D,x,R,M,v,21,s[51]),M=h(M,D,x,R,w,6,s[52]),R=h(R,M,D,x,p,10,s[53]),x=h(x,R,M,D,_,15,s[54]),D=h(D,x,R,M,c,21,s[55]),M=h(M,D,x,R,b,6,s[56]),R=h(R,M,D,x,k,10,s[57]),x=h(x,R,M,D,g,15,s[58]),D=h(D,x,R,M,E,21,s[59]),M=h(M,D,x,R,m,6,s[60]),R=h(R,M,D,x,C,10,s[61]),x=h(x,R,M,D,f,15,s[62]),D=h(D,x,R,M,S,21,s[63]),a[0]=a[0]+M|0,a[1]=a[1]+D|0,a[2]=a[2]+x|0,a[3]=a[3]+R|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var a=e.floor(r/4294967296),o=r;n[15+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,c=s.words,l=0;l<4;l++){var u=c[l];c[l]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return s},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,n,r,i,a,o){var s=e+(t&n|~t&r)+i+o;return(s<<a|s>>>32-a)+t}function u(e,t,n,r,i,a,o){var s=e+(t&r|n&~r)+i+o;return(s<<a|s>>>32-a)+t}function d(e,t,n,r,i,a,o){var s=e+(t^n^r)+i+o;return(s<<a|s>>>32-a)+t}function h(e,t,n,r,i,a,o){var s=e+(n^(t|~r))+i+o;return(s<<a|s>>>32-a)+t}t.MD5=a._createHelper(c),t.HmacMD5=a._createHmacHelper(c)}(Math),r.MD5)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(230),i=n(231),a=n(57),o=n(398),s=n(399);function c(e){return e.reduce((function(e,n){return"b"!==n.type||"SimpleBlock"!==n.name?e:t.ebmlBlock(n.data).frames.some((function(e){return"9d012a"===e.slice(3,6).toString("hex")}))?e.concat(n):e}),[])}function l(e){var n=u("VP8 ",e);return u("RIFF",v([new t.Buffer("WEBP","ascii"),n]))}function u(e,n){var r=new t.Buffer(4);return r.writeUInt32LE(n.byteLength,0),v([new t.Buffer(e.substr(0,4),"ascii"),r,n,new t.Buffer(n.byteLength%2==0?0:1)])}function d(e,t){for(var n=-1,r=0;r<t.length;r++){var i=t[r];if(i.name===e){if("m"!==i.type)return void t.splice(r,1);if(i.isEnd){if(-1==n)throw new Error("Detected "+e+" closing element before finding the start");return void t.splice(n,r-n+1)}n=r}}}function h(e,t){for(var n=[],r=-1,i=0;i<t.length;i++){var a=t[i];if(a.name===e){if("m"!==a.type){n.push(t[i]);break}if(a.isEnd){if(-1==r)throw new Error("Detected "+e+" closing element before finding the start");n=t.slice(r,i+1);break}r=i}}return n}function f(e){var t=new i.default;return e.reduce((function(e,n){return e.concat(t.encode([n]))}),[]).reduce((function(e,t){return e+t.byteLength}),0)}function p(e,n,r){var i=r.duration,a=r.clusterPtrs,o=r.cues,s=e.slice(0);if("number"==typeof i){var c=!1;s.forEach((function(e){"f"===e.type&&"Duration"===e.name&&(c=!0,e.data=b(i,8))})),c||m(s,"Info",[{name:"Duration",type:"f",data:b(i,8)}])}Array.isArray(o)&&m(s,"Cues",function(e,t){var n=[];return e.forEach((function(e){var r=e.CueTrack,i=e.CueClusterPosition,a=e.CueTime;n.push({name:"CuePoint",type:"m",isEnd:!1}),n.push({name:"CueTime",type:"u",data:g(a)}),n.push({name:"CueTrackPositions",type:"m",isEnd:!1}),n.push({name:"CueTrack",type:"u",data:g(r)}),n.push({name:"CueClusterPosition",type:"u",data:g(i+t)}),n.push({name:"CueTrackPositions",type:"m",isEnd:!0}),n.push({name:"CuePoint",type:"m",isEnd:!0})})),n}(o,n));var l=[];return Array.isArray(a)&&(console.warn("append cluster pointers to seekhead is deprecated. please use cues"),l=function(e,n){var r=[];return e.forEach((function(e){r.push({name:"Seek",type:"m",isEnd:!1}),r.push({name:"SeekID",type:"b",data:new t.Buffer([31,67,182,117])}),r.push({name:"SeekPosition",type:"u",data:g(e+n)}),r.push({name:"Seek",type:"m",isEnd:!0})})),r}(a,n)),m(s,"SeekHead",l,!0),s}function m(e,t,n,r){void 0===r&&(r=!1);for(var i=-1,a=0;a<e.length;a++){var o=e[a];if("m"===o.type&&o.name===t&&!1===o.isEnd){i=a;break}}i>=0?Array.prototype.splice.apply(e,[i+1,0].concat(n)):r?[].concat([{name:t,type:"m",isEnd:!1}],n,[{name:t,type:"m",isEnd:!0}]).reverse().forEach((function(t){e.unshift(t)})):(e.push({name:t,type:"m",isEnd:!1}),n.forEach((function(t){e.push(t)})),e.push({name:t,type:"m",isEnd:!0}))}function v(e){for(var n=0,r=0;n<e.length;++n)r+=e[n].length;var i=t.Buffer.allocUnsafe(r),a=0;for(n=0;n<e.length;++n){var o=e[n];o.copy(i,a),a+=o.length}return i}function g(e){for(var n=1;e>=Math.pow(2,8*n);n++);if(n>=7)return console.warn("7bit or more bigger uint not supported."),new r.Uint64BE(e).toBuffer();var i=new t.Buffer(n);return i.writeUIntBE(e,0,n),i}function y(e){for(var n=1;e>=Math.pow(2,8*n);n++);if(n>=7)return console.warn("7bit or more bigger uint not supported."),new r.Int64BE(e).toBuffer();var i=new t.Buffer(n);return i.writeIntBE(e,0,n),i}function b(e,n){var r;if(void 0===n&&(n=8),8===n)return(r=new t.Buffer(8)).writeDoubleBE(e,0),r;if(4===n)return(r=new t.Buffer(4)).writeFloatBE(e,0),r;throw new Error("float type bits must 4bytes or 8bytes")}t.Buffer=a.Buffer,t.readVint=o.readVint,t.writeVint=o.writeVint,t.ebmlBlock=s,t.readBlock=function(e){return t.ebmlBlock(new t.Buffer(e))},t.encodeTag=function(e,n,r){return void 0===r&&(r=!1),v([e,r?new t.Buffer("01ffffffffffffff","hex"):t.writeVint(n.length),n])},t.WebPFrameFilter=function(e){return c(e).reduce((function(e,n){return t.ebmlBlock(n.data).frames.reduce((function(e,t){var n=l(t),r=new Blob([n],{type:"image/webp"});return e.concat(r)}),e)}),[])},t.WebPBlockFilter=c,t.VP8BitStreamToRiffWebPBuffer=l,t.createRIFFChunk=u,t.makeMetadataSeekable=function(e,n,r){var a=h("EBML",e),o=f(a)+12,s=e[e.length-1].dataEnd-o,c=h("Info",e);d("Duration",c),c.splice(1,0,{name:"Duration",type:"f",data:b(n,8)});for(var l=f(c),u=h("Tracks",e),p=f(u),m=47,v=[],y=5+15*r.length,S=[],_=-1,C=function(e){var n=m,i=n+l,a=i+p,c=a+y-s;if((v=[]).push({name:"SeekHead",type:"m",isEnd:!1}),v.push({name:"Seek",type:"m",isEnd:!1}),v.push({name:"SeekID",type:"b",data:new t.Buffer([21,73,169,102])}),v.push({name:"SeekPosition",type:"u",data:g(n)}),v.push({name:"Seek",type:"m",isEnd:!0}),v.push({name:"Seek",type:"m",isEnd:!1}),v.push({name:"SeekID",type:"b",data:new t.Buffer([22,84,174,107])}),v.push({name:"SeekPosition",type:"u",data:g(i)}),v.push({name:"Seek",type:"m",isEnd:!0}),v.push({name:"Seek",type:"m",isEnd:!1}),v.push({name:"SeekID",type:"b",data:new t.Buffer([28,83,187,107])}),v.push({name:"SeekPosition",type:"u",data:g(a)}),v.push({name:"Seek",type:"m",isEnd:!0}),v.push({name:"SeekHead",type:"m",isEnd:!0}),m=f(v),(S=[]).push({name:"Cues",type:"m",isEnd:!1}),r.forEach((function(e){var t=e.CueTrack,n=e.CueClusterPosition,r=e.CueTime;S.push({name:"CuePoint",type:"m",isEnd:!1}),S.push({name:"CueTime",type:"u",data:g(r)}),S.push({name:"CueTrackPositions",type:"m",isEnd:!1}),S.push({name:"CueTrack",type:"u",data:g(t)}),n-=o,n+=c,S.push({name:"CueClusterPosition",type:"u",data:g(n)}),S.push({name:"CueTrackPositions",type:"m",isEnd:!0}),S.push({name:"CuePoint",type:"m",isEnd:!0})})),S.push({name:"Cues",type:"m",isEnd:!0}),y=f(S),_===c)return"break";if(_=c,9===e)throw new Error("Failed to converge to a stable metadata size")},w=0;w<10&&"break"!==C(w);w++);var E=[].concat.apply([],[a,{name:"Segment",type:"m",isEnd:!1,unknownSize:!0},v,c,u,S]);return(new i.default).encode(E)},t.removeElement=d,t.extractElement=h,t.putRefinedMetaData=function(e,n){Array.isArray(n.cueInfos)&&!Array.isArray(n.cues)&&(console.warn("putRefinedMetaData: info.cueInfos property is deprecated. please use info.cues"),n.cues=n.cueInfos);for(var r=[],a=[],o=0;o<e.length;o++){var s=e[o];if("m"===s.type&&"Segment"===s.name){if(r=e.slice(0,o),a=e.slice(o),s.unknownSize){a.shift();break}throw new Error("this metadata is not streaming webm file")}}if(!(a[a.length-1].dataEnd>0))throw new Error("metadata dataEnd has wrong number");var c,l=a[a.length-1].dataEnd,u=r[r.length-1].dataEnd,d=(new i.default).encode(r).byteLength-u,h=l-a[0].tagStart,f=(a[0].tagStart,a[0].tagStart,new t.Buffer([24,83,128,103])),m=new t.Buffer("01ffffffffffffff","hex"),v=f.byteLength+m.byteLength,g=h;for(c=1;c<20;c++){var y=p(a,d+(u+v+g-l),n),b=(new i.default).encode(y).byteLength;if(b===g)return(new i.default).encode([].concat(r,[{type:"m",name:"Segment",isEnd:!1,unknownSize:!0}],y));g=b}throw new Error("unable to refine metadata, stable size could not be found in "+c+" iterations!")},t.concat=v,t.encodeValueToBuffer=function(e){var n=new t.Buffer(0);if("m"===e.type)return e;switch(e.type){case"u":n=g(e.value);break;case"i":n=y(e.value);break;case"f":n=b(e.value);break;case"s":n=new t.Buffer(e.value,"ascii");break;case"8":n=new t.Buffer(e.value,"utf8");break;case"b":n=e.value;break;case"d":n=new r.Int64BE(e.value.getTime().toString()).toBuffer()}return Object.assign({},e,{data:n})},t.createUIntBuffer=g,t.createIntBuffer=y,t.createFloatBuffer=b,t.convertEBMLDateToJSDate=function(e){return e instanceof Date?e:new Date(new Date("2001-01-01T00:00:00.000Z").getTime()+Number(e)/1e3/1e3)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(15),i=function(){function e(){S(this,e),this.queue=[],this.started=!1}return C(e,[{key:"add",value:function(e){this.queue.push(e),this.started||(this.started=!0,this.execute())}},{key:"execute",value:function(){var e=this,t=this.queue.shift();if(t)try{this.timeoutPromise(2e4,t).then((function(){e.execute()})).catch((function(t){var n=t&&t.message?t.message:"Unknown error";r.default.error("[PromiseQueue] execute failure -- "+n),e.execute()}))}catch(a){var n=a&&a.message?a.message:"Unknown error",i=a&&a.stack?a.stack:"Unknown stack";r.default.error("[PromiseQueue] execution exception  -- ".concat(n," : ").concat(i)),this.execute()}else this.started=!1}},{key:"timeoutPromise",value:function(e,t){var n=null,r=new Promise((function(t,r){n=setTimeout((function(){r(new Error("Timed out in "+e+"ms."))}),e)}));return Promise.race([t(),r]).then((function(e){return clearTimeout(n),e}))}}],[{key:"create",value:function(){return new e}}]),e}();t.PromiseQueue=i},function(e,t,n){function r(e){return null!==e&&"object"==typeof e}n.d(t,"a",(function(){return r}))},function(e,t,n){n.d(t,"a",(function(){return i}));var r=n(11);function i(e){for(;e;){var t=e,n=t.closed,i=t.destination,a=t.isStopped;if(n||a)return!1;e=i&&i instanceof r.a?i:null}return!0}},function(e,t,n){var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var a=n[i],o=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=r.parseRtpMap(o),c=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=r.writeExtmap(e)})),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,l=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),a&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(r))}})),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var a=r.matchPrefix(e,"a=rtcp-mux");return t.mux=a.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var a=r.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var o=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=r},function(e,t,n){n.d(t,"a",(function(){return a}));var r=n(21),i=n(36),a={closed:!0,next:function(e){},error:function(e){if(r.a.useDeprecatedSynchronousErrorHandling)throw e;Object(i.a)(e)},complete:function(){}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(66),i=n(10),a=n(60),o=n(3),s=function e(){S(this,e)};s.DELETED="deleted",s.UPLOADING="uploading",s.UPLOADED="uploaded",s.NOT_UPLOADED="not_uploaded",s.DOWNLOADING="downloading",s.UPLOAD_CANCELED="upload_canceled",s.UNKNOWN="unknown",t.FileState=s;var c=function e(t,n,r){S(this,e),this.icon=t,this.style=n,this.type=r},l=function(){function e(t){S(this,e),t?(this.availableThumbnail=t.availableThumbnail,this.md5sum=t.md5sum,this.size=t.size,this.wantThumbnailDate=t.wantThumbnailDate):this.availableThumbnail=!1}return C(e,[{key:"isThumbnailAvailable",value:function(){return this.availableThumbnail}}]),e}(),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,v=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,y=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,b=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0,_=arguments.length>16&&void 0!==arguments[16]?arguments[16]:null,C=arguments.length>17&&void 0!==arguments[17]?arguments[17]:null,w=arguments.length>18&&void 0!==arguments[18]&&arguments[18];S(this,e),this.id=t,this.url=n,this.ownerId=a,this.fileName=o,this.extension=s,this.typeMIME=c,this.thumbnailPlaceholder=this.getThumbnailPlaceholderFromMimetype(c),this.size=u,this.registrationDate=d,this.uploadedDate=h,this.dateToSort=f,this.viewers=p,this.state=m,this.stateSubject=new r.BehaviorSubject(this.state),this.thumbnail=new l(v),this.fileToSend=void 0,this.previewBlob=void 0,this.previewBlobSubject=new r.BehaviorSubject(this.previewBlob),this.blobOrientation=void 0,this.blobOrientationSubject=new r.BehaviorSubject(this.blobOrientation),this.previewDownloaded=!1,this.tags=_,this.orientation=g||void 0,this.virusScanState=C,this.original_w=y||0,this.original_h=b||0,this.voiceMessage=w,this.time=this.getDate().getTime(),this.progressSubject=new i.Subject,this.loadingRef=0}return C(e,[{key:"isMicrosoftFile",value:function(){var e=this;return["docx","doc","ppt","pptx","xls","xlsx"].some((function(t){return t===e.extension}))}},{key:"isThumbnailPossible",value:function(){return this.isImage()||this.isPDF()}},{key:"isPDF",value:function(){return"application/pdf"===this.typeMIME}},{key:"isSVG",value:function(){return"svg"===this.extension}},{key:"isImage",value:function(){return this.typeMIME&&this.typeMIME.length>="image/".length&&"image/"===this.typeMIME.slice(0,"image/".length)}},{key:"isAudioVideo",value:function(){var e=this;return["avi","mpg","wma","mp3","wmv","mkv","mov","wav","ogg","mp4","aac"].some((function(t){return t===e.extension}))}},{key:"isUploaded",value:function(){return this.state&&this.state===s.UPLOADED}},{key:"isPublicUrlExpired",value:function(){if(!this.publicUrlExpirationDate)return!1;var e=o();return o(this.publicUrlExpirationDate).isBefore(e)}},{key:"isAlreadyFileViewer",value:function(e){return!(!this.ownerId||this.ownerId!==e)||!!this.viewers&&this.viewers.some((function(t){return t.viewerId===e}))}},{key:"getDisplayName",value:function(){return this.fileName.replace(/\.[^/.]+$/,"")}},{key:"getDisplayNameTruncated",value:function(){var e=this.fileName.replace(/\.[^/.]+$/,"");return[a(e.substring(0,e.length-4)),a(e.slice(-4))]}},{key:"getExtension",value:function(){return this.fileName.toUpperCase()===this.extension.toUpperCase()?"":"."+this.extension}},{key:"getDuration",value:function(){return this.tags&&this.tags.duration?Math.floor(this.tags.duration):0}},{key:"getThumbnailPlaceholderFromMimetype",value:function(e){return e?"image/vnd.adobe.photoshop"===e||"image/photoshop"===e||"image/x-photoshop"===e||"image/psd"===e||"application/photoshop"===e||"application/psd"===e?new c("psd-type","psdStyle","psd"):0===e.indexOf("image")?new c("image-type","imageStyle","image"):"application/msword"===e||/^application\/vnd.openxmlformats-officedocument.wordprocessingml.*$/.test(e)||"application/vnd.oasis.opendocument.text"===e?new c("document-type","docStyle","doc"):/^application\/vnd.ms-powerpoint.*$/.test(e)||/^application\/vnd.openxmlformats-officedocument.presentationml.*$/.test(e)||"application/vnd.oasis.opendocument.presentation"===e?new c("powerpoint-type","pptStyle","ppt"):0===e.indexOf("application/vnd.ms-excel")||/^application\/vnd.openxmlformats-officedocument.spreadsheetml.*$/.test(e)?new c("excel-type","xlsStyle","xls"):"application/pdf"===e||"application/vnd.oasis.opendocument.spreadsheet"===e?new c("pdf-type","pdfStyle","pdf"):0===e.indexOf("video/")?new c("video-type","videoStyle","video"):0===e.indexOf("audio/")?new c("audio-type","audioStyle","audio"):"text/plain"===e?new c("txt-type","txtStyle","txt"):"application/zip"===e||"application/x-rar-compressed"===e||"application/x-7z-compressed"===e||"application/x-tar"===e?new c("archive-type","archiveStyle","archive"):"application/illustrator"===e||0===e.indexOf("application/postscript")?new c("ai-type","aiStyle","ai"):"text/css"===e||"text/html"===e||"application/javascript"===e||"application/json"===e||"application/typescript"===e||"application/xml"===e?new c("code-type","codeStyle","code"):new c("unknown-type","otherStyle","other"):new c("unknown-type","otherStyle","other")}},{key:"releaseURL",value:function(){this.localURL=void 0}},{key:"setState",value:function(e){this.state=e,this.stateSubject.next(this.state)}},{key:"setOriginalImageDimensions",value:function(e,t){this.original_w=e,this.original_h=t}},{key:"update",value:function(e){this.id=e.id,this.url=e.url,this.ownerId=e.ownerId,this.fileName=e.fileName,this.extension=e.extension,this.typeMIME=e.typeMIME,this.size=e.size,this.registrationDate=e.registrationDate,this.uploadedDate=e.uploadedDate,this.dateToSort=e.dateToSort,this.viewers=e.viewers,this.setState(e.state),this.thumbnail=e.thumbnail,this.orientation=e.orientation,this.time=this.getDate().getTime()}},{key:"getDate",value:function(){return this.uploadedDate?new Date(this.uploadedDate):this.registrationDate?new Date(this.registrationDate):new Date(this.dateToSort)}},{key:"refreshFilePercent",value:function(){var e=0;this.chunkPercentArray.forEach((function(t){e+=t})),this.chunkPerformedPercent=Math.floor(e/this.chunkTotalNumber)}},{key:"updateProgressInfo",value:function(){this.refreshFilePercent(),this.progressSubject.next({})}},{key:"isInfected",value:function(){return"isInfected"===this.virusScanState}}],[{key:"create",value:function(t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,b){return new e(t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,b)}}]),e}();t.FileDescriptor=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(262),i=n(266),a=n(267),o=n(268),s=n(68),c=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,a=i.toSubscriber(e,t,n);if(r?a.add(r.call(a,this.source)):a.add(this.source||s.config.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),s.config.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){s.config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),r.canReportError(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=l(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(n){r(n),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[a.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:o.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=l(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function l(e){if(e||(e=s.config.Promise||Promise),!e)throw new Error("no Promise impl found");return e}t.Observable=c},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(78),o=n(79),s=n(45),c=n(69),l=n(68),u=n(80),d=function(e){function t(n,r,i){var a=e.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=o.empty;break;case 1:if(!n){a.destination=o.empty;break}if("object"==typeof n){n instanceof t?(a.syncErrorThrowable=n.syncErrorThrowable,a.destination=n,n.add(a)):(a.syncErrorThrowable=!0,a.destination=new h(a,n));break}default:a.syncErrorThrowable=!0,a.destination=new h(a,n,r,i)}return a}return i(t,e),t.prototype[c.rxSubscriber]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(s.Subscription);t.Subscriber=d;var h=function(e){function t(t,n,r,i){var s,c=e.call(this)||this;c._parentSubscriber=t;var l=c;return a.isFunction(n)?s=n:n&&(s=n.next,r=n.error,i=n.complete,n!==o.empty&&(l=Object.create(n),a.isFunction(l.unsubscribe)&&c.add(l.unsubscribe.bind(l)),l.unsubscribe=c.unsubscribe.bind(c))),c._context=l,c._next=s,c._error=r,c._complete=i,c}return i(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;l.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=l.config.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):u.hostReportError(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;u.hostReportError(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};l.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),l.config.useDeprecatedSynchronousErrorHandling)throw n;u.hostReportError(n)}},t.prototype.__tryOrSetError=function(e,t,n){if(!l.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return l.config.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(u.hostReportError(r),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(d);t.SafeSubscriber=h},function(e,t,n){(function(e){var r=n(385),i=n(386),a=n(387);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return l(this,e,t,n)}function l(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):h(e,t);if("Buffer"===t.type&&a(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(u(t),e=s(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(e).length;default:if(r)return F(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return M(this,t,n);case"latin1":case"binary":return D(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var a,o=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,c/=2,n/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(a=n;a<s;a++)if(l(e,a)===l(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===c)return u*o}else-1!==u&&(a-=a-u),u=-1}else for(n+c>s&&(n=s-c),a=n;a>=0;a--){for(var d=!0,h=0;h<c;h++)if(l(e,a+h)!==l(t,h)){d=!1;break}if(d)return a}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function S(e,t,n,r){return W(F(t,e.length-n),e,n,r)}function _(e,t,n,r){return W(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function C(e,t,n,r){return _(e,t,n,r)}function w(e,t,n,r){return W(H(t),e,n,r)}function E(e,t,n,r){return W(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function T(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,c,l=e[i],u=null,d=l>239?4:l>223?3:l>191?2:1;if(i+d<=n)switch(d){case 1:l<128&&(u=l);break;case 2:128==(192&(a=e[i+1]))&&(c=(31&l)<<6|63&a)>127&&(u=c);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(c=(15&l)<<12|(63&a)<<6|63&o)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&c<1114112&&(u=c)}null===u?(u=65533,d=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function M(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function D(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){var r,i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var a="",o=t;o<n;++o)a+=(r=e[o])<16?"0"+r.toString(16):r.toString(16);return a}function R(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,n,r,i,a){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function P(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function A(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function L(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,r,a){return a||L(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,a){return a||L(e,0,n,8),i.write(e,t,n,r,52,8),n+8}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return l(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return u(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):m.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),l=this.slice(r,i),u=e.slice(t,n),d=0;d<s;++d)if(l[d]!==u[d]){a=l[d],o=u[d];break}return a<o?-1:o<a?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return S(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return C(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||I(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||I(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):A(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):A(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):A(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):A(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=c.isBuffer(e)?e:F(new c(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function F(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function H(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(65))},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(332),a=n(75),o=n(1),s=function(e){h(n,e);var t=m(n);function n(){var e;return S(this,n),(e=t.call(this)).contactService=o.ContactService.getInstance(),e}return C(n,[{key:"start",value:function(e){var t=this;this.contactService.userContact.phoneMeetingsEnabledSubject.pipe(a.distinctUntilChanged()).subscribe((function(r){return r?u(l(n.prototype),"start",t).call(t,e):(t.logger.info("start skipped - phoneMeetingsEnabled : "+t.contactService.userContact.phoneMeetingsEnabled),null)}))}},{key:"makeSnapshotForConfId",value:function(e){var t=this,i=Object.create(null,{makeSnapshotForConfId:{get:function(){return u(l(n.prototype),"makeSnapshotForConfId",t)}}});return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.phoneMeetingsEnabled){t.next=4;break}t.t0=(this.logger.info("makeSnapshotForConfId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null),t.next=7;break;case 4:return t.next=6,i.makeSnapshotForConfId.call(this,e);case 6:t.t0=t.sent;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"removeConferenceSession",value:function(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("removeConferenceSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):u(l(n.prototype),"removeConferenceSession",this).call(this,e)}},{key:"updateOrCreateConferenceSession",value:function(e,t){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("updateOrCreateConferenceSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):u(l(n.prototype),"updateOrCreateConferenceSession",this).call(this,e,t)}},{key:"updateConference",value:function(e,t){var i=this,a=Object.create(null,{updateConference:{get:function(){return u(l(n.prototype),"updateConference",i)}}});return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.phoneMeetingsEnabled){n.next=4;break}n.t0=(this.logger.info("updateConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null),n.next=7;break;case 4:return n.next=6,a.updateConference.call(this,e,t);case 6:n.t0=n.sent;case 7:return n.abrupt("return",n.t0);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"getPstnInstantConferenceEndpoint",value:function(){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getPstnInstantConferenceEndpoint skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):u(l(n.prototype),"getPstnInstantConferenceEndpoint",this).call(this)}},{key:"getPstnInstantConferenceEndpointId",value:function(){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getPstnInstantConferenceEndpointId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):u(l(n.prototype),"getPstnInstantConferenceEndpointId",this).call(this)}},{key:"retrievePstnConferences",value:function(){var e=this,t=Object.create(null,{retrievePstnConferences:{get:function(){return u(l(n.prototype),"retrievePstnConferences",e)}}});return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.phoneMeetingsEnabled){e.next=4;break}e.t0=(this.logger.info("retrievePstnConferences skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null),e.next=7;break;case 4:return e.next=6,t.retrievePstnConferences.call(this);case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"retrieveConference",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Object.create(null,{retrieveConference:{get:function(){return u(l(n.prototype),"retrieveConference",t)}}});return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.phoneMeetingsEnabled){t.next=4;break}t.t0=(this.logger.info("retrieveConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null),t.next=7;break;case 4:return t.next=6,a.retrieveConference.call(this,e,i);case 6:t.t0=t.sent;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"updateOrCreatePstnConferenceEndpoint",value:function(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("updateOrCreatePstnConferenceEndpoint skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):u(l(n.prototype),"updateOrCreatePstnConferenceEndpoint",this).call(this,e)}},{key:"getConferenceSessionWithConnId",value:function(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getConferenceSessionWithConnId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):u(l(n.prototype),"getConferenceSessionWithConnId",this).call(this,e)}},{key:"getConferenceSessionById",value:function(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getConferenceSessionById skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):u(l(n.prototype),"getConferenceSessionById",this).call(this,e)}},{key:"subscribeToPstnSession",value:function(e){var t=this,i=Object.create(null,{subscribeToPstnSession:{get:function(){return u(l(n.prototype),"subscribeToPstnSession",t)}}});return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("subscribeToPstnSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):i.subscribeToPstnSession.call(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"unSubscribeParticipantFromPstnSession",value:function(e,t){var i=this,a=Object.create(null,{unSubscribeParticipantFromPstnSession:{get:function(){return u(l(n.prototype),"unSubscribeParticipantFromPstnSession",i)}}});return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("unSubscribeParticipantFromPstnSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):a.unSubscribeParticipantFromPstnSession.call(this,e,t));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"startPstnConference",value:function(e){var t=this,i=Object.create(null,{startPstnConference:{get:function(){return u(l(n.prototype),"startPstnConference",t)}}});return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("startPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):i.startPstnConference.call(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"stopPstnConference",value:function(e){var t=this,i=Object.create(null,{stopPstnConference:{get:function(){return u(l(n.prototype),"stopPstnConference",t)}}});return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("stopPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):i.stopPstnConference.call(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"joinPstnConference",value:function(e,t,i,a){var o=this,s=Object.create(null,{joinPstnConference:{get:function(){return u(l(n.prototype),"joinPstnConference",o)}}});return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("joinPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):s.joinPstnConference.call(this,e,t,i,a));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"disconnectParticipant",value:function(e,t){var i=this,a=Object.create(null,{disconnectParticipant:{get:function(){return u(l(n.prototype),"disconnectParticipant",i)}}});return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("disconnectParticipant skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):a.disconnectParticipant.call(this,e,t));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"retrievePstnPhoneNumbers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=Object.create(null,{retrievePstnPhoneNumbers:{get:function(){return u(l(n.prototype),"retrievePstnPhoneNumbers",e)}}});return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("retrievePstnPhoneNumbers skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):i.retrievePstnPhoneNumbers.call(this,t));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"resetPersonalMeetingRoom",value:function(){var e=this,t=Object.create(null,{resetPersonalMeetingRoom:{get:function(){return u(l(n.prototype),"resetPersonalMeetingRoom",e)}}});return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("resetPersonalMeetingRoom skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):t.resetPersonalMeetingRoom.call(this));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"subscribeToMyConferenceSessions",value:function(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("subscribeToMyConferenceSessions skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):u(l(n.prototype),"subscribeToMyConferenceSessions",this).call(this,e)}}],[{key:"getInstance",value:function(){var e=window;return e.rainbow||(e.rainbow={}),e.rainbow.pgiConferenceService||(e.rainbow.pgiConferenceService=new n),e.rainbow.pgiConferenceService}}]),n}(i.NgPgiConferenceService);t.PgiConferenceService=s,t.default=s.getInstance()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),a=n(19),o=n(18),s=n(18),c=n(15),l=n(2),u=n(26),d=n(31),h=n(37),f=n(4),p=function(){function e(){var t=this;S(this,e),this.eventService=i.default,this.logger=c.default,this.authService=l.default,this.mainService=u.default,this.userInfoService=d.default,this.xmppService=f.default,this.companies={},this.eventService.subscribe("ON_COMPANY_CHANGE_EVENT",(function(e,n){t.getCompanyById(n,!0)})),this.xmppService.subscribeToConnectionEvents((function(e){"ON_XMPP_DISCONNECTED"===e.name&&"LOGOUT"===e.data.reason&&(t.companies={})}))}return C(e,[{key:"getCompanyById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(this,void 0,void 0,b.a.mark((function n(){var r,i,o,s,c,l;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,e){n.next=3;break}throw new Error("missing companyId");case 3:if(!(r=this.companies[e])||t){n.next=6;break}return n.abrupt("return",(this.logger.info("[companyService] getCompanyById (cache) "+e+" - success"),r));case 6:return i=this.authService.getRequestHeader(),o="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/companies/").concat(e),n.next=10,fetch(o,{method:"GET",headers:i});case 10:if((s=n.sent).ok){n.next=13;break}throw new Error(s.statusText);case 13:return n.next=15,s.json();case 15:return c=n.sent,n.abrupt("return",(r?(r.updateFromData(c.data),this.logger.info("getCompanyById (update) ".concat(e," - success"))):(r=a.Company.createFromData(c.data),this.companies[r.id]=r,this.logger.info("getCompanyById ".concat(e," - success"))),this.getCompanyLogo(r),this.getCompanyBanner(r),r));case 19:throw n.prev=19,n.t0=n.catch(0),l="getCompanyById -- FAILURE -- "+n.t0.message,this.logger.error(l),new Error(l);case 23:case"end":return n.stop()}}),n,this,[[0,19]])})))}},{key:"searchCompanies",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return r(this,void 0,void 0,b.a.mark((function r(){var o,s,c,l,u,d,h=this;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/companies?name=").concat(encodeURIComponent(e),"&format=full"),null!=t&&(o+="&hasBP="+t),null!=n&&(o+="&isBP="+n),i&&(o+="&bpType="+i),s=this.authService.getRequestHeader(),r.next=6,fetch(o,{method:"GET",headers:s});case 6:if((c=r.sent).ok){r.next=9;break}throw new Error(c.statusText);case 9:return r.next=11,c.json();case 11:return l=r.sent,u=l.data.reduce((function(e,t){if("Default"!==t.name&&"Rainbow"!==t.name&&"active"===t.status){var n=h.companies[t.id];n||(n=a.Company.createFromData(t),h.companies[n.id]=n,h.getCompanyLogo(n)),e.push(n)}return e}),[]),r.abrupt("return",(this.logger.info("searchCompanies with criteria '"+e+"' - success - found "+l.length+" companies : returns "+u.length+" companies"),u));case 16:throw r.prev=16,r.t0=r.catch(0),d="searchCompanies -- FAILURE -- "+r.t0.message,this.logger.error(d),new Error(d);case 20:case"end":return r.stop()}}),r,this,[[0,16]])})))}},{key:"getCompanyAdminsData",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/companies/").concat(e,"/administrators"),r=this.authService.getRequestHeader(),t.next=5,fetch(n,{method:"GET",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw new Error(i.statusText);case 8:return t.next=10,i.json();case 10:return t.abrupt("return",t.sent.data);case 13:throw t.prev=13,t.t0=t.catch(0),a="getCompanyById -- FAILURE -- "+t.t0.message,this.logger.error(a),new Error(a);case 17:case"end":return t.stop()}}),t,this,[[0,13]])})))}},{key:"getCompanyUsers",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function t(){var r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r="".concat(config.restServerUrl,"/api/rainbow/search/v1.0/users?companyId=").concat(e,"&limit=").concat(n),i=this.authService.getRequestHeader(),t.next=5,fetch(r,{method:"GET",headers:i});case 5:if((a=t.sent).ok){t.next=8;break}throw new Error(a.statusText);case 8:return t.next=10,a.json();case 10:t.next=16;break;case 12:throw t.prev=12,t.t0=t.catch(0),o="getCompanyById -- FAILURE -- "+t.t0.message,this.logger.error(o),new Error(o);case 16:case"end":return t.stop()}}),t,this,[[0,12]])})))}},{key:"getCompanyLogo",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=this.userInfoService.computeUserColor(e.name),r=e.name.substr(0,1),t.abrupt("return",(e.logo=this.userInfoService.getAvatarImage(e.id,r,n.color,130,e.lastAvatarUpdateDate),this.eventService.publish("ON_COMPANY_LOGO_UPDATED",e.id),this.logger.info("[getCompanyLogo] - "+e.getNameForLogs()+" - success"),e.sendChangeEvent("logo"),e));case 5:throw t.prev=5,t.t0=t.catch(0),new Error("getCompanyLogo -- FAILURE -- "+t.t0.message);case 8:case"end":return t.stop()}}),t,this,[[0,5]])})))}},{key:"getCompanyBanner",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r=new Image;r.onload=function(){e.banner=r,n.eventService.publish("ON_COMPANY_BANNER_UPDATED",e.id),n.logger.info("[getCompanyBanner] - "+e.getNameForLogs()+" - success"),t(e)},r.onerror=function(){n.logger.error("[companyService] Load banner for "+e.getNameForLogs()+" failure"),t(e)};var i="/cacheV2/images/company-banner-01.svg";if(e.lastBannerUpdateDate){var a=config.webservices.protocol+"://"+config.webservices.currentServer;n.mainService.cdn&&(a=n.mainService.cdnServer),i=a+"/api/banner/"+e.id+"?size=831",i+="&update="+s.MD5(o.enc.Latin1.parse(e.lastBannerUpdateDate)).toString(o.enc.Hex)}r.src=i})));case 1:case"end":return t.stop()}}),t)})))}},{key:"getCompanyAlertNotificationState",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!config.urgencyNotifEmissionForced){t.next=2;break}return t.abrupt("return",!0);case 2:return t.prev=2,n="".concat(config.restServerUrl,"/api/rainbow/subscription/v1.0/companies/").concat(e.id,"/subscriptions/features"),r=this.authService.getRequestHeader(),t.next=7,fetch(n,{method:"GET",headers:r});case 7:if((i=t.sent).ok){t.next=10;break}throw new Error(i.statusText);case 10:return t.next=12,i.json();case 12:if(!(a=t.sent.data.find((function(e){return"ALERT_NOTIFICATIONS_ALLOWED"===e.featureUniqueRef})))){t.next=15;break}return t.abrupt("return",a.isEnabled);case 15:t.next=23;break;case 17:return t.prev=17,t.t0=t.catch(2),t.next=21,h.default.getErrorInfo(t.t0,"getCompanySubscriptions");case 21:o=t.sent,this.logger.warn("[roomService] "+o.message);case 23:return t.abrupt("return",!1);case 24:case"end":return t.stop()}}),t,this,[[2,17]])})))}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.companyService||(t.rainbow.companyService=new e),t.rainbow.companyService}}]),e}();t.CompanyService=p,t.default=p.getInstance()},function(e,t,n){(function(t){var n,r=/[&<>"'`]/g,i=RegExp(r.source),a="object"==typeof t&&t&&t.Object===Object&&t,o="object"==typeof self&&self&&self.Object===Object&&self,s=a||o||Function("return this")(),c=(n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},function(e){return null==n?void 0:n[e]}),l=Object.prototype.toString,u=s.Symbol,d=u?u.prototype:void 0,h=d?d.toString:void 0;try{e.exports=function(e){var t;return(e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==l.call(e)}(e))return h?h.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t))&&i.test(e)?e.replace(r,c):e}}catch(f){}}).call(this,n(65))},function(e,t,n){var r,i,a,o,s,c;e.exports=(i=(r=c=n(12)).lib,a=i.Base,o=i.WordArray,(s=r.x64={}).Word=a.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var i=e[r];n.push(i.high),n.push(i.low)}return o.create(n,this.sigBytes)},clone:function(){for(var e=a.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}}),c)},function(e,t,n){n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var r=n(34);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(e)}function a(e){return 0===e.length?r.a:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}},function(e,t,n){n.d(t,"a",(function(){return i}));var r=n(7),i=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return r.a(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(n(13).a)},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=n(15),o=n(38),s=n(37),c=function(){function e(){S(this,e),this.portalURL=null,this.errorHelperService=s.default,this.datacenters=[{name:"France","alpha-3":"FRA","alpha-2":"FR",region:"Europe"},{name:"Germany","alpha-3":"DEU","alpha-2":"DE",region:"Europe"},{name:"Canada","alpha-3":"CAN","alpha-2":"CA",region:"America"},{name:"Singapore","alpha-3":"SGP","alpha-2":"SG",region:"Asia-Pacific"}],this.countries=[{name:"Australia","alpha-3":"AUS","country-code":"036","alpha-2":"AU"},{name:"Austria","alpha-3":"AUT","country-code":"040","alpha-2":"AT"},{name:"Belgium","alpha-3":"BEL","country-code":"056","alpha-2":"BE"},{name:"Brazil","alpha-3":"BRA","country-code":"076","alpha-2":"BR"},{name:"Canada","alpha-3":"CAN","country-code":"124","alpha-2":"CA"},{name:"China","alpha-3":"CHN","country-code":"156","alpha-2":"CN"},{name:"Czech Republic","alpha-3":"CZE","country-code":"203","alpha-2":"CZ"},{name:"Denmark","alpha-3":"DNK","country-code":"208","alpha-2":"DK"},{name:"Finland","alpha-3":"FIN","country-code":"246","alpha-2":"FI"},{name:"France","alpha-3":"FRA","country-code":"250",default:!0,"alpha-2":"FR"},{name:"Germany","alpha-3":"DEU","country-code":"276","alpha-2":"DE"},{name:"Hong Kong","alpha-3":"HKG","country-code":"344","alpha-2":"HK"},{name:"Ireland","alpha-3":"IRL","country-code":"372","alpha-2":"IE"},{name:"Israel","alpha-3":"ISR","country-code":"376","alpha-2":"IL"},{name:"Italy","alpha-3":"ITA","country-code":"380","alpha-2":"IT"},{name:"Mexico","alpha-3":"MEX","country-code":"484","alpha-2":"MX"},{name:"Netherlands","alpha-3":"NLD","country-code":"528","alpha-2":"NL"},{name:"Norway","alpha-3":"NOR","country-code":"578","alpha-2":"NO"},{name:"Poland","alpha-3":"POL","country-code":"616","alpha-2":"PL"},{name:"Portugal","alpha-3":"PRT","country-code":"620","alpha-2":"PT"},{name:"Russia","alpha-3":"RUS","country-code":"643","alpha-2":"RU"},{name:"South Africa","alpha-3":"ZAF","country-code":"710","alpha-2":"ZA"},{name:"South Korea","alpha-3":"KOR","country-code":"410","alpha-2":"KR"},{name:"Spain","alpha-3":"ESP","country-code":"724","alpha-2":"ES"},{name:"Sweden","alpha-3":"SWE","country-code":"752","alpha-2":"SE"},{name:"Switzerland","alpha-3":"CHE","country-code":"756","alpha-2":"CH"},{name:"Taiwan","alpha-3":"TWN","country-code":"158","alpha-2":"TW"},{name:"Turkey","alpha-3":"TUR","country-code":"792","alpha-2":"TR"},{name:"United Kingdom","alpha-3":"GBR","country-code":"826","alpha-2":"GB"},{name:"United States of America","alpha-3":"USA","country-code":"840","alpha-2":"US"},{name:"Afghanistan","alpha-3":"AFG","country-code":"004","alpha-2":"AF"},{name:"Albania","alpha-3":"ALB","country-code":"008","alpha-2":"AL"},{name:"Algeria","alpha-3":"DZA","country-code":"012","alpha-2":"DZ"},{name:"Andorra","alpha-3":"AND","country-code":"020","alpha-2":"AD"},{name:"Angola","alpha-3":"AGO","country-code":"024","alpha-2":"AO"},{name:"Anguilla","alpha-3":"AIA","country-code":"660","alpha-2":"AI"},{name:"Antigua and Barbuda","alpha-3":"ATG","country-code":"028","alpha-2":"AG"},{name:"Argentina","alpha-3":"ARG","country-code":"032","alpha-2":"AR"},{name:"Armenia","alpha-3":"ARM","country-code":"051","alpha-2":"AM"},{name:"Aruba","alpha-3":"ABW","country-code":"533","alpha-2":"AW"},{name:"Azerbaijan","alpha-3":"AZE","country-code":"031","alpha-2":"AZ"},{name:"Bahamas","alpha-3":"BHS","country-code":"044","alpha-2":"BS"},{name:"Bahrain","alpha-3":"BHR","country-code":"048","alpha-2":"BH"},{name:"Bangladesh","alpha-3":"BGD","country-code":"050","alpha-2":"BD"},{name:"Barbados","alpha-3":"BRB","country-code":"052","alpha-2":"BB"},{name:"Belarus","alpha-3":"BLR","country-code":"112","alpha-2":"BY"},{name:"Belize","alpha-3":"BLZ","country-code":"084","alpha-2":"BZ"},{name:"Benin","alpha-3":"BEN","country-code":"204","alpha-2":"BJ"},{name:"Bermuda","alpha-3":"BMU","country-code":"060","alpha-2":"BM"},{name:"Bhutan","alpha-3":"BTN","country-code":"064","alpha-2":"BT"},{name:"Bolivia","alpha-3":"BOL","country-code":"068","alpha-2":"BO"},{name:"Bosnia and Herzegovina","alpha-3":"BIH","country-code":"070","alpha-2":"BA"},{name:"Botswana","alpha-3":"BWA","country-code":"072","alpha-2":"BW"},{name:"British Virgin Islands","alpha-3":"VGB","country-code":"092","alpha-2":"VG"},{name:"Brunei Darussalam","alpha-3":"BRN","country-code":"096","alpha-2":"BN"},{name:"Bulgaria","alpha-3":"BGR","country-code":"100","alpha-2":"BG"},{name:"Burkina Faso","alpha-3":"BFA","country-code":"854","alpha-2":"BF"},{name:"Burundi","alpha-3":"BDI","country-code":"108","alpha-2":"BI"},{name:"Cambodia","alpha-3":"KHM","country-code":"116","alpha-2":"KH"},{name:"Cameroon","alpha-3":"CMR","country-code":"120","alpha-2":"CM"},{name:"Cape Verde","alpha-3":"CPV","country-code":"132","alpha-2":"CV"},{name:"Cayman Islands","alpha-3":"CYM","country-code":"136","alpha-2":"KY"},{name:"Central African Republic","alpha-3":"CAF","country-code":"140","alpha-2":"CF"},{name:"Chad","alpha-3":"TCD","country-code":"148","alpha-2":"TD"},{name:"Chile","alpha-3":"CHL","country-code":"152","alpha-2":"CL"},{name:"Colombia","alpha-3":"COL","country-code":"170","alpha-2":"CO"},{name:"Comoros","alpha-3":"COM","country-code":"174","alpha-2":"KM"},{name:"Congo","alpha-3":"COG","country-code":"178","alpha-2":"CG"},{name:"Congo, Democratic Republic of","alpha-3":"COD","country-code":"180","alpha-2":"CD"},{name:"Costa Rica","alpha-3":"CRI","country-code":"188","alpha-2":"CR"},{name:"Ivory Coast","alpha-3":"CIV","country-code":"384","alpha-2":"CI"},{name:"Croatia","alpha-3":"HRV","country-code":"191","alpha-2":"HR"},{name:"Cyprus","alpha-3":"CYP","country-code":"196","alpha-2":"CY"},{name:"Djibouti","alpha-3":"DJI","country-code":"262","alpha-2":"DJ"},{name:"Dominica","alpha-3":"DMA","country-code":"212","alpha-2":"DM"},{name:"Dominican Republic","alpha-3":"DOM","country-code":"214","alpha-2":"DO"},{name:"Ecuador","alpha-3":"ECU","country-code":"218","alpha-2":"EC"},{name:"El Salvador","alpha-3":"SLV","country-code":"222","alpha-2":"SV"},{name:"Egypt","alpha-3":"EGY","country-code":"818","alpha-2":"EG"},{name:"Eritrea","alpha-3":"ERI","country-code":"232","alpha-2":"ER"},{name:"Estonia","alpha-3":"EST","country-code":"233","alpha-2":"EE"},{name:"Ethiopia","alpha-3":"ETH","country-code":"231","alpha-2":"ET"},{name:"Fiji","alpha-3":"FJI","country-code":"242","alpha-2":"FJ"},{name:"French Guiana","alpha-3":"GUF","country-code":"254","alpha-2":"GF"},{name:"French Polynesia","alpha-3":"PYF","country-code":"258","alpha-2":"PF"},{name:"Gabon","alpha-3":"GAB","country-code":"266","alpha-2":"GA"},{name:"Gambia","alpha-3":"GMB","country-code":"270","alpha-2":"GM"},{name:"Georgia","alpha-3":"GEO","country-code":"268","alpha-2":"GE"},{name:"Ghana","alpha-3":"GHA","country-code":"288","alpha-2":"GH"},{name:"Greece","alpha-3":"GRC","country-code":"300","alpha-2":"GR"},{name:"Grenada","alpha-3":"GRD","country-code":"308","alpha-2":"GD"},{name:"Guadeloupe","alpha-3":"GLP","country-code":"312","alpha-2":"GP"},{name:"Guatemala","alpha-3":"GTM","country-code":"320","alpha-2":"GT"},{name:"Guinea","alpha-3":"GIN","country-code":"324","alpha-2":"GN"},{name:"Guyana","alpha-3":"GUY","country-code":"328","alpha-2":"GY"},{name:"Haiti","alpha-3":"HTI","country-code":"332","alpha-2":"HT"},{name:"Honduras","alpha-3":"HND","country-code":"340","alpha-2":"HN"},{name:"Hungary","alpha-3":"HUN","country-code":"348","alpha-2":"HU"},{name:"Iceland","alpha-3":"ISL","country-code":"352","alpha-2":"IS"},{name:"India","alpha-3":"IND","country-code":"356","alpha-2":"IN"},{name:"Indonesia","alpha-3":"IDN","country-code":"360","alpha-2":"ID"},{name:"Iraq","alpha-3":"IRQ","country-code":"368","alpha-2":"IQ"},{name:"Jamaica","alpha-3":"JAM","country-code":"388","alpha-2":"JM"},{name:"Japan","alpha-3":"JPN","country-code":"392","alpha-2":"JP"},{name:"Jordan","alpha-3":"JOR","country-code":"400","alpha-2":"JO"},{name:"Kazakhstan","alpha-3":"KAZ","country-code":"398","alpha-2":"KZ"},{name:"Kenya","alpha-3":"KEN","country-code":"404","alpha-2":"KE"},{name:"Kuwait","alpha-3":"KWT","country-code":"414","alpha-2":"KW"},{name:"Kyrgyzstan","alpha-3":"KGZ","country-code":"417","alpha-2":"KG"},{name:"Latvia","alpha-3":"LVA","country-code":"428","alpha-2":"LV"},{name:"Lebanon","alpha-3":"LBN","country-code":"422","alpha-2":"LB"},{name:"Lesotho","alpha-3":"LSO","country-code":"426","alpha-2":"LS"},{name:"Liberia","alpha-3":"LBR","country-code":"430","alpha-2":"LR"},{name:"Libya","alpha-3":"LBY","country-code":"434","alpha-2":"LY"},{name:"Liechtenstein","alpha-3":"LIE","country-code":"438","alpha-2":"LI"},{name:"Lithuania","alpha-3":"LTU","country-code":"440","alpha-2":"LT"},{name:"Luxembourg","alpha-3":"LUX","country-code":"442","alpha-2":"LU"},{name:"Macao","alpha-3":"MAC","country-code":"446","alpha-2":"MO"},{name:"Macedonia","alpha-3":"MKD","country-code":"807","alpha-2":"MK"},{name:"Madagascar","alpha-3":"MDG","country-code":"450","alpha-2":"MG"},{name:"Malawi","alpha-3":"MWI","country-code":"454","alpha-2":"MW"},{name:"Malaysia","alpha-3":"MYS","country-code":"458","alpha-2":"MY"},{name:"Maldives","alpha-3":"MDV","country-code":"462","alpha-2":"MV"},{name:"Mali","alpha-3":"MLI","country-code":"466","alpha-2":"ML"},{name:"Malta","alpha-3":"MLT","country-code":"470","alpha-2":"MT"},{name:"Mauritius","alpha-3":"MUS","country-code":"480","alpha-2":"MU"},{name:"Mayotte","alpha-3":"MYT","country-code":"175","alpha-2":"YT"},{name:"Moldova","alpha-3":"MDA","country-code":"498","alpha-2":"MD"},{name:"Monaco","alpha-3":"MCO","country-code":"492","alpha-2":"MC"},{name:"Mongolia","alpha-3":"MNG","country-code":"496","alpha-2":"MN"},{name:"Montenegro","alpha-3":"MNE","country-code":"499","alpha-2":"ME"},{name:"Montserrat","alpha-3":"MSR","country-code":"500","alpha-2":"MS"},{name:"Morocco","alpha-3":"MAR","country-code":"504","alpha-2":"MA"},{name:"Mozambique","alpha-3":"MOZ","country-code":"508","alpha-2":"MZ"},{name:"Myanmar","alpha-3":"MMR","country-code":"104","alpha-2":"MM"},{name:"Namibia","alpha-3":"NAM","country-code":"516","alpha-2":"NA"},{name:"Nepal","alpha-3":"NPL","country-code":"524","alpha-2":"NP"},{name:"New Zealand","alpha-3":"NZL","country-code":"554","alpha-2":"NZ"},{name:"Nicaragua","alpha-3":"NIC","country-code":"558","alpha-2":"NI"},{name:"Niger","alpha-3":"NER","country-code":"562","alpha-2":"NE"},{name:"Nigeria","alpha-3":"NGA","country-code":"566","alpha-2":"NG"},{name:"Oman","alpha-3":"OMN","country-code":"512","alpha-2":"OM"},{name:"Pakistan","alpha-3":"PAK","country-code":"586","alpha-2":"PK"},{name:"Palestine","alpha-3":"PSE","country-code":"275","alpha-2":"PS"},{name:"Panama","alpha-3":"PAN","country-code":"591","alpha-2":"PA"},{name:"Paraguay","alpha-3":"PRY","country-code":"600","alpha-2":"PY"},{name:"Peru","alpha-3":"PER","country-code":"604","alpha-2":"PE"},{name:"Philippines","alpha-3":"PHL","country-code":"608","alpha-2":"PH"},{name:"Puerto Rico","alpha-3":"PRI","country-code":"630","alpha-2":"PR"},{name:"Qatar","alpha-3":"QAT","country-code":"634","alpha-2":"QA"},{name:"Romania","alpha-3":"ROU","country-code":"642","alpha-2":"RO"},{name:"Rwanda","alpha-3":"RWA","country-code":"646","alpha-2":"RW"},{name:"Saint Kitts and Nevis","alpha-3":"KNA","country-code":"659","alpha-2":"KN"},{name:"Saint Lucia","alpha-3":"LCA","country-code":"662","alpha-2":"LC"},{name:"Saint Vincent and the Grenadines","alpha-3":"VCT","country-code":"670","alpha-2":"VC"},{name:"Saudi Arabia","alpha-3":"SAU","country-code":"682","alpha-2":"SA"},{name:"Senegal","alpha-3":"SEN","country-code":"686","alpha-2":"SN"},{name:"Serbia","alpha-3":"SRB","country-code":"688","alpha-2":"RS"},{name:"Sierra Leone","alpha-3":"SLE","country-code":"694","alpha-2":"SL"},{name:"Singapore","alpha-3":"SGP","country-code":"702","alpha-2":"SG"},{name:"Slovakia","alpha-3":"SVK","country-code":"703","alpha-2":"SK"},{name:"Slovenia","alpha-3":"SVN","country-code":"705","alpha-2":"SI"},{name:"South Sudan","alpha-3":"SSD","country-code":"728","alpha-2":"SS"},{name:"Sri Lanka","alpha-3":"LKA","country-code":"144","alpha-2":"LK"},{name:"Sudan","alpha-3":"SDN","country-code":"729","alpha-2":"SD"},{name:"Swaziland","alpha-3":"SWZ","country-code":"748","alpha-2":"SZ"},{name:"Tajikistan","alpha-3":"TJK","country-code":"762","alpha-2":"TJ"},{name:"Tanzania","alpha-3":"TZA","country-code":"834","alpha-2":"TZ"},{name:"Thailand","alpha-3":"THA","country-code":"764","alpha-2":"TH"},{name:"Togo","alpha-3":"TGO","country-code":"768","alpha-2":"TG"},{name:"Trinidad and Tobago","alpha-3":"TTO","country-code":"780","alpha-2":"TT"},{name:"Tunisia","alpha-3":"TUN","country-code":"788","alpha-2":"TN"},{name:"Turkmenistan","alpha-3":"TKM","country-code":"795","alpha-2":"TM"},{name:"Turks and Caicos Islands","alpha-3":"TCA","country-code":"796","alpha-2":"TC"},{name:"Uganda","alpha-3":"UGA","country-code":"800","alpha-2":"UG"},{name:"Ukraine","alpha-3":"UKR","country-code":"804","alpha-2":"UA"},{name:"United Arab Emirates","alpha-3":"ARE","country-code":"784","alpha-2":"AE"},{name:"Virgin Islands, US","alpha-3":"VIR","country-code":"850","alpha-2":"VI"},{name:"Uruguay","alpha-3":"URY","country-code":"858","alpha-2":"UY"},{name:"Uzbekistan","alpha-3":"UZB","country-code":"860","alpha-2":"UZ"},{name:"Venezuela","alpha-3":"VEN","country-code":"862","alpha-2":"VE"},{name:"Vietnam","alpha-3":"VNM","country-code":"704","alpha-2":"VN"},{name:"Zambia","alpha-3":"ZMB","country-code":"894","alpha-2":"ZM"},{name:"Zimbabwe","alpha-3":"ZWE","country-code":"716","alpha-2":"ZW"}],this.statesOfCanada={AB:"Alberta",BC:"British Columbia",MB:"Manitoba",NB:"New Brunswick",NL:"Newfoundland and Labrador",NS:"Nova Scotia",NT:"Northwest Territories",NU:"Nunavut",ON:"Ontario",PE:"Prince Edward Island",QC:"Quebec",SK:"Saskatchewan",YT:"Yukon"},this.statesOfAmerica={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",AA:"Armed Forces America",AE:"Armed Forces",AP:"Armed Forces Pacific",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",GU:"Guam",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VI:"Virgin Islands",VA:"Virginia",WA:"Washington",DC:"Washington DC",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},this.countryToInternationalCallingCodeMapping={AD:"376",AE:"971",AF:"93",AG:"1268",AI:"1264",AL:"355",AM:"374",AN:"599",AO:"244",AQ:"672",AR:"54",AS:"1684",AT:"43",AU:"61",AW:"297",AZ:"994",BA:"387",BB:"1246",BD:"880",BE:"32",BF:"226",BG:"359",BH:"973",BI:"257",BJ:"229",BL:"590",BM:"1441",BN:"673",BO:"591",BR:"55",BS:"1242",BT:"975",BW:"267",BY:"375",BZ:"501",CA:"1",CC:"61",CD:"243",CF:"236",CG:"242",CH:"41",CI:"225",CK:"682",CL:"56",CM:"237",CN:"86",CO:"57",CR:"506",CU:"53",CV:"238",CX:"61",CY:"357",CZ:"420",DE:"49",DJ:"253",DK:"45",DM:"1767",DO:"1809",DZ:"213",EC:"593",EE:"372",EG:"20",ER:"291",ES:"34",ET:"251",FI:"358",FJ:"679",FK:"500",FM:"691",FO:"298",FR:"33",GA:"241",GB:"44",GD:"1473",GE:"995",GH:"233",GI:"350",GL:"299",GM:"220",GN:"224",GQ:"240",GR:"30",GT:"502",GU:"1671",GW:"245",GY:"592",HK:"852",HN:"504",HR:"385",HT:"509",HU:"36",ID:"62",IE:"353",IL:"972",IM:"44",IN:"91",IQ:"964",IR:"98",IS:"354",IT:"39",JM:"1876",JO:"962",JP:"81",KE:"254",KG:"996",KH:"855",KI:"686",KM:"269",KN:"1869",KP:"850",KR:"82",KW:"965",KY:"1345",KZ:"7",LA:"856",LB:"961",LC:"1758",LI:"423",LK:"94",LR:"231",LS:"266",LT:"370",LU:"352",LV:"371",LY:"218",MA:"212",MC:"377",MD:"373",ME:"382",MF:"1599",MG:"261",MH:"692",MK:"389",ML:"223",MM:"95",MN:"976",MO:"853",MP:"1670",MR:"222",MS:"1664",MT:"356",MU:"230",MV:"960",MW:"265",MX:"52",MY:"60",MZ:"258",NA:"264",NC:"687",NE:"227",NG:"234",NI:"505",NL:"31",NO:"47",NP:"977",NR:"674",NU:"683",NZ:"64",OM:"968",PA:"507",PE:"51",PF:"689",PG:"675",PH:"63",PK:"92",PL:"48",PM:"508",PN:"870",PR:"1",PT:"351",PW:"680",PY:"595",QA:"974",RO:"40",RS:"381",RU:"7",RW:"250",SA:"966",SB:"677",SC:"248",SD:"249",SE:"46",SG:"65",SH:"290",SI:"386",SK:"421",SL:"232",SM:"378",SN:"221",SO:"252",SR:"597",ST:"239",SV:"503",SY:"963",SZ:"268",TC:"1649",TD:"235",TG:"228",TH:"66",TJ:"992",TK:"690",TL:"670",TM:"993",TN:"216",TO:"676",TR:"90",TT:"1868",TV:"688",TW:"886",TZ:"255",UA:"380",UG:"256",US:"1",UY:"598",UZ:"998",VA:"39",VC:"1784",VE:"58",VG:"1284",VI:"1340",VN:"84",VU:"678",WF:"681",WS:"685",XK:"381",YE:"967",YT:"262",ZA:"27",ZM:"260",ZW:"263"},this.countryToLanguageMapping={ad:"ca",ae:"ar",af:"fa,ps",ag:"en",ai:"en",al:"sq",am:"hy",an:"nl,en",ao:"pt",ar:"es",as:"en,sm",at:"de",au:"en",aw:"nl,pap",ax:"sv",ba:"bs,hr,sr",bb:"en",bd:"bn",be:"nl,fr,de",bf:"fr",bh:"ar",bi:"fr",bj:"fr",bl:"fr",bm:"en",bn:"ms",bo:"es,qu,ay",br:"pt",bs:"en",bt:"dz",bv:"no",bw:"en,tn",by:"be,ru",bz:"en",ca:"en,fr",cc:"en",cd:"fr",cf:"fr",cg:"fr",ch:"de,fr,it,rm",ci:"fr",ck:"en,rar",cl:"es",cm:"fr,en",cn:"zh",co:"es",cr:"es",cu:"es",cv:"pt",cx:"en",cy:"el,tr",cz:"cs","// de":"de",dj:"fr,ar,so",dk:"da",dm:"en",do:"es",dz:"ar",ec:"es",ee:"et",eg:"ar",eh:"ar,es,fr",er:"ti,ar,en",es:"ast,ca,es,eu,gl",et:"am,om",fi:"fi,sv,se",fj:"en",fk:"en",fm:"en",ga:"fr",gb:"en,ga,cy,gd,kw",gd:"en",ge:"ka",gf:"fr",gg:"en",gh:"en",gi:"en",gl:"kl,da",gm:"en",gn:"fr",gp:"fr",gq:"es,fr,pt",gr:"el",gs:"en",gt:"es",gu:"en,ch",gw:"pt",gy:"en",hk:"zh,en",hm:"en",hn:"es",ht:"fr,ht",ie:"en,ga",il:"he",im:"en",in:"hi,en",io:"en",iq:"ar,ku",ir:"fa",it:"it,de,fr",je:"en",jm:"en",jo:"ar",jp:"ja",ke:"sw,en",kg:"ky,ru",kh:"km",ki:"en",km:"ar,fr",kn:"en",kp:"ko",kr:"ko,en",kw:"ar",ky:"en",kz:"kk,ru",la:"lo",lb:"ar,fr",lc:"en",li:"de",lk:"si,ta",lr:"en",ls:"en,st",lu:"lb,fr,de",ly:"ar",ma:"ar",mc:"fr",md:"ru,uk,ro",me:"srp,sq,bs,hr,sr",mf:"fr",mg:"mg,fr",mh:"en,mh",ml:"fr",mm:"my",mo:"zh,pt",mp:"ch",mq:"fr",mr:"ar,fr",ms:"en",mt:"mt,en",mu:"mfe,fr,en",mv:"dv",mw:"en,ny",mx:"es",my:"ms",mz:"pt",na:"en,sf,de",nc:"fr",ne:"fr",nf:"en,pih",ng:"en",ni:"es",no:"nb,nn,no,se",np:"ne",nr:"na,en",nu:"niu,en",nz:"mi,en",om:"ar",pa:"es",pe:"es",pf:"fr",pg:"en,tpi,ho",ph:"en,tl",pk:"en,ur",pm:"fr",pn:"en,pih",pr:"es,en",ps:"ar,he",pw:"en,pau,ja,sov,tox",py:"es,gn",qa:"ar",re:"fr",rs:"sr",rw:"rw,fr,en",sa:"ar",sb:"en",sc:"fr,en,crs",sd:"ar,en",se:"sv",sg:"en,ms,zh,ta",sh:"en",si:"sl",sj:"no",sl:"en",sm:"it",sn:"fr",so:"so,ar",sr:"nl",st:"pt",ss:"en",sv:"es",sy:"ar",sz:"en,ss",tc:"en",td:"fr,ar",tf:"fr",tg:"fr",tj:"tg,ru",tk:"tkl,en,sm",tl:"pt,tet",tm:"tk",tn:"ar",to:"en",tt:"en",tv:"en",tw:"zh",tz:"sw,en",ua:"uk",ug:"en,sw",um:"en",us:"en",uy:"es",uz:"uz,kaa",va:"it",vc:"en",ve:"es",vg:"en",vi:"en",vn:"vi",vu:"bi,en,fr",wf:"fr",ws:"sm,en",ye:"ar",yt:"fr",za:"zu,xh,af,st,tn,en",zm:"en",zw:"en,sn,nd "}}return C(e,[{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.default.info(""),a.default.info("[countryService] === STARTING ==="),this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/",e.prev=1,e.next=4,this.getAvailableCountries();case 4:t=e.sent,this.countries=t.map((function(e){var t={name:e.fullname,"alpha-3":e.isoAlpha3Code,"alpha-2":e.isoAlpha2Code};return"FRA"===e.isoAlpha3Code&&(t.default=!0),t})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),a.default.info("[countryService] === warning === "+e.t0.message);case 11:a.default.info("[countryService] === STARTED  === "+this.countries.length+" countries"),a.default.info("");case 12:case"end":return e.stop()}}),e,this,[[1,8]])})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.default.info("[countryService] STOPPED");case 1:case"end":return e.stop()}}),e)})))}},{key:"getCountries",value:function(){var e=this,t=this.countries.map((function(t){var n=e.getCountryLabel(t["alpha-2"]);if(n){var r=o.default.translate(n);r&&r!==n&&(t.name=r)}return t}));return t.sort((function(e,t){return e.name.localeCompare(t.name,o.default.getCurrentLanguage())})),t}},{key:"getCountryStates",value:function(e){return e&&"USA"===e["alpha-3"]?this.statesOfAmerica:e&&"CAN"===e["alpha-3"]?this.statesOfCanada:{}}},{key:"getCountry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return t?this.getDefaultCountry():null;var n=this.countries.filter((function(t){return t["alpha-3"]===e}));return n.length>0?n[0]:null}},{key:"getDefaultCountry",value:function(){var e=this.countries.filter((function(e){return!0===e.default}));return e.length>0?e[0]:this.countries[0]}},{key:"getCountryName",value:function(e){return this.getCountry(e)?this.getCountry(e).name:null}},{key:"getCountryCode",value:function(e){return e?e["alpha-3"]:null}},{key:"getStateName",value:function(e,t){return e&&t?"USA"===e?this.statesOfAmerica[t]:"CAN"===e?this.statesOfCanada[t]:"":""}},{key:"getDefaultState",value:function(e){return e&&"USA"===e["alpha-3"]?"AL":e&&"CAN"===e["alpha-3"]?"AB":null}},{key:"getAlpha2Code",value:function(e){if(!e)return null;var t=this.countries.filter((function(t){return t["alpha-3"]===e}));return t.length>0?t[0]["alpha-2"]:null}},{key:"getCountryLabel",value:function(e){var t;return(t=3===e.length?this.getAlpha2Code(e):e)?"country"+t:null}},{key:"getDataCenterLabel",value:function(e,t){var n=this.getRegionLabel(e.name);if(e.country===t)n=this.getCountryLabel(e.country);else{var r=this.datacenters.find((function(t){return t["alpha-3"]===e.country}));r&&(n=this.getRegionLabel(r.region))}return n}},{key:"getRegionLabel",value:function(e){return e}},{key:"getInternationalCallingCode",value:function(e){if(e){var t=e.toUpperCase();return this.countryToInternationalCallingCodeMapping[t]}}},{key:"mapCountryToLanguages",value:function(e){if(e){var t=e.toLowerCase();return void 0!==this.countryToLanguageMapping[t]?this.countryToLanguageMapping[t].split(","):[t]}}},{key:"getAvailableCountries",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.portalURL+"/countries",{method:"GET",headers:i.default.getRequestHeader()});case 3:if((t=e.sent).ok){e.next=6;break}throw t;case 6:return e.next=8,t.json();case 8:return e.abrupt("return",e.sent.data);case 11:return e.prev=11,e.t0=e.catch(0),e.next=15,this.errorHelperService.getErrorInfo(e.t0,"getAvailableCountries");case 15:throw n=e.sent,a.default.error("[countryService] "+n.message),n.error;case 17:case"end":return e.stop()}}),e,this,[[0,11]])})))}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.countryService||(t.rainbow.countryService=new e),t.rainbow.countryService}}]),e}();t.CountryService=c,t.default=c.getInstance()},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(67),o=n(70),s=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return i(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new o.ObjectUnsubscribedError;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(a.Subject);t.BehaviorSubject=s},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(55),o=n(56),s=n(45),c=n(70),l=n(81),u=n(69),d=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return i(t,e),t}(o.Subscriber);t.SubjectSubscriber=d;var h=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return i(t,e),t.prototype[u.rxSubscriber]=function(){return new d(this)},t.prototype.lift=function(e){var t=new f(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new c.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new c.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),s.Subscription.EMPTY):this.isStopped?(e.complete(),s.Subscription.EMPTY):(this.observers.push(e),new l.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new a.Observable;return e.source=this,e},t.create=function(e,t){return new f(e,t)},t}(a.Observable);t.Subject=h;var f=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return i(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):s.Subscription.EMPTY},t}(h);t.AnonymousSubject=f},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=!1;t.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else r&&console.log("RxJS: Back to a better error behavior. Thank you. <3");r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),t.$$rxSubscriber=t.rxSubscriber},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}();t.ObjectUnsubscribedError=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function e(){S(this,e)};r.USER="user",r.ROOM="room";var i=function(){function e(t,n){S(this,e),this.viewerId=null,this.type=null,this.contact=null,this.room=null,this.channel=null,this.viewerId=t,this.type=n}return C(e,null,[{key:"createFromData",value:function(t){return t.map((function(t){return new e(t.viewerId,t.type)}))}}]),e}();t.FileViewer=i},function(e,t,n){var r,i,a,o,s,c,l,u;e.exports=(i=(r=u=n(12)).lib,a=i.WordArray,o=i.Hasher,s=r.algo,c=[],l=s.SHA1=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=0;l<80;l++){if(l<16)c[l]=0|e[t+l];else{var u=c[l-3]^c[l-8]^c[l-14]^c[l-16];c[l]=u<<1|u>>>31}var d=(r<<5|r>>>27)+s+c[l];d+=l<20?1518500249+(i&a|~i&o):l<40?1859775393+(i^a^o):l<60?(i&a|i&o|a&o)-1894007588:(i^a^o)-899497514,s=o,o=a,a=i<<30|i>>>2,i=r,r=d}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+a|0,n[3]=n[3]+o|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=o._createHelper(l),r.HmacSHA1=o._createHmacHelper(l),u.SHA1)},function(e,t,n){var r,i,a;e.exports=(i=(r=n(12)).lib.Base,a=r.enc.Utf8,void(r.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=a.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),s=i.words,c=o.words,l=0;l<n;l++)s[l]^=1549556828,c[l]^=909522486;i.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.resizeImage=function(e,t,n){return new Promise((function(r,i){var a=new Image;a.onload=function(){var e=a.width,i=a.height;e>i?e>t&&(i*=t/e,e=t):i>n&&(e*=n/i,i=n);var o=document.createElement("canvas");o.width=e,o.height=i,a.width=e,a.height=i,a.crossOrigin="Anonymous",o.getContext("2d").drawImage(a,0,0,e,i);var s=new Image;s.src=o.toDataURL("image/png"),r(s)},a.onerror=function(){i()},a.src=e}))},t.getBinaryData=function(e){for(var t=e.src.indexOf("image/")+6,n=e.src.indexOf(";base64,"),r=e.src.slice(n+8),i=e.src.slice(t,n),a=window.atob(r),o=a.length,s=new Uint8Array(o),c=0;c<o;c++)s[c]=a.charCodeAt(c);return{type:i,data:s}}},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(56);t.distinctUntilChanged=function(e,t){return function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.compare,this.keySelector))},e}(),s=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return i(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(i){return this.destination.error(i)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(i){return this.destination.error(i)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(a.Subscriber)},function(e,t,n){var r;window,r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/strophe.js")}({"./node_modules/webpack/buildin/global.js":function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(r){"object"==typeof window&&(n=window)}e.exports=n},"./src/bosh.js":function(e,t,n){n.r(t);var r=n("./src/core.js"),i=r.default.Strophe,a=r.default.$build;i.Request=function(e,t,n,r){this.id=++i._requestId,this.xmlData=e,this.data=i.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},i.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw i.error("invalid response received"),i.error("responseText: "+this.xhr.responseText),i.error("responseXML: "+i.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(i.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){i.error("invalid response received: "+e.querySelector("parsererror").textContent),i.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=i.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},i.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},i.Bosh.prototype={strip:null,_buildBody:function(){var e=a("body",{rid:this.rid++,xmlns:i.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":i.NS.BOSH});n&&r.attrs({route:n});var a=this._conn._connect_cb;this._requests.push(new i.Request(r.tree(),this._onRequestStateChange.bind(this,a.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,r,a,o,s){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=i.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=a||this.wait,this.hold=o||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(i.Status.ATTACHED,null)},_restore:function(e,t,n,r,a){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==e||i.getBareJidFromJid(o.jid)===i.getBareJidFromJid(e)||null===i.getNodeFromJid(e)&&i.getDomainFromJid(o.jid)===e))){var s=new Error("_restore: no restoreable session.");throw s.name="StropheSessionError",s}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,t,n,r,a)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");i.error("BOSH-Connection failed: "+n);var r=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(i.Status.CONNFAIL,n)):this._conn._changeConnectStatus(i.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),i.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var a=e.getAttribute("requests");a&&(this.window=parseInt(a,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10));var c=e.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)},_hitError:function(e){this.errors++,i.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){i.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new i.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(i.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":i.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new i.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(i.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(i.TIMEOUT*this.wait)&&(i.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(i.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){var n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(r){i.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n},_onRequestStateChange:function(e,t){if(i.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)t.abort=!1;else if(4===t.xhr.readyState){var n=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);var r=n>0&&n<500,a=t.sends>this._conn.maxRetries;if((r||a)&&(this._removeRequest(t),i.debug("request id "+t.id+" should now be removed")),200===n){var o=this._requests[0]===t;(this._requests[1]===t||o&&this._requests.length>0&&this._requests[0].age()>Math.floor(i.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),i.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===n||n>=400&&n<600||n>=12e3?(i.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(i.Status.DISCONNECTING,null),this._conn._doDisconnect())):i.error("request id "+t.id+"."+t.sends+" error "+n+" happened");r||a?a&&!this._conn.connected&&this._conn._changeConnectStatus(i.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],r=this._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var a=n.age(),o=!isNaN(a)&&a>Math.floor(i.TIMEOUT*this.wait),s=null!==n.dead&&n.timeDead()>Math.floor(i.SECONDARY_TIMEOUT*this.wait),c=4===n.xhr.readyState&&(r<1||r>=500);if((o||s||c)&&(s&&i.error("Request ".concat(this._requests[e].id," timed out (secondary), restarting")),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new i.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){i.debug("request id "+n.id+"."+n.sends+" posting");try{var l=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",l),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(h){return i.error("XHR open failed: "+h.toString()),this._conn.connected||this._conn._changeConnectStatus(i.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.xhr.setRequestHeader(r,e[r])}n.xhr.send(n.data)};if(n.sends>1){var d=1e3*Math.min(Math.floor(i.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout((function(){u()}),d)}else u();n.sends++,this._conn.xmlOutput!==i.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==i.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else i.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)}},_removeRequest:function(e){i.debug("removing request");for(var t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!==t.message)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){i.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new i.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((function(){return e._conn._onIdle()}),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?i.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):i.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":function(e,t,n){n.r(t),n.d(t,"Strophe",(function(){return d})),n.d(t,"$build",(function(){return s})),n.d(t,"$iq",(function(){return l})),n.d(t,"$msg",(function(){return c})),n.d(t,"$pres",(function(){return u}));var r=n("./src/md5.js");n.d(t,"MD5",(function(){return r.default}));var i=n("./src/sha1.js");n.d(t,"SHA1",(function(){return i.default}));var a=n("./src/utils.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return new d.Builder(e,t)}function c(e){return new d.Builder("message",e)}function l(e){return new d.Builder("iq",e)}function u(e){return new d.Builder("presence",e)}var d={VERSION:"1.3.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<d.XHTML.tags.length;t++)if(e===d.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==d.XHTML.attributes[e]&&d.XHTML.attributes[e].length>0)for(var n=0;n<d.XHTML.attributes[e].length;n++)if(t===d.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<d.XHTML.css.length;t++)if(e===d.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){d.NS[e]=t},forEachChild:function(e,t,n){for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];i.nodeType!==d.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return d._xmlGenerator||(d._xmlGenerator=d._makeGenerator()),d._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(r){e=null}return e},xmlElement:function(e){if(!e)return null;for(var t=d.xmlGenerator().createElement(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r)if("string"==typeof r||"number"==typeof r)t.appendChild(d.xmlTextNode(r));else if("object"===o(r)&&"function"==typeof r.sort)for(var i=0;i<r.length;i++){var a=r[i];"object"===o(a)&&"function"==typeof a.sort&&void 0!==a[1]&&null!==a[1]&&t.setAttribute(a[0],a[1])}else if("object"===o(r))for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&void 0!==r[s]&&null!==r[s]&&t.setAttribute(s,r[s])}return t},xmlescape:function(e){return(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return d.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;return DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)),t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===d.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===d.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return d.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===d.ElementType.NORMAL){t=d.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var r=0;r<e.childNodes.length;r++)t.appendChild(d.copyElement(e.childNodes[r]))}else e.nodeType===d.ElementType.TEXT&&(t=d.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t;if(e.nodeType===d.ElementType.NORMAL){var n=e.nodeName.toLowerCase();if(d.XHTML.validTag(n))try{t=d.xmlElement(n);for(var r=0;r<d.XHTML.attributes[n].length;r++){var i=d.XHTML.attributes[n][r],a=e.getAttribute(i);if(null!=a&&""!==a&&!1!==a&&0!==a)if("style"===i&&"object"===o(a)&&void 0!==a.cssText&&(a=a.cssText),"style"===i){for(var s=[],c=a.split(";"),l=0;l<c.length;l++){var u=c[l].split(":"),h=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(d.XHTML.validCSS(h)){var f=u[1].replace(/^\s*/,"").replace(/\s*$/,"");s.push(h+": "+f)}}s.length>0&&(a=s.join("; "),t.setAttribute(i,a))}else t.setAttribute(i,a)}for(var p=0;p<e.childNodes.length;p++)t.appendChild(d.createHtml(e.childNodes[p]))}catch(g){t=d.xmlTextNode("")}else{t=d.xmlGenerator().createDocumentFragment();for(var m=0;m<e.childNodes.length;m++)t.appendChild(d.createHtml(e.childNodes[m]))}}else if(e.nodeType===d.ElementType.FRAGMENT){t=d.xmlGenerator().createDocumentFragment();for(var v=0;v<e.childNodes.length;v++)t.appendChild(d.createHtml(e.childNodes[v]))}else e.nodeType===d.ElementType.TEXT&&(t=d.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=d.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&d.fatal(e.stack),e.sourceURL?d.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?d.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):d.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"===o(window.console)&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var t,n=(t=Array(e.attributes.length).keys(),function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(t)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()).map((function(t){return e.attributes[t].nodeName}));n.sort();var r=n.reduce((function(t,n){return"".concat(t," ").concat(n,'="').concat(d.xmlescape(e.attributes.getNamedItem(n).value),'"')}),"<".concat(e.nodeName));if(e.childNodes.length>0){r+=">";for(var i=0;i<e.childNodes.length;i++){var a=e.childNodes[i];switch(a.nodeType){case d.ElementType.NORMAL:r+=d.serialize(a);break;case d.ElementType.TEXT:r+=d.xmlescape(a.nodeValue);break;case d.ElementType.CDATA:r+="<![CDATA["+a.nodeValue+"]]>"}}r+="</"+e.nodeName+">"}else r+="/>";return r},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){d._connectionPlugins[e]=t},Builder:function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=d.NS.CLIENT:t||(t={xmlns:d.NS.CLIENT})),this.nodeTree=d.xmlElement(e,t),this.node=this.nodeTree}};d.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return d.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var r=d.xmlElement(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this},cnode:function(e){var t,n=d.xmlGenerator();try{t=void 0!==n.importNode}catch(i){t=!1}var r=t?n.importNode(e,!0):d.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(e){var t=d.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=d.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},d.Handler=function(e,t,n,r,i,a,o){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(d.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=a?d.getBareJidFromJid(a):null:this.from=a,this.user=!0},d.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||(d.forEachChild(e,null,(function(e){t.getNamespace(e)===t.ns&&(n=!0)})),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=d.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!d.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(n){throw d._handleError(n),n}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},d.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},d.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},d.Connection=function(e,t){var n=this;this.service=e,this.options=t||{};var r=this.options.protocol||"";for(var i in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===r.indexOf("ws")?this._proto=new d.Websocket(this):this._proto=new d.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((function(){return n._onIdle()}),100),a.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),d._connectionPlugins)if(Object.prototype.hasOwnProperty.call(d._connectionPlugins,i)){var o=function(){};o.prototype=d._connectionPlugins[i],this[i]=new o,this[i].init(this)}},d.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,r,i,a,o){this.jid=e,this.authzid=d.getBareJidFromJid(this.jid),this.authcid=o||d.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=d.getDomainFromJid(this.jid),this._changeConnectStatus(d.Status.CONNECTING,null),this._proto._connect(r,i,a)},attach:function(e,t,n,r,i,a,o){if(!(this._proto instanceof d.Bosh)){var s=new Error('The "attach" method can only be used with a BOSH connection.');throw s.name="StropheSessionError",s}this._proto._attach(e,t,n,r,i,a,o)},restore:function(e,t,n,r,i){if(!this._sessionCachingSupported()){var a=new Error('The "restore" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._restore(e,t,n,r,i)},_sessionCachingSupported:function(){if(this._proto instanceof d.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,r){var i=this,a=null;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){var s=this.addHandler((function(e){a&&i.deleteTimedHandler(a),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)}),null,"presence",null,o);r&&(a=this.addTimedHandler(r,(function(){return i.deleteHandler(s),n&&n(null),!1})))}return this.send(e),o},sendIQ:function(e,t,n,r){var i=this,a=null;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){var s=this.addHandler((function(e){a&&i.deleteTimedHandler(a);var r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){var o=new Error("Got bad IQ type of ".concat(r));throw o.name="StropheError",o}n&&n(e)}}),null,"iq",["error","result"],o);r&&(a=this.addTimedHandler(r,(function(){return i.deleteHandler(s),n&&n(null),!1})))}return this.send(e),o},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)},_sendRestart:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((function(){return e._onIdle()}),100)},addTimedHandler:function(e,t){var n=new d.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,r,i,a,o){var s=new d.Handler(e,t,n,r,i,a,o);return this.addHandlers.push(s),s},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[d.SASLAnonymous,d.SASLExternal,d.SASLMD5,d.SASLOAuthBearer,d.SASLXOAuth2,d.SASLPlain,d.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(d.Status.DISCONNECTING,e),d.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=u({xmlns:d.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else d.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(var r in d._connectionPlugins)if(Object.prototype.hasOwnProperty.call(d._connectionPlugins,r)){var i=this[r];if(i.statusChanged)try{i.statusChanged(e,t)}catch(a){d.error("".concat(r," plugin caused an exception changing status: ").concat(a))}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(o){d._handleError(o),d.error("User connection callback caused an exception: ".concat(o))}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),d.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(d.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){var n=this;d.info("_dataRecv called");var r=this._proto._reqToData(e);if(null!==r){for(this.xmlInput!==d.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==d.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(d.serialize(r)));this.removeHandlers.length>0;){var i=this.removeHandlers.pop(),a=this.handlers.indexOf(i);a>=0&&this.handlers.splice(a,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var o=r.getAttribute("type");if(null!==o&&"terminate"===o){if(this.disconnecting)return;var s=r.getAttribute("condition"),c=r.getElementsByTagName("conflict");return null!==s?("remote-stream-error"===s&&c.length>0&&(s="conflict"),this._changeConnectStatus(d.Status.CONNFAIL,s)):this._changeConnectStatus(d.Status.CONNFAIL,d.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(s)}d.forEachChild(r,null,(function(e){var t=n.handlers;n.handlers=[];for(var r=0;r<t.length;r++){var i=t[r];try{(!i.isMatch(e)||!n.authenticated&&i.user||i.run(e))&&n.handlers.push(i)}catch(a){d.warn("Removing Strophe handlers due to uncaught exception: "+a.message)}}}))}}},mechanisms:{},_connect_cb:function(e,t,n){var r;d.info("_connect_cb was called"),this.connected=!0;try{r=this._proto._reqToData(e)}catch(c){if(c.name!==d.ErrorCondition.BAD_FORMAT)throw c;this._changeConnectStatus(d.Status.CONNFAIL,d.ErrorCondition.BAD_FORMAT),this._doDisconnect(d.ErrorCondition.BAD_FORMAT)}if(r&&(this.xmlInput!==d.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==d.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(d.serialize(r))),this._proto._connect_cb(r)!==d.Status.CONNFAIL))if(r.getElementsByTagNameNS?r.getElementsByTagNameNS(d.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0){var i=[],a=r.getElementsByTagName("mechanism");if(a.length>0)for(var o=0;o<a.length;o++){var s=d.getText(a[o]);this.mechanisms[s]&&i.push(this.mechanisms[s])}0!==i.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(i):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,r=t+1;r<e.length;++r)e[r].prototype.priority>e[n].prototype.priority&&(n=r);if(n!==t){var i=e[t];e[t]=e[n],e[n]=i}}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var r=s("auth",{xmlns:d.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var i=this._sasl_mechanism.onChallenge(this,null);r.t(btoa(i))}this.send(r.tree()),t=!0;break}return t},_attemptLegacyAuth:function(){null===d.getNodeFromJid(this.jid)?(this._changeConnectStatus(d.Status.CONNFAIL,d.ErrorCondition.MISSING_JID_NODE),this.disconnect(d.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(d.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(l({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:d.NS.AUTH}).c("username",{}).t(d.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(d.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),r=s("response",{xmlns:d.NS.SASL});return""!==n&&r.t(btoa(n)),this.send(r.tree()),!0},_auth1_cb:function(e){var t=l({type:"set",id:"_auth_2"}).c("query",{xmlns:d.NS.AUTH}).c("username",{}).t(d.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return d.getResourceFromJid(this.jid)||(this.jid=d.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(d.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){var t=this;if(this._sasl_data["server-signature"]){var n,r=atob(d.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===r[1]&&(n=r[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}d.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var i=[],a=function(e,n){for(;e.length;)t.deleteHandler(e.pop());return t._sasl_auth1_cb(n),!1};return i.push(this._addSysHandler((function(e){return a(i,e)}),null,"stream:features",null,null)),i.push(this._addSysHandler((function(e){return a(i,e)}),d.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(d.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=d.getResourceFromJid(this.jid);return r?this.send(l({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:d.NS.BIND}).c("resource",{}).t(r).tree()):this.send(l({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:d.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){var t;if("error"===e.getAttribute("type"))return d.info("SASL binding failed."),e.getElementsByTagName("conflict").length>0&&(t=d.ErrorCondition.CONFLICT),this._changeConnectStatus(d.Status.AUTHFAIL,t,e),!1;var n=e.getElementsByTagName("bind");if(!(n.length>0))return d.info("SASL binding failed."),this._changeConnectStatus(d.Status.AUTHFAIL,null,e),!1;var r=n[0].getElementsByTagName("jid");r.length>0&&(this.jid=d.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(l({type:"set",id:"_session_auth_2"}).c("session",{xmlns:d.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(d.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(d.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return d.info("Session creation failed."),this._changeConnectStatus(d.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(d.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(d.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(d.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new d.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,r,i){var a=new d.Handler(e,t,n,r,i);return a.user=!1,this.addHandlers.push(a),a},_onDisconnectTimeout:function(){return d.info("_onDisconnectTimeout was called"),this._changeConnectStatus(d.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);n>=0&&this.timedHandlers.splice(n,1)}for(var r=(new Date).getTime(),i=[],a=0;a<this.timedHandlers.length;a++){var o=this.timedHandlers[a];!this.authenticated&&o.user||(o.lastCalled+o.period-r<=0?o.run()&&i.push(o):i.push(o))}this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((function(){return e._onIdle()}),100))}},d.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},d.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},d.SASLAnonymous=function(){},d.SASLAnonymous.prototype=new d.SASLMechanism("ANONYMOUS",!1,20),d.SASLAnonymous.prototype.test=function(e){return null===e.authcid},d.SASLPlain=function(){},d.SASLPlain.prototype=new d.SASLMechanism("PLAIN",!0,50),d.SASLPlain.prototype.test=function(e){return null!==e.authcid},d.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,a.default.utf16to8(t)},d.SASLSHA1=function(){},d.SASLSHA1.prototype=new d.SASLMechanism("SCRAM-SHA-1",!0,70),d.SASLSHA1.prototype.test=function(e){return null!==e.authcid},d.SASLSHA1.prototype.onChallenge=function(e,t,n){var o=n||r.default.hexdigest(1234567890*Math.random()),s="n="+a.default.utf16to8(e.authcid);return s+=",r=",s+=o,e._sasl_data.cnonce=o,e._sasl_data["client-first-message-bare"]=s,s="n,,"+s,this.onChallenge=function(e,t){for(var n,r,o,s,c,l,u,d,h="c=biws,",f="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),p=e._sasl_data.cnonce,m=/([a-z]+)=([^,]+)(,|$)/;t.match(m);){var v=t.match(m);switch(t=t.replace(v[0],""),v[1]){case"r":n=v[2];break;case"s":r=v[2];break;case"i":o=v[2]}}if(n.substr(0,p.length)!==p)return e._sasl_data={},e._sasl_failure_cb();f+=h+="r="+n,r=atob(r),r+="\0\0\0\x01";var g=a.default.utf16to8(e.pass);for(s=l=i.default.core_hmac_sha1(g,r),u=1;u<o;u++){for(c=i.default.core_hmac_sha1(g,i.default.binb2str(l)),d=0;d<5;d++)s[d]^=c[d];l=c}s=i.default.binb2str(s);var y=i.default.core_hmac_sha1(s,"Client Key"),b=i.default.str_hmac_sha1(s,"Server Key"),S=i.default.core_hmac_sha1(i.default.str_sha1(i.default.binb2str(y)),f);for(e._sasl_data["server-signature"]=i.default.b64_hmac_sha1(b,f),d=0;d<5;d++)y[d]^=S[d];return h+",p="+btoa(i.default.binb2str(y))},s},d.SASLMD5=function(){},d.SASLMD5.prototype=new d.SASLMechanism("DIGEST-MD5",!1,60),d.SASLMD5.prototype.test=function(e){return null!==e.authcid},d.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},d.SASLMD5.prototype.onChallenge=function(e,t,n){for(var i=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,o=n||r.default.hexdigest(""+1234567890*Math.random()),s="",c=null,l="";t.match(i);){var u=t.match(i);switch(t=t.replace(u[0],""),u[2]=u[2].replace(/^"(.+)"$/,"$1"),u[1]){case"realm":s=u[2];break;case"nonce":l=u[2];break;case"qop":u[2];break;case"host":c=u[2]}}var d=e.servtype+"/"+e.domain;null!==c&&(d=d+"/"+c);var h=a.default.utf16to8(e.authcid+":"+s+":"+this._connection.pass),f=r.default.hash(h)+":"+l+":"+o,p="AUTHENTICATE:"+d,m="";return m+="charset=utf-8,",m+="username="+this._quote(a.default.utf16to8(e.authcid))+",",m+="realm="+this._quote(s)+",",m+="nonce="+this._quote(l)+",",m+="nc=00000001,",m+="cnonce="+this._quote(o)+",",m+="digest-uri="+this._quote(d)+",",m+="response="+r.default.hexdigest(r.default.hexdigest(f)+":"+l+":00000001:"+o+":auth:"+r.default.hexdigest(p))+",",m+="qop=auth",this.onChallenge=function(){return""},m},d.SASLOAuthBearer=function(){},d.SASLOAuthBearer.prototype=new d.SASLMechanism("OAUTHBEARER",!0,40),d.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},d.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="\x01",t+="auth=Bearer ",t+=e.pass,t+="\x01",t+="\x01",a.default.utf16to8(t)},d.SASLExternal=function(){},d.SASLExternal.prototype=new d.SASLMechanism("EXTERNAL",!0,10),d.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},d.SASLXOAuth2=function(){},d.SASLXOAuth2.prototype=new d.SASLMechanism("X-OAUTH2",!0,30),d.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},d.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,a.default.utf16to8(t)},t.default={Strophe:d,$build:s,$iq:l,$msg:c,$pres:u,SHA1:i.default,MD5:r.default,b64_hmac_sha1:i.default.b64_hmac_sha1,b64_sha1:i.default.b64_sha1,str_hmac_sha1:i.default.str_hmac_sha1,str_sha1:i.default.str_sha1}},"./src/md5.js":function(e,t,n){n.r(t),n.d(t,"default",(function(){return d}));var r=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},i=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},a=function(e,t,n,i,a,o){return r((s=r(r(t,e),r(i,o)))<<(c=a)|s>>>32-c,n);var s,c},o=function(e,t,n,r,i,o,s){return a(t&n|~t&r,e,t,i,o,s)},s=function(e,t,n,r,i,o,s){return a(t&r|n&~r,e,t,i,o,s)},c=function(e,t,n,r,i,o,s){return a(t^n^r,e,t,i,o,s)},l=function(e,t,n,r,i,o,s){return a(n^(t|~r),e,t,i,o,s)},u=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,i,a,u,d=1732584193,h=-271733879,f=-1732584194,p=271733878,m=0;m<e.length;m+=16)n=d,i=h,a=f,u=p,d=o(d,h,f,p,e[m+0],7,-680876936),p=o(p,d,h,f,e[m+1],12,-389564586),f=o(f,p,d,h,e[m+2],17,606105819),h=o(h,f,p,d,e[m+3],22,-1044525330),d=o(d,h,f,p,e[m+4],7,-176418897),p=o(p,d,h,f,e[m+5],12,1200080426),f=o(f,p,d,h,e[m+6],17,-1473231341),h=o(h,f,p,d,e[m+7],22,-45705983),d=o(d,h,f,p,e[m+8],7,1770035416),p=o(p,d,h,f,e[m+9],12,-1958414417),f=o(f,p,d,h,e[m+10],17,-42063),h=o(h,f,p,d,e[m+11],22,-1990404162),d=o(d,h,f,p,e[m+12],7,1804603682),p=o(p,d,h,f,e[m+13],12,-40341101),f=o(f,p,d,h,e[m+14],17,-1502002290),h=o(h,f,p,d,e[m+15],22,1236535329),d=s(d,h,f,p,e[m+1],5,-165796510),p=s(p,d,h,f,e[m+6],9,-1069501632),f=s(f,p,d,h,e[m+11],14,643717713),h=s(h,f,p,d,e[m+0],20,-373897302),d=s(d,h,f,p,e[m+5],5,-701558691),p=s(p,d,h,f,e[m+10],9,38016083),f=s(f,p,d,h,e[m+15],14,-660478335),h=s(h,f,p,d,e[m+4],20,-405537848),d=s(d,h,f,p,e[m+9],5,568446438),p=s(p,d,h,f,e[m+14],9,-1019803690),f=s(f,p,d,h,e[m+3],14,-187363961),h=s(h,f,p,d,e[m+8],20,1163531501),d=s(d,h,f,p,e[m+13],5,-1444681467),p=s(p,d,h,f,e[m+2],9,-51403784),f=s(f,p,d,h,e[m+7],14,1735328473),h=s(h,f,p,d,e[m+12],20,-1926607734),d=c(d,h,f,p,e[m+5],4,-378558),p=c(p,d,h,f,e[m+8],11,-2022574463),f=c(f,p,d,h,e[m+11],16,1839030562),h=c(h,f,p,d,e[m+14],23,-35309556),d=c(d,h,f,p,e[m+1],4,-1530992060),p=c(p,d,h,f,e[m+4],11,1272893353),f=c(f,p,d,h,e[m+7],16,-155497632),h=c(h,f,p,d,e[m+10],23,-1094730640),d=c(d,h,f,p,e[m+13],4,681279174),p=c(p,d,h,f,e[m+0],11,-358537222),f=c(f,p,d,h,e[m+3],16,-722521979),h=c(h,f,p,d,e[m+6],23,76029189),d=c(d,h,f,p,e[m+9],4,-640364487),p=c(p,d,h,f,e[m+12],11,-421815835),f=c(f,p,d,h,e[m+15],16,530742520),h=c(h,f,p,d,e[m+2],23,-995338651),d=l(d,h,f,p,e[m+0],6,-198630844),p=l(p,d,h,f,e[m+7],10,1126891415),f=l(f,p,d,h,e[m+14],15,-1416354905),h=l(h,f,p,d,e[m+5],21,-57434055),d=l(d,h,f,p,e[m+12],6,1700485571),p=l(p,d,h,f,e[m+3],10,-1894986606),f=l(f,p,d,h,e[m+10],15,-1051523),h=l(h,f,p,d,e[m+1],21,-2054922799),d=l(d,h,f,p,e[m+8],6,1873313359),p=l(p,d,h,f,e[m+15],10,-30611744),f=l(f,p,d,h,e[m+6],15,-1560198380),h=l(h,f,p,d,e[m+13],21,1309151649),d=l(d,h,f,p,e[m+4],6,-145523070),p=l(p,d,h,f,e[m+11],10,-1120210379),f=l(f,p,d,h,e[m+2],15,718787259),h=l(h,f,p,d,e[m+9],21,-343485551),d=r(d,n),h=r(h,i),f=r(f,a),p=r(p,u);return[d,h,f,p]},d={hexdigest:function(e){return function(e){for(var t="",n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(u(i(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(u(i(e),8*e.length))}}},"./src/sha1.js":function(e,t,n){function r(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,r,o,l,u,d,h,f,p=new Array(80),m=1732584193,v=-271733879,g=-1732584194,y=271733878,b=-1009589776;for(n=0;n<e.length;n+=16){for(l=m,u=v,d=g,h=y,f=b,r=0;r<80;r++)p[r]=r<16?e[n+r]:c(p[r-3]^p[r-8]^p[r-14]^p[r-16],1),o=s(s(c(m,5),i(r,v,g,y)),s(s(b,p[r]),a(r))),b=y,y=g,g=c(v,30),v=m,m=o;m=s(m,l),v=s(v,u),g=s(g,d),y=s(y,h),b=s(b,f)}return[m,v,g,y,b]}function i(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function a(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function o(e,t){var n=l(e);n.length>16&&(n=r(n,8*e.length));for(var i=new Array(16),a=new Array(16),o=0;o<16;o++)i[o]=909522486^n[o],a[o]=1549556828^n[o];var s=r(i.concat(l(t)),512+8*t.length);return r(a.concat(s),672)}function s(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function c(e,t){return e<<t|e>>>32-t}function l(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function u(e){for(var t,n,r="",i=0;i<4*e.length;i+=3)for(t=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return r}function d(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}n.r(t),n.d(t,"default",(function(){return h}));var h={b64_hmac_sha1:function(e,t){return u(o(e,t))},b64_sha1:function(e){return u(r(l(e),8*e.length))},binb2str:d,core_hmac_sha1:o,str_hmac_sha1:function(e,t){return d(o(e,t))},str_sha1:function(e){return d(r(l(e),8*e.length))}}},"./src/strophe.js":function(e,t,n){n.r(t),function(e){var r=n("./src/core.js");n("./src/bosh.js"),n("./src/websocket.js"),n.d(t,"default",(function(){return r.default})),e.Strophe=r.default.Strophe,e.$build=r.default.$build,e.$iq=r.default.$iq,e.$msg=r.default.$msg,e.$pres=r.default.$pres}.call(this,n("./node_modules/webpack/buildin/global.js"))},"./src/utils.js":function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t),n.d(t,"default",(function(){return i}));var i={utf16to8:function(e){var t,n,r="",i=e.length;for(t=0;t<i;t++)(n=e.charCodeAt(t))>=0&&n<=127?r+=e.charAt(t):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var n="",i="",a="",o=e[t],s="object"===r(o),c=escape(unescape(s?o.value:o));s&&(n=o.expires?";expires="+o.expires:"",i=o.domain?";domain="+o.domain:"",a=o.path?";path="+o.path:""),document.cookie=t+"="+c+n+i+a}}}},"./src/websocket.js":function(e,t,n){n.r(t);var r=n("./src/core.js"),i=r.default.Strophe,a=r.default.$build;i.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},i.Websocket.prototype={_buildStream:function(){return a("open",{xmlns:i.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){var n;if(0===(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(i.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var r=n[0],a="",o="",s=0;s<r.childNodes.length;s++){var c=r.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?o=c.textContent:a=c.nodeName}var l="WebSocket stream error: ";return l+=a||"unknown",o&&(l+=" - "+o),i.error(l),this._conn._changeConnectStatus(t,a),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,i.Status.CONNFAIL))return i.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==i.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(i.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var r=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(e.data);var a=r.getAttribute("see-other-uri");if(a){var o=this._conn.service;(o.indexOf("wss:")>=0&&a.indexOf("wss:")>=0||o.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(i.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=a,this._connect())}else this._conn._changeConnectStatus(i.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var s=this._streamWrap(e.data),c=(new DOMParser).parseFromString(s,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(c,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t=a("close",{xmlns:i.NS.FRAMING});this._conn.xmlOutput(t.tree());var n=i.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(r){i.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){i.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(e){i.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(i.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(i.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(i.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):i.info("Websocket closed")},_no_auth_received:function(e){i.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(i.Status.CONNFAIL,i.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){i.error("Websocket error "+e),this._conn._changeConnectStatus(i.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n;n="restart"===e[t]?this._buildStream().tree():e[t];var r=i.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(e){var t,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var r=this._streamWrap(e.data);t=(new DOMParser).parseFromString(r,"text/xml").documentElement}return this._check_streamerror(t,i.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(i.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){i.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=i.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},e.exports=r()},function(e,t,n){n.d(t,"a",(function(){return o}));var r=n(7),i=n(23),a=n(30),o=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r.a(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new a.a;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(i.a)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isFunction=function(e){return"function"==typeof e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(68),i=n(80);t.empty={closed:!0,next:function(e){},error:function(e){if(r.config.useDeprecatedSynchronousErrorHandling)throw e;i.hostReportError(e)},complete:function(){}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.hostReportError=function(e){setTimeout((function(){throw e}),0)}},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return i(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(n(45).Subscription);t.SubjectSubscription=a},function(e,t,n){!function(e){e.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mrt_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiemParse:/vm|nm/i,isPM:function(e){return/^nm$/i.test(e)},meridiem:function(e,t,n){return e<12?n?"vm":"VM":n?"nm":"NM"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[M\xf4re om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",ss:"%d sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0661",2:"\u0662",3:"\u0663",4:"\u0664",5:"\u0665",6:"\u0666",7:"\u0667",8:"\u0668",9:"\u0669",0:"\u0660"},n={"\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9","\u0660":"0"},r=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},i={s:["\u0623\u0642\u0644 \u0645\u0646 \u062b\u0627\u0646\u064a\u0629","\u062b\u0627\u0646\u064a\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062b\u0627\u0646\u064a\u062a\u0627\u0646","\u062b\u0627\u0646\u064a\u062a\u064a\u0646"],"%d \u062b\u0648\u0627\u0646","%d \u062b\u0627\u0646\u064a\u0629","%d \u062b\u0627\u0646\u064a\u0629"],m:["\u0623\u0642\u0644 \u0645\u0646 \u062f\u0642\u064a\u0642\u0629","\u062f\u0642\u064a\u0642\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062f\u0642\u064a\u0642\u062a\u0627\u0646","\u062f\u0642\u064a\u0642\u062a\u064a\u0646"],"%d \u062f\u0642\u0627\u0626\u0642","%d \u062f\u0642\u064a\u0642\u0629","%d \u062f\u0642\u064a\u0642\u0629"],h:["\u0623\u0642\u0644 \u0645\u0646 \u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u0629 \u0648\u0627\u062d\u062f\u0629",["\u0633\u0627\u0639\u062a\u0627\u0646","\u0633\u0627\u0639\u062a\u064a\u0646"],"%d \u0633\u0627\u0639\u0627\u062a","%d \u0633\u0627\u0639\u0629","%d \u0633\u0627\u0639\u0629"],d:["\u0623\u0642\u0644 \u0645\u0646 \u064a\u0648\u0645","\u064a\u0648\u0645 \u0648\u0627\u062d\u062f",["\u064a\u0648\u0645\u0627\u0646","\u064a\u0648\u0645\u064a\u0646"],"%d \u0623\u064a\u0627\u0645","%d \u064a\u0648\u0645\u064b\u0627","%d \u064a\u0648\u0645"],M:["\u0623\u0642\u0644 \u0645\u0646 \u0634\u0647\u0631","\u0634\u0647\u0631 \u0648\u0627\u062d\u062f",["\u0634\u0647\u0631\u0627\u0646","\u0634\u0647\u0631\u064a\u0646"],"%d \u0623\u0634\u0647\u0631","%d \u0634\u0647\u0631\u0627","%d \u0634\u0647\u0631"],y:["\u0623\u0642\u0644 \u0645\u0646 \u0639\u0627\u0645","\u0639\u0627\u0645 \u0648\u0627\u062d\u062f",["\u0639\u0627\u0645\u0627\u0646","\u0639\u0627\u0645\u064a\u0646"],"%d \u0623\u0639\u0648\u0627\u0645","%d \u0639\u0627\u0645\u064b\u0627","%d \u0639\u0627\u0645"]},a=function(e){return function(t,n,a,o){var s=r(t),c=i[e][r(t)];return 2===s&&(c=c[n?0:1]),c.replace(/%d/i,t)}},o=["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"];e.defineLocale("ar",{months:o,monthsShort:o,weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/\u200fM/\u200fYYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0635|\u0645/,isPM:function(e){return"\u0645"===e},meridiem:function(e,t,n){return e<12?"\u0635":"\u0645"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u064b\u0627 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0628\u0639\u062f %s",past:"\u0645\u0646\u0630 %s",s:a("s"),ss:a("s"),m:a("m"),mm:a("m"),h:a("h"),hh:a("h"),d:a("d"),dd:a("d"),M:a("M"),MM:a("M"),y:a("y"),yy:a("y")},preparse:function(e){return e.replace(/[\u0661\u0662\u0663\u0664\u0665\u0666\u0667\u0668\u0669\u0660]/g,(function(e){return n[e]})).replace(/\u060c/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"\u060c")},week:{dow:6,doy:12}})}(n(3))},function(e,t,n){!function(e){var t=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},n={s:["\u0623\u0642\u0644 \u0645\u0646 \u062b\u0627\u0646\u064a\u0629","\u062b\u0627\u0646\u064a\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062b\u0627\u0646\u064a\u062a\u0627\u0646","\u062b\u0627\u0646\u064a\u062a\u064a\u0646"],"%d \u062b\u0648\u0627\u0646","%d \u062b\u0627\u0646\u064a\u0629","%d \u062b\u0627\u0646\u064a\u0629"],m:["\u0623\u0642\u0644 \u0645\u0646 \u062f\u0642\u064a\u0642\u0629","\u062f\u0642\u064a\u0642\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062f\u0642\u064a\u0642\u062a\u0627\u0646","\u062f\u0642\u064a\u0642\u062a\u064a\u0646"],"%d \u062f\u0642\u0627\u0626\u0642","%d \u062f\u0642\u064a\u0642\u0629","%d \u062f\u0642\u064a\u0642\u0629"],h:["\u0623\u0642\u0644 \u0645\u0646 \u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u0629 \u0648\u0627\u062d\u062f\u0629",["\u0633\u0627\u0639\u062a\u0627\u0646","\u0633\u0627\u0639\u062a\u064a\u0646"],"%d \u0633\u0627\u0639\u0627\u062a","%d \u0633\u0627\u0639\u0629","%d \u0633\u0627\u0639\u0629"],d:["\u0623\u0642\u0644 \u0645\u0646 \u064a\u0648\u0645","\u064a\u0648\u0645 \u0648\u0627\u062d\u062f",["\u064a\u0648\u0645\u0627\u0646","\u064a\u0648\u0645\u064a\u0646"],"%d \u0623\u064a\u0627\u0645","%d \u064a\u0648\u0645\u064b\u0627","%d \u064a\u0648\u0645"],M:["\u0623\u0642\u0644 \u0645\u0646 \u0634\u0647\u0631","\u0634\u0647\u0631 \u0648\u0627\u062d\u062f",["\u0634\u0647\u0631\u0627\u0646","\u0634\u0647\u0631\u064a\u0646"],"%d \u0623\u0634\u0647\u0631","%d \u0634\u0647\u0631\u0627","%d \u0634\u0647\u0631"],y:["\u0623\u0642\u0644 \u0645\u0646 \u0639\u0627\u0645","\u0639\u0627\u0645 \u0648\u0627\u062d\u062f",["\u0639\u0627\u0645\u0627\u0646","\u0639\u0627\u0645\u064a\u0646"],"%d \u0623\u0639\u0648\u0627\u0645","%d \u0639\u0627\u0645\u064b\u0627","%d \u0639\u0627\u0645"]},r=function(e){return function(r,i,a,o){var s=t(r),c=n[e][t(r)];return 2===s&&(c=c[i?0:1]),c.replace(/%d/i,r)}},i=["\u062c\u0627\u0646\u0641\u064a","\u0641\u064a\u0641\u0631\u064a","\u0645\u0627\u0631\u0633","\u0623\u0641\u0631\u064a\u0644","\u0645\u0627\u064a","\u062c\u0648\u0627\u0646","\u062c\u0648\u064a\u0644\u064a\u0629","\u0623\u0648\u062a","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"];e.defineLocale("ar-dz",{months:i,monthsShort:i,weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/\u200fM/\u200fYYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0635|\u0645/,isPM:function(e){return"\u0645"===e},meridiem:function(e,t,n){return e<12?"\u0635":"\u0645"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u064b\u0627 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0628\u0639\u062f %s",past:"\u0645\u0646\u0630 %s",s:r("s"),ss:r("s"),m:r("m"),mm:r("m"),h:r("h"),hh:r("h"),d:r("d"),dd:r("d"),M:r("M"),MM:r("M"),y:r("y"),yy:r("y")},postformat:function(e){return e.replace(/,/g,"\u060c")},week:{dow:0,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ar-kw",{months:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648\u0632_\u063a\u0634\u062a_\u0634\u062a\u0646\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0646\u0628\u0631_\u062f\u062c\u0646\u0628\u0631".split("_"),monthsShort:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648\u0632_\u063a\u0634\u062a_\u0634\u062a\u0646\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0646\u0628\u0631_\u062f\u062c\u0646\u0628\u0631".split("_"),weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062a\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0627\u062d\u062f_\u0627\u062a\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u0627 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0641\u064a %s",past:"\u0645\u0646\u0630 %s",s:"\u062b\u0648\u0627\u0646",ss:"%d \u062b\u0627\u0646\u064a\u0629",m:"\u062f\u0642\u064a\u0642\u0629",mm:"%d \u062f\u0642\u0627\u0626\u0642",h:"\u0633\u0627\u0639\u0629",hh:"%d \u0633\u0627\u0639\u0627\u062a",d:"\u064a\u0648\u0645",dd:"%d \u0623\u064a\u0627\u0645",M:"\u0634\u0647\u0631",MM:"%d \u0623\u0634\u0647\u0631",y:"\u0633\u0646\u0629",yy:"%d \u0633\u0646\u0648\u0627\u062a"},week:{dow:0,doy:12}})}(n(3))},function(e,t,n){!function(e){var t={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",0:"0"},n=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},r={s:["\u0623\u0642\u0644 \u0645\u0646 \u062b\u0627\u0646\u064a\u0629","\u062b\u0627\u0646\u064a\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062b\u0627\u0646\u064a\u062a\u0627\u0646","\u062b\u0627\u0646\u064a\u062a\u064a\u0646"],"%d \u062b\u0648\u0627\u0646","%d \u062b\u0627\u0646\u064a\u0629","%d \u062b\u0627\u0646\u064a\u0629"],m:["\u0623\u0642\u0644 \u0645\u0646 \u062f\u0642\u064a\u0642\u0629","\u062f\u0642\u064a\u0642\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062f\u0642\u064a\u0642\u062a\u0627\u0646","\u062f\u0642\u064a\u0642\u062a\u064a\u0646"],"%d \u062f\u0642\u0627\u0626\u0642","%d \u062f\u0642\u064a\u0642\u0629","%d \u062f\u0642\u064a\u0642\u0629"],h:["\u0623\u0642\u0644 \u0645\u0646 \u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u0629 \u0648\u0627\u062d\u062f\u0629",["\u0633\u0627\u0639\u062a\u0627\u0646","\u0633\u0627\u0639\u062a\u064a\u0646"],"%d \u0633\u0627\u0639\u0627\u062a","%d \u0633\u0627\u0639\u0629","%d \u0633\u0627\u0639\u0629"],d:["\u0623\u0642\u0644 \u0645\u0646 \u064a\u0648\u0645","\u064a\u0648\u0645 \u0648\u0627\u062d\u062f",["\u064a\u0648\u0645\u0627\u0646","\u064a\u0648\u0645\u064a\u0646"],"%d \u0623\u064a\u0627\u0645","%d \u064a\u0648\u0645\u064b\u0627","%d \u064a\u0648\u0645"],M:["\u0623\u0642\u0644 \u0645\u0646 \u0634\u0647\u0631","\u0634\u0647\u0631 \u0648\u0627\u062d\u062f",["\u0634\u0647\u0631\u0627\u0646","\u0634\u0647\u0631\u064a\u0646"],"%d \u0623\u0634\u0647\u0631","%d \u0634\u0647\u0631\u0627","%d \u0634\u0647\u0631"],y:["\u0623\u0642\u0644 \u0645\u0646 \u0639\u0627\u0645","\u0639\u0627\u0645 \u0648\u0627\u062d\u062f",["\u0639\u0627\u0645\u0627\u0646","\u0639\u0627\u0645\u064a\u0646"],"%d \u0623\u0639\u0648\u0627\u0645","%d \u0639\u0627\u0645\u064b\u0627","%d \u0639\u0627\u0645"]},i=function(e){return function(t,i,a,o){var s=n(t),c=r[e][n(t)];return 2===s&&(c=c[i?0:1]),c.replace(/%d/i,t)}},a=["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"];e.defineLocale("ar-ly",{months:a,monthsShort:a,weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/\u200fM/\u200fYYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0635|\u0645/,isPM:function(e){return"\u0645"===e},meridiem:function(e,t,n){return e<12?"\u0635":"\u0645"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u064b\u0627 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0628\u0639\u062f %s",past:"\u0645\u0646\u0630 %s",s:i("s"),ss:i("s"),m:i("m"),mm:i("m"),h:i("h"),hh:i("h"),d:i("d"),dd:i("d"),M:i("M"),MM:i("M"),y:i("y"),yy:i("y")},preparse:function(e){return e.replace(/\u060c/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"\u060c")},week:{dow:6,doy:12}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ar-ma",{months:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648\u0632_\u063a\u0634\u062a_\u0634\u062a\u0646\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0646\u0628\u0631_\u062f\u062c\u0646\u0628\u0631".split("_"),monthsShort:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648\u0632_\u063a\u0634\u062a_\u0634\u062a\u0646\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0646\u0628\u0631_\u062f\u062c\u0646\u0628\u0631".split("_"),weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0627\u062d\u062f_\u0627\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u0627 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0641\u064a %s",past:"\u0645\u0646\u0630 %s",s:"\u062b\u0648\u0627\u0646",ss:"%d \u062b\u0627\u0646\u064a\u0629",m:"\u062f\u0642\u064a\u0642\u0629",mm:"%d \u062f\u0642\u0627\u0626\u0642",h:"\u0633\u0627\u0639\u0629",hh:"%d \u0633\u0627\u0639\u0627\u062a",d:"\u064a\u0648\u0645",dd:"%d \u0623\u064a\u0627\u0645",M:"\u0634\u0647\u0631",MM:"%d \u0623\u0634\u0647\u0631",y:"\u0633\u0646\u0629",yy:"%d \u0633\u0646\u0648\u0627\u062a"},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0661",2:"\u0662",3:"\u0663",4:"\u0664",5:"\u0665",6:"\u0666",7:"\u0667",8:"\u0668",9:"\u0669",0:"\u0660"},n={"\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9","\u0660":"0"};e.defineLocale("ar-sa",{months:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a\u0648_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648_\u0623\u063a\u0633\u0637\u0633_\u0633\u0628\u062a\u0645\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0641\u0645\u0628\u0631_\u062f\u064a\u0633\u0645\u0628\u0631".split("_"),monthsShort:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a\u0648_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648_\u0623\u063a\u0633\u0637\u0633_\u0633\u0628\u062a\u0645\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0641\u0645\u0628\u0631_\u062f\u064a\u0633\u0645\u0628\u0631".split("_"),weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0635|\u0645/,isPM:function(e){return"\u0645"===e},meridiem:function(e,t,n){return e<12?"\u0635":"\u0645"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u0627 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0641\u064a %s",past:"\u0645\u0646\u0630 %s",s:"\u062b\u0648\u0627\u0646",ss:"%d \u062b\u0627\u0646\u064a\u0629",m:"\u062f\u0642\u064a\u0642\u0629",mm:"%d \u062f\u0642\u0627\u0626\u0642",h:"\u0633\u0627\u0639\u0629",hh:"%d \u0633\u0627\u0639\u0627\u062a",d:"\u064a\u0648\u0645",dd:"%d \u0623\u064a\u0627\u0645",M:"\u0634\u0647\u0631",MM:"%d \u0623\u0634\u0647\u0631",y:"\u0633\u0646\u0629",yy:"%d \u0633\u0646\u0648\u0627\u062a"},preparse:function(e){return e.replace(/[\u0661\u0662\u0663\u0664\u0665\u0666\u0667\u0668\u0669\u0660]/g,(function(e){return n[e]})).replace(/\u060c/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"\u060c")},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ar-tn",{months:"\u062c\u0627\u0646\u0641\u064a_\u0641\u064a\u0641\u0631\u064a_\u0645\u0627\u0631\u0633_\u0623\u0641\u0631\u064a\u0644_\u0645\u0627\u064a_\u062c\u0648\u0627\u0646_\u062c\u0648\u064a\u0644\u064a\u0629_\u0623\u0648\u062a_\u0633\u0628\u062a\u0645\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0641\u0645\u0628\u0631_\u062f\u064a\u0633\u0645\u0628\u0631".split("_"),monthsShort:"\u062c\u0627\u0646\u0641\u064a_\u0641\u064a\u0641\u0631\u064a_\u0645\u0627\u0631\u0633_\u0623\u0641\u0631\u064a\u0644_\u0645\u0627\u064a_\u062c\u0648\u0627\u0646_\u062c\u0648\u064a\u0644\u064a\u0629_\u0623\u0648\u062a_\u0633\u0628\u062a\u0645\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0641\u0645\u0628\u0631_\u062f\u064a\u0633\u0645\u0628\u0631".split("_"),weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u0627 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0641\u064a %s",past:"\u0645\u0646\u0630 %s",s:"\u062b\u0648\u0627\u0646",ss:"%d \u062b\u0627\u0646\u064a\u0629",m:"\u062f\u0642\u064a\u0642\u0629",mm:"%d \u062f\u0642\u0627\u0626\u0642",h:"\u0633\u0627\u0639\u0629",hh:"%d \u0633\u0627\u0639\u0627\u062a",d:"\u064a\u0648\u0645",dd:"%d \u0623\u064a\u0627\u0645",M:"\u0634\u0647\u0631",MM:"%d \u0623\u0634\u0647\u0631",y:"\u0633\u0646\u0629",yy:"%d \u0633\u0646\u0648\u0627\u062a"},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-\xfcnc\xfc",4:"-\xfcnc\xfc",100:"-\xfcnc\xfc",6:"-nc\u0131",9:"-uncu",10:"-uncu",30:"-uncu",60:"-\u0131nc\u0131",90:"-\u0131nc\u0131"};e.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ert\u0259si_\xc7\u0259r\u015f\u0259nb\u0259 ax\u015fam\u0131_\xc7\u0259r\u015f\u0259nb\u0259_C\xfcm\u0259 ax\u015fam\u0131_C\xfcm\u0259_\u015e\u0259nb\u0259".split("_"),weekdaysShort:"Baz_BzE_\xc7Ax_\xc7\u0259r_CAx_C\xfcm_\u015e\u0259n".split("_"),weekdaysMin:"Bz_BE_\xc7A_\xc7\u0259_CA_C\xfc_\u015e\u0259".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bug\xfcn saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[g\u0259l\u0259n h\u0259ft\u0259] dddd [saat] LT",lastDay:"[d\xfcn\u0259n] LT",lastWeek:"[ke\xe7\u0259n h\u0259ft\u0259] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s \u0259vv\u0259l",s:"bir ne\xe7\u0259 saniy\u0259",ss:"%d saniy\u0259",m:"bir d\u0259qiq\u0259",mm:"%d d\u0259qiq\u0259",h:"bir saat",hh:"%d saat",d:"bir g\xfcn",dd:"%d g\xfcn",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiemParse:/gec\u0259|s\u0259h\u0259r|g\xfcnd\xfcz|ax\u015fam/,isPM:function(e){return/^(g\xfcnd\xfcz|ax\u015fam)$/.test(e)},meridiem:function(e,t,n){return e<4?"gec\u0259":e<12?"s\u0259h\u0259r":e<17?"g\xfcnd\xfcz":"ax\u015fam"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0131nc\u0131|inci|nci|\xfcnc\xfc|nc\u0131|uncu)/,ordinal:function(e){if(0===e)return e+"-\u0131nc\u0131";var n=e%10;return e+(t[n]||t[e%100-n]||t[e>=100?100:null])},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n){var r,i;return"m"===n?t?"\u0445\u0432\u0456\u043b\u0456\u043d\u0430":"\u0445\u0432\u0456\u043b\u0456\u043d\u0443":"h"===n?t?"\u0433\u0430\u0434\u0437\u0456\u043d\u0430":"\u0433\u0430\u0434\u0437\u0456\u043d\u0443":e+" "+(r=+e,i={ss:t?"\u0441\u0435\u043a\u0443\u043d\u0434\u0430_\u0441\u0435\u043a\u0443\u043d\u0434\u044b_\u0441\u0435\u043a\u0443\u043d\u0434":"\u0441\u0435\u043a\u0443\u043d\u0434\u0443_\u0441\u0435\u043a\u0443\u043d\u0434\u044b_\u0441\u0435\u043a\u0443\u043d\u0434",mm:t?"\u0445\u0432\u0456\u043b\u0456\u043d\u0430_\u0445\u0432\u0456\u043b\u0456\u043d\u044b_\u0445\u0432\u0456\u043b\u0456\u043d":"\u0445\u0432\u0456\u043b\u0456\u043d\u0443_\u0445\u0432\u0456\u043b\u0456\u043d\u044b_\u0445\u0432\u0456\u043b\u0456\u043d",hh:t?"\u0433\u0430\u0434\u0437\u0456\u043d\u0430_\u0433\u0430\u0434\u0437\u0456\u043d\u044b_\u0433\u0430\u0434\u0437\u0456\u043d":"\u0433\u0430\u0434\u0437\u0456\u043d\u0443_\u0433\u0430\u0434\u0437\u0456\u043d\u044b_\u0433\u0430\u0434\u0437\u0456\u043d",dd:"\u0434\u0437\u0435\u043d\u044c_\u0434\u043d\u0456_\u0434\u0437\u0451\u043d",MM:"\u043c\u0435\u0441\u044f\u0446_\u043c\u0435\u0441\u044f\u0446\u044b_\u043c\u0435\u0441\u044f\u0446\u0430\u045e",yy:"\u0433\u043e\u0434_\u0433\u0430\u0434\u044b_\u0433\u0430\u0434\u043e\u045e"}[n].split("_"),r%10==1&&r%100!=11?i[0]:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?i[1]:i[2])}e.defineLocale("be",{months:{format:"\u0441\u0442\u0443\u0434\u0437\u0435\u043d\u044f_\u043b\u044e\u0442\u0430\u0433\u0430_\u0441\u0430\u043a\u0430\u0432\u0456\u043a\u0430_\u043a\u0440\u0430\u0441\u0430\u0432\u0456\u043a\u0430_\u0442\u0440\u0430\u045e\u043d\u044f_\u0447\u044d\u0440\u0432\u0435\u043d\u044f_\u043b\u0456\u043f\u0435\u043d\u044f_\u0436\u043d\u0456\u045e\u043d\u044f_\u0432\u0435\u0440\u0430\u0441\u043d\u044f_\u043a\u0430\u0441\u0442\u0440\u044b\u0447\u043d\u0456\u043a\u0430_\u043b\u0456\u0441\u0442\u0430\u043f\u0430\u0434\u0430_\u0441\u043d\u0435\u0436\u043d\u044f".split("_"),standalone:"\u0441\u0442\u0443\u0434\u0437\u0435\u043d\u044c_\u043b\u044e\u0442\u044b_\u0441\u0430\u043a\u0430\u0432\u0456\u043a_\u043a\u0440\u0430\u0441\u0430\u0432\u0456\u043a_\u0442\u0440\u0430\u0432\u0435\u043d\u044c_\u0447\u044d\u0440\u0432\u0435\u043d\u044c_\u043b\u0456\u043f\u0435\u043d\u044c_\u0436\u043d\u0456\u0432\u0435\u043d\u044c_\u0432\u0435\u0440\u0430\u0441\u0435\u043d\u044c_\u043a\u0430\u0441\u0442\u0440\u044b\u0447\u043d\u0456\u043a_\u043b\u0456\u0441\u0442\u0430\u043f\u0430\u0434_\u0441\u043d\u0435\u0436\u0430\u043d\u044c".split("_")},monthsShort:"\u0441\u0442\u0443\u0434_\u043b\u044e\u0442_\u0441\u0430\u043a_\u043a\u0440\u0430\u0441_\u0442\u0440\u0430\u0432_\u0447\u044d\u0440\u0432_\u043b\u0456\u043f_\u0436\u043d\u0456\u0432_\u0432\u0435\u0440_\u043a\u0430\u0441\u0442_\u043b\u0456\u0441\u0442_\u0441\u043d\u0435\u0436".split("_"),weekdays:{format:"\u043d\u044f\u0434\u0437\u0435\u043b\u044e_\u043f\u0430\u043d\u044f\u0434\u0437\u0435\u043b\u0430\u043a_\u0430\u045e\u0442\u043e\u0440\u0430\u043a_\u0441\u0435\u0440\u0430\u0434\u0443_\u0447\u0430\u0446\u0432\u0435\u0440_\u043f\u044f\u0442\u043d\u0456\u0446\u0443_\u0441\u0443\u0431\u043e\u0442\u0443".split("_"),standalone:"\u043d\u044f\u0434\u0437\u0435\u043b\u044f_\u043f\u0430\u043d\u044f\u0434\u0437\u0435\u043b\u0430\u043a_\u0430\u045e\u0442\u043e\u0440\u0430\u043a_\u0441\u0435\u0440\u0430\u0434\u0430_\u0447\u0430\u0446\u0432\u0435\u0440_\u043f\u044f\u0442\u043d\u0456\u0446\u0430_\u0441\u0443\u0431\u043e\u0442\u0430".split("_"),isFormat:/\[ ?[\u0423\u0443\u045e] ?(?:\u043c\u0456\u043d\u0443\u043b\u0443\u044e|\u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0443\u044e)? ?\] ?dddd/},weekdaysShort:"\u043d\u0434_\u043f\u043d_\u0430\u0442_\u0441\u0440_\u0447\u0446_\u043f\u0442_\u0441\u0431".split("_"),weekdaysMin:"\u043d\u0434_\u043f\u043d_\u0430\u0442_\u0441\u0440_\u0447\u0446_\u043f\u0442_\u0441\u0431".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY \u0433.",LLL:"D MMMM YYYY \u0433., HH:mm",LLLL:"dddd, D MMMM YYYY \u0433., HH:mm"},calendar:{sameDay:"[\u0421\u0451\u043d\u043d\u044f \u045e] LT",nextDay:"[\u0417\u0430\u045e\u0442\u0440\u0430 \u045e] LT",lastDay:"[\u0423\u0447\u043e\u0440\u0430 \u045e] LT",nextWeek:function(){return"[\u0423] dddd [\u045e] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[\u0423 \u043c\u0456\u043d\u0443\u043b\u0443\u044e] dddd [\u045e] LT";case 1:case 2:case 4:return"[\u0423 \u043c\u0456\u043d\u0443\u043b\u044b] dddd [\u045e] LT"}},sameElse:"L"},relativeTime:{future:"\u043f\u0440\u0430\u0437 %s",past:"%s \u0442\u0430\u043c\u0443",s:"\u043d\u0435\u043a\u0430\u043b\u044c\u043a\u0456 \u0441\u0435\u043a\u0443\u043d\u0434",m:t,mm:t,h:t,hh:t,d:"\u0434\u0437\u0435\u043d\u044c",dd:t,M:"\u043c\u0435\u0441\u044f\u0446",MM:t,y:"\u0433\u043e\u0434",yy:t},meridiemParse:/\u043d\u043e\u0447\u044b|\u0440\u0430\u043d\u0456\u0446\u044b|\u0434\u043d\u044f|\u0432\u0435\u0447\u0430\u0440\u0430/,isPM:function(e){return/^(\u0434\u043d\u044f|\u0432\u0435\u0447\u0430\u0440\u0430)$/.test(e)},meridiem:function(e,t,n){return e<4?"\u043d\u043e\u0447\u044b":e<12?"\u0440\u0430\u043d\u0456\u0446\u044b":e<17?"\u0434\u043d\u044f":"\u0432\u0435\u0447\u0430\u0440\u0430"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0456|\u044b|\u0433\u0430)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e%10!=2&&e%10!=3||e%100==12||e%100==13?e+"-\u044b":e+"-\u0456";case"D":return e+"-\u0433\u0430";default:return e}},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("bg",{months:"\u044f\u043d\u0443\u0430\u0440\u0438_\u0444\u0435\u0432\u0440\u0443\u0430\u0440\u0438_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0438\u043b_\u043c\u0430\u0439_\u044e\u043d\u0438_\u044e\u043b\u0438_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043f\u0442\u0435\u043c\u0432\u0440\u0438_\u043e\u043a\u0442\u043e\u043c\u0432\u0440\u0438_\u043d\u043e\u0435\u043c\u0432\u0440\u0438_\u0434\u0435\u043a\u0435\u043c\u0432\u0440\u0438".split("_"),monthsShort:"\u044f\u043d\u0443_\u0444\u0435\u0432_\u043c\u0430\u0440_\u0430\u043f\u0440_\u043c\u0430\u0439_\u044e\u043d\u0438_\u044e\u043b\u0438_\u0430\u0432\u0433_\u0441\u0435\u043f_\u043e\u043a\u0442_\u043d\u043e\u0435_\u0434\u0435\u043a".split("_"),weekdays:"\u043d\u0435\u0434\u0435\u043b\u044f_\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u043d\u0438\u043a_\u0432\u0442\u043e\u0440\u043d\u0438\u043a_\u0441\u0440\u044f\u0434\u0430_\u0447\u0435\u0442\u0432\u044a\u0440\u0442\u044a\u043a_\u043f\u0435\u0442\u044a\u043a_\u0441\u044a\u0431\u043e\u0442\u0430".split("_"),weekdaysShort:"\u043d\u0435\u0434_\u043f\u043e\u043d_\u0432\u0442\u043e_\u0441\u0440\u044f_\u0447\u0435\u0442_\u043f\u0435\u0442_\u0441\u044a\u0431".split("_"),weekdaysMin:"\u043d\u0434_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[\u0414\u043d\u0435\u0441 \u0432] LT",nextDay:"[\u0423\u0442\u0440\u0435 \u0432] LT",nextWeek:"dddd [\u0432] LT",lastDay:"[\u0412\u0447\u0435\u0440\u0430 \u0432] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[\u041c\u0438\u043d\u0430\u043b\u0430\u0442\u0430] dddd [\u0432] LT";case 1:case 2:case 4:case 5:return"[\u041c\u0438\u043d\u0430\u043b\u0438\u044f] dddd [\u0432] LT"}},sameElse:"L"},relativeTime:{future:"\u0441\u043b\u0435\u0434 %s",past:"\u043f\u0440\u0435\u0434\u0438 %s",s:"\u043d\u044f\u043a\u043e\u043b\u043a\u043e \u0441\u0435\u043a\u0443\u043d\u0434\u0438",ss:"%d \u0441\u0435\u043a\u0443\u043d\u0434\u0438",m:"\u043c\u0438\u043d\u0443\u0442\u0430",mm:"%d \u043c\u0438\u043d\u0443\u0442\u0438",h:"\u0447\u0430\u0441",hh:"%d \u0447\u0430\u0441\u0430",d:"\u0434\u0435\u043d",dd:"%d \u0434\u0435\u043d\u0430",w:"\u0441\u0435\u0434\u043c\u0438\u0446\u0430",ww:"%d \u0441\u0435\u0434\u043c\u0438\u0446\u0438",M:"\u043c\u0435\u0441\u0435\u0446",MM:"%d \u043c\u0435\u0441\u0435\u0446\u0430",y:"\u0433\u043e\u0434\u0438\u043d\u0430",yy:"%d \u0433\u043e\u0434\u0438\u043d\u0438"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0435\u0432|\u0435\u043d|\u0442\u0438|\u0432\u0438|\u0440\u0438|\u043c\u0438)/,ordinal:function(e){var t=e%10,n=e%100;return 0===e?e+"-\u0435\u0432":0===n?e+"-\u0435\u043d":n>10&&n<20?e+"-\u0442\u0438":1===t?e+"-\u0432\u0438":2===t?e+"-\u0440\u0438":7===t||8===t?e+"-\u043c\u0438":e+"-\u0442\u0438"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("bm",{months:"Zanwuyekalo_Fewuruyekalo_Marisikalo_Awirilikalo_M\u025bkalo_Zuw\u025bnkalo_Zuluyekalo_Utikalo_S\u025btanburukalo_\u0254kut\u0254burukalo_Nowanburukalo_Desanburukalo".split("_"),monthsShort:"Zan_Few_Mar_Awi_M\u025b_Zuw_Zul_Uti_S\u025bt_\u0254ku_Now_Des".split("_"),weekdays:"Kari_Nt\u025bn\u025bn_Tarata_Araba_Alamisa_Juma_Sibiri".split("_"),weekdaysShort:"Kar_Nt\u025b_Tar_Ara_Ala_Jum_Sib".split("_"),weekdaysMin:"Ka_Nt_Ta_Ar_Al_Ju_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"MMMM [tile] D [san] YYYY",LLL:"MMMM [tile] D [san] YYYY [l\u025br\u025b] HH:mm",LLLL:"dddd MMMM [tile] D [san] YYYY [l\u025br\u025b] HH:mm"},calendar:{sameDay:"[Bi l\u025br\u025b] LT",nextDay:"[Sini l\u025br\u025b] LT",nextWeek:"dddd [don l\u025br\u025b] LT",lastDay:"[Kunu l\u025br\u025b] LT",lastWeek:"dddd [t\u025bm\u025bnen l\u025br\u025b] LT",sameElse:"L"},relativeTime:{future:"%s k\u0254n\u0254",past:"a b\u025b %s b\u0254",s:"sanga dama dama",ss:"sekondi %d",m:"miniti kelen",mm:"miniti %d",h:"l\u025br\u025b kelen",hh:"l\u025br\u025b %d",d:"tile kelen",dd:"tile %d",M:"kalo kelen",MM:"kalo %d",y:"san kelen",yy:"san %d"},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u09e7",2:"\u09e8",3:"\u09e9",4:"\u09ea",5:"\u09eb",6:"\u09ec",7:"\u09ed",8:"\u09ee",9:"\u09ef",0:"\u09e6"},n={"\u09e7":"1","\u09e8":"2","\u09e9":"3","\u09ea":"4","\u09eb":"5","\u09ec":"6","\u09ed":"7","\u09ee":"8","\u09ef":"9","\u09e6":"0"};e.defineLocale("bn",{months:"\u099c\u09be\u09a8\u09c1\u09df\u09be\u09b0\u09bf_\u09ab\u09c7\u09ac\u09cd\u09b0\u09c1\u09df\u09be\u09b0\u09bf_\u09ae\u09be\u09b0\u09cd\u099a_\u098f\u09aa\u09cd\u09b0\u09bf\u09b2_\u09ae\u09c7_\u099c\u09c1\u09a8_\u099c\u09c1\u09b2\u09be\u0987_\u0986\u0997\u09b8\u09cd\u099f_\u09b8\u09c7\u09aa\u09cd\u099f\u09c7\u09ae\u09cd\u09ac\u09b0_\u0985\u0995\u09cd\u099f\u09cb\u09ac\u09b0_\u09a8\u09ad\u09c7\u09ae\u09cd\u09ac\u09b0_\u09a1\u09bf\u09b8\u09c7\u09ae\u09cd\u09ac\u09b0".split("_"),monthsShort:"\u099c\u09be\u09a8\u09c1_\u09ab\u09c7\u09ac\u09cd\u09b0\u09c1_\u09ae\u09be\u09b0\u09cd\u099a_\u098f\u09aa\u09cd\u09b0\u09bf\u09b2_\u09ae\u09c7_\u099c\u09c1\u09a8_\u099c\u09c1\u09b2\u09be\u0987_\u0986\u0997\u09b8\u09cd\u099f_\u09b8\u09c7\u09aa\u09cd\u099f_\u0985\u0995\u09cd\u099f\u09cb_\u09a8\u09ad\u09c7_\u09a1\u09bf\u09b8\u09c7".split("_"),weekdays:"\u09b0\u09ac\u09bf\u09ac\u09be\u09b0_\u09b8\u09cb\u09ae\u09ac\u09be\u09b0_\u09ae\u0999\u09cd\u0997\u09b2\u09ac\u09be\u09b0_\u09ac\u09c1\u09a7\u09ac\u09be\u09b0_\u09ac\u09c3\u09b9\u09b8\u09cd\u09aa\u09a4\u09bf\u09ac\u09be\u09b0_\u09b6\u09c1\u0995\u09cd\u09b0\u09ac\u09be\u09b0_\u09b6\u09a8\u09bf\u09ac\u09be\u09b0".split("_"),weekdaysShort:"\u09b0\u09ac\u09bf_\u09b8\u09cb\u09ae_\u09ae\u0999\u09cd\u0997\u09b2_\u09ac\u09c1\u09a7_\u09ac\u09c3\u09b9\u09b8\u09cd\u09aa\u09a4\u09bf_\u09b6\u09c1\u0995\u09cd\u09b0_\u09b6\u09a8\u09bf".split("_"),weekdaysMin:"\u09b0\u09ac\u09bf_\u09b8\u09cb\u09ae_\u09ae\u0999\u09cd\u0997\u09b2_\u09ac\u09c1\u09a7_\u09ac\u09c3\u09b9_\u09b6\u09c1\u0995\u09cd\u09b0_\u09b6\u09a8\u09bf".split("_"),longDateFormat:{LT:"A h:mm \u09b8\u09ae\u09df",LTS:"A h:mm:ss \u09b8\u09ae\u09df",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u09b8\u09ae\u09df",LLLL:"dddd, D MMMM YYYY, A h:mm \u09b8\u09ae\u09df"},calendar:{sameDay:"[\u0986\u099c] LT",nextDay:"[\u0986\u0997\u09be\u09ae\u09c0\u0995\u09be\u09b2] LT",nextWeek:"dddd, LT",lastDay:"[\u0997\u09a4\u0995\u09be\u09b2] LT",lastWeek:"[\u0997\u09a4] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u09aa\u09b0\u09c7",past:"%s \u0986\u0997\u09c7",s:"\u0995\u09df\u09c7\u0995 \u09b8\u09c7\u0995\u09c7\u09a8\u09cd\u09a1",ss:"%d \u09b8\u09c7\u0995\u09c7\u09a8\u09cd\u09a1",m:"\u098f\u0995 \u09ae\u09bf\u09a8\u09bf\u099f",mm:"%d \u09ae\u09bf\u09a8\u09bf\u099f",h:"\u098f\u0995 \u0998\u09a8\u09cd\u099f\u09be",hh:"%d \u0998\u09a8\u09cd\u099f\u09be",d:"\u098f\u0995 \u09a6\u09bf\u09a8",dd:"%d \u09a6\u09bf\u09a8",M:"\u098f\u0995 \u09ae\u09be\u09b8",MM:"%d \u09ae\u09be\u09b8",y:"\u098f\u0995 \u09ac\u099b\u09b0",yy:"%d \u09ac\u099b\u09b0"},preparse:function(e){return e.replace(/[\u09e7\u09e8\u09e9\u09ea\u09eb\u09ec\u09ed\u09ee\u09ef\u09e6]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u09b0\u09be\u09a4|\u09b8\u0995\u09be\u09b2|\u09a6\u09c1\u09aa\u09c1\u09b0|\u09ac\u09bf\u0995\u09be\u09b2|\u09b0\u09be\u09a4/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u09b0\u09be\u09a4"===t&&e>=4||"\u09a6\u09c1\u09aa\u09c1\u09b0"===t&&e<5||"\u09ac\u09bf\u0995\u09be\u09b2"===t?e+12:e},meridiem:function(e,t,n){return e<4?"\u09b0\u09be\u09a4":e<10?"\u09b8\u0995\u09be\u09b2":e<17?"\u09a6\u09c1\u09aa\u09c1\u09b0":e<20?"\u09ac\u09bf\u0995\u09be\u09b2":"\u09b0\u09be\u09a4"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u09e7",2:"\u09e8",3:"\u09e9",4:"\u09ea",5:"\u09eb",6:"\u09ec",7:"\u09ed",8:"\u09ee",9:"\u09ef",0:"\u09e6"},n={"\u09e7":"1","\u09e8":"2","\u09e9":"3","\u09ea":"4","\u09eb":"5","\u09ec":"6","\u09ed":"7","\u09ee":"8","\u09ef":"9","\u09e6":"0"};e.defineLocale("bn-bd",{months:"\u099c\u09be\u09a8\u09c1\u09df\u09be\u09b0\u09bf_\u09ab\u09c7\u09ac\u09cd\u09b0\u09c1\u09df\u09be\u09b0\u09bf_\u09ae\u09be\u09b0\u09cd\u099a_\u098f\u09aa\u09cd\u09b0\u09bf\u09b2_\u09ae\u09c7_\u099c\u09c1\u09a8_\u099c\u09c1\u09b2\u09be\u0987_\u0986\u0997\u09b8\u09cd\u099f_\u09b8\u09c7\u09aa\u09cd\u099f\u09c7\u09ae\u09cd\u09ac\u09b0_\u0985\u0995\u09cd\u099f\u09cb\u09ac\u09b0_\u09a8\u09ad\u09c7\u09ae\u09cd\u09ac\u09b0_\u09a1\u09bf\u09b8\u09c7\u09ae\u09cd\u09ac\u09b0".split("_"),monthsShort:"\u099c\u09be\u09a8\u09c1_\u09ab\u09c7\u09ac\u09cd\u09b0\u09c1_\u09ae\u09be\u09b0\u09cd\u099a_\u098f\u09aa\u09cd\u09b0\u09bf\u09b2_\u09ae\u09c7_\u099c\u09c1\u09a8_\u099c\u09c1\u09b2\u09be\u0987_\u0986\u0997\u09b8\u09cd\u099f_\u09b8\u09c7\u09aa\u09cd\u099f_\u0985\u0995\u09cd\u099f\u09cb_\u09a8\u09ad\u09c7_\u09a1\u09bf\u09b8\u09c7".split("_"),weekdays:"\u09b0\u09ac\u09bf\u09ac\u09be\u09b0_\u09b8\u09cb\u09ae\u09ac\u09be\u09b0_\u09ae\u0999\u09cd\u0997\u09b2\u09ac\u09be\u09b0_\u09ac\u09c1\u09a7\u09ac\u09be\u09b0_\u09ac\u09c3\u09b9\u09b8\u09cd\u09aa\u09a4\u09bf\u09ac\u09be\u09b0_\u09b6\u09c1\u0995\u09cd\u09b0\u09ac\u09be\u09b0_\u09b6\u09a8\u09bf\u09ac\u09be\u09b0".split("_"),weekdaysShort:"\u09b0\u09ac\u09bf_\u09b8\u09cb\u09ae_\u09ae\u0999\u09cd\u0997\u09b2_\u09ac\u09c1\u09a7_\u09ac\u09c3\u09b9\u09b8\u09cd\u09aa\u09a4\u09bf_\u09b6\u09c1\u0995\u09cd\u09b0_\u09b6\u09a8\u09bf".split("_"),weekdaysMin:"\u09b0\u09ac\u09bf_\u09b8\u09cb\u09ae_\u09ae\u0999\u09cd\u0997\u09b2_\u09ac\u09c1\u09a7_\u09ac\u09c3\u09b9_\u09b6\u09c1\u0995\u09cd\u09b0_\u09b6\u09a8\u09bf".split("_"),longDateFormat:{LT:"A h:mm \u09b8\u09ae\u09df",LTS:"A h:mm:ss \u09b8\u09ae\u09df",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u09b8\u09ae\u09df",LLLL:"dddd, D MMMM YYYY, A h:mm \u09b8\u09ae\u09df"},calendar:{sameDay:"[\u0986\u099c] LT",nextDay:"[\u0986\u0997\u09be\u09ae\u09c0\u0995\u09be\u09b2] LT",nextWeek:"dddd, LT",lastDay:"[\u0997\u09a4\u0995\u09be\u09b2] LT",lastWeek:"[\u0997\u09a4] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u09aa\u09b0\u09c7",past:"%s \u0986\u0997\u09c7",s:"\u0995\u09df\u09c7\u0995 \u09b8\u09c7\u0995\u09c7\u09a8\u09cd\u09a1",ss:"%d \u09b8\u09c7\u0995\u09c7\u09a8\u09cd\u09a1",m:"\u098f\u0995 \u09ae\u09bf\u09a8\u09bf\u099f",mm:"%d \u09ae\u09bf\u09a8\u09bf\u099f",h:"\u098f\u0995 \u0998\u09a8\u09cd\u099f\u09be",hh:"%d \u0998\u09a8\u09cd\u099f\u09be",d:"\u098f\u0995 \u09a6\u09bf\u09a8",dd:"%d \u09a6\u09bf\u09a8",M:"\u098f\u0995 \u09ae\u09be\u09b8",MM:"%d \u09ae\u09be\u09b8",y:"\u098f\u0995 \u09ac\u099b\u09b0",yy:"%d \u09ac\u099b\u09b0"},preparse:function(e){return e.replace(/[\u09e7\u09e8\u09e9\u09ea\u09eb\u09ec\u09ed\u09ee\u09ef\u09e6]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u09b0\u09be\u09a4|\u09ad\u09cb\u09b0|\u09b8\u0995\u09be\u09b2|\u09a6\u09c1\u09aa\u09c1\u09b0|\u09ac\u09bf\u0995\u09be\u09b2|\u09b8\u09a8\u09cd\u09a7\u09cd\u09af\u09be|\u09b0\u09be\u09a4/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u09b0\u09be\u09a4"===t?e<4?e:e+12:"\u09ad\u09cb\u09b0"===t||"\u09b8\u0995\u09be\u09b2"===t?e:"\u09a6\u09c1\u09aa\u09c1\u09b0"===t?e>=3?e:e+12:"\u09ac\u09bf\u0995\u09be\u09b2"===t||"\u09b8\u09a8\u09cd\u09a7\u09cd\u09af\u09be"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"\u09b0\u09be\u09a4":e<6?"\u09ad\u09cb\u09b0":e<12?"\u09b8\u0995\u09be\u09b2":e<15?"\u09a6\u09c1\u09aa\u09c1\u09b0":e<18?"\u09ac\u09bf\u0995\u09be\u09b2":e<20?"\u09b8\u09a8\u09cd\u09a7\u09cd\u09af\u09be":"\u09b0\u09be\u09a4"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0f21",2:"\u0f22",3:"\u0f23",4:"\u0f24",5:"\u0f25",6:"\u0f26",7:"\u0f27",8:"\u0f28",9:"\u0f29",0:"\u0f20"},n={"\u0f21":"1","\u0f22":"2","\u0f23":"3","\u0f24":"4","\u0f25":"5","\u0f26":"6","\u0f27":"7","\u0f28":"8","\u0f29":"9","\u0f20":"0"};e.defineLocale("bo",{months:"\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f51\u0f44\u0f0b\u0f54\u0f7c_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f42\u0f49\u0f72\u0f66\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f42\u0f66\u0f74\u0f58\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f5e\u0f72\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f63\u0f94\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f51\u0fb2\u0f74\u0f42\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f62\u0f92\u0fb1\u0f51\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f51\u0f42\u0f74\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f45\u0f74\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f45\u0f74\u0f0b\u0f42\u0f45\u0f72\u0f42\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f45\u0f74\u0f0b\u0f42\u0f49\u0f72\u0f66\u0f0b\u0f54".split("_"),monthsShort:"\u0f5f\u0fb3\u0f0b1_\u0f5f\u0fb3\u0f0b2_\u0f5f\u0fb3\u0f0b3_\u0f5f\u0fb3\u0f0b4_\u0f5f\u0fb3\u0f0b5_\u0f5f\u0fb3\u0f0b6_\u0f5f\u0fb3\u0f0b7_\u0f5f\u0fb3\u0f0b8_\u0f5f\u0fb3\u0f0b9_\u0f5f\u0fb3\u0f0b10_\u0f5f\u0fb3\u0f0b11_\u0f5f\u0fb3\u0f0b12".split("_"),monthsShortRegex:/^(\u0f5f\u0fb3\u0f0b\d{1,2})/,monthsParseExact:!0,weekdays:"\u0f42\u0f5f\u0f60\u0f0b\u0f49\u0f72\u0f0b\u0f58\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f5f\u0fb3\u0f0b\u0f56\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f58\u0f72\u0f42\u0f0b\u0f51\u0f58\u0f62\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f63\u0fb7\u0f42\u0f0b\u0f54\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f55\u0f74\u0f62\u0f0b\u0f56\u0f74_\u0f42\u0f5f\u0f60\u0f0b\u0f54\u0f0b\u0f66\u0f44\u0f66\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f66\u0fa4\u0f7a\u0f53\u0f0b\u0f54\u0f0b".split("_"),weekdaysShort:"\u0f49\u0f72\u0f0b\u0f58\u0f0b_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b_\u0f58\u0f72\u0f42\u0f0b\u0f51\u0f58\u0f62\u0f0b_\u0f63\u0fb7\u0f42\u0f0b\u0f54\u0f0b_\u0f55\u0f74\u0f62\u0f0b\u0f56\u0f74_\u0f54\u0f0b\u0f66\u0f44\u0f66\u0f0b_\u0f66\u0fa4\u0f7a\u0f53\u0f0b\u0f54\u0f0b".split("_"),weekdaysMin:"\u0f49\u0f72_\u0f5f\u0fb3_\u0f58\u0f72\u0f42_\u0f63\u0fb7\u0f42_\u0f55\u0f74\u0f62_\u0f66\u0f44\u0f66_\u0f66\u0fa4\u0f7a\u0f53".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[\u0f51\u0f72\u0f0b\u0f62\u0f72\u0f44] LT",nextDay:"[\u0f66\u0f44\u0f0b\u0f49\u0f72\u0f53] LT",nextWeek:"[\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f55\u0fb2\u0f42\u0f0b\u0f62\u0f97\u0f7a\u0f66\u0f0b\u0f58], LT",lastDay:"[\u0f41\u0f0b\u0f66\u0f44] LT",lastWeek:"[\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f55\u0fb2\u0f42\u0f0b\u0f58\u0f50\u0f60\u0f0b\u0f58] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0f63\u0f0b",past:"%s \u0f66\u0f94\u0f53\u0f0b\u0f63",s:"\u0f63\u0f58\u0f0b\u0f66\u0f44",ss:"%d \u0f66\u0f90\u0f62\u0f0b\u0f46\u0f0d",m:"\u0f66\u0f90\u0f62\u0f0b\u0f58\u0f0b\u0f42\u0f45\u0f72\u0f42",mm:"%d \u0f66\u0f90\u0f62\u0f0b\u0f58",h:"\u0f46\u0f74\u0f0b\u0f5a\u0f7c\u0f51\u0f0b\u0f42\u0f45\u0f72\u0f42",hh:"%d \u0f46\u0f74\u0f0b\u0f5a\u0f7c\u0f51",d:"\u0f49\u0f72\u0f53\u0f0b\u0f42\u0f45\u0f72\u0f42",dd:"%d \u0f49\u0f72\u0f53\u0f0b",M:"\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f42\u0f45\u0f72\u0f42",MM:"%d \u0f5f\u0fb3\u0f0b\u0f56",y:"\u0f63\u0f7c\u0f0b\u0f42\u0f45\u0f72\u0f42",yy:"%d \u0f63\u0f7c"},preparse:function(e){return e.replace(/[\u0f21\u0f22\u0f23\u0f24\u0f25\u0f26\u0f27\u0f28\u0f29\u0f20]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c|\u0f5e\u0f7c\u0f42\u0f66\u0f0b\u0f40\u0f66|\u0f49\u0f72\u0f53\u0f0b\u0f42\u0f74\u0f44|\u0f51\u0f42\u0f7c\u0f44\u0f0b\u0f51\u0f42|\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c"===t&&e>=4||"\u0f49\u0f72\u0f53\u0f0b\u0f42\u0f74\u0f44"===t&&e<5||"\u0f51\u0f42\u0f7c\u0f44\u0f0b\u0f51\u0f42"===t?e+12:e},meridiem:function(e,t,n){return e<4?"\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c":e<10?"\u0f5e\u0f7c\u0f42\u0f66\u0f0b\u0f40\u0f66":e<17?"\u0f49\u0f72\u0f53\u0f0b\u0f42\u0f74\u0f44":e<20?"\u0f51\u0f42\u0f7c\u0f44\u0f0b\u0f51\u0f42":"\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n){return e+" "+function(e,t){return 2===t?function(e){var t={m:"v",b:"v",d:"z"};return void 0===t[e.charAt(0)]?e:t[e.charAt(0)]+e.substring(1)}(e):e}({mm:"munutenn",MM:"miz",dd:"devezh"}[n],e)}var n=[/^gen/i,/^c[\u02bc\']hwe/i,/^meu/i,/^ebr/i,/^mae/i,/^(mez|eve)/i,/^gou/i,/^eos/i,/^gwe/i,/^her/i,/^du/i,/^ker/i],r=/^(genver|c[\u02bc\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu|gen|c[\u02bc\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,i=[/^Su/i,/^Lu/i,/^Me([^r]|$)/i,/^Mer/i,/^Ya/i,/^Gw/i,/^Sa/i];e.defineLocale("br",{months:"Genver_C\u02bchwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C\u02bchwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc\u02bcher_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),weekdaysParse:i,fullWeekdaysParse:[/^sul/i,/^lun/i,/^meurzh/i,/^merc[\u02bc\']her/i,/^yaou/i,/^gwener/i,/^sadorn/i],shortWeekdaysParse:[/^Sul/i,/^Lun/i,/^Meu/i,/^Mer/i,/^Yao/i,/^Gwe/i,/^Sad/i],minWeekdaysParse:i,monthsRegex:r,monthsShortRegex:r,monthsStrictRegex:/^(genver|c[\u02bc\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu)/i,monthsShortStrictRegex:/^(gen|c[\u02bc\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,monthsParse:n,longMonthsParse:n,shortMonthsParse:n,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY HH:mm",LLLL:"dddd, D [a viz] MMMM YYYY HH:mm"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc\u02bchoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec\u02bch da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s \u02bczo",s:"un nebeud segondenno\xf9",ss:"%d eilenn",m:"ur vunutenn",mm:t,h:"un eur",hh:"%d eur",d:"un devezh",dd:t,M:"ur miz",MM:t,y:"ur bloaz",yy:function(e){switch(function e(t){return t>9?e(t%10):t}(e)){case 1:case 3:case 4:case 5:case 9:return e+" bloaz";default:return e+" vloaz"}}},dayOfMonthOrdinalParse:/\d{1,2}(a\xf1|vet)/,ordinal:function(e){return e+(1===e?"a\xf1":"vet")},week:{dow:1,doy:4},meridiemParse:/a.m.|g.m./,isPM:function(e){return"g.m."===e},meridiem:function(e,t,n){return e<12?"a.m.":"g.m."}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n){var r=e+" ";switch(n){case"ss":return r+(1===e?"sekunda":2===e||3===e||4===e?"sekunde":"sekundi");case"m":return t?"jedna minuta":"jedne minute";case"mm":return r+(1===e?"minuta":2===e||3===e||4===e?"minute":"minuta");case"h":return t?"jedan sat":"jednog sata";case"hh":return r+(1===e?"sat":2===e||3===e||4===e?"sata":"sati");case"dd":return r+(1===e?"dan":"dana");case"MM":return r+(1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci");case"yy":return r+(1===e?"godina":2===e||3===e||4===e?"godine":"godina")}}e.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_august_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_\u010detvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._\u010det._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_\u010de_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[ju\u010der u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[pro\u0161lu] dddd [u] LT";case 6:return"[pro\u0161le] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[pro\u0161li] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:t,m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ca",{months:{standalone:"gener_febrer_mar\xe7_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),format:"de gener_de febrer_de mar\xe7_d'abril_de maig_de juny_de juliol_d'agost_de setembre_d'octubre_de novembre_de desembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar\xe7_abr._maig_juny_jul._ag._set._oct._nov._des.".split("_"),monthsParseExact:!0,weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dt_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a les] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a les] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem\xe0 a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"d'aqu\xed %s",past:"fa %s",s:"uns segons",ss:"%d segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t|\xe8|a)/,ordinal:function(e,t){var n=1===e?"r":2===e?"n":3===e?"r":4===e?"t":"\xe8";return"w"!==t&&"W"!==t||(n="a"),e+n},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t="leden_\xfanor_b\u0159ezen_duben_kv\u011bten_\u010derven_\u010dervenec_srpen_z\xe1\u0159\xed_\u0159\xedjen_listopad_prosinec".split("_"),n="led_\xfano_b\u0159e_dub_kv\u011b_\u010dvn_\u010dvc_srp_z\xe1\u0159_\u0159\xedj_lis_pro".split("_"),r=[/^led/i,/^\xfano/i,/^b\u0159e/i,/^dub/i,/^kv\u011b/i,/^(\u010dvn|\u010derven$|\u010dervna)/i,/^(\u010dvc|\u010dervenec|\u010dervence)/i,/^srp/i,/^z\xe1\u0159/i,/^\u0159\xedj/i,/^lis/i,/^pro/i],i=/^(leden|\xfanor|b\u0159ezen|duben|kv\u011bten|\u010dervenec|\u010dervence|\u010derven|\u010dervna|srpen|z\xe1\u0159\xed|\u0159\xedjen|listopad|prosinec|led|\xfano|b\u0159e|dub|kv\u011b|\u010dvn|\u010dvc|srp|z\xe1\u0159|\u0159\xedj|lis|pro)/i;function a(e){return e>1&&e<5&&1!=~~(e/10)}function o(e,t,n,r){var i=e+" ";switch(n){case"s":return t||r?"p\xe1r sekund":"p\xe1r sekundami";case"ss":return t||r?i+(a(e)?"sekundy":"sekund"):i+"sekundami";case"m":return t?"minuta":r?"minutu":"minutou";case"mm":return t||r?i+(a(e)?"minuty":"minut"):i+"minutami";case"h":return t?"hodina":r?"hodinu":"hodinou";case"hh":return t||r?i+(a(e)?"hodiny":"hodin"):i+"hodinami";case"d":return t||r?"den":"dnem";case"dd":return t||r?i+(a(e)?"dny":"dn\xed"):i+"dny";case"M":return t||r?"m\u011bs\xedc":"m\u011bs\xedcem";case"MM":return t||r?i+(a(e)?"m\u011bs\xedce":"m\u011bs\xedc\u016f"):i+"m\u011bs\xedci";case"y":return t||r?"rok":"rokem";case"yy":return t||r?i+(a(e)?"roky":"let"):i+"lety"}}e.defineLocale("cs",{months:t,monthsShort:n,monthsRegex:i,monthsShortRegex:i,monthsStrictRegex:/^(leden|ledna|\xfanora|\xfanor|b\u0159ezen|b\u0159ezna|duben|dubna|kv\u011bten|kv\u011btna|\u010dervenec|\u010dervence|\u010derven|\u010dervna|srpen|srpna|z\xe1\u0159\xed|\u0159\xedjen|\u0159\xedjna|listopadu|listopad|prosinec|prosince)/i,monthsShortStrictRegex:/^(led|\xfano|b\u0159e|dub|kv\u011b|\u010dvn|\u010dvc|srp|z\xe1\u0159|\u0159\xedj|lis|pro)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"ned\u011ble_pond\u011bl\xed_\xfater\xfd_st\u0159eda_\u010dtvrtek_p\xe1tek_sobota".split("_"),weekdaysShort:"ne_po_\xfat_st_\u010dt_p\xe1_so".split("_"),weekdaysMin:"ne_po_\xfat_st_\u010dt_p\xe1_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm",l:"D. M. YYYY"},calendar:{sameDay:"[dnes v] LT",nextDay:"[z\xedtra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v ned\u011bli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve st\u0159edu v] LT";case 4:return"[ve \u010dtvrtek v] LT";case 5:return"[v p\xe1tek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[v\u010dera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou ned\u011bli v] LT";case 1:case 2:return"[minul\xe9] dddd [v] LT";case 3:return"[minulou st\u0159edu v] LT";case 4:case 5:return"[minul\xfd] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"p\u0159ed %s",s:o,ss:o,m:o,mm:o,h:o,hh:o,d:o,dd:o,M:o,MM:o,y:o,yy:o},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("cv",{months:"\u043a\u04d1\u0440\u043b\u0430\u0447_\u043d\u0430\u0440\u04d1\u0441_\u043f\u0443\u0448_\u0430\u043a\u0430_\u043c\u0430\u0439_\u04ab\u04d7\u0440\u0442\u043c\u0435_\u0443\u0442\u04d1_\u04ab\u0443\u0440\u043b\u0430_\u0430\u0432\u04d1\u043d_\u044e\u043f\u0430_\u0447\u04f3\u043a_\u0440\u0430\u0448\u0442\u0430\u0432".split("_"),monthsShort:"\u043a\u04d1\u0440_\u043d\u0430\u0440_\u043f\u0443\u0448_\u0430\u043a\u0430_\u043c\u0430\u0439_\u04ab\u04d7\u0440_\u0443\u0442\u04d1_\u04ab\u0443\u0440_\u0430\u0432\u043d_\u044e\u043f\u0430_\u0447\u04f3\u043a_\u0440\u0430\u0448".split("_"),weekdays:"\u0432\u044b\u0440\u0441\u0430\u0440\u043d\u0438\u043a\u0443\u043d_\u0442\u0443\u043d\u0442\u0438\u043a\u0443\u043d_\u044b\u0442\u043b\u0430\u0440\u0438\u043a\u0443\u043d_\u044e\u043d\u043a\u0443\u043d_\u043a\u04d7\u04ab\u043d\u0435\u0440\u043d\u0438\u043a\u0443\u043d_\u044d\u0440\u043d\u0435\u043a\u0443\u043d_\u0448\u04d1\u043c\u0430\u0442\u043a\u0443\u043d".split("_"),weekdaysShort:"\u0432\u044b\u0440_\u0442\u0443\u043d_\u044b\u0442\u043b_\u044e\u043d_\u043a\u04d7\u04ab_\u044d\u0440\u043d_\u0448\u04d1\u043c".split("_"),weekdaysMin:"\u0432\u0440_\u0442\u043d_\u044b\u0442_\u044e\u043d_\u043a\u04ab_\u044d\u0440_\u0448\u043c".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"YYYY [\u04ab\u0443\u043b\u0445\u0438] MMMM [\u0443\u0439\u04d1\u0445\u04d7\u043d] D[-\u043c\u04d7\u0448\u04d7]",LLL:"YYYY [\u04ab\u0443\u043b\u0445\u0438] MMMM [\u0443\u0439\u04d1\u0445\u04d7\u043d] D[-\u043c\u04d7\u0448\u04d7], HH:mm",LLLL:"dddd, YYYY [\u04ab\u0443\u043b\u0445\u0438] MMMM [\u0443\u0439\u04d1\u0445\u04d7\u043d] D[-\u043c\u04d7\u0448\u04d7], HH:mm"},calendar:{sameDay:"[\u041f\u0430\u044f\u043d] LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",nextDay:"[\u042b\u0440\u0430\u043d] LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",lastDay:"[\u04d6\u043d\u0435\u0440] LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",nextWeek:"[\u04aa\u0438\u0442\u0435\u0441] dddd LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",lastWeek:"[\u0418\u0440\u0442\u043d\u04d7] dddd LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",sameElse:"L"},relativeTime:{future:function(e){return e+(/\u0441\u0435\u0445\u0435\u0442$/i.exec(e)?"\u0440\u0435\u043d":/\u04ab\u0443\u043b$/i.exec(e)?"\u0442\u0430\u043d":"\u0440\u0430\u043d")},past:"%s \u043a\u0430\u044f\u043b\u043b\u0430",s:"\u043f\u04d7\u0440-\u0438\u043a \u04ab\u0435\u043a\u043a\u0443\u043d\u0442",ss:"%d \u04ab\u0435\u043a\u043a\u0443\u043d\u0442",m:"\u043f\u04d7\u0440 \u043c\u0438\u043d\u0443\u0442",mm:"%d \u043c\u0438\u043d\u0443\u0442",h:"\u043f\u04d7\u0440 \u0441\u0435\u0445\u0435\u0442",hh:"%d \u0441\u0435\u0445\u0435\u0442",d:"\u043f\u04d7\u0440 \u043a\u0443\u043d",dd:"%d \u043a\u0443\u043d",M:"\u043f\u04d7\u0440 \u0443\u0439\u04d1\u0445",MM:"%d \u0443\u0439\u04d1\u0445",y:"\u043f\u04d7\u0440 \u04ab\u0443\u043b",yy:"%d \u04ab\u0443\u043b"},dayOfMonthOrdinalParse:/\d{1,2}-\u043c\u04d7\u0448/,ordinal:"%d-\u043c\u04d7\u0448",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn \xf4l",s:"ychydig eiliadau",ss:"%d eiliad",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},dayOfMonthOrdinalParse:/\d{1,2}(fed|ain|af|il|ydd|ed|eg)/,ordinal:function(e){var t="";return e>20?t=40===e||50===e||60===e||80===e||100===e?"fed":"ain":e>0&&(t=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"][e]),e+t},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"s\xf8ndag_mandag_tirsdag_onsdag_torsdag_fredag_l\xf8rdag".split("_"),weekdaysShort:"s\xf8n_man_tir_ons_tor_fre_l\xf8r".split("_"),weekdaysMin:"s\xf8_ma_ti_on_to_fr_l\xf8".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd [d.] D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"p\xe5 dddd [kl.] LT",lastDay:"[i g\xe5r kl.] LT",lastWeek:"[i] dddd[s kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f\xe5 sekunder",ss:"%d sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en m\xe5ned",MM:"%d m\xe5neder",y:"et \xe5r",yy:"%d \xe5r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?i[n][0]:i[n][1]}e.defineLocale("de",{months:"Januar_Februar_M\xe4rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._M\xe4rz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?i[n][0]:i[n][1]}e.defineLocale("de-at",{months:"J\xe4nner_Februar_M\xe4rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"J\xe4n._Feb._M\xe4rz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?i[n][0]:i[n][1]}e.defineLocale("de-ch",{months:"Januar_Februar_M\xe4rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._M\xe4rz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t=["\u0796\u07ac\u0782\u07aa\u0787\u07a6\u0783\u07a9","\u078a\u07ac\u0784\u07b0\u0783\u07aa\u0787\u07a6\u0783\u07a9","\u0789\u07a7\u0783\u07a8\u0797\u07aa","\u0787\u07ad\u0795\u07b0\u0783\u07a9\u078d\u07aa","\u0789\u07ad","\u0796\u07ab\u0782\u07b0","\u0796\u07aa\u078d\u07a6\u0787\u07a8","\u0787\u07af\u078e\u07a6\u0790\u07b0\u0793\u07aa","\u0790\u07ac\u0795\u07b0\u0793\u07ac\u0789\u07b0\u0784\u07a6\u0783\u07aa","\u0787\u07ae\u0786\u07b0\u0793\u07af\u0784\u07a6\u0783\u07aa","\u0782\u07ae\u0788\u07ac\u0789\u07b0\u0784\u07a6\u0783\u07aa","\u0791\u07a8\u0790\u07ac\u0789\u07b0\u0784\u07a6\u0783\u07aa"],n=["\u0787\u07a7\u078b\u07a8\u0787\u07b0\u078c\u07a6","\u0780\u07af\u0789\u07a6","\u0787\u07a6\u0782\u07b0\u078e\u07a7\u0783\u07a6","\u0784\u07aa\u078b\u07a6","\u0784\u07aa\u0783\u07a7\u0790\u07b0\u078a\u07a6\u078c\u07a8","\u0780\u07aa\u0786\u07aa\u0783\u07aa","\u0780\u07ae\u0782\u07a8\u0780\u07a8\u0783\u07aa"];e.defineLocale("dv",{months:t,monthsShort:t,weekdays:n,weekdaysShort:n,weekdaysMin:"\u0787\u07a7\u078b\u07a8_\u0780\u07af\u0789\u07a6_\u0787\u07a6\u0782\u07b0_\u0784\u07aa\u078b\u07a6_\u0784\u07aa\u0783\u07a7_\u0780\u07aa\u0786\u07aa_\u0780\u07ae\u0782\u07a8".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0789\u0786|\u0789\u078a/,isPM:function(e){return"\u0789\u078a"===e},meridiem:function(e,t,n){return e<12?"\u0789\u0786":"\u0789\u078a"},calendar:{sameDay:"[\u0789\u07a8\u0787\u07a6\u078b\u07aa] LT",nextDay:"[\u0789\u07a7\u078b\u07a6\u0789\u07a7] LT",nextWeek:"dddd LT",lastDay:"[\u0787\u07a8\u0787\u07b0\u0794\u07ac] LT",lastWeek:"[\u078a\u07a7\u0787\u07a8\u078c\u07aa\u0788\u07a8] dddd LT",sameElse:"L"},relativeTime:{future:"\u078c\u07ac\u0783\u07ad\u078e\u07a6\u0787\u07a8 %s",past:"\u0786\u07aa\u0783\u07a8\u0782\u07b0 %s",s:"\u0790\u07a8\u0786\u07aa\u0782\u07b0\u078c\u07aa\u0786\u07ae\u0785\u07ac\u0787\u07b0",ss:"d% \u0790\u07a8\u0786\u07aa\u0782\u07b0\u078c\u07aa",m:"\u0789\u07a8\u0782\u07a8\u0793\u07ac\u0787\u07b0",mm:"\u0789\u07a8\u0782\u07a8\u0793\u07aa %d",h:"\u078e\u07a6\u0791\u07a8\u0787\u07a8\u0783\u07ac\u0787\u07b0",hh:"\u078e\u07a6\u0791\u07a8\u0787\u07a8\u0783\u07aa %d",d:"\u078b\u07aa\u0788\u07a6\u0780\u07ac\u0787\u07b0",dd:"\u078b\u07aa\u0788\u07a6\u0790\u07b0 %d",M:"\u0789\u07a6\u0780\u07ac\u0787\u07b0",MM:"\u0789\u07a6\u0790\u07b0 %d",y:"\u0787\u07a6\u0780\u07a6\u0783\u07ac\u0787\u07b0",yy:"\u0787\u07a6\u0780\u07a6\u0783\u07aa %d"},preparse:function(e){return e.replace(/\u060c/g,",")},postformat:function(e){return e.replace(/,/g,"\u060c")},week:{dow:7,doy:12}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("el",{monthsNominativeEl:"\u0399\u03b1\u03bd\u03bf\u03c5\u03ac\u03c1\u03b9\u03bf\u03c2_\u03a6\u03b5\u03b2\u03c1\u03bf\u03c5\u03ac\u03c1\u03b9\u03bf\u03c2_\u039c\u03ac\u03c1\u03c4\u03b9\u03bf\u03c2_\u0391\u03c0\u03c1\u03af\u03bb\u03b9\u03bf\u03c2_\u039c\u03ac\u03b9\u03bf\u03c2_\u0399\u03bf\u03cd\u03bd\u03b9\u03bf\u03c2_\u0399\u03bf\u03cd\u03bb\u03b9\u03bf\u03c2_\u0391\u03cd\u03b3\u03bf\u03c5\u03c3\u03c4\u03bf\u03c2_\u03a3\u03b5\u03c0\u03c4\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2_\u039f\u03ba\u03c4\u03ce\u03b2\u03c1\u03b9\u03bf\u03c2_\u039d\u03bf\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2_\u0394\u03b5\u03ba\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2".split("_"),monthsGenitiveEl:"\u0399\u03b1\u03bd\u03bf\u03c5\u03b1\u03c1\u03af\u03bf\u03c5_\u03a6\u03b5\u03b2\u03c1\u03bf\u03c5\u03b1\u03c1\u03af\u03bf\u03c5_\u039c\u03b1\u03c1\u03c4\u03af\u03bf\u03c5_\u0391\u03c0\u03c1\u03b9\u03bb\u03af\u03bf\u03c5_\u039c\u03b1\u0390\u03bf\u03c5_\u0399\u03bf\u03c5\u03bd\u03af\u03bf\u03c5_\u0399\u03bf\u03c5\u03bb\u03af\u03bf\u03c5_\u0391\u03c5\u03b3\u03bf\u03cd\u03c3\u03c4\u03bf\u03c5_\u03a3\u03b5\u03c0\u03c4\u03b5\u03bc\u03b2\u03c1\u03af\u03bf\u03c5_\u039f\u03ba\u03c4\u03c9\u03b2\u03c1\u03af\u03bf\u03c5_\u039d\u03bf\u03b5\u03bc\u03b2\u03c1\u03af\u03bf\u03c5_\u0394\u03b5\u03ba\u03b5\u03bc\u03b2\u03c1\u03af\u03bf\u03c5".split("_"),months:function(e,t){return e?"string"==typeof t&&/D/.test(t.substring(0,t.indexOf("MMMM")))?this._monthsGenitiveEl[e.month()]:this._monthsNominativeEl[e.month()]:this._monthsNominativeEl},monthsShort:"\u0399\u03b1\u03bd_\u03a6\u03b5\u03b2_\u039c\u03b1\u03c1_\u0391\u03c0\u03c1_\u039c\u03b1\u03ca_\u0399\u03bf\u03c5\u03bd_\u0399\u03bf\u03c5\u03bb_\u0391\u03c5\u03b3_\u03a3\u03b5\u03c0_\u039f\u03ba\u03c4_\u039d\u03bf\u03b5_\u0394\u03b5\u03ba".split("_"),weekdays:"\u039a\u03c5\u03c1\u03b9\u03b1\u03ba\u03ae_\u0394\u03b5\u03c5\u03c4\u03ad\u03c1\u03b1_\u03a4\u03c1\u03af\u03c4\u03b7_\u03a4\u03b5\u03c4\u03ac\u03c1\u03c4\u03b7_\u03a0\u03ad\u03bc\u03c0\u03c4\u03b7_\u03a0\u03b1\u03c1\u03b1\u03c3\u03ba\u03b5\u03c5\u03ae_\u03a3\u03ac\u03b2\u03b2\u03b1\u03c4\u03bf".split("_"),weekdaysShort:"\u039a\u03c5\u03c1_\u0394\u03b5\u03c5_\u03a4\u03c1\u03b9_\u03a4\u03b5\u03c4_\u03a0\u03b5\u03bc_\u03a0\u03b1\u03c1_\u03a3\u03b1\u03b2".split("_"),weekdaysMin:"\u039a\u03c5_\u0394\u03b5_\u03a4\u03c1_\u03a4\u03b5_\u03a0\u03b5_\u03a0\u03b1_\u03a3\u03b1".split("_"),meridiem:function(e,t,n){return e>11?n?"\u03bc\u03bc":"\u039c\u039c":n?"\u03c0\u03bc":"\u03a0\u039c"},isPM:function(e){return"\u03bc"===(e+"").toLowerCase()[0]},meridiemParse:/[\u03a0\u039c]\.?\u039c?\.?/i,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendarEl:{sameDay:"[\u03a3\u03ae\u03bc\u03b5\u03c1\u03b1 {}] LT",nextDay:"[\u0391\u03cd\u03c1\u03b9\u03bf {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[\u03a7\u03b8\u03b5\u03c2 {}] LT",lastWeek:function(){switch(this.day()){case 6:return"[\u03c4\u03bf \u03c0\u03c1\u03bf\u03b7\u03b3\u03bf\u03cd\u03bc\u03b5\u03bd\u03bf] dddd [{}] LT";default:return"[\u03c4\u03b7\u03bd \u03c0\u03c1\u03bf\u03b7\u03b3\u03bf\u03cd\u03bc\u03b5\u03bd\u03b7] dddd [{}] LT"}},sameElse:"L"},calendar:function(e,t){var n,r=this._calendarEl[e],i=t&&t.hours();return n=r,("undefined"!=typeof Function&&n instanceof Function||"[object Function]"===Object.prototype.toString.call(n))&&(r=r.apply(t)),r.replace("{}",i%12==1?"\u03c3\u03c4\u03b7":"\u03c3\u03c4\u03b9\u03c2")},relativeTime:{future:"\u03c3\u03b5 %s",past:"%s \u03c0\u03c1\u03b9\u03bd",s:"\u03bb\u03af\u03b3\u03b1 \u03b4\u03b5\u03c5\u03c4\u03b5\u03c1\u03cc\u03bb\u03b5\u03c0\u03c4\u03b1",ss:"%d \u03b4\u03b5\u03c5\u03c4\u03b5\u03c1\u03cc\u03bb\u03b5\u03c0\u03c4\u03b1",m:"\u03ad\u03bd\u03b1 \u03bb\u03b5\u03c0\u03c4\u03cc",mm:"%d \u03bb\u03b5\u03c0\u03c4\u03ac",h:"\u03bc\u03af\u03b1 \u03ce\u03c1\u03b1",hh:"%d \u03ce\u03c1\u03b5\u03c2",d:"\u03bc\u03af\u03b1 \u03bc\u03ad\u03c1\u03b1",dd:"%d \u03bc\u03ad\u03c1\u03b5\u03c2",M:"\u03ad\u03bd\u03b1\u03c2 \u03bc\u03ae\u03bd\u03b1\u03c2",MM:"%d \u03bc\u03ae\u03bd\u03b5\u03c2",y:"\u03ad\u03bd\u03b1\u03c2 \u03c7\u03c1\u03cc\u03bd\u03bf\u03c2",yy:"%d \u03c7\u03c1\u03cc\u03bd\u03b9\u03b1"},dayOfMonthOrdinalParse:/\d{1,2}\u03b7/,ordinal:"%d\u03b7",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:0,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"YYYY-MM-DD",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("en-ie",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("en-il",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("en-in",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("en-nz",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("en-sg",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_a\u016dgusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mart_apr_maj_jun_jul_a\u016dg_sept_okt_nov_dec".split("_"),weekdays:"diman\u0109o_lundo_mardo_merkredo_\u0135a\u016ddo_vendredo_sabato".split("_"),weekdaysShort:"dim_lun_mard_merk_\u0135a\u016d_ven_sab".split("_"),weekdaysMin:"di_lu_ma_me_\u0135a_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"[la] D[-an de] MMMM, YYYY",LLL:"[la] D[-an de] MMMM, YYYY HH:mm",LLLL:"dddd[n], [la] D[-an de] MMMM, YYYY HH:mm",llll:"ddd, [la] D[-an de] MMM, YYYY HH:mm"},meridiemParse:/[ap]\.t\.m/i,isPM:function(e){return"p"===e.charAt(0).toLowerCase()},meridiem:function(e,t,n){return e>11?n?"p.t.m.":"P.T.M.":n?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia\u016d je] LT",nextDay:"[Morga\u016d je] LT",nextWeek:"dddd[n je] LT",lastDay:"[Hiera\u016d je] LT",lastWeek:"[pasintan] dddd[n je] LT",sameElse:"L"},relativeTime:{future:"post %s",past:"anta\u016d %s",s:"kelkaj sekundoj",ss:"%d sekundoj",m:"unu minuto",mm:"%d minutoj",h:"unu horo",hh:"%d horoj",d:"unu tago",dd:"%d tagoj",M:"unu monato",MM:"%d monatoj",y:"unu jaro",yy:"%d jaroj"},dayOfMonthOrdinalParse:/\d{1,2}a/,ordinal:"%da",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),n="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),r=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],i=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?n[e.month()]:t[e.month()]:t},monthsRegex:i,monthsShortRegex:i,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"domingo_lunes_martes_mi\xe9rcoles_jueves_viernes_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xe9._jue._vie._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma\xf1ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un a\xf1o",yy:"%d a\xf1os"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4},invalidDate:"Fecha inv\xe1lida"})}(n(3))},function(e,t,n){!function(e){var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),n="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),r=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],i=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-do",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?n[e.month()]:t[e.month()]:t},monthsRegex:i,monthsShortRegex:i,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"domingo_lunes_martes_mi\xe9rcoles_jueves_viernes_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xe9._jue._vie._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma\xf1ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un a\xf1o",yy:"%d a\xf1os"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),n="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),r=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],i=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-mx",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?n[e.month()]:t[e.month()]:t},monthsRegex:i,monthsShortRegex:i,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"domingo_lunes_martes_mi\xe9rcoles_jueves_viernes_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xe9._jue._vie._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma\xf1ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un a\xf1o",yy:"%d a\xf1os"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:0,doy:4},invalidDate:"Fecha inv\xe1lida"})}(n(3))},function(e,t,n){!function(e){var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),n="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),r=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],i=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-us",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?n[e.month()]:t[e.month()]:t},monthsRegex:i,monthsShortRegex:i,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"domingo_lunes_martes_mi\xe9rcoles_jueves_viernes_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xe9._jue._vie._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"MM/DD/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma\xf1ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un a\xf1o",yy:"%d a\xf1os"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i={s:["m\xf5ne sekundi","m\xf5ni sekund","paar sekundit"],ss:[e+"sekundi",e+"sekundit"],m:["\xfche minuti","\xfcks minut"],mm:[e+" minuti",e+" minutit"],h:["\xfche tunni","tund aega","\xfcks tund"],hh:[e+" tunni",e+" tundi"],d:["\xfche p\xe4eva","\xfcks p\xe4ev"],M:["kuu aja","kuu aega","\xfcks kuu"],MM:[e+" kuu",e+" kuud"],y:["\xfche aasta","aasta","\xfcks aasta"],yy:[e+" aasta",e+" aastat"]};return t?i[n][2]?i[n][2]:i[n][1]:r?i[n][0]:i[n][1]}e.defineLocale("et",{months:"jaanuar_veebruar_m\xe4rts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_m\xe4rts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"p\xfchap\xe4ev_esmasp\xe4ev_teisip\xe4ev_kolmap\xe4ev_neljap\xe4ev_reede_laup\xe4ev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[T\xe4na,] LT",nextDay:"[Homme,] LT",nextWeek:"[J\xe4rgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s p\xe4rast",past:"%s tagasi",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:"%d p\xe4eva",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),monthsParseExact:!0,weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] HH:mm",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] HH:mm",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] HH:mm",llll:"ddd, YYYY[ko] MMM D[a] HH:mm"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",ss:"%d segundo",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u06f1",2:"\u06f2",3:"\u06f3",4:"\u06f4",5:"\u06f5",6:"\u06f6",7:"\u06f7",8:"\u06f8",9:"\u06f9",0:"\u06f0"},n={"\u06f1":"1","\u06f2":"2","\u06f3":"3","\u06f4":"4","\u06f5":"5","\u06f6":"6","\u06f7":"7","\u06f8":"8","\u06f9":"9","\u06f0":"0"};e.defineLocale("fa",{months:"\u0698\u0627\u0646\u0648\u06cc\u0647_\u0641\u0648\u0631\u06cc\u0647_\u0645\u0627\u0631\u0633_\u0622\u0648\u0631\u06cc\u0644_\u0645\u0647_\u0698\u0648\u0626\u0646_\u0698\u0648\u0626\u06cc\u0647_\u0627\u0648\u062a_\u0633\u067e\u062a\u0627\u0645\u0628\u0631_\u0627\u06a9\u062a\u0628\u0631_\u0646\u0648\u0627\u0645\u0628\u0631_\u062f\u0633\u0627\u0645\u0628\u0631".split("_"),monthsShort:"\u0698\u0627\u0646\u0648\u06cc\u0647_\u0641\u0648\u0631\u06cc\u0647_\u0645\u0627\u0631\u0633_\u0622\u0648\u0631\u06cc\u0644_\u0645\u0647_\u0698\u0648\u0626\u0646_\u0698\u0648\u0626\u06cc\u0647_\u0627\u0648\u062a_\u0633\u067e\u062a\u0627\u0645\u0628\u0631_\u0627\u06a9\u062a\u0628\u0631_\u0646\u0648\u0627\u0645\u0628\u0631_\u062f\u0633\u0627\u0645\u0628\u0631".split("_"),weekdays:"\u06cc\u06a9\u200c\u0634\u0646\u0628\u0647_\u062f\u0648\u0634\u0646\u0628\u0647_\u0633\u0647\u200c\u0634\u0646\u0628\u0647_\u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647_\u067e\u0646\u062c\u200c\u0634\u0646\u0628\u0647_\u062c\u0645\u0639\u0647_\u0634\u0646\u0628\u0647".split("_"),weekdaysShort:"\u06cc\u06a9\u200c\u0634\u0646\u0628\u0647_\u062f\u0648\u0634\u0646\u0628\u0647_\u0633\u0647\u200c\u0634\u0646\u0628\u0647_\u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647_\u067e\u0646\u062c\u200c\u0634\u0646\u0628\u0647_\u062c\u0645\u0639\u0647_\u0634\u0646\u0628\u0647".split("_"),weekdaysMin:"\u06cc_\u062f_\u0633_\u0686_\u067e_\u062c_\u0634".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/\u0642\u0628\u0644 \u0627\u0632 \u0638\u0647\u0631|\u0628\u0639\u062f \u0627\u0632 \u0638\u0647\u0631/,isPM:function(e){return/\u0628\u0639\u062f \u0627\u0632 \u0638\u0647\u0631/.test(e)},meridiem:function(e,t,n){return e<12?"\u0642\u0628\u0644 \u0627\u0632 \u0638\u0647\u0631":"\u0628\u0639\u062f \u0627\u0632 \u0638\u0647\u0631"},calendar:{sameDay:"[\u0627\u0645\u0631\u0648\u0632 \u0633\u0627\u0639\u062a] LT",nextDay:"[\u0641\u0631\u062f\u0627 \u0633\u0627\u0639\u062a] LT",nextWeek:"dddd [\u0633\u0627\u0639\u062a] LT",lastDay:"[\u062f\u06cc\u0631\u0648\u0632 \u0633\u0627\u0639\u062a] LT",lastWeek:"dddd [\u067e\u06cc\u0634] [\u0633\u0627\u0639\u062a] LT",sameElse:"L"},relativeTime:{future:"\u062f\u0631 %s",past:"%s \u067e\u06cc\u0634",s:"\u0686\u0646\u062f \u062b\u0627\u0646\u06cc\u0647",ss:"%d \u062b\u0627\u0646\u06cc\u0647",m:"\u06cc\u06a9 \u062f\u0642\u06cc\u0642\u0647",mm:"%d \u062f\u0642\u06cc\u0642\u0647",h:"\u06cc\u06a9 \u0633\u0627\u0639\u062a",hh:"%d \u0633\u0627\u0639\u062a",d:"\u06cc\u06a9 \u0631\u0648\u0632",dd:"%d \u0631\u0648\u0632",M:"\u06cc\u06a9 \u0645\u0627\u0647",MM:"%d \u0645\u0627\u0647",y:"\u06cc\u06a9 \u0633\u0627\u0644",yy:"%d \u0633\u0627\u0644"},preparse:function(e){return e.replace(/[\u06f0-\u06f9]/g,(function(e){return n[e]})).replace(/\u060c/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"\u060c")},dayOfMonthOrdinalParse:/\d{1,2}\u0645/,ordinal:"%d\u0645",week:{dow:6,doy:12}})}(n(3))},function(e,t,n){!function(e){var t="nolla yksi kaksi kolme nelj\xe4 viisi kuusi seitsem\xe4n kahdeksan yhdeks\xe4n".split(" "),n=["nolla","yhden","kahden","kolmen","nelj\xe4n","viiden","kuuden",t[7],t[8],t[9]];function r(e,r,i,a){var o="";switch(i){case"s":return a?"muutaman sekunnin":"muutama sekunti";case"ss":o=a?"sekunnin":"sekuntia";break;case"m":return a?"minuutin":"minuutti";case"mm":o=a?"minuutin":"minuuttia";break;case"h":return a?"tunnin":"tunti";case"hh":o=a?"tunnin":"tuntia";break;case"d":return a?"p\xe4iv\xe4n":"p\xe4iv\xe4";case"dd":o=a?"p\xe4iv\xe4n":"p\xe4iv\xe4\xe4";break;case"M":return a?"kuukauden":"kuukausi";case"MM":o=a?"kuukauden":"kuukautta";break;case"y":return a?"vuoden":"vuosi";case"yy":o=a?"vuoden":"vuotta"}return function(e,r){return e<10?r?n[e]:t[e]:e}(e,a)+" "+o}e.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_kes\xe4kuu_hein\xe4kuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes\xe4_hein\xe4_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] HH.mm",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] HH.mm",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] HH.mm",llll:"ddd, Do MMM YYYY, [klo] HH.mm"},calendar:{sameDay:"[t\xe4n\xe4\xe4n] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s p\xe4\xe4st\xe4",past:"%s sitten",s:r,ss:r,m:r,mm:r,h:r,hh:r,d:r,dd:r,M:r,MM:r,y:r,yy:r},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("fil",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("fo",{months:"januar_februar_mars_apr\xedl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_m\xe1nadagur_t\xfdsdagur_mikudagur_h\xf3sdagur_fr\xedggjadagur_leygardagur".split("_"),weekdaysShort:"sun_m\xe1n_t\xfds_mik_h\xf3s_fr\xed_ley".split("_"),weekdaysMin:"su_m\xe1_t\xfd_mi_h\xf3_fr_le".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D. MMMM, YYYY HH:mm"},calendar:{sameDay:"[\xcd dag kl.] LT",nextDay:"[\xcd morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[\xcd gj\xe1r kl.] LT",lastWeek:"[s\xed\xf0stu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s s\xed\xf0ani",s:"f\xe1 sekund",ss:"%d sekundir",m:"ein minuttur",mm:"%d minuttir",h:"ein t\xedmi",hh:"%d t\xedmar",d:"ein dagur",dd:"%d dagar",M:"ein m\xe1na\xf0ur",MM:"%d m\xe1na\xf0ir",y:"eitt \xe1r",yy:"%d \xe1r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t=/(janv\.?|f\xe9vr\.?|mars|avr\.?|mai|juin|juil\.?|ao\xfbt|sept\.?|oct\.?|nov\.?|d\xe9c\.?|janvier|f\xe9vrier|mars|avril|mai|juin|juillet|ao\xfbt|septembre|octobre|novembre|d\xe9cembre)/i,n=[/^janv/i,/^f\xe9vr/i,/^mars/i,/^avr/i,/^mai/i,/^juin/i,/^juil/i,/^ao\xfbt/i,/^sept/i,/^oct/i,/^nov/i,/^d\xe9c/i];e.defineLocale("fr",{months:"janvier_f\xe9vrier_mars_avril_mai_juin_juillet_ao\xfbt_septembre_octobre_novembre_d\xe9cembre".split("_"),monthsShort:"janv._f\xe9vr._mars_avr._mai_juin_juil._ao\xfbt_sept._oct._nov._d\xe9c.".split("_"),monthsRegex:t,monthsShortRegex:t,monthsStrictRegex:/^(janvier|f\xe9vrier|mars|avril|mai|juin|juillet|ao\xfbt|septembre|octobre|novembre|d\xe9cembre)/i,monthsShortStrictRegex:/(janv\.?|f\xe9vr\.?|mars|avr\.?|mai|juin|juil\.?|ao\xfbt|sept\.?|oct\.?|nov\.?|d\xe9c\.?)/i,monthsParse:n,longMonthsParse:n,shortMonthsParse:n,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd\u2019hui \xe0] LT",nextDay:"[Demain \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[Hier \xe0] LT",lastWeek:"dddd [dernier \xe0] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",w:"une semaine",ww:"%d semaines",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|)/,ordinal:function(e,t){switch(t){case"D":return e+(1===e?"er":"");default:case"M":case"Q":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("fr-ca",{months:"janvier_f\xe9vrier_mars_avril_mai_juin_juillet_ao\xfbt_septembre_octobre_novembre_d\xe9cembre".split("_"),monthsShort:"janv._f\xe9vr._mars_avr._mai_juin_juil._ao\xfbt_sept._oct._nov._d\xe9c.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd\u2019hui \xe0] LT",nextDay:"[Demain \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[Hier \xe0] LT",lastWeek:"dddd [dernier \xe0] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(e,t){switch(t){default:case"M":case"Q":case"D":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("fr-ch",{months:"janvier_f\xe9vrier_mars_avril_mai_juin_juillet_ao\xfbt_septembre_octobre_novembre_d\xe9cembre".split("_"),monthsShort:"janv._f\xe9vr._mars_avr._mai_juin_juil._ao\xfbt_sept._oct._nov._d\xe9c.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd\u2019hui \xe0] LT",nextDay:"[Demain \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[Hier \xe0] LT",lastWeek:"dddd [dernier \xe0] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(e,t){switch(t){default:case"M":case"Q":case"D":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t="jan._feb._mrt._apr._mai_jun._jul._aug._sep._okt._nov._des.".split("_"),n="jan_feb_mrt_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_");e.defineLocale("fy",{months:"jannewaris_febrewaris_maart_april_maaie_juny_july_augustus_septimber_oktober_novimber_desimber".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?n[e.month()]:t[e.month()]:t},monthsParseExact:!0,weekdays:"snein_moandei_tiisdei_woansdei_tongersdei_freed_sneon".split("_"),weekdaysShort:"si._mo._ti._wo._to._fr._so.".split("_"),weekdaysMin:"Si_Mo_Ti_Wo_To_Fr_So".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[hjoed om] LT",nextDay:"[moarn om] LT",nextWeek:"dddd [om] LT",lastDay:"[juster om] LT",lastWeek:"[\xf4fr\xfbne] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oer %s",past:"%s lyn",s:"in pear sekonden",ss:"%d sekonden",m:"ien min\xfat",mm:"%d minuten",h:"ien oere",hh:"%d oeren",d:"ien dei",dd:"%d dagen",M:"ien moanne",MM:"%d moannen",y:"ien jier",yy:"%d jierren"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ga",{months:["Ean\xe1ir","Feabhra","M\xe1rta","Aibre\xe1n","Bealtaine","Meitheamh","I\xfail","L\xfanasa","Me\xe1n F\xf3mhair","Deireadh F\xf3mhair","Samhain","Nollaig"],monthsShort:["Ean","Feabh","M\xe1rt","Aib","Beal","Meith","I\xfail","L\xfan","M.F.","D.F.","Samh","Noll"],monthsParseExact:!0,weekdays:["D\xe9 Domhnaigh","D\xe9 Luain","D\xe9 M\xe1irt","D\xe9 C\xe9adaoin","D\xe9ardaoin","D\xe9 hAoine","D\xe9 Sathairn"],weekdaysShort:["Domh","Luan","M\xe1irt","C\xe9ad","D\xe9ar","Aoine","Sath"],weekdaysMin:["Do","Lu","M\xe1","C\xe9","D\xe9","A","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Inniu ag] LT",nextDay:"[Am\xe1rach ag] LT",nextWeek:"dddd [ag] LT",lastDay:"[Inn\xe9 ag] LT",lastWeek:"dddd [seo caite] [ag] LT",sameElse:"L"},relativeTime:{future:"i %s",past:"%s \xf3 shin",s:"c\xfapla soicind",ss:"%d soicind",m:"n\xf3im\xe9ad",mm:"%d n\xf3im\xe9ad",h:"uair an chloig",hh:"%d uair an chloig",d:"l\xe1",dd:"%d l\xe1",M:"m\xed",MM:"%d m\xedonna",y:"bliain",yy:"%d bliain"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(e){return e+(1===e?"d":e%10==2?"na":"mh")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("gd",{months:["Am Faoilleach","An Gearran","Am M\xe0rt","An Giblean","An C\xe8itean","An t-\xd2gmhios","An t-Iuchar","An L\xf9nastal","An t-Sultain","An D\xe0mhair","An t-Samhain","An D\xf9bhlachd"],monthsShort:["Faoi","Gear","M\xe0rt","Gibl","C\xe8it","\xd2gmh","Iuch","L\xf9n","Sult","D\xe0mh","Samh","D\xf9bh"],monthsParseExact:!0,weekdays:["Did\xf2mhnaich","Diluain","Dim\xe0irt","Diciadain","Diardaoin","Dihaoine","Disathairne"],weekdaysShort:["Did","Dil","Dim","Dic","Dia","Dih","Dis"],weekdaysMin:["D\xf2","Lu","M\xe0","Ci","Ar","Ha","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[An-diugh aig] LT",nextDay:"[A-m\xe0ireach aig] LT",nextWeek:"dddd [aig] LT",lastDay:"[An-d\xe8 aig] LT",lastWeek:"dddd [seo chaidh] [aig] LT",sameElse:"L"},relativeTime:{future:"ann an %s",past:"bho chionn %s",s:"beagan diogan",ss:"%d diogan",m:"mionaid",mm:"%d mionaidean",h:"uair",hh:"%d uairean",d:"latha",dd:"%d latha",M:"m\xecos",MM:"%d m\xecosan",y:"bliadhna",yy:"%d bliadhna"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(e){return e+(1===e?"d":e%10==2?"na":"mh")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("gl",{months:"xaneiro_febreiro_marzo_abril_maio_xu\xf1o_xullo_agosto_setembro_outubro_novembro_decembro".split("_"),monthsShort:"xan._feb._mar._abr._mai._xu\xf1._xul._ago._set._out._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"domingo_luns_martes_m\xe9rcores_xoves_venres_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._m\xe9r._xov._ven._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_m\xe9_xo_ve_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"\xe1s":"\xe1")+"] LT"},nextDay:function(){return"[ma\xf1\xe1 "+(1!==this.hours()?"\xe1s":"\xe1")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"\xe1s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"\xe1":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"\xe1s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(e){return 0===e.indexOf("un")?"n"+e:"en "+e},past:"hai %s",s:"uns segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i={s:["\u0925\u094b\u0921\u092f\u093e \u0938\u0945\u0915\u0902\u0921\u093e\u0902\u0928\u0940","\u0925\u094b\u0921\u0947 \u0938\u0945\u0915\u0902\u0921"],ss:[e+" \u0938\u0945\u0915\u0902\u0921\u093e\u0902\u0928\u0940",e+" \u0938\u0945\u0915\u0902\u0921"],m:["\u090f\u0915\u093e \u092e\u093f\u0923\u091f\u093e\u0928","\u090f\u0915 \u092e\u093f\u0928\u0942\u091f"],mm:[e+" \u092e\u093f\u0923\u091f\u093e\u0902\u0928\u0940",e+" \u092e\u093f\u0923\u091f\u093e\u0902"],h:["\u090f\u0915\u093e \u0935\u0930\u093e\u0928","\u090f\u0915 \u0935\u0930"],hh:[e+" \u0935\u0930\u093e\u0902\u0928\u0940",e+" \u0935\u0930\u093e\u0902"],d:["\u090f\u0915\u093e \u0926\u093f\u0938\u093e\u0928","\u090f\u0915 \u0926\u0940\u0938"],dd:[e+" \u0926\u093f\u0938\u093e\u0902\u0928\u0940",e+" \u0926\u0940\u0938"],M:["\u090f\u0915\u093e \u092e\u094d\u0939\u092f\u0928\u094d\u092f\u093e\u0928","\u090f\u0915 \u092e\u094d\u0939\u092f\u0928\u094b"],MM:[e+" \u092e\u094d\u0939\u092f\u0928\u094d\u092f\u093e\u0928\u0940",e+" \u092e\u094d\u0939\u092f\u0928\u0947"],y:["\u090f\u0915\u093e \u0935\u0930\u094d\u0938\u093e\u0928","\u090f\u0915 \u0935\u0930\u094d\u0938"],yy:[e+" \u0935\u0930\u094d\u0938\u093e\u0902\u0928\u0940",e+" \u0935\u0930\u094d\u0938\u093e\u0902"]};return r?i[n][0]:i[n][1]}e.defineLocale("gom-deva",{months:{standalone:"\u091c\u093e\u0928\u0947\u0935\u093e\u0930\u0940_\u092b\u0947\u092c\u094d\u0930\u0941\u0935\u093e\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u090f\u092a\u094d\u0930\u0940\u0932_\u092e\u0947_\u091c\u0942\u0928_\u091c\u0941\u0932\u092f_\u0911\u0917\u0938\u094d\u091f_\u0938\u092a\u094d\u091f\u0947\u0902\u092c\u0930_\u0911\u0915\u094d\u091f\u094b\u092c\u0930_\u0928\u094b\u0935\u094d\u0939\u0947\u0902\u092c\u0930_\u0921\u093f\u0938\u0947\u0902\u092c\u0930".split("_"),format:"\u091c\u093e\u0928\u0947\u0935\u093e\u0930\u0940\u091a\u094d\u092f\u093e_\u092b\u0947\u092c\u094d\u0930\u0941\u0935\u093e\u0930\u0940\u091a\u094d\u092f\u093e_\u092e\u093e\u0930\u094d\u091a\u093e\u091a\u094d\u092f\u093e_\u090f\u092a\u094d\u0930\u0940\u0932\u093e\u091a\u094d\u092f\u093e_\u092e\u0947\u092f\u093e\u091a\u094d\u092f\u093e_\u091c\u0942\u0928\u093e\u091a\u094d\u092f\u093e_\u091c\u0941\u0932\u092f\u093e\u091a\u094d\u092f\u093e_\u0911\u0917\u0938\u094d\u091f\u093e\u091a\u094d\u092f\u093e_\u0938\u092a\u094d\u091f\u0947\u0902\u092c\u0930\u093e\u091a\u094d\u092f\u093e_\u0911\u0915\u094d\u091f\u094b\u092c\u0930\u093e\u091a\u094d\u092f\u093e_\u0928\u094b\u0935\u094d\u0939\u0947\u0902\u092c\u0930\u093e\u091a\u094d\u092f\u093e_\u0921\u093f\u0938\u0947\u0902\u092c\u0930\u093e\u091a\u094d\u092f\u093e".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"\u091c\u093e\u0928\u0947._\u092b\u0947\u092c\u094d\u0930\u0941._\u092e\u093e\u0930\u094d\u091a_\u090f\u092a\u094d\u0930\u0940._\u092e\u0947_\u091c\u0942\u0928_\u091c\u0941\u0932._\u0911\u0917._\u0938\u092a\u094d\u091f\u0947\u0902._\u0911\u0915\u094d\u091f\u094b._\u0928\u094b\u0935\u094d\u0939\u0947\u0902._\u0921\u093f\u0938\u0947\u0902.".split("_"),monthsParseExact:!0,weekdays:"\u0906\u092f\u0924\u093e\u0930_\u0938\u094b\u092e\u093e\u0930_\u092e\u0902\u0917\u0933\u093e\u0930_\u092c\u0941\u0927\u0935\u093e\u0930_\u092c\u093f\u0930\u0947\u0938\u094d\u0924\u093e\u0930_\u0938\u0941\u0915\u094d\u0930\u093e\u0930_\u0936\u0947\u0928\u0935\u093e\u0930".split("_"),weekdaysShort:"\u0906\u092f\u0924._\u0938\u094b\u092e._\u092e\u0902\u0917\u0933._\u092c\u0941\u0927._\u092c\u094d\u0930\u0947\u0938\u094d\u0924._\u0938\u0941\u0915\u094d\u0930._\u0936\u0947\u0928.".split("_"),weekdaysMin:"\u0906_\u0938\u094b_\u092e\u0902_\u092c\u0941_\u092c\u094d\u0930\u0947_\u0938\u0941_\u0936\u0947".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm [\u0935\u093e\u091c\u0924\u093e\u0902]",LTS:"A h:mm:ss [\u0935\u093e\u091c\u0924\u093e\u0902]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [\u0935\u093e\u091c\u0924\u093e\u0902]",LLLL:"dddd, MMMM Do, YYYY, A h:mm [\u0935\u093e\u091c\u0924\u093e\u0902]",llll:"ddd, D MMM YYYY, A h:mm [\u0935\u093e\u091c\u0924\u093e\u0902]"},calendar:{sameDay:"[\u0906\u092f\u091c] LT",nextDay:"[\u092b\u093e\u0932\u094d\u092f\u093e\u0902] LT",nextWeek:"[\u092b\u0941\u0921\u0932\u094b] dddd[,] LT",lastDay:"[\u0915\u093e\u0932] LT",lastWeek:"[\u092b\u093e\u091f\u0932\u094b] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s \u0906\u0926\u0940\u0902",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}(\u0935\u0947\u0930)/,ordinal:function(e,t){switch(t){case"D":return e+"\u0935\u0947\u0930";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return e}},week:{dow:0,doy:3},meridiemParse:/\u0930\u093e\u0924\u0940|\u0938\u0915\u093e\u0933\u0940\u0902|\u0926\u0928\u092a\u093e\u0930\u093e\u0902|\u0938\u093e\u0902\u091c\u0947/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0930\u093e\u0924\u0940"===t?e<4?e:e+12:"\u0938\u0915\u093e\u0933\u0940\u0902"===t?e:"\u0926\u0928\u092a\u093e\u0930\u093e\u0902"===t?e>12?e:e+12:"\u0938\u093e\u0902\u091c\u0947"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"\u0930\u093e\u0924\u0940":e<12?"\u0938\u0915\u093e\u0933\u0940\u0902":e<16?"\u0926\u0928\u092a\u093e\u0930\u093e\u0902":e<20?"\u0938\u093e\u0902\u091c\u0947":"\u0930\u093e\u0924\u0940"}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i={s:["thoddea sekondamni","thodde sekond"],ss:[e+" sekondamni",e+" sekond"],m:["eka mintan","ek minut"],mm:[e+" mintamni",e+" mintam"],h:["eka voran","ek vor"],hh:[e+" voramni",e+" voram"],d:["eka disan","ek dis"],dd:[e+" disamni",e+" dis"],M:["eka mhoinean","ek mhoino"],MM:[e+" mhoineamni",e+" mhoine"],y:["eka vorsan","ek voros"],yy:[e+" vorsamni",e+" vorsam"]};return r?i[n][0]:i[n][1]}e.defineLocale("gom-latn",{months:{standalone:"Janer_Febrer_Mars_Abril_Mai_Jun_Julai_Agost_Setembr_Otubr_Novembr_Dezembr".split("_"),format:"Janerachea_Febrerachea_Marsachea_Abrilachea_Maiachea_Junachea_Julaiachea_Agostachea_Setembrachea_Otubrachea_Novembrachea_Dezembrachea".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"Jan._Feb._Mars_Abr._Mai_Jun_Jul._Ago._Set._Otu._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Aitar_Somar_Mongllar_Budhvar_Birestar_Sukrar_Son'var".split("_"),weekdaysShort:"Ait._Som._Mon._Bud._Bre._Suk._Son.".split("_"),weekdaysMin:"Ai_Sm_Mo_Bu_Br_Su_Sn".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm [vazta]",LTS:"A h:mm:ss [vazta]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [vazta]",LLLL:"dddd, MMMM Do, YYYY, A h:mm [vazta]",llll:"ddd, D MMM YYYY, A h:mm [vazta]"},calendar:{sameDay:"[Aiz] LT",nextDay:"[Faleam] LT",nextWeek:"[Fuddlo] dddd[,] LT",lastDay:"[Kal] LT",lastWeek:"[Fattlo] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s adim",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}(er)/,ordinal:function(e,t){switch(t){case"D":return e+"er";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return e}},week:{dow:0,doy:3},meridiemParse:/rati|sokallim|donparam|sanje/,meridiemHour:function(e,t){return 12===e&&(e=0),"rati"===t?e<4?e:e+12:"sokallim"===t?e:"donparam"===t?e>12?e:e+12:"sanje"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"rati":e<12?"sokallim":e<16?"donparam":e<20?"sanje":"rati"}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0ae7",2:"\u0ae8",3:"\u0ae9",4:"\u0aea",5:"\u0aeb",6:"\u0aec",7:"\u0aed",8:"\u0aee",9:"\u0aef",0:"\u0ae6"},n={"\u0ae7":"1","\u0ae8":"2","\u0ae9":"3","\u0aea":"4","\u0aeb":"5","\u0aec":"6","\u0aed":"7","\u0aee":"8","\u0aef":"9","\u0ae6":"0"};e.defineLocale("gu",{months:"\u0a9c\u0abe\u0aa8\u0acd\u0aaf\u0ac1\u0a86\u0ab0\u0ac0_\u0aab\u0ac7\u0aac\u0acd\u0ab0\u0ac1\u0a86\u0ab0\u0ac0_\u0aae\u0abe\u0ab0\u0acd\u0a9a_\u0a8f\u0aaa\u0acd\u0ab0\u0abf\u0ab2_\u0aae\u0ac7_\u0a9c\u0ac2\u0aa8_\u0a9c\u0ac1\u0ab2\u0abe\u0a88_\u0a91\u0a97\u0ab8\u0acd\u0a9f_\u0ab8\u0aaa\u0acd\u0a9f\u0ac7\u0aae\u0acd\u0aac\u0ab0_\u0a91\u0a95\u0acd\u0a9f\u0acd\u0aac\u0ab0_\u0aa8\u0ab5\u0ac7\u0aae\u0acd\u0aac\u0ab0_\u0aa1\u0abf\u0ab8\u0ac7\u0aae\u0acd\u0aac\u0ab0".split("_"),monthsShort:"\u0a9c\u0abe\u0aa8\u0acd\u0aaf\u0ac1._\u0aab\u0ac7\u0aac\u0acd\u0ab0\u0ac1._\u0aae\u0abe\u0ab0\u0acd\u0a9a_\u0a8f\u0aaa\u0acd\u0ab0\u0abf._\u0aae\u0ac7_\u0a9c\u0ac2\u0aa8_\u0a9c\u0ac1\u0ab2\u0abe._\u0a91\u0a97._\u0ab8\u0aaa\u0acd\u0a9f\u0ac7._\u0a91\u0a95\u0acd\u0a9f\u0acd._\u0aa8\u0ab5\u0ac7._\u0aa1\u0abf\u0ab8\u0ac7.".split("_"),monthsParseExact:!0,weekdays:"\u0ab0\u0ab5\u0abf\u0ab5\u0abe\u0ab0_\u0ab8\u0acb\u0aae\u0ab5\u0abe\u0ab0_\u0aae\u0a82\u0a97\u0ab3\u0ab5\u0abe\u0ab0_\u0aac\u0ac1\u0aa7\u0acd\u0ab5\u0abe\u0ab0_\u0a97\u0ac1\u0ab0\u0ac1\u0ab5\u0abe\u0ab0_\u0ab6\u0ac1\u0a95\u0acd\u0ab0\u0ab5\u0abe\u0ab0_\u0ab6\u0aa8\u0abf\u0ab5\u0abe\u0ab0".split("_"),weekdaysShort:"\u0ab0\u0ab5\u0abf_\u0ab8\u0acb\u0aae_\u0aae\u0a82\u0a97\u0ab3_\u0aac\u0ac1\u0aa7\u0acd_\u0a97\u0ac1\u0ab0\u0ac1_\u0ab6\u0ac1\u0a95\u0acd\u0ab0_\u0ab6\u0aa8\u0abf".split("_"),weekdaysMin:"\u0ab0_\u0ab8\u0acb_\u0aae\u0a82_\u0aac\u0ac1_\u0a97\u0ac1_\u0ab6\u0ac1_\u0ab6".split("_"),longDateFormat:{LT:"A h:mm \u0ab5\u0abe\u0a97\u0acd\u0aaf\u0ac7",LTS:"A h:mm:ss \u0ab5\u0abe\u0a97\u0acd\u0aaf\u0ac7",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u0ab5\u0abe\u0a97\u0acd\u0aaf\u0ac7",LLLL:"dddd, D MMMM YYYY, A h:mm \u0ab5\u0abe\u0a97\u0acd\u0aaf\u0ac7"},calendar:{sameDay:"[\u0a86\u0a9c] LT",nextDay:"[\u0a95\u0abe\u0ab2\u0ac7] LT",nextWeek:"dddd, LT",lastDay:"[\u0a97\u0a87\u0a95\u0abe\u0ab2\u0ac7] LT",lastWeek:"[\u0aaa\u0abe\u0a9b\u0ab2\u0abe] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0aae\u0abe",past:"%s \u0aaa\u0ab9\u0ac7\u0ab2\u0abe",s:"\u0a85\u0aae\u0ac1\u0a95 \u0aaa\u0ab3\u0acb",ss:"%d \u0ab8\u0ac7\u0a95\u0a82\u0aa1",m:"\u0a8f\u0a95 \u0aae\u0abf\u0aa8\u0abf\u0a9f",mm:"%d \u0aae\u0abf\u0aa8\u0abf\u0a9f",h:"\u0a8f\u0a95 \u0a95\u0ab2\u0abe\u0a95",hh:"%d \u0a95\u0ab2\u0abe\u0a95",d:"\u0a8f\u0a95 \u0aa6\u0abf\u0ab5\u0ab8",dd:"%d \u0aa6\u0abf\u0ab5\u0ab8",M:"\u0a8f\u0a95 \u0aae\u0ab9\u0abf\u0aa8\u0acb",MM:"%d \u0aae\u0ab9\u0abf\u0aa8\u0acb",y:"\u0a8f\u0a95 \u0ab5\u0ab0\u0acd\u0ab7",yy:"%d \u0ab5\u0ab0\u0acd\u0ab7"},preparse:function(e){return e.replace(/[\u0ae7\u0ae8\u0ae9\u0aea\u0aeb\u0aec\u0aed\u0aee\u0aef\u0ae6]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u0ab0\u0abe\u0aa4|\u0aac\u0aaa\u0acb\u0ab0|\u0ab8\u0ab5\u0abe\u0ab0|\u0ab8\u0abe\u0a82\u0a9c/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0ab0\u0abe\u0aa4"===t?e<4?e:e+12:"\u0ab8\u0ab5\u0abe\u0ab0"===t?e:"\u0aac\u0aaa\u0acb\u0ab0"===t?e>=10?e:e+12:"\u0ab8\u0abe\u0a82\u0a9c"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"\u0ab0\u0abe\u0aa4":e<10?"\u0ab8\u0ab5\u0abe\u0ab0":e<17?"\u0aac\u0aaa\u0acb\u0ab0":e<20?"\u0ab8\u0abe\u0a82\u0a9c":"\u0ab0\u0abe\u0aa4"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("he",{months:"\u05d9\u05e0\u05d5\u05d0\u05e8_\u05e4\u05d1\u05e8\u05d5\u05d0\u05e8_\u05de\u05e8\u05e5_\u05d0\u05e4\u05e8\u05d9\u05dc_\u05de\u05d0\u05d9_\u05d9\u05d5\u05e0\u05d9_\u05d9\u05d5\u05dc\u05d9_\u05d0\u05d5\u05d2\u05d5\u05e1\u05d8_\u05e1\u05e4\u05d8\u05de\u05d1\u05e8_\u05d0\u05d5\u05e7\u05d8\u05d5\u05d1\u05e8_\u05e0\u05d5\u05d1\u05de\u05d1\u05e8_\u05d3\u05e6\u05de\u05d1\u05e8".split("_"),monthsShort:"\u05d9\u05e0\u05d5\u05f3_\u05e4\u05d1\u05e8\u05f3_\u05de\u05e8\u05e5_\u05d0\u05e4\u05e8\u05f3_\u05de\u05d0\u05d9_\u05d9\u05d5\u05e0\u05d9_\u05d9\u05d5\u05dc\u05d9_\u05d0\u05d5\u05d2\u05f3_\u05e1\u05e4\u05d8\u05f3_\u05d0\u05d5\u05e7\u05f3_\u05e0\u05d5\u05d1\u05f3_\u05d3\u05e6\u05de\u05f3".split("_"),weekdays:"\u05e8\u05d0\u05e9\u05d5\u05df_\u05e9\u05e0\u05d9_\u05e9\u05dc\u05d9\u05e9\u05d9_\u05e8\u05d1\u05d9\u05e2\u05d9_\u05d7\u05de\u05d9\u05e9\u05d9_\u05e9\u05d9\u05e9\u05d9_\u05e9\u05d1\u05ea".split("_"),weekdaysShort:"\u05d0\u05f3_\u05d1\u05f3_\u05d2\u05f3_\u05d3\u05f3_\u05d4\u05f3_\u05d5\u05f3_\u05e9\u05f3".split("_"),weekdaysMin:"\u05d0_\u05d1_\u05d2_\u05d3_\u05d4_\u05d5_\u05e9".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [\u05d1]MMMM YYYY",LLL:"D [\u05d1]MMMM YYYY HH:mm",LLLL:"dddd, D [\u05d1]MMMM YYYY HH:mm",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[\u05d4\u05d9\u05d5\u05dd \u05d1\u05be]LT",nextDay:"[\u05de\u05d7\u05e8 \u05d1\u05be]LT",nextWeek:"dddd [\u05d1\u05e9\u05e2\u05d4] LT",lastDay:"[\u05d0\u05ea\u05de\u05d5\u05dc \u05d1\u05be]LT",lastWeek:"[\u05d1\u05d9\u05d5\u05dd] dddd [\u05d4\u05d0\u05d7\u05e8\u05d5\u05df \u05d1\u05e9\u05e2\u05d4] LT",sameElse:"L"},relativeTime:{future:"\u05d1\u05e2\u05d5\u05d3 %s",past:"\u05dc\u05e4\u05e0\u05d9 %s",s:"\u05de\u05e1\u05e4\u05e8 \u05e9\u05e0\u05d9\u05d5\u05ea",ss:"%d \u05e9\u05e0\u05d9\u05d5\u05ea",m:"\u05d3\u05e7\u05d4",mm:"%d \u05d3\u05e7\u05d5\u05ea",h:"\u05e9\u05e2\u05d4",hh:function(e){return 2===e?"\u05e9\u05e2\u05ea\u05d9\u05d9\u05dd":e+" \u05e9\u05e2\u05d5\u05ea"},d:"\u05d9\u05d5\u05dd",dd:function(e){return 2===e?"\u05d9\u05d5\u05de\u05d9\u05d9\u05dd":e+" \u05d9\u05de\u05d9\u05dd"},M:"\u05d7\u05d5\u05d3\u05e9",MM:function(e){return 2===e?"\u05d7\u05d5\u05d3\u05e9\u05d9\u05d9\u05dd":e+" \u05d7\u05d5\u05d3\u05e9\u05d9\u05dd"},y:"\u05e9\u05e0\u05d4",yy:function(e){return 2===e?"\u05e9\u05e0\u05ea\u05d9\u05d9\u05dd":e%10==0&&10!==e?e+" \u05e9\u05e0\u05d4":e+" \u05e9\u05e0\u05d9\u05dd"}},meridiemParse:/\u05d0\u05d7\u05d4"\u05e6|\u05dc\u05e4\u05e0\u05d4"\u05e6|\u05d0\u05d7\u05e8\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd|\u05dc\u05e4\u05e0\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd|\u05dc\u05e4\u05e0\u05d5\u05ea \u05d1\u05d5\u05e7\u05e8|\u05d1\u05d1\u05d5\u05e7\u05e8|\u05d1\u05e2\u05e8\u05d1/i,isPM:function(e){return/^(\u05d0\u05d7\u05d4"\u05e6|\u05d0\u05d7\u05e8\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd|\u05d1\u05e2\u05e8\u05d1)$/.test(e)},meridiem:function(e,t,n){return e<5?"\u05dc\u05e4\u05e0\u05d5\u05ea \u05d1\u05d5\u05e7\u05e8":e<10?"\u05d1\u05d1\u05d5\u05e7\u05e8":e<12?n?'\u05dc\u05e4\u05e0\u05d4"\u05e6':"\u05dc\u05e4\u05e0\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd":e<18?n?'\u05d0\u05d7\u05d4"\u05e6':"\u05d0\u05d7\u05e8\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd":"\u05d1\u05e2\u05e8\u05d1"}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0967",2:"\u0968",3:"\u0969",4:"\u096a",5:"\u096b",6:"\u096c",7:"\u096d",8:"\u096e",9:"\u096f",0:"\u0966"},n={"\u0967":"1","\u0968":"2","\u0969":"3","\u096a":"4","\u096b":"5","\u096c":"6","\u096d":"7","\u096e":"8","\u096f":"9","\u0966":"0"},r=[/^\u091c\u0928/i,/^\u092b\u093c\u0930|\u092b\u0930/i,/^\u092e\u093e\u0930\u094d\u091a/i,/^\u0905\u092a\u094d\u0930\u0948/i,/^\u092e\u0908/i,/^\u091c\u0942\u0928/i,/^\u091c\u0941\u0932/i,/^\u0905\u0917/i,/^\u0938\u093f\u0924\u0902|\u0938\u093f\u0924/i,/^\u0905\u0915\u094d\u091f\u0942/i,/^\u0928\u0935|\u0928\u0935\u0902/i,/^\u0926\u093f\u0938\u0902|\u0926\u093f\u0938/i];e.defineLocale("hi",{months:{format:"\u091c\u0928\u0935\u0930\u0940_\u092b\u093c\u0930\u0935\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u0948\u0932_\u092e\u0908_\u091c\u0942\u0928_\u091c\u0941\u0932\u093e\u0908_\u0905\u0917\u0938\u094d\u0924_\u0938\u093f\u0924\u092e\u094d\u092c\u0930_\u0905\u0915\u094d\u091f\u0942\u092c\u0930_\u0928\u0935\u092e\u094d\u092c\u0930_\u0926\u093f\u0938\u092e\u094d\u092c\u0930".split("_"),standalone:"\u091c\u0928\u0935\u0930\u0940_\u092b\u0930\u0935\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u0948\u0932_\u092e\u0908_\u091c\u0942\u0928_\u091c\u0941\u0932\u093e\u0908_\u0905\u0917\u0938\u094d\u0924_\u0938\u093f\u0924\u0902\u092c\u0930_\u0905\u0915\u094d\u091f\u0942\u092c\u0930_\u0928\u0935\u0902\u092c\u0930_\u0926\u093f\u0938\u0902\u092c\u0930".split("_")},monthsShort:"\u091c\u0928._\u092b\u093c\u0930._\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u0948._\u092e\u0908_\u091c\u0942\u0928_\u091c\u0941\u0932._\u0905\u0917._\u0938\u093f\u0924._\u0905\u0915\u094d\u091f\u0942._\u0928\u0935._\u0926\u093f\u0938.".split("_"),weekdays:"\u0930\u0935\u093f\u0935\u093e\u0930_\u0938\u094b\u092e\u0935\u093e\u0930_\u092e\u0902\u0917\u0932\u0935\u093e\u0930_\u092c\u0941\u0927\u0935\u093e\u0930_\u0917\u0941\u0930\u0942\u0935\u093e\u0930_\u0936\u0941\u0915\u094d\u0930\u0935\u093e\u0930_\u0936\u0928\u093f\u0935\u093e\u0930".split("_"),weekdaysShort:"\u0930\u0935\u093f_\u0938\u094b\u092e_\u092e\u0902\u0917\u0932_\u092c\u0941\u0927_\u0917\u0941\u0930\u0942_\u0936\u0941\u0915\u094d\u0930_\u0936\u0928\u093f".split("_"),weekdaysMin:"\u0930_\u0938\u094b_\u092e\u0902_\u092c\u0941_\u0917\u0941_\u0936\u0941_\u0936".split("_"),longDateFormat:{LT:"A h:mm \u092c\u091c\u0947",LTS:"A h:mm:ss \u092c\u091c\u0947",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u092c\u091c\u0947",LLLL:"dddd, D MMMM YYYY, A h:mm \u092c\u091c\u0947"},monthsParse:r,longMonthsParse:r,shortMonthsParse:[/^\u091c\u0928/i,/^\u092b\u093c\u0930/i,/^\u092e\u093e\u0930\u094d\u091a/i,/^\u0905\u092a\u094d\u0930\u0948/i,/^\u092e\u0908/i,/^\u091c\u0942\u0928/i,/^\u091c\u0941\u0932/i,/^\u0905\u0917/i,/^\u0938\u093f\u0924/i,/^\u0905\u0915\u094d\u091f\u0942/i,/^\u0928\u0935/i,/^\u0926\u093f\u0938/i],monthsRegex:/^(\u091c\u0928\u0935\u0930\u0940|\u091c\u0928\.?|\u092b\u093c\u0930\u0935\u0930\u0940|\u092b\u0930\u0935\u0930\u0940|\u092b\u093c\u0930\.?|\u092e\u093e\u0930\u094d\u091a?|\u0905\u092a\u094d\u0930\u0948\u0932|\u0905\u092a\u094d\u0930\u0948\.?|\u092e\u0908?|\u091c\u0942\u0928?|\u091c\u0941\u0932\u093e\u0908|\u091c\u0941\u0932\.?|\u0905\u0917\u0938\u094d\u0924|\u0905\u0917\.?|\u0938\u093f\u0924\u092e\u094d\u092c\u0930|\u0938\u093f\u0924\u0902\u092c\u0930|\u0938\u093f\u0924\.?|\u0905\u0915\u094d\u091f\u0942\u092c\u0930|\u0905\u0915\u094d\u091f\u0942\.?|\u0928\u0935\u092e\u094d\u092c\u0930|\u0928\u0935\u0902\u092c\u0930|\u0928\u0935\.?|\u0926\u093f\u0938\u092e\u094d\u092c\u0930|\u0926\u093f\u0938\u0902\u092c\u0930|\u0926\u093f\u0938\.?)/i,monthsShortRegex:/^(\u091c\u0928\u0935\u0930\u0940|\u091c\u0928\.?|\u092b\u093c\u0930\u0935\u0930\u0940|\u092b\u0930\u0935\u0930\u0940|\u092b\u093c\u0930\.?|\u092e\u093e\u0930\u094d\u091a?|\u0905\u092a\u094d\u0930\u0948\u0932|\u0905\u092a\u094d\u0930\u0948\.?|\u092e\u0908?|\u091c\u0942\u0928?|\u091c\u0941\u0932\u093e\u0908|\u091c\u0941\u0932\.?|\u0905\u0917\u0938\u094d\u0924|\u0905\u0917\.?|\u0938\u093f\u0924\u092e\u094d\u092c\u0930|\u0938\u093f\u0924\u0902\u092c\u0930|\u0938\u093f\u0924\.?|\u0905\u0915\u094d\u091f\u0942\u092c\u0930|\u0905\u0915\u094d\u091f\u0942\.?|\u0928\u0935\u092e\u094d\u092c\u0930|\u0928\u0935\u0902\u092c\u0930|\u0928\u0935\.?|\u0926\u093f\u0938\u092e\u094d\u092c\u0930|\u0926\u093f\u0938\u0902\u092c\u0930|\u0926\u093f\u0938\.?)/i,monthsStrictRegex:/^(\u091c\u0928\u0935\u0930\u0940?|\u092b\u093c\u0930\u0935\u0930\u0940|\u092b\u0930\u0935\u0930\u0940?|\u092e\u093e\u0930\u094d\u091a?|\u0905\u092a\u094d\u0930\u0948\u0932?|\u092e\u0908?|\u091c\u0942\u0928?|\u091c\u0941\u0932\u093e\u0908?|\u0905\u0917\u0938\u094d\u0924?|\u0938\u093f\u0924\u092e\u094d\u092c\u0930|\u0938\u093f\u0924\u0902\u092c\u0930|\u0938\u093f\u0924?\.?|\u0905\u0915\u094d\u091f\u0942\u092c\u0930|\u0905\u0915\u094d\u091f\u0942\.?|\u0928\u0935\u092e\u094d\u092c\u0930|\u0928\u0935\u0902\u092c\u0930?|\u0926\u093f\u0938\u092e\u094d\u092c\u0930|\u0926\u093f\u0938\u0902\u092c\u0930?)/i,monthsShortStrictRegex:/^(\u091c\u0928\.?|\u092b\u093c\u0930\.?|\u092e\u093e\u0930\u094d\u091a?|\u0905\u092a\u094d\u0930\u0948\.?|\u092e\u0908?|\u091c\u0942\u0928?|\u091c\u0941\u0932\.?|\u0905\u0917\.?|\u0938\u093f\u0924\.?|\u0905\u0915\u094d\u091f\u0942\.?|\u0928\u0935\.?|\u0926\u093f\u0938\.?)/i,calendar:{sameDay:"[\u0906\u091c] LT",nextDay:"[\u0915\u0932] LT",nextWeek:"dddd, LT",lastDay:"[\u0915\u0932] LT",lastWeek:"[\u092a\u093f\u091b\u0932\u0947] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u092e\u0947\u0902",past:"%s \u092a\u0939\u0932\u0947",s:"\u0915\u0941\u091b \u0939\u0940 \u0915\u094d\u0937\u0923",ss:"%d \u0938\u0947\u0915\u0902\u0921",m:"\u090f\u0915 \u092e\u093f\u0928\u091f",mm:"%d \u092e\u093f\u0928\u091f",h:"\u090f\u0915 \u0918\u0902\u091f\u093e",hh:"%d \u0918\u0902\u091f\u0947",d:"\u090f\u0915 \u0926\u093f\u0928",dd:"%d \u0926\u093f\u0928",M:"\u090f\u0915 \u092e\u0939\u0940\u0928\u0947",MM:"%d \u092e\u0939\u0940\u0928\u0947",y:"\u090f\u0915 \u0935\u0930\u094d\u0937",yy:"%d \u0935\u0930\u094d\u0937"},preparse:function(e){return e.replace(/[\u0967\u0968\u0969\u096a\u096b\u096c\u096d\u096e\u096f\u0966]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u0930\u093e\u0924|\u0938\u0941\u092c\u0939|\u0926\u094b\u092a\u0939\u0930|\u0936\u093e\u092e/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0930\u093e\u0924"===t?e<4?e:e+12:"\u0938\u0941\u092c\u0939"===t?e:"\u0926\u094b\u092a\u0939\u0930"===t?e>=10?e:e+12:"\u0936\u093e\u092e"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"\u0930\u093e\u0924":e<10?"\u0938\u0941\u092c\u0939":e<17?"\u0926\u094b\u092a\u0939\u0930":e<20?"\u0936\u093e\u092e":"\u0930\u093e\u0924"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n){var r=e+" ";switch(n){case"ss":return r+(1===e?"sekunda":2===e||3===e||4===e?"sekunde":"sekundi");case"m":return t?"jedna minuta":"jedne minute";case"mm":return r+(1===e?"minuta":2===e||3===e||4===e?"minute":"minuta");case"h":return t?"jedan sat":"jednog sata";case"hh":return r+(1===e?"sat":2===e||3===e||4===e?"sata":"sati");case"dd":return r+(1===e?"dan":"dana");case"MM":return r+(1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci");case"yy":return r+(1===e?"godina":2===e||3===e||4===e?"godine":"godina")}}e.defineLocale("hr",{months:{format:"sije\u010dnja_velja\u010de_o\u017eujka_travnja_svibnja_lipnja_srpnja_kolovoza_rujna_listopada_studenoga_prosinca".split("_"),standalone:"sije\u010danj_velja\u010da_o\u017eujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_")},monthsShort:"sij._velj._o\u017eu._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_\u010detvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._\u010det._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_\u010de_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"Do MMMM YYYY",LLL:"Do MMMM YYYY H:mm",LLLL:"dddd, Do MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[ju\u010der u] LT",lastWeek:function(){switch(this.day()){case 0:return"[pro\u0161lu] [nedjelju] [u] LT";case 3:return"[pro\u0161lu] [srijedu] [u] LT";case 6:return"[pro\u0161le] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[pro\u0161li] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:t,m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){var t="vas\xe1rnap h\xe9tf\u0151n kedden szerd\xe1n cs\xfct\xf6rt\xf6k\xf6n p\xe9nteken szombaton".split(" ");function n(e,t,n,r){var i=e;switch(n){case"s":return r||t?"n\xe9h\xe1ny m\xe1sodperc":"n\xe9h\xe1ny m\xe1sodperce";case"ss":return i+(r||t)?" m\xe1sodperc":" m\xe1sodperce";case"m":return"egy"+(r||t?" perc":" perce");case"mm":return i+(r||t?" perc":" perce");case"h":return"egy"+(r||t?" \xf3ra":" \xf3r\xe1ja");case"hh":return i+(r||t?" \xf3ra":" \xf3r\xe1ja");case"d":return"egy"+(r||t?" nap":" napja");case"dd":return i+(r||t?" nap":" napja");case"M":return"egy"+(r||t?" h\xf3nap":" h\xf3napja");case"MM":return i+(r||t?" h\xf3nap":" h\xf3napja");case"y":return"egy"+(r||t?" \xe9v":" \xe9ve");case"yy":return i+(r||t?" \xe9v":" \xe9ve")}return""}function r(e){return(e?"":"[m\xfalt] ")+"["+t[this.day()]+"] LT[-kor]"}e.defineLocale("hu",{months:"janu\xe1r_febru\xe1r_m\xe1rcius_\xe1prilis_m\xe1jus_j\xfanius_j\xfalius_augusztus_szeptember_okt\xf3ber_november_december".split("_"),monthsShort:"jan._feb._m\xe1rc._\xe1pr._m\xe1j._j\xfan._j\xfal._aug._szept._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"vas\xe1rnap_h\xe9tf\u0151_kedd_szerda_cs\xfct\xf6rt\xf6k_p\xe9ntek_szombat".split("_"),weekdaysShort:"vas_h\xe9t_kedd_sze_cs\xfct_p\xe9n_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D. H:mm",LLLL:"YYYY. MMMM D., dddd H:mm"},meridiemParse:/de|du/i,isPM:function(e){return"u"===e.charAt(1).toLowerCase()},meridiem:function(e,t,n){return e<12?!0===n?"de":"DE":!0===n?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return r.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return r.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s m\xfalva",past:"%s",s:n,ss:n,m:n,mm:n,h:n,hh:n,d:n,dd:n,M:n,MM:n,y:n,yy:n},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("hy-am",{months:{format:"\u0570\u0578\u0582\u0576\u057e\u0561\u0580\u056b_\u0583\u0565\u057f\u0580\u057e\u0561\u0580\u056b_\u0574\u0561\u0580\u057f\u056b_\u0561\u057a\u0580\u056b\u056c\u056b_\u0574\u0561\u0575\u056b\u057d\u056b_\u0570\u0578\u0582\u0576\u056b\u057d\u056b_\u0570\u0578\u0582\u056c\u056b\u057d\u056b_\u0585\u0563\u0578\u057d\u057f\u0578\u057d\u056b_\u057d\u0565\u057a\u057f\u0565\u0574\u0562\u0565\u0580\u056b_\u0570\u0578\u056f\u057f\u0565\u0574\u0562\u0565\u0580\u056b_\u0576\u0578\u0575\u0565\u0574\u0562\u0565\u0580\u056b_\u0564\u0565\u056f\u057f\u0565\u0574\u0562\u0565\u0580\u056b".split("_"),standalone:"\u0570\u0578\u0582\u0576\u057e\u0561\u0580_\u0583\u0565\u057f\u0580\u057e\u0561\u0580_\u0574\u0561\u0580\u057f_\u0561\u057a\u0580\u056b\u056c_\u0574\u0561\u0575\u056b\u057d_\u0570\u0578\u0582\u0576\u056b\u057d_\u0570\u0578\u0582\u056c\u056b\u057d_\u0585\u0563\u0578\u057d\u057f\u0578\u057d_\u057d\u0565\u057a\u057f\u0565\u0574\u0562\u0565\u0580_\u0570\u0578\u056f\u057f\u0565\u0574\u0562\u0565\u0580_\u0576\u0578\u0575\u0565\u0574\u0562\u0565\u0580_\u0564\u0565\u056f\u057f\u0565\u0574\u0562\u0565\u0580".split("_")},monthsShort:"\u0570\u0576\u057e_\u0583\u057f\u0580_\u0574\u0580\u057f_\u0561\u057a\u0580_\u0574\u0575\u057d_\u0570\u0576\u057d_\u0570\u056c\u057d_\u0585\u0563\u057d_\u057d\u057a\u057f_\u0570\u056f\u057f_\u0576\u0574\u0562_\u0564\u056f\u057f".split("_"),weekdays:"\u056f\u056b\u0580\u0561\u056f\u056b_\u0565\u0580\u056f\u0578\u0582\u0577\u0561\u0562\u0569\u056b_\u0565\u0580\u0565\u0584\u0577\u0561\u0562\u0569\u056b_\u0579\u0578\u0580\u0565\u0584\u0577\u0561\u0562\u0569\u056b_\u0570\u056b\u0576\u0563\u0577\u0561\u0562\u0569\u056b_\u0578\u0582\u0580\u0562\u0561\u0569_\u0577\u0561\u0562\u0561\u0569".split("_"),weekdaysShort:"\u056f\u0580\u056f_\u0565\u0580\u056f_\u0565\u0580\u0584_\u0579\u0580\u0584_\u0570\u0576\u0563_\u0578\u0582\u0580\u0562_\u0577\u0562\u0569".split("_"),weekdaysMin:"\u056f\u0580\u056f_\u0565\u0580\u056f_\u0565\u0580\u0584_\u0579\u0580\u0584_\u0570\u0576\u0563_\u0578\u0582\u0580\u0562_\u0577\u0562\u0569".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY \u0569.",LLL:"D MMMM YYYY \u0569., HH:mm",LLLL:"dddd, D MMMM YYYY \u0569., HH:mm"},calendar:{sameDay:"[\u0561\u0575\u057d\u0585\u0580] LT",nextDay:"[\u057e\u0561\u0572\u0568] LT",lastDay:"[\u0565\u0580\u0565\u056f] LT",nextWeek:function(){return"dddd [\u0585\u0580\u0568 \u056a\u0561\u0574\u0568] LT"},lastWeek:function(){return"[\u0561\u0576\u0581\u0561\u056e] dddd [\u0585\u0580\u0568 \u056a\u0561\u0574\u0568] LT"},sameElse:"L"},relativeTime:{future:"%s \u0570\u0565\u057f\u0578",past:"%s \u0561\u057c\u0561\u057b",s:"\u0574\u056b \u0584\u0561\u0576\u056b \u057e\u0561\u0575\u0580\u056f\u0575\u0561\u0576",ss:"%d \u057e\u0561\u0575\u0580\u056f\u0575\u0561\u0576",m:"\u0580\u0578\u057a\u0565",mm:"%d \u0580\u0578\u057a\u0565",h:"\u056a\u0561\u0574",hh:"%d \u056a\u0561\u0574",d:"\u0585\u0580",dd:"%d \u0585\u0580",M:"\u0561\u0574\u056b\u057d",MM:"%d \u0561\u0574\u056b\u057d",y:"\u057f\u0561\u0580\u056b",yy:"%d \u057f\u0561\u0580\u056b"},meridiemParse:/\u0563\u056b\u0577\u0565\u0580\u057e\u0561|\u0561\u057c\u0561\u057e\u0578\u057f\u057e\u0561|\u0581\u0565\u0580\u0565\u056f\u057e\u0561|\u0565\u0580\u0565\u056f\u0578\u0575\u0561\u0576/,isPM:function(e){return/^(\u0581\u0565\u0580\u0565\u056f\u057e\u0561|\u0565\u0580\u0565\u056f\u0578\u0575\u0561\u0576)$/.test(e)},meridiem:function(e){return e<4?"\u0563\u056b\u0577\u0565\u0580\u057e\u0561":e<12?"\u0561\u057c\u0561\u057e\u0578\u057f\u057e\u0561":e<17?"\u0581\u0565\u0580\u0565\u056f\u057e\u0561":"\u0565\u0580\u0565\u056f\u0578\u0575\u0561\u0576"},dayOfMonthOrdinalParse:/\d{1,2}|\d{1,2}-(\u056b\u0576|\u0580\u0564)/,ordinal:function(e,t){switch(t){case"DDD":case"w":case"W":case"DDDo":return 1===e?e+"-\u056b\u0576":e+"-\u0580\u0564";default:return e}},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"siang"===t?e>=11?e:e+12:"sore"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,n){return e<11?"pagi":e<15?"siang":e<19?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",ss:"%d detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){function t(e){return e%100==11||e%10!=1}function n(e,n,r,i){var a=e+" ";switch(r){case"s":return n||i?"nokkrar sek\xfandur":"nokkrum sek\xfandum";case"ss":return t(e)?a+(n||i?"sek\xfandur":"sek\xfandum"):a+"sek\xfanda";case"m":return n?"m\xedn\xfata":"m\xedn\xfatu";case"mm":return t(e)?a+(n||i?"m\xedn\xfatur":"m\xedn\xfatum"):n?a+"m\xedn\xfata":a+"m\xedn\xfatu";case"hh":return t(e)?a+(n||i?"klukkustundir":"klukkustundum"):a+"klukkustund";case"d":return n?"dagur":i?"dag":"degi";case"dd":return t(e)?n?a+"dagar":a+(i?"daga":"d\xf6gum"):n?a+"dagur":a+(i?"dag":"degi");case"M":return n?"m\xe1nu\xf0ur":i?"m\xe1nu\xf0":"m\xe1nu\xf0i";case"MM":return t(e)?n?a+"m\xe1nu\xf0ir":a+(i?"m\xe1nu\xf0i":"m\xe1nu\xf0um"):n?a+"m\xe1nu\xf0ur":a+(i?"m\xe1nu\xf0":"m\xe1nu\xf0i");case"y":return n||i?"\xe1r":"\xe1ri";case"yy":return t(e)?a+(n||i?"\xe1r":"\xe1rum"):a+(n||i?"\xe1r":"\xe1ri")}}e.defineLocale("is",{months:"jan\xfaar_febr\xfaar_mars_apr\xedl_ma\xed_j\xfan\xed_j\xfal\xed_\xe1g\xfast_september_okt\xf3ber_n\xf3vember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma\xed_j\xfan_j\xfal_\xe1g\xfa_sep_okt_n\xf3v_des".split("_"),weekdays:"sunnudagur_m\xe1nudagur_\xferi\xf0judagur_mi\xf0vikudagur_fimmtudagur_f\xf6studagur_laugardagur".split("_"),weekdaysShort:"sun_m\xe1n_\xferi_mi\xf0_fim_f\xf6s_lau".split("_"),weekdaysMin:"Su_M\xe1_\xder_Mi_Fi_F\xf6_La".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd, D. MMMM YYYY [kl.] H:mm"},calendar:{sameDay:"[\xed dag kl.] LT",nextDay:"[\xe1 morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[\xed g\xe6r kl.] LT",lastWeek:"[s\xed\xf0asta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s s\xed\xf0an",s:n,ss:n,m:n,mm:n,h:"klukkustund",hh:n,d:n,dd:n,M:n,MM:n,y:n,yy:n},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned\xec_marted\xec_mercoled\xec_gioved\xec_venerd\xec_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:function(){return"[Oggi a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextDay:function(){return"[Domani a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextWeek:function(){return"dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastDay:function(){return"[Ieri a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastWeek:function(){switch(this.day()){case 0:return"[La scorsa] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT";default:return"[Lo scorso] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"}},sameElse:"L"},relativeTime:{future:"tra %s",past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",w:"una settimana",ww:"%d settimane",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("it-ch",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned\xec_marted\xec_mercoled\xec_gioved\xec_venerd\xec_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(e){return(/^[0-9].+$/.test(e)?"tra":"in")+" "+e},past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ja",{eras:[{since:"2019-05-01",offset:1,name:"\u4ee4\u548c",narrow:"\u32ff",abbr:"R"},{since:"1989-01-08",until:"2019-04-30",offset:1,name:"\u5e73\u6210",narrow:"\u337b",abbr:"H"},{since:"1926-12-25",until:"1989-01-07",offset:1,name:"\u662d\u548c",narrow:"\u337c",abbr:"S"},{since:"1912-07-30",until:"1926-12-24",offset:1,name:"\u5927\u6b63",narrow:"\u337d",abbr:"T"},{since:"1873-01-01",until:"1912-07-29",offset:6,name:"\u660e\u6cbb",narrow:"\u337e",abbr:"M"},{since:"0001-01-01",until:"1873-12-31",offset:1,name:"\u897f\u66a6",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"\u7d00\u5143\u524d",narrow:"BC",abbr:"BC"}],eraYearOrdinalRegex:/(\u5143|\d+)\u5e74/,eraYearOrdinalParse:function(e,t){return"\u5143"===t[1]?1:parseInt(t[1]||e,10)},months:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u65e5\u66dc\u65e5_\u6708\u66dc\u65e5_\u706b\u66dc\u65e5_\u6c34\u66dc\u65e5_\u6728\u66dc\u65e5_\u91d1\u66dc\u65e5_\u571f\u66dc\u65e5".split("_"),weekdaysShort:"\u65e5_\u6708_\u706b_\u6c34_\u6728_\u91d1_\u571f".split("_"),weekdaysMin:"\u65e5_\u6708_\u706b_\u6c34_\u6728_\u91d1_\u571f".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5 HH:mm",LLLL:"YYYY\u5e74M\u6708D\u65e5 dddd HH:mm",l:"YYYY/MM/DD",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5(ddd) HH:mm"},meridiemParse:/\u5348\u524d|\u5348\u5f8c/i,isPM:function(e){return"\u5348\u5f8c"===e},meridiem:function(e,t,n){return e<12?"\u5348\u524d":"\u5348\u5f8c"},calendar:{sameDay:"[\u4eca\u65e5] LT",nextDay:"[\u660e\u65e5] LT",nextWeek:function(e){return e.week()!==this.week()?"[\u6765\u9031]dddd LT":"dddd LT"},lastDay:"[\u6628\u65e5] LT",lastWeek:function(e){return this.week()!==e.week()?"[\u5148\u9031]dddd LT":"dddd LT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}\u65e5/,ordinal:function(e,t){switch(t){case"y":return 1===e?"\u5143\u5e74":e+"\u5e74";case"d":case"D":case"DDD":return e+"\u65e5";default:return e}},relativeTime:{future:"%s\u5f8c",past:"%s\u524d",s:"\u6570\u79d2",ss:"%d\u79d2",m:"1\u5206",mm:"%d\u5206",h:"1\u6642\u9593",hh:"%d\u6642\u9593",d:"1\u65e5",dd:"%d\u65e5",M:"1\u30f6\u6708",MM:"%d\u30f6\u6708",y:"1\u5e74",yy:"%d\u5e74"}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("jv",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_Nopember_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nop_Des".split("_"),weekdays:"Minggu_Senen_Seloso_Rebu_Kemis_Jemuwah_Septu".split("_"),weekdaysShort:"Min_Sen_Sel_Reb_Kem_Jem_Sep".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sp".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/enjing|siyang|sonten|ndalu/,meridiemHour:function(e,t){return 12===e&&(e=0),"enjing"===t?e:"siyang"===t?e>=11?e:e+12:"sonten"===t||"ndalu"===t?e+12:void 0},meridiem:function(e,t,n){return e<11?"enjing":e<15?"siyang":e<19?"sonten":"ndalu"},calendar:{sameDay:"[Dinten puniko pukul] LT",nextDay:"[Mbenjang pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kala wingi pukul] LT",lastWeek:"dddd [kepengker pukul] LT",sameElse:"L"},relativeTime:{future:"wonten ing %s",past:"%s ingkang kepengker",s:"sawetawis detik",ss:"%d detik",m:"setunggal menit",mm:"%d menit",h:"setunggal jam",hh:"%d jam",d:"sedinten",dd:"%d dinten",M:"sewulan",MM:"%d wulan",y:"setaun",yy:"%d taun"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ka",{months:"\u10d8\u10d0\u10dc\u10d5\u10d0\u10e0\u10d8_\u10d7\u10d4\u10d1\u10d4\u10e0\u10d5\u10d0\u10da\u10d8_\u10db\u10d0\u10e0\u10e2\u10d8_\u10d0\u10de\u10e0\u10d8\u10da\u10d8_\u10db\u10d0\u10d8\u10e1\u10d8_\u10d8\u10d5\u10dc\u10d8\u10e1\u10d8_\u10d8\u10d5\u10da\u10d8\u10e1\u10d8_\u10d0\u10d2\u10d5\u10d8\u10e1\u10e2\u10dd_\u10e1\u10d4\u10e5\u10e2\u10d4\u10db\u10d1\u10d4\u10e0\u10d8_\u10dd\u10e5\u10e2\u10dd\u10db\u10d1\u10d4\u10e0\u10d8_\u10dc\u10dd\u10d4\u10db\u10d1\u10d4\u10e0\u10d8_\u10d3\u10d4\u10d9\u10d4\u10db\u10d1\u10d4\u10e0\u10d8".split("_"),monthsShort:"\u10d8\u10d0\u10dc_\u10d7\u10d4\u10d1_\u10db\u10d0\u10e0_\u10d0\u10de\u10e0_\u10db\u10d0\u10d8_\u10d8\u10d5\u10dc_\u10d8\u10d5\u10da_\u10d0\u10d2\u10d5_\u10e1\u10d4\u10e5_\u10dd\u10e5\u10e2_\u10dc\u10dd\u10d4_\u10d3\u10d4\u10d9".split("_"),weekdays:{standalone:"\u10d9\u10d5\u10d8\u10e0\u10d0_\u10dd\u10e0\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8_\u10e1\u10d0\u10db\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8_\u10dd\u10d7\u10ee\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8_\u10ee\u10e3\u10d7\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8_\u10de\u10d0\u10e0\u10d0\u10e1\u10d9\u10d4\u10d5\u10d8_\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8".split("_"),format:"\u10d9\u10d5\u10d8\u10e0\u10d0\u10e1_\u10dd\u10e0\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1_\u10e1\u10d0\u10db\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1_\u10dd\u10d7\u10ee\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1_\u10ee\u10e3\u10d7\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1_\u10de\u10d0\u10e0\u10d0\u10e1\u10d9\u10d4\u10d5\u10e1_\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1".split("_"),isFormat:/(\u10ec\u10d8\u10dc\u10d0|\u10e8\u10d4\u10db\u10d3\u10d4\u10d2)/},weekdaysShort:"\u10d9\u10d5\u10d8_\u10dd\u10e0\u10e8_\u10e1\u10d0\u10db_\u10dd\u10d7\u10ee_\u10ee\u10e3\u10d7_\u10de\u10d0\u10e0_\u10e8\u10d0\u10d1".split("_"),weekdaysMin:"\u10d9\u10d5_\u10dd\u10e0_\u10e1\u10d0_\u10dd\u10d7_\u10ee\u10e3_\u10de\u10d0_\u10e8\u10d0".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u10d3\u10e6\u10d4\u10e1] LT[-\u10d6\u10d4]",nextDay:"[\u10ee\u10d5\u10d0\u10da] LT[-\u10d6\u10d4]",lastDay:"[\u10d2\u10e3\u10e8\u10d8\u10dc] LT[-\u10d6\u10d4]",nextWeek:"[\u10e8\u10d4\u10db\u10d3\u10d4\u10d2] dddd LT[-\u10d6\u10d4]",lastWeek:"[\u10ec\u10d8\u10dc\u10d0] dddd LT-\u10d6\u10d4",sameElse:"L"},relativeTime:{future:function(e){return e.replace(/(\u10ec\u10d0\u10db|\u10ec\u10e3\u10d7|\u10e1\u10d0\u10d0\u10d7|\u10ec\u10d4\u10da|\u10d3\u10e6|\u10d7\u10d5)(\u10d8|\u10d4)/,(function(e,t,n){return"\u10d8"===n?t+"\u10e8\u10d8":t+n+"\u10e8\u10d8"}))},past:function(e){return/(\u10ec\u10d0\u10db\u10d8|\u10ec\u10e3\u10d7\u10d8|\u10e1\u10d0\u10d0\u10d7\u10d8|\u10d3\u10e6\u10d4|\u10d7\u10d5\u10d4)/.test(e)?e.replace(/(\u10d8|\u10d4)$/,"\u10d8\u10e1 \u10ec\u10d8\u10dc"):/\u10ec\u10d4\u10da\u10d8/.test(e)?e.replace(/\u10ec\u10d4\u10da\u10d8$/,"\u10ec\u10da\u10d8\u10e1 \u10ec\u10d8\u10dc"):e},s:"\u10e0\u10d0\u10db\u10d3\u10d4\u10dc\u10d8\u10db\u10d4 \u10ec\u10d0\u10db\u10d8",ss:"%d \u10ec\u10d0\u10db\u10d8",m:"\u10ec\u10e3\u10d7\u10d8",mm:"%d \u10ec\u10e3\u10d7\u10d8",h:"\u10e1\u10d0\u10d0\u10d7\u10d8",hh:"%d \u10e1\u10d0\u10d0\u10d7\u10d8",d:"\u10d3\u10e6\u10d4",dd:"%d \u10d3\u10e6\u10d4",M:"\u10d7\u10d5\u10d4",MM:"%d \u10d7\u10d5\u10d4",y:"\u10ec\u10d4\u10da\u10d8",yy:"%d \u10ec\u10d4\u10da\u10d8"},dayOfMonthOrdinalParse:/0|1-\u10da\u10d8|\u10db\u10d4-\d{1,2}|\d{1,2}-\u10d4/,ordinal:function(e){return 0===e?e:1===e?e+"-\u10da\u10d8":e<20||e<=100&&e%20==0||e%100==0?"\u10db\u10d4-"+e:e+"-\u10d4"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){var t={0:"-\u0448\u0456",1:"-\u0448\u0456",2:"-\u0448\u0456",3:"-\u0448\u0456",4:"-\u0448\u0456",5:"-\u0448\u0456",6:"-\u0448\u044b",7:"-\u0448\u0456",8:"-\u0448\u0456",9:"-\u0448\u044b",10:"-\u0448\u044b",20:"-\u0448\u044b",30:"-\u0448\u044b",40:"-\u0448\u044b",50:"-\u0448\u0456",60:"-\u0448\u044b",70:"-\u0448\u0456",80:"-\u0448\u0456",90:"-\u0448\u044b",100:"-\u0448\u0456"};e.defineLocale("kk",{months:"\u049b\u0430\u04a3\u0442\u0430\u0440_\u0430\u049b\u043f\u0430\u043d_\u043d\u0430\u0443\u0440\u044b\u0437_\u0441\u04d9\u0443\u0456\u0440_\u043c\u0430\u043c\u044b\u0440_\u043c\u0430\u0443\u0441\u044b\u043c_\u0448\u0456\u043b\u0434\u0435_\u0442\u0430\u043c\u044b\u0437_\u049b\u044b\u0440\u043a\u04af\u0439\u0435\u043a_\u049b\u0430\u0437\u0430\u043d_\u049b\u0430\u0440\u0430\u0448\u0430_\u0436\u0435\u043b\u0442\u043e\u049b\u0441\u0430\u043d".split("_"),monthsShort:"\u049b\u0430\u04a3_\u0430\u049b\u043f_\u043d\u0430\u0443_\u0441\u04d9\u0443_\u043c\u0430\u043c_\u043c\u0430\u0443_\u0448\u0456\u043b_\u0442\u0430\u043c_\u049b\u044b\u0440_\u049b\u0430\u0437_\u049b\u0430\u0440_\u0436\u0435\u043b".split("_"),weekdays:"\u0436\u0435\u043a\u0441\u0435\u043d\u0431\u0456_\u0434\u04af\u0439\u0441\u0435\u043d\u0431\u0456_\u0441\u0435\u0439\u0441\u0435\u043d\u0431\u0456_\u0441\u04d9\u0440\u0441\u0435\u043d\u0431\u0456_\u0431\u0435\u0439\u0441\u0435\u043d\u0431\u0456_\u0436\u04b1\u043c\u0430_\u0441\u0435\u043d\u0431\u0456".split("_"),weekdaysShort:"\u0436\u0435\u043a_\u0434\u04af\u0439_\u0441\u0435\u0439_\u0441\u04d9\u0440_\u0431\u0435\u0439_\u0436\u04b1\u043c_\u0441\u0435\u043d".split("_"),weekdaysMin:"\u0436\u043a_\u0434\u0439_\u0441\u0439_\u0441\u0440_\u0431\u0439_\u0436\u043c_\u0441\u043d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0411\u04af\u0433\u0456\u043d \u0441\u0430\u0493\u0430\u0442] LT",nextDay:"[\u0415\u0440\u0442\u0435\u04a3 \u0441\u0430\u0493\u0430\u0442] LT",nextWeek:"dddd [\u0441\u0430\u0493\u0430\u0442] LT",lastDay:"[\u041a\u0435\u0448\u0435 \u0441\u0430\u0493\u0430\u0442] LT",lastWeek:"[\u04e8\u0442\u043a\u0435\u043d \u0430\u043f\u0442\u0430\u043d\u044b\u04a3] dddd [\u0441\u0430\u0493\u0430\u0442] LT",sameElse:"L"},relativeTime:{future:"%s \u0456\u0448\u0456\u043d\u0434\u0435",past:"%s \u0431\u04b1\u0440\u044b\u043d",s:"\u0431\u0456\u0440\u043d\u0435\u0448\u0435 \u0441\u0435\u043a\u0443\u043d\u0434",ss:"%d \u0441\u0435\u043a\u0443\u043d\u0434",m:"\u0431\u0456\u0440 \u043c\u0438\u043d\u0443\u0442",mm:"%d \u043c\u0438\u043d\u0443\u0442",h:"\u0431\u0456\u0440 \u0441\u0430\u0493\u0430\u0442",hh:"%d \u0441\u0430\u0493\u0430\u0442",d:"\u0431\u0456\u0440 \u043a\u04af\u043d",dd:"%d \u043a\u04af\u043d",M:"\u0431\u0456\u0440 \u0430\u0439",MM:"%d \u0430\u0439",y:"\u0431\u0456\u0440 \u0436\u044b\u043b",yy:"%d \u0436\u044b\u043b"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0448\u0456|\u0448\u044b)/,ordinal:function(e){return e+(t[e]||t[e%10]||t[e>=100?100:null])},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u17e1",2:"\u17e2",3:"\u17e3",4:"\u17e4",5:"\u17e5",6:"\u17e6",7:"\u17e7",8:"\u17e8",9:"\u17e9",0:"\u17e0"},n={"\u17e1":"1","\u17e2":"2","\u17e3":"3","\u17e4":"4","\u17e5":"5","\u17e6":"6","\u17e7":"7","\u17e8":"8","\u17e9":"9","\u17e0":"0"};e.defineLocale("km",{months:"\u1798\u1780\u179a\u17b6_\u1780\u17bb\u1798\u17d2\u1797\u17c8_\u1798\u17b8\u1793\u17b6_\u1798\u17c1\u179f\u17b6_\u17a7\u179f\u1797\u17b6_\u1798\u17b7\u1790\u17bb\u1793\u17b6_\u1780\u1780\u17d2\u1780\u178a\u17b6_\u179f\u17b8\u17a0\u17b6_\u1780\u1789\u17d2\u1789\u17b6_\u178f\u17bb\u179b\u17b6_\u179c\u17b7\u1785\u17d2\u1786\u17b7\u1780\u17b6_\u1792\u17d2\u1793\u17bc".split("_"),monthsShort:"\u1798\u1780\u179a\u17b6_\u1780\u17bb\u1798\u17d2\u1797\u17c8_\u1798\u17b8\u1793\u17b6_\u1798\u17c1\u179f\u17b6_\u17a7\u179f\u1797\u17b6_\u1798\u17b7\u1790\u17bb\u1793\u17b6_\u1780\u1780\u17d2\u1780\u178a\u17b6_\u179f\u17b8\u17a0\u17b6_\u1780\u1789\u17d2\u1789\u17b6_\u178f\u17bb\u179b\u17b6_\u179c\u17b7\u1785\u17d2\u1786\u17b7\u1780\u17b6_\u1792\u17d2\u1793\u17bc".split("_"),weekdays:"\u17a2\u17b6\u1791\u17b7\u178f\u17d2\u1799_\u1785\u17d0\u1793\u17d2\u1791_\u17a2\u1784\u17d2\u1782\u17b6\u179a_\u1796\u17bb\u1792_\u1796\u17d2\u179a\u17a0\u179f\u17d2\u1794\u178f\u17b7\u17cd_\u179f\u17bb\u1780\u17d2\u179a_\u179f\u17c5\u179a\u17cd".split("_"),weekdaysShort:"\u17a2\u17b6_\u1785_\u17a2_\u1796_\u1796\u17d2\u179a_\u179f\u17bb_\u179f".split("_"),weekdaysMin:"\u17a2\u17b6_\u1785_\u17a2_\u1796_\u1796\u17d2\u179a_\u179f\u17bb_\u179f".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/\u1796\u17d2\u179a\u17b9\u1780|\u179b\u17d2\u1784\u17b6\u1785/,isPM:function(e){return"\u179b\u17d2\u1784\u17b6\u1785"===e},meridiem:function(e,t,n){return e<12?"\u1796\u17d2\u179a\u17b9\u1780":"\u179b\u17d2\u1784\u17b6\u1785"},calendar:{sameDay:"[\u1790\u17d2\u1784\u17c3\u1793\u17c1\u17c7 \u1798\u17c9\u17c4\u1784] LT",nextDay:"[\u179f\u17d2\u17a2\u17c2\u1780 \u1798\u17c9\u17c4\u1784] LT",nextWeek:"dddd [\u1798\u17c9\u17c4\u1784] LT",lastDay:"[\u1798\u17d2\u179f\u17b7\u179b\u1798\u17b7\u1789 \u1798\u17c9\u17c4\u1784] LT",lastWeek:"dddd [\u179f\u1794\u17d2\u178f\u17b6\u17a0\u17cd\u1798\u17bb\u1793] [\u1798\u17c9\u17c4\u1784] LT",sameElse:"L"},relativeTime:{future:"%s\u1791\u17c0\u178f",past:"%s\u1798\u17bb\u1793",s:"\u1794\u17c9\u17bb\u1793\u17d2\u1798\u17b6\u1793\u179c\u17b7\u1793\u17b6\u1791\u17b8",ss:"%d \u179c\u17b7\u1793\u17b6\u1791\u17b8",m:"\u1798\u17bd\u1799\u1793\u17b6\u1791\u17b8",mm:"%d \u1793\u17b6\u1791\u17b8",h:"\u1798\u17bd\u1799\u1798\u17c9\u17c4\u1784",hh:"%d \u1798\u17c9\u17c4\u1784",d:"\u1798\u17bd\u1799\u1790\u17d2\u1784\u17c3",dd:"%d \u1790\u17d2\u1784\u17c3",M:"\u1798\u17bd\u1799\u1781\u17c2",MM:"%d \u1781\u17c2",y:"\u1798\u17bd\u1799\u1786\u17d2\u1793\u17b6\u17c6",yy:"%d \u1786\u17d2\u1793\u17b6\u17c6"},dayOfMonthOrdinalParse:/\u1791\u17b8\d{1,2}/,ordinal:"\u1791\u17b8%d",preparse:function(e){return e.replace(/[\u17e1\u17e2\u17e3\u17e4\u17e5\u17e6\u17e7\u17e8\u17e9\u17e0]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0ce7",2:"\u0ce8",3:"\u0ce9",4:"\u0cea",5:"\u0ceb",6:"\u0cec",7:"\u0ced",8:"\u0cee",9:"\u0cef",0:"\u0ce6"},n={"\u0ce7":"1","\u0ce8":"2","\u0ce9":"3","\u0cea":"4","\u0ceb":"5","\u0cec":"6","\u0ced":"7","\u0cee":"8","\u0cef":"9","\u0ce6":"0"};e.defineLocale("kn",{months:"\u0c9c\u0ca8\u0cb5\u0cb0\u0cbf_\u0cab\u0cc6\u0cac\u0ccd\u0cb0\u0cb5\u0cb0\u0cbf_\u0cae\u0cbe\u0cb0\u0ccd\u0c9a\u0ccd_\u0c8f\u0caa\u0ccd\u0cb0\u0cbf\u0cb2\u0ccd_\u0cae\u0cc6\u0cd5_\u0c9c\u0cc2\u0ca8\u0ccd_\u0c9c\u0cc1\u0cb2\u0cc6\u0cd6_\u0c86\u0c97\u0cb8\u0ccd\u0c9f\u0ccd_\u0cb8\u0cc6\u0caa\u0ccd\u0c9f\u0cc6\u0c82\u0cac\u0cb0\u0ccd_\u0c85\u0c95\u0ccd\u0c9f\u0cc6\u0cc2\u0cd5\u0cac\u0cb0\u0ccd_\u0ca8\u0cb5\u0cc6\u0c82\u0cac\u0cb0\u0ccd_\u0ca1\u0cbf\u0cb8\u0cc6\u0c82\u0cac\u0cb0\u0ccd".split("_"),monthsShort:"\u0c9c\u0ca8_\u0cab\u0cc6\u0cac\u0ccd\u0cb0_\u0cae\u0cbe\u0cb0\u0ccd\u0c9a\u0ccd_\u0c8f\u0caa\u0ccd\u0cb0\u0cbf\u0cb2\u0ccd_\u0cae\u0cc6\u0cd5_\u0c9c\u0cc2\u0ca8\u0ccd_\u0c9c\u0cc1\u0cb2\u0cc6\u0cd6_\u0c86\u0c97\u0cb8\u0ccd\u0c9f\u0ccd_\u0cb8\u0cc6\u0caa\u0ccd\u0c9f\u0cc6\u0c82_\u0c85\u0c95\u0ccd\u0c9f\u0cc6\u0cc2\u0cd5_\u0ca8\u0cb5\u0cc6\u0c82_\u0ca1\u0cbf\u0cb8\u0cc6\u0c82".split("_"),monthsParseExact:!0,weekdays:"\u0cad\u0cbe\u0ca8\u0cc1\u0cb5\u0cbe\u0cb0_\u0cb8\u0cc6\u0cc2\u0cd5\u0cae\u0cb5\u0cbe\u0cb0_\u0cae\u0c82\u0c97\u0cb3\u0cb5\u0cbe\u0cb0_\u0cac\u0cc1\u0ca7\u0cb5\u0cbe\u0cb0_\u0c97\u0cc1\u0cb0\u0cc1\u0cb5\u0cbe\u0cb0_\u0cb6\u0cc1\u0c95\u0ccd\u0cb0\u0cb5\u0cbe\u0cb0_\u0cb6\u0ca8\u0cbf\u0cb5\u0cbe\u0cb0".split("_"),weekdaysShort:"\u0cad\u0cbe\u0ca8\u0cc1_\u0cb8\u0cc6\u0cc2\u0cd5\u0cae_\u0cae\u0c82\u0c97\u0cb3_\u0cac\u0cc1\u0ca7_\u0c97\u0cc1\u0cb0\u0cc1_\u0cb6\u0cc1\u0c95\u0ccd\u0cb0_\u0cb6\u0ca8\u0cbf".split("_"),weekdaysMin:"\u0cad\u0cbe_\u0cb8\u0cc6\u0cc2\u0cd5_\u0cae\u0c82_\u0cac\u0cc1_\u0c97\u0cc1_\u0cb6\u0cc1_\u0cb6".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[\u0c87\u0c82\u0ca6\u0cc1] LT",nextDay:"[\u0ca8\u0cbe\u0cb3\u0cc6] LT",nextWeek:"dddd, LT",lastDay:"[\u0ca8\u0cbf\u0ca8\u0ccd\u0ca8\u0cc6] LT",lastWeek:"[\u0c95\u0cc6\u0cc2\u0ca8\u0cc6\u0caf] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0ca8\u0c82\u0ca4\u0cb0",past:"%s \u0cb9\u0cbf\u0c82\u0ca6\u0cc6",s:"\u0c95\u0cc6\u0cb2\u0cb5\u0cc1 \u0c95\u0ccd\u0cb7\u0ca3\u0c97\u0cb3\u0cc1",ss:"%d \u0cb8\u0cc6\u0c95\u0cc6\u0c82\u0ca1\u0cc1\u0c97\u0cb3\u0cc1",m:"\u0c92\u0c82\u0ca6\u0cc1 \u0ca8\u0cbf\u0cae\u0cbf\u0cb7",mm:"%d \u0ca8\u0cbf\u0cae\u0cbf\u0cb7",h:"\u0c92\u0c82\u0ca6\u0cc1 \u0c97\u0c82\u0c9f\u0cc6",hh:"%d \u0c97\u0c82\u0c9f\u0cc6",d:"\u0c92\u0c82\u0ca6\u0cc1 \u0ca6\u0cbf\u0ca8",dd:"%d \u0ca6\u0cbf\u0ca8",M:"\u0c92\u0c82\u0ca6\u0cc1 \u0ca4\u0cbf\u0c82\u0c97\u0cb3\u0cc1",MM:"%d \u0ca4\u0cbf\u0c82\u0c97\u0cb3\u0cc1",y:"\u0c92\u0c82\u0ca6\u0cc1 \u0cb5\u0cb0\u0ccd\u0cb7",yy:"%d \u0cb5\u0cb0\u0ccd\u0cb7"},preparse:function(e){return e.replace(/[\u0ce7\u0ce8\u0ce9\u0cea\u0ceb\u0cec\u0ced\u0cee\u0cef\u0ce6]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u0cb0\u0cbe\u0ca4\u0ccd\u0cb0\u0cbf|\u0cac\u0cc6\u0cb3\u0cbf\u0c97\u0ccd\u0c97\u0cc6|\u0cae\u0ca7\u0ccd\u0caf\u0cbe\u0cb9\u0ccd\u0ca8|\u0cb8\u0c82\u0c9c\u0cc6/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0cb0\u0cbe\u0ca4\u0ccd\u0cb0\u0cbf"===t?e<4?e:e+12:"\u0cac\u0cc6\u0cb3\u0cbf\u0c97\u0ccd\u0c97\u0cc6"===t?e:"\u0cae\u0ca7\u0ccd\u0caf\u0cbe\u0cb9\u0ccd\u0ca8"===t?e>=10?e:e+12:"\u0cb8\u0c82\u0c9c\u0cc6"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"\u0cb0\u0cbe\u0ca4\u0ccd\u0cb0\u0cbf":e<10?"\u0cac\u0cc6\u0cb3\u0cbf\u0c97\u0ccd\u0c97\u0cc6":e<17?"\u0cae\u0ca7\u0ccd\u0caf\u0cbe\u0cb9\u0ccd\u0ca8":e<20?"\u0cb8\u0c82\u0c9c\u0cc6":"\u0cb0\u0cbe\u0ca4\u0ccd\u0cb0\u0cbf"},dayOfMonthOrdinalParse:/\d{1,2}(\u0ca8\u0cc6\u0cd5)/,ordinal:function(e){return e+"\u0ca8\u0cc6\u0cd5"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ko",{months:"1\uc6d4_2\uc6d4_3\uc6d4_4\uc6d4_5\uc6d4_6\uc6d4_7\uc6d4_8\uc6d4_9\uc6d4_10\uc6d4_11\uc6d4_12\uc6d4".split("_"),monthsShort:"1\uc6d4_2\uc6d4_3\uc6d4_4\uc6d4_5\uc6d4_6\uc6d4_7\uc6d4_8\uc6d4_9\uc6d4_10\uc6d4_11\uc6d4_12\uc6d4".split("_"),weekdays:"\uc77c\uc694\uc77c_\uc6d4\uc694\uc77c_\ud654\uc694\uc77c_\uc218\uc694\uc77c_\ubaa9\uc694\uc77c_\uae08\uc694\uc77c_\ud1a0\uc694\uc77c".split("_"),weekdaysShort:"\uc77c_\uc6d4_\ud654_\uc218_\ubaa9_\uae08_\ud1a0".split("_"),weekdaysMin:"\uc77c_\uc6d4_\ud654_\uc218_\ubaa9_\uae08_\ud1a0".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY\ub144 MMMM D\uc77c",LLL:"YYYY\ub144 MMMM D\uc77c A h:mm",LLLL:"YYYY\ub144 MMMM D\uc77c dddd A h:mm",l:"YYYY.MM.DD.",ll:"YYYY\ub144 MMMM D\uc77c",lll:"YYYY\ub144 MMMM D\uc77c A h:mm",llll:"YYYY\ub144 MMMM D\uc77c dddd A h:mm"},calendar:{sameDay:"\uc624\ub298 LT",nextDay:"\ub0b4\uc77c LT",nextWeek:"dddd LT",lastDay:"\uc5b4\uc81c LT",lastWeek:"\uc9c0\ub09c\uc8fc dddd LT",sameElse:"L"},relativeTime:{future:"%s \ud6c4",past:"%s \uc804",s:"\uba87 \ucd08",ss:"%d\ucd08",m:"1\ubd84",mm:"%d\ubd84",h:"\ud55c \uc2dc\uac04",hh:"%d\uc2dc\uac04",d:"\ud558\ub8e8",dd:"%d\uc77c",M:"\ud55c \ub2ec",MM:"%d\ub2ec",y:"\uc77c \ub144",yy:"%d\ub144"},dayOfMonthOrdinalParse:/\d{1,2}(\uc77c|\uc6d4|\uc8fc)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"\uc77c";case"M":return e+"\uc6d4";case"w":case"W":return e+"\uc8fc";default:return e}},meridiemParse:/\uc624\uc804|\uc624\ud6c4/,isPM:function(e){return"\uc624\ud6c4"===e},meridiem:function(e,t,n){return e<12?"\uc624\uc804":"\uc624\ud6c4"}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0661",2:"\u0662",3:"\u0663",4:"\u0664",5:"\u0665",6:"\u0666",7:"\u0667",8:"\u0668",9:"\u0669",0:"\u0660"},n={"\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9","\u0660":"0"},r=["\u06a9\u0627\u0646\u0648\u0646\u06cc \u062f\u0648\u0648\u06d5\u0645","\u0634\u0648\u0628\u0627\u062a","\u0626\u0627\u0632\u0627\u0631","\u0646\u06cc\u0633\u0627\u0646","\u0626\u0627\u06cc\u0627\u0631","\u062d\u0648\u0632\u06d5\u06cc\u0631\u0627\u0646","\u062a\u06d5\u0645\u0645\u0648\u0632","\u0626\u0627\u0628","\u0626\u06d5\u06cc\u0644\u0648\u0648\u0644","\u062a\u0634\u0631\u06cc\u0646\u06cc \u06cc\u06d5\u0643\u06d5\u0645","\u062a\u0634\u0631\u06cc\u0646\u06cc \u062f\u0648\u0648\u06d5\u0645","\u0643\u0627\u0646\u0648\u0646\u06cc \u06cc\u06d5\u06a9\u06d5\u0645"];e.defineLocale("ku",{months:r,monthsShort:r,weekdays:"\u06cc\u0647\u200c\u0643\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u062f\u0648\u0648\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u0633\u06ce\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u0686\u0648\u0627\u0631\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u067e\u06ce\u0646\u062c\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u0647\u0647\u200c\u06cc\u0646\u06cc_\u0634\u0647\u200c\u0645\u0645\u0647\u200c".split("_"),weekdaysShort:"\u06cc\u0647\u200c\u0643\u0634\u0647\u200c\u0645_\u062f\u0648\u0648\u0634\u0647\u200c\u0645_\u0633\u06ce\u0634\u0647\u200c\u0645_\u0686\u0648\u0627\u0631\u0634\u0647\u200c\u0645_\u067e\u06ce\u0646\u062c\u0634\u0647\u200c\u0645_\u0647\u0647\u200c\u06cc\u0646\u06cc_\u0634\u0647\u200c\u0645\u0645\u0647\u200c".split("_"),weekdaysMin:"\u06cc_\u062f_\u0633_\u0686_\u067e_\u0647_\u0634".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/\u0626\u06ce\u0648\u0627\u0631\u0647\u200c|\u0628\u0647\u200c\u06cc\u0627\u0646\u06cc/,isPM:function(e){return/\u0626\u06ce\u0648\u0627\u0631\u0647\u200c/.test(e)},meridiem:function(e,t,n){return e<12?"\u0628\u0647\u200c\u06cc\u0627\u0646\u06cc":"\u0626\u06ce\u0648\u0627\u0631\u0647\u200c"},calendar:{sameDay:"[\u0626\u0647\u200c\u0645\u0631\u06c6 \u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",nextDay:"[\u0628\u0647\u200c\u06cc\u0627\u0646\u06cc \u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",nextWeek:"dddd [\u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",lastDay:"[\u062f\u0648\u06ce\u0646\u06ce \u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",lastWeek:"dddd [\u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",sameElse:"L"},relativeTime:{future:"\u0644\u0647\u200c %s",past:"%s",s:"\u0686\u0647\u200c\u0646\u062f \u0686\u0631\u0643\u0647\u200c\u06cc\u0647\u200c\u0643",ss:"\u0686\u0631\u0643\u0647\u200c %d",m:"\u06cc\u0647\u200c\u0643 \u062e\u0648\u0644\u0647\u200c\u0643",mm:"%d \u062e\u0648\u0644\u0647\u200c\u0643",h:"\u06cc\u0647\u200c\u0643 \u0643\u0627\u062a\u0698\u0645\u06ce\u0631",hh:"%d \u0643\u0627\u062a\u0698\u0645\u06ce\u0631",d:"\u06cc\u0647\u200c\u0643 \u0695\u06c6\u0698",dd:"%d \u0695\u06c6\u0698",M:"\u06cc\u0647\u200c\u0643 \u0645\u0627\u0646\u06af",MM:"%d \u0645\u0627\u0646\u06af",y:"\u06cc\u0647\u200c\u0643 \u0633\u0627\u06b5",yy:"%d \u0633\u0627\u06b5"},preparse:function(e){return e.replace(/[\u0661\u0662\u0663\u0664\u0665\u0666\u0667\u0668\u0669\u0660]/g,(function(e){return n[e]})).replace(/\u060c/g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"\u060c")},week:{dow:6,doy:12}})}(n(3))},function(e,t,n){!function(e){var t={0:"-\u0447\u04af",1:"-\u0447\u0438",2:"-\u0447\u0438",3:"-\u0447\u04af",4:"-\u0447\u04af",5:"-\u0447\u0438",6:"-\u0447\u044b",7:"-\u0447\u0438",8:"-\u0447\u0438",9:"-\u0447\u0443",10:"-\u0447\u0443",20:"-\u0447\u044b",30:"-\u0447\u0443",40:"-\u0447\u044b",50:"-\u0447\u04af",60:"-\u0447\u044b",70:"-\u0447\u0438",80:"-\u0447\u0438",90:"-\u0447\u0443",100:"-\u0447\u04af"};e.defineLocale("ky",{months:"\u044f\u043d\u0432\u0430\u0440\u044c_\u0444\u0435\u0432\u0440\u0430\u043b\u044c_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0435\u043b\u044c_\u043c\u0430\u0439_\u0438\u044e\u043d\u044c_\u0438\u044e\u043b\u044c_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044c_\u043e\u043a\u0442\u044f\u0431\u0440\u044c_\u043d\u043e\u044f\u0431\u0440\u044c_\u0434\u0435\u043a\u0430\u0431\u0440\u044c".split("_"),monthsShort:"\u044f\u043d\u0432_\u0444\u0435\u0432_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440_\u043c\u0430\u0439_\u0438\u044e\u043d\u044c_\u0438\u044e\u043b\u044c_\u0430\u0432\u0433_\u0441\u0435\u043d_\u043e\u043a\u0442_\u043d\u043e\u044f_\u0434\u0435\u043a".split("_"),weekdays:"\u0416\u0435\u043a\u0448\u0435\u043c\u0431\u0438_\u0414\u04af\u0439\u0448\u04e9\u043c\u0431\u04af_\u0428\u0435\u0439\u0448\u0435\u043c\u0431\u0438_\u0428\u0430\u0440\u0448\u0435\u043c\u0431\u0438_\u0411\u0435\u0439\u0448\u0435\u043c\u0431\u0438_\u0416\u0443\u043c\u0430_\u0418\u0448\u0435\u043c\u0431\u0438".split("_"),weekdaysShort:"\u0416\u0435\u043a_\u0414\u04af\u0439_\u0428\u0435\u0439_\u0428\u0430\u0440_\u0411\u0435\u0439_\u0416\u0443\u043c_\u0418\u0448\u0435".split("_"),weekdaysMin:"\u0416\u043a_\u0414\u0439_\u0428\u0439_\u0428\u0440_\u0411\u0439_\u0416\u043c_\u0418\u0448".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0411\u04af\u0433\u04af\u043d \u0441\u0430\u0430\u0442] LT",nextDay:"[\u042d\u0440\u0442\u0435\u04a3 \u0441\u0430\u0430\u0442] LT",nextWeek:"dddd [\u0441\u0430\u0430\u0442] LT",lastDay:"[\u041a\u0435\u0447\u044d\u044d \u0441\u0430\u0430\u0442] LT",lastWeek:"[\u04e8\u0442\u043a\u04e9\u043d \u0430\u043f\u0442\u0430\u043d\u044b\u043d] dddd [\u043a\u04af\u043d\u04af] [\u0441\u0430\u0430\u0442] LT",sameElse:"L"},relativeTime:{future:"%s \u0438\u0447\u0438\u043d\u0434\u0435",past:"%s \u043c\u0443\u0440\u0443\u043d",s:"\u0431\u0438\u0440\u043d\u0435\u0447\u0435 \u0441\u0435\u043a\u0443\u043d\u0434",ss:"%d \u0441\u0435\u043a\u0443\u043d\u0434",m:"\u0431\u0438\u0440 \u043c\u04af\u043d\u04e9\u0442",mm:"%d \u043c\u04af\u043d\u04e9\u0442",h:"\u0431\u0438\u0440 \u0441\u0430\u0430\u0442",hh:"%d \u0441\u0430\u0430\u0442",d:"\u0431\u0438\u0440 \u043a\u04af\u043d",dd:"%d \u043a\u04af\u043d",M:"\u0431\u0438\u0440 \u0430\u0439",MM:"%d \u0430\u0439",y:"\u0431\u0438\u0440 \u0436\u044b\u043b",yy:"%d \u0436\u044b\u043b"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0447\u0438|\u0447\u044b|\u0447\u04af|\u0447\u0443)/,ordinal:function(e){return e+(t[e]||t[e%10]||t[e>=100?100:null])},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return t?i[n][0]:i[n][1]}function n(e){if(e=parseInt(e,10),isNaN(e))return!1;if(e<0)return!0;if(e<10)return 4<=e&&e<=7;if(e<100){var t=e%10;return n(0===t?e/10:t)}if(e<1e4){for(;e>=10;)e/=10;return n(e)}return n(e/=1e3)}e.defineLocale("lb",{months:"Januar_Februar_M\xe4erz_Abr\xebll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonndeg_M\xe9indeg_D\xebnschdeg_M\xebttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._M\xe9._D\xeb._M\xeb._Do._Fr._Sa.".split("_"),weekdaysMin:"So_M\xe9_D\xeb_M\xeb_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm [Auer]",LTS:"H:mm:ss [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm [Auer]",LLLL:"dddd, D. MMMM YYYY H:mm [Auer]"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[G\xebschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:function(e){return n(e.substr(0,e.indexOf(" ")))?"a "+e:"an "+e},past:function(e){return n(e.substr(0,e.indexOf(" ")))?"viru "+e:"virun "+e},s:"e puer Sekonnen",ss:"%d Sekonnen",m:t,mm:"%d Minutten",h:t,hh:"%d Stonnen",d:t,dd:"%d Deeg",M:t,MM:"%d M\xe9int",y:t,yy:"%d Joer"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("lo",{months:"\u0ea1\u0eb1\u0e87\u0e81\u0ead\u0e99_\u0e81\u0eb8\u0ea1\u0e9e\u0eb2_\u0ea1\u0eb5\u0e99\u0eb2_\u0ec0\u0ea1\u0eaa\u0eb2_\u0e9e\u0eb6\u0e94\u0eaa\u0eb0\u0e9e\u0eb2_\u0ea1\u0eb4\u0e96\u0eb8\u0e99\u0eb2_\u0e81\u0ecd\u0ea5\u0eb0\u0e81\u0ebb\u0e94_\u0eaa\u0eb4\u0e87\u0eab\u0eb2_\u0e81\u0eb1\u0e99\u0e8d\u0eb2_\u0e95\u0eb8\u0ea5\u0eb2_\u0e9e\u0eb0\u0e88\u0eb4\u0e81_\u0e97\u0eb1\u0e99\u0ea7\u0eb2".split("_"),monthsShort:"\u0ea1\u0eb1\u0e87\u0e81\u0ead\u0e99_\u0e81\u0eb8\u0ea1\u0e9e\u0eb2_\u0ea1\u0eb5\u0e99\u0eb2_\u0ec0\u0ea1\u0eaa\u0eb2_\u0e9e\u0eb6\u0e94\u0eaa\u0eb0\u0e9e\u0eb2_\u0ea1\u0eb4\u0e96\u0eb8\u0e99\u0eb2_\u0e81\u0ecd\u0ea5\u0eb0\u0e81\u0ebb\u0e94_\u0eaa\u0eb4\u0e87\u0eab\u0eb2_\u0e81\u0eb1\u0e99\u0e8d\u0eb2_\u0e95\u0eb8\u0ea5\u0eb2_\u0e9e\u0eb0\u0e88\u0eb4\u0e81_\u0e97\u0eb1\u0e99\u0ea7\u0eb2".split("_"),weekdays:"\u0ead\u0eb2\u0e97\u0eb4\u0e94_\u0e88\u0eb1\u0e99_\u0ead\u0eb1\u0e87\u0e84\u0eb2\u0e99_\u0e9e\u0eb8\u0e94_\u0e9e\u0eb0\u0eab\u0eb1\u0e94_\u0eaa\u0eb8\u0e81_\u0ec0\u0eaa\u0ebb\u0eb2".split("_"),weekdaysShort:"\u0e97\u0eb4\u0e94_\u0e88\u0eb1\u0e99_\u0ead\u0eb1\u0e87\u0e84\u0eb2\u0e99_\u0e9e\u0eb8\u0e94_\u0e9e\u0eb0\u0eab\u0eb1\u0e94_\u0eaa\u0eb8\u0e81_\u0ec0\u0eaa\u0ebb\u0eb2".split("_"),weekdaysMin:"\u0e97_\u0e88_\u0ead\u0e84_\u0e9e_\u0e9e\u0eab_\u0eaa\u0e81_\u0eaa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"\u0ea7\u0eb1\u0e99dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0e95\u0ead\u0e99\u0ec0\u0e8a\u0ebb\u0ec9\u0eb2|\u0e95\u0ead\u0e99\u0ec1\u0ea5\u0e87/,isPM:function(e){return"\u0e95\u0ead\u0e99\u0ec1\u0ea5\u0e87"===e},meridiem:function(e,t,n){return e<12?"\u0e95\u0ead\u0e99\u0ec0\u0e8a\u0ebb\u0ec9\u0eb2":"\u0e95\u0ead\u0e99\u0ec1\u0ea5\u0e87"},calendar:{sameDay:"[\u0ea1\u0eb7\u0ec9\u0e99\u0eb5\u0ec9\u0ec0\u0ea7\u0ea5\u0eb2] LT",nextDay:"[\u0ea1\u0eb7\u0ec9\u0ead\u0eb7\u0ec8\u0e99\u0ec0\u0ea7\u0ea5\u0eb2] LT",nextWeek:"[\u0ea7\u0eb1\u0e99]dddd[\u0edc\u0ec9\u0eb2\u0ec0\u0ea7\u0ea5\u0eb2] LT",lastDay:"[\u0ea1\u0eb7\u0ec9\u0ea7\u0eb2\u0e99\u0e99\u0eb5\u0ec9\u0ec0\u0ea7\u0ea5\u0eb2] LT",lastWeek:"[\u0ea7\u0eb1\u0e99]dddd[\u0ec1\u0ea5\u0ec9\u0ea7\u0e99\u0eb5\u0ec9\u0ec0\u0ea7\u0ea5\u0eb2] LT",sameElse:"L"},relativeTime:{future:"\u0ead\u0eb5\u0e81 %s",past:"%s\u0e9c\u0ec8\u0eb2\u0e99\u0ea1\u0eb2",s:"\u0e9a\u0ecd\u0ec8\u0ec0\u0e97\u0ebb\u0ec8\u0eb2\u0ec3\u0e94\u0ea7\u0eb4\u0e99\u0eb2\u0e97\u0eb5",ss:"%d \u0ea7\u0eb4\u0e99\u0eb2\u0e97\u0eb5",m:"1 \u0e99\u0eb2\u0e97\u0eb5",mm:"%d \u0e99\u0eb2\u0e97\u0eb5",h:"1 \u0e8a\u0ebb\u0ec8\u0ea7\u0ec2\u0ea1\u0e87",hh:"%d \u0e8a\u0ebb\u0ec8\u0ea7\u0ec2\u0ea1\u0e87",d:"1 \u0ea1\u0eb7\u0ec9",dd:"%d \u0ea1\u0eb7\u0ec9",M:"1 \u0ec0\u0e94\u0eb7\u0ead\u0e99",MM:"%d \u0ec0\u0e94\u0eb7\u0ead\u0e99",y:"1 \u0e9b\u0eb5",yy:"%d \u0e9b\u0eb5"},dayOfMonthOrdinalParse:/(\u0e97\u0eb5\u0ec8)\d{1,2}/,ordinal:function(e){return"\u0e97\u0eb5\u0ec8"+e}})}(n(3))},function(e,t,n){!function(e){var t={ss:"sekund\u0117_sekund\u017ei\u0173_sekundes",m:"minut\u0117_minut\u0117s_minut\u0119",mm:"minut\u0117s_minu\u010di\u0173_minutes",h:"valanda_valandos_valand\u0105",hh:"valandos_valand\u0173_valandas",d:"diena_dienos_dien\u0105",dd:"dienos_dien\u0173_dienas",M:"m\u0117nuo_m\u0117nesio_m\u0117nes\u012f",MM:"m\u0117nesiai_m\u0117nesi\u0173_m\u0117nesius",y:"metai_met\u0173_metus",yy:"metai_met\u0173_metus"};function n(e,t,n,r){return t?i(n)[0]:r?i(n)[1]:i(n)[2]}function r(e){return e%10==0||e>10&&e<20}function i(e){return t[e].split("_")}function a(e,t,a,o){var s=e+" ";return 1===e?s+n(0,t,a[0],o):t?s+(r(e)?i(a)[1]:i(a)[0]):o?s+i(a)[1]:s+(r(e)?i(a)[1]:i(a)[2])}e.defineLocale("lt",{months:{format:"sausio_vasario_kovo_baland\u017eio_gegu\u017e\u0117s_bir\u017eelio_liepos_rugpj\u016b\u010dio_rugs\u0117jo_spalio_lapkri\u010dio_gruod\u017eio".split("_"),standalone:"sausis_vasaris_kovas_balandis_gegu\u017e\u0117_bir\u017eelis_liepa_rugpj\u016btis_rugs\u0117jis_spalis_lapkritis_gruodis".split("_"),isFormat:/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?|MMMM?(\[[^\[\]]*\]|\s)+D[oD]?/},monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:{format:"sekmadien\u012f_pirmadien\u012f_antradien\u012f_tre\u010diadien\u012f_ketvirtadien\u012f_penktadien\u012f_\u0161e\u0161tadien\u012f".split("_"),standalone:"sekmadienis_pirmadienis_antradienis_tre\u010diadienis_ketvirtadienis_penktadienis_\u0161e\u0161tadienis".split("_"),isFormat:/dddd HH:mm/},weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_\u0160e\u0161".split("_"),weekdaysMin:"S_P_A_T_K_Pn_\u0160".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], HH:mm [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, HH:mm [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], HH:mm [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, HH:mm [val.]"},calendar:{sameDay:"[\u0160iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Pra\u0117jus\u012f] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie\u0161 %s",s:function(e,t,n,r){return t?"kelios sekund\u0117s":r?"keli\u0173 sekund\u017ei\u0173":"kelias sekundes"},ss:a,m:n,mm:a,h:n,hh:a,d:n,dd:a,M:n,MM:a,y:n,yy:a},dayOfMonthOrdinalParse:/\d{1,2}-oji/,ordinal:function(e){return e+"-oji"},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={ss:"sekundes_sekund\u0113m_sekunde_sekundes".split("_"),m:"min\u016btes_min\u016bt\u0113m_min\u016bte_min\u016btes".split("_"),mm:"min\u016btes_min\u016bt\u0113m_min\u016bte_min\u016btes".split("_"),h:"stundas_stund\u0101m_stunda_stundas".split("_"),hh:"stundas_stund\u0101m_stunda_stundas".split("_"),d:"dienas_dien\u0101m_diena_dienas".split("_"),dd:"dienas_dien\u0101m_diena_dienas".split("_"),M:"m\u0113ne\u0161a_m\u0113ne\u0161iem_m\u0113nesis_m\u0113ne\u0161i".split("_"),MM:"m\u0113ne\u0161a_m\u0113ne\u0161iem_m\u0113nesis_m\u0113ne\u0161i".split("_"),y:"gada_gadiem_gads_gadi".split("_"),yy:"gada_gadiem_gads_gadi".split("_")};function n(e,t,n){return n?t%10==1&&t%100!=11?e[2]:e[3]:t%10==1&&t%100!=11?e[0]:e[1]}function r(e,r,i){return e+" "+n(t[i],e,r)}function i(e,r,i){return n(t[i],e,r)}e.defineLocale("lv",{months:"janv\u0101ris_febru\u0101ris_marts_apr\u012blis_maijs_j\u016bnijs_j\u016blijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_j\u016bn_j\u016bl_aug_sep_okt_nov_dec".split("_"),weekdays:"sv\u0113tdiena_pirmdiena_otrdiena_tre\u0161diena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY.",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, HH:mm",LLLL:"YYYY. [gada] D. MMMM, dddd, HH:mm"},calendar:{sameDay:"[\u0160odien pulksten] LT",nextDay:"[R\u012bt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pag\u0101ju\u0161\u0101] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"p\u0113c %s",past:"pirms %s",s:function(e,t){return t?"da\u017eas sekundes":"da\u017e\u0101m sekund\u0113m"},ss:r,m:i,mm:r,h:i,hh:r,d:i,dd:r,M:i,MM:r,y:i,yy:r},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={words:{ss:["sekund","sekunda","sekundi"],m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mjesec","mjeseca","mjeseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&e<=4?t[1]:t[2]},translate:function(e,n,r){var i=t.words[r];return 1===r.length?n?i[0]:i[1]:e+" "+t.correctGrammaticalCase(e,i)}};e.defineLocale("me",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_\u010detvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._\u010det._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_\u010de_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sjutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[ju\u010de u] LT",lastWeek:function(){return["[pro\u0161le] [nedjelje] [u] LT","[pro\u0161log] [ponedjeljka] [u] LT","[pro\u0161log] [utorka] [u] LT","[pro\u0161le] [srijede] [u] LT","[pro\u0161log] [\u010detvrtka] [u] LT","[pro\u0161log] [petka] [u] LT","[pro\u0161le] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"nekoliko sekundi",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"dan",dd:t.translate,M:"mjesec",MM:t.translate,y:"godinu",yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("mi",{months:"Kohi-t\u0101te_Hui-tanguru_Pout\u016b-te-rangi_Paenga-wh\u0101wh\u0101_Haratua_Pipiri_H\u014dngoingoi_Here-turi-k\u014dk\u0101_Mahuru_Whiringa-\u0101-nuku_Whiringa-\u0101-rangi_Hakihea".split("_"),monthsShort:"Kohi_Hui_Pou_Pae_Hara_Pipi_H\u014dngoi_Here_Mahu_Whi-nu_Whi-ra_Haki".split("_"),monthsRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,2}/i,weekdays:"R\u0101tapu_Mane_T\u016brei_Wenerei_T\u0101ite_Paraire_H\u0101tarei".split("_"),weekdaysShort:"Ta_Ma_T\u016b_We_T\u0101i_Pa_H\u0101".split("_"),weekdaysMin:"Ta_Ma_T\u016b_We_T\u0101i_Pa_H\u0101".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [i] HH:mm",LLLL:"dddd, D MMMM YYYY [i] HH:mm"},calendar:{sameDay:"[i teie mahana, i] LT",nextDay:"[apopo i] LT",nextWeek:"dddd [i] LT",lastDay:"[inanahi i] LT",lastWeek:"dddd [whakamutunga i] LT",sameElse:"L"},relativeTime:{future:"i roto i %s",past:"%s i mua",s:"te h\u0113kona ruarua",ss:"%d h\u0113kona",m:"he meneti",mm:"%d meneti",h:"te haora",hh:"%d haora",d:"he ra",dd:"%d ra",M:"he marama",MM:"%d marama",y:"he tau",yy:"%d tau"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("mk",{months:"\u0458\u0430\u043d\u0443\u0430\u0440\u0438_\u0444\u0435\u0432\u0440\u0443\u0430\u0440\u0438_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0438\u043b_\u043c\u0430\u0458_\u0458\u0443\u043d\u0438_\u0458\u0443\u043b\u0438_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043f\u0442\u0435\u043c\u0432\u0440\u0438_\u043e\u043a\u0442\u043e\u043c\u0432\u0440\u0438_\u043d\u043e\u0435\u043c\u0432\u0440\u0438_\u0434\u0435\u043a\u0435\u043c\u0432\u0440\u0438".split("_"),monthsShort:"\u0458\u0430\u043d_\u0444\u0435\u0432_\u043c\u0430\u0440_\u0430\u043f\u0440_\u043c\u0430\u0458_\u0458\u0443\u043d_\u0458\u0443\u043b_\u0430\u0432\u0433_\u0441\u0435\u043f_\u043e\u043a\u0442_\u043d\u043e\u0435_\u0434\u0435\u043a".split("_"),weekdays:"\u043d\u0435\u0434\u0435\u043b\u0430_\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u043d\u0438\u043a_\u0432\u0442\u043e\u0440\u043d\u0438\u043a_\u0441\u0440\u0435\u0434\u0430_\u0447\u0435\u0442\u0432\u0440\u0442\u043e\u043a_\u043f\u0435\u0442\u043e\u043a_\u0441\u0430\u0431\u043e\u0442\u0430".split("_"),weekdaysShort:"\u043d\u0435\u0434_\u043f\u043e\u043d_\u0432\u0442\u043e_\u0441\u0440\u0435_\u0447\u0435\u0442_\u043f\u0435\u0442_\u0441\u0430\u0431".split("_"),weekdaysMin:"\u043de_\u043fo_\u0432\u0442_\u0441\u0440_\u0447\u0435_\u043f\u0435_\u0441a".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[\u0414\u0435\u043d\u0435\u0441 \u0432\u043e] LT",nextDay:"[\u0423\u0442\u0440\u0435 \u0432\u043e] LT",nextWeek:"[\u0412\u043e] dddd [\u0432\u043e] LT",lastDay:"[\u0412\u0447\u0435\u0440\u0430 \u0432\u043e] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[\u0418\u0437\u043c\u0438\u043d\u0430\u0442\u0430\u0442\u0430] dddd [\u0432\u043e] LT";case 1:case 2:case 4:case 5:return"[\u0418\u0437\u043c\u0438\u043d\u0430\u0442\u0438\u043e\u0442] dddd [\u0432\u043e] LT"}},sameElse:"L"},relativeTime:{future:"\u0437\u0430 %s",past:"\u043f\u0440\u0435\u0434 %s",s:"\u043d\u0435\u043a\u043e\u043b\u043a\u0443 \u0441\u0435\u043a\u0443\u043d\u0434\u0438",ss:"%d \u0441\u0435\u043a\u0443\u043d\u0434\u0438",m:"\u0435\u0434\u043d\u0430 \u043c\u0438\u043d\u0443\u0442\u0430",mm:"%d \u043c\u0438\u043d\u0443\u0442\u0438",h:"\u0435\u0434\u0435\u043d \u0447\u0430\u0441",hh:"%d \u0447\u0430\u0441\u0430",d:"\u0435\u0434\u0435\u043d \u0434\u0435\u043d",dd:"%d \u0434\u0435\u043d\u0430",M:"\u0435\u0434\u0435\u043d \u043c\u0435\u0441\u0435\u0446",MM:"%d \u043c\u0435\u0441\u0435\u0446\u0438",y:"\u0435\u0434\u043d\u0430 \u0433\u043e\u0434\u0438\u043d\u0430",yy:"%d \u0433\u043e\u0434\u0438\u043d\u0438"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0435\u0432|\u0435\u043d|\u0442\u0438|\u0432\u0438|\u0440\u0438|\u043c\u0438)/,ordinal:function(e){var t=e%10,n=e%100;return 0===e?e+"-\u0435\u0432":0===n?e+"-\u0435\u043d":n>10&&n<20?e+"-\u0442\u0438":1===t?e+"-\u0432\u0438":2===t?e+"-\u0440\u0438":7===t||8===t?e+"-\u043c\u0438":e+"-\u0442\u0438"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ml",{months:"\u0d1c\u0d28\u0d41\u0d35\u0d30\u0d3f_\u0d2b\u0d46\u0d2c\u0d4d\u0d30\u0d41\u0d35\u0d30\u0d3f_\u0d2e\u0d3e\u0d7c\u0d1a\u0d4d\u0d1a\u0d4d_\u0d0f\u0d2a\u0d4d\u0d30\u0d3f\u0d7d_\u0d2e\u0d47\u0d2f\u0d4d_\u0d1c\u0d42\u0d7a_\u0d1c\u0d42\u0d32\u0d48_\u0d13\u0d17\u0d38\u0d4d\u0d31\u0d4d\u0d31\u0d4d_\u0d38\u0d46\u0d2a\u0d4d\u0d31\u0d4d\u0d31\u0d02\u0d2c\u0d7c_\u0d12\u0d15\u0d4d\u0d1f\u0d4b\u0d2c\u0d7c_\u0d28\u0d35\u0d02\u0d2c\u0d7c_\u0d21\u0d3f\u0d38\u0d02\u0d2c\u0d7c".split("_"),monthsShort:"\u0d1c\u0d28\u0d41._\u0d2b\u0d46\u0d2c\u0d4d\u0d30\u0d41._\u0d2e\u0d3e\u0d7c._\u0d0f\u0d2a\u0d4d\u0d30\u0d3f._\u0d2e\u0d47\u0d2f\u0d4d_\u0d1c\u0d42\u0d7a_\u0d1c\u0d42\u0d32\u0d48._\u0d13\u0d17._\u0d38\u0d46\u0d2a\u0d4d\u0d31\u0d4d\u0d31._\u0d12\u0d15\u0d4d\u0d1f\u0d4b._\u0d28\u0d35\u0d02._\u0d21\u0d3f\u0d38\u0d02.".split("_"),monthsParseExact:!0,weekdays:"\u0d1e\u0d3e\u0d2f\u0d31\u0d3e\u0d34\u0d4d\u0d1a_\u0d24\u0d3f\u0d19\u0d4d\u0d15\u0d33\u0d3e\u0d34\u0d4d\u0d1a_\u0d1a\u0d4a\u0d35\u0d4d\u0d35\u0d3e\u0d34\u0d4d\u0d1a_\u0d2c\u0d41\u0d27\u0d28\u0d3e\u0d34\u0d4d\u0d1a_\u0d35\u0d4d\u0d2f\u0d3e\u0d34\u0d3e\u0d34\u0d4d\u0d1a_\u0d35\u0d46\u0d33\u0d4d\u0d33\u0d3f\u0d2f\u0d3e\u0d34\u0d4d\u0d1a_\u0d36\u0d28\u0d3f\u0d2f\u0d3e\u0d34\u0d4d\u0d1a".split("_"),weekdaysShort:"\u0d1e\u0d3e\u0d2f\u0d7c_\u0d24\u0d3f\u0d19\u0d4d\u0d15\u0d7e_\u0d1a\u0d4a\u0d35\u0d4d\u0d35_\u0d2c\u0d41\u0d27\u0d7b_\u0d35\u0d4d\u0d2f\u0d3e\u0d34\u0d02_\u0d35\u0d46\u0d33\u0d4d\u0d33\u0d3f_\u0d36\u0d28\u0d3f".split("_"),weekdaysMin:"\u0d1e\u0d3e_\u0d24\u0d3f_\u0d1a\u0d4a_\u0d2c\u0d41_\u0d35\u0d4d\u0d2f\u0d3e_\u0d35\u0d46_\u0d36".split("_"),longDateFormat:{LT:"A h:mm -\u0d28\u0d41",LTS:"A h:mm:ss -\u0d28\u0d41",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm -\u0d28\u0d41",LLLL:"dddd, D MMMM YYYY, A h:mm -\u0d28\u0d41"},calendar:{sameDay:"[\u0d07\u0d28\u0d4d\u0d28\u0d4d] LT",nextDay:"[\u0d28\u0d3e\u0d33\u0d46] LT",nextWeek:"dddd, LT",lastDay:"[\u0d07\u0d28\u0d4d\u0d28\u0d32\u0d46] LT",lastWeek:"[\u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e\u0d4d",past:"%s \u0d2e\u0d41\u0d7b\u0d2a\u0d4d",s:"\u0d05\u0d7d\u0d2a \u0d28\u0d3f\u0d2e\u0d3f\u0d37\u0d19\u0d4d\u0d19\u0d7e",ss:"%d \u0d38\u0d46\u0d15\u0d4d\u0d15\u0d7b\u0d21\u0d4d",m:"\u0d12\u0d30\u0d41 \u0d2e\u0d3f\u0d28\u0d3f\u0d31\u0d4d\u0d31\u0d4d",mm:"%d \u0d2e\u0d3f\u0d28\u0d3f\u0d31\u0d4d\u0d31\u0d4d",h:"\u0d12\u0d30\u0d41 \u0d2e\u0d23\u0d3f\u0d15\u0d4d\u0d15\u0d42\u0d7c",hh:"%d \u0d2e\u0d23\u0d3f\u0d15\u0d4d\u0d15\u0d42\u0d7c",d:"\u0d12\u0d30\u0d41 \u0d26\u0d3f\u0d35\u0d38\u0d02",dd:"%d \u0d26\u0d3f\u0d35\u0d38\u0d02",M:"\u0d12\u0d30\u0d41 \u0d2e\u0d3e\u0d38\u0d02",MM:"%d \u0d2e\u0d3e\u0d38\u0d02",y:"\u0d12\u0d30\u0d41 \u0d35\u0d7c\u0d37\u0d02",yy:"%d \u0d35\u0d7c\u0d37\u0d02"},meridiemParse:/\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f|\u0d30\u0d3e\u0d35\u0d3f\u0d32\u0d46|\u0d09\u0d1a\u0d4d\u0d1a \u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e\u0d4d|\u0d35\u0d48\u0d15\u0d41\u0d28\u0d4d\u0d28\u0d47\u0d30\u0d02|\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f/i,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f"===t&&e>=4||"\u0d09\u0d1a\u0d4d\u0d1a \u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e\u0d4d"===t||"\u0d35\u0d48\u0d15\u0d41\u0d28\u0d4d\u0d28\u0d47\u0d30\u0d02"===t?e+12:e},meridiem:function(e,t,n){return e<4?"\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f":e<12?"\u0d30\u0d3e\u0d35\u0d3f\u0d32\u0d46":e<17?"\u0d09\u0d1a\u0d4d\u0d1a \u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e\u0d4d":e<20?"\u0d35\u0d48\u0d15\u0d41\u0d28\u0d4d\u0d28\u0d47\u0d30\u0d02":"\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f"}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){switch(n){case"s":return t?"\u0445\u044d\u0434\u0445\u044d\u043d \u0441\u0435\u043a\u0443\u043d\u0434":"\u0445\u044d\u0434\u0445\u044d\u043d \u0441\u0435\u043a\u0443\u043d\u0434\u044b\u043d";case"ss":return e+(t?" \u0441\u0435\u043a\u0443\u043d\u0434":" \u0441\u0435\u043a\u0443\u043d\u0434\u044b\u043d");case"m":case"mm":return e+(t?" \u043c\u0438\u043d\u0443\u0442":" \u043c\u0438\u043d\u0443\u0442\u044b\u043d");case"h":case"hh":return e+(t?" \u0446\u0430\u0433":" \u0446\u0430\u0433\u0438\u0439\u043d");case"d":case"dd":return e+(t?" \u04e9\u0434\u04e9\u0440":" \u04e9\u0434\u0440\u0438\u0439\u043d");case"M":case"MM":return e+(t?" \u0441\u0430\u0440":" \u0441\u0430\u0440\u044b\u043d");case"y":case"yy":return e+(t?" \u0436\u0438\u043b":" \u0436\u0438\u043b\u0438\u0439\u043d");default:return e}}e.defineLocale("mn",{months:"\u041d\u044d\u0433\u0434\u04af\u0433\u044d\u044d\u0440 \u0441\u0430\u0440_\u0425\u043e\u0451\u0440\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0413\u0443\u0440\u0430\u0432\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0414\u04e9\u0440\u04e9\u0432\u0434\u04af\u0433\u044d\u044d\u0440 \u0441\u0430\u0440_\u0422\u0430\u0432\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0417\u0443\u0440\u0433\u0430\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0414\u043e\u043b\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u041d\u0430\u0439\u043c\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0415\u0441\u0434\u04af\u0433\u044d\u044d\u0440 \u0441\u0430\u0440_\u0410\u0440\u0430\u0432\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0410\u0440\u0432\u0430\u043d \u043d\u044d\u0433\u0434\u04af\u0433\u044d\u044d\u0440 \u0441\u0430\u0440_\u0410\u0440\u0432\u0430\u043d \u0445\u043e\u0451\u0440\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440".split("_"),monthsShort:"1 \u0441\u0430\u0440_2 \u0441\u0430\u0440_3 \u0441\u0430\u0440_4 \u0441\u0430\u0440_5 \u0441\u0430\u0440_6 \u0441\u0430\u0440_7 \u0441\u0430\u0440_8 \u0441\u0430\u0440_9 \u0441\u0430\u0440_10 \u0441\u0430\u0440_11 \u0441\u0430\u0440_12 \u0441\u0430\u0440".split("_"),monthsParseExact:!0,weekdays:"\u041d\u044f\u043c_\u0414\u0430\u0432\u0430\u0430_\u041c\u044f\u0433\u043c\u0430\u0440_\u041b\u0445\u0430\u0433\u0432\u0430_\u041f\u04af\u0440\u044d\u0432_\u0411\u0430\u0430\u0441\u0430\u043d_\u0411\u044f\u043c\u0431\u0430".split("_"),weekdaysShort:"\u041d\u044f\u043c_\u0414\u0430\u0432_\u041c\u044f\u0433_\u041b\u0445\u0430_\u041f\u04af\u0440_\u0411\u0430\u0430_\u0411\u044f\u043c".split("_"),weekdaysMin:"\u041d\u044f_\u0414\u0430_\u041c\u044f_\u041b\u0445_\u041f\u04af_\u0411\u0430_\u0411\u044f".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY \u043e\u043d\u044b MMMM\u044b\u043d D",LLL:"YYYY \u043e\u043d\u044b MMMM\u044b\u043d D HH:mm",LLLL:"dddd, YYYY \u043e\u043d\u044b MMMM\u044b\u043d D HH:mm"},meridiemParse:/\u04ae\u04e8|\u04ae\u0425/i,isPM:function(e){return"\u04ae\u0425"===e},meridiem:function(e,t,n){return e<12?"\u04ae\u04e8":"\u04ae\u0425"},calendar:{sameDay:"[\u04e8\u043d\u04e9\u04e9\u0434\u04e9\u0440] LT",nextDay:"[\u041c\u0430\u0440\u0433\u0430\u0430\u0448] LT",nextWeek:"[\u0418\u0440\u044d\u0445] dddd LT",lastDay:"[\u04e8\u0447\u0438\u0433\u0434\u04e9\u0440] LT",lastWeek:"[\u04e8\u043d\u0433\u04e9\u0440\u0441\u04e9\u043d] dddd LT",sameElse:"L"},relativeTime:{future:"%s \u0434\u0430\u0440\u0430\u0430",past:"%s \u04e9\u043c\u043d\u04e9",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2} \u04e9\u0434\u04e9\u0440/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+" \u04e9\u0434\u04e9\u0440";default:return e}}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0967",2:"\u0968",3:"\u0969",4:"\u096a",5:"\u096b",6:"\u096c",7:"\u096d",8:"\u096e",9:"\u096f",0:"\u0966"},n={"\u0967":"1","\u0968":"2","\u0969":"3","\u096a":"4","\u096b":"5","\u096c":"6","\u096d":"7","\u096e":"8","\u096f":"9","\u0966":"0"};function r(e,t,n,r){var i="";if(t)switch(n){case"s":i="\u0915\u093e\u0939\u0940 \u0938\u0947\u0915\u0902\u0926";break;case"ss":i="%d \u0938\u0947\u0915\u0902\u0926";break;case"m":i="\u090f\u0915 \u092e\u093f\u0928\u093f\u091f";break;case"mm":i="%d \u092e\u093f\u0928\u093f\u091f\u0947";break;case"h":i="\u090f\u0915 \u0924\u093e\u0938";break;case"hh":i="%d \u0924\u093e\u0938";break;case"d":i="\u090f\u0915 \u0926\u093f\u0935\u0938";break;case"dd":i="%d \u0926\u093f\u0935\u0938";break;case"M":i="\u090f\u0915 \u092e\u0939\u093f\u0928\u093e";break;case"MM":i="%d \u092e\u0939\u093f\u0928\u0947";break;case"y":i="\u090f\u0915 \u0935\u0930\u094d\u0937";break;case"yy":i="%d \u0935\u0930\u094d\u0937\u0947"}else switch(n){case"s":i="\u0915\u093e\u0939\u0940 \u0938\u0947\u0915\u0902\u0926\u093e\u0902";break;case"ss":i="%d \u0938\u0947\u0915\u0902\u0926\u093e\u0902";break;case"m":i="\u090f\u0915\u093e \u092e\u093f\u0928\u093f\u091f\u093e";break;case"mm":i="%d \u092e\u093f\u0928\u093f\u091f\u093e\u0902";break;case"h":i="\u090f\u0915\u093e \u0924\u093e\u0938\u093e";break;case"hh":i="%d \u0924\u093e\u0938\u093e\u0902";break;case"d":i="\u090f\u0915\u093e \u0926\u093f\u0935\u0938\u093e";break;case"dd":i="%d \u0926\u093f\u0935\u0938\u093e\u0902";break;case"M":i="\u090f\u0915\u093e \u092e\u0939\u093f\u0928\u094d\u092f\u093e";break;case"MM":i="%d \u092e\u0939\u093f\u0928\u094d\u092f\u093e\u0902";break;case"y":i="\u090f\u0915\u093e \u0935\u0930\u094d\u0937\u093e";break;case"yy":i="%d \u0935\u0930\u094d\u0937\u093e\u0902"}return i.replace(/%d/i,e)}e.defineLocale("mr",{months:"\u091c\u093e\u0928\u0947\u0935\u093e\u0930\u0940_\u092b\u0947\u092c\u094d\u0930\u0941\u0935\u093e\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u090f\u092a\u094d\u0930\u093f\u0932_\u092e\u0947_\u091c\u0942\u0928_\u091c\u0941\u0932\u0948_\u0911\u0917\u0938\u094d\u091f_\u0938\u092a\u094d\u091f\u0947\u0902\u092c\u0930_\u0911\u0915\u094d\u091f\u094b\u092c\u0930_\u0928\u094b\u0935\u094d\u0939\u0947\u0902\u092c\u0930_\u0921\u093f\u0938\u0947\u0902\u092c\u0930".split("_"),monthsShort:"\u091c\u093e\u0928\u0947._\u092b\u0947\u092c\u094d\u0930\u0941._\u092e\u093e\u0930\u094d\u091a._\u090f\u092a\u094d\u0930\u093f._\u092e\u0947._\u091c\u0942\u0928._\u091c\u0941\u0932\u0948._\u0911\u0917._\u0938\u092a\u094d\u091f\u0947\u0902._\u0911\u0915\u094d\u091f\u094b._\u0928\u094b\u0935\u094d\u0939\u0947\u0902._\u0921\u093f\u0938\u0947\u0902.".split("_"),monthsParseExact:!0,weekdays:"\u0930\u0935\u093f\u0935\u093e\u0930_\u0938\u094b\u092e\u0935\u093e\u0930_\u092e\u0902\u0917\u0933\u0935\u093e\u0930_\u092c\u0941\u0927\u0935\u093e\u0930_\u0917\u0941\u0930\u0942\u0935\u093e\u0930_\u0936\u0941\u0915\u094d\u0930\u0935\u093e\u0930_\u0936\u0928\u093f\u0935\u093e\u0930".split("_"),weekdaysShort:"\u0930\u0935\u093f_\u0938\u094b\u092e_\u092e\u0902\u0917\u0933_\u092c\u0941\u0927_\u0917\u0941\u0930\u0942_\u0936\u0941\u0915\u094d\u0930_\u0936\u0928\u093f".split("_"),weekdaysMin:"\u0930_\u0938\u094b_\u092e\u0902_\u092c\u0941_\u0917\u0941_\u0936\u0941_\u0936".split("_"),longDateFormat:{LT:"A h:mm \u0935\u093e\u091c\u0924\u093e",LTS:"A h:mm:ss \u0935\u093e\u091c\u0924\u093e",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u0935\u093e\u091c\u0924\u093e",LLLL:"dddd, D MMMM YYYY, A h:mm \u0935\u093e\u091c\u0924\u093e"},calendar:{sameDay:"[\u0906\u091c] LT",nextDay:"[\u0909\u0926\u094d\u092f\u093e] LT",nextWeek:"dddd, LT",lastDay:"[\u0915\u093e\u0932] LT",lastWeek:"[\u092e\u093e\u0917\u0940\u0932] dddd, LT",sameElse:"L"},relativeTime:{future:"%s\u092e\u0927\u094d\u092f\u0947",past:"%s\u092a\u0942\u0930\u094d\u0935\u0940",s:r,ss:r,m:r,mm:r,h:r,hh:r,d:r,dd:r,M:r,MM:r,y:r,yy:r},preparse:function(e){return e.replace(/[\u0967\u0968\u0969\u096a\u096b\u096c\u096d\u096e\u096f\u0966]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u092a\u0939\u093e\u091f\u0947|\u0938\u0915\u093e\u0933\u0940|\u0926\u0941\u092a\u093e\u0930\u0940|\u0938\u093e\u092f\u0902\u0915\u093e\u0933\u0940|\u0930\u093e\u0924\u094d\u0930\u0940/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u092a\u0939\u093e\u091f\u0947"===t||"\u0938\u0915\u093e\u0933\u0940"===t?e:"\u0926\u0941\u092a\u093e\u0930\u0940"===t||"\u0938\u093e\u092f\u0902\u0915\u093e\u0933\u0940"===t||"\u0930\u093e\u0924\u094d\u0930\u0940"===t?e>=12?e:e+12:void 0},meridiem:function(e,t,n){return e>=0&&e<6?"\u092a\u0939\u093e\u091f\u0947":e<12?"\u0938\u0915\u093e\u0933\u0940":e<17?"\u0926\u0941\u092a\u093e\u0930\u0940":e<20?"\u0938\u093e\u092f\u0902\u0915\u093e\u0933\u0940":"\u0930\u093e\u0924\u094d\u0930\u0940"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ms",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"tengahari"===t?e>=11?e:e+12:"petang"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,n){return e<11?"pagi":e<15?"tengahari":e<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"tengahari"===t?e>=11?e:e+12:"petang"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,n){return e<11?"pagi":e<15?"tengahari":e<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("mt",{months:"Jannar_Frar_Marzu_April_Mejju_\u0120unju_Lulju_Awwissu_Settembru_Ottubru_Novembru_Di\u010bembru".split("_"),monthsShort:"Jan_Fra_Mar_Apr_Mej_\u0120un_Lul_Aww_Set_Ott_Nov_Di\u010b".split("_"),weekdays:"Il-\u0126add_It-Tnejn_It-Tlieta_L-Erbg\u0127a_Il-\u0126amis_Il-\u0120img\u0127a_Is-Sibt".split("_"),weekdaysShort:"\u0126ad_Tne_Tli_Erb_\u0126am_\u0120im_Sib".split("_"),weekdaysMin:"\u0126a_Tn_Tl_Er_\u0126a_\u0120i_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Illum fil-]LT",nextDay:"[G\u0127ada fil-]LT",nextWeek:"dddd [fil-]LT",lastDay:"[Il-biera\u0127 fil-]LT",lastWeek:"dddd [li g\u0127adda] [fil-]LT",sameElse:"L"},relativeTime:{future:"f\u2019 %s",past:"%s ilu",s:"ftit sekondi",ss:"%d sekondi",m:"minuta",mm:"%d minuti",h:"sieg\u0127a",hh:"%d sieg\u0127at",d:"\u0121urnata",dd:"%d \u0121ranet",M:"xahar",MM:"%d xhur",y:"sena",yy:"%d sni"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u1041",2:"\u1042",3:"\u1043",4:"\u1044",5:"\u1045",6:"\u1046",7:"\u1047",8:"\u1048",9:"\u1049",0:"\u1040"},n={"\u1041":"1","\u1042":"2","\u1043":"3","\u1044":"4","\u1045":"5","\u1046":"6","\u1047":"7","\u1048":"8","\u1049":"9","\u1040":"0"};e.defineLocale("my",{months:"\u1007\u1014\u103a\u1014\u101d\u102b\u101b\u102e_\u1016\u1031\u1016\u1031\u102c\u103a\u101d\u102b\u101b\u102e_\u1019\u1010\u103a_\u1027\u1015\u103c\u102e_\u1019\u1031_\u1007\u103d\u1014\u103a_\u1007\u1030\u101c\u102d\u102f\u1004\u103a_\u101e\u103c\u1002\u102f\u1010\u103a_\u1005\u1000\u103a\u1010\u1004\u103a\u1018\u102c_\u1021\u1031\u102c\u1000\u103a\u1010\u102d\u102f\u1018\u102c_\u1014\u102d\u102f\u101d\u1004\u103a\u1018\u102c_\u1012\u102e\u1007\u1004\u103a\u1018\u102c".split("_"),monthsShort:"\u1007\u1014\u103a_\u1016\u1031_\u1019\u1010\u103a_\u1015\u103c\u102e_\u1019\u1031_\u1007\u103d\u1014\u103a_\u101c\u102d\u102f\u1004\u103a_\u101e\u103c_\u1005\u1000\u103a_\u1021\u1031\u102c\u1000\u103a_\u1014\u102d\u102f_\u1012\u102e".split("_"),weekdays:"\u1010\u1014\u1004\u103a\u1039\u1002\u1014\u103d\u1031_\u1010\u1014\u1004\u103a\u1039\u101c\u102c_\u1021\u1004\u103a\u1039\u1002\u102b_\u1017\u102f\u1012\u1039\u1013\u101f\u1030\u1038_\u1000\u103c\u102c\u101e\u1015\u1010\u1031\u1038_\u101e\u1031\u102c\u1000\u103c\u102c_\u1005\u1014\u1031".split("_"),weekdaysShort:"\u1014\u103d\u1031_\u101c\u102c_\u1002\u102b_\u101f\u1030\u1038_\u1000\u103c\u102c_\u101e\u1031\u102c_\u1014\u1031".split("_"),weekdaysMin:"\u1014\u103d\u1031_\u101c\u102c_\u1002\u102b_\u101f\u1030\u1038_\u1000\u103c\u102c_\u101e\u1031\u102c_\u1014\u1031".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u101a\u1014\u1031.] LT [\u1019\u103e\u102c]",nextDay:"[\u1019\u1014\u1000\u103a\u1016\u103c\u1014\u103a] LT [\u1019\u103e\u102c]",nextWeek:"dddd LT [\u1019\u103e\u102c]",lastDay:"[\u1019\u1014\u1031.\u1000] LT [\u1019\u103e\u102c]",lastWeek:"[\u1015\u103c\u102e\u1038\u1001\u1032\u1037\u101e\u1031\u102c] dddd LT [\u1019\u103e\u102c]",sameElse:"L"},relativeTime:{future:"\u101c\u102c\u1019\u100a\u103a\u1037 %s \u1019\u103e\u102c",past:"\u101c\u103d\u1014\u103a\u1001\u1032\u1037\u101e\u1031\u102c %s \u1000",s:"\u1005\u1000\u1039\u1000\u1014\u103a.\u1021\u1014\u100a\u103a\u1038\u1004\u101a\u103a",ss:"%d \u1005\u1000\u1039\u1000\u1014\u1037\u103a",m:"\u1010\u1005\u103a\u1019\u102d\u1014\u1005\u103a",mm:"%d \u1019\u102d\u1014\u1005\u103a",h:"\u1010\u1005\u103a\u1014\u102c\u101b\u102e",hh:"%d \u1014\u102c\u101b\u102e",d:"\u1010\u1005\u103a\u101b\u1000\u103a",dd:"%d \u101b\u1000\u103a",M:"\u1010\u1005\u103a\u101c",MM:"%d \u101c",y:"\u1010\u1005\u103a\u1014\u103e\u1005\u103a",yy:"%d \u1014\u103e\u1005\u103a"},preparse:function(e){return e.replace(/[\u1041\u1042\u1043\u1044\u1045\u1046\u1047\u1048\u1049\u1040]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"s\xf8ndag_mandag_tirsdag_onsdag_torsdag_fredag_l\xf8rdag".split("_"),weekdaysShort:"s\xf8._ma._ti._on._to._fr._l\xf8.".split("_"),weekdaysMin:"s\xf8_ma_ti_on_to_fr_l\xf8".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] HH:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i g\xe5r kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"noen sekunder",ss:"%d sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",w:"en uke",ww:"%d uker",M:"en m\xe5ned",MM:"%d m\xe5neder",y:"ett \xe5r",yy:"%d \xe5r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0967",2:"\u0968",3:"\u0969",4:"\u096a",5:"\u096b",6:"\u096c",7:"\u096d",8:"\u096e",9:"\u096f",0:"\u0966"},n={"\u0967":"1","\u0968":"2","\u0969":"3","\u096a":"4","\u096b":"5","\u096c":"6","\u096d":"7","\u096e":"8","\u096f":"9","\u0966":"0"};e.defineLocale("ne",{months:"\u091c\u0928\u0935\u0930\u0940_\u092b\u0947\u092c\u094d\u0930\u0941\u0935\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u093f\u0932_\u092e\u0908_\u091c\u0941\u0928_\u091c\u0941\u0932\u093e\u0908_\u0905\u0917\u0937\u094d\u091f_\u0938\u0947\u092a\u094d\u091f\u0947\u092e\u094d\u092c\u0930_\u0905\u0915\u094d\u091f\u094b\u092c\u0930_\u0928\u094b\u092d\u0947\u092e\u094d\u092c\u0930_\u0921\u093f\u0938\u0947\u092e\u094d\u092c\u0930".split("_"),monthsShort:"\u091c\u0928._\u092b\u0947\u092c\u094d\u0930\u0941._\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u093f._\u092e\u0908_\u091c\u0941\u0928_\u091c\u0941\u0932\u093e\u0908._\u0905\u0917._\u0938\u0947\u092a\u094d\u091f._\u0905\u0915\u094d\u091f\u094b._\u0928\u094b\u092d\u0947._\u0921\u093f\u0938\u0947.".split("_"),monthsParseExact:!0,weekdays:"\u0906\u0907\u0924\u092c\u093e\u0930_\u0938\u094b\u092e\u092c\u093e\u0930_\u092e\u0919\u094d\u0917\u0932\u092c\u093e\u0930_\u092c\u0941\u0927\u092c\u093e\u0930_\u092c\u093f\u0939\u093f\u092c\u093e\u0930_\u0936\u0941\u0915\u094d\u0930\u092c\u093e\u0930_\u0936\u0928\u093f\u092c\u093e\u0930".split("_"),weekdaysShort:"\u0906\u0907\u0924._\u0938\u094b\u092e._\u092e\u0919\u094d\u0917\u0932._\u092c\u0941\u0927._\u092c\u093f\u0939\u093f._\u0936\u0941\u0915\u094d\u0930._\u0936\u0928\u093f.".split("_"),weekdaysMin:"\u0906._\u0938\u094b._\u092e\u0902._\u092c\u0941._\u092c\u093f._\u0936\u0941._\u0936.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A\u0915\u094b h:mm \u092c\u091c\u0947",LTS:"A\u0915\u094b h:mm:ss \u092c\u091c\u0947",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A\u0915\u094b h:mm \u092c\u091c\u0947",LLLL:"dddd, D MMMM YYYY, A\u0915\u094b h:mm \u092c\u091c\u0947"},preparse:function(e){return e.replace(/[\u0967\u0968\u0969\u096a\u096b\u096c\u096d\u096e\u096f\u0966]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u0930\u093e\u0924\u093f|\u092c\u093f\u0939\u093e\u0928|\u0926\u093f\u0909\u0901\u0938\u094b|\u0938\u093e\u0901\u091d/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0930\u093e\u0924\u093f"===t?e<4?e:e+12:"\u092c\u093f\u0939\u093e\u0928"===t?e:"\u0926\u093f\u0909\u0901\u0938\u094b"===t?e>=10?e:e+12:"\u0938\u093e\u0901\u091d"===t?e+12:void 0},meridiem:function(e,t,n){return e<3?"\u0930\u093e\u0924\u093f":e<12?"\u092c\u093f\u0939\u093e\u0928":e<16?"\u0926\u093f\u0909\u0901\u0938\u094b":e<20?"\u0938\u093e\u0901\u091d":"\u0930\u093e\u0924\u093f"},calendar:{sameDay:"[\u0906\u091c] LT",nextDay:"[\u092d\u094b\u0932\u093f] LT",nextWeek:"[\u0906\u0909\u0901\u0926\u094b] dddd[,] LT",lastDay:"[\u0939\u093f\u091c\u094b] LT",lastWeek:"[\u0917\u090f\u0915\u094b] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s\u092e\u093e",past:"%s \u0905\u0917\u093e\u0921\u093f",s:"\u0915\u0947\u0939\u0940 \u0915\u094d\u0937\u0923",ss:"%d \u0938\u0947\u0915\u0947\u0923\u094d\u0921",m:"\u090f\u0915 \u092e\u093f\u0928\u0947\u091f",mm:"%d \u092e\u093f\u0928\u0947\u091f",h:"\u090f\u0915 \u0918\u0923\u094d\u091f\u093e",hh:"%d \u0918\u0923\u094d\u091f\u093e",d:"\u090f\u0915 \u0926\u093f\u0928",dd:"%d \u0926\u093f\u0928",M:"\u090f\u0915 \u092e\u0939\u093f\u0928\u093e",MM:"%d \u092e\u0939\u093f\u0928\u093e",y:"\u090f\u0915 \u092c\u0930\u094d\u0937",yy:"%d \u092c\u0930\u094d\u0937"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){var t="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),n="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),r=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],i=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;e.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?n[e.month()]:t[e.month()]:t},monthsRegex:i,monthsShortRegex:i,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"\xe9\xe9n minuut",mm:"%d minuten",h:"\xe9\xe9n uur",hh:"%d uur",d:"\xe9\xe9n dag",dd:"%d dagen",w:"\xe9\xe9n week",ww:"%d weken",M:"\xe9\xe9n maand",MM:"%d maanden",y:"\xe9\xe9n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),n="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),r=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],i=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;e.defineLocale("nl-be",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?n[e.month()]:t[e.month()]:t},monthsRegex:i,monthsShortRegex:i,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"\xe9\xe9n minuut",mm:"%d minuten",h:"\xe9\xe9n uur",hh:"%d uur",d:"\xe9\xe9n dag",dd:"%d dagen",M:"\xe9\xe9n maand",MM:"%d maanden",y:"\xe9\xe9n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"sundag_m\xe5ndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"su._m\xe5._ty._on._to._fr._lau.".split("_"),weekdaysMin:"su_m\xe5_ty_on_to_fr_la".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I g\xe5r klokka] LT",lastWeek:"[F\xf8reg\xe5ande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s sidan",s:"nokre sekund",ss:"%d sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",w:"ei veke",ww:"%d veker",M:"ein m\xe5nad",MM:"%d m\xe5nader",y:"eit \xe5r",yy:"%d \xe5r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("oc-lnc",{months:{standalone:"geni\xe8r_febri\xe8r_mar\xe7_abril_mai_junh_julhet_agost_setembre_oct\xf2bre_novembre_decembre".split("_"),format:"de geni\xe8r_de febri\xe8r_de mar\xe7_d'abril_de mai_de junh_de julhet_d'agost_de setembre_d'oct\xf2bre_de novembre_de decembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar\xe7_abr._mai_junh_julh._ago._set._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"dimenge_diluns_dimars_dim\xe8cres_dij\xf2us_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dm._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dm_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:"[u\xe8i a] LT",nextDay:"[deman a] LT",nextWeek:"dddd [a] LT",lastDay:"[i\xe8r a] LT",lastWeek:"dddd [passat a] LT",sameElse:"L"},relativeTime:{future:"d'aqu\xed %s",past:"fa %s",s:"unas segondas",ss:"%d segondas",m:"una minuta",mm:"%d minutas",h:"una ora",hh:"%d oras",d:"un jorn",dd:"%d jorns",M:"un mes",MM:"%d meses",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t|\xe8|a)/,ordinal:function(e,t){var n=1===e?"r":2===e?"n":3===e?"r":4===e?"t":"\xe8";return"w"!==t&&"W"!==t||(n="a"),e+n},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0a67",2:"\u0a68",3:"\u0a69",4:"\u0a6a",5:"\u0a6b",6:"\u0a6c",7:"\u0a6d",8:"\u0a6e",9:"\u0a6f",0:"\u0a66"},n={"\u0a67":"1","\u0a68":"2","\u0a69":"3","\u0a6a":"4","\u0a6b":"5","\u0a6c":"6","\u0a6d":"7","\u0a6e":"8","\u0a6f":"9","\u0a66":"0"};e.defineLocale("pa-in",{months:"\u0a1c\u0a28\u0a35\u0a30\u0a40_\u0a2b\u0a3c\u0a30\u0a35\u0a30\u0a40_\u0a2e\u0a3e\u0a30\u0a1a_\u0a05\u0a2a\u0a4d\u0a30\u0a48\u0a32_\u0a2e\u0a08_\u0a1c\u0a42\u0a28_\u0a1c\u0a41\u0a32\u0a3e\u0a08_\u0a05\u0a17\u0a38\u0a24_\u0a38\u0a24\u0a70\u0a2c\u0a30_\u0a05\u0a15\u0a24\u0a42\u0a2c\u0a30_\u0a28\u0a35\u0a70\u0a2c\u0a30_\u0a26\u0a38\u0a70\u0a2c\u0a30".split("_"),monthsShort:"\u0a1c\u0a28\u0a35\u0a30\u0a40_\u0a2b\u0a3c\u0a30\u0a35\u0a30\u0a40_\u0a2e\u0a3e\u0a30\u0a1a_\u0a05\u0a2a\u0a4d\u0a30\u0a48\u0a32_\u0a2e\u0a08_\u0a1c\u0a42\u0a28_\u0a1c\u0a41\u0a32\u0a3e\u0a08_\u0a05\u0a17\u0a38\u0a24_\u0a38\u0a24\u0a70\u0a2c\u0a30_\u0a05\u0a15\u0a24\u0a42\u0a2c\u0a30_\u0a28\u0a35\u0a70\u0a2c\u0a30_\u0a26\u0a38\u0a70\u0a2c\u0a30".split("_"),weekdays:"\u0a10\u0a24\u0a35\u0a3e\u0a30_\u0a38\u0a4b\u0a2e\u0a35\u0a3e\u0a30_\u0a2e\u0a70\u0a17\u0a32\u0a35\u0a3e\u0a30_\u0a2c\u0a41\u0a27\u0a35\u0a3e\u0a30_\u0a35\u0a40\u0a30\u0a35\u0a3e\u0a30_\u0a38\u0a3c\u0a41\u0a71\u0a15\u0a30\u0a35\u0a3e\u0a30_\u0a38\u0a3c\u0a28\u0a40\u0a1a\u0a30\u0a35\u0a3e\u0a30".split("_"),weekdaysShort:"\u0a10\u0a24_\u0a38\u0a4b\u0a2e_\u0a2e\u0a70\u0a17\u0a32_\u0a2c\u0a41\u0a27_\u0a35\u0a40\u0a30_\u0a38\u0a3c\u0a41\u0a15\u0a30_\u0a38\u0a3c\u0a28\u0a40".split("_"),weekdaysMin:"\u0a10\u0a24_\u0a38\u0a4b\u0a2e_\u0a2e\u0a70\u0a17\u0a32_\u0a2c\u0a41\u0a27_\u0a35\u0a40\u0a30_\u0a38\u0a3c\u0a41\u0a15\u0a30_\u0a38\u0a3c\u0a28\u0a40".split("_"),longDateFormat:{LT:"A h:mm \u0a35\u0a1c\u0a47",LTS:"A h:mm:ss \u0a35\u0a1c\u0a47",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u0a35\u0a1c\u0a47",LLLL:"dddd, D MMMM YYYY, A h:mm \u0a35\u0a1c\u0a47"},calendar:{sameDay:"[\u0a05\u0a1c] LT",nextDay:"[\u0a15\u0a32] LT",nextWeek:"[\u0a05\u0a17\u0a32\u0a3e] dddd, LT",lastDay:"[\u0a15\u0a32] LT",lastWeek:"[\u0a2a\u0a3f\u0a1b\u0a32\u0a47] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0a35\u0a3f\u0a71\u0a1a",past:"%s \u0a2a\u0a3f\u0a1b\u0a32\u0a47",s:"\u0a15\u0a41\u0a1d \u0a38\u0a15\u0a3f\u0a70\u0a1f",ss:"%d \u0a38\u0a15\u0a3f\u0a70\u0a1f",m:"\u0a07\u0a15 \u0a2e\u0a3f\u0a70\u0a1f",mm:"%d \u0a2e\u0a3f\u0a70\u0a1f",h:"\u0a07\u0a71\u0a15 \u0a18\u0a70\u0a1f\u0a3e",hh:"%d \u0a18\u0a70\u0a1f\u0a47",d:"\u0a07\u0a71\u0a15 \u0a26\u0a3f\u0a28",dd:"%d \u0a26\u0a3f\u0a28",M:"\u0a07\u0a71\u0a15 \u0a2e\u0a39\u0a40\u0a28\u0a3e",MM:"%d \u0a2e\u0a39\u0a40\u0a28\u0a47",y:"\u0a07\u0a71\u0a15 \u0a38\u0a3e\u0a32",yy:"%d \u0a38\u0a3e\u0a32"},preparse:function(e){return e.replace(/[\u0a67\u0a68\u0a69\u0a6a\u0a6b\u0a6c\u0a6d\u0a6e\u0a6f\u0a66]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u0a30\u0a3e\u0a24|\u0a38\u0a35\u0a47\u0a30|\u0a26\u0a41\u0a2a\u0a39\u0a3f\u0a30|\u0a38\u0a3c\u0a3e\u0a2e/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0a30\u0a3e\u0a24"===t?e<4?e:e+12:"\u0a38\u0a35\u0a47\u0a30"===t?e:"\u0a26\u0a41\u0a2a\u0a39\u0a3f\u0a30"===t?e>=10?e:e+12:"\u0a38\u0a3c\u0a3e\u0a2e"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"\u0a30\u0a3e\u0a24":e<10?"\u0a38\u0a35\u0a47\u0a30":e<17?"\u0a26\u0a41\u0a2a\u0a39\u0a3f\u0a30":e<20?"\u0a38\u0a3c\u0a3e\u0a2e":"\u0a30\u0a3e\u0a24"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){var t="stycze\u0144_luty_marzec_kwiecie\u0144_maj_czerwiec_lipiec_sierpie\u0144_wrzesie\u0144_pa\u017adziernik_listopad_grudzie\u0144".split("_"),n="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrze\u015bnia_pa\u017adziernika_listopada_grudnia".split("_"),r=[/^sty/i,/^lut/i,/^mar/i,/^kwi/i,/^maj/i,/^cze/i,/^lip/i,/^sie/i,/^wrz/i,/^pa\u017a/i,/^lis/i,/^gru/i];function i(e){return e%10<5&&e%10>1&&~~(e/10)%10!=1}function a(e,t,n){var r=e+" ";switch(n){case"ss":return r+(i(e)?"sekundy":"sekund");case"m":return t?"minuta":"minut\u0119";case"mm":return r+(i(e)?"minuty":"minut");case"h":return t?"godzina":"godzin\u0119";case"hh":return r+(i(e)?"godziny":"godzin");case"ww":return r+(i(e)?"tygodnie":"tygodni");case"MM":return r+(i(e)?"miesi\u0105ce":"miesi\u0119cy");case"yy":return r+(i(e)?"lata":"lat")}}e.defineLocale("pl",{months:function(e,r){return e?/D MMMM/.test(r)?n[e.month()]:t[e.month()]:t},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa\u017a_lis_gru".split("_"),monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"niedziela_poniedzia\u0142ek_wtorek_\u015broda_czwartek_pi\u0105tek_sobota".split("_"),weekdaysShort:"ndz_pon_wt_\u015br_czw_pt_sob".split("_"),weekdaysMin:"Nd_Pn_Wt_\u015ar_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Dzi\u015b o] LT",nextDay:"[Jutro o] LT",nextWeek:function(){switch(this.day()){case 0:return"[W niedziel\u0119 o] LT";case 2:return"[We wtorek o] LT";case 3:return"[W \u015brod\u0119 o] LT";case 6:return"[W sobot\u0119 o] LT";default:return"[W] dddd [o] LT"}},lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz\u0142\u0105 niedziel\u0119 o] LT";case 3:return"[W zesz\u0142\u0105 \u015brod\u0119 o] LT";case 6:return"[W zesz\u0142\u0105 sobot\u0119 o] LT";default:return"[W zesz\u0142y] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",ss:a,m:a,mm:a,h:a,hh:a,d:"1 dzie\u0144",dd:"%d dni",w:"tydzie\u0144",ww:a,M:"miesi\u0105c",MM:a,y:"rok",yy:a},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("pt",{months:"janeiro_fevereiro_mar\xe7o_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"Domingo_Segunda-feira_Ter\xe7a-feira_Quarta-feira_Quinta-feira_Sexta-feira_S\xe1bado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_S\xe1b".split("_"),weekdaysMin:"Do_2\xaa_3\xaa_4\xaa_5\xaa_6\xaa_S\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY HH:mm"},calendar:{sameDay:"[Hoje \xe0s] LT",nextDay:"[Amanh\xe3 \xe0s] LT",nextWeek:"dddd [\xe0s] LT",lastDay:"[Ontem \xe0s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[\xdaltimo] dddd [\xe0s] LT":"[\xdaltima] dddd [\xe0s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h\xe1 %s",s:"segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",w:"uma semana",ww:"%d semanas",M:"um m\xeas",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("pt-br",{months:"janeiro_fevereiro_mar\xe7o_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_ter\xe7a-feira_quarta-feira_quinta-feira_sexta-feira_s\xe1bado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_s\xe1b".split("_"),weekdaysMin:"do_2\xaa_3\xaa_4\xaa_5\xaa_6\xaa_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [\xe0s] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [\xe0s] HH:mm"},calendar:{sameDay:"[Hoje \xe0s] LT",nextDay:"[Amanh\xe3 \xe0s] LT",nextWeek:"dddd [\xe0s] LT",lastDay:"[Ontem \xe0s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[\xdaltimo] dddd [\xe0s] LT":"[\xdaltima] dddd [\xe0s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h\xe1 %s",s:"poucos segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um m\xeas",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",invalidDate:"Data inv\xe1lida"})}(n(3))},function(e,t,n){!function(e){function t(e,t,n){var r=" ";return(e%100>=20||e>=100&&e%100==0)&&(r=" de "),e+r+{ss:"secunde",mm:"minute",hh:"ore",dd:"zile",ww:"s\u0103pt\u0103m\xe2ni",MM:"luni",yy:"ani"}[n]}e.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._feb._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"duminic\u0103_luni_mar\u021bi_miercuri_joi_vineri_s\xe2mb\u0103t\u0103".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_S\xe2m".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S\xe2".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[m\xe2ine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s \xeen urm\u0103",s:"c\xe2teva secunde",ss:t,m:"un minut",mm:t,h:"o or\u0103",hh:t,d:"o zi",dd:t,w:"o s\u0103pt\u0103m\xe2n\u0103",ww:t,M:"o lun\u0103",MM:t,y:"un an",yy:t},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n){var r,i;return"m"===n?t?"\u043c\u0438\u043d\u0443\u0442\u0430":"\u043c\u0438\u043d\u0443\u0442\u0443":e+" "+(r=+e,i={ss:t?"\u0441\u0435\u043a\u0443\u043d\u0434\u0430_\u0441\u0435\u043a\u0443\u043d\u0434\u044b_\u0441\u0435\u043a\u0443\u043d\u0434":"\u0441\u0435\u043a\u0443\u043d\u0434\u0443_\u0441\u0435\u043a\u0443\u043d\u0434\u044b_\u0441\u0435\u043a\u0443\u043d\u0434",mm:t?"\u043c\u0438\u043d\u0443\u0442\u0430_\u043c\u0438\u043d\u0443\u0442\u044b_\u043c\u0438\u043d\u0443\u0442":"\u043c\u0438\u043d\u0443\u0442\u0443_\u043c\u0438\u043d\u0443\u0442\u044b_\u043c\u0438\u043d\u0443\u0442",hh:"\u0447\u0430\u0441_\u0447\u0430\u0441\u0430_\u0447\u0430\u0441\u043e\u0432",dd:"\u0434\u0435\u043d\u044c_\u0434\u043d\u044f_\u0434\u043d\u0435\u0439",ww:"\u043d\u0435\u0434\u0435\u043b\u044f_\u043d\u0435\u0434\u0435\u043b\u0438_\u043d\u0435\u0434\u0435\u043b\u044c",MM:"\u043c\u0435\u0441\u044f\u0446_\u043c\u0435\u0441\u044f\u0446\u0430_\u043c\u0435\u0441\u044f\u0446\u0435\u0432",yy:"\u0433\u043e\u0434_\u0433\u043e\u0434\u0430_\u043b\u0435\u0442"}[n].split("_"),r%10==1&&r%100!=11?i[0]:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?i[1]:i[2])}var n=[/^\u044f\u043d\u0432/i,/^\u0444\u0435\u0432/i,/^\u043c\u0430\u0440/i,/^\u0430\u043f\u0440/i,/^\u043c\u0430[\u0439\u044f]/i,/^\u0438\u044e\u043d/i,/^\u0438\u044e\u043b/i,/^\u0430\u0432\u0433/i,/^\u0441\u0435\u043d/i,/^\u043e\u043a\u0442/i,/^\u043d\u043e\u044f/i,/^\u0434\u0435\u043a/i];e.defineLocale("ru",{months:{format:"\u044f\u043d\u0432\u0430\u0440\u044f_\u0444\u0435\u0432\u0440\u0430\u043b\u044f_\u043c\u0430\u0440\u0442\u0430_\u0430\u043f\u0440\u0435\u043b\u044f_\u043c\u0430\u044f_\u0438\u044e\u043d\u044f_\u0438\u044e\u043b\u044f_\u0430\u0432\u0433\u0443\u0441\u0442\u0430_\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f_\u043e\u043a\u0442\u044f\u0431\u0440\u044f_\u043d\u043e\u044f\u0431\u0440\u044f_\u0434\u0435\u043a\u0430\u0431\u0440\u044f".split("_"),standalone:"\u044f\u043d\u0432\u0430\u0440\u044c_\u0444\u0435\u0432\u0440\u0430\u043b\u044c_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0435\u043b\u044c_\u043c\u0430\u0439_\u0438\u044e\u043d\u044c_\u0438\u044e\u043b\u044c_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044c_\u043e\u043a\u0442\u044f\u0431\u0440\u044c_\u043d\u043e\u044f\u0431\u0440\u044c_\u0434\u0435\u043a\u0430\u0431\u0440\u044c".split("_")},monthsShort:{format:"\u044f\u043d\u0432._\u0444\u0435\u0432\u0440._\u043c\u0430\u0440._\u0430\u043f\u0440._\u043c\u0430\u044f_\u0438\u044e\u043d\u044f_\u0438\u044e\u043b\u044f_\u0430\u0432\u0433._\u0441\u0435\u043d\u0442._\u043e\u043a\u0442._\u043d\u043e\u044f\u0431._\u0434\u0435\u043a.".split("_"),standalone:"\u044f\u043d\u0432._\u0444\u0435\u0432\u0440._\u043c\u0430\u0440\u0442_\u0430\u043f\u0440._\u043c\u0430\u0439_\u0438\u044e\u043d\u044c_\u0438\u044e\u043b\u044c_\u0430\u0432\u0433._\u0441\u0435\u043d\u0442._\u043e\u043a\u0442._\u043d\u043e\u044f\u0431._\u0434\u0435\u043a.".split("_")},weekdays:{standalone:"\u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435_\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a_\u0432\u0442\u043e\u0440\u043d\u0438\u043a_\u0441\u0440\u0435\u0434\u0430_\u0447\u0435\u0442\u0432\u0435\u0440\u0433_\u043f\u044f\u0442\u043d\u0438\u0446\u0430_\u0441\u0443\u0431\u0431\u043e\u0442\u0430".split("_"),format:"\u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435_\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a_\u0432\u0442\u043e\u0440\u043d\u0438\u043a_\u0441\u0440\u0435\u0434\u0443_\u0447\u0435\u0442\u0432\u0435\u0440\u0433_\u043f\u044f\u0442\u043d\u0438\u0446\u0443_\u0441\u0443\u0431\u0431\u043e\u0442\u0443".split("_"),isFormat:/\[ ?[\u0412\u0432] ?(?:\u043f\u0440\u043e\u0448\u043b\u0443\u044e|\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e|\u044d\u0442\u0443)? ?] ?dddd/},weekdaysShort:"\u0432\u0441_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),weekdaysMin:"\u0432\u0441_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),monthsParse:n,longMonthsParse:n,shortMonthsParse:n,monthsRegex:/^(\u044f\u043d\u0432\u0430\u0440[\u044c\u044f]|\u044f\u043d\u0432\.?|\u0444\u0435\u0432\u0440\u0430\u043b[\u044c\u044f]|\u0444\u0435\u0432\u0440?\.?|\u043c\u0430\u0440\u0442\u0430?|\u043c\u0430\u0440\.?|\u0430\u043f\u0440\u0435\u043b[\u044c\u044f]|\u0430\u043f\u0440\.?|\u043c\u0430[\u0439\u044f]|\u0438\u044e\u043d[\u044c\u044f]|\u0438\u044e\u043d\.?|\u0438\u044e\u043b[\u044c\u044f]|\u0438\u044e\u043b\.?|\u0430\u0432\u0433\u0443\u0441\u0442\u0430?|\u0430\u0432\u0433\.?|\u0441\u0435\u043d\u0442\u044f\u0431\u0440[\u044c\u044f]|\u0441\u0435\u043d\u0442?\.?|\u043e\u043a\u0442\u044f\u0431\u0440[\u044c\u044f]|\u043e\u043a\u0442\.?|\u043d\u043e\u044f\u0431\u0440[\u044c\u044f]|\u043d\u043e\u044f\u0431?\.?|\u0434\u0435\u043a\u0430\u0431\u0440[\u044c\u044f]|\u0434\u0435\u043a\.?)/i,monthsShortRegex:/^(\u044f\u043d\u0432\u0430\u0440[\u044c\u044f]|\u044f\u043d\u0432\.?|\u0444\u0435\u0432\u0440\u0430\u043b[\u044c\u044f]|\u0444\u0435\u0432\u0440?\.?|\u043c\u0430\u0440\u0442\u0430?|\u043c\u0430\u0440\.?|\u0430\u043f\u0440\u0435\u043b[\u044c\u044f]|\u0430\u043f\u0440\.?|\u043c\u0430[\u0439\u044f]|\u0438\u044e\u043d[\u044c\u044f]|\u0438\u044e\u043d\.?|\u0438\u044e\u043b[\u044c\u044f]|\u0438\u044e\u043b\.?|\u0430\u0432\u0433\u0443\u0441\u0442\u0430?|\u0430\u0432\u0433\.?|\u0441\u0435\u043d\u0442\u044f\u0431\u0440[\u044c\u044f]|\u0441\u0435\u043d\u0442?\.?|\u043e\u043a\u0442\u044f\u0431\u0440[\u044c\u044f]|\u043e\u043a\u0442\.?|\u043d\u043e\u044f\u0431\u0440[\u044c\u044f]|\u043d\u043e\u044f\u0431?\.?|\u0434\u0435\u043a\u0430\u0431\u0440[\u044c\u044f]|\u0434\u0435\u043a\.?)/i,monthsStrictRegex:/^(\u044f\u043d\u0432\u0430\u0440[\u044f\u044c]|\u0444\u0435\u0432\u0440\u0430\u043b[\u044f\u044c]|\u043c\u0430\u0440\u0442\u0430?|\u0430\u043f\u0440\u0435\u043b[\u044f\u044c]|\u043c\u0430[\u044f\u0439]|\u0438\u044e\u043d[\u044f\u044c]|\u0438\u044e\u043b[\u044f\u044c]|\u0430\u0432\u0433\u0443\u0441\u0442\u0430?|\u0441\u0435\u043d\u0442\u044f\u0431\u0440[\u044f\u044c]|\u043e\u043a\u0442\u044f\u0431\u0440[\u044f\u044c]|\u043d\u043e\u044f\u0431\u0440[\u044f\u044c]|\u0434\u0435\u043a\u0430\u0431\u0440[\u044f\u044c])/i,monthsShortStrictRegex:/^(\u044f\u043d\u0432\.|\u0444\u0435\u0432\u0440?\.|\u043c\u0430\u0440[\u0442.]|\u0430\u043f\u0440\.|\u043c\u0430[\u044f\u0439]|\u0438\u044e\u043d[\u044c\u044f.]|\u0438\u044e\u043b[\u044c\u044f.]|\u0430\u0432\u0433\.|\u0441\u0435\u043d\u0442?\.|\u043e\u043a\u0442\.|\u043d\u043e\u044f\u0431?\.|\u0434\u0435\u043a\.)/i,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY \u0433.",LLL:"D MMMM YYYY \u0433., H:mm",LLLL:"dddd, D MMMM YYYY \u0433., H:mm"},calendar:{sameDay:"[\u0421\u0435\u0433\u043e\u0434\u043d\u044f, \u0432] LT",nextDay:"[\u0417\u0430\u0432\u0442\u0440\u0430, \u0432] LT",lastDay:"[\u0412\u0447\u0435\u0440\u0430, \u0432] LT",nextWeek:function(e){if(e.week()===this.week())return 2===this.day()?"[\u0412\u043e] dddd, [\u0432] LT":"[\u0412] dddd, [\u0432] LT";switch(this.day()){case 0:return"[\u0412 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0435] dddd, [\u0432] LT";case 1:case 2:case 4:return"[\u0412 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439] dddd, [\u0432] LT";case 3:case 5:case 6:return"[\u0412 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e] dddd, [\u0432] LT"}},lastWeek:function(e){if(e.week()===this.week())return 2===this.day()?"[\u0412\u043e] dddd, [\u0432] LT":"[\u0412] dddd, [\u0432] LT";switch(this.day()){case 0:return"[\u0412 \u043f\u0440\u043e\u0448\u043b\u043e\u0435] dddd, [\u0432] LT";case 1:case 2:case 4:return"[\u0412 \u043f\u0440\u043e\u0448\u043b\u044b\u0439] dddd, [\u0432] LT";case 3:case 5:case 6:return"[\u0412 \u043f\u0440\u043e\u0448\u043b\u0443\u044e] dddd, [\u0432] LT"}},sameElse:"L"},relativeTime:{future:"\u0447\u0435\u0440\u0435\u0437 %s",past:"%s \u043d\u0430\u0437\u0430\u0434",s:"\u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0441\u0435\u043a\u0443\u043d\u0434",ss:t,m:t,mm:t,h:"\u0447\u0430\u0441",hh:t,d:"\u0434\u0435\u043d\u044c",dd:t,w:"\u043d\u0435\u0434\u0435\u043b\u044f",ww:t,M:"\u043c\u0435\u0441\u044f\u0446",MM:t,y:"\u0433\u043e\u0434",yy:t},meridiemParse:/\u043d\u043e\u0447\u0438|\u0443\u0442\u0440\u0430|\u0434\u043d\u044f|\u0432\u0435\u0447\u0435\u0440\u0430/i,isPM:function(e){return/^(\u0434\u043d\u044f|\u0432\u0435\u0447\u0435\u0440\u0430)$/.test(e)},meridiem:function(e,t,n){return e<4?"\u043d\u043e\u0447\u0438":e<12?"\u0443\u0442\u0440\u0430":e<17?"\u0434\u043d\u044f":"\u0432\u0435\u0447\u0435\u0440\u0430"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0439|\u0433\u043e|\u044f)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-\u0439";case"D":return e+"-\u0433\u043e";case"w":case"W":return e+"-\u044f";default:return e}},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t=["\u062c\u0646\u0648\u0631\u064a","\u0641\u064a\u0628\u0631\u0648\u0631\u064a","\u0645\u0627\u0631\u0686","\u0627\u067e\u0631\u064a\u0644","\u0645\u0626\u064a","\u062c\u0648\u0646","\u062c\u0648\u0644\u0627\u0621\u0650","\u0622\u06af\u0633\u067d","\u0633\u064a\u067e\u067d\u0645\u0628\u0631","\u0622\u06aa\u067d\u0648\u0628\u0631","\u0646\u0648\u0645\u0628\u0631","\u068a\u0633\u0645\u0628\u0631"],n=["\u0622\u0686\u0631","\u0633\u0648\u0645\u0631","\u0627\u06b1\u0627\u0631\u0648","\u0627\u0631\u0628\u0639","\u062e\u0645\u064a\u0633","\u062c\u0645\u0639","\u0687\u0646\u0687\u0631"];e.defineLocale("sd",{months:t,monthsShort:t,weekdays:n,weekdaysShort:n,weekdaysMin:n,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd\u060c D MMMM YYYY HH:mm"},meridiemParse:/\u0635\u0628\u062d|\u0634\u0627\u0645/,isPM:function(e){return"\u0634\u0627\u0645"===e},meridiem:function(e,t,n){return e<12?"\u0635\u0628\u062d":"\u0634\u0627\u0645"},calendar:{sameDay:"[\u0627\u0684] LT",nextDay:"[\u0633\u0680\u0627\u06bb\u064a] LT",nextWeek:"dddd [\u0627\u06b3\u064a\u0646 \u0647\u0641\u062a\u064a \u062a\u064a] LT",lastDay:"[\u06aa\u0627\u0644\u0647\u0647] LT",lastWeek:"[\u06af\u0632\u0631\u064a\u0644 \u0647\u0641\u062a\u064a] dddd [\u062a\u064a] LT",sameElse:"L"},relativeTime:{future:"%s \u067e\u0648\u0621",past:"%s \u0627\u06b3",s:"\u0686\u0646\u062f \u0633\u064a\u06aa\u0646\u068a",ss:"%d \u0633\u064a\u06aa\u0646\u068a",m:"\u0647\u06aa \u0645\u0646\u067d",mm:"%d \u0645\u0646\u067d",h:"\u0647\u06aa \u06aa\u0644\u0627\u06aa",hh:"%d \u06aa\u0644\u0627\u06aa",d:"\u0647\u06aa \u068f\u064a\u0646\u0647\u0646",dd:"%d \u068f\u064a\u0646\u0647\u0646",M:"\u0647\u06aa \u0645\u0647\u064a\u0646\u0648",MM:"%d \u0645\u0647\u064a\u0646\u0627",y:"\u0647\u06aa \u0633\u0627\u0644",yy:"%d \u0633\u0627\u0644"},preparse:function(e){return e.replace(/\u060c/g,",")},postformat:function(e){return e.replace(/,/g,"\u060c")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("se",{months:"o\u0111\u0111ajagem\xe1nnu_guovvam\xe1nnu_njuk\u010dam\xe1nnu_cuo\u014bom\xe1nnu_miessem\xe1nnu_geassem\xe1nnu_suoidnem\xe1nnu_borgem\xe1nnu_\u010dak\u010dam\xe1nnu_golggotm\xe1nnu_sk\xe1bmam\xe1nnu_juovlam\xe1nnu".split("_"),monthsShort:"o\u0111\u0111j_guov_njuk_cuo_mies_geas_suoi_borg_\u010dak\u010d_golg_sk\xe1b_juov".split("_"),weekdays:"sotnabeaivi_vuoss\xe1rga_ma\u014b\u014beb\xe1rga_gaskavahkku_duorastat_bearjadat_l\xe1vvardat".split("_"),weekdaysShort:"sotn_vuos_ma\u014b_gask_duor_bear_l\xe1v".split("_"),weekdaysMin:"s_v_m_g_d_b_L".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"MMMM D. [b.] YYYY",LLL:"MMMM D. [b.] YYYY [ti.] HH:mm",LLLL:"dddd, MMMM D. [b.] YYYY [ti.] HH:mm"},calendar:{sameDay:"[otne ti] LT",nextDay:"[ihttin ti] LT",nextWeek:"dddd [ti] LT",lastDay:"[ikte ti] LT",lastWeek:"[ovddit] dddd [ti] LT",sameElse:"L"},relativeTime:{future:"%s gea\u017ees",past:"ma\u014bit %s",s:"moadde sekunddat",ss:"%d sekunddat",m:"okta minuhta",mm:"%d minuhtat",h:"okta diimmu",hh:"%d diimmut",d:"okta beaivi",dd:"%d beaivvit",M:"okta m\xe1nnu",MM:"%d m\xe1nut",y:"okta jahki",yy:"%d jagit"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("si",{months:"\u0da2\u0db1\u0dc0\u0dcf\u0dbb\u0dd2_\u0db4\u0dd9\u0db6\u0dbb\u0dc0\u0dcf\u0dbb\u0dd2_\u0db8\u0dcf\u0dbb\u0dca\u0dad\u0dd4_\u0d85\u0db4\u0dca\u200d\u0dbb\u0dda\u0dbd\u0dca_\u0db8\u0dd0\u0dba\u0dd2_\u0da2\u0dd6\u0db1\u0dd2_\u0da2\u0dd6\u0dbd\u0dd2_\u0d85\u0d9c\u0ddd\u0dc3\u0dca\u0dad\u0dd4_\u0dc3\u0dd0\u0db4\u0dca\u0dad\u0dd0\u0db8\u0dca\u0db6\u0dbb\u0dca_\u0d94\u0d9a\u0dca\u0dad\u0ddd\u0db6\u0dbb\u0dca_\u0db1\u0ddc\u0dc0\u0dd0\u0db8\u0dca\u0db6\u0dbb\u0dca_\u0daf\u0dd9\u0dc3\u0dd0\u0db8\u0dca\u0db6\u0dbb\u0dca".split("_"),monthsShort:"\u0da2\u0db1_\u0db4\u0dd9\u0db6_\u0db8\u0dcf\u0dbb\u0dca_\u0d85\u0db4\u0dca_\u0db8\u0dd0\u0dba\u0dd2_\u0da2\u0dd6\u0db1\u0dd2_\u0da2\u0dd6\u0dbd\u0dd2_\u0d85\u0d9c\u0ddd_\u0dc3\u0dd0\u0db4\u0dca_\u0d94\u0d9a\u0dca_\u0db1\u0ddc\u0dc0\u0dd0_\u0daf\u0dd9\u0dc3\u0dd0".split("_"),weekdays:"\u0d89\u0dbb\u0dd2\u0daf\u0dcf_\u0dc3\u0db3\u0dd4\u0daf\u0dcf_\u0d85\u0d9f\u0dc4\u0dbb\u0dd4\u0dc0\u0dcf\u0daf\u0dcf_\u0db6\u0daf\u0dcf\u0daf\u0dcf_\u0db6\u0dca\u200d\u0dbb\u0dc4\u0dc3\u0dca\u0db4\u0dad\u0dd2\u0db1\u0dca\u0daf\u0dcf_\u0dc3\u0dd2\u0d9a\u0dd4\u0dbb\u0dcf\u0daf\u0dcf_\u0dc3\u0dd9\u0db1\u0dc3\u0dd4\u0dbb\u0dcf\u0daf\u0dcf".split("_"),weekdaysShort:"\u0d89\u0dbb\u0dd2_\u0dc3\u0db3\u0dd4_\u0d85\u0d9f_\u0db6\u0daf\u0dcf_\u0db6\u0dca\u200d\u0dbb\u0dc4_\u0dc3\u0dd2\u0d9a\u0dd4_\u0dc3\u0dd9\u0db1".split("_"),weekdaysMin:"\u0d89_\u0dc3_\u0d85_\u0db6_\u0db6\u0dca\u200d\u0dbb_\u0dc3\u0dd2_\u0dc3\u0dd9".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"a h:mm",LTS:"a h:mm:ss",L:"YYYY/MM/DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D, a h:mm",LLLL:"YYYY MMMM D [\u0dc0\u0dd0\u0db1\u0dd2] dddd, a h:mm:ss"},calendar:{sameDay:"[\u0d85\u0daf] LT[\u0da7]",nextDay:"[\u0dc4\u0dd9\u0da7] LT[\u0da7]",nextWeek:"dddd LT[\u0da7]",lastDay:"[\u0d8a\u0dba\u0dda] LT[\u0da7]",lastWeek:"[\u0db4\u0dc3\u0dd4\u0d9c\u0dd2\u0dba] dddd LT[\u0da7]",sameElse:"L"},relativeTime:{future:"%s\u0d9a\u0dd2\u0db1\u0dca",past:"%s\u0d9a\u0da7 \u0db4\u0dd9\u0dbb",s:"\u0dad\u0dad\u0dca\u0db4\u0dbb \u0d9a\u0dd2\u0dc4\u0dd2\u0db4\u0dba",ss:"\u0dad\u0dad\u0dca\u0db4\u0dbb %d",m:"\u0db8\u0dd2\u0db1\u0dd2\u0dad\u0dca\u0dad\u0dd4\u0dc0",mm:"\u0db8\u0dd2\u0db1\u0dd2\u0dad\u0dca\u0dad\u0dd4 %d",h:"\u0db4\u0dd0\u0dba",hh:"\u0db4\u0dd0\u0dba %d",d:"\u0daf\u0dd2\u0db1\u0dba",dd:"\u0daf\u0dd2\u0db1 %d",M:"\u0db8\u0dcf\u0dc3\u0dba",MM:"\u0db8\u0dcf\u0dc3 %d",y:"\u0dc0\u0dc3\u0dbb",yy:"\u0dc0\u0dc3\u0dbb %d"},dayOfMonthOrdinalParse:/\d{1,2} \u0dc0\u0dd0\u0db1\u0dd2/,ordinal:function(e){return e+" \u0dc0\u0dd0\u0db1\u0dd2"},meridiemParse:/\u0db4\u0dd9\u0dbb \u0dc0\u0dbb\u0dd4|\u0db4\u0dc3\u0dca \u0dc0\u0dbb\u0dd4|\u0db4\u0dd9.\u0dc0|\u0db4.\u0dc0./,isPM:function(e){return"\u0db4.\u0dc0."===e||"\u0db4\u0dc3\u0dca \u0dc0\u0dbb\u0dd4"===e},meridiem:function(e,t,n){return e>11?n?"\u0db4.\u0dc0.":"\u0db4\u0dc3\u0dca \u0dc0\u0dbb\u0dd4":n?"\u0db4\u0dd9.\u0dc0.":"\u0db4\u0dd9\u0dbb \u0dc0\u0dbb\u0dd4"}})}(n(3))},function(e,t,n){!function(e){var t="janu\xe1r_febru\xe1r_marec_apr\xedl_m\xe1j_j\xfan_j\xfal_august_september_okt\xf3ber_november_december".split("_"),n="jan_feb_mar_apr_m\xe1j_j\xfan_j\xfal_aug_sep_okt_nov_dec".split("_");function r(e){return e>1&&e<5}function i(e,t,n,i){var a=e+" ";switch(n){case"s":return t||i?"p\xe1r sek\xfand":"p\xe1r sekundami";case"ss":return t||i?a+(r(e)?"sekundy":"sek\xfand"):a+"sekundami";case"m":return t?"min\xfata":i?"min\xfatu":"min\xfatou";case"mm":return t||i?a+(r(e)?"min\xfaty":"min\xfat"):a+"min\xfatami";case"h":return t?"hodina":i?"hodinu":"hodinou";case"hh":return t||i?a+(r(e)?"hodiny":"hod\xedn"):a+"hodinami";case"d":return t||i?"de\u0148":"d\u0148om";case"dd":return t||i?a+(r(e)?"dni":"dn\xed"):a+"d\u0148ami";case"M":return t||i?"mesiac":"mesiacom";case"MM":return t||i?a+(r(e)?"mesiace":"mesiacov"):a+"mesiacmi";case"y":return t||i?"rok":"rokom";case"yy":return t||i?a+(r(e)?"roky":"rokov"):a+"rokmi"}}e.defineLocale("sk",{months:t,monthsShort:n,weekdays:"nede\u013ea_pondelok_utorok_streda_\u0161tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_\u0161t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_\u0161t_pi_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nede\u013eu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo \u0161tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[v\u010dera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul\xfa nede\u013eu o] LT";case 1:case 2:return"[minul\xfd] dddd [o] LT";case 3:return"[minul\xfa stredu o] LT";case 4:case 5:return"[minul\xfd] dddd [o] LT";case 6:return"[minul\xfa sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:i,ss:i,m:i,mm:i,h:i,hh:i,d:i,dd:i,M:i,MM:i,y:i,yy:i},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i=e+" ";switch(n){case"s":return t||r?"nekaj sekund":"nekaj sekundami";case"ss":return i+(1===e?t?"sekundo":"sekundi":2===e?t||r?"sekundi":"sekundah":e<5?t||r?"sekunde":"sekundah":"sekund");case"m":return t?"ena minuta":"eno minuto";case"mm":return i+(1===e?t?"minuta":"minuto":2===e?t||r?"minuti":"minutama":e<5?t||r?"minute":"minutami":t||r?"minut":"minutami");case"h":return t?"ena ura":"eno uro";case"hh":return i+(1===e?t?"ura":"uro":2===e?t||r?"uri":"urama":e<5?t||r?"ure":"urami":t||r?"ur":"urami");case"d":return t||r?"en dan":"enim dnem";case"dd":return i+(1===e?t||r?"dan":"dnem":2===e?t||r?"dni":"dnevoma":t||r?"dni":"dnevi");case"M":return t||r?"en mesec":"enim mesecem";case"MM":return i+(1===e?t||r?"mesec":"mesecem":2===e?t||r?"meseca":"mesecema":e<5?t||r?"mesece":"meseci":t||r?"mesecev":"meseci");case"y":return t||r?"eno leto":"enim letom";case"yy":return i+(1===e?t||r?"leto":"letom":2===e?t||r?"leti":"letoma":e<5?t||r?"leta":"leti":t||r?"let":"leti")}}e.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljek_torek_sreda_\u010detrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._\u010det._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_\u010de_pe_so".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[v\u010deraj ob] LT",lastWeek:function(){switch(this.day()){case 0:return"[prej\u0161njo] [nedeljo] [ob] LT";case 3:return"[prej\u0161njo] [sredo] [ob] LT";case 6:return"[prej\u0161njo] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[prej\u0161nji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"\u010dez %s",past:"pred %s",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_N\xebntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_N\xebn_Dhj".split("_"),weekdays:"E Diel_E H\xebn\xeb_E Mart\xeb_E M\xebrkur\xeb_E Enjte_E Premte_E Shtun\xeb".split("_"),weekdaysShort:"Die_H\xebn_Mar_M\xebr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M\xeb_E_P_Sh".split("_"),weekdaysParseExact:!0,meridiemParse:/PD|MD/,isPM:function(e){return"M"===e.charAt(0)},meridiem:function(e,t,n){return e<12?"PD":"MD"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Sot n\xeb] LT",nextDay:"[Nes\xebr n\xeb] LT",nextWeek:"dddd [n\xeb] LT",lastDay:"[Dje n\xeb] LT",lastWeek:"dddd [e kaluar n\xeb] LT",sameElse:"L"},relativeTime:{future:"n\xeb %s",past:"%s m\xeb par\xeb",s:"disa sekonda",ss:"%d sekonda",m:"nj\xeb minut\xeb",mm:"%d minuta",h:"nj\xeb or\xeb",hh:"%d or\xeb",d:"nj\xeb dit\xeb",dd:"%d dit\xeb",M:"nj\xeb muaj",MM:"%d muaj",y:"nj\xeb vit",yy:"%d vite"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={words:{ss:["sekunda","sekunde","sekundi"],m:["jedan minut","jedne minute"],mm:["minut","minute","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mesec","meseca","meseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&e<=4?t[1]:t[2]},translate:function(e,n,r){var i=t.words[r];return 1===r.length?n?i[0]:i[1]:e+" "+t.correctGrammaticalCase(e,i)}};e.defineLocale("sr",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljak_utorak_sreda_\u010detvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sre._\u010det._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_\u010de_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D. M. YYYY.",LL:"D. MMMM YYYY.",LLL:"D. MMMM YYYY. H:mm",LLLL:"dddd, D. MMMM YYYY. H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[ju\u010de u] LT",lastWeek:function(){return["[pro\u0161le] [nedelje] [u] LT","[pro\u0161log] [ponedeljka] [u] LT","[pro\u0161log] [utorka] [u] LT","[pro\u0161le] [srede] [u] LT","[pro\u0161log] [\u010detvrtka] [u] LT","[pro\u0161log] [petka] [u] LT","[pro\u0161le] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"dan",dd:t.translate,M:"mesec",MM:t.translate,y:"godinu",yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){var t={words:{ss:["\u0441\u0435\u043a\u0443\u043d\u0434\u0430","\u0441\u0435\u043a\u0443\u043d\u0434\u0435","\u0441\u0435\u043a\u0443\u043d\u0434\u0438"],m:["\u0458\u0435\u0434\u0430\u043d \u043c\u0438\u043d\u0443\u0442","\u0458\u0435\u0434\u043d\u0435 \u043c\u0438\u043d\u0443\u0442\u0435"],mm:["\u043c\u0438\u043d\u0443\u0442","\u043c\u0438\u043d\u0443\u0442\u0435","\u043c\u0438\u043d\u0443\u0442\u0430"],h:["\u0458\u0435\u0434\u0430\u043d \u0441\u0430\u0442","\u0458\u0435\u0434\u043d\u043e\u0433 \u0441\u0430\u0442\u0430"],hh:["\u0441\u0430\u0442","\u0441\u0430\u0442\u0430","\u0441\u0430\u0442\u0438"],dd:["\u0434\u0430\u043d","\u0434\u0430\u043d\u0430","\u0434\u0430\u043d\u0430"],MM:["\u043c\u0435\u0441\u0435\u0446","\u043c\u0435\u0441\u0435\u0446\u0430","\u043c\u0435\u0441\u0435\u0446\u0438"],yy:["\u0433\u043e\u0434\u0438\u043d\u0430","\u0433\u043e\u0434\u0438\u043d\u0435","\u0433\u043e\u0434\u0438\u043d\u0430"]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&e<=4?t[1]:t[2]},translate:function(e,n,r){var i=t.words[r];return 1===r.length?n?i[0]:i[1]:e+" "+t.correctGrammaticalCase(e,i)}};e.defineLocale("sr-cyrl",{months:"\u0458\u0430\u043d\u0443\u0430\u0440_\u0444\u0435\u0431\u0440\u0443\u0430\u0440_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0438\u043b_\u043c\u0430\u0458_\u0458\u0443\u043d_\u0458\u0443\u043b_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043f\u0442\u0435\u043c\u0431\u0430\u0440_\u043e\u043a\u0442\u043e\u0431\u0430\u0440_\u043d\u043e\u0432\u0435\u043c\u0431\u0430\u0440_\u0434\u0435\u0446\u0435\u043c\u0431\u0430\u0440".split("_"),monthsShort:"\u0458\u0430\u043d._\u0444\u0435\u0431._\u043c\u0430\u0440._\u0430\u043f\u0440._\u043c\u0430\u0458_\u0458\u0443\u043d_\u0458\u0443\u043b_\u0430\u0432\u0433._\u0441\u0435\u043f._\u043e\u043a\u0442._\u043d\u043e\u0432._\u0434\u0435\u0446.".split("_"),monthsParseExact:!0,weekdays:"\u043d\u0435\u0434\u0435\u0459\u0430_\u043f\u043e\u043d\u0435\u0434\u0435\u0459\u0430\u043a_\u0443\u0442\u043e\u0440\u0430\u043a_\u0441\u0440\u0435\u0434\u0430_\u0447\u0435\u0442\u0432\u0440\u0442\u0430\u043a_\u043f\u0435\u0442\u0430\u043a_\u0441\u0443\u0431\u043e\u0442\u0430".split("_"),weekdaysShort:"\u043d\u0435\u0434._\u043f\u043e\u043d._\u0443\u0442\u043e._\u0441\u0440\u0435._\u0447\u0435\u0442._\u043f\u0435\u0442._\u0441\u0443\u0431.".split("_"),weekdaysMin:"\u043d\u0435_\u043f\u043e_\u0443\u0442_\u0441\u0440_\u0447\u0435_\u043f\u0435_\u0441\u0443".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D. M. YYYY.",LL:"D. MMMM YYYY.",LLL:"D. MMMM YYYY. H:mm",LLLL:"dddd, D. MMMM YYYY. H:mm"},calendar:{sameDay:"[\u0434\u0430\u043d\u0430\u0441 \u0443] LT",nextDay:"[\u0441\u0443\u0442\u0440\u0430 \u0443] LT",nextWeek:function(){switch(this.day()){case 0:return"[\u0443] [\u043d\u0435\u0434\u0435\u0459\u0443] [\u0443] LT";case 3:return"[\u0443] [\u0441\u0440\u0435\u0434\u0443] [\u0443] LT";case 6:return"[\u0443] [\u0441\u0443\u0431\u043e\u0442\u0443] [\u0443] LT";case 1:case 2:case 4:case 5:return"[\u0443] dddd [\u0443] LT"}},lastDay:"[\u0458\u0443\u0447\u0435 \u0443] LT",lastWeek:function(){return["[\u043f\u0440\u043e\u0448\u043b\u0435] [\u043d\u0435\u0434\u0435\u0459\u0435] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u043e\u0433] [\u043f\u043e\u043d\u0435\u0434\u0435\u0459\u043a\u0430] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u043e\u0433] [\u0443\u0442\u043e\u0440\u043a\u0430] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u0435] [\u0441\u0440\u0435\u0434\u0435] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u043e\u0433] [\u0447\u0435\u0442\u0432\u0440\u0442\u043a\u0430] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u043e\u0433] [\u043f\u0435\u0442\u043a\u0430] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u0435] [\u0441\u0443\u0431\u043e\u0442\u0435] [\u0443] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"\u0437\u0430 %s",past:"\u043f\u0440\u0435 %s",s:"\u043d\u0435\u043a\u043e\u043b\u0438\u043a\u043e \u0441\u0435\u043a\u0443\u043d\u0434\u0438",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"\u0434\u0430\u043d",dd:t.translate,M:"\u043c\u0435\u0441\u0435\u0446",MM:t.translate,y:"\u0433\u043e\u0434\u0438\u043d\u0443",yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ss",{months:"Bhimbidvwane_Indlovana_Indlov'lenkhulu_Mabasa_Inkhwekhweti_Inhlaba_Kholwane_Ingci_Inyoni_Imphala_Lweti_Ingongoni".split("_"),monthsShort:"Bhi_Ina_Inu_Mab_Ink_Inh_Kho_Igc_Iny_Imp_Lwe_Igo".split("_"),weekdays:"Lisontfo_Umsombuluko_Lesibili_Lesitsatfu_Lesine_Lesihlanu_Umgcibelo".split("_"),weekdaysShort:"Lis_Umb_Lsb_Les_Lsi_Lsh_Umg".split("_"),weekdaysMin:"Li_Us_Lb_Lt_Ls_Lh_Ug".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Namuhla nga] LT",nextDay:"[Kusasa nga] LT",nextWeek:"dddd [nga] LT",lastDay:"[Itolo nga] LT",lastWeek:"dddd [leliphelile] [nga] LT",sameElse:"L"},relativeTime:{future:"nga %s",past:"wenteka nga %s",s:"emizuzwana lomcane",ss:"%d mzuzwana",m:"umzuzu",mm:"%d emizuzu",h:"lihora",hh:"%d emahora",d:"lilanga",dd:"%d emalanga",M:"inyanga",MM:"%d tinyanga",y:"umnyaka",yy:"%d iminyaka"},meridiemParse:/ekuseni|emini|entsambama|ebusuku/,meridiem:function(e,t,n){return e<11?"ekuseni":e<15?"emini":e<19?"entsambama":"ebusuku"},meridiemHour:function(e,t){return 12===e&&(e=0),"ekuseni"===t?e:"emini"===t?e>=11?e:e+12:"entsambama"===t||"ebusuku"===t?0===e?0:e+12:void 0},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"s\xf6ndag_m\xe5ndag_tisdag_onsdag_torsdag_fredag_l\xf6rdag".split("_"),weekdaysShort:"s\xf6n_m\xe5n_tis_ons_tor_fre_l\xf6r".split("_"),weekdaysMin:"s\xf6_m\xe5_ti_on_to_fr_l\xf6".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [kl.] HH:mm",LLLL:"dddd D MMMM YYYY [kl.] HH:mm",lll:"D MMM YYYY HH:mm",llll:"ddd D MMM YYYY HH:mm"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Ig\xe5r] LT",nextWeek:"[P\xe5] dddd LT",lastWeek:"[I] dddd[s] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"f\xf6r %s sedan",s:"n\xe5gra sekunder",ss:"%d sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en m\xe5nad",MM:"%d m\xe5nader",y:"ett \xe5r",yy:"%d \xe5r"},dayOfMonthOrdinalParse:/\d{1,2}(\:e|\:a)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?":e":1===t||2===t?":a":":e")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("sw",{months:"Januari_Februari_Machi_Aprili_Mei_Juni_Julai_Agosti_Septemba_Oktoba_Novemba_Desemba".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ago_Sep_Okt_Nov_Des".split("_"),weekdays:"Jumapili_Jumatatu_Jumanne_Jumatano_Alhamisi_Ijumaa_Jumamosi".split("_"),weekdaysShort:"Jpl_Jtat_Jnne_Jtan_Alh_Ijm_Jmos".split("_"),weekdaysMin:"J2_J3_J4_J5_Al_Ij_J1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"hh:mm A",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[leo saa] LT",nextDay:"[kesho saa] LT",nextWeek:"[wiki ijayo] dddd [saat] LT",lastDay:"[jana] LT",lastWeek:"[wiki iliyopita] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s baadaye",past:"tokea %s",s:"hivi punde",ss:"sekunde %d",m:"dakika moja",mm:"dakika %d",h:"saa limoja",hh:"masaa %d",d:"siku moja",dd:"siku %d",M:"mwezi mmoja",MM:"miezi %d",y:"mwaka mmoja",yy:"miaka %d"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){var t={1:"\u0be7",2:"\u0be8",3:"\u0be9",4:"\u0bea",5:"\u0beb",6:"\u0bec",7:"\u0bed",8:"\u0bee",9:"\u0bef",0:"\u0be6"},n={"\u0be7":"1","\u0be8":"2","\u0be9":"3","\u0bea":"4","\u0beb":"5","\u0bec":"6","\u0bed":"7","\u0bee":"8","\u0bef":"9","\u0be6":"0"};e.defineLocale("ta",{months:"\u0b9c\u0ba9\u0bb5\u0bb0\u0bbf_\u0baa\u0bbf\u0baa\u0bcd\u0bb0\u0bb5\u0bb0\u0bbf_\u0bae\u0bbe\u0bb0\u0bcd\u0b9a\u0bcd_\u0b8f\u0baa\u0bcd\u0bb0\u0bb2\u0bcd_\u0bae\u0bc7_\u0b9c\u0bc2\u0ba9\u0bcd_\u0b9c\u0bc2\u0bb2\u0bc8_\u0b86\u0b95\u0bb8\u0bcd\u0b9f\u0bcd_\u0b9a\u0bc6\u0baa\u0bcd\u0b9f\u0bc6\u0bae\u0bcd\u0baa\u0bb0\u0bcd_\u0b85\u0b95\u0bcd\u0b9f\u0bc7\u0bbe\u0baa\u0bb0\u0bcd_\u0ba8\u0bb5\u0bae\u0bcd\u0baa\u0bb0\u0bcd_\u0b9f\u0bbf\u0b9a\u0bae\u0bcd\u0baa\u0bb0\u0bcd".split("_"),monthsShort:"\u0b9c\u0ba9\u0bb5\u0bb0\u0bbf_\u0baa\u0bbf\u0baa\u0bcd\u0bb0\u0bb5\u0bb0\u0bbf_\u0bae\u0bbe\u0bb0\u0bcd\u0b9a\u0bcd_\u0b8f\u0baa\u0bcd\u0bb0\u0bb2\u0bcd_\u0bae\u0bc7_\u0b9c\u0bc2\u0ba9\u0bcd_\u0b9c\u0bc2\u0bb2\u0bc8_\u0b86\u0b95\u0bb8\u0bcd\u0b9f\u0bcd_\u0b9a\u0bc6\u0baa\u0bcd\u0b9f\u0bc6\u0bae\u0bcd\u0baa\u0bb0\u0bcd_\u0b85\u0b95\u0bcd\u0b9f\u0bc7\u0bbe\u0baa\u0bb0\u0bcd_\u0ba8\u0bb5\u0bae\u0bcd\u0baa\u0bb0\u0bcd_\u0b9f\u0bbf\u0b9a\u0bae\u0bcd\u0baa\u0bb0\u0bcd".split("_"),weekdays:"\u0b9e\u0bbe\u0baf\u0bbf\u0bb1\u0bcd\u0bb1\u0bc1\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0ba4\u0bbf\u0b99\u0bcd\u0b95\u0b9f\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0b9a\u0bc6\u0bb5\u0bcd\u0bb5\u0bbe\u0baf\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0baa\u0bc1\u0ba4\u0ba9\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0bb5\u0bbf\u0baf\u0bbe\u0bb4\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0bb5\u0bc6\u0bb3\u0bcd\u0bb3\u0bbf\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0b9a\u0ba9\u0bbf\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8".split("_"),weekdaysShort:"\u0b9e\u0bbe\u0baf\u0bbf\u0bb1\u0bc1_\u0ba4\u0bbf\u0b99\u0bcd\u0b95\u0bb3\u0bcd_\u0b9a\u0bc6\u0bb5\u0bcd\u0bb5\u0bbe\u0baf\u0bcd_\u0baa\u0bc1\u0ba4\u0ba9\u0bcd_\u0bb5\u0bbf\u0baf\u0bbe\u0bb4\u0ba9\u0bcd_\u0bb5\u0bc6\u0bb3\u0bcd\u0bb3\u0bbf_\u0b9a\u0ba9\u0bbf".split("_"),weekdaysMin:"\u0b9e\u0bbe_\u0ba4\u0bbf_\u0b9a\u0bc6_\u0baa\u0bc1_\u0bb5\u0bbf_\u0bb5\u0bc6_\u0b9a".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, HH:mm",LLLL:"dddd, D MMMM YYYY, HH:mm"},calendar:{sameDay:"[\u0b87\u0ba9\u0bcd\u0bb1\u0bc1] LT",nextDay:"[\u0ba8\u0bbe\u0bb3\u0bc8] LT",nextWeek:"dddd, LT",lastDay:"[\u0ba8\u0bc7\u0bb1\u0bcd\u0bb1\u0bc1] LT",lastWeek:"[\u0b95\u0b9f\u0ba8\u0bcd\u0ba4 \u0bb5\u0bbe\u0bb0\u0bae\u0bcd] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0b87\u0bb2\u0bcd",past:"%s \u0bae\u0bc1\u0ba9\u0bcd",s:"\u0b92\u0bb0\u0bc1 \u0b9a\u0bbf\u0bb2 \u0bb5\u0bbf\u0ba8\u0bbe\u0b9f\u0bbf\u0b95\u0bb3\u0bcd",ss:"%d \u0bb5\u0bbf\u0ba8\u0bbe\u0b9f\u0bbf\u0b95\u0bb3\u0bcd",m:"\u0b92\u0bb0\u0bc1 \u0ba8\u0bbf\u0bae\u0bbf\u0b9f\u0bae\u0bcd",mm:"%d \u0ba8\u0bbf\u0bae\u0bbf\u0b9f\u0b99\u0bcd\u0b95\u0bb3\u0bcd",h:"\u0b92\u0bb0\u0bc1 \u0bae\u0ba3\u0bbf \u0ba8\u0bc7\u0bb0\u0bae\u0bcd",hh:"%d \u0bae\u0ba3\u0bbf \u0ba8\u0bc7\u0bb0\u0bae\u0bcd",d:"\u0b92\u0bb0\u0bc1 \u0ba8\u0bbe\u0bb3\u0bcd",dd:"%d \u0ba8\u0bbe\u0b9f\u0bcd\u0b95\u0bb3\u0bcd",M:"\u0b92\u0bb0\u0bc1 \u0bae\u0bbe\u0ba4\u0bae\u0bcd",MM:"%d \u0bae\u0bbe\u0ba4\u0b99\u0bcd\u0b95\u0bb3\u0bcd",y:"\u0b92\u0bb0\u0bc1 \u0bb5\u0bb0\u0bc1\u0b9f\u0bae\u0bcd",yy:"%d \u0b86\u0ba3\u0bcd\u0b9f\u0bc1\u0b95\u0bb3\u0bcd"},dayOfMonthOrdinalParse:/\d{1,2}\u0bb5\u0ba4\u0bc1/,ordinal:function(e){return e+"\u0bb5\u0ba4\u0bc1"},preparse:function(e){return e.replace(/[\u0be7\u0be8\u0be9\u0bea\u0beb\u0bec\u0bed\u0bee\u0bef\u0be6]/g,(function(e){return n[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/\u0baf\u0bbe\u0bae\u0bae\u0bcd|\u0bb5\u0bc8\u0b95\u0bb1\u0bc8|\u0b95\u0bbe\u0bb2\u0bc8|\u0ba8\u0ba3\u0bcd\u0baa\u0b95\u0bb2\u0bcd|\u0b8e\u0bb1\u0bcd\u0baa\u0bbe\u0b9f\u0bc1|\u0bae\u0bbe\u0bb2\u0bc8/,meridiem:function(e,t,n){return e<2?" \u0baf\u0bbe\u0bae\u0bae\u0bcd":e<6?" \u0bb5\u0bc8\u0b95\u0bb1\u0bc8":e<10?" \u0b95\u0bbe\u0bb2\u0bc8":e<14?" \u0ba8\u0ba3\u0bcd\u0baa\u0b95\u0bb2\u0bcd":e<18?" \u0b8e\u0bb1\u0bcd\u0baa\u0bbe\u0b9f\u0bc1":e<22?" \u0bae\u0bbe\u0bb2\u0bc8":" \u0baf\u0bbe\u0bae\u0bae\u0bcd"},meridiemHour:function(e,t){return 12===e&&(e=0),"\u0baf\u0bbe\u0bae\u0bae\u0bcd"===t?e<2?e:e+12:"\u0bb5\u0bc8\u0b95\u0bb1\u0bc8"===t||"\u0b95\u0bbe\u0bb2\u0bc8"===t||"\u0ba8\u0ba3\u0bcd\u0baa\u0b95\u0bb2\u0bcd"===t&&e>=10?e:e+12},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("te",{months:"\u0c1c\u0c28\u0c35\u0c30\u0c3f_\u0c2b\u0c3f\u0c2c\u0c4d\u0c30\u0c35\u0c30\u0c3f_\u0c2e\u0c3e\u0c30\u0c4d\u0c1a\u0c3f_\u0c0f\u0c2a\u0c4d\u0c30\u0c3f\u0c32\u0c4d_\u0c2e\u0c47_\u0c1c\u0c42\u0c28\u0c4d_\u0c1c\u0c41\u0c32\u0c48_\u0c06\u0c17\u0c38\u0c4d\u0c1f\u0c41_\u0c38\u0c46\u0c2a\u0c4d\u0c1f\u0c46\u0c02\u0c2c\u0c30\u0c4d_\u0c05\u0c15\u0c4d\u0c1f\u0c4b\u0c2c\u0c30\u0c4d_\u0c28\u0c35\u0c02\u0c2c\u0c30\u0c4d_\u0c21\u0c3f\u0c38\u0c46\u0c02\u0c2c\u0c30\u0c4d".split("_"),monthsShort:"\u0c1c\u0c28._\u0c2b\u0c3f\u0c2c\u0c4d\u0c30._\u0c2e\u0c3e\u0c30\u0c4d\u0c1a\u0c3f_\u0c0f\u0c2a\u0c4d\u0c30\u0c3f._\u0c2e\u0c47_\u0c1c\u0c42\u0c28\u0c4d_\u0c1c\u0c41\u0c32\u0c48_\u0c06\u0c17._\u0c38\u0c46\u0c2a\u0c4d._\u0c05\u0c15\u0c4d\u0c1f\u0c4b._\u0c28\u0c35._\u0c21\u0c3f\u0c38\u0c46.".split("_"),monthsParseExact:!0,weekdays:"\u0c06\u0c26\u0c3f\u0c35\u0c3e\u0c30\u0c02_\u0c38\u0c4b\u0c2e\u0c35\u0c3e\u0c30\u0c02_\u0c2e\u0c02\u0c17\u0c33\u0c35\u0c3e\u0c30\u0c02_\u0c2c\u0c41\u0c27\u0c35\u0c3e\u0c30\u0c02_\u0c17\u0c41\u0c30\u0c41\u0c35\u0c3e\u0c30\u0c02_\u0c36\u0c41\u0c15\u0c4d\u0c30\u0c35\u0c3e\u0c30\u0c02_\u0c36\u0c28\u0c3f\u0c35\u0c3e\u0c30\u0c02".split("_"),weekdaysShort:"\u0c06\u0c26\u0c3f_\u0c38\u0c4b\u0c2e_\u0c2e\u0c02\u0c17\u0c33_\u0c2c\u0c41\u0c27_\u0c17\u0c41\u0c30\u0c41_\u0c36\u0c41\u0c15\u0c4d\u0c30_\u0c36\u0c28\u0c3f".split("_"),weekdaysMin:"\u0c06_\u0c38\u0c4b_\u0c2e\u0c02_\u0c2c\u0c41_\u0c17\u0c41_\u0c36\u0c41_\u0c36".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[\u0c28\u0c47\u0c21\u0c41] LT",nextDay:"[\u0c30\u0c47\u0c2a\u0c41] LT",nextWeek:"dddd, LT",lastDay:"[\u0c28\u0c3f\u0c28\u0c4d\u0c28] LT",lastWeek:"[\u0c17\u0c24] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0c32\u0c4b",past:"%s \u0c15\u0c4d\u0c30\u0c3f\u0c24\u0c02",s:"\u0c15\u0c4a\u0c28\u0c4d\u0c28\u0c3f \u0c15\u0c4d\u0c37\u0c23\u0c3e\u0c32\u0c41",ss:"%d \u0c38\u0c46\u0c15\u0c28\u0c4d\u0c32\u0c41",m:"\u0c12\u0c15 \u0c28\u0c3f\u0c2e\u0c3f\u0c37\u0c02",mm:"%d \u0c28\u0c3f\u0c2e\u0c3f\u0c37\u0c3e\u0c32\u0c41",h:"\u0c12\u0c15 \u0c17\u0c02\u0c1f",hh:"%d \u0c17\u0c02\u0c1f\u0c32\u0c41",d:"\u0c12\u0c15 \u0c30\u0c4b\u0c1c\u0c41",dd:"%d \u0c30\u0c4b\u0c1c\u0c41\u0c32\u0c41",M:"\u0c12\u0c15 \u0c28\u0c46\u0c32",MM:"%d \u0c28\u0c46\u0c32\u0c32\u0c41",y:"\u0c12\u0c15 \u0c38\u0c02\u0c35\u0c24\u0c4d\u0c38\u0c30\u0c02",yy:"%d \u0c38\u0c02\u0c35\u0c24\u0c4d\u0c38\u0c30\u0c3e\u0c32\u0c41"},dayOfMonthOrdinalParse:/\d{1,2}\u0c35/,ordinal:"%d\u0c35",meridiemParse:/\u0c30\u0c3e\u0c24\u0c4d\u0c30\u0c3f|\u0c09\u0c26\u0c2f\u0c02|\u0c2e\u0c27\u0c4d\u0c2f\u0c3e\u0c39\u0c4d\u0c28\u0c02|\u0c38\u0c3e\u0c2f\u0c02\u0c24\u0c4d\u0c30\u0c02/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0c30\u0c3e\u0c24\u0c4d\u0c30\u0c3f"===t?e<4?e:e+12:"\u0c09\u0c26\u0c2f\u0c02"===t?e:"\u0c2e\u0c27\u0c4d\u0c2f\u0c3e\u0c39\u0c4d\u0c28\u0c02"===t?e>=10?e:e+12:"\u0c38\u0c3e\u0c2f\u0c02\u0c24\u0c4d\u0c30\u0c02"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"\u0c30\u0c3e\u0c24\u0c4d\u0c30\u0c3f":e<10?"\u0c09\u0c26\u0c2f\u0c02":e<17?"\u0c2e\u0c27\u0c4d\u0c2f\u0c3e\u0c39\u0c4d\u0c28\u0c02":e<20?"\u0c38\u0c3e\u0c2f\u0c02\u0c24\u0c4d\u0c30\u0c02":"\u0c30\u0c3e\u0c24\u0c4d\u0c30\u0c3f"},week:{dow:0,doy:6}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("tet",{months:"Janeiru_Fevereiru_Marsu_Abril_Maiu_Ju\xf1u_Jullu_Agustu_Setembru_Outubru_Novembru_Dezembru".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingu_Segunda_Tersa_Kuarta_Kinta_Sesta_Sabadu".split("_"),weekdaysShort:"Dom_Seg_Ters_Kua_Kint_Sest_Sab".split("_"),weekdaysMin:"Do_Seg_Te_Ku_Ki_Ses_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Ohin iha] LT",nextDay:"[Aban iha] LT",nextWeek:"dddd [iha] LT",lastDay:"[Horiseik iha] LT",lastWeek:"dddd [semana kotuk] [iha] LT",sameElse:"L"},relativeTime:{future:"iha %s",past:"%s liuba",s:"segundu balun",ss:"segundu %d",m:"minutu ida",mm:"minutu %d",h:"oras ida",hh:"oras %d",d:"loron ida",dd:"loron %d",M:"fulan ida",MM:"fulan %d",y:"tinan ida",yy:"tinan %d"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={0:"-\u0443\u043c",1:"-\u0443\u043c",2:"-\u044e\u043c",3:"-\u044e\u043c",4:"-\u0443\u043c",5:"-\u0443\u043c",6:"-\u0443\u043c",7:"-\u0443\u043c",8:"-\u0443\u043c",9:"-\u0443\u043c",10:"-\u0443\u043c",12:"-\u0443\u043c",13:"-\u0443\u043c",20:"-\u0443\u043c",30:"-\u044e\u043c",40:"-\u0443\u043c",50:"-\u0443\u043c",60:"-\u0443\u043c",70:"-\u0443\u043c",80:"-\u0443\u043c",90:"-\u0443\u043c",100:"-\u0443\u043c"};e.defineLocale("tg",{months:{format:"\u044f\u043d\u0432\u0430\u0440\u0438_\u0444\u0435\u0432\u0440\u0430\u043b\u0438_\u043c\u0430\u0440\u0442\u0438_\u0430\u043f\u0440\u0435\u043b\u0438_\u043c\u0430\u0439\u0438_\u0438\u044e\u043d\u0438_\u0438\u044e\u043b\u0438_\u0430\u0432\u0433\u0443\u0441\u0442\u0438_\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u0438_\u043e\u043a\u0442\u044f\u0431\u0440\u0438_\u043d\u043e\u044f\u0431\u0440\u0438_\u0434\u0435\u043a\u0430\u0431\u0440\u0438".split("_"),standalone:"\u044f\u043d\u0432\u0430\u0440_\u0444\u0435\u0432\u0440\u0430\u043b_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0435\u043b_\u043c\u0430\u0439_\u0438\u044e\u043d_\u0438\u044e\u043b_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043d\u0442\u044f\u0431\u0440_\u043e\u043a\u0442\u044f\u0431\u0440_\u043d\u043e\u044f\u0431\u0440_\u0434\u0435\u043a\u0430\u0431\u0440".split("_")},monthsShort:"\u044f\u043d\u0432_\u0444\u0435\u0432_\u043c\u0430\u0440_\u0430\u043f\u0440_\u043c\u0430\u0439_\u0438\u044e\u043d_\u0438\u044e\u043b_\u0430\u0432\u0433_\u0441\u0435\u043d_\u043e\u043a\u0442_\u043d\u043e\u044f_\u0434\u0435\u043a".split("_"),weekdays:"\u044f\u043a\u0448\u0430\u043d\u0431\u0435_\u0434\u0443\u0448\u0430\u043d\u0431\u0435_\u0441\u0435\u0448\u0430\u043d\u0431\u0435_\u0447\u043e\u0440\u0448\u0430\u043d\u0431\u0435_\u043f\u0430\u043d\u04b7\u0448\u0430\u043d\u0431\u0435_\u04b7\u0443\u043c\u044a\u0430_\u0448\u0430\u043d\u0431\u0435".split("_"),weekdaysShort:"\u044f\u0448\u0431_\u0434\u0448\u0431_\u0441\u0448\u0431_\u0447\u0448\u0431_\u043f\u0448\u0431_\u04b7\u0443\u043c_\u0448\u043d\u0431".split("_"),weekdaysMin:"\u044f\u0448_\u0434\u0448_\u0441\u0448_\u0447\u0448_\u043f\u0448_\u04b7\u043c_\u0448\u0431".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0418\u043c\u0440\u04ef\u0437 \u0441\u043e\u0430\u0442\u0438] LT",nextDay:"[\u0424\u0430\u0440\u0434\u043e \u0441\u043e\u0430\u0442\u0438] LT",lastDay:"[\u0414\u0438\u0440\u04ef\u0437 \u0441\u043e\u0430\u0442\u0438] LT",nextWeek:"dddd[\u0438] [\u04b3\u0430\u0444\u0442\u0430\u0438 \u043e\u044f\u043d\u0434\u0430 \u0441\u043e\u0430\u0442\u0438] LT",lastWeek:"dddd[\u0438] [\u04b3\u0430\u0444\u0442\u0430\u0438 \u0433\u0443\u0437\u0430\u0448\u0442\u0430 \u0441\u043e\u0430\u0442\u0438] LT",sameElse:"L"},relativeTime:{future:"\u0431\u0430\u044a\u0434\u0438 %s",past:"%s \u043f\u0435\u0448",s:"\u044f\u043a\u0447\u0430\u043d\u0434 \u0441\u043e\u043d\u0438\u044f",m:"\u044f\u043a \u0434\u0430\u049b\u0438\u049b\u0430",mm:"%d \u0434\u0430\u049b\u0438\u049b\u0430",h:"\u044f\u043a \u0441\u043e\u0430\u0442",hh:"%d \u0441\u043e\u0430\u0442",d:"\u044f\u043a \u0440\u04ef\u0437",dd:"%d \u0440\u04ef\u0437",M:"\u044f\u043a \u043c\u043e\u04b3",MM:"%d \u043c\u043e\u04b3",y:"\u044f\u043a \u0441\u043e\u043b",yy:"%d \u0441\u043e\u043b"},meridiemParse:/\u0448\u0430\u0431|\u0441\u0443\u0431\u04b3|\u0440\u04ef\u0437|\u0431\u0435\u0433\u043e\u04b3/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u0448\u0430\u0431"===t?e<4?e:e+12:"\u0441\u0443\u0431\u04b3"===t?e:"\u0440\u04ef\u0437"===t?e>=11?e:e+12:"\u0431\u0435\u0433\u043e\u04b3"===t?e+12:void 0},meridiem:function(e,t,n){return e<4?"\u0448\u0430\u0431":e<11?"\u0441\u0443\u0431\u04b3":e<16?"\u0440\u04ef\u0437":e<19?"\u0431\u0435\u0433\u043e\u04b3":"\u0448\u0430\u0431"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0443\u043c|\u044e\u043c)/,ordinal:function(e){return e+(t[e]||t[e%10]||t[e>=100?100:null])},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("th",{months:"\u0e21\u0e01\u0e23\u0e32\u0e04\u0e21_\u0e01\u0e38\u0e21\u0e20\u0e32\u0e1e\u0e31\u0e19\u0e18\u0e4c_\u0e21\u0e35\u0e19\u0e32\u0e04\u0e21_\u0e40\u0e21\u0e29\u0e32\u0e22\u0e19_\u0e1e\u0e24\u0e29\u0e20\u0e32\u0e04\u0e21_\u0e21\u0e34\u0e16\u0e38\u0e19\u0e32\u0e22\u0e19_\u0e01\u0e23\u0e01\u0e0e\u0e32\u0e04\u0e21_\u0e2a\u0e34\u0e07\u0e2b\u0e32\u0e04\u0e21_\u0e01\u0e31\u0e19\u0e22\u0e32\u0e22\u0e19_\u0e15\u0e38\u0e25\u0e32\u0e04\u0e21_\u0e1e\u0e24\u0e28\u0e08\u0e34\u0e01\u0e32\u0e22\u0e19_\u0e18\u0e31\u0e19\u0e27\u0e32\u0e04\u0e21".split("_"),monthsShort:"\u0e21.\u0e04._\u0e01.\u0e1e._\u0e21\u0e35.\u0e04._\u0e40\u0e21.\u0e22._\u0e1e.\u0e04._\u0e21\u0e34.\u0e22._\u0e01.\u0e04._\u0e2a.\u0e04._\u0e01.\u0e22._\u0e15.\u0e04._\u0e1e.\u0e22._\u0e18.\u0e04.".split("_"),monthsParseExact:!0,weekdays:"\u0e2d\u0e32\u0e17\u0e34\u0e15\u0e22\u0e4c_\u0e08\u0e31\u0e19\u0e17\u0e23\u0e4c_\u0e2d\u0e31\u0e07\u0e04\u0e32\u0e23_\u0e1e\u0e38\u0e18_\u0e1e\u0e24\u0e2b\u0e31\u0e2a\u0e1a\u0e14\u0e35_\u0e28\u0e38\u0e01\u0e23\u0e4c_\u0e40\u0e2a\u0e32\u0e23\u0e4c".split("_"),weekdaysShort:"\u0e2d\u0e32\u0e17\u0e34\u0e15\u0e22\u0e4c_\u0e08\u0e31\u0e19\u0e17\u0e23\u0e4c_\u0e2d\u0e31\u0e07\u0e04\u0e32\u0e23_\u0e1e\u0e38\u0e18_\u0e1e\u0e24\u0e2b\u0e31\u0e2a_\u0e28\u0e38\u0e01\u0e23\u0e4c_\u0e40\u0e2a\u0e32\u0e23\u0e4c".split("_"),weekdaysMin:"\u0e2d\u0e32._\u0e08._\u0e2d._\u0e1e._\u0e1e\u0e24._\u0e28._\u0e2a.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY \u0e40\u0e27\u0e25\u0e32 H:mm",LLLL:"\u0e27\u0e31\u0e19dddd\u0e17\u0e35\u0e48 D MMMM YYYY \u0e40\u0e27\u0e25\u0e32 H:mm"},meridiemParse:/\u0e01\u0e48\u0e2d\u0e19\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07|\u0e2b\u0e25\u0e31\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07/,isPM:function(e){return"\u0e2b\u0e25\u0e31\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07"===e},meridiem:function(e,t,n){return e<12?"\u0e01\u0e48\u0e2d\u0e19\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07":"\u0e2b\u0e25\u0e31\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07"},calendar:{sameDay:"[\u0e27\u0e31\u0e19\u0e19\u0e35\u0e49 \u0e40\u0e27\u0e25\u0e32] LT",nextDay:"[\u0e1e\u0e23\u0e38\u0e48\u0e07\u0e19\u0e35\u0e49 \u0e40\u0e27\u0e25\u0e32] LT",nextWeek:"dddd[\u0e2b\u0e19\u0e49\u0e32 \u0e40\u0e27\u0e25\u0e32] LT",lastDay:"[\u0e40\u0e21\u0e37\u0e48\u0e2d\u0e27\u0e32\u0e19\u0e19\u0e35\u0e49 \u0e40\u0e27\u0e25\u0e32] LT",lastWeek:"[\u0e27\u0e31\u0e19]dddd[\u0e17\u0e35\u0e48\u0e41\u0e25\u0e49\u0e27 \u0e40\u0e27\u0e25\u0e32] LT",sameElse:"L"},relativeTime:{future:"\u0e2d\u0e35\u0e01 %s",past:"%s\u0e17\u0e35\u0e48\u0e41\u0e25\u0e49\u0e27",s:"\u0e44\u0e21\u0e48\u0e01\u0e35\u0e48\u0e27\u0e34\u0e19\u0e32\u0e17\u0e35",ss:"%d \u0e27\u0e34\u0e19\u0e32\u0e17\u0e35",m:"1 \u0e19\u0e32\u0e17\u0e35",mm:"%d \u0e19\u0e32\u0e17\u0e35",h:"1 \u0e0a\u0e31\u0e48\u0e27\u0e42\u0e21\u0e07",hh:"%d \u0e0a\u0e31\u0e48\u0e27\u0e42\u0e21\u0e07",d:"1 \u0e27\u0e31\u0e19",dd:"%d \u0e27\u0e31\u0e19",w:"1 \u0e2a\u0e31\u0e1b\u0e14\u0e32\u0e2b\u0e4c",ww:"%d \u0e2a\u0e31\u0e1b\u0e14\u0e32\u0e2b\u0e4c",M:"1 \u0e40\u0e14\u0e37\u0e2d\u0e19",MM:"%d \u0e40\u0e14\u0e37\u0e2d\u0e19",y:"1 \u0e1b\u0e35",yy:"%d \u0e1b\u0e35"}})}(n(3))},function(e,t,n){!function(e){var t={1:"'inji",5:"'inji",8:"'inji",70:"'inji",80:"'inji",2:"'nji",7:"'nji",20:"'nji",50:"'nji",3:"'\xfcnji",4:"'\xfcnji",100:"'\xfcnji",6:"'njy",9:"'unjy",10:"'unjy",30:"'unjy",60:"'ynjy",90:"'ynjy"};e.defineLocale("tk",{months:"\xddanwar_Fewral_Mart_Aprel_Ma\xfd_I\xfdun_I\xfdul_Awgust_Sent\xfdabr_Okt\xfdabr_No\xfdabr_Dekabr".split("_"),monthsShort:"\xddan_Few_Mar_Apr_Ma\xfd_I\xfdn_I\xfdl_Awg_Sen_Okt_No\xfd_Dek".split("_"),weekdays:"\xddek\u015fenbe_Du\u015fenbe_Si\u015fenbe_\xc7ar\u015fenbe_Pen\u015fenbe_Anna_\u015eenbe".split("_"),weekdaysShort:"\xddek_Du\u015f_Si\u015f_\xc7ar_Pen_Ann_\u015een".split("_"),weekdaysMin:"\xddk_D\u015f_S\u015f_\xc7r_Pn_An_\u015en".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bug\xfcn sagat] LT",nextDay:"[ertir sagat] LT",nextWeek:"[indiki] dddd [sagat] LT",lastDay:"[d\xfc\xfdn] LT",lastWeek:"[ge\xe7en] dddd [sagat] LT",sameElse:"L"},relativeTime:{future:"%s so\u0148",past:"%s \xf6\u0148",s:"birn\xe4\xe7e sekunt",m:"bir minut",mm:"%d minut",h:"bir sagat",hh:"%d sagat",d:"bir g\xfcn",dd:"%d g\xfcn",M:"bir a\xfd",MM:"%d a\xfd",y:"bir \xfdyl",yy:"%d \xfdyl"},ordinal:function(e,n){switch(n){case"d":case"D":case"Do":case"DD":return e;default:if(0===e)return e+"'unjy";var r=e%10;return e+(t[r]||t[e%100-r]||t[e>=100?100:null])}},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t="pagh_wa\u2019_cha\u2019_wej_loS_vagh_jav_Soch_chorgh_Hut".split("_");function n(e,n,r,i){var a=function(e){var n=Math.floor(e%1e3/100),r=Math.floor(e%100/10),i=e%10,a="";return n>0&&(a+=t[n]+"vatlh"),r>0&&(a+=(""!==a?" ":"")+t[r]+"maH"),i>0&&(a+=(""!==a?" ":"")+t[i]),""===a?"pagh":a}(e);switch(r){case"ss":return a+" lup";case"mm":return a+" tup";case"hh":return a+" rep";case"dd":return a+" jaj";case"MM":return a+" jar";case"yy":return a+" DIS"}}e.defineLocale("tlh",{months:"tera\u2019 jar wa\u2019_tera\u2019 jar cha\u2019_tera\u2019 jar wej_tera\u2019 jar loS_tera\u2019 jar vagh_tera\u2019 jar jav_tera\u2019 jar Soch_tera\u2019 jar chorgh_tera\u2019 jar Hut_tera\u2019 jar wa\u2019maH_tera\u2019 jar wa\u2019maH wa\u2019_tera\u2019 jar wa\u2019maH cha\u2019".split("_"),monthsShort:"jar wa\u2019_jar cha\u2019_jar wej_jar loS_jar vagh_jar jav_jar Soch_jar chorgh_jar Hut_jar wa\u2019maH_jar wa\u2019maH wa\u2019_jar wa\u2019maH cha\u2019".split("_"),monthsParseExact:!0,weekdays:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysShort:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysMin:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[DaHjaj] LT",nextDay:"[wa\u2019leS] LT",nextWeek:"LLL",lastDay:"[wa\u2019Hu\u2019] LT",lastWeek:"LLL",sameElse:"L"},relativeTime:{future:function(e){var t=e;return-1!==e.indexOf("jaj")?t.slice(0,-3)+"leS":-1!==e.indexOf("jar")?t.slice(0,-3)+"waQ":-1!==e.indexOf("DIS")?t.slice(0,-3)+"nem":t+" pIq"},past:function(e){var t=e;return-1!==e.indexOf("jaj")?t.slice(0,-3)+"Hu\u2019":-1!==e.indexOf("jar")?t.slice(0,-3)+"wen":-1!==e.indexOf("DIS")?t.slice(0,-3)+"ben":t+" ret"},s:"puS lup",ss:n,m:"wa\u2019 tup",mm:n,h:"wa\u2019 rep",hh:n,d:"wa\u2019 jaj",dd:n,M:"wa\u2019 jar",MM:n,y:"wa\u2019 DIS",yy:n},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){var t={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'\xfcnc\xfc",4:"'\xfcnc\xfc",100:"'\xfcnc\xfc",6:"'nc\u0131",9:"'uncu",10:"'uncu",30:"'uncu",60:"'\u0131nc\u0131",90:"'\u0131nc\u0131"};e.defineLocale("tr",{months:"Ocak_\u015eubat_Mart_Nisan_May\u0131s_Haziran_Temmuz_A\u011fustos_Eyl\xfcl_Ekim_Kas\u0131m_Aral\u0131k".split("_"),monthsShort:"Oca_\u015eub_Mar_Nis_May_Haz_Tem_A\u011fu_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal\u0131_\xc7ar\u015famba_Per\u015fembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_\xc7ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_\xc7a_Pe_Cu_Ct".split("_"),meridiem:function(e,t,n){return e<12?n?"\xf6\xf6":"\xd6\xd6":n?"\xf6s":"\xd6S"},meridiemParse:/\xf6\xf6|\xd6\xd6|\xf6s|\xd6S/,isPM:function(e){return"\xf6s"===e||"\xd6S"===e},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bug\xfcn saat] LT",nextDay:"[yar\u0131n saat] LT",nextWeek:"[gelecek] dddd [saat] LT",lastDay:"[d\xfcn] LT",lastWeek:"[ge\xe7en] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s \xf6nce",s:"birka\xe7 saniye",ss:"%d saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir g\xfcn",dd:"%d g\xfcn",w:"bir hafta",ww:"%d hafta",M:"bir ay",MM:"%d ay",y:"bir y\u0131l",yy:"%d y\u0131l"},ordinal:function(e,n){switch(n){case"d":case"D":case"Do":case"DD":return e;default:if(0===e)return e+"'\u0131nc\u0131";var r=e%10;return e+(t[r]||t[e%100-r]||t[e>=100?100:null])}},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n,r){var i={s:["viensas secunds","'iensas secunds"],ss:[e+" secunds",e+" secunds"],m:["'n m\xedut","'iens m\xedut"],mm:[e+" m\xeduts",e+" m\xeduts"],h:["'n \xfeora","'iensa \xfeora"],hh:[e+" \xfeoras",e+" \xfeoras"],d:["'n ziua","'iensa ziua"],dd:[e+" ziuas",e+" ziuas"],M:["'n mes","'iens mes"],MM:[e+" mesen",e+" mesen"],y:["'n ar","'iens ar"],yy:[e+" ars",e+" ars"]};return r||t?i[n][0]:i[n][1]}e.defineLocale("tzl",{months:"Januar_Fevraglh_Mar\xe7_Avr\xefu_Mai_G\xfcn_Julia_Guscht_Setemvar_Listop\xe4ts_Noemvar_Zecemvar".split("_"),monthsShort:"Jan_Fev_Mar_Avr_Mai_G\xfcn_Jul_Gus_Set_Lis_Noe_Zec".split("_"),weekdays:"S\xfaladi_L\xfane\xe7i_Maitzi_M\xe1rcuri_Xh\xfaadi_Vi\xe9ner\xe7i_S\xe1turi".split("_"),weekdaysShort:"S\xfal_L\xfan_Mai_M\xe1r_Xh\xfa_Vi\xe9_S\xe1t".split("_"),weekdaysMin:"S\xfa_L\xfa_Ma_M\xe1_Xh_Vi_S\xe1".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"D. MMMM [dallas] YYYY",LLL:"D. MMMM [dallas] YYYY HH.mm",LLLL:"dddd, [li] D. MMMM [dallas] YYYY HH.mm"},meridiemParse:/d\'o|d\'a/i,isPM:function(e){return"d'o"===e.toLowerCase()},meridiem:function(e,t,n){return e>11?n?"d'o":"D'O":n?"d'a":"D'A"},calendar:{sameDay:"[oxhi \xe0] LT",nextDay:"[dem\xe0 \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[ieiri \xe0] LT",lastWeek:"[s\xfcr el] dddd [lasteu \xe0] LT",sameElse:"L"},relativeTime:{future:"osprei %s",past:"ja%s",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("tzm",{months:"\u2d49\u2d4f\u2d4f\u2d30\u2d62\u2d54_\u2d31\u2d55\u2d30\u2d62\u2d55_\u2d4e\u2d30\u2d55\u2d5a_\u2d49\u2d31\u2d54\u2d49\u2d54_\u2d4e\u2d30\u2d62\u2d62\u2d53_\u2d62\u2d53\u2d4f\u2d62\u2d53_\u2d62\u2d53\u2d4d\u2d62\u2d53\u2d63_\u2d56\u2d53\u2d5b\u2d5c_\u2d5b\u2d53\u2d5c\u2d30\u2d4f\u2d31\u2d49\u2d54_\u2d3d\u2d5f\u2d53\u2d31\u2d55_\u2d4f\u2d53\u2d61\u2d30\u2d4f\u2d31\u2d49\u2d54_\u2d37\u2d53\u2d4a\u2d4f\u2d31\u2d49\u2d54".split("_"),monthsShort:"\u2d49\u2d4f\u2d4f\u2d30\u2d62\u2d54_\u2d31\u2d55\u2d30\u2d62\u2d55_\u2d4e\u2d30\u2d55\u2d5a_\u2d49\u2d31\u2d54\u2d49\u2d54_\u2d4e\u2d30\u2d62\u2d62\u2d53_\u2d62\u2d53\u2d4f\u2d62\u2d53_\u2d62\u2d53\u2d4d\u2d62\u2d53\u2d63_\u2d56\u2d53\u2d5b\u2d5c_\u2d5b\u2d53\u2d5c\u2d30\u2d4f\u2d31\u2d49\u2d54_\u2d3d\u2d5f\u2d53\u2d31\u2d55_\u2d4f\u2d53\u2d61\u2d30\u2d4f\u2d31\u2d49\u2d54_\u2d37\u2d53\u2d4a\u2d4f\u2d31\u2d49\u2d54".split("_"),weekdays:"\u2d30\u2d59\u2d30\u2d4e\u2d30\u2d59_\u2d30\u2d62\u2d4f\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4f\u2d30\u2d59_\u2d30\u2d3d\u2d54\u2d30\u2d59_\u2d30\u2d3d\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4e\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d39\u2d62\u2d30\u2d59".split("_"),weekdaysShort:"\u2d30\u2d59\u2d30\u2d4e\u2d30\u2d59_\u2d30\u2d62\u2d4f\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4f\u2d30\u2d59_\u2d30\u2d3d\u2d54\u2d30\u2d59_\u2d30\u2d3d\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4e\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d39\u2d62\u2d30\u2d59".split("_"),weekdaysMin:"\u2d30\u2d59\u2d30\u2d4e\u2d30\u2d59_\u2d30\u2d62\u2d4f\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4f\u2d30\u2d59_\u2d30\u2d3d\u2d54\u2d30\u2d59_\u2d30\u2d3d\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4e\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d39\u2d62\u2d30\u2d59".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u2d30\u2d59\u2d37\u2d45 \u2d34] LT",nextDay:"[\u2d30\u2d59\u2d3d\u2d30 \u2d34] LT",nextWeek:"dddd [\u2d34] LT",lastDay:"[\u2d30\u2d5a\u2d30\u2d4f\u2d5c \u2d34] LT",lastWeek:"dddd [\u2d34] LT",sameElse:"L"},relativeTime:{future:"\u2d37\u2d30\u2d37\u2d45 \u2d59 \u2d62\u2d30\u2d4f %s",past:"\u2d62\u2d30\u2d4f %s",s:"\u2d49\u2d4e\u2d49\u2d3d",ss:"%d \u2d49\u2d4e\u2d49\u2d3d",m:"\u2d4e\u2d49\u2d4f\u2d53\u2d3a",mm:"%d \u2d4e\u2d49\u2d4f\u2d53\u2d3a",h:"\u2d59\u2d30\u2d44\u2d30",hh:"%d \u2d5c\u2d30\u2d59\u2d59\u2d30\u2d44\u2d49\u2d4f",d:"\u2d30\u2d59\u2d59",dd:"%d o\u2d59\u2d59\u2d30\u2d4f",M:"\u2d30\u2d62o\u2d53\u2d54",MM:"%d \u2d49\u2d62\u2d62\u2d49\u2d54\u2d4f",y:"\u2d30\u2d59\u2d33\u2d30\u2d59",yy:"%d \u2d49\u2d59\u2d33\u2d30\u2d59\u2d4f"},week:{dow:6,doy:12}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("tzm-latn",{months:"innayr_br\u02e4ayr\u02e4_mar\u02e4s\u02e4_ibrir_mayyw_ywnyw_ywlywz_\u0263w\u0161t_\u0161wtanbir_kt\u02e4wbr\u02e4_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_br\u02e4ayr\u02e4_mar\u02e4s\u02e4_ibrir_mayyw_ywnyw_ywlywz_\u0263w\u0161t_\u0161wtanbir_kt\u02e4wbr\u02e4_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asi\u1e0dyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asi\u1e0dyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asi\u1e0dyas".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",ss:"%d imik",m:"minu\u1e0d",mm:"%d minu\u1e0d",h:"sa\u025ba",hh:"%d tassa\u025bin",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("ug-cn",{months:"\u064a\u0627\u0646\u06cb\u0627\u0631_\u0641\u06d0\u06cb\u0631\u0627\u0644_\u0645\u0627\u0631\u062a_\u0626\u0627\u067e\u0631\u06d0\u0644_\u0645\u0627\u064a_\u0626\u0649\u064a\u06c7\u0646_\u0626\u0649\u064a\u06c7\u0644_\u0626\u0627\u06cb\u063a\u06c7\u0633\u062a_\u0633\u06d0\u0646\u062a\u06d5\u0628\u0649\u0631_\u0626\u06c6\u0643\u062a\u06d5\u0628\u0649\u0631_\u0646\u0648\u064a\u0627\u0628\u0649\u0631_\u062f\u06d0\u0643\u0627\u0628\u0649\u0631".split("_"),monthsShort:"\u064a\u0627\u0646\u06cb\u0627\u0631_\u0641\u06d0\u06cb\u0631\u0627\u0644_\u0645\u0627\u0631\u062a_\u0626\u0627\u067e\u0631\u06d0\u0644_\u0645\u0627\u064a_\u0626\u0649\u064a\u06c7\u0646_\u0626\u0649\u064a\u06c7\u0644_\u0626\u0627\u06cb\u063a\u06c7\u0633\u062a_\u0633\u06d0\u0646\u062a\u06d5\u0628\u0649\u0631_\u0626\u06c6\u0643\u062a\u06d5\u0628\u0649\u0631_\u0646\u0648\u064a\u0627\u0628\u0649\u0631_\u062f\u06d0\u0643\u0627\u0628\u0649\u0631".split("_"),weekdays:"\u064a\u06d5\u0643\u0634\u06d5\u0646\u0628\u06d5_\u062f\u06c8\u0634\u06d5\u0646\u0628\u06d5_\u0633\u06d5\u064a\u0634\u06d5\u0646\u0628\u06d5_\u0686\u0627\u0631\u0634\u06d5\u0646\u0628\u06d5_\u067e\u06d5\u064a\u0634\u06d5\u0646\u0628\u06d5_\u062c\u06c8\u0645\u06d5_\u0634\u06d5\u0646\u0628\u06d5".split("_"),weekdaysShort:"\u064a\u06d5_\u062f\u06c8_\u0633\u06d5_\u0686\u0627_\u067e\u06d5_\u062c\u06c8_\u0634\u06d5".split("_"),weekdaysMin:"\u064a\u06d5_\u062f\u06c8_\u0633\u06d5_\u0686\u0627_\u067e\u06d5_\u062c\u06c8_\u0634\u06d5".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY-\u064a\u0649\u0644\u0649M-\u0626\u0627\u064a\u0646\u0649\u06adD-\u0643\u06c8\u0646\u0649",LLL:"YYYY-\u064a\u0649\u0644\u0649M-\u0626\u0627\u064a\u0646\u0649\u06adD-\u0643\u06c8\u0646\u0649\u060c HH:mm",LLLL:"dddd\u060c YYYY-\u064a\u0649\u0644\u0649M-\u0626\u0627\u064a\u0646\u0649\u06adD-\u0643\u06c8\u0646\u0649\u060c HH:mm"},meridiemParse:/\u064a\u06d0\u0631\u0649\u0645 \u0643\u06d0\u0686\u06d5|\u0633\u06d5\u06be\u06d5\u0631|\u0686\u06c8\u0634\u062a\u0649\u0646 \u0628\u06c7\u0631\u06c7\u0646|\u0686\u06c8\u0634|\u0686\u06c8\u0634\u062a\u0649\u0646 \u0643\u06d0\u064a\u0649\u0646|\u0643\u06d5\u0686/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u064a\u06d0\u0631\u0649\u0645 \u0643\u06d0\u0686\u06d5"===t||"\u0633\u06d5\u06be\u06d5\u0631"===t||"\u0686\u06c8\u0634\u062a\u0649\u0646 \u0628\u06c7\u0631\u06c7\u0646"===t?e:"\u0686\u06c8\u0634\u062a\u0649\u0646 \u0643\u06d0\u064a\u0649\u0646"===t||"\u0643\u06d5\u0686"===t?e+12:e>=11?e:e+12},meridiem:function(e,t,n){var r=100*e+t;return r<600?"\u064a\u06d0\u0631\u0649\u0645 \u0643\u06d0\u0686\u06d5":r<900?"\u0633\u06d5\u06be\u06d5\u0631":r<1130?"\u0686\u06c8\u0634\u062a\u0649\u0646 \u0628\u06c7\u0631\u06c7\u0646":r<1230?"\u0686\u06c8\u0634":r<1800?"\u0686\u06c8\u0634\u062a\u0649\u0646 \u0643\u06d0\u064a\u0649\u0646":"\u0643\u06d5\u0686"},calendar:{sameDay:"[\u0628\u06c8\u06af\u06c8\u0646 \u0633\u0627\u0626\u06d5\u062a] LT",nextDay:"[\u0626\u06d5\u062a\u06d5 \u0633\u0627\u0626\u06d5\u062a] LT",nextWeek:"[\u0643\u06d0\u0644\u06d5\u0631\u0643\u0649] dddd [\u0633\u0627\u0626\u06d5\u062a] LT",lastDay:"[\u062a\u06c6\u0646\u06c8\u06af\u06c8\u0646] LT",lastWeek:"[\u0626\u0627\u0644\u062f\u0649\u0646\u0642\u0649] dddd [\u0633\u0627\u0626\u06d5\u062a] LT",sameElse:"L"},relativeTime:{future:"%s \u0643\u06d0\u064a\u0649\u0646",past:"%s \u0628\u06c7\u0631\u06c7\u0646",s:"\u0646\u06d5\u0686\u0686\u06d5 \u0633\u06d0\u0643\u0648\u0646\u062a",ss:"%d \u0633\u06d0\u0643\u0648\u0646\u062a",m:"\u0628\u0649\u0631 \u0645\u0649\u0646\u06c7\u062a",mm:"%d \u0645\u0649\u0646\u06c7\u062a",h:"\u0628\u0649\u0631 \u0633\u0627\u0626\u06d5\u062a",hh:"%d \u0633\u0627\u0626\u06d5\u062a",d:"\u0628\u0649\u0631 \u0643\u06c8\u0646",dd:"%d \u0643\u06c8\u0646",M:"\u0628\u0649\u0631 \u0626\u0627\u064a",MM:"%d \u0626\u0627\u064a",y:"\u0628\u0649\u0631 \u064a\u0649\u0644",yy:"%d \u064a\u0649\u0644"},dayOfMonthOrdinalParse:/\d{1,2}(-\u0643\u06c8\u0646\u0649|-\u0626\u0627\u064a|-\u06be\u06d5\u067e\u062a\u06d5)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"-\u0643\u06c8\u0646\u0649";case"w":case"W":return e+"-\u06be\u06d5\u067e\u062a\u06d5";default:return e}},preparse:function(e){return e.replace(/\u060c/g,",")},postformat:function(e){return e.replace(/,/g,"\u060c")},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){function t(e,t,n){var r,i;return"m"===n?t?"\u0445\u0432\u0438\u043b\u0438\u043d\u0430":"\u0445\u0432\u0438\u043b\u0438\u043d\u0443":"h"===n?t?"\u0433\u043e\u0434\u0438\u043d\u0430":"\u0433\u043e\u0434\u0438\u043d\u0443":e+" "+(r=+e,i={ss:t?"\u0441\u0435\u043a\u0443\u043d\u0434\u0430_\u0441\u0435\u043a\u0443\u043d\u0434\u0438_\u0441\u0435\u043a\u0443\u043d\u0434":"\u0441\u0435\u043a\u0443\u043d\u0434\u0443_\u0441\u0435\u043a\u0443\u043d\u0434\u0438_\u0441\u0435\u043a\u0443\u043d\u0434",mm:t?"\u0445\u0432\u0438\u043b\u0438\u043d\u0430_\u0445\u0432\u0438\u043b\u0438\u043d\u0438_\u0445\u0432\u0438\u043b\u0438\u043d":"\u0445\u0432\u0438\u043b\u0438\u043d\u0443_\u0445\u0432\u0438\u043b\u0438\u043d\u0438_\u0445\u0432\u0438\u043b\u0438\u043d",hh:t?"\u0433\u043e\u0434\u0438\u043d\u0430_\u0433\u043e\u0434\u0438\u043d\u0438_\u0433\u043e\u0434\u0438\u043d":"\u0433\u043e\u0434\u0438\u043d\u0443_\u0433\u043e\u0434\u0438\u043d\u0438_\u0433\u043e\u0434\u0438\u043d",dd:"\u0434\u0435\u043d\u044c_\u0434\u043d\u0456_\u0434\u043d\u0456\u0432",MM:"\u043c\u0456\u0441\u044f\u0446\u044c_\u043c\u0456\u0441\u044f\u0446\u0456_\u043c\u0456\u0441\u044f\u0446\u0456\u0432",yy:"\u0440\u0456\u043a_\u0440\u043e\u043a\u0438_\u0440\u043e\u043a\u0456\u0432"}[n].split("_"),r%10==1&&r%100!=11?i[0]:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?i[1]:i[2])}function n(e){return function(){return e+"\u043e"+(11===this.hours()?"\u0431":"")+"] LT"}}e.defineLocale("uk",{months:{format:"\u0441\u0456\u0447\u043d\u044f_\u043b\u044e\u0442\u043e\u0433\u043e_\u0431\u0435\u0440\u0435\u0437\u043d\u044f_\u043a\u0432\u0456\u0442\u043d\u044f_\u0442\u0440\u0430\u0432\u043d\u044f_\u0447\u0435\u0440\u0432\u043d\u044f_\u043b\u0438\u043f\u043d\u044f_\u0441\u0435\u0440\u043f\u043d\u044f_\u0432\u0435\u0440\u0435\u0441\u043d\u044f_\u0436\u043e\u0432\u0442\u043d\u044f_\u043b\u0438\u0441\u0442\u043e\u043f\u0430\u0434\u0430_\u0433\u0440\u0443\u0434\u043d\u044f".split("_"),standalone:"\u0441\u0456\u0447\u0435\u043d\u044c_\u043b\u044e\u0442\u0438\u0439_\u0431\u0435\u0440\u0435\u0437\u0435\u043d\u044c_\u043a\u0432\u0456\u0442\u0435\u043d\u044c_\u0442\u0440\u0430\u0432\u0435\u043d\u044c_\u0447\u0435\u0440\u0432\u0435\u043d\u044c_\u043b\u0438\u043f\u0435\u043d\u044c_\u0441\u0435\u0440\u043f\u0435\u043d\u044c_\u0432\u0435\u0440\u0435\u0441\u0435\u043d\u044c_\u0436\u043e\u0432\u0442\u0435\u043d\u044c_\u043b\u0438\u0441\u0442\u043e\u043f\u0430\u0434_\u0433\u0440\u0443\u0434\u0435\u043d\u044c".split("_")},monthsShort:"\u0441\u0456\u0447_\u043b\u044e\u0442_\u0431\u0435\u0440_\u043a\u0432\u0456\u0442_\u0442\u0440\u0430\u0432_\u0447\u0435\u0440\u0432_\u043b\u0438\u043f_\u0441\u0435\u0440\u043f_\u0432\u0435\u0440_\u0436\u043e\u0432\u0442_\u043b\u0438\u0441\u0442_\u0433\u0440\u0443\u0434".split("_"),weekdays:function(e,t){var n={nominative:"\u043d\u0435\u0434\u0456\u043b\u044f_\u043f\u043e\u043d\u0435\u0434\u0456\u043b\u043e\u043a_\u0432\u0456\u0432\u0442\u043e\u0440\u043e\u043a_\u0441\u0435\u0440\u0435\u0434\u0430_\u0447\u0435\u0442\u0432\u0435\u0440_\u043f\u2019\u044f\u0442\u043d\u0438\u0446\u044f_\u0441\u0443\u0431\u043e\u0442\u0430".split("_"),accusative:"\u043d\u0435\u0434\u0456\u043b\u044e_\u043f\u043e\u043d\u0435\u0434\u0456\u043b\u043e\u043a_\u0432\u0456\u0432\u0442\u043e\u0440\u043e\u043a_\u0441\u0435\u0440\u0435\u0434\u0443_\u0447\u0435\u0442\u0432\u0435\u0440_\u043f\u2019\u044f\u0442\u043d\u0438\u0446\u044e_\u0441\u0443\u0431\u043e\u0442\u0443".split("_"),genitive:"\u043d\u0435\u0434\u0456\u043b\u0456_\u043f\u043e\u043d\u0435\u0434\u0456\u043b\u043a\u0430_\u0432\u0456\u0432\u0442\u043e\u0440\u043a\u0430_\u0441\u0435\u0440\u0435\u0434\u0438_\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0430_\u043f\u2019\u044f\u0442\u043d\u0438\u0446\u0456_\u0441\u0443\u0431\u043e\u0442\u0438".split("_")};return!0===e?n.nominative.slice(1,7).concat(n.nominative.slice(0,1)):e?n[/(\[[\u0412\u0432\u0423\u0443]\]) ?dddd/.test(t)?"accusative":/\[?(?:\u043c\u0438\u043d\u0443\u043b\u043e\u0457|\u043d\u0430\u0441\u0442\u0443\u043f\u043d\u043e\u0457)? ?\] ?dddd/.test(t)?"genitive":"nominative"][e.day()]:n.nominative},weekdaysShort:"\u043d\u0434_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),weekdaysMin:"\u043d\u0434_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY \u0440.",LLL:"D MMMM YYYY \u0440., HH:mm",LLLL:"dddd, D MMMM YYYY \u0440., HH:mm"},calendar:{sameDay:n("[\u0421\u044c\u043e\u0433\u043e\u0434\u043d\u0456 "),nextDay:n("[\u0417\u0430\u0432\u0442\u0440\u0430 "),lastDay:n("[\u0412\u0447\u043e\u0440\u0430 "),nextWeek:n("[\u0423] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return n("[\u041c\u0438\u043d\u0443\u043b\u043e\u0457] dddd [").call(this);case 1:case 2:case 4:return n("[\u041c\u0438\u043d\u0443\u043b\u043e\u0433\u043e] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:"\u0437\u0430 %s",past:"%s \u0442\u043e\u043c\u0443",s:"\u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",ss:t,m:t,mm:t,h:"\u0433\u043e\u0434\u0438\u043d\u0443",hh:t,d:"\u0434\u0435\u043d\u044c",dd:t,M:"\u043c\u0456\u0441\u044f\u0446\u044c",MM:t,y:"\u0440\u0456\u043a",yy:t},meridiemParse:/\u043d\u043e\u0447\u0456|\u0440\u0430\u043d\u043a\u0443|\u0434\u043d\u044f|\u0432\u0435\u0447\u043e\u0440\u0430/,isPM:function(e){return/^(\u0434\u043d\u044f|\u0432\u0435\u0447\u043e\u0440\u0430)$/.test(e)},meridiem:function(e,t,n){return e<4?"\u043d\u043e\u0447\u0456":e<12?"\u0440\u0430\u043d\u043a\u0443":e<17?"\u0434\u043d\u044f":"\u0432\u0435\u0447\u043e\u0440\u0430"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0439|\u0433\u043e)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e+"-\u0439";case"D":return e+"-\u0433\u043e";default:return e}},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){var t=["\u062c\u0646\u0648\u0631\u06cc","\u0641\u0631\u0648\u0631\u06cc","\u0645\u0627\u0631\u0686","\u0627\u067e\u0631\u06cc\u0644","\u0645\u0626\u06cc","\u062c\u0648\u0646","\u062c\u0648\u0644\u0627\u0626\u06cc","\u0627\u06af\u0633\u062a","\u0633\u062a\u0645\u0628\u0631","\u0627\u06a9\u062a\u0648\u0628\u0631","\u0646\u0648\u0645\u0628\u0631","\u062f\u0633\u0645\u0628\u0631"],n=["\u0627\u062a\u0648\u0627\u0631","\u067e\u06cc\u0631","\u0645\u0646\u06af\u0644","\u0628\u062f\u06be","\u062c\u0645\u0639\u0631\u0627\u062a","\u062c\u0645\u0639\u06c1","\u06c1\u0641\u062a\u06c1"];e.defineLocale("ur",{months:t,monthsShort:t,weekdays:n,weekdaysShort:n,weekdaysMin:n,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd\u060c D MMMM YYYY HH:mm"},meridiemParse:/\u0635\u0628\u062d|\u0634\u0627\u0645/,isPM:function(e){return"\u0634\u0627\u0645"===e},meridiem:function(e,t,n){return e<12?"\u0635\u0628\u062d":"\u0634\u0627\u0645"},calendar:{sameDay:"[\u0622\u062c \u0628\u0648\u0642\u062a] LT",nextDay:"[\u06a9\u0644 \u0628\u0648\u0642\u062a] LT",nextWeek:"dddd [\u0628\u0648\u0642\u062a] LT",lastDay:"[\u06af\u0630\u0634\u062a\u06c1 \u0631\u0648\u0632 \u0628\u0648\u0642\u062a] LT",lastWeek:"[\u06af\u0630\u0634\u062a\u06c1] dddd [\u0628\u0648\u0642\u062a] LT",sameElse:"L"},relativeTime:{future:"%s \u0628\u0639\u062f",past:"%s \u0642\u0628\u0644",s:"\u0686\u0646\u062f \u0633\u06cc\u06a9\u0646\u0688",ss:"%d \u0633\u06cc\u06a9\u0646\u0688",m:"\u0627\u06cc\u06a9 \u0645\u0646\u0679",mm:"%d \u0645\u0646\u0679",h:"\u0627\u06cc\u06a9 \u06af\u06be\u0646\u0679\u06c1",hh:"%d \u06af\u06be\u0646\u0679\u06d2",d:"\u0627\u06cc\u06a9 \u062f\u0646",dd:"%d \u062f\u0646",M:"\u0627\u06cc\u06a9 \u0645\u0627\u06c1",MM:"%d \u0645\u0627\u06c1",y:"\u0627\u06cc\u06a9 \u0633\u0627\u0644",yy:"%d \u0633\u0627\u0644"},preparse:function(e){return e.replace(/\u060c/g,",")},postformat:function(e){return e.replace(/,/g,"\u060c")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("uz",{months:"\u044f\u043d\u0432\u0430\u0440_\u0444\u0435\u0432\u0440\u0430\u043b_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0435\u043b_\u043c\u0430\u0439_\u0438\u044e\u043d_\u0438\u044e\u043b_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043d\u0442\u044f\u0431\u0440_\u043e\u043a\u0442\u044f\u0431\u0440_\u043d\u043e\u044f\u0431\u0440_\u0434\u0435\u043a\u0430\u0431\u0440".split("_"),monthsShort:"\u044f\u043d\u0432_\u0444\u0435\u0432_\u043c\u0430\u0440_\u0430\u043f\u0440_\u043c\u0430\u0439_\u0438\u044e\u043d_\u0438\u044e\u043b_\u0430\u0432\u0433_\u0441\u0435\u043d_\u043e\u043a\u0442_\u043d\u043e\u044f_\u0434\u0435\u043a".split("_"),weekdays:"\u042f\u043a\u0448\u0430\u043d\u0431\u0430_\u0414\u0443\u0448\u0430\u043d\u0431\u0430_\u0421\u0435\u0448\u0430\u043d\u0431\u0430_\u0427\u043e\u0440\u0448\u0430\u043d\u0431\u0430_\u041f\u0430\u0439\u0448\u0430\u043d\u0431\u0430_\u0416\u0443\u043c\u0430_\u0428\u0430\u043d\u0431\u0430".split("_"),weekdaysShort:"\u042f\u043a\u0448_\u0414\u0443\u0448_\u0421\u0435\u0448_\u0427\u043e\u0440_\u041f\u0430\u0439_\u0416\u0443\u043c_\u0428\u0430\u043d".split("_"),weekdaysMin:"\u042f\u043a_\u0414\u0443_\u0421\u0435_\u0427\u043e_\u041f\u0430_\u0416\u0443_\u0428\u0430".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[\u0411\u0443\u0433\u0443\u043d \u0441\u043e\u0430\u0442] LT [\u0434\u0430]",nextDay:"[\u042d\u0440\u0442\u0430\u0433\u0430] LT [\u0434\u0430]",nextWeek:"dddd [\u043a\u0443\u043d\u0438 \u0441\u043e\u0430\u0442] LT [\u0434\u0430]",lastDay:"[\u041a\u0435\u0447\u0430 \u0441\u043e\u0430\u0442] LT [\u0434\u0430]",lastWeek:"[\u0423\u0442\u0433\u0430\u043d] dddd [\u043a\u0443\u043d\u0438 \u0441\u043e\u0430\u0442] LT [\u0434\u0430]",sameElse:"L"},relativeTime:{future:"\u042f\u043a\u0438\u043d %s \u0438\u0447\u0438\u0434\u0430",past:"\u0411\u0438\u0440 \u043d\u0435\u0447\u0430 %s \u043e\u043b\u0434\u0438\u043d",s:"\u0444\u0443\u0440\u0441\u0430\u0442",ss:"%d \u0444\u0443\u0440\u0441\u0430\u0442",m:"\u0431\u0438\u0440 \u0434\u0430\u043a\u0438\u043a\u0430",mm:"%d \u0434\u0430\u043a\u0438\u043a\u0430",h:"\u0431\u0438\u0440 \u0441\u043e\u0430\u0442",hh:"%d \u0441\u043e\u0430\u0442",d:"\u0431\u0438\u0440 \u043a\u0443\u043d",dd:"%d \u043a\u0443\u043d",M:"\u0431\u0438\u0440 \u043e\u0439",MM:"%d \u043e\u0439",y:"\u0431\u0438\u0440 \u0439\u0438\u043b",yy:"%d \u0439\u0438\u043b"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("uz-latn",{months:"Yanvar_Fevral_Mart_Aprel_May_Iyun_Iyul_Avgust_Sentabr_Oktabr_Noyabr_Dekabr".split("_"),monthsShort:"Yan_Fev_Mar_Apr_May_Iyun_Iyul_Avg_Sen_Okt_Noy_Dek".split("_"),weekdays:"Yakshanba_Dushanba_Seshanba_Chorshanba_Payshanba_Juma_Shanba".split("_"),weekdaysShort:"Yak_Dush_Sesh_Chor_Pay_Jum_Shan".split("_"),weekdaysMin:"Ya_Du_Se_Cho_Pa_Ju_Sha".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[Bugun soat] LT [da]",nextDay:"[Ertaga] LT [da]",nextWeek:"dddd [kuni soat] LT [da]",lastDay:"[Kecha soat] LT [da]",lastWeek:"[O'tgan] dddd [kuni soat] LT [da]",sameElse:"L"},relativeTime:{future:"Yaqin %s ichida",past:"Bir necha %s oldin",s:"soniya",ss:"%d soniya",m:"bir daqiqa",mm:"%d daqiqa",h:"bir soat",hh:"%d soat",d:"bir kun",dd:"%d kun",M:"bir oy",MM:"%d oy",y:"bir yil",yy:"%d yil"},week:{dow:1,doy:7}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("vi",{months:"th\xe1ng 1_th\xe1ng 2_th\xe1ng 3_th\xe1ng 4_th\xe1ng 5_th\xe1ng 6_th\xe1ng 7_th\xe1ng 8_th\xe1ng 9_th\xe1ng 10_th\xe1ng 11_th\xe1ng 12".split("_"),monthsShort:"Thg 01_Thg 02_Thg 03_Thg 04_Thg 05_Thg 06_Thg 07_Thg 08_Thg 09_Thg 10_Thg 11_Thg 12".split("_"),monthsParseExact:!0,weekdays:"ch\u1ee7 nh\u1eadt_th\u1ee9 hai_th\u1ee9 ba_th\u1ee9 t\u01b0_th\u1ee9 n\u0103m_th\u1ee9 s\xe1u_th\u1ee9 b\u1ea3y".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysParseExact:!0,meridiemParse:/sa|ch/i,isPM:function(e){return/^ch$/i.test(e)},meridiem:function(e,t,n){return e<12?n?"sa":"SA":n?"ch":"CH"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [n\u0103m] YYYY",LLL:"D MMMM [n\u0103m] YYYY HH:mm",LLLL:"dddd, D MMMM [n\u0103m] YYYY HH:mm",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[H\xf4m nay l\xfac] LT",nextDay:"[Ng\xe0y mai l\xfac] LT",nextWeek:"dddd [tu\u1ea7n t\u1edbi l\xfac] LT",lastDay:"[H\xf4m qua l\xfac] LT",lastWeek:"dddd [tu\u1ea7n tr\u01b0\u1edbc l\xfac] LT",sameElse:"L"},relativeTime:{future:"%s t\u1edbi",past:"%s tr\u01b0\u1edbc",s:"v\xe0i gi\xe2y",ss:"%d gi\xe2y",m:"m\u1ed9t ph\xfat",mm:"%d ph\xfat",h:"m\u1ed9t gi\u1edd",hh:"%d gi\u1edd",d:"m\u1ed9t ng\xe0y",dd:"%d ng\xe0y",w:"m\u1ed9t tu\u1ea7n",ww:"%d tu\u1ea7n",M:"m\u1ed9t th\xe1ng",MM:"%d th\xe1ng",y:"m\u1ed9t n\u0103m",yy:"%d n\u0103m"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("x-pseudo",{months:"J~\xe1\xf1\xfa\xe1~r\xfd_F~\xe9br\xfa~\xe1r\xfd_~M\xe1rc~h_\xc1p~r\xedl_~M\xe1\xfd_~J\xfa\xf1\xe9~_J\xfal~\xfd_\xc1\xfa~g\xfast~_S\xe9p~t\xe9mb~\xe9r_\xd3~ct\xf3b~\xe9r_\xd1~\xf3v\xe9m~b\xe9r_~D\xe9c\xe9~mb\xe9r".split("_"),monthsShort:"J~\xe1\xf1_~F\xe9b_~M\xe1r_~\xc1pr_~M\xe1\xfd_~J\xfa\xf1_~J\xfal_~\xc1\xfag_~S\xe9p_~\xd3ct_~\xd1\xf3v_~D\xe9c".split("_"),monthsParseExact:!0,weekdays:"S~\xfa\xf1d\xe1~\xfd_M\xf3~\xf1d\xe1\xfd~_T\xfa\xe9~sd\xe1\xfd~_W\xe9d~\xf1\xe9sd~\xe1\xfd_T~h\xfars~d\xe1\xfd_~Fr\xedd~\xe1\xfd_S~\xe1t\xfar~d\xe1\xfd".split("_"),weekdaysShort:"S~\xfa\xf1_~M\xf3\xf1_~T\xfa\xe9_~W\xe9d_~Th\xfa_~Fr\xed_~S\xe1t".split("_"),weekdaysMin:"S~\xfa_M\xf3~_T\xfa_~W\xe9_T~h_Fr~_S\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[T~\xf3d\xe1~\xfd \xe1t] LT",nextDay:"[T~\xf3m\xf3~rr\xf3~w \xe1t] LT",nextWeek:"dddd [\xe1t] LT",lastDay:"[\xdd~\xe9st~\xe9rd\xe1~\xfd \xe1t] LT",lastWeek:"[L~\xe1st] dddd [\xe1t] LT",sameElse:"L"},relativeTime:{future:"\xed~\xf1 %s",past:"%s \xe1~g\xf3",s:"\xe1 ~f\xe9w ~s\xe9c\xf3~\xf1ds",ss:"%d s~\xe9c\xf3\xf1~ds",m:"\xe1 ~m\xed\xf1~\xfat\xe9",mm:"%d m~\xed\xf1\xfa~t\xe9s",h:"\xe1~\xf1 h\xf3~\xfar",hh:"%d h~\xf3\xfars",d:"\xe1 ~d\xe1\xfd",dd:"%d d~\xe1\xfds",M:"\xe1 ~m\xf3\xf1~th",MM:"%d m~\xf3\xf1t~hs",y:"\xe1 ~\xfd\xe9\xe1r",yy:"%d \xfd~\xe9\xe1rs"},dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("yo",{months:"S\u1eb9\u0301r\u1eb9\u0301_E\u0300re\u0300le\u0300_\u1eb8r\u1eb9\u0300na\u0300_I\u0300gbe\u0301_E\u0300bibi_O\u0300ku\u0300du_Ag\u1eb9mo_O\u0300gu\u0301n_Owewe_\u1ecc\u0300wa\u0300ra\u0300_Be\u0301lu\u0301_\u1ecc\u0300p\u1eb9\u0300\u0300".split("_"),monthsShort:"S\u1eb9\u0301r_E\u0300rl_\u1eb8rn_I\u0300gb_E\u0300bi_O\u0300ku\u0300_Ag\u1eb9_O\u0300gu\u0301_Owe_\u1ecc\u0300wa\u0300_Be\u0301l_\u1ecc\u0300p\u1eb9\u0300\u0300".split("_"),weekdays:"A\u0300i\u0300ku\u0301_Aje\u0301_I\u0300s\u1eb9\u0301gun_\u1eccj\u1ecd\u0301ru\u0301_\u1eccj\u1ecd\u0301b\u1ecd_\u1eb8ti\u0300_A\u0300ba\u0301m\u1eb9\u0301ta".split("_"),weekdaysShort:"A\u0300i\u0300k_Aje\u0301_I\u0300s\u1eb9\u0301_\u1eccjr_\u1eccjb_\u1eb8ti\u0300_A\u0300ba\u0301".split("_"),weekdaysMin:"A\u0300i\u0300_Aj_I\u0300s_\u1eccr_\u1eccb_\u1eb8t_A\u0300b".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[O\u0300ni\u0300 ni] LT",nextDay:"[\u1ecc\u0300la ni] LT",nextWeek:"dddd [\u1eccs\u1eb9\u0300 to\u0301n'b\u1ecd] [ni] LT",lastDay:"[A\u0300na ni] LT",lastWeek:"dddd [\u1eccs\u1eb9\u0300 to\u0301l\u1ecd\u0301] [ni] LT",sameElse:"L"},relativeTime:{future:"ni\u0301 %s",past:"%s k\u1ecdja\u0301",s:"i\u0300s\u1eb9ju\u0301 aaya\u0301 die",ss:"aaya\u0301 %d",m:"i\u0300s\u1eb9ju\u0301 kan",mm:"i\u0300s\u1eb9ju\u0301 %d",h:"wa\u0301kati kan",hh:"wa\u0301kati %d",d:"\u1ecdj\u1ecd\u0301 kan",dd:"\u1ecdj\u1ecd\u0301 %d",M:"osu\u0300 kan",MM:"osu\u0300 %d",y:"\u1ecddu\u0301n kan",yy:"\u1ecddu\u0301n %d"},dayOfMonthOrdinalParse:/\u1ecdj\u1ecd\u0301\s\d{1,2}/,ordinal:"\u1ecdj\u1ecd\u0301 %d",week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("zh-cn",{months:"\u4e00\u6708_\u4e8c\u6708_\u4e09\u6708_\u56db\u6708_\u4e94\u6708_\u516d\u6708_\u4e03\u6708_\u516b\u6708_\u4e5d\u6708_\u5341\u6708_\u5341\u4e00\u6708_\u5341\u4e8c\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u661f\u671f\u65e5_\u661f\u671f\u4e00_\u661f\u671f\u4e8c_\u661f\u671f\u4e09_\u661f\u671f\u56db_\u661f\u671f\u4e94_\u661f\u671f\u516d".split("_"),weekdaysShort:"\u5468\u65e5_\u5468\u4e00_\u5468\u4e8c_\u5468\u4e09_\u5468\u56db_\u5468\u4e94_\u5468\u516d".split("_"),weekdaysMin:"\u65e5_\u4e00_\u4e8c_\u4e09_\u56db_\u4e94_\u516d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5Ah\u70b9mm\u5206",LLLL:"YYYY\u5e74M\u6708D\u65e5ddddAh\u70b9mm\u5206",l:"YYYY/M/D",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm"},meridiemParse:/\u51cc\u6668|\u65e9\u4e0a|\u4e0a\u5348|\u4e2d\u5348|\u4e0b\u5348|\u665a\u4e0a/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u51cc\u6668"===t||"\u65e9\u4e0a"===t||"\u4e0a\u5348"===t?e:"\u4e0b\u5348"===t||"\u665a\u4e0a"===t?e+12:e>=11?e:e+12},meridiem:function(e,t,n){var r=100*e+t;return r<600?"\u51cc\u6668":r<900?"\u65e9\u4e0a":r<1130?"\u4e0a\u5348":r<1230?"\u4e2d\u5348":r<1800?"\u4e0b\u5348":"\u665a\u4e0a"},calendar:{sameDay:"[\u4eca\u5929]LT",nextDay:"[\u660e\u5929]LT",nextWeek:function(e){return e.week()!==this.week()?"[\u4e0b]dddLT":"[\u672c]dddLT"},lastDay:"[\u6628\u5929]LT",lastWeek:function(e){return this.week()!==e.week()?"[\u4e0a]dddLT":"[\u672c]dddLT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(\u65e5|\u6708|\u5468)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"\u65e5";case"M":return e+"\u6708";case"w":case"W":return e+"\u5468";default:return e}},relativeTime:{future:"%s\u540e",past:"%s\u524d",s:"\u51e0\u79d2",ss:"%d \u79d2",m:"1 \u5206\u949f",mm:"%d \u5206\u949f",h:"1 \u5c0f\u65f6",hh:"%d \u5c0f\u65f6",d:"1 \u5929",dd:"%d \u5929",w:"1 \u5468",ww:"%d \u5468",M:"1 \u4e2a\u6708",MM:"%d \u4e2a\u6708",y:"1 \u5e74",yy:"%d \u5e74"},week:{dow:1,doy:4}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("zh-hk",{months:"\u4e00\u6708_\u4e8c\u6708_\u4e09\u6708_\u56db\u6708_\u4e94\u6708_\u516d\u6708_\u4e03\u6708_\u516b\u6708_\u4e5d\u6708_\u5341\u6708_\u5341\u4e00\u6708_\u5341\u4e8c\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u661f\u671f\u65e5_\u661f\u671f\u4e00_\u661f\u671f\u4e8c_\u661f\u671f\u4e09_\u661f\u671f\u56db_\u661f\u671f\u4e94_\u661f\u671f\u516d".split("_"),weekdaysShort:"\u9031\u65e5_\u9031\u4e00_\u9031\u4e8c_\u9031\u4e09_\u9031\u56db_\u9031\u4e94_\u9031\u516d".split("_"),weekdaysMin:"\u65e5_\u4e00_\u4e8c_\u4e09_\u56db_\u4e94_\u516d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5 HH:mm",LLLL:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm",l:"YYYY/M/D",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm"},meridiemParse:/\u51cc\u6668|\u65e9\u4e0a|\u4e0a\u5348|\u4e2d\u5348|\u4e0b\u5348|\u665a\u4e0a/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u51cc\u6668"===t||"\u65e9\u4e0a"===t||"\u4e0a\u5348"===t?e:"\u4e2d\u5348"===t?e>=11?e:e+12:"\u4e0b\u5348"===t||"\u665a\u4e0a"===t?e+12:void 0},meridiem:function(e,t,n){var r=100*e+t;return r<600?"\u51cc\u6668":r<900?"\u65e9\u4e0a":r<1200?"\u4e0a\u5348":1200===r?"\u4e2d\u5348":r<1800?"\u4e0b\u5348":"\u665a\u4e0a"},calendar:{sameDay:"[\u4eca\u5929]LT",nextDay:"[\u660e\u5929]LT",nextWeek:"[\u4e0b]ddddLT",lastDay:"[\u6628\u5929]LT",lastWeek:"[\u4e0a]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(\u65e5|\u6708|\u9031)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"\u65e5";case"M":return e+"\u6708";case"w":case"W":return e+"\u9031";default:return e}},relativeTime:{future:"%s\u5f8c",past:"%s\u524d",s:"\u5e7e\u79d2",ss:"%d \u79d2",m:"1 \u5206\u9418",mm:"%d \u5206\u9418",h:"1 \u5c0f\u6642",hh:"%d \u5c0f\u6642",d:"1 \u5929",dd:"%d \u5929",M:"1 \u500b\u6708",MM:"%d \u500b\u6708",y:"1 \u5e74",yy:"%d \u5e74"}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("zh-mo",{months:"\u4e00\u6708_\u4e8c\u6708_\u4e09\u6708_\u56db\u6708_\u4e94\u6708_\u516d\u6708_\u4e03\u6708_\u516b\u6708_\u4e5d\u6708_\u5341\u6708_\u5341\u4e00\u6708_\u5341\u4e8c\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u661f\u671f\u65e5_\u661f\u671f\u4e00_\u661f\u671f\u4e8c_\u661f\u671f\u4e09_\u661f\u671f\u56db_\u661f\u671f\u4e94_\u661f\u671f\u516d".split("_"),weekdaysShort:"\u9031\u65e5_\u9031\u4e00_\u9031\u4e8c_\u9031\u4e09_\u9031\u56db_\u9031\u4e94_\u9031\u516d".split("_"),weekdaysMin:"\u65e5_\u4e00_\u4e8c_\u4e09_\u56db_\u4e94_\u516d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5 HH:mm",LLLL:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm",l:"D/M/YYYY",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm"},meridiemParse:/\u51cc\u6668|\u65e9\u4e0a|\u4e0a\u5348|\u4e2d\u5348|\u4e0b\u5348|\u665a\u4e0a/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u51cc\u6668"===t||"\u65e9\u4e0a"===t||"\u4e0a\u5348"===t?e:"\u4e2d\u5348"===t?e>=11?e:e+12:"\u4e0b\u5348"===t||"\u665a\u4e0a"===t?e+12:void 0},meridiem:function(e,t,n){var r=100*e+t;return r<600?"\u51cc\u6668":r<900?"\u65e9\u4e0a":r<1130?"\u4e0a\u5348":r<1230?"\u4e2d\u5348":r<1800?"\u4e0b\u5348":"\u665a\u4e0a"},calendar:{sameDay:"[\u4eca\u5929] LT",nextDay:"[\u660e\u5929] LT",nextWeek:"[\u4e0b]dddd LT",lastDay:"[\u6628\u5929] LT",lastWeek:"[\u4e0a]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(\u65e5|\u6708|\u9031)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"\u65e5";case"M":return e+"\u6708";case"w":case"W":return e+"\u9031";default:return e}},relativeTime:{future:"%s\u5167",past:"%s\u524d",s:"\u5e7e\u79d2",ss:"%d \u79d2",m:"1 \u5206\u9418",mm:"%d \u5206\u9418",h:"1 \u5c0f\u6642",hh:"%d \u5c0f\u6642",d:"1 \u5929",dd:"%d \u5929",M:"1 \u500b\u6708",MM:"%d \u500b\u6708",y:"1 \u5e74",yy:"%d \u5e74"}})}(n(3))},function(e,t,n){!function(e){e.defineLocale("zh-tw",{months:"\u4e00\u6708_\u4e8c\u6708_\u4e09\u6708_\u56db\u6708_\u4e94\u6708_\u516d\u6708_\u4e03\u6708_\u516b\u6708_\u4e5d\u6708_\u5341\u6708_\u5341\u4e00\u6708_\u5341\u4e8c\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u661f\u671f\u65e5_\u661f\u671f\u4e00_\u661f\u671f\u4e8c_\u661f\u671f\u4e09_\u661f\u671f\u56db_\u661f\u671f\u4e94_\u661f\u671f\u516d".split("_"),weekdaysShort:"\u9031\u65e5_\u9031\u4e00_\u9031\u4e8c_\u9031\u4e09_\u9031\u56db_\u9031\u4e94_\u9031\u516d".split("_"),weekdaysMin:"\u65e5_\u4e00_\u4e8c_\u4e09_\u56db_\u4e94_\u516d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5 HH:mm",LLLL:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm",l:"YYYY/M/D",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm"},meridiemParse:/\u51cc\u6668|\u65e9\u4e0a|\u4e0a\u5348|\u4e2d\u5348|\u4e0b\u5348|\u665a\u4e0a/,meridiemHour:function(e,t){return 12===e&&(e=0),"\u51cc\u6668"===t||"\u65e9\u4e0a"===t||"\u4e0a\u5348"===t?e:"\u4e2d\u5348"===t?e>=11?e:e+12:"\u4e0b\u5348"===t||"\u665a\u4e0a"===t?e+12:void 0},meridiem:function(e,t,n){var r=100*e+t;return r<600?"\u51cc\u6668":r<900?"\u65e9\u4e0a":r<1130?"\u4e0a\u5348":r<1230?"\u4e2d\u5348":r<1800?"\u4e0b\u5348":"\u665a\u4e0a"},calendar:{sameDay:"[\u4eca\u5929] LT",nextDay:"[\u660e\u5929] LT",nextWeek:"[\u4e0b]dddd LT",lastDay:"[\u6628\u5929] LT",lastWeek:"[\u4e0a]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(\u65e5|\u6708|\u9031)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"\u65e5";case"M":return e+"\u6708";case"w":case"W":return e+"\u9031";default:return e}},relativeTime:{future:"%s\u5f8c",past:"%s\u524d",s:"\u5e7e\u79d2",ss:"%d \u79d2",m:"1 \u5206\u9418",mm:"%d \u5206\u9418",h:"1 \u5c0f\u6642",hh:"%d \u5c0f\u6642",d:"1 \u5929",dd:"%d \u5929",M:"1 \u500b\u6708",MM:"%d \u500b\u6708",y:"1 \u5e74",yy:"%d \u5e74"}})}(n(3))},function(e,t,n){var r;e.exports=(r=n(12),function(e){var t=r,n=t.lib,i=n.WordArray,a=n.Hasher,o=t.algo,s=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(s[i]=n(e.pow(r,.5))),c[i]=n(e.pow(r,1/3)),i++),r++}();var l=[],u=o.SHA256=a.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],d=n[6],h=n[7],f=0;f<64;f++){if(f<16)l[f]=0|e[t+f];else{var p=l[f-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,v=l[f-2],g=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;l[f]=m+l[f-7]+g+l[f-16]}var y=r&i^r&a^i&a,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),S=h+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&u^~s&d)+c[f]+l[f];h=d,d=u,u=s,s=o+S|0,o=a,a=i,i=r,r=S+(b+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+a|0,n[3]=n[3]+o|0,n[4]=n[4]+s|0,n[5]=n[5]+u|0,n[6]=n[6]+d|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=a._createHelper(u),t.HmacSHA256=a._createHmacHelper(u)}(Math),r.SHA256)},function(e,t,n){var r;e.exports=(r=n(12),n(61),function(){var e=r,t=e.lib.Hasher,n=e.x64,i=n.Word,a=n.WordArray,o=e.algo;function s(){return i.create.apply(i,arguments)}var c=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],l=[];!function(){for(var e=0;e<80;e++)l[e]=s()}();var u=o.SHA512=t.extend({_doReset:function(){this._hash=new a.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],d=n[6],h=n[7],f=r.high,p=r.low,m=i.high,v=i.low,g=a.high,y=a.low,b=o.high,S=o.low,_=s.high,C=s.low,w=u.high,E=u.low,T=d.high,k=d.low,M=h.high,D=h.low,x=f,R=p,O=m,I=v,P=g,A=y,L=b,N=S,j=_,U=C,F=w,H=E,W=T,Y=k,B=M,V=D,$=0;$<80;$++){var G=l[$];if($<16)var z=G.high=0|e[t+2*$],q=G.low=0|e[t+2*$+1];else{var J=l[$-15],K=J.high,Q=J.low,X=(K>>>1|Q<<31)^(K>>>8|Q<<24)^K>>>7,Z=(Q>>>1|K<<31)^(Q>>>8|K<<24)^(Q>>>7|K<<25),ee=l[$-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ie=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ae=l[$-7],oe=ae.high,se=ae.low,ce=l[$-16],le=ce.high,ue=ce.low;z=(z=(z=X+oe+((q=Z+se)>>>0<Z>>>0?1:0))+re+((q+=ie)>>>0<ie>>>0?1:0))+le+((q+=ue)>>>0<ue>>>0?1:0),G.high=z,G.low=q}var de,he=j&F^~j&W,fe=U&H^~U&Y,pe=x&O^x&P^O&P,me=R&I^R&A^I&A,ve=(x>>>28|R<<4)^(x<<30|R>>>2)^(x<<25|R>>>7),ge=(R>>>28|x<<4)^(R<<30|x>>>2)^(R<<25|x>>>7),ye=(j>>>14|U<<18)^(j>>>18|U<<14)^(j<<23|U>>>9),be=(U>>>14|j<<18)^(U>>>18|j<<14)^(U<<23|j>>>9),Se=c[$],_e=Se.high,Ce=Se.low,we=B+ye+((de=V+be)>>>0<V>>>0?1:0),Ee=ge+me;B=W,V=Y,W=F,Y=H,F=j,H=U,j=L+(we=(we=(we=we+he+((de+=fe)>>>0<fe>>>0?1:0))+_e+((de+=Ce)>>>0<Ce>>>0?1:0))+z+((de+=q)>>>0<q>>>0?1:0))+((U=N+de|0)>>>0<N>>>0?1:0)|0,L=P,N=A,P=O,A=I,O=x,I=R,x=we+(ve+pe+(Ee>>>0<ge>>>0?1:0))+((R=de+Ee|0)>>>0<de>>>0?1:0)|0}p=r.low=p+R,r.high=f+x+(p>>>0<R>>>0?1:0),v=i.low=v+I,i.high=m+O+(v>>>0<I>>>0?1:0),y=a.low=y+A,a.high=g+P+(y>>>0<A>>>0?1:0),S=o.low=S+N,o.high=b+L+(S>>>0<N>>>0?1:0),C=s.low=C+U,s.high=_+j+(C>>>0<U>>>0?1:0),E=u.low=E+H,u.high=w+F+(E>>>0<H>>>0?1:0),k=d.low=k+Y,d.high=T+W+(k>>>0<Y>>>0?1:0),D=h.low=D+V,h.high=M+B+(D>>>0<V>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(u),e.HmacSHA512=t._createHmacHelper(u)}(),r.SHA512)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,r="",i=0;i<e;i++)r+=t.charAt(Math.floor(Math.random()*n));return r}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(t,n,i,a,o,s,c,l,u,d,h,f,p,m,v,g){S(this,e),this.userRole="none",this.messageRetrieved=!1,this.messages=[],this.subscribed=!1,this.deleted=!1,this.invited=!1,this.type="SIMPLE",this.pageIndex=0,this.isLoading=!1,this.complete=!1,this.users=[],this.publishersRetreived=!1,this.loaded=!1,this.muted=!1,this.name=t,this.id=n,this.visibility=i,this.topic=a,this.creatorId=o,this.companyId=s,this.creationDate=c,this.type=h,this.users_count=l,this.subscribers_count=v,this.category=p,this.mode=m,this.lastAvatarUpdateDate=u;var y=this.lastAvatarUpdateDate?"&ts="+new Date(this.lastAvatarUpdateDate).getTime():"";if(this.avatar=config.restServerUrl+"/api/channel-avatar/"+n+"?size=256"+y,void 0!==d&&(this.subscribed=d),void 0!==h&&(this.userRole=h,this.subscribed="none"!==h),void 0!==f&&(this.invited=f),!this.mode)switch(this.visibility){case"company":this.mode="company_public";break;case"public":this.mode="all_public";break;case"private":this.mode="company_private"}this.updateSubject=new r.Subject,this.muted=g}return C(e,[{key:"isNotMember",value:function(){return this.userRole="none"}},{key:"isOwner",value:function(){return"owner"===this.userRole}},{key:"isPublisher",value:function(){return this.subscribed&&("owner"===this.userRole||"publisher"===this.userRole)}},{key:"isMember",value:function(){return"member"===this.userRole}},{key:"getAvatarSrc",value:function(){return this.lastAvatarUpdateDate?this.avatar:"/resources/skins/rainbow/images/channels/default_channel_avatar.png"}}],[{key:"create",value:function(t){var n=new e(t.name,t.id,t.visibility,t.topic,t.creatorId,t.companyId,t.creationDate,t.users_count,t.lastAvatarUpdateDate,t.subscribed,t.type,t.invited,t.category,t.mode,t.subscribers_count,t.mute);return n.category||(n.category="globalnews"),n}}]),e}();t.Channel=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){S(this,e),this.body=void 0,this.date=void 0,this.isRoom=!1,this.isSent=!1,this.messageId=void 0,this.otherJid=null,this.historyIndex=null}return C(e,null,[{key:"SearchTextMsgResultFactory",value:function(){return function(){return new e}}}]),e}();t.SearchTextMsgResult=r,t.SearchTextResult=function(){function e(t){S(this,e),this.room=null,this.contact=null,this.totalCount=0,this.convRes=[],this.otherJid=t}return C(e,[{key:"addMsgItem",value:function(e){this.convRes.push(e)}},{key:"isRoom",value:function(){return this.conversation?null!=this.conversation.room:null!==this.room}}]),e}();var i=function(){function e(){S(this,e),this._searchedText=null,this.normalizedSearchText=null,this.queryIds=[],this.results=[],this.totalCount=0,this.currentMessageId=null,this.isSearching=!1}return C(e,[{key:"searchedText",get:function(){return this._searchedText},set:function(e){this._searchedText=e,this.normalizedSearchText=e?e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""):null}},{key:"isEmpty",value:function(){return 0===this.queryIds.length||0===Object.keys(this.results).length}},{key:"clearAll",value:function(){this.searchedText=null,this.queryIds=[],this.partResults=[],this.totalCount=0,this.currentMessageId=null,this.results.splice(0,this.results.length)}},{key:"isCurrentQuery",value:function(e){return this.queryIds.indexOf(e)>-1}},{key:"getResultByJid",value:function(e){return this.results.find((function(t){return t.otherJid===e}))}}]),e}();t.SearchTextConvResults=i,angular.module("rainbow").factory("SearchTextConvResultsFactory",(function(){return function(){return new i}})),angular.module("rainbow").factory("SearchTextMsgResultFactory",r.SearchTextMsgResultFactory)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n){S(this,e),this.id=t,this.body=n}return C(e,null,[{key:"create",value:function(t,n){return new e(t,(emojione?emojione.toShort:function(e){return e})(n))}}]),e}();t.ReplaceMsg=r},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),i=n(4),a=n(25),o=n(1),s=n(15),c=n(33),l=n(3),u=function(){function e(t,n,r,i,a){S(this,e),this.$rootScope=t,this.Conversation=n,this.fileServerService=r,this.webrtcGatewayService=i,this.conversationService=a}return C(e,[{key:"onChatMessageReceived",value:function(e){var t=this;try{var n=$(e);return n.find("event").length>0||n.find("propose").length>0||n.find("received").length>0?(s.default.info("[ConversationServiceEventHandler] onChatMessageReceived ignore the message"),!0):(n.find("recording").length>0?(s.default.info("[ConversationServiceEventHandler] onChatMessageReceived : recording msg case"),this.onRecordingMessageReceived(e)):this.extractStanzaData(e).then((function(n){n&&(n.body||n.oob||n.conference||n.replace?(s.default.info("[ConversationServiceEventHandler] onChatMessageReceived"),t.handleChatMessage(n)):n.outgoingMessage||o.default.isUserContact(n.participant)||!n.status||t.handleStatusMessage(n.conversation,n.participant,e))})),!0)}catch(r){return s.default.error("[ConversationServiceEventHandler] onChatMessageReceived ERROR "+r),!0}}},{key:"onConferenceMessageReceived",value:function(e){var t=this;s.default.info("[ConversationServiceEventHandler] onConferenceMessageReceived");try{return 0===$(e).find("event").length?s.default.info("[ConversationServiceEventHandler] onConferenceMessageReceived ignore the message"):this.extractStanzaData(e).then((function(e){e.conference&&t.handleChatMessage(e)})),!0}catch(n){return s.default.error("[ConversationServiceEventHandler] onConferenceMessageReceived ERROR "+n),!0}}},{key:"onRoomAdminMessageReceived",value:function(e,t,n,r){s.default.info("[ConversationServiceEventHandler] onRoomAdminMessageReceived");var i=e.addAdminBubbleMessage(t,new Date,n,r);e.setStatusMessage(t,this.Conversation.Status.ACTIVE),this.conversationService.sendAckReceivedMessage(e,i),e===this.conversationService.activeConversation&&this.$rootScope.appVisible||e.setMissedCounter(e.missedCounter+1),this.$rootScope.$broadcast("ON_CONVERSATION_MESSAGE_RECEIVED",i,e,!1),this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",e,this.Conversation.EventType.IM)}},{key:"onFileMessageReceived",value:function(e){var t=this;s.default.info("[ConversationServiceEventHandler] onFileMessageReceived");try{return this.extractStanzaData(e).then((function(e){if(e.body){var n=e.conversation;n.addFileMessage(e.participant,e.date,e.body,e.messageId,e.urgency),n.setStatusMessage(e.participant,t.Conversation.Status.ACTIVE),t.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",n,t.Conversation.EventType.FILE)}})),!0}catch(n){return s.default.error("[ConversationServiceEventHandler] onFileMessageReceived ERROR "+n),!0}}},{key:"onWebRTCMessageReceived",value:function(e){var t=this;s.default.info("[ConversationServiceEventHandler] onWebRTCMessageReceived");try{return $(e).find("call_log").length>0?this.extractWebrtcStanzaData(e).then((function(e){if(e&&e.body){var n=e.conversation,r=n.addWebRTCMessage(e.participant,e.date,e.body,e.messageId);n.setStatusMessage(e.participant,t.Conversation.Status.ACTIVE),t.conversationService.sendAckReceivedMessage(n,r),"R"===r.side||e.state&&"answered"===e.state?t.conversationService.sendAckReadMessage(n,r):n===t.conversationService.activeConversation&&t.$rootScope.appVisible||n.setMissedCounter(n.missedCounter+1),t.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",n)}})):this.extractStanzaData(e).then((function(e){if(e&&e.body){var n=e.conversation;n.addWebRTCMessage(e.participant,e.date,e.body,e.messageId),n.setStatusMessage(e.participant,t.Conversation.Status.ACTIVE),t.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",n)}})),!0}catch(n){return s.default.error("[ConversationServiceEventHandler] onWebRTCMessageReceived error "+n),!0}}},{key:"onManagementMessageReceived",value:function(e){var t=this;try{var n=$(e),r=n.find("conversation");if(r){var a=r.attr("action"),o=null;if("create"===a){var c=i.default.getBareJidFromJid(r.find("peer").text()),l=r.find("type").text(),u=r.attr("id");o=this.conversationService.getConversationAsyncById(c,l,u)}else o=Promise.resolve(this.conversationService.getConversationByDbId(r.attr("id")));o.then((function(e){if(s.default.info("[ConversationServiceEventHandler] onManagementMessageReceived ("+a+" conversation)"),e)switch(a){case"create":e.dbId=r.attr("id");var n=r.find("lastMessageDate").text();n&&n.length>0&&(e.lastModification=new Date(n)),e.missedCounter=parseInt(r.find("unreadMessageNumber").text(),10)||0,e.muted="true"===r.find("mute").text(),t.conversationService.favoriteService.updateFavoriteConversations(e),t.conversationService.orderConversations(),t.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT");break;case"delete":t.conversationService.removeConversation(e)}else if("create"===a){var o=i.default.getBareJidFromJid(r.find("peer").text()),c=r.attr("id"),l=new Date(r.find("lastMessageDate").text()),u=r.find("lastMessageText").text(),d=r.find("lastMessageSender").text(),h=parseInt(r.find("unreadMessageNumber").text(),10)||0,f="true"===r.find("mute").text(),p=r.find("type").text(),m="room"===p?"getRoomConversation":"getOrCreateOneToOneConversation";t.conversationService[m](o).then((function(e){s.default.info("[ConversationServiceEventHandler] onManagementMessageReceived update conversation ("+e.id+")"),e.dbId=c,e.lastModification=l?new Date(l):void 0,e.lastMessageText=u,e.lastMessageSender=d,e.muted=f,e.preload=!0,e.setMissedCounter(h),p===t.Conversation.Type.BOT&&(e.type=t.Conversation.Type.ONE_TO_ONE),t.conversationService.favoriteService.updateFavoriteConversations(e),t.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",e)}))}}))}if(n.find("mute")||n.find("unmute")){var d=n.find("mute"),h=!1;d.length&&(h=!d.text().length||"true"===d.text());var f=n.find("mute").attr("conversation")||n.find("unmute").attr("conversation"),p=this.conversationService.getConversationByDbId(f);p&&(s.default.info("[ConversationServiceEventHandler] onManagementMessageReceived : mute is changed to "+h),p.muted=h)}return!0}catch(m){return s.default.error("[ConversationServiceEventHandler] onManagementMessageReceived error "+m),!0}}},{key:"onReceiptMessageReceived",value:function(e){var t=this;try{var n=$(e),a=i.default.getBareJidFromJid(n.attr("from")),c=n.find("message");o.default.isUserContactJid(a)&&c.length>0&&(n=$(c));var l=n.find("received");if(l.length&&l.length>0){s.default.info("[ConversationServiceEventHandler] onReceiptMessageReceived");var u=$(l).attr("id"),d=$(l).attr("entity"),h=$(l).attr("event");if("server"===d&&"received"===h){var f=this.conversationService.pendingMessages[u];if(f&&f.message){var p=f.message,m=f.conversation;s.default.info("[conversationService] Receive server ack ("+m.id+", "+p.id+")"),p.setReceiptStatus(r.Message.ReceiptStatus.SENT),m.updateMessage(p),delete this.conversationService.pendingMessages[u],this.$rootScope.$broadcast("ON_CONVERSATION_RECEIPT_RECEIVED",p,m,"server")}}else"client"===d&&this.extractStanzaData(e).then((function(n){t.handleReceiptReceiveMessage(n.conversation,e)}))}else if(n.find("mark_as_read").length){s.default.info("[ConversationServiceEventHandler] onReceiptMessageReceived -- mark_as_read");var v=n.find("mark_as_read").attr("with"),g=this.conversationService.getConversationById(v);if(g)switch(n.find("mark_as_read").attr("id")){case"all-received":g.setMissedCounter(0);break;case"all-sent":g.ackReadAllSentMessages();break;default:s.default.error("[ConversationServiceEventHandler] onReceiptMessageReceived error - unknown read type")}}else n.find("voicemessage").length&&s.default.debug("[ConversationServiceEventHandler] onReceiptMessageReceived VoiceMessage detected");return!0}catch(y){return s.default.error("[ConversationServiceEventHandler] onReceiptMessageReceived error "+y),!0}}},{key:"extractStanzaData",value:function(e){var t=this;return new Promise((function(n,r){var a=$(e),s=a.attr("from"),c=i.default.getBareJidFromJid(s),l={},u=null,d=a.find("message");if(d.length>0&&o.default.isUserContactJid(c)){var h=$(a).find("sent forwarded message forwarded message");if(h&&h.length){var f=$(a).find("sent forwarded message").attr("id");a=$(h).find("forwarded message"),l.isForwarded=!0,u=t.handleCarbonMsg(d,l,a,f)}else u=t.handleCarbonMsg(d,l,a,null)}else{var p=$(a).find("forwarded[xmlns='urn:xmpp:forward:0']");if(p&&p.length){var m=a.attr("id");a=$(p).find("forwarded message"),l.isForwarded=!0,u=t.handleStandardMsg(l,a,s,m,n)}else u=t.handleStandardMsg(l,a,s,null,n)}u&&t.handleCommonData(e,l,a,u.conversationId,u.delay,u.resource,n,r)}))}},{key:"handleCommonData",value:function(e,t,n,r,i,a,l,u){var d="push"===n.find("retransmission").attr("source");if(t.date=new Date,t.offline=!1,"Offline Storage"===i.text()&&(t.date=new Date(i.attr("stamp")),t.offline=!0),d){var h=this.conversationService.getConversationById(r);if(h)u();else{var f=this.conversationService;(r.startsWith("room_")?f.getRoomConversation(r):f.getOrCreateOneToOneConversation(r)).then((function(e){h=e,u()}))}}else{var p=this.conversationService.getConversationById(r);if(t.convReady=p&&null!==p.dbId,t.body||p||t.oob||t.conference)if(0===r.indexOf("room_")){var m=c.default.getRoomByJid(r),v=n.find("subject"),g=v.length&&""===v.text();m&&"accepted"!==m.status||g?s.default.info("[conversationServiceEvent] extractStanzaData -- ignore this stanza message"):this.conversationService.getRoomConversation(r).then((function(e){return t.conversation=e,t.conference&&t.conference.ownerjid?o.default.getOrCreateContact(t.conference.ownerjid):(a&&-1!==a.indexOf("/")&&(a=a.split("/")[0]),o.default.getOrCreateContact(a))})).then((function(e){t.participant=e,l(t)})).catch((function(e){s.default.error("[conversationServiceEventHandler] impossible to fetch conversation "+e.message),u()}))}else this.conversationService.getOrCreateOneToOneConversation(r).then((function(e){t.conversation=e,t.participant||(t.participant=e.contact),l(t)})).catch((function(e){s.default.error("[conversationServiceEventHandler] impossible to fetch conversation "+e.message),u()}));else if($(e).find("deleted")){var y=$(e).find("deleted")[0];if(y&&"all"===y.getAttribute("id")){var b=this.conversationService.getConversationById(y.getAttribute("with"));b&&(s.default.info("[conversationServiceEventHandler] Remove all messages for conversation "+b.id),b.reset())}l()}else s.default.debug("[conversationServiceEventHandler] ignored message stanza"),u()}}},{key:"handleStandardMsg",value:function(e,t,n,r,a){s.default.debug("[conversationServiceEventHandler] > handleStandardMsg "+r),e.outgoingMessage=!1,e.body=t.find("body").text(),e.messageId=r||t.attr("id"),e.carbon=!1,e.answeredMsg=t.find("answeredMsg"),e.alternativeContent=t.find("content"),e.attention=t.find("attention");var o=i.default.getBareJidFromJid(n),c=i.default.getResourceFromJid(n),l=t.find("delay");e.urgency="std";var u=t.find("headers[xmlns='http://jabber.org/protocol/shim']");if(u&&u.length){var d=$(u).find("header[name='Urgency']");d&&d.length&&(e.urgency=d.text()),"undefined"===e.urgency&&(e.urgency="std")}var h=t.find("x[xmlns='jabber:x:oob']");if(h&&h.length){var f=$(h),p=f.find("url").text(),m=f.find("mime").text(),v=f.find("filename").text(),g=f.find("size").text();e.oob={url:p,mime:m,filename:v,filesize:g}}var y=t.find("geoloc");if(y&&y.length){var b=$(y),S=b.find("lon").text(),_=b.find("lat").text();e.geoloc={lon:S,lat:_}}var C=t.find("voicemessage");C&&C.length&&(e.voiceMessage=!0);var w=t.find("x[xmlns='jabber:x:audioconference']");if(w&&w.length){var E=$(w),T=E.attr("message"),k=E.attr("confendpointid"),M=w.attr("jid"),D=w.attr("type");if(e.conference={type:D,message:T,confendpointid:k,roomjid:M,ownerjid:o},"reminder"!==D)return s.default.debug("[conversationServiceEventHandler] ignored message stanza for conference"),a(e),null;o=M}var x=t.find("replace");x&&x.length&&(e.replace={id:x.attr("id")});var R=t.find("mention[xmlns='urn:xmpp:attention:0']");R.length&&(e.mentions=[],R.find("jid").each((function(t,n){var r={};r.jid=$(n).text(),r.pos=parseInt($(n).attr("pos"),10),r.size=parseInt($(n).attr("size"),10),r.jid&&r.size&&e.mentions.push(r)}))),e.additionalContent=null;var O=t.find("content[xmlns='urn:xmpp:content']");O&&O.each((function(){e.additionalContent||(e.additionalContent={});var t=$(this).attr("type"),n=$(this).text();"text/markdown"===t&&(e.markdown=!0,e.body=n),e.additionalContent[t]={type:t,message:n}}));var I=t.find("subject");I&&""!==I.text()&&(e.subject=I.text()),e.status=null;var P=t.find("composing"),A=t.find("paused"),L=t.find("active"),N=t.find("inactive");return P.length?e.status="composing":A.length?e.status="paused":L.length?e.status="active":N.length&&(e.status="inactive"),{conversationId:o,resource:c,delay:l}}},{key:"handleCarbonMsg",value:function(e,t,n,r){var a=$(e),s=i.default.getBareJidFromJid(a.attr("from")),c=i.default.getResourceFromJid(a.attr("from")),l=i.default.getBareJidFromJid(a.attr("to")),u=i.default.getResourceFromJid(a.attr("to"));t.outgoingMessage=o.default.isUserContactJid(s),t.body=a.find("body").text(),t.participant=t.outgoingMessage?o.default.userContact:null,t.messageId=r||a.attr("id"),t.carbon=!0,t.answeredMsg=a.find("answeredMsg"),t.alternativeContent=a.find("content");var d=t.outgoingMessage?l:s,h=t.outgoingMessage?u:c,f=a.find("delay");t.urgency="std";var p=a.find("headers[xmlns='http://jabber.org/protocol/shim']");if(p&&p.length){var m=$(p).find("header[name='Urgency']");m&&m.length&&(t.urgency=m.text())}var v=a.find("x[xmlns='jabber:x:oob']");if(v&&v.length){var g=$(v),y=g.find("url").text(),b=g.find("mime").text(),S=g.find("filename").text(),_=g.find("size").text();t.oob={url:y,mime:b,filename:S,filesize:_}}var C=n.find("x[xmlns='jabber:x:audioconference']");if(C&&C.length){var w=$(C),E=w.attr("subject"),T=w.attr("confendpointid"),k=C.attr("jid"),M=C.attr("type");t.conference={type:M,subject:E,confendpointid:T,roomjid:k,ownerjid:d}}var D=e.find("replace");D&&D.length&&(t.replace={id:D.attr("id")});var x=e.find("mention[xmlns='urn:xmpp:attention:0']");x.length&&(t.mentions=[],x.find("jid").each((function(e,n){var r={};r.jid=$(n).text(),r.pos=parseInt($(n).attr("pos"),10),r.size=parseInt($(n).attr("size"),10),r.jid&&r.size&&t.mentions.push(r)}))),t.status=null;var R=n.find("composing"),O=n.find("paused"),I=n.find("active"),P=n.find("inactive");R.length?t.status="composing":O.length?t.status="paused":I.length?t.status="active":P.length&&(t.status="inactive");var A=a.find("geoloc");if(A&&A.length){var L=$(A),N=L.find("lon").text(),j=L.find("lat").text();t.geoloc={lon:N,lat:j}}var U=a.find("voicemessage");return U&&U.length&&(t.voiceMessage=!0),{conversationId:d,resource:h,delay:f}}},{key:"extractWebrtcStanzaData",value:function(e){var t=this;return new Promise((function(n,r){s.default.debug("[conversationServiceEventHandler] extractWebrtcStanzaData");var i={};i.messageId=$(e).attr("id"),i.callerJid=$(e).find("caller").text(),i.calleeJid=$(e).find("callee").text(),i.state=$(e).find("state").text();var a=null;if(o.default.isUserContactJid(i.callerJid)?(a=i.calleeJid,i.participant=o.default.userContact):a=i.callerJid,-1!==a.indexOf("janusgateway"))return s.default.debug("[conversationServiceEventHandler] extractWebrtcStanzaData -- ignore Janus message"),void r();if(t.webrtcGatewayService.isMediaPillarJid(i.callerJid))return s.default.debug("[conversationServiceEventHandler] extractWebrtcStanzaData -- ignore MediaPillar message"),void n();var c=0;$(e).find("duration")&&(c=parseInt($(e).find("duration").text(),10)),i.duration=c>0?"("+l.duration(c,"ms").format("h[H] mm[m] ss[s]")+")":0;var u=$(e).find("date").text();u&&(i.date=new Date(u)),i.body="","missed"===i.state?i.body="missedCall||"+i.date:"answered"===i.state&&(i.body="activeCallMsg||"+i.date+"||"+i.duration),t.conversationService.getOrCreateOneToOneConversation(a).then((function(e){i.conversation=e,i.participant||(i.participant=e.contact),n(i)})).catch((function(e){s.default.error("[conversationServiceEventHandler] impossible to fetch conversation "+e.message),r()}))}))}},{key:"handleChatMessage",value:function(e){var t=this;s.default.info("[ConversationServiceEventHandler] handleChatMessage");var n=e.body,r=null,i=e.conversation;if(i&&i.room&&(i.room.lastActivityDate=new Date),e.oob){var o=e.oob.url,c=e.oob.filename,l=a.default.extractFileIdFromUrl(o),u=e.attention&&e.attention.length;a.default.retrieveAndStoreOneFileDescriptor(l).then((function(n){r=i.addFileSharingMessage(e.participant,e.date,e.body,e.messageId,l,c,e.geoloc,e.urgency,e.isForwarded,u),t.acknowledgeHandledChatMessage(e,i,r),t.fileServerService.getBlobThumbnailFromFileDescriptor(n).then((function(e){var r=a.default.getFileDescriptorById(n.id);r.previewBlob=e,r.previewBlobSubject.next(r.previewBlob),t.$rootScope.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:r.id})})),t.$rootScope.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:n.id})})).catch((function(e){s.default.info("[ConversationServiceEventHandler] handleChatMessage error "+e)}))}else if(e.conference){var d={type:e.conference.type,message:e.conference.subject,confendpointid:e.conference.confendpointid,roomjid:e.conference.roomjid};if(i=this.conversationService.getConversationById(d.roomjid),this.$rootScope.$broadcast("ROOM_UPDATE_CONFID"),!i)return;r=i.addConferenceMessage(e.participant,e.date,e.messageId,d)}else if(e.replace)(r=i.getMessageById(e.replace.id))&&e.participant.jid!==r.from.jid?(s.default.warn("[ConversationServiceEventHandler] handleChatMessage : message Replaced by somebody else - Skip"),r=null):(r||(r=i.addChatMessage(e.participant,e.date,"",e.replace.id,null,e.markdown,e.subject,null,null,e.additionalContent)),r.addReplaceMsg(e.messageId,n),r.mentions=e.mentions,i.updateAfterReplaceEvent(r));else if(n.length>0){var h=e.answeredMsg?e.answeredMsg.text():null,f=e.answeredMsg?e.answeredMsg.attr("stamp"):null,p=e.alternativeContent.length>0?{type:e.alternativeContent.attr("type"),message:e.alternativeContent.text()}:null;if(r=i.addChatMessage(e.participant,e.date,e.body,e.messageId,null,e.markdown,e.subject,h,f,e.additionalContent,p,e.mentions,e.urgency),h){var m=i.getMessageById(h);m?(m.urgencyAck=!0,m.urgencyHandler&&m.urgencyHandler()):s.default.error("[ConversationServiceEventHandler] Not possible to handle answeredMsg because replied msg not found")}}r&&(r.isForwarded=!!e.isForwarded&&e.isForwarded,this.acknowledgeHandledChatMessage(e,i,r))}},{key:"acknowledgeHandledChatMessage",value:function(e,t,n){if(s.default.info("[ConversationServiceEventHandler] acknowledgeHandledChatMessage"),!n)return n=t.getMessageById(e.messageId),void(t.room&&n&&n.side===r.Message.Side.RIGHT&&this.conversationService.sendAckReceivedMessage(t,n));n.side===r.Message.Side.LEFT?(t===this.conversationService.activeConversation&&"away"!==o.default.userContact.status&&this.$rootScope.appVisible&&!t.isFullScreenNoChat?this.conversationService.sendAckReadMessage(t,n):(this.conversationService.sendAckReceivedMessage(t,n),!e.offline&&e.convReady&&t.setMissedCounter(t.missedCounter+1)),n.isTextModified()&&(n.receiptStatus===r.Message.ReceiptStatus.READ&&this.conversationService.sendAckReadOrReceivedMessage(t,e.messageId,"read"),t.updateMessage(n))):(e.carbon?n.setReceiptStatus(r.Message.ReceiptStatus.SENT):n.setReceiptStatus(r.Message.ReceiptStatus.IN_PROGRESS),t.updateMessage(n)),t.setStatusMessage(e.participant,this.Conversation.Status.ACTIVE),this.$rootScope.$broadcast("ON_CONVERSATION_MESSAGE_RECEIVED",n,t,e.carbon),this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",t)}},{key:"handleReceiptReceiveMessage",value:function(e,t){s.default.info("[ConversationServiceEventHandler] handleReceiptReceiveMessage");var n=$(t).find("received[xmlns='urn:xmpp:receipts']");if(n.length){var i=$(n).attr("id"),a=e.getMessageById(i);if(a){var c=$(t).attr("from").split("/")[1];c||(c=$(t).attr("from"));var l=$(n).attr("event");(e.room&&o.default.isUserContactJid(c)||!e.room)&&("received"===l?a.setReceiptStatus(r.Message.ReceiptStatus.UNREAD):"read"===l&&(a.setReceiptStatus(r.Message.ReceiptStatus.READ),e.setMissedCounter(0))),o.default.isUserContactJid(c)&&"read"===l&&"L"===a.side&&e.setMissedCounter(0),e.updateMessage(a),this.$rootScope.$broadcast("ON_CONVERSATION_RECEIPT_RECEIVED",a,e,l),this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",e)}else{var u=$(t).attr("from"),d=$(n).attr("event"),h="";u&&(h=u.split("/")[1]),h||(h=u),o.default.isUserContactJid(h)&&"read"===d&&(e.setMissedCounter(0),this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",e))}}}},{key:"handleStatusMessage",value:function(e,t,n){s.default.info("[conversationServiceEventHandler] handleStatusMessage ");var r;r="thread"===$(n).children().prop("tagName")?this.Conversation.stringToStatus($($(n).children()[1]).prop("tagName")):this.Conversation.stringToStatus($(n).children().prop("tagName")),e.setStatusMessage(t,r),this.$rootScope.$broadcast("ON_CONVERSATIONS_STATUS_MESSAGE_EVENT",e,t,r)}},{key:"onRecordingMessageReceived",value:function(e){var t=this;s.default.info("[ConversationServiceEventHandler] onRecordingMessageReceived");try{var n=e.textContent;return this.extractStanzaData(e).then((function(e){if("start"===n){var r=e.conversation;r.addRecordingMessage(e.participant,e.date,n,e.messageId),r.setStatusMessage(e.participant,t.Conversation.Status.ACTIVE),r.videoCall&&(r.videoCall.isRecorded=!0),t.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",r),t.$rootScope.$broadcast("ON_RECORDING_START_MSG_RECEIVED")}else if("stop"===n){var i=e.conversation;i&&(i.addRecordingMessage(e.participant,e.date,n,e.messageId),i.videoCall&&(i.videoCall.isRecorded=!1)),t.$rootScope.$broadcast("ON_RECORDING_STOP_MSG_RECEIVED")}else"remoteStopVideo"===n?t.$rootScope.$broadcast("ON_RECORDING_REMOTESTOPVIDEO_MSG_RECEIVED"):"remoteChangeMediaVideo"===n?t.$rootScope.$broadcast("ON_RECORDING_REMOTECHANGEMEDIAVIDEO_MSG_RECEIVED"):"remoteStopSharing"===n?t.$rootScope.$broadcast("ON_RECORDING_REMOTESTOPSHARING_MSG_RECEIVED"):"remoteChangeMediaSharing"===n&&t.$rootScope.$broadcast("ON_RECORDING_REMOTECHANGEMEDIASHARING_MSG_RECEIVED")})),!0}catch(r){return s.default.error("[ConversationServiceEventHandler] onRecordingMessageReceived error "+r),!0}}}],[{key:"create",value:function(t,n,r,i,a){return new e(t,n,r,i,a)}}]),e}();t.ConversationServiceEventHandler=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(24),a=function(){function e(t,n,i,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.History.NONE,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]&&arguments[10],f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:"unlock",m=arguments.length>13&&void 0!==arguments[13]&&arguments[13],v=arguments.length>14&&void 0!==arguments[14]?arguments[14]:[],g=arguments.length>15&&void 0!==arguments[15]?arguments[15]:"",y=arguments.length>16&&void 0!==arguments[16]?arguments[16]:"";S(this,e),this.nameForLogs="",this.users=[],this.ownerContact=null,this.organizers=[],this.members=[],this.avatarContacts=[],this.owner=!1,this.isModerator=!1,this.status="none",this.rxSubject=new r.Subject,this.initPresPromise=null,this.initPresPromiseResolve=null,this.initPresInterval=null,this.initPresenceAck=!1,this.autoAcceptInvitation=!1,this.tags=[],this.foundByTag=!1,this.filterName=null,this.containerId="",this.containerName="",this.webinarId=null,this.dbId=t,this.jid=n,this.name=i,this.desc=a,this.creationDate=o,this.type=e.Type.PRIVATE,this.history=c,this.customData=l,this.confEndpoints=s,this.conference=u,this.avatar=d,this.isActive=h,this.lastActivityDate=f,this.autoRegister=p,this.autoAcceptInvitation=m,this.tags=v,this.containerId=g||"",this.autoAcceptInvitation=m,this.tags=v,this.containerId=g||"",this.containerName=y||""}return C(e,[{key:"toString",value:function(){return"Room "+this.dbId+" "+this.name+" "+this.jid}},{key:"getCreationDate",value:function(){return this.creationDate?new Date(this.creationDate):new Date}},{key:"getLastActivityDate",value:function(){return this.lastActivityDate?new Date(this.lastActivityDate):this.getCreationDate()}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"updateAvatarInfo",value:function(){if(!this.avatar){var e=[],t=this.users.slice();t.sort((function(e,t){return new Date(e.date)>new Date(t.date)?1:new Date(e.date)<new Date(t.date)?-1:0}));for(var n=0;n<t.length;n++){var r=t[n].contact,a=t[n].status;if(!(this.ownerContact&&r.dbId===this.ownerContact.dbId||r.isAnonymousGuest()||r.isBadGuest()||r.isTerminated)&&(!this.owner&&!this.isModerator||"accepted"!==a&&"invited"!==a?"accepted"===a&&e.push(r):e.push(r),5===e.length))break}this.avatarContacts=e,this.rxSubject&&this.rxSubject.next(i.RBEvent.create("updateAvatarInfo",this.avatarContacts))}}},{key:"isUserOwner",value:function(e){return!!e&&this.ownerContact&&this.ownerContact.jid===e.jid}},{key:"isUserModerator",value:function(e){return void 0!==this.getOrganizerFromContactJid(e.jid)}},{key:"isUserStatusAccepted",value:function(e){var t=this.getUserByJid(e.jid);return void 0!==t&&"accepted"===t.status}},{key:"isUserStatusAcceptedOrInvited",value:function(e){var t=this.getUserByJid(e.jid);return void 0!==t&&("accepted"===t.status||"invited"===t.status)}},{key:"isUserStillBelongToRoom",value:function(e){var t=this.getUserByJid(e);return!t||"unsubscribed"!==t.status&&"deleted"!==t.status}},{key:"getOrganizerFromContactJid",value:function(e){var t;return this.organizers.forEach((function(n){n.contact.jid===e&&(t=n)})),t}},{key:"getUserByJid",value:function(e){for(var t=0;t<this.users.length;t++)if(e===this.users[t].contact.jid)return this.users[t];return null}},{key:"getPstnConfEndpointId",value:function(){if(this.confEndpoints&&this.confEndpoints.length)for(var e=0;e<this.confEndpoints.length;e++)if("pstnAudio"===this.confEndpoints[e].mediaType)return this.confEndpoints[e].confEndpointId;return null}},{key:"getSFUConfEndpointId",value:function(){if(this.confEndpoints&&this.confEndpoints.length)for(var e=0;e<this.confEndpoints.length;e++)if("webrtc"===this.confEndpoints[e].mediaType)return this.confEndpoints[e].confEndpointId;return null}},{key:"getSFUSharingConfEndpointId",value:function(){if(this.confEndpoints&&this.confEndpoints.length)for(var e=0;e<this.confEndpoints.length;e++)if("webrtcSharingOnly"===this.confEndpoints[e].mediaType)return this.confEndpoints[e].confEndpointId;return null}},{key:"isMyPersonalMeetingRoom",value:function(){return this.conference&&"pstnAudio"===this.conference.mediaType&&!this.conference.scheduled&&this.conference.personalMeeting&&this.owner}},{key:"isMeetingRoom",value:function(){return this.conference&&"pstnAudio"===this.conference.mediaType}},{key:"isWebinarRoom",value:function(){return this.conference&&this.conference.webinarId}},{key:"isWebConferenceRoom",value:function(){return this.conference&&"pstnAudio"!==this.conference.mediaType&&null!==this.getSFUConfEndpointId()}},{key:"isMeetingOrWebConferenceRoom",value:function(){return this.isMeetingRoom()||null!==this.getSFUConfEndpointId()}},{key:"getNameForLogs",value:function(){if(!this.nameForLogs&&this.name){var e=this.name.replace(/[^\s](?=.{1,}$)/g,"*");this.nameForLogs=this.name.charAt(0)+e.substr(1)}return this.nameForLogs}},{key:"getAutoRegister",value:function(){return this.autoRegister?this.autoRegister:"unlock"}},{key:"setAutoRegister",value:function(e){this.autoRegister=e}},{key:"getAutoAcceptInvitation",value:function(){return this.autoAcceptInvitation}},{key:"setAutoAcceptInvitation",value:function(e){this.autoAcceptInvitation=e}},{key:"getMuteUponEntry",value:function(){return this.conference?this.conference.muteUponEntry:"false"}},{key:"setMuteUponEntry",value:function(e){this.conference&&(this.conference.muteUponEntry=e)}},{key:"getDisableTimeStats",value:function(){return this.conference?this.conference.disableTimeStats:"false"}},{key:"setDisableTimeStats",value:function(e){this.conference&&(this.conference.disableTimeStats=e)}},{key:"getAllAcceptedMembers",value:function(){return this.members.filter((function(e){return!e.contact.isBadGuest()&&!e.contact.isAnonymousGuest()&&!e.contact.isTerminated&&"accepted"===e.status}))}},{key:"getAllAcceptedUsers",value:function(){return this.users.filter((function(e){return!e.contact.isBadGuest()&&!e.contact.isAnonymousGuest()&&!e.contact.isTerminated&&"accepted"===e.status}))}},{key:"getTagColor",value:function(e){var t=this.tags.findIndex((function(t){return t.tag===e}));return t>-1?this.tags[t].color:"#ff9900"}}],[{key:"create",value:function(t,n,r,i,a,o,s,c,l,u,d){var h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:"unlock",p=arguments.length>13&&void 0!==arguments[13]&&arguments[13],m=arguments.length>14&&void 0!==arguments[14]?arguments[14]:[],v=arguments.length>15&&void 0!==arguments[15]?arguments[15]:"",g=arguments.length>16&&void 0!==arguments[16]?arguments[16]:"",y=new e(t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g);return y.lastActivityDate=h,y}}]),e}();a.Type={PRIVATE:0,PUBLIC:1},a.Privilege={USER:"user",MODERATOR:"moderator",GUEST:"guest"},a.History={ALL:"all",NONE:"none"},t.Room=a},function(e,t,n){var r,i,a,o,s;o=this,s=function(e){var t=!1,n=!1,r=!1,i=!1,a="escape years months weeks days hours minutes seconds milliseconds general".split(" "),o=[{type:"seconds",targets:[{type:"minutes",value:60},{type:"hours",value:3600},{type:"days",value:86400},{type:"weeks",value:604800},{type:"months",value:2678400},{type:"years",value:31536e3}]},{type:"minutes",targets:[{type:"hours",value:60},{type:"days",value:1440},{type:"weeks",value:10080},{type:"months",value:44640},{type:"years",value:525600}]},{type:"hours",targets:[{type:"days",value:24},{type:"weeks",value:168},{type:"months",value:744},{type:"years",value:8760}]},{type:"days",targets:[{type:"weeks",value:7},{type:"months",value:31},{type:"years",value:365}]},{type:"months",targets:[{type:"years",value:12}]}];function s(e,t){return!(t.length>e.length)&&-1!==e.indexOf(t)}function c(e){for(var t="";e;)t+="0",e-=1;return t}function l(e,t){var n=e+"+"+y(k(t).sort(),(function(e){return e+":"+t[e]})).join(",");return l.cache[n]||(l.cache[n]=Intl.NumberFormat(e,t)),l.cache[n]}function u(e,t,a){var o,s,d,h=t.useToLocaleString,f=t.useGrouping,p=f&&t.grouping.slice(),m=t.maximumSignificantDigits,v=t.minimumIntegerDigits||1,g=t.fractionDigits||0,y=t.groupingSeparator,b=t.decimalSeparator;if(h&&a){var S,_={minimumIntegerDigits:v,useGrouping:f};return g&&(_.maximumFractionDigits=g,_.minimumFractionDigits=g),m&&e>0&&(_.maximumSignificantDigits=m),r?(i||((S=T({},t)).useGrouping=!1,S.decimalSeparator=".",e=parseFloat(u(e,S),10)),l(a,_).format(e)):(n||((S=T({},t)).useGrouping=!1,S.decimalSeparator=".",e=parseFloat(u(e,S),10)),e.toLocaleString(a,_))}var C=(m?e.toPrecision(m+1):e.toFixed(g+1)).split("e");d=C[1]||"",s=(C=C[0].split("."))[1]||"";var w=(o=C[0]||"").length,E=s.length,k=w+E,M=o+s;(m&&k===m+1||!m&&E===g+1)&&((M=function(e){for(var t=e.split("").reverse(),n=0,r=!0;r&&n<t.length;)n?"9"===t[n]?t[n]="0":(t[n]=(parseInt(t[n],10)+1).toString(),r=!1):(parseInt(t[n],10)<5&&(r=!1),t[n]="0"),n+=1;return r&&t.push("1"),t.reverse().join("")}(M)).length===k+1&&(w+=1),E&&(M=M.slice(0,-1)),o=M.slice(0,w),s=M.slice(w)),m&&(s=s.replace(/0*$/,""));var D=parseInt(d,10);D>0?s.length<=D?(o+=s+=c(D-s.length),s=""):(o+=s.slice(0,D),s=s.slice(D)):D<0&&(s=c(Math.abs(D)-o.length)+o+s,o="0"),m||((s=s.slice(0,g)).length<g&&(s+=c(g-s.length)),o.length<v&&(o=c(v-o.length)+o));var x,R="";if(f)for(C=o;C.length;)p.length&&(x=p.shift()),R&&(R=y+R),R=C.slice(-x)+R,C=C.slice(0,-x);else R=o;return s&&(R=R+b+s),R}function d(e,t){return e.label.length>t.label.length?-1:e.label.length<t.label.length?1:0}function h(e,t){var n=[];return g(k(t),(function(r){if("_durationLabels"===r.slice(0,15)){var i=r.slice(15).toLowerCase();g(k(t[r]),(function(a){a.slice(0,1)===e&&n.push({type:i,key:a,label:t[r][a]})}))}})),n}l.cache={};var f={durationLabelsStandard:{S:"millisecond",SS:"milliseconds",s:"second",ss:"seconds",m:"minute",mm:"minutes",h:"hour",hh:"hours",d:"day",dd:"days",w:"week",ww:"weeks",M:"month",MM:"months",y:"year",yy:"years"},durationLabelsShort:{S:"msec",SS:"msecs",s:"sec",ss:"secs",m:"min",mm:"mins",h:"hr",hh:"hrs",d:"dy",dd:"dys",w:"wk",ww:"wks",M:"mo",MM:"mos",y:"yr",yy:"yrs"},durationTimeTemplates:{HMS:"h:mm:ss",HM:"h:mm",MS:"m:ss"},durationLabelTypes:[{type:"standard",string:"__"},{type:"short",string:"_"}],durationPluralKey:function(e,t,n){return 1===t&&null===n?e:e+e}};function p(e){return"[object Array]"===Object.prototype.toString.call(e)}function m(e){return"[object Object]"===Object.prototype.toString.call(e)}function v(e,t){var n,r=0,i=e&&e.length||0;for("function"!=typeof t&&(n=t,t=function(e){return e===n});r<i;){if(t(e[r]))return e[r];r+=1}}function g(e,t){var n=0,r=e.length;if(e&&r)for(;n<r;){if(!1===t(e[n],n))return;n+=1}}function y(e,t){var n=0,r=e.length,i=[];if(!e||!r)return i;for(;n<r;)i[n]=t(e[n],n),n+=1;return i}function b(e,t){return y(e,(function(e){return e[t]}))}function S(e){var t=[];return g(e,(function(e){e&&t.push(e)})),t}function _(e){var t=[];return g(e,(function(e){v(t,e)||t.push(e)})),t}function C(e,t){var n=[];return g(e,(function(e){g(t,(function(t){e===t&&n.push(e)}))})),_(n)}function w(e,t){var n=[];return g(e,(function(r,i){if(!t(r))return n=e.slice(i),!1})),n}function E(e,t){return w(e.slice().reverse(),t).reverse()}function T(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function k(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}function M(e,t){var n=0,r=e.length;if(!e||!r)return!1;for(;n<r;){if(!0===t(e[n],n))return!0;n+=1}return!1}function D(e){var t=[];return g(e,(function(e){t=t.concat(e)})),t}function x(e){return"3.6"===e(3.55,"en",{useGrouping:!1,minimumIntegerDigits:1,minimumFractionDigits:1,maximumFractionDigits:1})}function R(e){var t=!0;return!!((t=(t=(t=t&&"1"===e(1,"en",{minimumIntegerDigits:1}))&&"01"===e(1,"en",{minimumIntegerDigits:2}))&&"001"===e(1,"en",{minimumIntegerDigits:3}))&&(t=(t=(t=(t=t&&"100"===e(99.99,"en",{maximumFractionDigits:0,minimumFractionDigits:0}))&&"100.0"===e(99.99,"en",{maximumFractionDigits:1,minimumFractionDigits:1}))&&"99.99"===e(99.99,"en",{maximumFractionDigits:2,minimumFractionDigits:2}))&&"99.990"===e(99.99,"en",{maximumFractionDigits:3,minimumFractionDigits:3}))&&(t=(t=(t=(t=(t=t&&"100"===e(99.99,"en",{maximumSignificantDigits:1}))&&"100"===e(99.99,"en",{maximumSignificantDigits:2}))&&"100"===e(99.99,"en",{maximumSignificantDigits:3}))&&"99.99"===e(99.99,"en",{maximumSignificantDigits:4}))&&"99.99"===e(99.99,"en",{maximumSignificantDigits:5}))&&(t=(t=t&&"1,000"===e(1e3,"en",{useGrouping:!0}))&&"1000"===e(1e3,"en",{useGrouping:!1})))}function O(){var e,t=[].slice.call(arguments),n={};if(g(t,(function(t,r){if(!r){if(!p(t))throw"Expected array as the first argument to durationsFormat.";e=t}"string"!=typeof t&&"function"!=typeof t?"number"!=typeof t?m(t)&&T(n,t):n.precision=t:n.template=t})),!e||!e.length)return[];n.returnMomentTypes=!0;var r=y(e,(function(e){return e.format(n)})),i=C(a,_(b(D(r),"type"))),o=n.largest;return o&&(i=i.slice(0,o)),n.returnMomentTypes=!1,n.outputTypes=i,y(e,(function(e){return e.format(n)}))}function I(){var n=[].slice.call(arguments),i=T({},this.format.defaults),c=this.asMilliseconds(),l=this.asMonths();"function"==typeof this.isValid&&!1===this.isValid()&&(c=0,l=0);var D=c<0,x=e.duration(Math.abs(c),"milliseconds"),R=e.duration(Math.abs(l),"months");g(n,(function(e){"string"!=typeof e&&"function"!=typeof e?"number"!=typeof e?m(e)&&T(i,e):i.precision=e:i.template=e}));var O={years:"y",months:"M",weeks:"w",days:"d",hours:"h",minutes:"m",seconds:"s",milliseconds:"S"},I={escape:/\[(.+?)\]/,years:/\*?[Yy]+/,months:/\*?M+/,weeks:/\*?[Ww]+/,days:/\*?[Dd]+/,hours:/\*?[Hh]+/,minutes:/\*?m+/,seconds:/\*?s+/,milliseconds:/\*?S+/,general:/.+?/};i.types=a;var P=function(e){return v(a,(function(t){return I[t].test(e)}))},A=new RegExp(y(a,(function(e){return I[e].source})).join("|"),"g");i.duration=this;var L="function"==typeof i.template?i.template.apply(i):i.template,N=i.outputTypes,j=i.returnMomentTypes,U=i.largest,F=[];N||(p(i.stopTrim)&&(i.stopTrim=i.stopTrim.join("")),i.stopTrim&&g(i.stopTrim.match(A),(function(e){var t=P(e);"escape"!==t&&"general"!==t&&F.push(t)})));var H=e.localeData();H||(H={}),g(k(f),(function(e){"function"!=typeof f[e]?H["_"+e]||(H["_"+e]=f[e]):H[e]||(H[e]=f[e])})),g(k(H._durationTimeTemplates),(function(e){L=L.replace("_"+e+"_",H._durationTimeTemplates[e])}));var W=i.userLocale||e.locale(),Y=i.useLeftUnits,B=i.usePlural,V=i.precision,$=i.forceLength,G=i.useGrouping,z=i.trunc,q=i.useSignificantDigits&&V>0,J=q?i.precision:0,K=J,Q=i.minValue,X=!1,Z=i.maxValue,ee=!1,te=i.useToLocaleString,ne=i.groupingSeparator,re=i.decimalSeparator,ie=i.grouping;te=te&&(t||r);var ae=i.trim;p(ae)&&(ae=ae.join(" ")),null===ae&&(U||Z||q)&&(ae="all"),null!==ae&&!0!==ae&&"left"!==ae&&"right"!==ae||(ae="large"),!1===ae&&(ae="");var oe=function(e){return e.test(ae)},se=/large/,ce=/small/,le=/both/,ue=/mid/,de=/^all|[^sm]all/,he=/final/,fe=U>0||M([se,le,de],oe),pe=M([ce,le,de],oe),me=M([ue,de],oe),ve=M([he,de],oe),ge=y(L.match(A),(function(e,t){var n=P(e);return"*"===e.slice(0,1)&&(e=e.slice(1),"escape"!==n&&"general"!==n&&F.push(n)),{index:t,length:e.length,text:"",token:"escape"===n?e.replace(I.escape,"$1"):e,type:"escape"===n||"general"===n?null:n}})),ye={index:0,length:0,token:"",text:"",type:null},be=[];Y&&ge.reverse(),g(ge,(function(e){if(e.type)return(ye.type||ye.text)&&be.push(ye),void(ye=e);Y?ye.text=e.token+ye.text:ye.text+=e.token})),(ye.type||ye.text)&&be.push(ye),Y&&be.reverse();var Se=C(a,_(S(b(be,"type"))));if(!Se.length)return b(be,"text").join("");Se=y(Se,(function(e,t){var n,r=t+1===Se.length,a=!t;n="years"===e||"months"===e?R.as(e):x.as(e);var o=Math.floor(n),s=n-o,c=v(be,(function(t){return e===t.type}));return a&&Z&&n>Z&&(ee=!0),r&&Q&&Math.abs(i.duration.as(e))<Q&&(X=!0),a&&null===$&&c.length>1&&($=!0),x.subtract(o,e),R.subtract(o,e),{rawValue:n,wholeValue:o,decimalValue:r?s:0,isSmallest:r,isLargest:a,type:e,tokenLength:c.length}}));var _e=z?Math.floor:Math.round,Ce=function(e,t){var n=Math.pow(10,t);return _e(e*n)/n},we=!1,Ee=!1,Te=function(e,t){var n={useGrouping:G,groupingSeparator:ne,decimalSeparator:re,grouping:ie,useToLocaleString:te};return q&&(J<=0?(e.rawValue=0,e.wholeValue=0,e.decimalValue=0):(n.maximumSignificantDigits=J,e.significantDigits=J)),ee&&!Ee&&(e.isLargest?(e.wholeValue=Z,e.decimalValue=0):(e.wholeValue=0,e.decimalValue=0)),X&&!Ee&&(e.isSmallest?(e.wholeValue=Q,e.decimalValue=0):(e.wholeValue=0,e.decimalValue=0)),e.isSmallest||e.significantDigits&&e.significantDigits-e.wholeValue.toString().length<=0?V<0?e.value=Ce(e.wholeValue,V):0===V?e.value=_e(e.wholeValue+e.decimalValue):q?(e.value=z?Ce(e.rawValue,J-e.wholeValue.toString().length):e.rawValue,e.wholeValue&&(J-=e.wholeValue.toString().length)):(n.fractionDigits=V,e.value=z?e.wholeValue+Ce(e.decimalValue,V):e.wholeValue+e.decimalValue):q&&e.wholeValue?(e.value=Math.round(Ce(e.wholeValue,e.significantDigits-e.wholeValue.toString().length)),J-=e.wholeValue.toString().length):e.value=e.wholeValue,e.tokenLength>1&&($||we)&&(n.minimumIntegerDigits=e.tokenLength,Ee&&n.maximumSignificantDigits<e.tokenLength&&delete n.maximumSignificantDigits),!we&&(e.value>0||""===ae||v(F,e.type)||v(N,e.type))&&(we=!0),e.formattedValue=u(e.value,n,W),n.useGrouping=!1,n.decimalSeparator=".",e.formattedValueEn=u(e.value,n,"en"),2===e.tokenLength&&"milliseconds"===e.type&&(e.formattedValueMS=u(e.value,{minimumIntegerDigits:3,useGrouping:!1},"en").slice(0,2)),e};if((Se=S(Se=y(Se,Te))).length>1){var ke=function(e){return v(Se,(function(t){return t.type===e}))},Me=function(e){var t=ke(e.type);t&&g(e.targets,(function(e){var n=ke(e.type);n&&parseInt(t.formattedValueEn,10)===e.value&&(t.rawValue=0,t.wholeValue=0,t.decimalValue=0,n.rawValue+=1,n.wholeValue+=1,n.decimalValue=0,n.formattedValueEn=n.wholeValue.toString(),Ee=!0)}))};g(o,Me)}return Ee&&(we=!1,J=K,Se=S(Se=y(Se,Te))),!N||ee&&!i.trim?(fe&&(Se=w(Se,(function(e){return!e.isSmallest&&!e.wholeValue&&!v(F,e.type)}))),U&&Se.length&&(Se=Se.slice(0,U)),pe&&Se.length>1&&(Se=E(Se,(function(e){return!e.wholeValue&&!v(F,e.type)&&!e.isLargest}))),me&&(Se=S(Se=y(Se,(function(e,t){return t>0&&t<Se.length-1&&!e.wholeValue?null:e})))),!ve||1!==Se.length||Se[0].wholeValue||!z&&Se[0].isSmallest&&Se[0].rawValue<Q||(Se=[])):Se=S(Se=y(Se,(function(e){return v(N,(function(t){return e.type===t}))?e:null}))),j?Se:(g(be,(function(e){var t=O[e.type],n=v(Se,(function(t){return t.type===e.type}));if(t&&n){var r=n.formattedValueEn.split(".");r[0]=parseInt(r[0],10),r[1]?r[1]=parseFloat("0."+r[1],10):r[1]=null;var i=H.durationPluralKey(t,r[0],r[1]),a=h(t,H),o=!1,c={};g(H._durationLabelTypes,(function(t){var n=v(a,(function(e){return e.type===t.type&&e.key===i}));n&&(c[n.type]=n.label,s(e.text,t.string)&&(e.text=e.text.replace(t.string,n.label),o=!0))})),B&&!o&&(a.sort(d),g(a,(function(t){return c[t.type]===t.label?!s(e.text,t.label)&&void 0:s(e.text,t.label)?(e.text=e.text.replace(t.label,c[t.type]),!1):void 0})))}})),(be=y(be,(function(e){if(!e.type)return e.text;var t=v(Se,(function(t){return t.type===e.type}));if(!t)return"";var n="";return Y&&(n+=e.text),(D&&ee||!D&&X)&&(n+="< ",ee=!1,X=!1),(D&&X||!D&&ee)&&(n+="> ",ee=!1,X=!1),D&&(t.value>0||""===ae||v(F,t.type)||v(N,t.type))&&(n+="-",D=!1),"milliseconds"===e.type&&t.formattedValueMS?n+=t.formattedValueMS:n+=t.formattedValue,Y||(n+=e.text),n}))).join("").replace(/(,| |:|\.)*$/,"").replace(/^(,| |:|\.)*/,""))}function P(){var e=this.duration,t=function(t){return e._data[t]},n=v(this.types,t),r=function(e,t){for(var n=e.length;n-=1;)if(t(e[n]))return e[n]}(this.types,t);switch(n){case"milliseconds":return"S __";case"seconds":case"minutes":return"*_MS_";case"hours":return"_HMS_";case"days":if(n===r)return"d __";case"weeks":return n===r?"w __":(null===this.trim&&(this.trim="both"),"w __, d __, h __");case"months":if(n===r)return"M __";case"years":return n===r?"y __":(null===this.trim&&(this.trim="both"),"y __, M __, d __");default:return null===this.trim&&(this.trim="both"),"y __, d __, h __, m __, s __"}}function A(e){if(!e)throw"Moment Duration Format init cannot find moment instance.";e.duration.format=O,e.duration.fn.format=I,e.duration.fn.format.defaults={trim:null,stopTrim:null,largest:null,maxValue:null,minValue:null,precision:0,trunc:!1,forceLength:null,userLocale:null,usePlural:!0,useLeftUnits:!1,useGrouping:!0,useSignificantDigits:!1,template:P,useToLocaleString:!0,groupingSeparator:",",decimalSeparator:".",grouping:[3]},e.updateLocale("en",f)}var L=function(e,t,n){return e.toLocaleString(t,n)};t=function(){try{(0).toLocaleString("i")}catch(e){return"RangeError"===e.name}return!1}()&&R(L),n=t&&x(L);var N=function(e,t,n){if("undefined"!=typeof window&&window&&window.Intl&&window.Intl.NumberFormat)return window.Intl.NumberFormat(t,n).format(e)};return r=R(N),i=r&&x(N),A(e),A},i=[n(3)],void 0===(a="function"==typeof(r=s)?r.apply(t,i):r)||(e.exports=a),o&&(o.momentDurationFormatSetup=o.moment?s(o.moment):s)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n,r,i,a,o,s,c,l,u,d,h){S(this,e),this.participantId=t,this.userId=n,this.jid_im=r,this.jid_tel=i,this.participantRole=a,this.mute=o,this.held=s,this.confStartDate=c,this.startDate=l,this.phoneNumber=u,this.participantState=d,this.delegateCapability=h}return C(e,[{key:"updateFromData",value:function(e){e.participantId&&(this.participantId=e.participantId),e.userId&&(this.userId=e.userId),this.jid_im=e.jid_im,e.jid_tel&&(this.jid_tel=e.jid_tel),this.participantRole=e.participantRole,this.mute=e.mute,this.held=e.held,this.confStartDate=e.confStartDate,this.startDate=e.startDate,this.phoneNumber=e.phoneNumber,this.participantState=e.participantState,this.delegateCapability=e.delegateCapability}}],[{key:"createFromData",value:function(t){return new e(t.participantId,t.userId,t.jid_im,t.jid_tel,t.participantRole,t.mute,t.held,t.confStartDate,t.startDate,t.phoneNumber,t.participantState,t.delegateCapability)}}]),e}();t.ConferenceParticipant=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(55),i=n(45);t.scheduleArray=function(e,t){return new r.Observable((function(n){var r=new i.Subscription,a=0;return r.add(t.schedule((function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}},function(e,t,n){(function(e){!function(t){var n,r=void 0!==e&&e,i="undefined"!=typeof Uint8Array&&Uint8Array,a="undefined"!=typeof ArrayBuffer&&ArrayBuffer,o=[0,0,0,0,0,0,0,0],s=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},c=4294967296;function l(e,s,l){var S=s?0:4,_=s?4:0,C=s?0:3,w=s?1:2,E=s?2:1,T=s?3:0,k=s?v:y,M=s?g:b,D=O.prototype,x="is"+e,R="_"+x;return D.buffer=void 0,D.offset=0,D[R]=!0,D.toNumber=I,D.toString=function(e){var t=this.buffer,n=this.offset,r=A(t,n+S),i=A(t,n+_),a="",o=!l&&2147483648&r;for(o&&(r=~r,i=c-i),e=e||10;;){var s=r%e*c+i;if(r=Math.floor(r/e),i=Math.floor(s/e),a=(s%e).toString(e)+a,!r&&!i)break}return o&&(a="-"+a),a},D.toJSON=I,D.toArray=u,r&&(D.toBuffer=d),i&&(D.toArrayBuffer=h),O[x]=function(e){return!(!e||!e[R])},t[e]=O,O;function O(e,t,r,s){return this instanceof O?function(e,t,r,s,l){i&&a&&(t instanceof a&&(t=new i(t)),s instanceof a&&(s=new i(s))),t||r||s||n?(f(t,r)||(l=r,s=t,r=0,t=new(n||Array)(8)),e.buffer=t,e.offset=r|=0,void 0!==s&&("string"==typeof s?function(e,t,n,r){var i=0,a=n.length,o=0,s=0;"-"===n[0]&&i++;for(var l=i;i<a;){var u=parseInt(n[i++],r);if(!(u>=0))break;s=s*r+u,o=o*r+Math.floor(s/c),s%=c}l&&(o=~o,s?s=c-s:o++),P(e,t+S,o),P(e,t+_,s)}(t,r,s,l||10):f(s,l)?p(t,r,s,l):"number"==typeof l?(P(t,r+S,s),P(t,r+_,l)):s>0?k(t,r,s):s<0?M(t,r,s):p(t,r,o,0))):e.buffer=m(o,0)}(this,e,t,r,s):new O(e,t,r,s)}function I(){var e=this.buffer,t=this.offset,n=A(e,t+S),r=A(e,t+_);return l||(n|=0),n?n*c+r:r}function P(e,t,n){e[t+T]=255&n,n>>=8,e[t+E]=255&n,n>>=8,e[t+w]=255&n,n>>=8,e[t+C]=255&n}function A(e,t){return 16777216*e[t+C]+(e[t+w]<<16)+(e[t+E]<<8)+e[t+T]}}function u(e){var t=this.buffer,r=this.offset;return n=null,!1!==e&&0===r&&8===t.length&&s(t)?t:m(t,r)}function d(t){var i=this.buffer,a=this.offset;if(n=r,!1!==t&&0===a&&8===i.length&&e.isBuffer(i))return i;var o=new r(8);return p(o,0,i,a),o}function h(e){var t=this.buffer,r=this.offset,o=t.buffer;if(n=i,!1!==e&&0===r&&o instanceof a&&8===o.byteLength)return o;var s=new i(8);return p(s,0,t,r),s.buffer}function f(e,t){var n=e&&e.length;return t|=0,n&&t+8<=n&&"string"!=typeof e[t]}function p(e,t,n,r){t|=0,r|=0;for(var i=0;i<8;i++)e[t++]=255&n[r++]}function m(e,t){return Array.prototype.slice.call(e,t,t+8)}function v(e,t,n){for(var r=t+8;r>t;)e[--r]=255&n,n/=256}function g(e,t,n){var r=t+8;for(n++;r>t;)e[--r]=255&-n^255,n/=256}function y(e,t,n){for(var r=t+8;t<r;)e[t++]=255&n,n/=256}function b(e,t,n){var r=t+8;for(n++;t<r;)e[t++]=255&-n^255,n/=256}l("Uint64BE",!0,!0),l("Int64BE",!0,!1),l("Uint64LE",!1,!0),l("Int64LE",!1,!1)}("string"!=typeof t.nodeName?t:this||{})}).call(this,n(57).Buffer)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(48),i=n(48),a=n(232).byEbmlID,o=function(){function e(){this._schema=a,this._buffers=[],this._stack=[]}return e.prototype.encode=function(e){var t=this;return r.concat(e.reduce((function(e,n){return e.concat(t.encodeChunk(n))}),[])).buffer},e.prototype.encodeChunk=function(e){return"m"===e.type?e.isEnd?this.endTag(e):this.startTag(e):this.writeTag(e),this.flush()},e.prototype.flush=function(){var e=this._buffers;return this._buffers=[],e},e.prototype.getSchemaInfo=function(e){for(var t=Object.keys(this._schema).map(Number),n=0;n<t.length;n++){var r=t[n];if(this._schema[r].name===e)return new i.Buffer(r.toString(16),"hex")}return null},e.prototype.writeTag=function(e){var t=e.name,n=this.getSchemaInfo(t),i=e.data;if(null==n)throw new Error("No schema entry found for "+t);var a=r.encodeTag(n,i);this._stack.length>0?this._stack[this._stack.length-1].children.push({tagId:n,elm:e,children:[],data:a}):this._buffers=this._buffers.concat(a)},e.prototype.startTag=function(e){var t=e.name,n=this.getSchemaInfo(t);if(null==n)throw new Error("No schema entry found for "+t);if(e.unknownSize){var a=r.encodeTag(n,new i.Buffer(0),e.unknownSize);this._buffers=this._buffers.concat(a)}else{var o={tagId:n,elm:e,children:[],data:null};this._stack.length>0&&this._stack[this._stack.length-1].children.push(o),this._stack.push(o)}},e.prototype.endTag=function(e){e.name;var t=this._stack.pop();if(null==t)throw new Error("EBML structure is broken");if(t.elm.name!==e.name)throw new Error("EBML structure is broken");var n=t.children.reduce((function(e,t){if(null===t.data)throw new Error("EBML structure is broken");return e.concat(t.data)}),[]),i=r.concat(n);"m"===t.elm.type?t.data=r.encodeTag(t.tagId,i,t.elm.unknownSize):t.data=r.encodeTag(t.tagId,i),this._stack.length<1&&(this._buffers=this._buffers.concat(t.data))},e}();t.default=o},function(e,t,n){var r={128:{name:"ChapterDisplay",level:4,type:"m",multiple:!0,minver:1,webm:!0,description:"Contains all possible strings to use for the chapter display."},131:{name:"TrackType",level:3,type:"u",mandatory:!0,minver:1,range:"1-254",description:"A set of track types coded on 8 bits (1: video, 2: audio, 3: complex, 0x10: logo, 0x11: subtitle, 0x12: buttons, 0x20: control)."},133:{name:"ChapString",cppname:"ChapterString",level:5,type:"8",mandatory:!0,minver:1,webm:!0,description:"Contains the string to use as the chapter atom."},134:{name:"CodecID",level:3,type:"s",mandatory:!0,minver:1,description:"An ID corresponding to the codec, see the codec page for more info."},136:{name:"FlagDefault",cppname:"TrackFlagDefault",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if that track (audio, video or subs) SHOULD be active if no language found matches the user preference. (1 bit)"},137:{name:"ChapterTrackNumber",level:5,type:"u",mandatory:!0,multiple:!0,minver:1,webm:!1,range:"not 0",description:"UID of the Track to apply this chapter too. In the absense of a control track, choosing this chapter will select the listed Tracks and deselect unlisted tracks. Absense of this element indicates that the Chapter should be applied to any currently used Tracks."},145:{name:"ChapterTimeStart",level:4,type:"u",mandatory:!0,minver:1,webm:!0,description:"Timestamp of the start of Chapter (not scaled)."},146:{name:"ChapterTimeEnd",level:4,type:"u",minver:1,webm:!1,description:"Timestamp of the end of Chapter (timestamp excluded, not scaled)."},150:{name:"CueRefTime",level:5,type:"u",mandatory:!0,minver:2,webm:!1,description:"Timestamp of the referenced Block."},151:{name:"CueRefCluster",level:5,type:"u",mandatory:!0,webm:!1,description:"The Position of the Cluster containing the referenced Block."},152:{name:"ChapterFlagHidden",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a chapter is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},16980:{name:"ContentCompAlgo",level:6,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The compression algorithm used. Algorithms that have been specified so far are: 0 - zlib,   3 - Header Stripping"},16981:{name:"ContentCompSettings",level:6,type:"b",minver:1,webm:!1,description:"Settings that might be needed by the decompressor. For Header Stripping (ContentCompAlgo=3), the bytes that were removed from the beggining of each frames of the track."},17026:{name:"DocType",level:1,type:"s",mandatory:!0,default:"matroska",minver:1,description:"A string that describes the type of document that follows this EBML header. 'matroska' in our case or 'webm' for webm files."},17029:{name:"DocTypeReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum DocType version an interpreter has to support to read this file."},17030:{name:"EBMLVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of EBML parser used to create the file."},17031:{name:"DocTypeVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of DocType interpreter used to create the file."},17476:{name:"SegmentFamily",level:2,type:"b",multiple:!0,minver:1,webm:!1,bytesize:16,description:"A randomly generated unique ID that all segments related to each other must use (128 bits)."},17505:{name:"DateUTC",level:2,type:"d",minver:1,description:"Date of the origin of timestamp (value 0), i.e. production date."},17540:{name:"TagDefault",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Indication to know if this is the default/original language to use for the given tag. (1 bit)"},17541:{name:"TagBinary",level:4,type:"b",minver:1,webm:!1,description:"The values of the Tag if it is binary. Note that this cannot be used in the same SimpleTag as TagString."},17543:{name:"TagString",level:4,type:"8",minver:1,webm:!1,description:"The value of the Element."},17545:{name:"Duration",level:2,type:"f",minver:1,range:"> 0",description:"Duration of the segment (based on TimecodeScale)."},17816:{name:"ChapterFlagEnabled",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Specify wether the chapter is enabled. It can be enabled/disabled by a Control Track. When disabled, the movie should skip all the content between the TimeStart and TimeEnd of this chapter (see flag notes). (1 bit)"},18016:{name:"FileMimeType",level:3,type:"s",mandatory:!0,minver:1,webm:!1,description:"MIME type of the file."},18017:{name:"FileUsedStartTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18018:{name:"FileUsedEndTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18037:{name:"FileReferral",level:3,type:"b",webm:!1,description:"A binary value that a track/codec can refer to when the attachment is needed."},20529:{name:"ContentEncodingOrder",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Tells when this modification was used during encoding/muxing starting with 0 and counting upwards. The decoder/demuxer has to start with the highest order number it finds and work its way down. This value has to be unique over all ContentEncodingOrder elements in the segment."},20530:{name:"ContentEncodingScope",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"A bit field that describes which elements have been modified in this way. Values (big endian) can be OR'ed. Possible values: 1 - all frame contents, 2 - the track's private data, 4 - the next ContentEncoding (next ContentEncodingOrder. Either the data inside ContentCompression and/or ContentEncryption)"},20531:{name:"ContentEncodingType",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"A value describing what kind of transformation has been done. Possible values: 0 - compression, 1 - encryption"},20532:{name:"ContentCompression",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the compression used. Must be present if the value of ContentEncodingType is 0 and absent otherwise. Each block must be decompressable even if no previous block is available in order not to prevent seeking."},20533:{name:"ContentEncryption",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the encryption used. Must be present if the value of ContentEncodingType is 1 and absent otherwise."},21368:{name:"CueBlockNumber",level:4,type:"u",minver:1,default:1,range:"not 0",description:"Number of the Block in the specified Cluster."},22100:{name:"ChapterStringUID",level:4,type:"8",mandatory:!1,minver:3,webm:!0,description:"A unique string ID to identify the Chapter. Use for WebVTT cue identifier storage."},22337:{name:"WritingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Writing application ("mkvmerge-0.3.3").'},22612:{name:"SilentTracks",cppname:"ClusterSilentTracks",level:2,type:"m",minver:1,webm:!1,description:"The list of tracks that are not used in that part of the stream. It is useful when using overlay tracks on seeking. Then you should decide what track to use."},25152:{name:"ContentEncoding",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Settings for one content encoding like compression or encryption."},25188:{name:"BitDepth",cppname:"AudioBitDepth",level:4,type:"u",minver:1,range:"not 0",description:"Bits per sample, mostly used for PCM."},25906:{name:"SignedElement",level:3,type:"b",multiple:!0,webm:!1,description:"An element ID whose data will be used to compute the signature."},26148:{name:"TrackTranslate",level:3,type:"m",multiple:!0,minver:1,webm:!1,description:"The track identification for the given Chapter Codec."},26897:{name:"ChapProcessCommand",cppname:"ChapterProcessCommand",level:5,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26914:{name:"ChapProcessTime",cppname:"ChapterProcessTime",level:6,type:"u",mandatory:!0,minver:1,webm:!1,description:"Defines when the process command should be handled (0: during the whole chapter, 1: before starting playback, 2: after playback of the chapter)."},26916:{name:"ChapterTranslate",level:2,type:"m",multiple:!0,minver:1,webm:!1,description:"A tuple of corresponding ID used by chapter codecs to represent this segment."},26931:{name:"ChapProcessData",cppname:"ChapterProcessData",level:6,type:"b",mandatory:!0,minver:1,webm:!1,description:"Contains the command information. The data should be interpreted depending on the ChapProcessCodecID value. For ChapProcessCodecID = 1, the data correspond to the binary DVD cell pre/post commands."},26948:{name:"ChapProcess",cppname:"ChapterProcess",level:4,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26965:{name:"ChapProcessCodecID",cppname:"ChapterProcessCodecID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Contains the type of the codec used for the processing. A value of 0 means native Matroska processing (to be defined), a value of 1 means the DVD command set is used. More codec IDs can be added later."},29555:{name:"Tag",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters."},29572:{name:"SegmentFilename",level:2,type:"8",minver:1,webm:!1,description:"A filename corresponding to this segment."},29766:{name:"AttachmentLink",cppname:"TrackAttachmentLink",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"The UID of an attachment that is used by this codec."},2459272:{name:"CodecName",level:3,type:"8",minver:1,description:"A human-readable string specifying the codec."},408125543:{name:"Segment",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"This element contains all other top-level (level 1) elements. Typically a Matroska file is composed of 1 segment."},17530:{name:"TagLanguage",level:4,type:"s",mandatory:!0,minver:1,webm:!1,default:"und",description:"Specifies the language of the tag specified, in the Matroska languages form."},17827:{name:"TagName",level:4,type:"8",mandatory:!0,minver:1,webm:!1,description:"The name of the Tag that is going to be stored."},26568:{name:"SimpleTag",cppname:"TagSimple",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contains general information about the target."},25542:{name:"TagAttachmentUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Attachment(s) the tags belong to. If the value is 0 at this level, the tags apply to all the attachments in the Segment."},25540:{name:"TagChapterUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Chapter(s) the tags belong to. If the value is 0 at this level, the tags apply to all chapters in the Segment."},25545:{name:"TagEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the EditionEntry(s) the tags belong to. If the value is 0 at this level, the tags apply to all editions in the Segment."},25541:{name:"TagTrackUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Track(s) the tags belong to. If the value is 0 at this level, the tags apply to all tracks in the Segment."},25546:{name:"TargetType",cppname:"TagTargetType",level:4,type:"s",minver:1,webm:!1,strong:"informational",description:'An  string that can be used to display the logical level of the target like "ALBUM", "TRACK", "MOVIE", "CHAPTER", etc (see TargetType).'},26826:{name:"TargetTypeValue",cppname:"TagTargetTypeValue",level:4,type:"u",minver:1,webm:!1,default:50,description:"A number to indicate the logical level of the target (see TargetType)."},25536:{name:"Targets",cppname:"TagTargets",level:3,type:"m",mandatory:!0,minver:1,webm:!1,description:"Contain all UIDs where the specified meta data apply. It is empty to describe everything in the segment."},307544935:{name:"Tags",level:1,type:"m",multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters. A list of valid tags can be found here."},17677:{name:"ChapProcessPrivate",cppname:"ChapterProcessPrivate",level:5,type:"b",minver:1,webm:!1,description:'Some optional data attached to the ChapProcessCodecID information. For ChapProcessCodecID = 1, it is the "DVD level" equivalent.'},17278:{name:"ChapCountry",cppname:"ChapterCountry",level:5,type:"s",multiple:!0,minver:1,webm:!1,description:"The countries corresponding to the string, same 2 octets as in Internet domains."},17276:{name:"ChapLanguage",cppname:"ChapterLanguage",level:5,type:"s",mandatory:!0,multiple:!0,minver:1,webm:!0,default:"eng",description:"The languages corresponding to the string, in the bibliographic ISO-639-2 form."},143:{name:"ChapterTrack",level:4,type:"m",minver:1,webm:!1,description:"List of tracks on which the chapter applies. If this element is not present, all tracks apply"},25539:{name:"ChapterPhysicalEquiv",level:4,type:"u",minver:1,webm:!1,description:'Specify the physical equivalent of this ChapterAtom like "DVD" (60) or "SIDE" (50), see complete list of values.'},28348:{name:"ChapterSegmentEditionUID",level:4,type:"u",minver:1,webm:!1,range:"not 0",description:"The EditionUID to play from the segment linked in ChapterSegmentUID."},28263:{name:"ChapterSegmentUID",level:4,type:"b",minver:1,webm:!1,range:">0",bytesize:16,description:"A segment to play in place of this chapter. Edition ChapterSegmentEditionUID should be used for this segment, otherwise no edition is used."},29636:{name:"ChapterUID",level:4,type:"u",mandatory:!0,minver:1,webm:!0,range:"not 0",description:"A unique ID to identify the Chapter."},182:{name:"ChapterAtom",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains the atom information to use as the chapter atom (apply to all tracks)."},17885:{name:"EditionFlagOrdered",level:3,type:"u",minver:1,webm:!1,default:0,range:"0-1",description:"Specify if the chapters can be defined multiple times and the order to play them is enforced. (1 bit)"},17883:{name:"EditionFlagDefault",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a flag is set (1) the edition should be used as the default one. (1 bit)"},17853:{name:"EditionFlagHidden",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If an edition is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},17852:{name:"EditionUID",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"A unique ID to identify the edition. It's useful for tagging an edition."},17849:{name:"EditionEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains all information about a segment edition."},272869232:{name:"Chapters",level:1,type:"m",minver:1,webm:!0,description:"A system to define basic menus and partition data. For more detailed information, look at the Chapters Explanation."},18094:{name:"FileUID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,range:"not 0",description:"Unique ID representing the file, as random as possible."},18012:{name:"FileData",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The data of the file."},18030:{name:"FileName",level:3,type:"8",mandatory:!0,minver:1,webm:!1,description:"Filename of the attached file."},18046:{name:"FileDescription",level:3,type:"8",minver:1,webm:!1,description:"A human-friendly name for the attached file."},24999:{name:"AttachedFile",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"An attached file."},423732329:{name:"Attachments",level:1,type:"m",minver:1,webm:!1,description:"Contain attached files."},235:{name:"CueRefCodecState",level:5,type:"u",webm:!1,default:0,description:"The position of the Codec State corresponding to this referenced element. 0 means that the data is taken from the initial Track Entry."},21343:{name:"CueRefNumber",level:5,type:"u",webm:!1,default:1,range:"not 0",description:"Number of the referenced Block of Track X in the specified Cluster."},219:{name:"CueReference",level:4,type:"m",multiple:!0,minver:2,webm:!1,description:"The Clusters containing the required referenced Blocks."},234:{name:"CueCodecState",level:4,type:"u",minver:2,webm:!1,default:0,description:"The position of the Codec State corresponding to this Cue element. 0 means that the data is taken from the initial Track Entry."},178:{name:"CueDuration",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The duration of the block according to the segment time base. If missing the track's DefaultDuration does not apply and no duration information is available in terms of the cues."},240:{name:"CueRelativePosition",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The relative position of the referenced block inside the cluster with 0 being the first possible position for an element inside that cluster.",position:"clusterRelative"},241:{name:"CueClusterPosition",level:4,type:"u",mandatory:!0,minver:1,description:"The position of the Cluster containing the required Block.",position:"segment"},247:{name:"CueTrack",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track for which a position is given."},183:{name:"CueTrackPositions",level:3,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contain positions for different tracks corresponding to the timestamp."},179:{name:"CueTime",level:3,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp according to the segment time base."},187:{name:"CuePoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains all information relative to a seek point in the segment."},475249515:{name:"Cues",level:1,type:"m",minver:1,description:'A top-level element to speed seeking access. All entries are local to the segment. Should be mandatory for non "live" streams.'},18406:{name:"ContentSigHashAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The hash algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - SHA1-160 2 - MD5"},18405:{name:"ContentSigAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - RSA"},18404:{name:"ContentSigKeyID",level:6,type:"b",minver:1,webm:!1,description:"This is the ID of the private key the data was signed with."},18403:{name:"ContentSignature",level:6,type:"b",minver:1,webm:!1,description:"A cryptographic signature of the contents."},18402:{name:"ContentEncKeyID",level:6,type:"b",minver:1,webm:!1,description:"For public key algorithms this is the ID of the public key the the data was encrypted with."},18401:{name:"ContentEncAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The encryption algorithm used. The value '0' means that the contents have not been encrypted but only signed. Predefined values: 1 - DES, 2 - 3DES, 3 - Twofish, 4 - Blowfish, 5 - AES"},28032:{name:"ContentEncodings",level:3,type:"m",minver:1,webm:!1,description:"Settings for several content encoding mechanisms like compression or encryption."},196:{name:"TrickMasterTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},199:{name:"TrickMasterTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},198:{name:"TrickTrackFlag",level:3,type:"u",divx:!0,default:0,description:"DivX trick track extenstions"},193:{name:"TrickTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},192:{name:"TrickTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},237:{name:"TrackJoinUID",level:5,type:"u",mandatory:!0,multiple:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of a track whose blocks are used to create this virtual track."},233:{name:"TrackJoinBlocks",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all tracks whose Blocks need to be combined to create this virtual track"},230:{name:"TrackPlaneType",level:6,type:"u",mandatory:!0,minver:3,webm:!1,description:"The kind of plane this track corresponds to (0: left eye, 1: right eye, 2: background)."},229:{name:"TrackPlaneUID",level:6,type:"u",mandatory:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of the track representing the plane."},228:{name:"TrackPlane",level:5,type:"m",mandatory:!0,multiple:!0,minver:3,webm:!1,description:"Contains a video plane track that need to be combined to create this 3D track"},227:{name:"TrackCombinePlanes",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all video plane tracks that need to be combined to create this 3D track"},226:{name:"TrackOperation",level:3,type:"m",minver:3,webm:!1,description:"Operation that needs to be applied on tracks to create this virtual track. For more details look at the Specification Notes on the subject."},32123:{name:"ChannelPositions",cppname:"AudioPosition",level:4,type:"b",webm:!1,description:"Table of horizontal angles for each successive channel, see appendix."},159:{name:"Channels",cppname:"AudioChannels",level:4,type:"u",mandatory:!0,minver:1,default:1,range:"not 0",description:"Numbers of channels in the track."},30901:{name:"OutputSamplingFrequency",cppname:"AudioOutputSamplingFreq",level:4,type:"f",minver:1,default:"Sampling Frequency",range:"> 0",description:"Real output sampling frequency in Hz (used for SBR techniques)."},181:{name:"SamplingFrequency",cppname:"AudioSamplingFreq",level:4,type:"f",mandatory:!0,minver:1,default:8e3,range:"> 0",description:"Sampling frequency in Hz."},225:{name:"Audio",cppname:"TrackAudio",level:3,type:"m",minver:1,description:"Audio settings."},2327523:{name:"FrameRate",cppname:"VideoFrameRate",level:4,type:"f",range:"> 0",strong:"Informational",description:"Number of frames per second.  only."},3126563:{name:"GammaValue",cppname:"VideoGamma",level:4,type:"f",webm:!1,range:"> 0",description:"Gamma Value."},3061028:{name:"ColourSpace",cppname:"VideoColourSpace",level:4,type:"b",minver:1,webm:!1,bytesize:4,description:"Same value as in AVI (32 bits)."},21683:{name:"AspectRatioType",cppname:"VideoAspectRatio",level:4,type:"u",minver:1,default:0,description:"Specify the possible modifications to the aspect ratio (0: free resizing, 1: keep aspect ratio, 2: fixed)."},21682:{name:"DisplayUnit",cppname:"VideoDisplayUnit",level:4,type:"u",minver:1,default:0,description:"How DisplayWidth & DisplayHeight should be interpreted (0: pixels, 1: centimeters, 2: inches, 3: Display Aspect Ratio)."},21690:{name:"DisplayHeight",cppname:"VideoDisplayHeight",level:4,type:"u",minver:1,default:"PixelHeight",range:"not 0",description:"Height of the video frames to display. The default value is only valid when DisplayUnit is 0."},21680:{name:"DisplayWidth",cppname:"VideoDisplayWidth",level:4,type:"u",minver:1,default:"PixelWidth",range:"not 0",description:"Width of the video frames to display. The default value is only valid when DisplayUnit is 0."},21725:{name:"PixelCropRight",cppname:"VideoPixelCropRight",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the right of the image."},21708:{name:"PixelCropLeft",cppname:"VideoPixelCropLeft",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the left of the image."},21691:{name:"PixelCropTop",cppname:"VideoPixelCropTop",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the top of the image."},21674:{name:"PixelCropBottom",cppname:"VideoPixelCropBottom",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the bottom of the image (for HDTV content)."},186:{name:"PixelHeight",cppname:"VideoPixelHeight",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Height of the encoded video frames in pixels."},176:{name:"PixelWidth",cppname:"VideoPixelWidth",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Width of the encoded video frames in pixels."},21433:{name:"OldStereoMode",level:4,type:"u",maxver:"0",webm:!1,divx:!1,description:"DEPRECATED, DO NOT USE. Bogus StereoMode value used in old versions of libmatroska. (0: mono, 1: right eye, 2: left eye, 3: both eyes)."},21440:{name:"AlphaMode",cppname:"VideoAlphaMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Alpha Video Mode. Presence of this element indicates that the BlockAdditional element could contain Alpha data."},21432:{name:"StereoMode",cppname:"VideoStereoMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Stereo-3D video mode (0: mono, 1: side by side (left eye is first), 2: top-bottom (right eye is first), 3: top-bottom (left eye is first), 4: checkboard (right is first), 5: checkboard (left is first), 6: row interleaved (right is first), 7: row interleaved (left is first), 8: column interleaved (right is first), 9: column interleaved (left is first), 10: anaglyph (cyan/red), 11: side by side (right eye is first), 12: anaglyph (green/magenta), 13 both eyes laced in one Block (left eye is first), 14 both eyes laced in one Block (right eye is first)) . There are some more details on 3D support in the Specification Notes."},154:{name:"FlagInterlaced",cppname:"VideoFlagInterlaced",level:4,type:"u",mandatory:!0,minver:2,webm:!0,default:0,range:"0-1",description:"Set if the video is interlaced. (1 bit)"},224:{name:"Video",cppname:"TrackVideo",level:3,type:"m",minver:1,description:"Video settings."},26277:{name:"TrackTranslateTrackID",level:4,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this track in the chapter codec data. The format depends on the ChapProcessCodecID used."},26303:{name:"TrackTranslateCodec",level:4,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},26364:{name:"TrackTranslateEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this translation applies. When not specified, it means for all editions found in the segment."},22203:{name:"SeekPreRoll",level:3,type:"u",mandatory:!0,multiple:!1,default:0,minver:4,webm:!0,description:"After a discontinuity, SeekPreRoll is the duration in nanoseconds of the data the decoder must decode before the decoded data is valid."},22186:{name:"CodecDelay",level:3,type:"u",multiple:!1,default:0,minver:4,webm:!0,description:"CodecDelay is The codec-built-in delay in nanoseconds. This value must be subtracted from each block timestamp in order to get the actual timestamp. The value should be small so the muxing of tracks with the same actual timestamp are in the same Cluster."},28587:{name:"TrackOverlay",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify that this track is an overlay track for the Track specified (in the u-integer). That means when this track has a gap (see SilentTracks) the overlay track should be used instead. The order of multiple TrackOverlay matters, the first one is the one that should be used. If not found it should be the second, etc."},170:{name:"CodecDecodeAll",level:3,type:"u",mandatory:!0,minver:2,webm:!1,default:1,range:"0-1",description:"The codec can decode potentially damaged data (1 bit)."},2536e3:{name:"CodecDownloadURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to download about the codec used."},3883072:{name:"CodecInfoURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to find information about the codec used."},3839639:{name:"CodecSettings",level:3,type:"8",webm:!1,description:"A string describing the encoding setting used."},25506:{name:"CodecPrivate",level:3,type:"b",minver:1,description:"Private data only known to the codec."},2274716:{name:"Language",cppname:"TrackLanguage",level:3,type:"s",minver:1,default:"eng",description:"Specifies the language of the track in the Matroska languages form."},21358:{name:"Name",cppname:"TrackName",level:3,type:"8",minver:1,description:"A human-readable track name."},21998:{name:"MaxBlockAdditionID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The maximum value of BlockAdditions for this track."},21375:{name:"TrackOffset",level:3,type:"i",webm:!1,default:0,description:"A value to add to the Block's Timestamp. This can be used to adjust the playback offset of a track."},2306383:{name:"TrackTimecodeScale",level:3,type:"f",mandatory:!0,minver:1,maxver:"3",webm:!1,default:1,range:"> 0",description:"DEPRECATED, DO NOT USE. The scale to apply on this track to work at normal speed in relation with other tracks (mostly used to adjust video speed when the audio length differs)."},2313850:{name:"DefaultDecodedFieldDuration",cppname:"TrackDefaultDecodedFieldDuration",level:3,type:"u",minver:4,range:"not 0",description:"The period in nanoseconds (not scaled by TimcodeScale)\nbetween two successive fields at the output of the decoding process (see the notes)"},2352003:{name:"DefaultDuration",cppname:"TrackDefaultDuration",level:3,type:"u",minver:1,range:"not 0",description:"Number of nanoseconds (not scaled via TimecodeScale) per frame ('frame' in the Matroska sense -- one element put into a (Simple)Block)."},28152:{name:"MaxCache",cppname:"TrackMaxCache",level:3,type:"u",minver:1,webm:!1,description:"The maximum cache size required to store referenced frames in and the current frame. 0 means no cache is needed."},28135:{name:"MinCache",cppname:"TrackMinCache",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The minimum number of frames a player should be able to cache during playback. If set to 0, the reference pseudo-cache system is not used."},156:{name:"FlagLacing",cppname:"TrackFlagLacing",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if the track may contain blocks using lacing. (1 bit)"},21930:{name:"FlagForced",cppname:"TrackFlagForced",level:3,type:"u",mandatory:!0,minver:1,default:0,range:"0-1",description:"Set if that track MUST be active during playback. There can be many forced track for a kind (audio, video or subs), the player should select the one which language matches the user preference or the default + forced track. Overlay MAY happen between a forced and non-forced track of the same kind. (1 bit)"},185:{name:"FlagEnabled",cppname:"TrackFlagEnabled",level:3,type:"u",mandatory:!0,minver:2,webm:!0,default:1,range:"0-1",description:"Set if the track is usable. (1 bit)"},29637:{name:"TrackUID",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"A unique ID to identify the Track. This should be kept the same when making a direct stream copy of the Track to another file."},215:{name:"TrackNumber",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track number as used in the Block Header (using more than 127 tracks is not encouraged, though the design allows an unlimited number)."},174:{name:"TrackEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Describes a track with all elements."},374648427:{name:"Tracks",level:1,type:"m",multiple:!0,minver:1,description:"A top-level block of information with many tracks described."},175:{name:"EncryptedBlock",level:2,type:"b",multiple:!0,webm:!1,description:"Similar to EncryptedBlock Structure)"},202:{name:"ReferenceTimeCode",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},201:{name:"ReferenceOffset",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},200:{name:"ReferenceFrame",level:3,type:"m",multiple:!1,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},207:{name:"SliceDuration",level:5,type:"u",default:0,description:"The (scaled) duration to apply to the element."},206:{name:"Delay",cppname:"SliceDelay",level:5,type:"u",default:0,description:"The (scaled) delay to apply to the element."},203:{name:"BlockAdditionID",cppname:"SliceBlockAddID",level:5,type:"u",default:0,description:"The ID of the BlockAdditional element (0 is the main Block)."},205:{name:"FrameNumber",cppname:"SliceFrameNumber",level:5,type:"u",default:0,description:"The number of the frame to generate from this lace with this delay (allow you to generate many frames from the same Block/Frame)."},204:{name:"LaceNumber",cppname:"SliceLaceNumber",level:5,type:"u",minver:1,default:0,divx:!1,description:"The reverse number of the frame in the lace (0 is the last frame, 1 is the next to last, etc). While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},232:{name:"TimeSlice",level:4,type:"m",multiple:!0,minver:1,divx:!1,description:"Contains extra time information about the data contained in the Block. While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},142:{name:"Slices",level:3,type:"m",minver:1,divx:!1,description:"Contains slices description."},30114:{name:"DiscardPadding",level:3,type:"i",minver:4,webm:!0,description:"Duration in nanoseconds of the silent data added to the Block (padding at the end of the Block for positive value, at the beginning of the Block for negative value). The duration of DiscardPadding is not calculated in the duration of the TrackEntry and should be discarded during playback."},164:{name:"CodecState",level:3,type:"b",minver:2,webm:!1,description:"The new codec state to use. Data interpretation is private to the codec. This information should always be referenced by a seek entry."},253:{name:"ReferenceVirtual",level:3,type:"i",webm:!1,description:"Relative position of the data that should be in position of the virtual block."},251:{name:"ReferenceBlock",level:3,type:"i",multiple:!0,minver:1,description:"Timestamp of another frame used as a reference (ie: B or P frame). The timestamp is relative to the block it's attached to."},250:{name:"ReferencePriority",cppname:"FlagReferenced",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"This frame is referenced and has the specified cache priority. In cache only a frame of the same or higher priority can replace this frame. A value of 0 means the frame is not referenced."},155:{name:"BlockDuration",level:3,type:"u",minver:1,default:"TrackDuration",description:'The duration of the Block (based on TimecodeScale). This element is mandatory when DefaultDuration is set for the track (but can be omitted as other default values). When not written and with no DefaultDuration, the value is assumed to be the difference between the timestamp of this Block and the timestamp of the next Block in "display" order (not coding order). This element can be useful at the end of a Track (as there is not other Block available), or when there is a break in a track like for subtitle tracks. When set to 0 that means the frame is not a keyframe.'},165:{name:"BlockAdditional",level:5,type:"b",mandatory:!0,minver:1,webm:!1,description:"Interpreted by the codec as it wishes (using the BlockAddID)."},238:{name:"BlockAddID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"An ID to identify the BlockAdditional level."},166:{name:"BlockMore",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contain the BlockAdditional and some parameters."},30113:{name:"BlockAdditions",level:3,type:"m",minver:1,webm:!1,description:"Contain additional blocks to complete the main one. An EBML parser that has no knowledge of the Block structure could still see and use/skip these data."},162:{name:"BlockVirtual",level:3,type:"b",webm:!1,description:"A Block with no data. It must be stored in the stream at the place the real Block should be in display order. (see Block Virtual)"},161:{name:"Block",level:3,type:"b",mandatory:!0,minver:1,description:"Block containing the actual data to be rendered and a timestamp relative to the Cluster Timecode. (see Block Structure)"},160:{name:"BlockGroup",level:2,type:"m",multiple:!0,minver:1,description:"Basic container of information containing a single Block or BlockVirtual, and information specific to that Block/VirtualBlock."},163:{name:"SimpleBlock",level:2,type:"b",multiple:!0,minver:2,webm:!0,divx:!0,description:"Similar to SimpleBlock Structure"},171:{name:"PrevSize",cppname:"ClusterPrevSize",level:2,type:"u",minver:1,description:"Size of the previous Cluster, in octets. Can be useful for backward playing.",position:"prevCluster"},167:{name:"Position",cppname:"ClusterPosition",level:2,type:"u",minver:1,webm:!1,description:"The Position of the Cluster in the segment (0 in live broadcast streams). It might help to resynchronise offset on damaged streams.",position:"segment"},22743:{name:"SilentTrackNumber",cppname:"ClusterSilentTrackNumber",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"One of the track number that are not used from now on in the stream. It could change later if not specified as silent in a further Cluster."},231:{name:"Timecode",cppname:"ClusterTimecode",level:2,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp of the cluster (based on TimecodeScale)."},524531317:{name:"Cluster",level:1,type:"m",multiple:!0,minver:1,description:"The lower level element containing the (monolithic) Block structure."},19840:{name:"MuxingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Muxing application or library ("libmatroska-0.4.3").'},31657:{name:"Title",level:2,type:"8",minver:1,webm:!1,description:"General name of the segment."},2807730:{name:"TimecodeScaleDenominator",level:2,type:"u",mandatory:!0,minver:4,default:"1000000000",description:"Timestamp scale numerator, see TimecodeScale."},2807729:{name:"TimecodeScale",level:2,type:"u",mandatory:!0,minver:1,default:"1000000",description:"Timestamp scale in nanoseconds (1.000.000 means all timestamps in the segment are expressed in milliseconds)."},27045:{name:"ChapterTranslateID",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this segment in the chapter codec data. The format depends on the ChapProcessCodecID used."},27071:{name:"ChapterTranslateCodec",level:3,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},27132:{name:"ChapterTranslateEditionUID",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this correspondance applies. When not specified, it means for all editions found in the segment."},4096955:{name:"NextFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the next segment."},4110627:{name:"NextUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the next chained segment (128 bits)."},3965867:{name:"PrevFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the previous segment."},3979555:{name:"PrevUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the previous chained segment (128 bits)."},29604:{name:"SegmentUID",level:2,type:"b",minver:1,webm:!1,range:"not 0",bytesize:16,description:"A randomly generated unique ID to identify the current segment between many others (128 bits)."},357149030:{name:"Info",level:1,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains miscellaneous general information and statistics on the file."},21420:{name:"SeekPosition",level:3,type:"u",mandatory:!0,minver:1,description:"The position of the element in the segment in octets (0 = first level 1 element).",position:"segment"},21419:{name:"SeekID",level:3,type:"b",mandatory:!0,minver:1,description:"The binary ID corresponding to the element name.",type2:"ebmlID"},19899:{name:"Seek",cppname:"SeekPoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains a single seek entry to an EBML element."},290298740:{name:"SeekHead",cppname:"SeekHeader",level:1,type:"m",multiple:!0,minver:1,description:"Contains the position of other level 1 elements."},32379:{name:"SignatureElementList",level:2,type:"m",multiple:!0,webm:!1,i:"Cluster|Block|BlockAdditional",description:"A list consists of a number of consecutive elements that represent one case where data is used in signature. Ex:  means that the BlockAdditional of all Blocks in all Clusters is used for encryption."},32347:{name:"SignatureElements",level:1,type:"m",webm:!1,description:"Contains elements that will be used to compute the signature."},32437:{name:"Signature",level:1,type:"b",webm:!1,description:"The signature of the data (until a new."},32421:{name:"SignaturePublicKey",level:1,type:"b",webm:!1,description:"The public key to use with the algorithm (in the case of a PKI-based signature)."},32410:{name:"SignatureHash",level:1,type:"u",webm:!1,description:"Hash algorithm used (1=SHA1-160, 2=MD5)."},32394:{name:"SignatureAlgo",level:1,type:"u",webm:!1,description:"Signature algorithm used (1=RSA, 2=elliptic)."},458458727:{name:"SignatureSlot",level:-1,type:"m",multiple:!0,webm:!1,description:"Contain signature of some (coming) elements in the stream."},191:{name:"CRC-32",level:-1,type:"b",minver:1,webm:!1,description:"The CRC is computed on all the data of the Master element it's in. The CRC element should be the first in it's parent master for easier reading. All level 1 elements should include a CRC-32. The CRC in use is the IEEE CRC32 Little Endian",crc:!0},236:{name:"Void",level:-1,type:"b",minver:1,description:"Used to void damaged data, to avoid unexpected behaviors when using damaged data. The content is discarded. Also used to reserve space in a sub-element for later use."},17139:{name:"EBMLMaxSizeLength",level:1,type:"u",mandatory:!0,default:8,minver:1,description:"The maximum length of the sizes you'll find in this file (8 or less in Matroska). This does not override the element size indicated at the beginning of an element. Elements that have an indicated size which is larger than what is allowed by EBMLMaxSizeLength shall be considered invalid."},17138:{name:"EBMLMaxIDLength",level:1,type:"u",mandatory:!0,default:4,minver:1,description:"The maximum length of the IDs you'll find in this file (4 or less in Matroska)."},17143:{name:"EBMLReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum EBML version a parser has to support to read this file."},440786851:{name:"EBML",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"Set the EBML characteristics of the data to follow. Each EBML document has to start with this."}},i={},a={byEbmlID:r,byName:i};for(var o in r)i[r[o].name.replace("-","_")]=parseInt(o,10);e.exports=a},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),a=n(2),o=n(4),s=n(1),c=n(15),l=n(37),u=n(32),d=n(412),h=n(10),f=n(3),p=function(){function e(){S(this,e),this.logger=c.default,this.authService=a.default,this.xmppService=o.default,this.contactService=s.default,this.settingsService=i.default,this.errorHelperService=l.default,this.eventService=u.default,this.subscription=null,this.xmppHandler=null,this.rxSubject=new h.Subject,this.portalURL=null,this.receivedInvitations={},this.sentInvitations={},this.acceptedInvitationsArray=[],this.sentInvitationsArray=[],this.receivedInvitationsArray=[]}return C(e,[{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info(""),this.logger.info("[invitationService] === STARTING ==="),this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/",this.attachHandlers(),this.getAllSentInvitations(),this.getAllReceivedInvitations(),this.logger.info("[invitationService] === STARTED ==="),this.subscription=this.xmppService.subscribeToContactEvents((function(e){"ON_ROSTER_CHANGED_EVENT"===e.name&&t.getAllSentInvitations()}));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info(""),this.logger.info("[invitationService] === STOPPING ==="),this.subscription&&this.subscription.unsubscribe(),this.logger.info("[invitationService] === STOPPED ===");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next({type:e,value:t}),this.eventService.publish(e,t)}},{key:"attachHandlers",value:function(){var e=this;this.logger.info("[invitationService] attachHandlers"),this.xmppHandler&&(o.default.connection.deleteHandler(this.xmppHandler),this.xmppHandler=null),this.xmppHandler=o.default.connection.addHandler((function(t){return e.onInvitationsUpdate(t)}),null,"message","management")}},{key:"onInvitationsUpdate",value:function(e){var t=$(e).find("userinvite");if(t.length){var n=t.attr("id"),r=t.attr("type"),i=t.attr("action");switch(r){case"received":this.handleReceivedInvitation(n,i);break;case"sent":this.handleSentInvitation(n,i);break;default:this.logger.warn("[invitationService] onInvitationsUpdate - received unexpected type - "+r)}}return!0}},{key:"handleReceivedInvitation",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.logger.info("[invitationService] handleReceivedInvitation"),"delete"!==t){n.next=2;break}return n.abrupt("return",(delete this.receivedInvitations[e],void this.updateReceivedInvitationsArray()));case 2:return n.next=4,this.getServerInvitation(e);case 4:r=n.sent,i=null,a="none",n.t0=r.status,n.next="pending"===n.t0?9:"accepted"===n.t0||"auto-accepted"===n.t0?15:21;break;case 9:if(this.receivedInvitations[r.id]=r,i=r,a="ask",!r.invitingUserId){n.next=14;break}return n.next=12,this.contactService.getContactByDBId(r.invitingUserId,!0);case 12:o=n.sent,this.sendEvent("ON_INVITATION_RECEIVED",o);case 14:return n.abrupt("break",22);case 15:if(this.receivedInvitations[r.id]=r,this.sendEvent("ON_INVITATION_ACCEPTED",r.invitingUserId),!r.invitingUserId){n.next=20;break}return n.next=18,this.contactService.getContactByDBId(r.invitingUserId,!0);case 18:s=n.sent,this.eventService.publish("ON_CONTACT_UPDATED_EVENT",s);case 20:return n.abrupt("break",22);case 21:delete this.receivedInvitations[r.id],a="unknown";case 22:if(n.t1=r.invitingUserId,!n.t1){n.next=26;break}return n.next=26,this.updateContactInvitationStatus(r.invitingUserId,a,i);case 26:this.updateReceivedInvitationsArray(),this.sendEvent("ON_INVITATION_CHANGED",r);case 28:case"end":return n.stop()}}),n,this)})))}},{key:"handleSentInvitation",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.logger.info("[invitationService] handleSentInvitation"),"delete"!==t){n.next=2;break}return n.abrupt("return",(delete this.sentInvitations[e],void this.updateReceivedInvitationsArray()));case 2:return n.next=4,this.getServerInvitation(e);case 4:r=n.sent,i=null,n.t0=r.status,n.next="pending"===n.t0?9:"accepted"===n.t0||"auto-accepted"===n.t0?11:17;break;case 9:return this.sentInvitations[r.id]=r,i="wait",n.abrupt("break",18);case 11:if(this.sendEvent("ON_INVITATION_ACCEPTED",r.invitedUserId),!r.invitedUserId){n.next=16;break}return n.next=14,this.contactService.getContactByDBId(r.invitedUserId,!0);case 14:a=n.sent,this.eventService.publish("ON_CONTACT_UPDATED_EVENT",a);case 16:return n.abrupt("break",18);case 17:delete this.sentInvitations[r.id],i="unknown";case 18:if(n.t1=r.invitedUserId,!n.t1){n.next=22;break}return n.next=22,this.updateContactInvitationStatus(r.invitedUserId,i,r);case 22:this.updateSentInvitationsArray(),"resend"===t&&this.sendEvent("ON_INVITATIONS_RE_SEND",e);case 24:case"end":return n.stop()}}),n,this)})))}},{key:"updateReceivedInvitationsArray",value:function(){for(var e in this.receivedInvitationsArray=[],this.acceptedInvitationsArray=[],this.receivedInvitations)if(this.receivedInvitations.hasOwnProperty(e)){var t=this.receivedInvitations[e];switch(t.status){case"pending":this.receivedInvitationsArray.push(t);break;case"accepted":case"auto-accepted":this.acceptedInvitationsArray.push(t)}}this.receivedInvitationsArray.sort(this.sortInvitationArray),this.acceptedInvitationsArray=this.acceptedInvitationsArray.filter((function(e){var t=f(e.lastNotificationDate);return f.duration(f().diff(t)).asHours()<168})),this.acceptedInvitationsArray.sort(this.sortInvitationArray),this.sendEvent("ON_INVITATIONS_NUMBER_UPDATED")}},{key:"updateSentInvitationsArray",value:function(){for(var e in this.sentInvitationsArray=[],this.sentInvitations)this.sentInvitations.hasOwnProperty(e)&&this.sentInvitationsArray.push(this.sentInvitations[e]);this.sentInvitationsArray.sort(this.sortInvitationArray),this.sendEvent("ON_INVITATIONS_NUMBER_UPDATED")}},{key:"getServerInvitation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations/").concat(e),r=this.authService.getRequestHeader(),t.next=5,fetch(n,{method:"GET",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:return t.next=10,i.json();case 10:return a=t.sent.data,t.abrupt("return",(this.logger.info("[invitationService] getServerInvitation success"),d.Invitation.createFromData(a)));case 14:return t.prev=14,t.t0=t.catch(0),t.next=18,this.errorHelperService.getErrorInfo(t.t0,"getServerInvitation");case 18:throw o=t.sent,this.logger.error("[invitationService] "+o.message),o.error;case 20:case"end":return t.stop()}}),t,this,[[0,14]])})))}},{key:"getReceivedInvitations",value:function(){return this.receivedInvitationsArray}},{key:"getAcceptedInvitations",value:function(){return this.acceptedInvitationsArray}},{key:"getSentInvitations",value:function(){return this.sentInvitationsArray}},{key:"getInvitationsNumberForCounter",value:function(){return this.receivedInvitationsArray.length}},{key:"getAllInvitationsNumber",value:function(){return this.receivedInvitationsArray.length+this.sentInvitationsArray.length+this.acceptedInvitationsArray.length}},{key:"getInvitation",value:function(e){var t=this.receivedInvitations[e];return t||(t=this.acceptedInvitationsArray[e]),t||(t=this.sentInvitations[e]),t}},{key:"joinContactInvitation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,this.logger.info("[invitationService] joinContactInvitation contact (".concat(e.jid,")")),r="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations"),i=this.authService.getPostHeader(),a={invitedUserId:e.dbId,customMessage:t},n.next=7,fetch(r,{method:"POST",headers:i,body:JSON.stringify(a)});case 7:if((o=n.sent).ok){n.next=10;break}throw o;case 10:this.logger.info("[invitationService] joinContactInvitation - success (".concat(e.jid,")")),"unknown"===e.status&&this.updateContactInvitationStatus(e.dbId,"wait"),n.next=19;break;case 13:return n.prev=13,n.t0=n.catch(0),n.next=17,this.errorHelperService.getErrorInfo(n.t0,"joinContactInvitation");case 17:throw s=n.sent,this.logger.error("[invitationService] "+s.message),s.error;case 19:case"end":return n.stop()}}),n,this,[[0,13]])})))}},{key:"sendInvitationByEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,this.logger.info("[invitationService] sendInvitationByEmail"),r=this.settingsService.getAppliLanguageCodeForServer(),i="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations"),a=this.authService.getPostHeader(),o={email:e,lang:r,customMessage:t},n.next=8,fetch(i,{method:"POST",headers:a,body:JSON.stringify(o)});case 8:if((s=n.sent).ok){n.next=11;break}throw s;case 11:this.logger.info("[invitationService] sendInvitationByEmail - success"),n.next=20;break;case 14:return n.prev=14,n.t0=n.catch(0),n.next=18,this.errorHelperService.getErrorInfo(n.t0,"sendInvitationByEmail");case 18:throw c=n.sent,this.logger.error("[invitationService] "+c.message),c.error;case 20:case"end":return n.stop()}}),n,this,[[0,14]])})))}},{key:"cancelOneSendInvitation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL).concat(e.invitingUserId,"/invitations/").concat(e.id,"/cancel"),r=this.authService.getPostHeader(),t.next=5,fetch(n,{method:"POST",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:this.logger.info("[invitationService] cancelOneSendInvitation success"),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(0),t.next=15,this.errorHelperService.getErrorInfo(t.t0,"cancelOneSendInvitation");case 15:throw a=t.sent,this.logger.error("[invitationService] "+a.message),a.error;case 17:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"reSendInvitation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/invitations/").concat(e,"/re-send"),r=this.authService.getPostHeader(),t.next=5,fetch(n,{method:"POST",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:this.logger.info("[invitationService] reSendInvitation ".concat(e," success")),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(0),t.next=15,this.errorHelperService.getErrorInfo(t.t0,"reSendInvitation");case 15:throw a=t.sent,this.logger.error("[invitationService] "+a.message),a.error;case 17:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"sendInvitationsParBulk",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.length&&!(e.length>100)){t.next=2;break}throw this.logger.error("[invitationService] sendInvitationsParBulk mail list length not correct"),new Error("sendInvitationsParBulk mail list length not correct");case 2:return t.prev=2,n="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/invitations/bulk"),r=this.authService.getPostHeader(),t.next=7,fetch(n,{method:"POST",headers:r,body:JSON.stringify({emails:e})});case 7:if((i=t.sent).ok){t.next=10;break}throw i;case 10:this.logger.info("[invitationService] sendInvitationsParBulk - success"),t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(2),t.next=17,this.errorHelperService.getErrorInfo(t.t0,"sendInvitationsParBulk");case 17:throw a=t.sent,this.logger.error("[invitationService] "+a.message),a.error;case 19:case"end":return t.stop()}}),t,this,[[2,13]])})))}},{key:"acceptInvitation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL).concat(e.invitedUserId,"/invitations/").concat(e.id,"/accept"),r=this.authService.getPostHeader(),t.next=5,fetch(n,{method:"POST",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:this.logger.info("[invitationService] acceptInvitation success"),t.next=22;break;case 11:return t.prev=11,t.t0=t.catch(0),t.next=15,this.errorHelperService.getErrorInfo(t.t0,"acceptInvitation");case 15:if((a=t.sent).error.errorDetailsCode&&409605===a.error.errorDetailsCode){t.next=18;break}throw this.logger.error("[invitationService] "+a.message),a.error;case 18:return t.next=20,this.contactService.getContactByDBId(e.invitingUserId,!0);case 20:o=t.sent,this.eventService.publish("ON_CONTACT_UPDATED_EVENT",o);case 22:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"declineInvitation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL).concat(e.invitedUserId,"/invitations/").concat(e.id,"/decline"),r=this.authService.getPostHeader(),t.next=5,fetch(n,{method:"POST",headers:r});case 5:if((i=t.sent).ok){t.next=8;break}throw i;case 8:this.logger.info("[invitationService] declineInvitation success"),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(0),t.next=15,this.errorHelperService.getErrorInfo(t.t0,"declineInvitation");case 15:throw a=t.sent,this.logger.error("[invitationService] "+a.message),a.error;case 17:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"updateContactInvitationStatus",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return r(this,void 0,void 0,b.a.mark((function r(){var i;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.contactService.getContactByDBId(e);case 2:i=r.sent,r.t0=t,r.next="ask"===r.t0?6:"wait"===r.t0?8:10;break;case 6:return i.status="unknown",i.ask="ask",i.invitation=n,r.abrupt("break",11);case 8:return i.status="wait",i.ask="subscribe",i.invitation=n,r.abrupt("break",11);case 10:i.ask="none",i.invitation=null;case 11:this.contactService.updateContactRichStatus(i),i.rxSubject.next({name:"update",data:i});case 12:case"end":return r.stop()}}),r,this)})))}},{key:"sortInvitationArray",value:function(e,t){return new Date(t.lastNotificationDate).getTime()-new Date(e.lastNotificationDate).getTime()}},{key:"getAllReceivedInvitations",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,o=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations/received?format=full&status=pending&limit=500"),n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:return e.next=10,r.json();case 10:return i=e.sent.data,e.abrupt("return",(this.logger.info("[invitationService] getAllReceivedInvitations success (find ".concat(i.length," invitations)")),this.receivedInvitations={},i.forEach((function(e){if("pending"===e.status&&"registration"!==e.type){var t=d.Invitation.createFromData(e);o.receivedInvitations[e.id]=t,e.invitingUserId&&o.updateContactInvitationStatus(e.invitingUserId,"ask",t)}else"accepted"!==e.status&&"auto-accepted"!==e.status||(o.receivedInvitations[e.id]=d.Invitation.createFromData(e))})),this.updateReceivedInvitationsArray(),this.receivedInvitations));case 14:return e.prev=14,e.t0=e.catch(0),e.next=18,this.errorHelperService.getErrorInfo(e.t0,"getAllReceivedInvitations");case 18:throw a=e.sent,this.logger.error("[invitationService] "+a.message),a.error;case 20:case"end":return e.stop()}}),e,this,[[0,14]])})))}},{key:"getAllSentInvitations",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,o=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations/sent?format=full&status=pending&limit=500"),n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw r;case 8:return e.next=10,r.json();case 10:return i=e.sent.data,e.abrupt("return",(this.logger.info("[invitationService] getAllSentInvitations success (find "+i.length+" invitations)"),this.sentInvitations={},i.forEach((function(e){if("pending"===e.status&&!e.inviteToJoinMeeting){var t=d.Invitation.createFromData(e);o.sentInvitations[e.id]=t,void 0!==t.invitedUserId&&o.updateContactInvitationStatus(t.invitedUserId,"wait",t)}})),this.updateSentInvitationsArray(),this.sentInvitations));case 14:return e.prev=14,e.t0=e.catch(0),e.next=18,this.errorHelperService.getErrorInfo(e.t0,"getAllSentInvitations");case 18:throw a=e.sent,this.logger.error("[invitationService] "+a.message),a.error;case 20:case"end":return e.stop()}}),e,this,[[0,14]])})))}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.invitationService||(t.rainbow.invitationService=new e),t.rainbow.invitationService}}]),e}();t.InvitationService=p,t.default=p.getInstance()},function(e,t,n){var r=n(52);function i(e,t,n,i,a){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":a||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var a=r(e.parameters.apt,n),o=r(t.parameters.apt,i);return a&&o&&a.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(r){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&o.parameters.apt&&!i(r,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(r.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,n,r,i){var a=new Event("track");a.track=n,a.receiver=r,a.transceiver={receiver:r},a.streams=i,e.setTimeout((function(){t._dispatchEvent("track",a)}))}var u=function(n){var i=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=a[e].bind(a)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},u.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},u.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},u.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},u.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},u.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},u.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},u.prototype._gather=function(t,n){var i=this,a=this.transceivers[n].iceGatherer;if(!a.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),a.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==a.state&&"gathering"!==a.state||(a.state="completed");else{"new"===a.state&&(a.state="gathering"),s.component=1,s.ufrag=a.getLocalParameters().usernameFragment;var l=r.writeCandidate(s);o.candidate=Object.assign(o.candidate,r.parseCandidate(l)),o.candidate.candidate=l,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=r.getMediaSections(i._localDescription.sdp);u[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+u.join("");var d=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",o),d&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){a.onlocalcandidate(e)}))}),0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,n,i){var o=a(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},u.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var o=i.transceivers[t],c=o.iceGatherer,l=o.iceTransport,u=o.dtlsTransport,d=o.localCapabilities,h=o.remoteCapabilities;if((!r.isRejected(e)||0!==r.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var f=r.getIceParameters(e,n),p=r.getDtlsParameters(e,n);s&&(p.role="server"),i.usingBundle&&0!==t||(i._gather(o.mid,t),"new"===l.state&&l.start(c,f,s?"controlling":"controlled"),"new"===u.state&&u.start(p));var m=a(d,h);i._transceive(o,m.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(i){var u=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!o("setRemoteDescription",i.type,u.signalingState)||u._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+u.signalingState));var d={};u.remoteStreams.forEach((function(e){d[e.id]=e}));var h=[],f=r.splitSections(i.sdp),p=f.shift(),m=r.matchPrefix(p,"a=ice-lite").length>0,v=r.matchPrefix(p,"a=group:BUNDLE ").length>0;u.usingBundle=v;var g=r.matchPrefix(p,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,f.forEach((function(o,c){var l=r.splitLines(o),f=r.getKind(o),g=r.isRejected(o)&&0===r.matchPrefix(o,"a=bundle-only").length,y=l[0].substr(2).split(" ")[2],b=r.getDirection(o,p),S=r.parseMsid(o),_=r.getMid(o)||r.generateIdentifier();if(g||"application"===f&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))u.transceivers[c]={mid:_,kind:f,protocol:y,rejected:!0};else{var C,w,E,T,k,M,D,x,R;!g&&u.transceivers[c]&&u.transceivers[c].rejected&&(u.transceivers[c]=u._createTransceiver(f,!0));var O,I,P=r.parseRtpParameters(o);g||(O=r.getIceParameters(o,p),(I=r.getDtlsParameters(o,p)).role="client"),D=r.parseRtpEncodingParameters(o);var A=r.parseRtcpParameters(o),L=r.matchPrefix(o,"a=end-of-candidates",p).length>0,N=r.matchPrefix(o,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!g&&v&&c>0&&u.transceivers[c]&&(u._disposeIceAndDtlsTransports(c),u.transceivers[c].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[c].iceTransport=u.transceivers[0].iceTransport,u.transceivers[c].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[c].rtpSender&&u.transceivers[c].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[c].rtpReceiver&&u.transceivers[c].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==i.type||g)"answer"!==i.type||g||(w=(C=u.transceivers[c]).iceGatherer,E=C.iceTransport,T=C.dtlsTransport,k=C.rtpReceiver,M=C.sendEncodingParameters,x=C.localCapabilities,u.transceivers[c].recvEncodingParameters=D,u.transceivers[c].remoteCapabilities=P,u.transceivers[c].rtcpParameters=A,N.length&&"new"===E.state&&(!m&&!L||v&&0!==c?N.forEach((function(e){s(C.iceTransport,e)})):E.setRemoteCandidates(N)),v&&0!==c||("new"===E.state&&E.start(w,O,"controlling"),"new"===T.state&&T.start(I)),!a(C.localCapabilities,C.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,u._transceive(C,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!k||"sendrecv"!==b&&"sendonly"!==b?delete C.rtpReceiver:(R=k.track,S?(d[S.stream]||(d[S.stream]=new e.MediaStream),n(R,d[S.stream]),h.push([R,k,d[S.stream]])):(d.default||(d.default=new e.MediaStream),n(R,d.default),h.push([R,k,d.default]))));else{(C=u.transceivers[c]||u._createTransceiver(f)).mid=_,C.iceGatherer||(C.iceGatherer=u._createIceGatherer(c,v)),N.length&&"new"===C.iceTransport.state&&(!L||v&&0!==c?N.forEach((function(e){s(C.iceTransport,e)})):C.iceTransport.setRemoteCandidates(N)),x=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(x.codecs=x.codecs.filter((function(e){return"rtx"!==e.name}))),M=C.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var j,U=!1;"sendrecv"===b||"sendonly"===b?(U=!C.rtpReceiver,k=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,f),U&&(R=k.track,S&&"-"===S.stream||(S?(d[S.stream]||(d[S.stream]=new e.MediaStream,Object.defineProperty(d[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(R,"id",{get:function(){return S.track}}),j=d[S.stream]):(d.default||(d.default=new e.MediaStream),j=d.default)),j&&(n(R,j),C.associatedRemoteMediaStreams.push(j)),h.push([R,k,j]))):C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===C.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),C.associatedRemoteMediaStreams=[]),C.localCapabilities=x,C.remoteCapabilities=P,C.rtpReceiver=k,C.rtcpParameters=A,C.sendEncodingParameters=M,C.recvEncodingParameters=D,u._transceive(u.transceivers[c],!1,U)}}})),void 0===u._dtlsRole&&(u._dtlsRole="offer"===i.type?"active":"passive"),u._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(d).forEach((function(t){var n=d[t];if(n.getTracks().length){if(-1===u.remoteStreams.indexOf(n)){u.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){u._dispatchEvent("addstream",r)}))}h.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&l(u,t,r,[n])}))}})),h.forEach((function(e){e[2]||l(u,e[0],e[1],[])})),e.setTimeout((function(){u&&u.transceivers&&u.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},u.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var a=n.transceivers.filter((function(e){return"audio"===e.kind})).length,o=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(a=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(o=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));a>0||o>0;)a>0&&(n._createTransceiver("audio"),a--),o>0&&(n._createTransceiver("video"),o--);var l=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,a){var o=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(a,n.usingBundle));var l=e.RTCRtpSender.getCapabilities(s);t<15019&&(l.codecs=l.codecs.filter((function(e){return"rtx"!==e.name}))),l.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),l.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=i.sendEncodingParameters||[{ssrc:1001*(2*a+1)}];o&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=l,i.sendEncodingParameters=u})),"max-compat"!==n._config.bundlePolicy&&(l+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){l+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,l+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))}));var u=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(u)},u.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var o=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(o+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var l=a(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=i(e,l,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var l=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(l)},u.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,a){if(!n._remoteDescription)return a(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<n.transceivers.length;l++)if(n.transceivers[l].mid===e.sdpMid){o=l;break}var u=n.transceivers[o];if(!u)return a(c("OperationError","Can not add ICE candidate"));if(u.rejected)return i();var d=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return i();if(d.component&&1!==d.component)return i();if((0===o||o>0&&u.iceTransport!==n.transceivers[0].iceTransport)&&!s(u.iceTransport,d))return a(c("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(d.type?h:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].rejected||(n.transceivers[f].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);i()}))},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var d=["createOffer","createAnswer"];return d.forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),u}},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=n(26),s=n(5),c=n(2),l=n(32),u=n(4),d=n(1),h=n(25),f=n(233),p=n(6),m=n(33),v=n(39),g=n(28),y=new WeakMap,_=new WeakMap,w=new WeakMap,E=new WeakMap,T=new WeakMap,k=new WeakMap,M=new WeakMap,D=new WeakMap,x=new WeakMap,R=new WeakMap,O=new WeakMap,I=new WeakMap,P=new WeakMap,A=new WeakMap,L=new WeakMap,N=new WeakMap,j=new WeakMap,U=new WeakMap;t.ConnectionService=function(){function e(t,n,r,f,m,v,g,b,C,F,H,W,Y,B,V,$,G,z,q){var J=this;S(this,e),this.logService="ConnectionService | ",this.state="disconnected",this.hostUsed="",this.RAINBOW_ONCONNECTIONSTATECHANGED="rainbowconnectionstatechanged",this.RAINBOW_ONSTARTED="started",this.RAINBOW_ONSIGNED="signed",this.RAINBOW_ONSTOPPED="stopped",this.RAINBOW_CONNECTIONINPROGRESS="inProgress",this.RAINBOW_ONUSERTOKENRENEW="userTokenRenew",this.RAINBOW_ONUSERTOKENRENEWFAILED="userTokenRenewFailed",this.RAINBOW_ONAPPTOKENRENEW="applicationTokenRenew",this.RAINBOW_ONAPPTOKENRENEWFAILED="applicationTokenRenewFailed",this.RAINBOW_CONNECTIONCONNECTED="connected",this.RAINBOW_CONNECTIONDISCONNECTED="disconnected",this.RAINBOW_OFFICIAL_HOST="openrainbow.com",this.RAINBOW_BETA_HOST="openrainbow.net",this.RAINBOW_DEV_HOST="openrainbow.org",this.RAINBOW_SANDBOX_HOST="sandbox.openrainbow.com",this.RAINBOW_CPAASPREPROD_HOST="cpaaspreprod.openrainbow.net",this.RAINBOW_CHINA_HOST="myopenrainbow.com.cn",this.RAINBOW_CHINASANDBOX_HOST="sandbox.myopenrainbow.com.cn",l.default.configure(t),o.default.configure(),s.default.configure("en"),s.default.setSetting("apiMode","sdk"),y.set(this,n),_.set(this,r),w.set(this,f),E.set(this,m),T.set(this,v),k.set(this,g),M.set(this,b),D.set(this,C),x.set(this,F),R.set(this,H),O.set(this,W),I.set(this,Y),P.set(this,B),A.set(this,V),L.set(this,$),N.set(this,G),j.set(this,z),U.set(this,q),u.default.subscribeToConnectionEvents((function(e){var t="connected";"ON_XMPP_CONNECTING"===e.name&&(t="inProgress"),"ON_XMPP_DISCONNECTED"===e.name&&(t="LOGOUT"===e.data.reason?"unlogged":"disconnected"),"ON_XMPP_CONNECTED"===e.name&&(t="connected","RECONNECTION"===e.data.reason&&(a.eventsService.dispatchEvent(J.RAINBOW_ONCONNECTIONSTATECHANGED,"reconnecting"),J.reconnectServices())),J.state=t,i.rainbowLogger.sdk(J.logService+"[onChange] :: Connection state changed to "+t),a.eventsService.dispatchEvent(J.RAINBOW_ONCONNECTIONSTATECHANGED,t)})),c.default.subscribe((function(e){switch(e.name){case"ON_AUTH_TOKEN_RENEW":a.eventsService.dispatchEvent(J.RAINBOW_ONUSERTOKENRENEW);break;case"ON_AUTH_TOKEN_EXPIRE":a.eventsService.dispatchEvent(J.RAINBOW_ONUSERTOKENRENEWFAILED);break;case"ON_APP_TOKEN_RENEW":a.eventsService.dispatchEvent(J.RAINBOW_ONAPPTOKENRENEW);break;case"ON_APP_TOKEN_EXPIRE":a.eventsService.dispatchEvent(J.RAINBOW_ONAPPTOKENRENEWFAILED)}})),window.addEventListener("beforeunload",(function(){m.stop(),d.default.stop(),H.stop(),f.stop(),b.stop(),r.stop(),h.default.stop(),u.default.stop(),p.default.stop(),z.stop(),$.stop(),G.stop()}))}return C(e,[{key:"signin",value:function(e,t){return this.hostUsed=this.RAINBOW_SANDBOX_HOST,this.signinToRainbow(e,t,null)}},{key:"signinOnRainbowOfficial",value:function(e,t){return this.hostUsed=this.RAINBOW_OFFICIAL_HOST,window.config.webservices.currentServer=this.RAINBOW_OFFICIAL_HOST,this.signinToRainbow(e,t,null)}},{key:"signinOnRainbowBeta",value:function(e,t){return this.hostUsed=this.RAINBOW_BETA_HOST,this.signinToRainbow(e,t,null)}},{key:"signinOnRainbowCPaasPreProd",value:function(e,t){return this.hostUsed=this.RAINBOW_CPAASPREPROD_HOST,this.signinToRainbow(e,t,null)}},{key:"signinOnRainbowDev",value:function(e,t){return this.hostUsed=this.RAINBOW_DEV_HOST,this.signinToRainbow(e,t,null)}},{key:"signinOnRainbowSandboxChina",value:function(e,t){return this.hostUsed=this.RAINBOW_CHINASANDBOX_HOST,this.signinToRainbow(e,t,null)}},{key:"signinOnRainbowChina",value:function(e,t){return this.hostUsed=this.RAINBOW_CHINA_HOST,this.signinToRainbow(e,t,null)}},{key:"signinOnRainbowHosted",value:function(e,t,n){return this.hostUsed=n,this.signinToRainbow(e,t,null)}},{key:"signinSandBoxWithToken",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.hostUsed=this.RAINBOW_SANDBOX_HOST,t.prev=1,t.next=4,this.signinToRainbow(null,null,e);case 4:return t.abrupt("return",t.sent);case 7:throw t.prev=7,t.t0=t.catch(1),t.t0;case 10:case"end":return t.stop()}}),t,this,[[1,7]])})))}},{key:"signinOnRainbowOfficialWithToken",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.hostUsed=this.RAINBOW_OFFICIAL_HOST,window.config.webservices.currentServer=this.RAINBOW_OFFICIAL_HOST,t.next=4,this.signinToRainbow(null,null,e);case 4:return t.abrupt("return",t.sent);case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"signinOnRainbowBetaWithToken",value:function(e){return this.hostUsed=this.RAINBOW_BETA_HOST,this.signinToRainbow(null,null,e)}},{key:"signinOnRainbowDevWithToken",value:function(e){return this.hostUsed=this.RAINBOW_DEV_HOST,this.signinToRainbow(null,null,e)}},{key:"signinOnRainbowHostedWithToken",value:function(e,t){return this.hostUsed=t,this.signinToRainbow(null,null,e)}},{key:"signinOnRainbowWithOICD",value:function(e){for(var t=this,n="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=r.length,o=0;o<30;o++)n+=r.charAt(Math.floor(Math.random()*a));var s="https://openrainbow.com/api/rainbow/authentication/v1.0/oidc-client/jwt?id_token=".concat(e,"&challenge=").concat(n);return new Promise((function(r,a){if(!e)return i.rainbowLogger.sdk(t.logService+"[signinOnRainbowWithOICD] :: Argument strToken is null or undefined"),a("Argument strToken is null or undefined");var o=window.btoa(unescape(encodeURIComponent(window.sdk.key.appID+":"+window.SHA256(window.sdk.key.appSecret+n))));o="Basic "+o;var c=new Headers({"Content-Type":"application/x-www-form-urlencoded","X-Rainbow-App-Auth":o,Accept:"application/json"});fetch(s,{method:"get",mode:"cors",headers:c}).then((function(e){e.json().then((function(e){t.signinOnRainbowBetaWithToken(e.token).then((function(e){return r(e)})).catch((function(e){return a(e)}))}))})).catch((function(e){return a(e)}))}))}},{key:"styleSignInWithRainbowButton",value:function(e,t){var n,r,a,o,s,c,l=document.querySelector(".SignInWithRainbow");return l?(t||(t="medium"),e||(e="blue"),"blue"===e?(s="#1b85e0",c="#FFFFFF"):"white"===e&&(s="#FFFFFF",c="#1b85e0"),"small"===t?(n="200px",r="20px",a="18px",o="12px"):"medium"===t?(n="250px",r="30px",a="26px",o="16px"):"large"===t&&(n="350px",r="40px",a="34px",o="22px"),l.style.backgroundColor=s,l.style.color=c,l.style.width=n,l.style.height=r,l.style.fontSize=o,l.style.border="0px",l.style.borderRadius="5px",l.innerHTML="Sign in with Rainbow",l.style.backgroundImage="url('https://hub.openrainbow.com/android-chrome-48x48.png')",l.style.backgroundPosition="left",l.style.backgroundRepeat="no-repeat",l.style.verticalAlign="middle",l.style.backgroundSize=a,l.style.backgroundOrigin="content-box",l.style.paddingLeft="13px",i.rainbowLogger.sdk(this.logService+"[styleSignInWithRainbowButton] :: Styled a corresponding HTML element"),!0):(i.rainbowLogger.sdk(this.logService+"[styleSignInWithRainbowButton] :: Could not find a corresponding HTML element"),!1)}},{key:"signout",value:function(){var e=this,t=E.get(this),n=T.get(this),r=k.get(this),o=y.get(this),s=R.get(this),c=D.get(this),l=x.get(this),v=L.get(this),b=M.get(this),S=_.get(this),C=w.get(this),O=I.get(this),F=P.get(this),H=A.get(this),W=N.get(this),Y=j.get(this),B=U.get(this),V={code:g.SDK.OK,label:"OK"};return i.rainbowLogger.sdk(this.logService+"[signout] :: Trying to sign out"),new Promise((function(g,y){t.stop().then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Video service stopped"),n.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Favorite service stopped"),B.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: VoiceMessage service stopped"),r.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: WebRTCEventHandler service stopped"),d.default.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Contact service stopped"),o.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Bot service stopped"),p.default.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Profile service stopped"),s.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Conversation service stopped"),c.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Conference service stopped"),l.stop()})).then((function(){i.rainbowLogger.sdk(e.logService+"[signout] :: PTSN Conference service stopped")})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: ChannelService service stopped"),v.stop()})).then((function(){return b.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Telephony service stopped"),S.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: FileServer service stopped"),h.default.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: FileStorage service stopped"),f.default.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Invitation service stopped"),C.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Group service stopped"),m.default.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Room service stopped"),O.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Company Directory service stopped"),F.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Admin User service stopped"),H.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Invitation service stopped"),W.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: webrtcGateway service stopped"),u.default.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: Records service stopped"),Y.stop()})).then((function(){return i.rainbowLogger.sdk(e.logService+"[signout] :: XMPP service stopped"),i.rainbowLogger.sdk(e.logService+"[signout] :: Services Successfully unloaded!"),a.eventsService.dispatchEvent(e.RAINBOW_ONSTOPPED,null),g(V)})).catch((function(t){return i.rainbowLogger.sdk(e.logService+"[signout] :: An error occurred during signout"),y(t)}))}))}},{key:"updateUserPassword",value:function(e,t){return d.default.updateUserPassword(e,t,!1)}},{key:"getState",value:function(){return this.state}},{key:"getToken",value:function(){return c.default.token}},{key:"refreshToken",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.default.renewAuthToken(!1);case 3:return e.abrupt("return",void e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))}},{key:"signinToRainbow",value:function(e,t,n){var r=this,o=E.get(this),s=k.get(this),l=y.get(this),b=R.get(this),S=D.get(this),C=x.get(this),F=L.get(this),H=M.get(this),W=_.get(this),Y=w.get(this),B=I.get(this),V=P.get(this),$=A.get(this),G=N.get(this),z=j.get(this),q=O.get(this),J=T.get(this),K=U.get(this);i.rainbowLogger.time("Auth");var Q=!1;return new Promise((function(y,_){if(n)Q=!0,e=null,t=null;else{if(!e)return _({code:g.SDK.ERRORBADREQUEST,label:"Parameter 'login' is missing or empty"});if(!t)return _({code:g.SDK.ERRORBADREQUEST,label:"Parameter 'password' is missing or empty"})}i.rainbowLogger.sdk(r.logService+"[signin] :: Rainbow host used "+r.hostUsed),Q?i.rainbowLogger.sdk(r.logService+"[signin] :: Trying to sign-in with given token"):i.rainbowLogger.sdk(r.logService+"[signin] :: Trying to sign-in");var w={code:g.SDK.OK,label:"",account:null},E={appID:window.sdk.key.appID,appSecret:window.sdk.key.appSecret};c.default.removeCredentials(),i.rainbowLogger.time("RainbowSDK Performance - sdkLogOn"),c.default.sdkLogOn(e,t,r.hostUsed,E,n).then((function(){i.rainbowLogger.timeEnd("RainbowSDK Performance - sdkLogOn"),w.account={},w.label="ok",w.account.userId=c.default.userId,w.account.companyId=c.default.companyId,w.account.loginEmail=c.default.login,w.account.roles=c.default.loggedInUser.roles,w.token=c.default.token,w.userData=c.default.loggedInUser;var e=[];i.rainbowLogger.sdk(r.logService+"[signin] :: Successfully sign-in with  | "+c.default.jidIm),a.eventsService.dispatchEvent(r.RAINBOW_ONSIGNED,w),c.default.startTokenSurvey(),i.rainbowLogger.sdk(r.logService+"[signin] :: Start services..."),i.rainbowLogger.time("RainbowSDK Performance - XMPPService"),u.default.start().then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - companyService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Company service ready!"),i.rainbowLogger.time("RainbowSDK Performance - adminCompanyService"),B.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - adminCompanyService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Admin company service ready!"),i.rainbowLogger.time("RainbowSDK Performance - companyDirectoryService"),V.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - companyDirectoryService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Company Directory Service company service ready!"),i.rainbowLogger.time("RainbowSDK Performance - adminUserService"),$.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - adminUserService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Admin user service ready!"),i.rainbowLogger.time("RainbowSDK Performance - contactService"),d.default.start()})).then((function(){if(i.rainbowLogger.timeEnd("RainbowSDK Performance - contactService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Contact service ready!"),i.rainbowLogger.time("RainbowSDK Performance - profileService"),v.sdkConfig.features.profileService)return p.default.start()})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - profileService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Profile service ready!"),i.rainbowLogger.time("RainbowSDK Performance - invitationService"),f.default.start()})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - invitationService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Invitation service ready!"),i.rainbowLogger.time("RainbowSDK Performance - fileServerService"),W.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - fileServerService"),i.rainbowLogger.sdk(r.logService+"[signin] :: FileServer service ready!"),i.rainbowLogger.time("RainbowSDK Performance - fileStorageService"),h.default.start()})).then((function(){if(i.rainbowLogger.timeEnd("RainbowSDK Performance - fileStorageService"),i.rainbowLogger.sdk(r.logService+"[signin] :: FileStorage service ready!"),i.rainbowLogger.time("RainbowSDK Performance - roomService"),v.sdkConfig.features.roomService)return m.default.start()})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - roomService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Room service ready!"),i.rainbowLogger.time("RainbowSDK Performance - groupService"),Y.start(e)})).then((function(){if(i.rainbowLogger.timeEnd("RainbowSDK Performance - groupService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Group service ready!"),i.rainbowLogger.time("RainbowSDK Performance - favoriteService"),v.sdkConfig.features.favoriteService)return J.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - favoriteService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Favorite service ready!"),i.rainbowLogger.time("RainbowSDK Performance - voiceMessageService"),K.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - voiceMessageService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Voice Message Service service ready!"),i.rainbowLogger.time("RainbowSDK Performance - webrtcGatewayService"),G.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - webrtcGatewayService"),i.rainbowLogger.sdk(r.logService+"[signin] :: WebrtcGateway service ready!"),i.rainbowLogger.time("RainbowSDK Performance - videoService"),!0===v.sdkConfig.unifiedPlan&&(i.rainbowLogger.sdk(r.logService+"[videoService] :: Unified plan activated"),o.config||(o.config={}),o.config.unifiedPlan=!0),o.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - videoService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Video service ready!"),i.rainbowLogger.time("RainbowSDK Performance - webrtcServiceEventHandler"),s.start(e)})).then((function(){if(i.rainbowLogger.timeEnd("RainbowSDK Performance - webrtcServiceEventHandler"),i.rainbowLogger.sdk(r.logService+"[signin] :: WebRTCEventHandler service ready!"),i.rainbowLogger.time("RainbowSDK Performance - telephonyService"),v.sdkConfig.features.telephony)return H.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - telephonyService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Telephony service ready!"),i.rainbowLogger.time("RainbowSDK Performance - webConferenceService"),C.start(e)})).then((function(){if(C.setActiveSpeakerValue(!1),i.rainbowLogger.timeEnd("RainbowSDK Performance - webConferenceService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Web Conference service ready!"),i.rainbowLogger.time("RainbowSDK Performance - conversationService"),v.sdkConfig.features.conversationService)return b.start(e)})).then((function(){i.rainbowLogger.timeEnd("RainbowSDK Performance - conversationService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Conversation service ready!"),i.rainbowLogger.sdk(r.logService+"[signin] :: Send initial presence"),i.rainbowLogger.time("RainbowSDK Performance - sendPresenceFromConfiguration"),d.default.sendPresenceFromConfiguration()})).then((function(){i.rainbowLogger.timeEnd("RainbowSDK Performance - sendPresenceFromConfiguration"),i.rainbowLogger.sdk(r.logService+"[signin] :: Initial presence sent !")})).then((function(){return i.rainbowLogger.time("RainbowSDK Performance - platformService"),q.start(e)})).then((function(){if(i.rainbowLogger.timeEnd("RainbowSDK Performance - platformService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Platform service ready!"),i.rainbowLogger.time("RainbowSDK Performance - botService"),v.sdkConfig.features.bots)return l.start(e)})).then((function(){if(i.rainbowLogger.timeEnd("RainbowSDK Performance - botService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Bot service ready!"),i.rainbowLogger.time("RainbowSDK Performance - conferenceService"),v.sdkConfig.features.conference)return S.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - conferenceService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Conference service ready!"),i.rainbowLogger.time("RainbowSDK Performance - recordsService"),z.start(e)})).then((function(){if(i.rainbowLogger.timeEnd("RainbowSDK Performance - recordsService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Records service ready!"),i.rainbowLogger.time("RainbowSDK Performance - channelService"),v.sdkConfig.features.channels)return F.start(e)})).then((function(){return i.rainbowLogger.timeEnd("RainbowSDK Performance - channelService"),i.rainbowLogger.sdk(r.logService+"[signin] :: Channel service ready!"),i.rainbowLogger.sdk(r.logService+"[signin] :: Services Successfully loaded!"),a.eventsService.dispatchEvent(r.RAINBOW_ONSTARTED,w),i.rainbowLogger.timeEnd("Auth"),y(w)})).catch((function(){return i.rainbowLogger.sdk(r.logService+"[signin] :: Error during signin"),w.code=g.SDK.ERRORXMPP,w.label="errorXMPP",w.account=null,_(w)}))})).catch((function(){return i.rainbowLogger.sdk(r.logService+"[signin] :: Error during signin"),w.code=g.SDK.ERRORUNAUTHORIZED,w.label="errorUnauthorized",_(w)}))}))}},{key:"reconnectServices",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,a,o,s,c,l,u,v;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.get(this),n=k.get(this),r=R.get(this),a=D.get(this),o=L.get(this),s=M.get(this),c=_.get(this),l=w.get(this),u=T.get(this),v=U.get(this),e.prev=1,t.attachHandlers(),n.attachHandlers(),r.attachHandlers(),a.reconnectService(),o.reconnect(),s.reconnect(),c.attachHandlers(),l.attachHandlers(),m.default.reconnect(),u.connect(),v.attachHandlers(),d.default.updateUserContactFullJid(),f.default.attachHandlers(),p.default.restart(),e.next=18,h.default.reinit(!1);case 18:return e.next=20,r.reinit();case 20:return e.next=22,d.default.sendPresenceFromConfiguration(!0);case 22:return e.abrupt("return",void e.sent);case 25:e.prev=25,e.t0=e.catch(1),i.rainbowLogger.error("[serviceLauncher] reconnectServices failure "+e.t0.message);case 28:case"end":return e.stop()}}),e,this,[[1,25]])})))}}],[{key:"$inject",get:function(){return["$rootScope","botService","fileServerService","groupService","videoService","favoriteService","webrtcServiceEventHandler","telephonyService","conferenceService","webConferenceService","conversationService","platformService","adminCompanyService","companyDirectoryService","adminUserService","channelService","webrtcGatewayService","recordsService","voiceMessageService"]}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(22),a=n(1),o=n(4),s=n(28),c=new WeakMap,l=function(){function e(t){var n=this;S(this,e),this.RAINBOW_PRESENCE_ONLINE="online",this.RAINBOW_PRESENCE_AWAY="away",this.RAINBOW_PRESENCE_DONOTDISTURB="dnd",this.RAINBOW_PRESENCE_OFFLINE="xa",this.RAINBOW_PRESENCE_BUSY="busy",this.RAINBOW_PRESENCE_UNKNOW="unknow",this.RAINBOW_ONCONTACTPRESENCECHANGED="rainbowcontactpresencechanged",this.RAINBOW_ONPRESENCECHANGED="rainbowpresencechanged",this.RAINBOW_ONCONTACTRICHPRESENCECHANGED="rainbowcontactrichpresencechanged",this.RAINBOW_ONRICHPRESENCECHANGED="rainbowrichpresencechanged",c.set(this,t),o.default.subscribeToContactEvents((function(e){"ON_CONTACT_PRESENCE_EVENT"===e.name&&n.onPresenceChangedEvent(e.name,e.data)})),t.$on("$destroy",t.$on("ON_UPDATE_CONTACT_RICH_STATUS_EVENT",(function(e,t){return n.onRichPresenceChangedEvent(e,t)})))}return C(e,[{key:"setPresenceTo",value:function(t){if(t!==this.RAINBOW_PRESENCE_DONOTDISTURB&&t!==this.RAINBOW_PRESENCE_AWAY&&t!==this.RAINBOW_PRESENCE_OFFLINE&&t!==this.RAINBOW_PRESENCE_ONLINE)throw new Error("Parameter 'strPresenceState' should be 'dnd', 'away', 'xa' (invisible) or 'online'");return r.rainbowLogger.sdk(e.logService+"[setPresenceTo] :: Set presence to "+t),a.default.changeMyPresence(t),{code:s.SDK.OK,label:"OK"}}},{key:"onPresenceChangedEvent",value:function(t,n){var a=n.message||"''";n.jid===o.default.fullJid?(r.rainbowLogger.sdk(e.logService+"[onPresenceChangedEvent] :: Presence changed for me ("+n.jid+") to  "+n.status+" | "+a),i.eventsService.dispatchEvent(this.RAINBOW_ONPRESENCECHANGED,n)):(r.rainbowLogger.sdk(e.logService+"[onPresenceChangedEvent] :: Presence changed for contact ("+n.jid+") to  "+n.status+" | "+a),i.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTPRESENCECHANGED,n))}},{key:"onRichPresenceChangedEvent",value:function(t,n){var i=n.message||"''",a=n.telStatus||"''";if(o.default.fullJid.includes(n.jid)){r.rainbowLogger.sdk(e.logService+"[onPresenceChangedEvent] :: Rich Presence changed for myself to status "+n.status+", message "+i+" and telStatus "+a);var s=new CustomEvent(this.RAINBOW_ONRICHPRESENCECHANGED,{detail:n});document.dispatchEvent(s)}else{r.rainbowLogger.sdk(e.logService+"[onPresenceChangedEvent] :: Rich Presence changed for contact ("+n.jid+") to status "+n.status+", message "+i+" and telStatus "+a);var c=new CustomEvent(this.RAINBOW_ONCONTACTRICHPRESENCECHANGED,{detail:n});document.dispatchEvent(c)}}}],[{key:"$inject",get:function(){return["$rootScope"]}}]),e}();l.logService="PresenceService | ",t.PresenceService=l},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=n(9),o=n(1),s=n(6),c=new WeakMap,l=new WeakMap,u=function(){function e(t,n){S(this,e),c.set(this,t),l.set(this,n)}return C(e,[{key:"getProfile",value:function(){return i.default.loggedInUser}},{key:"getProfileOffer",value:function(){return s.default.getMyProfileName()}},{key:"updateFirstName",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t&&"string"==typeof t&&!(t.length<1)){n.next=2;break}throw new Error("Parameter 'strFirstname' is missing, empty or null");case 2:return r={firstName:t},n.next=5,s.default.setUserData(r);case 5:return i=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updateFirstName] :: First name updated"),i.data));case 7:case"end":return n.stop()}}),n)})))}},{key:"updateLastName",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t&&"string"==typeof t&&!(t.length<1)){n.next=2;break}throw new Error("Parameter 'strFirstname' is missing, empty or null");case 2:return r={lastName:t},n.next=5,s.default.setUserData(r);case 5:return i=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updateFirstName] :: First name updated"),i.data));case 7:case"end":return n.stop()}}),n)})))}},{key:"updatePhoneNumber",value:function(t,n,o,c){return r(this,void 0,void 0,b.a.mark((function r(){var l,u,d,h,f;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&"string"==typeof t&&!(["home","work","other"].indexOf(t)<0)){r.next=2;break}throw new Error("Parameter 'type' is missing or not matching one of the following types: 'home', 'work', 'other'");case 2:if(n&&"string"==typeof n&&!(["landline","mobile","fax","other"].indexOf(n)<0)){r.next=4;break}throw new Error("Parameter 'deviceType' is missing or not matching one of the following types 'landline', 'mobile', 'fax', 'other'");case 4:if("string"==typeof o){r.next=6;break}throw new Error("Parameter 'strPhoneNumber' must be of type 'string' ");case 6:return l={type:t,deviceType:n,number:o},c&&"string"==typeof c&&(l.country=c),(u=i.default.loggedInUser).phoneNumbers.length?(!1,u.phoneNumbers.some((function(e){return e.type===t&&e.deviceType===n}))?u.phoneNumbers.push(l):(d={type:t,deviceType:n,number:o},u.phoneNumbers.push(d))):(h={type:t,deviceType:n,number:o},u.phoneNumbers.push(h)),r.next=12,s.default.setUserData(u);case 12:return f=r.sent,r.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updatePhoneNumber] :: Phone number updated"),f.data));case 14:case"end":return r.stop()}}),r)})))}},{key:"deletePhoneNumber",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var o,c,l,u;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&"string"==typeof t&&!(["home","work","other"].indexOf(t)<0)){r.next=2;break}throw new Error("Parameter 'type' is missing or not matching one of the following types: 'home', 'work', 'other'");case 2:if(n&&"string"==typeof n&&!(["landline","mobile","fax","other"].indexOf(n)<0)){r.next=4;break}throw new Error("Parameter 'deviceType' is missing or not matching one of the following types 'landline', 'mobile', 'fax', 'other'");case 4:if((o=i.default.loggedInUser).phoneNumbers.length){r.next=7;break}throw new Error("No phone numbers associated with the user profile");case 7:for(l=o.phoneNumbers,u=0;u<l.length;u++)l[u].type===t&&l[u].deviceType===n&&l.splice(u,1);return o.phoneNumbers=l,r.next=12,s.default.setUserData(o);case 12:return c=r.sent,a.rainbowLogger.sdk(e.logService+"[deletePhoneNumber] :: Phone number deleted"),r.abrupt("return",c.data);case 15:case"end":return r.stop()}}),r)})))}},{key:"updatePhotoFromUrl",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t&&"string"==typeof t&&!(t.length<1)){n.next=2;break}throw new Error("Parameter 'imgUrl' is missing, empty or null");case 2:return n.next=4,o.default.pushAvatarImage(t);case 4:a.rainbowLogger.sdk(e.logService+"[updatePhotoFromUrl] :: Photo updated");case 5:case"end":return n.stop()}}),n)})))}},{key:"updateWorkEmail",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,o,c,l,u;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t&&"string"==typeof t&&!(t.length<1)){n.next=2;break}throw new Error("Parameter 'strEmail' is missing, empty or null");case 2:if(r=i.default.loggedInUser,o=!1,r.emails.length){for(c=0;c<r.emails.length;c++)"work"===r.emails[c].type&&(r.emails[c].email=t,o=!0);o||r.emails.push({email:t,type:"work"})}else r.emails=[{email:t,type:"work"}];return l={emails:r.emails},n.next=8,s.default.setUserData(l);case 8:return u=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updateWorkEmail] :: work email updated"),u.data));case 10:case"end":return n.stop()}}),n)})))}},{key:"updatePersonalEmail",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,o,c,l,u;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t&&"string"==typeof t&&!(t.length<1)){n.next=2;break}throw new Error("Parameter 'strEmail' is missing, empty or null");case 2:if(r=i.default.loggedInUser,o=!1,r.emails.length){for(c=0;c<r.emails.length;c++)"home"===r.emails[c].type&&(r.emails[c].email=t,o=!0);o||r.emails.push({email:t,type:"home"})}else r.emails=[{email:t,type:"home"}];return l={emails:r.emails},n.next=8,s.default.setUserData(l);case 8:return u=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updatePersonalEmail] :: work email updated"),u.data));case 10:case"end":return n.stop()}}),n)})))}},{key:"deleteWorkEmail",value:function(){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={emails:i.default.loggedInUser.emails.filter((function(e){return"work"!==e.type}))},t.next=3,s.default.setUserData(n);case 3:return r=t.sent,t.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[deleteWorkEmails] :: work emails deleted"),r.data));case 5:case"end":return t.stop()}}),t)})))}},{key:"deletePersonalEmail",value:function(){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={emails:i.default.loggedInUser.emails.filter((function(e){return"home"!==e.type}))},t.next=3,s.default.setUserData(n);case 3:return r=t.sent,t.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[deletePersonalEmails] :: personal emails deleted"),r.data));case 5:case"end":return t.stop()}}),t)})))}},{key:"updateCountry",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={country:t},n.next=3,s.default.setUserData(r);case 3:return i=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updateCountry] :: Country updated"),i.data));case 5:case"end":return n.stop()}}),n)})))}},{key:"updateLanguage",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={language:t},n.next=3,s.default.setUserData(r);case 3:return i=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updateLanguage] :: Language updated"),i.data));case 5:case"end":return n.stop()}}),n)})))}},{key:"updateTitle",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={title:t},n.next=3,s.default.setUserData(r);case 3:return i=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updateTitle] :: title updated"),i.data));case 5:case"end":return n.stop()}}),n)})))}},{key:"updateNickName",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={nickName:t},n.next=3,s.default.setUserData(r);case 3:return i=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updateNickName] :: nickname updated"),i.data));case 5:case"end":return n.stop()}}),n)})))}},{key:"updateJobTitle",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={jobTitle:t},n.next=3,s.default.setUserData(r);case 3:return i=n.sent,n.abrupt("return",(a.rainbowLogger.sdk(e.logService+"[updateJobTitle] :: job title updated"),i.data));case 5:case"end":return n.stop()}}),n)})))}}],[{key:"$inject",get:function(){return["$rootScope","adminUserService"]}}]),e}();u.logService="UserProfileService | ",t.UserProfileService=u},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),a=n(1),o=n(233),s=n(413),c=n(6),l=n(22),u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=function(){function e(t,n,r,i){var a=this;S(this,e),this.RAINBOW_ONCONTACTINFORMATIONCHANGED="rainbowcontactinformationchanged",this.RAINBOW_ONINFORMATIONCHANGED="rainbowinformationchanged",this.RAINBOW_ONCONTACTINVITATIONNUMBERCHANGED="rainbowsubscriptionnumberchanged",this.RAINBOW_ONCONTACTINVITATIONRECEIVED="rainbowinvitationreceived",u.set(this,t),d.set(this,n),h.set(this,r),f.set(this,i),t.$on("$destroy",t.$on("ON_CONTACT_UPDATED_EVENT",(function(e,t){return a.onContactInformationUpdated(e,t)}))),t.$on("$destroy",t.$on("ON_USER_CONTACT_UPDATED_EVENT",(function(e,t){return a.onInformationUpdated(e,t)}))),t.$on("$destroy",t.$on("ON_INVITATIONS_NUMBER_UPDATED",(function(){return a.onInvitationNumberChanged()}))),t.$on("$destroy",t.$on("ON_INVITATION_CHANGED",(function(e,t){return a.onInvitationReceived(e,t)})))}return C(e,[{key:"onContactInformationUpdated",value:function(e,t){l.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINFORMATIONCHANGED,t)}},{key:"onInformationUpdated",value:function(e,t){l.eventsService.dispatchEvent(this.RAINBOW_ONINFORMATIONCHANGED,t)}},{key:"onInvitationNumberChanged",value:function(){l.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINVITATIONNUMBERCHANGED,null)}},{key:"onInvitationReceived",value:function(e,t){l.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINVITATIONRECEIVED,t)}},{key:"getContactByJID",value:function(e){return e?a.default.getContactByJid(e):{code:i.SDK.ERRORBADREQUEST,label:"Parameter 'strJID' is missing or empty"}}},{key:"getContactById",value:function(e){return e?a.default.getContactById(e):{code:i.SDK.ERRORBADREQUEST,label:"Parameter 'strId' is missing or empty"}}},{key:"getNetworkContacts",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.default.getContacts().filter((function(e){return e.id!==a.default.userContact.id&&!e.isBot&&e.roster})));case 1:case"end":return e.stop()}}),e)})))}},{key:"getAll",value:function(){return a.default.getContacts().filter((function(e){return e.id!==a.default.userContact.id&&!e.isBot}))}},{key:"getConnectedUser",value:function(){return a.default.userContact||null}},{key:"getConnectedUserPhone",value:function(){return a.default.userContact?0===a.default.userContact.pbxId.length?null:{phoneNumber:a.default.userContact.phonePbx,pbxId:a.default.userContact.pbxId}:null}},{key:"searchByName",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return r(this,void 0,void 0,b.a.mark((function r(){var o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=d.get(this),e){r.next=3;break}throw new Error("Parameter 'strName' is missing or empty");case 3:return t||(t=20),r.next=6,o.search(e,n,Math.min(t,1e3),i,a);case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}),r,this)})))}},{key:"searchPhonebook",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=f.get(this),r=c.default.isFeatureEnabled(c.default.FeaturesEnum.TELEPHONY_PHONE_BOOK),e){t.next=3;break}throw new Error("Parameter 'strPattern' is missing or empty");case 3:if(r){t.next=5;break}throw new Error("The feature is not enabled for connected user");case 5:return t.abrupt("return",n.search(e));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"searchOffice365",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Parameter 'strPattern' is missing or empty");case 2:return t.next=4,s.default.search(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))}},{key:"searchCompanyDirectory",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=h.get(this),e){n.next=3;break}throw new Error("Parameter 'strPattern' is missing or empty");case 3:return n.next=5,r.search(e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"searchByLogin",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d.get(this),e){t.next=3;break}throw new Error("Parameter 'strLogin' is missing or empty");case 3:return t.next=5,n.searchUserByLogin(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"searchByJid",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d.get(this),e){t.next=3;break}throw new Error("Parameter 'strJid' is missing or empty");case 3:return t.next=5,n.searchUserByJid(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"searchById",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Parameter 'strId' is missing or empty");case 2:return t.next=4,a.default.getContactByDBId(e,!0);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))}},{key:"acceptInvitation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,o.default.acceptInvitation(e);case 3:t.t0={code:i.SDK.OK,label:"OK"},t.next=7;break;case 6:t.t0=new Error("Parameter 'invitation' is missing or null");case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t)})))}},{key:"declineInvitation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Parameter 'invitation' is missing or null");case 2:return t.next=4,o.default.declineInvitation(e);case 4:return t.abrupt("return",{code:i.SDK.OK,label:"OK"});case 5:case"end":return t.stop()}}),t)})))}},{key:"addToNetwork",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:return t.next=4,o.default.joinContactInvitation(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))}},{key:"sendInvitationByEmail",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}throw new Error("Parameter 'email' is missing or null");case 2:return n.next=4,o.default.sendInvitationByEmail(e,t);case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),n)})))}},{key:"removeFromNetwork",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:return t.next=4,a.default.removeContact(e);case 4:return t.abrupt("return",{code:i.SDK.OK,label:"OK"});case 5:case"end":return t.stop()}}),t)})))}},{key:"getInvitationById",value:function(e){if(!e)throw new Error("Parameter 'strInvitationId' is missing or null");return o.default.getInvitation(e)}},{key:"getInvitationsReceived",value:function(){return o.default.getReceivedInvitations()}},{key:"cancelInvitation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Parameter 'invitation' is missing or null");case 2:return t.next=4,o.default.cancelOneSendInvitation(e);case 4:case"end":return t.stop()}}),t)})))}},{key:"getInvitationsSent",value:function(){return o.default.getSentInvitations()}},{key:"updateUserCustomData",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Parameter 'customData' is missing or null");case 2:return t.next=4,a.default.updateUserContact({customData:e});case 4:case"end":return t.stop()}}),t)})))}}],[{key:"$inject",get:function(){return["$rootScope","directoryService","companyDirectoryService","phonebookService"]}}]),e}();p.logService="ContactService | ",t.ContactsService=p},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=n(1),s=n(28),c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=function(){function e(t,n,r,i,a){var o=this;S(this,e),this.RAINBOW_ONTELEPHONYCALLSTATECHANGED="rainbowontelephonycallstatechanged",this.RAINBOW_ONVOIPCALLSTATECHANGED="rainbowonvoipcallstatechanged",this.RAINBOW_ONTELEPHONYSTARTED="rainbowontelephonystarted",this.RAINBOW_ONTELEPHONYSTOPPED="rainbowontelephonystopped",this.RAINBOW_ONTELEPHONYFORWARDSTATECHANGED="rainbowontelephonyforwardstatechanged",this.RAINBOW_ONCALLNOMADICEVENT="rainbowoncallnomadicevent",this.RAINBOW_ONVOIPSTARTED="rainbowonvoipstarted",this.RAINBOW_ONVOIPSTOPPED="rainbowonvoipstopped",this.RAINBOW_ONVOICEMESSAGEUPDATED="rainbowonvoicemessageupdated",this.RAINBOW_TELEPHONYDIALING="dialing",this.RAINBOW_TELEPHONYRINGINGOUTGOING="ringingOutgoing",this.RAINBOW_TELEPHONYINCOMING="incomingCall",this.RAINBOW_TELEPHONYACTIVE="active",this.RAINBOW_TELEPHONYRELEASING="releasing",this.RAINBOW_TELEPHONYUNKNOW="Unknown",this.RAINBOW_TELEPHONYMUTE="rainbowtelephonymute",c.set(this,t),l.set(this,n),u.set(this,r),d.set(this,i),h.set(this,a),t.$on("$destroy",t.$on("ON_TELEPHONY_STATUS_CHANGED_EVENT",(function(e,t){return o.onTelephonyStateChanged(e,t)}))),t.$on("$destroy",t.$on("ON_CALL_NOMADIC_EVENT",(function(e,t){return o.onCallNomadicEvent(e,t)}))),t.$on("$destroy",t.$on("ON_CALL_UPDATED_EVENT",(function(e,t){return o.onTelephonyCallChanged(e,t)}))),t.$on("$destroy",t.$on("ON_CALL_FORWARDED_EVENT",(function(e,t){return o.onCallForwardChanged(e,t)}))),t.$on("$destroy",t.$on("ON_WEBRTCGATEWAY_STATE_CHG",(function(e,t){return o.onVoIPStateChanged(e,t)}))),t.$on("$destroy",t.$on("ON_VOICE_MESSAGE_UPDATE_EVENT",(function(e,t){return o.onVoiceMessageUpdated(e,t)}))),t.$on("$destroy",t.$on("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",(function(e,t){return o.onCallMuteEvent(e,t)})))}return C(e,[{key:"onTelephonyStateChanged",value:function(t,n){i.rainbowLogger.sdk(e.logService+"[onTelephonyStateChanged] :: PBX state changed to "+n),"started"===n?a.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYSTARTED,null):a.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYSTOPPED,null)}},{key:"onCallNomadicEvent",value:function(t,n){i.rainbowLogger.sdk(e.logService+"[onCallNomadicEvent] :: Nomadic event received"),a.eventsService.dispatchEvent(this.RAINBOW_ONCALLNOMADICEVENT,n)}},{key:"onTelephonyCallChanged",value:function(t,n){var r=h.get(this).isMediaPillarCallSituation(n);"Phone"!==n.type.value||r?r&&(i.rainbowLogger.sdk(e.logService+"[onTelephonyCallChanged] :: Telephony state changed to "+n),a.eventsService.dispatchEvent(this.RAINBOW_ONVOIPCALLSTATECHANGED,n)):(i.rainbowLogger.sdk(e.logService+"[onTelephonyCallChanged] :: Telephony state changed to "+n),a.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYCALLSTATECHANGED,n))}},{key:"onCallForwardChanged",value:function(t,n){i.rainbowLogger.sdk(e.logService+"[onCallForwardChanged] :: Forward state changed to "+n),a.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYFORWARDSTATECHANGED,n)}},{key:"onVoIPStateChanged",value:function(t,n){i.rainbowLogger.sdk(e.logService+"[onVoIPStateChanged] :: VoIP state changed to "+n?"true":"false"),n?a.eventsService.dispatchEvent(this.RAINBOW_ONVOIPSTARTED,null):a.eventsService.dispatchEvent(this.RAINBOW_ONVOIPSTOPPED,null)}},{key:"onVoiceMessageUpdated",value:function(t,n){i.rainbowLogger.sdk(e.logService+"[onVoiceMessageUpdated] :: New Voice Message event received"),a.eventsService.dispatchEvent(this.RAINBOW_ONVOICEMESSAGEUPDATED,n)}},{key:"onCallMuteEvent",value:function(t,n){i.rainbowLogger.sdk(e.logService+"[onCallMuteEvent] :: New Mute Event received"),a.eventsService.dispatchEvent(this.RAINBOW_TELEPHONYMUTE,n)}},{key:"isTelephonyAvailable",value:function(){return u.get(this).started}},{key:"isVoiceMailConfigured",value:function(){var e=u.get(this);return Boolean(e.voiceMailFeatureEnabled&&e.voicemailNumber)}},{key:"getAgentVersion",value:function(){return u.get(this).agentStatus.agentVersion||"unknown"}},{key:"getXMPPAgentStatus",value:function(){return u.get(this).agentStatus.xmppAgent||"unknown"}},{key:"getPhoneAPIStatus",value:function(){return u.get(this).agentStatus.phoneApi||"unknown"}},{key:"makeCall1PCC",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=h.get(this),e){n.next=3;break}throw new Error("Parameter 'strPhoneNumber' is missing or empty");case 3:return n.abrupt("return",r.mediaPillarMakeCall1PCC(e,t));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"makeCall",value:function(e,t,n,i){return r(this,void 0,void 0,b.a.mark((function r(){var a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=u.get(this),t){r.next=3;break}throw new Error("Parameter 'strPhoneNumber' is missing or empty");case 3:if(!e){r.next=8;break}return r.next=6,a.makeCall(e,t,n,i);case 6:r.next=10;break;case 8:return r.next=10,a.makeCallByPhoneNumber(t,n,i);case 10:return r.abrupt("return",{code:s.SDK.OK,label:"OK"});case 11:case"end":return r.stop()}}),r,this)})))}},{key:"callByNumber",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),e){t.next=3;break}throw new Error("Parameter 'strPhoneNumber' is missing or empty");case 3:return t.next=5,n.makeCallByPhoneNumber(e);case 5:return t.abrupt("return",{code:s.SDK.OK,label:"OK"});case 6:case"end":return t.stop()}}),t,this)})))}},{key:"callWithMessage",value:function(e,t,n,i){return r(this,void 0,void 0,b.a.mark((function r(){var a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=u.get(this),e){r.next=3;break}throw new Error("Parameter 'contact' is missing or empty");case 3:if(t){r.next=5;break}throw new Error("Parameter 'phoneNumber' is missing or empty");case 5:if(n){r.next=7;break}throw new Error("Parameter 'callSubject' is missing or empty");case 7:return r.next=9,a.makeCall(e,t,n,i);case 9:return r.abrupt("return",{code:s.SDK.OK,label:"OK"});case 10:case"end":return r.stop()}}),r,this)})))}},{key:"callWithSubject",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=u.get(this),e){r.next=3;break}throw new Error("Parameter 'contact' is missing or empty");case 3:if(t){r.next=5;break}throw new Error("Parameter 'phoneNumber' is missing or empty");case 5:if(n){r.next=7;break}throw new Error("Parameter 'callSubject' is missing or empty");case 7:return r.next=9,i.makeCall(e,t,n);case 9:return r.abrupt("return",{code:s.SDK.OK,label:"OK"});case 10:case"end":return r.stop()}}),r,this)})))}},{key:"calls",value:function(){return u.get(this).calls}},{key:"getActiveCall",value:function(){return u.get(this).getActiveCall()}},{key:"release",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),e){t.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:return t.next=5,n.releaseCall(e);case 5:return t.abrupt("return",{code:s.SDK.OK,label:"OK"});case 6:case"end":return t.stop()}}),t,this)})))}},{key:"deflectToVM",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),e){t.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:if(e.connectionId){t.next=5;break}throw new Error("Property 'connectionId' of the object 'call' is missing or null");case 5:if("Phone"===e.type.value){t.next=7;break}throw new Error("Call must be of type 'Phone' (see call.type.value)");case 7:return t.next=9,n.deflectCallToVM(e);case 9:return t.abrupt("return",{code:s.SDK.OK,label:"OK"});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"forwardToDevice",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),e&&"string"==typeof e&&0!==e.length){t.next=3;break}throw new Error("Parameter 'strPhoneNumber' is missing or empty");case 3:return t.abrupt("return",(n.forwardToDevice(e),{code:s.SDK.OK,label:"OK"}));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"forwardToVoicemail",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.get(this),e.next=3,t.forwardToVoicemail();case 3:return e.abrupt("return",{code:s.SDK.OK,label:"OK"});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"cancelForward",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.get(this),e.next=3,t.cancelForward();case 3:return e.abrupt("return",{code:s.SDK.OK,label:"OK"});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getForwardStatusFromServer",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.get(this),e.next=3,t.getForwardStatus().then((function(){return{code:s.SDK.OK,label:"OK"}}));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getForwardStatus",value:function(){return u.get(this).getForwardObject()}},{key:"answer",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),r=h.get(this),e){t.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:if(!e.mediaPillarCall){t.next=7;break}r.answerCall(e),t.next=9;break;case 7:return t.next=9,n.answerCall(e);case 9:return t.abrupt("return",{code:s.SDK.OK,label:"OK"});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"hold",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),e){t.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:return t.next=5,n.holdCall(e);case 5:return t.abrupt("return",{code:s.SDK.OK,label:"OK"});case 6:case"end":return t.stop()}}),t,this)})))}},{key:"retrieve",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),e){t.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:return t.next=5,n.retrieveCall(e);case 5:return t.abrupt("return",{code:s.SDK.OK,label:"OK"});case 6:case"end":return t.stop()}}),t,this)})))}},{key:"transferCall",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=u.get(this),e){n.next=3;break}throw new Error("Parameter 'activeCall' is missing or null");case 3:if(t){n.next=5;break}throw new Error("Parameter 'heldCall' is missing or null");case 5:return n.next=7,r.transfertCall(e,t);case 7:return n.abrupt("return",{code:s.SDK.OK,label:"OK"});case 8:case"end":return n.stop()}}),n,this)})))}},{key:"conferenceCall",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=u.get(this),e){n.next=3;break}throw new Error("Parameter 'activeCall' is missing or null");case 3:if(t){n.next=5;break}throw new Error("Parameter 'heldCall' is missing or null");case 5:return n.next=7,r.conferenceCall(e,t);case 7:return n.abrupt("return",{code:s.SDK.OK,label:"OK"});case 8:case"end":return n.stop()}}),n,this)})))}},{key:"fetchVoiceMailMessagesNumber",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.get(this),e.next=3,t.getVoiceMessagesCounters();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"muteCall",value:function(e,t){var n=h.get(this);if(!e)throw new Error("Parameter 'call' is missing or null");n.muteAudio(e,!0,t)}},{key:"unmuteCall",value:function(e,t){var n=h.get(this);if(!e)throw new Error("Parameter 'call' is missing or null");n.muteAudio(e,!1,t)}},{key:"nomadicLogin",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=u.get(this),e){r.next=3;break}throw new Error("Parameter 'phoneNumber' is missing or null");case 3:return r.next=5,i.nomadicLogin(e,t,n);case 5:case"end":return r.stop()}}),r,this)})))}},{key:"nomadicLogout",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.get(this),e.next=3,t.nomadicLogout();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getNomadicState",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.get(this),e.next=3,t.getNomadicStatus();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"setExternalNomadicNumber",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),e){t.next=3;break}throw new Error("Parameter 'phoneNumber' is missing or null");case 3:if("string"==typeof e){t.next=5;break}throw new Error("Parameter 'phoneNumber' is not a string");case 5:return t.next=7,n.nomadicLogin(e);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"setNomadicOfficePhone",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.get(this),e.next=3,t.nomadicLoginOnOfficePhone();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"setNomadicVoIP",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.get(this),n=u.get(this),r=t.getMyMediaPillarRemoteExtension(),e.next=3,n.nomadicLogin(r);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"setNomadicWebRTC",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.get(this),n=u.get(this),r=t.getMyMediaPillarRemoteExtension(),e.next=3,n.nomadicLogin(r);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"isDeskPhoneAvailable",value:function(){return!o.default.userContact.isVirtualTerm}},{key:"isVoIPAvailable",value:function(){return h.get(this).isMediaPillarAvailable()}},{key:"logonCCD",value:function(e,t,n,i){return r(this,void 0,void 0,b.a.mark((function r(){var a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=u.get(this),e){r.next=3;break}throw new Error("Parameter 'endpointTel' is missing or empty");case 3:return r.next=5,a.logonCCD(e,t,n,i);case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}}),r,this)})))}},{key:"logoffCCD",value:function(e,t,n,i){return r(this,void 0,void 0,b.a.mark((function r(){var a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=u.get(this),e){r.next=3;break}throw new Error("Parameter 'endpointTel' is missing or empty");case 3:return r.next=5,a.logoffCCD(e,t,n,i);case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}}),r,this)})))}},{key:"withdrawalCCD",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=u.get(this),r.next=3,i.withdrawalCCD(e,t,n);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r,this)})))}},{key:"wrapupCCD",value:function(e,t,n,i){return r(this,void 0,void 0,b.a.mark((function r(){return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",u.get(this).wrapupCCD(e,t,n,i));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"sendDTMF",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i=u.get(this),e){n.next=3;break}throw new Error("Parameter 'dialString' is missing or empty");case 3:if(t){n.next=5;break}throw new Error("Parameter 'call' is missing or empty");case 5:if("Video"!==t.type.value){n.next=7;break}return n.abrupt("return",r.sendDTMF(e,t,!1));case 7:if("Phone"!==t.type.value){n.next=9;break}return n.abrupt("return",i.sendDtmf(t,e));case 9:if("Video"===t.type.value&&"Phone"===t.type.value){n.next=11;break}throw new Error("Parameter 'call' must be of type 'Video' or 'Phone'");case 11:return n.abrupt("return",!0);case 12:case"end":return n.stop()}}),n,this)})))}}],[{key:"$inject",get:function(){return["$rootScope","videoService","telephonyService","voiceMessageService","webrtcGatewayService"]}}]),e}();f.logService="TelephonyService | ",t.PbxService=f},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=new WeakMap,s=new WeakMap,c=new WeakMap,l=function(){function e(t,n,r){var i=this;S(this,e),this.RAINBOW_ONCONVERSATIONSMISSEDCOUNTERCHANGED="rainbowconversationsmissedcounterchanged",this.RAINBOW_ONCONVERSATIONSCHANGED="rainbowconversationschanged",this.RAINBOW_ONCONVERSATIONREMOVED="rainbowconversationremoved",this.RAINBOW_ONCONVERSATIONCHANGED="rainbowconversationchanged",o.set(this,t),s.set(this,n),c.set(this,r),t.$on("$destroy",t.$on("ON_CONVERSATIONS_UPDATED_EVENT",(function(e,t){return i.onConversationsChanged(e,t)}))),t.$on("$destroy",t.$on("ON_CONVERSATION_REMOVE_EVENT",(function(e,t){return i.onConversationsRemoved(e,t)}))),t.$on("$destroy",t.$on("ON_CONVERSATION_UPDATED_EVENT",(function(e,t){return i.onConversationChanged(e,t)}))),t.$on("$destroy",t.$on("ON_MISSED_COUNTER_CHANGED_EVENT",(function(e,t){return i.onConversationsCounterChanged(e,t)})))}return C(e,[{key:"onConversationsChanged",value:function(e,t){t&&a.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONSCHANGED,t)}},{key:"onConversationsRemoved",value:function(e,t){a.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONREMOVED,t)}},{key:"onConversationChanged",value:function(e,t){a.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONCHANGED,t)}},{key:"onConversationsCounterChanged",value:function(e,t){a.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONSMISSEDCOUNTERCHANGED,t)}},{key:"getAllConversations",value:function(){return c.get(this).getConversations()}},{key:"getCallById",value:function(e){var t=c.get(this);if(!e)throw new Error("Parameter 'strCallId' is missing or empty");var n=t.getConversations(),r=null;return n.forEach((function(t){t.videoCall&&t.videoCall.id===e?r=t.videoCall:t.audioCall&&t.audioCall.id===e&&(r=t.audioCall)})),r}},{key:"getConversationById",value:function(e){var t=c.get(this);if(!e)throw new Error("Parameter 'callId' is missing or empty");return t.getConversationById(e)}},{key:"getConversationByBubbleId",value:function(e){var t=c.get(this);if(!e)throw new Error("Parameter 'strBubbleId' is missing or empty");return t.getConversationByRoomDbId(e)}},{key:"openConversationForContact",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=c.get(this),t){n.next=3;break}throw new Error("Parameter 'contact' is missing or null");case 3:return i.rainbowLogger.sdk(e.logService+"[openConversationForContact] :: Trying to open a conversation for a contact"),n.next=6,r.getOrCreateOneToOneConversation(t.jid);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"openConversationForBubble",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=c.get(this),t){n.next=3;break}throw new Error("Prameter 'bubble' is missing or null");case 3:return i.rainbowLogger.sdk(e.logService+"[openConversationForBubble] :: Try to create or get a conversation for a bubble "),n.next=6,r.getRoomConversation(t.jid);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"closeConversation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=c.get(this),e){t.next=3;break}throw new Error("Parametr 'conversation' is missing or null");case 3:return t.next=5,n.closeConversation(e);case 5:case"end":return t.stop()}}),t,this)})))}}],[{key:"$inject",get:function(){return["$rootScope","Conversation","conversationService"]}}]),e}();l.logService="ConversationsService | ",t.ConversationsService=l},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),a=n(9),o=n(16),s=n(28),c=n(25),l=n(33),u=new WeakMap,d=new WeakMap,h=new WeakMap,f=function(){function e(t,n,r){var i=this;S(this,e),this.RAINBOW_ONNEWIMMESSAGERECEIVED="rainbownewimmessagereceived",this.RAINBOW_ONNEWIMRECEIPTRECEIVED="rainbownewimreceiptreceived",this.RAINBOW_ONNEWPARTICIPANTSTATUS="rainbownewparticipantstatus",u.set(this,t),d.set(this,n),h.set(this,r),t.$on("$destroy",t.$on("ON_CONVERSATION_MESSAGE_RECEIVED",(function(e,t,n,r){return i.onNewImMessageReceived(e,t,n,r)}))),t.$on("$destroy",t.$on("ON_CONVERSATION_RECEIPT_RECEIVED",(function(e,t,n,r){return i.onNewImReceiptReceived(e,t,n,r)}))),t.$on("$destroy",t.$on("ON_CONVERSATIONS_STATUS_MESSAGE_EVENT",(function(e,t,n,r){return i.onNewParticipantStatus(e,t,n,r)})))}return C(e,[{key:"onNewImMessageReceived",value:function(e,t,n,r){i.eventsService.dispatchEvent(this.RAINBOW_ONNEWIMMESSAGERECEIVED,{message:t,conversation:n,cc:r})}},{key:"onNewImReceiptReceived",value:function(e,t,n,r){i.eventsService.dispatchEvent(this.RAINBOW_ONNEWIMRECEIPTRECEIVED,{message:t,conversation:n,evt:r})}},{key:"onNewParticipantStatus",value:function(e,t,n,r){r&&r.value&&i.eventsService.dispatchEvent(this.RAINBOW_ONNEWPARTICIPANTSTATUS,{participant:t,conversation:n,status:r.value})}},{key:"getMessagesFromConversation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=d.get(this),e){n.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:return t=t?Math.min(t,100):30,n.next=6,r.conversationServiceBulkHistoryHandler.getHistoryPage(e,t);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"getMessageFromConversationById",value:function(e,t){if(!e)throw new Error("Parameter 'conversation' is missing or null");if(!t)throw new Error("Parameter 'strMessageId' is missing or empty");var n=e.getMessageById(t);return n&&n.fileId&&(n.shortFileDescriptor=c.default.getFileDescriptorById(n.fileId)),n}},{key:"getMessageFromBubbleById",value:function(e,t){var n=d.get(this),r=h.get(this);if(!e)throw new Error("Parameter 'bubble' is missing or null");if(!t)throw new Error("Parameter 'strMessageId' is missing or empty");var i=n.getConversationByRoomDbId(e.dbId);if(!i)throw new Error("Parameter 'bubble' don't have a conversation");if(i.type!==r.Type.ROOM)throw new Error("Parameter 'conversation' is not a bubble conversation");var a=i.getMessageById(t);return a&&a.fileId&&(a.shortFileDescriptor=c.default.getFileDescriptorById(a.fileId)),a}},{key:"sendMessageToConversation",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"std",a=d.get(this);if(!e)throw new Error("Parameter 'conversation' is missing or null");if(!t)throw new Error("Parameter 'strMessage' is missing or empty");if("string"!=typeof t)throw new Error("Parameter 'strMessage' must be a string");if(t.length>1024)throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");var o=null;if(r){if(r.length>1024)throw new Error("Parameter 'alternativeContent.message' should be shorter than 1024 characters");if(!n||"text"!==n&&"markdown"!==n&&"rainbow/json"!==n)throw new Error("Parameter 'alternativeContent.type' should be set to either 'text', 'markdown' or 'rainbow/json'");"rainbow/json"===n&&(r=JSON.stringify(r)),o={type:n,message:r}}if("high"!==i&&"middle"!==i&&"low"!==i&&"std"!==i)throw new Error("Parameter 'urgency' should be set to either 'high', 'middle', 'low' or 'std'");return a.sendChatMessage(e,t,o,null,null,i)}},{key:"sendCorrectedChatMessage",value:function(t,n,r){var i=d.get(this);if(a.rainbowLogger.sdk(e.logService+"[sendCorrectedChatMessage] :: Trying to send a corrected message"),!t)throw new Error("Parameter 'conversation' is missing or null");if(!n)throw new Error("Parameter 'strMessage' is missing or empty");if(n.length>1024)throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");if(!r)throw new Error("Parameter 'messageId' is missing or empty");return i.sendCorrectedChatMessage(t,n,r),t.getMessageById(r)}},{key:"replyToMessage",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=d.get(this),!e){r.next=7;break}if(!t){r.next=6;break}if(!n){r.next=5;break}return r.abrupt("return",(i.sendChatMessage(e,t,null,n),n));case 5:throw new Error("Parameter 'answerMessage' is missing or null");case 6:throw new Error("Parameter 'strMessage' is missing or null");case 7:throw new Error("Parameter 'conversation' is missing or null");case 8:case"end":return r.stop()}}),r,this)})))}},{key:"deleteMessage",value:function(e,t){var n=d.get(this);if(!e)throw new Error("Parameter 'conversation' is missing or null");if(!t)throw new Error("Parameter 'messageId' is missing or empty");return n.sendCorrectedChatMessage(e,"",t),e.getMessageById(t)}},{key:"sendIsTypingStateInConversation",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=d.get(this),e){n.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if("boolean"==typeof t){n.next=5;break}throw new Error("Parameter 'status' is missing or null");case 5:if(e=e.id?r.getConversationById(e.id):null){n.next=7;break}throw new Error("Parameter 'conversation': this conversation doesn't exist");case 7:r.sendIsTypingState(e,t);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"sendMessageToBubble",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=d.get(this),e){n.next=3;break}throw new Error("Parameter 'bubble' is missing or null");case 3:if(t){n.next=5;break}throw new Error("Parameter 'strMessage' is missing or empty");case 5:if(!(t.length>1024)){n.next=7;break}throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");case 7:return n.next=9,r.getRoomConversation(e.jid);case 9:if(i=n.sent){n.next=12;break}throw new Error("No 'conversation' found");case 12:if(n.t0=e.isActive,n.t0){n.next=16;break}return n.next=16,l.default.sendInitialRoomPresenceSync(e);case 16:return a=r.sendChatMessage(i,t),n.abrupt("return",a);case 18:case"end":return n.stop()}}),n,this)})))}},{key:"sendIsTypingStateInBubble",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=d.get(this),e){n.next=3;break}throw new Error("Parameter 'bubble' is missing or null");case 3:if("boolean"==typeof t){n.next=5;break}throw new Error("Parameter 'status' is missing or null");case 5:if(e.jid){n.next=7;break}throw new Error("Parameter 'bubble': this bubble is not a valid one");case 7:return n.next=9,r.getRoomConversation(e.jid);case 9:if(i=n.sent){n.next=12;break}throw new Error("No 'conversation' found for this bubble");case 12:r.sendIsTypingState(i,t);case 13:case"end":return n.stop()}}),n,this)})))}},{key:"removeAllMessagesFromConversation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d.get(this),r=h.get(this),!e){t.next=7;break}if(e.type===r.Type.ONE_TO_ONE||e.type===r.Type.BOT){t.next=4;break}throw new Error("Parameter 'conversation' is not a one-to-one conversation");case 4:return t.next=6,n.removeAllMessages(e);case 6:return t.abrupt("return",{code:s.SDK.OK,label:"OK"});case 7:throw new Error("Parameter 'conversation' is missing or null");case 8:case"end":return t.stop()}}),t,this)})))}},{key:"markMessageFromConversationAsRead",value:function(e,t){var n=d.get(this);if(!t)throw new Error("Parameter 'message' is missing or empty");if(!e)throw new Error("Parameter 'conversation' is missing or null");if(t.receiptStatus===o.Message.ReceiptStatus.READ)throw new Error("Parameter 'message' is aldready marked as read");return n.sendAckReadMessage(e,t),t.receiptStatus===o.Message.ReceiptStatus.READ&&n.decreaseMissedIMCounterForConversation(e),{code:s.SDK.OK,label:"OK"}}}],[{key:"$inject",get:function(){return["$rootScope","conversationService","Conversation"]}}]),e}();f.logService="IMService | ",t.ImService=f},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(39),a=n(5),o=n(4),s=n(0),c=n(9),l=n(22),u=n(28),d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,v=new WeakMap,g=new WeakMap,y=function(){function e(t,n,r,i,a,o,s){var c=this;S(this,e),this.DetectRTC=window.DetectRTC,this.RAINBOW_ONWEBRTCCALLSTATECHANGED="rainbowonwebrtccallstatechanged",this.RAINBOW_ONVOIPCALLSTATECHANGED="rainbowonvoipcallstatechanged",this.RAINBOW_ONWEBRTCMEDIADEVICECHANGED="rainbowonwebrtcmediadevicechanged",this.RAINBOW_ONWEBRTCERRORHANDLED="rainbowonwebrtcerrorhandled",this.RAINBOW_ONWEBRTCSTREAMADDED="rainbowonwebrtcstreamadded",this.RAINBOW_ONWEBRTCTRACKCHANGED="rainbowonwebrtctrackchanged",this.RAINBOW_ONCHROMESTOPSCREENSHARINGTRIGGERED="rainbowonchromestopscreensharingtriggered",this.RAINBOW_ONWEBRTCTMEDIAERROROCCURED="rainbowonwebrtcmediaerroroccured",this.RAINBOW_ONWEBRTCTRECORDSTARTED="rainbowonwebrtcrecordstarted",this.RAINBOW_ONWEBRTCTRECORDSTOPPED="rainbowonwebrtcrecordstopped",this.RAINBOW_ONWEBRTCTRECORDPAUSED="rainbowonwebrtcrecordpaused",this.RAINBOW_ONWEBRTCTRECORDREMOTESTARTED="rainbowonwebrtcrecordremotestarted",this.RAINBOW_ONWEBRTCTRECORDREMOTESTOPPED="rainbowonwebrtcrecordremotestopped",this.RAINBOW_ONWEBRTCTRECORDDONE="rainbowonwebrtcrecorddone",this.RAINBOW_ONWEBRTCTRECORDERROR="rainbowonwebrtcrecorderror",d.set(this,t),h.set(this,n),f.set(this,r),p.set(this,i),m.set(this,a),v.set(this,o),g.set(this,s),t.$on("$destroy",t.$on("ON_CALL_UPDATED_EVENT",(function(e,t){return c.onWebRTCCallChanged(e,t)}))),t.$on("$destroy",t.$on("ON_WEBRTC_CALL_ERROR_EVENT",(function(e,t){return c.onWebRTCErrorHandled(e,t)}))),t.$on("$destroy",t.$on("ON_WEBRTC_REMOTE_STREAM_ADDED",(function(e,t){return c.onWebRTCRemoteStreamAdded(e,t)}))),t.$on("$destroy",t.$on("ON_WEBRTC_CALL_ESCALATION_SUCCESS",(function(e,t){return c.onWebRTCEscalation(e,t)}))),t.$on("$destroy",t.$on("ON_WEBRTC_CALL_ESCALATION",(function(e,t){return c.onWebRTCEscalation(e,t)}))),t.$on("$destroy",t.$on("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED",(function(){return c.onChromeStopScreenSharingTrigerred()}))),t.$on("$destroy",t.$on("ON_WEBRTC_RECORD_SAVED",(function(e,t,n,r){return c.onWebRTCRecordingData(e,t,n,r)}))),t.$on("$destroy",t.$on("ON_WEBRTC_RECORD_ERROR",(function(){return c.onWebRTCRecordingError()}))),t.$on("$destroy",t.$on("ON_RECORDING_START_MSG_RECEIVED",(function(){return c.onWebRTCRecordingStartedByRemote()}))),t.$on("$destroy",t.$on("ON_RECORDING_STOP_MSG_RECEIVED",(function(){return c.onWebRTCRecordingStoppedByRemote()})))}return C(e,[{key:"onWebRTCCallChanged",value:function(e,t){var n=m.get(this),r=h.get(this);t.type.value!==s.Call.Type.WEBRTC.value||n.isMediaPillarCallSituation(t)||(l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCCALLSTATECHANGED,t),"active"===t.status.value&&t.unifiedPlanActivated&&r.attachDistantMediaStreamsUnifiedPlan(t))}},{key:"onWebRTCErrorHandled",value:function(e,t){l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCERRORHANDLED,t)}},{key:"onWebRTCRemoteStreamAdded",value:function(e,t){var n=this;setTimeout((function(){l.eventsService.dispatchEvent(n.RAINBOW_ONWEBRTCSTREAMADDED,t)}),100)}},{key:"onWebRTCEscalation",value:function(e,t){var n=this;setTimeout((function(){l.eventsService.dispatchEvent(n.RAINBOW_ONWEBRTCTRACKCHANGED,t)}),100)}},{key:"onChromeStopScreenSharingTrigerred",value:function(){var e=this;setTimeout((function(){l.eventsService.dispatchEvent(e.RAINBOW_ONCHROMESTOPSCREENSHARINGTRIGGERED,null)}),100)}},{key:"onWebRTCRecordingData",value:function(e,t,n,r){l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDDONE,[t,n,r])}},{key:"onWebRTCRecordingError",value:function(){l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDERROR,null)}},{key:"onWebRTCRecordingStartedByRemote",value:function(){l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDREMOTESTARTED,null)}},{key:"onWebRTCRecordingStoppedByRemote",value:function(){l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDREMOTESTOPPED,null)}},{key:"setUnifiedPlan",value:function(){var e=h.get(this);if(!0===i.sdkConfig.unifiedPlan){if(!e.config)return c.rainbowLogger.sdk("WebRTC Service: Unified plan set to true"),e.config={},e.config.unifiedPlan=!0,!0;c.rainbowLogger.sdk("WebRTC Service: Unified plan set to true"),e.config.unifiedPlan=!0}return!1}},{key:"canMakeAudioVideoCall",value:function(){return("https:"===location.protocol||"chrome-extension:"===location.protocol)&&this.DetectRTC.isWebRTCSupported&&this.DetectRTC.isGetUserMediaSupported}},{key:"hasAMicrophone",value:function(){return this.DetectRTC.hasMicrophone}},{key:"hasACamera",value:function(){return this.DetectRTC.hasWebcam}},{key:"useMicrophone",value:function(e){return e?(a.default.setSetting("microphone",e),a.default.setSetting("headsetMicrophone",e),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'strMicrophoneId' is missing or empty"}}},{key:"useSpeaker",value:function(e){var t=f.get(this);return e?(a.default.setSetting("speaker",e),a.default.setSetting("headsetSpeaker",e),a.default.setSetting("ringingSpeaker",e),t.setSpeakerForElement(document.getElementById("largevideo"),e),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'strSpeakerId' is missing or empty"}}},{key:"useCamera",value:function(e){return e?(a.default.setSetting("camera",e),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'strCameraId' is missing or empty"}}},{key:"callInAudio",value:function(e,t){var n=h.get(this);return e?this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),n.makeCall(e,"audio",t),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'contact' is missing or null"}}},{key:"callInVideo",value:function(e,t){var n=h.get(this);return e?this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),n.makeCall(e,"video",t),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'contact' is missing or null"}}},{key:"callInSharing",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=h.get(this),!e){n.next=15;break}if(!(navigator.userAgent.indexOf("Chrome")>-1)){n.next=14;break}if(i=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),!(parseInt(i[2],10)>72)){n.next=8;break}n.t0=(r.makeDesktopSharingCall(e,"sharingOnly",t),{code:u.SDK.OK,label:"OK"}),n.next=13;break;case 8:return n.next=10,this.canMakeDesktopSharingCall();case 10:this.setUnifiedPlan(),r.makeDesktopSharingCall(e,"sharingOnly",t),n.t0={code:u.SDK.OK,label:"OK"};case 13:return n.abrupt("return",n.t0);case 14:return n.abrupt("return",(this.setUnifiedPlan(),r.makeDesktopSharingCall(e,"sharingOnly",t),{code:u.SDK.OK,label:"OK"}));case 15:throw new Error("Parameter 'contact' is missing or null");case 16:case"end":return n.stop()}}),n,this)})))}},{key:"callinAudioWithSharing",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=h.get(this),i=navigator.userAgent,e){n.next=3;break}return n.abrupt("return",{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'contact' is missing or null"});case 3:if(!(i.indexOf("Chrome")>-1)){n.next=13;break}if(a=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),!(parseInt(a[2],10)>72)){n.next=7;break}return n.abrupt("return",(r.makeDesktopSharingCall(e,t),{code:u.SDK.OK,label:"OK"}));case 7:return n.next=9,this.canMakeDesktopSharingCall();case 9:this.setUnifiedPlan(),r.makeDesktopSharingCall(e,t),n.next=14;break;case 13:this.setUnifiedPlan(),r.makeDesktopSharingCall(e,t);case 14:return n.abrupt("return",{code:u.SDK.OK,label:"OK"});case 15:case"end":return n.stop()}}),n,this)})))}},{key:"answerInAudio",value:function(e){var t=h.get(this);return e?this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),t.answerCall(e,"audio"),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"answerInVideo",value:function(e){var t=h.get(this);return e?this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),t.answerCall(e,"video"),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"getPeerConnectionForCall",value:function(e){return e?e.id?o.default.connection.jingle.sessions[e.id].peerconnection:{code:u.SDK.ERRORBADREQUEST,label:"Can not get the call ID"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"showLocalVideo",value:function(){var e=h.get(this);return this.canMakeAudioVideoCall()?(e.attachLocalMediaStreams(!0),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}},{key:"hideLocalVideo",value:function(){var e=h.get(this);return this.canMakeAudioVideoCall()?(e.attachLocalMediaStreams(!1),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}},{key:"showRemoteVideo",value:function(e){var t=h.get(this);return e?this.canMakeAudioVideoCall()?(t.attachDistantMediaStreams(!0,e),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"hideRemoteVideo",value:function(e){var t=h.get(this);return e?this.canMakeAudioVideoCall()?(t.attachDistantMediaStreams(!1,e),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"addVideoToCall",value:function(e){var t=h.get(this);return this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),t.addVideoToCall(e,!1),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}},{key:"addSharingToCall",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=h.get(this),r=navigator.userAgent,e){t.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:if(r.indexOf("Chrome")>-1){t.next=5;break}return t.abrupt("return",(this.setUnifiedPlan(),n.addSharingToCall(e),{code:u.SDK.OK,label:"OK"}));case 5:return i=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),parseInt(i[2],10)>72&&n.addSharingToCall(e),t.next=9,this.canMakeDesktopSharingCall();case 9:return this.setUnifiedPlan(),n.addSharingToCall(e),t.abrupt("return",{code:u.SDK.OK,label:"OK"});case 12:case"end":return t.stop()}}),t,this)})))}},{key:"removeVideoFromCall",value:function(e){var t=h.get(this);return this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),t.removeVideoFromCall(e),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}},{key:"removeSharingFromCall",value:function(e){var t=h.get(this);return this.setUnifiedPlan(),t.removeSharingFromCall(e),{code:u.SDK.OK,label:"OK"}}},{key:"release",value:function(t){var n=h.get(this);return t?(this.canMakeAudioVideoCall()||c.rainbowLogger.sdk(e.logService+"release called but WebRTC is not supported by your browser"),n.rejectCall(t),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"muteAudioCall",value:function(e){var t=h.get(this);return e?this.canMakeAudioVideoCall()?(t.muteAudio(e,!0),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'conversation' is missing or null"}}},{key:"unmuteAudioCall",value:function(e){var t=h.get(this);return e?this.canMakeAudioVideoCall()?(t.muteAudio(e,!1),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'conversation' is missing or null"}}},{key:"getLocalStreamsFromCall",value:function(e){if(!e||!("id"in e))return{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or empty"};if(e.type!==s.Call.Type.WEBRTC)return{code:u.SDK.ERRORNOTFOUND,label:"This call is not an audio or audio/video call"};var t=o.default.connection.jingle.sessions[e.id];return t?t.localStreams:[]}},{key:"getRemoteStreamsFromCall",value:function(e){if(!e||!("id"in e))return{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or empty"};if(e.type!==s.Call.Type.WEBRTC)return{code:u.SDK.ERRORNOTFOUND,label:"This call is not an audio or audio/video call"};var t=o.default.connection.jingle.sessions[e.id];return t?t.remoteStreamsObject:[]}},{key:"setChromeExtensionIdForSharing",value:function(e){var t=p.get(this);return e?(t.setExtensionId(e),t.start(),{code:u.SDK.OK,label:"OK"}):{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'strExtensionId' is missing or empty"}}},{key:"canMakeDesktopSharingCall",value:function(){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=p.get(this),!((r=navigator.userAgent).indexOf("Firefox")>-1)){t.next=3;break}return t.abrupt("return",{code:u.SDK.OK,label:"OK"});case 3:if(r.indexOf("Chrome")>-1){t.next=9;break}return t.next=6,n.isExtensionInstalled();case 6:if(!t.sent){t.next=8;break}return t.abrupt("return",(e.isChromeExtensionInstalled=!0,{code:u.SDK.OK,label:"OK"}));case 8:throw e.isChromeExtensionInstalled=!1,new Error("Not Chrome Extension installed for desktop sharing");case 9:if(i=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),!(parseInt(i[2],10)>72)){t.next=12;break}return t.abrupt("return",{code:u.SDK.OK,label:"OK"});case 12:case"end":return t.stop()}}),t,this)})))}},{key:"startRecording",value:function(t,n,r,i,a,o){var s=this,d=v.get(this),h=g.get(this);if(c.rainbowLogger.sdk(e.logService+"[startRecording] :: Enter"),!t)return{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"};if(!n)return{code:u.SDK.ERRORBADREQUEST,label:"Parameter 'fileName' is missing or null"};if(r=null==r||r,i=null==i||i,a=null!=a&&a,o=null==o?"video/webm;codecs=vp9":o,c.rainbowLogger.sdk(e.logService+"[startRecording] :: Prepare recording..."),d.createRecord(t.id,null,r?"REMOTE":"LOCAL",i,n,a,o)){d.setOnPauseCallback((function(){c.rainbowLogger.sdk(e.logService+"[onRTCChange] :: WebRTC recording paused"),l.eventsService.dispatchEvent(s.RAINBOW_ONWEBRTCTRECORDPAUSED,null)})),c.rainbowLogger.sdk(e.logService+"[startRecording] :: Start recording"),d.startRecording();var f=h.getConversationById(t.conversationId);return f?(c.rainbowLogger.sdk(e.logService+"[startRecording] :: Notify remote peer"),h.sendRecordingMessage(f,"start")):c.rainbowLogger.sdk(e.logService+"[startRecording] :: No conversation found - can't notify remote peer"),c.rainbowLogger.sdk(e.logService+"[startRecording] :: WebRTC recording started"),l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDSTARTED,null),{code:u.SDK.OK,label:"OK"}}return c.rainbowLogger.sdk(e.logService+"[startRecording] :: can't start a webRTC recording"),l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDERROR,null),{code:u.SDK.ERRORBADREQUEST,label:"Can't record the conversation"}}},{key:"stopRecording",value:function(t){var n=v.get(this),r=g.get(this);c.rainbowLogger.sdk(e.logService+"[stopRecording] :: Stop current WebRTC recording"),n.setOnPauseCallback(null),n.stopRecording();var i=r.getConversationById(t.conversationId);return i?(c.rainbowLogger.sdk(e.logService+"[stopRecording] :: Notify remote peer"),r.sendRecordingMessage(i,"stop")):c.rainbowLogger.sdk(e.logService+"[stopRecording] :: No conversation found - can't notify remote peer"),l.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDSTOPPED,null),{code:u.SDK.OK,label:"OK"}}}],[{key:"$inject",get:function(){return["$rootScope","videoService","platformService","extensionSharingService","webrtcGatewayService","recordsService","conversationService"]}}]),e}();y.logService="WebRTCService | ",y.isChromeExtensionInstalled=!1,t.WebRTCService=y},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=n(226),s=n(49),c=n(1),l=n(33),u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=function(){function e(t,n,r,i,a){var o=this;S(this,e),this.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED="rainbowbubblerequesttojoin",this.RAINBOW_ONBUBBLEUPDATED="rainbowbubbleupdated",this.RAINBOW_ONBUBBLEAVATARUPDATED="rainbowbubbleavatarupdated",this.RAINBOW_ONBUBBLEDEACTIVATED="rainbowonbubbledeactivated",u.set(this,t),d.set(this,n),h.set(this,r),f.set(this,i),p.set(this,a),a.$on("$destroy",a.$on(l.default.ROOM_UPDATE_EVENT,(function(e,t){return o.onBubbleUpdatedEvent(e,t)}))),a.$on("$destroy",a.$on(l.default.ROOM_AVATAR_UPDATE_EVENT,(function(){return o.onAvatarUpdatedEvent()}))),a.$on("$destroy",a.$on("ROOM_INVITATION",(function(e,t){return o.onRoomInvitationEvent(e,t)})))}return C(e,[{key:"onBubbleUpdatedEvent",value:function(e,t){t&&!1===t.isActive?a.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEDEACTIVATED,t):a.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEUPDATED,t)}},{key:"onAvatarUpdatedEvent",value:function(){a.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEAVATARUPDATED,null)}},{key:"onRoomInvitationEvent",value:function(e,t){a.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED,t)}},{key:"createBubble",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return r(this,void 0,void 0,b.a.mark((function r(){var u,h,f,p,m,v,g;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=d.get(this),h=null,f=n||"",p=Boolean(a),m=Boolean(o),v=Boolean(c),t){r.next=5;break}throw new Error("Parameter 'strName' is missing or empty");case 5:return r.next=7,l.default.createRoom(t,f,p,s,m,!1,!1,v);case 7:return h=r.sent,r.next=10,u.getRoomConversation(h.jid);case 10:return g=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[createBubble] :: New bubble "+t+" created successfully"),l.default.sendInitialRoomPresence(g.room),h));case 12:case"end":return r.stop()}}),r,this)})))}},{key:"deleteBubble",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e&&e.dbId?l.default.getRoomById(e.dbId):null){t.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return t.next=4,this.closeBubble(e);case 4:return n=t.sent,t.abrupt("return",l.default.ownerDeleteRoom(n));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"deleteAllBubbles",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s.PromiseQueue.create(),l.default.getMyRooms().forEach((function(e){t.add((function(){return n.deleteBubble(e)}))}));case 2:case"end":return e.stop()}}),e)})))}},{key:"inviteContactToBubble",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return r(this,void 0,void 0,b.a.mark((function r(){var a,s,c,u,d,h,f,p,m,v;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){r.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(t){r.next=4;break}throw new Error("Parameter 'bubble' is missing or null");case 4:if(a=o.Room.Privilege.USER,n&&(a=o.Room.Privilege.MODERATOR),s=!1,"boolean"==typeof i&&(s=!i),c=!1,u=!1,d=!1,h=!1,f=!1,t.users.forEach((function(t){if(t.contact.id===e.id)switch(t.status){case"invited":d=!0;break;case"accepted":c=!0;break;case"unsubscribed":u=!0;break;case"rejected":h=!0;break;case"deleted":f=!0}})),!c&&!d){r.next=11;break}throw new Error("Contact has been already invited or is already a member of the room");case 11:if(!u&&!h){r.next=16;break}return r.next=14,l.default.ownerReinviteRejectedUser(t,e,null,a,s);case 14:return p=r.sent,r.abrupt("return",(p.updateAvatarInfo(),p));case 16:if(!f){r.next=21;break}return r.next=19,l.default.ownerReinviteDeletedUser(t,e,null,a);case 19:return m=r.sent,r.abrupt("return",(m.updateAvatarInfo(),m));case 21:return r.next=23,l.default.addRoomUser(t,e,null,a,s);case 23:return v=r.sent,r.abrupt("return",(v.updateAvatarInfo(),v));case 25:case"end":return r.stop()}}),r)})))}},{key:"removeContactFromBubble",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){n.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(t){n.next=4;break}throw new Error("Parameter 'bubble' is missing or is null");case 4:r="",n.t0=(t.users.forEach((function(t){t.contact.id===e.id&&(r=t.status)})),r),n.next=n.t0===l.default.RoomUserStatus.INVITED?8:n.t0===l.default.RoomUserStatus.ACCEPTED?12:16;break;case 8:return n.next=10,l.default.ownerDeletesUserFromRoom(t,e);case 10:return i=n.sent,n.abrupt("return",(i.updateAvatarInfo(),i));case 12:return n.next=14,l.default.unsubscribeUserFromRoom(t,e);case 14:return a=n.sent,n.abrupt("return",(a.updateAvatarInfo(),a));case 16:return n.abrupt("return",t);case 17:case"end":return n.stop()}}),n)})))}},{key:"promoteContactToModerator",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){n.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(t){n.next=4;break}throw new Error("Parameter 'bubble' is missing or is null");case 4:return n.next=6,l.default.updateRoomUser(t,e,null,"moderator");case 6:return r=n.sent,n.abrupt("return",(r.updateAvatarInfo(),r));case 8:case"end":return n.stop()}}),n)})))}},{key:"demoteContactFromModerator",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){n.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(t){n.next=4;break}throw new Error("Parameter 'bubble' is missing or is null");case 4:return n.next=6,l.default.updateRoomUser(t,e,null,"user");case 6:return r=n.sent,n.abrupt("return",(r.updateAvatarInfo(),r));case 8:case"end":return n.stop()}}),n)})))}},{key:"changeOwner",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){n.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(t){n.next=4;break}throw new Error("Parameter 'bubble' is missing or is null");case 4:return n.next=6,l.default.changeRoomOwner(t,e);case 6:return r=n.sent,n.abrupt("return",(r.updateAvatarInfo(),r));case 8:case"end":return n.stop()}}),n)})))}},{key:"acceptInvitationToJoinBubble",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e&&e.dbId?l.default.getRoomById(e.dbId):null){t.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return t.next=4,l.default.acceptRoomInvitation(e);case 4:return t.abrupt("return",e);case 5:case"end":return t.stop()}}),t)})))}},{key:"declineInvitationToJoinBubble",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e&&e.dbId?l.default.getRoomById(e.dbId):null){t.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return t.next=4,l.default.declineRoomInvitation(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))}},{key:"leaveBubble",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e&&e.dbId?l.default.getRoomById(e.dbId):null){t.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:if(n=!1,e.users.forEach((function(e){c.default.isUserContact(e)||"moderator"===e.privilege&&"accepted"===e.status&&(n=!0)})),n){t.next=5;break}throw new Error("Can't leave the bubble. No other moderator");case 5:t.t0=e.status,t.next=t.t0===l.default.RoomUserStatus.UNSUBSCRIBED?8:11;break;case 8:return t.next=10,l.default.participantCloseRoom(e);case 10:return t.abrupt("return",t.sent);case 11:return t.next=13,l.default.unsubscribeMeFromRoom(e);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t)})))}},{key:"closeBubble",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e&&e.dbId?l.default.getRoomById(e.dbId):null){t.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:if(t.t0=this.isBubbleArchived(e),t.t0){t.next=6;break}return t.next=6,l.default.ownerArchiveRoom(e);case 6:return t.abrupt("return",e);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"isBubbleArchived",value:function(e){var t=!0;return(e=e&&e.dbId?l.default.getRoomById(e.dbId):null)?e.status!==l.default.RoomUserStatus.UNSUBSCRIBED?t=!1:e.users.forEach((function(e){e.status!==l.default.RoomUserStatus.UNSUBSCRIBED&&e.status!==l.default.RoomUserStatus.DELETED&&(t=!1)})):t=!1,t}},{key:"getAllBubbles",value:function(){return l.default.getRooms()}},{key:"getAllOwnedBubbles",value:function(){return l.default.getMyRooms()}},{key:"getAllPendingBubbles",value:function(){return l.default.getRooms().filter((function(e){return"invited"===e.status}))}},{key:"getAllInactiveBubbles",value:function(){return l.default.getRooms().filter((function(e){return!1===e.isActive}))}},{key:"getBubbleById",value:function(e){if(!e)throw new Error("Parameter 'strBubbleId' is missing or empty");return l.default.getRoomById(e)}},{key:"updateNameForBubble",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){n.next=2;break}throw new Error("Parameter 'strName' is missing or empty");case 2:if(t){n.next=4;break}throw new Error("Parameter 'bubble' is missing or empty");case 4:return t.name=e,n.next=7,l.default.ownerUpdateRoom(t);case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n)})))}},{key:"updateDescriptionForBubble",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){n.next=2;break}throw new Error("Parameter 'strDescription' is missing or empty");case 2:if(t){n.next=4;break}throw new Error("Parameter 'bubble' is missing or empty");case 4:return t.desc=e,n.next=7,l.default.ownerUpdateRoom(t);case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n)})))}},{key:"updateAvatarForBubble",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){n.next=2;break}throw new Error("Parameter 'urlAvatar' is missing or empty");case 2:if(t){n.next=4;break}throw new Error("Parameter 'bubble' is missing or empty");case 4:return t.id=t.dbId,n.next=7,l.default.setAvatarRoom(t,e);case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n)})))}},{key:"deleteAvatarFromBubble",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e&&e.dbId?l.default.getRoomById(e.dbId):null){t.next=2;break}throw new Error("Parameter 'bubble' is missing or empty");case 2:return t.next=4,l.default.deleteAvatarRoom(e.dbId);case 4:case"end":return t.stop()}}),t)})))}},{key:"updateCustomDataForBubble",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t&&t.dbId?l.default.getRoomById(t.dbId):null,e){n.next=2;break}throw new Error("Parameter 'customData' is missing or empty");case 2:if(t){n.next=4;break}throw new Error("Parameter 'bubble' is missing or empty");case 4:return t.customData=e,r=l.default.ownerUpdateRoomCustomData(t),n.abrupt("return",(t.customData=r,t));case 7:case"end":return n.stop()}}),n)})))}},{key:"deleteCustomDataForBubble",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=e&&e.dbId?l.default.getRoomById(e.dbId):null){t.next=2;break}throw new Error("Parameter 'bubble' is missing or empty");case 2:return e.customData={},t.next=5,l.default.ownerUpdateRoomCustomData(e);case 5:return n=t.sent,t.abrupt("return",(e.customData=n,e));case 7:case"end":return t.stop()}}),t)})))}},{key:"getBubbleFromServer",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&e.dbId){t.next=2;break}throw new Error("Parameter 'bubble' missing or not correct");case 2:return t.next=4,l.default.getServerRoom(e.dbId);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))}}],[{key:"$inject",get:function(){return["videoService","conversationService","conferenceService","webConferenceService","$rootScope"]}}]),e}();m.logService="BubblesService | ",t.BubblesService=m},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),a=n(22),o=n(1),s=n(6),c=n(33),l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap;t.ConferencesService=function(){function e(t,n,r,i,a){var o=this;S(this,e),this.confBubble=null,this.confBubbleType="",this.RAINBOW_ONWEBCONFERENCEUPDATED="rainbowwebconferenceupdated",this.RAINBOW_ONWEBRTCMEDIAERROROCCURED="rainbowwebrtcmediaerroroccured",this.RAINBOW_ONBUBBLESHARINGCONFERENCESTARTED="rainbowbubblesharingconferencestarted",this.RAINBOW_ONBUBBLECONFERENCESTARTED="rainbowbubbleconferencestarted",this.RAINBOW_ONBUBBLECONFERENCETALKERACTIVE="rainbowonwebconferencetalkeractive",this.RAINBOW_ONWEBCONFERENCEDELEGATED="rainbowonwebconferencedelegated",l.set(this,t),u.set(this,n),d.set(this,r),h.set(this,i),f.set(this,a),a.$on("$destroy",a.$on("ON_CONFERENCE_UPDATED_EVENT",(function(e,t){return o.onConferenceUpdated(e,t)}))),a.$on("$destroy",a.$on("ON_WEBRTC_GETUSERMEDIA_ERROR",(function(e,t){return o.onWebRtcGetUserMediaError(e,t)}))),a.$on("$destroy",a.$on("ON_CONFERENCE_PARTICIPANT_EVENT",(function(e,t){return o.onConferenceParticipantEvent(e,t)}))),a.$on("$destroy",a.$on("ON_CONFERENCE_STARTED_INVITATION",(function(e,t){return o.onConferenceStartedInvitation(e,t)}))),a.$on("$destroy",a.$on("ON_CONFERENCE_TALKER_EVENT",(function(e,t){return o.onConferenceTalkerEvent(e,t)}))),a.$on("$destroy",a.$on("ON_CONFERENCE_DELEGATED_EVENT",(function(e,t,n){return o.onWebConferenceDelegated(e,t,n)})))}return C(e,[{key:"onConferenceUpdated",value:function(e,t){t&&a.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEUPDATED,t)}},{key:"onWebRtcGetUserMediaError",value:function(e,t){a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCMEDIAERROROCCURED,t)}},{key:"onConferenceParticipantEvent",value:function(e,t){a.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEUPDATED,t)}},{key:"onConferenceStartedInvitation",value:function(e,t){var n=this,r=t.confEndpoints;r&&r.forEach((function(e){"webrtc"===e.mediaType&&a.eventsService.dispatchEvent(n.RAINBOW_ONBUBBLECONFERENCESTARTED,t),"webrtcSharingOnly"===e.mediaType&&a.eventsService.dispatchEvent(n.RAINBOW_ONBUBBLESHARINGCONFERENCESTARTED,t)}))}},{key:"onConferenceTalkerEvent",value:function(e,t){t&&a.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLECONFERENCETALKERACTIVE,t)}},{key:"onWebConferenceDelegated",value:function(e,t,n){var r={oldConferenceId:t,newConferenceId:n};a.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEDELEGATED,r)}},{key:"isWebConferenceAllowed",value:function(){return s.default.isFeatureEnabled(s.default.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED)}},{key:"hasActiveWebConferenceSession",value:function(){return h.get(this).hasActiveConferenceSession()}},{key:"getWebConferenceBubble",value:function(){return h.get(this).getRelatedRoomToActiveConferenceSession()}},{key:"setActiveSpeakerValue",value:function(e){return h.get(this).setActiveSpeakerValue(e),e}},{key:"startOrJoinWebConference",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=h.get(this),e=e&&e.dbId?c.default.getRoomById(e.dbId):null){t.next=3;break}throw new Error("Parameter 'bubble' is missing or empty");case 3:if(!this.hasActiveWebConferenceSession()){t.next=5;break}throw new Error("Already in a conference");case 5:if(t.t0=e.confEndpoints.length,!t.t0){t.next=9;break}return t.next=9,n.makeSnapshotForConfId(e.confEndpoints[0].confEndpointId,"webrtc",!0);case 9:return t.next=11,n.bubbleStartOrJoinWebConference(e);case 11:return this.confBubble=e,this.confBubbleType="webrtc",t.abrupt("return",c.default.getRoomById(e.dbId));case 14:case"end":return t.stop()}}),t,this)})))}},{key:"stopWebConference",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.get(this),n=d.get(this),this.confBubble=this.confBubble&&this.confBubble.dbId?c.default.getRoomById(this.confBubble.dbId):null,this.hasActiveWebConferenceSession()&&this.confBubble){e.next=3;break}throw new Error("No known conference in a Bubble");case 3:if(r="",r="webrtc"===this.confBubbleType?this.confBubble.getSFUConfEndpointId():this.confBubble.getSFUSharingConfEndpointId(),i=t.getConferenceSessionById(r),"moderator"===(a=i?i.getParticipantByJid(o.default.userContact.jid):null).role){e.next=11;break}return e.next=9,n.disconnectsParticipant(r,a.participantId,this.confBubbleType);case 9:return this.confBubble=null,e.abrupt("return",void(this.confBubbleType=null));case 11:return e.next=13,n.stopConference(r,"webrtc",this.confBubble.dbId);case 13:this.confBubble=null,this.confBubbleType=null;case 15:case"end":return e.stop()}}),e,this)})))}},{key:"muteConferenceAudio",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d.get(this),r=e.getConnectedParticipantByJid(o.default.userContact.jid).participantId,e){t.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(r){t.next=5;break}throw new Error("Couldn't retrieve participant ID - make sure the conference is active and you are connected");case 5:return t.next=7,n.updateParticipantState(e.id,r,"mute","webrtc");case 7:case"end":return t.stop()}}),t,this)})))}},{key:"unmuteConferenceAudio",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d.get(this),r=e.getConnectedParticipantByJid(o.default.userContact.jid).participantId,e){t.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(r){t.next=5;break}throw new Error("Couldn't retrieve participant ID - make sure the conference is active and you are connected");case 5:return t.next=7,n.updateParticipantState(e.id,r,"unmute","webrtc");case 7:case"end":return t.stop()}}),t,this)})))}},{key:"muteConferenceParticipant",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=d.get(this),e){n.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(t){n.next=5;break}throw new Error("Parameter 'participantId' is missing or empty");case 5:return n.next=7,r.updateParticipantState(e.id,t,"mute","webrtc");case 7:case"end":return n.stop()}}),n,this)})))}},{key:"unmuteConferenceParticipant",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=d.get(this),e){n.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(t){n.next=5;break}throw new Error("Parameter 'participantId' is missing or empty");case 5:return n.next=7,r.updateParticipantState(e.id,t,"unmute","webrtc");case 7:case"end":return n.stop()}}),n,this)})))}},{key:"muteAllConferenceParticipants",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d.get(this),e){t.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:r=e.participants,i=0;case 5:if(!(i<r.length)){t.next=13;break}if(t.t0="moderator"!==r[i].role,!t.t0){t.next=10;break}return t.next=10,n.updateParticipantState(e.id,r[i].participantId,"mute","webrtc");case 10:i++,t.next=5;break;case 13:case"end":return t.stop()}}),t,this)})))}},{key:"unmuteAllConferenceParticipants",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d.get(this),e){t.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:r=e.participants,i=0;case 5:if(!(i<r.length)){t.next=13;break}if(t.t0="moderator"!==r[i].role,!t.t0){t.next=10;break}return t.next=10,n.updateParticipantState(e.id,r[i].participantId,"unmute","webrtc");case 10:i++,t.next=5;break;case 13:case"end":return t.stop()}}),t,this)})))}},{key:"addVideoToConference",value:function(e){var t=h.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.addMediaToConferenceSession(e,"video")}},{key:"addSharingToConference",value:function(e){var t=h.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.addMediaToConferenceSession(e,"sharing")}},{key:"removeVideoFromConference",value:function(e){var t=h.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.removeMediaFromConferenceSession(e,"video"),e}},{key:"removeSharingFromConference",value:function(e){var t=h.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.removeMediaFromConferenceSession(e,"sharing"),e}},{key:"showLocalVideo",value:function(e){var t=h.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.attachLocalMediaStream(!0,e),t.isActiveSpeakerEnabled(),e}},{key:"showRemoteVideo",value:function(e){var t=h.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.isActiveSpeakerEnabled()?t.attachGalleryMediaStreams(e):t.attachDistantMediaStream(!0,e),e}},{key:"getConferenceSessionById",value:function(e){var t=h.get(this);if(!e)throw new Error("Parameter 'conferenceId' is missing or empty");return t.getConferenceSessionById(e)}},{key:"updateGalleryPublisher",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=h.get(this),e){r.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(t){r.next=5;break}throw new Error("Parameter 'galleryElementId' is missing or empty");case 5:if(n){r.next=7;break}throw new Error("Parameter 'newPublisher' is missing or empty");case 7:if(i.getRelatedPublisherToElement(e.id,t))for(a=0;a<e.videoGallery.length;a++)e.videoGallery[a].id===t&&(e.videoGallery[a].sessionId?i.dropRemoteVideoSession(e,e.videoGallery[a].sessionId):i.reInitialiseVideoGalleryElementById(e,t));return r.next=10,i.subscribeToPublisher(e.id,n,t);case 10:case"end":return r.stop()}}),r,this)})))}},{key:"removeGalleryPublisher",value:function(e,t){var n=h.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");if(!t)throw new Error("Parameter 'galleryElementId' is missing or empty");return n.dropRemoteVideoSession(e,t),{code:i.SDK.OK,label:"Publisher from ".concat(t," successfully removed")}}},{key:"setVideoGalleryElementsNumber",value:function(e){return h.get(this).setVideoGalleryElementsNumber(e),e}},{key:"removePipVideo",value:function(){return l.get(this).removeConferencePip()}},{key:"updateMainVideoSession",value:function(e,t){var n=h.get(this);if(e){if(t){n.updateMainScreenSession(e,t);var r=n.getConferenceSessionById(e);return n.attachDistantMediaStream(!0,r),n.getConferenceSessionById(e)}throw new Error("Parameter 'sessionId' is missing or empty")}throw new Error("Parameter 'conferenceId' is missing or empty")}},{key:"disconnectParticipant",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"webrtc";return r(this,void 0,void 0,b.a.mark((function r(){var i;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=d.get(this),e){r.next=3;break}throw new Error("Parameter 'conferenceId' is missing or empty");case 3:if(t){r.next=5;break}throw new Error("Parameter 'participantId' is missing or empty");case 5:return r.next=7,i.disconnectsParticipant(e,t,n);case 7:case"end":return r.stop()}}),r,this)})))}},{key:"getListOfAvailableRemoteVideoPublishers",value:function(e){var t=h.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");var n={all:[],notActive:[]};return n.all=e.getListOfRemoteVideoPublishers(),n.notActive=t.getListOfAvailableRemoteVideoPublishers(e.id),n}},{key:"delegateConferenceToParticipant",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=h.get(this),e){n.next=3;break}throw new Error("Parameter 'conferenceId' is missing or empty");case 3:if(t){n.next=5;break}throw new Error("Parameter 'participantId' is missing or empty");case 5:return n.next=7,r.delegateConferenceToParticipant(e,t);case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n,this)})))}}],[{key:"$inject",get:function(){return["videoService","conversationService","conferenceService","webConferenceService","$rootScope"]}}]),e}()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=n(44),s=n(28),c=new WeakMap,l=new WeakMap,u=function(){function e(t,n){var r=this;S(this,e),this.RAINBOW_ONGROUPCREATED="rainbowgroupcreated",this.RAINBOW_ONGROUPUPDATED="rainbowgroupupdated",this.RAINBOW_ONGROUPDELETED="rainbowgroupdeleted",this.RAINBOW_ONGROUPUSERADDED="rainbowgroupuseradded",this.RAINBOW_ONGROUPUSERREMOVED="rainbowgroupuserdeleted",l.set(this,t),c.set(this,n),n.$on("$destroy",n.$on(t.ON_UPDATE_GROUP_EVENT,(function(e,t){return r.onGroupUpdated(e,t)}))),n.$on("$destroy",n.$on(t.ON_CREATED_GROUP_EVENT,(function(e,t){return r.onGroupCreated(e,t)}))),n.$on("$destroy",n.$on(t.ON_REMOVED_GROUP_EVENT,(function(e,t){return r.onGroupDeleted(e,t)}))),n.$on("$destroy",n.$on(t.ON_ADD_GROUP_USER_EVENT,(function(e,t,n){return r.onGroupUserAdded(e,t,n)}))),n.$on("$destroy",n.$on(t.ON_REMOVE_GROUP_USER_EVENT,(function(e,t,n){return r.onGroupUserRemoved(e,t,n)})))}return C(e,[{key:"onGroupUpdated",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function e(){var n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.get(this),e.next=3,n.getGroup(t);case 3:r=e.sent,a.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUPDATED,r);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"onGroupCreated",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function e(){var n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.get(this),e.next=3,n.getGroup(t);case 3:r=e.sent,a.eventsService.dispatchEvent(this.RAINBOW_ONGROUPCREATED,r);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"onGroupDeleted",value:function(e,t){a.eventsService.dispatchEvent(this.RAINBOW_ONGROUPDELETED,t)}},{key:"onGroupUserAdded",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function e(){var r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.get(this),e.next=3,r.getGroup(t);case 3:i=e.sent,a.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUSERADDED,{group:i,userId:n});case 5:case"end":return e.stop()}}),e,this)})))}},{key:"onGroupUserRemoved",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function e(){var r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.get(this),e.next=3,r.getGroup(t);case 3:i=e.sent,a.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUSERREMOVED,{group:i,userId:n});case 5:case"end":return e.stop()}}),e,this)})))}},{key:"createGroup",value:function(t,n,a){return r(this,void 0,void 0,b.a.mark((function r(){var s,c,u,d,h;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=l.get(this),c=null,u=n||"",d=!1,"boolean"==typeof a&&(d=a),t){r.next=6;break}throw new Error("Parameter 'strName' is missing or empty");case 6:return c=new o.Group(null,t,u,d),r.next=9,s.addGroup(c);case 9:return h=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[createGroup] :: New group created successfully"),h));case 11:case"end":return r.stop()}}),r,this)})))}},{key:"deleteGroup",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),t){n.next=3;break}throw new Error("Parameter 'group' is missing or empty");case 3:return n.next=5,r.removeGroup(t.id);case 5:return i.rainbowLogger.sdk(e.logService+"[deleteGroup] :: Group deleted successfully"),n.abrupt("return",{code:s.SDK.OK,label:"OK"});case 7:case"end":return n.stop()}}),n,this)})))}},{key:"deleteAllGroups",value:function(){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=l.get(this),r=[],n.getGroupsAsArray().forEach((function(e){r.push(function(e){return n.removeGroup(e.id)}(e))})),t.next=4,Promise.all(r);case 4:return i.rainbowLogger.sdk(e.logService+"[deleteAllGroups] :: All groups deleted successfully"),t.abrupt("return",{code:s.SDK.OK,label:"OK"});case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getAll",value:function(){return l.get(this).getGroupsAsArray()}},{key:"getFavoritesGroups",value:function(){return l.get(this).getGroupsAsArray().filter((function(e){return e.isFavorite}))}},{key:"setGroupAsFavorite",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=l.get(this),e.isFavorite=!0,t.next=4,n.updateGroup(e);case 4:return t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"unsetGroupAsFavorite",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=l.get(this),e.isFavorite=!1,t.next=4,n.updateGroup(e);case 4:return t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getGroupById",value:function(e){var t=l.get(this),n=null;return t.getGroupsAsArray().some((function(t){return e===t.id&&(n=t,!0)})),n}},{key:"getDetailedGroupById",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=l.get(this),e){t.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return t.next=5,n.getGroup(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"addContactInGroup",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),t){r.next=3;break}throw new Error("Parameter 'contact' is missing or null");case 3:if(n){r.next=5;break}throw new Error("Parameter 'group' is missing or null");case 5:return r.next=7,a.addGroupUser(n,t);case 7:return o=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[addContactInGroup] :: Contact added successfully"),o));case 9:case"end":return r.stop()}}),r,this)})))}},{key:"removeContactFromGroup",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),e){n.next=3;break}throw new Error("Parameter 'contact' is missing or null");case 3:if(t){n.next=5;break}throw new Error("Parameter 'group' is missing or null");case 5:return n.abrupt("return",r.removeGroupUser(t.id,e));case 6:case"end":return n.stop()}}),n,this)})))}}],[{key:"$inject",get:function(){return["groupService","$rootScope"]}}]),e}();u.logService="GroupService  | ",t.GroupsService=u},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),a=new WeakMap,o=new WeakMap;t.CallsLogService=function(){function e(t,n){var r=this;S(this,e),this.RAINBOW_ONCALLLOGUPDATED="rainbowcalllogupdated",this.RAINBOW_ONCALLLOGACKUPDATED="rainbowcalllogackupdated",this.initialized=!1,a.set(this,t),o.set(this,n),t.$on("$destroy",t.$on("ON_CALL_LOG_UPDATED",(function(){return r.onCallLogUpdated()}))),t.$on("$destroy",t.$on("ON_CALL_LOG_ACK_UPDATED",(function(e,t){return r.onCallLogAckUpdated(e,t)})))}return C(e,[{key:"onCallLogUpdated",value:function(){i.eventsService.dispatchEvent(this.RAINBOW_ONCALLLOGUPDATED,null)}},{key:"onCallLogAckUpdated",value:function(e,t){i.eventsService.dispatchEvent(this.RAINBOW_ONCALLLOGACKUPDATED,t)}},{key:"getAll",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,s,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.get(this),e.next=3,t.getSimplifiedCallLogs();case 3:for(n=e.sent,r=0;r<n.length;r++)if(i=0,(a=n[r].duration)&&"string"==typeof a&&a.match(/^(?:(?:([01]?\d|2[0-3])h )?([0-5]?\d)m )?([0-5]?\ds)$/)){for(a=a.replace(/[hms]/g,""),s=a.split(" ").reverse(),c=0;c<s.length;c++)i+=s[c]*Math.pow(60,c);n[r].duration=1e3*i}return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"getMissedCallLogCounter",value:function(){return o.get(this).getMissedCallLogCounter()}},{key:"getMissedCallLogNumber",value:function(){return o.get(this).getNumberMissedCallLogs()}},{key:"deleteOneCallLog",value:function(e){return o.get(this).deleteOneCallLog(e),!0}},{key:"deleteCallLogsForContact",value:function(e){return o.get(this).deleteCallLogsForContact(e)}},{key:"deleteAllCallLogs",value:function(){return o.get(this).deleteAllCallLogs()}},{key:"markCallLogAsRead",value:function(e){return o.get(this).markCallLogAsRead(e)}},{key:"markAllCallsLogsAsRead",value:function(){return o.get(this).markAllCallsLogsAsRead()}},{key:"isInitialized",value:function(){return this.initialized}}],[{key:"$inject",get:function(){return["$rootScope","callLogService"]}}]),e}()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=new WeakMap,s=function(){function e(t){var n=this;S(this,e),this.RAINBOW_ONFAVORITECREATED="rainbowonfavoritecreated",this.RAINBOW_ONFAVORITEDELETED="rainbowonfavoritedeleted",o.set(this,t),window.addEventListener("ON_FAVORITE_CREATED",(function(e){return n.onFavoriteCreated(e)})),window.addEventListener("ON_FAVORITE_DELETED",(function(e){return n.onFavoriteDeleted(e)}))}return C(e,[{key:"onFavoriteCreated",value:function(e){a.eventsService.dispatchEvent(this.RAINBOW_ONFAVORITECREATED,e.detail)}},{key:"onFavoriteDeleted",value:function(e){a.eventsService.dispatchEvent(this.RAINBOW_ONFAVORITEDELETED,e.detail)}},{key:"fetchAllFavorites",value:function(){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.get(this),t.next=3,n.getServerFavorites();case 3:return r=t.sent,t.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[fetchAllFavorites] :: Successfully fetched the Favorites"),r));case 5:case"end":return t.stop()}}),t,this)})))}},{key:"createFavorite",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=o.get(this),t){r.next=3;break}throw i.rainbowLogger.sdk(e.logService+"[createFavorite] :: Error: parameter 'id' is missing or null"),new Error(e.logService+"[createFavorite] :: Error: parameter 'id' is missing or null");case 3:if(n){r.next=5;break}throw i.rainbowLogger.sdk(e.logService+"[createFavorite] :: Error: parameter 'favoriteType' is missing or null"),new Error(e.logService+"[createFavorite] :: Error: parameter 'favoriteType' is missing or null");case 5:if("bubble"===n||"user"===n){r.next=7;break}throw i.rainbowLogger.sdk(e.logService+'[createFavorite] :: Error: favoriteType should be set to "user" or "bubble"'),new Error(e.logService+'[createFavorite] :: Error: favoriteType should be set to "user" or "bubble"');case 7:return"bubble"===n&&(n="room"),r.next=10,a.addServerFavorite(t,n);case 10:case"end":return r.stop()}}),r,this)})))}},{key:"deleteFavorite",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=o.get(this),t){n.next=3;break}throw i.rainbowLogger.sdk(e.logService+"[deleteFavorite] :: Error: parameter 'id' is missing or null"),new Error(e.logService+"[deleteFavorite] :: Error: parameter 'id' is missing or null");case 3:return n.next=5,r.removeServerFavorite(t);case 5:case"end":return n.stop()}}),n,this)})))}}],[{key:"$inject",get:function(){return["favoriteService"]}}]),e}();s.logService="FavoritesService | ",t.FavoritesService=s},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=n(1),s=n(25),c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=function(){function e(t,n,r,i){var a=this;S(this,e),this.RAINBOW_ONFILEUPLOADED_ERROR="rainbowfileuploadederror",this.RAINBOW_ONFILEDOWNLOADED="rainbowonfiledownloaded",this.RAINBOW_ONFILEDOWNLOADED_ERROR="rainbowfiledownloadederror",this.RAINBOW_ONCHUNKLOADMESSAGE="rainbowonchunkloadmessage",this.RAINBOW_ONFILEUPLOADED="rainbowfileuploaded",this.eventsMap={success:{download:this.RAINBOW_ONFILEDOWNLOADED,upload:this.RAINBOW_ONFILEUPLOADED},error:{download:this.RAINBOW_ONFILEDOWNLOADED_ERROR,upload:this.RAINBOW_ONFILEUPLOADED_ERROR}},l.set(this,t),u.set(this,n),d.set(this,r),c.set(this,i),i.$on("$destroy",i.$on("ON_FILE_TRANSFER_EVENT",(function(e,t){return a.onFileTransferChanged(e,t)})))}return C(e,[{key:"onFileTransferChanged",value:function(t,n){n.result&&n.type?(i.rainbowLogger.sdk(e.logService+"[onFileTransferChanged] ::  File transfered"),a.eventsService.dispatchEvent(this.eventsMap[n.result][n.type],n)):"uploading"!==(n=n.fileDesc).state&&"downloading"!==n.state||a.eventsService.dispatchEvent(this.RAINBOW_ONCHUNKLOADMESSAGE,n)}},{key:"addFileToConversation",value:function(e,t,n){var r=d.get(this);return new Promise((function(i,a){if("string"==typeof t){var o=new XMLHttpRequest;o.open("GET",t,!0),o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE){var s=o.response,c=new File([s],t.replace(/^.*[\\/]/,""));if(c.size>1e8)return a("The file is too large (limited to 100MB)");r.sendFSMessage(e,c,n).then((function(e){return i(e)}))}},o.responseType="blob",o.send()}else{if(t.size>1e8)return a("The file is too large (limited to 100MB)");r.sendFSMessage(e,t,n).then((function(e){return i(e)}))}}))}},{key:"uploadFileToConversation",value:function(t,n,a){return r(this,void 0,void 0,b.a.mark((function r(){var o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=l.get(this),t){r.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if(n){r.next=5;break}throw new Error("Parameter 'file' is missing or null");case 5:if(t.type===o.Type.ONE_TO_ONE){r.next=7;break}throw new Error("Parameter 'conversation' is not a one-to-one conversation");case 7:return i.rainbowLogger.sdk(e.logService+"[uploadFileToConversation] ::  Add file to the conversation "+t.id),r.next=10,this.addFileToConversation(t,n,a);case 10:return r.abrupt("return",r.sent);case 11:case"end":return r.stop()}}),r,this)})))}},{key:"uploadFile",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=u.get(this),e){r.next=3;break}throw new Error("Parameter 'file' is missing or null");case 3:return r.next=5,s.default.createFileDescriptor(e.name,e.name.split(".").pop(),e.size,[],!1);case 5:return a=r.sent,r.next=8,i.uploadAFileByChunk(a,e,t,n);case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}}),r,this)})))}},{key:"uploadExistingFileToConversation",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return r(this,void 0,void 0,b.a.mark((function r(){var o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=d.get(this),t){r.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if(n){r.next=5;break}throw new Error("Parameter 'fileDescriptor' is missing or null");case 5:return i.rainbowLogger.sdk(e.logService+"[uploadExistingFileToConversation] ::  Upload existing file to conversation "+t.id),r.next=8,o.sendEFSMessage(t,n,a);case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}}),r,this)})))}},{key:"uploadFileToBubble",value:function(t,n,a){return r(this,void 0,void 0,b.a.mark((function r(){var o,s,c;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=l.get(this),s=d.get(this),t){r.next=3;break}throw new Error("Parameter 'bubble' is missing or null");case 3:if(n){r.next=5;break}throw new Error("Parameter 'file' is missing or null");case 5:if(c=s.getConversationByRoomDbId(t.dbId)){r.next=8;break}throw new Error("Parameter 'bubble' don't have a conversation");case 8:if(c.type===o.Type.ROOM){r.next=10;break}throw new Error("Parameter 'conversation' is not a bubble conversation");case 10:return i.rainbowLogger.sdk(e.logService+"[uploadFileToBubble] ::  Trying to add a file to the bubble "+t.dbId),r.next=13,this.addFileToConversation(c,n,a);case 13:return r.abrupt("return",r.sent);case 14:case"end":return r.stop()}}),r,this)})))}},{key:"downloadFile",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=u.get(this),t){n.next=3;break}throw new Error("Parameter 'fileDescriptor' is missing or null");case 3:return i.rainbowLogger.sdk(e.logService+"[downloadFile] ::  Trying to get a file"),n.next=6,r.getBlobFromFileDescriptor(t,!0);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"removeFile",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}throw new Error("Parameter 'fileDescriptor' is missing or null");case 2:if(!t.id&&!t.url){n.next=9;break}return i.rainbowLogger.sdk(e.logService+"[removeFile] ::  Trying to remove a file"),(r=t.id)||(a=t.url.split("/"),r=a.pop()||a.pop()),n.next=8,s.default.deleteFileDescriptor(r);case 8:return n.abrupt("return",void i.rainbowLogger.sdk(e.logService+"[removeFile] ::  File removed"));case 9:throw new Error("Parameter 'fileDescriptor' does not contain sufficient information to remove the file - no id or url property");case 10:case"end":return n.stop()}}),n)})))}},{key:"getFileDescriptorFromId",value:function(t){return i.rainbowLogger.sdk(e.logService+"[getFileDescriptorFromId] ::  Get file descriptor "+t),s.default.getFileDescriptorById(t)}},{key:"getFileDescriptorUrl",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=u.get(this),n.next=3,r.getFileDescriptorUrl(e,t);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getFilesReceivedInConversation",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),t){n.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if(t.type===r.Type.ONE_TO_ONE){n.next=5;break}throw new Error("Parameter 'conversation' is not a one-to-one conversation");case 5:return i.rainbowLogger.sdk(e.logService+"[getFilesReceivedInConversation] ::  Get files received in conversation "+t.id+"..."),n.next=8,s.default.retrieveFilesReceivedFromPeer(o.default.userContact.dbId,t.contact.dbId);case 8:return a=n.sent,n.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[getFilesReceivedInConversation] ::  Shared "+a.length),a));case 10:case"end":return n.stop()}}),n,this)})))}},{key:"getFilesReceivedInBubble",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return i.rainbowLogger.sdk(e.logService+"[getFilesReceivedInBubble] ::  Get files received in bubble "+t.dbId),n.next=5,s.default.retrieveReceivedFilesForRoom(t.dbId);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n)})))}},{key:"getFilesSentInConversation",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),t){n.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if(t.type===r.Type.ONE_TO_ONE){n.next=5;break}throw new Error("Parameter 'conversation' is not a one-to-one conversation");case 5:return i.rainbowLogger.sdk(e.logService+"[getFilesSentInConversation] :: Get files sent in conversation "+t.id),n.abrupt("return",s.default.retrieveSentFiles(t.contact.dbId));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"getFilesSentInBubble",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return i.rainbowLogger.sdk(e.logService+"[getFilesSentInBubble] :: Get files sent in bubble "+t.dbId),n.abrupt("return",s.default.retrieveSentFiles(t.dbId));case 4:case"end":return n.stop()}}),n)})))}},{key:"getUserQuotaConsumption",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.default.retrieveUserConsumption());case 1:case"end":return e.stop()}}),e)})))}},{key:"getAllFilesSent",value:function(){return s.default.getDocuments("date",!1)}},{key:"getAllFilesReceived",value:function(){return s.default.getDocuments("date",!0)}},{key:"cancelCurrentFileTransfer",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.get(this),t.prev=1,e){t.next=4;break}throw new Error("Parameter 'id' is missing or null");case 4:if(null!==(r=s.default.getFileDescriptorById(e))){t.next=7;break}throw new Error("Could not find a file with the id "+e);case 7:if("downloading"===r.state||"uploading"===r.state){t.next=9;break}throw new Error("File Status is not set to 'downloading' or 'uploading'");case 9:return t.abrupt("return",(n.cancelCurrentFiletransfer(e),"not_uploaded"!==r.state&&"uploading"!==r.state?(r.state="uploaded",r):"not_uploaded"!==r.state&&"uploading"===r.state?(r.state="not_uploaded",r):r));case 12:throw t.prev=12,t.t0=t.catch(1),t.t0;case 15:case"end":return t.stop()}}),t,this,[[1,12]])})))}}],[{key:"inject",get:function(){return["Conversation","fileServerService","conversationService","$rootScope"]}}]),e}();h.logService="FilesStorageService | ",t.FilesStorageService=h},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);t.CapabilitiesService=function(){function e(){S(this,e)}return C(e,[{key:"getAll",value:function(){return r.default.getMyProfileFeatures()}},{key:"getUserSubscription",value:function(){return r.default.getMyProfileName()}},{key:"isFeatureEnabled",value:function(e){return r.default.isFeatureEnabled(e)}},{key:"hasS4BExtensionEnabled",value:function(){return r.default.isFeatureEnabled("MS_SKYPE_PLUGIN")}},{key:"hasOutlookExtensionEnabled",value:function(){return r.default.isFeatureEnabled("MS_OUTLOOK_PLUGIN")}},{key:"hasCalendarPresenceEnabled",value:function(){return r.default.isFeatureEnabled("MSO365_CALENDAR_PRESENCE")}},{key:"hasTelephonyBasicCallEnabled",value:function(){return r.default.isFeatureEnabled("TELEPHONY_BASIC_CALL")}},{key:"hasTelephonySecondCallEnabled",value:function(){return r.default.isFeatureEnabled("TELEPHONY_SECOND_CALL")}},{key:"hasTelephonyTransferCallEnabled",value:function(){return r.default.isFeatureEnabled("TELEPHONY_TRANSFER_CALL")}},{key:"hasTelephonyConferenceCallEnabled",value:function(){return r.default.isFeatureEnabled("TELEPHONY_CONFERENCE_CALL")}},{key:"hasTelephonyDeflectCallEnabled",value:function(){return r.default.isFeatureEnabled("TELEPHONY_DEFLECT_CALL")}},{key:"hasTelephonyForwardCallEnabled",value:function(){return r.default.isFeatureEnabled("TELEPHONY_FORWARD_CALL")}},{key:"hasTelephonyPhoneBookEnabled",value:function(){return r.default.isFeatureEnabled("TELEPHONY_PHONE_BOOK")}},{key:"hasTelephonyVoiceMailEnabled",value:function(){return r.default.isFeatureEnabled("TELEPHONY_VOICE_MAIL")}},{key:"hasWebRTCAudioMobileEnabled",value:function(){return r.default.isFeatureEnabled("WEBRTC_FOR_MOBILE")}},{key:"hasWebRTCVideoMobileEnabled",value:function(){return r.default.isFeatureEnabled("WEBRTC_FOR_MOBILE_VIDEO")}},{key:"hasBridgeConferenceEnabled",value:function(){return r.default.isFeatureEnabled("CONFERENCE_ALLOWED")}},{key:"hasBridgeConferenceRecordEnabled",value:function(){return r.default.isFeatureEnabled("CONFERENCE_RECORDING")}},{key:"hasBridgeConferenceDialOutEnabled",value:function(){return r.default.isFeatureEnabled("CONFERENCE_DIAL_OUT")}},{key:"maxParticipantsPerBubbleAllowed",value:function(){return r.default.getFeatureLimitMax("BUBBLE_PARTICIPANT_COUNT")}},{key:"maxParticipantsPerBridgeConferenceAllowed",value:function(){return r.default.getFeatureLimitMax("CONFERENCE_PARTICIPANT_COUNT")}},{key:"maxFileStorageQuotaAllowed",value:function(){return r.default.getFeatureLimitMax("FILE_SHARING_QUOTA_GB")}}]),e}()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=new WeakMap,a=new WeakMap,o=new WeakMap,s=n(19),c=function(){function e(t,n,r){S(this,e),this.logService="AdminService | ",i.set(this,t),a.set(this,n),o.set(this,r)}return C(e,[{key:"createEssentialCompany",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.get(this),(i=s.Company.create(null,"")).name=e,i.country=t,n.next=5,r.createCompanyEndUser(i);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"createCompany",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=a.get(this),(o=s.Company.create(null,"")).name=e,o.country=t,n&&(o.state=n),o.economicActivityClassification="",r.next=7,i.createCompany(o);case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}}),r,this)})))}},{key:"removeCompany",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.get(this),t.next=3,n.deleteCompany(e.id);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"createUserForCompany",value:function(e,t,n,a,s,c){return r(this,void 0,void 0,b.a.mark((function r(){var l,u,d;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return l=i.get(this),u=o.get(this),(d=l.create()).loginEmail=e,d.firstName=t,d.lastName=n,d.password=a,d.language="en",d.companyId=s.id,d.adminType="undefined",d.isActive=!0,d.isInitialized=!0,c&&(d.tags=c&&Array.isArray(c)?c:[c]),r.next=13,u.createUser(d);case 13:return r.abrupt("return",r.sent);case 14:case"end":return r.stop()}}),r,this)})))}},{key:"removeUserFromCompany",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.get(this),t.next=3,n.deleteUser(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"fetchUsersByTag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return r(this,void 0,void 0,b.a.mark((function r(){var i;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=o.get(this),r.next=3,i.getUsers(null,t,n,e,!1,null,!1,!0);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r,this)})))}},{key:"updateUserTags",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=o.get(this),e){n.next=3;break}throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'user' is missing or null");case 3:if(e.id){n.next=5;break}throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'user.id' is missing or null");case 5:if(t instanceof Array==1){n.next=7;break}throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'tags' must be an array");case 7:if(!(t instanceof Array&&(t.length<1||t.length>5))){n.next=9;break}throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'tags' must be an array with at least 1 and maximum 5 elements");case 9:return n.next=11,r.updateUser(e);case 11:return n.abrupt("return",n.sent);case 12:case"end":return n.stop()}}),n,this)})))}},{key:"setVisibilityForCompany",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.get(this),n.next=3,r.addVisibility(e.id,t.id);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)})))}}],[{key:"$inject",get:function(){return["User","adminCompanyService","adminUserService"]}},{key:"getInstance",value:function(){return this.instance||(this.instance=new e("User","adminCompanyService","adminUserService")),this.instance}}]),e}();t.AdminService=c},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=n(28),s=n(1),c=new WeakMap,l=new WeakMap,u=function(){function e(t,n){var r=this;S(this,e),this.RAINBOW_ONCHANNELUPDATED="rainbowchannelupdate",this.RAINBOW_ONCHANNELMESSAGERECEIVED="rainbowchannelmessagereceived",this.RAINBOW_ONCHANNELRETRACTMESSAGERECEIVED="rainbowchannelretractmessage",this.RAINBOW_ONCHANNELDELETED="rainbowchanneldeleted",this.RAINBOW_ONCHANNELAVATARUPDATED="rainbowchannelavatarupdate",this.RAINBOW_ONCHANNELUSERSUBSCRIBED="rainbowchannelusersubscribed",this.RAINBOW_ONCHANNELUSERUNSUBSCRIBED="rainbowchanneluserunsubscribed",c.set(this,t),l.set(this,n),t.$on("$destroy",t.$on("CHANNEL_MESSAGE_RECEIVED",(function(e,t,n){return r.onMessageReceived(e,t,n)}))),t.$on("$destroy",t.$on("CHANNEL_UPDATE_EVENT",(function(e,t,n){return r.onChannelUpdated(e,t,n)}))),t.$on("$destroy",t.$on("CHANNEL_USERS_UPDATE_EVENT",(function(e,t,n){return r.onChannelUsersUpdated(e,t,n)}))),t.$on("$destroy",t.$on("ON_UPDATE_CHANNEL_AVATAR",(function(e,t){return r.onChannelAvatarUpdated(e,t)}))),t.$on("$destroy",t.$on("CHANNEL_USER_SUBSCRIPTION_EVENT",(function(e,t,n,i){return r.onUserSubscriptionChange(e,t,n,i)})))}return C(e,[{key:"onMessageReceived",value:function(t,n,r){var o=this,s=r.channelId?r.channelId:r;i.rainbowLogger.sdk(e.logService+"[ChannelsService] :: EVENT onMessageReceived"),this.fetchChannel(s).then((function(t){0===n?a.eventsService.dispatchEvent(o.RAINBOW_ONCHANNELMESSAGERECEIVED,r):(i.rainbowLogger.sdk(e.logService+"[ChannelsService] :: EVENT onMessageReceived - retracted message"),a.eventsService.dispatchEvent(o.RAINBOW_ONCHANNELRETRACTMESSAGERECEIVED,{channel:t,message:r}))}))}},{key:"onChannelUpdated",value:function(t,n,r){var o=this;i.rainbowLogger.sdk(e.logService+"[ChannelsService] :: EVENT: onChannelUpdated("+n+") id:"+r),3!==n?this.fetchChannel(r).then((function(e){a.eventsService.dispatchEvent(o.RAINBOW_ONCHANNELUPDATED,{channel:e,updateType:n})})):a.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELDELETED,r)}},{key:"onChannelUsersUpdated",value:function(t,n,r){var o=this;i.rainbowLogger.sdk(e.logService+"[ChannelsService] :: EVENT onChannelUsersUpdated:"+n),this.fetchChannel(n).then((function(e){a.eventsService.dispatchEvent(o.RAINBOW_ONCHANNELUPDATED,{channel:e,users:r})}))}},{key:"onChannelAvatarUpdated",value:function(t,n){var r=this;this.fetchChannel(n).then((function(t){i.rainbowLogger.sdk(e.logService+"[ChannelsService] :: EVENT onChannelAvatarUpdated"+t.id),a.eventsService.dispatchEvent(r.RAINBOW_ONCHANNELAVATARUPDATED,t)}))}},{key:"onUserSubscriptionChange",value:function(t,n,r,o){var c=this,l=null;this.fetchChannel(r).then((function(e){return l=e,s.default.getContactByDBId(o,!0)})).then((function(t){t=t||o,4===n?(i.rainbowLogger.sdk(e.logService+"[ChannelsService] :: EVENT onUserSubscriptionChange: user subscribed to a channel: "+r),a.eventsService.dispatchEvent(c.RAINBOW_ONCHANNELUSERSUBSCRIBED,{channel:l,user:t})):(i.rainbowLogger.sdk(e.logService+"[ChannelsService] :: EVENT onUserSubscriptionChange: user unsubscribed from a channel: "+r),a.eventsService.dispatchEvent(c.RAINBOW_ONCHANNELUSERUNSUBSCRIBED,{channel:l,user:t}))}))}},{key:"fetchMyChannels",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.get(this),e.next=3,t.getMyChannels();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"createPublicChannel",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return r(this,void 0,void 0,b.a.mark((function r(){var o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=l.get(this),i.rainbowLogger.sdk(e.logService+"[createPublicChannel] :: Trying to create a new public channel"),t){r.next=3;break}throw new Error("Parameter 'channelName' is missing or empty");case 3:return r.next=5,o.createChannel(t,"company_public",n,a,!1);case 5:return s=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[createPublicChannel] :: Public Channel created: "+s.id),s));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"createClosedChannel",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return r(this,void 0,void 0,b.a.mark((function r(){var o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=l.get(this),i.rainbowLogger.sdk(e.logService+"[createClosedChannel] :: Trying to create a new closed channel"),t){r.next=3;break}throw new Error("Parameter 'channelName' is missing or empty");case 3:return s=o.createChannel(t,"company_closed",n,a,!1),r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[createClosedChannel] :: created: "+s.id),s));case 5:case"end":return r.stop()}}),r,this)})))}},{key:"deleteChannel",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[deleteChannel] :: Trying to delete a channel"),t){n.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return n.next=5,r.deleteChannel(t);case 5:return i.rainbowLogger.sdk(e.logService+"[deleteChannel] :: deleted: "+t),n.abrupt("return",{code:o.SDK.OK,label:"OK"});case 7:case"end":return n.stop()}}),n,this)})))}},{key:"fetchChannelsByName",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a,o;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[fetchChannelsByName] :: Trying to fetch channels by name"),t){n.next=3;break}throw new Error("Parameter 'name' is missing or empty");case 3:return(a={}).name=t,n.next=7,r.findChannels(a);case 7:return o=n.sent,n.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[fetchChannelsByName] :: fetched: "+o.length),o));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"fetchChannelsByTopic",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a,o;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[fetchChannelsByTopic] :: Trying to fetch channels by topic"),t){n.next=3;break}throw new Error("Parameter 'topic' is missing or empty");case 3:return(a={}).topic=t,n.next=7,r.findChannels(a);case 7:return o=n.sent,n.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[fetchChannelsByTopic] :: fetched: "+o.length),o));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"fetchChannelsByCategory",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a,o;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[fetchChannelsByCategory] :: Trying to fetch channels by category"),t){n.next=3;break}throw new Error("Parameter 'category' is missing or empty");case 3:return(a={}).category=t,o=r.findChannels(a),n.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[fetchChannelsByCategory] :: fetched: "+o.length),o));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"fetchChannel",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[fetchChannel] :: Trying to fetch a channel..."),t){n.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return a=r.getChannel(t),n.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[fetchChannel] :: fetched: "+a.id),a));case 5:case"end":return n.stop()}}),n,this)})))}},{key:"createItem",value:function(t,n,a,s,c){return r(this,void 0,void 0,b.a.mark((function r(){var u;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=l.get(this),i.rainbowLogger.sdk(e.logService+"[createItem] :: Trying to create item"),t){r.next=3;break}throw new Error("Parmeter 'channel' is missing or empty");case 3:if(n){r.next=5;break}throw new Error("Parmeter 'message' is missing or empty");case 5:if(!c||-1!==["basic","markdown","html","data"].indexOf(c)){r.next=7;break}throw new Error("Parameter 'itemType' could be 'asic', 'markdown', 'html' or 'data'");case 7:return a=a||"",s=s||"",c=c?"urn:xmpp:channels:"+c:"urn:xmpp:channels:basic",r.next=12,u.publishToChannel(t.id,null,c,n,a,s);case 12:return i.rainbowLogger.sdk(e.logService+"[createItem] :: created: "+t.id),r.abrupt("return",{code:o.SDK.OK,label:"OK"});case 14:case"end":return r.stop()}}),r,this)})))}},{key:"subscribeToChannelById",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[subscribeToChannelById] :: Trying to subscribe to a channel..."),t){n.next=3;break}throw new Error("Parameter 'id' is missing or null");case 3:if(!(a=r.getChannelFromCache(t))){n.next=10;break}return n.next=7,r.subscribeToChannel(a);case 7:i.rainbowLogger.sdk(e.logService+"[subscribeToChannelById] :: subscribed: "+t),n.next=18;break;case 10:return n.next=12,r.getChannel(t);case 12:if(s=n.sent){n.next=15;break}return n.abrupt("return",{code:o.SDK.ERRORBADREQUEST,label:"No channel found with id "+t});case 15:return n.next=17,r.subscribeToChannel(s);case 17:i.rainbowLogger.sdk(e.logService+"[subscribeToChannelById] :: subscribed: "+t);case 18:return n.abrupt("return",{code:o.SDK.OK,label:"OK"});case 19:case"end":return n.stop()}}),n,this)})))}},{key:"subscribeToChannel",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[subscribeToChannel] :: Trying to subscribe to a channel..."),t){n.next=3;break}throw new Error("Paameter 'channel' is missing or null");case 3:return n.next=5,r.subscribeToChannel(t);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"unsubscribeFromChannelById",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[unsubscribeFromChannelById] :: Trying to unsubscribe from a channel..."),t){n.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:if(!(a=r.getChannelFromCache(t))){n.next=10;break}return n.next=7,r.unsubscribeToChannel(a);case 7:i.rainbowLogger.sdk(e.logService+"[unsubscribeFromChannelById] :: unsubscribed: "+t),n.next=16;break;case 10:if(s=r.getChannel(t)){n.next=13;break}return n.abrupt("return",{code:o.SDK.ERRORBADREQUEST,label:"No channel found with id "+t});case 13:return n.next=15,r.unsubscribeToChannel(s);case 15:i.rainbowLogger.sdk(e.logService+"[unsubscribeFromChannelById] :: unsubscribed: "+t);case 16:return n.abrupt("return",{code:o.SDK.OK,label:"OK"});case 17:case"end":return n.stop()}}),n,this)})))}},{key:"unsubscribeFromChannel",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[unsubscribeFromChannel] :: Trying to unsubscribe from a channel..."),t){n.next=3;break}throw new Error("Parameter 'channel' is missing or null");case 3:return n.next=5,r.unsubscribeToChannel(t);case 5:return i.rainbowLogger.sdk(e.logService+"[unsubscribeFromChannel] :: unsubscribed: "+t.id),n.abrupt("return",{code:o.SDK.OK,label:"OK"});case 7:case"end":return n.stop()}}),n,this)})))}},{key:"updateChannel",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"public",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return r(this,void 0,void 0,b.a.mark((function r(){var d,h,f;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(d=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannel] :: Trying to update a channel..."),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return h={},null!==n&&(h.topic=n),null!==a&&(h.mode="company"===a?"company_public":"company_closed"),null!==o&&(h.maxItems=o),null!==s&&(h.maxPayloadSize=s),null!==c&&(h.name=c),null!==u&&(h.cateogry=u),r.next=7,d.updateChannel(t,h);case 7:return f=r.sent,r.abrupt("return",(f.visibility=h.visibility,i.rainbowLogger.sdk(e.logService+"[updateChannel] :: updated: "+t),f));case 9:case"end":return r.stop()}}),r,this)})))}},{key:"updateChannelVisibility",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannelVisibility] :: Trying to update visibility of a channel..."),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:if(n){r.next=5;break}throw new Error("Parameter 'visibility' is missing or empty");case 5:return o={},null!==n&&(o.mode="company"===n?"company_public":"company_closed"),r.next=9,a.updateChannel(t,o);case 9:return s=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[updateChannelVisibility] :: updated: "+t),s));case 11:case"end":return r.stop()}}),r,this)})))}},{key:"updateChannelVisibilityToPublic",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannelVisibilityToPublic] :: Trying to update visibility to visible for a channel"),t){n.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return n.next=5,r.updateChannel(t,{mode:"company_public"});case 5:return a=n.sent,n.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[updateChannelVisibilityToPublic] :: updated: "+t),a));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"updateChannelVisibilityToClosed",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannelVisibilityToPublic] :: Trying to update visibility to visible for a channel"),t){n.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return n.next=5,r.updateChannel(t,{mode:"company_closed"});case 5:return a=n.sent,n.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[updateChannelVisibilityToPublic] :: updated: "+t),a));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"updateChannelName",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannelName] :: Trying to update the name of a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return o={},null!==n&&(o.name=n),s=a.updateChannel(t,o),r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[updateChannelName] :: updated: "+t),s));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"updateChannelTopic",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannelTopic] :: Try to update the topic of a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return o={},null!==n&&(o.topic=n),s=a.updateChannel(t,o),r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[updateChannelTopic] :: updated: "+t),s));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"updateChannelCategory",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannelCategory] :: Try to update the category of a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return o={},null!==n&&(o.category=n),s=a.updateChannel(t,o),r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[updateChannelCategory] :: updated: "+t),s));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"updateChannelAvatar",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannelAvatar] :: Try to update the avatar of a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:if(n){r.next=5;break}throw new Error("Parameter 'urlAvatar' is missing or empty");case 5:return r.abrupt("return",(a.uploadChannelAvatar(t,n,512),i.rainbowLogger.sdk(e.logService+"[updateChannelAvatar] :: updated: "+t.id),{code:o.SDK.OK,label:"OK"}));case 6:case"end":return r.stop()}}),r,this)})))}},{key:"deleteChannelAvatar",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[deleteChannelAvatar] :: Try to delete the avatar of a channel"),t){n.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return n.abrupt("return",(r.deleteChannelAvatar(t),i.rainbowLogger.sdk(e.logService+"[deleteChannelAvatar] :: updated: "+t),{code:o.SDK.OK,label:"OK"}));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"fetchUsers",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[fetchUsers] :: Trying to fetch users of a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return r.next=5,a.getChannelUsers(t,n);case 5:return r.abrupt("return",r.sent.data);case 6:case"end":return r.stop()}}),r,this)})))}},{key:"deleteAllUsersFromChannel",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=l.get(this),i.rainbowLogger.sdk(e.logService+"[deleteAllUsersFromChannel] :: Trying to get delete all users of a channel..."),t){n.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return n.next=5,r.removeAllUsersFromChannel(t);case 5:return n.next=7,r.getChannel(t);case 7:return a=n.sent,n.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[deleteAllUsersFromChannel] :: deleted: "+t),a));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"updateChannelUsers",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"member";return r(this,void 0,void 0,b.a.mark((function r(){var o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=l.get(this),i.rainbowLogger.sdk(e.logService+"[updateChannelUsers] :: Trying to update users of a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return r.next=5,o.updateChannelUsers(t,n,a);case 5:return s=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[updateChannelUsers] :: updated: "+t),s));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"addMembersToChannel",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[addMembersToChannel] :: Trying to add members to a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return r.next=5,a.updateChannelUsers(t,n,"member");case 5:return o=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[addMembersToChannel] :: added: "+t),o));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"addPublishersToChannel",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[addPublishersToChannel] :: Trying to add publishers to a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return r.next=5,a.updateChannelUsers(t,n,"publisher");case 5:return o=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[addPublishersToChannel] :: added: "+t),o));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"addOwnersToChannel",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[addOwnersToChannel] :: Trying to add owners to a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return r.next=5,a.updateChannelUsers(t,n,"owner");case 5:return o=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[addOwnersToChannel] :: added: "+t),o));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"deleteUsersFromChannel",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[deleteUsersFromChannel] :: Trying to delete users from a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return r.next=5,a.updateChannelUsers(t,n,"none");case 5:return o=r.sent,r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[deleteUsersFromChannel] :: deleted: "+t),o));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"fetchItems",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return r(this,void 0,void 0,b.a.mark((function r(){var s,c;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=l.get(this),i.rainbowLogger.sdk(e.logService+"[fetchItems] :: Try to fetch items of a channel"),t){r.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return c=s.getChannelItems(t,n,a,o),r.abrupt("return",(i.rainbowLogger.sdk(e.logService+"[fetchItems] :: fetched: "+t),c));case 5:case"end":return r.stop()}}),r,this)})))}},{key:"deleteItem",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=l.get(this),i.rainbowLogger.sdk(e.logService+"[deleteItem] :: Trying to delete an item."),t){r.next=3;break}throw new Error("Parameter 'channelId' is missing or empty");case 3:if(n){r.next=5;break}throw new Error("Parameter 'itemId' is missing or empty");case 5:return r.next=7,a.deleteChannelItem(t,n);case 7:i.rainbowLogger.sdk(e.logService+"[deleteItem] :: Item deleted: "+n);case 8:case"end":return r.stop()}}),r,this)})))}}],[{key:"$inject",get:function(){return["$rootScope","channelService"]}}]),e}();u.logService="ChannelsService | ",t.ChannelsService=u},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(22),o=n(5),s=n(39),c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,v=new WeakMap,g=new WeakMap,y=new WeakMap,_=new WeakMap,w=new WeakMap,E=new WeakMap,T=new WeakMap,k=new WeakMap,M=new WeakMap;t.SdkService=function(){function e(t,n,r,i,a,o,s,b,C,D,x,R,O,I,P,A,L){S(this,e),this.eventHandler=null,this.logService="SDKService | ",this.isReady=!1,this.RAINBOW_ONREADY="ready",this.RAINBOW_ONLOADED="loaded",c.set(this,t),l.set(this,n),u.set(this,r),d.set(this,i),h.set(this,a),f.set(this,o),p.set(this,s),m.set(this,b),v.set(this,C),g.set(this,D),y.set(this,x),_.set(this,R),w.set(this,O),E.set(this,I),T.set(this,P),k.set(this,A),M.set(this,L),this.connection=t,this.presence=n,this.contacts=r,this.conversations=i,this.im=a,this.telephony=o,this.webRTC=s,this.bubbles=b,this.conferences=C,this.groups=D,this.callsLog=x,this.userProfile=R,this.favorites=O,this.fileStorage=I,this.caps=P,this.channels=A,this.admin=L,this.detectRTC=this.detectRTC.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.initializeAuto=this.initializeAuto.bind(this),this.start=this.start.bind(this)}return C(e,[{key:"version",value:function(){return window.sdkversion}},{key:"mode",value:function(){return o.default.getSetting("apiMode")}},{key:"setVerboseLog",value:function(e){return s.sdkConfig.verboseLog=e,s.sdkConfig.verboseLog}},{key:"setKeyFromConfig",value:function(e,t){return i.rainbowLogger.sdk(this.logService+"[setKeyFromConfig] :: Linked to application ID "+e+" from configuration file"),s.sdkConfig.credentials.appID=e,s.sdkConfig.credentials.appSecret=t,!0}},{key:"hasBeenLaunchedFromConfig",value:function(e){var t=e?"YES":"NO";return i.rainbowLogger.sdk(this.logService+"[hasBeenLaunchedFromConfig] :: SDK launched from a configuration file "+t),sdk.hasBeenLaunchedFromConfig=e,sdk.hasBeenLaunchedFromConfig}},{key:"initialize",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e&&e.length>0?(sdk.key.appID=e,i.rainbowLogger.sdk(this.logService+"[initialize] :: Initialize the SDK for the application "+sdk.key.appID)):i.rainbowLogger.sdk(this.logService+"[initialize] :: Initialize the SDK without an application key"),t&&t.length>0&&(sdk.key.appSecret=t),n.next=4,this.detectRTC();case 4:return i.rainbowLogger.sdk(this.logService+"[initialize] :: SDK Initialized successfully!"),n.abrupt("return",!0);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"detectRTC",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.DetectRTC,e.next=3,t.load();case 3:this.initializeAuto();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"load",value:function(e){e&&(i.rainbowLogger.sdk(this.logService+"Loading Rainbow Web SDK with custom config"),Object.assign(s.sdkConfig,e)),this.start(),i.rainbowLogger.sdk(this.logService+"[load] :: Rainbow SDK loaded!"),a.eventsService.dispatchEvent(this.RAINBOW_ONLOADED,null)}},{key:"ready",value:function(){i.rainbowLogger.sdk(this.logService+"[ready] :: Rainbow SDK ready!"),a.eventsService.dispatchEvent(this.RAINBOW_ONREADY,null)}},{key:"initializeAuto",value:function(){var e=window.sdkversion,t=window.DetectRTC,n=window.config;i.rainbowLogger.sdk(this.logService+"[initialize ] :: Initializing the Rainbow SDK..."),i.rainbowLogger.sdk(this.logService+"[initialize ] :: -----------------------------"),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Platform    | "+t.osName+" "+t.osVersion),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Screen      | "+window.screen.width+"x"+window.screen.height),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Cookie      | "+navigator.cookieEnabled),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Java        | "+navigator.javaEnabled()),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Server      | "+n.webservices.server),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Version WEB | "+version),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Version SDK | "+e),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Browser     | "+t.browser.name+" "+t.browser.fullVersion),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Microphone  | "+t.hasMicrophone),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Camera      | "+t.hasWebcam),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Speakers    | "+t.hasSpeakers),i.rainbowLogger.sdk(this.logService+"[initialize ] :: WebRTC      | "+t.isWebRTCSupported),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Mode        | "+this.mode()),i.rainbowLogger.sdk(this.logService+"[initialize ] :: verboseLog  | "+s.sdkConfig.verboseLog),i.rainbowLogger.sdk(this.logService+"[initialize ] :: appID       | "+sdk.key.appID),i.rainbowLogger.sdk(this.logService+"[initialize ] :: -----------------------------"),i.rainbowLogger.sdk(this.logService+"[initialize ] :: Initialized!"),this.ready()}},{key:"start",value:function(){window.config.webservices.currentServer=window.config.webservices.server,this.isReady=!0}}],[{key:"$inject",get:function(){return["connectionService","presenceService","contactsService","conversationsService","imService","pbxService","webRTCService","bubblesService","conferencesService","groupsService","callsLogService","userProfileService","favoritesService","filesStorageService","capabilitiesService","channelsService","adminService"]}}]),e}()},function(e,t){window.version="2.84.0"},function(e,t){window.sdkversion="1.84.0"},function(e,t){window.config={xmpp:{protocol:"wss",server:"sandbox.openrainbow.com",port:"443",pingInterval:"60000"},webservices:{protocol:"https",server:"sandbox.openrainbow.com",port:"443"},cpaas:{protocol:"https",server:"",port:"8887"}}},function(e,t){window.app=angular.module("rainbow",[]),window.rainbowAdmin=angular.module("rainbowAdmin",[]),window.rainbow=angular.module("rainbow",["rainbowAdmin"])},function(e,t,n){n.r(t),n(352),n(355),n(358),n(361),n(363);var r=n(9);angular.module("rainbow").moduleIds=[],n(258),n(260),n(261),n(54),n(71),n(272),n(273),n(274),n(275),n(276),n(306),n(220),n(307),n(221),n(308),n(43),n(309),n(16),n(0),n(312),n(313),n(314),n(222),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(225),n(351),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),angular.module("rainbow").factory("rainbowLogger",(function(){return r.rainbowLogger})),n(388),n(389),n(390),n(391),n(394),n(395),n(405),n(406),n(407),n(408),n(409)},function(e,t,n){(function(n,r){var i;!function(){function a(e,t){var n=0,r=!1,i=window.setInterval((function(){e()&&(window.clearInterval(i),t(r)),n++>50&&(window.clearInterval(i),t(r=!0))}),10)}var o,s="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if("object"==typeof n&&"object"==typeof n.versions&&n.versions.node&&!n.browser){var c=n.versions.node.toString().replace("v","");s="Nodejs/"+c+" (NodeOS) AppleWebKit/"+c+" (KHTML, like Gecko) Nodejs/"+c+" Nodejs/"+c}o=void 0!==r?r:window,"undefined"==typeof window&&("undefined"==typeof window&&void 0!==r&&(r.navigator={userAgent:s,getUserMedia:function(){}},o.window=r),"undefined"==typeof location&&(o.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(o.screen={width:0,height:0}));var l=window.navigator;void 0!==l?(void 0!==l.webkitGetUserMedia&&(l.getUserMedia=l.webkitGetUserMedia),void 0!==l.mozGetUserMedia&&(l.getUserMedia=l.mozGetUserMedia)):l={getUserMedia:function(){},userAgent:s};var u,d,h=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(l.userAgent||""),f=!(-1===l.userAgent.indexOf("Edge")||!l.msSaveOrOpenBlob&&!l.msSaveBlob),p=!!window.opera||l.userAgent.indexOf(" OPR/")>=0,m=l.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(l.userAgent),v=/^((?!chrome|android).)*safari/i.test(l.userAgent),g=!!window.chrome&&!p,y="undefined"!=typeof document&&!!document.documentMode&&!f,b={Android:function(){return l.userAgent.match(/Android/i)},BlackBerry:function(){return l.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return l.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return l.userAgent.match(/Opera Mini/i)},Windows:function(){return l.userAgent.match(/IEMobile/i)},any:function(){return b.Android()||b.BlackBerry()||b.iOS()||b.Opera()||b.Windows()},getOsName:function(){var e="Unknown OS";return b.Android()&&(e="Android"),b.BlackBerry()&&(e="BlackBerry"),b.iOS()&&(e="iOS"),b.Opera()&&(e="Opera Mini"),b.Windows()&&(e="Windows"),e}},S="Unknown OS",_="Unknown OS Version",C=function(){for(var e,t=l.appVersion,n=l.userAgent,r="-",i=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],a=0;e=i[a];a++)if(e.r.test(n)){r=e.s;break}var o="-";switch(/Windows/.test(r)&&(/Windows (.*)/.test(r)&&(o=/Windows (.*)/.exec(r)[1]),r="Windows"),r){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(n)&&(o=/Mac OS X (10[\.\_\d]+)/.exec(n)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(n)&&(o=/Android ([\.\_\d]+)/.exec(n)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(o=(o=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+o[2]+"."+(0|o[3]))}return{osName:r,osVersion:o}}();C&&C.osName&&"-"!=C.osName?(S=C.osName,_=C.osVersion):b.any()&&"Android"==(S=b.getOsName())&&(_=!!(d=(u=(u||l.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&d[1]);var w="object"==typeof n&&"object"==typeof n.versions&&n.versions.node;"Unknown OS"===S&&w&&(S="Nodejs",_=n.versions.node.toString().replace("v",""));var E=!1,T=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!E&&e in document.createElement("canvas")&&(E=!0),!T&&e in document.createElement("video")&&(T=!0))}));var k=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,M=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,D=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,x=[],R=[],O=[],I=[];l.mediaDevices&&l.mediaDevices.enumerateDevices&&(l.enumerateDevices=function(e){var t=l.mediaDevices.enumerateDevices();t&&t.then?l.mediaDevices.enumerateDevices().then(e).catch((function(){e([])})):e([])});var P=!1;("undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||l.mediaDevices&&l.mediaDevices.enumerateDevices)&&(P=!0);var A=!1,L=!1,N=!1,j=!1,U=!1,F=window.DetectRTC||{};F.browser=function(){var e,t,n,r=(l.appVersion,l.userAgent),i=l.appName,a=""+parseFloat(l.appVersion),o=parseInt(l.appVersion,10);if(p){i="Opera";try{o=(a=l.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(s){a="0.0.0.0",o=0}}else y?((t=r.indexOf("rv:"))>0?a=r.substring(t+3):(t=r.indexOf("MSIE"),a=r.substring(t+5)),i="IE"):g?(t=r.indexOf("Chrome"),i="Chrome",a=r.substring(t+7)):v?-1!==r.indexOf("CriOS")?(t=r.indexOf("CriOS"),i="Chrome",a=r.substring(t+6)):-1!==r.indexOf("FxiOS")?(t=r.indexOf("FxiOS"),i="Firefox",a=r.substring(t+6)):(t=r.indexOf("Safari"),i="Safari",a=r.substring(t+7),-1!==(t=r.indexOf("Version"))&&(a=r.substring(t+8)),-1!==l.userAgent.indexOf("Version/")&&(a=l.userAgent.split("Version/")[1].split(" ")[0])):m?(t=r.indexOf("Firefox"),i="Firefox",a=r.substring(t+8)):(e=r.lastIndexOf(" ")+1)<(t=r.lastIndexOf("/"))&&(i=r.substring(e,t),a=r.substring(t+1),i.toLowerCase()===i.toUpperCase()&&(i=l.appName));return f&&(i="Edge",a=l.userAgent.split("Edge/")[1]),-1!==(n=a.search(/[; \)]/))&&(a=a.substring(0,n)),o=parseInt(""+a,10),isNaN(o)&&(a=""+parseFloat(l.appVersion),o=parseInt(l.appVersion,10)),{fullVersion:a,version:o,name:i,isPrivateBrowsing:!1}}(),function(e){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,(function(){t=!1}),(function(e){t=!0}));else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var n;try{(n=window.indexedDB.open("test")).onerror=function(){return!0}}catch(r){t=!0}void 0===t&&a((function(){return"done"===n.readyState}),(function(e){e||(t=!n.result)}))}else if(function(e){var t=window.navigator.userAgent.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&parseInt(n[1],10)>=10)}()){t=!1;try{window.indexedDB||(t=!0)}catch(r){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(r){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}}catch(r){t=!1}a((function(){return void 0!==t}),(function(e){var n;n=t,F.browser.isPrivateBrowsing=!!n}))}(),F.browser["is"+F.browser.name]=!0,F.osName=S,F.osVersion=_;var H=("object"==typeof n&&"object"==typeof n.versions&&n.versions["node-webkit"],!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){H||e in window&&(H=!0)})),F.isWebRTCSupported=H,F.isORTCSupported="undefined"!=typeof RTCIceGatherer;var W=!1;(F.browser.isChrome&&F.browser.version>=35||F.browser.isFirefox&&F.browser.version>=34||F.browser.isEdge&&F.browser.version>=17||"Android"===F.osName&&F.browser.isChrome)&&(W=!0),(l.getDisplayMedia||l.mediaDevices&&l.mediaDevices.getDisplayMedia)&&(W=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||"")||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(F.browser.isChrome||F.browser.isEdge||F.browser.isOpera)||F.browser.isFirefox)&&(W=!1),F.isScreenCapturingSupported=W;var Y={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach((function(e){Y.isSupported||e in window&&(Y.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(Y.isCreateMediaStreamSourceSupported=!0))})),F.isAudioContextSupported=Y.isSupported,F.isCreateMediaStreamSourceSupported=Y.isCreateMediaStreamSourceSupported;var B=!1;F.browser.isChrome&&F.browser.version>31&&(B=!0),F.isRtpDataChannelsSupported=B;var V=!1;(F.browser.isFirefox&&F.browser.version>28||F.browser.isChrome&&F.browser.version>25||F.browser.isOpera&&F.browser.version>=11)&&(V=!0),F.isSctpDataChannelsSupported=V,F.isMobileDevice=h;var $=!1;(l.getUserMedia||l.mediaDevices&&l.mediaDevices.getUserMedia)&&($=!0),F.browser.isChrome&&F.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&($="Requires HTTPs"),"Nodejs"===F.osName&&($=!1),F.isGetUserMediaSupported=$;var G,z,q,J="";screen.width&&(J+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")),F.displayResolution=J,F.displayAspectRatio=(G=screen.width,z=screen.height,q=function e(t,n){return 0==n?t:e(n,t%n)}(G,z),G/q/(z/q)).toFixed(2),F.isCanvasSupportsStreamCapturing=E,F.isVideoSupportsStreamCapturing=T,"Chrome"==F.browser.name&&F.browser.version>=53&&(F.isCanvasSupportsStreamCapturing||(F.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),F.isVideoSupportsStreamCapturing||(F.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),F.DetectLocalIPAddress=function(e,t){if(F.isWebRTCSupported){var n=!0,r=!0;!function(e,t){function n(t){if(t){var n=M.exec(t);if(n){var r=n[1];t.match(k);void 0===i[r]&&e(r),i[r]=!0}}else e()}function r(){l.localDescription.sdp.split("\n").forEach((function(e){e&&0===e.indexOf("a=candidate:")&&n(e)}))}if("undefined"!=typeof document&&"function"==typeof document.getElementById){var i={},a=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!a){var o=document.getElementById("iframe");if(!o)return;var s=o.contentWindow;a=s.RTCPeerConnection||s.mozRTCPeerConnection||s.webkitRTCPeerConnection}if(a){var c=null;"Chrome"===F.browser&&F.browser.version<58&&(c={optional:[{RtpDataChannels:!0}]});var l=new a({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},c);if(t&&(l.addStream?l.addStream(t):l.addTrack&&t.getTracks()[0]&&l.addTrack(t.getTracks()[0],t)),l.onicecandidate=function(e){e.candidate&&e.candidate.candidate?n(e.candidate.candidate):n()},!t)try{l.createDataChannel("sctp",{})}catch(u){}F.isPromisesSupported?l.createOffer().then((function(e){l.setLocalDescription(e).then(r)})):l.createOffer((function(e){l.setLocalDescription(e,r,(function(){}))}),(function(){}))}}}((function(t){t?t.match(k)?e("Local: "+t,n=!1,r):t.match(D)?e("Public: "+t,n,r=!1):e("Public: "+t,n,r):e()}),t)}},F.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,F.isWebSocketsBlocked=!F.isWebSocketsSupported,"Nodejs"===F.osName&&(F.isWebSocketsSupported=!0,F.isWebSocketsBlocked=!1),F.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){F.isWebSocketsBlocked=!1,t=(new Date).getTime(),n.send("ping")},n.onmessage=function(){F.WebsocketLatency=(new Date).getTime()-t+"ms",e(),n.close(),n=null},n.onerror=function(){F.isWebSocketsBlocked=!0,e()}}catch(r){F.isWebSocketsBlocked=!0,e()}},F.load=function(e){!function(e){if(P)if(!l.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(l.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!l.enumerateDevices&&l.enumerateDevices&&(l.enumerateDevices=l.enumerateDevices.bind(l)),l.enumerateDevices){x=[],R=[],O=[],I=[],A=!1,L=!1,N=!1,j=!1,U=!1;var t={};l.enumerateDevices((function(n){x=[],R=[],O=[],I=[],n.forEach((function(e){var n={};for(var r in e)try{"function"!=typeof e[r]&&(n[r]=e[r])}catch(i){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||U||(U=!0),"audioinput"!==n.kind||j||(j=!0)):(n.isCustomLabel=!0,"videoinput"===n.kind?n.label="Camera "+(I.length+1):"audioinput"===n.kind?n.label="Microphone "+(R.length+1):"audiooutput"===n.kind?n.label="Speaker "+(O.length+1):n.label="Please invoke getUserMedia once.",void 0!==F&&F.browser.isChrome&&F.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(A=!0,-1===R.indexOf(n)&&R.push(n)),"audiooutput"===n.kind&&(L=!0,-1===O.indexOf(n)&&O.push(n)),"videoinput"===n.kind&&(N=!0,-1===I.indexOf(n)&&I.push(n)),x.push(n),t[n.deviceId+n.label+n.kind]=n)})),void 0!==F&&(F.MediaDevices=x,F.hasMicrophone=A,F.hasSpeakers=L,F.hasWebcam=N,F.isWebsiteHasWebcamPermissions=U,F.isWebsiteHasMicrophonePermissions=j,F.audioInputDevices=R,F.audioOutputDevices=O,F.videoInputDevices=I),e&&e()}))}else e&&e();else e&&e()}(e=e||function(){})},F.MediaDevices=void 0!==x?x:[],F.hasMicrophone=A,F.hasSpeakers=L,F.hasWebcam=N,F.isWebsiteHasWebcamPermissions=U,F.isWebsiteHasMicrophonePermissions=j,F.audioInputDevices=R,F.audioOutputDevices=O,F.videoInputDevices=I;var K=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(K=!0),F.isSetSinkIdSupported=K;var Q=!1;F.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(Q=!0):F.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(Q=!0),F.isRTPSenderReplaceTracksSupported=Q;var X=!1;F.browser.isFirefox&&F.browser.version>38&&(X=!0),F.isRemoteStreamProcessingSupported=X;var Z=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(Z=!0),F.isApplyConstraintsSupported=Z;var ee=!1;F.browser.isFirefox&&F.browser.version>=43&&(ee=!0),F.isMultiMonitorScreenCapturingSupported=ee,F.isPromisesSupported=!!("Promise"in window),F.version="1.4.0",void 0===F&&(window.DetectRTC={});var te=window.MediaStream;void 0===te&&"undefined"!=typeof webkitMediaStream&&(te=webkitMediaStream),F.MediaStream=void 0!==te&&"function"==typeof te&&Object.keys(te.prototype),"undefined"!=typeof MediaStreamTrack?F.MediaStreamTrack=Object.keys(MediaStreamTrack.prototype):F.MediaStreamTrack=!1;var ne=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;F.RTCPeerConnection=void 0!==ne&&Object.keys(ne.prototype),window.DetectRTC=F,e.exports=F,void 0===(i=function(){return F}.apply(t,[]))||(e.exports=i)}()}).call(this,n(259),n(65))},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c,l=[],u=!1,d=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&f())}function f(){if(!u){var e=s(h);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||u||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){function n(e,t,n,r){this.name="RainbowError",this.message=e,this.details=t,this.detailsCode=n,this.detailsData=r,this.stack=(new Error).stack}n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,window.RBError=n},function(e,t){angular.module("rainbow").factory("CompanyInvitation",[function(){function e(e,t,n,r,i,a,o,s,c,l,u,d,h,f){this.id=e,this.companyId=t,this.companyName=n,this.invitedUserId=r,this.invitedUserEmail=i,this.invitingAdminId=a,this.invitingAdminLoginEmail=o,this.invitationDate=s,this.lastNotificationDate=c,this.requestedNotificationLanguage=l,this.status=u,this.acceptationDate=d,this.declinationDate=h,this.invitedToBeCompanyAdmin=f}return e.createFromData=function(t){return new e(t.id,t.companyId,t.companyName,t.invitedUserId,t.invitedUserEmail,t.invitingAdminId,t.invitingAdminLoginEmail,t.invitationDate,t.lastNotificationDate,t.requestedNotificationLanguage,t.status,t.acceptationDate,t.declinationDate,t.invitedToBeCompanyAdmin)},e}])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(56);t.canReportError=function(e){for(;e;){var t=e,n=t.closed,i=t.destination,a=t.isStopped;if(n||a)return!1;e=i&&i instanceof r.Subscriber?i:null}return!0}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isObject=function(e){return null!==e&&"object"==typeof e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}();t.UnsubscriptionError=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(56),i=n(69),a=n(79);t.toSubscriber=function(e,t,n){if(e){if(e instanceof r.Subscriber)return e;if(e[i.rxSubscriber])return e[i.rxSubscriber]()}return e||t||n?new r.Subscriber(e,t,n):new r.Subscriber(a.empty)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(269);function i(e){return 0===e.length?r.identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}t.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i(e)},t.pipeFromArray=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.identity=function(e){return e}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r={"./af":82,"./af.js":82,"./ar":83,"./ar-dz":84,"./ar-dz.js":84,"./ar-kw":85,"./ar-kw.js":85,"./ar-ly":86,"./ar-ly.js":86,"./ar-ma":87,"./ar-ma.js":87,"./ar-sa":88,"./ar-sa.js":88,"./ar-tn":89,"./ar-tn.js":89,"./ar.js":83,"./az":90,"./az.js":90,"./be":91,"./be.js":91,"./bg":92,"./bg.js":92,"./bm":93,"./bm.js":93,"./bn":94,"./bn-bd":95,"./bn-bd.js":95,"./bn.js":94,"./bo":96,"./bo.js":96,"./br":97,"./br.js":97,"./bs":98,"./bs.js":98,"./ca":99,"./ca.js":99,"./cs":100,"./cs.js":100,"./cv":101,"./cv.js":101,"./cy":102,"./cy.js":102,"./da":103,"./da.js":103,"./de":104,"./de-at":105,"./de-at.js":105,"./de-ch":106,"./de-ch.js":106,"./de.js":104,"./dv":107,"./dv.js":107,"./el":108,"./el.js":108,"./en-au":109,"./en-au.js":109,"./en-ca":110,"./en-ca.js":110,"./en-gb":111,"./en-gb.js":111,"./en-ie":112,"./en-ie.js":112,"./en-il":113,"./en-il.js":113,"./en-in":114,"./en-in.js":114,"./en-nz":115,"./en-nz.js":115,"./en-sg":116,"./en-sg.js":116,"./eo":117,"./eo.js":117,"./es":118,"./es-do":119,"./es-do.js":119,"./es-mx":120,"./es-mx.js":120,"./es-us":121,"./es-us.js":121,"./es.js":118,"./et":122,"./et.js":122,"./eu":123,"./eu.js":123,"./fa":124,"./fa.js":124,"./fi":125,"./fi.js":125,"./fil":126,"./fil.js":126,"./fo":127,"./fo.js":127,"./fr":128,"./fr-ca":129,"./fr-ca.js":129,"./fr-ch":130,"./fr-ch.js":130,"./fr.js":128,"./fy":131,"./fy.js":131,"./ga":132,"./ga.js":132,"./gd":133,"./gd.js":133,"./gl":134,"./gl.js":134,"./gom-deva":135,"./gom-deva.js":135,"./gom-latn":136,"./gom-latn.js":136,"./gu":137,"./gu.js":137,"./he":138,"./he.js":138,"./hi":139,"./hi.js":139,"./hr":140,"./hr.js":140,"./hu":141,"./hu.js":141,"./hy-am":142,"./hy-am.js":142,"./id":143,"./id.js":143,"./is":144,"./is.js":144,"./it":145,"./it-ch":146,"./it-ch.js":146,"./it.js":145,"./ja":147,"./ja.js":147,"./jv":148,"./jv.js":148,"./ka":149,"./ka.js":149,"./kk":150,"./kk.js":150,"./km":151,"./km.js":151,"./kn":152,"./kn.js":152,"./ko":153,"./ko.js":153,"./ku":154,"./ku.js":154,"./ky":155,"./ky.js":155,"./lb":156,"./lb.js":156,"./lo":157,"./lo.js":157,"./lt":158,"./lt.js":158,"./lv":159,"./lv.js":159,"./me":160,"./me.js":160,"./mi":161,"./mi.js":161,"./mk":162,"./mk.js":162,"./ml":163,"./ml.js":163,"./mn":164,"./mn.js":164,"./mr":165,"./mr.js":165,"./ms":166,"./ms-my":167,"./ms-my.js":167,"./ms.js":166,"./mt":168,"./mt.js":168,"./my":169,"./my.js":169,"./nb":170,"./nb.js":170,"./ne":171,"./ne.js":171,"./nl":172,"./nl-be":173,"./nl-be.js":173,"./nl.js":172,"./nn":174,"./nn.js":174,"./oc-lnc":175,"./oc-lnc.js":175,"./pa-in":176,"./pa-in.js":176,"./pl":177,"./pl.js":177,"./pt":178,"./pt-br":179,"./pt-br.js":179,"./pt.js":178,"./ro":180,"./ro.js":180,"./ru":181,"./ru.js":181,"./sd":182,"./sd.js":182,"./se":183,"./se.js":183,"./si":184,"./si.js":184,"./sk":185,"./sk.js":185,"./sl":186,"./sl.js":186,"./sq":187,"./sq.js":187,"./sr":188,"./sr-cyrl":189,"./sr-cyrl.js":189,"./sr.js":188,"./ss":190,"./ss.js":190,"./sv":191,"./sv.js":191,"./sw":192,"./sw.js":192,"./ta":193,"./ta.js":193,"./te":194,"./te.js":194,"./tet":195,"./tet.js":195,"./tg":196,"./tg.js":196,"./th":197,"./th.js":197,"./tk":198,"./tk.js":198,"./tl-ph":199,"./tl-ph.js":199,"./tlh":200,"./tlh.js":200,"./tr":201,"./tr.js":201,"./tzl":202,"./tzl.js":202,"./tzm":203,"./tzm-latn":204,"./tzm-latn.js":204,"./tzm.js":203,"./ug-cn":205,"./ug-cn.js":205,"./uk":206,"./uk.js":206,"./ur":207,"./ur.js":207,"./uz":208,"./uz-latn":209,"./uz-latn.js":209,"./uz.js":208,"./vi":210,"./vi.js":210,"./x-pseudo":211,"./x-pseudo.js":211,"./yo":212,"./yo.js":212,"./zh-cn":213,"./zh-cn.js":213,"./zh-hk":214,"./zh-hk.js":214,"./zh-mo":215,"./zh-mo.js":215,"./zh-tw":216,"./zh-tw.js":216};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id=271},function(e,t){angular.module("rainbow").factory("CompanyRequest",[function(){function e(e,t,n,r,i,a,o,s,c,l,u){this.id=e,this.requestingUserId=t,this.requestingUserLoginEmail=n,this.requestedCompanyId=r,this.requestedCompanyName=i,this.status=a,this.requestingDate=o,this.requestedNotificationLanguage=s,this.lastNotificationDate=c,this.requestedToCompanyAdmin=l,this.requestedCompanyInvitationId=u}return e.createFromData=function(t){return new e(t.id,t.requestingUserId,t.requestingUserLoginEmail,t.requestedCompanyId,t.requestedCompanyName,t.status,t.requestingDate,t.requestedNotificationLanguage,t.lastNotificationDate,t.requestedToCompanyAdmin,t.requestedCompanyInvitationId)},e}])},function(e,t){angular.module("rainbow").factory("CompanyBpLinkInvitation",[function(){function e(e,t,n,r,i,a,o,s,c,l,u,d,h,f,p){this.id=e,this.invitedCompanyId=t,this.invitedCompanyName=n,this.invitedToBeBpIr=r,this.invitingAdminId=i,this.invitingAdminLoginEmail=a,this.invitingCompanyId=o,this.invitingCompanyName=s,this.invitationDate=c,this.lastNotificationDate=l,this.requestedNotificationLanguage=u,this.status=d,this.acceptationDate=h,this.cancelationDate=f,this.declinationDate=p}return e.createFromData=function(t){return new e(t.id,t.invitedCompanyId,t.invitedCompanyName,t.invitedToBeBpIr,t.invitingAdminId,t.invitingAdminLoginEmail,t.invitingCompanyId,t.invitingCompanyName,t.invitationDate,t.lastNotificationDate,t.requestedNotificationLanguage,t.status,t.acceptationDate,t.cancelationDate,t.declinationDate)},e}])},function(e,t){angular.module("rainbow").factory("CompanyBpLinkRequest",[function(){function e(e,t,n,r,i,a,o,s,c,l,u,d,h,f,p){this.id=e,this.requestingAdminId=t,this.requestingAdminLoginEmail=n,this.requestingCompanyId=r,this.requestingCompanyName=i,this.requestedCompanyId=a,this.requestedCompanyName=o,this.requestedToBeBpIr=s,this.requestDate=c,this.lastNotificationDate=l,this.requestedNotificationLanguage=u,this.status=d,this.acceptationDate=h,this.cancelationDate=f,this.declinationDate=p}return e.createFromData=function(t){return new e(t.id,t.requestingAdminId,t.requestingAdminLoginEmail,t.requestingCompanyId,t.requestingCompanyName,t.requestedCompanyId,t.requestedCompanyName,t.requestedToBeBpIr,t.requestDate,t.lastNotificationDate,t.requestedNotificationLanguage,t.status,t.acceptationDate,t.cancelationDate,t.declinationDate)},e}])},function(e,t){angular.module("rainbow").factory("Conference",[function(){function e(e,t,n,r,i,a,o,s,c,l,u){this.companyId=e,this.id=t,this.mediaType=n,this.name=r,this.passCodes=i||[],this.scheduled=a,this.lastUpdateDate=o,this.userId=s,this.confDialOutDisabled=c,this.playEntryTone=l,this.muteUponEntry=u,this.updateFromData=function(e){this.companyId=e.companyId,this.id=e.id,this.mediaType=e.mediaType,this.name=e.name,this.passCodes=e.passCodes,this.scheduled=e.scheduled,this.lastUpdateDate=e.lastUpdateDate,this.userId=e.userId,this.confDialOutDisabled=e.confDialOutDisabled,this.playEntryTone=e.playEntryTone,this.muteUponEntry=e.muteUponEntry}}return e.createFromData=function(t){return new e(t.companyId,t.id,t.mediaType,t.name,t.passCodes,t.scheduled,t.lastUpdateDate,t.userId,t.confDialOutDisabled,t.playEntryTone,t.muteUponEntry)},e}])},function(e,t,n){n.r(t);var r=n(1),i=n.n(r),a=n(77);angular.module("rainbow").factory("ConferenceSession",["$log","ConferenceParticipant","$q","$interval",function(e,t,n,r){function o(s,c,l,u){var d=this;d.id=s,d.participants=c,d.active=l,d.talkerActive=void 0,d.recordingStarted=void 0,d.talkers=void 0,d.talkerSubject=new a.a(this.talkers),d.isLeaderAlreadyConnected=!1,d.status=null,d.localStreams=[],d.sessions={},d.publishers=[],d.type=u,d.callId=null,d.hasLocalVideo=!1,d.jingleJid=null,d.localVideoSessionId=null,d.localSharingSessionId=null,d.haveJoined=!1,d.lock=!1,d.duration=0,d.durationTimer=null,d.conferenceStats=null,d.control={activeControl:!1,hasRemoteControlling:!1,controller:null,controlled:null},d.conferenceView=o.ConferenceView.GalleryView,d.networkQuality=0,d.isMyConference=!1,d.cleanupSessionData=function(){e.debug("[ConferenceSession] Cleanup for conferenceSession "+d.id),d.participants=[],d.talkerActive=void 0,d.recordingStarted=void 0,d.talkers=void 0,d.isLeaderAlreadyConnected=!1,d.localStreams=[],d.sessions={},d.publishers=[],d.hasLocalVideo=!1,d.metricsState="",d.recordingStarted=!1,d.status="ended",d.hasLocalSharing=!1,d.reversedVideos=!1,d.jingleJid=null,d.localVideoSessionId=null,d.localSharingSessionId=null,d.haveJoined=!1,d.lock=!1,d.duration=0,d.conferenceStats=null,d.durationTimer&&(r.cancel(d.durationTimer),d.durationTimer=null),d.conferenceView=o.ConferenceView.GalleryView,d.joinedFromOtherDevice=!1},d.updateFromData=function(e,t,n){d.id=e,d.participants=t,d.active=n},d.updateActiveState=function(e){d.active=e},d.updateStateFromData=function(e,t,n,r){d.active=e,d.talkerActive=t,d.recordingStarted=n,d.lock=r},d.updateParticipants=function(r){return n((function(n){var i=!1;r||n(!1),d.participants||(d.participants=[]),0===r.length&&(d.participants=[]),r.forEach((function(n){if(n.participantId){e.debug("[conferenceSession] updateParticipants participantId="+n.participantId);var r=d.getParticipantById(n.participantId)?d.getParticipantById(n.participantId):n.jid_im?d.getParticipantByJid(n.jid_im):null;if(r)e.debug("[conferenceSession] updateParticipants update participantId="+n.participantId),r.updateFromData(n);else{e.debug("[conferenceSession] updateParticipants create participantId="+n.participantId);var a=t.createFromData(n);d.participants.push(a),i=a}}})),n(i)}))},d.removeParticipants=function(t){t&&t.forEach((function(t){var n=d.getParticipantIndexById(t);-1!==n&&(e.debug("[conferenceSession] removeParticipants remove participantId="+t),d.participants.splice(n,1))}))},d.removePublisher=function(t){if(t){var n=d.getPublisherIndexById(t);-1!==n&&(e.debug("[conferenceSession] removePublisher remove participantId="+t),d.publishers.splice(n,1))}},d.updateTalkers=function(t){e.debug("[conferenceSession] updateTalkers talkers="+t),d.talkers=t,d.talkerSubject.next(d.talkers)},d.isActive=function(){return void 0!==d.active&&d.active},d.isTalkerActive=function(){return void 0!==d.talkerActive&&d.talkerActive},d.isRecordingStarted=function(){return void 0!==d.recordingStarted&&d.recordingStarted},d.getParticipants=function(){return d.participants},d.getConnectedParticipants=function(){return d.participants?d.participants.filter((function(e){return"disconnected"!==e.state&&"watching"!==e.state})):void 0},d.getWatchingParticipants=function(){return d.participants?d.participants.filter((function(e){return"watching"===e.state})):void 0},d.getConnectedParticipantsExceptLeader=function(){return d.participants?d.participants.filter((function(e){return"disconnected"!==e.state&&"watching"!==e.state&&"moderator"!==e.role})):void 0},d.getConnectedLeaderParticipantsExcept=function(e){return d.participants?d.participants.filter((function(t){return"disconnected"!==t.state&&"moderator"===t.role&&t.jid_im!==e})):void 0},d.getConnectedParticipantsExcept=function(e){return d.participants?d.participants.filter((function(t){return t.jid_im!==e&&"disconnected"!==t.state&&"watching"!==t.state})):void 0},d.getLeaderParticipant=function(){return d.participants?d.participants.find((function(e){return"moderator"===e.role&&"disconnected"!==e.state&&"watching"!==e.state})):void 0},d.getLeaderParticipantById=function(e){return d.participants?d.participants.find((function(t){return"moderator"===t.role&&"disconnected"!==t.state&&"watching"!==t.state&&t.jid_im===e})):void 0},d.getParticipantById=function(e){return d.participants?d.participants.find((function(t){return t.participantId===e})):void 0},d.getParticipantByJid=function(e){return d.participants?d.participants.find((function(t){return t.jid_im===e})):void 0},d.getNonDisconnectedParticipantByJid=function(e){return d.participants?d.participants.find((function(t){return t.jid_im===e&&"disconnected"!==t.state})):void 0},d.getConnectedParticipantByJid=function(e){return d.participants?d.participants.find((function(t){return t.jid_im===e&&"connected"===t.state})):void 0},d.getWatchingParticipantByJid=function(e){return d.participants?d.participants.find((function(t){return t.jid_im===e&&"watching"===t.state})):void 0},d.getParticipantIndexById=function(e){return d.participants?d.participants.findIndex((function(t){return t.participantId===e})):-1},d.getPublisherIndexById=function(e){return d.publishers?d.publishers.findIndex((function(t){return t.participantId===e})):-1},d.getPublisherById=function(e){return d.publishers?d.publishers.find((function(t){return t.participantId===e})):void 0},d.isParticipantConnectedByJid=function(e){return void 0!==d.participants&&d.participants.some((function(t){return t.jid_im===e&&"connected"===t.state}))},d.isParticipantWatchingByJid=function(e){return void 0!==d.participants&&d.participants.some((function(t){return t.jid_im===e&&"watching"===t.state}))},d.isParticipantRingingByJid=function(e){return void 0!==d.participants&&d.participants.some((function(t){return t.jid_im===e&&"ringing"===t.state}))},d.isParticipantConnectedWithThisUAByJid=function(e){return d.haveJoined&&void 0!==d.participants&&d.participants.some((function(t){return t.jid_im===e&&"connected"===t.state}))},d.checkIfParticipantHasVideoByPublisherId=function(e){var t=!1;if(d.publishers)for(var n=0;n<d.publishers.length;n++)if("video"===d.publishers[n].mediaType&&d.publishers[n].participantId===e){t=!0;break}return t},d.getCurrentSharingParticipant=function(){var e=null;if(d.publishers)for(var t=0;t<d.publishers.length;t++)if("sharing"===d.publishers[t].mediaType){e=d.publishers[t].participantId;break}return e&&d.participants?d.participants.find((function(t){return t.participantId===e})):void 0},d.getDelegateParticipantsListExcept=function(e){var t=[],n=this.getConnectedParticipantsExcept(e);if(n)for(var r=0;r<n.length;r++)n[r].delegateCapability&&t.push(n[r]);return t},d.getTalkers=function(){return d.talkers},d.setCallId=function(e){d.callId=e},d.getListOfRemoteVideoPublishers=function(){var e=[];if(d.publishers)for(var t=0;t<d.publishers.length;t++)"video"===d.publishers[t].mediaType&&d.publishers[t].jid_im!==i.a.userContact.jid&&e.push(d.publishers[t]);return e},d.startDuration=function(){d.durationTimer||(d.durationTimer=r((function(){d.duration++}),1e3))},d.stopDuration=function(){d.durationTimer&&(r.cancel(d.durationTimer),d.durationTimer=null,d.duration=0)},d.isInConferenceWithDesktopApp=function(){var e=d.getCurrentSharingParticipant();return!(!e||!e.contact)&&-1!==e.contact.fullJid.indexOf("desk_")}}return o.createFromData=function(e,t,n,r){return r||(r="pstnAudio"),new o(e,t,n,r)},o.ConferenceView={GalleryView:"gallery_view",SpeakerView:"speaker_view",GridView:"grid_view"},o}])},function(e,t,n){var r;e.exports=(r=n(12),function(){if("function"==typeof ArrayBuffer){var e=r.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,r=[],i=0;i<n;i++)r[i>>>2]|=e[i]<<24-i%4*8;t.call(this,r,n)}else t.apply(this,arguments)}).prototype=e}}(),r.lib.WordArray)},function(e,t,n){var r;e.exports=(r=n(12),function(){var e=r,t=e.lib.WordArray,n=e.enc;function i(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i+=2){var a=t[i>>>2]>>>16-i%4*8&65535;r.push(String.fromCharCode(a))}return r.join("")},parse:function(e){for(var n=e.length,r=[],i=0;i<n;i++)r[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return t.create(r,2*n)}},n.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],a=0;a<n;a+=2){var o=i(t[a>>>2]>>>16-a%4*8&65535);r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var n=e.length,r=[],a=0;a<n;a++)r[a>>>1]|=i(e.charCodeAt(a)<<16-a%2*16);return t.create(r,2*n)}}}(),r.enc.Utf16)},function(e,t,n){var r,i,a,o,s,c;e.exports=(c=n(12),n(217),i=(r=c).lib.WordArray,a=r.algo,o=a.SHA256,s=a.SHA224=o.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=o._doFinalize.call(this);return e.sigBytes-=4,e}}),r.SHA224=o._createHelper(s),r.HmacSHA224=o._createHmacHelper(s),c.SHA224)},function(e,t,n){var r,i,a,o,s,c,l,u;e.exports=(u=n(12),n(61),n(218),i=(r=u).x64,a=i.Word,o=i.WordArray,s=r.algo,c=s.SHA512,l=s.SHA384=c.extend({_doReset:function(){this._hash=new o.init([new a.init(3418070365,3238371032),new a.init(1654270250,914150663),new a.init(2438529370,812702999),new a.init(355462360,4144912697),new a.init(1731405415,4290775857),new a.init(2394180231,1750603025),new a.init(3675008525,1694076839),new a.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),r.SHA384=c._createHelper(l),r.HmacSHA384=c._createHmacHelper(l),u.SHA384)},function(e,t,n){var r;e.exports=(r=n(12),n(61),function(e){var t=r,n=t.lib,i=n.WordArray,a=n.Hasher,o=t.x64.Word,s=t.algo,c=[],l=[],u=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var r=(2*e+3*t)%5;e=t%5,t=r}for(e=0;e<5;e++)for(t=0;t<5;t++)l[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,a=0;a<24;a++){for(var s=0,d=0,h=0;h<7;h++){if(1&i){var f=(1<<h)-1;f<32?d^=1<<f:s^=1<<f-32}128&i?i=i<<1^113:i<<=1}u[a]=o.create(s,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=o.create()}();var h=s.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,r=this.blockSize/2,i=0;i<r;i++){var a=e[t+2*i],o=e[t+2*i+1];a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),(D=n[i]).high^=o,D.low^=a}for(var s=0;s<24;s++){for(var h=0;h<5;h++){for(var f=0,p=0,m=0;m<5;m++)f^=(D=n[h+5*m]).high,p^=D.low;var v=d[h];v.high=f,v.low=p}for(h=0;h<5;h++){var g=d[(h+4)%5],y=d[(h+1)%5],b=y.high,S=y.low;for(f=g.high^(b<<1|S>>>31),p=g.low^(S<<1|b>>>31),m=0;m<5;m++)(D=n[h+5*m]).high^=f,D.low^=p}for(var _=1;_<25;_++){var C=(D=n[_]).high,w=D.low,E=c[_];E<32?(f=C<<E|w>>>32-E,p=w<<E|C>>>32-E):(f=w<<E-32|C>>>64-E,p=C<<E-32|w>>>64-E);var T=d[l[_]];T.high=f,T.low=p}var k=d[0],M=n[0];for(k.high=M.high,k.low=M.low,h=0;h<5;h++)for(m=0;m<5;m++){var D=n[_=h+5*m],x=d[_],R=d[(h+1)%5+5*m],O=d[(h+2)%5+5*m];D.high=x.high^~R.high&O.high,D.low=x.low^~R.low&O.low}D=n[0];var I=u[s];D.high^=I.high,D.low^=I.low}},_doFinalize:function(){var t=this._data,n=t.words,r=(this._nDataBytes,8*t.sigBytes),a=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(e.ceil((r+1)/a)*a>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var o=this._state,s=this.cfg.outputLength/8,c=s/8,l=[],u=0;u<c;u++){var d=o[u],h=d.high,f=d.low;h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),l.push(f),l.push(h)}return new i.init(l,s)},clone:function(){for(var e=a.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=a._createHelper(h),t.HmacSHA3=a._createHmacHelper(h)}(Math),r.SHA3)},function(e,t,n){var r;e.exports=(r=n(12),function(e){var t=r,n=t.lib,i=n.WordArray,a=n.Hasher,o=t.algo,s=i.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=i.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=i.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=i.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=i.create([0,1518500249,1859775393,2400959708,2840853838]),h=i.create([1352829926,1548603684,1836072691,2053994217,0]),f=o.RIPEMD160=a.extend({_doReset:function(){this._hash=i.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var a,o,f,S,_,C,w,E,T,k,M,D=this._hash.words,x=d.words,R=h.words,O=s.words,I=c.words,P=l.words,A=u.words;for(C=a=D[0],w=o=D[1],E=f=D[2],T=S=D[3],k=_=D[4],n=0;n<80;n+=1)M=a+e[t+O[n]]|0,M+=n<16?p(o,f,S)+x[0]:n<32?m(o,f,S)+x[1]:n<48?v(o,f,S)+x[2]:n<64?g(o,f,S)+x[3]:y(o,f,S)+x[4],M=(M=b(M|=0,P[n]))+_|0,a=_,_=S,S=b(f,10),f=o,o=M,M=C+e[t+I[n]]|0,M+=n<16?y(w,E,T)+R[0]:n<32?g(w,E,T)+R[1]:n<48?v(w,E,T)+R[2]:n<64?m(w,E,T)+R[3]:p(w,E,T)+R[4],M=(M=b(M|=0,A[n]))+k|0,C=k,k=T,T=b(E,10),E=w,w=M;M=D[1]+f+T|0,D[1]=D[2]+S+k|0,D[2]=D[3]+_+C|0,D[3]=D[4]+a+w|0,D[4]=D[0]+o+E|0,D[0]=M},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,a=i.words,o=0;o<5;o++){var s=a[o];a[o]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return i},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function p(e,t,n){return e^t^n}function m(e,t,n){return e&t|~e&n}function v(e,t,n){return(e|~t)^n}function g(e,t,n){return e&n|t&~n}function y(e,t,n){return e^(t|~n)}function b(e,t){return e<<t|e>>>32-t}t.RIPEMD160=a._createHelper(f),t.HmacRIPEMD160=a._createHmacHelper(f)}(Math),r.RIPEMD160)},function(e,t,n){var r,i,a,o,s,c,l,u,d;e.exports=(d=n(12),n(72),n(73),a=(i=(r=d).lib).Base,o=i.WordArray,c=(s=r.algo).SHA1,l=s.HMAC,u=s.PBKDF2=a.extend({cfg:a.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=l.create(n.hasher,e),i=o.create(),a=o.create([1]),s=i.words,c=a.words,u=n.keySize,d=n.iterations;s.length<u;){var h=r.update(t).finalize(a);r.reset();for(var f=h.words,p=f.length,m=h,v=1;v<d;v++){m=r.finalize(m),r.reset();for(var g=m.words,y=0;y<p;y++)f[y]^=g[y]}i.concat(h),c[0]++}return i.sigBytes=4*u,i}}),r.PBKDF2=function(e,t,n){return u.create(n).compute(e,t)},d.PBKDF2)},function(e,t,n){var r;e.exports=(r=n(12),n(20),r.mode.CFB=function(){var e=r.lib.BlockCipherMode.extend();function t(e,t,n,r){var i=this._iv;if(i){var a=i.slice(0);this._iv=void 0}else a=this._prevBlock;r.encryptBlock(a,0);for(var o=0;o<n;o++)e[t+o]^=a[o]}return e.Encryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize;t.call(this,e,n,i,r),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize,a=e.slice(n,n+i);t.call(this,e,n,i,r),this._prevBlock=a}}),e}(),r.mode.CFB)},function(e,t,n){var r,i,a;e.exports=(a=n(12),n(20),a.mode.CTR=(i=(r=a.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,a=this._counter;i&&(a=this._counter=i.slice(0),this._iv=void 0);var o=a.slice(0);n.encryptBlock(o,0),a[r-1]=a[r-1]+1|0;for(var s=0;s<r;s++)e[t+s]^=o[s]}}),r.Decryptor=i,r),a.mode.CTR)},function(e,t,n){var r;e.exports=(r=n(12),n(20),r.mode.CTRGladman=function(){var e=r.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,n=e>>8&255,r=255&e;255===t?(t=0,255===n?(n=0,255===r?r=0:++r):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=r}else e+=1<<24;return e}var n=e.Encryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize,a=this._iv,o=this._counter;a&&(o=this._counter=a.slice(0),this._iv=void 0),function(e){0===(e[0]=t(e[0]))&&(e[1]=t(e[1]))}(o);var s=o.slice(0);r.encryptBlock(s,0);for(var c=0;c<i;c++)e[n+c]^=s[c]}});return e.Decryptor=n,e}(),r.mode.CTRGladman)},function(e,t,n){var r,i,a;e.exports=(a=n(12),n(20),a.mode.OFB=(i=(r=a.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,a=this._keystream;i&&(a=this._keystream=i.slice(0),this._iv=void 0),n.encryptBlock(a,0);for(var o=0;o<r;o++)e[t+o]^=a[o]}}),r.Decryptor=i,r),a.mode.OFB)},function(e,t,n){var r,i;e.exports=(i=n(12),n(20),i.mode.ECB=((r=i.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),r.Decryptor=r.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),r),i.mode.ECB)},function(e,t,n){var r;e.exports=(r=n(12),n(20),r.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,r=4*t,i=r-n%r,a=n+i-1;e.clamp(),e.words[a>>>2]|=i<<24-a%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Ansix923)},function(e,t,n){var r;e.exports=(r=n(12),n(20),r.pad.Iso10126={pad:function(e,t){var n=4*t,i=n-e.sigBytes%n;e.concat(r.lib.WordArray.random(i-1)).concat(r.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Iso10126)},function(e,t,n){var r;e.exports=(r=n(12),n(20),r.pad.Iso97971={pad:function(e,t){e.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(e,t)},unpad:function(e){r.pad.ZeroPadding.unpad(e),e.sigBytes--}},r.pad.Iso97971)},function(e,t,n){var r;e.exports=(r=n(12),n(20),r.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},r.pad.ZeroPadding)},function(e,t,n){var r;e.exports=(r=n(12),n(20),r.pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding)},function(e,t,n){var r,i,a,o;e.exports=(o=n(12),n(20),i=(r=o).lib.CipherParams,a=r.enc.Hex,r.format.Hex={stringify:function(e){return e.ciphertext.toString(a)},parse:function(e){var t=a.parse(e);return i.create({ciphertext:t})}},o.format.Hex)},function(e,t,n){var r;e.exports=(r=n(12),n(46),n(47),n(40),n(20),function(){var e=r,t=e.lib.BlockCipher,n=e.algo,i=[],a=[],o=[],s=[],c=[],l=[],u=[],d=[],h=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,r=0;for(t=0;t<256;t++){var p=r^r<<1^r<<2^r<<3^r<<4;p=p>>>8^255&p^99,i[n]=p,a[p]=n;var m=e[n],v=e[m],g=e[v],y=257*e[p]^16843008*p;o[n]=y<<24|y>>>8,s[n]=y<<16|y>>>16,c[n]=y<<8|y>>>24,l[n]=y,y=16843009*g^65537*v^257*m^16843008*n,u[p]=y<<24|y>>>8,d[p]=y<<16|y>>>16,h[p]=y<<8|y>>>24,f[p]=y,n?(n=m^e[e[e[g^m]]],r^=e[e[r]]):n=r=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],m=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=4*((this._nRounds=n+6)+1),a=this._keySchedule=[],o=0;o<r;o++)if(o<n)a[o]=t[o];else{var s=a[o-1];o%n?n>6&&o%n==4&&(s=i[s>>>24]<<24|i[s>>>16&255]<<16|i[s>>>8&255]<<8|i[255&s]):(s=i[(s=s<<8|s>>>24)>>>24]<<24|i[s>>>16&255]<<16|i[s>>>8&255]<<8|i[255&s],s^=p[o/n|0]<<24),a[o]=a[o-n]^s}for(var c=this._invKeySchedule=[],l=0;l<r;l++)o=r-l,s=l%4?a[o]:a[o-4],c[l]=l<4||o<=4?s:u[i[s>>>24]]^d[i[s>>>16&255]]^h[i[s>>>8&255]]^f[i[255&s]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,s,c,l,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,d,h,f,a),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,a,o,s){for(var c=this._nRounds,l=e[t]^n[0],u=e[t+1]^n[1],d=e[t+2]^n[2],h=e[t+3]^n[3],f=4,p=1;p<c;p++){var m=r[l>>>24]^i[u>>>16&255]^a[d>>>8&255]^o[255&h]^n[f++],v=r[u>>>24]^i[d>>>16&255]^a[h>>>8&255]^o[255&l]^n[f++],g=r[d>>>24]^i[h>>>16&255]^a[l>>>8&255]^o[255&u]^n[f++],y=r[h>>>24]^i[l>>>16&255]^a[u>>>8&255]^o[255&d]^n[f++];l=m,u=v,d=g,h=y}m=(s[l>>>24]<<24|s[u>>>16&255]<<16|s[d>>>8&255]<<8|s[255&h])^n[f++],v=(s[u>>>24]<<24|s[d>>>16&255]<<16|s[h>>>8&255]<<8|s[255&l])^n[f++],g=(s[d>>>24]<<24|s[h>>>16&255]<<16|s[l>>>8&255]<<8|s[255&u])^n[f++],y=(s[h>>>24]<<24|s[l>>>16&255]<<16|s[u>>>8&255]<<8|s[255&d])^n[f++],e[t]=m,e[t+1]=v,e[t+2]=g,e[t+3]=y},keySize:8});e.AES=t._createHelper(m)}(),r.AES)},function(e,t,n){var r;e.exports=(r=n(12),n(46),n(47),n(40),n(20),function(){var e=r,t=e.lib,n=t.WordArray,i=t.BlockCipher,a=e.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=a.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var r=o[n]-1;t[n]=e[r>>>5]>>>31-r%32&1}for(var i=this._subKeys=[],a=0;a<16;a++){var l=i[a]=[],u=c[a];for(n=0;n<24;n++)l[n/6|0]|=t[(s[n]-1+u)%28]<<31-n%6,l[4+(n/6|0)]|=t[28+(s[n+24]-1+u)%28]<<31-n%6;for(l[0]=l[0]<<1|l[0]>>>31,n=1;n<7;n++)l[n]=l[n]>>>4*(n-1)+3;l[7]=l[7]<<5|l[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=i[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],h.call(this,4,252645135),h.call(this,16,65535),f.call(this,2,858993459),f.call(this,8,16711935),h.call(this,1,1431655765);for(var r=0;r<16;r++){for(var i=n[r],a=this._lBlock,o=this._rBlock,s=0,c=0;c<8;c++)s|=l[c][((o^i[c])&u[c])>>>0];this._lBlock=o,this._rBlock=a^s}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,h.call(this,1,1431655765),f.call(this,8,16711935),f.call(this,2,858993459),h.call(this,16,65535),h.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function h(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function f(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=i._createHelper(d);var p=a.TripleDES=i.extend({_doReset:function(){var e=this._key.words;this._des1=d.createEncryptor(n.create(e.slice(0,2))),this._des2=d.createEncryptor(n.create(e.slice(2,4))),this._des3=d.createEncryptor(n.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=i._createHelper(p)}(),r.TripleDES)},function(e,t,n){var r;e.exports=(r=n(12),n(46),n(47),n(40),n(20),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,i=n.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,r=this._S=[],i=0;i<256;i++)r[i]=i;i=0;for(var a=0;i<256;i++){var o=i%n,s=t[o>>>2]>>>24-o%4*8&255;a=(a+r[i]+s)%256;var c=r[i];r[i]=r[a],r[a]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=a.call(this)},keySize:8,ivSize:0});function a(){for(var e=this._S,t=this._i,n=this._j,r=0,i=0;i<4;i++){n=(n+e[t=(t+1)%256])%256;var a=e[t];e[t]=e[n],e[n]=a,r|=e[(e[t]+e[n])%256]<<24-8*i}return this._i=t,this._j=n,r}e.RC4=t._createHelper(i);var o=n.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)a.call(this)}});e.RC4Drop=t._createHelper(o)}(),r.RC4)},function(e,t,n){var r;e.exports=(r=n(12),n(46),n(47),n(40),n(20),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,i=[],a=[],o=[],s=n.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)i[n]^=r[n+4&7];if(t){var a=t.words,o=a[0],s=a[1],l=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=l>>>16|4294901760&u,h=u<<16|65535&l;for(i[0]^=l,i[1]^=d,i[2]^=u,i[3]^=h,i[4]^=l,i[5]^=d,i[6]^=u,i[7]^=h,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)a[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<a[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<a[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<a[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<a[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<a[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<a[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<a[6]>>>0?1:0)|0,this._b=t[7]>>>0<a[7]>>>0?1:0,n=0;n<8;n++){var r=e[n]+t[n],i=65535&r,s=r>>>16,c=((i*i>>>17)+i*s>>>15)+s*s,l=((4294901760&r)*r|0)+((65535&r)*r|0);o[n]=c^l}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.Rabbit=t._createHelper(s)}(),r.Rabbit)},function(e,t,n){var r;e.exports=(r=n(12),n(46),n(47),n(40),n(20),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,i=[],a=[],o=[],s=n.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)c.call(this);for(i=0;i<8;i++)r[i]^=n[i+4&7];if(t){var a=t.words,o=a[0],s=a[1],l=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=l>>>16|4294901760&u,h=u<<16|65535&l;for(r[0]^=l,r[1]^=d,r[2]^=u,r[3]^=h,r[4]^=l,r[5]^=d,r[6]^=u,r[7]^=h,i=0;i<4;i++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)a[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<a[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<a[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<a[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<a[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<a[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<a[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<a[6]>>>0?1:0)|0,this._b=t[7]>>>0<a[7]>>>0?1:0,n=0;n<8;n++){var r=e[n]+t[n],i=65535&r,s=r>>>16,c=((i*i>>>17)+i*s>>>15)+s*s,l=((4294901760&r)*r|0)+((65535&r)*r|0);o[n]=c^l}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.RabbitLegacy=t._createHelper(s)}(),r.RabbitLegacy)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){if(S(this,e),this.type=null,this.loginUrl=null,this.logoutUrl=null,this.safetyUrl=null,this.userId=null,t.length>0){var n;n=1===t.length?t[0]:t.reduce((function(e,t){return"RAINBOW"===t.type&&"RAINBOW"!==e.type?(e.safetyUrl=t.url||t.loginUrl,e):(t.safetyUrl=e.url||e.loginUrl,t)})),this.type=n.type,this.loginUrl=n.url||n.loginUrl,this.logoutUrl=n.logoutUrl,this.safetyUrl=n.safetyUrl}}return C(e,[{key:"setParameter",value:function(e,t){switch(e){case"uid":this.userId=t();break;case"x-rainbow-app-auth":if("RAINBOW"!==this.type&&this.loginUrl){var n=new URL(this.loginUrl),r=t(n.searchParams.get("challenge"));n.searchParams.append(e,r),this.loginUrl=n.href}break;case"token":if("RAINBOW"!==this.type&&this.logoutUrl){var i=new URL(this.logoutUrl),a=t();i.searchParams.append(e,a),this.logoutUrl=i.href}break;case"safetyUrl":"RAINBOW"===this.type||this.safetyUrl||(this.safetyUrl=t())}}}],[{key:"createFromData",value:function(t){return new e(t)}}]),e}();t.AuthSettings=r},function(e,t,n){var r=n(302);function i(e){this.message=e}i.prototype=new Error,i.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new i("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(r(e.split(".")[n]))}catch(a){throw new i("Invalid token specified: "+a.message)}},e.exports.InvalidTokenError=i},function(e,t,n){var r=n(303);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(n){return r(t)}}},function(e,t){function n(e){this.message=e}n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,i,a=0,o=0,s="";i=t.charAt(o++);~i&&(r=a%4?64*r+i:i,a++%4)?s+=String.fromCharCode(255&r>>(-2*a&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return s}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;return Promise.race([fetch(e,t),new Promise((function(e,t){return setTimeout((function(){return t(new Error("timeout"))}),n)}))])}},function(e,t,n){var r,i,a;i="undefined"!=typeof window?window:this,a=function(n,i){var a=[],o=Object.getPrototypeOf,s=a.slice,c=a.flat?function(e){return a.flat.call(e)}:function(e){return a.concat.apply([],e)},l=a.push,u=a.indexOf,d={},h=d.toString,f=d.hasOwnProperty,p=f.toString,m=p.call(Object),v={},g=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},b=n.document,S={type:!0,src:!0,nonce:!0,noModule:!0};function _(e,t,n){var r,i,a=(n=n||b).createElement("script");if(a.text=e,t)for(r in S)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&a.setAttribute(r,i);n.head.appendChild(a).parentNode.removeChild(a)}function C(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?d[h.call(e)]||"object":typeof e}var w=function e(t,n){return new e.fn.init(t,n)};function E(e){var t=!!e&&"length"in e&&e.length,n=C(e);return!g(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}w.fn=w.prototype={jquery:"3.5.1",constructor:w,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(w.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(w.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:a.sort,splice:a.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,a,o=arguments[0]||{},s=1,c=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[s]||{},s++),"object"==typeof o||g(o)||(o={}),s===c&&(o=this,s--);s<c;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&o!==r&&(l&&r&&(w.isPlainObject(r)||(i=Array.isArray(r)))?(n=o[t],a=i&&!Array.isArray(n)?[]:i||w.isPlainObject(n)?n:{},i=!1,o[t]=w.extend(l,a,r)):void 0!==r&&(o[t]=r));return o},w.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==h.call(e))&&(!(t=o(e))||"function"==typeof(n=f.call(t,"constructor")&&t.constructor)&&p.call(n)===m)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){_(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(E(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(E(Object(e))?w.merge(n,"string"==typeof e?[e]:e):l.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,a=e.length,o=!n;i<a;i++)!t(e[i],i)!==o&&r.push(e[i]);return r},map:function(e,t,n){var r,i,a=0,o=[];if(E(e))for(r=e.length;a<r;a++)null!=(i=t(e[a],a,n))&&o.push(i);else for(a in e)null!=(i=t(e[a],a,n))&&o.push(i);return c(o)},guid:1,support:v}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=a[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){d["[object "+t+"]"]=t.toLowerCase()}));var T=function(e){var t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,b,S="sizzle"+1*new Date,_=e.document,C=0,w=0,E=ce(),T=ce(),k=ce(),M=ce(),D=function(e,t){return e===t&&(d=!0),0},x={}.hasOwnProperty,R=[],O=R.pop,I=R.push,P=R.push,A=R.slice,L=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},N="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",j="[\\x20\\t\\r\\n\\f]",U="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",F="\\[[\\x20\\t\\r\\n\\f]*("+U+")(?:"+j+"*([*^$|!~]?=)"+j+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+U+"))|)"+j+"*\\]",H=":("+U+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",W=new RegExp(j+"+","g"),Y=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),B=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),V=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),$=new RegExp(j+"|>"),G=new RegExp(H),z=new RegExp("^"+U+"$"),q={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),TAG:new RegExp("^("+U+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+N+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},J=/HTML$/i,K=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,X=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ae=function(){h()},oe=Se((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{P.apply(R=A.call(_.childNodes),_.childNodes),R[_.childNodes.length].nodeType}catch(Te){P={apply:R.length?function(e,t){I.apply(e,A.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(e,t,r,i){var a,s,l,u,d,p,g,y=t&&t.ownerDocument,_=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==_&&9!==_&&11!==_)return r;if(!i&&(h(t),t=t||f,m)){if(11!==_&&(d=Z.exec(e)))if(a=d[1]){if(9===_){if(!(l=t.getElementById(a)))return r;if(l.id===a)return r.push(l),r}else if(y&&(l=y.getElementById(a))&&b(t,l)&&l.id===a)return r.push(l),r}else{if(d[2])return P.apply(r,t.getElementsByTagName(e)),r;if((a=d[3])&&n.getElementsByClassName&&t.getElementsByClassName)return P.apply(r,t.getElementsByClassName(a)),r}if(n.qsa&&!M[e+" "]&&(!v||!v.test(e))&&(1!==_||"object"!==t.nodeName.toLowerCase())){if(g=e,y=t,1===_&&($.test(e)||V.test(e))){for((y=ee.test(e)&&ge(t.parentNode)||t)===t&&n.scope||((u=t.getAttribute("id"))?u=u.replace(re,ie):t.setAttribute("id",u=S)),s=(p=o(e)).length;s--;)p[s]=(u?"#"+u:":scope")+" "+be(p[s]);g=p.join(",")}try{return P.apply(r,y.querySelectorAll(g)),r}catch(C){M(e,!0)}finally{u===S&&t.removeAttribute("id")}}}return c(e.replace(Y,"$1"),t,r,i)}function ce(){var e=[];return function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function le(e){return e[S]=!0,e}function ue(e){var t=f.createElement("fieldset");try{return!!e(t)}catch(Te){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function de(e,t){for(var n=e.split("|"),i=n.length;i--;)r.attrHandle[n[i]]=t}function he(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function fe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function pe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function me(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ve(e){return le((function(t){return t=+t,le((function(n,r){for(var i,a=e([],n.length,t),o=a.length;o--;)n[i=a[o]]&&(n[i]=!(r[i]=n[i]))}))}))}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=se.support={},a=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!J.test(t||n&&n.nodeName||"HTML")},h=se.setDocument=function(e){var t,i,o=e?e.ownerDocument||e:_;return o!=f&&9===o.nodeType&&o.documentElement?(p=(f=o).documentElement,m=!a(f),_!=f&&(i=f.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",ae,!1):i.attachEvent&&i.attachEvent("onunload",ae)),n.scope=ue((function(e){return p.appendChild(e).appendChild(f.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),n.attributes=ue((function(e){return e.className="i",!e.getAttribute("className")})),n.getElementsByTagName=ue((function(e){return e.appendChild(f.createComment("")),!e.getElementsByTagName("*").length})),n.getElementsByClassName=X.test(f.getElementsByClassName),n.getById=ue((function(e){return p.appendChild(e).id=S,!f.getElementsByName||!f.getElementsByName(S).length})),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var n,r,i,a=t.getElementById(e);if(a){if((n=a.getAttributeNode("id"))&&n.value===e)return[a];for(i=t.getElementsByName(e),r=0;a=i[r++];)if((n=a.getAttributeNode("id"))&&n.value===e)return[a]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,a=t.getElementsByTagName(e);if("*"===e){for(;n=a[i++];)1===n.nodeType&&r.push(n);return r}return a},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&m)return t.getElementsByClassName(e)},g=[],v=[],(n.qsa=X.test(f.querySelectorAll))&&(ue((function(e){var t;p.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+N+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=f.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")})),ue((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=f.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),p.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")}))),(n.matchesSelector=X.test(y=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&ue((function(e){n.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),g.push("!=",H)})),v=v.length&&new RegExp(v.join("|")),g=g.length&&new RegExp(g.join("|")),t=X.test(p.compareDocumentPosition),b=t||X.test(p.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return d=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==f||e.ownerDocument==_&&b(_,e)?-1:t==f||t.ownerDocument==_&&b(_,t)?1:u?L(u,e)-L(u,t):0:4&r?-1:1)}:function(e,t){if(e===t)return d=!0,0;var n,r=0,i=e.parentNode,a=t.parentNode,o=[e],s=[t];if(!i||!a)return e==f?-1:t==f?1:i?-1:a?1:u?L(u,e)-L(u,t):0;if(i===a)return he(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;o[r]===s[r];)r++;return r?he(o[r],s[r]):o[r]==_?-1:s[r]==_?1:0},f):f},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(h(e),n.matchesSelector&&m&&!M[t+" "]&&(!g||!g.test(t))&&(!v||!v.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(Te){M(t,!0)}return se(t,f,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=f&&h(e),b(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=f&&h(e);var i=r.attrHandle[t.toLowerCase()],a=i&&x.call(r.attrHandle,t.toLowerCase())?i(e,t,!m):void 0;return void 0!==a?a:n.attributes||!m?e.getAttribute(t):(a=e.getAttributeNode(t))&&a.specified?a.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,r=[],i=0,a=0;if(d=!n.detectDuplicates,u=!n.sortStable&&e.slice(0),e.sort(D),d){for(;t=e[a++];)t===e[a]&&(i=r.push(a));for(;i--;)e.splice(r[i],1)}return u=null,e},i=se.getText=function(e){var t,n="",r=0,a=e.nodeType;if(a){if(1===a||9===a||11===a){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===a||4===a)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=se.selectors={cacheLength:50,createPseudo:le,match:q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return q.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&G.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"("+j+"|$)"))&&E(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var i=se.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(W," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var a="nth"!==e.slice(0,3),o="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var l,u,d,h,f,p,m=a!==o?"nextSibling":"previousSibling",v=t.parentNode,g=s&&t.nodeName.toLowerCase(),y=!c&&!s,b=!1;if(v){if(a){for(;m;){for(h=t;h=h[m];)if(s?h.nodeName.toLowerCase()===g:1===h.nodeType)return!1;p=m="only"===e&&!p&&"nextSibling"}return!0}if(p=[o?v.firstChild:v.lastChild],o&&y){for(b=(f=(l=(u=(d=(h=v)[S]||(h[S]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]||[])[0]===C&&l[1])&&l[2],h=f&&v.childNodes[f];h=++f&&h&&h[m]||(b=f=0)||p.pop();)if(1===h.nodeType&&++b&&h===t){u[e]=[C,f,b];break}}else if(y&&(b=f=(l=(u=(d=(h=t)[S]||(h[S]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]||[])[0]===C&&l[1]),!1===b)for(;(h=++f&&h&&h[m]||(b=f=0)||p.pop())&&((s?h.nodeName.toLowerCase()!==g:1!==h.nodeType)||!++b||(y&&((u=(d=h[S]||(h[S]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]=[C,b]),h!==t)););return(b-=i)===r||b%r==0&&b/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return i[S]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?le((function(e,n){for(var r,a=i(e,t),o=a.length;o--;)e[r=L(e,a[o])]=!(n[r]=a[o])})):function(e){return i(e,0,n)}):i}},pseudos:{not:le((function(e){var t=[],n=[],r=s(e.replace(Y,"$1"));return r[S]?le((function(e,t,n,i){for(var a,o=r(e,null,i,[]),s=e.length;s--;)(a=o[s])&&(e[s]=!(t[s]=a))})):function(e,i,a){return t[0]=e,r(t,null,a,n),t[0]=null,!n.pop()}})),has:le((function(e){return function(t){return se(e,t).length>0}})),contains:le((function(e){return e=e.replace(te,ne),function(t){return(t.textContent||i(t)).indexOf(e)>-1}})),lang:le((function(e){return z.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=m?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:me(!1),disabled:me(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return K.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve((function(){return[0]})),last:ve((function(e,t){return[t-1]})),eq:ve((function(e,t,n){return[n<0?n+t:n]})),even:ve((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:ve((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:ve((function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:ve((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=fe(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pe(t);function ye(){}function be(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function Se(e,t,n){var r=t.dir,i=t.next,a=i||r,o=n&&"parentNode"===a,s=w++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var l,u,d,h=[C,s];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(u=(d=t[S]||(t[S]={}))[t.uniqueID]||(d[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=u[a])&&l[0]===C&&l[1]===s)return h[2]=l[2];if(u[a]=h,h[2]=e(t,n,c))return!0}return!1}}function _e(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Ce(e,t,n,r,i){for(var a,o=[],s=0,c=e.length,l=null!=t;s<c;s++)(a=e[s])&&(n&&!n(a,r,i)||(o.push(a),l&&t.push(s)));return o}function we(e,t,n,r,i,a){return r&&!r[S]&&(r=we(r)),i&&!i[S]&&(i=we(i,a)),le((function(a,o,s,c){var l,u,d,h=[],f=[],p=o.length,m=a||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),v=!e||!a&&t?m:Ce(m,h,e,s,c),g=n?i||(a?e:p||r)?[]:o:v;if(n&&n(v,g,s,c),r)for(l=Ce(g,f),r(l,[],s,c),u=l.length;u--;)(d=l[u])&&(g[f[u]]=!(v[f[u]]=d));if(a){if(i||e){if(i){for(l=[],u=g.length;u--;)(d=g[u])&&l.push(v[u]=d);i(null,g=[],l,c)}for(u=g.length;u--;)(d=g[u])&&(l=i?L(a,d):h[u])>-1&&(a[l]=!(o[l]=d))}}else g=Ce(g===o?g.splice(p,g.length):g),i?i(null,o,g,c):P.apply(o,g)}))}function Ee(e){for(var t,n,i,a=e.length,o=r.relative[e[0].type],s=o||r.relative[" "],c=o?1:0,u=Se((function(e){return e===t}),s,!0),d=Se((function(e){return L(t,e)>-1}),s,!0),h=[function(e,n,r){var i=!o&&(r||n!==l)||((t=n).nodeType?u(e,n,r):d(e,n,r));return t=null,i}];c<a;c++)if(n=r.relative[e[c].type])h=[Se(_e(h),n)];else{if((n=r.filter[e[c].type].apply(null,e[c].matches))[S]){for(i=++c;i<a&&!r.relative[e[i].type];i++);return we(c>1&&_e(h),c>1&&be(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(Y,"$1"),n,c<i&&Ee(e.slice(c,i)),i<a&&Ee(e=e.slice(i)),i<a&&be(e))}h.push(n)}return _e(h)}return ye.prototype=r.filters=r.pseudos,r.setFilters=new ye,o=se.tokenize=function(e,t){var n,i,a,o,s,c,l,u=T[e+" "];if(u)return t?0:u.slice(0);for(s=e,c=[],l=r.preFilter;s;){for(o in n&&!(i=B.exec(s))||(i&&(s=s.slice(i[0].length)||s),c.push(a=[])),n=!1,(i=V.exec(s))&&(n=i.shift(),a.push({value:n,type:i[0].replace(Y," ")}),s=s.slice(n.length)),r.filter)!(i=q[o].exec(s))||l[o]&&!(i=l[o](i))||(n=i.shift(),a.push({value:n,type:o,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?se.error(e):T(e,c).slice(0)},s=se.compile=function(e,t){var n,i=[],a=[],s=k[e+" "];if(!s){for(t||(t=o(e)),n=t.length;n--;)(s=Ee(t[n]))[S]?i.push(s):a.push(s);(s=k(e,function(e,t){var n=t.length>0,i=e.length>0,a=function(a,o,s,c,u){var d,p,v,g=0,y="0",b=a&&[],S=[],_=l,w=a||i&&r.find.TAG("*",u),E=C+=null==_?1:Math.random()||.1,T=w.length;for(u&&(l=o==f||o||u);y!==T&&null!=(d=w[y]);y++){if(i&&d){for(p=0,o||d.ownerDocument==f||(h(d),s=!m);v=e[p++];)if(v(d,o||f,s)){c.push(d);break}u&&(C=E)}n&&((d=!v&&d)&&g--,a&&b.push(d))}if(g+=y,n&&y!==g){for(p=0;v=t[p++];)v(b,S,o,s);if(a){if(g>0)for(;y--;)b[y]||S[y]||(S[y]=O.call(c));S=Ce(S)}P.apply(c,S),u&&!a&&S.length>0&&g+t.length>1&&se.uniqueSort(c)}return u&&(C=E,l=_),b};return n?le(a):a}(a,i))).selector=e}return s},c=se.select=function(e,t,n,i){var a,c,l,u,d,h="function"==typeof e&&e,f=!i&&o(e=h.selector||e);if(n=n||[],1===f.length){if((c=f[0]=f[0].slice(0)).length>2&&"ID"===(l=c[0]).type&&9===t.nodeType&&m&&r.relative[c[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(te,ne),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(c.shift().value.length)}for(a=q.needsContext.test(e)?0:c.length;a--&&(l=c[a],!r.relative[u=l.type]);)if((d=r.find[u])&&(i=d(l.matches[0].replace(te,ne),ee.test(c[0].type)&&ge(t.parentNode)||t))){if(c.splice(a,1),!(e=i.length&&be(c)))return P.apply(n,i),n;break}}return(h||s(e,f))(i,t,!m,n,!t||ee.test(e)&&ge(t.parentNode)||t),n},n.sortStable=S.split("").sort(D).join("")===S,n.detectDuplicates=!!d,h(),n.sortDetached=ue((function(e){return 1&e.compareDocumentPosition(f.createElement("fieldset"))})),ue((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||de("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),n.attributes&&ue((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||de("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ue((function(e){return null==e.getAttribute("disabled")}))||de(N,(function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null})),se}(n);w.find=T,(w.expr=T.selectors)[":"]=w.expr.pseudos,w.uniqueSort=w.unique=T.uniqueSort,w.text=T.getText,w.isXMLDoc=T.isXML,w.contains=T.contains,w.escapeSelector=T.escape;var k=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&w(e).is(n))break;r.push(e)}return r},M=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},D=w.expr.match.needsContext;function x(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var R=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function O(e,t,n){return g(t)?w.grep(e,(function(e,r){return!!t.call(e,r,e)!==n})):t.nodeType?w.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?w.grep(e,(function(e){return u.call(t,e)>-1!==n})):w.filter(t,e,n)}w.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,(function(e){return 1===e.nodeType})))},w.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(w(e).filter((function(){for(t=0;t<r;t++)if(w.contains(i[t],this))return!0})));for(n=this.pushStack([]),t=0;t<r;t++)w.find(e,i[t],n);return r>1?w.uniqueSort(n):n},filter:function(e){return this.pushStack(O(this,e||[],!1))},not:function(e){return this.pushStack(O(this,e||[],!0))},is:function(e){return!!O(this,"string"==typeof e&&D.test(e)?w(e):e||[],!1).length}});var I,P=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||I,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:P.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:b,!0)),R.test(r[1])&&w.isPlainObject(t))for(r in t)g(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=b.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):g(e)?void 0!==n.ready?n.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,I=w(b);var A=/^(?:parents|prev(?:Until|All))/,L={children:!0,contents:!0,next:!0,prev:!0};function N(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}w.fn.extend({has:function(e){var t=w(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(w.contains(this,t[e]))return!0}))},closest:function(e,t){var n,r=0,i=this.length,a=[],o="string"!=typeof e&&w(e);if(!D.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){a.push(n);break}return this.pushStack(a.length>1?w.uniqueSort(a):a)},index:function(e){return e?"string"==typeof e?u.call(w(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return k(e,"parentNode")},parentsUntil:function(e,t,n){return k(e,"parentNode",n)},next:function(e){return N(e,"nextSibling")},prev:function(e){return N(e,"previousSibling")},nextAll:function(e){return k(e,"nextSibling")},prevAll:function(e){return k(e,"previousSibling")},nextUntil:function(e,t,n){return k(e,"nextSibling",n)},prevUntil:function(e,t,n){return k(e,"previousSibling",n)},siblings:function(e){return M((e.parentNode||{}).firstChild,e)},children:function(e){return M(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(x(e,"template")&&(e=e.content||e),w.merge([],e.childNodes))}},(function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=w.filter(r,i)),this.length>1&&(L[e]||w.uniqueSort(i),A.test(e)&&i.reverse()),this.pushStack(i)}}));var j=/[^\x20\t\r\n\f]+/g;function U(e){return e}function F(e){throw e}function H(e,t,n,r){var i;try{e&&g(i=e.promise)?i.call(e).done(t).fail(n):e&&g(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}w.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return w.each(e.match(j)||[],(function(e,n){t[n]=!0})),t}(e):w.extend({},e);var t,n,r,i,a=[],o=[],s=-1,c=function(){for(i=i||e.once,r=t=!0;o.length;s=-1)for(n=o.shift();++s<a.length;)!1===a[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=a.length,n=!1);e.memory||(n=!1),t=!1,i&&(a=n?[]:"")},l={add:function(){return a&&(n&&!t&&(s=a.length-1,o.push(n)),function t(n){w.each(n,(function(n,r){g(r)?e.unique&&l.has(r)||a.push(r):r&&r.length&&"string"!==C(r)&&t(r)}))}(arguments),n&&!t&&c()),this},remove:function(){return w.each(arguments,(function(e,t){for(var n;(n=w.inArray(t,a,n))>-1;)a.splice(n,1),n<=s&&s--})),this},has:function(e){return e?w.inArray(e,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return i=o=[],a=n="",this},disabled:function(){return!a},lock:function(){return i=o=[],n||t||(a=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],o.push(n),t||c()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},w.extend({Deferred:function(e){var t=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return a.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return w.Deferred((function(n){w.each(t,(function(t,r){var i=g(e[r[4]])&&e[r[4]];a[r[1]]((function(){var e=i&&i.apply(this,arguments);e&&g(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[r[0]+"With"](this,i?[e]:arguments)}))})),e=null})).promise()},then:function(e,r,i){var a=0;function o(e,t,r,i){return function(){var s=this,c=arguments,l=function(){var n,l;if(!(e<a)){if((n=r.apply(s,c))===t.promise())throw new TypeError("Thenable self-resolution");l=n&&("object"==typeof n||"function"==typeof n)&&n.then,g(l)?i?l.call(n,o(a,t,U,i),o(a,t,F,i)):(a++,l.call(n,o(a,t,U,i),o(a,t,F,i),o(a,t,U,t.notifyWith))):(r!==U&&(s=void 0,c=[n]),(i||t.resolveWith)(s,c))}},u=i?l:function(){try{l()}catch(n){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(n,u.stackTrace),e+1>=a&&(r!==F&&(s=void 0,c=[n]),t.rejectWith(s,c))}};e?u():(w.Deferred.getStackHook&&(u.stackTrace=w.Deferred.getStackHook()),n.setTimeout(u))}}return w.Deferred((function(n){t[0][3].add(o(0,n,g(i)?i:U,n.notifyWith)),t[1][3].add(o(0,n,g(e)?e:U)),t[2][3].add(o(0,n,g(r)?r:F))})).promise()},promise:function(e){return null!=e?w.extend(e,i):i}},a={};return w.each(t,(function(e,n){var o=n[2],s=n[5];i[n[1]]=o.add,s&&o.add((function(){r=s}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(n[3].fire),a[n[0]]=function(){return a[n[0]+"With"](this===a?void 0:this,arguments),this},a[n[0]+"With"]=o.fireWith})),i.promise(a),e&&e.call(a,a),a},when:function(e){var t=arguments.length,n=t,r=Array(n),i=s.call(arguments),a=w.Deferred(),o=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?s.call(arguments):n,--t||a.resolveWith(r,i)}};if(t<=1&&(H(e,a.done(o(n)).resolve,a.reject,!t),"pending"===a.state()||g(i[n]&&i[n].then)))return a.then();for(;n--;)H(i[n],o(n),a.reject);return a.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(e,t){n.console&&n.console.warn&&e&&W.test(e.name)&&n.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},w.readyException=function(e){n.setTimeout((function(){throw e}))};var Y=w.Deferred();function B(){b.removeEventListener("DOMContentLoaded",B),n.removeEventListener("load",B),w.ready()}w.fn.ready=function(e){return Y.then(e).catch((function(e){w.readyException(e)})),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||Y.resolveWith(b,[w]))}}),w.ready.then=Y.then,"complete"===b.readyState||"loading"!==b.readyState&&!b.documentElement.doScroll?n.setTimeout(w.ready):(b.addEventListener("DOMContentLoaded",B),n.addEventListener("load",B));var V=function e(t,n,r,i,a,o,s){var c=0,l=t.length,u=null==r;if("object"===C(r))for(c in a=!0,r)e(t,n,c,r[c],!0,o,s);else if(void 0!==i&&(a=!0,g(i)||(s=!0),u&&(s?(n.call(t,i),n=null):(u=n,n=function(e,t,n){return u.call(w(e),n)})),n))for(;c<l;c++)n(t[c],r,s?i:i.call(t[c],c,n(t[c],r)));return a?t:u?n.call(t):l?n(t[0],r):o},$=/^-ms-/,G=/-([a-z])/g;function z(e,t){return t.toUpperCase()}function q(e){return e.replace($,"ms-").replace(G,z)}var J=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function K(){this.expando=w.expando+K.uid++}K.uid=1,K.prototype={cache:function(e){var t=e[this.expando];return t||(t={},J(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[q(t)]=n;else for(r in t)i[q(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][q(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(q):(t=q(t))in r?[t]:t.match(j)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||w.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var Q=new K,X=new K,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Z.test(e)?JSON.parse(e):e)}(n)}catch(i){}X.set(e,t,n)}else n=void 0;return n}w.extend({hasData:function(e){return X.hasData(e)||Q.hasData(e)},data:function(e,t,n){return X.access(e,t,n)},removeData:function(e,t){X.remove(e,t)},_data:function(e,t,n){return Q.access(e,t,n)},_removeData:function(e,t){Q.remove(e,t)}}),w.fn.extend({data:function(e,t){var n,r,i,a=this[0],o=a&&a.attributes;if(void 0===e){if(this.length&&(i=X.get(a),1===a.nodeType&&!Q.get(a,"hasDataAttrs"))){for(n=o.length;n--;)o[n]&&0===(r=o[n].name).indexOf("data-")&&(r=q(r.slice(5)),te(a,r,i[r]));Q.set(a,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each((function(){X.set(this,e)})):V(this,(function(t){var n;if(a&&void 0===t)return void 0!==(n=X.get(a,e))||void 0!==(n=te(a,e))?n:void 0;this.each((function(){X.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){X.remove(this,e)}))}}),w.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Q.get(e,t),n&&(!r||Array.isArray(n)?r=Q.access(e,t,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){var n=w.queue(e,t=t||"fx"),r=n.length,i=n.shift(),a=w._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete a.stop,i.call(e,(function(){w.dequeue(e,t)}),a)),!r&&a&&a.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Q.get(e,n)||Q.access(e,n,{empty:w.Callbacks("once memory").add((function(){Q.remove(e,[t+"queue",n])}))})}}),w.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?w.queue(this[0],e):void 0===t?this:this.each((function(){var n=w.queue(this,e,t);w._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&w.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){w.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=w.Deferred(),a=this,o=this.length,s=function(){--r||i.resolveWith(a,[a])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(n=Q.get(a[o],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,re=new RegExp("^(?:([+-])=|)("+ne+")([a-z%]*)$","i"),ie=["Top","Right","Bottom","Left"],ae=b.documentElement,oe=function(e){return w.contains(e.ownerDocument,e)},se={composed:!0};ae.getRootNode&&(oe=function(e){return w.contains(e.ownerDocument,e)||e.getRootNode(se)===e.ownerDocument});var ce=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===w.css(e,"display")};function le(e,t,n,r){var i,a,o=20,s=r?function(){return r.cur()}:function(){return w.css(e,t,"")},c=s(),l=n&&n[3]||(w.cssNumber[t]?"":"px"),u=e.nodeType&&(w.cssNumber[t]||"px"!==l&&+c)&&re.exec(w.css(e,t));if(u&&u[3]!==l){for(c/=2,l=l||u[3],u=+c||1;o--;)w.style(e,t,u+l),(1-a)*(1-(a=s()/c||.5))<=0&&(o=0),u/=a;w.style(e,t,(u*=2)+l),n=n||[]}return n&&(u=+u||+c||0,i=n[1]?u+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=u,r.end=i)),i}var ue={};function de(e){var t,n=e.ownerDocument,r=e.nodeName,i=ue[r];return i||(t=n.body.appendChild(n.createElement(r)),i=w.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),ue[r]=i,i)}function he(e,t){for(var n,r,i=[],a=0,o=e.length;a<o;a++)(r=e[a]).style&&(n=r.style.display,t?("none"===n&&(i[a]=Q.get(r,"display")||null,i[a]||(r.style.display="")),""===r.style.display&&ce(r)&&(i[a]=de(r))):"none"!==n&&(i[a]="none",Q.set(r,"display",n)));for(a=0;a<o;a++)null!=i[a]&&(e[a].style.display=i[a]);return e}w.fn.extend({show:function(){return he(this,!0)},hide:function(){return he(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){ce(this)?w(this).show():w(this).hide()}))}});var fe,pe,me=/^(?:checkbox|radio)$/i,ve=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ge=/^$|^module$|\/(?:java|ecma)script/i;fe=b.createDocumentFragment().appendChild(b.createElement("div")),(pe=b.createElement("input")).setAttribute("type","radio"),pe.setAttribute("checked","checked"),pe.setAttribute("name","t"),fe.appendChild(pe),v.checkClone=fe.cloneNode(!0).cloneNode(!0).lastChild.checked,fe.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!fe.cloneNode(!0).lastChild.defaultValue,fe.innerHTML="<option></option>",v.option=!!fe.lastChild;var ye={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function be(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&x(e,t)?w.merge([e],n):n}function Se(e,t){for(var n=0,r=e.length;n<r;n++)Q.set(e[n],"globalEval",!t||Q.get(t[n],"globalEval"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,v.option||(ye.optgroup=ye.option=[1,"<select multiple='multiple'>","</select>"]);var _e=/<|&#?\w+;/;function Ce(e,t,n,r,i){for(var a,o,s,c,l,u,d=t.createDocumentFragment(),h=[],f=0,p=e.length;f<p;f++)if((a=e[f])||0===a)if("object"===C(a))w.merge(h,a.nodeType?[a]:a);else if(_e.test(a)){for(o=o||d.appendChild(t.createElement("div")),s=(ve.exec(a)||["",""])[1].toLowerCase(),c=ye[s]||ye._default,o.innerHTML=c[1]+w.htmlPrefilter(a)+c[2],u=c[0];u--;)o=o.lastChild;w.merge(h,o.childNodes),(o=d.firstChild).textContent=""}else h.push(t.createTextNode(a));for(d.textContent="",f=0;a=h[f++];)if(r&&w.inArray(a,r)>-1)i&&i.push(a);else if(l=oe(a),o=be(d.appendChild(a),"script"),l&&Se(o),n)for(u=0;a=o[u++];)ge.test(a.type||"")&&n.push(a);return d}var we=/^key/,Ee=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Te=/^([^.]*)(?:\.(.+)|)/;function ke(){return!0}function Me(){return!1}function De(e,t){return e===function(){try{return b.activeElement}catch(e){}}()==("focus"===t)}function xe(e,t,n,r,i,a){var o,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)xe(e,s,n,r,t[s],a);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Me;else if(!i)return e;return 1===a&&(o=i,(i=function(e){return w().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=w.guid++)),e.each((function(){w.event.add(this,t,i,r,n)}))}function Re(e,t,n){n?(Q.set(e,t,!1),w.event.add(e,t,{namespace:!1,handler:function(e){var r,i,a=Q.get(this,t);if(1&e.isTrigger&&this[t]){if(a.length)(w.event.special[t]||{}).delegateType&&e.stopPropagation();else if(a=s.call(arguments),Q.set(this,t,a),r=n(this,t),this[t](),a!==(i=Q.get(this,t))||r?Q.set(this,t,!1):i={},a!==i)return e.stopImmediatePropagation(),e.preventDefault(),i.value}else a.length&&(Q.set(this,t,{value:w.event.trigger(w.extend(a[0],w.Event.prototype),a.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Q.get(e,t)&&w.event.add(e,t,ke)}w.event={global:{},add:function(e,t,n,r,i){var a,o,s,c,l,u,d,h,f,p,m,v=Q.get(e);if(J(e))for(n.handler&&(n=(a=n).handler,i=a.selector),i&&w.find.matchesSelector(ae,i),n.guid||(n.guid=w.guid++),(c=v.events)||(c=v.events=Object.create(null)),(o=v.handle)||(o=v.handle=function(t){return void 0!==w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(j)||[""]).length;l--;)f=m=(s=Te.exec(t[l])||[])[1],p=(s[2]||"").split(".").sort(),f&&(d=w.event.special[f]||{},f=(i?d.delegateType:d.bindType)||f,d=w.event.special[f]||{},u=w.extend({type:f,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&w.expr.match.needsContext.test(i),namespace:p.join(".")},a),(h=c[f])||((h=c[f]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(e,r,p,o)||e.addEventListener&&e.addEventListener(f,o)),d.add&&(d.add.call(e,u),u.handler.guid||(u.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,u):h.push(u),w.event.global[f]=!0)},remove:function(e,t,n,r,i){var a,o,s,c,l,u,d,h,f,p,m,v=Q.hasData(e)&&Q.get(e);if(v&&(c=v.events)){for(l=(t=(t||"").match(j)||[""]).length;l--;)if(f=m=(s=Te.exec(t[l])||[])[1],p=(s[2]||"").split(".").sort(),f){for(d=w.event.special[f]||{},h=c[f=(r?d.delegateType:d.bindType)||f]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=a=h.length;a--;)u=h[a],!i&&m!==u.origType||n&&n.guid!==u.guid||s&&!s.test(u.namespace)||r&&r!==u.selector&&("**"!==r||!u.selector)||(h.splice(a,1),u.selector&&h.delegateCount--,d.remove&&d.remove.call(e,u));o&&!h.length&&(d.teardown&&!1!==d.teardown.call(e,p,v.handle)||w.removeEvent(e,f,v.handle),delete c[f])}else for(f in c)w.event.remove(e,f+t[l],n,r,!0);w.isEmptyObject(c)&&Q.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,a,o,s=new Array(arguments.length),c=w.event.fix(e),l=(Q.get(this,"events")||Object.create(null))[c.type]||[],u=w.event.special[c.type]||{};for(s[0]=c,t=1;t<arguments.length;t++)s[t]=arguments[t];if(c.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,c)){for(o=w.event.handlers.call(this,c,l),t=0;(i=o[t++])&&!c.isPropagationStopped();)for(c.currentTarget=i.elem,n=0;(a=i.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==a.namespace&&!c.rnamespace.test(a.namespace)||(c.handleObj=a,c.data=a.data,void 0!==(r=((w.event.special[a.origType]||{}).handle||a.handler).apply(i.elem,s))&&!1===(c.result=r)&&(c.preventDefault(),c.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,r,i,a,o,s=[],c=t.delegateCount,l=e.target;if(c&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(a=[],o={},n=0;n<c;n++)void 0===o[i=(r=t[n]).selector+" "]&&(o[i]=r.needsContext?w(i,this).index(l)>-1:w.find(i,this,null,[l]).length),o[i]&&a.push(r);a.length&&s.push({elem:l,handlers:a})}return l=this,c<t.length&&s.push({elem:l,handlers:t.slice(c)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:g(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return me.test(t.type)&&t.click&&x(t,"input")&&Re(t,"click",ke),!1},trigger:function(e){var t=this||e;return me.test(t.type)&&t.click&&x(t,"input")&&Re(t,"click"),!0},_default:function(e){var t=e.target;return me.test(t.type)&&t.click&&x(t,"input")&&Q.get(t,"click")||x(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},(w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?ke:Me,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0}).prototype={constructor:w.Event,isDefaultPrevented:Me,isPropagationStopped:Me,isImmediatePropagationStopped:Me,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ke,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ke,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=ke,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ee.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},w.event.addProp),w.each({focus:"focusin",blur:"focusout"},(function(e,t){w.event.special[e]={setup:function(){return Re(this,e,De),!1},trigger:function(){return Re(this,e),!0},delegateType:t}})),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,a=e.handleObj;return i&&(i===r||w.contains(r,i))||(e.type=a.origType,n=a.handler.apply(this,arguments),e.type=t),n}}})),w.fn.extend({on:function(e,t,n,r){return xe(this,e,t,n,r)},one:function(e,t,n,r){return xe(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,w(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Me),this.each((function(){w.event.remove(this,e,n,t)}))}});var Oe=/<script|<style|<link/i,Ie=/checked\s*(?:[^=]|=\s*.checked.)/i,Pe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ae(e,t){return x(e,"table")&&x(11!==t.nodeType?t:t.firstChild,"tr")&&w(e).children("tbody")[0]||e}function Le(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ne(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function je(e,t){var n,r,i,a,o,s;if(1===t.nodeType){if(Q.hasData(e)&&(s=Q.get(e).events))for(i in Q.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)w.event.add(t,i,s[i][n]);X.hasData(e)&&(a=X.access(e),o=w.extend({},a),X.set(t,o))}}function Ue(e,t){var n=t.nodeName.toLowerCase();"input"===n&&me.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Fe(e,t,n,r){t=c(t);var i,a,o,s,l,u,d=0,h=e.length,f=h-1,p=t[0],m=g(p);if(m||h>1&&"string"==typeof p&&!v.checkClone&&Ie.test(p))return e.each((function(i){var a=e.eq(i);m&&(t[0]=p.call(this,i,a.html())),Fe(a,t,n,r)}));if(h&&(a=(i=Ce(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=a),a||r)){for(s=(o=w.map(be(i,"script"),Le)).length;d<h;d++)l=i,d!==f&&(l=w.clone(l,!0,!0),s&&w.merge(o,be(l,"script"))),n.call(e[d],l,d);if(s)for(u=o[o.length-1].ownerDocument,w.map(o,Ne),d=0;d<s;d++)l=o[d],ge.test(l.type||"")&&!Q.access(l,"globalEval")&&w.contains(u,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?w._evalUrl&&!l.noModule&&w._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},u):_(l.textContent.replace(Pe,""),l,u))}return e}function He(e,t,n){for(var r,i=t?w.filter(t,e):e,a=0;null!=(r=i[a]);a++)n||1!==r.nodeType||w.cleanData(be(r)),r.parentNode&&(n&&oe(r)&&Se(be(r,"script")),r.parentNode.removeChild(r));return e}w.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,a,o,s=e.cloneNode(!0),c=oe(e);if(!(v.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(o=be(s),r=0,i=(a=be(e)).length;r<i;r++)Ue(a[r],o[r]);if(t)if(n)for(a=a||be(e),o=o||be(s),r=0,i=a.length;r<i;r++)je(a[r],o[r]);else je(e,s);return(o=be(s,"script")).length>0&&Se(o,!c&&be(e,"script")),s},cleanData:function(e){for(var t,n,r,i=w.event.special,a=0;void 0!==(n=e[a]);a++)if(J(n)){if(t=n[Q.expando]){if(t.events)for(r in t.events)i[r]?w.event.remove(n,r):w.removeEvent(n,r,t.handle);n[Q.expando]=void 0}n[X.expando]&&(n[X.expando]=void 0)}}}),w.fn.extend({detach:function(e){return He(this,e,!0)},remove:function(e){return He(this,e)},text:function(e){return V(this,(function(e){return void 0===e?w.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Fe(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ae(this,e).appendChild(e)}))},prepend:function(){return Fe(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ae(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Fe(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Fe(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(be(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return w.clone(this,e,t)}))},html:function(e){return V(this,(function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Oe.test(e)&&!ye[(ve.exec(e)||["",""])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(w.cleanData(be(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Fe(this,arguments,(function(t){var n=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(be(this)),n&&n.replaceChild(t,this))}),e)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){w.fn[e]=function(e){for(var n,r=[],i=w(e),a=i.length-1,o=0;o<=a;o++)n=o===a?this:this.clone(!0),w(i[o])[t](n),l.apply(r,n.get());return this.pushStack(r)}}));var We=new RegExp("^("+ne+")(?!px)[a-z%]+$","i"),Ye=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=n),t.getComputedStyle(e)},Be=function(e,t,n){var r,i,a={};for(i in t)a[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=a[i];return r},Ve=new RegExp(ie.join("|"),"i");function $e(e,t,n){var r,i,a,o,s=e.style;return(n=n||Ye(e))&&(""!==(o=n.getPropertyValue(t)||n[t])||oe(e)||(o=w.style(e,t)),!v.pixelBoxStyles()&&We.test(o)&&Ve.test(t)&&(r=s.width,i=s.minWidth,a=s.maxWidth,s.minWidth=s.maxWidth=s.width=o,o=n.width,s.width=r,s.minWidth=i,s.maxWidth=a)),void 0!==o?o+"":o}function Ge(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(u){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ae.appendChild(l).appendChild(u);var e=n.getComputedStyle(u);r="1%"!==e.top,c=12===t(e.marginLeft),u.style.right="60%",o=36===t(e.right),i=36===t(e.width),u.style.position="absolute",a=12===t(u.offsetWidth/3),ae.removeChild(l),u=null}}function t(e){return Math.round(parseFloat(e))}var r,i,a,o,s,c,l=b.createElement("div"),u=b.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle="content-box"===u.style.backgroundClip,w.extend(v,{boxSizingReliable:function(){return e(),i},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),r},reliableMarginLeft:function(){return e(),c},scrollboxSize:function(){return e(),a},reliableTrDimensions:function(){var e,t,r,i;return null==s&&(e=b.createElement("table"),t=b.createElement("tr"),r=b.createElement("div"),e.style.cssText="position:absolute;left:-11111px",t.style.height="1px",r.style.height="9px",ae.appendChild(e).appendChild(t).appendChild(r),i=n.getComputedStyle(t),s=parseInt(i.height)>3,ae.removeChild(e)),s}}))}();var ze=["Webkit","Moz","ms"],qe=b.createElement("div").style,Je={};function Ke(e){return w.cssProps[e]||Je[e]||(e in qe?e:Je[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=ze.length;n--;)if((e=ze[n]+t)in qe)return e}(e)||e)}var Qe=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ze={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,n){var r=re.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function nt(e,t,n,r,i,a){var o="width"===t?1:0,s=0,c=0;if(n===(r?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(c+=w.css(e,n+ie[o],!0,i)),r?("content"===n&&(c-=w.css(e,"padding"+ie[o],!0,i)),"margin"!==n&&(c-=w.css(e,"border"+ie[o]+"Width",!0,i))):(c+=w.css(e,"padding"+ie[o],!0,i),"padding"!==n?c+=w.css(e,"border"+ie[o]+"Width",!0,i):s+=w.css(e,"border"+ie[o]+"Width",!0,i));return!r&&a>=0&&(c+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-a-c-s-.5))||0),c}function rt(e,t,n){var r=Ye(e),i=(!v.boxSizingReliable()||n)&&"border-box"===w.css(e,"boxSizing",!1,r),a=i,o=$e(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(We.test(o)){if(!n)return o;o="auto"}return(!v.boxSizingReliable()&&i||!v.reliableTrDimensions()&&x(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===w.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===w.css(e,"boxSizing",!1,r),(a=s in e)&&(o=e[s])),(o=parseFloat(o)||0)+nt(e,t,n||(i?"border":"content"),a,r,o)+"px"}function it(e,t,n,r,i){return new it.prototype.init(e,t,n,r,i)}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=$e(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,a,o,s=q(t),c=Xe.test(t),l=e.style;if(c||(t=Ke(s)),o=w.cssHooks[t]||w.cssHooks[s],void 0===n)return o&&"get"in o&&void 0!==(i=o.get(e,!1,r))?i:l[t];"string"===(a=typeof n)&&(i=re.exec(n))&&i[1]&&(n=le(e,t,i),a="number"),null!=n&&n==n&&("number"!==a||c||(n+=i&&i[3]||(w.cssNumber[s]?"":"px")),v.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),o&&"set"in o&&void 0===(n=o.set(e,n,r))||(c?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,a,o,s=q(t);return Xe.test(t)||(t=Ke(s)),(o=w.cssHooks[t]||w.cssHooks[s])&&"get"in o&&(i=o.get(e,!0,n)),void 0===i&&(i=$e(e,t,r)),"normal"===i&&t in et&&(i=et[t]),""===n||n?(a=parseFloat(i),!0===n||isFinite(a)?a||0:i):i}}),w.each(["height","width"],(function(e,t){w.cssHooks[t]={get:function(e,n,r){if(n)return!Qe.test(w.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?rt(e,t,r):Be(e,Ze,(function(){return rt(e,t,r)}))},set:function(e,n,r){var i,a=Ye(e),o=!v.scrollboxSize()&&"absolute"===a.position,s=(o||r)&&"border-box"===w.css(e,"boxSizing",!1,a),c=r?nt(e,t,r,s,a):0;return s&&o&&(c-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(a[t])-nt(e,t,"border",!1,a)-.5)),c&&(i=re.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=w.css(e,t)),tt(0,n,c)}}})),w.cssHooks.marginLeft=Ge(v.reliableMarginLeft,(function(e,t){if(t)return(parseFloat($e(e,"marginLeft"))||e.getBoundingClientRect().left-Be(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),w.each({margin:"",padding:"",border:"Width"},(function(e,t){w.cssHooks[e+t]={expand:function(n){for(var r=0,i={},a="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+ie[r]+t]=a[r]||a[r-2]||a[0];return i}},"margin"!==e&&(w.cssHooks[e+t].set=tt)})),w.fn.extend({css:function(e,t){return V(this,(function(e,t,n){var r,i,a={},o=0;if(Array.isArray(t)){for(r=Ye(e),i=t.length;o<i;o++)a[t[o]]=w.css(e,t[o],!1,r);return a}return void 0!==n?w.style(e,t,n):w.css(e,t)}),e,t,arguments.length>1)}}),w.Tween=it,it.prototype={constructor:it,init:function(e,t,n,r,i,a){this.elem=e,this.prop=n,this.easing=i||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=a||(w.cssNumber[n]?"":"px")},cur:function(){var e=it.propHooks[this.prop];return e&&e.get?e.get(this):it.propHooks._default.get(this)},run:function(e){var t,n=it.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):it.propHooks._default.set(this),this}},it.prototype.init.prototype=it.prototype,it.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||!w.cssHooks[e.prop]&&null==e.elem.style[Ke(e.prop)]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},it.propHooks.scrollTop=it.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},(w.fx=it.prototype.init).step={};var at,ot,st=/^(?:toggle|show|hide)$/,ct=/queueHooks$/;function lt(){ot&&(!1===b.hidden&&n.requestAnimationFrame?n.requestAnimationFrame(lt):n.setTimeout(lt,w.fx.interval),w.fx.tick())}function ut(){return n.setTimeout((function(){at=void 0})),at=Date.now()}function dt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ie[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ht(e,t,n){for(var r,i=(ft.tweeners[t]||[]).concat(ft.tweeners["*"]),a=0,o=i.length;a<o;a++)if(r=i[a].call(n,t,e))return r}function ft(e,t,n){var r,i,a=0,o=ft.prefilters.length,s=w.Deferred().always((function(){delete c.elem})),c=function(){if(i)return!1;for(var t=at||ut(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),a=0,o=l.tweens.length;a<o;a++)l.tweens[a].run(r);return s.notifyWith(e,[l,r,n]),r<1&&o?n:(o||s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:t,originalOptions:n,startTime:at||ut(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),u=l.props;for(function(e,t){var n,r,i,a,o;for(n in e)if(i=t[r=q(n)],a=e[n],Array.isArray(a)&&(i=a[1],a=e[n]=a[0]),n!==r&&(e[r]=a,delete e[n]),(o=w.cssHooks[r])&&"expand"in o)for(n in a=o.expand(a),delete e[r],a)n in e||(e[n]=a[n],t[n]=i);else t[r]=i}(u,l.opts.specialEasing);a<o;a++)if(r=ft.prefilters[a].call(l,e,u,l.opts))return g(r.stop)&&(w._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return w.map(u,ht,l),g(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),w.fx.timer(w.extend(c,{elem:e,anim:l,queue:l.opts.queue})),l}w.Animation=w.extend(ft,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return le(n.elem,e,re.exec(t),n),n}]},tweener:function(e,t){g(e)?(t=e,e=["*"]):e=e.match(j);for(var n,r=0,i=e.length;r<i;r++)n=e[r],ft.tweeners[n]=ft.tweeners[n]||[],ft.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,a,o,s,c,l,u,d="width"in t||"height"in t,h=this,f={},p=e.style,m=e.nodeType&&ce(e),v=Q.get(e,"fxshow");for(r in n.queue||(null==(o=w._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,h.always((function(){h.always((function(){o.unqueued--,w.queue(e,"fx").length||o.empty.fire()}))}))),t)if(i=t[r],st.test(i)){if(delete t[r],a=a||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;m=!0}f[r]=v&&v[r]||w.style(e,r)}if((c=!w.isEmptyObject(t))||!w.isEmptyObject(f))for(r in d&&1===e.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(l=v&&v.display)&&(l=Q.get(e,"display")),"none"===(u=w.css(e,"display"))&&(l?u=l:(he([e],!0),l=e.style.display||l,u=w.css(e,"display"),he([e]))),("inline"===u||"inline-block"===u&&null!=l)&&"none"===w.css(e,"float")&&(c||(h.done((function(){p.display=l})),null==l&&(u=p.display,l="none"===u?"":u)),p.display="inline-block")),n.overflow&&(p.overflow="hidden",h.always((function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}))),c=!1,f)c||(v?"hidden"in v&&(m=v.hidden):v=Q.access(e,"fxshow",{display:l}),a&&(v.hidden=!m),m&&he([e],!0),h.done((function(){for(r in m||he([e]),Q.remove(e,"fxshow"),f)w.style(e,r,f[r])}))),c=ht(m?v[r]:0,r,h),r in v||(v[r]=c.start,m&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?ft.prefilters.unshift(e):ft.prefilters.push(e)}}),w.speed=function(e,t,n){var r=e&&"object"==typeof e?w.extend({},e):{complete:n||!n&&t||g(e)&&e,duration:e,easing:n&&t||t&&!g(t)&&t};return w.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in w.fx.speeds?r.duration=w.fx.speeds[r.duration]:r.duration=w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){g(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ce).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),a=w.speed(t,n,r),o=function(){var t=ft(this,w.extend({},e),a);(i||Q.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||!1===a.queue?this.each(o):this.queue(a.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,i=null!=e&&e+"queueHooks",a=w.timers,o=Q.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&ct.test(i)&&r(o[i]);for(i=a.length;i--;)a[i].elem!==this||null!=e&&a[i].queue!==e||(a[i].anim.stop(n),t=!1,a.splice(i,1));!t&&n||w.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=Q.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],a=w.timers,o=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish}))}}),w.each(["toggle","show","hide"],(function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(dt(t,!0),e,r,i)}})),w.each({slideDown:dt("show"),slideUp:dt("hide"),slideToggle:dt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}})),w.timers=[],w.fx.tick=function(){var e,t=0,n=w.timers;for(at=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||w.fx.stop(),at=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){ot||(ot=!0,lt())},w.fx.stop=function(){ot=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(e,t){return e=w.fx&&w.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,r){var i=n.setTimeout(t,e);r.stop=function(){n.clearTimeout(i)}}))},function(){var e=b.createElement("input"),t=b.createElement("select").appendChild(b.createElement("option"));e.type="checkbox",v.checkOn=""!==e.value,v.optSelected=t.selected,(e=b.createElement("input")).value="t",e.type="radio",v.radioValue="t"===e.value}();var pt,mt=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return V(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){w.removeAttr(this,e)}))}}),w.extend({attr:function(e,t,n){var r,i,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return void 0===e.getAttribute?w.prop(e,t,n):(1===a&&w.isXMLDoc(e)||(i=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?pt:void 0)),void 0!==n?null===n?void w.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=w.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!v.radioValue&&"radio"===t&&x(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(j);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),pt={set:function(e,t,n){return!1===t?w.removeAttr(e,n):e.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=mt[t]||w.find.attr;mt[t]=function(e,t,r){var i,a,o=t.toLowerCase();return r||(a=mt[o],mt[o]=i,i=null!=n(e,t,r)?o:null,mt[o]=a),i}}));var vt=/^(?:input|select|textarea|button)$/i,gt=/^(?:a|area)$/i;function yt(e){return(e.match(j)||[]).join(" ")}function bt(e){return e.getAttribute&&e.getAttribute("class")||""}function St(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(j)||[]}w.fn.extend({prop:function(e,t){return V(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[w.propFix[e]||e]}))}}),w.extend({prop:function(e,t,n){var r,i,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&w.isXMLDoc(e)||(t=w.propFix[t]||t,i=w.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):vt.test(e.nodeName)||gt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),v.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){w.propFix[this.toLowerCase()]=this})),w.fn.extend({addClass:function(e){var t,n,r,i,a,o,s,c=0;if(g(e))return this.each((function(t){w(this).addClass(e.call(this,t,bt(this)))}));if((t=St(e)).length)for(;n=this[c++];)if(i=bt(n),r=1===n.nodeType&&" "+yt(i)+" "){for(o=0;a=t[o++];)r.indexOf(" "+a+" ")<0&&(r+=a+" ");i!==(s=yt(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,a,o,s,c=0;if(g(e))return this.each((function(t){w(this).removeClass(e.call(this,t,bt(this)))}));if(!arguments.length)return this.attr("class","");if((t=St(e)).length)for(;n=this[c++];)if(i=bt(n),r=1===n.nodeType&&" "+yt(i)+" "){for(o=0;a=t[o++];)for(;r.indexOf(" "+a+" ")>-1;)r=r.replace(" "+a+" "," ");i!==(s=yt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e,r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):g(e)?this.each((function(n){w(this).toggleClass(e.call(this,n,bt(this),t),t)})):this.each((function(){var t,i,a,o;if(r)for(i=0,a=w(this),o=St(e);t=o[i++];)a.hasClass(t)?a.removeClass(t):a.addClass(t);else void 0!==e&&"boolean"!==n||((t=bt(this))&&Q.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":Q.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+yt(bt(n))+" ").indexOf(t)>-1)return!0;return!1}});var _t=/\r/g;w.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=g(e),this.each((function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,w(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=w.map(i,(function(e){return null==e?"":e+""}))),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))}))):i?(t=w.valHooks[i.type]||w.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(_t,""):null==n?"":n:void 0}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:yt(w.text(e))}},select:{get:function(e){var t,n,r,i=e.options,a=e.selectedIndex,o="select-one"===e.type,s=o?null:[],c=o?a+1:i.length;for(r=a<0?c:o?a:0;r<c;r++)if(((n=i[r]).selected||r===a)&&!n.disabled&&(!n.parentNode.disabled||!x(n.parentNode,"optgroup"))){if(t=w(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,a=w.makeArray(t),o=i.length;o--;)((r=i[o]).selected=w.inArray(w.valHooks.option.get(r),a)>-1)&&(n=!0);return n||(e.selectedIndex=-1),a}}}}),w.each(["radio","checkbox"],(function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},v.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),v.focusin="onfocusin"in n;var Ct=/^(?:focusinfocus|focusoutblur)$/,wt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(e,t,r,i){var a,o,s,c,l,u,d,h,p=[r||b],m=f.call(e,"type")?e.type:e,v=f.call(e,"namespace")?e.namespace.split("."):[];if(o=h=s=r=r||b,3!==r.nodeType&&8!==r.nodeType&&!Ct.test(m+w.event.triggered)&&(m.indexOf(".")>-1&&(v=m.split("."),m=v.shift(),v.sort()),l=m.indexOf(":")<0&&"on"+m,(e=e[w.expando]?e:new w.Event(m,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=v.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:w.makeArray(t,[e]),d=w.event.special[m]||{},i||!d.trigger||!1!==d.trigger.apply(r,t))){if(!i&&!d.noBubble&&!y(r)){for(c=d.delegateType||m,Ct.test(c+m)||(o=o.parentNode);o;o=o.parentNode)p.push(o),s=o;s===(r.ownerDocument||b)&&p.push(s.defaultView||s.parentWindow||n)}for(a=0;(o=p[a++])&&!e.isPropagationStopped();)h=o,e.type=a>1?c:d.bindType||m,(u=(Q.get(o,"events")||Object.create(null))[e.type]&&Q.get(o,"handle"))&&u.apply(o,t),(u=l&&o[l])&&u.apply&&J(o)&&(e.result=u.apply(o,t),!1===e.result&&e.preventDefault());return e.type=m,i||e.isDefaultPrevented()||d._default&&!1!==d._default.apply(p.pop(),t)||!J(r)||l&&g(r[m])&&!y(r)&&((s=r[l])&&(r[l]=null),w.event.triggered=m,e.isPropagationStopped()&&h.addEventListener(m,wt),r[m](),e.isPropagationStopped()&&h.removeEventListener(m,wt),w.event.triggered=void 0,s&&(r[l]=s)),e.result}},simulate:function(e,t,n){var r=w.extend(new w.Event,n,{type:e,isSimulated:!0});w.event.trigger(r,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each((function(){w.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return w.event.trigger(e,t,n,!0)}}),v.focusin||w.each({focus:"focusin",blur:"focusout"},(function(e,t){var n=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,i=Q.access(r,t);i||r.addEventListener(e,n,!0),Q.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,i=Q.access(r,t)-1;i?Q.access(r,t,i):(r.removeEventListener(e,n,!0),Q.remove(r,t))}}}));var Et=n.location,Tt={guid:Date.now()},kt=/\?/;w.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new n.DOMParser).parseFromString(e,"text/xml")}catch(r){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+e),t};var Mt=/\[\]$/,Dt=/\r?\n/g,xt=/^(?:submit|button|image|reset|file)$/i,Rt=/^(?:input|select|textarea|keygen)/i;function Ot(e,t,n,r){var i;if(Array.isArray(t))w.each(t,(function(t,i){n||Mt.test(e)?r(e,i):Ot(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)}));else if(n||"object"!==C(t))r(e,t);else for(i in t)Ot(e+"["+i+"]",t[i],n,r)}w.param=function(e,t){var n,r=[],i=function(e,t){var n=g(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,(function(){i(this.name,this.value)}));else for(n in e)Ot(n,e[n],t,i);return r.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&Rt.test(this.nodeName)&&!xt.test(e)&&(this.checked||!me.test(e))})).map((function(e,t){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,(function(e){return{name:t.name,value:e.replace(Dt,"\r\n")}})):{name:t.name,value:n.replace(Dt,"\r\n")}})).get()}});var It=/%20/g,Pt=/#.*$/,At=/([?&])_=[^&]*/,Lt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Nt=/^(?:GET|HEAD)$/,jt=/^\/\//,Ut={},Ft={},Ht="*/".concat("*"),Wt=b.createElement("a");function Yt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,a=t.toLowerCase().match(j)||[];if(g(n))for(;r=a[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Bt(e,t,n,r){var i={},a=e===Ft;function o(s){var c;return i[s]=!0,w.each(e[s]||[],(function(e,s){var l=s(t,n,r);return"string"!=typeof l||a||i[l]?a?!(c=l):void 0:(t.dataTypes.unshift(l),o(l),!1)})),c}return o(t.dataTypes[0])||!i["*"]&&o("*")}function Vt(e,t){var n,r,i=w.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&w.extend(!0,e,r),e}Wt.href=Et.href,w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ht,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Vt(Vt(e,w.ajaxSettings),t):Vt(w.ajaxSettings,e)},ajaxPrefilter:Yt(Ut),ajaxTransport:Yt(Ft),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0);var r,i,a,o,s,c,l,u,d,h,f=w.ajaxSetup({},t=t||{}),p=f.context||f,m=f.context&&(p.nodeType||p.jquery)?w(p):w.event,v=w.Deferred(),g=w.Callbacks("once memory"),y=f.statusCode||{},S={},_={},C="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(l){if(!o)for(o={};t=Lt.exec(a);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return l?a:null},setRequestHeader:function(e,t){return null==l&&(e=_[e.toLowerCase()]=_[e.toLowerCase()]||e,S[e]=t),this},overrideMimeType:function(e){return null==l&&(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)E.always(e[E.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||C;return r&&r.abort(t),T(0,t),this}};if(v.promise(E),f.url=((e||f.url||Et.href)+"").replace(jt,Et.protocol+"//"),f.type=t.method||t.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(j)||[""],null==f.crossDomain){c=b.createElement("a");try{c.href=f.url,c.href=c.href,f.crossDomain=Wt.protocol+"//"+Wt.host!=c.protocol+"//"+c.host}catch(k){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=w.param(f.data,f.traditional)),Bt(Ut,f,t,E),l)return E;for(d in(u=w.event&&f.global)&&0==w.active++&&w.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Nt.test(f.type),i=f.url.replace(Pt,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(It,"+")):(h=f.url.slice(i.length),f.data&&(f.processData||"string"==typeof f.data)&&(i+=(kt.test(i)?"&":"?")+f.data,delete f.data),!1===f.cache&&(i=i.replace(At,"$1"),h=(kt.test(i)?"&":"?")+"_="+Tt.guid+++h),f.url=i+h),f.ifModified&&(w.lastModified[i]&&E.setRequestHeader("If-Modified-Since",w.lastModified[i]),w.etag[i]&&E.setRequestHeader("If-None-Match",w.etag[i])),(f.data&&f.hasContent&&!1!==f.contentType||t.contentType)&&E.setRequestHeader("Content-Type",f.contentType),E.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Ht+"; q=0.01":""):f.accepts["*"]),f.headers)E.setRequestHeader(d,f.headers[d]);if(f.beforeSend&&(!1===f.beforeSend.call(p,E,f)||l))return E.abort();if(C="abort",g.add(f.complete),E.done(f.success),E.fail(f.error),r=Bt(Ft,f,t,E)){if(E.readyState=1,u&&m.trigger("ajaxSend",[E,f]),l)return E;f.async&&f.timeout>0&&(s=n.setTimeout((function(){E.abort("timeout")}),f.timeout));try{l=!1,r.send(S,T)}catch(k){if(l)throw k;T(-1,k)}}else T(-1,"No Transport");function T(e,t,o,c){var d,h,b,S,_,C=t;l||(l=!0,s&&n.clearTimeout(s),r=void 0,a=c||"",E.readyState=e>0?4:0,d=e>=200&&e<300||304===e,o&&(S=function(e,t,n){for(var r,i,a,o,s=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){c.unshift(i);break}if(c[0]in n)a=c[0];else{for(i in n){if(!c[0]||e.converters[i+" "+c[0]]){a=i;break}o||(o=i)}a=a||o}if(a)return a!==c[0]&&c.unshift(a),n[a]}(f,E,o)),!d&&w.inArray("script",f.dataTypes)>-1&&(f.converters["text script"]=function(){}),S=function(e,t,n,r){var i,a,o,s,c,l={},u=e.dataTypes.slice();if(u[1])for(o in e.converters)l[o.toLowerCase()]=e.converters[o];for(a=u.shift();a;)if(e.responseFields[a]&&(n[e.responseFields[a]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=a,a=u.shift())if("*"===a)a=c;else if("*"!==c&&c!==a){if(!(o=l[c+" "+a]||l["* "+a]))for(i in l)if((s=i.split(" "))[1]===a&&(o=l[c+" "+s[0]]||l["* "+s[0]])){!0===o?o=l[i]:!0!==l[i]&&(a=s[0],u.unshift(s[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(k){return{state:"parsererror",error:o?k:"No conversion from "+c+" to "+a}}}return{state:"success",data:t}}(f,S,E,d),d?(f.ifModified&&((_=E.getResponseHeader("Last-Modified"))&&(w.lastModified[i]=_),(_=E.getResponseHeader("etag"))&&(w.etag[i]=_)),204===e||"HEAD"===f.type?C="nocontent":304===e?C="notmodified":(C=S.state,h=S.data,d=!(b=S.error))):(b=C,!e&&C||(C="error",e<0&&(e=0))),E.status=e,E.statusText=(t||C)+"",d?v.resolveWith(p,[h,C,E]):v.rejectWith(p,[E,C,b]),E.statusCode(y),y=void 0,u&&m.trigger(d?"ajaxSuccess":"ajaxError",[E,f,d?h:b]),g.fireWith(p,[E,C]),u&&(m.trigger("ajaxComplete",[E,f]),--w.active||w.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,t){return w.get(e,void 0,t,"script")}}),w.each(["get","post"],(function(e,t){w[t]=function(e,n,r,i){return g(n)&&(i=i||r,r=n,n=void 0),w.ajax(w.extend({url:e,type:t,dataType:i,data:n,success:r},w.isPlainObject(e)&&e))}})),w.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),w._evalUrl=function(e,t,n){return w.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){w.globalEval(e,t,n)}})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(g(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return g(e)?this.each((function(t){w(this).wrapInner(e.call(this,t))})):this.each((function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=g(e);return this.each((function(n){w(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){w(this).replaceWith(this.childNodes)})),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new n.XMLHttpRequest}catch(e){}};var $t={0:200,1223:204},Gt=w.ajaxSettings.xhr();v.cors=!!Gt&&"withCredentials"in Gt,v.ajax=Gt=!!Gt,w.ajaxTransport((function(e){var t,r;if(v.cors||Gt&&!e.crossDomain)return{send:function(i,a){var o,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)s[o]=e.xhrFields[o];for(o in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(o,i[o]);t=function(e){return function(){t&&(t=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?a(0,"error"):a(s.status,s.statusText):a($t[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),r=s.onerror=s.ontimeout=t("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&n.setTimeout((function(){t&&r()}))},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(c){if(t)throw c}},abort:function(){t&&t()}}})),w.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),w.ajaxTransport("script",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,i){t=w("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),b.head.appendChild(t[0])},abort:function(){n&&n()}}}));var zt,qt=[],Jt=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=qt.pop()||w.expando+"_"+Tt.guid++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",(function(e,t,r){var i,a,o,s=!1!==e.jsonp&&(Jt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Jt.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=g(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(Jt,"$1"+i):!1!==e.jsonp&&(e.url+=(kt.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||w.error(i+" was not called"),o[0]},e.dataTypes[0]="json",a=n[i],n[i]=function(){o=arguments},r.always((function(){void 0===a?w(n).removeProp(i):n[i]=a,e[i]&&(e.jsonpCallback=t.jsonpCallback,qt.push(i)),o&&g(a)&&a(o[0]),o=a=void 0})),"script"})),v.createHTMLDocument=((zt=b.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===zt.childNodes.length),w.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(v.createHTMLDocument?((r=(t=b.implementation.createHTMLDocument("")).createElement("base")).href=b.location.href,t.head.appendChild(r)):t=b),a=!n&&[],(i=R.exec(e))?[t.createElement(i[1])]:(i=Ce([e],t,a),a&&a.length&&w(a).remove(),w.merge([],i.childNodes)));var r,i,a},w.fn.load=function(e,t,n){var r,i,a,o=this,s=e.indexOf(" ");return s>-1&&(r=yt(e.slice(s)),e=e.slice(0,s)),g(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),o.length>0&&w.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done((function(e){a=arguments,o.html(r?w("<div>").append(w.parseHTML(e)).find(r):e)})).always(n&&function(e,t){o.each((function(){n.apply(this,a||[e.responseText,t,e])}))}),this},w.expr.pseudos.animated=function(e){return w.grep(w.timers,(function(t){return e===t.elem})).length},w.offset={setOffset:function(e,t,n){var r,i,a,o,s,c,l=w.css(e,"position"),u=w(e),d={};"static"===l&&(e.style.position="relative"),s=u.offset(),a=w.css(e,"top"),c=w.css(e,"left"),("absolute"===l||"fixed"===l)&&(a+c).indexOf("auto")>-1?(o=(r=u.position()).top,i=r.left):(o=parseFloat(a)||0,i=parseFloat(c)||0),g(t)&&(t=t.call(e,n,w.extend({},s))),null!=t.top&&(d.top=t.top-s.top+o),null!=t.left&&(d.left=t.left-s.left+i),"using"in t?t.using.call(e,d):("number"==typeof d.top&&(d.top+="px"),"number"==typeof d.left&&(d.left+="px"),u.css(d))}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){w.offset.setOffset(this,e,t)}));var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===w.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===w.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=w(e).offset()).top+=w.css(e,"borderTopWidth",!0),i.left+=w.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-w.css(r,"marginTop",!0),left:t.left-i.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===w.css(e,"position");)e=e.offsetParent;return e||ae}))}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;w.fn[e]=function(r){return V(this,(function(e,r,i){var a;if(y(e)?a=e:9===e.nodeType&&(a=e.defaultView),void 0===i)return a?a[t]:e[r];a?a.scrollTo(n?a.pageXOffset:i,n?i:a.pageYOffset):e[r]=i}),e,r,arguments.length)}})),w.each(["top","left"],(function(e,t){w.cssHooks[t]=Ge(v.pixelPosition,(function(e,n){if(n)return n=$e(e,t),We.test(n)?w(e).position()[t]+"px":n}))})),w.each({Height:"height",Width:"width"},(function(e,t){w.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,r){w.fn[r]=function(i,a){var o=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===a?"margin":"border");return V(this,(function(t,n,i){var a;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(a=t.documentElement,Math.max(t.body["scroll"+e],a["scroll"+e],t.body["offset"+e],a["offset"+e],a["client"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)}),t,o?i:void 0,o)}}))})),w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){w.fn[t]=function(e){return this.on(t,e)}})),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var Kt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;w.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),g(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=x,w.isFunction=g,w.isWindow=y,w.camelCase=q,w.type=C,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},w.trim=function(e){return null==e?"":(e+"").replace(Kt,"")},void 0===(r=function(){return w}.apply(t,[]))||(e.exports=r);var Qt=n.jQuery,Xt=n.$;return w.noConflict=function(e){return n.$===w&&(n.$=Xt),e&&n.jQuery===w&&(n.jQuery=Qt),w},void 0===i&&(n.jQuery=n.$=w),w},"object"==typeof e.exports?e.exports=i.document?a(i,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return a(e)}:a(i)},function(e,t){angular.module("rainbow").factory("ConferenceParticipant",[function(){function e(e,t,n,r,i,a,o,s,c,l,u,d){this.participantId=e,this.userId=t,this.jid_im=n,this.jid_tel=r,this.role=i,this.mute=a,this.held=o,this.confStartDate=s,this.startDate=c,this.phoneNumber=l,this.state=u,this.delegateCapability=d,this.updateFromData=function(e){e.participantId&&(this.participantId=e.participantId),e.userId&&(this.userId=e.userId),this.jid_im=e.jid_im,e.jid_tel&&(this.jid_tel=e.jid_tel),this.role=e.participantRole?e.participantRole:this.role,this.confStartDate=e.confStartDate?e.confStartDate:this.confStartDate,this.startDate=e.startDate?e.startDate:this.startDate,this.phoneNumber=e.phoneNumber?e.phoneNumber:this.phoneNumber,this.state=e.participantState?e.participantState:this.state,this.mute=e.mute,this.held=e.held,this.delegateCapability=e.delegateCapability}}return e.createFromData=function(t){return new e(t.participantId,t.userId,t.jid_im,t.jid_tel,t.participantRole,t.mute,t.held,t.confStartDate,t.startDate,t.phoneNumber,t.participantState,t.delegateCapability)},e}])},function(e,t){var n=function(){function e(t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,b){S(this,e),t&&(this.companyId=t),n&&(this.id=n),r&&(this.firstName=r),i&&(this.lastName=i),a&&(this.eMail=a),o&&(this.jobTitle=o),s&&(this.department=s),c&&(this.companyName=c),l&&(this.street=l),u&&(this.city=u),d&&(this.state=d),h&&(this.postalCode=h),f&&(this.country=f),p&&(this.workPhoneNumbers=p),m&&(this.mobilePhoneNumbers=m),v&&(this.otherPhoneNumbers=v),g&&(this.custom1=g),y&&(this.custom2=y),b&&(this.tags=b)}return C(e,null,[{key:"directoryContactFactory",value:function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e(t.companyId,t.id,t.firstName,t.lastName,t.eMail,t.jobTitle,t.department,t.companyName,t.street,t.city,t.state,t.postalCode,t.country,t.workPhoneNumbers,t.mobilePhoneNumbers,t.otherPhoneNumbers,t.custom1,t.custom2,t.tags)}}}]),e}();angular.module("rainbow").factory("directoryContact",n.directoryContactFactory)},function(e,t){angular.module("rainbowAdmin").factory("Offer",[function(){function e(t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y){this.id=t,this.name=n||"",v&&(this.name=this.name.replace(new RegExp("\\bDemo\\b"),"Custom")),this.description=r||"Rainbow "+this.name,this.groupName=p?"Conference":i||n,this.offerReference=a,this.profileId=o,this.canBeSold=s||!1,this.businessModel=c,this.isDefault=l,this.isExclusive=u,this.isPrepaid=d,this.prepaidDuration=h,this.autoSubscribe=f,this.hasConference=p,this.hasVoice=m,this.isDemo=void 0===v?!this.isDefault&&!this.canBeSold&&this.name.toLowerCase().includes("custom"):v,this.isBundle=g,this.isChinaOffer=y,this.disallowUnsubscribeWithAllocatedLicences=this.hasVoice||"Room"===this.groupName,this.disallowAllocationToUsers="Room"===this.groupName,this.hasVoice?this.logo="logo-offer-voice.svg":this.hasConference?this.logo="logo-offer-conference.svg":this.logo=e.getLogoByName(this.name),this.isEnterprise=function(){return this.groupName.toLowerCase().includes("enterprise")},this.isBusiness=function(){return this.groupName.toLowerCase().includes("business")},this.isEssential=function(){return this.isDefault},this.isTrial=function(){return this.isDemo},this.isUserLicense=function(){return this.isDefault||"nb_users"===this.businessModel||"usage"===this.businessModel},this.isDeviceLicense=function(e){return"TV"===e&&"Room"===this.groupName},this.isFixedLicense=function(){return"flat_fee"===this.businessModel},this.isUserBasedLicense=function(){return"nb_users"===this.businessModel},this.isUsageBasedLicense=function(){return"usage"===this.businessModel}}return e.createFromData=function(t){return new e(t.id,t.name,t.description,t.groupName,t.offerReference,t.profileId,t.canBeSold,t.businessModel,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,t.autoSubscribe,t.hasConference,t.hasVoice,t.isDemo,t.isBundle,t.isChinaOffer)},e.createFromSubscriptionData=function(t){return new e(t.offerId,t.offerName,t.offerDescription,t.groupName,t.offerReference,t.profileId,t.canBeSold,t.businessModel,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,t.autoSubscribe,t.hasConference,t.hasVoice,t.isDemo,t.isBundle,t.isChinaOffer)},e.createFromSubscriptionCountersData=function(t){return new e(t.offerId,t.offerName,void 0,t.groupName,t.offerReference,void 0,t.canBeSold,t.businessModel,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,void 0,t.hasConference,t.hasVoice,t.isDemo,t.isBundle)},e.createFromProfileData=function(t){return new e(t.offerId,t.offerName,void 0,void 0,void 0,t.profileId,!1,void 0,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,void 0,t.hasConference,t.hasVoice,t.isDemo,t.isBundle)},e.createFromOperationLog=function(t){var n="delete"===t.operationType?t.previousData:t.newData;return new e(n.offerId,n.offerName,n.offerDescription,void 0,n.offerReference,n.profileId,n.canBeSold,n.businessModel,n.isDefault,n.isExclusive,n.isPrepaid,n.prepaidDuration,void 0,n.hasConference,n.hasVoice,n.isDemo,n.isBundle)},e.getLogoByName=function(e){var t="logo-offer-default.svg";if(e){var n=e.toLowerCase();-1!==n.indexOf("voice")?n="voice":-1!==n.indexOf("conference")?n="conference":-1!==n.indexOf("enterprise")?n="enterprise":-1!==n.indexOf("business")&&(n="business"),t="logo-offer-"+n+".svg"}return t},e.offerComparator=function(e,t){var n=["Essential","Business","Enterprise","Voice","Room","Conference"];if(e.isEssential())return-1;if(t.isEssential())return 1;if(e.isTrial()&&!t.isTrial())return-1;if(!e.isTrial()&&t.isTrial())return 1;if(e.canBeSold&&!t.canBeSold)return-1;if(!e.canBeSold&&t.canBeSold)return 1;if(e.hasConference&&!t.hasConference)return 1;if(!e.hasConference&&t.hasConference)return-1;var r=n.findIndex((function(t){return e.name.startsWith(t)})),i=n.findIndex((function(e){return t.name.startsWith(e)}));return(r=-1===r?n.length:r)<(i=-1===i?n.length:i)?-1:r>i?1:e.isTrial()?-1:t.isTrial()||e.isPrepaid&&!t.isPrepaid?1:!e.isPrepaid&&t.isPrepaid||e.name<t.name?-1:e.name>t.name?1:0},e.isExclusive=function(e){return e.isDefault||e.isExclusive},e.isOptional=function(t){return!e.isExclusive(t)},e.isEssential=function(e){return e.isDefault},e.isNotEssential=function(e){return!e.isDefault},e.isModelByNbUsers=function(e){return"nb_users"===e.businessModel},e.isPrepaid=function(e){return e.isPrepaid},e.isNotPrepaid=function(e){return!e.isPrepaid},e.isUserLicense=function(e){return e.isUserLicense()},e.isUsageBasedLicense=function(e){return e.isUsageBasedLicense()},e}])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(16),a=n(0),o=n(27),s=n(1);angular.module("rainbow").factory("Conversation",["$log","$rootScope",function(e,t){function n(e){var t=this;this.id=e,this.dbId=null,this.type=null,this.owner=null,this.contact=null,this.room=null,this.capabilities=null,this.avatar=null,this.presenceStatus=null,this.name=function(){return{}},this.filterName="",this.missedCounter=0,this.missedCalls=0,this.messages=[],this.participantStatuses={},this.draft="",this.status=n.Status.ACTIVE,this.historyIndex=-1,this.historyMessages=[],this.historyDefered=null,this.historyComplete=!1,this.lastModification=void 0,this.creationDate=new Date,this.lastMessageText="",this.lastMessageSender="",this.forwardFrom=null,this.forwardedMessage=null,this.replaceLastMsgId="",this.pip=!0,this.showVideoGallery=!0,this.videoCall={status:a.Call.Status.UNKNOWN},this.audioCall=null,this.pstnConferenceSession=null,this.webConferenceSession=null,this.isMutedAudio=!1,this.isMutedVideo=!1,this.infoVisible=!1,this.largeInfoVisible=!0,this.muted=!1,this.isFavorite=!1,this.lastEditableMsg=null,this.cacheMessages=[],this.rxSubject=new r.Subject,this.innerHtml="",this.mentionedMembersArray=[],this.telephonyContacts=null,this.isFullScreenNoChat=!1,this.getMessageById=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n){var r=t.cacheMessages.find((function(t){return t.id===e}));if(r)return r}return t.messages.find((function(t){return t.id===e}))},this.getMessageInCacheById=function(e){return t.cacheMessages.find((function(t){return t.id===e}))},this.getReplacedMessageById=function(e){var n=null;return t.messages.forEach((function(t){n=t.replaceMsgs.find((function(t){return t.id===e}))})),n},this.reset=function(){t.messages=[],t.historyIndex=-1,t.historyMessages=[],t.historyComplete=!1,t.currentHistoryId=null,t.lastMessageText=null,t.rxSubject.next({name:"appendMessage"})},this.subscribe=function(e){return t.rxSubject.subscribe(e)}}n.ChatstatesNS="http://jabber.org/protocol/chatstates",n.ReceiptNS="urn:xmpp:receipts",n.contentNS="urn:xmpp:content",n.AttentionNS="urn:xmpp:attention:0",n.FORWARDNS="urn:xmpp:forward:0",n.Type={ONE_TO_ONE:0,ROOM:1,BOT:2},n.EventType={NEW:0,IM:1,CAPABILITIES:2,FILE:3},n.Status={ACTIVE:{key:0,value:"active"},INACTIVE:{key:1,value:"inactive"},COMPOSING:{key:2,value:"composing"},PAUSED:{key:3,value:"paused"}},n.createOneToOneConversation=function(t){e.info("[Conversation] Create one to one conversation ("+t.id+")");var r=new n(t.id);return r.contact=t,t.conversation=r,t.isBot?(r.avatar="",r.type=n.Type.BOT,r.infoVisible=!0):(r.avatar=t.avatar?t.avatar.src:null,r.type=n.Type.ONE_TO_ONE),r.name=t.name,t.displayName&&(r.filterName=t.displayName.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"")),r},n.createRoomConversation=function(t){e.info("[Conversation] Create room conversation ("+t.jid+")");var r=new n(t.jid);return r.type=n.Type.ROOM,r.room=t,r.filterName=t.name.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""),r.infoVisible=!0,r};var c=o(),l=0;return n.getUniqueMessageId=function(){var e="web_"+c+l;return l++,e},n.stringToStatus=function(e){switch(e){case"composing":return n.Status.COMPOSING;case"paused":return n.Status.PAUSED;default:return n.Status.ACTIVE}},n.prototype.setMissedCounter=function(e){this.missedCounter=e,this.rxSubject.next({name:"missedCounter",value:e})},n.prototype.shortnameToUnicode=function(e){return emojione?emojione.shortnameToUnicode(e):e},n.prototype.isInCall=function(){return this.pstnConferenceSession?this.pstnConferenceSession.isParticipantConnectedByJid(s.default.userContact.jid):this.webConferenceSession?this.webConferenceSession.isParticipantConnectedByJid(s.default.userContact.jid)&&this.webConferenceSession.haveJoined:this.videoCall&&this.videoCall.status&&"Unknown"!==this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"Unknown"!==this.audioCall.status.value&&"incommingCall"!==this.audioCall.status.value&&"queued"!==this.audioCall.status.value},n.prototype.isNotInCall=function(){return!(this.videoCall&&this.videoCall.status&&"Unknown"!==this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"Unknown"!==this.audioCall.status.value||"busy"===s.default.userContact.status&&""!==s.default.userContact.message)},n.prototype.isActive=function(){return this.videoCall&&this.videoCall.status&&"active"===this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"active"===this.audioCall.status.value},n.prototype.isHeld=function(){return this.videoCall&&this.videoCall.status&&"held"===this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"held"===this.audioCall.status.value},n.prototype.getMessageByIdInHistory=function(e){return this.historyMessages.find((function(t){return t.id===e}))},n.prototype.addAdminBubbleMessage=function(t,n,r,a){if(this.getMessageById(a))return e.info("[Conversation] "+this.id+" add addAdminBubbleMessage message ("+a+") already exists."),null;e.info("[Conversation] "+this.id+" add addAdminBubbleMessage from "+t.jid+" : "+r);var o=r+"MsgRoom",s=i.Message.Side.ADMIN,c=i.Message.create(a,n,t,s,o,!1);return c.setReceiptStatus(i.Message.ReceiptStatus.SENT),this.addMessage(c)},n.prototype.addFSMessage=function(t,r,a,o){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=n.getUniqueMessageId(),h=this.shortnameToUnicode(r),f=new Date;e.info("[Conversation] "+this.id+" add FILE SHARING message from me");var p=i.Message.createFileSharingMessage(d,f,s.default.userContact,"R",h,a,t,null,o,c,u);return p.urgency=l,p.setReceiptStatus(i.Message.ReceiptStatus.IN_PROGRESS),this.addMessage(p)},n.prototype.addChatMessage=function(t,n,r,a,o,c,l,u,d,h,f,p,m){if(this.getMessageById(a))return e.info("[Conversation] "+this.id+" add CHAT message ("+a+") already exists."),null;e.info("[Conversation] "+this.id+" add CHAT message ("+a+") from "+t.jid);var v=s.default.isUserContact(t)?"R":"L",g=i.Message.create(a,n,t,v,r,!1,c,h,l,u,d,f,p);return g.urgency=m,o?g.setReceiptStatus(i.Message.ReceiptStatus.IN_PROGRESS):g.setReceiptStatus(i.Message.ReceiptStatus.SENT),this.addMessage(g)},n.prototype.addForwardChatMessage=function(t,r,a,o,c){if(this.getMessageById(a))return e.info("[Conversation] "+this.id+" add CHAT message ("+a+") already exists."),null;e.info("[Conversation] "+this.id+" add CHAT message ("+a+") from "+t.jid);var l=s.default.isUserContact(t)?"R":"L",u=i.Message.create(a,r,t,l,"",!1,!1);u.setReceiptStatus(i.Message.ReceiptStatus.IN_PROGRESS),u.forwardedMsg=o,u.forwardConvType=c.type===n.Type.ONE_TO_ONE?"chat":"groupchat",u.isForwarded=!0;var d=i.Message.createFromMsg(u.forwardedMsg);return d.id=a,d.side=l,d.date=r,d.from=t,d.isForwarded=!0,this.addMessage(d),u},n.prototype.addRecordingMessage=function(e,t,n,r){var a=i.Message.createRecordingAdminMessage(r,t,e,"ADMIN",n);return this.addMessage(a)},n.prototype.addFileMessage=function(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;e.info("[Conversation] "+this.id+" add FILE message from "+t.jid+" : "+r);var c=s.default.isUserContact(t)?"R":"L",l=i.Message.createFileMessage(a,n,t,c,r,!1);return l.urgency=o,this.addMessage(l)},n.prototype.addFileSharingMessage=function(t,n,r,a,o,c,l,u,d){var h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;e.info("[Conversation] "+this.id+" add FILE SHARING message from "+t.jid+" : "+r);var f=s.default.isUserContact(t)?"R":"L",p=i.Message.createFileSharingMessage(a,n,t,f,r,!1,o,c,null,l,h);return p.urgency=u,p.isForwarded=d,this.addMessage(p)},n.prototype.addWebRTCMessage=function(t,n,r,a){if(this.getMessageById(a))return e.info("[Conversation] "+this.id+" add addWebRTCMessage message ("+a+") already exists."),null;e.info("[Conversation] "+this.id+" add WebRTC message from "+t.jid+" : "+r);var o=s.default.isUserContact(t)?i.Message.Side.RIGHT:i.Message.Side.LEFT,c=i.Message.createWebRTCMessage(a,n,t,o,r,!1);return this.addMessage(c)},n.prototype.updateMessage=function(e){e.sendUpdateEvent()},n.prototype.addMessage=function(r){if(this.messages.find((function(e){return e.id===r.id})))return e.info("[Conversation] "+this.id+" try to add an already stored message with id "+r.id),r;if(r.side===i.Message.Side.LEFT)r.type===i.Message.Type.WEBRTC&&(this.missedCalls+=1),this.setStatusMessage(r.from,n.Status.ACTIVE);else{var a=this.lastEditableMsg;this.lastEditableMsg=r,a&&this.updateMessage(a)}return this.messages.push(r),this.lastModification=new Date,this.lastMessageText=r.data,this.lastMessageSender=r.from.id,this.replaceLastMsgId=null,r.isForwarded?(this.forwardFrom=r.from.jid,this.forwardedMessage=r.data):(this.forwardFrom=null,this.forwardedMessage=null),this.rxSubject.next({name:"appendMessage",message:r}),t.$broadcast("ON_CONVERSATION_UPDATED_EVENT",this.id),r},n.prototype.addMessageInHistoryMessages=function(e){if(e&&(this.historyMessages.push(e),e.side===i.Message.Side.RIGHT&&(!this.lastEditableMsg||e.date.getTime()>this.lastEditableMsg.date.getTime()))){var t=this.lastEditableMsg;this.lastEditableMsg=e,t&&this.updateMessage(t)}},n.prototype.addMessageInCacheMessages=function(e){e&&(this.getMessageInCacheById(e.id)||(this.cacheMessages.push(e),this.rxSubject.next({name:"cachedMessage",message:e})))},n.prototype.removeMessage=function(e){var t=this.messages.lastIndexOf(e);-1!==t&&this.messages.splice(t,1)},n.prototype.setStatusMessage=function(t,n){e.info("[Conversation] "+this.id+" add status message from "+t.jid+" : "+n.value),this.participantStatuses[t.jid]=n,this.rxSubject.next({name:"status",value:n})},n.prototype.ackReadAllSentMessages=function(){var e=this;this.messages.forEach((function(t){"R"!==t.side||t.receiptStatus!==i.Message.ReceiptStatus.SENT&&t.receiptStatus!==i.Message.ReceiptStatus.UNREAD||(t.setReceiptStatus(i.Message.ReceiptStatus.READ),e.updateMessage(t))}))},n.prototype.ackReadAllReceivedMessages=function(){var e=this,t=!1;return this.messages.forEach((function(n){"R"===n.side||n.receiptStatus!==i.Message.ReceiptStatus.SENT&&n.receiptStatus!==i.Message.ReceiptStatus.UNREAD||(n.setReceiptStatus(i.Message.ReceiptStatus.READ),e.updateMessage(n),t=!0)})),t},n.prototype.updateAfterReplaceEvent=function(e){var t=this.messages[this.messages.length-1];t&&t.id===e.id&&(this.lastModification=new Date,this.lastMessageText=e.getLastTextModified(),this.lastMessageSender=e.from.id,this.replaceLastMsgId=t.id,this.rxSubject.next({name:"replaceMessage",message:e}))},n}])},function(e,t,n){var r,i,a=n(223),o=n(224),s=0,c=0;e.exports=function(e,t,n){var l=t&&n||0,u=t||[],d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var f=a();null==d&&(d=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=i=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:c+1,v=p-s+(m-c)/1e4;if(v<0&&void 0===e.clockseq&&(h=h+1&16383),(v<0||p>s)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=p,c=m,i=h;var g=(1e4*(268435455&(p+=122192928e5))+m)%4294967296;u[l++]=g>>>24&255,u[l++]=g>>>16&255,u[l++]=g>>>8&255,u[l++]=255&g;var y=p/4294967296*1e4&268435455;u[l++]=y>>>8&255,u[l++]=255&y,u[l++]=y>>>24&15|16,u[l++]=y>>>16&255,u[l++]=h>>>8|128,u[l++]=255&h;for(var b=0;b<6;++b)u[l+b]=d[b];return t||o(u)}},function(e,t,n){var r=n(223),i=n(224);e.exports=function(e,t,n){var a=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[a+s]=o[s];return t||i(o)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.RBNotification=function(){return function e(t){S(this,e),this.date=t}}()},function(e,t){angular.module("rainbow").factory("CallLog",[function(){function e(t,n,r,i,a,o,s,c,l,u){this.id=t,this.contact=n,this.state=r,this.duration=i,this.direction=c,this.callSubject=l,this.isLatestCall=u,a="unknown"===a||"audio"===a||"webrtc"===a?e.Type.WEBRTC:"telephone"===a?e.Type.TELEPHONE:e.Type.CONFERENCE,this.type=a,this.read=o,this.date=s,this.updateCallLogDisplayInfo=function(){"missed"===this.state&&"incoming"===this.direction?(this.svgId="call_missed",this.svgClass="missed",this.title="missedCall"):"missed"===this.state&&"outgoing"===this.direction?(this.svgId="call_missed-outgoing",this.svgClass="missed",this.title="noAnswer"):"incoming"===this.direction?(this.svgId="call_received",this.svgClass="active",this.title="incommingCall"):"outgoing"===this.direction&&(this.svgId="call_made",this.svgClass="active",this.title="outgoingCall")}}return e.create=function(t,n,r,i,a,o,s,c,l,u){return new e(t,n,r,i,a,o,s,c,l,u)},e.getNames=function(e){var t={firstname:"",lastname:""};return e&&e.contact&&(t.firstname=e.contact.firstname?e.contact.firstname.toUpperCase():"",t.lastname=e.contact.lastname?e.contact.lastname.toUpperCase():"",e&&e.date&&(t.date=e.date.getTime())),t},e.getDate=function(e){return e&&e.date?e.date.getTime():0},e.sortByContact=function(e,t){var n=-1;if(e&&e.value.lastname&&t&&t.value.lastname){var r=e.value.lastname,i=t.value.lastname;0===(n=r.localeCompare(i))&&(r=e.value.firstname,i=t.value.firstname,0===(n=r.localeCompare(i))&&t.value.date&&e.value.date&&(n=t.value.date-e.value.date))}return n},e.sortByDate=function(e,t){var n=1;return e&&t&&(n=t.value-e.value),n},e.Type={WEBRTC:"webrtc",TELEPHONE:"telephone",CONFERENCE:"conference"},e}])},function(e,t,n){n.r(t);var r=n(6),i=n.n(r);angular.module("rainbow").factory("VoiceMail",[function(){function e(){this.VMFlag=!1,this.VMCounter=0,this.infoMsg="",this.voiceMailFeatureEnabled=i.a.isFeatureEnabled(i.a.FeaturesEnum.TELEPHONY_VOICE_MAIL),this.setVMFlag=function(e){this.VMFlag=e},this.getVMFlag=function(){return this.VMFlag},this.setVMCounter=function(e){e>0?(this.VMFlag=!0,this.VMCounter=e):this.VMCounter=0},this.getVMCounter=function(){return this.VMCounter},this.setInfoMsg=function(e){this.infoMsg=e},this.getInfoMsg=function(){return this.infoMsg},this.getDisplayState=function(){return this.voiceMailFeatureEnabled}}return e.create=function(){return new e},e}])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n,r,i,a,o,s){S(this,e),this.id=null,this.name=null,this.isDefault=!1,this.isExclusive=!1,this.hasConference=!1,this.isPrepaid=!1,this.isDemo=!1,this.id=t,this.name=n||"",this.isDefault=r,this.isExclusive=i,this.isPrepaid=a,this.hasConference=o,this.isDemo=s}return C(e,[{key:"isEnterprise",value:function(){return this.name.toLowerCase().startsWith("enterprise")}},{key:"isBusiness",value:function(){return this.name.toLowerCase().startsWith("business")}},{key:"isEssential",value:function(){return this.isDefault}}],[{key:"createFromProfileData",value:function(t){return new e(t.offerId,t.offerName,t.isDefault,t.isExclusive,t.isPrepaid,t.hasConference,t.isDemo)}},{key:"offerComparator",value:function(e,t){var n=["Essential","Business","Enterprise","Voice","Room","Conference"];if(e.isEssential())return-1;if(t.isEssential())return 1;if(e.isDemo&&!t.isDemo)return-1;if(!e.isDemo&&t.isDemo)return 1;if(e.hasConference&&!t.hasConference)return 1;if(!e.hasConference&&t.hasConference)return-1;var r=n.findIndex((function(t){return e.name.startsWith(t)})),i=n.findIndex((function(e){return t.name.startsWith(e)}));return(r=-1===r?n.length:r)<(i=-1===i?n.length:i)?-1:r>i?1:e.isDemo?-1:t.isDemo||e.isPrepaid&&!t.isPrepaid?1:!e.isPrepaid&&t.isPrepaid||e.name<t.name?-1:e.name>t.name?1:0}}]),e}();t.Offer=r},function(e,t){angular.module("rainbow").factory("Organisation",[function(){function e(e,t,n){this.id=e,this.name=t,this.visibility=n,this.companies=[]}return e.createFromData=function(t){return new e(t.id,t.name,t.visibility)},e}])},function(e,t){angular.module("rainbowAdmin").factory("Bot",[function(){function e(e,t,n,r,i,a){this.jid=e,this.name=t,this.id=n,this.avatarId=r||n,this.lastAvatarUpdateDate=i,this.isAvatarCustomized=a}return e.create=function(t){return new e(t.jid,t.name,t.id,t.avatarId,t.lastAvatarUpdateDate,t.isBotAvatarCustomized)},e}])},function(e,t){angular.module("rainbow").factory("Site",[function(){function e(e,t,n,r,i,a){this.id=e,this.name=t||"",this.status=n||"",this.companyId=r||"",this.settings=i||"",angular.isDefined(a)&&(this.isCentrex=a)}return e.createFromData=function(t){return new e(t.id,t.name,t.status,t.companyId,t.settings,t.isCentrex)},e.create=function(t,n,r,i){return new e(t,n,r,i)},e.StatusValues=["active","alerting","hold","terminated"],e}])},function(e,t){angular.module("rainbow").factory("System",[function(){function e(t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,b,S,_,C,w,E,T){this.id=t||null,this.type=s||null,this.type!==e.TypeEnum.CLOUD_PBX&&(this.jid_pbxagent=r||"",this.jid_password=i||"",this.jid_pbxagent_password=f||"",this.jid_pbxagent_password_activating=p||"",this.pbxMainBundlePrefix=a||["0"],this.usePbxMainBundlePrefix=!angular.isDefined(m)||m,this.pbxNumberingTranslator=v||[],this.pbxNationalPrefix=E,this.pbxInternationalPrefix=T),this.country=d||"FRA",this.name=h||"",u&&(this.siteId=u),n&&(this.pbxId=n),o&&(this.serverPingTimeout=o),c&&(this.status=c),l&&(this.version=l),angular.isDefined(g)&&(this.isCentrex=g),angular.isDefined(y)&&(this.isShared=y),b&&(this.bpId=b),angular.isDefined(_)&&(this.hasMediaPillar=_),angular.isDefined(C)&&(this.isOxoManaged=C),S?(S.domainName&&(this.domainName=S.domainName),S.numberingDigits&&(this.numberingDigits=S.numberingDigits),S.numberingPrefix&&(this.numberingPrefix=S.numberingPrefix),S.outgoingPrefix&&(this.outgoingPrefix=S.outgoingPrefix),S.externalTrunkId&&(this.externalTrunkId=S.externalTrunkId),S.installationNumber&&(this.installationNumber=S.installationNumber),S.installationNumberId&&(this.installationNumberId=S.installationNumberId),S.language&&(this.language=S.language),S.customSipHeader_1&&(this.customSipHeader_1=S.customSipHeader_1),S.customSipHeader_2&&(this.customSipHeader_2=S.customSipHeader_2),S.overflowSubscribersToVoicemail&&(angular.isDefined(S.overflowSubscribersToVoicemail.activate)&&(this.callOverflowToVMActivate=S.overflowSubscribersToVoicemail.activate),S.overflowSubscribersToVoicemail.noReplyDelay&&(this.callOverflowToVMNoReplyDelay=S.overflowSubscribersToVoicemail.noReplyDelay)),S.barringOptions&&(S.barringOptions.permissions&&(this.barringOptionsPermission=S.barringOptions.permissions),S.barringOptions.restrictions&&(this.barringOptionsRestriction=S.barringOptions.restrictions)),S.cliOptions&&(this.cliOptions=S.cliOptions),S.emergencyOptions&&(this.emergencyOptions=S.emergencyOptions),S.callForwardOptions&&(this.callForwardOptions=S.callForwardOptions),angular.isDefined(S.allowCloudPbxRecording)&&(this.allowCloudPbxRecording=S.allowCloudPbxRecording)):C&&w?(w.numberingDigits&&(this.numberingDigits=w.numberingDigits),w.numberingPrefix&&(this.numberingPrefix=w.numberingPrefix),w.outgoingPrefix&&(this.outgoingPrefix=w.outgoingPrefix),w.target&&(this.target=w.target),w.installationNumber&&(this.installationNumber=w.installationNumber),w.installationNumberId&&(this.installationNumberId=w.installationNumberId)):(this.numberingDigits=3,this.numberingPrefix="1"),this.isCallForwardAuthorized=function(){return this.callForwardOptions&&"authorized"===this.callForwardOptions.externalCallForward}}return e.createFromData=function(t){return new e(t.id,t.pbxId,t.jid_pbxagent,t.jid_password,t.pbxMainBundlePrefix,t.serverPingTimeout,t.type,t.status,t.version,t.siteId,t.country,t.name,t.jid_pbxagent_password,t.jid_pbxagent_password_activating,t.usePbxMainBundlePrefix,t.pbxNumberingTranslator,t.isCentrex,t.isShared,t.bpId,t.cloudpbx,t.hasMediaPillar,t.isOxoManaged,t.oxopbx,t.pbxNationalPrefix,t.pbxInternationalPrefix)},e.create=function(){return new e},e.TypeValues=["oxe","oxo","third_party","cloud_pbx","oxo_managed"],e.TypeEnum={OXE:"oxe",OXO:"oxo",THIRD_PARTY:"third_party",CLOUD_PBX:"cloud_pbx",OXO_MANAGED:"oxo_managed"},e.StatusValues=["created","activating","activated"],e.CliPolicy={USER_DDI_NUMBER:"user_ddi_number",INSTALLATION_DDI_NUMBER:"installation_ddi_number"},e.CliPolicyValues=[e.CliPolicy.USER_DDI_NUMBER,e.CliPolicy.INSTALLATION_DDI_NUMBER],e}]),angular.module("rainbow").filter("serverTypeFilter",[function(){return function(e){return"oxo"===e?"OXO Connect":"oxe"===e?"OmniPCX Enterprise":"third_party"===e?"Third party PBX":"cloud_pbx"===e?"Cloud PBX":"oxo_managed"===e?"Managed OXO Connect":e}}]),angular.module("rainbow").filter("systemStateFilter",[function(){return function(e){return"created"===e||"activating"===e?"pending":"activated"===e?"systemStatusActivated":"connected"===e?"systemStatusConnected":"disconnected"===e?"systemStatusDisonnected":"degraded"===e?"systemStatusDegraded":e}}]),angular.module("rainbow").filter("systemStateColorFilter",[function(){return function(e){return"created"===e||"activating"===e||"activated"===e?"color_blue":"connected"===e?"color_green":"disconnected"===e?"color_error":"degraded"===e?"color_warning":e}}]),angular.module("rainbow").filter("thirdPartySystemStateFilter",[function(){return function(e){return"created"===e||"activating"===e?"pending":"activated"===e?"systemStatusConnected":e}}]),angular.module("rainbow").filter("thirdPartySystemStateColorFilter",[function(){return function(e){return"created"===e||"activating"===e?"color_blue":"activated"===e?"color_green":e}}]),angular.module("rainbow").filter("cloudPbxStateFilter",[function(){return function(e){return"created"===e?"systemStatusConnected":"disconnected"===e?"systemStatusDisonnected":e}}]),angular.module("rainbow").filter("cloudPbxStateColorFilter",[function(){return function(e){return"created"===e?"color_green":"disconnected"===e?"color_error":e}}]),angular.module("rainbow").filter("gatewayStateFilter",[function(){return function(e){return"true"===e?"systemStatusConnected":"false"===e?"systemStatusDisonnected":e}}]),angular.module("rainbow").filter("gatewayStateColorFilter",[function(){return function(e){return"true"===e?"color_green":"false"===e?"color_error":"new_version"===e?"color_warning":e}}]),angular.module("rainbow").filter("cloudPbxBarringOptionPermissionFilter",[function(){return function(e){return"default"===e?"same_than_company":"local"===e?"intraPBXCallsOnly":"nat_local"===e?"nationalAndIntraPBXCalls":"int_nat_local"===e?"internationalNationalAndIntraPBXCalls":e}}]),angular.module("rainbow").filter("cloudPbxBarringOptionRestrictionFilter",[function(){return function(e){return"default"===e?"same_than_company":"no_restriction"===e?"none":"surcharged_numbers"===e?"surchargedNumbers":"custom_numbers"===e?"customizedProhibitedNumbers":e}}]),angular.module("rainbow").filter("cloudPbxCliPolicyFilter",[function(){return function(e){return"user_ddi_number"===e?"userDDINumber":"installation_ddi_number"===e?"companyPhoneNumber":"other_ddi_number"===e?"otherDDINumber":e}}]),angular.module("rainbow").filter("ivrStateFilter",[function(){return function(e){return"active"===e?"systemStatusActive":"unknown"}}]),angular.module("rainbow").filter("ivrStateClassFilter",[function(){return function(e){return"active"===e?"color_green":"color_error"}}])},function(e,t){angular.module("rainbow").factory("SystemsGroup",[function(){function e(e,t,n,r){this.id=e||null,this.name=t,this.companies=n||[],this.systems=r,this.containsSystem=function(e){return!!this.systems&&this.systems.some((function(t){return t.systemId===e}))}}return e.createFromData=function(t){return new e(t.id,t.name,t.companies,t.systems)},e.create=function(t,n,r,i){return new e(t,n,r,i)},e}])},function(e,t,n){n.r(t);var r=n(31),i=n.n(r);angular.module("rainbow").factory("User",["Subscription",function(e){function t(n,r){var a=this;t.attributes.forEach((function(e){n&&angular.isDefined(n[e.name])?a[e.name]=n[e.name]:!r&&angular.isDefined(e.defaultValue)&&(a[e.name]=e.defaultValue)})),this.subscriptions=[],this.updateFromData=function(e){t.attributes.forEach((function(t){angular.isDefined(e[t.name])&&(a[t.name]=e[t.name])}))},this.fillSubscriptionMap=function(){var e={};this.subscriptions.forEach((function(t){e[t.id]=t})),this.subscriptionMap=e},this.fillMainSubscriptionField=function(){var t=this.subscriptions.filter(e.isExclusive).sort(e.subscriptionComparator);t.length>0&&(this.mainSubscription=t[t.length-1],this.mainSubscriptionName=this.mainSubscription.offerName);var n=this.subscriptions.filter(e.isOptional);n.length>0&&(this.optionalSubscriptionNames=n.map((function(e){return e.offerName})).join(", ")),this.subscriptionNames=this.mainSubscriptionName+(this.optionalSubscriptionNames?", "+this.optionalSubscriptionNames:"")},this.getMainSubscription=function(){return this.mainSubscription||this.fillMainSubscriptionField(),this.mainSubscription},this.getOptionalSubscriptions=function(){return this.subscriptions.filter(e.isOptional)},this.getMainSubscriptionName=function(){return this.mainSubscriptionName||this.fillMainSubscriptionField(),this.mainSubscriptionName},this.getOptionalSubscriptionNames=function(){return this.mainSubscriptionName||this.fillMainSubscriptionField(),this.optionalSubscriptionNames},this.hasUserRoleOnly=function(){return 1===this.roles.length&&-1!==this.roles.indexOf(t.RoleValues.USER)},this.isGuest=function(){return-1!==this.roles.indexOf(t.RoleValues.GUEST)||this.guestMode},this.isAdmin=function(){return-1!==this.roles.indexOf(t.RoleValues.ADMIN)},this.isOrganizationAdmin=function(){return!!this.isAdmin()&&"organization_admin"===this.adminType},this.isSiteAdmin=function(){return!!this.isAdmin()&&"site_admin"===this.adminType},this.isCompanyAdmin=function(){return!!this.isAdmin()&&"company_admin"===this.adminType},this.isBPAdmin=function(){return this.isBPAdminOperations()||this.isBPAdminFinance()},this.isBPAdminOperations=function(){return-1!==this.roles.indexOf(t.RoleValues.BP_ADMIN_OPERATIONS)},this.isBPAdminFinance=function(){return-1!==this.roles.indexOf(t.RoleValues.BP_ADMIN_FINANCE)},this.isSuperadmin=function(){return-1!==this.roles.indexOf(t.RoleValues.SUPERADMIN)},this.isBusinessAdmin=function(){return-1!==this.roles.indexOf(t.RoleValues.BUSINESS_ADMIN)},this.isPublicChannelsAdmin=function(){return-1!==this.roles.indexOf(t.RoleValues.PUBLIC_CHANNELS_ADMIN)},this.isAllCompanyChannelsAdmin=function(){return-1!==this.roles.indexOf(t.RoleValues.ALL_COMPANY_CHANNELS_ADMIN)},this.isClosedChannelsAdmin=function(){return-1!==this.roles.indexOf(t.RoleValues.CLOSED_CHANNELS_ADMIN)},this.isDirectoryAdmin=function(){return-1!==this.roles.indexOf(t.RoleValues.DIRECTORY_ADMIN)},this.isRainbowTv=function(){return this.isTv||-1!==this.roles.indexOf(t.RoleValues.TV)},this.computeDisplayName=function(){var e=i.a.getNameInformation(this.firstName,this.lastName);this.displayName=e.displayName,this.initials=e.initials},this.getPhoneNumbers=function(e,t){return this.phoneNumbers?this.phoneNumbers.filter((function(n){return n.type===e&&n.deviceType===t})):[]},this.getSystemPhoneNumber=function(){return this.phoneNumbers?this.phoneNumbers.find((function(e){return angular.isDefined(e.systemId)&&e.isFromSystem})):void 0},this.isRvcpSubscriber=function(){var e=this.getSystemPhoneNumber();return e&&"RVCP Subscriber"===e.deviceName},this.isOxoSubscriber=function(){return this.getSystemPhoneNumber()},this.getActivePhoneNumber=function(e,t){var n=this.getPhoneNumbers(e,t);if(n.length>1){var r=n.find((function(e){return angular.isDefined(e.systemId)}));if(r)return r}return n[0]},this.getDdiPhoneNumber=function(e,t){var n=this.getPhoneNumbers(e,t);if(n.length>1){var r=n.find((function(e){return e.isCloudPbxDDI||e.isOxoPbxDDI}));if(r||(r=n.find((function(e){return e.isFromSystem}))),r)return r}return n[0]}}return t.createFromData=function(n,r){n&&n.roles&&n.roles.includes("private_channels_admin")&&n.roles.splice(n.roles.indexOf("private_channels_admin"),1,t.RoleValues.ALL_COMPANY_CHANNELS_ADMIN);var i=new t(n,r);return n.profiles&&(n.profiles.forEach((function(t){var n=e.createFromData(t);n.isTerminated()||i.subscriptions.push(n)})),i.fillMainSubscriptionField()),i.computeDisplayName(),i},t.create=function(){return new t},t.prune=function(e,t){var n=Object.assign({},e);return"RAINBOW"===n.authenticationType&&delete n.authenticationExternalUid,n},t.VisibilityValues=["same_than_company","public","private"],t.PermissionValues=["same_than_company","enabled","disabled"],t.VmOverflowValues=["default","custom","disabled"],t.CliPolicy={COMPANY_POLICY:"company_policy",USER_DDI_NUMBER:"user_ddi_number",INSTALLATION_DDI_NUMBER:"installation_ddi_number",OTHER_DDI_NUMBER:"other_ddi_number"},t.CliPolicyValues=[t.CliPolicy.COMPANY_POLICY,t.CliPolicy.USER_DDI_NUMBER,t.CliPolicy.INSTALLATION_DDI_NUMBER,t.CliPolicy.OTHER_DDI_NUMBER],t.RoleValues={USER:"user",GUEST:"guest",SUPERADMIN:"superadmin",SUPPORT:"support",BUSINESS_ADMIN:"business_admin",ADMIN:"admin",BP_ADMIN_OPERATIONS:"bp_admin",BP_ADMIN_FINANCE:"bp_finance",DIRECTORY_ADMIN:"directory_admin",PUBLIC_CHANNELS_ADMIN:"public_channels_admin",ALL_COMPANY_CHANNELS_ADMIN:"all_company_channels_admin",CLOSED_CHANNELS_ADMIN:"closed_channels_admin",TV:"tv"},t.LoginPolicies=[{value:"RAINBOW",label:"rainbowLoginCredentials"},{value:"SAML",label:"ssoLoginCredentialsSAML",isSSO:!0},{value:"OIDC",label:"ssoLoginCredentialsOIDC",isSSO:!0},{value:"DEFAULT",label:"defaultLogin"}],t.attributes=[{name:"id",defaultValue:null},{name:"loginEmail",defaultValue:""},{name:"firstName",defaultValue:""},{name:"lastName",defaultValue:""},{name:"displayName",defaultValue:""},{name:"nickName",defaultValue:""},{name:"title",defaultValue:""},{name:"jobTitle",defaultValue:""},{name:"department",defaultValue:""},{name:"companyId",defaultValue:""},{name:"companyName",defaultValue:""},{name:"siteId",defaultValue:""},{name:"systemId",defaultValue:""},{name:"accountType",defaultValue:"free"},{name:"country",defaultValue:"FRA"},{name:"timezone",defaultValue:"Europe/Paris"},{name:"emails",defaultValue:[]},{name:"phoneNumbers",defaultValue:[]},{name:"roles",defaultValue:["user"]},{name:"adminType",defaultValue:"company_admin"},{name:"isActive",defaultValue:!1},{name:"isInitialized",defaultValue:!1},{name:"isTerminated",defaultValue:void 0},{name:"isTv",defaultValue:void 0},{name:"password",defaultValue:void 0},{name:"jid_im",defaultValue:""},{name:"jid_tel",defaultValue:""},{name:"language",defaultValue:"en"},{name:"lastAvatarUpdateDate",defaultValue:null},{name:"visibility",defaultValue:void 0},{name:"authenticationType",defaultValue:void 0},{name:"authenticationExternalUid",defaultValue:void 0},{name:"tags",defaultValue:void 0},{name:"userInfo1",defaultValue:void 0},{name:"userInfo2",defaultValue:void 0},{name:"tryNewUiCustomisation",defaultValue:void 0},{name:"softphoneOnlyCustomisation",defaultValue:void 0},{name:"fileSharingCustomisation",defaultValue:void 0},{name:"userTitleNameCustomisation",defaultValue:void 0},{name:"useRoomCustomisation",defaultValue:void 0},{name:"phoneMeetingCustomisation",defaultValue:void 0},{name:"useChannelCustomisation",defaultValue:void 0},{name:"useWebRTCVideoCustomisation",defaultValue:void 0},{name:"useWebRTCAudioCustomisation",defaultValue:void 0},{name:"instantMessagesCustomisation",defaultValue:void 0},{name:"userProfileCustomisation",defaultValue:void 0},{name:"fileStorageCustomisation",defaultValue:void 0},{name:"overridePresenceCustomisation",defaultValue:void 0},{name:"changeSettingsCustomisation",defaultValue:void 0},{name:"changeTelephonyCustomisation",defaultValue:void 0},{name:"recordingConversationCustomisation",defaultValue:void 0},{name:"useGifCustomisation",defaultValue:void 0},{name:"useDialOutCustomisation",defaultValue:void 0},{name:"selectedAppCustomisationTemplate",defaultValue:void 0},{name:"guestMode",defaultValue:void 0},{name:"lastLoginDate",defaultValue:void 0}],t}]),angular.module("rainbow").filter("genericPermissionLabelFilter",[function(){return function(e){return"same_than_company"===e?"same_than_company":"enabled"===e?"authorized":"disabled"===e?"notAuthorized":e}}]),angular.module("rainbow").filter("phoneVmOverflowLabelFilter",[function(){return function(e){return"default"===e?"same_than_company":"custom"===e?"yes":"disabled"===e?"no":e}}]),angular.module("rainbow").filter("cloudPbxSubscriberCliPolicyFilter",[function(){return function(e){return"company_policy"===e?"same_than_company":"user_ddi_number"===e?"userDDINumber":"installation_ddi_number"===e?"companyPhoneNumber":"other_ddi_number"===e?"otherDDINumber":e}}]),angular.module("rainbow").filter("softphoneOnlyPermissionLabelFilter",[function(){return function(e){return e&&"same_than_company"!==e?"enabled"===e?"softphoneOnly":"disabled"===e?"allServices":e:"same_than_company"}}])},function(e,t){angular.module("rainbow").factory("Subscription",["Offer",function(e){function t(e,t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,b,S,_,C,w,E,T,k,M,D,x,R,O){this.id=e,this.name=n,this.offerId=t,this.offerName=n||"",R&&(this.offerName=this.offerName.replace(new RegExp("\\bDemo\\b"),"Custom")),this.offerDescription=r||"Rainbow "+this.offerName,this.groupName=i||n,this.offerReference=a,this.profileId=o,this.profileName=s,this.maxNumberUsers=c,this.numberAssignedUsers=l,this.status=u,this.syncOngoing=d||!1,this.updatingMaxNumberUsers=h,void 0!==f&&(this.nbBPLicences=f),void 0!==p&&(this.nbAssignedBPUsers=p),void 0!==m&&(this.nbLicencesAssignedToECs=m),void 0!==v&&(this.nbLicencesUsed=v),void 0!==g&&(this.nbFreeLicences=g),this.businessModel=y,this.canBeSold=b,this.isDefault=S,this.isExclusive=_,this.isPrepaid=C,this.prepaidDuration=w,this.expirationDate=E,this.autoRenew=T,this.renewalTermOption=k,this.prepaidRenewalOption=M,this.hasConference=D,this.hasVoice=x,this.isDemo=void 0===R?!this.isDefault&&!this.canBeSold&&this.offerName.toLowerCase().includes("custom"):R,this.isChinaOffer=O,this.isEnterprise=function(){return this.groupName.toLowerCase().includes("enterprise")},this.isBusiness=function(){return this.groupName.toLowerCase().includes("business")},this.isEssential=function(){return this.isDefault},this.isTrial=function(){return this.isDemo},this.isTerminated=function(){return"terminated"===this.status},this.isTerminating=function(){return"terminating"===this.status},this.isUserLicense=function(){return this.isDefault||"nb_users"===this.businessModel||"usage"===this.businessModel}}return t.createFromData=function(e){return new t(e.id?e.id:e.subscriptionId,e.offerId,e.offerName,e.offerDescription,e.groupName,e.offerReference,e.profileId,e.profileName,e.maxNumberUsers,e.numberAssignedUsers,e.status,e.syncOngoing,e.updatingMaxNumberUsers,e.nbBPLicences,e.nbAssignedBPUsers,e.nbLicencesAssignedToECs,e.nbLicencesUsed,e.nbFreeLicences,e.businessModel,e.canBeSold,e.isDefault,e.isExclusive,e.isPrepaid,e.prepaidDuration,e.expirationDate,e.autoRenew,e.renewalTermOption,e.prepaidRenewalOption,e.hasConference,e.hasVoice,e.isDemo,e.isChinaOffer)},t.PrepaidRenewalOptions={RENEW_BILLED:"billed",RENEW_ALLOCATED:"allocated"},t.subscriptionComparator=function(t,n){var r=new e(t.offerId,t.offerName,t.offerDescription,t.groupName,t.offerReference,t.profileId,t.canBeSold,t.businessModel,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,t.autoSubscribe,t.hasConference,t.hasVoice,t.isDemo,t.isBundle,t.isChinaOffer),i=new e(n.offerId,n.offerName,n.offerDescription,n.groupName,n.offerReference,n.profileId,n.canBeSold,n.businessModel,n.isDefault,n.isExclusive,n.isPrepaid,n.prepaidDuration,n.autoSubscribe,n.hasConference,n.hasVoice,n.isDemo,n.isBundle,n.isChinaOffer);return e.offerComparator(r,i)},t.isUserLicense=function(e){return e.isDefault||"nb_users"===e.businessModel||"usage"===e.businessModel},t.isTvLicense=function(e){return"Room"===e.groupName},t.excludeTvLicense=function(e){return!t.isTvLicense(e)},t.isExclusive=function(e){return e.isDefault||e.isExclusive},t.isOptional=function(e){return!t.isExclusive(e)},t.isConference=function(e){return t.isOptional(e)&&(e.hasConference||"usage"===e.businessModel)},t.isNotConference=function(e){return t.isOptional(e)&&!(e.hasConference||"usage"===e.businessModel)},t.withLicenses=function(e){return e.isDefault||"usage"===e.businessModel||"nb_users"===e.businessModel&&e.maxNumberUsers>0},t.isPrepaid=function(e){return e.isPrepaid},t.isMonthly=function(e){return!e.isPrepaid},t}])},function(e,t){angular.module("rainbow").factory("IceServer",[function(){function e(e,t,n,r){this.id=e,this.urls=t,this.username=n,this.credential=r}return e.createFromData=function(t){return new e(t.id,t.urls,t.username,t.credential)},e}])},function(e,t){angular.module("rainbow").factory("PhoneNumber",[function(){function e(e,t,n,r,i,a,o,s,c,l,u,d,h,f,p,m,v,g,y,b,S,_,C,w,E,T,k){this.id=e,this.shortNumber=t,this.number=n,this.numberE164=r,this.pbxUserId=i,this.userId=a,this.type=o,this.deviceType=s,this.pbxId=c,this.isFromSystem=l,this.isMonitored=u,this.systemId=d,this.country=h,this.voiceMailNumber=f,this.deviceName=p,this.firstName=m,this.lastName=v,this.internalNumber=g,angular.isDefined(y)&&(this.isCloudPbxDDI=y),angular.isDefined(b)&&(this.isCloudPbxDefault=b),S&&(this.password=S),w&&(this.userDisplayName=w),angular.isDefined(_)&&(this.isOxoPbxDDI=_,this.isCloudPbxDDI=_),angular.isDefined(C)&&(this.isOxoPbxDefault=C,this.isCloudPbxDefault=C),E&&(this.overflowToVoicemail=E),T&&(this.barringOptions=T),angular.isDefined(k)&&(this.isRecordingActivated=k)}return e.SelectTypeEnum={EXTENSION:"extension",EXTENSION_CLOUD:"extension-cloud",GROUP_CLOUD:"group-cloud",DDI_CLOUD:"ddi-cloud",FREE_DDI_CLOUD:"free-ddi-cloud",FREE_DDI_GROUP_CLOUD:"free-ddi-group-cloud"},e.createFromData=function(t){return new e(t.id?t.id:t.phoneNumberId,t.shortNumber,t.number,t.numberE164,t.pbxUserId,t.userId,t.type,t.deviceType,t.pbxId,t.isFromSystem,t.isMonitored,t.systemId,t.country,t.voiceMailNumber,t.deviceName,t.firstName,t.lastName,t.internalNumber,t.isCloudPbxDDI,t.isCloudPbxDefault,t.password,t.isOxoPbxDDI,t.isOxoPbxDefault,t.userDisplayName,t.overflowToVoicemail,t.barringOptions,t.isRecordingActivated)},e}])},function(e,t){angular.module("rainbow").service("helpersService",[function(){this.chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",this.findIndex=function(e,t){return e.findIndex(t)},this.checkBrowser=function(e){return-1!==navigator.userAgent.indexOf(e)},this.randomString=function(e){e=e||10;for(var t,n="";e>0;)t=Math.floor(Math.random()*this.chars.length),n+=this.chars.charAt(t),e--;return n}}])},function(e,t){angular.module("rainbow").service("errorHelperService",["$filter",function(e){var t=this;t.ErrorCodeLabels={"-1":"unknownError",0:"errorNoServerResponse",400:"Bad request",4e5:"Bad request",400210:"invalidPhoneNumber",400400:"errorWrongPassword",400500:"invalidFile",400504:"companyNameAlreadyExist",400505:"BPCompanyWithoutPaymentConfigurationData",400506:"NoActiveSubscriptionToOffer",400509:"errorDecreaseSubscriptionForbidden",400511:"ActiveDirectoryDomainAlreadyUsed",400552:"BPCompanyAndECCompanyMustNotBeSame",400601:"outboundAndInternalPrefixesCantBeIdentical",400973:"noCreateUserPermission",400975:"userAlreadyExistsInOtherCompany",400983:"userAlreadyExistsInOtherCompany",400990:"noUserFound",400993:"noUserFound",401:"Authorization failure",401102:"Authorization failure",401202:"errorInvalidToken",401500:"errorUnauthorized",401501:"errorLoginForbidden",401510:"errorUnauthorized",401520:"errorUserNotActive",401521:"errorUserNotActive",403:"Forbidden",403e3:"accessDeniedNotRequiredRole",403001:"accessDeniedNotOwner",403034:"cantDeselectDefaultWebRTCGateway",403035:"cantDeleteDefaultWebRTCGateway",403060:"confLockMsg",403072:"errorIsoMd5Mismatch",403153:"notAllowedToAccessMeeting",403154:"notAllowedToAccessMeeting",403200:"notAllowedToChangeRole",403203:"notAllowedToChangeRole",403204:"notAllowedToMoveExistingUserToThisCompany",403205:"notAllowedToManageUser",403301:"notAllowedToManageCompany",403304:"notAllowedToAddAnotherAdmin",403311:"errorRemoveSyncOngoingSubscriptionForbidden",403315:"errorRemoveSubscriptionForbidden",403316:"errorRemoveAdminAllocatedSubscriptionForbidden",403317:"errorRemoveClientAllocatedSubscriptionForbidden",403400:"notAllowedDeleteAppOwner",403500:"notAllowedBlacklistedEmail",403501:"notAllowedBlacklistedEmail",403503:"NotAllowedSelfRegistrationEmail",403504:"notAllowedLoggedInUserEmail",403507:"notAllowedSupportEmail",403513:"companyNotABpCompany",403516:"companyNotABpCompany",403517:"companySeenAsTerminated",403518:"companyBpTypeIncompatible",403519:"companyAlreadyLinkedToBp",403520:"companyNotVadBp",403526:"isolatedUser",403531:"resetPasswordBlocked",403532:"resetPasswordForbidden",403608:"errorAssignSubscriptionSyncOngoing",403609:"errorAssignSubscriptionSyncOngoing",403610:"maxSubscriptionAllocationReached",403611:"notAllowedToCreateAnEquipment",403615:"maximumNumberConferenceParticipantsReach",403616:"subscriptionCompanyAdminEssentialAlreadyExists",403617:"roleCompanyAdminEssentialAlreadyExists",403620:"MaximumNumberRoomUsersReach",403621:"MaximumNumberConvUsersReach",403624:"notAllowedRemoveService",403625:"errorAllocatedSubscriptionRemoveForbidden",403626:"restrictedConvAccess",403630:"uploadErrorMaxQuotaReached",403655:"userAlreadyCompanyMember",403670:"errorOperationForbiddenOnGuest",403700:"errorDeleteSiteWithSystems",403701:"errorDeleteOrganisationLinkedCompany",403702:"errorDeleteCompanyWithSubscriptions",403703:"errorDeleteCompanyWithSites",403704:"errorDeleteCompanyWithUsers",403705:"errorDeleteCompanyStillTerminated",403706:"errorRemoveBusinessPartnerRole",403719:"externalTrunkChangeForbidden",403721:"numberingPlanCantBeUpdated",403722:"outgoingPrefixChangeForbidden",403723:"cannotRemoveCompanyPublicNumber",403724:"notAllowedDeleteCloudPbxWithPublicNumbers",403725:"notAllowedDeleteCloudPbxWithUsedExtensions",404:"resourceNotFound",404e3:"resourceNotFound",404001:"resourceNotFoundUpdateImpossible",404002:"resourceNotFoundDeleteImpossible",404116:"archivedOrDeletedConversation",404300:"noValidOfferReferenceInACTISFile",404301:"offerNotFound",409e3:"userAlreadyCreated",409005:"inviteUsersError",409008:"emptyVoiceMessage",409011:"noMessagesToExport",409251:"DDIAlreadyAssociatedToCompany",409552:"internalNumberAlreadyUsed",409555:"publicNumberAlreadyExists",409557:"notAllowedDeleteUserAssociatedToCloudPbx",409600:"userAlreadyExist",409601:"invitationReSentConflict",409602:"userAlreadyNetworkMember",409603:"invitationReSentConflict",409620:"offerAlreadySubscribed",409623:"conferenceOfferAlreadySubscribed",409625:"errorUpdateSyncOngoingSubscriptionForbidden",409800:"companyNotIrBp",409801:"companyNotLinkedToBp",409802:"actisCompanyAdminMismatch",409803:"actisCompanyNameMismatch",413e3:"uploadErrorTooLarge",500:"errorInternalServerError",1001:"extensionNotLinkedToEquipment",1002:"extensionHasNoIdentifier",1003:"extensionDoesNotExist",1004:"extensionLookupFailure",1005:"extensionConflict",1006:"nonUniqueEquipmentForExtension",1007:"userAlreadyAssociatedToExtension",1008:"extensionAssociatedToAnotherUser",1009:"failedToAttachExtension",1010:"userHasNoExtension",1011:"userHasTooManyExtensions",1012:"failedToDetachExtension"},t.portalErrorCodeLabels={massprovisioning:{4e5:"invalidValue",400501:"invalidFile",400502:"invalidColumnName",400504:"invalidFile",400506:"invalidValueInActionColumn",400600:"deviceTypeCannotBeUpdated",400601:"duplicateDeviceIds",400602:"duplicateMacAdresses",400603:"invalidDeviceTypes",400604:"missingDeviceTypeInLines",400605:"invalidEquipment",403610:"errorMaxSubscriptionReached",404600:"deviceDoesNotExist",404601:"noCloudPbxInCompany"},rvcpprovisioning:{403e3:"overflowConfigurationChangesStillInProgress",403622:"noVoiceLicenceAllocatedToUser",403694:"forbiddenOperationEquipmentHasGroups",403699:"forbiddenOperationEquipmentHasWelcomeService",403728:"forbiddenOperationEquipmentHasDevices",409556:"companyHasAlreadyACloudPbx",409560:"macAddressAlreadyUsed",409561:"deviceStillUsedByUser",409562:"deviceAlreadyUsed",409563:"deviceAlreadyUsedByAnotherSystem",403739:"forbiddenOperationWelcomeServiceUsed",413e3:"fileTooLarge",415e3:"audioFileTypeNotSupported"},authentication:{401102:"Authorization failure",401103:"Authorization failure",401500:"Authorization failure",401520:"Forbidden",401521:"Forbidden",401522:"Forbidden",401523:"Forbidden",401530:"Authorization failure",401600:"Authorization failure",401700:"Authorization failure",403e3:"Authorization failure",5e5:"errorInternalServerError",503e3:"resourceNotFound"}},t.handleErrorMessage=function(e,n){t.getErrorFullMessage(e,n)},t.handleError=function(e,n){var r=t.getPortal(e),i=e.status;e.data&&e.data.errorDetailsCode&&(i=e.data.errorDetailsCode);var a=new Error(t.getDetailedErrorMessage(e));return a.status=e.status,a.fieldErrors=t.getBadRequestFieldErrors(e),a.errorDetailsCode=i,a.errorDetailsLabel=t.getErrorCodeLabel(i,r),a.translatedMessage=t.getTranslatedErrorMessage(e,n,r),a.portal=r,a},t.getPortal=function(e){var t=e.config?e.config.url:void 0,n=t?t.match(/api\/rainbow\/(\w+)\//):void 0;return n?n[1]:void 0},t.getBadRequestFieldErrors=function(e){var n={};if(400===e.status){if(e.data&&e.data.errorDetails instanceof Array)e.data.errorDetails.forEach((function(e){n[e.param]||(n[e.param]={ok:!1,message:e.msg,value:e.value})}));else if(e.data&&e.data.errorDetails&&e.data.errorDetails.param){var r=e.data.errorDetails;n[r.param]={ok:!1,message:r.msg,value:r.value}}e.data&&400511===e.data.errorDetailsCode&&(n.office365Tenant={ok:!1,message:t.ErrorCodeLabels[400511]}),e.data&&400601===e.data.errorDetailsCode&&(n.outgoingPrefix={ok:!1,message:t.ErrorCodeLabels[400601]},n.numberingPrefix={ok:!1,message:t.ErrorCodeLabels[400601]})}return n},t.getErrorMessage=function(e){var n=t.getStatusErrorMessage(e);return e.data&&e.data.errorMsg&&(n="",e.data.errorDetails?e.data.errorDetails instanceof Array?n+="one or more fields are invalid":e.data.errorDetails.msg?n+=e.data.errorDetails.msg:n+=e.data.errorDetails:n+=e.data.errorMsg),n},t.getStatusErrorMessage=function(e){return 500===e.status?"Internal server error":-1===e.status?"Service unavailable":415===e.status?"Unsupported Media Type":413===e.status?"Request Entity Too Large":404===e.status?"Resource not found":403===e.status?"Access is forbidden":401===e.status?"Authorization failure":400===e.status?"Bad request":e.statusText?e.statusText:"Unknown error"},t.getDetailedErrorMessage=function(e){var n=t.getErrorMessage(e);return e.data&&e.data.errorDetailsData&&"string"==typeof e.data.errorDetailsData&&(n+=" "+e.data.errorDetailsData),e.data&&e.data.errorDetails&&e.data.errorDetails instanceof Array&&e.data.errorDetails.length>0&&(n+=" : "+e.data.errorDetails[0].msg),n},t.getTranslatedErrorMessage=function(e,n,r){if(500===e.status)return t.getLocalizedError("500");var i=null;e.data&&e.data.errorDetailsCode&&(i=e.data.errorDetailsCode);var a;return a=e.data&&e.data.errorDetailsData?Object.assign(e.data.errorDetailsData,n):n,t.getTranslatedErrorMessageByDetailsCode(i,a,t.getErrorMessage(e),r)},t.getTranslatedErrorMessageByDetailsCode=function(n,r,i,a){var o;return n&&(o=t.getLocalizedError(n,r,a)),o||(o=n?e("translate")("anErrorOccurred",{errorcode:n}):e("translate")("anErrorOccurred"),i&&(o+=" ("+e("translate")(i)+")")),o},t.getLocalizedError=function(n,r,i){var a;if(n){var o=t.getErrorCodeLabel(n,i);if(o){var s=e("translate")(o,r);s!==o&&(a=s)}}return a},t.getErrorCodeLabel=function(e,n){return n&&t.portalErrorCodeLabels[n]&&t.portalErrorCodeLabels[n][e]?t.portalErrorCodeLabels[n][e]:t.ErrorCodeLabels[e]},t.getErrorFullMessage=function(e,t){var n=t?t+" failure : ":"";e&&e.data?(n+=e.data.errorMsg,e.data.errorDetails&&(n+=" - ",e.data.errorDetails instanceof Array?e.data.errorDetails.forEach((function(e){n+=e.msg})):e.data.errorDetails.msg?n+=JSON.stringify(e.data.errorDetails.msg):n+=e.data.errorDetails)):n+="Unknow error - Something goes really wrong";var r="";return e&&e.headers&&(r=e.headers("x-rainbow-request-id"),n+=" x-rainbow-request-id = "+r),n}}])},function(e,t,n){n.r(t);var r=n(2),i=n.n(r);angular.module("rainbow").service("pushImageHelperService",["$log","$q","$http","errorHelperService",function(e,t,n,r){var a=this;a.pushImage=function(o,s,c){return t((function(l,u){var d=null;if(c&&c.nosize)d=function(){var e=new Image;return e.src=s,t.when(e)};else{var h=c&&c.width?c.width:512,f=c&&c.height?c.height:512;d=function(){return a.resizeImage(s,h,f)}}d().then((function(t){var s=a.getBinaryData(t);n({method:"POST",url:o,headers:i.a.getPostHeader("image/"+s.type),data:s.data,transformRequest:[]}).then((function(){e.info("[pushImageHelperService] pushImage : success"),l()}),(function(t){var n=r.handleError(t);u(n),e.error("[pushImageHelperService] "+r.getErrorFullMessage(t,"pushImage"))}))}))}))},a.resizeImage=function(e,n,r){return t((function(t){var i=new Image;i.src=e,i.onload=function(){var e=i.width,a=i.height;e>a?e>n&&(a*=n/e,e=n):a>r&&(e*=r/a,a=r);var o=document.createElement("canvas");o.width=e,o.height=a,i.width=e,i.height=a,o.getContext("2d").drawImage(this,0,0,e,a);var s=new Image;s.src=o.toDataURL("image/png"),t(s)}}))},a.getBinaryData=function(e){for(var t=e.src.indexOf("image/")+6,n=e.src.indexOf(";base64,"),r=e.src.slice(n+8),i=e.src.slice(t,n),a=window.atob(r),o=a.length,s=new Uint8Array(o),c=0;c<o;c++)s[c]=a.charCodeAt(c);return{type:i,data:s}}}])},function(e,t,n){n.r(t);var r=n(18),i=n(2),a=n.n(i),o=n(26),s=n.n(o),c=n(1),l=n.n(c);angular.module("rainbow").service("botService",["$http","$q","$log","$rootScope","$interval","conversationService",function(e,t,n,i,o,c){var u=this;u.listeners=[],u.start=function(e){n.info("[botService] === STARTING ===");var r=performance.now();return t((function(t,i){u.init(),u.startListeners(),u.getBots().then((function(i){n.info(""),u.findEmily(i),u.unlockWaitingConversations();var a=Math.round(performance.now()-r);e.push({service:"botService",startDuration:a}),n.info("[botService] === STARTED ("+a+" ms) ==="),n.info(""),t()})).catch((function(e){n.info("[botService] === STARTING FAILURE === "+e.message),i()}))}))},u.stop=function(){n.info("[botService] === STOPPED ===")},u.init=function(){u.emily=null,this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/"},u.startListeners=function(){u.listeners.push(i.$on("ON_COMPANY_SUPPORT_AVATAR_CHANGE_EVENT",u.onSupportAvatarChange))},u.stopListeners=function(){for(var e;e=listeners.pop();)e()},u.onSupportAvatarChange=function(e,t){n.info("[botService] Emily avatar has been changed"),t.companyId===l.a.userContact.company.id&&u.getEmilyBot().then((function(e){u.updateEmily(e)})).catch((function(e){n.warn("[botService] Impossible to update Emily - "+e.stack||!1)}))},u.getBots=function(r){return t((function(t,i){var o=u.portalURL+"bots?format="+(r||"full");e({method:"GET",url:o,headers:a.a.getRequestHeader()}).then((function(e){n.info("[botService] getBots success"),t(e.data.data)})).catch((function(e){var t="getBots failure "+e.data.errorDetails+" with status "+e.status;n.error("[botService] "+t),i(new Error(t))}))}))},u.getEmilyBot=function(){return t((function(t,r){var i=u.portalURL+"bots/rainbow-support";e({method:"GET",url:i,headers:a.a.getRequestHeader()}).then((function(e){n.info("[botService] getEmilyBot success"),t(e.data.data)})).catch((function(e){var t="getEmilyBot failure "+e.data.errorDetails+" with status "+e.status;n.error("[botService] "+t),r(new Error(t))}))}))},u.findEmily=function(e){e.forEach((function(e){"Emily"===e.name&&(n.info("[botService] Emily is found"),u.updateEmily(e))}))},u.updateEmily=function(e){u.emily=u.emily||e,u.emily.name=e.name,u.emily.id=e.id,u.emily.avatarId=e.avatarId||e.id,u.emily.lastAvatarUpdateDate=e.lastAvatarUpdateDate,u.emily.capabilities=e.capabilities,u.emily.avatarUrl=u.getBotAvatarUrl(u.emily.avatarId,u.emily.lastAvatarUpdateDate),l.a.createBotContact(u.emily.jid,u.emily.name,u.emily.id,u.emily.avatarUrl,u.emily.capabilities),n.info("[botService] Emily contact has been updated")},u.getEmily=function(){return u.emily},u.openConversationWithEmily=function(){return t((function(e,t){n.info("[botService] openConversationWithEmily");var r=l.a.getContactByJid(u.emily.jid);c.getOrCreateOneToOneConversation(r.jid).then((function(t){c.setActiveConversation(t),e(t)})).catch((function(){n.error("[botService] openConversationWithEmily failure"),t()}))}))},u.unlockWaitingConversations=function(){c.unlockWaitingBotConversations(!0)},u.getBotAvatarImage=function(e,r){return t((function(t,i){n.info("[botService] getBotAvatarImage");var a=u.getBotAvatarUrl(e,r),s=new Image,c=0;s.onload=function(){var i=this;o((function(){n.log("[botService] Load bot avatar "+e+" lastAvatarUpdateDate "+r+" success"),t(i)}),1,1)},s.onerror=function(){c++,o((function(){n.warn("[botService] Load bor avatar "+e+" lastAvatarUpdateDate "+r+" failure"),1===c?(n.warn("[botService] Fallback to default emily avatar"),s.src="/resources/skins/rainbow/images/conversation/icon_headset.png"):i(new Error("No image found"))}),1,1)},s.src=a}))},u.getBotAvatarUrl=function(e,t){var n=config.webservices.protocol+"://"+config.webservices.currentServer;s.a.cdn&&(n=s.a.cdnServer);var i=n+"/api/avatar/"+e+"?size=120";return i+=t?"&update="+Object(r.MD5)(r.enc.Latin1.parse(t)).toString(r.enc.Hex):"&update="+Date.now()}}])},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(221),a=n(225),o=n(331),s=n(0),c=n(3),l=n(10),u=n(54),d=n(71),h=n(16),f=n(24),p=n(2),m=n(4),v=n(6),g=n(25),y=n(1),S=n(15),_=n(38),C=n(33),w=n(58),E=n(76);angular.module("rainbow").service("conversationService",["$q","$rootScope","$http","$interval","Conversation","videoService","telephonyService","ConversationServiceHistoryHandler","SearchTextConvResultsFactory","webConferenceService","webrtcGatewayService","fileServerService",function(e,t,n,T,k,M,D,x,R,O,I,P){var A=this,L=this;this.started=!1,L.start=function(n){S.default.info(""),S.default.info("[conversationService] === STARTING ===");var r=e.defer(),i=performance.now();return A.pendingMessages={},A.activeConversation=null,A.conversations=[],A.conversationCreationPromise={},A.inCallConversations=[],A.idleConversations=[],A.involvedContactIds=[],A.rxSubject=new l.Subject,A.pgiServiceSubscription=null,A.currentMissedIMCounter=0,A.currentMissedCallCounter=0,A.searchTextConvResults=R(),A.waitingBotConversations=[],A.botServiceReady=!1,A.isBasicCallAllowed=v.default.isFeatureEnabled(v.default.FeaturesEnum.TELEPHONY_BASIC_CALL),A.isSecondCallAllowed=v.default.isFeatureEnabled(v.default.FeaturesEnum.TELEPHONY_SECOND_CALL),A.attachHandlers(),S.default.info("[conversationService] getServerConversations"),r.resolve(),L.getServerConversations().then((function(){L.started=!0,L.linkAllActiveCallsToConversations(),L.cleanUnwantedConversations(),L.pgiServiceSubscription=w.default.conferenceSessionsSubject.subscribe((function(e){e.id===w.default.getPstnInstantConferenceEndpointId()&&"created"===e.action&&w.default.subscribeToMyConferenceSessions((function(e){A.onPGiConferenceStateEvent(e)}))}));var e=Math.round(performance.now()-i);n.push({service:"conversationService",startDuration:e}),S.default.info("[conversationService] === STARTED ("+e+" ms) ===")})).catch((function(e){S.default.info("[conversationService] === STARTING FAILURE === "+e.message),r.reject(e)})),A.contactUpdateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_CONTACT_UPDATED_EVENT, rehandle it"),A.contactUpdateEventHandlerCleaner()),A.contactUpdateEventHandlerCleaner=t.$on("ON_CONTACT_UPDATED_EVENT",A.onContactChangedEvent),A.roomUpdateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event "+C.default.ROOM_UPDATE_EVENT+", rehandle it"),A.roomUpdateEventHandlerCleaner()),A.roomUpdateEventHandlerCleaner=t.$on(C.default.ROOM_UPDATE_EVENT,A.onRoomChangedEvent),A.roomAddConferenceEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event "+C.default.ROOM_ADD_CONF_ENDPOINT_EVENT+", rehandle it"),A.roomAddConferenceEventHandlerCleaner()),A.roomAddConferenceEventHandlerCleaner=t.$on(C.default.ROOM_ADD_CONF_ENDPOINT_EVENT,A.onRoomAddConferenceEvent),A.roomHistoryUpdateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event "+C.default.ROOM_HISTORY_UPDATE_EVENT+", rehandle it"),A.roomHistoryUpdateEventHandlerCleaner()),A.roomHistoryUpdateEventHandlerCleaner=t.$on(C.default.ROOM_HISTORY_UPDATE_EVENT,A.onRoomHistoryChangedEvent),A.roomAdminMessageEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event "+C.default.ROOM_ADMIN_MESSAGE_EVENT+", rehandle it"),A.roomAdminMessageEventHandlerCleaner()),A.roomAdminMessageEventHandlerCleaner=t.$on(C.default.ROOM_ADMIN_MESSAGE_EVENT,A.onRoomAdminMessageEvent),A.callUpdateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_CALL_UPDATED_EVENT, rehandle it"),A.callUpdateEventHandlerCleaner()),A.callUpdateEventHandlerCleaner=t.$on("ON_CALL_UPDATED_EVENT",(function(e,t){A.onCallEvent(t)})),A.webRtcCallUpdateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_WEBRTC_GW_CALL_UPDATED_EVENT, rehandle it"),A.webRtcCallUpdateEventHandlerCleaner()),A.webRtcCallUpdateEventHandlerCleaner=t.$on("ON_WEBRTC_GW_CALL_UPDATED_EVENT",(function(e,t){A.onCallEvent(t,!0)})),A.conversationUpdateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_CONVERSATIONS_UPDATED_EVENT, rehandle it"),A.conversationUpdateEventHandlerCleaner()),A.conversationUpdateEventHandlerCleaner=t.$on("ON_CONVERSATIONS_UPDATED_EVENT",A.onConversationEvent),A.capacityUpdateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_UPDATE_MYCONTACT_EVENT, rehandle it"),A.capacityUpdateEventHandlerCleaner()),A.capacityUpdateEventHandlerCleaner=t.$on("ON_UPDATE_MYCONTACT_EVENT",A.onMyContactChangedEvent),A.telephonyStateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_TELEPHONY_STATUS_CHANGED_EVENT, rehandle it"),A.telephonyStateEventHandlerCleaner()),A.telephonyStateEventHandlerCleaner=t.$on("ON_TELEPHONY_STATUS_CHANGED_EVENT",A.onTelephonyStateChangeEvent),A.conferenceStateEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_CONFERENCE_STATE_EVENT, rehandle it"),A.conferenceStateEventHandlerCleaner()),A.conferenceStateEventHandlerCleaner=t.$on("ON_CONFERENCE_STATE_EVENT",A.onConferenceStateChangeEvent),A.conferenceParticipantsEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_CONFERENCE_PARTICIPANT_EVENT, rehandle it"),A.conferenceParticipantsEventHandlerCleaner()),A.conferenceParticipantsEventHandlerCleaner=t.$on("ON_CONFERENCE_PARTICIPANT_EVENT",A.onConferenceParticipantChangeEvent),A.reloadCapabilitiesForMyContactEventHandlerCleaner&&(S.default.warn("[conversationService] already subscribed to event ON_RELOAD_CAPABILITIES_FOR_MY_CONYTACT, rehandle it"),A.reloadCapabilitiesForMyContactEventHandlerCleaner()),A.reloadCapabilitiesForMyContactEventHandlerCleaner=t.$on("ON_RELOAD_CAPABILITIES_FOR_MY_CONYTACT",A.onReloadCapabilitiesForMyContactEvent),r.promise},this.attachHandlers=function(){var e=this;if(this.removeHandlers(),y.default.userContact&&!y.default.userContact.instantMessagesEnabled)return S.default.warn("[conversationService] attachHandlers skipped - instantMessagesEnabled : false"),this.conversationServiceEventHandler=a.ConversationServiceEventHandler.create(t,k,P,I,this),void(this.messageHandlerRef||(this.messageHandlerRef=m.default.addHandler((function(e){return L.conversationServiceEventHandler.onChatMessageReceived(e),!0}),"jabber:iq:recordingP2P","message","chat")));S.default.info("[conversationService] attachHandlers"),this.conversationHistoryHandler=x.create(this),this.conversationServiceEventHandler=a.ConversationServiceEventHandler.create(t,k,P,I,this),this.conversationServiceBulkHistoryHandler=new o.ConversationServiceBulkHistoryHandler(this,P),m.default.addHistoryHandler((function(e){return L.conversationHistoryHandler.onHistoryMessageReceived(e)})),m.default.addBulkHistoryHandler((function(e){return L.conversationServiceBulkHistoryHandler.onHistoryMessageReceived(e)})),m.default.addSearchTextHandler((function(t,n){if(L.searchTextConvResults.isCurrentQuery(t)){var r=L.conversationHistoryHandler.onSearchTextMessageReceived(n);r&&e.storeSearchTextResult(r)}})),this.messageHandlerRef||(this.messageHandlerRef=m.default.addHandler((function(e){return L.conversationServiceEventHandler.onChatMessageReceived(e),!0}),null,"message","chat")),this.messageMucHandlerRef||(this.messageMucHandlerRef=m.default.addHandler((function(e){return L.conversationServiceEventHandler.onChatMessageReceived(e),!0}),null,"message","groupchat")),this.fileMessageHandlerRef||(this.fileMessageHandlerRef=m.default.addHandler((function(e){return L.conversationServiceEventHandler.onFileMessageReceived(e),!0}),null,"message","file")),this.webrtcMessageHandlerRef||(this.webrtcMessageHandlerRef=m.default.addHandler((function(e){return L.conversationServiceEventHandler.onWebRTCMessageReceived(e),!0}),null,"message","webrtc")),this.convMessageHandlerRef||(this.convMessageHandlerRef=m.default.addHandler((function(e){return L.conversationServiceEventHandler.onManagementMessageReceived(e),!0}),null,"message","management")),this.receiptMessageHandlerRef||(this.receiptMessageHandlerRef=m.default.addHandler((function(e){return L.conversationServiceEventHandler.onReceiptMessageReceived(e),!0}),null,"message")),this.audioConfMessageHandlerRef||(this.audioConfMessageHandlerRef=m.default.addHandler((function(e){return L.conversationServiceEventHandler.onConferenceMessageReceived(e),!0}),"jabber:x:audioconference","message","chat")),this.aksSharingHandlerRef||(this.aksSharingHandlerRef=m.default.addHandler((function(t){return e.onAskSharingMessageReceived(t),!0}),"http://jabber.org/protocol/commands","iq"))},this.removeHandlers=function(){S.default.info("[conversationService] removeHandlers "),this.conversationHistoryHandler&&(this.conversationHistoryHandler=null),this.conversationServiceEventHandler&&(this.conversationServiceEventHandler=null),this.conversationServiceBulkHistoryHandler&&(this.conversationServiceBulkHistoryHandler=null),this.messageHandlerRef&&(m.default.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.fileMessageHandlerRef&&(m.default.deleteHandler(this.fileMessageHandlerRef),this.fileMessageHandlerRef=null),this.webrtcMessageHandlerRef&&(m.default.deleteHandler(this.webrtcMessageHandlerRef),this.webrtcMessageHandlerRef=null),this.convMessageHandlerRef&&(m.default.deleteHandler(this.convMessageHandlerRef),this.convMessageHandlerRef=null),this.receiptMessageHandlerRef&&(m.default.deleteHandler(this.receiptMessageHandlerRef),this.receiptMessageHandlerRef=null),this.messageMucHandlerRef&&(m.default.deleteHandler(this.messageMucHandlerRef),this.messageMucHandlerRef=null),this.recordingMessageHandlerRef&&(m.default.deleteHandler(this.recordingMessageHandlerRef),this.recordingMessageHandlerRef=null),this.audioConfMessageHandlerRef&&(m.default.deleteHandler(this.audioConfMessageHandlerRef),this.audioConfMessageHandlerRef=null),this.aksSharingHandlerRef&&(m.default.deleteHandler(this.aksSharingHandlerRef),this.aksSharingHandlerRef=null)},L.stop=function(){return S.default.info("[conversationService] === STOPPING ==="),this.conversations=null,this.messageHandlerRef&&(m.default.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.fileMessageHandlerRef&&(m.default.deleteHandler(this.fileMessageHandlerRef),this.fileMessageHandlerRef=null),this.webrtcMessageHandlerRef&&(m.default.deleteHandler(this.webrtcMessageHandlerRef),this.webrtcMessageHandlerRef=null),this.recordingMessageHandlerRef&&(m.default.deleteHandler(this.recordingMessageHandlerRef),this.recordingMessageHandlerRef=null),this.audioConfMessageHandlerRef&&(m.default.deleteHandler(this.audioConfMessageHandlerRef),this.audioConfMessageHandlerRef=null),this.aksSharingHandlerRef&&(m.default.deleteHandler(this.aksSharingHandlerRef),this.aksSharingHandlerRef=null),this.contactUpdateEventHandlerCleaner&&(this.contactUpdateEventHandlerCleaner(),this.contactUpdateEventHandlerCleaner=null),this.roomUpdateEventHandlerCleaner&&(this.roomUpdateEventHandlerCleaner(),this.roomUpdateEventHandlerCleaner=null),this.roomAddConferenceEventHandlerCleaner&&(this.roomAddConferenceEventHandlerCleaner(),this.roomAddConferenceEventHandlerCleaner=null),this.roomAdminMessageEventHandlerCleaner&&(this.roomAdminMessageEventHandlerCleaner(),this.roomAdminMessageEventHandlerCleaner=null),this.callUpdateEventHandlerCleaner&&(this.callUpdateEventHandlerCleaner(),this.callUpdateEventHandlerCleaner=null),this.conversationUpdateEventHandlerCleaner&&(this.conversationUpdateEventHandlerCleaner(),this.conversationUpdateEventHandlerCleaner=null),this.capacityUpdateEventHandlerCleaner&&(this.capacityUpdateEventHandlerCleaner(),this.capacityUpdateEventHandlerCleaner=null),this.telephonyStateEventHandlerCleaner&&(this.telephonyStateEventHandlerCleaner(),this.telephonyStateEventHandlerCleaner=null),this.reloadCapabilitiesForMyContactEventHandlerCleaner&&(this.reloadCapabilitiesForMyContactEventHandlerCleaner(),this.reloadCapabilitiesForMyContactEventHandlerCleaner=null),this.conferenceParticipantsEventHandlerCleaner&&(this.conferenceParticipantsEventHandlerCleaner(),this.conferenceParticipantsEventHandlerCleaner=null),this.conferenceStateEventHandlerCleaner&&(this.conferenceStateEventHandlerCleaner(),this.conferenceStateEventHandlerCleaner=null),this.webRtcCallUpdateEventHandlerCleaner&&(this.webRtcCallUpdateEventHandlerCleaner(),this.webRtcCallUpdateEventHandlerCleaner=null),this.roomHistoryUpdateEventHandlerCleaner&&(this.roomHistoryUpdateEventHandlerCleaner(),this.roomHistoryUpdateEventHandlerCleaner=null),this.pgiServiceSubscription&&this.pgiServiceSubscription.unsubscribe(),this.started=!1,this.isReinit=!1,S.default.info("[conversationService] === STOPPED ==="),e.when()},L.subscribe=function(e){return A.rxSubject.subscribe(e)},L.publish=function(e){A.rxSubject.next(e)},this.emojiOneToShort=function(e){return emojione?emojione.toShort(e):e},L.getServerConversations=function(){return r(A,void 0,void 0,b.a.mark((function e(){var t,n,r,i,a,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.default.userContact&&!y.default.userContact.instantMessagesEnabled){e.next=23;break}return e.prev=1,t="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(y.default.userContact.dbId,"/conversations"),e.next=5,fetch(t,{headers:p.default.getRequestHeader()});case 5:return n=e.sent,e.next=8,n.json();case 8:return(r=e.sent.data).forEach((function(e){e.creationDateSort=e.creationDate?new Date(e.creationDate):void 0,e.lastModificationSort=e.lastMessageDate?new Date(e.lastMessageDate):void 0})),r.sort(L.sortDataFunction),i=p.default.fromSDK?3e3:20,a=[],r.forEach((function(e,t){var n=parseInt(e.unreadMessageNumber,10);t>=i&&0===n?L.deleteServerConversation(e.id):(S.default.info("getServerConversations -- create conversation "+e.jid_im+" "+e.id),"user"===e.type?a.push(L.createOneToOneConversationFromData(e)):a.push(L.createRoomConversationFromData(e)))})),e.next=14,Promise.all(a);case 14:this.orderConversations(),e.next=21;break;case 17:throw e.prev=17,e.t0=e.catch(1),o="getServerConversations -- failure:"+e.t0.message,S.default.error(o),new Error(o);case 21:e.next=24;break;case 23:S.default.warn("[conversationService] getServerConversations skipped - instantMessagesEnabled : false");case 24:case"end":return e.stop()}}),e,this,[[1,17]])})))},this.createServerConversation=function(t){return e((function(e,r){if(t.dbId)e(t);else{var i=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+y.default.userContact.dbId+"/conversations",a=null;switch(t.type){case k.Type.ONE_TO_ONE:a={peerId:t.contact.dbId,type:"user"};break;case k.Type.ROOM:a={peerId:t.room.dbId,type:"room"};break;case k.Type.BOT:t.type=k.Type.ONE_TO_ONE,a={peerId:t.contact.dbId,type:"bot"}}n({method:"POST",url:i,headers:p.default.getRequestHeader(),data:a}).then((function(n){t.dbId=n.data.data.id,e(t)})).catch((function(e){var t="createServerConversation failure: unknown ... ";e.data&&e.data.errorDetails&&(t="createServerConversation failure: "+e.data.errorDetails),S.default.warn("[conversationService] "+t),r(new Error(t))}))}}))},this.deleteServerConversation=function(t){var r=e.defer();return t?(n({method:"DELETE",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+y.default.userContact.dbId+"/conversations/"+t,headers:p.default.getRequestHeader()}).then((function(){S.default.info("[conversationService] deleteServerConversation success: "+t),L.orderConversations(),r.resolve()}),(function(e){if(404002===e.data.errorDetailsCode)S.default.info("[conversationService] deleteServerConversation success: "+t),r.resolve();else{var n="deleteServerConversation failure: "+e.data.errorDetails;S.default.warn("[conversationService] "+n),r.reject(new Error(n))}})),r.promise):e.when()},this.updateServerConversation=function(t){var r=e.defer();return t?(n({method:"PUT",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+y.default.userContact.dbId+"/conversations/"+t.dbId,headers:p.default.getPostHeader(),data:{mute:t.muted}}).then((function(){S.default.info("[conversationService] updateServerConversation success: "+t.dbId),r.resolve()}),(function(e){var t="updateServerConversation failure: "+e.data.errorDetails;S.default.warn("[conversationService] "+t),r.reject(new Error(t))})),r.promise):e.when()},this.ackAllMessages=function(t,r){return e((function(e,i){if(!t)return S.default.error("[conversationService] ackAllMessages for conversation error -- missing conversation id"),void i();var a=L.getConversationByDbId(t);return a?a.ackReadAllReceivedMessages()||r?(S.default.info("[conversationService] ackAllMessages for conversation "+t),void n({method:"PUT",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+y.default.userContact.dbId+"/conversations/"+t+"/markallread",headers:p.default.getPostHeader()}).then((function(){S.default.info("[conversationService] ackAllMessages success: "+t),e()}),(function(e){var t="ackAllMessages failure: "+e.data.errorDetails;S.default.warn("[conversationService] "+t),i(new Error(t))}))):(S.default.info("[conversationService] ackAllMessages for conversation "+t+" already updated"),void e()):(S.default.error("[conversationService] ackAllMessages for conversation error -- can not find conversation"),void i())}))},this.getConversationAsyncById=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return A["room"===t?"getRoomConversation":"getOrCreateOneToOneConversation"](e,n)},this.createOneToOneConversationFromData=function(e){var t=parseInt(e.unreadMessageNumber,10),n=!0===e.mute;A.getOrCreateOneToOneConversation(e.jid_im,e.id,e.lastMessageDate,e.lastMessageText,t,n,e.creationDate,e.lastMessageSender,e.call,e.replace,e.forwardFrom,e.forwardedMessage)},this.createRoomConversationFromData=function(e){var t=parseInt(e.unreadMessageNumber,10),n=!0===e.mute;return A.getRoomConversation(e.jid_im,e.id,e.lastMessageDate,e.lastMessageText,t,!0,n,e.creationDate,e.lastMessageSender,e.topic,e.type,e.forwardFrom,e.forwardedMessage)},this.getOrCreateTelephonyConversation=function(e){S.default.info("getOrCreateTelephonyConversation -- "+e.id);var t=L.getConversationById(e.id);return e.id&&D.currentPgiObject&&D.currentPgiObject.callId&&e.id===D.currentPgiObject.callId&&(t=L.getConversationById(D.currentPgiObject.roomJid)),t||(t=new k(e.id),e.isConference?t.telephonyContacts=e.participants:(t.contact=e.contact,e.contact.conversation=t),A.conversations[e.id]=t),t},this.getOrCreateOneToOneConversation=function(n,r,i,a,o,s,c,l,u,d,h,f){if(S.default.info("[conversationService] getOrCreateOneToOneConversation "+n+" "+r+" "+o),!L.conversationCreationPromise[n]){var p=L.getConversationById(n);if(p)return p.preload=!0,e.resolve(p);L.conversationCreationPromise[n]=e((function(e,p){y.default.getOrCreateContact(n).then((function(e){var t=k.createOneToOneConversation(e);return t.lastModification=i?new Date(i):void 0,t.lastCallInfo=u,t.replaceLastMsgId=d,a&&(t.lastMessageText=L.emojiOneToShort(a)),t.lastMessageSender=m.default.getBareJidFromJid(l),t.muted=s,t.creationDate=c?new Date(c):new Date,t.preload=!1,L.computeCapabilitiesForContact(e),t.dbId=r,t.missedCounter=o||0,t.forwardFrom=h,t.forwardedMessage=f,L.createServerConversation(t)})).then((function(r){L.conversations[r.contact.id]=r,L.orderConversations(),t.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",r,k.EventType.NEW),e(r),delete L.conversationCreationPromise[n]})).catch((function(e){var t="getOrCreateOneToOneConversation "+n+" failure "+e.message;S.default.error("[conversationService] "+t),p(new Error(t)),delete L.conversationCreationPromise[n]}))}))}return L.conversationCreationPromise[n]},this.getRoomConversation=function(n,r,i,a,o,s,c,l,u,d,h,f,p){if(y.default.userContact&&!y.default.userContact.roomsEnabled)return S.default.info("[conversationService] === getRoomConversation skipped - roomsEnabled : "+y.default.userContact.roomsEnabled),e.when();if(S.default.info("[conversationService] getRoomConversation "+n),!L.conversationCreationPromise[n]){var v=L.getConversationById(n);if(v)return v.preload=!0,e.resolve(v);L.conversationCreationPromise[n]=e((function(e,s){T((function(){var v=C.default.getRoomByJid(n);if(v||"bot"===h)if(v){var g=k.createRoomConversation(v);g.dbId=r,g.lastModification=i?new Date(i):void 0,a&&(g.lastMessageText=L.emojiOneToShort(a)),g.muted=c,g.creationDate=l?new Date(l):new Date,g.preload=!1,g.lastMessageSender=m.default.getBareJidFromJid(u),g.forwardFrom=f,g.forwardedMessage=p,g.room&&d&&(g.room.desc=d),o&&(g.missedCounter=o),r?(L.conversations[g.id]=g,L.getRoomConferences(g).then((function(){t.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",g,k.EventType.NEW),e(g),delete L.conversationCreationPromise[n]})).catch((function(e){var t="getRoomConversation "+n+" failure "+e.message;S.default.error("[conversationService] "+t),s(new Error(t)),delete L.conversationCreationPromise[n]}))):L.createServerConversation(g).then((function(r){var i=C.default.getRoomByJid(n);r.room=i,L.conversations[r.id]=r,L.orderConversations(),i&&"unsubscribed"!==i.status&&i.isActive&&C.default.sendInitialRoomPresence(i),t.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",r,k.EventType.NEW),e(r),delete L.conversationCreationPromise[n]}))}else{var y={jid:n,conversationDbId:r,lastModification:i,lastMessageText:a?L.emojiOneToShort(a):a,lastMessageSender:m.default.getBareJidFromJid(u),missedIMCounter:o,muted:c,creationDate:l};delete L.conversationCreationPromise[n],L.waitingBotConversations.push(y),L.unlockWaitingBotConversations(),e()}else S.default.error("[conversationService] getRoomConversation ("+n+") failure : no such room -- try to get from server and update"),setTimeout((function(){C.default.getServerRoomByJid(n).then((function(s){var h=k.createRoomConversation(s);h.dbId=r,h.lastModification=i?new Date(i):void 0,a&&(h.lastMessageText=L.emojiOneToShort(a)),h.muted=c,h.creationDate=l?new Date(l):new Date,h.preload=!1,h.lastMessageSender=m.default.getBareJidFromJid(u),h.forwardFrom=f,h.forwardedMessage=p,h.room&&d&&(h.room.desc=d),o&&(h.missedCounter=o),r&&(L.conversations[h.id]=h,t.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",h,k.EventType.NEW),e(h),delete L.conversationCreationPromise[n]),s&&s.confEndpoints&&s.confEndpoints[0]&&t.$broadcast("ON_ADD_HOC_COMPLETED",s)})).catch((function(){S.default.error("[conversationService] getRoomConversation ("+n+") failure : no such room at all")}))}),500)}),1,1)}))}return L.conversationCreationPromise[n]},L.getRoomConferences=function(t){return e((function(e){var n=t.room.confEndpoints;n&&n.forEach((function(e){if("pstnAudio"===e.mediaType){var n=w.default.getConferenceSessionById(e.confEndpointId);n&&(t.pstnConferenceSession=n)}})),e()}))},L.updateRoomConferences=function(){L.getConversations().forEach((function(e){if(e.room&&e.room.confEndpoints){var t=w.default.getConferenceSessionById(e.room.getPstnConfEndpointId());e.pstnConferenceSession=t||null;var n=O.getConferenceSessionForRoom(e.room.confEndpoints);e.webConferenceSession=n||null}else e.pstnConferenceSession=null,e.webConferenceSession=null}))},this.closeConversation=function(t){return e((function(e,n){S.default.info("[conversationService] closeConversation "+t.id),L.deleteServerConversation(t.dbId).then((function(){L.removeConversation(t),e()})).catch((function(e){n(e)}))}))},this.removeConversation=function(e){if(S.default.info("[conversationService] remove conversation "+e.id),e.videoCall&&e.videoCall.status!==s.Call.Status.UNKNOWN)S.default.info("[conversationService] Ignore conversation deletion message for conversation"+e.id);else{delete L.conversations[e.id],L.orderConversations();var n=L.getOrderedConversations();!L.activeConversation||n.idle.indexOf(L.activeConversation)>=0||(n.idle.length>0?L.setActiveConversation(n.idle.first()):n.inCall.length>0?L.setActiveConversation(n.inCall.first()):L.setActiveConversation(null)),e.contact&&(e.contact.conversation=null,e.contact=null),t.$broadcast("ON_CONVERSATION_REMOVE_EVENT",e)}},this.getConversationByDbId=function(e){if(L.conversations)for(var t in L.conversations)if(L.conversations.hasOwnProperty(t)&&L.conversations[t].dbId===e)return L.conversations[t];return null},this.getConversationByRoomDbId=function(e){if(L.conversations)for(var t in L.conversations)if(L.conversations.hasOwnProperty(t)&&L.conversations[t].room&&L.conversations[t].room.dbId===e)return L.conversations[t];return null},this.searchConversations=function(e){var t=e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return L.getOrderedConversations().idle.filter((function(e){var n=e.filterName.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return t.every((function(e){return n.some((function(t,r){return!(!t.length||-1===t.indexOf(e))&&(n[r]="",!0)}))}))}))},this.cleanFile=function(e){var t=function(e){var t=document.createElement("div");t.innerHTML=e;for(var n=t.getElementsByTagName("script"),r=n.length;r--;)n[r].parentNode.removeChild(n[r]);return t.innerHTML};return new Promise((function(n){if("image/svg+xml"===e.type){var r=new FileReader;r.addEventListener("loadend",(function(r){var i=r.srcElement,a=new Blob([t(i.result)],{type:"image/svg+xml"}),o=new File([a],e.name,{type:"image/svg+xml",lastModified:Date.now()});n(o)})),r.readAsText(e)}else n(e)}))},this.sendChatMessage=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=k.getUniqueMessageId(),s=e.shortnameToUnicode(t),c=n&&"text/markdown"===n.type,l=r?r.id:null,u=r?r.date:null,d=new Date,h=y.default.userContact,f=e.addChatMessage(h,d,s,o,!0,c,null,l,u,null,n,i);if(f)return f.urgency=a,A.pendingMessages[f.id]={conversation:e,message:f},A.sendXmppMessage(e,f),f},this.sendChatForwardMessage=function(e,t,n,i){return r(A,void 0,void 0,b.a.mark((function r(){var a,o,s,c,l,u;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=null,o=null,n.fileId&&(a=g.default.getFileDescriptorById(n.fileId)),!a){r.next=13;break}if(r.t0=a.ownerId!==y.default.userContact.dbId,!r.t0){r.next=8;break}return r.next=7,g.default.copyFileToUserCloudStorage(a.id);case 7:a=r.sent;case 8:return r.next=10,this.shareFileToViewer(e,a);case 10:o=h.Message.createFileSharingMessage(n.id,n.date,n.from,n.side,n.data,n.status,a.id,n.fileName,null,n.geoloc),r.next=14;break;case 13:o=h.Message.create(n.id,n.date,n.from,n.side,n.getLastTextModified(),n.status);case 14:i.type===k.Type.ONE_TO_ONE?o.to=i.contact.jid!==n.from.jid?i.contact:y.default.userContact:o.to=i.room,s=k.getUniqueMessageId(),c=new Date,l=y.default.userContact,(u=e.addForwardChatMessage(l,c,s,o,i))&&(this.pendingMessages[o.id]={conversation:e,newForwardedMsg:o},this.sendXmppMessage(e,u),t&&t.length&&this.sendChatMessage(e,t));case 17:case"end":return r.stop()}}),r,this)})))},this.shareFileToViewer=function(e,t){return r(A,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=10;break}return n.prev=1,r=0===e.type?"user":"room",i=0===e.type?e.contact.dbId:e.room.dbId,n.next=5,g.default.addFileViewer(t.id,i,r);case 5:n.next=10;break;case 7:throw n.prev=7,n.t0=n.catch(1),new Error(n.t0);case 10:case"end":return n.stop()}}),n,null,[[1,7]])})))},this.sendFSMessage=function(e,n,i,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return r(A,void 0,void 0,b.a.mark((function r(){var c,l,f,p,m,v;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,c=n,i&&0!==i.length||(i=c.name),l=e.type===k.Type.ONE_TO_ONE?{viewerId:e.contact.dbId,type:"user"}:{viewerId:e.room.dbId,type:"room"},f=d.FileViewer.createFromData([l]),r.next=7,g.default.createFileDescriptor(n.name,n.name.split(".").pop(),n.size,f,a||!1);case 7:return(p=r.sent).fileToSend=n,p.isImage()&&n.preview&&(p.previewBlob=n.preview),(m="object"==typeof i?i:void 0)||(m=e.addFSMessage(p.id,i,u.FileState.UPLOADING,o,null,s),o&&!o.attachedMsgId&&(m.attachedMsgId=m.id)),m.fileId=p.id,m.fileName=p.fileName,m.urgency=s,r.prev=11,L.pendingMessages[m.id]={conversation:e,message:m},p.setState(u.FileState.UPLOADING),t.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:p,cancelable:!0}),r.next=17,P.uploadAFileByChunk(p,n,m,null);case 17:p.setState(u.FileState.UPLOADED),p.fileToSend=null,p.chunkPerformed=0,p.chunkTotalNumber=0,t.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:p}),this.sendXmppMessage(e,m,p),r.next=28;break;case 25:throw r.prev=25,r.t0=r.catch(11),S.default.error("[conversationService] sendFSMessage -- uploadAFile error"),o||g.default.deleteFileDescriptor(p.id),p.setState("uploadError"),m.receiptStatus=h.Message.ReceiptStatus.ERROR,m.fileErrorMsg=r.t0.translatedMessage?r.t0.translatedMessage:"Unable to share file",m.sendUpdateEvent(),r.t0;case 28:return r.abrupt("return",m);case 31:throw r.prev=31,r.t1=r.catch(0),v=r.t1.translatedMessage?r.t1.translatedMessage:"Unable to share file",403153===r.t1.errorDetailsCode&&(v=_.default.translate("fileSharingNoMoreAllowedMsg")),t.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"fileTransfer",popupBodyTranslated:v,okLabel:"ok"}),new Error(r.t1);case 35:case"end":return r.stop()}}),r,this,[[0,31],[11,25]])})))},this.resendFSMessage=function(e,n){return r(A,void 0,void 0,b.a.mark((function r(){var i,a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,n){r.next=3;break}return r.abrupt("return");case 3:return i=g.default.getFileDescriptorById(n.fileId),r.prev=4,L.pendingMessages[n.id]={conversation:e,message:n},n.setReceiptStatus(h.Message.ReceiptStatus.IN_PROGRESS),i.chunkPerformedPercent=0,i.chunkPerformed=0,i.chunkTotalNumber=0,i.setState(u.FileState.UPLOADING),n.sendUpdateEvent(),t.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:i,cancelable:!0}),r.next=15,P.uploadAFileByChunk(i,i.fileToSend,n,null);case 15:i.setState(u.FileState.UPLOADED),i.fileToSend=null,i.chunkPerformed=0,i.chunkTotalNumber=0,t.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:i}),this.sendXmppMessage(e,n,i),r.next=26;break;case 23:throw r.prev=23,r.t0=r.catch(4),S.default.error("[conversationService] sendFSMessage -- uploadAFile error"),i.setState("uploadError"),n.receiptStatus=h.Message.ReceiptStatus.ERROR,n.fileErrorMsg=r.t0.translatedMessage?r.t0.translatedMessage:"Unable to share file",n.sendUpdateEvent(),r.t0;case 26:r.next=32;break;case 28:throw r.prev=28,r.t1=r.catch(0),a=r.t1.translatedMessage?r.t1.translatedMessage:"Unable to share file",403153===r.t1.errorDetailsCode&&(a=_.default.translate("fileSharingNoMoreAllowedMsg")),t.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"fileTransfer",popupBodyTranslated:a,okLabel:"ok"}),new Error(r.t1);case 32:case"end":return r.stop()}}),r,this,[[0,28],[4,23]])})))},this.sendEFSMessage=function(e,n,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return r(A,void 0,void 0,b.a.mark((function r(){var c,l,u;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=null,r.prev=1,i&&0!==i.length||(i=n.fileName),(c=e.addFSMessage(n.id,i,n.state,a,o,s)).fileName=n.fileName,a&&!c.attachedMsgId&&(c.attachedMsgId=c.id),l=e.type===k.Type.ONE_TO_ONE?"user":"room",u=e.type===k.Type.ONE_TO_ONE?e.contact.dbId:e.room.dbId,r.next=6,g.default.addFileViewer(n.id,u,l);case 6:return this.sendXmppMessage(e,c,n),this.pendingMessages[c.id]={conversation:e,message:c},t.$broadcast("ON_SEND_EFS_MESSAGE",n),r.abrupt("return",c);case 12:r.prev=12,r.t0=r.catch(1),c.receiptStatus=h.Message.ReceiptStatus.ERROR,c.sendUpdateEvent();case 15:case"end":return r.stop()}}),r,this,[[1,12]])})))},this.sendXmppMessage=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;var r=t.id,i=e.shortnameToUnicode(t.data),a=e.type===k.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,o=e.type===k.Type.ONE_TO_ONE?"chat":"groupchat",s=E.$msg({to:a,type:o,id:r,"xml:lang":y.default.currentLanguage});return s.c("body",{"xml:lang":y.default.currentLanguage}).t(i).up(),s.c("store",{xmlns:"urn:xmpp:hints"}).up(),s.c("request",{xmlns:k.ReceiptNS}).up(),s.c("active",{xmlns:k.ChatstatesNS}).up(),n&&(s.c("x",{xmlns:"jabber:x:oob",index:t.attachIndex,count:t.attachNumber}).c("url",{},config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+n.id).c("mime",{},n.typeMIME).c("filename",{},n.fileName).c("size",{},n.size).up(),t.fileId=n.id,n.tags&&"voicemail"===n.tags.purpose&&s.c("voicemessage",{xmlns:"http://jabber.org/protocol/voicemessage"}).up()),t.attachedMsgId&&s.c("attach-to",{xmlns:"urn:xmpp:message-attaching:1",id:t.attachedMsgId}).up(),t.geoloc&&s.c("geoLoc",{xmlns:"http://jabber.org/protocol/geoloc"}).c("lat",t.geoloc.lat).c("lon",t.geoloc.lon),t.alternativeContent&&s.c("content",{xmlns:k.contentNS,type:t.alternativeContent.type}).t(t.alternativeContent.message).up(),t.answeredMsgId&&s.c("answeredMsg",{stamp:t.answeredMsgDate.getTime()}).t(t.answeredMsgId).up(),t.mentions&&t.mentions.length&&(s.c("mention",{xmlns:k.AttentionNS}),t.mentions.forEach((function(e){s.c("jid",{pos:e.pos,size:e.size},e.jid)})),s.up()),t.urgency&&"std"!==t.urgency&&s.c("headers",{xmlns:"http://jabber.org/protocol/shim"}).c("header",{name:"Urgency"}).t(t.urgency).up().up(),t.forwardedMsg&&A.addXmppForwardMessage(e,s,t),t.serverAckTimer=setTimeout((function(){t.receiptStatus=h.Message.ReceiptStatus.ERROR,t.sendUpdateEvent()}),1e4),t.setReceiptStatus(h.Message.ReceiptStatus.SENT),t.sendUpdateEvent(),m.default.send(s),e.room&&(e.room.lastActivityDate=new Date),t},this.addXmppForwardMessage=function(e,t,n){t.c("forwarded",{xmlns:k.FORWARDNS});var r=e.shortnameToUnicode(n.forwardedMsg.data),i=n.forwardedMsg.from.fullJid?n.forwardedMsg.from.fullJid:n.forwardedMsg.from.jid;t.c("message",{to:n.forwardedMsg.to.jid,from:i,id:n.forwardedMsg.id,type:n.forwardConvType,xmlns:"jabber:client"}),t.c("body",{"xml:lang":y.default.currentLanguage}).t(r).up();var a=g.default.getFileDescriptorById(n.forwardedMsg.fileId);a&&(t.c("x",{xmlns:"jabber:x:oob",index:n.attachIndex,count:n.attachNumber}).c("url",{},a.state===u.FileState.UPLOADED?config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+a.id:"").c("mime",{},a.typeMIME).c("filename",{},a.fileName).c("size",{},a.size).up(),a.tags&&"voicemail"===a.tags.purpose&&t.c("voicemessage",{xmlns:"http://jabber.org/protocol/voicemessage"}).up()),n.forwardedMsg.geoloc&&t.c("geoLoc",{xmlns:"http://jabber.org/protocol/geoloc"}).c("lat",n.forwardedMsg.geoloc.lat).up().c("lon",n.forwardedMsg.geoloc.lon).up().up(),n.answeredMsgId&&t.c("answeredMsg",{stamp:n.forwardedMsg.answeredMsgDate.getTime()}).t(n.forwardedMsg.answeredMsgId).up(),t.up(),t.up()},this.sendAckReadOrReceivedMessage=function(e,t,n){S.default.info("[ConversationService] ".concat(e.id," send ").concat(n," status for message ").concat(t));var r=e.type===k.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,i=e.type===k.Type.ONE_TO_ONE?"chat":"groupchat",a=y.default.userContact.jid,o={xmlns:k.ReceiptNS,id:t,event:n,entity:"client"};e.type!==k.Type.ONE_TO_ONE&&(o.type="muc"),m.default.send(E.$msg({to:r,from:a,type:i}).c("received",o))},this.sendAckReceivedMessage=function(e,t){t.receiptStatus>=h.Message.ReceiptStatus.UNREAD||(A.sendAckReadOrReceivedMessage(e,t.id,"received"),t.setReceiptStatus(h.Message.ReceiptStatus.UNREAD))},this.sendAckReadMessage=function(e,t){t.receiptStatus!==h.Message.ReceiptStatus.READ&&(A.sendAckReadOrReceivedMessage(e,t.id,"read"),t.setReceiptStatus(h.Message.ReceiptStatus.READ),t.replaceMsgs&&t.replaceMsgs.length&&t.replaceMsgs.forEach((function(t){A.sendAckReadOrReceivedMessage(e,t.id,"read")})))},this.sendAckReadMessages=function(e){S.default.info("[ConversationService] ".concat(e.id," sendAckReadMessages"));var t=!1;return e.messages.forEach((function(n){n.receiptStatus!==h.Message.ReceiptStatus.SENT&&n.receiptStatus!==h.Message.ReceiptStatus.UNREAD||n.side!==h.Message.Side.LEFT&&n.side!==h.Message.Side.ADMIN||(A.sendAckReadMessage(e,n),t=!0)})),t},this.sendChatStatus=function(e,t){if(e.status!==t){S.default.info("[ConversationService] ".concat(e.id," setStatus ").concat(t.value)),e.status=t;var n=e.type===k.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,r=e.type===k.Type.ONE_TO_ONE?"chat":"groupchat";m.default.send(E.$msg({to:n,type:r}).c(t.value,{xmlns:k.ChatstatesNS}))}},this.sendIsTypingState=function(e,t){var n=k.getUniqueMessageId(),r=t?"composing":"active",i=e.type===k.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,a=e.type===k.Type.ONE_TO_ONE?"chat":"groupchat",o=y.default.currentLanguage;m.default.send(E.$msg({to:i,type:a,id:n,"xml:lang":o}).c(r,{xmlns:k.ChatstatesNS}).up())},this.sendRecordingMessage=function(e,t){var n=k.getUniqueMessageId(),r=e.contact.jid,i=e.shortnameToUnicode(t),a=y.default.currentLanguage,o=e.addRecordingMessage(y.default.userContact,new Date,i,n);if(!o)return null;var s=E.$msg({to:r,type:"chat",id:n,"xml:lang":a}).c("body",{"xml:lang":a}).up().c("recording",{xmlns:"jabber:iq:recordingP2P"}).t(i).up().c("request",{xmlns:k.ReceiptNS}).up().c("active",{xmlns:k.ChatstatesNS}).up();return o.serverAckTimer=setTimeout((function(){o.receiptStatus=h.Message.ReceiptStatus.ERROR,o.sendUpdateEvent()}),1e4),m.default.send(s),A.pendingMessages[o.id]={conversation:e,message:o},o},this.sendCorrectedChatMessage=function(e,t,n,r){var i=e.getMessageById(n);if(!i)return S.default.info("[conversationService] sendCorrectedChatMessage - original message not found"),null;if(i.from.jid!==y.default.userContact.jid)return S.default.info("[conversationService] sendCorrectedChatMessage forbidden Action - only sent messages can be modified"),null;if(e.lastEditableMsg.id!==i.id)return S.default.info("[conversationService] sendCorrectedChatMessage forbidden Action - only last sent message can be modified"),null;A.sendAckReadMessages(e);var a=k.getUniqueMessageId(),o=e.type===k.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,s=e.type===k.Type.ONE_TO_ONE?"chat":"groupchat",c=e.shortnameToUnicode(t),l=y.default.currentLanguage,u=E.$msg({to:o,type:s,id:a,"xml:lang":l}).c("body",{"xml:lang":y.default.currentLanguage}).t(c).up().c("replace",{id:n,xmlns:"urn:xmpp:message-correct:0"}).up();return r&&r.length&&(u.c("mention",{xmlns:k.AttentionNS}),r.forEach((function(e){u.c("jid",{pos:e.pos,size:e.size},e.jid)}))),u.c("store",{xmlns:"urn:xmpp:hints"}).up().c("request",{xmlns:k.ReceiptNS}).up().c("active",{xmlns:k.ChatstatesNS}).up(),i.serverAckTimer=setTimeout((function(){i.receiptStatus=h.Message.ReceiptStatus.ERROR,i.sendUpdateEvent()}),1e4),i.addReplaceMsg(a,t),m.default.send(u),e.room&&(e.room.lastActivityDate=new Date),e.updateAfterReplaceEvent(i),A.pendingMessages[a]={conversation:e,message:i},i},this.removeAllMessages=function(t){S.default.info("[conversationService] removeAllMessage "+t.id);var n=e.defer(),r={queryid:m.default.connection.getUniqueId(),with:t.id,onComplete:function(){n.resolve()}},i=m.default.connection.getUniqueId();return m.default.connection.mam.delete(i,r),n.promise},this.removeMessagesFromConversation=function(t,n,r){S.default.info("[conversationService] removeMessagesFromConversation "+t.id),S.default.info("[conversationService] removing "+r+" messages after "+n);var i=e.defer(),a={queryid:"remove_"+t.id,with:t.id,start:c(n).format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),max:r,onComplete:function(){S.default.info("[conversationService] MAM Message deleted !!!"),i.resolve()}};return m.default.connection.mam.delete(t.id,a),i.promise},this.sendConversationByEmail=function(t){var r=e.defer(),i=y.default.userContact,a=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+i.dbId+"/conversations/"+t.dbId+"/downloads";return n({method:"POST",url:a,headers:p.default.getRequestHeader(),data:{}}).then((function(){S.default.error("[conversationService] sendConversationByEmail - success"),r.resolve()}),(function(e){var t={message:"Impossible to download conversation",messageKey:null};e&&e.data&&409011===e.data.errorDetailsCode&&(t.message="No messages to export for the last 30 days.",t.messageKey="noMessagesToExport"),S.default.error("[adminUserService] sendConversationByEmail - "+t.message),r.reject(t)})),r.promise},this.getHistoryPage=function(t,n){return L.isReinit?(S.default.debug("[conversationService] getHistoryPage --- service is reinitialising !"),e.reject(new Error("Service is reinitialising !"))):L.conversationServiceBulkHistoryHandler.getHistoryPage(t,n)},this.retrieveMsgByDate=function(e,t){return S.default.debug("[conversationService] >retrieveMsgByDate: "+t),L.conversationHistoryHandler.retrieveMsgByDate(e,t+"000")},this.searchTextInRoomsAndConversations=function(e){return r(A,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.searchTextConvResults.clearAll(),this.searchTextConvResults.isSearching=!0,t.next=5,Promise.all([this.searchTextInConversations(e),this.searchTextInRooms(e)]);case 5:this.searchTextConvResults.isSearching=!1,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this.searchTextConvResults.isSearching=!1;case 11:case"end":return t.stop()}}),t,this,[[0,8]])})))},this.searchTextInConversations=function(e){return r(A,void 0,void 0,b.a.mark((function t(){var n,r=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=m.default.connection.getUniqueId(),this.searchTextConvResults.queryIds.push(n),this.searchTextConvResults.searchedText=e,t.next=5,L.conversationHistoryHandler.searchTextInConversations(n,e);case 5:Object.keys(this.searchTextConvResults.partResults).forEach((function(e){var t=r.searchTextConvResults.partResults[e];t.room||y.default.getOrCreateContact(e).then((function(n){t.contact=n,r.sortResults(t),r.searchTextConvResults.totalCount+=t.convRes.length,r.searchTextConvResults.results.push(t),delete r.searchTextConvResults.partResults[e]}))}));case 6:case"end":return t.stop()}}),t,this)})))},this.searchTextInRooms=function(e){return r(A,void 0,void 0,b.a.mark((function t(){var n,r=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=C.default.getRooms().map((function(t){return t.desc&&t.desc.startsWith("Rainbow_OutlookCreation_InternalUseOnly")?Promise.resolve():r.searchTextInConversation(e,!1,t.jid,"room")})),t.next=3,Promise.all(n);case 3:case"end":return t.stop()}}),t)})))},this.searchTextInConversation=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return r(A,void 0,void 0,b.a.mark((function r(){var a,o,s,c;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t&&this.searchTextConvResults.clearAll(),a=m.default.connection.getUniqueId(),this.searchTextConvResults.searchedText=e,this.searchTextConvResults.queryIds.push(a),o="room"===i?"searchTextResultsInRoom":"searchTextResultsInConversation",r.next=6,L.conversationHistoryHandler[o](a,e,n);case 6:s=r.sent,(c=this.searchTextConvResults.partResults[n])&&(c.totalCount=s,this.sortResults(c),this.searchTextConvResults.totalCount+=s,this.searchTextConvResults.results.push(c),delete this.searchTextConvResults.partResults[n]);case 9:case"end":return r.stop()}}),r,this)})))},this.storeSearchTextResult=function(e){var t=e.otherJid;if(!e.body.startsWith("/img")){var n=A.searchTextConvResults.partResults[t];n||(n=new i.SearchTextResult(t),e.isRoom&&(n.room=C.default.getRoomByJid(t)),A.searchTextConvResults.partResults[t]=n),n.addMsgItem(e),n.totalCount++}},this.sortResults=function(e){e.convRes.sort((function(e,t){return e.date?t.date?e.date-t.date:1:-1}))},this.setActiveConversation=function(e){return S.default.debug("[conversationService] - setActiveConversation: "+(e?e.id:"null")),this.activeConversation=e,this.activeConversation},this.setMostRecentConversationActive=function(){var e=L.getConversations().sort(L.sortFunction);return e.length>0?this.setActiveConversation(e.first()):this.setActiveConversation(null)},this.getActiveConversation=function(){return this.activeConversation},this.getConversationById=function(e){return L.conversations?L.conversations[e]:null},this.getConversations=function(){var e=[];for(var t in L.conversations)L.conversations.hasOwnProperty(t)&&e.push(L.conversations[t]);return e},this.orderConversations=function(){L.inCallConversations=[],L.idleConversations=[],L.involvedContactIds=[],Object.keys(L.conversations).forEach((function(e){var t=L.conversations[e];if(t.type===k.Type.ROOM&&t.room.owner&&t.room.isMeetingRoom()){var n=w.default.getConferenceSessionById(t.room.getPstnConfEndpointId());if(n&&n.active)return void L.inCallConversations.push(t)}t.isInCall()?L.inCallConversations.push(t):L.idleConversations.push(t),t.type===k.Type.ONE_TO_ONE&&L.involvedContactIds.push(t.contact.id)})),L.idleConversations.sort(L.sortFunction),L.publish(f.RBEvent.create("reorder"))},this.getOrderedConversations=function(){return{inCall:L.inCallConversations,idle:L.idleConversations,contactIds:L.involvedContactIds}},this.sortFunction=function(e,t){var n=!e.lastModification&&e.creationDate?e.creationDate:e.lastModification;return(!t.lastModification&&t.creationDate?t.creationDate:t.lastModification)-n},this.sortDataFunction=function(e,t){var n=!e.lastModificationSort&&e.creationDateSort?e.creationDateSort:e.lastModificationSort;return(!t.lastModificationSort&&t.creationDateSort?t.creationDateSort:t.lastModificationSort)-n},this.formatDate=function(e){return c(e).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z"},this.resetConversationMissedCounters=function(e){t.appVisible&&(e.missedCounter=0,e.missedCalls=0,this.updateMissedCounters())},this.decreaseMissedIMCounterForConversation=function(e){e.missedCounter>0&&(e.missedCounter-=1),this.updateMissedCounters()},this.updateMissedCounters=function(){var e=0,n=[];Object.keys(L.conversations).forEach((function(t){var r=L.conversations[t];0!==r.missedCounter&&(e+=r.missedCounter,n.push(r))})),e===this.currentMissedIMCounter&&0===this.currentMissedCallCounter||(this.currentMissedIMCounter=e,this.currentMissedCallCounter=0,t.$broadcast("ON_MISSED_COUNTER_CHANGED_EVENT",{missedIMCounter:e,missedCallCounter:0,missedIMDetails:n}))},this.dropConversationCall=function(e){e.audioCall&&D.releaseCall(e.audioCall),e.videoCall&&(M.attachLocalMediaStream(!1),M.attachDistantMediaStream(!1),M.releaseCall(e.videoCall))},this.holdConversationCall=function(e){e.audioCall&&(D.holdCall(e.audioCall),e.videoCall&&(M.attachLocalMediaStream(!1),M.attachDistantMediaStream(!1),M.releaseCall(e.videoCall)))},this.retrieveConversationCall=function(e){e.audioCall&&D.retrieveCall(e.audioCall),e.videoCall&&S.default.error("Not implemented for the moment")},this.allowDesktopSharing=function(){return!1},this.allowAdvancedDesktopSharing=function(){return!1},this.updateConversationCall=function(e,t){t.type===s.Call.Type.WEBRTC?e.videoCall=t:t.type===s.Call.Type.PHONE&&(e.audioCall=t),t.setConversationId(e.id),!t.isConference&&e.contact&&A.computeCapabilitiesForContact(e.contact),A.computeCapabilitiesForMyContact()},this.computeCapabilitiesForContact=function(e,n){var r=!1,i=!1,a=!1,o=!1,c=!1,l=e.status,u=e.fullJid,d=y.default.userContact;if(e.jid!==d.jid){var h=e.company&&y.default.userContact.company&&"Rainbow"!==e.company.name&&"Default"!==e.company.name&&e.company.name===y.default.userContact.company.name,f=A.getConversationById(e.id);if(M.started){var p=f?f.videoCall:null;p&&p.status!==s.Call.Status.UNKNOWN||!(("unknown"===l||"wait"===l)&&h||"online"===l||"online-mobile"===l||"away"===l||"busy"===l&&"audioPhone"===e.message)||(e.webrtcAudioEnabled&&(i=!0),a=!0)}if(D.started){var m=e.phonePro||e.phonePbx&&e.pbxId||e.mobilePro||e.phonePerso||e.mobilePerso,v=D.getActiveCallsForContact(e);0===v.length&&m&&(r=!0),(0!==v.length||M.getMediaPillarAudioCall())&&u&&(c=!0)}"online"!==l&&"busy"!==l&&"away"!==l&&"dnd"!==l||(o=!0);var g={telephony:r,webRTC:i,sharedDesktop:a,fileTransfert:o,mediaAvailable:r||i,addMedia:c};(e.isBot||e.displayName&&-1!==e.displayName.indexOf("E-HELPER"))&&(g={telephony:!1,webRTC:!1,sharedDesktop:!1,fileTransfert:!1,mediaAvailable:!1,addMedia:!1}),e.capabilities=g,f&&(f.capabilities=g,n||t.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",f,k.EventType.CAPABILITIES))}else A.computeCapabilitiesForMyContact()},this.computeCapabilitiesForMyContact=function(){var e=!1,t=!1,n=!1,r=y.default.userContact;if(M.started){var i=M.isUserContactInCall();i||"busy"===r.status&&("busy"!==r.status||"audioPhone"!==r.message)||(r.webrtcAudioEnabled&&(t=!0),L.allowDesktopSharing()&&(n=!0)),i&&M.getMediaPillarAudioCall()&&!M.getCurrentSharingCall()&&L.allowDesktopSharing()&&(n=!0)}if(D.started){var a=D.getCalls();I.isMediaPillarCallSituation()&&Object.keys(M.calls).length>=1?e=!!(a.length>=1&&L.isSecondCallAllowed):(0===a.length&&L.isBasicCallAllowed||1===a.length&&L.isSecondCallAllowed)&&(e=!0)}var o={telephony:e,webRTC:t,sharedDesktop:n,mediaAvailable:e||t};S.default.debug("[ConversationService] computeCapabilitiesForMyContact  capabilities "+JSON.stringify(o)),r.capabilities=o},this.onCallEvent=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e.type){case s.Call.Type.WEBRTC:A.handleWebRtcCallEvent(e);break;case s.Call.Type.PHONE:A.handleTelephonyCallEvent(e,t)}},this.handleWebRtcCallEvent=function(e){return r(A,void 0,void 0,b.a.mark((function n(){var r=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:I.isMediaPillarJid(e.fullJid)?(t.$broadcast("ON_MPMEDIA_CONVERSATION_CALL_UPDATED_EVENT",{call:e}),e.status===s.Call.Status.ACTIVE&&e.mediaPillarCall&&(e.mediaPillarCall.telephonyCallRefs||[]).forEach((function(t){if(null!==t&&t.type.value===s.Call.Type.PHONE.value){var n=r.getConversationById(t.conversationId);n&&n.rxSubject.next({name:"callUpdate",value:e})}})),e.status!==s.Call.Status.RINGING_INCOMMING&&(this.computeCapabilitiesForMyContact(),t.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:e}))):L.getOrCreateOneToOneConversation(e.contact.id).then((function(n){L.updateConversationCall(n,e),L.orderConversations(),n.rxSubject.next({name:"callUpdate",value:e}),t.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:n,call:e})}));case 1:case"end":return n.stop()}}),n,this)})))},this.isTempTelephonyConversation=function(e){return!e.contact||e.contact.temp||e.isConference||y.default.isUserContact(e.contact)},this.handleTelephonyCallEvent=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(A,void 0,void 0,b.a.mark((function r(){var i,a,o,c,l,u,d,h,p,m=this;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.status===s.Call.Status.UNKNOWN&&(e.conversationId&&(e.conversationId===e.id?((i=this.getConversationById(e.id))&&this.removeConversation(i),t.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:e})):((a=this.getConversationById(e.conversationId))&&(S.default.info("[ConversationService] onCallEvent call "+e.id+" conversation "+e.conversationId+" : set inactive"),a.audioCall=null),t.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:a,call:e})),this.orderConversations(),1!==(o=D.getCalls()).length||!o[0]||o[0].status!==s.Call.Status.HOLD&&o[0].status!==s.Call.Status.PUT_ON_HOLD&&o[0].status!==s.Call.Status.ACTIVE||(c=o[0],(l=!c.contact||c.contact.temp||c.contact.jid===y.default.userContact.jid?this.getOrCreateTelephonyConversation(c):this.getConversationById(c.contact.id))&&setTimeout((function(){m.publish(f.RBEvent.create("activeConversation",l))}),200))),e.contact&&!D.getConferenceCallForContact(e.contact)&&M.endAllCallsForContact(e.contact),e.isConference&&setTimeout((function(){(e.participants||[]).forEach((function(e){e&&0===D.getActiveCallsForContact(e).length&&M.endAllCallsForContact(e)}))}),1e3)),n||!I.isMediaPillarCallSituation(e)){r.next=6;break}if(e.isSecondary){r.next=4;break}return r.abrupt("return",void t.$broadcast("ON_UPDATE_TELEPHONY_ICON_EVENT"));case 4:if(e.status!==s.Call.Status.RINGING_INCOMMING||"MAKECALL"===e.lastCause||"CALLBACK"===e.lastCause){r.next=6;break}return r.abrupt("return");case 6:if(e.status===s.Call.Status.UNKNOWN||null===e.connectionId){r.next=31;break}if(this.isSecondCallAllowed){r.next=11;break}if(!((u=D.getNotIdleCalls()).length>1&&u.findIndex((function(t){return t.id===e.id}))>0)){r.next=11;break}return r.abrupt("return");case 11:if(d=this.isTempTelephonyConversation(e),S.default.info("[ConversationService] onCallEvent -- "+e.connectionId+"  -- relevantEquipmentId : "+e.relevantEquipmentId+" "+(e.status?e.status.value:"null")+" isTempConversation: "+d),h=d?this.getOrCreateTelephonyConversation(e):this.getConversationById(e.contact.id),r.t0=h,r.t0){r.next=24;break}if(!d){r.next=20;break}r.t1=this.getOrCreateTelephonyConversation(e),r.next=23;break;case 20:return r.next=22,this.getOrCreateOneToOneConversation(e.contact.id);case 22:r.t1=r.sent;case 23:h=r.t1;case 24:if(d&&h.contact&&e.contact&&(e.contact.firstname||e.contact.lastname)&&h.contact.updateName(e.contact.firstname,e.contact.lastname),d&&!e.isConference&&e.conversationId===e.id&&!h.contact&&h.telephonyContacts&&(S.default.info("[ConversationService] onCallEvent -- "+e.connectionId+" : remove prevous conference conversation "+e.id),this.removeConversation(h),t.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:e}),h=this.getOrCreateTelephonyConversation(e)),!e.conversationId||e.conversationId===h.id){r.next=28;break}e.conversationId===e.id?!d&&this.conversations[e.id]&&(S.default.info("[ConversationService] onCallEvent -- "+e.connectionId+" : remove prevous temp conversation "+e.id),delete this.conversations[e.id]):(p=this.getConversationById(e.conversationId))&&(S.default.info("[ConversationService] onCallEvent -- "+e.connectionId+" : set previous conversation to known rainbow contact inactive "+e.conversationId),p.audioCall=null,t.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:p,call:e}));case 28:if(this.updateConversationCall(h,e),e.status!==s.Call.Status.ACTIVE&&e.status!==s.Call.Status.DIALING&&e.status!==s.Call.Status.RINGING_OUTGOING||setTimeout((function(){m.publish(f.RBEvent.create("activeConversation",h))}),200),this.orderConversations(),t.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:h,call:e}),h.rxSubject.next({name:"callUpdate",value:e}),e.getDeviceIdFromConnectionIdFromCall()===e.relevantEquipmentId||e.status===s.Call.Status.ACTIVE){r.next=31;break}return r.abrupt("return",void t.$broadcast("ON_UPDATE_TELEPHONY_ICON_EVENT"));case 31:e.status!==s.Call.Status.ERROR||e.connectionId||this.publish(f.RBEvent.create("callError",e));case 32:case"end":return r.stop()}}),r,this)})))},this.onPGiConferenceStateEvent=function(e){return r(A,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=12;break}return t.prev=1,t.next=4,C.default.retrieveCurrentPersonalAudioRoom();case 4:return n=t.sent,t.next=7,this.getRoomConversation(n.jid);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),S.default.debug("[conversationService] error handling pgi conference event");case 12:L.orderConversations();case 13:case"end":return t.stop()}}),t,this,[[1,9]])})))},this.onReloadCapabilitiesForMyContactEvent=function(e){S.default.info("[conversationService] onReloadCapabilitiesForMyContactEvent"),L.computeCapabilitiesForMyContact()},this.onConversationEvent=function(){L.updateMissedCounters()},this.onContactChangedEvent=function(e,t){L.computeCapabilitiesForContact(t),L.computeCapabilitiesForMyContact()},this.onTelephonyStateChangeEvent=function(e){var t=L.getConversations();t&&t.forEach((function(e){e.type===k.Type.ONE_TO_ONE&&L.computeCapabilitiesForContact(e.contact)})),L.computeCapabilitiesForMyContact()},this.onConferenceStateChangeEvent=function(){L.updateRoomConferences(),L.orderConversations(),t.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT")},this.onConferenceParticipantChangeEvent=function(){L.orderConversations(),t.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT")},this.onRoomChangedEvent=function(e,t,n){if(t){var r=L.getConversationById(t.jid);r&&("remove"===n?L.closeConversation(r):r.room=t)}},this.onRoomHistoryChangedEvent=function(e,t){if(t){var n=L.getConversationById(t.jid);n&&n.chatRenderer&&(n.reset(),n.chatRenderer.loadMore())}},this.onRoomAdminMessageEvent=function(e,t,n,r,i){S.default.info("[conversationService] onRoomAdminMessageEvent");var a=L.getConversationById(t);a&&"welcome"===r&&a.room&&a.room.ownerContact&&(n=a.room.ownerContact.jid);var o=y.default.getContactByJid(n);if(a&&o){if(!a.room.owner&&"invitation"===r)return;if(a.room&&a.room.isMeetingRoom())return;L.conversationServiceEventHandler.onRoomAdminMessageReceived(a,o,r,i)}},this.onRoomAddConferenceEvent=function(e){S.default.info("[conversationService] onRoomAddConferenceEvent"),L.updateRoomConferences(),L.orderConversations(),t.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT")},this.onMyContactChangedEvent=function(){L.getOrderedConversations().idle.forEach((function(e){e.type===k.Type.ONE_TO_ONE&&L.computeCapabilitiesForContact(e.contact)})),L.computeCapabilitiesForMyContact()},this.reinit=function(){var n=e.defer();return S.default.info("[conversationService] Re-initialize conversation service"),L.activeConversation&&(L.activeConversation.reset(),L.activeConversation=null),delete L.conversations,L.conversations=[],L.conversationCreationPromise||(L.conversationCreationPromise={}),L.botServiceReady=!0,L.isReinit=!0,S.default.info("[conversationService] getServerConversations"),L.getServerConversations().then((function(){L.isReinit=!1,L.linkAllActiveCallsToConversations(),t.$broadcast("ON_MISSED_COUNTER_CHANGED_EVENT",{missedIMCounter:this.currentMissedIMCounter,missedCallCounter:this.currentMissedCallCounter}),n.resolve()})).catch((function(){L.isReinit=!1,T((function(){S.default.info("[conversationService] getServerConversations failure, try again"),L.getServerConversations().then((function(){L.linkAllActiveCallsToConversations()}))}),1e4,1,!0),n.resolve()})),n.promise},this.linkAllActiveCallsToConversations=function(){for(var e in D.calls)if(D.calls.hasOwnProperty(e)){var n=D.calls[e];t.$broadcast("ON_CALL_UPDATED_EVENT",n)}for(var r in M.calls)if(M.calls.hasOwnProperty(r)){var i=M.calls[r];t.$broadcast("ON_CALL_UPDATED_EVENT",i)}},this.unlockWaitingBotConversations=function(e){e&&(L.botServiceReady=!0),L.botServiceReady&&(L.waitingBotConversations.forEach((function(e,t){var n=y.default.getContactByJid(e.jid);n&&(L.getOrCreateOneToOneConversation(n.jid,e.conversationDbId,e.lastModification,e.lastMessageText,e.missedIMCounter,e.muted,e.creationDate),L.waitingBotConversations.splice(t,1))})),L.waitingBotConversations=[])},this.askForSharing=function(e,t){return r(A,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(r=$iq({from:m.default.jid,to:t.fullJid,type:"set"})).c("command",{xmlns:"http://jabber.org/protocol/commands",node:"request-transfert-sharing",convId:e}),n.next=4,m.default.sendIQ(r);case 4:case"end":return n.stop()}}),n)})))},this.acceptTransfertSharing=function(e,t){return r(A,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(r=$iq({from:m.default.jid,to:t.fullJid,type:"set"})).c("command",{xmlns:"http://jabber.org/protocol/commands",node:"accept-transfert-sharing",convId:e}),n.next=4,m.default.sendIQ(r);case 4:case"end":return n.stop()}}),n)})))},this.refuseTransfertSharing=function(e,t){return r(A,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(r=$iq({from:m.default.jid,to:t.fullJid,type:"set"})).c("command",{xmlns:"http://jabber.org/protocol/commands",node:"refuse-transfert-sharing",convId:e}),n.next=4,m.default.sendIQ(r);case 4:case"end":return n.stop()}}),n)})))},this.onAskSharingMessageReceived=function(e){try{var t=$(e),n=t.attr("from"),r=y.default.getContactByJid(m.default.getBareJidFromJid(n)),i=t.find("command"),a=i.attr("convId"),o=A.getConversationById(a);if(i.length>0)switch(i.attr("node")){case"request-transfert-sharing":o.rxSubject.next({name:"request-transfert-sharing",fromContact:r});break;case"accept-transfert-sharing":o.rxSubject.next({name:"accept-transfert-sharing",fromContact:r});break;case"refuse-transfert-sharing":o.rxSubject.next({name:"refuse-transfert-sharing",fromContact:r})}}catch(s){return!0}return!0},this.cleanUnwantedConversations=function(){Object.keys(L.conversations).forEach((function(e){var t=L.conversations[e];t.type===k.Type.ROOM&&(!y.default.userContact.roomsEnabled||t.room&&t.room.isMeetingRoom()&&!y.default.userContact.phoneMeetingsEnabled)&&(S.default.info("cleanUnwantedConversations -- close conversation "+t.id+" due to customisation limitation"),L.closeConversation(t))}))}}])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;S(this,e),this.url=t,this.fileName=n,this.totalBytes=i,this.receivedBytes=a,this.savePath=o,this.isCanceled=!1,this.openFolderOnceDownloadFinished=!1,this.progressSubject=new r.Subject}return C(e,[{key:"isDownloadFinished",value:function(){return this.receivedBytes===this.totalBytes}},{key:"askCancel",value:function(){this.isCanceled=!0,this.progressSubject.next()}}],[{key:"create",value:function(t,n,r,i,a){return new e(t,n,r,i,a)}}]),e}();t.FilePublicDownload=i},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),a=n(54),o=n(76),s=n(3);n(227);var c=n(1),l=n(4),u=n(38),d=n(15),h=n(25);t.ConversationServiceBulkHistoryHandler=function(){function e(t,n){S(this,e),this.conversationService=t,this.fileServerService=n,this.xmppService=l.default,this.i18n=u.default,this.logger=d.default,this.contactService=c.default,this.fileStorageService=h.default}return C(e,[{key:"getHistoryPage",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.logger.info("[ConversationServiceBulkHistoryHandler] getHistoryPage(".concat(e.id,")")),n.prev=1,n.abrupt("return",this.getHistoryPageInternal(e,t));case 5:return n.prev=5,n.t0=n.catch(1),n.abrupt("return",(this.logger.info("[ConversationServiceBulkHistoryHandler] "+n.t0.message),null));case 8:case"end":return n.stop()}}),n,this,[[1,5]])})))}},{key:"getHistoryPageAroundMessage",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.logger.info("[ConversationServiceBulkHistoryHandler] getHistoryPageAroundDate(".concat(e.id,", ").concat(t,")")),n.next=3,this.getHistoryPageInternal(e,15,"after",t);case 3:return n.next=5,this.getHistoryPageInternal(e,15,"before",t);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"getHistoryPageInternal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"before",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return r(this,void 0,void 0,b.a.mark((function r(){var a,s,c,l,u,d,h,f,p,m,v;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.logger.info("[ConversationServiceBulkHistoryHandler] getHistoryPage(".concat(e.id,", ").concat(t,")")),a=new Promise((function(t,n){e.historyDefered={resolve:t}})),r.t0=e.room&&e.room.initPresPromise,!r.t0){r.next=6;break}return r.next=6,e.room.initPresPromise.promise;case 6:if(!e.currentHistoryId||e.currentHistoryId!==e.historyIndex){r.next=9;break}throw s="getHistoryPage(".concat(e.id,", ").concat(t,", ").concat(e.historyIndex,") --- already asked"),this.logger.info("[ConversationServiceBulkHistoryHandler] "+s),new Error(s);case 9:if(e.currentHistoryId=e.historyIndex,!e.historyComplete){r.next=12;break}throw c="getHistoryPage(".concat(e.id,") --- complete"),this.logger.info("[ConversationServiceBulkHistoryHandler] "+c),new Error(c);case 12:return l=e.id,u=this.xmppService.connection.getUniqueId(),d=e.room?e.room.jid:null,h=e.room?this.contactService.userContact.jid:e.id,f=o.$iq({id:u,to:d,type:"set"}).c("query",{queryid:l,xmlns:"urn:xmpp:mam:1:bulk"}).c("x",{xmlns:"jabber:x:data",type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"with"}).c("value").t(h).up().up().up().c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(t).up(),i?(p="after"===n?Number(i)-1:i,f.c(n).t(p)):-1===e.historyIndex?f.c(n).t(""):f.c(n).t(e.historyIndex),m=performance.now(),r.next=17,this.xmppService.sendIQ(f);case 17:return v=Math.round(performance.now()-m),r.next=20,a;case 20:return this.logger.info("[ConversationServiceBulkHistoryHandler] getHistoryPage(".concat(e.id,") -- duration ").concat(v,"ms")),r.abrupt("return",e);case 22:case"end":return r.stop()}}),r,this)})))}},{key:"resetHistory",value:function(e){var t=e.messages.length;if(t>30){this.logger.info("[ConversationServiceBulkHistoryHandler] resetHistory for conversation "+e.id);var n=t-30;e.messages.splice(0,n),e.currentHistoryId=null,e.historyComplete=!1,e.historyIndex=e.messages[0].historyIndex}}},{key:"onHistoryMessageReceived",value:function(e){var t=this;try{this.logger.info("[conversationService] onHistoryMessageReceived");var n=$(e).find("results");if(1===n.length){var r=n.find("result");if(r.length>0){var i=$(r[0]).attr("queryid");this.logger.info('[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived "results" ('.concat(i,")"));var a=this.conversationService.getConversationById(i);a&&n.find("result").each((function(e,n){var r=$(n).find("forwarded message"),i=r.attr("from"),o=$(r).find("forwarded[xmlns='urn:xmpp:forward:0']");if(o&&o.length){t.logger.info("[ConversationServiceHistoryHandler] ("+a.id+") Forwarded Message detected");var s=r.attr("id");r=$(o).find("forwarded message"),t.createMessage(a,n,r,i,s,!0)}else t.createMessage(a,n,r,i,null,!1)}))}}else{var o=$(e).find("fin"),s=o.attr("queryid");this.logger.info('[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived "fin" ('.concat(s,")"));var c=this.conversationService.getConversationById(s);if(c){if(c.historyComplete="true"===o.attr("complete"),c.historyIndex=$(o).find("set first").text(),c.messages.unshift.apply(c.messages,c.historyMessages),c.historyMessages=[],c.lastMessageText="",c.lastMessageSender=null,c.messages&&c.messages.length>0){var l=c.messages[c.messages.length-1];c.lastMessageText=l.data,c.lastMessageSender=l.from.id}c.historyDefered&&c.historyDefered.resolve()}}}catch(u){return this.logger.error("[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived -- failure -- "+u),!0}return!0}},{key:"createMessage",value:function(e,t,n,r,a,o){var c=a||n.attr("id");this.logger.info("[ConversationServiceHistoryHandler] : createMessage - searching for message "+c);var l=e.getMessageById(c);if(l||(l=e.historyMessages.find((function(e){return e.id===c}))),l||(l=e.getReplacedMessageById(c)),l)this.logger.info("[ConversationServiceHistoryHandler] ("+e.id+") try to add an already stored message with id "+l.id);else{var u=null,d=n.attr("type"),h=r&&0===r.indexOf("room_")?r.split("/")[1]:this.xmppService.getBareJidFromJid(r),f=null;if(!h){var p=$(t).find("event");if(p.length){if(h=p.attr("jid"),f=p.attr("name"),e.room){if(e.room.isMeetingRoom()&&("welcome"===f||"conferenceAdd"===f||"conferenceRemove"===f||"invitation"===f))return;if("welcome"===f&&e.room.ownerContact&&(h=e.room.ownerContact.jid),("conferenceAdd"===f||"conferenceRemove"===f)&&e.room.ownerContact){var m=e.room.getUserByJid(h);u=m&&m.contact?m.contact:e.room.ownerContact}}d="admin"}}if(h){if("webrtc"===d){var v=$(t).find("caller").text();u=this.contactService.getContact(v)}u||(u=this.contactService.getContact(h)),u||(u=this.contactService.createEmptyContact(h));var g=new Date($(t).find("forwarded delay").attr("stamp")),y=$(n).find("body").text(),b=this.contactService.isUserContact(u)?i.Message.Side.RIGHT:i.Message.Side.LEFT,S=$(t).find("geoloc"),_=null;if(S&&S.length){var C=$(S);_={lon:C.find("lon").text(),lat:C.find("lat").text()}}var w="std",E=$(n).find("headers[xmlns='http://jabber.org/protocol/shim']");if(E&&E.length){var T=$(E).find("header[name='Urgency']");T&&T.length&&(w=T.text())}var k=$(n).find("x[xmlns='jabber:x:oob']");if(k&&k.length&&(d="fileSharing"),$(t).find("call_log").length){var M=$(t).find("state").text();if("missed"===M)y="missedCall||"+g;else if("answered"===M){var D=$(t).find("duration")?parseInt($(t).find("duration").text(),10):0,x=D>0?"(".concat(s.duration(D,"ms").format("h[H] mm[m] ss[s]"),")"):"";y="activeCallMsg||".concat(g,"||").concat(x)}}switch(d){case"webrtc":l=i.Message.createWebRTCMessage(c,g,u,b,y,!1);break;case"admin":l=i.Message.createBubbleAdminMessage(c,g,u,f);break;case"fileSharing":l=this.createFileSharingMessage(k,c,g,u,b,y,_);break;case"recording":break;default:var R=$(t).find("content[xmlns='urn:xmpp:content']"),O=!1,I=null;R&&R.each((function(e,t){I||(I={});var n=$(t).attr("type"),r=$(t).text();"text/markdown"===n&&(O=!0,y=r),I[n]={type:n,message:r}}));var P=null,A=$(t).find("mention[xmlns='urn:xmpp:attention:0']");A.length&&(P=[],A.find("jid").each((function(e,t){var n={};n.jid=$(t).text(),n.pos=parseInt($(t).attr("pos"),10),n.size=parseInt($(t).attr("size"),10),n.jid&&n.size&&P.push(n)})));var L=$(t).find("replace");if(L&&L.length){var N=L.attr("id"),j=e.getMessageByIdInHistory(N);if(j||(j=e.getMessageById(N)),j||(l=j=i.Message.create(N,g,u,b,y,!1,O,I,null,null,null,null,P)),u.jid!==j.from.jid)this.logger.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived : message Replaced by somebody else - Skip"),l=null;else if(j){j.addReplaceMsg(c,y),j.mentions=P;var U=y.length?y.substr(0,1)+"***"+y.substr(y.length-1):"";this.logger.info("Add new history replace message for message "+c+" witn body "+U)}}else{var F=$(t).find("answeredMsg"),H=F?F.text():null,W=F?F.attr("stamp"):null;if((l=i.Message.create(c,g,u,b,y,!1,O,I,null,H,W,null,P)).urgency=w,H){var Y=e.getMessageByIdInHistory(H);Y?(Y.urgencyAck=!0,Y.sendUpdateEvent()):this.logger.error("[ConversationServiceEventHandler] Not possible to handle answeredMsg because replied msg not found")}}}if(l){l.isForwarded=o,l.urgency=w,l.historyIndex=$(t).attr("id");var B=$(n).find("ack");l.receiptStatus="true"===$(B).attr("read")?5:"true"===$(B).attr("recv")?4:3,e.addMessageInHistoryMessages(l),this.logger.info("Add new history message : "+l.getInfoForLogs())}}else this.logger.warn("[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived - Receive message without valid fromJid information")}}},{key:"createFileSharingMessage",value:function(e,t,n,r,o,s,c){var l=this,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=$(e),h=d.find("url").text(),f=d.find("filename").text(),p=this.fileStorageService.extractFileIdFromUrl(h),m=i.Message.createFileSharingMessage(t,n,r,o,s,!1,p,f,null,c,u);return this.fileStorageService.retrieveAndStoreOneFileDescriptor(p).then((function(e){e&&e.state===a.FileState.NOT_UPLOADED&&(m.receiptStatus=1,m.fileErrorMsg=l.i18n.translate("file_notuploaded")),l.fileServerService.getBlobThumbnailFromFileDescriptor(e).then((function(t){e.previewBlob=t,e.previewBlobSubject.next(e.previewBlob)})).catch((function(){l.logger.info("[ConversationServiceBulkHistoryHandler] getBlobThumbnailFromFileDescriptor error "),e.previewBlobSubject.next(e.previewBlob)}))})).catch((function(e){l.logger.info("[ConversationServiceBulkHistoryHandler] createFileSharingMessage error "+e)})),m}}]),e}()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(66),o=n(75),s=n(333),c=n(334),l=n(228),u=n(60),d=n(32),h=n(67),f=n(335),p=n(15),m=n(1),v=n(2),y=n(4),_=n(64),w=n(6),E=n(33),T=n(38),k=n(37);!function(e){e.PSTNAUDIO="pstnAudio",e.WEBRTC="webrtc",e.WEBRTCSHARINGONLY="webrtcSharingOnly"}(i=t.MEDIATYPE||(t.MEDIATYPE={})),t.NgPgiConferenceService=function(){function e(){S(this,e),this.eventService=d.default,this.logger=p.default,this.authService=v.default,this.xmppService=y.default,this.countryService=_.default,this.profileService=w.default,this.contactService=m.default,this.roomService=E.default,this.i18n=T.default,this.conferenceEndpoints={},this.conferenceEnpointsSubject=new h.Subject,this.conferenceSessions={},this.conferenceSessionsSubject=new f.ReplaySubject,this.started=!1,this.isPstnConferenceAvailable=!1,this.isPstnConferenceAvailableSubject=new a.BehaviorSubject(this.isPstnConferenceAvailable),this.pstnConferencePhoneNumbers=null,this.startedSubject=new a.BehaviorSubject(!1)}return C(e,[{key:"start",value:function(e){var t=this;this.logger.info("=== STARTING ===");var n=performance.now();this.confProvPortalURL=new URL(config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/"),this.confPortalURL=new URL(config.restServerUrl+"/api/rainbow/conference/v1.0/"),this.attachHandlers(),this.computePstnConferencePremission(),this.isPstnConferenceAvailableSubject.pipe(o.distinctUntilChanged()).subscribe((function(e){e&&t.initializeServiceData()})),this.started=!0;var r=Math.round(performance.now()-n);e.push({service:"PgiConferenceService",startDuration:r}),this.logger.info("=== STARTED (".concat(r," ms) ===")),this.startedSubject.next(!0),this.contactService.userContact.phoneMeetingsEnabledSubject.pipe(o.distinctUntilChanged()).subscribe((function(e){e||t.stop()}))}},{key:"stop",value:function(){this.logger.info(""),this.logger.info("[PgiConferenceService] === STOPPING ==="),this.isPstnConferenceAvailable=!1,this.started=!1,this.logger.info("[PgiConferenceService] === STOPPED ==="),this.startedSubject.next(!1)}},{key:"reconnectService",value:function(){this.logger.info("reconnectService"),this.attachHandlers(),this.refreshConferenceSessions()}},{key:"attachHandlers",value:function(){var e=this;this.xmppManagementHandler&&(this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.xmppManagementHandler=this.xmppService.addHandler((function(t){return e.onManagementMessage(t),!0}),null,"message","management"),this.conferenceHandler&&(this.xmppService.connection.deleteHandler(this.conferenceHandler),this.conferenceHandler=null),this.conferenceHandler=this.xmppService.connection.addHandler((function(t){return e.onConferenceMessage(t),!0}),"jabber:iq:conference","message",null)}},{key:"onManagementMessage",value:function(e){var t=$(e);t.find("confuseractivated ").length>0&&this.setPstnConferenceAvailability(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED));var n=t.find("confendpoint");if(n.length&&"update"===n.attr("action")){this.logger.info("onManagementMessage - update of conference");var r=t.find("confendpointid").text();this.retrieveConference(r,!0)}}},{key:"onConferenceMessage",value:function(e){var t=$(e),n=t.find("conference-id").text(),r=this.getConferenceSessionById(n);r&&this.updateConferenceSession(t,r)}},{key:"updateConferenceSession",value:function(e,t){this.logger.info("updateConferenceSession - "+t.id);var n=e.find("conference-state");if(n.length){var r="true"===n.find("active").text();this.updateState(t,r)}var i=e.find("talkers");if(i.length){var a=[];i.find("participant-id").each((function(e,t){var n=$(t).text();a.push(n)})),this.logger.debug("update talkers with: "+a),t.updateTalkers(a)}var o=e.find("participants");if(0===o.length&&(o=e.find("updated-participants")),o.length||(o=e.find("added-participants")),o.length){var s=[];o.find("participant").each((function(e,t){var n=$(t),r=n.find("participant-id").text(),i=n.find("jid-im").text(),a=n.find("phone-number").text(),o=n.find("role").text(),c=n.find("mute").text(),l=n.find("hold").text(),u=n.find("cnx-state").text();s.push({participantId:r,jid_im:i,phoneNumber:a,participantRole:o,mute:"on"===c,held:"on"===l,participantState:u})})),s.length&&(t.participants=s)}var c=e.find("removed-participants");if(c.length){var l=[];c.find("participant-id").each((function(e,t){var n=$(t).text();l.push(n)})),this.logger.debug("remove participants: "+l),t.removeParticipants(l)}this.conferenceSessionsSubject.next({id:t.id,action:"updated"})}},{key:"updateState",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s,c;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.active||t){r.next=25;break}if(!this.contactService.userContact.guestMode||e.type===i.WEBRTCSHARINGONLY){r.next=3;break}return r.abrupt("return",(this.eventService.publish("ON_OPEN_POPUP","concludeInvitation"),e.cleanupSessionData(),void e.updateStateFromData(t,n)));case 3:if(!(a=this.roomService.findRoomsWithConfId(e.id)[0])){r.next=24;break}if(!a.owner||e.id!==this.getPstnInstantConferenceEndpointId()){r.next=23;break}return r.prev=6,r.next=9,this.roomService.retrieveRoomConsumption();case 9:if(!(r.sent>this.profileService.getFeatureLimitMax(this.profileService.FeaturesEnum.BUBBLE_COUNT))){r.next=16;break}return this.eventService.publish("ON_OPEN_GLOBAL_POPUP",{popupTitle:"createBubble",popupBody:"maxCollabSpaceReached",okLabel:"ok"}),r.next=14,this.roomService.deletePersonalMeetingRoom();case 14:r.next=17;break;case 16:a.isMyPersonalMeetingRoom()&&this.eventService.publish("ON_SHOW_POPUP",{component:"renameMeeting",data:a});case 17:r.next=21;break;case 19:r.prev=19,r.t0=r.catch(6);case 21:r.next=24;break;case 23:!a.owner&&e.isParticipantConnectedByJid(this.contactService.userContact.dbId)&&(o=u(a.ownerContact.displayName),s=u(a.name),c=this.i18n.translate("meetingEndBy",{owner:o,meeting:s}),this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",c));case 24:e.cleanupSessionData();case 25:e.updateStateFromData(t,n);case 26:case"end":return r.stop()}}),r,this,[[6,19]])})))}},{key:"initializeServiceData",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.retrievePstnConferences();case 3:return e.next=5,this.makeSnapshots();case 5:this.logger.info("service data initialized"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.logger.warn("service data init failed");case 11:case"end":return e.stop()}}),e,this,[[0,8]])})))}},{key:"setPstnConferenceAvailability",value:function(e){this.isPstnConferenceAvailable&&!e&&this.eventService.publish("ON_OPEN_GLOBAL_POPUP",{popupTitle:"information",popupBody:"pgiRightsRemovedWarning",okLabel:"ok"}),this.isPstnConferenceAvailable=e,this.isPstnConferenceAvailableSubject.next(this.isPstnConferenceAvailable)}},{key:"computePstnConferencePremission",value:function(){var e=this,t=!0;this.profileService.getProfilesByName("conference").filter((function(e){return"active"===e.status})).forEach((function(n){n.provisioningNeeded&&n.provisioningNeeded.length&&n.provisioningNeeded.forEach((function(n){-1!==n.providerType.toLowerCase().indexOf("pgi")&&((t=n.provisioningOngoing)&&e.logger.info("computePstnConferencePremission - pgi provisioning on going"))}))})),this.setPstnConferenceAvailability(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED)&&!t)}},{key:"makeSnapshots",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,i,a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n in e.prev=0,this.logger.info("makeSnapshots"),t=[],this.conferenceEndpoints)this.conferenceEndpoints[n]&&(i=this.conferenceEndpoints[n])&&(this.logger.info("makeSnapshots -- "+i.id),t.push(i.id));return e.next=6,Promise.all(t.map((function(e){return r(a,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.makeSnapshotForConfId(e);case 3:t.next=7;break;case 5:t.prev=5,t.t0=t.catch(0);case 7:case"end":return t.stop()}}),t,this,[[0,5]])})))})));case 6:this.logger.info("makeSnapshots -- SUCCESS"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.logger.info("makeSnapshots -- ERROR");case 12:case"end":return e.stop()}}),e,this,[[0,9]])})))}},{key:"makeSnapshotForConfId",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}throw n=new Error("makeSnapshotForConfId - No confId !!"),this.logger.error(n.message),n;case 3:if(t.prev=3,!((r=this.conferenceSessions[e])&&r.active&&r.haveJoined)){t.next=7;break}return t.abrupt("return",(this.logger.debug("makeSnapshotForConfId skipped, already joined"),r));case 7:return i=new URL("conferences/".concat(e,"/snapshot"),this.confPortalURL),a=this.authService.getRequestHeader(),t.next=11,fetch(i.href,{method:"GET",headers:a});case 11:if((o=t.sent).ok){t.next=14;break}throw this.logger.debug("Request ".concat(o.headers.get("x-rainbow-request-id")," failed with status ").concat(o.status)),o;case 14:return t.next=16,o.json();case 16:return s=t.sent.data,t.abrupt("return",(this.updateOrCreateConferenceSession(e,s),s));case 20:return t.prev=20,t.t0=t.catch(3),this.conferenceSessions[e]&&(this.logger.debug("makeSnapshotForConfId failed - remove conferenceSession "+e),this.removeConferenceSession(e)),t.next=25,k.default.getErrorInfo(t.t0,"makeSnapshotForConfId");case 25:throw c=t.sent,this.logger.error("[pgiConferenceService] "+c.message),c.error;case 27:case"end":return t.stop()}}),t,this,[[3,20]])})))}},{key:"removeConferenceSession",value:function(e){e&&(this.logger.debug("removeConferenceSession "+e),delete this.conferenceSessions[e],this.conferenceSessionsSubject.next({id:e,action:"deleted"}))}},{key:"updateOrCreateConferenceSession",value:function(e,t){if(this.logger.debug("updateOrCreateConferenceSession for "+e),!e||!t)return this.logger.warn("updateOrCreateConferenceSession - Not enough data"),null;var n=this.conferenceSessions[e];return n?(t.active!==n.active&&(this.logger.debug("updateOrCreateConferenceSession - state update to "+(t.active?"active":"inactive")),n.active=t.active,this.conferenceSessionsSubject.next({id:e,action:"updated"})),t.participants&&(this.logger.debug("updateOrCreateConferenceSession - update participants for ".concat(e," with:\n").concat(JSON.stringify(t.participants))),n.participants=t.participants.map((function(e){return l.ConferenceParticipant.createFromData(e)})),this.conferenceSessionsSubject.next({id:e,action:"updated"}))):(this.logger.debug("updateOrCreateConferenceSession - create new conferencesession with id ".concat(e," and data: \n").concat(JSON.stringify(t))),n=c.ConferenceSession.createFromData(e,t.participants,t.active,i.PSTNAUDIO),this.conferenceSessions[e]=n,this.conferenceSessionsSubject.next({id:e,action:"created"})),n}},{key:"updateConference",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this.logger.info("updateConference"),e){n.next=4;break}throw"updateConference failure: No confEndpoint",this.logger.error("updateConference failure : No confEndpoint"),new Error("updateConference failure: No confEndpoint");case 4:return r=new URL("conferences/"+e,this.confProvPortalURL),(i=this.authService.getRequestHeader())["Content-Type"]="application/json",n.next=8,fetch(r.href,{method:"PUT",headers:i,body:JSON.stringify(t)});case 8:if((a=n.sent).ok){n.next=11;break}throw this.logger.debug("Request ".concat(a.headers.get("x-rainbow-request-id")," failed with status ").concat(a.status)),a;case 11:return n.next=13,a.json();case 13:return o=n.sent.data,s=this.updateOrCreatePstnConferenceEndpoint(o),n.abrupt("return",(this.logger.info("updateConference SUCCESS"),s));case 18:throw n.prev=18,n.t0=n.catch(0),this.logger.error("updateConference ERROR"),n.t0;case 21:case"end":return n.stop()}}),n,this,[[0,18]])})))}},{key:"getPstnInstantConferenceEndpoint",value:function(){return this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]]}},{key:"getPstnInstantConferenceEndpointId",value:function(){return this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]]?this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]].id:null}},{key:"retrievePstnConferences",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,a,o,s,c,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.logger.info("retrievePstnConferences"),this.isPstnConferenceAvailable){e.next=3;break}throw this.logger.warn("retrievePstnConferences - user is not allowed"),new Error("notAllowed");case 3:return(t=new URL("conferences",this.confProvPortalURL)).searchParams.set("format","full"),t.searchParams.set("userId",this.contactService.userContact.dbId),t.searchParams.set("scheduled","false"),t.searchParams.set("mediaType",i.PSTNAUDIO),n=this.authService.getRequestHeader(),e.next=8,fetch(t.href,{method:"GET",headers:n});case 8:if((r=e.sent).ok){e.next=11;break}throw this.logger.debug("Request ".concat(r.headers.get("x-rainbow-request-id")," failed with status ").concat(r.status)),r;case 11:return e.next=13,r.json();case 13:a=e.sent.data,o=g(a);try{for(o.s();!(s=o.n()).done;)(c=s.value)&&c.mediaType===i.PSTNAUDIO&&this.updateOrCreatePstnConferenceEndpoint(c)}catch(u){o.e(u)}finally{o.f()}return e.abrupt("return",(this.logger.info("retrievePstnConferences successfully"),a));case 19:return e.prev=19,e.t0=e.catch(0),e.next=23,k.default.getErrorInfo(e.t0,"retrievePstnConferences");case 23:throw l=e.sent,this.logger.error("[pgiConferenceService] "+l.message),l.error;case 25:case"end":return e.stop()}}),e,this,[[0,19]])})))}},{key:"retrieveConference",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}throw r=new Error("retrieveConference - missing parameter"),this.logger.error(r.message),r;case 3:if(n.prev=3,this.logger.info("retrieveConference - "+e),!this.conferenceEndpoints[e]||t){n.next=6;break}return n.abrupt("return",this.conferenceEndpoints[e]);case 6:return i=new URL("conferences/"+e,this.confProvPortalURL),a=this.authService.getRequestHeader(),n.next=10,fetch(i.href,{method:"GET",headers:a});case 10:if((o=n.sent).ok){n.next=13;break}throw this.logger.debug("Request ".concat(o.headers.get("x-rainbow-request-id")," failed with status ").concat(o.status)),o;case 13:return n.next=15,o.json();case 15:return s=n.sent.data,n.abrupt("return",s&&Object.prototype.hasOwnProperty.call(s,"id")?this.updateOrCreatePstnConferenceEndpoint(s):s);case 19:return n.prev=19,n.t0=n.catch(3),n.next=23,k.default.getErrorInfo(n.t0,"retrieveConference");case 23:throw c=n.sent,this.logger.error("[pgiConferenceService] "+c.message),c.error;case 25:case"end":return n.stop()}}),n,this,[[3,19]])})))}},{key:"updateOrCreatePstnConferenceEndpoint",value:function(e){if(this.logger.info("updateOrCreatePstnConferenceEndpoint for "+e.id),!e)return this.logger.error("updateOrCreatePstnConferenceEndpoint - no conference data !"),null;if(e.mediaType!==i.PSTNAUDIO)return this.logger.warn("updateOrCreatePstnConferenceEndpoint - wrong mediaType: "+e.mediaType),null;if(this.conferenceEndpoints[e.id])this.conferenceEndpoints[e.id].updateFromData(e),this.conferenceEnpointsSubject.next({id:e.id,action:"updated"});else{var t=s.ConferenceEndpoint.createFromData(e);this.conferenceEndpoints[e.id]=t,this.conferenceEnpointsSubject.next({id:e.id,action:"created"})}return this.conferenceEndpoints[e.id]}},{key:"getConferenceSessionWithConnId",value:function(e){for(var t in this.logger.debug("getConferenceSessionWithConnId with connId "+e),this.conferenceSessions)if(this.conferenceSessions[t]){var n=this.conferenceSessions[t];if(n&&n.callId===e)return this.logger.debug("getConferenceSessionWithConnId with connId ".concat(e,": - conferenceSessionId: ").concat(t)),n}return null}},{key:"getConferenceSessionById",value:function(e){return this.conferenceSessions[e]}},{key:"subscribeToPstnSession",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,a,o,s,c,l;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.info("subscribeToPstnSession( confId=".concat(e,")")),e){t.next=3;break}throw n=new Error("subscribeToPstnSession - missing parameter"),this.logger.error(n.message),n;case 3:return t.prev=3,r=new URL("conferences/".concat(e,"/join"),this.confPortalURL),(a=this.authService.getRequestHeader())["Content-Type"]="application/json",o={participantPhoneNumber:"joinWithoutAudio",participant:{role:"member",type:"unmuted"},mediaType:i.PSTNAUDIO},t.next=9,fetch(r.href,{method:"POST",headers:a,body:JSON.stringify(o)});case 9:if((s=t.sent).ok){t.next=12;break}throw this.logger.debug("Request ".concat(s.headers.get("x-rainbow-request-id")," failed with status ").concat(s.status)),s;case 12:return t.next=14,s.json();case 14:return c=t.sent.status,t.abrupt("return",(this.logger.info("subscribeToPstnSession( confId=".concat(e,") success : ").concat(c)),e));case 18:return t.prev=18,t.t0=t.catch(3),t.next=22,k.default.getErrorInfo(t.t0,"subscribeToPstnSession");case 22:throw l=t.sent,this.logger.error("[pgiConferenceService] "+l.message),l.error;case 24:case"end":return t.stop()}}),t,this,[[3,18]])})))}},{key:"unSubscribeParticipantFromPstnSession",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a,o,s,c,l,u;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.logger.info("unSubscribeParticipantFromPstnSession( confId=".concat(e," - participantId=").concat(t,")")),e&&t){n.next=3;break}throw r=new Error("unSubscribeParticipantFromPstnSession - missing parameter"),this.logger.error(r.message),r;case 3:return n.prev=3,(a=new URL("conferences/".concat(e,"/participants/").concat(t),this.confPortalURL)).searchParams.set("mediaType",i.PSTNAUDIO),(o=this.authService.getRequestHeader())["Content-Type"]="application/json",s={participantPhoneNumber:"joinWithoutAudio",participant:{role:"member",type:"unmuted"},mediaType:i.PSTNAUDIO},n.next=11,fetch(a.href,{method:"DELETE",headers:o,body:JSON.stringify(s)});case 11:if((c=n.sent).ok){n.next=14;break}throw this.logger.debug("Request ".concat(c.headers.get("x-rainbow-request-id")," failed with status ").concat(c.status)),c;case 14:return n.next=16,c.json();case 16:l=n.sent.status,this.logger.info("unSubscribeParticipantFromPstnSession( confId=".concat(e," ) success : ").concat(l)),n.next=26;break;case 20:return n.prev=20,n.t0=n.catch(3),n.next=24,k.default.getErrorInfo(n.t0,"unSubscribeParticipantFromPstnSession");case 24:throw u=n.sent,this.logger.error("[pgiConferenceService] "+u.message),u.error;case 26:case"end":return n.stop()}}),n,this,[[3,20]])})))}},{key:"startPstnConference",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.info("startPstnConference( confId=".concat(e," )")),e){t.next=3;break}throw n=new Error("startPstnConference - missing parameter"),this.logger.error(n.message),n;case 3:if(!this.conferenceSessions[e]||!this.conferenceSessions[e].active){t.next=7;break}this.logger.info("startPstnConference : conference already started"),t.next=27;break;case 7:return t.prev=7,r=new URL("conferences/".concat(e,"/start"),this.confPortalURL),i=this.authService.getRequestHeader(),t.next=12,fetch(r.href,{method:"PUT",headers:i});case 12:if((a=t.sent).ok){t.next=15;break}throw this.logger.debug("Request ".concat(a.headers.get("x-rainbow-request-id")," failed with status ").concat(a.status)),a;case 15:return t.next=17,a.json();case 17:o=t.sent.status,this.logger.info("startPstnConference( confId=".concat(e," ) success : ").concat(o)),t.next=27;break;case 21:return t.prev=21,t.t0=t.catch(7),t.next=25,k.default.getErrorInfo(t.t0,"startPstnConference");case 25:throw s=t.sent,this.logger.error("[pgiConferenceService] "+s.message),s.error;case 27:case"end":return t.stop()}}),t,this,[[7,21]])})))}},{key:"stopPstnConference",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,a,o,s,c,l,u,d;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.info("stopPstnConference( confId=".concat(e," )")),e){t.next=3;break}throw n=new Error("stopPstnConference - missing parameter"),this.logger.error(n.message),n;case 3:if(!this.conferenceSessions[e]||!this.conferenceSessions[e].active){t.next=29;break}return t.prev=4,r=new URL("conferences/".concat(e,"/stop"),this.confPortalURL),(a=this.authService.getRequestHeader())["Content-Type"]="application/json",o={mediaType:i.PSTNAUDIO},t.next=10,fetch(r.href,{method:"PUT",headers:a,body:JSON.stringify(o)});case 10:return s=t.sent,t.next=13,s.json();case 13:if(c=t.sent,s.ok){t.next=17;break}throw this.logger.debug("Request ".concat(s.headers.get("x-rainbow-request-id")," failed with status ").concat(s.status)),404===s.status&&404e3===c.errorDetailsCode&&(l=this.getConferenceSessionById(e))&&(l.active=!1,l.participants=[],this.removeConferenceSession(e)),s;case 17:u=c.status,this.logger.info("stopPstnConference( confId=".concat(e," ) success : ").concat(u)),t.next=27;break;case 21:return t.prev=21,t.t0=t.catch(4),t.next=25,k.default.getErrorInfo(t.t0,"stopPstnConference");case 25:throw d=t.sent,this.logger.error("[pgiConferenceService] "+d.message),d.error;case 27:t.next=30;break;case 29:this.logger.info("stopPstnConference : no conference to stop");case 30:case"end":return t.stop()}}),t,this,[[4,21]])})))}},{key:"joinPstnConference",value:function(e,t,n,a){return r(this,void 0,void 0,b.a.mark((function r(){var o,s,c,l,u,d,h;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&t&&n){r.next=3;break}throw o=new Error("joinPstnConference - missing parameter"),this.logger.error(o.message),o;case 3:return this.logger.info("joinPstnConference( confId=".concat(e,", PhoneNumber=").concat(t,", role=").concat(n.role,", country=").concat(a," )")),r.prev=4,s=new URL("conferences/".concat(e,"/join"),this.confPortalURL),(c=this.authService.getRequestHeader())["Content-Type"]="application/json",l={participantPhoneNumber:t,participant:n,country:a,mediaType:i.PSTNAUDIO},r.next=10,fetch(s.href,{method:"POST",headers:c,body:JSON.stringify(l)});case 10:if((u=r.sent).ok){r.next=13;break}throw this.logger.debug("Request ".concat(u.headers.get("x-rainbow-request-id")," failed with status ").concat(u.status)),u;case 13:return this.conferenceSessions[e].joinInProgress=!0,r.next=16,u.json();case 16:return d=r.sent.status,r.abrupt("return",(this.logger.info("joinPstnConference( confId=".concat(e," ) success - ").concat(d)),e));case 20:return r.prev=20,r.t0=r.catch(4),r.next=24,k.default.getErrorInfo(r.t0,"joinPstnConference");case 24:throw h=r.sent,this.logger.error("[pgiConferenceService] "+h.message),h.error;case 26:case"end":return r.stop()}}),r,this,[[4,20]])})))}},{key:"disconnectParticipant",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e&&t){n.next=3;break}throw r=new Error("disconnectParticipant - missing parameter"),this.logger.error(r.message),r;case 3:return this.logger.info("disconnectParticipant( confId=".concat(e,", participantId=").concat(t," )")),n.prev=4,(a=new URL("conferences/".concat(e,"/participants/").concat(t),this.confPortalURL)).searchParams.set("mediaType",i.PSTNAUDIO),o=this.authService.getRequestHeader(),n.next=10,fetch(a.href,{method:"DELETE",headers:o});case 10:if((s=n.sent).ok){n.next=13;break}throw this.logger.debug("Request ".concat(s.headers.get("x-rainbow-request-id")," failed with status ").concat(s.status)),s;case 13:this.logger.info("disconnectParticipant success"),n.next=22;break;case 16:return n.prev=16,n.t0=n.catch(4),n.next=20,k.default.getErrorInfo(n.t0,"disconnectParticipant");case 20:throw c=n.sent,this.logger.error("[pgiConferenceService] "+c.message),c.error;case 22:case"end":return n.stop()}}),n,this,[[4,16]])})))}},{key:"retrievePstnPhoneNumbers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.info("retrievePstnPhoneNumbers : "+e),!this.pstnConferencePhoneNumbers){t.next=2;break}return t.abrupt("return",e?this.formatPstnPhoneNumbers(this.pstnConferencePhoneNumbers):this.pstnConferencePhoneNumbers);case 2:return t.prev=2,(n=new URL("conferences/audio/phonenumbers",this.confProvPortalURL)).searchParams.set("shortList","false"),r=this.authService.getRequestHeader(),t.next=8,fetch(n.href,{method:"GET",headers:r});case 8:if((i=t.sent).ok){t.next=11;break}throw this.logger.debug("Request ".concat(i.headers.get("x-rainbow-request-id")," failed with status ").concat(i.status)),i;case 11:return t.next=13,i.json();case 13:return a=t.sent,t.abrupt("return",(this.logger.info("retrievePstnPhoneNumbers success"),this.pstnConferencePhoneNumbers=a.data.phoneNumberList,e?this.formatPstnPhoneNumbers(this.pstnConferencePhoneNumbers):this.pstnConferencePhoneNumbers));case 17:return t.prev=17,t.t0=t.catch(2),t.next=21,k.default.getErrorInfo(t.t0,"retrievePstnPhoneNumbers");case 21:throw o=t.sent,this.logger.error("[pgiConferenceService] "+o.message),o.error;case 23:case"end":return t.stop()}}),t,this,[[2,17]])})))}},{key:"resetPersonalMeetingRoom",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("resetPersonalMeetingRoom"),e.prev=1,t=new URL("meetings/reset",this.confProvPortalURL),(n=this.authService.getRequestHeader())["Content-Type"]="application/json",e.next=6,fetch(t.href,{method:"PUT",headers:n});case 6:if((r=e.sent).ok){e.next=9;break}throw this.logger.debug("Request ".concat(r.headers.get("x-rainbow-request-id")," failed with status ").concat(r.status)),r;case 9:e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(1),e.next=15,k.default.getErrorInfo(e.t0,"resetPersonalMeetingRoom");case 15:throw i=e.sent,this.logger.error("[pgiConferenceService] "+i.message),i.error;case 17:case"end":return e.stop()}}),e,this,[[1,11]])})))}},{key:"formatPstnPhoneNumbers",value:function(e){var t=this,n={};return e.forEach((function(e){if(e.locationcode){var r=t.countryService.getAlpha2Code(e.locationcode.substr(0,3));r&&(n[r]||(n[r]={numbersList:[]})),n[r].numbersList.push({number:e.number,locationName:e.location,city:e.location.split(", ")[1],numberType:e.numberType,needLanguageSelection:e.needLanguageSelection})}})),n}},{key:"refreshConferenceSessions",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("refreshConferenceSessions"),e.prev=1,e.t0=b.a.keys(this.conferenceSessions);case 3:if((e.t1=e.t0()).done){e.next=11;break}if(t=e.t1.value,e.t2=Object.prototype.hasOwnProperty.call(this.conferenceSessions,t),!e.t2){e.next=9;break}return e.next=9,this.makeSnapshotForConfId(t);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t3=e.catch(1),this.logger.error("refreshConferenceSessions -- ERROR");case 16:case"end":return e.stop()}}),e,this,[[1,13]])})))}},{key:"subscribeToMyConferenceSessions",value:function(e){this.conferenceSessions[this.getPstnInstantConferenceEndpointId()]&&this.conferenceSessions[this.getPstnInstantConferenceEndpointId()].activeSubject.pipe(o.distinctUntilChanged()).subscribe(e)}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];S(this,e),this.id=t,this.userId=n,this.mediaType=r,this.scheduled=i,this.confDialOutDisabled=a,this.passCodes=o,this.playEntryTone=s,this.muteUponEntry=c}return C(e,[{key:"updateFromData",value:function(e){this.id=e.id,this.userId=e.userId,this.mediaType=e.mediaType,this.scheduled=e.scheduled,this.confDialOutDisabled=e.confDialOutDisabled,this.passCodes=e.passCodes,this.playEntryTone=e.playEntryTone,this.muteUponEntry=e.muteUponEntry}}],[{key:"createFromData",value:function(t){return new e(t.id,t.userId,t.mediaType,t.scheduled,t.confDialOutDisabled,t.passCodes,t.playEntryTone,t.muteUponEntry)}}]),e}();t.ConferenceEndpoint=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(228),i=n(66),a=function(){function e(t,n,r,a){S(this,e),this.conferenceStats=null,this.talkers=[],this.talkerSubject=new i.BehaviorSubject(this.talkers),this._haveJoined=!1,this.haveJoinedSubject=new i.BehaviorSubject(this._haveJoined),this._joinInProgress=!1,this.joinInProgressSubject=new i.BehaviorSubject(this._haveJoined),this._active=!1,this.activeSubject=new i.BehaviorSubject(this._active),this._callId="",this.callIdSubject=new i.BehaviorSubject(this._callId),this._participants=[],this.participantsSubject=new i.BehaviorSubject(this._participants),this._lock=!1,this.lockSubject=new i.BehaviorSubject(this._lock),this.id=t,this.participants=n,this.active=r,this.type=a}return C(e,[{key:"haveJoined",get:function(){return this._haveJoined},set:function(e){this._haveJoined=e,this.haveJoinedSubject.next(this._haveJoined)}},{key:"joinInProgress",get:function(){return this._joinInProgress},set:function(e){this._joinInProgress=e,this.joinInProgressSubject.next(this._joinInProgress)}},{key:"active",get:function(){return this._active},set:function(e){this._active=e,this.activeSubject.next(this._active)}},{key:"callId",get:function(){return this._callId},set:function(e){this._callId=e,this.callIdSubject.next(this._callId)}},{key:"participants",get:function(){return this._participants},set:function(e){if(e.length){var t,n=g(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!i.participantId)return;var a=this.getParticipantById(i.participantId)?this.getParticipantById(i.participantId):this.getParticipantByJid(i.jid_im);a?a.updateFromData(i):this._participants.push(r.ConferenceParticipant.createFromData(i))}}catch(o){n.e(o)}finally{n.f()}}else this._participants=[];this.participantsSubject.next(this._participants)}},{key:"lock",get:function(){return this._lock},set:function(e){this._lock=e,this.lockSubject.next(this._lock)}},{key:"cleanupSessionData",value:function(){this.participants=[],this.talkers=[],this.haveJoined=!1}},{key:"updateFromData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.participants=e,this.active=t}},{key:"updateStateFromData",value:function(e,t){this.active=e,this.lock=t}},{key:"removeParticipants",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=g(t);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.getParticipantIndexById(r);-1!==i&&this._participants.splice(i,1)}}catch(a){n.e(a)}finally{n.f()}this.participantsSubject.next(this._participants)}},{key:"updateTalkers",value:function(e){this.talkers=e,this.talkerSubject.next(this.talkers)}},{key:"getParticipants",value:function(){return this.participants}},{key:"getConnectedParticipants",value:function(){return this.participants?this.participants.filter((function(e){return"disconnected"!==e.participantState&&"watching"!==e.participantState})):void 0}},{key:"getWatchingParticipants",value:function(){return this.participants?this.participants.filter((function(e){return"watching"===e.participantState})):void 0}},{key:"getConnectedParticipantsExceptLeader",value:function(){return this.participants?this.participants.filter((function(e){return"disconnected"!==e.participantState&&"watching"!==e.participantState&&"moderator"!==e.participantRole})):void 0}},{key:"getConnectedLeaderParticipantsExcept",value:function(e){return this.participants?this.participants.filter((function(t){return"disconnected"!==t.participantState&&"moderator"===t.participantRole&&t.jid_im!==e})):void 0}},{key:"getConnectedParticipantsExcept",value:function(e){return this.participants?this.participants.filter((function(t){return t.jid_im!==e&&"disconnected"!==t.participantState&&"watching"!==t.participantState})):void 0}},{key:"getLeaderParticipant",value:function(){return this.participants?this.participants.find((function(e){return"moderator"===e.participantRole&&"disconnected"!==e.participantState&&"watching"!==e.participantState})):void 0}},{key:"getLeaderParticipantById",value:function(e){return this.participants?this.participants.find((function(t){return"moderator"===t.participantRole&&"disconnected"!==t.participantState&&"watching"!==t.participantState&&t.jid_im===e})):void 0}},{key:"getParticipantById",value:function(e){return this.participants?this.participants.find((function(t){return t.participantId===e})):void 0}},{key:"getParticipantByJid",value:function(e){return this.participants?this.participants.find((function(t){return t.jid_im===e})):void 0}},{key:"getNonDisconnectedParticipantByJid",value:function(e){return this.participants?this.participants.find((function(t){return t.jid_im===e&&"disconnected"!==t.participantState})):void 0}},{key:"getConnectedParticipantByJid",value:function(e){return this.participants?this.participants.find((function(t){return t.jid_im===e&&"connected"===t.participantState})):void 0}},{key:"getWatchingParticipantByJid",value:function(e){return this.participants?this.participants.find((function(t){return t.jid_im===e&&"watching"===t.participantState})):void 0}},{key:"getParticipantIndexById",value:function(e){return this.participants?this.participants.findIndex((function(t){return t.participantId===e})):-1}},{key:"isParticipantConnectedByJid",value:function(e){return void 0!==this.participants&&this.participants.some((function(t){return t.jid_im===e&&"connected"===t.participantState}))}},{key:"isParticipantWatchingByJid",value:function(e){return void 0!==this.participants&&this.participants.some((function(t){return t.jid_im===e&&"watching"===t.participantState}))}},{key:"isParticipantRingingByJid",value:function(e){return void 0!==this.participants&&this.participants.some((function(t){return t.jid_im===e&&"ringing"===t.participantState}))}},{key:"isParticipantConnectedWithThisUAByJid",value:function(e){return this.haveJoined&&void 0!==this.participants&&this.participants.some((function(t){return t.jid_im===e&&"connected"===t.participantState}))}},{key:"getTalkers",value:function(){return this.talkers}},{key:"getParticipantStatus",value:function(e){if(this.participants&&this.participants.length){var t=this.participants.find((function(t){return t.jid_im===e}));if(t)return t.participantState}return"none"}}],[{key:"createFromData",value:function(t,n,i,a){return new e(t,n.map((function(e){return r.ConferenceParticipant.createFromData(e)})),i,a)}}]),e}();t.ConferenceSession=a},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(67),o=n(336),s=n(45),c=n(343),l=n(70),u=n(81),d=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return i(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new h(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,a=r.length;if(this.closed)throw new l.ObjectUnsubscribedError;if(this.isStopped||this.hasError?t=s.Subscription.EMPTY:(this.observers.push(e),t=new u.SubjectSubscription(this,e)),i&&e.add(e=new c.ObserveOnSubscriber(e,i)),n)for(var o=0;o<a&&!e.closed;o++)e.next(r[o]);else for(o=0;o<a&&!e.closed;o++)e.next(r[o].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||o.queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,a=0;a<i&&!(e-r[a].time<n);)a++;return i>t&&(a=Math.max(a,i-t)),a>0&&r.splice(0,a),r},t}(a.Subject);t.ReplaySubject=d;var h=function(e,t){this.time=e,this.value=t}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(337),i=n(340);t.queueScheduler=new i.QueueScheduler(r.QueueAction),t.queue=t.queueScheduler},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return i(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(n(338).AsyncAction);t.QueueAction=a},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return i(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(n(339).Action);t.AsyncAction=a},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n){return e.call(this)||this}return i(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(45).Subscription);t.Action=a},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n(341).AsyncScheduler);t.QueueScheduler=a},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(342),o=function(e){function t(n,r){void 0===r&&(r=a.Scheduler.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return i(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(a.Scheduler);t.AsyncScheduler=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}();t.Scheduler=r},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(56),o=n(344);t.observeOn=function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new s(e,t))}};var s=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.scheduler,this.delay))},e}();t.ObserveOnOperator=s;var c=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return i(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new l(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(o.Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(o.Notification.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(o.Notification.createComplete()),this.unsubscribe()},t}(a.Subscriber);t.ObserveOnSubscriber=c;var l=function(e,t){this.notification=e,this.destination=t};t.ObserveOnMessage=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(345),a=n(346),o=n(350);(r=t.NotificationKind||(t.NotificationKind={})).NEXT="N",r.ERROR="E",r.COMPLETE="C";var s=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return a.of(this.value);case"E":return o.throwError(this.error);case"C":return i.empty()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();t.Notification=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(55);t.EMPTY=new r.Observable((function(e){return e.complete()})),t.empty=function(e){return e?function(e){return new r.Observable((function(t){return e.schedule((function(){return t.complete()}))}))}(e):t.EMPTY}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(347),i=n(348),a=n(229);t.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return r.isScheduler(n)?(e.pop(),a.scheduleArray(e,n)):i.fromArray(e)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isScheduler=function(e){return e&&"function"==typeof e.schedule}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(55),i=n(349),a=n(229);t.fromArray=function(e,t){return t?a.scheduleArray(e,t):new r.Observable(i.subscribeToArray(e))}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeToArray=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(55);function i(e){var t=e.error;e.subscriber.error(t)}t.throwError=function(e,t){return t?new r.Observable((function(n){return t.schedule(i,0,{error:e,subscriber:n})})):new r.Observable((function(t){return t.error(e)}))}},function(e,t,n){n.r(t);var r=n(16),i=n(4),a=n.n(i),o=n(1),s=n.n(o),l=n(25),u=n.n(l);angular.module("rainbow").factory("ConversationServiceHistoryHandler",["$log","$q","$filter","$rootScope","fileServerService","SearchTextMsgResultFactory",function(e,t,n,i,o,l){function d(e){this.conversationService=e}return d.create=function(e){return new d(e)},d.prototype.getHistoryPage=function(e,t){var n=this,r=e.room;return r&&r.initPresPromise?r.initPresPromise.promise.then((function(){return n.getHistoryPageInternal(e,t)})):this.getHistoryPageInternal(e,t)},d.prototype.getHistoryPageInternal=function(n,r){if(n.currentHistoryId&&n.currentHistoryId===n.historyIndex)return e.info("[ConversationServiceHistoryHandler] getHistoryPage("+n.id+", "+r+", "+n.historyIndex+") already asked"),t.reject();n.currentHistoryId=n.historyIndex,e.info("[ConversationServiceHistoryHandler] getHistoryPage("+n.id+", "+r+", "+n.historyIndex+")");var i=n.historyDefered=t.defer();if(s.a.isUserContact(n.contact))return i.reject(),i.promise;if(n.historyComplete)return e.info("[ConversationServiceHistoryHandler] getHistoryPage("+n.id+") : already complete"),i.reject(),i.promise;var o={queryid:n.id,with:n.id,max:r,before:""};return-1!==n.historyIndex&&(o.before=n.historyIndex),n.room?(o={queryid:n.id,with:s.a.userContact.jid,max:r,before:""},-1!==n.historyIndex&&(o.before=n.historyIndex),a.a.connection.mam.querymuc(n.id,n.room.jid,o)):a.a.connection.mam.query(n.id,o),i.promise},d.prototype.retrieveMsgByDate=function(n,r){var i=n.historyDefered=t.defer();if(s.a.isUserContact(n.contact))return i.reject(),i.promise;var a="cache_"+n.id;return d.prototype.getCommonHistoryPageAroundMsg(a,n,1,r,"after",(function(){e.info("[ConversationServiceHistoryHandler] retrieveMsgByDate finished")})),d.prototype.getCommonHistoryPageAroundMsg(a,n,1,r,"before",(function(){e.info("[ConversationServiceHistoryHandler] retrieveMsgByDate finished")})),i.promise},d.prototype.getCommonHistoryPageAroundMsg=function(t,n,r,i,o,c){if(e.info("[ConversationServiceHistoryHandler] getCommonHistoryPageAroundMsg("+t+", "+r+", "+n.historyIndex+")"),n.room){var l={queryid:t,with:s.a.userContact.jid,max:r,onComplete:c};l[o]=i,a.a.connection.mam.querymuc(t,n.room.jid,l)}else{var u={queryid:t,with:n.id,max:r,onComplete:c};u[o]=i,a.a.connection.mam.query(t,u)}},d.prototype.searchTextInConversations=function(n,r){e.info("[ConversationServiceHistoryHandler] searchTextInConversations("+r+")");var i=t.defer(),o=a.a.connection.getUniqueId(),s=$iq({id:o,type:"get"}).c("query",{queryid:n,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(100).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(r).up().up();return a.a.sendIQ(s).then((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Success: "+r);var n=$(t).find("query").find("set").find("count").text();e.info("[ConversationServiceHistoryHandler] >searchTextInConversations: count= "+n),i.resolve(parseInt(n,10))})).catch((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Failure: "+t.message),i.reject(t)})),i.promise},d.prototype.getConversationTextCount=function(n,r,i){e.info("[ConversationServiceHistoryHandler] getConversationTextCount("+r+")");var o=t.defer(),s=a.a.connection.getUniqueId(),c=$iq({id:s,type:"get"}).c("query",{queryid:n,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t("0").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(r).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(i).up().up();return a.a.sendIQ(c).then((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Success: "+r);var n=$(t).find("query").find("set").find("count").text();e.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+n),o.resolve(parseInt(n,10))})).catch((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Failure: "+t.message),o.reject(t)})),o.promise},d.prototype.searchTextResultsInConversation=function(n,r,i){e.info("[ConversationServiceHistoryHandler] searchTextResultsInConversation("+r+")");var o=t.defer(),s=a.a.connection.getUniqueId(),c=$iq({id:s,type:"get"}).c("query",{queryid:n,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(100).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(r).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(i).up().up();return a.a.sendIQ(c).then((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Success: "+r);var n=$(t).find("query").find("set").find("count").text();e.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+n),o.resolve(parseInt(n,10))})).catch((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Failure: "+t.message),o.reject(t)})),o.promise},d.prototype.searchTextMoreResultsInConversation=function(n,r,i,o){e.info("[ConversationServiceHistoryHandler] searchTextMoreResultsInConversation("+r+")");var s=t.defer(),c=a.a.connection.getUniqueId(),l=$iq({id:c,type:"get"}).c("query",{queryid:n,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(100).up().c("before").t(o).up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(r).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(i).up().up();return a.a.sendIQ(l).then((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Success: "+r);var n=$(t).find("query").find("set").find("count").text();e.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+n),s.resolve(parseInt(n,10))})).catch((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Failure: "+t.message),s.reject(t)})),s.promise},d.prototype.searchTextResultsInRoom=function(n,r,i){e.info("[ConversationServiceHistoryHandler] searchTextInRoom("+r+")");var o=t.defer(),c=s.a.userContact.jid,l=a.a.connection.getUniqueId(),u=$iq({to:i,id:l,type:"get"}).c("query",{queryid:n,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(100).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"with",type:"text-single"}).c("value").t(c).up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(r).up().up();return a.a.sendIQ(u).then((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Success: "+r);var n=$(t).find("query").find("set").find("count").text();e.info("[ConversationServiceHistoryHandler] >searchTextInRoom: count= "+n),o.resolve(parseInt(n,10))})).catch((function(t){e.info("[ConversationServiceHistoryHandler] >searchTextInRoom: Failure: "+t.message),o.reject(t)})),o.promise},d.prototype.searchTextMoreResultsInRoom=function(n,r,i,o,s,c){e.info("[ConversationServiceHistoryHandler] searchTextMoreResultsInConversation("+r+")");var l=t.defer(),u=a.a.connection.getUniqueId(),d=$iq({to:o,id:u,type:"get"}).c("query",{queryid:n,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(c).up().c("before").t(s).up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(r).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(i).up().up();return a.a.sendIQ(d).then((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Success: "+r);var n=$(t).find("query").find("set").find("count").text();e.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+n),l.resolve(n)})).catch((function(t){e.info("[ConversationServiceHistoryHandler] sendIq Failure: "+t.message),l.reject(t)})),l.promise},d.prototype.onHistoryMessageReceived=function(t){e.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived: "+t);try{var l=null,d=$(t),h=d.find("result").attr("queryid");if(h){if(l=this.conversationService.getConversationById(h)){if(d.find("call_log").length)return this.onWebrtcHistoryMessageReceived(t,l);var f,p=d.find("forwarded message").attr("from"),m=!1;if(!(f=p&&0===p.indexOf("room_")?p.split("/")[1]:a.a.getBareJidFromJid(d.find("forwarded message").attr("from")))&&d.find("event").length&&(m=d.find("event").attr("name"),f=d.find("event").attr("jid"),"welcome"===m&&l.room&&l.room.ownerContact&&(f=l.room.ownerContact.jid)),!f)return e.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived - Receive message without valid fromJid information"),!0;var v=s.a.getContactByJid(f),g=d.find("forwarded message").attr("type"),y=d.find("forwarded message").attr("id"),b=new Date(d.find("forwarded delay").attr("stamp")),S=d.find("forwarded message body").text(),_=d.find("forwarded message ack"),C=d.find("forwarded message x[xmlns='jabber:x:oob']"),w=d.find("forwarded message x[xmlns='jabber:x:bubble:conference:pstn']"),E=d.find("content[xmlns='urn:xmpp:content']"),T=d.find("replace"),k=d.find("answeredMsg"),M=d.find("content"),D=s.a.isUserContact(v)?r.Message.Side.RIGHT:r.Message.Side.LEFT,x=d.find("voicemessage"),R=!1;if(x&&x.length&&(R=!0),v||(e.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived missing contact for jid : "+f+", ignore message"),v=s.a.createEmptyContact(f)),m){if(e.info("[ConversationServiceHistoryHandler] ("+l.id+") add Room admin event message "+m),g="admin",l.room&&l.room.isMeetingRoom()&&("welcome"===m||"conferenceAdd"===m||"conferenceRemove"===m||"invitation"===m))return!0;if(("conferenceAdd"===m||"conferenceRemove"===m)&&l.room&&l.room.ownerContact){var O=d.find("event").attr("jid"),I=l.room.getUserByJid(O);v=I&&I.contact?I.contact:l.room.ownerContact}}var P=l.getMessageById(y);if(P||(P=l.historyMessages.find((function(e){return e.id===y}))),P)e.info("[ConversationServiceHistoryHandler] ("+l.id+") try to add an already stored message with id "+P.id);else{switch(g){case"file":P=r.Message.createFileMessage(y,b,v,D,S,!1);break;case"webrtc":P=r.Message.createWebRTCMessage(y,b,v,D,S,!1);break;case"admin":P=r.Message.createBubbleAdminMessage(y,b,v,m);break;case"recording":P=r.Message.createRecordingAdminMessage(y,b,v,"Admin");break;default:if(C&&C.length){var A=$(C),L=A.find("url").text(),N=A.find("filename").text(),j=u.a.extractFileIdFromUrl(L);P=R?r.Message.createVoiceMessage(y,b,v,D,S,!1,j,N,R):r.Message.createFileSharingMessage(y,b,v,D,S,!1,j,N,null,geolocData),u.a.retrieveAndStoreOneFileDescriptor(j).then((function(e){e&&"not_uploaded"===e.state&&(P.receiptStatus=1,P.fileErrorMsg=n("translate")("file_notuploaded")),o.getBlobThumbnailFromFileDescriptor(e).then((function(t){e.previewBlob=t,e.previewBlobSubject.next(e.previewBlob),i.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:e.id})})),i.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:e.id})})).catch((function(t){e.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived error "+t)}))}else if(w&&w.length){var U=$(w),F=U.attr("subject"),H=U.attr("confendpointid"),W=w.attr("jid");if("reminder"===w.attr("type"))return!0;var Y={subject:F,confendpointid:H,roomjid:W};P=r.Message.createConferenceMessage(y,b,v,D,!1,Y)}else{var B=!1,V={};if(E&&E.each((function(){var e=$(this).attr("type"),t=$(this).text();"text/markdown"===e&&(c("isMarkdown"),B=!0,c("body"),S=t),V[e]={type:e,message:t}})),T&&T.length){var G=T.attr("id"),z=l.getMessageByIdInHistory(G);z||(z=r.Message.create(G,b,v,D,S,!1,B,null,null,null,null),P=z),v.jid!==z.from.jid?(e.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived : message Replaced by somebody else - Skip"),P=null):z&&z.addReplaceMsg(y,S)}else{var q=k?k.text():null,J=k?k.attr("stamp"):null,K=M?{type:M.attr("type"),message:M.text()}:null;P=r.Message.create(y,b,v,D,S,!1,B,null,q,J,V,K)}}}P&&(P.receiptStatus="true"===angular.element(_).attr("read")?5:"true"===angular.element(_).attr("recv")?4:3,e.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived : pushing msg inside historyMessages"),l.addMessageInHistoryMessages(P))}}else if(h.startsWith("cache_")){e.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived : Query Id for Cached Message");var Q=h.substr(6);if(l=this.conversationService.getConversationById(Q)){var X;e.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived : Conversation Found");var Z=d.find("forwarded message").attr("from");if(!(X=Z&&0===Z.indexOf("room_")?Z.split("/")[1]:a.a.getBareJidFromJid(d.find("forwarded message").attr("from")))&&d.find("event").length){var ee=d.find("event").attr("name");X=d.find("event").attr("jid"),"welcome"===ee&&l.room&&l.room.ownerContact&&(X=l.room.ownerContact.jid)}if(!X)return e.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived - Receive message without valid fromJid information"),!0;var te=s.a.getContactByJid(X),ne=d.find("forwarded message").attr("id"),re=new Date(d.find("forwarded delay").attr("stamp")),ie=d.find("forwarded message body").text(),ae=s.a.isUserContact(te)?r.Message.Side.RIGHT:r.Message.Side.LEFT;te||(e.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived missing contact for jid : "+X+", ignore message"),te=s.a.createEmptyContact(X));var oe=r.Message.create(ne,re,te,ae,ie,!1,!1);oe&&l.addMessageInCacheMessages(oe),l.historyDefered&&l.historyDefered.resolve(oe)}}}else if(h=angular.element(t).find("fin").attr("queryid"),l=this.conversationService.getConversationById(h)){l.historyComplete="true"===angular.element(t).find("fin").attr("complete");var se=angular.element(t).find("fin set first").text();-1===l.historyIndex?(l.messages.unshift.apply(l.messages,l.historyMessages),l.chatRenderer&&l.chatRenderer.prependMessages(l.messages,l.room)):(l.messages.unshift.apply(l.messages,l.historyMessages),l.chatRenderer&&l.chatRenderer.prependMessages(l.historyMessages,l.room)),l.historyIndex=se,l.historyMessages=[],angular.isDefined(l.messages)&&l.messages.length>0?l.lastMessageText=l.messages[l.messages.length-1].data:l.lastMessageText="",l.historyDefered&&l.historyDefered.resolve(l)}return!0}catch(ce){return e.error("[ConversationServiceHistoryHandler] onHistoryMessageReceived error : "+ce),!0}},d.prototype.onSearchTextMessageReceived=function(t){e.info("[ConversationServiceHistoryHandler] onSearchTextMessageReceived");try{var n,r=$(t),i=r.find("forwarded message").attr("from"),o=r.find("forwarded message").attr("to"),c=!1,u=!1;if(s.a.isUserContactJid(i)?(e.info("[ConversationServiceHistoryHandler] sent message"),c=!0,n=o):(e.info("[ConversationServiceHistoryHandler] received message"),c=!1,n=i),n&&0===n.indexOf("room_")?(n=n.split("/")[0],u=!0):n=a.a.getBareJidFromJid(n),!n)return void e.warn("[ConversationServiceHistoryHandler] onSearchTextMessageReceived - Receive message without valid otherJid information");var d=r.find("forwarded message").attr("id"),h=new Date(r.find("forwarded delay").attr("stamp")),f=r.find("forwarded message body").text(),p=r.find("result").attr("id"),m=l();return m.body=f,m.date=h,m.isRoom=u,m.isSent=c,m.messageId=d,m.otherJid=n,m.historyIndex=p,m}catch(v){return e.error("[ConversationServiceHistoryHandler] onSearchTextMessageReceived error : "+v),!0}},d.prototype.onWebrtcHistoryMessageReceived=function(t,n){try{var i=$(t),a=i.find("forwarded message").attr("id"),o=i.find("caller").text(),c=i.find("state").text(),l=0;i.find("duration")&&(l=i.find("duration").text(),l=parseInt(l,10)),l=l>0?"("+moment.duration(l,"ms").format("h[H] mm[m] ss[s]")+")":0;var u=i.find("date").text();u=u?new Date(u):new Date(i.find("forwarded delay").attr("stamp"));var d="";"missed"===c?d="missedCall||"+u:"answered"===c&&(d="activeCallMsg||"+u+"||"+l);var h=n.getMessageById(a);if(h||(h=n.historyMessages.find((function(e){return e.id===a}))),h)e.info("[ConversationServiceHistoryHandler] ("+n.id+") try to add an already stored message with id "+h.id);else{var f=s.a.getContactByJid(o);f||(e.warn("[ConversationServiceHistoryHandler] onWebrtcHistoryMessageReceived missing contact for jid : "+o+", ignore message"),f=s.a.createEmptyContact(o));var p=s.a.isUserContact(f)?r.Message.Side.RIGHT:r.Message.Side.LEFT;h=r.Message.createWebRTCMessage(a,u,f,p,d,!1);var m=i.find("forwarded message ack");m&&(h.receiptStatus="true"===angular.element(m).attr("read")?5:"true"===angular.element(m).attr("received")?4:3),n.historyMessages.push(h)}return!0}catch(v){return!0}},d}])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){h(n,e);var t=m(n);function n(e,r){return S(this,n),t.call(this,e,r)}return n}(n(353).ChannelServiceAgnostic);r.$inject=["$rootScope","$http"],t.ChannelService=r,angular.module("rainbow").service("channelService",r)},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=n(220),o=n(354),s=n(2),c=n(4),l=n(6),u=n(32),d=n(15),h=n(38),f=n(1),p=n(24),m=n(60),v=n(74),g=function e(){S(this,e),this.messages=[],this.complete=!1,this.pageIndex=0,this.isLoading=!1,this.type="AGGREGATE"},y=function(){function e(t,n){S(this,e),this.$rootScope=t,this.$http=n,this.eventService=u.default,this.logger=d.default,this.authService=s.default,this.xmppService=c.default,this.profileService=l.default,this.i18n=h.default,this.contactService=f.default,this.listeners=[],this.isStarted=!1,this.channels={},this.channelsList=[],this.serviceStatusSubject=new i.Subject,this.rxSubject=new i.Subject,this.LIST_EVENT_TYPE={ADD:0,UPDATE:1,REMOVE:2,DELETE:3,SUBSCRIBE:4,UNSUBSCRIBE:5,CREATE:6},this.USER_ROLE={NONE:"none",OWNER:"owner",PUBLISHER:"publisher",MEMBER:"member"},this.MESSAGE_ACTION={ADD:0,RETRACT:1},this.xmppMessageHandler=null,this.xmppManagementHandler=null,this.notificationCounter=0,this.messageCounter=0,this.invitationCounter=0,this.CHANNEL_UPDATE_EVENT="CHANNEL_UPDATE_EVENT",this.CHANNEL_MESSAGE_RECEIVED="CHANNEL_MESSAGE_RECEIVED",this.CHANNEL_USERS_UPDATE_EVENT="CHANNEL_USERS_UPDATE_EVENT",this.CHANNEL_NOTIFICATION_NUMBER_UPDATED="CHANNEL_NOTIFICATION_NUMBER_UPDATED",this.CHANNEL_USER_SUBSCRIPTION_EVENT="CHANNEL_USER_SUBSCRIPTION_EVENT"}return C(e,[{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CHANNEL_ACTIVATED)){e.next=3;break}return e.abrupt("return");case 3:if(!this.contactService.userContact.isCPaaSGuest()){e.next=5;break}return e.abrupt("return");case 5:if(this.contactService.userContact.channelsEnabled){e.next=7;break}return e.abrupt("return");case 7:this.logger.info("=== STARTING ==="),this.feedChannel=new g,this.portalURL=config.restServerUrl+"/api/rainbow/channels/v1.0/channels",this.getMyChannels(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.logger.info("=== STARTING FAILURE === "+e.t0.message);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})))}},{key:"getMyChannels",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.portalURL+"?format=full",n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((r=e.sent).ok){e.next=8;break}throw this.logger.debug("Request ".concat(r.headers.get("x-rainbow-request-id")," failed with status ").concat(r.status)),new Error(r.statusText);case 8:return e.next=10,r.json();case 10:return e.sent.data.forEach((function(e){var t=a.Channel.create(e);i.updateDisplayInfo(t),t.invited&&i.incrementInvitationCounter(),(t.subscribed||t.invited)&&(i.channels[t.id]=t)})),this.updateChannelsList(),this.attachHandlers(),this.attachListeners(),this.isStarted=!0,this.$rootScope.$broadcast("ON_CHANNEL_SERVICE_STARTED"),this.serviceStatusSubject.next("CHANNEL_SERVICE_STARTED"),e.abrupt("return",this.channelsList);case 20:throw e.prev=20,e.t0=e.catch(0),this.channelErrorHandler("getMyChannels",e.t0);case 23:case"end":return e.stop()}}),e,this,[[0,20]])})))}},{key:"attachHandlers",value:function(){var e=this;this.xmppMessageHandler&&(this.xmppService.connection.deleteHandler(this.xmppMessageHandler),this.xmppMessageHandler=null),this.xmppManagementHandler&&(this.xmppService.connection.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.xmppMessageHandler=this.xmppService.connection.addHandler((function(t){return e.onChannelMessageReceived(t)}),null,"message","headline"),this.xmppManagementHandler=this.xmppService.connection.addHandler((function(t){return e.onChannelManagementReceived(t)}),null,"message","management")}},{key:"attachListeners",value:function(){var e=this;this.listeners.push(this.eventService.subscribe(this.CHANNEL_USERS_UPDATE_EVENT,(function(t,n,r){return e.usersUpdateHandler(t,n,r)})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("=== STOPPING ==="),this.listeners.forEach((function(e){e()})),this.channels={},this.channelsList=[],this.feedChannel=null,this.notificationCounter=0,this.logger.info("=== STOPPED ===");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"reconnect",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.logger.info("reconnect"),e.next=4,this.stop();case 4:return e.next=6,this.start();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.logger.error("reconnect -- failure -- "+e.t0.message);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})))}},{key:"removeChannelFromCache",value:function(e){var t=this;return new Promise((function(n,r){var i=t.getChannelFromCache(e);if(i){var a=i.name;i.invited&&t.decrementInvitationCounter(),delete t.channels[e],t.updateChannelsList(),t.feedChannel.messages=[],t.retrieveLatests().then((function(){n(a)})).catch((function(e){r(e)}))}}))}},{key:"onChannelMessageReceived",value:function(e){try{var t=$(e).find("event");if(t&&"http://jabber.org/protocol/pubsub#event"===t.attr("xmlns")){var n=t.find("items"),r=n.find("item"),i=n.find("retract"),a=t.find("update");if(1===a.length)this.updateMessage(a);else if(1===r.length)this.onNewMessage(r);else if(1===i.length){var o=i.attr("id"),s=n.attr("node").split(":")[0];this.onRetractMessage(s,o)}}return!0}catch(c){return this.logger.error("onChannelMessageReceived -- failure -- "+c.message),!0}}},{key:"onNewMessage",value:function(e){var t=e.find("entry"),n=e.attr("id"),r=t.attr("channelId"),i=this.getChannelFromCache(r),a=i.messages.findIndex((function(e){return e.id===n})),s=this.feedChannel.messages.findIndex((function(e){return e.id===n})),c=t.attr("creation")?"modify":"new";-1===a&&-1===s||(c="modify"),this.logger.info("[channelService] onChannelMessageReceived -- "+c+" message "+n+" on channel "+r);var l={id:n,channelId:r,from:t.attr("from"),fromDetails:null,new:!1,entry:{type:t.find("type").length?t.find("type")[0].textContent:"",message:t.find("message").length?t.find("message")[0].textContent:"",title:t.find("title").length?t.find("title")[0].textContent:"",url:t.find("url").length?t.find("url")[0].textContent:"",images:[],attachments:[],video:null},modified:"modify"===c,timestamp:new Date(t.attr("timestamp"))},u=e.find("images");0!==u.length&&u.find("id").each((function(e,t){l.entry.images.push({id:t.textContent})}));var d=e.find("attachments");0!==d.length&&d.find("id").each((function(e,t){l.entry.attachments.push({id:t.textContent})}));var h=e.find("video");if(0!==h.length&&(l.entry.video={provider:h.find("provider")[0].textContent,id:h.find("id")[0].textContent}),"new"===c){var f=o.ChannelMessage.createFromData(i,l);i.loaded&&i.messages.unshift(f),this.feedChannel.messages.unshift(f),this.contactService.userContact.jid!==l.from&&(f.isNew=!0,this.incrementMessagesCounter()),this.$rootScope.$broadcast(this.CHANNEL_MESSAGE_RECEIVED,this.MESSAGE_ACTION.ADD,l),this.rxSubject.next(p.RBEvent.create(this.CHANNEL_MESSAGE_RECEIVED,{action:this.MESSAGE_ACTION.ADD,message:l}))}else{var m=o.ChannelMessage.createFromData(i,l);-1!==a&&i.messages.splice(a,1,m),-1!==s&&this.feedChannel.messages.splice(s,1,m)}}},{key:"updateMessage",value:function(e){var t=e.attr("id"),n=e.attr("channel_id"),r=this.getChannelMessage(n,t);if(r){var i=e.find("my_appreciation");r.myLike=1===i.length?i.attr("appreciation"):"none";var a=e.find("appreciations");1===a.length&&(r.likeCounters=["like","happy","applause","fantastic","doubt"].reduce((function(e,t){return e[t]=parseInt(a.attr(t)||0,10),e}),{})),r.publishUpdate()}}},{key:"getChannelMessage",value:function(e,t){var n=this.getChannelFromCache(e);if(n){var r=n.messages.findIndex((function(e){return e.id===t})),i=this.feedChannel.messages.findIndex((function(e){return e.id===t})),a=-1!==r?n.messages.find((function(e){return e.id===t})):null;return a||-1===i||(a=this.feedChannel.messages.find((function(e){return e.id===t}))),a}return null}},{key:"onRetractMessage",value:function(e,t){this.logger.info("[channelService] onRetractMessage -- retract message "+t+" on channel "+e);var n=this.getChannelFromCache(e),r=n.messages.findIndex((function(e){return e.id===t}));-1!==r&&(n.messages[r].new&&this.decrementMessagesCounter(),n.messages.splice(r,1));var i=this.feedChannel.messages.findIndex((function(e){return e.id===t}));-1!==i&&this.feedChannel.messages.splice(i,1),this.$rootScope.$broadcast(this.CHANNEL_MESSAGE_RECEIVED,this.MESSAGE_ACTION.RETRACT)}},{key:"onChannelManagementReceived",value:function(e){try{var t=angular.element(e).find("mute");if(t&&t.length>0&&"channel"===t.attr("type")){var n=t.attr("peer_id"),r=this.getChannelFromCache(n);this.muteChannel(r)}var i=angular.element(e).find("unmute");if(i&&i.length>0&&"channel"===i.attr("type")){var a=i.attr("peer_id"),o=this.getChannelFromCache(a);this.unmuteChannel(o)}var s=angular.element(e).find("channel");if(s&&s.length>0){var c=s.attr("channelid"),l=this.getChannelFromCache(c);if(l){var u=s.find("avatar"),d=s.find("name"),h=s.find("topic"),f=s.find("category");u&&u.length>0&&this.onAvatarChange(c,u),d&&d.length>0&&(l.name=d.text()),h&&h.length>0&&(l.topic=h.text()),f&&f.length>0&&(l.category=f.text()),this.updateDisplayInfo(l)}var p=s.attr("action");switch(this.logger.info("[channelService] onChannelManagementReceived -- "+p+" event received on channel "+c),p){case"add":this.onAddToChannel(c);break;case"update":this.onUpdateToChannel(c);break;case"remove":this.onRemovedFromChannel(c);break;case"subscribe":this.onSubscribeToChannel(c,s.attr("subscribers"));break;case"unsubscribe":this.onUnsubscribeToChannel(c,s.attr("subscribers"));break;case"delete":this.onDeleteChannel(c)}}var m=angular.element(e).find("channel-subscription");if(m&&m.length>0){var v=m.attr("channelid"),g=m.attr("action"),y=m.attr("id"),b=m.attr("subscribers");switch(this.getChannelFromCache(v).subscribers_count=Number.parseInt(b,10),this.logger.info("[channelService] onChannelManagementReceived -- subscription-"+g+" event received on channel "+v),g){case"subscribe":this.onUserSubscribeEvent(v,y);break;case"unsubscribe":this.onUserUnsubscribeEvent(v,y)}}return!0}catch(S){return this.logger.error("[channels] onChannelManagementReceived -- failure -- "+S.message),!0}}},{key:"onAvatarChange",value:function(e,t){var n=t.attr("action"),r=t.attr("lastAvatarUpdateDate")?new Date(t.attr("lastAvatarUpdateDate")):null;if(this.logger.info("[channelService] onChannelManagementReceived -- "+n+" avatar for "+e),"delete"===n||"update"===n){var i=this.getChannelFromCache(e);i.lastAvatarUpdateDate=r,null!==r&&(i.avatar=config.restServerUrl+"/api/channel-avatar/"+e+"?size=256&ts="+new Date(r).getTime())}}},{key:"onUpdateToChannel",value:function(e){var t=this;this.getChannel(e).then((function(e){e.invited&&(t.addChannelToCache(e),t.$rootScope.$broadcast(t.CHANNEL_UPDATE_EVENT,t.LIST_EVENT_TYPE.ADD,e.id))}))}},{key:"onAddToChannel",value:function(e){var t=this,n=this.getChannelFromCache(e);this.getChannel(e).then((function(r){n||r.invited?!n&&r.invited?(t.addChannelToCache(r),t.incrementInvitationCounter(),t.$rootScope.$broadcast(t.CHANNEL_UPDATE_EVENT,t.LIST_EVENT_TYPE.SUBSCRIBE,r.id),t.rxSubject.next(p.RBEvent.create(t.CHANNEL_UPDATE_EVENT,{action:t.LIST_EVENT_TYPE.SUBSCRIBE,channelId:r.id}))):n&&r.userRole!==t.USER_ROLE.NONE&&(n.userRole=r.userRole,t.feedChannel.messages=[],t.retrieveLatests().then((function(){t.$rootScope.$broadcast(t.CHANNEL_UPDATE_EVENT,t.LIST_EVENT_TYPE.SUBSCRIBE,e)}))):(t.addChannelToCache(r),t.$rootScope.$broadcast(t.CHANNEL_UPDATE_EVENT,t.LIST_EVENT_TYPE.ADD,r.id))}))}},{key:"onRemovedFromChannel",value:function(e){var t=this;this.removeChannelFromCache(e).then((function(){t.$rootScope.$broadcast(t.CHANNEL_UPDATE_EVENT,t.LIST_EVENT_TYPE.DELETE,e)}))}},{key:"onSubscribeToChannel",value:function(e,t){var n=this,r=this.getChannelFromCache(e),i=Number.parseInt(t,10);r?(r.invited=!1,r.subscribed=!0,r.subscribers_count=i,this.feedChannel.messages=[],this.retrieveLatests().then((function(){n.$rootScope.$broadcast(n.CHANNEL_UPDATE_EVENT,n.LIST_EVENT_TYPE.SUBSCRIBE,e)}))):this.getChannel(e).then((function(e){return n.addChannelToCache(e),n.feedChannel.messages=[],n.retrieveLatests()})).then((function(){n.$rootScope.$broadcast(n.CHANNEL_UPDATE_EVENT,n.LIST_EVENT_TYPE.SUBSCRIBE,e)}))}},{key:"onUnsubscribeToChannel",value:function(e,t){var n=this,r=Number.parseInt(t,10),i=this.getChannelFromCache(e);i.subscribers_count=r,i.subscribed=!1,this.feedChannel.messages=[],this.retrieveLatests().then((function(){n.$rootScope.$broadcast(n.CHANNEL_UPDATE_EVENT,n.LIST_EVENT_TYPE.UNSUBSCRIBE,e)}))}},{key:"onDeleteChannel",value:function(e){var t=this;this.removeChannelFromCache(e).then((function(){t.$rootScope.$broadcast(t.CHANNEL_UPDATE_EVENT,t.LIST_EVENT_TYPE.DELETE,e)}))}},{key:"onUserSubscribeEvent",value:function(e,t){this.$rootScope.$broadcast(this.CHANNEL_USER_SUBSCRIPTION_EVENT,this.LIST_EVENT_TYPE.SUBSCRIBE,e,t)}},{key:"onUserUnsubscribeEvent",value:function(e,t){this.$rootScope.$broadcast(this.CHANNEL_USER_SUBSCRIPTION_EVENT,this.LIST_EVENT_TYPE.UNSUBSCRIBE,e,t)}},{key:"getChannelNextPage",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(this,void 0,void 0,b.a.mark((function r(){var i,a,o,s,c;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i="AGGREGATE"===t.type?"feedChannel":t.id,r.prev=1,!t.isLoading){r.next=4;break}return r.abrupt("return",void this.logger.info("-- getChannelNextPage("+i+", "+t.pageIndex+") -- ignored (isLoading)"));case 4:if(t.isLoading=!0,n&&(t.pageIndex=0),!((a=(t.pageIndex+1)*e.PAGE_SIZE)<=t.messages.length)){r.next=8;break}return r.abrupt("return",(this.logger.info("-- getChannelNextPage("+i+", "+t.pageIndex+") -- success from cache"),t.pageIndex+=1,t.isLoading=!1,{messages:t.messages,nbMessages:a}));case 8:if(!t.complete){r.next=10;break}return r.abrupt("return",(this.logger.info("-- getChannelNextPage("+i+", "+t.pageIndex+") -- success from cache (complete)"),t.isLoading=!1,{messages:t.messages,nbMessages:t.messages.length}));case 10:return o=t.messages,s=o.length?o[o.length-1].timestamp:null,r.next=14,this.getChannelMessages(t,s);case 14:return c=r.sent,r.abrupt("return",(c<e.PAGE_SIZE&&(t.complete=!0),this.logger.info("-- getChannelNextPage("+i+", "+t.pageIndex+") -- success from server "+(t.complete?"(complete)":"")+" -- retreive "+c+" message(s)"),t.pageIndex+=1,t.loaded=!0,t.isLoading=!1,{messages:t.messages,nbMessages:t.messages.length}));case 18:throw r.prev=18,r.t0=r.catch(1),t.isLoading=!1,this.channelErrorHandler("getChannelNextPage("+i+", "+t.pageIndex+")",r.t0);case 21:case"end":return r.stop()}}),r,this,[[1,18]])})))}},{key:"getChannelPublishers",value:function(e){var t=this;return new Promise((function(n,r){if(e.publishersRetreived)return n();t.getChannelUsers(e.id,{format:"full",types:"owner publisher"}).then((function(r){r.data.forEach((function(n){var r=t.contactService.getContactByJid(n.jid_im);r||((r=t.contactService.createContact()).updateFromUserData(n),t.contactService.updateContactRichStatus(r),t.contactService.contacts[r.id]=r,t.contactService.dbContacts[r.dbId]=r,t.contactService.jtelContacts[r.jidtel]=r),e.users.push(r)})),e.publishersRetreived=!0,t.logger.info("[channelService] getChannelPublishers ("+e.id+") -- success -- find "+r.length+" publisher(s)"),n()})).catch((function(n){r(t.channelErrorHandler("getChannelPublishers ("+e.id+")",n))}))}))}},{key:"getChannelMessages",value:function(t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,a,s=this;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,null,i="AGGREGATE"===t.type?this.getLatestMessages(10,n):this.getChannelItems(t.id,e.PAGE_SIZE,n),r.next=5,i;case 5:return a=r.sent.map((function(e){return o.ChannelMessage.createFromData(s.getChannelFromCache(e.channelId),e)})),r.abrupt("return",(t.messages.push.apply(t.messages,a),a.length));case 9:throw r.prev=9,r.t0=r.catch(0),this.channelErrorHandler("getChannelMessages ("+t.id+")",r.t0);case 12:case"end":return r.stop()}}),r,this,[[0,9]])})))}},{key:"getChannelInvitations",value:function(){return this.channelsList.filter((function(e){return!e.deleted&&e.invited}))}},{key:"muteChannel",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"/").concat(e.id,"/mute"),t.next=4,fetch(n,{method:"POST",headers:this.authService.getPostHeader()});case 4:if((r=t.sent).ok){t.next=7;break}throw new Error(r.statusText);case 7:e.muted=!0,e.updateSubject.next(),t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(0),this.channelErrorHandler("muteChannel",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})))}},{key:"unmuteChannel",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(this.portalURL,"/").concat(e.id,"/mute"),t.next=4,fetch(n,{method:"DELETE",headers:this.authService.getPostHeader()});case 4:if((r=t.sent).ok){t.next=7;break}throw new Error(r.statusText);case 7:e.muted=!1,e.updateSubject.next(),t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(0),this.channelErrorHandler("unmuteChannel",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})))}},{key:"createChannel",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"globalnews",o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100;return new Promise((function(c,l){var u=n.portalURL+(o?"?auto_provisioning=true":""),d={name:e,mode:t,topic:r,category:i,max_items:s};n.$http({method:"POST",url:u,headers:n.authService.getPostHeader(),data:d}).then((function(r){n.logger.info("[channelService] createChannel -- "+e+" -- "+t+" -- success");var i=a.Channel.create(r.data.data);n.updateDisplayInfo(i),c(i)})).catch((function(r){l(n.channelErrorHandler("createChannel -- "+e+" -- "+t,r))}))}))}},{key:"deleteChannel",value:function(e){var t=this;return new Promise((function(n,r){t.$http({method:"DELETE",url:t.portalURL+"/"+e,headers:t.authService.getPostHeader()}).then((function(r){t.logger.info("[channelService] deleteChannel -- "+e+" -- success"),n(r)})).catch((function(n){r(t.channelErrorHandler("deleteChannel ("+e+")",n))}))}))}},{key:"findChannels",value:function(e){var t=this;return new Promise((function(n,r){var i="?sortOrder="+(e.sortOrder&&1===e.sortOrder?"1":"-1");void 0!==e.subscribed&&(i+="&subscribed="+e.subscribed),e.name&&(i+="&name="+e.name),e.topic&&(i+="&topic="+e.topic),e.limit&&(i+="&limit="+e.limit),e.offset&&(i+="&offset="+e.offset),e.sortField&&(i+="&sortField="+e.sortField),e.category&&(i+="&category="+e.category),t.$http({method:"GET",url:t.portalURL+"/search"+i,headers:t.authService.getRequestHeader()}).then((function(e){var r=[];e.data.data.forEach((function(e){var n=a.Channel.create(e);t.updateDisplayInfo(n),r.push(n)})),n(r)})).catch((function(e){r(t.channelErrorHandler("findChannels ("+i+")",e))}))}))}},{key:"browseChannels",value:function(e){var t=this;return new Promise((function(n,r){var i="?sortOrder="+(e.sortOrder&&1===e.sortOrder?"1":"-1");e.category&&(i+="&category="+e.category),e.excluded_category&&(i+="&excluded_category="+e.excluded_category),void 0!==e.subscribed&&(i+="&subscribed="+e.subscribed),e.limit&&(i+="&limit="+e.limit),e.offset&&(i+="&offset="+e.offset),e.sortField&&(i+="&sortField="+e.sortField),t.$http({method:"GET",url:t.portalURL+"/browse"+i,headers:t.authService.getRequestHeader()}).then((function(e){var r=[];e.data.data.forEach((function(e){var n=a.Channel.create(e);t.updateDisplayInfo(n),r.push(n)})),n(r)})).catch((function(e){r(t.channelErrorHandler("browseChannels ("+i+")",e))}))}))}},{key:"getChannel",value:function(e){var t=this;return new Promise((function(n,r){t.$http({method:"GET",url:t.portalURL+"/"+e,headers:t.authService.getRequestHeader()}).then((function(r){t.logger.info("[channelService] getChannel -- "+e+" -- success");var i=a.Channel.create(r.data.data);t.updateDisplayInfo(i),n(i)})).catch((function(n){r(t.channelErrorHandler("getChannel ("+e+")",n))}))}))}},{key:"getChannelFromCache",value:function(e){var t=this.channels[e];return void 0!==t?t:null}},{key:"publishToChannel",value:function(e,t,n,r,i,a,o,s,c){var l=this;return new Promise((function(a,u){var d={type:n,title:i||"",message:r||"",images:o||[],attachments:c||[]},h=t?"?itemId="+t:"";s&&(d.video=s),l.$http({method:"POST",url:l.portalURL+"/"+e+"/publish"+h,headers:l.authService.getRequestHeader(),data:d}).then((function(t){l.logger.info("[channelService] publishToChannel -- "+e+" -- "+n+" -- success"),a(t)})).catch((function(t){u(l.channelErrorHandler("publishToChannel ("+e+")",t))}))}))}},{key:"subscribeToChannel",value:function(e){var t=this;return new Promise((function(n,r){t.$http({method:"POST",url:t.portalURL+"/"+e.id+"/subscribe",headers:t.authService.getRequestHeader()}).then((function(r){t.logger.info("[channelService] subscribeToChannel -- "+e.id+" -- success"),e.subscribed=!0,e.users_count+=1,n(r)})).catch((function(n){r(t.channelErrorHandler("subscribeToChannel ("+e.id+")",n))}))}))}},{key:"unsubscribeToChannel",value:function(e){var t=this;return new Promise((function(n,r){t.$http({method:"DELETE",url:t.portalURL+"/"+e.id+"/subscribe",headers:t.authService.getRequestHeader()}).then((function(r){t.logger.info("[channelService] unsubscribeToChannel -- success"),e.subscribed=!1,e.users_count-=1,e.userRole=t.USER_ROLE.NONE,n(r)})).catch((function(e){r(t.channelErrorHandler("unsubscribeToChannel",e))}))}))}},{key:"updateChannel",value:function(e,t){var n=this;return new Promise((function(r,i){n.$http({method:"PUT",url:n.portalURL+"/"+e,headers:n.authService.getPostHeader(),data:t}).then((function(t){var i=n.getChannelFromCache(e);i.name=t.data.data.name,i.topic=t.data.data.topic,i.category=t.data.data.category,n.updateDisplayInfo(i),n.logger.info("[channelService] updateChannel ( "+e+") -- success"),n.$rootScope.$broadcast(n.CHANNEL_UPDATE_EVENT,n.LIST_EVENT_TYPE.UPDATE,i.id),i.updateSubject.next(),r(i)})).catch((function(t){i(n.channelErrorHandler("updateChannel ("+e+")",t))}))}))}},{key:"getChannelItems",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise((function(a,o){n.$http({method:"GET",url:n.portalURL+"/"+e+"/items",headers:n.authService.getRequestHeader(),params:{max:t,before:r,after:i}}).then((function(t){n.logger.info("[channelService] getChannelItems -- success"),n.getChannelFromCache(e).messagesCount=t.data.data.status.count,n.chewReceivedItems(t.data.data.items),a(t.data.data.items)})).catch((function(e){o(n.channelErrorHandler("getChannelItems",e))}))}))}},{key:"deleteChannelItem",value:function(e,t){var n=this;return new Promise((function(r,i){n.$http({method:"DELETE",url:n.portalURL+"/"+e+"/items/"+t,headers:n.authService.getRequestHeader()}).then((function(t){n.logger.info("[channelService] deleteChannelItem ("+e+") -- success"),r()})).catch((function(t){i(n.channelErrorHandler("deleteChannelItem ("+e+")",t))}))}))}},{key:"getChannelUsers",value:function(e,t){var n=this;return new Promise((function(r,i){var a={};t&&(t.format&&"string"==typeof t.format&&t.format.length&&(a.format=t.format),t.limit&&"number"==typeof t.limit&&t.limit>0&&(a.limit=t.limit),t.offset&&"number"==typeof t.offset&&t.offset>0&&(a.offset=t.offset),t.sortField&&"string"==typeof t.sortField&&t.sortField.length&&(a.sortField=t.sortField),!t.sortOrder||"-1"!==t.sortOrder&&"1"!==t.sortOrder||(a.sortOrder=t.sortOrder));var o=n.portalURL+"/"+e+"/users";t&&(t.types&&"string"==typeof t.types&&t.types.length?o+="?types="+t.types:t.invited&&"boolean"==typeof t.invited&&(o+="?invited="+t.invited)),n.$http({method:"GET",url:o,headers:n.authService.getRequestHeader(),params:a}).then((function(t){n.logger.info("[channelService] getChannelUsers ("+e+") -- success"),r(t.data)})).catch((function(t){i(n.channelErrorHandler("getChannelUsers ("+e+")",t))}))}))}},{key:"searchUsersByName",value:function(e,t,n){var r=this;return n.displayName=t,new Promise((function(t,i){r.$http({method:"GET",url:r.portalURL+"/"+e+"/users/search",headers:r.authService.getRequestHeader(),params:n}).then((function(n){r.logger.info("[channelService] searchUsersByName ("+e+" -- success"),t(n.data.data)})).catch((function(t){i(r.channelErrorHandler("searchUsersByName ("+e+")",t))}))}))}},{key:"deleteChannelAvatar",value:function(e){var t=this;return new Promise((function(n,r){t.$http({method:"DELETE",url:t.portalURL+"/"+e.id+"/avatar",headers:t.authService.getRequestHeader()}).then((function(r){t.logger.info("[channelService] deleteChannelAvatar "+e.id+" -- success"),n(r),e.avatar=null,e.lastAvatarUpdateDate=null,e.updateSubject.next()})).catch((function(n){r(t.channelErrorHandler("deleteChannelAvatar "+e.id,n))}))}))}},{key:"uploadChannelAvatar",value:function(e,t,n){var r=this;return new Promise((function(i,a){v.resizeImage(t,n,n).then((function(t){var n=v.getBinaryData(t);r.$http({method:"POST",url:r.portalURL+"/"+e.id+"/avatar",headers:r.authService.getPostHeader("image/"+n.type),data:n.data,transformRequest:[]}).then((function(n){r.logger.info("[channelService] uploadChannelAvatar "+e.id+" -- success"),e.avatar=t.src,e.lastAvatarUpdateDate=new Date,e.updateSubject.next(),i(n)})).catch((function(e){a(r.channelErrorHandler("uploadChannelAvatar",e))}))}))}))}},{key:"updateChannelUsers",value:function(e,t,n){var r=this;return new Promise((function(i,a){var o=t.map((function(e){return{id:e.dbId,type:n}}));r.$http({method:"PUT",url:r.portalURL+"/"+e+"/users",headers:r.authService.getRequestHeader(),data:{data:o}}).then((function(t){r.logger.info("[channelService] updateChannelUsers -- success");var n=t.data.data;r.$rootScope.$broadcast(r.CHANNEL_USERS_UPDATE_EVENT,e,n),i(n)})).catch((function(e){a(r.channelErrorHandler("updateChannelUsers",e))}))}))}},{key:"usersUpdateHandler",value:function(e,t,n){var r=this.getChannelFromCache(t);if(null!==n){if(r.users_count+=n.added.length-n.removed.length,r.users.length){for(var i=0;i<n.added.length;i++)this.contactService.getContactByDBId(n.added[i]).then((function(e){r.users.push(e)}));for(var a=0;a<n.removed.length;a++)for(var o=r.users.length-1;o>=0;o--)if(r.users[o].dbId===n.removed[a]){r.users.splice(o,1);break}}if(n.invalidUsers&&n.invalidUsers.length&&"409005"===n.invalidUsers[0].errorDetailsCode){var s=this.i18n.translate("inviteUsersError");this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",s)}}}},{key:"retrieveUsers",value:function(e){var t=this;if(this.logger.info("Retrieving users"),0===e.users.length&&e.userRole===this.USER_ROLE.OWNER){var n,r=this.contactService.userContact;return r.type="owner",this.getChannelUsers(e.id,{format:"full",types:"publisher",limit:19}).then((function(r){return(n=r.data.length?r.data:[]).length<19?t.getChannelUsers(e.id,{format:"full",types:"member",limit:19-n.length}):[]})).then((function(i){n.push.apply(n,i.data);var a=n;return e.users=t.usersToContacts(a),e.users.unshift(r),e.users}))}return Promise.resolve(null)}},{key:"usersToContacts",value:function(e){var t=this;if(null!==e)return e.map((function(e){var n=t.contactService.createContact(e.jid_im,e.firstName,e.lastName,e.company,e.loginEmail);n.dbId=e.id,n.lastAvatarUpdateDate=e.lastAvatarUpdateDate,n.type=e.type||e.affiliation,n.getAvatar()}))}},{key:"retrieveLatests",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.getLatestMessages(10,t,null).then((function(t){var n=t.map((function(t){return o.ChannelMessage.createFromData(e.getChannelFromCache(t.channelId),t)}));return e.feedChannel.messages.push.apply(e.feedChannel.messages,n),n.length}))}},{key:"incrementMessagesCounter",value:function(){this.messageCounter+=1,this.updateNotificationCounter()}},{key:"decrementMessagesCounter",value:function(){this.messageCounter-=1,this.updateNotificationCounter()}},{key:"incrementInvitationCounter",value:function(){this.invitationCounter+=1,this.updateNotificationCounter()}},{key:"decrementInvitationCounter",value:function(){this.invitationCounter-=1,this.updateNotificationCounter()}},{key:"ackMessages",value:function(){this.messageCounter=0,this.updateNotificationCounter(),this.feedChannel.messages.forEach((function(e){e.new=!1}))}},{key:"ackMessage",value:function(e){this.feedChannel.messages.forEach((function(t){t.id===e&&(t.new=!1)})),this.decrementMessagesCounter()}},{key:"updateNotificationCounter",value:function(){this.notificationCounter=this.messageCounter+this.invitationCounter,this.notificationCounter<0&&(this.notificationCounter=0),this.$rootScope.$broadcast(this.CHANNEL_NOTIFICATION_NUMBER_UPDATED,this.notificationCounter)}},{key:"removeAllUsersFromChannel",value:function(e){var t=this;return new Promise((function(n,r){t.$http({method:"DELETE",url:t.portalURL+"/"+e+"/users",headers:t.authService.getRequestHeader()}).then((function(r){t.logger.info("[channelService] Removed all users from channel -- success"),t.$rootScope.$broadcast(t.CHANNEL_USERS_UPDATE_EVENT,e,null),n(r)})).catch((function(e){r(t.channelErrorHandler("removeAllUsersFromChannel",e))}))}))}},{key:"getPortalInfos",value:function(){var e=this;return new Promise((function(t,n){e.$http({method:"GET",url:config.restServerUrl+"/api/rainbow/channels/v1.0/about",headers:e.authService.getRequestHeader()}).then((function(n){e.logger.info("[channelService] successfully retrieved portal infos -- success"),t(n.data)})).catch((function(t){n(e.channelErrorHandler("getPortalInfos",t))}))}))}},{key:"getLatestMessages",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(i,a){t.$http({method:"GET",url:t.portalURL+"/latest-items",headers:t.authService.getRequestHeader(),params:{max:e,before:n,after:r}}).then((function(e){t.chewReceivedItems(e.data.data.items),i(e.data.data.items)})).catch((function(e){a(t.channelErrorHandler("getLatestMessages",e))}))}))}},{key:"acceptInvitation",value:function(e){var t=this;return new Promise((function(n,r){t.$http({method:"PUT",url:t.portalURL+"/"+e+"/accept",headers:t.authService.getRequestHeader()}).then((function(r){t.logger.info("[channelService] acceptInvitation ("+e+") -- success"),t.decrementInvitationCounter(),n(r)})).catch((function(e){r(t.channelErrorHandler("acceptInvitation",e))}))}))}},{key:"declineInvitation",value:function(e){var t=this;return new Promise((function(n,r){t.$http({method:"PUT",url:t.portalURL+"/"+e+"/decline",headers:t.authService.getRequestHeader()}).then((function(r){t.logger.info("[channelService] declineInvitation ("+e+") -- success"),t.decrementInvitationCounter(),n(r)})).catch((function(e){r(t.channelErrorHandler("declineInvitation",e))}))}))}},{key:"chewReceivedItems",value:function(e){e.forEach((function(e){"urn:xmpp:channels:simple"===e.type&&(e.entry={message:e.message},delete e.message),e.modified=void 0!==e.creation}))}},{key:"updateChannelsList",value:function(){var e=this;this.channelsList=Object.keys(this.channels).map((function(t){return e.channels[t]}))}},{key:"addChannelToCache",value:function(e){this.channels[e.id]=e,this.updateChannelsList()}},{key:"channelErrorHandler",value:function(e,t){var n=null;return t.data?(this.logger.error("[channelService] "+e+" -- failure -- "+t.data.errorDetails),n=new RBError(t.data.errorMsg,t.data.errorDetails,t.data.errorDetailsCode)):(this.logger.error("[channelService] "+e+" -- failure -- Server failure"),n=new RBError("Server failure")),n}},{key:"likeChannelItem",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var i,a,o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i="".concat(this.portalURL,"/").concat(e.id,"/items/").concat(t.id,"/like"),a=JSON.stringify({appreciation:n}),r.next=5,fetch(i,{method:"POST",headers:this.authService.getPostHeader(),body:a});case 5:if((o=r.sent).ok){r.next=8;break}throw new Error(o.statusText);case 8:return r.next=10,o.json();case 10:return r.abrupt("return",r.sent.data);case 13:throw r.prev=13,r.t0=r.catch(0),s="getChannelItemReactions -- FAILURE -- "+r.t0.message,this.logger.error(s),new Error(s);case 17:case"end":return r.stop()}}),r,this,[[0,13]])})))}},{key:"getChannelMessageReactions",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r="".concat(this.portalURL,"/").concat(e.channel.id,"/items/").concat(e.id,"/likes?limit=400"),t&&(r+="&appreciation="+t),i=this.authService.getRequestHeader(),n.next=6,fetch(r,{method:"GET",headers:i});case 6:if((a=n.sent).ok){n.next=9;break}throw new Error(a.statusText);case 9:return n.next=11,a.json();case 11:return n.abrupt("return",n.sent.data.items.map((function(e){var t=s.contactService.getContactById(e.id);t||(t=s.contactService.createContact(e.id,e.firstName,e.lastName)).createTextAvatarImage();var n=e.companyName;return t.jobTitle&&(n=t.jobTitle+" - "+n),{reaction:e.appreciation,contact:t,info:n}})));case 14:throw n.prev=14,n.t0=n.catch(0),o="getChannelItemReactions -- FAILURE -- "+n.t0.message,this.logger.error(o),new Error(o);case 18:case"end":return n.stop()}}),n,this,[[0,14]])})))}},{key:"updateDisplayInfo",value:function(e){e.displayName=m(e.name),e.displayTopic=m(e.topic)}}]),e}();y.PAGE_SIZE=10,t.ChannelServiceAgnostic=y},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(24),a=function(){function e(){S(this,e),this.id=null,this.type=null,this.message=null,this.from=null,this.images=null,this.attachments=null,this.contact=null,this.video=null,this.isNew=!0,this.isModified=!1,this.rxSubject=new r.Subject}return C(e,[{key:"publishUpdate",value:function(){this.rxSubject.next(i.RBEvent.create("updateLikes"))}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}}],[{key:"createFromData",value:function(t,n){var r=new e;return r.isNew=n.new,r.isModified=n.modified,r.id=n.id,r.type=n.type,r.from=n.from,r.timestamp=n.timestamp,r.channel=t,r.video=n.video,n.entry.message&&(r.message=n.entry.message.replace(/<a/gi,"<a target='_blank' rel='noopener noreferrer' ")),n.entry.video&&(r.video=n.entry.video),n.entry.images&&"null"!==n.entry.images&&void 0!==n.entry.images&&(n.entry.images instanceof Array?n.entry.images.length>0&&(r.images=n.entry.images):r.images=[n.entry.images]),n.entry.attachments&&"null"!==n.entry.attachments&&void 0!==n.entry.attachments&&(n.entry.attachments instanceof Array?n.entry.attachments.length>0&&(r.attachments=n.entry.attachments):r.attachments=[n.entry.attachments]),r.myLike=n.my_appreciation?n.my_appreciation:"none",r.likeCounters=n.appreciations?n.appreciations:{like:0,fantastic:0,applause:0,doubt:0,happy:0},r}}]),e}();t.ChannelMessage=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){h(n,e);var t=m(n);function n(e){return S(this,n),t.call(this,e)}return n}(n(356).AgnosticFavoriteService);r.$inject=["conversationService"],t.FavoriteService=r,angular.module("rainbow").service("favoriteService",r)},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(357),a=n(10),o=n(1),s=n(2),c=n(4),l=n(15),u=n(33);t.AgnosticFavoriteService=function(){function e(t){S(this,e),this.conversationService=t,this.favorites=[],this.eventNames=[],this.authService=s.default,this.xmppService=c.default,this.contactService=o.default,this.logger=l.default,this.roomService=u.default}return C(e,[{key:"start",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.logger.info("=== STARTING ==="),n=performance.now(),this.rxSubject=new a.Subject,this.connect(),r=Math.round(performance.now()-n),e.push({service:"favoriteService",startDuration:r}),this.eventNames=["ON_FAVORITE_CREATED","ON_FAVORITE_DELETED","ON_FAVORITE_UPDATED"],this.logger.info("=== STARTED (".concat(r," ms) ==="));case 5:case"end":return t.stop()}}),t,this)})))}},{key:"connect",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getServerFavorites();case 3:this.conversationService.favoriteService=this,this.attachHandlers(),this.rxSubject.next({name:"update"}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.logger.error("connect -- Failure -- "+e.t0.message);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("=== STOPPING ==="),this.xmppManagementHandler&&(this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.logger.info("=== STOPPED ===");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"getServerFavorites",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,i,a,o,s,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/favorites"),n=this.authService.getRequestHeader(),e.next=5,fetch(t,{method:"GET",headers:n});case 5:if((i=e.sent).ok){e.next=8;break}throw this.logger.debug("Request ".concat(i.headers.get("x-rainbow-request-id")," failed with status ").concat(i.status)),new Error(i.statusText);case 8:return e.next=10,i.json();case 10:return a=e.sent.data.map((function(e){return r(c,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.createFavorite(e.id,e.peerId,e.type));case 1:case"end":return t.stop()}}),t,this)})))})),e.next=13,Promise.all(a);case 13:return o=e.sent,e.abrupt("return",(this.favorites=o.filter((function(e){return null!==e})),this.logger.info("getServerFavorites -- SUCCESS -- found ".concat(this.favorites.length," favorites")),this.favorites));case 17:throw e.prev=17,e.t0=e.catch(0),s="getServerFavorites -- FAILURE -- "+e.t0.message,this.logger.error(s),new Error(s);case 21:case"end":return e.stop()}}),e,this,[[0,17]])})))}},{key:"addServerFavorite",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o,s,c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/favorites"),i=this.authService.getPostHeader(),a={peerId:e,type:t},n.next=6,fetch(r,{method:"POST",headers:i,body:JSON.stringify(a)});case 6:return o=n.sent,n.next=9,o.json();case 9:if(!(s=n.sent).errorDetails||"FAVORITE_CONVERSATIONS_COUNT"!==s.errorDetails.feature){n.next=12;break}throw new Error("Reach FAVORITE_CONVERSATIONS_COUNT");case 12:this.logger.info("addServerFavorite(".concat(e,", ").concat(t,") -- SUCCESS")),n.next=19;break;case 15:throw n.prev=15,n.t0=n.catch(0),c="addServerFavorite(".concat(e,", ").concat(t,") -- FAILURE -- ").concat(n.t0.message),this.logger.error(c),new Error(c);case 19:case"end":return n.stop()}}),n,this,[[0,15]])})))}},{key:"removeServerFavorite",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/favorites/").concat(e),r=this.authService.getRequestHeader(),t.next=4,fetch(n,{method:"DELETE",headers:r});case 4:this.logger.info("removeServerFavorite(".concat(e,") -- SUCCESS")),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(0),i="removeServerFavorite(".concat(e,") -- FAILURE -- ").concat(t.t0.statusText),this.logger.error(i),new Error(i);case 11:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"toggleFavorite",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.contact?e.contact.dbId:e.room.dbId,r=e.contact?e.contact.isBot?"bot":"user":"room",!(i=this.favorites.find((function(e){return e.peerId===n})))){t.next=7;break}return t.next=5,this.removeServerFavorite(i.id);case 5:t.next=9;break;case 7:return t.next=9,this.addServerFavorite(n,r);case 9:t.next=14;break;case 11:throw t.prev=11,t.t0=t.catch(0),new Error(t.t0.message);case 14:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"getFavoriteConversation",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.favorites.find((function(t){return t.peerId===e})),r=n.contact?this.conversationService.getOrCreateOneToOneConversation(n.contact.jid):this.conversationService.getRoomConversation(n.room.jid),t.next=3,r;case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"isFavoriteConversation",value:function(e){return this.favorites.find((function(t){return t.peerId===e}))}},{key:"moveFavoritePosition",value:function(e,t){try{var n="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/favorites/").concat(e,"?position=").concat(t),r=this.authService.getRequestHeader();fetch(n,{method:"PUT",headers:r}),this.logger.info("moveFavoritePosition(".concat(e,", ").concat(t,") -- SUCCESS"))}catch(a){var i="moveFavoritePosition(".concat(e,", ").concat(t,") -- FAILURE -- ").concat(a.statusText);throw this.logger.error(i),new Error(i)}}},{key:"createFavorite",value:function(e,t,n){return r(this,void 0,void 0,b.a.mark((function r(){var a,o,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,a=new i.Favorite(e,t,n),"room"!==n){r.next=6;break}a.room=this.roomService.getRoomById(t),r.next=9;break;case 6:return r.next=8,this.contactService.getContactByDBId(t);case 8:a.contact=r.sent;case 9:if(a.room||a.contact){r.next=11;break}return r.abrupt("return",(this.removeServerFavorite(e),null));case 11:return o=a.room?a.room.jid:a.contact.jid,s=this.conversationService.getConversationById(o),r.abrupt("return",(s&&(s.isFavorite=!0,a.conv=s),a));case 15:return r.prev=15,r.t0=r.catch(0),r.abrupt("return",(this.logger.warn("createFavorite(".concat(e,", ").concat(t,", ").concat(n,") -- FAILURE -- ").concat(r.t0.message)),null));case 18:case"end":return r.stop()}}),r,this,[[0,15]])})))}},{key:"updateFavoriteConversations",value:function(e){var t=e.contact?e.contact.dbId:e.room.dbId,n=this.favorites.find((function(e){return e.peerId===t}));n&&(e.isFavorite=!0,n.conv=e)}},{key:"onXmppEvent",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c,l,u,d;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=$(e).find("favorite"))){t.next=16;break}if(r=n.attr("id"),i=n.attr("type"),a=n.attr("peer_id"),"create"!==(o=n.attr("action"))){t.next=15;break}if(s=this.favorites.find((function(e){return e.peerId===a})),t.t0=s,t.t0){t.next=13;break}return t.next=10,this.createFavorite(r,a,i);case 10:s=t.sent,this.favorites.push(s),this.sendEvent("ON_FAVORITE_CREATED",{favorite:s});case 13:t.next=16;break;case 15:"delete"===o?-1!==(c=this.favorites.findIndex((function(e){return e.peerId===a})))&&((l=this.favorites[c]).conv&&(l.conv.isFavorite=!1),this.favorites.splice(c,1),this.sendEvent("ON_FAVORITE_DELETED",{favoriteId:l.id})):"update"===o&&(u=parseInt(n.attr("position"),10),-1!==(d=this.favorites.findIndex((function(e){return e.id===r})))&&(this.favorites.splice(u,0,this.favorites.splice(d,1)[0]),this.sendEvent("ON_FAVORITE_UPDATED",{favoriteId:r,position:u})));case 16:return t.abrupt("return",!0);case 19:return t.prev=19,t.t1=t.catch(0),t.abrupt("return",!0);case 22:case"end":return t.stop()}}),t,this,[[0,19]])})))}},{key:"sendEvent",value:function(e,t){var n=new CustomEvent(e,{detail:t});window.dispatchEvent(n)}},{key:"attachHandlers",value:function(){var e=this;this.xmppManagementHandler&&this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=this.xmppService.addHandler((function(t){return e.onXmppEvent(t),!0}),null,"message","management")}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Favorite=function(){return function e(t,n,r){S(this,e),this.id=t,this.peerId=n,this.type=r}}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){h(n,e);var t=m(n);function n(e,r,i,a,o){return S(this,n),t.call(this,e,r,i,a,o)}return n}(n(359).AgnosticVoiceMessageService);r.$inject=["$rootScope","$http","$injector","telephonyService","fileServerService"],t.VoiceMessageService=r,angular.module("rainbow").service("voiceMessageService",r)},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=n(360),o=n(15),s=n(1),c=n(5),l=n(2),u=n(4),d=n(6),h=n(25);t.AgnosticVoiceMessageService=function(){function e(t,n,r,a,f){S(this,e),this.$rootScope=t,this.$http=n,this.$injector=r,this.telephonyService=a,this.fileServerService=f,this.portalURL="",this.sipWisePortalURL="",this.listeners=[],this.voiceMessageMngtRef=null,this.messageHandlerRef=null,this.voiceMessages=[],this.xmpp_message_handler=null,this.voiceMessagesCounters={total:0,unread:0},this.unreadVoiceMessageCounter=0,this.voiceMessagePromises={},this.rxSubject=new i.Subject,this.CALLSERVICE_NS="urn:xmpp:pbxagent:callservice:1",this.CALLSERVICE_NS_SIPWISE="urn:xmpp:pbxagent:telephony:1",this.settingsService=c.default,this.logger=o.default,this.authService=l.default,this.xmppService=u.default,this.profileService=d.default,this.fileStorageService=h.default,this.contactService=s.default}return C(e,[{key:"start",value:function(e){var t=this;return this.portalURL=config.restServerUrl+"/api/rainbow/telephony/v1.0/",this.sipWisePortalURL=config.restServerUrl+"/api/rainbow/voice/v1.0/",this.telephonyService.isSipWiseRoot()&&(this.logger.info("[voiceMessageService] starting in sipWise mode "),this.CALLSERVICE_NS=this.CALLSERVICE_NS_SIPWISE),this.voiceMessagesCounters={total:0,unread:0},new Promise((function(n){if(!t.profileService.isFeatureEnabled(t.profileService.FeaturesEnum.TELEPHONY_VOICE_MAIL))return n();if(t.contactService.userContact.isCPaaSGuest())return n();t.logger.info("[voiceMessageService] === STARTING ===");var r=performance.now();t.attachHandlers(),t.telephonyService.isSipWiseRoot()&&t.getVoiceMessagesCounters().then((function(){t.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:t.voiceMessagesCounters}),t.$rootScope.$broadcast("ON_VOICE_MESSAGE_UPDATE_EVENT",t.voiceMessagesCounters)}));var i=Math.round(performance.now()-r);t.logger.info("[voiceMessageService] === STARTED ("+i+" ms) ==="),e.push({service:"voiceMessageService",startDuration:i}),n()}))}},{key:"attachHandlers",value:function(){var e=this;this.logger.info("[voiceMessageService] attachHandlers"),this.voiceMessageMngtRef&&(this.xmppService.connection.deleteHandler(this.voiceMessageMngtRef),this.voiceMessageMngtRef=null),this.voiceMessageMngtRef=this.xmppService.connection.addHandler((function(t){return e.onVoiceMessageManagement(t)}),null,"message","management"),this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.messageHandlerRef=this.xmppService.addHandler((function(t){return e.vmCounterHandler(t)}),this.CALLSERVICE_NS,"message",null)}},{key:"stop",value:function(){var e=this;return new Promise((function(t){e.logger.info("[voiceMessageService] === STOPPING ==="),e.listeners.forEach((function(e){e()})),e.voiceMessagesCounters={total:0,unread:0},e.logger.info("[voiceMessageService] === STOPPED ==="),t()}))}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"vmCounterHandler",value:function(e){try{if(this.telephonyService.isSipWiseRoot()){var t=$(e).find("telephony").find("mwi");if(t&&0!==t.length){var n=t.find("message"),r=n.attr("type"),i=n.attr("new"),a=n.attr("old");r&&"voice"===r&&i&&a?(this.voiceMessagesCounters.unread=Number(i),this.voiceMessagesCounters.total=Number(i)+Number(a),this.logger.info("[voiceMessageService] vmCounterHandler SipWise -- Messages total : "+this.voiceMessagesCounters.total+" - Messages Unread : "+this.voiceMessagesCounters.unread),this.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:this.voiceMessagesCounters}),this.$rootScope.$broadcast("ON_VOICE_MESSAGE_UPDATE_EVENT",this.voiceMessagesCounters)):this.logger.info("[voiceMessageService] vmCounterHandler SipWise -- anomaly msg attr ")}}else{var o=$(e).find("voiceMessages").find("voiceMessagesCounters");if(o&&0!==o.length){var s=o.attr("totalVoiceMessages"),c=o.attr("unreadVoiceMessages");this.voiceMessagesCounters={total:s?parseInt(s,10):0,unread:c?parseInt(c,10):0},this.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:this.voiceMessagesCounters}),this.$rootScope.$broadcast("ON_VOICE_MESSAGE_UPDATE_EVENT",this.voiceMessagesCounters)}}return!0}catch(l){return!0}}},{key:"onVoiceMessageManagement",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=$(e).find("visualvoicemail")).length||"abort"!==n.attr("action")){t.next=7;break}r=n.attr("msgid"),i=n.find("error"),this.voiceMessagePromises[r].reject(new Error(i.attr("errordetailscode"))),delete this.voiceMessagePromises[r],this.logger.info("[voiceMessageService] onVoiceMessageManagement - "+r+" - abort - "+i.attr("errormsg")),t.next=18;break;case 7:if(!n.length||"create"!==n.attr("action")){t.next=18;break}if(a=n.attr("msgid"),n.find("url").text(),o=n.find("fileid").text(),this.logger.info("[voiceMessageService] onVoiceMessageManagement - "+a+" - create FileId - "+o),t.t0=this.getVoiceMessageById(a),!t.t0){t.next=18;break}return t.next=16,this.fileStorageService.retrieveVoiceMessageFileDescriptorsListPerOwner();case 16:this.voiceMessagePromises[a].resolve(a),delete this.voiceMessagePromises[a];case 18:return t.abrupt("return",!0);case 21:return t.prev=21,t.t1=t.catch(0),t.abrupt("return",!0);case 24:case"end":return t.stop()}}),t,this,[[0,21]])})))}},{key:"getVoiceMessageById",value:function(e){return this.voiceMessages.find((function(t){return e===t.id}))}},{key:"getVoiceMessagesList",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,i,a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("VVM"===this.telephonyService.agentStatus.features){e.next=2;break}return e.abrupt("return",[]);case 2:return e.prev=2,e.next=5,this.$http({method:"GET",url:this.portalURL+"voicemessages",headers:this.authService.getRequestHeader()});case 5:return t=e.sent,this.voiceMessages=[],n=t.data.data.voicemessages.voiceMessageList,e.next=10,Promise.all(n.map((function(e){return r(a,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.createVoiceMessageFromData(e).catch((function(){}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))})));case 10:return this.voiceMessages=e.sent,this.logger.info("[voiceMessageService] getVoiceMessagesList success - Messages number : "+this.voiceMessages.length),this.voiceMessages.sort((function(e,t){return new Date(t.date).getTime()-new Date(e.date).getTime()})),e.abrupt("return",this.voiceMessages);case 16:throw e.prev=16,e.t0=e.catch(2),i="getVoiceMessagesList failure -- ",i+=e.t0.status?e.t0.status:e.t0.message,this.logger.error("[voiceMessageService] "+i),new Error(i);case 20:case"end":return e.stop()}}),e,this,[[2,16]])})))}},{key:"getVoiceMessagesCounters",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t,n,r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.telephonyService.isSipWiseRoot()){e.next=8;break}return e.next=4,this.$http({method:"GET",url:this.sipWisePortalURL+"messages",headers:this.authService.getRequestHeader()});case 4:return t=e.sent.data,n=Number(t.inbox),r=Number(t.old),e.abrupt("return",(this.voiceMessagesCounters.unread=n,this.voiceMessagesCounters.total=n+r,this.logger.info("[voiceMessageService] getVoiceMessagesCounters success - total : "+this.voiceMessagesCounters.total+" - unread : "+this.voiceMessagesCounters.unread),this.voiceMessagesCounters));case 8:return e.next=10,this.$http({method:"GET",url:this.portalURL+"voicemessages/counters",headers:this.authService.getRequestHeader()});case 10:return i=e.sent.data.data.voicemessages.counters,e.abrupt("return",(this.voiceMessagesCounters.total=parseInt(i.total,10),this.voiceMessagesCounters.unread=parseInt(i.unread,10),this.logger.info("[voiceMessageService] getVoiceMessagesCounters success - total : "+this.voiceMessagesCounters.total+" - unread : "+this.voiceMessagesCounters.unread),this.voiceMessagesCounters));case 14:throw e.prev=14,e.t0=e.catch(0),this.voiceMessageHandleError("getVoiceMessagesCounters",e.t0);case 17:case"end":return e.stop()}}),e,this,[[0,14]])})))}},{key:"getVoiceMessagesUnreadCounter",value:function(){return this.voiceMessagesCounters.unread}},{key:"getVoiceMessagesTotalCounter",value:function(){return this.voiceMessagesCounters.total}},{key:"getVoiceMessageAudioFileURL",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.fileStorageService.getVoiceMessageFileDescriptorByMsgId(e.id))||"deleted"===n.state){t.next=6;break}return t.next=4,this.fileServerService.getBlobFromFileDescriptor(n);case 4:return r=t.sent,t.abrupt("return",URL.createObjectURL(r));case 6:return t.next=8,new Promise((function(t,n){o.voiceMessagePromises[e.id]={resolve:t,reject:n},o.getVoiceMessageFromPBX(e)}));case 8:if(i=t.sent,!(n=this.fileStorageService.getVoiceMessageFileDescriptorByMsgId(i))){t.next=14;break}return t.next=12,this.fileServerService.getBlobFromFileDescriptor(n);case 12:return a=t.sent,t.abrupt("return",URL.createObjectURL(a));case 14:case"end":return t.stop()}}),t,this)})))}},{key:"getVoiceMessageFromPBX",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=this.portalURL+"voicemessages/"+encodeURIComponent(e.id)+"?messageDate="+encodeURIComponent(e.dateString)+"&messageFrom="+encodeURIComponent(e.from),t.next=4,this.$http({method:"GET",url:n,headers:this.authService.getRequestHeader()});case 4:this.logger.info("[voiceMessageService] getVoiceMessageFromPBX success"),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),this.voiceMessageHandleError("getVoiceMessageFromPBX",t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"deleteVoiceMessage",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$http({method:"DELETE",url:this.portalURL+"voicemessages/"+e,headers:this.authService.getRequestHeader()});case 3:this.logger.info("[voiceMessageService] deleteVoiceMessage success"),t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),this.voiceMessageHandleError("deleteVoiceMessage",t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"deleteAllVoiceMessages",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$http({method:"DELETE",url:this.portalURL+"voicemessages/all",headers:this.authService.getRequestHeader()});case 3:this.logger.info("[voiceMessageService] deleteAllVoiceMessages success"),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),this.voiceMessageHandleError("deleteAllVoiceMessages",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})))}},{key:"createVoiceMessageFromData",value:function(e){var t=this;return new Promise((function(n,r){if(e){var i=e.foundidentity,o="",s="",c=e.jid,l=e.from;c||l?t.contactService.getOrCreateContact(c,l).then((function(r){if(t.logger.info("[voiceMessageService] createVoiceMessageFromData otherParticipant jid:"+c+"  Number:"+l+" => contact retrieved (temp:"+r.temp+")"),!c&&r.temp){if(i&&i.length){var u=i.attr("firstName"),d=i.attr("lastName"),h=i.attr("displayName");o=u||"",""===(s=d||"")&&""===o&&h&&0!==h.length&&h!==l&&(s=h),(o.length||s.length)&&(t.logger.debug("[voiceMessageService] createVoiceMessageFromData  xNames updated from directories for contact "+r.id),r.updateName(o,s))}else try{var f=t.$injector.get("centralizedService");f.outlook.updateContactFromOutlookInfos(r,l,!0).then((function(e){e?t.logger.debug("[telephonyService] createVoiceMessageFromData  xNames updated from outlook for contact "+r.id):t.logger.debug("[telephonyService] createVoiceMessageFromData no update from outlook for contact :"+r.id)})).catch((function(e){t.logger.debug("[voiceMessageService] createVoiceMessageFromData  no Outlook search available")}))}catch(v){}var p=!1;t.telephonyService.started&&(p=r.displayName.match(/^[0-9A-D #\-\+\*\(\)\./]{1,32}$/)&&t.telephonyService.startAsPhoneNumber(r.displayName)),p&&r.phoneProCan&&""!==r.phoneProCan&&(r.displayName=r.phoneProCan)}var m=Number.parseInt(e.length,10);n(new a.VoiceMessage(e.id,r,"true"===e.unread,m,e.date,e.from,e.jid))})).catch((function(e){t.voiceMessageErrorHandler("getVoiceMessagesList",r,e),r("reject")})):r("neither otherParticipantJid nor otherParticipantNumber")}else r("no data")}))}},{key:"voiceMessageHandleError",value:function(e,t){var n=e+" -- failure -- ";return n+=t.data?t.data.errorDetails:"Server failure",this.logger.error("[voiceMessageService] "+n),new Error(n)}},{key:"voiceMessageErrorHandler",value:function(e,t,n){n.data?this.logger.error("[voiceMessageService] "+e+" -- failure -- "+n.data.errorDetails):this.logger.error("[voiceMessageService] "+e+" -- failure -- Server failure"),t(n)}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10);t.VoiceMessage=function(){return function e(t,n,i,a,o,s,c){S(this,e),this.id=t,this.contact=n,this.unread=i,this.duration=a,this.date=new Date(o),this.dateString=o,this.from=s,this.jid=c,this.rxSubject=new r.Subject}}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){h(n,e);var t=m(n);function n(e){return S(this,n),t.call(this,e)}return n}(n(362).AgnosticPhonebookService);r.$inject=["rainbowLogger"],t.PhonebookService=r,angular.module("rainbow").service("phonebookService",r)},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(2),o=n(6);t.AgnosticPhonebookService=function(){function e(t){S(this,e),this.logger=t,this.authService=a.default,this.contactService=i.default,this.profileService=o.default,this.isPhonebookSearchAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK)}return C(e,[{key:"search",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK)){t.next=2;break}return t.abrupt("return",[]);case 2:return this.logger.info("search PBXContact from phonebook with pattern "+e),t.prev=3,n="".concat(config.restServerUrl,"/api/rainbow/search/v1.0/phonebooks?limit=20&name=").concat(encodeURIComponent(e)),r=this.authService.getRequestHeader(),t.next=8,fetch(n,{method:"GET",mode:"cors",headers:r});case 8:return i=t.sent,t.next=11,i.json();case 11:return a=t.sent.phoneBooks,t.abrupt("return",a.map((function(e){var t=o.contactService.createBasicContact(null,e.number);return t.updateName(e.firstName,e.lastName),t.getAvatar(),t})));case 15:return t.prev=15,t.t0=t.catch(3),t.abrupt("return",(this.logger.info("search PBXContact from phonebook with pattern ".concat(e," --- FAILURE --- ").concat(t.t0.message)),[]));case 18:case"end":return t.stop()}}),t,this,[[3,15]])})))}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){h(n,e);var t=m(n);function n(e,r,i,a){return S(this,n),t.call(this,e,r,i,a)}return n}(n(364).AgnosticCallLogService);r.$inject=["webrtcGatewayService","telephonyService","$injector","$rootScope"],t.CallLogService=r,angular.module("rainbow").service("callLogService",r)},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(365),a=n(10),o=n(3);n(227);var s=n(1),c=n(4),l=n(6),u=n(15),d=function(){function e(t,n,i,o){var d=this;S(this,e),this.webrtcGatewayService=t,this.telephonyService=n,this.$injector=i,this.$rootScope=o,this.started=!1,this.rxSubject=new a.Subject,this.callLogHandlerRef=null,this.callLogMessageAckRef=null,this.callLogNotificationRef=null,this.usePhonebookDirectory=!1,this.callLogPromises=[],this.numberMissedCallLogs=0,this.callLogs=[],this.aggregatedCallLogs=[],this.xmppService=c.default,this.profileService=l.default,this.logger=u.default,this.contactService=s.default,this.ackAllCallLogsInDBDone=!1,this.onHistoryCallLogMessageReceived=function(t){return r(d,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((r=$(t)).find("call_log").length>0)){n.next=6;break}i=this,r.find("call_log").each((function(t,n){var a=$(n);a.attr("xmlns")===e.CALL_LOG_NOTIF_NAMESPACE&&a.length>0&&i.callLogPromises.push(i.createCallLogFromStanza(r,a))})),n.next=15;break;case 6:if(n.t0=r.find("count").length>0&&r.find("query").length>0&&($(t).find("last").length>0||"0"===r.find("count").text()),!n.t0){n.next=15;break}return $(t).find("last").length&&(this.lastTimestamp=$(t).find("last").text()),this.logger.info("createCallLogFromStanza --- all calllogs received"),n.next=12,Promise.all(this.callLogPromises).catch((function(){}));case 12:this.callLogPromises=[],this.orderCallLogs(),this.startPromise&&(this.started=!0,this.startPromiseResolve(),this.startPromiseResolve=null,this.startPromise=null);case 15:return n.abrupt("return",!0);case 16:case"end":return n.stop()}}),n,this)})))},this.onCallLogAckReceived=function(e){try{if($(e).find("read").length>0){var t=$(e).find("read").attr("call_id");d.callLogs.forEach((function(e){e.id!==t||(e.read=!0)}));var n=d.getMissedCallLogCounter();n!==d.numberMissedCallLogs&&(d.numberMissedCallLogs=n,d.rxSubject.next({type:"ON_CALL_LOG_ACK_UPDATED",value:d.numberMissedCallLogs}))}}catch(r){return d.logger.error("onCallLogAckReceived -- failure --"+r),!0}return!0},this.onCallLogNotificationReceived=function(e){return r(d,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=$(e),t.prev=1,!(n.find("deleted_call_log").length>0)){t.next=14;break}if(!(r=n.find("deleted_call_log").attr("peer"))){t.next=8;break}this.removeCallLogsForUser(r),t.next=12;break;case 8:return this.callLogs=[],t.next=11,this.getCallLogHistoryPage();case 11:this.orderCallLogs();case 12:t.next=19;break;case 14:if(t.t0=n.find("updated_call_log").length>0,!t.t0){t.next=19;break}return t.next=18,this.createCallLogFromStanza(n,null).catch((function(){}));case 18:this.orderCallLogs();case 19:t.next=24;break;case 21:return t.prev=21,t.t1=t.catch(1),t.abrupt("return",(this.logger.error("callLogNotificationReceived -- failure --"+t.t1),!0));case 24:return t.abrupt("return",!0);case 25:case"end":return t.stop()}}),t,this,[[1,21]])})))},this.xmppService.connected&&this.attachXMPPListeners(),this.xmppService.subscribeToConnectionEvents((function(e){"ON_XMPP_CONNECTED"===e.name&&(d.attachXMPPListeners(),"RECONNECTION"===e.data.reason&&d.getCallLogHistoryPage(d.lastTimestamp)),"ON_XMPP_DISCONNECTED"===e.name&&"LOGOUT"===e.data.reason&&(d.numberMissedCallLogs=0,d.callLogs=[],d.aggregatedCallLogs=[],d.started=!1,d.ackAllCallLogsInDBDone=!1)}))}return C(e,[{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"start",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.started?Promise.resolve():(this.startPromise=new Promise((function(e){t.startPromiseResolve=e,t.usePhonebookDirectory=t.profileService.isFeatureEnabled(t.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK)||config.permitSearchFromPhoneBook,t.getCallLogHistoryPage(),t.numberMissedCallLogs>14&&!t.ackAllCallLogsInDBDone&&(t.ackAllCallLogsInDBDone=!0,t.ackAllCallLogsInDB())})),this.startPromise));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"attachXMPPListeners",value:function(){var t=this;this.getMissedCallLogNumber(),this.callLogHandlerRef&&(this.xmppService.connection.deleteHandler(this.callLogHandlerRef),this.callLogHandlerRef=null),this.callLogHandlerRef=this.xmppService.connection.addHandler((function(e){return t.onHistoryCallLogMessageReceived(e)}),e.CALL_LOG_NAMESPACE,null,null),this.callLogNotificationRef&&(this.xmppService.connection.deleteHandler(this.callLogNotificationRef),this.callLogNotificationRef=null),this.callLogNotificationRef=this.xmppService.connection.addHandler((function(e){return t.onCallLogNotificationReceived(e)}),e.CALL_LOG_NOTIF_NAMESPACE,null,null),this.callLogMessageAckRef&&(this.xmppService.connection.deleteHandler(this.callLogMessageAckRef),this.callLogMessageAckRef=null),this.callLogMessageAckRef=this.xmppService.connection.addHandler((function(e){return t.onCallLogAckReceived(e)}),e.CALL_LOG_ACK_NAMESPACE,null,null)}},{key:"getCalllogs",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.start();case 2:return e.abrupt("return",this.callLogs);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getAggregatedCalllogs",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.start();case 2:return e.abrupt("return",this.aggregatedCallLogs);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getSimplifiedCallLogs",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.start();case 2:return e.abrupt("return",this.callLogs.map((function(e){return{contact:e.contact.id,contactDisplayName:e.contact.displayName,read:e.read,contactInitials:e.contact.initials,id:e.id,state:e.state,date:e.date,duration:e.duration,direction:e.direction,type:e.type}})));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getNumberMissedCallLogs",value:function(){return this.numberMissedCallLogs}},{key:"markCallLogAsRead",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=$msg({from:this.xmppService.jid,to:this.xmppService.jid}),n.abrupt("return",(r.c("read",{xmlns:e.CALL_LOG_ACK_NAMESPACE,call_id:t}),this.xmppService.sendIQ(r)));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"markAllCallsLogsAsRead",value:function(){var t=this;this.callLogs.forEach((function(n){if(!n.read){var r=$msg({from:t.xmppService.jid,to:t.xmppService.jid});r.c("read",{xmlns:e.CALL_LOG_ACK_NAMESPACE,call_id:n.id}),t.xmppService.sendIQ(r)}}))}},{key:"deleteCallLogsForContact",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"}),n.abrupt("return",(r.c("delete",{xmlns:e.CALL_LOG_NAMESPACE,peer:t}),this.xmppService.sendIQ(r)));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"deleteOneCallLog",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"}).c("delete",{xmlns:e.CALL_LOG_NAMESPACE,call_id:t}),n.abrupt("return",this.xmppService.sendIQ(r));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"deleteAllCallLogs",value:function(){return r(this,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"}),t.abrupt("return",(n.c("delete",{xmlns:e.CALL_LOG_NAMESPACE}),this.xmppService.sendIQ(n)));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getMissedCallLogNumber",value:function(){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=$iq({from:this.xmppService.jid,type:"set"})).c("query",{xmlns:e.CALL_LOG_NAMESPACE}),n.c("set",{xmlns:"http://jabber.org/protocol/rsm"}),n.c("max").t(0).up().up(),n.c("x",{xmlns:"jabber:x:data",type:"submit"}),n.c("field",{var:"read"}).c("value").t("false").up().up(),t.next=4,this.xmppService.sendIQ(n);case 4:return r=t.sent,t.abrupt("return",(this.numberMissedCallLogs=parseInt($(r).find("count").text(),10),this.rxSubject.next({type:"ON_CALL_LOG_NUMBER_UPDATED",value:this.numberMissedCallLogs}),this.numberMissedCallLogs));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getCallLogHistoryPage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(r=$iq({from:this.xmppService.jid,type:"set"})).c("query",{xmlns:e.CALL_LOG_NAMESPACE}),r.c("set",{xmlns:"http://jabber.org/protocol/rsm"}),r.c("max").t(e.CALL_LOG_MAX).up(),t?r.c("after").t(t).up():r.c("before").t("").up(),n.next=7,this.xmppService.sendIQ(r);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"ackAllCallLogsInDB",value:function(){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.logger.warn("ackAllCallLogsInDB --- used for "+this.numberMissedCallLogs+" call-logs"),(n=$iq({from:this.xmppService.jid,type:"set"})).c("markallread",{xmlns:e.CALL_LOG_NAMESPACE}),t.next=6,this.xmppService.sendIQ(n);case 6:if(r=t.sent,!$(r).find("error").length){t.next=9;break}return t.abrupt("return",void this.logger.warn("ackAllCallLogsInDB --- error ..."));case 9:return t.next=11,this.getMissedCallLogNumber();case 11:t.next=16;break;case 13:return t.prev=13,t.t0=t.catch(0),t.abrupt("return",void this.logger.warn("ackAllCallLogsInDB --- error ..."));case 16:case"end":return t.stop()}}),t,this,[[0,13]])})))}},{key:"orderCallLogs",value:function(){this.callLogs.sort((function(e,t){return i.CallLog.getDate(t)-i.CallLog.getDate(e)})),this.aggregateCalllogs(),this.$rootScope.$broadcast("ON_CALL_LOG_UPDATED"),this.rxSubject.next({type:"ON_CALL_LOG_UPDATED"});var e=this.getMissedCallLogCounter();e!==this.numberMissedCallLogs&&(this.numberMissedCallLogs=e,this.$rootScope.$broadcast("ON_CALL_LOG_ACK_UPDATED",this.numberMissedCallLogs),this.rxSubject.next({type:"ON_CALL_LOG_ACK_UPDATED",value:this.numberMissedCallLogs}))}},{key:"aggregateCalllogs",value:function(){var e=this,t=0;this.aggregatedCallLogs=[];var n={};this.callLogs.forEach((function(r,i){var a=r.contact.id;if("conference"===r.type)0!==i&&t++,e.aggregatedCallLogs[t]=r,e.aggregatedCallLogs[t].count=1,e.aggregatedCallLogs[t].editable=!1;else if(0===i)n[a]=1,e.aggregatedCallLogs[t]=r,e.aggregatedCallLogs[t].count=1,e.aggregatedCallLogs[t].editable=!0,"missed"===r.state&&"incoming"===r.direction?e.aggregatedCallLogs[t].isMissed=!0:"missed"===r.state&&"outgoing"===r.direction&&(e.aggregatedCallLogs[t].isNotAnswered=!0);else if(n[a]){var o=n[a],s=e.aggregatedCallLogs[o-1];s.editable&&(s.isMissed&&"missed"===r.state&&"incoming"===r.direction||s.isNotAnswered&&"missed"===r.state&&"outgoing"===r.direction?s.count++:s.editable=!1)}else t++,n[a]=t+1,e.aggregatedCallLogs[t]=r,e.aggregatedCallLogs[t].count=1,e.aggregatedCallLogs[t].editable=!0,"missed"===r.state&&"incoming"===r.direction?e.aggregatedCallLogs[t].isMissed=!0:"missed"===r.state&&"outgoing"===r.direction&&(e.aggregatedCallLogs[t].isNotAnswered=!0)}))}},{key:"createCallLogFromStanza",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r,a,s,c,l,u,d,h,f,p,m,v,g,y,S,_,C,w,E,T,k,M,D,x,R,O;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=!1,t?r=!0:t=e,a=t.find("call_id").text(),s=t.find("state").text(),!this.callLogs.some((function(e){return e.id===a||"failed"===s||"ongoing"===s}))){n.next=5;break}return n.abrupt("return",(this.logger.debug("createCallLogFromStanza --- ignore existing of wrong call-log"),null));case 5:if(c=t.find("caller").text(),l=t.find("callee").text(),!(c&&-1!==c.indexOf("janusgateway")||l&&-1!==l.indexOf("janusgateway"))){n.next=8;break}return n.abrupt("return",(this.logger.debug("createCallLogFromStanza --- ignore janusgateway call-log"),null));case 8:if(!(c&&this.webrtcGatewayService.isMediaPillarJid(c)||l&&this.webrtcGatewayService.isMediaPillarJid(l))){n.next=10;break}return n.abrupt("return",(this.logger.debug("createCallLogFromStanza --- ignore mediapillar call-log"),null));case 10:if(u="webrtc",d=null,h=null,f=this.xmppService.isConnectedJid(c),p=f?"outgoing":"incoming",m=!1,(m=r?"conference"===t.attr("service"):"conference"===e.find("call_log").attr("service"))?(u="conference",-1===(d=c).indexOf("@")&&(h=d,d=null)):((v=r?t.attr("type"):e.find("call_log").attr("type"))||(v=e.find("type").text()),"phone"===v&&(u="telephone"),-1===(d=f?l:c).indexOf("@")&&(h=d,d=null,u="telephone")),!d&&!h){n.next=50;break}return n.prev=13,n.next=16,this.contactService.getOrCreateContact(d,h);case 16:if(g=n.sent,m||d||!g.temp){n.next=39;break}if(!(y=this.usePhonebookDirectory?t.find("identity"):null)||!y.length){n.next=24;break}S=y.attr("firstName"),_=y.attr("lastName"),C=y.attr("displayName"),w=S||"",""===(E=_||"")&&""===w&&C&&0!==C.length&&C!==h&&(E=C),(w.length||E.length)&&(this.logger.debug("createCallLogFromStanza xNames updated from phonebook for contact "+g.id),g.updateName(w,E)),n.next=36;break;case 24:return n.prev=24,T=this.$injector.get("centralizedService"),n.next=28,T.outlook.updateContactFromOutlookInfos(g,h,!0);case 28:if(n.t0=n.sent,!n.t0){n.next=31;break}this.logger.debug("createCallLogFromStanza xNames updated from outlook for contact "+g.id);case 31:n.next=36;break;case 33:n.prev=33,n.t1=n.catch(24),this.logger.debug("createCallLogFromMessage no outlook service :"+g.id);case 36:k=!1,this.telephonyService.started&&(k=g.displayName.match(/^[0-9A-D #\-\+\*\(\)\./]{1,32}$/)&&this.telephonyService.startAsPhoneNumber(g.displayName)),k&&g.phoneProCan&&""!==g.phoneProCan&&(g.displayName=g.phoneProCan);case 39:M="true"===t.find("ack").attr("read"),D=(D=parseInt(t.find("duration").text(),10))>0?o.duration(D,"ms").format("h[H] mm[m] ss[s]"):0,(x=e.find("delay").attr("stamp"))&&(x=new Date(x)),R=e.find("subject").text(),O=i.CallLog.create(a,g,s,D,u,M,x,p,R,!1),this.callLogs.push(O),"answered"!==s||M||this.markCallLogAsRead(a),n.next=50;break;case 47:n.prev=47,n.t2=n.catch(13),this.logger.error("createCallLogFromStanza -- failure --- "+n.t2);case 50:case"end":return n.stop()}}),n,this,[[13,47],[24,33]])})))}},{key:"getMissedCallLogCounter",value:function(){var e=0;return this.callLogs.forEach((function(t){t.read||"missed"!==t.state||"incoming"!==t.direction||e++})),e}},{key:"removeCallLogsForUser",value:function(e){e.endsWith("@_")&&(e=e.substring(0,e.length-2));for(var t=[],n=0;n<this.callLogs.length;n++)(!this.callLogs[n].contact||this.callLogs[n].contact.jid!==e&&this.callLogs[n].contact.id!==e)&&t.push(this.callLogs[n]);this.callLogs=t,this.orderCallLogs()}}]),e}();d.CALL_LOG_NAMESPACE="jabber:iq:telephony:call_log",d.CALL_LOG_ACK_NAMESPACE="urn:xmpp:telephony:call_log:receipts",d.CALL_LOG_NOTIF_NAMESPACE="jabber:iq:notification:telephony:call_log",d.CALL_LOG_MAX=75,t.AgnosticCallLogService=d},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n,r,i,a,o,s,c,l,u){S(this,e),this.count=0,this.editable=!1,this.isMissed=!1,this.isNotAnswered=!1,this.id=t,this.contact=n,this.state=r,this.duration=i,this.type=a,this.read=o,this.date=s,this.direction=c,this.callSubject=l,this.isLatestCall=u,this.type="unknown"===a||"audio"===a||"webrtc"===a?e.Type.WEBRTC:"telephone"===a?e.Type.TELEPHONE:e.Type.CONFERENCE}return C(e,[{key:"updateCallLogDisplayInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];"incoming"===this.direction?(this.svgClass="missed"===this.state?"missed":"active",this.svgId="call_made","forwarded"===this.state?(this.svgId="call_missed",this.title="incomingCallForwarded"):this.title="incommingCall","missed"===this.state&&(this.title=e&&this.count>1?"missedCalls":"missedCall")):(this.svgId="call_received",this.title="outgoingCall",this.svgClass="active","missed"===this.state&&(this.svgClass="",this.title=e&&this.count>1?"noAnswers":"noAnswer"))}}],[{key:"create",value:function(t,n,r,i,a,o,s,c,l,u){return new e(t,n,r,i,a,o,s,c,l,u)}},{key:"getNames",value:function(e){var t="",n="",r=null;return e&&e.contact&&(t=e.contact.firstname.toUpperCase(),n=e.contact.lastname.toUpperCase(),r=e.date?e.date.getTime():null),{firstname:t,lastname:n,date:r}}},{key:"getDate",value:function(e){return e&&e.date?e.date.getTime():0}},{key:"sortByContact",value:function(e,t){var n=-1;if(e&&e.value.lastname&&t&&t.value.lastname){var r=e.value.lastname,i=t.value.lastname;0===(n=r.localeCompare(i))&&(r=e.value.firstname,i=t.value.firstname,0===(n=r.localeCompare(i))&&t.value.date&&e.value.date&&(n=t.value.date-e.value.date))}return n}},{key:"sortByDate",value:function(e,t){var n=1;return e&&t&&(n=t.value-e.value),n}}]),e}();r.Type={WEBRTC:"webrtc",TELEPHONE:"telephone",CONFERENCE:"conference"},t.CallLog=r},function(e,t,n){n.r(t);var r=n(5),i=n.n(r),a=n(1),o=n.n(a),s=n(6),c=n.n(s);angular.module("rainbow").service("ringingService",["$q","$log","$rootScope","$interval","platformService",function(e,t,n,r,a){var s=this,l=[],u=[];s.start=function(r){var a=performance.now();t.info("[ringingService] STARTING"),s.notifs=["noSound","ding","harp","hello","complete","duck","appointed","chime","stairs","wet","wilhelm","important"],s.alarms=["noRingtone","lightBounce","discovery","lounge","uptown","morningLights","miami","farEast","highSpeed","rainDrops","deepSpace","steamTrain","happy","decrescendo","strident","peacefulness","classic1","classic2","classic3","cosy1","cosy2","cosy3","dynamic1","dynamic2","dynamic3","quiet1","quiet2","quiet3","relax1","relax2","relax3"];var d=new Audio;n.canPlayOgg=Boolean(d.canPlayType)&&Boolean(d.canPlayType('audio/ogg; codecs="vorbis"')),s.audioFileType=n.canPlayOgg?".ogg":".mp3",d=null,s.ringbackTone={audio:new Audio,starting:!1,id:"ringbackTone"},s.recordTone=new Audio("/resources/sounds/beep-01a"+s.audioFileType),s.SecondCallTone=new Audio("/resources/sounds/start"+s.audioFileType),s.joinWebConfTone=new Audio("/resources/sounds/join_meeting"+s.audioFileType),s.holdTone={audio:new Audio("/resources/sounds/hold-tone"+s.audioFileType),starting:!1},s.pushToTalkActivateTone=new Audio("/resources/sounds/ptt_activate"+s.audioFileType),s.pushToTalkDeactivateTone=new Audio("/resources/sounds/ptt_deactivate"+s.audioFileType),s.ringbackTone.audio.onloadeddata=function(){t.info("[ringingService] === ringbackTone -- loaded")},s.ringbackTone.audio.oncanplay=function(){t.info("[ringingService] === ringbackTone -- oncanplay ")},s.ringbackTone.audio.onerror=function(){t.error("[ringingService] === ringbackTone -- onerror ")},s.ringbackTone.audio.src="/resources/sounds/outgoing-rings"+s.audioFileType,s.holdTone.audio.loop=!0,s.alarmNotifOnce=null,s.informationImSound=o.a.userContact.customData.informationImSound,s.informationImSound||(s.informationImSound=i.a.getSetting("informationImSound")),s.importantImSound=o.a.userContact.customData.importantImSound,s.importantImSound||(s.importantImSound=i.a.getSetting("importantImSound")),s.manageEmergencyNotifs(),s.setActive(i.a.settings.activeNotif,i.a.settings.activeAlarm,s.informationImSound,s.importantImSound);var h=Math.round(performance.now()-a);return r.push({service:"ringingService",startDuration:h}),t.info("[ringingService] === STARTED ("+h+" ms) ==="),l.push(n.$on("ON_WEB_CONFENRECE_PARTICIPANT_JOINED_EVENT",s.playWebConferenceJoinNotif)),l.push(n.$on("ON_PRESS_PUSH_TO_TALK_EVENT",s.playActivatePtT)),l.push(n.$on("ON_RELEASE_PUSH_TO_TALK_EVENT",s.playDeactivatePtT)),u.push(c.a.subscribe((function(){s.manageEmergencyNotifs()}))),e.when()},s.setActive=function(e,n,r,i){s.activeNotif=e,s.activeAlarm=n,"noSound"!==e?(s.pingAudio=new Audio("/resources/sounds/notifs/"+s.activeNotif+s.audioFileType),s.pingAudioSecondary=new Audio("/resources/sounds/notifs/"+s.activeNotif+s.audioFileType)):(s.pingAudio=null,s.pingAudioSecondary=null,t.info("Notif sound set to null")),"noRingtone"!==n?(s.incomingRingingTone={audio:new Audio,starting:!1,id:"incomingRingingTone"},s.incomingRingingSecondaryTone={audio:new Audio("/resources/sounds/alarms/"+s.activeAlarm+s.audioFileType),starting:!1,id:"incomingRingingSecondaryTone"},s.incomingRingingTone.audio.onloadeddata=function(){t.info("[ringingService] === incomingRingingTone -- loaded")},s.incomingRingingTone.audio.oncanplay=function(){t.info("[ringingService] === incomingRingingTone -- oncanplay ")},s.incomingRingingTone.audio.onerror=function(e){t.error("[ringingService] === incomingRingingTone -- onerror "),e&&e.target&&e.target.error&&t.error("[ringingService] === incomingRingingTone -- onerror msg "+e.target.error.message)},s.incomingRingingTone.audio.src="/resources/sounds/alarms/"+s.activeAlarm+s.audioFileType):(s.incomingRingingTone=null,s.incomingRingingSecondaryTone=null,t.info("Ringtone sound set to null")),"noSound"!==r?(s.informationImSoundAudio=new Audio("/resources/sounds/notifs/"+s.informationImSound+s.audioFileType),s.informationImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+s.informationImSound+s.audioFileType)):(s.informationImSoundAudio=null,s.informationImSoundAudioSecondary=null,t.info("Information notif sound set to null")),"noSound"!==i?(s.importantImSoundAudio=new Audio("/resources/sounds/notifs/"+s.importantImSound+s.audioFileType),s.importantImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+s.importantImSound+s.audioFileType)):(s.importantImSoundAudio=null,s.importantImSoundAudioSecondary=null,t.info("Important notif sound set to null"))},s.manageEmergencyNotifs=function(){s.emergencyAlarms=["noSound","pager1"],c.a.isFeatureEnabled(c.a.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)&&(s.emergencyAlarms=["noSound","emergency"]),s.emergencyImSound=o.a.userContact.customData.emergencyImSound,s.emergencyImSound||(s.emergencyImSound=i.a.getSetting("emergencyImSound")),s.setEmergencyAlarm()},s.setEmergencyAlarm=function(){var e=!1;(!c.a.isFeatureEnabled(c.a.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)||"noSound"!==s.emergencyImSound&&-1!==s.emergencyAlarms.indexOf(s.emergencyImSound))&&(c.a.isFeatureEnabled(c.a.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)||-1!==s.emergencyAlarms.indexOf(s.emergencyImSound))||(e=!0),e&&(s.emergencyImSound=s.emergencyAlarms[1],o.a.userContact.customData.emergencyImSound=s.emergencyImSound,o.a.updateUserContact({customData:o.a.userContact.customData})),"noSound"!==s.emergencyImSound?(s.emergencyImSoundAudio=new Audio("/resources/sounds/notifs/"+s.emergencyImSound+s.audioFileType),s.emergencyImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+s.emergencyImSound+s.audioFileType)):(s.emergencyImSoundAudio=null,s.emergencyImSoundAudioSecondary=null,t.info("Emergency notif sound set to null"))},s.stop=function(){var n;for(t.info("[ringingService] STOPPING"),t.info("[ringingService] STOPPED");n=l.pop();)n();return u.forEach((function(e){e.unsubscribe()})),s.ringbackTone&&(s.ringbackTone.starting=!1),s.incomingRingingTone&&(s.incomingRingingTone.starting=!1),s.incomingRingingSecondaryTone&&(s.incomingRingingSecondaryTone.starting=!1),s.ringbackTone=null,s.recordTone=null,s.SecondCallTone=null,s.joinWebConfTone=null,s.holdTone=null,s.alarmNotifOnce=null,s.informationImSound=null,s.importantImSound=null,s.emergencyImSoundAudio=null,s.emergencyImSoundAudioSecondary=null,s.informationImSoundAudio=null,s.informationImSoundAudioSecondary=null,s.importantImSoundAudio=null,s.importantImSoundAudioSecondary=null,s.pingAudio=null,s.pingAudioSecondary=null,s.incomingRingingTone=null,s.incomingRingingSecondaryTone=null,s.pushToTalkActivateTone=null,s.pushToTalkDeactivateTone=null,e.when()},s.stopIncomingWebrtcSounds=function(){s.stopWebrtcSounds=!0},s.onMyProfileFeaturesChanged=function(){},s.setActiveAlarm=function(e){t.info("[ringingService] setActiveAlarm to "+e),s.activeAlarm=e,o.a.setUserSettings({activeAlarm:s.activeAlarm}),"noRingtone"!==e?(s.incomingRingingTone={audio:new Audio,starting:!1,id:"incomingRingingTone"},s.incomingRingingSecondaryTone={audio:new Audio("/resources/sounds/alarms/"+s.activeAlarm+s.audioFileType),starting:!1,id:"incomingRingingSecondaryTone"},s.incomingRingingTone.audio.onloadeddata=function(){t.info("[ringingService] === incomingRingingTone -- loaded")},s.incomingRingingTone.audio.oncanplay=function(){t.info("[ringingService] === incomingRingingTone -- oncanplay ")},s.incomingRingingTone.audio.onerror=function(e){t.error("[ringingService] === incomingRingingTone -- onerror "),e&&e.target&&e.target.error&&t.error("[ringingService] === incomingRingingTone -- onerror msg "+e.target.error.message)},s.incomingRingingTone.audio.src="/resources/sounds/alarms/"+s.activeAlarm+s.audioFileType):(s.incomingRingingTone=null,s.incomingRingingSecondaryTone=null,t.info("Ringtone sound set to null"))},s.playAlarmOnce=function(e){t.info("[ringingService] playAlarmOnce "+e.name),null!==s.alarmNotifOnce&&s.alarmNotifOnce.pause(),s.alarmNotifOnce=new Audio("/resources/sounds/alarms/"+e.name+s.audioFileType),s.alarmNotifOnce.currentTime=0,s.alarmNotifOnce.play(),s.addEvents(s.alarmNotifOnce,e)},s.alarmCurPlay=function(){return s.alarmNotifOnce instanceof Audio},s.addEvents=function(e,t){e.onended=function(){s.alarmNotifOnce=null,t.iconPlayer="play"}},s.stopAlarmOnce=function(){t.info("[ringingService] stopAlarmOnce"),s.alarmNotifOnce&&(s.alarmNotifOnce.pause(),s.alarmNotifOnce=null)},s.playNotifOnce=function(e){t.info("[ringingService] playNotifOnce "+e.name),s.audioNotifOnce=new Audio("/resources/sounds/notifs/"+e.name+s.audioFileType),s.audioNotifOnce.currentTime=0,s.audioNotifOnce.play(),s.addEvents(s.audioNotifOnce,e)},s.notifCurPlay=function(){return s.audioNotifOnce instanceof Audio},s.stopNotifOnce=function(){t.info("[ringingService] stopNotifOnce"),s.audioNotifOnce.pause(),s.audioNotifOnce=null},s.setActiveNotif=function(e){t.info("[ringingService] setActiveNotif to "+e),s.activeNotif=e,o.a.setUserSettings({activeNotif:s.activeNotif}),"noSound"!==e?(s.pingAudio=new Audio("/resources/sounds/notifs/"+s.activeNotif+s.audioFileType),s.pingAudioSecondary=new Audio("/resources/sounds/notifs/"+s.activeNotif+s.audioFileType)):(s.pingAudio=null,s.pingAudioSecondary=null,t.info("Notif sound set to null"))},s.setInformationImSound=function(e){t.info("[ringingService] setInformationImSound to "+e),s.informationImSound=e,i.a.setSetting("informationImSound",e),o.a.userContact.customData.informationImSound=e,o.a.updateUserContact({customData:o.a.userContact.customData}),"noSound"!==e?(s.informationImSoundAudio=new Audio("/resources/sounds/notifs/"+s.informationImSound+s.audioFileType),s.informationImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+s.informationImSound+s.audioFileType)):(s.informationImSoundAudio=null,s.informationImSoundAudioSecondary=null)},s.setImportantImSound=function(e){t.info("[ringingService] setImportantImSound to "+e),s.importantImSound=e,i.a.setSetting("importantImSound",e),o.a.userContact.customData.importantImSound=e,o.a.updateUserContact({customData:o.a.userContact.customData}),"noSound"!==e?(s.importantImSoundAudio=new Audio("/resources/sounds/notifs/"+s.importantImSound+s.audioFileType),s.importantImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+s.importantImSound+s.audioFileType)):(s.importantImSoundAudio=null,s.importantImSoundAudioSecondary=null)},s.setEmergencyImSound=function(e){t.info("[ringingService] setEmergencyImSound to "+e),s.emergencyImSound=e,i.a.setSetting("emergencyImSound",e),o.a.userContact.customData.emergencyImSound=e,o.a.updateUserContact({customData:o.a.userContact.customData}),"noSound"!==e?(s.emergencyImSoundAudio=new Audio("/resources/sounds/notifs/"+s.emergencyImSound+s.audioFileType),s.emergencyImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+s.emergencyImSound+s.audioFileType)):(s.emergencyImSoundAudio=null,s.emergencyImSoundAudioSecondary=null)},s.stopUrgencyNotif=function(){t.info("[ringingService] stopUrgencyNotif"),s.emergencyImSoundAudio&&(s.emergencyImSoundAudio.pause(),s.emergencyImSoundAudio=null),s.emergencyImSoundAudioSecondary&&(s.emergencyImSoundAudioSecondary.pause(),s.emergencyImSoundAudioSecondary=null)},s.playCustomNotif=function(e){var n,r;if(s.stopWebrtcSounds)t.info("[ringingService] playImNotif is blocked ...");else if("std"===e||"high"===e&&!o.a.userContact.alertNotificationEnabledForMyCompany)s.playImNotif();else{switch(e){case"low":n=s.informationImSoundAudio,r=s.informationImSoundAudioSecondary;break;case"middle":n=s.importantImSoundAudio,r=s.importantImSoundAudioSecondary;break;case"high":s.emergencyImSoundAudio&&s.emergencyImSoundAudio.pause(),s.emergencyImSoundAudio=new Audio("/resources/sounds/notifs/"+s.emergencyImSound+s.audioFileType),s.emergencyImSoundAudio.currentTime=0,c.a.isFeatureEnabled(c.a.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)&&(s.emergencyImSoundAudio.loop=!0),n=s.emergencyImSoundAudio,r=s.emergencyImSoundAudioSecondary;break;default:return void s.playImNotif()}a.allowDevicesManagement()?("true"===a.getSecondRingerStatusFromSettings()&&a.getRingingSpeaker().then((function(e){e&&a.setSpeakerForElement(r,e.id).then((function(){r.play()}))})),a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(n,e.id).then((function(){n.play()})):n.play()}))):n.play()}},s.play=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e&&e.audio){if(n||(n=0),4!==e.audio.readyState){if(n<3)return t.warn("[ringingService] play tone for id "+e.id+" is not ready -- retry in 1 sec"),void r((function(e,t){t+=1,s.play(e,t)}),1e3,1,!0,e,n);if("incomingRingingTone"===e.id){t.warn("[ringingService] play tone for id "+e.id+" does not load.. try another type");var i=".ogg"===s.audioFileType?".mp3":".ogg";return s.incomingRingingTone={audio:new Audio("/resources/sounds/alarms/"+s.activeAlarm+i),starting:!1,id:"incomingRingingTone"},void s.play(s.incomingRingingTone)}if("incomingRingingSecondaryTone"===e.id){t.warn("[ringingService] play tone for id "+e.id+" does not load.. try another type");var a=".ogg"===s.audioFileType?".mp3":".ogg";return s.incomingRingingSecondaryTone={audio:new Audio("/resources/sounds/alarms/"+s.activeAlarm+a),starting:!1,id:"incomingRingingSecondaryTone"},void s.play(s.incomingRingingSecondaryTone)}t.warn("[ringingService] play tone for id "+e.id+" is not ready -- try to play it anyway")}var o=e.audio.play();o&&"function"==typeof o.finally?o.then((function(){t.info("[ringingService] play for id "+e.id+" ok")})).catch((function(n){t.error("[ringingService] play for id "+e.id+" error: "+n)})).finally((function(){e.starting=!1})):(t.info("[ringingService] (no promise) play for id "+e.id+" ok"),e.starting=!1)}else t.warn("[ringingService] play tone is missing -- return")},s.startRingBackTone=function(e){e&&s.stopWebrtcSounds?t.info("[ringingService] startRingBackTone is blocked for webrtc calls ..."):(t.info("[ringingService] startRingBackTone ..."),s.ringbackTone&&s.ringbackTone.stopDefered&&(t.info("[ringingService] startRingBackTone: cancel defered stop operation"),r.cancel(s.ringbackTone.stopDefered),s.ringbackTone.stopDefered=void 0),s.ringbackTone&&s.ringbackTone.audio&&s.ringbackTone.audio.paused&&!s.ringbackTone.starting?(t.info("[ringingService] startRingBackTone currently paused"),s.ringbackTone.starting=!0,s.ringbackTone.audio.currentTime=0,a.allowDevicesManagement()?a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.ringbackTone.audio,e.id).catch((function(){t.error("[ringingService] startRingBackTone setSpeakerForElement -- error. Play on default device")})).finally((function(){t.info("[ringingService] startRingBackTone play"),s.play(s.ringbackTone)})):(t.info("[ringingService] startRingBackTone play (no speaker)"),s.play(s.ringbackTone))})).catch((function(){t.webrtc("[ringingService] startRingBackTone getCurrentSpeaker error"),s.ringbackTone.starting=!1})):(t.info("[ringingService] startRingBackTone play (no devices management)"),s.play(s.ringbackTone))):t.info("[ringingService] startRingBackTone -- nothing to do (already starting or playing)"))},s.stopRingBackTone=function(e){if(t.debug("[ringingService] stopRingBackTone ..."),s.ringbackTone){if(s.ringbackTone.starting)return void(s.ringbackTone.stopDefered?t.debug("[ringingService] stopRingBackTone: nothing to do : stop already defered"):(e||(e=1),t.debug("[ringingService] stopRingBackTone: tone still starting: defer stop 1s later"),s.ringbackTone.stopDefered=r(s.stopRingBackToneDefered,1e3,1,!0,e)));s.ringbackTone.stopDefered=void 0,s.ringbackTone.audio&&!s.ringbackTone.audio.paused?(t.info("[ringingService] stopRingBackTone: tone is playing: stop it"),s.ringbackTone.audio.pause(),s.ringbackTone.audio.currentTime=0):t.debug("[ringingService] stopRingBackTone: nothing to do : tone is already stopped")}},s.stopRingBackToneDefered=function(e){s.ringbackTone.stopDefered=void 0,(e+=1)>=3?s.ringbackTone.audio&&(t.info("[ringingService] stopRingBackToneDefered: tone is blocked on starting, stop it"),s.ringbackTone.audio.pause(),s.ringbackTone.audio.currentTime=0,s.ringbackTone.audio.src="",s.ringbackTone.audio.src="/resources/sounds/outgoing-rings"+s.audioFileType):s.stopRingBackTone(e)},s.startIncomingRinging=function(e){e&&s.stopWebrtcSounds?t.info("[ringingService] startIncomingRinging is blocked for webrtc calls ..."):(t.info("[ringingService] startIncomingRinging ..."),s.incomingRingingTone&&s.incomingRingingTone.stopDefered&&(t.info("[ringingService] startIncomingRinging: cancel defered stop operation"),r.cancel(s.incomingRingingTone.stopDefered),s.incomingRingingTone.stopDefered=void 0),s.incomingRingingTone&&s.incomingRingingTone.audio&&s.incomingRingingTone.audio.paused&&!s.incomingRingingTone.starting?(t.info("[ringingService] startIncomingRinging currently paused"),s.incomingRingingTone.starting=!0,s.incomingRingingTone.audio.loop=!0,s.incomingRingingTone.audio.currentTime=0,a.allowDevicesManagement()?("true"===a.getSecondRingerStatusFromSettings()&&(s.incomingRingingSecondaryTone.starting=!0,s.incomingRingingSecondaryTone.audio.loop=!0,s.incomingRingingSecondaryTone.audio.currentTime=0,a.getRingingSpeaker().then((function(e){e&&a.setSpeakerForElement(s.incomingRingingSecondaryTone.audio,e.id).then((function(){t.info("[ringingService] startIncomingRinging secondary device -- play"),s.play(s.incomingRingingSecondaryTone)}))})).catch((function(){t.webrtc("[ringingService] startIncomingRinging secondary getRingingSpeaker error"),s.incomingRingingSecondaryTone.starting=!1}))),a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.incomingRingingTone.audio,e.id).catch((function(){t.error("[ringingService] startIncomingRinging setSpeakerForElement -- error. Play on default device")})).finally((function(){t.info("[ringingService] startIncomingRinging -- play"),s.play(s.incomingRingingTone)})):(t.info("[ringingService] startIncomingRinging -- play (no speaker)"),s.play(s.incomingRingingTone))})).catch((function(){t.webrtc("[ringingService] startIncomingRinging getCurrentSpeaker error"),s.incomingRingingTone.starting=!1}))):(t.info("[ringingService] startIncomingRinging -- play (no devices management)"),s.play(s.incomingRingingTone))):t.info("[ringingService] startIncomingRinging -- nothing to do (already starting or playing)"))},s.stopIncomingRinging=function(e){if(t.debug("[ringingService] stopIncomingRinging ..."),s.incomingRingingTone){if(s.incomingRingingTone.starting)return void(s.incomingRingingTone.stopDefered?t.debug("[ringingService] stopIncomingRinging: nothing to do : stop already defered"):(e||(e=1),t.debug("[ringingService] stopIncomingRinging: tone still starting: defer stop 1s later"),s.incomingRingingTone.stopDefered=r(s.stopIncomingRingingDefered,1e3,1,!0,e)));s.incomingRingingTone.stopDefered=void 0,s.incomingRingingTone.audio&&!s.incomingRingingTone.audio.paused?(t.info("[ringingService] stopIncomingRinging: tone is playing: stop it"),s.incomingRingingTone.audio.pause(),s.incomingRingingTone.audio.currentTime=0):t.debug("[ringingService] stopIncomingRinging: nothing to do : tone is already stopped")}s.incomingRingingSecondaryTone&&s.incomingRingingSecondaryTone.audio&&!s.incomingRingingSecondaryTone.audio.paused&&(t.info("[ringingService] stopIncomingRinging: secondary tone is playing: stop it"),s.incomingRingingSecondaryTone.audio.pause(),s.incomingRingingSecondaryTone.audio.currentTime=0)},s.stopIncomingRingingDefered=function(e){s.incomingRingingTone.stopDefered=void 0,(e+=1)>=3?s.incomingRingingTone.audio&&(t.info("[ringingService] stopIncomingRingingDefered: tone is blocked on starting, stop it"),s.incomingRingingTone.audio.pause(),s.incomingRingingTone.audio.currentTime=0,s.incomingRingingTone.audio.src="",s.incomingRingingTone.audio.src="/resources/sounds/alarms/"+s.activeAlarm+s.audioFileType):s.stopIncomingRinging(e)},s.playImNotif=function(){s.stopWebrtcSounds?t.info("[ringingService] playImNotif is blocked ..."):"busy"!==o.a.userContact.status||"audio"!==o.a.userContact.message&&"video"!==o.a.userContact.message&&"sharing"!==o.a.userContact.message&&"presentation"!==o.a.userContact.message?i.a.getSetting("imSound")&&s.pingAudio&&(t.info("[ringingService] playImNotif"),s.pingAudio.currentTime=0,s.pingAudioSecondary.currentTime=0,a.allowDevicesManagement()?("true"===a.getSecondRingerStatusFromSettings()&&a.getRingingSpeaker().then((function(e){e&&a.setSpeakerForElement(s.pingAudioSecondary,e.id).then((function(){s.pingAudioSecondary.play()}))})),a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.pingAudio,e.id).then((function(){s.pingAudio.play()})):s.pingAudio.play()}))):s.pingAudio.play()):t.info("[ringingService] playImNotif aborted due to communication Activity")},s.playRecordTone=function(){t.info("[ringingService] playRecordTone"),s.recordTone.currentTime=0,a.allowDevicesManagement()?a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.recordTone,e.id).then((function(){s.recordTone.play()})):s.recordTone.play()})):s.recordTone.play()},s.playSecondCallTone=function(){t.info("[ringingService] playSecondCallTone"),s.SecondCallTone.currentTime=0,a.allowDevicesManagement()?a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.SecondCallTone,e.id).then((function(){s.SecondCallTone.play()})):s.SecondCallTone.play()})):s.SecondCallTone.play()},s.playWebConferenceJoinNotif=function(){t.info("[ringingService] playWebConferenceJoinNotif"),s.joinWebConfTone&&"true"===i.a.getSetting("joinSfuSound")&&(s.joinWebConfTone.currentTime=0,a.allowDevicesManagement()?a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.joinWebConfTone,e.id).then((function(){s.joinWebConfTone.play()})):s.joinWebConfTone.play()})):s.joinWebConfTone.play())},s.playHoldTone=function(){t.info("[ringingService] playHoldTone..."),s.holdTone&&s.holdTone.stopDefered&&(t.info("[ringingService] playHoldTone: cancel defered stop operation"),r.cancel(s.holdTone.stopDefered),s.holdTone.stopDefered=void 0),s.holdTone&&s.holdTone.audio&&s.holdTone.audio.paused&&!s.holdTone.starting?(s.holdTone.starting=!0,s.holdTone.audio.currentTime=0,a.allowDevicesManagement()?a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.holdTone.audio,e.id).catch((function(){t.error("[ringingService] playHoldTone setSpeakerForElement -- error. Play on default device")})).finally((function(){t.info("[ringingService] playHoldTone play"),s.play(s.holdTone)})):(t.info("[ringingService] playHoldTone play (no speaker)"),s.play(s.holdTone))})).catch((function(){t.webrtc("[ringingService] playHoldTone getCurrentSpeaker error"),s.holdTone.starting=!1})):(t.info("[ringingService] playHoldTone play (no devices management)"),s.play(s.holdTone))):t.info("[ringingService] playHoldTone -- nothing to do (already starting or playing)")},s.stopHoldTone=function(){if(t.debug("[ringingService] stopHoldTone ..."),s.holdTone){if(s.holdTone.starting)return void(s.holdTone.stopDefered?t.debug("[ringingService] stopHoldTone: nothing to do : stop already defered"):(t.debug("[ringingService] stopHoldTone: tone still starting: defer stop 1s later"),s.holdTone.stopDefered=r(s.stopHoldToneDefered,1e3,1)));s.holdTone.stopDefered=void 0,s.holdTone.audio&&!s.holdTone.audio.paused?(t.info("[ringingService] stopHoldTone: tone is playing: stop it"),s.holdTone.audio.pause(),s.holdTone.audio.currentTime=0):t.debug("[ringingService] stopHoldTone: nothing to do : tone is already stopped")}},s.stopHoldToneDefered=function(){s.holdTone.stopDefered=void 0,s.stopHoldTone()},s.playActivatePtT=function(){s.pushToTalkActivateTone&&o.a.userContact.customData.enablePushToTalkTone&&(s.pushToTalkActivateTone.currentTime=0,a.allowDevicesManagement()?a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.pushToTalkActivateTone,e.id).then((function(){s.pushToTalkActivateTone.play()})):s.pushToTalkActivateTone.play()})):s.pushToTalkActivateTone.play())},s.playDeactivatePtT=function(){s.pushToTalkDeactivateTone&&o.a.userContact.customData.enablePushToTalkTone&&(s.pushToTalkDeactivateTone.currentTime=0,a.allowDevicesManagement()?a.getCurrentSpeaker().then((function(e){e?a.setSpeakerForElement(s.pushToTalkDeactivateTone,e.id).then((function(){s.pushToTalkDeactivateTone.play()})):s.pushToTalkDeactivateTone.play()})):s.pushToTalkDeactivateTone.play())}}])},function(e,t,n){n.r(t);var r=n(0),i=n(2),a=n.n(i),o=n(14),s=n.n(o),c=n(1),l=n.n(c);angular.module("rainbow").service("telephonyServiceSipWise",["$q","$interval","$http","$rootScope","$log","errorHelperService","$injector",function(e,t,n,i,o,c,u){var d=this;d.portalURL=config.restServerUrl+"/api/rainbow/voice/v1.0/",d.portalAdminURL=config.restServerUrl+"/api/rainbow/rvcpprovisioning/v1.0/",d.sipWiseRoutingObject={sipWiseDevicesList:[],ringingDestinations:[],alsoOfficePhoneRingEnabled:!0},d.resetSipWiseRoutingObject=function(){d.sipWiseRoutingObject={sipWiseDevicesList:[],ringingDestinations:[],alsoOfficePhoneRingEnabled:!0}},d.getPortalURLSipWise=function(){return d.portalURL},d.resetDevicesListSipWise=function(){d.sipWiseDevicesList=[]},d.getDevicesListSipWise=function(){return d.sipWiseRoutingObject.sipWiseDevicesList.length<1&&o.info("[telephonyServiceSipWise] getDevicesListSipWise : Anomaly API getUserDevices not yet performed"),d.sipWiseRoutingObject.sipWiseDevicesList},d.getDevicesIdFromListSipWiseWithType=function(e){if(d.sipWiseRoutingObject.sipWiseDevicesList.length<1)return o.info("[telephonyServiceSipWise] getDevicesIdFromListSipWiseWithType : Anomaly API getUserDevices not yet performed"),null;if("sip"!==e&&"webrtc"!==e)return o.info("[telephonyServiceSipWise] getDevicesIdFromListSipWiseWithType : Anomaly wrong device type"),null;var t=d.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(t){return t.type===e}));return-1!==t?d.sipWiseRoutingObject.sipWiseDevicesList[t].deviceId:(o.info("[telephonyServiceSipWise] getDevicesIdFromListSipWiseWithType : device type "+e+" not found"),null)},d.getCurrentFromDevicesListSipWise=function(){if(d.sipWiseRoutingObject.sipWiseDevicesList.length<1)return o.info("[telephonyServiceSipWise] getCurrentFromDevicesListSipWise : Anomaly API getUserDevices not yet performed"),null;var e=d.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(e){return e.main}));return-1!==e&&"outOfService"!==d.sipWiseRoutingObject.sipWiseDevicesList[e].state?d.sipWiseRoutingObject.sipWiseDevicesList[e]:(o.info("[telephonyServiceSipWise] getCurrentFromDevicesListSipWise anomaly - no current/main device"),null)},d.setCurrentDevicesListSipWise=function(e){var t=d.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(t){return t.deviceId===e}));return-1!==t&&t<d.sipWiseRoutingObject.sipWiseDevicesList.length?(o.info("[telephonyServiceSipWise] setCurrentDevicesListSipWise for device: "+d.sipWiseRoutingObject.sipWiseDevicesList[t].deviceId+" / type : "+d.sipWiseRoutingObject.sipWiseDevicesList[t].type),"outOfService"===d.sipWiseRoutingObject.sipWiseDevicesList[t].state&&(new Error("Anomaly setCurrentDevicesListSipWise - current device outOfService"),o.error("[telephonyServiceSipWise] setCurrentDevicesListSipWise anomaly - current device outOfService")),d.sipWiseRoutingObject.sipWiseDevicesList.forEach((function(e){return e.main=!1})),d.sipWiseRoutingObject.sipWiseDevicesList[t].main=!0,!0):(new Error("Anomaly setCurrentDevicesListSipWise - current device not found"),o.error("[telephonyServiceSipWise] setCurrentDevicesListSipWise anomaly - current device not found / for device "+current),!1)},d.setRingingDeviceSipWise=function(e,t){var n=[],r=d.getCurrentFromDevicesListSipWise();if(!r)return o.info("[telephonyServiceSipWise] setRingingDeviceSipWise : Anomaly no current device"),!1;if("webrtc"!==r.type)return o.info("[telephonyServiceSipWise] setRingingDeviceSipWise : Anomaly not in computer mode"),!1;if(n.push(r.deviceId),t){var i=d.getDevicesIdFromListSipWiseWithType("sip");if(!i)return o.info("[telephonyServiceSipWise] setRingingDeviceSipWise : Anomaly no officePhone"),!1;n.push(i)}return d.putUserRoutingInfo(e,null,n),!0},d.putUserRoutingInfo=function(t,r,s){return e((function(e,l){if(o.info("[telephonyServiceSipWise] putUserRoutingInfo : currentId = "+r+" destinations = "+s),!r&&!s){var u=new Error("set routing failure - missing para");return o.error("[telephonyServiceSipWise] putUserRoutingInfo anomaly: missing para"),void l(u)}var h={};if(r){var f=d.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(e){return e.deviceId===r}));if(-1!==f){if(o.info("[telephonyServiceSipWise] putUserRoutingInfo found device with state : "+d.sipWiseRoutingObject.sipWiseDevicesList[f].state),"inService"!==d.sipWiseRoutingObject.sipWiseDevicesList[f].state){var p=new Error("Anomaly putUserRoutingInfo - current device outOfService");o.error("[telephonyServiceSipWise] putUserRoutingInfo anomaly - current device outOfService"),l(p)}h.currentDeviceId=r}else p=new Error("Anomaly putUserRoutingInfo - current device not found"),o.error("[telephonyServiceSipWise] putUserRoutingInfo anomaly - current device not found"),l(p)}s&&s.length>=1&&(h.destinations=s);var m=d.portalURL+"routing";o.info("[telephonyServiceSipWise] putUserRoutingInfo PUT "+m),o.info("[telephonyServiceSipWise] putUserRoutingInfo data: "+JSON.stringify(h)),n({method:"PUT",url:m,headers:a.a.getRequestHeader(),data:h}).then((function(n){o.info("[telephonyServiceSipWise] putUserRoutingInfo success : "),r&&d.setCurrentDevicesListSipWise(r),d.patchNomadicData(t),i.$broadcast("ON_SIPWISE_ROUTING_EVENT",d.getCurrentFromDevicesListSipWise().type,d.sipWiseRoutingObject),e()}),(function(e){var t=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"putUserRoutingInfo")),l(t)}))}))},d.getUserRoutingInfo=function(t){return e((function(e,r){if(o.info("[telephonyServiceSipWise] getUserRoutingInfo"),d.sipWiseRoutingObject.sipWiseDevicesList.length<1)return o.info("[telephonyServiceSipWise] getUserRoutingInfo : sipWise devices not yet avalaible"),r();var s=d.portalURL+"routing";o.info("[telephonyServiceSipWise] routing GET "+s),n({method:"GET",url:s,headers:a.a.getRequestHeader()}).then((function(n){var a=n.data.data;o.info("[telephonyServiceSipWise] getUserRoutingInfo success / status : "+n.statusText);var s=a.currentDeviceId,c=a.destinations;if(s){var l=d.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(e){return e.deviceId===s}));if(-1!==l)if("outOfService"===d.sipWiseRoutingObject.sipWiseDevicesList[l].state){var u=new Error("Anomaly getUserRoutingInfo - current device outOfService");o.error("[telephonyServiceSipWise] getUserRoutingInfo anomaly - current device outOfService"),r(u)}else o.info("[telephonyServiceSipWise] getUserRoutingInfo current : "+s+" type = "+d.sipWiseRoutingObject.sipWiseDevicesList[l].type),d.setCurrentDevicesListSipWise(s)||r(u);else u=new Error("Anomaly getUserRoutingInfo - current device not found"),o.error("[telephonyServiceSipWise] getUserRoutingInfo anomaly - current not found"),r(u)}else u=new Error("Anomaly getUserRoutingInfo - no current device"),o.error("[telephonyServiceSipWise] getUserRoutingInfo anomaly - no current device"),r(u);c?(d.sipWiseRoutingObject.ringingDestinations=c,o.info("[telephonyServiceSipWise] getUserRoutingInfo  / ringing destinations nb  = "+c.length),d.sipWiseRoutingObject.alsoOfficePhoneRingEnabled=-1!==d.sipWiseRoutingObject.ringingDestinations.findIndex((function(e){return"sip"===e.type}))):(u=new Error("Anomaly getUserRoutingInfo - no destination"),o.error("[telephonyServiceSipWise] getUserRoutingInfo anomaly - no destination "),r(u)),d.patchNomadicData(t),i.$broadcast("ON_SIPWISE_ROUTING_EVENT",d.getCurrentFromDevicesListSipWise().type,d.sipWiseRoutingObject),e()}),(function(e){var t=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"routing")),r(t)}))}))},d.patchNomadicData=function(e){var t=d.getCurrentFromDevicesListSipWise();if(o.info("[telephonyServiceSipWise] patchNomadicData current type =  "+t.type),t&&"webrtc"===t.type){var n=u.get("webrtcGatewayService");e.nomadicObject.destination=n.getMyMediaPillarRemoteExtension(),n.isMediaPillarAvailable()?(e.nomadicObject.featureActivated=!0,e.nomadicObject.modeActivated=!0,e.nomadicObject.makeCallInitiatorIsMain=!1):(e.nomadicObject.featureActivated=!0,e.nomadicObject.modeActivated=!1,e.nomadicObject.makeCallInitiatorIsMain=!1)}else e.nomadicObject={},e.nomadicObject.destination="",e.nomadicObject.featureActivated=!0,e.nomadicObject.modeActivated=!1,e.nomadicObject.makeCallInitiatorIsMain=!0;o.info("[telephonyServiceSipWise] patchNomadicData nomadicObject (desti/modeAct/CallIsMain) = "+e.nomadicObject.destination+"/"+e.nomadicObject.modeActivated+"/"+e.nomadicObject.makeCallInitiatorIsMain),i.$broadcast("ON_CALL_NOMADIC_EVENT",e.nomadicObject)},d.getUserDevices=function(t){return e((function(e,t){o.info("[telephonyServiceSipWise] getUserDevices");var r=d.portalURL+"devices";o.info("[telephonyServiceSipWise] devices GET "+r),n({method:"GET",url:r,headers:a.a.getRequestHeader()}).then((function(n){var r=n.data;if(o.info("[telephonyServiceSipWise] getUserDevices success / status : "+n.statusText),r.forEach((function(e){var t={type:e.type,id:e.id,deviceId:e.deviceId,jid_wrg:"",extension:"",state:"",main:!1};"webrtc"===e.type?(t.main=!1,t.jid_wrg=e.jid_wrg,d.sipWiseRoutingObject.sipWiseDevicesList.unshift(t)):d.sipWiseRoutingObject.sipWiseDevicesList.push(t),o.info("[telephonyServiceSipWise] getUserDevices : deviceId = "+e.deviceId+" type = "+e.type)})),d.sipWiseRoutingObject.sipWiseDevicesList.length>=1)o.info("[telephonyServiceSipWise] getUserDevices  : "+d.sipWiseRoutingObject.sipWiseDevicesList.length+" device(s)"),"webrtc"!==d.sipWiseRoutingObject.sipWiseDevicesList[0].type&&o.error("[telephonyServiceSipWise] getUserDevices anomaly - no webrtc device"),e();else{var i=new Error("Anomaly getUserDevices - no device");o.error("[telephonyServiceSipWise] getUserDevices anomaly - no device"),t(i)}}),(function(e){var n=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"devices")),t(n)}))}))},d.getUserGroups=function(t){return e((function(e,r){o.info("[telephonyServiceSipWise] getUserGroups");var i=d.portalURL+"groups";o.info("[telephonyServiceSipWise] groups GET "+i),n({method:"GET",url:i,headers:a.a.getRequestHeader()}).then((function(n){var r=n.data;o.info("[telephonyServiceSipWise] getUserGroups success / status : "+n.statusText),t.sipWiseUserGroupsDataClear(),r.data.length>0&&r.data.forEach((function(e){if(t.sipWiseUserGroupsData.sipWiseUserGroupsList.push(e),"hunting_group"===e.type&&t.sipWiseUserGroupsData.huntingGroupNb++,"manager_assistant"===e.type)if(t.sipWiseUserGroupsData.managerAssistantNb++,1===t.sipWiseUserGroupsData.managerAssistantNb){var n=e.members.find((function(e){return"manager"===e.roles[0]}));n?(t.sipWiseUserGroupsData.managerAssistGrId=e.id,t.sipWiseUserGroupsData.managerId=n.memberId,t.sipWiseUserGroupsData.managerName=n.displayName,t.sipWiseUserGroupsData.managerStatus=n.status):o.info("[telephonyServiceSipWise] getUserGroups for groupId : "+e.id+" Anomaly not 1 only manager");var r=e.members.find((function(e){return"assistant"===e.roles[0]}));r?(t.sipWiseUserGroupsData.assistantId=r.memberId,t.sipWiseUserGroupsData.assistantName=r.displayName,t.sipWiseUserGroupsData.assistantStatus=r.status):o.info("[telephonyServiceSipWise] getUserGroups for groupId : "+e.id+" Anomaly not 1 only assistant")}else o.info("[telephonyServiceSipWise] getUserGroups : Anomaly not a 1:1 mng/ass situation")})),t.sipWiseUserGroupsData.sipWiseUserGroupsList.length>=1?o.info("[telephonyServiceSipWise] getUserGroups  : "+t.sipWiseUserGroupsData.sipWiseUserGroupsList.length+" user's group(s)"):o.info("[telephonyServiceSipWise] getUserGroups  : no group"),e()}),(function(e){var t=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"groups")),r(t)}))}))},d.setUserGroupsForwards=function(t,r,i,s){return e((function(e,l){o.info("[telephonyServiceSipWise] setUserGroupsForwards for groupId : "+r);var u="";if(r?0===t.sipWiseUserGroupsData.sipWiseUserGroupsList.length&&(u="invalid groupId"):u="missing groupId",""!==u){var h=new Error("set group forward failure - "+u);return o.error("[telephonyServiceSipWise] set group forward anomaly:"+u),void l(h)}var f=d.portalURL+"groups/"+encodeURIComponent(r)+"/forwards/"+encodeURIComponent(i),p=s;o.info("[telephonyServiceSipWise] setUserGroupsForwards PUT "+f),o.info("[telephonyServiceSipWise] setUserGroupsForwards data: "+JSON.stringify(p)),n({method:"PUT",url:f,headers:a.a.getRequestHeader(),data:p}).then((function(t){o.info("[telephonyServiceSipWise] setUserGroupsForwards success / status : "+t.statusText),e()}),(function(e){var t=c.handleError(e);l(t),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"setUserGroupsForwards"))}))}))},d.getUserGroupsForwards=function(t,r){return e((function(e,i){o.info("[telephonyServiceSipWise] getUserGroupsForwards for groupId : "+r);var s="";if(r?0===t.sipWiseUserGroupsData.sipWiseUserGroupsList.length&&(s="invalid groupId"):s="missing groupId",""!==s){var l=new Error("get group forward failure - "+s);return o.error("[telephonyServiceSipWise] get group forward anomaly:"+s),void i(l)}var u=d.portalURL+"groups/"+encodeURIComponent(r)+"/forwards";o.info("[telephonyServiceSipWise] getUserGroupsForwards GET "+u),n({method:"GET",url:u,headers:a.a.getRequestHeader()}).then((function(n){var a=n.data.data,s=t.sipWiseUserGroupsData.sipWiseUserGroupsList.find((function(e){return e.id===r}));if(s.name!==a.name){o.info("[telephonyServiceSipWise] getUserGroupsForwards Anomaly group name : "+s.name+" VS "+a.name);var l=c.handleError(n);return i(l),void o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(n,"getUserGroupsForwards"))}if(s.forwardData=a,r===t.sipWiseUserGroupsData.managerAssistGrId)if(t.sipWiseUserGroupsData.managerAssistantNb>1)o.info("[telephonyServiceSipWise] getUserGroupsForwards : Anomaly not a 1:1 mng/ass situation");else{var u="unknow",d=a.members.find((function(e){return e.memberId===t.sipWiseUserGroupsData.managerId}));if(d&&d.displayName===t.sipWiseUserGroupsData.managerName){var h=d.forwards.find((function(e){return"immediate"===e.type}));u=h&&h.activate&&"managersecretary"===h.destinationType?"activated":"unactivated"}else o.info("[telephonyServiceSipWise] getUserGroupsForwards : Anomaly manager forward status");t.sipWiseUserGroupsData.managerForward=u}o.info("[telephonyServiceSipWise] getUserGroupsForwards success / status : "+n.statusText),e()}),(function(e){var t=c.handleError(e);i(t),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"getUserGroupsForwards"))}))}))},d.getAllUserGroupsForwards=function(t){return e((function(n,r){o.info("[telephonyServiceSipWise] getAllUserGroupsForwards");var i=[];return 0===t.sipWiseUserGroupsData.sipWiseUserGroupsList.length?(o.info("[telephonyServiceSipWise] getAllUserGroupsForwards / no group"),n()):(t.sipWiseUserGroupsData.sipWiseUserGroupsList.forEach((function(e){"manager_assistant"===e.type&&i.push(d.getUserGroupsForwards(t,e.id))})),0===i.length?(o.info("[telephonyServiceSipWise] getAllUserGroupsForwards / no manager assistant group"),n()):e.all(i).then((function(){o.info("[telephonyServiceSipWise] getAllUserGroupsForwards -- group forward completed -- "+i.length+" group(s) forward updated"),n()})).catch((function(e){o.error("[telephonyServiceSipWise] getAllUserGroupsForwards -- group forward failure -- "+e.message),r(e)})))}))},d.getSnapshot=function(t,r,i){return e((function(e,s){o.info("[telephonyServiceSipWise] getSnapshot");var l=[];t&&(o.info("[telephonyServiceSipWise] snapshot with callId "+t.id),l.push("callId="+t.id)),r&&(o.info("[telephonyServiceSipWise] snapshot with deviceId "+r),l.push("deviceId="+r)),i&&(o.info("[telephonyServiceSipWise] snapshot with seqNum "+i),l.push("seqNum="+i));var u="";l.length>=1&&(u="?"+l.join("&"));var h=d.portalURL+"snapshot"+u;o.info("[telephonyServiceSipWise] snapshot GET "+h),n({method:"GET",url:h,headers:a.a.getRequestHeader()}).then((function(t){var n=t.data.data;o.info("[telephonyServiceSipWise] getSnapshot success / status : "+t.statusText),e(n)}),(function(e){var t=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"snapshot")),s(t)}))}))},d.processSnapshot=function(t){return e((function(n,r){o.info("[telephonyServiceSipWise] processSnapshot");var i=0;d.getSnapshot().then((function(a){try{a&&a.devices?a.devices.forEach((function(e){d.sipWiseRoutingObject.sipWiseDevicesList.find((function(t){return t.deviceId===e.deviceId})).state=e.state,o.info("[telephonyServiceSipWise] processSnapshot / devicesId="+e.deviceId+"; state="+e.state),d.sipWiseRoutingObject.sipWiseDevicesList.find((function(t){return t.deviceId===e.deviceId})).state="inService"})):o.error("[telephonyServiceSipWise] processSnapshot / anomaly no device ");var s=[];return a&&a.calls?a.calls.length>5?(o.error("[telephonyServiceSipWise] processSnapshot / anomaly to much calls : "+a.calls.length),n()):(a.calls.forEach((function(e){"ringingIn"===e.legs[0].state&&++i>=4&&o.info("[telephonyServiceSipWise] processSnapshot / anomaly to much ringingIn calls : "+i),i<4&&s.push(d.createCallFromSnapShotCallsElt(t,e))})),0===s.length?(o.info("[telephonyServiceSipWise] processSnapshot / anomaly no call created"),n()):e.all(s).then((function(){o.info("[telephonyServiceSipWise] processSnapshot -- calls creation completed -- "+s.length+" calls created"),n()})).catch((function(e){o.error("[telephonyServiceSipWise] processSnapshot -- calls creation failure -- "+e.message),r(e)}))):(o.info("[telephonyServiceSipWise] processSnapshot / no call elt"),n())}catch(l){var c=" processSnapshot -- "+l.message;r(new Error(c))}}),(function(e){o.info("[telephonyServiceSipWise] processSnapshot / getSnapshot error : "+e),r(e)}))}))},d.createCallFromSnapShotCallsElt=function(t,n){return e((function(r,a){var s=null;o.info("[telephonyServiceSipWise] createCallFromSnapShotCallsElt - callId = "+n.callId);var c,u,h,f,p,m,v=null,g=null;if(!n.legs)return b="createCallFromSnapShotCallsElt -- Anomaly no leg",o.error("[telephonyServiceSipWise] "+b),e.when();var y=d.getCurrentFromDevicesListSipWise();if(null===y){var b="createCallFromSnapShotCallsElt -- Anomaly no current device";o.error("[telephonyServiceSipWise] "+b),v=n.legs[0]}else(v=n.legs.find((function(e){return e.deviceId===y.id})))||(v=n.legs[0]);return c=v.legId?v.legId:null,u=v.deviceId?v.deviceId:null,h=t.telephonyEventHandler.convLegStateToCallStatus(v.state),o.info("[telephonyServiceSipWise] createCallFromSnapShotCallsElt - legId = "+c+" deviceId = "+u+" leg_state = "+v.state),n.endpoints?((f=n.endpoints[0]).endpointId,p=f.phoneNumber,m=f.jid,g=f.displayName,m||p?void l.a.getOrCreateContact(m,p).then((function(e){m||e.displayName||(e.displayName=g,e.initials=g.charAt(0),e.getAvatar()),(s=t.getOrCreateCallSipWise(h,n.callId,c,u,e)).relevantEquipmentId=u,s.isSecondary=!1,i.$broadcast("ON_CALL_UPDATED_EVENT",s),r(s)})):(b="createCallFromSnapShotCallsElt -- Anomaly no jid no phoneNumber",o.error("[telephonyServiceSipWise] "+b),e.when())):(o.info("[telephonyServiceSipWise] createCallFromSnapShotCallsElt -- No endPoint provided !"),void r())}))},d.makeSimpleCallSipWise=function(l,u,h){return e((function(e,f){if(o.info("[telephonyServiceSipWise] makeSimpleCall to "+(u?u.nameForLogs:s()(h))),!l.isBasicCallAllowed){var p=new Error("makeSimpleCallSipWise failure - Not Allowed");return p.status=p.errorDetailsCode="403",o.error("[telephonyServiceSipWise] "+p.message),l.makingCall=!1,void f(p)}var m=l.getPhoneInfo(u,h),v=d.getCurrentFromDevicesListSipWise();if(v)var g=v.deviceId;else g="";if((l.sipWiseEmergencyCallData.WGEmergencyCallForbidden&&v&&"webrtc"===v.type||"testemergency"===l.sipWiseMode())&&d.checkEmergencyNumberSipWise(l,h))return o.info("[telephonyServiceSipWise] makeVOIPSipemergencyCall - Not Allowed for num : "+h),l.rxSubject.next({name:"ON_EMERGENCYCALL_VOIPSIP_NOTALLOWED_EVENT",data:h}),l.makingCall=!1,void f();if(l.getActiveCall()&&v&&"webrtc"===v.type&&"demo"!==l.sipWiseMode())return o.info("[telephonyServiceSipWise] makeSecondVOIPSipCall - Not Allowed"),l.makingCall=!1,i.$broadcast("ON_CALL_NOTALLOWED_EVENT","webCallAlreadyProgress"),void f("webCallAlreadyProgress");var y=d.portalURL+"calls",b={deviceId:g,calleeExtNumber:m.longNumber,calleeShortNumber:m.shortNumber,calleePbxId:m.pbxId,callerAutoAnswer:!0};o.info("[telephonyServiceSipWise] makeSimpleCall POST "+y),o.info("[telephonyServiceSipWise] makeSimpleCall data: "+JSON.stringify(b)),n({method:"POST",url:y,headers:a.a.getRequestHeader(),data:b}).then((function(n){var a=n.data.data.callId;if(o.info("[telephonyServiceSipWise] makeSimpleCall success : callee "+s()(h)+" / callId = "+a),!a||""===a){var d;(d=r.Call.create(r.Call.Status.ERROR,null,r.Call.Type.PHONE,u)).errorMessage="unexpectedError",l.calls[d.contact.id]=d,d.autoClear=t((function(){l.clearCall(d)}),5e3,1),l.makingCall=!1,i.$broadcast("ON_CALL_UPDATED_EVENT",d);var p=c.handleError(n);return o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(n,"makeCall")),void f(p)}(d=l.getOrCreateCallSipWise(r.Call.Status.DIALING,a,null,null,u)).setRelevantEquipmentId(d.getDeviceIdSipWise()),d.isOwner=!0,o.info("[telephonyServiceSipWise] makeSimpleCall Call created ("+d+")"),l.makingCall=!1,d.setIsVm(h===l.voicemailNumber),d.autoClear=t((function(){o.info("[telephonyServiceSipWise] keepAlive CallReset ("+d+")"),l.clearCall(d)}),1e4,1),i.$broadcast("ON_CALL_UPDATED_EVENT",d),e(d.id)}),(function(e){var n=r.Call.create(r.Call.Status.ERROR,null,r.Call.Type.PHONE,u);n.errorMessage=e&&"403"===e.errorDetailsCode?"notAllowed":"invalidPhoneNumber",l.calls[n.contact.id]=n,n.autoClear=t((function(){l.clearCall(n)}),5e3,1),l.makingCall=!1,n.publish("ON_CALL_UPDATED_EVENT"),i.$broadcast("ON_CALL_UPDATED_EVENT",n);var a=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"makeCall")),f(a)}))}))},d.getPhoneInfoSipWise=function(e,t){var n=t,r="",i="";return e&&(t===e.phonePro||t===e.phoneProCan?(n=e.phoneProCan?e.phoneProCan:"",r=e.phonePbx,i=e.phoneInternalNumber):t===e.phonePbx&&(n="",r=e.phonePbx,i=e.phoneInternalNumber)),{number:""!==n?n:r||i}},d.getErrorMessage=function(e,t){return null},d.releaseCallSipWise=function(t,s){return e((function(e,l){o.info("[telephonyServiceSipWise] releaseCallSipWise "+s.id);var u=d.portalURL+"calls/"+encodeURIComponent(s.id),h={legId:s.connectionId?s.connectionId:""};o.info("[telephonyServiceSipWise] releaseCall DELETE "+u),o.info("[telephonyServiceSipWise] releaseCall data: "+JSON.stringify(h)),n({method:"DELETE",url:u,headers:a.a.getRequestHeader(),data:h}).then((function(){s.setStatus(r.Call.Status.UNKNOWN),s.startDate=null,s.vm=!1,o.info("[telephonyServiceSipWise] releaseCall "+s.id+" - success"),i.$broadcast("ON_CALL_UPDATED_EVENT",s),delete t.calls[s.id],e(s)}),(function(e){var n=c.handleError(e);d.deleteCallIfInvalid(n,s,t),l(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"releaseCall"))}))}))},d.deleteCallIfInvalid=function(e,t,n){e&&"voice"===e.portal&&404201===e.errorDetailsCode&&"Specified leg not found"===e.message&&t&&(o.warn("[telephonyServiceSipWise] deleteCallIfInvalid: delete client call non existing on server: "+t.id),t.setStatus(r.Call.Status.UNKNOWN),i.$broadcast("ON_CALL_UPDATED_EVENT",t),n.calls[t.id]&&delete n.calls[t.id])},d.answerCallSipWise=function(t,l){return e((function(e,t){o.info("[telephonyServiceSipWise] answerCall : "+l.id);var u=d.portalURL+"calls/"+encodeURIComponent(l.id)+"/answer",h={legId:l.connectionId};o.info("[telephonyServiceSipWise] answerCallSipWise POST "+u),o.info("[telephonyServiceSipWise] answerCallSipWise data: "+JSON.stringify(h)),n({method:"POST",url:u,headers:a.a.getRequestHeader(),data:h}).then((function(t){l.setStatus(r.Call.Status.ACTIVE),o.info("[telephonyServiceSipWise] answerCall success : "+s()(l.contact.phone)+" Call ("+l+")"),i.$broadcast("ON_CALL_UPDATED_EVENT",l),e(l)}),(function(e){o.info("[telephonyServiceSipWise] answerCall fail : error = "+e.data.errorCode+" msg = "+e.data.errorMsg+" details = "+e.data.errorDetails),e.data&&"Device is not able to answer a call"===e.data.errorDetails&&i.$broadcast("ON_OPEN_GLOBAL_POPUP",{autoClose:!1,okLabel:"close",popupTitle:"warning",popupBody:"deviceDoesntAllowAnswer"}),l.setStatus(r.Call.Status.UNKNOWN);var n=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"answerCall")),t(n)}))}))},d.holdCallSipWise=function(t,r){return e((function(e,t){o.info("[telephonyServiceSipWise] holdCallSipWise : "+r.id);var i=d.portalURL+"calls/"+encodeURIComponent(r.id)+"/hold",l={legId:r.connectionId};o.info("[telephonyServiceSipWise] holdCallSipWise POST "+i),o.info("[telephonyServiceSipWise] holdCallSipWise data: "+JSON.stringify(l)),n({method:"POST",url:i,headers:a.a.getRequestHeader(),data:l}).then((function(t){o.info("[telephonyServiceSipWise] holdCall success : "+s()(r.contact.phone)+" Call ("+r+")"),e(r)}),(function(e){var n=c.handleError(e);t(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"holdCall"))}))}))},d.retrieveCallSipWise=function(t,r){return e((function(e,t){o.info("[telephonyServiceSipWise] retrieveCallSipWise : "+r.id);var i=d.portalURL+"calls/"+encodeURIComponent(r.id)+"/retrieve",l={legId:r.connectionId};o.info("[telephonyServiceSipWise] retrieveCallSipWise POST "+i),o.info("[telephonyServiceSipWise] retrieveCallSipWise data: "+JSON.stringify(l)),n({method:"POST",url:i,headers:a.a.getRequestHeader(),data:l}).then((function(t){o.info("[telephonyServiceSipWise] retrieveCall success : "+s()(r.contact.phone)+" Call ("+r+")"),e(r)}),(function(e){var n=c.handleError(e);t(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"retrieveCall"))}))}))},d.deflectCallSipWise=function(t,r,i){return e((function(e,t){if(o.info("[telephonyServiceSipWise] deflectCallSipWise : "+r.id+" to destination : "+i),!i){var s=new Error("deflect failure - no destination");return o.error("[telephonyServiceSipWise] deflect anomaly: no destination"),void t(s)}var l=d.portalURL+"calls/"+encodeURIComponent(r.id)+"/deflect",u={destination:i};o.info("[telephonyServiceSipWise] deflectCallSipWise POST "+l),o.info("[telephonyServiceSipWise] deflectCallSipWise data: "+JSON.stringify(u)),n({method:"POST",url:l,headers:a.a.getRequestHeader(),data:u}).then((function(t){o.info("[telephonyServiceSipWise] deflectCallSipWise success :  Call ("+r+")"),e()}),(function(e){var n=c.handleError(e);t(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"deflectCall"))}))}))},d.transfertCallSipWise=function(t,r,i){return e((function(e,t){if(o.info("[telephonyServiceSipWise] transfertCallSipWise : activeCall : "+r.id+" heldCall : "+i.id),!r||!i){var s=new Error("transfer failure - missing activeCall or heldCall");return o.error("[telephonyServiceSipWise] transfer anomaly: missing calls ref"),void t(s)}var l=d.portalURL+"calls/"+encodeURIComponent(r.id)+"/transfer",u={heldCallId:i.id};o.info("[telephonyServiceSipWise] transfertCallSipWise POST "+l),o.info("[telephonyServiceSipWise] transfertCallSipWise data: "+JSON.stringify(u)),n({method:"POST",url:l,headers:a.a.getRequestHeader(),data:u}).then((function(t){o.info("[telephonyServiceSipWise] transfertCallSipWise success : "+r.id+"->"+i.id),e()}),(function(e){var n=c.handleError(e);t(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"transfer"))}))}))},d.blindTransfertCallSipWise=function(t,r,i){return e((function(e,t){if(o.info("[telephonyServiceSipWise] blindTransfertCallSipWise : activeCall : "+r.id),!r||!i){var s=new Error("blind transfer failure - missing activeCall or callee number");return o.error("[telephonyServiceSipWise] blind transfer anomaly: missing calls ref or callee number"),void t(s)}var l=d.portalURL+"calls/"+encodeURIComponent(r.id)+"/blind-transfer",u={destination:i};o.info("[telephonyServiceSipWise] blindTransfertCallSipWise POST "+l),o.info("[telephonyServiceSipWise] blindTransfertCallSipWise data: "+JSON.stringify(u)),n({method:"POST",url:l,headers:a.a.getRequestHeader(),data:u}).then((function(t){o.info("[telephonyServiceSipWise] blind transfertCallSipWise success :  Call ("+call+")"),e()}),(function(e){var n=c.handleError(e);t(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"blind-transfer"))}))}))},d.forwardToDeviceSipWise=function(t,r,i,s){return e((function(e,t){if(o.info("[telephonyServiceSipWise] forwardToDeviceSipWise : phoneNumber = "+r+" / destType = "+i+" / fwtype = "+s),!r){var l=new Error("forward failure - missing phoneNumber");return o.error("[telephonyServiceSipWise] forward anomaly: missing phoneNumber"),void t(l)}var u=d.portalURL+"forwards/"+encodeURIComponent(s),h={number:r,destinationType:i,activate:!0};o.info("[telephonyServiceSipWise] forwardToDeviceSipWise PUT "+u),o.info("[telephonyServiceSipWise] forwardToDeviceSipWise data: "+JSON.stringify(h)),n({method:"PUT",url:u,headers:a.a.getRequestHeader(),data:h}).then((function(t){o.info("[telephonyServiceSipWise] forwardToDeviceSipWise success : "),e()}),(function(e){var n=c.handleError(e);t(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"forwardToDeviceSipWise"))}))}))},d.cancelForwardSipWise=function(t,r){return e((function(e,t){if(o.info("[telephonyServiceSipWise] cancelForwardSipWise :  fwtype = "+r),!r||"immediate"!==r&&"busy"!==r&&"noreply"!==r){var i=new Error("cancel forward failure - wrong forwardType");return o.error("[telephonyServiceSipWise] cancel forward anomaly: wrong forwardType"),void t(i)}var s=d.portalURL+"forwards/"+encodeURIComponent(r),l={activate:!1};o.info("[telephonyServiceSipWise] cancelForwardSipWise PUT "+s),o.info("[telephonyServiceSipWise] cancelForwardSipWise data: "+JSON.stringify(l)),n({method:"PUT",url:s,headers:a.a.getRequestHeader(),data:l}).then((function(t){o.info("[telephonyServiceSipWise] forwardToDeviceSipWise success : "),e()}),(function(e){var n=c.handleError(e);t(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"forwardToDeviceSipWise"))}))}))},d.getForwardStatusSipWise=function(t){return e((function(e,r){o.info("[telephonyServiceSipWise] getForwardStatusSipWise");var s=d.portalURL+"forwards";o.info("[telephonyServiceSipWise] getForwardStatusSipWise GET "+s),n({method:"GET",url:s,headers:a.a.getRequestHeader()}).then((function(n){if(n.data&&"Call Forwards successfully found"===n.data.status&&n.data.data){o.info("[telephonyServiceSipWise] getForwardStatusSipWise success");var a=n.data.data,s=d.convForwardObject(a);return o.info("[telephonyServiceSipWise] getForwardStatusSipWise immediat fwdtype = "+s.immediate.forwardType+" immediat forwardTo = "+s.immediate.forwardTo),s.busy&&o.info("[telephonyServiceSipWise] getForwardStatusSipWise busy activate = "+s.busy.activate),s.noreply&&o.info("[telephonyServiceSipWise] getForwardStatusSipWise noreply activate = "+s.noreply.activate),i.$broadcast("ON_CALL_FORWARDED_EVENT",{forwardType:s.immediate.forwardType,forwardTo:s.immediate.forwardTo}),t.forwardObject.forwardType=s.immediate.forwardType,t.forwardObject.forwardTo=s.immediate.forwardTo,(s.busy||s.noreply)&&(i.$broadcast("ON_CALL_FORWARDED_CONDI_EVENT",{busy:s.busy,noreply:s.noreply}),t.forwardObject.busy=s.busy,t.forwardObject.noreply=s.noreply),void e()}var c=new Error("getForwardStatus failure - invalide response");return o.error("[telephonyServiceSipWise] getForwardStatus anomaly: invalide response"),void r(c)}),(function(e){var t=c.handleError(e);r(t),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"getForwardStatusSipWise"))}))}))},d.convForwardObject=function(e){var t={immediate:{forwardType:"Desactivation",forwardTo:""},busy:{},noreply:{},manAssist:{}};return e.forEach((function(e){"immediate"===e.type?(e.activate&&("voicemail"===e.destinationType?(t.immediate.forwardType="Activation",t.immediate.forwardTo="VOICEMAILBOX"):""!==e.number&&(t.immediate.forwardType="Activation",t.immediate.forwardTo=e.number)),"managersecretary"===e.destinationType&&(t.immediate.forwardType=e.activate,t.immediate.forwardTo="MANAGERASSISTANT",t.manAssist=e)):"busy"===e.type?t.busy=e:"noreply"===e.type&&(t.noreply=e)})),t},d.getOverFlowStatusSipWise=function(t,r){return e((function(e,i){o.info("[telephonyServiceSipWise] getOverFlowStatusSipWise : systemId = "+t+" / phoneNumberId = "+r);var s=d.portalAdminURL+"cloudpbxs/"+encodeURIComponent(t)+"/subscribers/"+encodeURIComponent(r)+"/overflow/status";n({method:"GET",url:s,headers:a.a.getRequestHeader()}).then((function(t){var n=t.data.data;o.info("[telephonyServiceSipWise] getOverFlowStatusSipWise activated: "+n.activate),e(n)}),(function(e){var t=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"getOverFlowStatus")),i(t)}))}))},d.sendDtmfSipWise=function(t,r,i){return e((function(e,t){o.info("[telephonyServiceSipWise] sendDtmfSipWise for callId : "+r.id+" dtmf : "+i);var s=d.portalURL+"calls/"+encodeURIComponent(r.id)+"/sendDtmf",l={legId:r.connectionId,digits:i};o.info("[telephonyServiceSipWise] sendDtmfSipWise POST "+s),o.info("[telephonyServiceSipWise] sendDtmfSipWise data: "+JSON.stringify(l)),n({method:"POST",url:s,headers:a.a.getRequestHeader(),data:l}).then((function(t){o.info("[telephonyServiceSipWise] sendDtmfSipWise success :  Call ("+r+")"),e()}),(function(e){var n=c.handleError(e);t(n),o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"sendDtmf"))}))}))},d.checkEmergencyNumberSipWise=function(e,t){var n=!1,r=e.sipWiseEmergencyCallData;return r.emergencyNuList.length>0&&r.emergencyNuList.find((function(e){return e===t}))&&(n=!0),n},d.getEmergencyCallDataSipWise=function(t){return e((function(e,r){var i=d.portalURL+"emergency-numbers";o.info("[telephonyServiceSipWise] getEmergencyCallDataSipWise GET "+i),n({method:"GET",url:i,headers:a.a.getRequestHeader()}).then((function(n){var r=n.data.data;o.info("[telephonyServiceSipWise] getEmergencyCallDataSipWise success / status : "+n.statusText),o.info("[telephonyServiceSipWise] getEmergencyCallDataSipWise success / callAuthorizationWithSoftPhone  : "+r.emergencyOptions.callAuthorizationWithSoftPhone),o.info("[telephonyServiceSipWise] getEmergencyCallDataSipWise success / nb of emergency Nu : "+r.emergencyNumbers.length),t.sipWiseEmergencyCallDataClear(),t.sipWiseEmergencyCallData.WGEmergencyCallForbidden=!r.emergencyOptions.callAuthorizationWithSoftPhone,t.sipWiseEmergencyCallData.serverData=r.emergencyNumbers,r.emergencyNumbers&&r.emergencyNumbers.length>0&&r.emergencyNumbers.forEach((function(e){t.sipWiseEmergencyCallData.emergencyNuList.push(e.number)})),"testemergency"===t.sipWiseMode()&&(t.sipWiseEmergencyCallData.WGEmergencyCallForbidden=!0,t.sipWiseEmergencyCallData.emergencyNuList.push("3669")),e()}),(function(e){var t=c.handleError(e);o.error("[telephonyServiceSipWise] "+c.getErrorFullMessage(e,"getEmergencyCallDataSipWise")),r(t)}))}))}}])},function(e,t,n){n.r(t);var r=n(0),i=n(49),a=n(1),o=n.n(a);angular.module("rainbow").factory("TelephonyServiceEventHandlerSipWise",["$log","$q","$rootScope","$interval",function(e,t,n,a){function s(e){this.telephonyService=e,this.promiseQueue=i.PromiseQueue.create()}return s.create=function(e){return new s(e)},s.CallFailureLabels={invalidNumberFormat:"invalidPhoneNumber",destOutOfOrder:"outOfService",destNotObtainable:"outOfService",doNotDisturb:"dnd",busy:"busy",incompatibleDestination:"invalidPhoneNumber"},s.prototype.onCallserviceMessageReceived=function(t){try{var n=this,r=$(t).find("telephony"),i=r.find("forwardUpdated");if(i&&0!==i.length)return n.onforwardUpdatedMsg(i);var a=r.find("event"),o=a.attr("seqNum");if(!o)return e.info("[TelephonyServiceEventHandlerSipWise] onCallserviceMessageReceived -- no telephony event received then msg ignored"),!0;var s=a.attr("ts"),c=a.attr("cause");return e.info("[TelephonyServiceEventHandlerSipWise] onCallserviceMessageReceived -- telephony event received and queued: seqNum = "+o+" cause = "+c+" ts = "+s),this.promiseQueue.add((function(){return n.onTelephonyEvent(a,o)})),!0}catch(l){return e.error("[TelephonyServiceEventHandlerSipWise] onCallserviceMessageReceived -- failure -- "+l.message),!0}},s.prototype.onOverflowUpdateMessageReceived=function(t){try{var n=$(t).find("overflowOnSubscriberUpdated").find("overflowUpdated");return!n||0===n.length||this.overflowUpdatedMsg(n)}catch(r){return e.error("[TelephonyServiceEventHandlerSipWise] onOverflowUpdateMessageReceived -- failure -- "+r.message),!0}},s.prototype.onUserConfigurationMessageReceived=function(t){try{var n=$(t).find("routing");return!n||0===n.length||this.onRoutingUpdatedMsg(n)}catch(r){return e.error("[TelephonyServiceEventHandlerSipWise] onUserConfigurationMessageReceived -- failure -- "+r.message),!0}},s.prototype.onforwardUpdatedMsg=function(t){e.info("[TelephonyServiceEventHandlerSipWise] onforwardUpdatedMsg : msg forwardUpdated received");var n=t.attr("forwardItem");if("user"===n&&this.telephonyService.getForwardStatus(),"group"===n){var r=t.attr("forwardItemId");r?(this.telephonyService.getSipWiseUserGroupsForwards(r),"manager"===this.telephonyService.sipWiseManAssistGetMyRole()&&this.telephonyService.getForwardStatus()):this.telephonyService.getSipWiseUserGroups()}return!0},s.prototype.onRoutingUpdatedMsg=function(t){e.info("[TelephonyServiceEventHandlerSipWise] onRoutingUpdatedMsg : msg routing update received");var r=t.find("routingUpdated"),i=r.find("currentDeviceId").text(),a=r.find("destinations"),o=[],s=this.telephonyService.telephonyServiceSipWise.sipWiseRoutingObject;return i&&a?(s.alsoOfficePhoneRingEnabled=!1,a.find("destination").each((function(){var t=angular.element(this),n=t.attr("type"),r=t.attr("deviceId");e.info("[TelephonyServiceEventHandlerSipWise] onRoutingUpdatedMsg ITER desti / type = "+n+" deviceId = "+r),o.push({deviceId:r,type:n}),"sip"===n&&(s.alsoOfficePhoneRingEnabled=!0)})),i&&this.telephonyService.telephonyServiceSipWise.setCurrentDevicesListSipWise(i),o&&(e.info("[telephonyServiceSipWise] onRoutingUpdatedMsg  / ringing destinations nb  = "+o.length),s.ringingDestinations=o,n.$broadcast("ON_SIPWISE_ROUTING_EVENT",this.telephonyService.telephonyServiceSipWise.getCurrentFromDevicesListSipWise().type,s)),!0):(e.info("[TelephonyServiceEventHandlerSipWise] onRoutingUpdatedMsg Anomaly: no current/destination elts"),!1)},s.prototype.overflowUpdatedMsg=function(t){return e.info("[TelephonyServiceEventHandlerSipWise] overflowUpdatedMsg received"),this.telephonyService.getForwardStatus(),!0},s.prototype.onTelephonyEvent=function(n,r){e.info("[TelephonyServiceEventHandlerSipWise] onTelephonyEvent for seqNum = "+r);var i=this,a=[];return t((function(t,o){i.manageAllCalls(n,r,a).then((function(){return i.manageAllLegs(n,r,a)})).then((function(){return i.manageAllEndPoints(n,r,a)})).catch((function(t){e.info("[TelephonyServiceEventHandlerSipWise] onTelephonyEvent CATCH / seqNum = "+r);var n="onTelephonyEvent -- "+t.message;e.error("[TelephonyServiceEventHandlerSipWise] "+n)})).finally((function(){e.info("[TelephonyServiceEventHandlerSipWise] onTelephonyEvent FINALLY / seqNum = "+r),i.CallsUpdate(a),t()}))}))},s.prototype.manageAllCalls=function(n,r,i){var a=this,o=[],s=0;return n.find("call").each((function(){var c=angular.element(this),l=c.attr("callId"),u=c.attr("op");e.info("[TelephonyServiceEventHandlerSipWise] manageAllCalls ITER callId = "+l+" op = "+u+" / seqNum = "+r),"ended"!==u&&s++,o.push(t((function(t,o){a.manageCallElem(c,n,r,i).then((function(){e.info("[TelephonyServiceEventHandlerSipWise] manageAllCalls done for callId = "+l+" / seqNum = "+r)})).catch((function(t){e.info("[TelephonyServiceEventHandlerSipWise] manageAllCalls CATCH / seqNum = "+r);var n="manageAllCalls -- "+t.message;e.error("[TelephonyServiceEventHandlerSipWise] "+n)})).finally((function(){t()}))})))})),t.all(o).finally((function(){e.info("[TelephonyServiceEventHandlerSipWise] manageAllCalls : nb living calls = "+s+" / seqNum = "+r)}))},s.prototype.manageCallElem=function(n,i,a,o){var s=this;return n.length?t((function(t,c){try{var l=n.attr("callId"),u=n.attr("oldCallId"),d=(n.attr("newCallId"),n.attr("op"));if(!l){var h="manageCallElem -- Anomaly callId missing / seqNum = "+a;e.error("[TelephonyServiceEventHandlerSipWise] "+h),c(h)}switch(d||(h="manageCallElem -- Anomaly op missing / seqNum = "+a,e.error("[TelephonyServiceEventHandlerSipWise] "+h),c(h)),e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem callId = "+l+" op = "+d+" / seqNum = "+a),u&&((g=s.telephonyService.calls[u])?(e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : oldcallId = "+u+" ended  / seqNum = "+a),s.telephonyService.clearCall(g,!0),o[l]={trigger:!0,info:"callended"}):e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : oldCallId "+u+" ended, no call found")),d){case"created":if(e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / call creation / seqNum = "+a),g=s.telephonyService.createCallSipWise(r.Call.Status.UNKNOWN,l)){var f=i.attr("cause");f&&g.setInitCauseSipWiseData(f);var p=n.find("direction").text();p&&g.setDirectionSipWiseData(p);var m=n.find("called");(v={}).phoneNumber=m.find("phoneNumber").text(),v.displayName=m.find("displayName").text(),g.setCalledSipWiseData(v)}o[l]={trigger:!1,info:"call"+d},t();break;case"updated":var v;e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / call update / seqNum = "+a),m=n.find("called"),(v={}).phoneNumber=m.find("phoneNumber").text(),v.displayName=m.find("displayName").text();var g=s.getCallFromCallId(l);r.Call&&g.setCalledSipWiseData(v),s.checkCallRelevancy(l)?o[l]={trigger:!0,info:"call"+d}:e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : on callId "+l+" updated, not relevant"),t();break;case"ended":e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / call end / seqNum = "+a),g=s.telephonyService.calls[l],s.checkCallRelevancy(l)?(e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : callId = "+l+" ended  / seqNum = "+a),s.telephonyService.clearCall(s.getCallFromCallId(l),!0),o[l]={trigger:!0,info:"call"+d}):e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : on callId "+l+" ended, not relevant"),t();break;default:e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / invalid op -> "+d+" / seqNum = "+a),c()}}catch(y){h="manageCallElem -- "+y.message,c(new Error(h))}})):(e.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / no CallElem"),t.resolve())},s.prototype.manageAllLegs=function(n,r,i){var a=this,o=[],s=0;return n.find("leg").each((function(){var c=angular.element(this),l=c.attr("legId"),u=c.attr("op");e.info("[TelephonyServiceEventHandlerSipWise] manageAllLegs ITER legId = "+l+" op = "+u+" / seqNum = "+r),c.length&&("ended"!==u&&s++,o.push(t((function(t,o){a.manageLegElem(c,n,r,i).then((function(){e.info("[TelephonyServiceEventHandlerSipWise] manageAllLegs done for legId = "+l+" / seqNum = "+r)})).catch((function(t){e.info("[TelephonyServiceEventHandlerSipWise] manageAllLegs CATCH / seqNum = "+r);var n="manageAllLegs -- "+t.message;e.error("[TelephonyServiceEventHandlerSipWise] "+n)})).finally((function(){t()}))}))))})),t.all(o).finally((function(){e.info("[TelephonyServiceEventHandlerSipWise] manageAllLegs : nb living legs = "+s+" / seqNum = "+r)}))},s.prototype.manageLegElem=function(n,r,i,a){var o=this;return t((function(t,s){var c=n.attr("legId"),l=n.attr("callId"),u=n.attr("deviceId"),d=n.attr("state"),h=n.attr("op");switch(c||s("manageLegElem -- Anomaly legId missing / seqNum = "+i),l||s("manageLegElem -- Anomaly callId missing / seqNum = "+i),h||s("manageLegElem -- Anomaly op missing / seqNum = "+i),e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem legId = "+c+" callId = "+l+" deviceId = "+u+" state = "+d+" op = "+h+" / seqNum = "+i),h){case"created":e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / leg creation / seqNum = "+i),o.computeCallRelevancy(u)?(e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / create legId/callId = "+c+"/"+l+" relevant"),o.legElemCreate(r).then((function(){o.getCallFromCallId(l).setConnectionIdSipWise(c),a[l]={trigger:!0,info:"leg"+h},t()})).catch((function(e){s(e)}))):(e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / create legId/callId = "+c+"/"+l+" not relevant"),t());break;case"updated":e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / leg update / seqNum = "+i),o.computeCallRelevancy(u)?(e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / update legId/callId = "+c+"/"+l+" relevant"),o.legElemUpdate(r).then((function(){o.getCallFromCallId(l).setConnectionIdSipWise(c),a[l]={trigger:!0,info:"leg"+h},t()})).catch((function(e){s(e)}))):(e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / update legId/callId = "+c+"/"+l+" not relevant"),t());break;case"ended":e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / leg end / seqNum = "+i),o.computeCallRelevancy(u)?o.getCallFromCallId(l)?(o.telephonyService.clearCall(o.getCallFromCallId(l),!0),a[l]={trigger:!0,info:"leg"+h}):e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem : leg ended / call already removed"):e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem : leg ended but not relevant"),t();break;default:e.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / invalid op -> "+h+" / seqNum = "+i),s()}}))},s.prototype.manageAllEndPoints=function(n,r,i){var a=this,o=[],s=0;return n.find("endpoint").each((function(){var c=angular.element(this),l=c.attr("endpointId"),u=c.attr("op");e.info("[TelephonyServiceEventHandlerSipWise] manageAllEndPoints ITER endPointId = "+l+" op = "+u+" / seqNum = "+r),c.length&&("ended"!==u&&s++,o.push(t((function(t,o){a.manageEndPointElem(c,n,r,i).then((function(){e.info("[TelephonyServiceEventHandlerSipWise] manageAllEndPoints done for endPointId = "+l+" / seqNum = "+r)})).catch((function(t){e.info("[TelephonyServiceEventHandlerSipWise] manageAllEndPoints CATCH / seqNum = "+r);var n="manageAllEndPoints -- "+t.message;e.error("[TelephonyServiceEventHandlerSipWise] "+n)})).finally((function(){t()}))}))))})),t.all(o).finally((function(){e.info("[TelephonyServiceEventHandlerSipWise] manageAllEndPoints : nb living endPoint = "+s+" / seqNum = "+r)}))},s.prototype.manageEndPointElem=function(n,r,i,a){var o=this;return t((function(t,s){var c=n.attr("endpointId"),l=n.attr("callId"),u=n.attr("state"),d=n.attr("op");switch(n.attr("anonymous"),c||s("manageEndPointElem -- Anomaly endPointId missing / seqNum = "+i),l||s("manageEndPointElem -- Anomaly callId missing / seqNum = "+i),d||s("manageEndPointElem -- Anomaly op missing / seqNum = "+i),e.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem endPointId = "+c+" callId = "+l+" state = "+u+" op = "+d+" / seqNum = "+i),d){case"created":e.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem: create endPointId/callId = "+c+"/"+l),o.endPointElemCreate(r).then((function(){o.checkCallRelevancy(l)?a[l]={trigger:!0,info:"endpoint"+d}:e.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem: create endPointId/callId = "+c+"/"+l+" not yet relevant"),t()})).catch((function(e){s(e)}));break;case"updated":e.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem / updated"),o.endPointElemUpdate(r).then((function(){o.checkCallRelevancy(l)?a[l]={trigger:!0,info:"endpoint"+d}:e.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem: update endPointId/callId = "+c+"/"+l+" not relevant"),t()})).catch((function(e){s(e)}));break;case"ended":e.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem / ended"),t();break;default:s("manageEndPointElem / Anomaly unmanaged op : "+d)}}))},s.prototype.legElemCreate=function(n){var r=this,i=n.find("leg");return this.getCall(i).then((function(a){try{var o=i.attr("state"),s=i.attr("deviceId");if(!s){var c="legElemCreate -- Anomaly deviceId missing";return e.error("[TelephonyServiceEventHandlerSipWise] "+c),t.reject(new Error(c))}return e.info("[TelephonyServiceEventHandlerSipWise] legElemCreate / leg state : "+o+" / deviceId : "+s),a.setDeviceIdSipWise(s),a.setRelevantEquipmentId(s),r.callsetStatusFromLegState(a,o,n),a.startDate=null,a.vm=!1,t.when()}catch(l){return e.info("[TelephonyServiceEventHandlerSipWise] legElemCreate catch"),c="legElemCreate -- "+l.message,e.error("[TelephonyServiceEventHandlerSipWise] "+c),t.reject(new Error(c))}}))},s.prototype.legElemUpdate=function(n){e.info("[TelephonyServiceEventHandlerSipWise] legElemUpdate");var r=this,i=n.find("leg");return this.getCall(i).then((function(a){try{e.info("[TelephonyServiceEventHandlerSipWise] legElemUpdate try");var o=i.attr("state");return r.callsetStatusFromLegState(a,o,n),t.when()}catch(c){e.info("[TelephonyServiceEventHandlerSipWise] legElemUpdate catch");var s="legElemUpdate -- "+c.message;return e.error("[TelephonyServiceEventHandlerSipWise] "+s),t.reject(new Error(s))}}))},s.prototype.endPointElemCreate=function(n){e.info("[TelephonyServiceEventHandlerSipWise] endPointElemCreate");var r=this,i=n.find("endpoint"),a=i.attr("callId"),s=i.find("phoneNumber").text(),c=i.find("jid").text(),l=i.find("firstName").text(),u=i.find("lastName").text();return i.find("displayName").text(),c||s?t((function(t){o.a.getOrCreateContact(c,s).then((function(n){c||l&&u&&n.updateName(l,u);var i=r.getCallFromCallId(a);a&&i?(i.setContact(n),e.info("[TelephonyServiceEventHandlerSipWise] endPointElemCreate setContact DONE : displayName = "+i.contact.nameForLog)):e.info("[TelephonyServiceEventHandlerSipWise] endPointElemCreate NOT DONE / no associated call"),t()}))})):(e.error("[TelephonyServiceEventHandlerSipWise] endPointElemCreate -- Anomaly no jid no phoneNumber"),t.when())},s.prototype.endPointElemUpdate=function(n){e.info("[TelephonyServiceEventHandlerSipWise] endPointElemUpdate");var r=this,i=n.find("endpoint"),a=i.attr("callId"),s=i.find("phoneNumber").text(),c=i.find("jid").text(),l=i.find("firstName").text(),u=i.find("lastName").text();return i.find("displayName").text(),c||s?t((function(t){o.a.getOrCreateContact(c,s).then((function(n){c||l&&u&&n.updateName(l,u);var i=r.getCallFromCallId(a);a&&i?(i.setContact(n),e.info("[TelephonyServiceEventHandlerSipWise] endPointElemUpdate setContact DONE : displayName = "+i.contact.nameForLog)):e.info("[TelephonyServiceEventHandlerSipWise] endPointElemUpdate setContact NOT DONE / no associated call"),t()}))})):(e.error("[TelephonyServiceEventHandlerSipWise] endPointElemUpdate -- Anomaly no jid no phoneNumber"),t.when())},s.prototype.onFailCallEvent=function(t,n){var i=n.find("failedReason").text();e.info("[TelephonyServiceEventHandlerSipWise] onFailCallEvent for callId : "+t.id+" / call status ERROR / cause : "+i),t.setStatus(r.Call.Status.ERROR),t.errorMessage=s.CallFailureLabels[i],t.errorMessage||(t.errorMessage=i)},s.prototype.convLegStateToCallStatus=function(t){var n=null;if(!t)return e.info("[TelephonyServiceEventHandlerSipWise] convLegStateToCallStatus Anomaly no legState"),n;switch(t){case"initiated":case"dialing":n=r.Call.Status.DIALING;break;case"ringingIn":n=r.Call.Status.RINGING_INCOMMING;break;case"ringingOut":n=r.Call.Status.RINGING_OUTGOING;break;case"queued":n=r.Call.Status.QUEUED_INCOMMING;break;case"active":n=r.Call.Status.ACTIVE;break;case"hold":n=r.Call.Status.HOLD;break;case"holdVictim":n=r.Call.Status.PUT_ON_HOLD;break;case"failed":n=r.Call.Status.ERROR;break;default:e.info("[TelephonyServiceEventHandlerSipWise] convLegStateToCallStatus Anomaly legState = "+t)}return n},s.prototype.callsetStatusFromLegState=function(t,n,i){if(t&&n){var a=this.convLegStateToCallStatus(n);a===r.Call.Status.ERROR?this.onFailCallEvent(t,i):t.setStatus(a),e.info("[TelephonyServiceEventHandlerSipWise] callsetStatusFromLegState legstate = "+n+" Call.status = "+t.status.value)}else e.info("[TelephonyServiceEventHandlerSipWise] callsetStatusFromLegState Anomaly Call = "+t+" legState"+n)},s.prototype.getCallFromCallId=function(t){if(!t)return e.debug("[TelephonyServiceEventHandlerSipWise] getCallFromCallId - Anomaly no callId"),null;var n=this.telephonyService.calls[t];return n?(e.debug("[TelephonyServiceEventHandlerSipWise] getCallFromCallId = "+t+" -  call: "+n),n):null},s.prototype.getCall=function(e){var n=this;return t((function(t){var r=e.attr("callId"),i=e.attr("legId");n.getOrCreateCall(r,i).then((function(e){t(e)}))}))},s.prototype.getOrCreateCall=function(n,i){var a=this;if(!n)return t.reject("no callId");var o=this.telephonyService.calls[n];return o&&o.getConnectionIdSipWise()?(e.debug("[TelephonyServiceEventHandlerSipWise] getOrCreateCall - "+n+" -  => found completed call: "+o),t.when(o)):(e.debug("[TelephonyServiceEventHandlerSipWise] getOrCreateCall - "+n+" -  => not completed : manage it"),i?t((function(e){e(a.telephonyService.getOrCreateCallSipWise(r.Call.Status.UNKNOWN,n,i))})):t.reject("no legId"))},s.prototype.sendCallUpdateEvent=function(t,r){if(t){t.autoClear&&(a.cancel(t.autoClear),t.autoClear=null),e.info("[TelephonyServiceEventHandlerSipWise] sendCallUpdateEvent for call "+t);var i=this.extractInfoEvent(r);n.$broadcast("ON_CALL_UPDATED_EVENT",t,i)}},s.prototype.extractInfoEvent=function(e){return e&&null!==e?e:null},s.prototype.CallsUpdate=function(t){var n=this;e.info("[TelephonyServiceEventHandlerSipWise] CallsUpdate"),Object.keys(t||[]).forEach((function(r){t[r]&&t[r].trigger?(e.info("[TelephonyServiceEventHandlerSipWise] CallsUpdate for callId "+r+" triggered"),n.sendCallUpdateEvent(n.getCallFromCallId(r),t[r].info)):e.info("[TelephonyServiceEventHandlerSipWise] CallsUpdate for callId "+r+" no triggered")}))},s.prototype.computeCallRelevancy=function(t){var n=!1,r=this.telephonyService.telephonyServiceSipWise.getCurrentFromDevicesListSipWise();return t&&r&&(n=t===r.deviceId),e.info("[TelephonyServiceEventHandlerSipWise] computeCallRelevancy for deviceId : "+t+" / relevant = "+n),n},s.prototype.checkCallRelevancy=function(t){var n=!1,r=this.telephonyService.telephonyServiceSipWise.getCurrentFromDevicesListSipWise(),i=this.getCallFromCallId(t);return i&&r&&(e.debug("[TelephonyServiceEventHandlerSipWise] checkCallRelevancy call.deviceID = "+i.getDeviceIdSipWise()),n=i.getDeviceIdSipWise()==r.deviceId),e.info("[TelephonyServiceEventHandlerSipWise] checkCallRelevancy for callId : "+t+" / relevant = "+n),n},s}])},function(e,t,n){n.r(t);var r=n(23),i=n(0),a=n(5),o=n.n(a),s=n(2),c=n.n(s),l=n(4),u=n.n(l),d=n(6),h=n.n(d),f=n(14),p=n.n(f),m=n(1),v=n.n(m);angular.module("rainbow").service("telephonyService",["$q","$interval","$http","$rootScope","$log","TelephonyServiceEventHandler","errorHelperService","VoiceMail","videoService","$injector",function(e,t,n,a,s,l,d,f,m,g){var y=this,b=[],S=[],_="urn:xmpp:pbxagent:callservice:1",C=!1;y.rxSubject=new r.a,y.start=function(e){if(s.info("[telephonyService] === STARTING ==="),y.setSipWise(y.isSipWiseRoot()),y.isSipWise()){s.info("[telephonyService] starting in sipWise mode"),_="urn:xmpp:pbxagent:telephony:1";try{y.telephonyServiceEventHandlerSipWise=g.get("TelephonyServiceEventHandlerSipWise")}catch(r){var t=r&&r.message?r.message:"Unknown error",n=r&&r.stack?r.stack:"Unknown stack";s.error("[telephonyService] injection TelephonyServiceEventHandlerSipWise  exception  -- "+t+" : "+n)}try{y.telephonyServiceSipWise=g.get("telephonyServiceSipWise")}catch(r){t=r&&r.message?r.message:"Unknown error",n=r&&r.stack?r.stack:"Unknown stack",s.error("[telephonyService] injection TelephonyServiceSipWise  exception  -- "+t+" : "+n)}}y.startDate=performance.now(),y.stats=e,y.calls=[],y.pendingMakeCalls=[],y.starting=y.started=!1,y.agentStatus={phoneApi:"disconnected",xmppAgent:"stopped",agentVersion:"unknown"},y.voicemailNumber=v.a.userContact.voicemailNumber,y.pbxId=v.a.userContact.pbxId,y.makingCall=!1,y.voiceMail=f.create(),y.forwardObject={},y.nomadicObject={},y.nomadicAnswerNotTakedIntoAccount=!1,y.sipWiseUserGroupsData={huntingGroupNb:0,managerAssistantNb:0,managerAssistGrId:0,managerId:0,managerName:"",managerStatus:"",managerForward:"unknow",assistantId:0,assistantName:"",assistantStatus:"",sipWiseUserGroupsList:[]},y.sipWiseEmergencyCallData={WGEmergencyCallForbidden:!1,emergencyNuList:[],serverData:null},y.isBasicCallAllowed=h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_BASIC_CALL),y.isSecondCallAllowed=h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_SECOND_CALL),y.isTransferAllowed=h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_TRANSFER_CALL),y.isConferenceAllowed=h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_CONFERENCE_CALL),y.isVMDeflectCallAllowed=h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_DEFLECT_CALL),y.voiceMailFeatureEnabled=h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_VOICE_MAIL),y.isForwardEnabled=h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_CALL_FORWARD),y.isNomadicEnabled=h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_NOMADIC),y.userJidTel=c.a.jidTel,y.portalURL=config.restServerUrl+"/api/rainbow/telephony/v1.0/",S.push(u.a.subscribeToContactEvents((function(e){"ON_CONTACT_PRESENCE_EVENT"===e.name&&y.onTelPresenceChange(e.data)}))),y.isSipWise()?y.telephonyEventHandler=y.telephonyServiceEventHandlerSipWise.create(y):y.telephonyEventHandler=l.create(y),s.info("[telephonyService] starting on user jidTel: "+y.userJidTel),v.a.userContact&&(s.info("[telephonyService] starting user name: "+v.a.userContact.nameForLogs+", full jid: "+v.a.userContact.fullJid),s.info("[telephonyService] starting phonePbx: "+p()(v.a.userContact.phonePbx)+", phonePro: "+p()(v.a.userContact.phonePro)+", voicemailNumber: "+p()(v.a.userContact.voicemailNumber)+", pbxId: "+v.a.userContact.pbxId)),v.a.userContact&&(v.a.userContact.telStatus?(s.info("[telephonyService] start with my existing telephony presence "+v.a.userContact.telStatus+" of user contact ("+v.a.userContact.jidtel+") "),y.onTelPresenceChange({jid:y.userJidTel+"/phone",status:v.a.userContact.telStatus})):(s.info("[telephonyService] Subscribe and wait for my telephony presence ("+v.a.userContact.jidtel+")"),v.a.sendSubscribeInvitation(v.a.userContact.jidtel)))},y.onTelPresenceChange=function(e){if(v.a.isTelJid(e.jid)){var t=v.a.getResourceFromJid(e.jid);if("phone"!==t&&"pcg2"!==t)return!0;var n=v.a.getImJid(e.jid);if(!n)return!0;var r=e.status;v.a.isUserContactJid(n)&&("unavailable"===r||"offline"===r?(s.info("[telephonyService] received my telephony presence -- "+r),y.starting=y.started=!1,y.telephonyOfflineCallManagement(),a.$broadcast("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped"),s.info("[telephonyService] === STOPPED ===")):y.started||y.starting||(s.info("[telephonyService] received my telephony presence -- "+r),y.starting=!0,y.getAgentStatus().then((function(){return y.attachHandlers(),y.isSipWise()?(y.sipWiseUserGroupsDataClear(),y.sipWiseEmergencyCallDataClear(),y.telephonyServiceSipWise.resetSipWiseRoutingObject(),y.getTelephonyState(!1)):y.isNomadicEnabled?y.getNomadicStatus().then((function(){var e=y.nomadicObject.featureActivated&&y.nomadicObject.modeActivated&&!y.nomadicObject.makeCallInitiatorIsMain;return y.getTelephonyState(e)})):y.getTelephonyState(!1)})).then((function(){y.isForwardEnabled&&y.getForwardStatus()})).then((function(){var e=Math.round(performance.now()-y.startDate);y.stats.push({service:"telephonyService",startDuration:e}),s.info("[telephonyService] === STARTED ("+e+" ms) ==="),y.started=!0,y.starting=!1,a.$broadcast("ON_TELEPHONY_STATUS_CHANGED_EVENT","started")})).catch((function(e){y.starting=!1,s.error("[telephonyService] receive telephony presence but error in initialization - "+(e?e.message:"unknown error"))}))))}return!0},y.launchTelephonyInitilization=function(){v.a.userContact&&v.a.userContact.telStatus?(s.info("[telephonyService] launchTelephonyInitilization telStatus: "+v.a.userContact.telStatus+" => start"),y.onTelPresenceChange({jid:y.userJidTel+"/phone",status:v.a.userContact.telStatus})):s.info("[telephonyService] launchTelephonyInitilization no tel presence => do nothing")},y.reconnect=function(){s.info("[telephonyService] reconnect (xmpp reconnection)"),y.starting=y.started=!1,y.telephonyOfflineCallManagement(),a.$broadcast("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped"),y.attachHandlers()},y.telephonyOfflineCallManagement=function(){s.info("[telephonyService] telephony Offline Call Management");try{var e=g.get("webrtcGatewayService");Object.keys(y.calls||[]).forEach((function(t){var n=y.calls[t];n&&(n.status!==i.Call.Status.RINGING_INCOMMING&&n.status!==i.Call.Status.QUEUED_INCOMMING||(n.mediaPillarCall&&n.mediaPillarCall.webrtcCallRef&&(s.info("[telephonyService] Offline Call Management: release MP webrtc call for phone call "+n.id+" in state "+n.status.value),m.releaseCall(n.mediaPillarCall.webrtcCallRef)),s.info("[telephonyService] Offline Call Management: stop popup and ringing tone for phone call "+n.id+" in state "+n.status.value),n.setStatus(i.Call.Status.UNKNOWN),n.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",n)),(n.status===i.Call.Status.RINGING_OUTGOING||n.status===i.Call.Status.QUEUED_OUTGOING)&&e.isMediaPillarCallSituation(n)&&n.mediaPillarCall&&n.mediaPillarCall.webrtcCallRef&&(s.info("[telephonyService] Offline Call Management: release MP webrtc call for phone call "+n.id+" in state "+n.status.value),m.releaseCall(n.mediaPillarCall.webrtcCallRef)),e.isMediaPillarCallSituation(n)&&n.status===i.Call.Status.ACTIVE?(s.info("[telephonyService] Offline Call Management: keep MP call for phone call "+n.id+" in state "+n.status.value),n.pbxConnectionDown=!0):(delete y.calls[n.id],s.info("[telephonyService] Offline Call Management: phone call deleted: "+n.id+" in state "+n.status.value)))})),s.info("[telephonyService] Offline Call Management: clear "+y.pendingMakeCalls.length+" pending makecalls"),y.pendingMakeCalls=[]}catch(r){var t=r&&r.message?r.message:"Unknown error",n=r&&r.stack?r.stack:"Unknown stack";s.error("[telephonyService] telephonyOfflineCallManagement  exception  -- "+t+" : "+n)}},y.getTelephonyState=function(t){if(y.isSipWise())return e((function(e,t){s.info("[telephonyService] getTelephonyState -- sipWise get Devices then routingInfo then snapshot"),y.telephonyServiceSipWise.getUserDevices(y).then((function(){return y.telephonyServiceSipWise.getUserRoutingInfo(y)})).then((function(){return y.telephonyServiceSipWise.processSnapshot(y)})).then((function(){y.getSipWiseUserGroups()})).then((function(){y.fetchSipWiseEmergencyCallData()})).then((function(){e()})).catch((function(e){s.info("[telephonyService] sipwise getTelephonyState CATCH");var n="sipwise getTelephonyState -- "+e.message;s.error("[telephonyService] "+n),t(e)}))}));var n,r=e.defer();return n=t?$iq({type:"get",to:y.userJidTel+"/phone"}).c("callservice",{xmlns:_}).c("connections",{deviceType:"SECONDARY"}):$iq({type:"get",to:y.userJidTel+"/phone"}).c("callservice",{xmlns:_}).c("connections"),u.a.sendIQ(n,6e4).then((function(n){var i=y.getErrorMessage(n,"getTelephonyState");if(i)return s.info("[telephonyService] getTelephonyState -- failure -- "+i),r.reject(new Error(i)),r.promise;var a=angular.element(n).find("connection");if(s.info("[telephonyService] getTelephonyState ("+(t?"SECONDARY":"MAIN")+") -- success -- "+a.length+" existing call(s)"),0===a.length)return r.resolve(),r.promise;var o=[];return a.each((function(){o.push(y.createCallFromConnectionElem(this,t))})),e.all(o).then((function(){s.info("[telephonyService] getTelephonyState ("+(t?"SECONDARY":"MAIN")+") -- calls creation completed -- "+a.length+" calls created"),r.resolve()})).catch((function(e){s.error("[telephonyService] getTelephonyState -- calls creation failure -- "+e.message),r.reject(e)})),r.promise})).catch((function(e){s.error("[telephonyService] getTelephonyState -- failure -- "+e.message),r.reject(e)})),r.promise},y.snapshotDevice=function(t){return e((function(e,r){if(y.isSipWise())e();else{var i=y.portalURL+"snapshotdevice";t&&(i+="?deviceType=SECONDARY"),n({method:"GET",url:i,headers:c.a.getRequestHeader()}).then((function(t){s.info("[telephonyService] snapshotdevice success "),e(t.data.data)}),(function(e){s.error("[telephonyService] "+d.getErrorFullMessage(e,"snapshotdevice"));var t=d.handleError(e);r(t)}))}}))},y.getAgentStatus=function(){var t=e.defer(),n="/phone";y.isSipWise()&&(s.info("[telephonyService] getAgentStatus --- sipWise version"),n="/pcg2");var r=$iq({type:"get",to:y.userJidTel+n}).c("pbxagentstatus",{xmlns:"urn:xmpp:pbxagent:monitoring:1"});return u.a.sendIQ(r,6e4).then((function(e){var n=angular.element(e).find("phoneapi").text(),r=angular.element(e).find("xmppagent").text(),i=angular.element(e).find("version").text(),o=angular.element(e).find("features").text(),c=angular.element(e).find("type").text();if(i&&(y.agentStatus={phoneApi:n,xmppAgent:r,agentVersion:i,features:o},c?(y.isOxe=c.toLowerCase().includes("oxe"),y.isOxo=c.toLowerCase().includes("oxo")):(y.isOxe=i.toLowerCase().includes("oxe"),y.isOxo=i.toLowerCase().includes("oxo"))),y.isSipWise()&&"RVCP"!==c){y.setSipWise(!1);var l="getAgentStatus -- sipWise failure : wrong PCG type";s.error("[telephonyService] "+l),t.reject(new Error(l))}s.info("[telephonyService] getAgentStatus -- success -- version "+i+" isOxe:"+y.isOxe+" isOxo:"+y.isOxo+" isSipWise:"+y.isSipWise()),a.$broadcast("ON_AGENT_STATUS_RECEIVED_EVENT"),t.resolve()})).catch((function(e){var n="getAgentStatus -- failure : "+e.message;s.error("[telephonyService] "+n),t.reject(new Error(n))})),t.promise},y.getSnapshotCall=function(t){return s.info("[telephonyService] getSnapshotCall"),e((function(e,n){var r=$iq({type:"get",to:y.userJidTel+"/phone"}).c("callservice",{xmlns:_}).c("snapshotCall",{callId:t});u.a.sendIQ(r).then((function(t){console.error(t),e()})).catch((function(e){var t="getSnapshotCall failure : "+e.message;s.error("[telephonyService] "+t),n(new Error(t))}))}))},y.createCallFromConnectionElem=function(t,n){return e((function(e,r){var o=angular.element(t),c=o.attr("endpointIm"),l=o.attr("endpointTel"),u=o.attr("callId"),d=o.attr("endpointLci"),f=o.attr("lci"),m=o.find("participant"),b=o.find("identity").attr("firstName"),S=o.find("identity").attr("lastName"),_="",C="";c||l||(l="****"),h.a.isFeatureEnabled(h.a.FeaturesEnum.TELEPHONY_PHONE_BOOK)&&0===m.length&&S&&S.length&&(C=S,b&&b.length&&(_=b),s.info("[telephonyService] createCallFromConnectionElem - name resolution for: "+u+" for phoneNumber:"+p()(l)+" with firstname : "+_.slice(0,1)+"***")),"LCI_INITIATED"!==f||n&&g.get("webrtcGatewayService").IsMediaPillarUserSelected()?(0===m.length?v.a.getOrCreateContact(c,l):y.getParticipantsFromParticipantsElem(m)).then((function(t){var r=i.Call.Status.ACTIVE;"LCI_INITIATED"===f&&(r=i.Call.Status.DIALING),"LCI_HELD"===f&&"LCI_CONNECTED"===d&&(r=i.Call.Status.HOLD),"LCI_CONNECTED"===f&&"LCI_HELD"===d&&(r=i.Call.Status.PUT_ON_HOLD),"LCI_CONNECTED"===f&&"LCI_QUEUED"===d&&(r=i.Call.Status.QUEUED_OUTGOING),"LCI_QUEUED"===f&&"LCI_CONNECTED"===d&&(r=i.Call.Status.QUEUED_INCOMMING),"LCI_ALERTING"===f&&(r=i.Call.Status.RINGING_INCOMMING);var o=null;0===m.length?(t&&t.temp&&""!==C&&t.updateName(_,C),o=y.getOrCreateCall(r,u,t),s.info("[telephonyService] createCallFromConnectionElem - create call for user: "+t.id+" with callId: "+u+" "+f)):((o=y.getOrCreateCall(r,u)).setParticipants(t),o.isConference=!0,s.info("[telephonyService] createCallFromConnectionElem - create conference call with callId: "+u+" "+f)),o.relevantEquipmentId=i.Call.getDeviceIdFromConnectionId(u),o.isSecondary=n,o.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",o),e(o)})).catch((function(e){s.error("[TelephonyService] createCallFromConnectionElem - failure - "+e.message),r(e)})):e()}))},y.getParticipantsFromParticipantsElem=function(t){return e((function(n,r){var i=[],a=[];t.each((function(){var t=angular.element(this),n=t.find("endpointTel").text(),r=t.find("endpointIm").text();r&&v.a.isUserContactJid(r)||a.push(e((function(e,t){r||n||(n="****"),v.a.getOrCreateContact(r,n).then((function(t){i.push(t),e()})).catch((function(e){t(e)}))})))})),e.all(a).then((function(){n(i)}),(function(e){r(e)}))}))},y.getOrCreateCall=function(e,t,n){var r=y.calls[i.Call.getIdFromConnectionId(t)];return r?(r.setConnectionId(t),r.startDate=new Date):((r=i.Call.create(e,null,i.Call.Type.PHONE,n)).setConnectionId(t),y.calls[r.id]=r),r},y.createCallSipWise=function(e,t){var n=null;return t&&(n=y.calls[t]),n?n.startDate=new Date:(n=i.Call.create(e,t,i.Call.Type.PHONE),y.calls[n.id]=n),n},y.getOrCreateCallSipWise=function(e,t,n,r,a){var o=null;return t&&(o=y.calls[t]),o?(o.setConnectionIdSipWise(n),a&&o.setContact(a),r&&o.setDeviceIdSipWise(r),o.startDate=new Date):((o=i.Call.create(e,t,i.Call.Type.PHONE,a)).setConnectionIdSipWise(n),o.setDeviceIdSipWise(r),y.calls[o.id]=o),o},y.attachHandlers=function(){if(s.info("[telephonyService] attachHandlers"),0===Object.keys(y.calls||[]).length&&(a.telephonyAreaClass=""),y.messageHandlerRef&&(u.a.deleteHandler(y.messageHandlerRef),y.messageHandlerRef=null),y.messageHandlerRef=u.a.addHandler((function(e){return y.telephonyEventHandler.onCallserviceMessageReceived(e),!0}),_,"message",null),y.isSipWiseRoot()){y.overflowUpdatRef&&(u.a.deleteHandler(y.overflowUpdatRef),y.overflowUpdatRef=null),y.overflowUpdatRef=u.a.addHandler((function(e){return y.telephonyEventHandler.onOverflowUpdateMessageReceived(e),!0}),"urn:xmpp:pbxagent:overflowOnSubscriberUpdated:1","message",null);y.userConfigurationRef&&(u.a.deleteHandler(y.userConfigurationRef),y.userConfigurationRef=null),y.userConfigurationRef=u.a.addHandler((function(e){return y.telephonyEventHandler.onUserConfigurationMessageReceived(e),!0}),"urn:xmpp:rvcp:userConfiguration:1","message",null)}},y.stop=function(){var t;for(s.info(""),s.info("[telephonyService] === STOPPING ==="),y.starting=y.started=!1,y.userJidTel=null,y.calls=null,y.messageHandlerRef&&(u.a.deleteHandler(y.messageHandlerRef),y.messageHandlerRef=null),y.overflowUpdatRef&&(u.a.deleteHandler(y.overflowUpdatRef),y.overflowUpdatRef=null),y.userConfigurationRef&&(u.a.deleteHandler(y.userConfigurationRef),y.userConfigurationRef=null);t=b.pop();)t();return y.currentPgiObject={},S&&S.forEach((function(e){e.unsubscribe()})),s.info("[telephonyService] === STOPPED ==="),a.$broadcast("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped"),e.when()},y.getCallToHangOut=function(){var e=y.getCalls();if(!e||0===e.length)return null;var t=e[0].status;return 1===e.length||t===i.Call.Status.DIALING||t===i.Call.Status.ACTIVE||t===i.Call.Status.PUT_ON_HOLD?e[0]:e[1]},y.getActiveCall=function(){var e=null;return Object.keys(y.calls||[]).forEach((function(t){var n=y.calls[t];n.status===i.Call.Status.ACTIVE&&(e=n)})),e},y.getCalls=function(){var e=[];return Object.keys(y.calls||[]).forEach((function(t){var n=y.calls[t].status;n!==i.Call.Status.DIALING&&n!==i.Call.Status.RINGING_OUTGOING&&n!==i.Call.Status.QUEUED_OUTGOING&&n!==i.Call.Status.ACTIVE&&n!==i.Call.Status.HOLD&&n!==i.Call.Status.PUT_ON_HOLD&&n!==i.Call.Status.ERROR||e.push(y.calls[t])})),e},y.getNotIdleCalls=function(){var e=[];return Object.keys(y.calls||[]).forEach((function(t){var n=y.calls[t];n.status!==i.Call.Status.UNKNOWN&&e.push(n)})),e},y.getActiveCallsForContact=function(e){var t=[];return e&&e.jid&&Object.keys(y.calls||[]).forEach((function(n){!y.calls[n].contact||y.calls[n].contact.jid!==e.jid||y.calls[n].status!==i.Call.Status.DIALING&&y.calls[n].status!==i.Call.Status.RINGING_OUTGOING&&y.calls[n].status!==i.Call.Status.QUEUED_OUTGOING&&y.calls[n].status!==i.Call.Status.ACTIVE&&y.calls[n].status!==i.Call.Status.HOLD&&y.calls[n].status!==i.Call.Status.PUT_ON_HOLD||t.push(y.calls[n])})),t},y.getConferenceCallForContact=function(e){var t=null;return e&&e.jid&&Object.keys(y.calls||[]).forEach((function(n){y.calls[n].status===i.Call.Status.ACTIVE&&y.calls[n].isConference&&(y.calls[n].participants||[]).some((function(t){return t&&t.jid===e.jid}))&&(t=y.calls[n])})),t},y.logMakecallReqData=function(e,t){var n={};Object.keys(e).forEach((function(r){switch(r){case"calleeExtNumber":case"calleeIntNumber":case"calleeShortNumber":n[r]=p()(e[r]);break;case"calleeDisplayName":t&&(n[r]=t&&t.nameForLogs?t.nameForLogs:"");break;default:n[r]=e[r]}})),s.info("[telephonyService] makeCall data: "+JSON.stringify(n))},y.makeCall=function(t,n,r,i){s.info("TELAPI [telephonyService] makeCall to "+(t&&t.nameForLogs?t.nameForLogs:p()(n)));var a=y.getActiveCall();return y.makingCall?(s.warn("[telephonyService] makeCall failure - makeCall already making a call"),e.reject()):(y.makingCall=!0,a?y.isSipWise()?y.telephonyServiceSipWise.makeSimpleCallSipWise(y,t,n):y.makeConsultationCall(t,n,a.connectionId,i):y.isSipWise()?y.telephonyServiceSipWise.makeSimpleCallSipWise(y,t,n):y.makeSimpleCall(t,n,r,i))},y.makeSimpleCall=function(t,n,r,i){if(s.info("[telephonyService] makeSimpleCall to "+(t&&t.nameForLogs?t.nameForLogs:p()(n))),!y.isBasicCallAllowed){var o=new Error("makeSimpleCall failure - Not Allowed");return o.status=o.errorDetailsCode="403",s.error("[telephonyService] "+o.message),y.makingCall=!1,e.reject(o)}if(g.get("webrtcGatewayService").isMediaPillarCallSituation()&&m.getWebrtcAudioCall())return s.info("[telephonyService] makeCall failure - webrtcgateway call not possible when webrtc call already engaged"),y.makingCall=!1,a.$broadcast("ON_CALL_NOTALLOWED_EVENT","webCallAlreadyProgress"),e.reject("webCallAlreadyProgress");var c=y.getPhoneInfo(t,n),l=y.portalURL+"calls",u={calleeExtNumber:c.longNumber,calleeIntNumber:c.internalNumber,calleeShortNumber:c.shortNumber,calleePbxId:c.pbxId,calleeDisplayName:t.displayName,callSubject:r,correlatorData:i,secondaryDeviceMakeCall:angular.isDefined(y.nomadicObject.makeCallInitiatorIsMain)&&!0===y.nomadicObject.featureActivated&&y.isNomadicEnabled?y.nomadicObject.makeCallInitiatorIsMain?"false":"true":void 0};return s.info("[telephonyService] makeSimpleCall POST "+l),y.logMakecallReqData(u,t),y.doRequestMakecall(t,n,"POST",l,u)},y.makeConsultationCall=function(t,n,r,a){if(s.info("[telephonyService] makeConsultationCall to "+(t&&t.nameForLogs?t.nameForLogs:p()(n))),!y.isSecondCallAllowed){var o=new Error("makeConsultationCall failure - Not Allowed");return o.status=o.errorDetailsCode="403",s.error("[telephonyService] "+o.message),y.makingCall=!1,e.reject(o)}var c=y.getPhoneInfo(t,n,a),l=y.portalURL+"calls/"+encodeURIComponent(r)+"/consultation",u={calleeExtNumber:c.longNumber,calleeIntNumber:c.internalNumber,calleeShortNumber:c.shortNumber,calleePbxId:c.pbxId,calleeDisplayName:t.displayName,correlatorData:c.correlatorData};return s.info("[telephonyService] makeConsultationCall POST "+l),y.logMakecallReqData(u,t),y.doRequestMakecall(t,n,"POST",l,u).catch((function(e){throw y.deleteCallIfInvalid(e,y.calls[i.Call.getIdFromConnectionId(r)]),e}))},y.doRequestMakecall=function(r,o,l,u,h){return e((function(e,f){s.info("[telephonyService] doRequestMakecall to "+(r&&r.nameForLogs?r.nameForLogs:p()(o)));var m=i.Call.create(i.Call.Status.UNKNOWN,null,i.Call.Type.PHONE,r);m.isSecondary=y.nomadicObject&&!y.nomadicObject.makeCallInitiatorIsMain,m.isOwner=!0,m.setIsVm(o===y.voicemailNumber),y.pendingMakeCalls.push(m),s.info("[telephonyService] doRequestMakecall Call created ("+m+")"),n({method:l,url:u,headers:c.a.getRequestHeader(),data:h}).then((function(t){s.info("[telephonyService] doRequestMakecall success : callee "+p()(o)+" callId: "+t.data.data.callId),y.pendingMakeCalls.includes(m)?(m.setStatus(i.Call.Status.DIALING),m.setConnectionId(t.data.data.callId),m.setRelevantEquipmentId(i.Call.getDeviceIdFromConnectionId(m.connectionId)),y.calls[m.id]=m,y.pendingMakeCalls.splice(y.pendingMakeCalls.indexOf(m),1),s.info("[telephonyService] doRequestMakecall Call confirmed by makecall acknowlegement ("+m+")"),m.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",m),e(m.id)):e(m.id?m.id:t.data.data.callId),y.makingCall=!1}),(function(e){s.error("[telephonyService] "+d.getErrorFullMessage(e,"makeCall")),m.setStatus(i.Call.Status.ERROR),m.errorMessage=e&&"403"===e.errorDetailsCode?"notAllowed":"invalidPhoneNumber",y.calls[m.contact.id]=m,y.pendingMakeCalls.splice(y.pendingMakeCalls.indexOf(m),1),m.autoClear=t((function(){y.clearCall(m)}),5e3,1),y.makingCall=!1,m.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",m);var n=d.handleError(e);f(n)}))}))},y.makeCallByPhoneNumber=function(t,n,r){return e((function(e,i){if(s.info("[telephonyService] makeCallByPhoneNumber : "+p()(t)),v.a.userContact.phonePro===t||v.a.userContact.phoneProCan===t||v.a.userContact.phonePbx===t){var a="makeCallByPhoneNumber failure: impossible to call its own phone number";return s.error("[telephonyService] "+a),void i(new Error(a))}v.a.getOrCreateContact(null,t).then((function(e){return e,y.makeCall(e,t,n,r)})).then((function(){e()})).catch((function(e){var t="makeCallByPhoneNumber failure "+(e?e.message:"");s.error("[telephonyService] - callService - "+t),i(new Error(t))}))}))},y.getPhoneInfo=function(e,t,n){var r=t,i="",a="",o="";return e&&(t===e.phonePro||t===e.phoneProCan?(r=e.phoneProCan?e.phoneProCan:"",i=e.phonePbx,o=e.pbxId,a=e.phoneInternalNumber):t===e.phonePbx&&(r="",i=e.phonePbx,o=e.pbxId,a=e.phoneInternalNumber)),{longNumber:r,shortNumber:i,pbxId:o,internalNumber:a,correlatorData:n}},y.getErrorMessage=function(e,t){var n=t+" failure : ";if("error"===angular.element(e).attr("type")){var r=angular.element(e).find("error");if(r){var i=r.attr("type"),a=r.attr("code");i&&(n+=i+" : ","modify"===i&&(n+=r.find("text").text())),a&&"503"===a&&(n+="Agent error : service unavailable"),s.error("[telephonyService] "+n)}else n+="Unknown error";return n}return null},y.releaseCall=function(t){return e((function(e,r){if(s.info("TELAPI [telephonyService] releaseCall "+t.id),!y.isBasicCallAllowed){var o=new Error("releaseCall failure - Not Allowed");return o.status=o.errorDetailsCode="403",s.error("[telephonyService] "+o.message),void r(o)}if(t.pbxConnectionDown)return t.mediaPillarCall&&t.mediaPillarCall.webrtcCallRef&&t.mediaPillarCall.webrtcCallRef.status!==i.Call.Status.UNKNOWN?(s.info("[telephonyService] releaseCall "+t.id+" with pbx connection down : we release the mediapillar web call: "+t.mediaPillarCall.webrtcCallRef),m.releaseCall(t.mediaPillarCall.webrtcCallRef)):s.info("[telephonyService] releaseCall "+t.id+" with pbx connection down : "+(t.mediaPillarCall?t.mediaPillarCall.webrtcCallRef?"no need to release webrtc call with status "+t.mediaPillarCall.webrtcCallRef:"no MP webrtc call to release":"no MP context!")),s.info("[telephonyService] releaseCall "+t.id+" with pbx connection down : we remove the phone call"),y.clearCall(t),void e(t);if(y.isSipWise())y.telephonyServiceSipWise.releaseCallSipWise(y,t).then((function(t){e(t)}));else{var l=y.portalURL+"calls/"+encodeURIComponent(t.connectionId);s.info("[telephonyService] releaseCall DELETE "+l),n({method:"DELETE",url:l,headers:c.a.getRequestHeader()}).then((function(){t.setStatus(i.Call.Status.UNKNOWN),t.startDate=null,t.vm=!1,s.info("[telephonyService] releaseCall "+t.id+" - success"),t.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",t),delete y.calls[t.id],e(t)}),(function(e){var n=d.handleError(e);y.deleteCallIfInvalid(n,t),r(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"releaseCall"))}))}}))},y.releaseCallAndNotify=function(t){return e((function(e,n){y.releaseCall(t).then((function(){e()})).catch((function(){t.setStatus(i.Call.Status.UNKNOWN),a.$broadcast("ON_CALL_UPDATED_EVENT",t),n()}))}))},y.deleteCallIfInvalid=function(e,t){e&&"telephony"===e.portal&&404100===e.errorDetailsCode&&e.message&&(e.message.toLowerCase().includes("invalid connection identifier")||e.message.toLowerCase().includes("failed to send releasecall"))&&t&&(s.warn("[telephonyService] deleteCallIfInvalid: delete client call non existing on server: "+t.id),t.setStatus(i.Call.Status.UNKNOWN),t.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",t),y.calls[t.id]&&delete y.calls[t.id])},y.answerCall=function(t){return e((function(e,r){s.info("[telephonyService] answerCall : "+t.id);var o=y.getActiveCall();if(!y.isBasicCallAllowed){var l=new Error("answerCall failure - Not Allowed");return l.status=l.errorDetailsCode="403",s.error("[telephonyService] "+l.message),void r(l)}if(t.isMediaPillarCall()&&g.get("webrtcGatewayService").isMediaPillarCallSituation(t)&&a.isDesktopApp){var u=t.getMediaPillarCall();if(u&&u.webrtcCallRef)return m.answerCall(u.webrtcCallRef,"audio"),s.info("[telephonyService] answer webrtcgateway sending webrtc proceed"),void e(t);s.info("[telephonyService] answer webrtcgateway | Anomaly media Pillar : answer but no webrtcCallref")}y.isSipWise()?y.telephonyServiceSipWise.answerCallSipWise(y,t).then((function(t){e(t)}),(function(e){r(e)})):t.status===i.Call.Status.QUEUED_INCOMMING&&o&&y.isOxe?y.holdCall(o).catch((function(e){s.warn("[telephonyService] holdCall (before answerCall) failed on callId:"+o.connectionId+" "+e)})).then((function(){return y.answerCall(t)})).then((function(t){e(t)})).catch((function(e){var t="answerCall failure : "+e.message;s.error("[telephonyService] - callService -  "+t),r(new Error(t))})):n({method:"PUT",url:y.portalURL+"calls/"+encodeURIComponent(t.connectionId)+"/answer",headers:c.a.getRequestHeader()}).then((function(n){t.setConnectionId(n.data.data.callId),t.setStatus(i.Call.Status.ACTIVE),s.info("[telephonyService] answerCall success : "+p()(t.contact.phone)+" Call ("+t+")"),t.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",t),e(t)}),(function(e){e.data&&"Device is not able to answer a call"===e.data.errorDetails&&a.$broadcast("ON_OPEN_GLOBAL_POPUP",{autoClose:!1,okLabel:"close",popupTitle:"warning",popupBody:"deviceDoesntAllowAnswer"}),t.setStatus(i.Call.Status.UNKNOWN);var n=d.handleError(e);r(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"answerCall"))}))}))},y.answerCallAndNotify=function(t){return e((function(e,n){y.answerCall(t).then((function(){e()})).catch((function(){t.setStatus(i.Call.Status.UNKNOWN),a.$broadcast("ON_CALL_UPDATED_EVENT",t),n()}))}))},y.holdCall=function(t){return e((function(e,r){if(s.info("[telephonyService] holdCall : callId: "+t.id+" "+t.contact.nameForLog),t&&t.status!==i.Call.Status.HOLD){if(!y.isSecondCallAllowed){var o=new Error("holdCall failure - Not Allowed");return o.status=o.errorDetailsCode="403",s.error("[telephonyService] "+o.message),void r(o)}y.isSipWise()?y.telephonyServiceSipWise.holdCallSipWise(y,t).then((function(t){e(t)}),(function(e){r(e)})):n({method:"PUT",url:y.portalURL+"calls/"+encodeURIComponent(t.connectionId)+"/hold",headers:c.a.getRequestHeader()}).then((function(n){s.info("[telephonyService] holdCall success : "+p()(t.contact.phone)+" Call ("+t+")"),t.setConnectionId(n.data.data.callId),t.setStatus(i.Call.Status.HOLD),t.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",t),e(t)}),(function(e){var t=d.handleError(e);r(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"holdCall"))}))}else e(t)}))},y.retrieveCall=function(t){return e((function(e,r){if(s.info("[telephonyService] retrieveCall callId: "+t.id+" "+t.contact.nameForLog),!y.isSecondCallAllowed){var o=new Error("retrieveCall failure - Not Allowed");return o.status=o.errorDetailsCode="403",s.error("[telephonyService] "+o.message),void r(o)}var l=y.getActiveCall();if(l)y.holdCall(l).then((function(){return y.retrieveCall(t)})).then((function(t){e(t)})).catch((function(e){var t="retrieveCall failure : "+e.message;s.error("[telephonyService] - callService -  "+t),r(new Error(t))}));else{if(y.isSipWise())return void y.telephonyServiceSipWise.retrieveCallSipWise(y,t).then((function(t){e(t)}),(function(e){r(e)}));n({method:"PUT",url:y.portalURL+"calls/"+encodeURIComponent(t.connectionId)+"/retrieve",headers:c.a.getRequestHeader()}).then((function(n){s.info("[telephonyService] retrieveCall success : "+p()(t.contact.phone)+" Call ("+t+")"),t.setConnectionId(n.data.data.callId),t.setStatus(i.Call.Status.ACTIVE),t.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",t),e()}),(function(e){var n=d.handleError(e);y.deleteCallIfInvalid(n,t),r(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"retrieveCall"))}))}}))},y.deflectCallToVM=function(t){return e((function(e,r){if(t){if(!y.isVMDeflectCallAllowed){var i=new Error("deflectCall failure - Not Allowed");return i.status=i.errorDetailsCode="403",s.error("[telephonyService] "+i.message),void r(i)}s.info("[telephonyService] deflectCallToVM "+t.contact.nameForLogs),y.isSipWise()?y.telephonyServiceSipWise.deflectCallSipWise(y,t,y.voicemailNumber).then((function(){e()}),(function(e){r(e)})):n({method:"PUT",url:y.portalURL+"calls/"+encodeURIComponent(t.connectionId)+"/deflect",headers:c.a.getRequestHeader(),data:{calleeExtNumber:"",calleeIntNumber:y.voicemailNumber,calleeShortNumber:y.voicemailNumber,calleePbxId:y.pbxId}}).then((function(){s.info("[telephonyService] deflectCall success"),e()}),(function(e){var t=d.handleError(e);r(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"deflectCallToVM"))}))}else e(t)}))},y.deflectCallToNumber=function(t,n){return e((function(e,r){if(t&&n){var i;if(!y.isVMDeflectCallAllowed)return(i=new Error("deflectCall failure - Not Allowed")).status=i.errorDetailsCode="403",s.error("[telephonyService] "+i.message),void r(i);s.info("[telephonyService] deflectCallToNumber "+t.contact.nameForLog),y.isSipWise()?y.telephonyServiceSipWise.deflectCallSipWise(y,t,n).then((function(){e()}),(function(e){r(e)})):((i=new Error("deflectCall failure - Not Allowed")).status=i.errorDetailsCode="403",s.error("[telephonyService] "+i.message),r(i))}else e(t)}))},y.transfertCall=function(t,r){return e((function(e,i){if(t&&r){if(!y.isTransferAllowed){var a=new Error("transferCall failure - Not Allowed");return a.status=a.errorDetailsCode="403",s.error("[telephonyService] "+a.message),void i(a)}if(s.info("[telephonyService] transfertCall held("+r.contact.displayName+") to active("+t.contact.displayName+")"),y.isSipWise())return y.telephonyServiceSipWise.transfertCallSipWise(y,t,r);n({method:"PUT",url:y.portalURL+"calls/"+encodeURIComponent(t.connectionId)+"/transfer/"+encodeURIComponent(r.connectionId),headers:c.a.getRequestHeader()}).then((function(){s.info("[telephonyService] transferCall success"),e()}),(function(e){var t=d.handleError(e);i(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"transfertCall"))}))}else e()}))},y.blindTransfertCall=function(t,n){return e((function(e,r){if(t&&n){var i;if(!y.isTransferAllowed||!y.isSipWise())return(i=new Error("blind transfertCall failure - Not Allowed")).status=i.errorDetailsCode="403",s.error("[telephonyService] "+i.message),void r(i);if("demo"===y.sipWiseMode())return y.telephonyServiceSipWise.blindTransfertCallSipWise(y,t,n);s.info("[telephonyService]  blind Transfert sipWise not implemented"),(i=new Error("blind transferCall failure - Not Allowed")).status=i.errorDetailsCode="403",s.error("[telephonyService] "+i.message),r(i)}else e()}))},y.conferenceCall=function(t,r){return e((function(e,i){if(t&&r){if(!y.isConferenceAllowed){var a=new Error("conferenceCall failure - Not Allowed");return a.status=a.errorDetailsCode="403",s.error("[telephonyService] "+a.message),void i(a)}if(s.info("TELAPI [telephonyService] conferenceCall "+t.connectionId+" ("+t.contact.displayName+") and "+r.connectionId+" ("+r.contact.displayName+")"),y.isSipWise())return y.telephonyServiceSipWise.conferenceCallSipWise(y,t,r);n({method:"PUT",url:y.portalURL+"calls/"+encodeURIComponent(t.connectionId)+"/conference/"+encodeURIComponent(r.connectionId),headers:c.a.getRequestHeader()}).then((function(){s.info("[telephonyService] conferenceCall success"),e()}),(function(e){var t=d.handleError(e);i(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"conferenceCall"))}))}else e()}))},y.sipWiseForwardToDevice=function(t,n,r){return e((function(e,i){if(s.info("[telephonyService] sipWiseforwardToDevice : "+t+" / destType = "+n+" / fwType = "+r),!y.isForwardEnabled){var a=new Error("sipWiseforwardToDevice failure - Not Allowed");return a.status=a.errorDetailsCode="403",s.error("[telephonyService] "+a.message),void i(a)}if(v.a.userContact.phonePro===t||v.a.userContact.phoneProCan===t||v.a.userContact.phonePbx===t){var o="sipWiseforwardToDevice failure: impossible to forward its own phone number";return s.error("[telephonyService] "+o),void i(new Error(o))}return t&&r&&""!==r&&n&&""!==n?y.isSipWise()?void y.telephonyServiceSipWise.forwardToDeviceSipWise(y,t,n,r).then((function(){e()}),(function(e){var t=d.handleError(e);i(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"forwardToDevice"))})):(o="sipWiseforwardToDevice not implemented if not sipWise case",s.error("[telephonyService] "+o),void i(new Error(o))):(o="sipWiseforwardToDevice failure: bad parameters",s.error("[telephonyService] "+o),void i(new Error(o)))}))},y.sipWiseCancelForward=function(t){return e((function(e,n){if(s.info("[telephonyService] sipWiseCancelForward :  fwType = "+t),!y.isForwardEnabled){var r=new Error("cancelForward failure - Not Allowed");return r.status=r.errorDetailsCode="403",s.error("[telephonyService] "+r.message),void n(r)}if(!y.isSipWise()){var i="sipWiseCancelForward not implemented if not sipWise case";return s.error("[telephonyService] "+i),void n(new Error(i))}y.telephonyServiceSipWise.cancelForwardSipWise(y,t).then((function(){e()}),(function(e){var t=d.handleError(e);n(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"sipWiseCancelForward"))}))}))},y.forwardToDevice=function(t){return e((function(e,r){if(s.info("[telephonyService] forwardToDevice : "+t),!y.isForwardEnabled){var i=new Error("forwardToDevice failure - Not Allowed");return i.status=i.errorDetailsCode="403",s.error("[telephonyService] "+i.message),void r(i)}if(v.a.userContact.phonePro===t||v.a.userContact.phoneProCan===t||v.a.userContact.phonePbx===t){var a="forwardToDevice failure: impossible to forward its own phone number";return s.error("[telephonyService] "+a),void r(new Error(a))}y.isSipWise()?v.a.getOrCreateContact(null,t).then((function(n){var i=y.getPhoneInfo(n,t),a="externalNumber";""!==i.longNumber?(a="externalNumber",t=i.longNumber):(a="internalNumber",t=i.shortNumber),y.telephonyServiceSipWise.forwardToDeviceSipWise(y,t,a,"immediate").then((function(){e()}),(function(e){var t=d.handleError(e);r(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"forwardToDevice"))}))})):v.a.getOrCreateContact(null,t).then((function(i){var a=y.getPhoneInfo(i,t);n({method:"PUT",url:y.portalURL+"forward",headers:c.a.getRequestHeader(),data:{calleeExtNumber:a.longNumber,calleeIntNumber:a.internalNumber,calleeShortNumber:a.shortNumber,calleePbxId:a.pbxId,calleeDisplayName:i.displayName}}).then((function(){e()}),(function(e){var t=d.handleError(e);r(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"forwardToDevice"))}))}))}))},y.forwardToVoicemail=function(t){return e((function(e,r){if(s.info("[telephonyService] forwardToVoicemail"),!y.voiceMailFeatureEnabled||!y.isForwardEnabled){var i=new Error("forwardToVoicemail failure - voicemail/forward feature not enabled");return i.status=i.errorDetailsCode="404",s.error("[telephonyService] "+i.message),void r(i)}if(y.isSipWise()){var a=t||"immediate";y.telephonyServiceSipWise.forwardToDeviceSipWise(y,y.voicemailNumber,"voicemail",a).then((function(){e()}),(function(e){var t=d.handleError(e);r(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"forwardToVoicemail"))}))}else n({method:"PUT",url:y.portalURL+"forward",headers:c.a.getRequestHeader(),data:{calleeExtNumber:"",calleeIntNumber:y.voicemailNumber,calleePbxId:y.pbxId}}).then((function(){s.info("[telephonyService] forwardToVoicemail success"),e()}),(function(e){var t=d.handleError(e);r(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"forwardToVoicemail"))}))}))},y.cancelForward=function(){return e((function(e,t){if(s.info("[telephonyService] cancelForward"),!y.isForwardEnabled){var r=new Error("cancelForward failure - Not Allowed");return r.status=r.errorDetailsCode="403",s.error("[telephonyService] "+r.message),void t(r)}if(y.isSipWise()){y.telephonyServiceSipWise.cancelForwardSipWise(y,"immediate").then((function(){e()}),(function(e){var n=d.handleError(e);t(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"cancelForward"))}))}else v.a.userContact.phonePbx?n({method:"PUT",url:y.portalURL+"forward",headers:c.a.getRequestHeader(),data:{calleeExtNumber:"",calleeIntNumber:"CANCELFORWARD",calleePbxId:y.pbxId}}).then((function(){s.info("[telephonyService] cancelForward success"),e()}),(function(e){var n=d.handleError(e);t(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"cancelForward"))})):t()}))},y.getForwardStatus=function(){return e((function(e,t){if(!y.isForwardEnabled){var r=new Error("getForwardStatus failure - Not Allowed");return r.status=r.errorDetailsCode="403",s.error("[telephonyService] "+r.message),void t(r)}if(y.starting||y.started){if(y.isSipWise())return void y.telephonyServiceSipWise.getForwardStatusSipWise(y).then((function(){e()}),(function(e){var n=d.handleError(e);t(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"getForwardStatus"))}));n({method:"GET",url:y.portalURL+"forward",headers:c.a.getRequestHeader()}).then((function(){s.info("[telephonyService] getForwardStatus success"),e()}),(function(e){var n=d.handleError(e);t(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"getForwardStatus"))}))}else t(new Error("getForwardStatus failure - Telephony not started"))}))},y.getForwardObject=function(){return y.forwardObject},y.isOverFlowStatusActivated=function(){return e((function(e,t){y.isSipWise()?y.telephonyServiceSipWise.getOverFlowStatusSipWise(v.a.userContact.systemId,v.a.userContact.phoneNumberId).then((function(t){e(t.activate)}),(function(e){t(e)})):e(!1)}))},y.nomadicLogin=function(t,r,i){return e((function(e,a){if(!y.isNomadicEnabled||!y.nomadicObject.featureActivated){var o=new Error("nomadicLogin failure - Not Allowed");return o.status=o.errorDetailsCode="403",s.error("[telephonyService] "+o.message),void a(o)}if(v.a.userContact.phonePro===t||v.a.userContact.phoneProCan===t||v.a.userContact.phonePbx===t){var l="nomadicLogin failure: impossible to use its own phone number like nomadic phone";return s.error("[telephonyService] "+l),void a(new Error(l))}s.info("[telephonyService] nomadicLogin : "+p()(t)),i=i||!1,r=r||!1,y.nomadicAnswerNotTakedIntoAccount=i,v.a.getOrCreateContact(null,t).then((function(i){var o=y.getPhoneInfo(i,t);n({method:"PUT",url:y.portalURL+"nomadic/login",headers:c.a.getRequestHeader(),data:{destinationExtNumber:o.longNumber,destinationIntNumber:o.internalNumber,destinationShortNumber:o.shortNumber,destinationRainbowNumber:r?t:"",destinationPbxId:o.pbxId,destinationDisplayName:i.displayName,destinationCountry:i.country}}).then((function(){s.info("[telephonyService] nomadicLogin success"),e()}),(function(e){var t=d.handleError(e);a(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"nomadicLogin"))}))}))}))},y.nomadicLoginOnOfficePhone=function(){return e((function(e,t){if(!y.isNomadicEnabled||!y.nomadicObject.featureActivated){var r=new Error("nomadicLoginOnOfficePhone failure - Not Allowed");return r.status=r.errorDetailsCode="403",s.error("[telephonyService] "+r.message),void t(r)}s.info("[telephonyService] nomadicLoginOnOfficePhone"),n({method:"PUT",url:y.portalURL+"nomadic/login",headers:c.a.getRequestHeader()}).then((function(){s.info("[telephonyService] nomadicLoginOnOfficePhone success"),e()}),(function(e){var n=d.handleError(e);t(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"nomadicLoginOnOfficePhone"))}))}))},y.nomadicLogout=function(){return e((function(e,t){if(!y.isNomadicEnabled||!y.nomadicObject.featureActivated){var r=new Error("nomadicLogout failure - Not Allowed");return r.status=r.errorDetailsCode="403",s.error("[telephonyService] "+r.message),void t(r)}s.info("[telephonyService] nomadicLogout"),n({method:"PUT",url:y.portalURL+"nomadic/logout",headers:c.a.getRequestHeader()}).then((function(){s.info("[telephonyService] nomadicLogout success"),e()}),(function(e){var n=d.handleError(e);t(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"nomadicLogout"))}))}))},y.getNomadicStatus=function(){return e((function(e,t){if(y.isSipWise()){s.info("[telephonyService] getNomadicStatus -- SipWise bypass Nomadic");e()}else{if(!y.isNomadicEnabled){var r=new Error("getNomadicStatus failure - Not Allowed");return r.status=r.errorDetailsCode="403",s.error("[telephonyService] "+r.message),void t(r)}y.starting||y.started?n({method:"GET",url:y.portalURL+"nomadic",headers:c.a.getRequestHeader()}).then((function(t){s.info("[telephonyService] getNomadicStatus success"),y.updateNomadicData(t.data.data),e()}),(function(e){var n=d.handleError(e);t(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"getNomadicStatus"))})):t(new Error("getNomadicStatus failure - Telephony not started"))}}))},y.setNomadicState=function(){return e((function(e,t){s.info("[telephonyService] setNomadicState"),n({method:"PUT",url:y.portalURL+"nomadic/state",headers:c.a.getRequestHeader(),data:{makeCallInitiatorIsMain:"true"}}).then((function(){s.info("[telephonyService] setNomadicState success"),e()}),(function(e){var n=d.handleError(e);t(n),s.error("[telephonyService] "+d.getErrorFullMessage(e,"setNomadicState"))}))}))},y.updateNomadicData=function(e){var t=e.destination?p()(e.destination):"";s.info("[telephonyService] updateNomadicData destination: "+t+" featureActivated: "+e.featureActivated+" makeCallInitiatorIsMain: "+e.makeCallInitiatorIsMain+" modeActivated: "+e.modeActivated+" monodevice: "+v.a.userContact.isVirtualTerm+" NomadicInitialized: "+e.nomadicModeInitialized);var n=JSON.parse(JSON.stringify(y.nomadicObject));y.nomadicObject.featureActivated="true"===e.featureActivated,y.nomadicObject.modeActivated="true"===e.modeActivated,y.nomadicObject.destination=e.destination,y.nomadicObject.makeCallInitiatorIsMain="true"===e.makeCallInitiatorIsMain,void 0===e.nomadicModeInitialized?y.nomadicObject.nomadicModeInitialized=!0:y.nomadicObject.nomadicModeInitialized="true"===e.nomadicModeInitialized;var r=n.makeCallInitiatorIsMain!==y.nomadicObject.makeCallInitiatorIsMain;y.nomadicAnswerNotTakedIntoAccount||a.$broadcast("ON_CALL_NOMADIC_EVENT",y.nomadicObject),y.nomadicAnswerNotTakedIntoAccount=!1;var i=g.get("webrtcGatewayService");if(!y.nomadicObject.featureActivated||y.nomadicObject.nomadicModeInitialized||""!==y.nomadicObject.destination&&void 0!==y.nomadicObject.destination||!i.isMediaPillarConfigured())if(v.a.userContact.isVirtualTerm||!y.nomadicObject.featureActivated||y.nomadicObject.nomadicModeInitialized||""!==y.nomadicObject.destination&&void 0!==y.nomadicObject.destination||!v.a.userContact.mobileProCan&&!v.a.userContact.mobilePerso)!v.a.userContact.isVirtualTerm||!y.nomadicObject.featureActivated||y.nomadicObject.nomadicModeInitialized||""!==y.nomadicObject.destination&&void 0!==y.nomadicObject.destination||!v.a.userContact.mobileProCan&&!v.a.userContact.mobilePerso?v.a.userContact.isVirtualTerm&&y.nomadicObject.featureActivated&&!y.nomadicObject.makeCallInitiatorIsMain&&!y.nomadicObject.modeActivated&&i.isMediaPillarConfigured()&&(o=i.getMyMediaPillarRemoteExtension(),y.nomadicLogin(o)):(o=v.a.userContact.mobileProCan?v.a.userContact.mobileProCan:v.a.userContact.mobilePerso,y.nomadicLogin(o));else{var o=v.a.userContact.mobileProCan?v.a.userContact.mobileProCan:v.a.userContact.mobilePerso;y.nomadicLogin(o,!1,!0).then((function(){y.nomadicLoginOnOfficePhone()}))}else{o=i.getMyMediaPillarRemoteExtension();y.nomadicLogin(o)}return r},y.getNomadicObject=function(){return y.nomadicObject},y.getNomadicDestination=function(){return y.nomadicObject.destination},y.sendDtmf=function(t,r){return e((function(e,i){if(t&&r){if(s.info("[telephonyService] sendDtmf for call "+t.id),y.isSipWise())return void y.telephonyServiceSipWise.sendDtmfSipWise(y,t,r).then((function(){e()}),(function(e){i(e)}));n({method:"PUT",url:y.portalURL+"calls/"+encodeURIComponent(t.connectionId)+"/dtmf",headers:c.a.getRequestHeader(),data:{dtmf:r}}).then((function(){s.info("[telephonyService] sendDtmf success"),a.$broadcast("ON_DTMF_SENT",r),e()}),(function(e){var t=d.handleError(e);i(t),s.error("[telephonyService] "+d.getErrorFullMessage(e,"sendDtmf"))}))}else i()}))},y.clearCall=function(e,t){if(e)s.info("[telephonyService] clearCall for call id: "+e.id),e.setStatus(i.Call.Status.UNKNOWN),t||(e.publish("ON_CALL_UPDATED_EVENT"),a.$broadcast("ON_CALL_UPDATED_EVENT",e)),e.contact&&delete y.calls[e.contact.id],e.getCurrentCalled()&&e.setCurrentCalled(null);else{s.error("[telephonyService]clearCall failure : call null")}},y.startAsPhoneNumber=function(e){var t=e.trim().split(".").join("");if(t.length<2)return!1;var n=t.match(/^(\+|\d|#|\*|\(|\)|\.|-|\u2013|\u2014|\s|\/)*$/);return!!n&&n[0]===t},y.updateContactFromOutlookInfos=function(t,n,r,i){return s.info("[telephonyService] default updateContactFromOutlookInfos"),e.reject()},y.isSipWiseRoot=function(){return"RVCP Subscriber"===v.a.userContact.systDeviceName},y.setSipWise=function(e){C=e},y.isSipWise=function(){return C},y.getSipWiseDevicesList=function(){return y.isSipWise()?y.telephonyServiceSipWise.getDevicesListSipWise():(s.info("[telephonyService] Anomaly not a sipWise situation"),NULL)},y.getSipWiseDevicesListCurrent=function(){s.info("[telephonyService] getSipWiseDevicesListCurrent"),y.isSipWise()?y.telephonyServiceSipWise.getUserRoutingInfo(y):s.info("[telephonyService] getSipWiseDevicesListCurrent Anomaly not a sipWise situation")},y.setSipWiseDevicesCurrent=function(e){y.isSipWise()?y.telephonyServiceSipWise.putUserRoutingInfo(y,e,null):s.info("[telephonyService] setSipWiseDevicesMain Anomaly not a sipWise situation")},y.setSipWiseRingingOfficePhone=function(e){y.isSipWise()?y.telephonyServiceSipWise.setRingingDeviceSipWise(y,e):s.info("[telephonyService] setSipWiseRingingOfficePhone Anomaly not a sipWise situation")},y.sipWiseUserGroupsDataClear=function(){y.sipWiseUserGroupsData.huntingGroupNb=0,y.sipWiseUserGroupsData.managerAssistantNb=0,y.sipWiseUserGroupsData.managerAssistGrId=0,y.sipWiseUserGroupsData.managerId=0,y.sipWiseUserGroupsData.managerName="",y.sipWiseUserGroupsData.managerStatus="",y.sipWiseUserGroupsData.managerForward="unknow",y.sipWiseUserGroupsData.assistantId=0,y.sipWiseUserGroupsData.assistantName="",y.sipWiseUserGroupsData.assistantStatus="",y.sipWiseUserGroupsData.sipWiseUserGroupsList=[]},y.sipWiseUserGroupsDataIsManagerAssistant=function(){return!!(y.isSipWise()&&y.sipWiseUserGroupsData.managerAssistantNb>0)&&(1===y.sipWiseUserGroupsData.managerAssistantNb||(s.info("[telephonyService] sipWiseUserGroupsDataIsManagerAssistant Anomaly not 1:1 Manager/Assistant"),!1))},y.sipWiseManAssistGetMyRole=function(){var e="";if(y.isSipWise()&&y.sipWiseUserGroupsData.managerAssistantNb>0){var t=y.sipWiseUserGroupsData.sipWiseUserGroupsList.find((function(e){return"manager_assistant"===e.type}));if(t){var n=t.members.find((function(e){return e.displayName===v.a.userContact.displayName}));n&&(e=n.roles[0])}}return e},y.sipWiseManAssistIamManagerForwarded=function(){var e="unknown",t=!1;return y.isSipWise()&&1===y.sipWiseUserGroupsData.managerAssistantNb&&"manager"===y.sipWiseManAssistGetMyRole()&&(e=y.sipWiseUserGroupsData.managerForward),"activated"===e&&(t=!0),t},y.getSipWiseUserGroupsData=function(){return y.sipWiseUserGroupsData},y.getSipWiseUserGroups=function(){return e((function(e,t){if(s.info("[telephonyService] getSipWiseUserGroups"),!y.isSipWise()){return s.error("[telephonyService] sipwise getUserGroups -- not a sipWise situation"),void t()}y.telephonyServiceSipWise.getUserGroups(y).then((function(){return y.telephonyServiceSipWise.getAllUserGroupsForwards(y)})).then((function(){a.$broadcast("ON_TEL_USER_GROUPS_EVENT",y.sipWiseUserGroupsData),e()})).catch((function(e){s.info("[telephonyService] sipwise getSipWiseUserGroups CATCH");var n="sipwise getUserGroups -- "+e.message;s.error("[telephonyService] "+n),t(e)}))}))},y.getSipWiseUserGroupsForwards=function(t){return e((function(e,n){if(s.info("[telephonyService] getSipWiseUserGroupsForwards"),!y.isSipWise()){return s.error("[telephonyService] sipwise getUserGroupsForward -- not a sipWise situation"),void n()}y.telephonyServiceSipWise.getUserGroupsForwards(y,t).then((function(){a.$broadcast("ON_TEL_USER_GROUPS_EVENT",y.sipWiseUserGroupsData),e()})).catch((function(e){s.info("[telephonyService] sipwise getSipWiseUserGroupsForwards CATCH");var t="sipwise getUserGroupsForwards -- "+e.message;s.error("[telephonyService] "+t),n(e)}))}))},y.setSipWiseUserGroupsForwards=function(t,n,r){return e((function(e,i){if(s.info("[telephonyService] setSipWiseUserGroupsForwards"),!y.isSipWise()){return s.error("[telephonyService] sipwise setSipWiseUserGroupsForwards -- not a sipWise situation"),void i()}y.telephonyServiceSipWise.setUserGroupsForwards(y,t,n,r).then((function(){e()})).catch((function(e){s.info("[telephonyService] setSipWiseUserGroupsForwards CATCH");var t="sipwise setSipWiseUserGroupsForwards -- "+e.message;s.error("[telephonyService] "+t),i(e)}))}))},y.sipWiseManAssistActivat=function(e,t){var n=!0,r=0;if(s.info("[telephonyService] sipWiseManAssistActivat  Activ : "+e+" groupName : "+t),0!==y.sipWiseUserGroupsData.managerAssistantNb){if(t||(t=""),y.sipWiseUserGroupsData.sipWiseUserGroupsList.forEach((function(e){n&&"manager_assistant"===e.type&&(t!==e.name&&""!==t||(r=e.id,n=!1))})),!n){var i={destinationType:"managersecretary"};i.activate=e,y.setSipWiseUserGroupsForwards(r,"immediate",i)}}else{s.error("[telephonyService] sipwise sipWiseManAssistActivat -- no Manager Assistant group available")}},y.sipWiseEmergencyCallDataClear=function(){if(!y.isSipWiseRoot()){return s.error("[telephonyService] sipWiseEmergencyCallDataClear -- not a sipWise situation"),null}y.sipWiseEmergencyCallData.WGEmergencyCallForbidden=!1,y.sipWiseEmergencyCallData.emergencyNuList=[],y.sipWiseEmergencyCallData.serverData=null},y.getSipWiseEmergencyCallData=function(){if(!y.isSipWiseRoot()){return s.error("[telephonyService] getSipWiseEmergencyCallData -- not a sipWise situation"),null}return y.sipWiseEmergencyCallData},y.fetchSipWiseEmergencyCallData=function(){return e((function(e,t){if(s.info("[telephonyService] fetchSipWiseEmergencyCallData"),!y.isSipWise()){return s.error("[telephonyService] fetchSipWiseEmergencyCallData -- not a sipWise situation"),void t()}y.telephonyServiceSipWise.getEmergencyCallDataSipWise(y).then((function(){e()})).catch((function(e){s.info("[telephonyService] fetchSipWiseEmergencyCallData CATCH");var n="fetchSipWiseEmergencyCallData -- "+e.message;s.error("[telephonyService] "+n),t(e)}))}))},y.sipWiseMode=function(){var e=o.a.getSetting("sipWiseMode");return C||(e=!1),e},y.resetAllSipWiseCall=function(){if(y.isSipWise()){var e=$iq({type:"set",to:y.userJidTel+"/pcg2"}).c("telephony",{xmlns:"urn:xmpp:pbxagent:telephony:1"}).c("service").c("deleteCalls",{forced:"true"});u.a.sendIQ(e,6e4).then((function(e){s.info("[telephonyService] resetAllSipWiseCall : try to reset all ghost calls !"),console.error(e)})).catch((function(e){var t="resetAllSipWiseCall failure : "+e.message;s.error("[telephonyService]"+t)}))}},y.oxopbxsUpdateIndividualPassword=function(e){var t=config.restServerUrl+"/api/rainbow/oxopbxprovisioning/v1.0/oxopbxs/"+v.a.userContact.systemId+"/subscribers/"+v.a.userContact.dbId+"/password";return new Promise((function(r,i){var a={password:e};n({method:"PUT",url:t,headers:c.a.getRequestHeader(),data:a}).then((function(e){s.info("[telephonyService] oxopbxsUpdateIndividualPassword : success"),r(e)}),(function(e){var t=d.handleError(e);return s.error("[telephonyService] oxopbxsUpdateIndividualPassword : error : "+e.data.errorDetails),i(t)}))}))},y.setPgiCallObject=function(e,t,n,r){y.currentPgiObject={numberCalled:e,dtmfToSend:t,roomJid:n,callId:r}}}])},function(e,t,n){n.r(t);var r=n(0),i=n(49),a=n(6),o=n.n(a),s=n(43),c=n(14),l=n.n(c),u=n(1),d=n.n(u),h=n(58),f=n.n(h);angular.module("rainbow").factory("TelephonyServiceEventHandler",["$log","$q","$rootScope","$interval","$injector",function(e,t,n,a,c){function u(e){this.telephonyService=e,this.promiseQueue=i.PromiseQueue.create()}return u.create=function(e){return new u(e)},u.CallFailureLabels={DESTNOTOBTAINABLE:"outOfService",DONOTDISTURB:"dnd",TRUNKSBUSY:"trunksbusy",BUSY:"busy"},u.prototype.existingCall=function(t){var n=this.telephonyService.calls[t];return e.debug("[TelephonyServiceEventHandler] existingCall -- "+t+" => "+n),n},u.prototype.onCallserviceMessageReceived=function(t){try{var n=$(t),r=this;if("Offline Storage"===n.find("delay").text())return!0;var i=n.find("callservice").children(),a=i.prop("tagName").split(":"),o=a[a.length-1].toLowerCase(),s=i.attr("callId"),c=s?" -- "+s:"",l=i.attr("deviceType"),u=l?" -- "+l:"",d=i.attr("oldCallId");d=d?" -- old "+d:"",i.attr("correlatorData");var h=i.attr("globalCallId");h&&(h=h),l||(l="MAIN");var f=this.telephonyService.getNomadicObject(),p=!f||f.makeCallInitiatorIsMain||!f.modeActivated;if(!["messaging","voicemessages","forwarded","nomadicstatus","opendesktop"].includes(o)&&("MAIN"===l&&!p||"SECONDARY"===l&&p)&&!r.existingCall(s))return e.info("[TelephonyServiceEventHandler] onCallserviceMessageReceived -- "+o.toUpperCase()+c+d+u+" => IGNORED"),!0;switch(e.info("[TelephonyServiceEventHandler] onCallserviceMessageReceived -- "+o.toUpperCase()+c+d+u),o){case"initiated":this.promiseQueue.add((function(){return r.onInitiatedEvent(i)}));break;case"originated":this.promiseQueue.add((function(){return r.onOriginatedEvent(i)}));break;case"delivered":this.promiseQueue.add((function(){return r.onDeliveredEvent(i)}));break;case"established":this.promiseQueue.add((function(){return r.onEstablishedEvent(i)}));break;case"retrievecall":this.promiseQueue.add((function(){return r.onRetrieveCallEvent(i)}));break;case"queued":this.promiseQueue.add((function(){return r.onQueuedEvent(i)}));break;case"holdcall":case"held":this.promiseQueue.add((function(){return r.onHeldEvent(i)}));break;case"diverted":this.promiseQueue.add((function(){return r.onDivertedEvent(i)}));break;case"transfercall":case"transferred":this.promiseQueue.add((function(){return r.onTransferEvent(i)}));break;case"conferenced":this.promiseQueue.add((function(){return r.onConferenceEvent(i)}));break;case"connectioncleared":this.promiseQueue.add((function(){return r.onClearCallEvent(i)}));break;case"failed":this.promiseQueue.add((function(){return r.onFailCallEvent(i)}));break;case"updatecall":this.promiseQueue.add((function(){return r.onUpDateCallEvent(i)}));break;case"forwarded":this.promiseQueue.add((function(){return r.onCallForwardedEvent(i)}));break;case"callsubject":this.promiseQueue.add((function(){return r.onCallSubjectEvent(i)}));break;case"nomadicstatus":this.promiseQueue.add((function(){return r.onCallNomadicEvent(i)}));break;case"opendesktop":e.info("[TelephonyServiceEventHandler] openDesktop detected ")}return!0}catch(m){return e.error("[TelephonyServiceEventHandler] onCallserviceMessageReceived -- failure -- "+m.message),!0}},u.prototype.onInitiatedEvent=function(n){e.info("[TelephonyServiceEventHandler] onInitiatedEvent");var i=this;return this.getCall(n,!1,!0).then((function(a){try{var s=n.attr("deviceState"),l=n.attr("newCallId"),u=n.attr("cause");return void 0!==l?i.getOrCreateCall(l).then((function(t){e.info("[TelephonyServiceEventHandler] onInitiatedEvent : changed call id from "+a.id+" to "+l),i.computeCallRelevancy(n,t),"LCI_CONNECTED"===s?t.setStatus(r.Call.Status.ACTIVE):t.setStatus(a.status),t.setContact(a.contact),t.isOwner=a.isOwner;var o=f.a.getConferenceSessionWithConnId(a.connectionId);o&&(o.callId=l),a.isMediaPillarCall()&&c.get("webrtcGatewayService").replaceCallRefs(t,a),i.telephonyService.clearCall(a),i.sendCallUpdateEvent(a),i.sendCallUpdateEvent(t),delete i.telephonyService.calls[a.id]})):(i.computeCallRelevancy(n,a),o.a.isFeatureEnabled(o.a.FeaturesEnum.TELEPHONY_MAKE_CALL_CTI_APP)&&a.isSecondary&&!a.isOwner&&"MAKECALL"===u||"CALLBACK"===u?(e.info("[TelephonyServiceEventHandler] TELEPHONY_MAKE_CALL_CTI_APP - 3pcc activated"),d.a.getOrCreateContact("","000").then((function(e){a.setContact(e),a.setStatus(r.Call.Status.RINGING_INCOMMING),a.startDate=null,a.vm=!1,a.lastCause=u||"",i.sendCallUpdateEvent(a,n)}))):i.sendCallUpdateEvent(a)),t.when()}catch(p){var h="onInitiatedEvent -- "+p.message;return e.error("[TelephonyServiceEventHandler] "+h),t.reject(new Error(h))}}))},u.prototype.onOriginatedEvent=function(n){e.info("[TelephonyServiceEventHandler] onOriginatedEvent");var r=this;return this.getCall(n,!1,!0).then((function(i){try{var a=n.attr("endpointIm"),o=n.attr("endpointTel"),s=n.attr("newCallId"),l={contactPhoneNumber:"",contact:i.contact,participantsPhoneNumbers:null,participants:null};return a||o?l.contactPhoneNumber=o||"":i.contact&&i.contact.temp&&(l.contactPhoneNumber=i.contact.id),i.setCurrentCalled(l),void 0!==s?r.getOrCreateCall(s,a,o).then((function(t){e.info("[TelephonyServiceEventHandler] onOriginatedEvent : changed call id from "+i.id+" to "+s),r.computeCallRelevancy(n,t),t.setStatus(i.status),t.setContact(i.contact),t.setCurrentCalled(l),t.isOwner=i.isOwner;var a=f.a.getConferenceSessionWithConnId(i.connectionId);a&&(a.callId=s),i.isMediaPillarCall()&&c.get("webrtcGatewayService").replaceCallRefs(t,i),r.telephonyService.clearCall(i),r.sendCallUpdateEvent(i),r.sendCallUpdateEvent(t),delete r.telephonyService.calls[i.id]})):r.sendCallUpdateEvent(i),t.when()}catch(d){var u="onOriginatedEvent -- "+d.message;return e.error("[TelephonyServiceEventHandler] "+u),t.reject(new Error(u))}}))},u.prototype.onDeliveredEvent=function(n){e.info("[TelephonyServiceEventHandler] onDeliveredEvent");var i=this;return this.getCall(n).then((function(a){try{if(i.computeCallRelevancy(n,a),a.status===r.Call.Status.QUEUED_INCOMMING)return t.resolve();var o=n.attr("type"),s=n.attr("endpointIm"),c=n.attr("endpointTel"),l=n.attr("cause"),u=n.attr("correlatorData")?n.attr("correlatorData"):"",d=n.attr("globalCallId")?n.attr("globalCallId"):"";return a.setStatus("outgoing"===o?r.Call.Status.RINGING_OUTGOING:r.Call.Status.RINGING_INCOMMING),a.startDate=null,a.vm=!1,a.lastCause=l||"",a.correlatorData=u,a.globalCallId=d,i.updateCallContact(s,c,n,a)}catch(f){var h="onDeliveredEvent -- "+f.message;return e.error("[TelephonyServiceEventHandler] "+h),t.reject(new Error(h))}}))},u.prototype.onEstablishedEvent=function(n){e.info("[TelephonyServiceEventHandler] onEstablishedEvent");var i=this;return this.getCall(n).then((function(a){try{i.computeCallRelevancy(n,a);var o=n.attr("endpointIm"),s=n.attr("endpointTel"),c=n.attr("callId");if(a.contact&&a.contact.id)return a.setStatus(r.Call.Status.ACTIVE),a.setConnectionId(c),i.sendCallUpdateEvent(a,n),i.updateCallContact(o,s,n,a);if(!(a.participants&&a.participants.length>0))return e.info("[TelephonyServiceEventHandler] onEstablishedEvent, no call contact / no participants"),o||s||(s="****"),d.a.getOrCreateContact(o,s).then((function(e){return a.setContact(e),a.setStatus(r.Call.Status.ACTIVE),h={contactPhoneNumber:s,contact:e},a.setCurrentCalled(h),i.sendCallUpdateEvent(a,n),t.when()}));for(var l=null,u=0;u<a.participants.length&&!l;u++)(a.participants[u].id===o||a.currentCalled.participantsPhoneNumbers&&a.currentCalled.participantsPhoneNumbers.length>0&&a.currentCalled.participantsPhoneNumbers[u]===s)&&(l=a.participants[u]);a.participants=[],a.isConference=!1;var h=a.getCurrentCalled();return l?(a.setContact(l),a.setStatus(r.Call.Status.ACTIVE),h={contactPhoneNumber:s,contact:l},a.setCurrentCalled(h),i.sendCallUpdateEvent(a,n),t.when()):(o||s||(s="****"),d.a.getOrCreateContact(o,s).then((function(e){return a.setContact(e),a.setStatus(r.Call.Status.ACTIVE),h={contactPhoneNumber:s,contact:e},a.setCurrentCalled(h),i.sendCallUpdateEvent(a,n),t.when()})))}catch(p){var f="onEstablishedEvent -- "+p.message;return e.error("[TelephonyServiceEventHandler] "+f),t.reject(new Error(f))}}))},u.prototype.onRetrieveCallEvent=function(t){e.info("[TelephonyServiceEventHandler] onRetrieveCallEvent");var n=this;return this.getCall(t,!0).then((function(e){e.setStatus(r.Call.Status.ACTIVE),n.sendCallUpdateEvent(e,t)}))},u.prototype.onClearCallEvent=function(n){var i=this,a=n.attr("callId"),o=r.Call.getIdFromConnectionId(a);return e.info("[TelephonyServiceEventHandler] onClearCallEvent, connectionId: "+a),this.telephonyService.calls[o]?this.getCall(n).then((function(e){i.computeCallRelevancy(n,e),i.telephonyService.clearCall(e,!0),i.sendCallUpdateEvent(e,n)})):(e.info("[TelephonyServiceEventHandler] onClearCallEvent, no call for connectionId: "+a),t.resolve())},u.prototype.onHeldEvent=function(n){e.info("[TelephonyServiceEventHandler] onHeldEvent");var i=this;return this.getCall(n,!0).then((function(a){try{var o=n.attr("callId");return r.Call.getDeviceIdFromConnectionId(a.connectionId)===r.Call.getDeviceIdFromConnectionId(o)?a.setStatus(r.Call.Status.HOLD):a.setStatus(r.Call.Status.PUT_ON_HOLD),i.sendCallUpdateEvent(a,n),t.when()}catch(c){var s="onHeldEvent -- "+c.message;return e.error("[TelephonyServiceEventHandler] "+s),t.reject(new Error(s))}}))},u.prototype.onQueuedEvent=function(n){e.info("[TelephonyServiceEventHandler] onQueuedEvent");var i=this,a=n.attr("cause");return"PARK"===a?(e.warn("[TelephonyServiceEventHandler] onQueuedEvent - ignore PARK cause"),t.when()):"NEWCALL"===a?(e.warn("[TelephonyServiceEventHandler] onQueuedEvent - ignore NEWCALL cause"),t.when()):"CAMPON"!==a&&this.telephonyService.isOxe?(e.warn("[TelephonyServiceEventHandler] onQueuedEvent - ignore cause not CAMPON  (for oxe attendant res monoLine)"),t.when()):this.getCall(n).then((function(a){try{i.computeCallRelevancy(n,a);var o=n.attr("type"),s=n.attr("endpointIm"),c=n.attr("endpointTel"),l="outgoing"===o?r.Call.Status.QUEUED_OUTGOING:r.Call.Status.QUEUED_INCOMMING;return a.setStatus(l),a.startDate=null,a.vm=!1,a.relevantEquipmentId=r.Call.getDeviceIdFromConnectionId(a.connectionId),i.updateCallContact(s,c,n,a)}catch(d){var u="onQueuedEvent -- "+d.message;return e.error("[TelephonyServiceEventHandler] "+u),t.reject(new Error(u))}}))},u.prototype.onDivertedEvent=function(n){e.info("[TelephonyServiceEventHandler] onDivertedEvent");var i=n.attr("oldCallId"),a=r.Call.getIdFromConnectionId(i),o=this.telephonyService.calls[a];return o?(this.computeCallRelevancy(n,o),c.get("webrtcGatewayService").isMediaPillarCallCase()?o.isSecondary?this.telephonyService.clearCall(o):this.telephonyService.clearCall(o,!0):this.telephonyService.clearCall(o),this.sendCallUpdateEvent(o,n),t.when()):(e.warn("[TelephonyServiceEventHandler] onDivertedEvent - receive divertedEvent on unknown call --- ignored"),t.when())},u.prototype.onTransferEvent=function(n){e.info("[TelephonyServiceEventHandler] onTransferEvent");var i=this,a=n.attr("activeCallId"),o=n.attr("heldCallId"),s=n.attr("newCallId"),c=r.Call.getIdFromConnectionId(a),l=this.telephonyService.calls[c];if(o){var u=r.Call.getIdFromConnectionId(o),d=this.telephonyService.calls[u];d&&d.setStatus(r.Call.Status.UNKNOWN),l&&l.setStatus(r.Call.Status.UNKNOWN),d&&i.sendCallUpdateEvent(d),l&&i.sendCallUpdateEvent(l)}if(s){var h=n.attr("newEndpointIm"),f=n.attr("newEndpointTel"),p=n.attr("deviceState");p||(p=n.attr("deviceStatus"));var m=n.attr("deviceType");return m||(m="MAIN"),l&&(l.setStatus(r.Call.Status.UNKNOWN),i.sendCallUpdateEvent(l)),h||f||(f="****"),this.getOrCreateCall(s,h,f).then((function(e){return p&&"LCI_ALERTING"===p?e.setStatus(r.Call.Status.RINGING_INCOMMING):e.setStatus(r.Call.Status.ACTIVE),e.relevantEquipmentId=r.Call.getDeviceIdFromConnectionId(s),e.isSecondary=m&&"SECONDARY"===m,i.updateCallContact(h,f,n,e)}))}return t.resolve()},u.prototype.onConferenceEvent=function(n){e.info("[TelephonyServiceEventHandler] onConferenceEvent");var i=this,a=n.find("primaryOldCallId").text(),o=n.find("secondaryOldCallId").text(),s=n.find("newCallId").text(),c=r.Call.getIdFromConnectionId(a),l=r.Call.getIdFromConnectionId(o),u=this.telephonyService.calls[c],h=this.telephonyService.calls[l],f=[],p=[],m=[];return n.find("participant").each((function(){var n=angular.element(this),r=n.find("endpointTel").text(),a=n.find("endpointIm").text();a&&d.a.isUserContactJid(a)||p.push(t((function(t,n){a||r||(r="****"),!a&&u&&u.contact&&u.currentCalled.contactPhoneNumber===r?(f.push(u.contact),m.push(r),t()):!a&&h&&h.contact&&h.currentCalled.contactPhoneNumber===r?(f.push(h.contact),m.push(r),t()):d.a.getOrCreateContact(a,r).then((function(n){f.push(n),m.push(r),i.telephonyService.updateContactFromOutlookInfos(n,r).then((function(t){t?e.debug("[TelephonyServiceEventHandler] on conferenced, update from outlook for contact :"+n.nameForLog):e.debug("[TelephonyServiceEventHandler] on conferenced, no update from outlook for contact :"+n.nameForLog)}),(function(){e.debug("[TelephonyServiceEventHandler] on conferenced, no Outlook search available")})).finally((function(){t()}))})).catch((function(n){e.error("[TelephonyServiceEventHandler] onConferenceEvent - Impossible to get contact - "+n.message),t()}))})))})),t.all(p).finally((function(){var t=!1;u&&(t=t||u.isSecondary),h&&(t=t||h.isSecondary);var n=i.createConferenceCall(s,f),a=n.getCurrentCalled();a.participants=f,a.participantsPhoneNumbers=m,n.setCurrentCalled(a),n.setStatus(r.Call.Status.ACTIVE),n.relevantEquipmentId=r.Call.getDeviceIdFromConnectionId(s),n.isSecondary=t,e.debug("[TelephonyServiceEventHandler] on conferenced, create new call: "+n),i.sendCallUpdateEvent(n),u&&(u.setStatus(r.Call.Status.UNKNOWN),e.debug("[TelephonyServiceEventHandler] on conferenced, updated primaryOldCall: "+u),i.sendCallUpdateEvent(u)),h&&(h.setStatus(r.Call.Status.UNKNOWN),e.debug("[TelephonyServiceEventHandler] on conferenced, updated secondaryOldCall: "+h),i.sendCallUpdateEvent(h))}))},u.prototype.onUpDateCallEvent=function(n){e.info("[TelephonyServiceEventHandler] onUpDateCallEvent");var r=this;return this.getCall(n).then((function(i){var c=n.attr("endpointIm"),u=n.attr("endpointTel"),h="",f="",p=n.find("identity").attr("firstName"),m=n.find("identity").attr("lastName"),v=n.find("identity").attr("displayName"),g=!1;if(!config.permitSearchFromPhoneBook&&!o.a.isFeatureEnabled(o.a.FeaturesEnum.TELEPHONY_PHONE_BOOK))return e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent xnames not allowed for the user profile => IGNORED event"),t.when();if(m&&m.length)f=m,p&&p.length&&(h=p),e.info("[TelephonyServiceEventHandler] onUpDateCallEvent received for call "+i.id+" for phoneNumber:"+l()(u)+" with name : "+h.slice(0,1)+"***");else{if(!v||!v.length||v===u)return e.info("[TelephonyServiceEventHandler] onUpDateCallEvent xnames not available => IGNORED event"),t.when();f=v,e.info("[TelephonyServiceEventHandler] onUpDateCallEvent only displayName available")}return d.a.getOrCreateContact(c,u).then((function(t){if(t.temp){if(t.updateName(h,f),i.contact&&i.contact.id){var o={contactPhoneNumber:u,contact:t};i.contact.id===t.id&&i.contact.displayName!==u&&i.contact.nameUpdatePrio!==s.Contact.NameUpdatePrio.OUTLOOK_UPDATE_PRIO||(t.nameUpdatePrio=s.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO,i.setContact(t),i.setCurrentCalled(o),g=!0,e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent xnames updated for "+u+" with contact : "+t.nameForLog))}else if(i.participants&&i.participants.length>0){o=i.getCurrentCalled();for(var l=0;l<i.participants.length;l++)i.participants[l].temp?i.participants[l].phoneProCan&&i.participants[l].phoneProCan===u&&(e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent temp participant "+i.participants[l].nameForLog+" updated with : "+t.nameForLog),i.participants[l]=t,i.participants[l].nameUpdatePrio=s.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO,o.participantsPhoneNumbers[l]=u,o.participants[l]=t,g=!0):e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent STRANGE former participant was a rainbow: "+i.participants[l].nameForLog);i.setCurrentCalled(o)}}else if(i.contact&&i.contact.id)o={contactPhoneNumber:u,contact:t},i.contact.id!==t.id&&(i.contact.temp&&(i.contact.updateName(h,f),i.contact.nameUpdatePrio=s.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO),i.setContact(t),i.setCurrentCalled(o),g=!0,e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent call update with rainbow contact : "+t.nameForLog));else if(i.participants&&i.participants.length>0){for(o=i.getCurrentCalled(),l=0;l<i.participants.length;l++)i.participants[l].temp?i.participants[l].phoneProCan&&i.participants[l].phoneProCan===u&&(e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent temp participant "+i.participants[l].nameForLog+" updated with : "+t.nameForLog),i.participants[l]=t,i.setParticipants(i.participants),o.participantsPhoneNumbers[l]=u,o.participants[l]=t,g=!0):i.participants[l].jid===c?(o.participantsPhoneNumbers[l]=u,o.participants[l]=i.participants[l],g=!0,e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent rainbow participant "+i.participants[l].nameForLog+" updated with the same : "+t.nameForLog)):e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent other participant not updated : "+i.participants[l].nameForLog+" vs "+t.nameForLog);i.setCurrentCalled(o)}g?a((function(){r.sendCallUpdateEvent(i,n)}),300,1):e.debug("[TelephonyServiceEventHandler] onUpDateCallEvent, no update needed for call : "+i.id)}))}))},u.prototype.onFailCallEvent=function(t){e.info("[TelephonyServiceEventHandler] onFailCallEvent");var n=t.attr("cause"),i=this;return this.getCall(t).then((function(e){e.setStatus(r.Call.Status.ERROR),e.errorMessage=u.CallFailureLabels[n],e.errorMessage||(e.errorMessage=n),i.sendCallUpdateEvent(e,t)}))},u.prototype.onCallNomadicEvent=function(n){if(e.info("[TelephonyServiceEventHandler] onCallNomadicEvent"),!this.telephonyService.started&&!this.telephonyService.starting)return e.info("[TelephonyServiceEventHandler] onCallNomadicEvent on uninitialized telephony => relaunch telephony initialization"),this.telephonyService.launchTelephonyInitilization(),t.when();var r={destination:n.attr("destination"),featureActivated:n.attr("featureActivated"),makeCallInitiatorIsMain:n.attr("makeCallInitiatorIsMain"),modeActivated:n.attr("modeActivated"),nomadicModeInitialized:n.attr("nomadicModeInitialized")};if(this.telephonyService.updateNomadicData(r)){var i=this.telephonyService.nomadicObject.featureActivated&&this.telephonyService.nomadicObject.modeActivated&&!this.telephonyService.nomadicObject.makeCallInitiatorIsMain;this.telephonyService.getTelephonyState(i)}return t.when()},u.prototype.onCallForwardedEvent=function(r){var i=r.attr("forwardType"),a=r.attr("forwardTo");return e.info("[TelephonyServiceEventHandler] onCallForwardedEvent forwardType: "+i+" forwardTo: "+a),n.$broadcast("ON_CALL_FORWARDED_EVENT",{forwardType:i,forwardTo:a}),this.telephonyService.forwardObject.forwardType=i,this.telephonyService.forwardObject.forwardTo=a,t.when()},u.prototype.onCallSubjectEvent=function(n){e.info("[TelephonyServiceEventHandler] onCallSubjectEvent");var r=this;return this.getCall(n).then((function(i){try{i.subject=n.find("subject").text(),i.subject&&(e.info("[TelephonyServiceEventHandler] subject display"+i.subject),r.sendCallUpdateEvent(i))}catch(o){var a="onCallSubjectEvent -- "+o.message;e.error("[TelephonyServiceEventHandler] "+a),t.reject(new Error(a))}}))},u.prototype.computeCallRelevancy=function(t,n){var i=t.attr("newCallId")||t.attr("callId"),a=t.attr("deviceType"),o=r.Call.getDeviceIdFromConnectionId(i),s=this.telephonyService.getNomadicObject(),c=s.makeCallInitiatorIsMain;a||(a="MAIN"),s.modeActivated||(c=!0),"MAIN"===a&&c&&(n.relevantEquipmentId=o,n.connectionId=i),"SECONDARY"!==a||c||(n.relevantEquipmentId=o,n.connectionId=i),n.isSecondary=a&&"SECONDARY"===a&&!c,e.info("[TelephonyServiceEventHandler] computeCallRelevancy -- relevantEquipmentId: "+n.relevantEquipmentId+" connectionId: "+n.connectionId+" isSecondary: "+n.isSecondary)},u.prototype.getCall=function(e,n,r){var i=this;return t((function(t){var a=e.attr("endpointIm"),o=e.attr("endpointTel"),s=e.attr("callId");i.getOrCreateCall(s,a,o,n,r).then((function(e){t(e)}))}))},u.prototype.getOrCreateCall=function(n,i,a,o,s){var c=this;if(o){var u=n;n=Object.keys(this.telephonyService.calls||[]).find((function(e){return r.Call.getCallIdFromConnectionId(e)===r.Call.getCallIdFromConnectionId(n)})),e.debug("[TelephonyServiceEventHandler] getOrCreateCall - HOLD/RETRIEVE search call with callId: "+r.Call.getCallIdFromConnectionId(u)+" from connection id: "+u+" => found connectionId: "+n)}if(!n)return t.reject("no connection id");if(s){var h=this.telephonyService.pendingMakeCalls.pop();if(h)return h.setStatus(r.Call.Status.DIALING),h.setConnectionId(n),h.setRelevantEquipmentId(r.Call.getDeviceIdFromConnectionId(h.connectionId)),e.info("[TelephonyServiceEventHandler] getOrCreateCall - "+n+" - "+i+" => found pendingMakeCall: Call confirmed by csta event "+h),this.telephonyService.calls[h.id]=h,t.when(h)}var f=this.telephonyService.calls[n];return f?(e.info("[TelephonyServiceEventHandler] getOrCreateCall - "+n+" - "+l()(a)+" - "+i+" => found call: "+f),t.when(f)):(e.info("[TelephonyServiceEventHandler] getOrCreateCall - "+n+" - "+l()(a)+" - "+i+" => not found : create call..."),t((function(e){i||a?d.a.getOrCreateContact(i,a).then((function(t){e(c.telephonyService.getOrCreateCall(r.Call.Status.UNKNOWN,n,t))})):e(c.telephonyService.getOrCreateCall(r.Call.Status.UNKNOWN,n))})))},u.prototype.createConferenceCall=function(e,t){var n=r.Call.create(r.Call.Status.UNKNOWN,null,r.Call.Type.PHONE);return n.setConnectionId(e),n.isConference=!0,n.setParticipants(t),this.telephonyService.calls[n.id]=n,n},u.prototype.sendCallUpdateEvent=function(e,t){var r=this.extractInfoEvent(t);n.$broadcast("ON_CALL_UPDATED_EVENT",e,r)},u.prototype.extractInfoEvent=function(e){var t={actionElemName:"",cause:""};if(e&&null!==e){var n=e.prop("tagName").split(":");t.actionElemName=n[n.length-1].toLowerCase(),t.cause=e.attr("cause"),t.cause=t.cause?t.cause:""}else t=null;return t},u.prototype.analyzeContactChange=function(e,t,n){var r=!1,i=!1;return e||t?n.isConference?void 0:n.contact?(""!==e?n.contact.id!==e&&(r=!0,i=!1):n.contact.temp?n.contact.id!==t?(r=!0,i=!0):n.contact.displayName===t&&(r=!1,i=!0):""!==n.getCurrentCalled().contactPhoneNumber&&""!==t&&n.getCurrentCalled().contactPhoneNumber!==t&&(r=!0,i=!0),r||i?{updateContactToBeDone:r,searchOutlookToBeDone:i}:null):{updateContactToBeDone:!0,searchOutlookToBeDone:!0}:null},u.prototype.updateCallContact=function(n,r,i,a){var o=this,s=i.prop("tagName").split(":"),c=s[s.length-1].toLowerCase();try{var l=o.analyzeContactChange(n,r,a);return a.isConference||""===r||a.setCurrentCalledContactNumber(r),l?d.a.getOrCreateContact(n,r).then((function(n){return l.searchOutlookToBeDone?o.telephonyService.updateContactFromOutlookInfos(n,r).then((function(t){t?(e.debug("[TelephonyServiceEventHandler] on "+c+", update from outlook for contact :"+n.nameForLog),o.makeUpdateContact(a,n,r,c)):(e.debug("[TelephonyServiceEventHandler] on "+c+", no update from outlook for contact :"+n.nameForLog),l.updateContactToBeDone?(e.debug("[TelephonyServiceEventHandler] on "+c+", update contact :"+n.nameForLog),o.makeUpdateContact(a,n,r,c)):o.sendCallUpdateEvent(a,i))}),(function(){e.debug("[TelephonyServiceEventHandler] on "+c+", no Outlook search available"),l.updateContactToBeDone?(e.debug("[TelephonyServiceEventHandler] on "+c+", update contact :"+n.nameForLog),o.makeUpdateContact(a,n,r,c)):o.sendCallUpdateEvent(a,i)})):(e.debug("[TelephonyServiceEventHandler] on "+c+", update contact :"+n.nameForLog),o.makeUpdateContact(a,n,r,c),t.when())})).catch((function(n){if(n){var r="updateCallContact -- "+n.message;e.error("[TelephonyServiceEventHandler] "+r)}return e.debug("[TelephonyServiceEventHandler] on "+c+", no Outlook search available"),o.sendCallUpdateEvent(a,i),t.when()})):(o.sendCallUpdateEvent(a,i),t.when())}catch(h){var u="updateCallContact -- "+h.message;return e.error("[TelephonyServiceEventHandler] "+u),t.reject(new Error(u))}},u.prototype.makeUpdateContact=function(e,t,n,i){var o=this;e.setContact(t);var s={contactPhoneNumber:n,contact:t};e.setCurrentCalled(s),"delivered"===i&&e.status===r.Call.Status.RINGING_INCOMMING?a((function(){o.sendCallUpdateEvent(e)}),300,1):o.sendCallUpdateEvent(e)},u}])},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(2),o=n(6),c=n(14),l=function(){function e(t,n,r,s,c,l,u){S(this,e),this.$rootScope=t,this.$log=n,this.$http=r,this.$injector=s,this.orderByFilter=c,this.conversationService=l,this.errorHelperService=u,this.centralizedService=null,this.companyContactsNumber=0,this.otherCompanyContactsNumber=0,this.authService=a.default,this.profileService=o.default,this.contactService=i.default}return C(e,[{key:"start",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.$log.info("[DirectoryService] === STARTING ==="),n=performance.now();try{this.centralizedService=this.$injector.get("centralizedService")}catch(i){}r=Math.round(performance.now()-n),e.push({service:"directoryService",startDuration:r}),this.$log.info("[DirectoryService] === STARTED ("+r+" ms) ===");case 5:case"end":return t.stop()}}),t,this)})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$log.info("[DirectoryService] Stopping"),this.$log.info("[DirectoryService] Stopped");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return r(this,void 0,void 0,b.a.mark((function r(){var o,s,l,u,d,h,f=this;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.$log.info("[DirectoryService] searchContact with text "+c.default(e)),o=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.SEARCH_BY_TAGS)?"search=":"displayName=",s=config.restServerUrl+"/api/rainbow/search/v1.0/users?limit="+n+"&"+o+encodeURIComponent(e),i&&(s+="&companyId="+encodeURIComponent(i)),a&&(s+="&excludeCompanyId="+encodeURIComponent(a)),r.prev=3,r.next=6,this.$http({method:"GET",url:s,headers:this.authService.getRequestHeader()});case 6:return l=r.sent.data.data,this.$log.info("[DirectoryService] search find "+l.length+" contact(s)"),a?this.otherCompanyContactsNumber=l.length:this.companyContactsNumber=l.length,u=[],l.forEach((function(e){if(f.contactService.isUserContactJid(e.jid_im))f.$log.info("[DirectoryService] search contact "+e.jid_im+" ignored");else{var t=f.contactService.getContact(e.jid_im);t||((t=f.contactService.createBasicContact(e.jid_im)).updateFromUserData(e),t.getAvatar(),f.contactService.dbContacts[e.id]=t,f.contactService.jtelContacts[t.jidtel]=t),t.tags=e.tags,t.dbId=e.id,f.contactService.updateContactRichStatus(t),f.conversationService.computeCapabilitiesForContact(t,!1),u.push(t)}})),t&&(d=this.contactService.searchContacts(e),u=u.concat(d.filter((function(e){return e.roster&&u.indexOf(e)<0})))),r.abrupt("return",u=this.orderByFilter(u,"_displayName",!1));case 13:throw r.prev=13,r.t0=r.catch(3),h=r.t0,r.t0&&r.t0.data&&(h=this.errorHelperService.handleError(r.t0),this.$log.error("[DirectoryService] search - "+h.message),401===r.t0.data.errorCode&&this.$rootScope.$broadcast("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),h;case 17:case"end":return r.stop()}}),r,this,[[3,13]])})))}},{key:"getCompanyContactsNumber",value:function(){return this.companyContactsNumber}},{key:"getOtherCompanyContactsNumber",value:function(){return this.otherCompanyContactsNumber}},{key:"searchUserByLogin",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.$log.info('[DirectoryService] searchUserByLogin with "'+e+'"'),n=config.webservices.protocol+"://"+config.webservices.currentServer+":"+config.webservices.port+"/api/rainbow/enduser/v1.0/",t.prev=2,t.next=5,this.$http({method:"POST",url:n+"users/loginEmails",headers:this.authService.getPostHeader(),data:{loginEmail:[e]}});case 5:if(1!==(r=t.sent.data.data).length){t.next=11;break}return t.next=9,this.contactService.getOrCreateContact(r[0].jid_im);case 9:return i=t.sent,t.abrupt("return",(i.loginEmail=e,i));case 11:t.next=17;break;case 13:throw t.prev=13,t.t0=t.catch(2),a=t.t0,t.t0&&t.t0.data&&(a=this.errorHelperService.handleError(t.t0),this.$log.error("[DirectoryService] searchUserByLogin - "+a.message),401===t.t0.data.errorCode&&this.$rootScope.$broadcast("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),a;case 17:case"end":return t.stop()}}),t,this,[[2,13]])})))}},{key:"searchUserByJid",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.$log.info('[DirectoryService] searchUserByJid with "'+e+'"'),n=config.webservices.protocol+"://"+config.webservices.currentServer+":"+config.webservices.port+"/api/rainbow/enduser/v1.0/users/jids/",t.prev=2,t.next=5,this.$http({method:"GET",url:n+encodeURIComponent(e),headers:this.authService.getRequestHeader()});case 5:if(!(r=t.sent.data)){t.next=11;break}return t.next=9,this.contactService.getOrCreateContact(e);case 9:return i=t.sent,t.abrupt("return",(i.updateFromUserData(r.data),i));case 11:t.next=17;break;case 13:throw t.prev=13,t.t0=t.catch(2),a=t.t0,t.t0&&t.t0.data&&(a=this.errorHelperService.handleError(t.t0),this.$log.error("[DirectoryService] searchUserByJid - "+a.message),401===t.t0.data.errorCode&&this.$rootScope.$broadcast("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),a;case 17:case"end":return t.stop()}}),t,this,[[2,13]])})))}},{key:"searchUserByPhoneNumber",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.$log.info('[DirectoryService] searchUserByPhoneNumber with "'+e+'"'),n=config.webservices.protocol+"://"+config.webservices.currentServer+":"+config.webservices.port+"/api/rainbow/search/v1.0/phone-numbers/"+e+"/users",t.prev=2,t.next=5,this.$http({method:"GET",url:n,headers:this.authService.getRequestHeader()});case 5:if(!(r=t.sent.data.data)){t.next=10;break}return t.next=9,this.contactService.getOrCreateContact(r.jid_im);case 9:return t.abrupt("return",t.sent);case 10:t.next=16;break;case 12:return t.prev=12,t.t0=t.catch(2),i=t.t0,t.abrupt("return",(t.t0&&t.t0.data&&(i=this.errorHelperService.handleError(t.t0),this.$log.error("[DirectoryService] searchUserByPhoneNumber - "+i.message),401===t.t0.data.errorCode&&this.$rootScope.$broadcast("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),null));case 16:case"end":return t.stop()}}),t,this,[[2,12]])})))}},{key:"searchAllContacts",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return r(this,void 0,void 0,b.a.mark((function r(){var c,l,u,d,h,f,p;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.$log.info("[DirectoryService] searchAllContacts with text "+e),r.prev=1,c=[],i&&(c=this.contactService.searchContacts(e)),r.next=6,this.search(e,!1,t,n,o);case 6:if(l=r.sent,c=c.concat(l.filter((function(e){return!e.roster||c.indexOf(e)<0}))),this.$log.info("[DirectoryService] searchAllContacts with text "+e+" found contacts "+c.length),!a||!this.centralizedService){r.next=16;break}return r.next=10,Promise.all([this.searchOutlookUsersByEmail(e),this.searchOutlookUsersByName(e)]);case 10:u=r.sent,d=Object(s.a)(u,2),h=d[0],f=d[1],p=this.centralizedService.outlook.mergeOutlookContact(h,f),p=this.adaptOutlookContacts(p),c=c.concat(p),this.$log.info("[DirectoryService] searchAllContacts with text "+e+" with outlook contacts "+c.length);case 16:return r.abrupt("return",c);case 19:throw r.prev=19,r.t0=r.catch(1),this.$log.error("[DirectoryService] searchAllContacts - Unable to search all contacts"),r.t0;case 22:case"end":return r.stop()}}),r,this,[[1,19]])})))}},{key:"adaptOutlookContacts",value:function(e){return e&&e.length&&e.forEach((function(e){e.photo&&e.photo.src?e.avatar=e.photo:e.photo&&(e.avatar=new Image,e.avatar.src=e.photo),e.businessPhones=[],e.businessPhone&&e.businessPhones.push(e.businessPhone),e.mobilePhone&&(e.mobilePhones=[],e.mobilePhones.push(e.mobilePhone)),e.homePhone&&(e.otherPhoneNumbers=e.homePhone),e.emailAddress&&(e.email=e.emailAddress),e.outlookFlag=!0})),e}},{key:"searchOutlookUsersByName",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.centralizedService){t.next=10;break}return t.prev=1,t.next=4,this.centralizedService.outlook.searchByNameWithAvatar(e,2);case 4:return t.abrupt("return",t.sent);case 7:return t.prev=7,t.t0=t.catch(1),t.abrupt("return",(this.$log.warn("[DirectoryService] searchOutlookUsersByName - Outlook service unavailable"),[]));case 10:case"end":return t.stop()}}),t,this,[[1,7]])})))}},{key:"searchOutlookUsersByEmail",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.centralizedService||!this.centralizedService.outlook){t.next=10;break}return t.prev=1,t.next=4,this.centralizedService.outlook.searchByEmailWithAvatar(e,2);case 4:return t.abrupt("return",t.sent);case 7:return t.prev=7,t.t0=t.catch(1),t.abrupt("return",(this.$log.warn("[DirectoryService] searchOutlookUsersByEmail - Outlook service unavailable"),[]));case 10:case"end":return t.stop()}}),t,this,[[1,7]])})))}}]),e}();l.$inject=["$rootScope","$log","$http","$injector","orderByFilter","conversationService","errorHelperService"],t.DirectoryService=l,angular.module("rainbow").service("directoryService",l)},function(e,t,n){n.r(t);var r=n(44),i=n(2),a=n.n(i),o=n(4),s=n.n(o),c=n(1),l=n.n(c);angular.module("rainbow").service("groupService",["$q","$rootScope","$log","$http","usersService",function(e,t,n,i,o){var c=this;this.started=!1,c.ON_REMOVE_GROUP_USER_EVENT="ON_REMOVE_GROUP_USER_EVENT",c.ON_ADD_GROUP_USER_EVENT="ON_ADD_GROUP_USER_EVENT",c.ON_GROUP_USERS_UPDATE_EVENT="ON_GROUP_USERS_UPDATE_EVENT",c.ON_CREATED_GROUP_EVENT="ON_CREATED_GROUP_EVENT",c.ON_UPDATE_GROUP_EVENT="ON_UPDATE_GROUP_EVENT",c.ON_REMOVED_GROUP_EVENT="ON_REMOVED_GROUP_EVENT",this.start=function(){n.info(""),n.info("[groupService] === STARTING ==="),c.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+a.a.userId+"/";var t=e.defer();return c.$q=e,c.groups=null,l.a.userContact.isCPaaSGuest()?t.resolve():(this.attachHandlers(),this.getGroups(),c.started=!0,n.info("[groupService] === STARTED ==="),t.resolve(),t.promise)},this.stop=function(){return n.info("[groupService] === STOPPING ==="),c.conversations=null,c.groups=null,this.groupMessageHandlerRef&&(s.a.deleteHandler(this.groupMessageHandlerRef),this.groupMessageHandlerRef=null),this.started=!1,n.info("[groupService] === STOPPED ==="),e.when()},this.getGroups=function(){return c.groups?e.when(c.groups):c.getRemoteGroups()},this.getGroupById=function(e){return c.group[e]},c.getGroupsAsArray=function(){var e=[];for(var t in c.groups)c.groups.hasOwnProperty(t)&&e.push(c.groups[t]);return e},this.getRemoteGroups=function(){n.info("[groupService] getGroups");var t=e.defer();return i({method:"GET",url:c.portalURL+"groups?format=full",headers:a.a.getRequestHeader()}).then((function(t){var i=t.data.data;n.info("[groupService] getGroups success (find "+t.data.total+" group(s))"),c.groups=[];var a=[];return i.forEach((function(e){var t=r.Group.createFromData(e);c.groups.push(t),angular.forEach(e.users,(function(e){a=l.a.getContactByDBId(e).then((function(e){e&&t.users.push(e)}))})),c.logGroupUsers(t),c.sortUsersInGroup(t)})),e.all(a)}),(function(e){var r="getGroups"+c.handleErrorMessage(e);t.reject(new Error(r)),n.error("[groupService] "+r)})).then((function(){t.resolve(c.groups)})),t.promise};var u=function(n,r){return e((function(e){c.groups.some((function(i){return i.id===n&&(i.users.some((function(e){return r===e.dbId}))?(e(i),t.$broadcast(c.ON_ADD_GROUP_USER_EVENT,n,r),!0):(l.a.getContactByDBId(r).then((function(a){i.users.push(a),c.sortUsersInGroup(i);var o=[i];a.getGroups()?a.getGroups().push(i):a.setGroups(o),t.$broadcast(c.ON_ADD_GROUP_USER_EVENT,n,r),e(i)})),!0))}))||(t.$broadcast(c.ON_ADD_GROUP_USER_EVENT,n,r),e())}))};this.getGroup=function(t){n.info("[groupService] getGroup  for "+t);var o=e.defer(),s=null;return i({method:"GET",url:c.portalURL+"groups/"+t,headers:a.a.getRequestHeader()}).then((function(t){var i=t.data.data,a=[];return s=r.Group.createFromData(i),n.info("[groupService] getGroup success for "+s.name+" : "+s.id),c.groups.some((function(e,t){return e.id===i.id&&(c.groups[t]=s,angular.forEach(i.users,(function(e){a=l.a.getContactByDBId(e.id).then((function(e){e&&(c.groups[t].users.push(e),c.sortUsersInGroup(c.groups[t]))}))})),!0)}))||(c.groups.push(s),angular.forEach(i.users,(function(e){a=l.a.getContactByDBId(e.id).then((function(e){if(e){s.users.push(e),c.sortUsersInGroup(s);var t=[s];e.getGroups()?e.getGroups().push(s):e.setGroups(t)}}))}))),e.all(a)}),(function(e){var t="getGroup"+c.handleErrorMessage(e);o.reject(new Error(t)),n.error("[groupService] "+t)})).then((function(){o.resolve(s)})),o.promise},this.addGroup=function(t){n.info("[groupService] addGroup : "+t.name);var o=e.defer();return i({method:"POST",url:c.portalURL+"groups",headers:a.a.getPostHeader(),data:{name:t.name,comment:t.comment,isFavorite:t.isFavorite}}).then((function(e){n.info("[groupService] addGroup success for : "+t.name);var i=e.data.data,a=r.Group.createFromData(i);o.resolve(a)}),(function(e){var t="addGroup"+c.handleErrorMessage(e),r=new Error(t);r.details=409===e.status?"conflict":"unknown",o.reject(r),n.error("[groupService] "+t)})),o.promise};var d=function(e){angular.forEach(c.groups,(function(t,n){t.id===e&&c.groups.splice(n,1)}))};this.removeGroup=function(t){n.info("[groupService] removeGroup : "+t);var r=e.defer();return i({method:"DELETE",url:c.portalURL+"groups/"+t,headers:a.a.getRequestHeader()}).then((function(){n.info("[groupService] removeGroup success for : "+t),d(t),r.resolve()}),(function(e){var t="removeGroup"+c.handleErrorMessage(e);r.reject(new Error(t)),n.error("[groupService] "+t)})),r.promise},this.updateGroup=function(t){n.info("[groupService] updateGroup for : "+t.name);var r=e.defer();return i({method:"PUT",url:c.portalURL+"groups/"+t.id,headers:a.a.getRequestHeader(),data:{name:t.name,comment:t.comment,isFavorite:t.isFavorite}}).then((function(){n.info("[groupService] updateGroup success for : "+t.name),r.resolve()}),(function(e){var t=c.handleErrorMessage(e,"updateGroup");r.reject(t),n.error("[groupService] "+t.message)})),r.promise},this.getGroupUsers=function(t){n.info("[groupService] getGroupUsers : "+t);var r=e.defer();return i({method:"GET",url:c.portalURL+"groups/"+t+"/users",headers:a.a.getRequestHeader()}).then((function(e){var i=e.data.data;n.info("[groupService] getGroupUsers success for "+t+" (find "+e.data.total+" users(s))"),r.resolve(i.users)}),(function(e){var t="getGroupUsers"+c.handleErrorMessage(e);r.reject(new Error(t)),n.error("[groupService] "+t)})),r.promise},this.addGroupUser=function(e,o){n.info("[groupService] addGroupUser");var s=c.$q.defer();return e.users.some((function(e){return o.dbId===e.dbId}))?(n.info("[groupService] addGroupUser - user: "+o.id+" already exist in group: "+e.name+" - no remote action"),void s.resolve()):(i({method:"POST",url:c.portalURL+"groups/"+e.id+"/users/"+o.dbId,headers:a.a.getPostHeader()}).then((function(i){n.info("[groupService] addGroupUser success: "+o.id+"/"+e.name),u(e.id,o.dbId).then((function(e){if(e)s.resolve(e);else{var t=i.data.data,n=r.Group.createFromData(t);s.resolve(n)}})),t.$broadcast(c.ON_GROUP_USERS_UPDATE_EVENT)}),(function(e){var t="addGroupUser"+c.handleErrorMessage(e);s.reject(new Error(t)),n.error("[groupService] "+t)})),s.promise)};var h=function(e,t){angular.forEach(c.groups,(function(n){n.id===e&&(angular.forEach(n.users,(function(r,i){r.dbId===t&&(n.users.splice(i,1),r.getGroups()&&angular.forEach(r.getGroups(),(function(t,n){t.id===e&&r.getGroups().splice(n,1)})))})),c.sortUsersInGroup(n))}))};this.getGroupById=function(e){var t=null;return angular.forEach(c.groups,(function(n){n.id===e&&(t=n)})),t},this.removeGroupUser=function(r,o){n.info("[groupService] removeGroupUser : "+r+"/"+o.id);var s=e.defer();return i({method:"DELETE",url:c.portalURL+"groups/"+r+"/users/"+o.dbId,headers:a.a.getRequestHeader()}).then((function(){n.info("[groupService] removeGroupUser success : "+r+"/"+o.id),h(r,o.dbId);var e=c.getGroupById(r);t.$broadcast(c.ON_GROUP_USERS_UPDATE_EVENT),s.resolve(e)}),(function(e){var t="removeGroupUser"+c.handleErrorMessage(e);s.reject(new Error(t)),n.error("[groupService] "+t)})),s.promise},this.getUserGroups=function(t){if(!t)return n.info("[groupService] getUserGroups for unknown user !"),e.when();n.info("[groupService] getUserGroups for user : "+t.id);var o=e.defer(),s=t.getGroups();return s?e.when(s):(i({method:"GET",url:c.portalURL+"groups?userId="+t.dbId,headers:a.a.getRequestHeader()}).then((function(e){var i=e.data.data;n.info("[groupService] getUserGroups success (find "+e.data.total+" group(s))");var a=[];i.forEach((function(e){var t=r.Group.createFromData(e);a.push(t)})),t.setGroups(a),c.logUserGroups(t.nameForLog,a),o.resolve(a)}),(function(e){var t="getUserGroups"+c.handleErrorMessage(e);o.reject(new Error(t)),n.error("[groupService] "+t)})),o.promise)},this.getGroupFromName=function(t){n.info("[groupService] getGroupFromName : "+t);var r=e.defer();return this.getGroups().then((function(e){var n=null;e.forEach((function(e){e.name===t&&(n=e)})),r.resolve(n)})),r.promise},this.sortUsersInGroup=function(e){e&&(e.sortedUserList=o.getFilterAndOrderUsersGroupedByOrderLabelAndUpdateActivity(e.users,t.orderType,t.filterType,!0))},this.searchLocalGroup=function(e){var t=[];return n.info("[groupService] searchLocalGroup with text "+e),e&&c.groups.forEach((function(n){n.name.toLowerCase().indexOf(e.toLowerCase().toString())>=0&&t.push(n)})),t},this.extractStanzaData=function(t){var n=e.defer(),r={outgoingMessage:!1};return r.body=angular.element(t)[0].firstChild,r.messageId=angular.element(t).attr("id"),n.resolve(r),n.promise},this.onGroupMessageReceived=function(e){try{return this.extractStanzaData(e).then((function(e){if(e.body&&"group"===e.body.tagName){var n=e.body.getAttribute("action"),r=e.body.getAttribute("scope"),i=e.body.getAttribute("id");switch(r){case"group":switch(n){case"create":c.getGroup(i).then((function(){t.$broadcast(c.ON_CREATED_GROUP_EVENT,i)}));break;case"update":var a=e.body.getAttribute("name"),o=e.body.getAttribute("comment"),s="true"===e.body.getAttribute("isFavorite");t.$broadcast(c.ON_UPDATE_GROUP_EVENT,i,a,o,s);break;case"delete":d(i),t.$broadcast(c.ON_REMOVED_GROUP_EVENT,i)}break;case"user":var l=e.body.getAttribute("userId");switch(n){case"create":u(i,l);break;case"delete":h(i,l),t.$broadcast(c.ON_REMOVE_GROUP_USER_EVENT,i,l)}}}})),!0}catch(n){return!0}},this.attachHandlers=function(){c.removeHandlers(),c.groupMessageHandlerRef||(c.groupMessageHandlerRef=s.a.addHandler((function(e){return c.onGroupMessageReceived(e)}),null,"message","management"))},this.removeHandlers=function(){c.groupMessageHandlerRef&&(s.a.deleteHandler(c.groupMessageHandlerRef),c.groupMessageHandlerRef=null)},this.handleBadRequest=function(e,t){if(400===t.status&&t.data.errorDetails&&t.data.errorDetails.length>0){var n={};t.data.errorDetails.forEach((function(e){n[e.param]=e.msg}));var r=new Error(e+" failure: BadRequest");return r.fieldErrors=n,r}return null},this.handleErrorMessage=function(e){var t=" failure: ";return 500===e.status&&(t+="Internal server error"),403===e.status?t+="Access is forbidden for the current user":404===e.status?t+=e.data.errorMsg:e.data&&e.data.errorDetails&&(t+=e.data.errorDetails),t},this.logUserGroups=function(e,t){var r="";t&&0!==t.length&&(t.forEach((function(e){e.name&&(r+=" "+e.name)})),n.info("[groupService] logUserGroups for "+e+":"+r))},this.logGroupUsers=function(e){var t;e&&e.users&&0!==e.users.length&&(t=e.users.map((function(e){return e.nameForLog})).join(" / "),n.info("[groupService] logGroupUsers for "+e.name+": "+t))}}])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),a=n(27),o=n(3),s=n(1),c=n(2),l=n(4),u=n(6);!function(e){e[e.Unknow=0]="Unknow",e[e.Free=1]="Free",e[e.WaitWebrtc=2]="WaitWebrtc",e[e.WaitTelephony=3]="WaitTelephony",e[e.CallOffer=4]="CallOffer",e[e.CallOnGoing=5]="CallOnGoing",e[e.CallActive=6]="CallActive",e[e.CallActiveNoWebMedia=7]="CallActiveNoWebMedia",e[e.TelCallReleasing=8]="TelCallReleasing",e[e.WebCallReleasing=9]="WebCallReleasing",e[e.RemoteControled=10]="RemoteControled",e[e.AnomalyCCS=11]="AnomalyCCS"}(r=t.MPCallState||(t.MPCallState={}));var d=function(){function e(t,n,r,i,a,o,d,h){S(this,e),this.$q=t,this.$rootScope=n,this.$log=r,this.$http=i,this.$interval=a,this.videoService=o,this.errorHelperService=d,this.telephonyService=h,this.started=!1,this.listeners=[],this.myContact=null,this.mediaPillarContact=null,this.mediaPillarConfigured=!1,this.mediaPillarAlive=!1,this.mediaPillarJid="",this.authService=c.default,this.evtQueue=[],this.SEM=0,this.fakeMediaPillarJid="00a241586a984a869c73719007b27921@demo-all-in-one-dev-1.opentouch.cloud",this.xmppService=l.default,this.profileService=u.default,this.contactService=s.default,this.TO_transition=15e3,this.TO_transition_long=3e4,this.TO_NoWebMedia=6e4,this.TO_NoWebMediaNotel=5e3,this.TO_PILLAR_POLLING=3e5,this.TO_waitTelephony=600,this.mediaPillarKeepAliveSuspend=!1}return C(e,[{key:"start",value:function(e){var t=this,n=performance.now();return this.mediaPillarConfigured=!1,this.mediaPillarAlive=!1,this.portalURL=config.restServerUrl+"/api/rainbow/mediapillar/v1.0/mediapillars",this.myContact=this.contactService.userContact,this.mediaPillarContact=null,this.mediaPillarCallContext={callState:r.Free,keepAlive_TO:null,callState_TO:null,waitTelephony_TO:null,isOutgoingCall3PCC:!1,telephonyCallRefs:[],webrtcCallRef:null,mediaPillarJid:"",rainbowPhoneNumber:"",remoteExtension:"",previousCallConnectionId:null,previousCallStatus:null,updateContactFlag:!1,isIncomingCallPopupWithWebRtcCall:!1},this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_WEBRTC_PSTN_CALLING)?(this.$log.info("[WebrtcGatewayService] === STARTING ==="),this.started=!0,this.SEM=0,this.resetEvtAutomaton(),this.getMediaPillarData().then((function(r){t.mediaPillarContact=t.createMediaPillarContact(r),t.mediaPillarCallContext.mediaPillarJid=r,t.$log.info("[WebrtcGatewayService] Pillar remoteExtension used : "+t.mediaPillarCallContext.remoteExtension),""!==t.mediaPillarCallContext.remoteExtension?t.mediaPillarConfigured=!0:(t.$log.warn("[WebrtcGatewayService] no remoteExtention available "),t.mediaPillarConfigured=!1),t.mediaPillarConfigured&&t.dummyRegisterMediaPillarCall().then((function(){t.mediaPillarAlive=!0,t.$log.info("[WebrtcGatewayService] Pseudo media pillar register OK with extension "+t.mediaPillarCallContext.remoteExtension),t.$rootScope.$broadcast("ON_WEBRTCGATEWAY_STATE_CHG",t.mediaPillarAlive)})).catch((function(e){t.mediaPillarAlive=!1,t.$log.info("[WebrtcGatewayService] Pseudo media pillar register KO"),t.$log.info("[WebrtcGatewayService] Initial polling activated on starting issue"),t.mediaPillarKeepAlivePolling("START",3e5),t.$rootScope.$broadcast("ON_WEBRTCGATEWAY_STATE_CHG",t.mediaPillarAlive)})),t.xmppConnectionSubscription=t.xmppService.subscribeToConnectionEvents((function(e){"ON_XMPP_DISCONNECTED"===e.name?(t.$log.info("[WebrtcGatewayService] onConnectionStateChangeEvent : disconnected then MP keepalive suspended"),t.mediaPillarKeepAliveSuspend=!0):"ON_XMPP_CONNECTED"===e.name&&(t.$log.info("[WebrtcGatewayService] onConnectionStateChangeEvent : connected then keepalive as necessary"),t.mediaPillarKeepAliveSuspend=!1,t.TO_PILLAR_POLLING=3e5)})),t.listeners.push(t.$rootScope.$on("ON_CALL_UPDATED_EVENT",(function(e,n,r){t.onCallEvent(e,n,r)}))),t.listeners.push(t.$rootScope.$on("ON_MEDIAPILLAR_CALL_REMOTE_CTRL_EVENT",(function(e,n){t.onRemoteCtrlCall(e,n)})));var i=Math.round(performance.now()-n);e.push({service:"WebrtcGatewayService",startDuration:i}),t.$log.info("[WebrtcGatewayService] === STARTED ("+i+" ms) ===")})).catch((function(e){t.mediaPillarCallContext.mediaPillarJid="",t.mediaPillarCallContext.rainbowPhoneNumber="",t.mediaPillarCallContext.remoteExtension="",t.mediaPillarConfigured=!1,t.mediaPillarAlive=!1,t.$log.info("[WebrtcGatewayService] === STARTING FAILURE === "+e.message)}))):this.$log.info("[WebrtcGatewayService] === NO WEBRTCGATEWAY ENVOLVED === "),this.$q.when()}},{key:"stop",value:function(){return this.$log.info("[WebrtcGatewayService] === STOPPING ==="),this.started=!1,this.mediaPillarConfigured=!1,this.mediaPillarAlive=!1,this.mediaPillarKeepAlivePolling("STOP",0),this.mediaPillarCallContext&&(this.releaseMediaPillarCallContext(),this.mediaPillarCallContext.callState=r.Unknow,this.mediaPillarCallContext.mediaPillarJid="",this.mediaPillarCallContext.rainbowPhoneNumber="",this.mediaPillarCallContext.remoteExtension=""),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.listeners&&this.listeners.forEach((function(e){e()})),this.$log.info("[WebrtcGatewayService] === STOPPED ==="),this.$q.resolve()}},{key:"onCallEvent",value:function(e,t,n){if(this.isMediaPillarCallCase()){if(this.SEM++,this.$log.info("[WebrtcGatewayService] onCallEvent IN("+this.SEM+") state = "+this.mediaPillarCallContext.callState),this.$log.info("[WebrtcGatewayService] onCallEvent "+this.mediaPillarCallContext.callState+" --- "+t.type.value+"("+t.id+","+t.status.value+")"),n&&null!==n&&(this.$log.info("[WebrtcGatewayService] onCallEvent tel infoEvt = "+n),this.$log.info("[WebrtcGatewayService] onCallEvent tel infoEvt : Evt = "+n.actionElemName+" / cause = "+n.cause),"updatecall"===n.actionElemName&&(this.mediaPillarCallContext.updateContactFlag=!0,this.$log.info("[WebrtcGatewayService] updateContactFlag = true"))),t.connectionId===this.mediaPillarCallContext.previousCallConnectionId&&t.status===this.mediaPillarCallContext.previousCallStatus&&!this.mediaPillarCallContext.updateContactFlag)return this.mediaPillarCallContext.previousCallConnectionId=t.connectionId,this.mediaPillarCallContext.previousCallStatus=t.status,this.$log.info("[WebrtcGatewayService] onCallEvent | DEBOUNCE EVT"),this.SEM--,void this.$log.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+")");if(t.type.value===i.Call.Type.PHONE.value&&null===t.id)return this.mediaPillarCallContext.previousCallConnectionId=t.connectionId,this.mediaPillarCallContext.previousCallStatus=t.status,this.$log.info("[WebrtcGatewayService] onCallEvent | FILTER EVT null/error"),this.SEM--,void this.$log.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+")");if(this.mediaPillarCallContext.previousCallConnectionId=t.connectionId,this.mediaPillarCallContext.previousCallStatus=t.status,this.evtQueue.push(t),this.evtQueue.length>1)return this.SEM--,void this.$log.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+") evt pushed = "+t.status.value);for(;this.evtQueue.length;){try{this.processEvt(this.evtQueue[0])}catch(r){this.$log.error("[WebrtcGatewayService] onCallEvent queue processing | call : "+this.evtQueue[0].status.value+" Error : "+r)}this.evtQueue.splice(0,1)}this.SEM--,this.$log.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+") state = "+this.mediaPillarCallContext.callState),0!==this.SEM&&(this.$log.error("[WebrtcGatewayService] onCallEvent OUT | Unmanaged Eventing Reentrancy Situation"),this.resetEvtAutomaton(),this.SEM=0)}}},{key:"processEvt",value:function(e){var t=this;if(this.$log.info("[WebrtcGatewayService] processEvt | process "+e.type.value+"("+e.id+","+e.status.value+") in MPcontextCallstate = "+this.mediaPillarCallContext.callState),e.type.value===i.Call.Type.PHONE.value){var n=this.telephonyService.getCalls().length;if(function(){var n=!1;return(e.status===i.Call.Status.DIALING||t.telephonyService.isSipWise())&&(e.isSecondary=!0),e.isSecondary?e.status===i.Call.Status.UNKNOWN||e.status===i.Call.Status.RINGING_INCOMMING||e.status===i.Call.Status.QUEUED_INCOMMING||e.status===i.Call.Status.ACTIVE?(t.addTelCallRefs(e),n=!1):t.mediaPillarCallContext.callState===r.RemoteControled?(t.$log.info("[WebrtcGatewayService] processEvt |  RemoteControled state for call : "+e.id+" then ignore"),n=!0):(t.addTelCallRefs(e),t.mediaPillarCallContext.telephonyCallRefs.length>1?(t.$log.info("[WebrtcGatewayService] processEvt |  nthCall : "+t.mediaPillarCallContext.telephonyCallRefs.length+" then ignore"),n=!0):n):(t.$log.info("[WebrtcGatewayService] processEvt | NOT SECONDARY then ignore"),n=!0)}())this.$log.info("[WebrtcGatewayService] processEvt |  call("+e.id+" / SEC "+e.isSecondary+", "+e.status.value+") -> EVT IGNORED"),this.$log.info("[WebrtcGatewayService] processEvt |  telephonyCallRefs.length = "+this.mediaPillarCallContext.telephonyCallRefs.length),this.$log.info("[WebrtcGatewayService] processEvt |  calls.length = "+n);else switch(this.$log.info("[WebrtcGatewayService] processEvt |  call("+e.id+" / SEC "+e.isSecondary+", "+e.status.value+") -> EVT PROCESSED"),this.$log.info("[WebrtcGatewayService] processEvt |  telephonyCallRefs.length = "+this.mediaPillarCallContext.telephonyCallRefs.length),this.$log.info("[WebrtcGatewayService] processEvt |  calls.length = "+n),e.status){case i.Call.Status.RINGING_INCOMMING:this.onTelCallIncomming(e);break;case i.Call.Status.DIALING:this.onTelCallDialling(e);break;case i.Call.Status.RINGING_OUTGOING:this.onTelCallOutgoing(e);break;case i.Call.Status.ACTIVE:this.onTelCallActive(e);break;case i.Call.Status.UNKNOWN:this.onTelCallReleasing(e)}}else if(this.isMediaPillarJid(this.xmppService.getBareJidFromJid(e.fullJid)))switch(e.status){case i.Call.Status.RINGING_INCOMMING:this.onWebrtcCallIncomming(e);break;case i.Call.Status.CONNECTING:this.onWebrtcCallConnecting(e);break;case i.Call.Status.ACTIVE:this.onWebrtcCallActive(e);break;case i.Call.Status.ANSWERING:this.onWebrtcCallAnswering(e);break;case i.Call.Status.UNKNOWN:this.onWebrtcCallReleasing(e)}else this.$log.info("[WebrtcGatewayService] processEvt | process call("+e.id+","+e.status.value+") -> Not a webrtcgateway case")}},{key:"releaseMediaPillarCallContext",value:function(){this.mediaPillarCallContext.callState=r.Free,this.stopCallStateTimeOut(),this.stopWaitTelephonyTimeOut(),this.mediaPillarCallContext.isOutgoingCall3PCC=!1,this.mediaPillarCallContext.updateContactFlag=!1,this.mediaPillarCallContext.telephonyCallRefs.length>0&&this.$log.warn("[WebrtcGatewayService] releaseMediaPillarCallContext | reset context but telephonyCallRefs not empty !"),null!==this.mediaPillarCallContext.webrtcCallRef&&this.$log.warn("[WebrtcGatewayService] releaseMediaPillarCallContext | reset context but webrtcCallRef not null !"),this.mediaPillarCallContext.telephonyCallRefs=[],this.mediaPillarCallContext.webrtcCallRef=null,this.mediaPillarCallContext.previousCallConnectionId=null,this.mediaPillarCallContext.previousCallStatus="",this.mediaPillarCallContext.isIncomingCallPopupWithWebRtcCall=!1,this.$log.log("[WebrtcGatewayService] releaseMediaPillarCallContext | =====  mediaPillarCallContext RELEASED  ===== ")}},{key:"resetEvtAutomaton",value:function(){this.evtQueue=[]}},{key:"stopCallStateTimeOut",value:function(){this.mediaPillarCallContext.callState_TO&&this.$interval.cancel(this.mediaPillarCallContext.callState_TO),this.mediaPillarCallContext.callState_TO=null}},{key:"stopWaitTelephonyTimeOut",value:function(){this.mediaPillarCallContext.waitTelephony_TO&&this.$interval.cancel(this.mediaPillarCallContext.waitTelephony_TO),this.mediaPillarCallContext.waitTelephony_TO=null}},{key:"onRemoteCtrlCall",value:function(e,t){this.$log.info("[WebrtcGatewayService] onRemoteCtrlCall for call "+t.id+" in previous state: "+this.mediaPillarCallContext.callState+": => Becomes REMOTECONTROLED"),this.mediaPillarCallContext.callState=r.RemoteControled,this.stopCallStateTimeOut()}},{key:"addTelCallRefs",value:function(e){if(null!=e){for(var t=!1,n=0;n<this.mediaPillarCallContext.telephonyCallRefs.length;n++)this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[n].id===e.id&&(t=!0);t||this.mediaPillarCallContext.telephonyCallRefs.push(e)}else this.$log.warn("[WebrtcGatewayService] addTelCallRefs | ANOMALY callRef not valid")}},{key:"removeTelCallRefs",value:function(e){if(null!=e)for(var t=0;t<this.mediaPillarCallContext.telephonyCallRefs.length;)this.mediaPillarCallContext.telephonyCallRefs[t].id===e.id?(this.mediaPillarCallContext.telephonyCallRefs.splice(t,1),0===t&&this.mediaPillarCallContext.telephonyCallRefs.length&&(this.mediaPillarCallContext.telephonyCallRefs[0].setMediaPillarCall(this.getMediaPillarCallContext()),this.$log.log("[WebrtcGatewayService] removeTelCallRefs | master MP call becomes : "+this.mediaPillarCallContext.telephonyCallRefs[0].id))):t++;else this.$log.warn("[WebrtcGatewayService] removeTelCallRefs | ANOMALY callRef not valid")}},{key:"putAsMasterTelCallRefs",value:function(e){if(null!=e){for(var t=-1,n=0;n<this.mediaPillarCallContext.telephonyCallRefs.length;n++)this.mediaPillarCallContext.telephonyCallRefs[n].id===e.id&&(t=n);if(this.$log.log("[WebrtcGatewayService] putAsMasterTelCallRefs | master MP call is : "+e.id),0!==t)if(-1!==t){var r=this.mediaPillarCallContext.telephonyCallRefs[0];this.mediaPillarCallContext.telephonyCallRefs[0]=e,this.mediaPillarCallContext.telephonyCallRefs[t]=r,e.setMediaPillarCall(this.getMediaPillarCallContext())}else this.$log.warn("[WebrtcGatewayService] putAsMasterTelCallRefs | Anomaly call not in telephonyCallRefs")}else this.$log.warn("[WebrtcGatewayService] putAsMasterTelCallRefs | ANOMALY callRef not valid")}},{key:"isMasterTelCallRefs",value:function(e){return null==e?(this.$log.warn("[WebrtcGatewayService] isMasterTelCallRefs | ANOMALY callRef not valid"),!1):0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[0].id===e.id}},{key:"isInTelCallRefs",value:function(e){if(null!=e){for(var t=-1,n=0;n<this.mediaPillarCallContext.telephonyCallRefs.length;n++)this.mediaPillarCallContext.telephonyCallRefs[n].id===e.id&&(t=n);return-1!==t}this.$log.warn("[WebrtcGatewayService] isInTelCallRefs | ANOMALY callRef not valid")}},{key:"replaceCallRefs",value:function(e,t){if(null!=e&&null!=t){var n=!1,r=e.isMediaPillarCall(),i=t.isMediaPillarCall();this.isInTelCallRefs(e)&&(n=!0,this.$log.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY newcallRef already existing"),this.removeTelCallRefs(e));for(var a=-1,o=0;o<this.mediaPillarCallContext.telephonyCallRefs.length;o++)this.mediaPillarCallContext.telephonyCallRefs[o].id===t.id&&(a=o);-1!==a?(this.mediaPillarCallContext.telephonyCallRefs[a]=e,i&&e.setMediaPillarCall(this.getMediaPillarCallContext()),t.setMediaPillarCall(null),0===a&&this.$log.log("[WebrtcGatewayService] replaceCallRefs | master MP call becomes : "+this.mediaPillarCallContext.telephonyCallRefs[0].id)):(this.$log.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY oldCallRef not found"),n&&(this.addTelCallRefs(e),r&&e.setMediaPillarCall(this.getMediaPillarCallContext())))}else this.$log.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY callRef not valid")}},{key:"automatonDefenseTimout",value:function(e){var t=this,n=0;if(null!=e)if(e.type.value===i.Call.Type.PHONE.value)switch(this.$log.log("[WebrtcGatewayService] automatonDefenseTimout | transition telcall call="+e.id+" evt="+e.status.value+" then timout"),e.status){case i.Call.Status.RINGING_OUTGOING:case i.Call.Status.RINGING_INCOMMING:break;default:this.mediaPillarCallContext.callState!==r.CallActive&&this.mediaPillarCallContext.callState!==r.CallActiveNoWebMedia&&this.mediaPillarCallContext.callState!==r.CallOffer&&this.mediaPillarCallContext.callState!==r.CallOnGoing&&(n=2)}else if(this.isMediaPillarJid(this.xmppService.getBareJidFromJid(e.fullJid)))switch(this.$log.log("[WebrtcGatewayService] automatonDefenseTimout | transition webrtc "+e.status.value+" then timout"),e.status){case i.Call.Status.ACTIVE:break;default:this.mediaPillarCallContext.callState!==r.CallActive&&this.mediaPillarCallContext.callState!==r.CallActiveNoWebMedia&&this.mediaPillarCallContext.callState!==r.CallOffer&&this.mediaPillarCallContext.callState!==r.CallOnGoing&&(n=3)}else this.$log.warn("[WebrtcGatewayService] automatonDefenseTimout | anomaly transition webrtc call but Not a webrtcgateway case"),n=2;else this.mediaPillarCallContext.callState!==r.CallActive&&this.mediaPillarCallContext.callState!==r.CallActiveNoWebMedia&&this.mediaPillarCallContext.callState!==r.RemoteControled&&this.mediaPillarCallContext.callState!==r.CallOffer&&this.mediaPillarCallContext.callState!==r.CallOnGoing&&(this.$log.log("[WebrtcGatewayService] automatonDefenseTimout | anomaly timout in unexpected state"),n=2);switch(0!==n&&this.$log.warn("[WebrtcGatewayService] automatonDefenseTimout | actionlevel "+n),n){case 0:break;case 1:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING);break;case 2:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.releaseMediaPillarCallContext();break;case 3:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.MediaPillarReleaseWebrtcCall(),this.releaseMediaPillarCallContext();break;default:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.MediaPillarCallTerminator()}this.mediaPillarCallContext.callState!==r.Free&&(this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(null)}),this.TO_transition,1))}},{key:"onTelCallIncomming",value:function(e){var t=this;if(this.mediaPillarCallContext.telephonyCallRefs.length>1&&this.mediaPillarCallContext.callState!==r.Free&&this.mediaPillarCallContext.callState!==r.WaitTelephony&&this.mediaPillarCallContext.callState!==r.WaitWebrtc)return this.$log.info("[WebrtcGatewayService] onTelCallIncomming | nth calls BUT trig the GUI & link the call"),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.$log.info("[WebrtcGatewayService] onTelCallIncomming | ON_WEBRTC_GW_CALL_UPDATED_EVENT for call = "+e.id),this.mediaPillarCallContext.updateContactFlag=!0,void this.$rootScope.$broadcast("ON_WEBRTC_GW_CALL_UPDATED_EVENT",e);switch(this.$log.info("[WebrtcGatewayService] onTelCallIncomming | mediapilaryse as necessary for call "+e.id+" date "+o().format("HH:mm:ss:SSS")),this.mediaPillaryseTheCall(e,null)){case"Ok":if(this.stopWaitTelephonyTimeOut(),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition,1),!this.isMediaPillarOutgoingCall()&&this.mediaPillarCallContext.callState===r.CallOffer&&this.mediaPillarCallContext.webrtcCallRef){var n=this.mediaPillarCallContext.isIncomingCallPopupWithWebRtcCall;n&&(this.$log.warn("[WebrtcGatewayService] onTelCallIncomming | Incoming tel phone while Popup displayed with Webrtc Call should happen in rare cases when csta event is very slow: use phone call info anyway for call "+e.id),this.mediaPillarCallContext.webrtcCallRef.contact=Object.assign(this.mediaPillarCallContext.webrtcCallRef.contact,e.contact),this.$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:this.mediaPillarCallContext.webrtcCallRef}));for(var a=0;a<this.mediaPillarCallContext.telephonyCallRefs.length;a++)(!n&&(this.mediaPillarCallContext.telephonyCallRefs[a].status===i.Call.Status.RINGING_INCOMMING||this.mediaPillarCallContext.telephonyCallRefs[a].status===i.Call.Status.QUEUED_INCOMMING)||n&&this.mediaPillarCallContext.telephonyCallRefs[a].status===i.Call.Status.QUEUED_INCOMMING)&&(this.$log.info("[WebrtcGatewayService] onTelCallIncomming | ON_WEBRTC_GW_CALL_UPDATED_EVENT for call = "+e.id),this.mediaPillarCallContext.updateContactFlag=!0,this.$rootScope.$broadcast("ON_WEBRTC_GW_CALL_UPDATED_EVENT",this.mediaPillarCallContext.telephonyCallRefs[a]))}break;case"Update":this.stopCallStateTimeOut(),this.isMediaPillarOutgoingCall()||!this.mediaPillarCallContext.webrtcCallRef||e.status!==i.Call.Status.RINGING_INCOMMING&&e.status!==i.Call.Status.QUEUED_INCOMMING?this.$log.info("[WebrtcGatewayService] onTelCallIncomming | ignore update call"):(this.$rootScope.$broadcast("ON_WEBRTC_GW_CALL_UPDATED_EVENT",e),this.$log.info("[WebrtcGatewayService] onTelCallIncomming | update call"));break;case"Ignore":this.$log.info("[WebrtcGatewayService] onTelCallIncomming | ignore evt");break;default:this.$log.error("[WebrtcGatewayService] onTelCallIncomming | media Pillar call anomaly "+status)}}},{key:"onTelCallDialling",value:function(e){var t=this;if(this.mediaPillarCallContext.isOutgoingCall3PCC=!0===e.isOwner,this.mediaPillarCallContext.isOutgoingCall3PCC)if(this.mediaPillarCallContext.callState===r.Free||this.mediaPillarCallContext.callState===r.WaitTelephony)switch(this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition,1),this.mediaPillaryseTheCall(e,null)){case"Ok":this.mediaPillarCallContext.webrtcCallRef&&this.mediaPillarCallContext.callState===r.CallOffer&&(this.videoService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.$log.info("[WebrtcGatewayService] onTelCallDialling | outgoing3PCC then send webrtc proceed")),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition,1);break;case"Ignore":case"Update":this.$log.info("[WebrtcGatewayService] onTelCallDialling | ignore evt");break;default:this.$log.error("[WebrtcGatewayService] onTelCallDialling | media Pillar call anomaly "+status),this.MediaPillarCallTerminator()}else this.mediaPillarCallContext.callState===r.CallOffer||this.mediaPillarCallContext.callState===r.CallOnGoing?(this.$log.warn("[WebrtcGatewayService] onTelCallDialling | media Pillar call anomaly, on state : "+this.mediaPillarCallContext.callState),this.$log.info("[WebrtcGatewayService] onTelCallDialling | ignored , on state : "+this.mediaPillarCallContext.callState)):(this.$log.warn("[WebrtcGatewayService] onTelCallDialling | media Pillar call anomaly, MP context not compatible"),this.MediaPillarCallTerminator());else this.stopCallStateTimeOut(),this.$log.info("[WebrtcGatewayService] onTelCallDialling but not call owner (=>other client) | ignore evt on state : "+this.mediaPillarCallContext.callState)}},{key:"onTelCallOutgoing",value:function(e){var t=this;this.isMediaPillarOutgoingCall()?(this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition_long,1)):(this.$log.warn("[WebrtcGatewayService] onTelCallOutgoing | media Pillar, not a 1st 3PCC outgoing call then ignore & release MP CallContext"),this.releaseMediaPillarCallContext())}},{key:"onTelCallActive",value:function(e){switch(this.mediaPillarCallContext.callState){case r.CallOnGoing:this.stopCallStateTimeOut(),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=r.CallActive;break;case r.TelCallReleasing:this.$log.warn("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state = "+this.mediaPillarCallContext.callState),this.$log.info("[WebrtcGatewayService] onTelCallActive | media Pillar , RE-ACTIVATION"),this.stopCallStateTimeOut(),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=r.CallActive;break;case r.CallActive:this.$log.info("[WebrtcGatewayService] onTelCallActive | media Pillar , ignore tel active on state CallActive ");break;case r.WebCallReleasing:this.$log.info("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state WebCallReleasing then releaseMediaPillarCallContext"),this.releaseMediaPillarCallContext();break;case r.Free:this.$log.info("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state = 1 ; probably call taken on deskphone ; ignore active & release call context "),this.releaseMediaPillarCallContext();break;default:this.$log.info("[WebrtcGatewayService] onTelCallActive | Anomaly media Pillar recv tel active on state = "+this.mediaPillarCallContext.callState)}}},{key:"onTelCallReleasing",value:function(e){var t=this;if(this.telephonyService.getCalls().length,this.mediaPillarCallContext.telephonyCallRefs.length>1)return e.setMediaPillarCall(null),this.removeTelCallRefs(e),void this.$log.info("[WebrtcGatewayService] onTelCallReleasing -- "+e.id+" -- postpone mediaPillarCallContext release ;  remaining calls = "+this.mediaPillarCallContext.telephonyCallRefs.length);this.isMediaPillarReleasableCall()?(e.setMediaPillarCall(null),this.removeTelCallRefs(e),this.mediaPillarCallContext.webrtcCallRef&&this.mediaPillarCallContext.callState!==r.WebCallReleasing&&this.mediaPillarCallContext.callState!==r.RemoteControled?this.mediaPillarCallContext.callState!==r.TelCallReleasing?(this.mediaPillarCallContext.callState=r.TelCallReleasing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition,1),this.$log.info("[WebrtcGatewayService] onTelCallReleasing -- "+e.id+" -- wait web release: state = "+this.mediaPillarCallContext.callState)):this.$log.info("[WebrtcGatewayService] onTelCallReleasing -- "+e.id+" -- ignore telrelease on state = "+this.mediaPillarCallContext.callState):this.mediaPillarCallContext.callState!==r.Free&&(this.releaseMediaPillarCallContext(),this.$log.info("[WebrtcGatewayService] onTelCallReleasing -- "+e.id+" -- release MP context"))):(this.$log.warn("[WebrtcGatewayService] onTelCallReleasing | media Pillar call release anomaly on state = "+this.mediaPillarCallContext.callState),this.MediaPillarCallTerminator())}},{key:"onWebrtcCallIncomming",value:function(e){var t=this;if(this.mediaPillarCallContext.webrtcCallRef)this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming -- "+e.id+" --- ignored other incomming");else{if(this.mediaPillarCallContext.callState===r.WebCallReleasing&&0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[0].status!==i.Call.Status.UNKNOWN)return this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming -- "+e.id+" --- re propose during established tel call"),this.mediaPillarCallContext.webrtcCallRef=e,this.videoService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition,1),void(this.mediaPillarCallContext.callState=r.CallOnGoing);switch(this.mediaPillaryseTheCall(null,e)){case"Ok":if(this.stopCallStateTimeOut(),(this.isMediaPillarOutgoingCall()||this.mediaPillarCallContext.callState!==r.WaitTelephony)&&(this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition,1)),this.isMediaPillarOutgoingCall())this.videoService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming | outgoing3PCC then send webrtc proceed");else if(this.mediaPillarCallContext.callState===r.WaitTelephony)this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming | incoming webrtc WaitTelephony : "+o().format("HH:mm:ss:SSS")+" : arm waitTelephony_TO "),this.stopWaitTelephonyTimeOut(),this.mediaPillarCallContext.waitTelephony_TO=this.$interval((function(){t.waitTelephonyTimeout(e)}),this.TO_waitTelephony,1);else if(this.mediaPillarCallContext.callState===r.CallOffer){this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming | incoming webrtc + telephony");for(var n=0;n<this.mediaPillarCallContext.telephonyCallRefs.length;n++)this.mediaPillarCallContext.telephonyCallRefs[n].status!==i.Call.Status.RINGING_INCOMMING&&this.mediaPillarCallContext.telephonyCallRefs[n].status!==i.Call.Status.QUEUED_INCOMMING||(this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming | ON_CONVERSATION_CALL_UPDATED_EVENT for call = "+this.mediaPillarCallContext.telephonyCallRefs[n].id),this.$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:this.mediaPillarCallContext.telephonyCallRefs[n]}))}break;case"Ignore":break;default:this.$log.error("[WebrtcGatewayService] onWebrtcCallIncomming | media Pillar call anomaly "+status)}}}},{key:"onWebrtcCallConnecting",value:function(e){var t=this;return this.mediaPillarCallContext.callState===r.CallActive?(this.$log.info("[WebrtcGatewayService] onWebrtcCallConnecting -- media Pillar call reconnecting attempts"),this.mediaPillarCallContext.callState=r.CallActiveNoWebMedia,this.stopCallStateTimeOut(),void(this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.timeOutCallActiveNoWebMedia()}),this.TO_NoWebMedia,1))):this.mediaPillarCallContext.callState===r.TelCallReleasing?(this.$log.info("[WebrtcGatewayService] onWebrtcCallConnecting -- media Pillar webrtc call reconnecting while TelCallReleasing"),this.mediaPillarCallContext.callState=r.CallActiveNoWebMedia,this.stopCallStateTimeOut(),void(this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.timeOutCallActiveNoWebMedia()}),this.TO_NoWebMediaNotel,1))):void 0}},{key:"onWebrtcCallActive",value:function(e){this.mediaPillarCallContext.callState===r.CallActiveNoWebMedia&&(this.$log.info("[WebrtcGatewayService] onWebrtcCallConnecting -- media Pillar call reconnected"),this.mediaPillarCallContext.callState=r.CallActive,this.stopCallStateTimeOut())}},{key:"onWebrtcCallAnswering",value:function(e){var t=this;this.mediaPillarCallContext.callState=r.CallOnGoing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition,1)}},{key:"onWebrtcCallReleasing",value:function(e){var t=this;this.isMediaPillarReleasableCall()?(e.setMediaPillarCall(null),this.mediaPillarCallContext.webrtcCallRef=null,0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.callState!==r.TelCallReleasing&&this.mediaPillarCallContext.callState!==r.RemoteControled?this.mediaPillarCallContext.callState!==r.WebCallReleasing?(this.mediaPillarCallContext.callState=r.WebCallReleasing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){t.automatonDefenseTimout(e)}),this.TO_transition,1),this.releasePbxCallIfPbxConnectionDown(),this.$log.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+e.id+" -- wait tel release: state = "+this.mediaPillarCallContext.callState)):this.$log.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+e.id+" -- ignore webrelease on state = "+this.mediaPillarCallContext.callState):(this.releaseMediaPillarCallContext(),this.$log.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+e.id+" -- release MP context"))):(this.$log.warn("[WebrtcGatewayService] onWebrtcCallReleasing | media Pillar call release anomaly on state = "+this.mediaPillarCallContext.callState),this.MediaPillarCallTerminator())}},{key:"waitTelephonyTimeout",value:function(e){var t=this;this.mediaPillarCallContext.callState===r.WaitTelephony?(this.$log.info("[WebrtcGatewayService] waitTelephonyTimeout date "+o().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+this.mediaPillarCallContext.callState+" : perform snpashot on secondary device to check remote extension's csta state"),this.telephonyService.snapshotDevice(!0).then((function(n){var i=n.connections;t.mediaPillarCallContext.callState!==r.WaitTelephony||i&&0!==i.length?(t.$log.info("[WebrtcGatewayService] waitTelephonyTimeout date "+o().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+t.mediaPillarCallContext.callState+" => no more waiting for phone call or existing csta call: don't display any incoming call popup"),t.stopCallStateTimeOut(),t.mediaPillarCallContext.callState_TO=t.$interval((function(){t.automatonDefenseTimout(e)}),t.TO_transition,1)):(t.$log.info("[WebrtcGatewayService] waitTelephonyTimeout date "+o().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+t.mediaPillarCallContext.callState+" => still waiting for phone call and no csta call: send event to open incoming call popup with webrtc call"),t.mediaPillarCallContext.isIncomingCallPopupWithWebRtcCall=!0,t.$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:e}))})).catch((function(n){t.$log.error("[WebrtcGatewayService] waitTelephonyTimeout date "+o().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+t.mediaPillarCallContext.callState+" => snpashotdevice error "+n)}))):this.$log.info("[WebrtcGatewayService] waitTelephonyTimeout date "+o().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+this.mediaPillarCallContext.callState+" => IGNORED"),this.mediaPillarCallContext.waitTelephony_TO=null}},{key:"releasePbxCallIfPbxConnectionDown",value:function(){var e=this.getActivePbxCall();e&&e.pbxConnectionDown&&(this.$log.info("[WebrtcGatewayService] releasePbxCallIfPbxConnectionDown | release call"+e),this.telephonyService.releaseCall(e),e.mediaPillarCall=null)}},{key:"mediaPillarMakeCall1PCC",value:function(e,t){this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall1PCC");var n=this.getMyMediaPillarJid();if(!this.mediaPillarConfigured||!this.mediaPillarAlive)return this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall1PCC ANOMALY webrtcgateway not available"),null;if(this.videoService.makingCall=!0,""!==n){var r="web_"+a();if(!t||null===t){var o=i.Call.create(i.Call.Status.DIALING,r,i.Call.Type.WEBRTC,this.mediaPillarContact);return o.fullJid=n,this.mediaPillarStartCall(o,e,n),o}var s=i.Call.create(i.Call.Status.DIALING,r,i.Call.Type.WEBRTC,t);return s.fullJid=n,this.mediaPillarStartCall(s,e,n),s}return this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY no mediaPillarJid"),null}},{key:"mediaPillarReleaseCall1PCC",value:function(e){if(this.$log.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC"),this.mediaPillarConfigured){var t=this.videoService.calls[e.id];t&&t.type===i.Call.Type.WEBRTC?this.videoService.rejectCall(t):this.$log.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC ANOMALY invalid call")}else this.$log.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC ANOMALY webrtcgateway not available")}},{key:"mediaPillarMakeCall",value:function(e,t){this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall");var n=this.getMyMediaPillarJid();if(e.length>6&&t&&(e=t.phonePbx),this.videoService.makingCall=!0,""!==n){var r,o="web_"+a();t&&null!==t?((r=i.Call.create(i.Call.Status.DIALING,o,i.Call.Type.WEBRTC,t)).fullJid=n,this.mediaPillarStartCall(r,e,n)):((r=i.Call.create(i.Call.Status.DIALING,o,i.Call.Type.WEBRTC,this.mediaPillarContact)).fullJid=n,this.mediaPillarStartCall(r,e,n))}else this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY no mediaPillarJid")}},{key:"mediaPillarStartCall",value:function(e,t,n){var r=this;this.$log.info("[WebrtcGatewayService] mediaPillarStartCall for phone number "+t),this.initiateMediaPillarCall(e).then((function(){r.dummyRegisterMediaPillarCall().then((function(){r.$log.info("[WebrtcGatewayService] mediaPillarMakeCall for number "+t),r.videoService.makeJingleCall(e,n,t)})).catch((function(t){r.$log.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY dummyRegisterMediaPillarCall then abort call"),r.abortCall(e)}))})).catch((function(t){r.$log.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY initiateMediaPillarCall then abort call"),r.abortCall(e)}))}},{key:"abortCall",value:function(e){this.videoService.makingCall=!1,e&&this.videoService.removeCallObject(e),this.videoService.resetToSafeState()}},{key:"initiateMediaPillarCall",value:function(e){var t=this;return this.$q((function(n,r){t.$log.info("[WebrtcGatewayService] initiateMediaPillarCall");var a=["audio"];t.videoService.getBrowserMedia(a).then((function(r){e.isInitiator=!0,t.videoService.localStreams.push(r),t.videoService.calls[e.id]=e,e.localMedia=e.localMedia|i.Call.Media.AUDIO,t.contactService.setBusyState("dnd",t.videoService.calculatePresenceMessage(e)),t.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",e),n()})).catch((function(e){t.$log.info("[WebrtcGatewayService]   | initate call failure : "+JSON.stringify({error:e.message})),a.indexOf("sharing")>=0||-1===e.toString().indexOf("getUserMedia")||t.videoService.openErrorPopup(),r(e)}))}))}},{key:"dummyRegisterMediaPillarCall",value:function(){var e=this;return this.$q((function(t,n){var r=$iq({from:e.myContact.fullJid,to:e.mediaPillarCallContext.mediaPillarJid,type:"set"}).c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("register").c("jidIm").t(e.contactService.userContact.jid).up().c("jidTel").t(e.contactService.userContact.jidtel).up().c("number").t(e.mediaPillarCallContext.rainbowPhoneNumber).up().c("displayName").t(e.myContact.displayName).up().c("secret").t(e.mediaPillarCallContext.rainbowPhoneNumber).up();e.xmppService.sendIQ(r).then((function(e){t()})).catch((function(t){e.IsMediaPillarUserSelected()&&e.$log.warn("[WebrtcGatewayService] dummyRegisterMediaPillarCall -- register failure -- "+t.message),n(t)}))}))}},{key:"getMediaPillarData",value:function(){var e=this;return this.telephonyService.isSipWise()?this.$q((function(t,n){var r=e.telephonyService.telephonyServiceSipWise.getPortalURLSipWise()+"devices";e.$log.info("[WebrtcGatewayService] getMediaPillarData sipwise device GET "+r),e.$http({method:"GET",url:r,headers:e.authService.getRequestHeader()}).then((function(r){var i=e;e.$log.log("[WebrtcGatewayService] getMediaPillarData sipwise success/ status : "+r.statusText);var a=r.data,o="";a?(a.forEach((function(e){"webrtc"===e.type&&(i.mediaPillarCallContext.rainbowPhoneNumber=e.deviceId,i.mediaPillarCallContext.remoteExtension=e.deviceId,(o=e.jid_wrg)&&-1===o.indexOf("/")&&(o+="/mediapillar"))})),""!==o?t(o):(i.$log.error("[WebrtcGatewayService] getMediaPillarData sipwise success -- missing jid_wrg"),n(new Error("[WebrtcGatewayService] getMediaPillarData sipwise -- missing jid_wrg in response")))):(i.$log.error("[WebrtcGatewayService] getMediaPillarData sipwise success -- missing data"),n(new Error("[WebrtcGatewayService] getMediaPillarData sipwise -- missing data in response")))})).catch((function(t){var r=e.errorHelperService.handleError(t);e.$log.info("[WebrtcGatewayService] getMediaPillarData sipwise error -- "+r.message),n(r)}))})):this.$q((function(t,n){e.$http({method:"GET",url:e.portalURL+"/data",headers:e.authService.getRequestHeader()}).then((function(r){if(e.$log.log("[WebrtcGatewayService] getMediaPillarData success"),r.data&&r.data.data){var i=r.data.data.prefix,a=r.data.data.rainbowPhoneNumber;i&&a&&(e.mediaPillarCallContext.rainbowPhoneNumber=a,e.mediaPillarCallContext.remoteExtension=i+a);var o=r.data.data.jid_im;o&&-1===o.indexOf("/")&&(o+="/mediapillar"),t(o)}else e.$log.error("[WebrtcGatewayService] getMediaPillarData success -- missing data"),n(new Error("[WebrtcGatewayService] getMediaPillarData -- missing data in response"))})).catch((function(t){var r=e.errorHelperService.handleError(t);e.$log.info("[WebrtcGatewayService] getMediaPillarData error -- "+r.message),n(r)}))}))}},{key:"mediaPillarKeepAlivePolling",value:function(e,t){var n=this;if(this.started)switch(e){case"START":this.mediaPillarCallContext&&this.mediaPillarCallContext.keepAlive_TO&&(this.$interval.cancel(this.mediaPillarCallContext.keepAlive_TO),this.mediaPillarCallContext.keepAlive_TO=null),this.mediaPillarCallContext.keepAlive_TO=this.$interval((function(){n.mediaPillarKeepAlive()}),t,1);break;case"STOP":this.mediaPillarCallContext&&this.mediaPillarCallContext.keepAlive_TO&&this.$interval.cancel(this.mediaPillarCallContext.keepAlive_TO),this.mediaPillarCallContext.keepAlive_TO=null;break;default:this.$log.error("[WebrtcGatewayService] mediaPillarKeepAlivePolling cmd error : "+e)}}},{key:"mediaPillarUserSelectAndPolling",value:function(e){this.started&&(this.$log.log("[WebrtcGatewayService] mediaPillarUserSelectAndPolling : "+e),e?(this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.mediaPillarKeepAlive()):this.mediaPillarAlive&&this.mediaPillarKeepAlivePolling("STOP",0))}},{key:"mediaPillarKeepAlive",value:function(){var e=this;if(this.$log.info("[WebrtcGatewayService] mediaPillarKeepAlive"),this.mediaPillarKeepAliveSuspend)this.$log.info("[WebrtcGatewayService] KeepAlive suspended");else{var t=!1;this.dummyRegisterMediaPillarCall().then((function(){t=!0,e.$log.info("[WebrtcGatewayService] mediaPillarKeepAlive webrtcgateway is UP")})).catch((function(n){t=!1,e.$log.info("[WebrtcGatewayService] mediaPillarKeepAlive webrtcgateway is DOWN")})).finally((function(){e.mediaPillarAlive!==t&&(e.mediaPillarAlive=t,e.$rootScope.$broadcast("ON_WEBRTCGATEWAY_STATE_CHG",e.mediaPillarAlive),e.$log.info("[WebrtcGatewayService] mediaPillarKeepAlive ON_WEBRTCGATEWAY_STATE_CHG")),e.mediaPillarAlive?e.TO_PILLAR_POLLING<9e5?e.TO_PILLAR_POLLING+=1800:e.TO_PILLAR_POLLING=9e5:(e.TO_PILLAR_POLLING=3e5,e.mediaPillarKeepAlivePolling("START",e.TO_PILLAR_POLLING)),e.IsMediaPillarUserSelected()&&e.mediaPillarAlive&&e.mediaPillarKeepAlivePolling("START",e.TO_PILLAR_POLLING)}))}}},{key:"forceMPpooling",value:function(){this.started&&(this.$log.log("[WebrtcGatewayService] forceMPpooling "),this.TO_PILLAR_POLLING=3e5,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.$rootScope.$broadcast("ON_WEBRTCGATEWAY_STATE_CHG",this.mediaPillarAlive))}},{key:"getMyMediaPillarJid",value:function(){return this.$log.info("[WebrtcGatewayService] getMyMediaPillarJid : "+this.mediaPillarCallContext.mediaPillarJid),this.mediaPillarCallContext.mediaPillarJid}},{key:"getMyMediaPillarRemoteExtension",value:function(){return this.telephonyService.isSipWise()?this.telephonyService.telephonyServiceSipWise.getDevicesIdFromListSipWiseWithType("webrtc")||"":this.mediaPillarCallContext.remoteExtension}},{key:"shouldUseMediaPillar",value:function(){return this.isMediaPillarAvailable()&&this.IsMediaPillarUserSelected(),void 0!==config.devMediaPillarEnabled&&config.devMediaPillarEnabled,!1}},{key:"isMediaPillarConfigured",value:function(){return this.mediaPillarConfigured&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_WEBRTC_PSTN_CALLING)}},{key:"isMediaPillarAvailable",value:function(){var e=this.isMediaPillarConfigured();return e&&this.mediaPillarAlive}},{key:"IsMediaPillarUserSelected",value:function(){var e;if(this.telephonyService.isSipWise()){var t=this.telephonyService.telephonyServiceSipWise.getCurrentFromDevicesListSipWise();e=t&&"webrtc"===t.type}else e=!this.telephonyService.nomadicObject.makeCallInitiatorIsMain&&this.telephonyService.getNomadicDestination()===this.getMyMediaPillarRemoteExtension();return e}},{key:"isMediaPillarJid",value:function(e){return!!e&&0===e.search("mp_")}},{key:"isMediaPillarCallCase",value:function(){return this.isMediaPillarAvailable()&&this.IsMediaPillarUserSelected()}},{key:"isMediaPillarCallSituation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.isMediaPillarCallCase();if(e)if(e.type===i.Call.Type.WEBRTC)t=t&&this.isMediaPillarJid(e.fullJid);else if(this.telephonyService.getCalls().length<=1&&this.mediaPillarCallContext.telephonyCallRefs.length<=1)switch(e.status){case i.Call.Status.RINGING_INCOMMING:case i.Call.Status.RINGING_OUTGOING:case i.Call.Status.QUEUED_INCOMMING:case i.Call.Status.DIALING:case i.Call.Status.RELEASING:break;default:t=!!e.mediaPillarCall&&t&&this.isInTelCallRefs(e)}else switch(e.status){case i.Call.Status.RINGING_INCOMMING:case i.Call.Status.RINGING_OUTGOING:case i.Call.Status.QUEUED_INCOMMING:case i.Call.Status.DIALING:case i.Call.Status.RELEASING:break;default:t=!!e.mediaPillarCall&&(t=t&&e.mediaPillarCall.telephonyCallRefs.length>=1)&&this.isInTelCallRefs(e)}return t}},{key:"mediaPillaryseTheCall",value:function(e,t){if(this.mediaPillarCallContext.callState!==r.Free){if(e&&this.mediaPillarCallContext.updateContactFlag)return this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall | only Update"),e.setMediaPillarCall(this.getMediaPillarCallContext()),"Update";if(e&&this.mediaPillarCallContext.callState===r.TelCallReleasing&&e.status===i.Call.Status.RINGING_INCOMMING)return this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall |  transfer managed as Update"),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=r.CallOffer,"Update";if(t&&this.mediaPillarCallContext.callState!==r.WaitWebrtc)return this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall | only Ignore"),"Ignore"}var n="";if(!e&&!t)return"NoCallRef";if(e&&t)return"toManyCallRef";if(e){switch(this.mediaPillarCallContext.callState){case r.Free:this.mediaPillarCallContext.callState=r.WaitWebrtc,n="Ok";break;case r.WaitTelephony:this.mediaPillarCallContext.callState=r.CallOffer,n="Ok";break;case r.WaitWebrtc:this.mediaPillarCallContext.telephonyCallRefs.length>1?(this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall but 2nd incomming in WaitWebrtc| only Ignore"),e.setMediaPillarCall(this.getMediaPillarCallContext()),n="Ignore"):this.telephonyService.isSipWise()?this.$log.info("[WebrtcGatewayService] multiple mediaPillaryseTheCall but sipwise case | only Ignore"):(this.mediaPillarCallContext.callState=r.AnomalyCCS,n="Ano_inTel_contextCallState_"+this.mediaPillarCallContext.callState,this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall again in WaitWebrtc"));break;default:this.mediaPillarCallContext.callState=r.AnomalyCCS,n="Ano_inTel_contextCallState_"+this.mediaPillarCallContext.callState}"Ok"===n&&(this.putAsMasterTelCallRefs(e),e.setMediaPillarCall(this.getMediaPillarCallContext()))}else if(t){switch(this.mediaPillarCallContext.webrtcCallRef=t,this.mediaPillarCallContext.callState){case r.Free:this.mediaPillarCallContext.callState=r.WaitTelephony,n="Ok";break;case r.WaitWebrtc:this.mediaPillarCallContext.callState=r.CallOffer,n="Ok";break;default:this.mediaPillarCallContext.callState=r.AnomalyCCS,n="Ano_inWrtc_contextCallState_"+this.mediaPillarCallContext.callState}"Ok"===n&&t.setMediaPillarCall(this.getMediaPillarCallContext())}return n}},{key:"getMediaPillarCallContext",value:function(){return this.mediaPillarCallContext}},{key:"isMediaPillarOutgoingCall",value:function(){var e;switch(this.mediaPillarCallContext.callState){case r.WaitWebrtc:case r.WaitTelephony:case r.CallOffer:case r.CallOnGoing:case r.CallActive:case r.CallActiveNoWebMedia:case r.TelCallReleasing:case r.WebCallReleasing:e=!0;break;default:e=!1}return e&&this.mediaPillarCallContext.isOutgoingCall3PCC}},{key:"isMediaPillarReleasableCall",value:function(){var e;switch(this.mediaPillarCallContext.callState){case r.AnomalyCCS:case r.Unknow:e=!1;break;default:e=!0}return e}},{key:"MediaPillarReleaseWebrtcCall",value:function(){this.mediaPillarCallContext.webrtcCallRef&&(this.mediaPillarCallContext.webrtcCallRef.mediaPillarCall=null,this.videoService.releaseCall(this.mediaPillarCallContext.webrtcCallRef))}},{key:"timeOutCallActiveNoWebMedia",value:function(){this.$log.info("[WebrtcGatewayService] timeOutCallActiveNoWebMedia"),this.mediaPillarCallContext.callState===r.CallActiveNoWebMedia&&(this.MediaPillarCallTerminator(),this.mediaPillarKeepAlive(),this.$log.info("[WebrtcGatewayService] timeOutCallActiveNoWebMedia noWebMedia then release calls if existing & force keepalive"))}},{key:"MediaPillarCallTerminator",value:function(){var e=this;0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs.forEach((function(t){null!==t&&t.type.value===i.Call.Type.PHONE.value&&(t.mediaPillarCall=null,e.telephonyService.releaseCall(t),e.$log.info("[WebrtcGatewayService] MediaPillarCallTerminator | release call"+t))})),this.MediaPillarReleaseWebrtcCall(),this.releaseMediaPillarCallContext(),this.resetEvtAutomaton(),this.TO_PILLAR_POLLING+=3e5,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.$log.warn("[WebrtcGatewayService] MediaPillarCallTerminator | Full cleaning")}},{key:"createMediaPillarContact",value:function(e){this.$log.info("[webrtcGatewayService] createMediaPillarContact -- "+e);var t=this.contactService.createBasicContact(e);return t.displayName="mediaPillar",t.avatar=new Image,t.avatar.src="/resources/skins/rainbow/images/conversations/unknownUser.jpeg",this.xmppService.getResourceFromJid(e)&&this.contactService.createBasicContact(this.xmppService.getBareJidFromJid(e)),t}},{key:"muteAudio",value:function(e,t,n){if(e){if(this.isMediaPillarCallCase()){var r=this.mediaPillarCallContext.webrtcCallRef;if(r){var i=this.xmppService.connection.jingle.sessions[r.id];if(i){i.muteAudio(t),r.isMuted=t,n&&(n.isMutedAudio=t,n.rxSubject.next({name:"callUpdate",value:e})),e.isMuted=t,this.$log.info("[webrtcGatewayService] muteAudio conversation: "+(n?n.id:"undefined")+" / pbxcall: "+e.id+"-- "+(t?"mute":"unumute"));var a={call:e};n&&(a.conversation=n),this.$rootScope.$broadcast("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",a),this.$rootScope.$broadcast("ON_MPMEDIA_CONVERSATION_CALL_UPDATED_EVENT",{call:r})}else this.$log.error("[webrtcGatewayService] muteAudio "+e.id+" -- failure: no session")}}}else this.$log.error("[webrtcGatewayService] muteAudio - trying to mute a non existing call !")}},{key:"getActivePbxCall",value:function(){return this.isMediaPillarCallCase()&&this.mediaPillarCallContext?this.mediaPillarCallContext.telephonyCallRefs.find((function(e){return e.status===i.Call.Status.ACTIVE})):null}},{key:"answerCall",value:function(e){var t=e.getMediaPillarCall();if(t&&t.webrtcCallRef)this.videoService.answerCall(t.webrtcCallRef,"audio"),this.$log.info("[WebrtcGatewayService] -- answerCall -- send webrtc proceed for call : "+e.id);else if(e.status===i.Call.Status.QUEUED_INCOMMING){var n=this;this.telephonyService.answerCall(e).catch((function(){n.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",e)})),this.$log.info("[WebrtcGatewayService] -- answerCall -- "+e.id)}else this.$log.info("[WebrtcGatewayService] -- answerCall -- Anomaly media Pillar : answerAudioAction but no webrtcCallref & no 2nd call")}},{key:"releaseCall",value:function(e){var t=e.getMediaPillarCall();if(t&&t.webrtcCallRef)if(e.type===i.Call.Type.PHONE){this.$log.info("[WebrtcGatewayService] -- releaseCall MP PHONE -- "+e.id),this.isMasterTelCallRefs(e)&&(this.$log.info("[WebrtcGatewayService] -- rejectCall MP webrtc call -- "+t.webrtcCallRef),this.videoService.rejectCall(t.webrtcCallRef));var n=this;this.telephonyService.releaseCall(e).catch((function(){e.setStatus(i.Call.Status.UNKNOWN),n.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",e)}))}else this.$log.info("[WebrtcGatewayService] -- releaseCall MP WEBRTC -- "+e.id),this.videoService.rejectCall(t.webrtcCallRef);else{this.$log.info("[WebrtcGatewayService] releaseCall | Anomaly media Pillar : declineAction but no webrtcCallref for call = "+e.id);var r=this;this.telephonyService.releaseCall(e).catch((function(){e.setStatus(i.Call.Status.UNKNOWN),r.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",e)}))}}},{key:"deflectCallToVm",value:function(e){var t=this;this.telephonyService.deflectCallToVM(e).finally((function(){if(e.type===i.Call.Type.PHONE){var n=e.getMediaPillarCall();n&&n.webrtcCallRef&&t.videoService.rejectCall(n.webrtcCallRef),e.setStatus(i.Call.Status.UNKNOWN),t.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",e)}}))}}]),e}();d.$inject=["$q","$rootScope","$log","$http","$interval","videoService","errorHelperService","telephonyService"],t.WebrtcGatewayService=d,angular.module("rainbow").service("webrtcGatewayService",d)},function(e,t,n){n.r(t);var r=n(23),i=n(24),a=n(0),o=n(5),s=n.n(o),c=n(2),l=n.n(c),u=n(4),d=n.n(u),h=n(6),f=n.n(h),p=n(1),m=n.n(p);angular.module("rainbow").service("videoService",["$q","$rootScope","$window","$log","$http","$interval","browserService","gRTCStatsService","fRTCStatsService","platformService","gaService","VideoServiceEventHandler","extensionSharingService",function(e,t,n,o,c,u,h,p,v,g,y,b,S){var _=this;this.started=!1,this.connected=!1,this.RTC=null,this.videoEventHandler=null,this.config=null,this.companyConfig=null,this.calls={},this.localStream=null,this.autoreleaseTimeout=null,this.callsStats={},this.localStreams=[],this.makingCall=!1,this.reconnectCall=!1,this.statsInterval=null,this.audioProfileChanging=!1,this.reverseAudioCallInitiated=!1,this.alreadyAttaching=!1,this.ttl=0,this.ttlTimeout=null,this.xmppConnectionSubscription=null;var C=[];this.rxSubject=new r.a,this.callsStatsSimplified={},this.allowDesktopSharing=function(){return!1},this.allowAdvancedDesktopSharing=function(){return!1},this.getDesktopSharingSource=function(){return null},this.askToAddSharing=function(e){return!1},this.askToStartSharing=function(e,t){return!1},this.isNativeApplication=function(){return!1},this.subscribe=function(e){return this.rxSubject.subscribe(e)},this.sendEvent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next(i.RBEvent.create(e,t))},this.start=function(n){o.webrtc("[videoService] SERVICE | === STARTING ===");var r=performance.now();if(this.RTC=_.getBrowserMethodHandler(),this.RTC){_.started=!0,_.connected=!0,_.setWebrtcConfiguration();var i=Math.round(performance.now()-r);n.push({service:"videoService",startDuration:i}),o.info("[videoService] SERVICE | === STARTED ("+i+" ms) ===")}else o.error("[videoService] SERVICE | === STARTING FAILURE ===  webRTC capable browser is really required !");return this.xmppConnectionSubscription=d.a.subscribeToConnectionEvents((function(e){_.onConnectionStateChangeEvent(e)})),C.push(t.$on("ON_INPUT_DEVICE_CHANGED_EVENT",_.onAudioProfileChangeEvent)),C.push(t.$on("ON_VIDEO_INPUT_DEVICE_CHANGED_EVENT",_.onVideoInputChangeEvent)),this.attachHandlers(),e.when()},this.stop=function(){try{if(this.started){var t;for(o.webrtc("[videoService] SERVICE | === STOPPING ==="),this.started=!1,this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe();t=C.pop();)t();for(var n in _.removeHandlers(),_.config=null,_.calls)if(_.calls.hasOwnProperty(n)){var r=_.calls[n];_.removeCallObject(r)}d.a.connection.jingle.terminate(),_.connected=!1,_.reconnectCall=!1,_.makingCall=!1,_.statsInterval&&window.clearInterval(_.statsInterval),_.ttlTimeout&&u.cancel(_.ttlTimeout),o.webrtc("SERVICE | === STOPPED ===")}return e.when()}catch(i){return o.webrtc("[videoService] SERVICE | === STOPPING ERROR : "+i),e.when()}},this.attachHandlers=function(){this.removeHandlers(),o.info("[videoService] attachHandlers"),this.videoEventHandler=b.create(this)},this.removeHandlers=function(){o.info("[videoService] removeHandlers"),this.videoEventHandler&&(this.videoEventHandler=null)},this.setIceConfig=function(){return o.webrtc("[videoService] setIceConfig"),e((function(e,t){if(_.config&&0!==_.ttl)return o.webrtc("[videoService] setIceConfig from stored variable"),d.a.connection.jingle.ice_config=_.config,e();_.getIceConfig().then((function(t){_.config=t,"true"===s.a.getSetting("enableDSCP")&&(o.webrtc("[videoService] setWebrtcConfiguration - DSCP is enabled"),_.config.enableDSCP=!0),"true"===s.a.getSetting("dtx")&&(o.webrtc("[videoService] setWebrtcConfiguration - DTX is enabled"),_.config.dtx=!0);var n="true"===s.a.getSetting("simulcast");(n=n||f.a.isFeatureEnabled(f.a.FeaturesEnum.WEBRTC_CONFERENCE_SIMULCAST))&&(o.webrtc("[videoService] setWebrtcConfiguration - Simulcasting is enabled"),_.config.simulcast=!0),"true"===s.a.getSetting("unifiedPlan")&&(o.webrtc("[videoService] setWebrtcConfiguration - unifiedPlan is enabled"),_.config.unifiedPlan=!0),"true"===s.a.getSetting("debugWebRTC")&&(o.webrtc("[videoService] setWebrtcConfiguration - unifiedPlan is enabled"),_.config.debugWeRTC=!0),d.a.connection.jingle.ice_config=_.config,s.a.setIceConfig(_.config),o.webrtc("[videoService] setIceConfig from server success !"),e()})).catch((function(e){o.error("[videoService] setIceConfig from server ERROR : "+e),-1!==e.status&&_.openErrorPopup("IceConfigurationFailed"),t()}))}))},this.setCompanyWebrtcConfig=function(){return o.webrtc("[videoService] setCompanyWebrtcConfig"),e((function(e,t){if(_.companyConfig)return o.webrtc("[videoService] setCompanyWebrtcConfig from stored variable"),d.a.connection.jingle.company_config=_.companyConfig,_.setVideoQualityConfigurationForCompany(),e();_.getCompanyWebrtcConfig().then((function(t){_.companyConfig=t,d.a.connection.jingle.company_config=_.companyConfig,_.setVideoQualityConfigurationForCompany(),o.webrtc("[videoService] setCompanyWebrtcConfig from server success !"),e()})).catch((function(e){o.error("[videoService] setCompanyWebrtcConfig from server ERROR : "+e),t()}))}))},this.setWebrtcConfiguration=function(){return e((function(t){var n=[];n.push(_.setIceConfig()),n.push(_.setCompanyWebrtcConfig()),e.all(n).then((function(){o.webrtc("[videoService] setWebrtcConfiguration -- done"),t()}))}))},this.onConnectionStateChangeEvent=function(e){try{if("ON_XMPP_DISCONNECTED"===e.name){for(var n in o.info("MEDIA   | onConnectionStateChangeEvent : disconnected"),_.connected=!1,_.config=null,_.ttlTimeout&&u.cancel(_.ttlTimeout),_.calls)if(_.calls.hasOwnProperty(n)){var r=_.calls[n];_.reconnectCall=!0,r&&r.status!==a.Call.Status.UNKNOWN&&(o.webrtc("INFO    | onConnectionStateChangeEvent : disconnected -> call goes to connecting state"),r.setStatus(a.Call.Status.CONNECTING),t.$broadcast("ON_CALL_UPDATED_EVENT",r)),_.statsInterval&&window.clearInterval(_.statsInterval)}}else if("ON_XMPP_CONNECTED"===e.name){for(var n in o.info("MEDIA   | onConnectionStateChangeEvent : connected"),_.attachHandlers(),_.setWebrtcConfiguration(),_.connected=!0,_.statsInterval&&(window.clearInterval(_.statsInterval),_.statsinterval=null),_.calls)if(_.calls.hasOwnProperty(n)){r=_.calls[n];var i=d.a.connection.jingle.sessions[r.id];_.reconnectCall&&i&&i.peerconnection&&(o.info("MEDIA   | onConnectionStateChangeEvent : connected - start reconnection on session "+r.id),i.me=m.a.userContact.fullJid,i.isInitiator&&(i.initiator=i.me),i.connection=d.a.connection,m.a.setBusyState("dnd",_.calculatePresenceMessage(r)),i.reconnectSession())}_.reconnectCall=!1}}catch(s){o.info("MEDIA   | onConnectionStateChangeEvent : disconnected error : "+s)}},_.isUserContactInCall=function(){for(var e in _.calls)if(_.calls.hasOwnProperty(e)&&_.calls[e].status!==a.Call.Status.UNKNOWN)return!0;return!1},this.getCurrentActiveCall=function(){for(var e in _.calls)if(_.calls.hasOwnProperty(e)){var t=_.calls[e];if(t.status!==a.Call.Status.UNKNOWN)return t}return null},this.getCurrentActiveSession=function(){for(var e in _.calls)if(_.calls.hasOwnProperty(e)){var t=_.calls[e];if(t.status!==a.Call.Status.UNKNOWN)return d.a.connection.jingle.sessions[t.id]}return null},_.getMediaPillarAudioCall=function(){for(var e in _.calls)if(_.calls.hasOwnProperty(e)){var t=_.calls[e];if(t.status!==a.Call.Status.UNKNOWN&&t.localMedia&a.Call.Media.AUDIO&&t.isMediaPillarCall())return t}return null},_.getWebrtcAudioCall=function(){for(var e in _.calls)if(_.calls.hasOwnProperty(e)){var t=_.calls[e];if(t.status!==a.Call.Status.UNKNOWN&&t.localMedia&a.Call.Media.AUDIO&&!t.isMediaPillarCall())return t}return null},_.getMediaPillarSession=function(){var e=_.getMediaPillarAudioCall();return e?d.a.connection.jingle.sessions[e.id]:null},_.getCurrentSharingCall=function(){for(var e in _.calls)if(_.calls.hasOwnProperty(e)){var t=_.calls[e];if(t.status!==a.Call.Status.UNKNOWN&&(t.localMedia===a.Call.Media.SHARING||t.remoteMedia===a.Call.Media.SHARING))return t}return null},_.endAllCallsForContact=function(e){if(e)for(var t in o.webrtc("[videoService] endAllCallsForContact "+e.jid),_.calls)if(_.calls.hasOwnProperty(t)){var n=_.calls[t];n.status!==a.Call.Status.UNKNOWN&&n.contact&&n.contact.jid===e.jid&&!n.isMediaPillarCall()&&_.releaseCall(n)}},_.onVideoInputChangeEvent=function(){for(var e in o.webrtc("MEDIA   | onVideoInputChangeEvent"),_.calls)if(_.calls.hasOwnProperty(e)){var t=_.calls[e];d.a.connection.jingle.sessions[t.id]&&t.localMedia&&t.localMedia===a.Call.Media.AUDIO+a.Call.Media.VIDEO&&(o.webrtc("MEDIA   | audio + video call, renegotiate the profile"),_.escalateToVideoCall(t,!0))}},_.onAudioProfileChangeEvent=function(){if(o.webrtc("MEDIA   | onAudioProfileChangeEvent"),_.audioProfileChanging)o.webrtc("MEDIA   | onAudioProfileChangeEvent -- already changing");else for(var e in _.calls)if(_.calls.hasOwnProperty(e)){var t=_.calls[e];d.a.connection.jingle.sessions[t.id]&&t.localMedia&&(_.audioProfileChanging=!0,u((function(e){_.audioProfileChanging=!1,_.renegotiateCurrentCall(e)}),500,1,!0,t))}},this.renegotiateCurrentCall=function(e){e.localMedia===a.Call.Media.AUDIO||e.localMedia===a.Call.Media.AUDIO+a.Call.Media.SHARING?(o.webrtc("MEDIA   | renegotiate the audio profile"),_.addAudioToCall(e,!0)):e.localMedia!==a.Call.Media.AUDIO+a.Call.Media.VIDEO&&e.localMedia!==a.Call.Media.AUDIO+a.Call.Media.SHARING+a.Call.Media.VIDEO||(o.webrtc("MEDIA   | audio + video call, renegotiate the profile"),_.addVideoToCall(e,!0))},this.getCallByJid=function(e,t){var n=null;if(!e&&!t)return n;for(var r in o.webrtc("[videoService] getCallByJid "+e),_.calls)if(_.calls.hasOwnProperty(r)&&(i=_.calls[r]).contact&&i.contact.jid===e){n=i;break}if(!n)for(var r in o.webrtc("[videoService] getCallByJid fallback "+t),_.calls){var i;if(_.calls.hasOwnProperty(r)&&(i=_.calls[r])&&i.fullJid===t){n=i;break}}return n},this.resetAudioOutputElement=function(){g.allowDevicesManagement()&&!this.audioProfileChanging&&($("#globalAudioTag").length?(o.webrtc("[videoService] resetAudioOutputElement"),this.audioProfileChanging=!0,g.getCurrentSpeaker().then((function(e){var t="default";e&&e.id&&(t=e.id);var n="default";"default"!==t&&DetectRTC.audioOutputDevices.forEach((function(e){"default"!==e.deviceId&&"communications"!==e.deviceId&&e.deviceId!==t&&(n=e.deviceId)})),$("#globalAudioTag")[0].setSinkId(n).then((function(){o.webrtc("[videoService] resetAudioOutputElement sinkId is "+$("#globalAudioTag")[0].sinkId),"default"!==t?$("#globalAudioTag")[0].setSinkId(t).then((function(){o.webrtc("[videoService] resetAudioOutputElement sinkId is "+$("#globalAudioTag")[0].sinkId),_.audioProfileChanging=!1,$("#globalAudioTag")[0].load&&$("#globalAudioTag")[0].load()})).catch((function(){_.audioProfileChanging=!1})):_.audioProfileChanging=!1})).catch((function(e){o.warn("[videoService] resetAudioOutputElement globalAudioTag error "+e),_.audioProfileChanging=!1})),u((function(){$("#largevideo")[0]&&$("#largevideo")[0].setSinkId(n).then((function(){o.webrtc("[videoService] resetAudioOutputElement largevideo "+$("#largevideo")[0].sinkId),"default"!==t&&$("#largevideo")[0].setSinkId(t).then((function(){o.webrtc("[videoService] resetAudioOutputElement largevideo "+$("#largevideo")[0].sinkId)})).catch((function(e){o.warn("[videoService] resetAudioOutputElement largevideo error "+e)}))})).catch((function(e){o.warn("[videoService] resetAudioOutputElement largevideo error "+e)})),$("#p2pSecondVideo")[0]&&$("#p2pSecondVideo")[0].setSinkId(n).then((function(){"default"!==t&&$("#p2pSecondVideo")[0].setSinkId(t).then((function(){o.webrtc("[videoService] resetAudioOutputElement p2pSecondVideo "+$("#p2pSecondVideo")[0].sinkId)})).catch((function(e){o.warn("[videoService] resetAudioOutputElement p2pSecondVideo error "+e)}))})).catch((function(e){o.warn("[videoService] resetAudioOutputElement p2pSecondVideo error "+e)}))}),3e3,1)})).catch((function(){o.webrtc("[videoService] resetAudioOutputElement getCurrentSpeaker error"),_.audioProfileChanging=!1}))):o.warn("[videoService] resetAudioOutputElement -- missing global audio tag !"))},this.disableStreams=function(e){if(e&&e.length)for(e.forEach((function(e){e.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),e.stop&&e.stop(),e=null}));e.length>0;){e.pop();null}},this.disableAudioVideoMedia=function(e,t){if(e?o.webrtc("MEDIA   | disableAudioVideoMedia for session "+JSON.stringify({sid:e.sid})):t?o.webrtc("MEDIA   | disableAudioVideoMedia no session, sessionId: "+t):o.webrtc("MEDIA   | disableAudioVideoMedia no session, no session Id"),!e&&!t){var n=_.localStreams.length;if(_.localStreams.length>0)for(_.localStreams.forEach((function(e){e.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),e.stop&&e.stop(),e=null}));_.localStreams.length>0;)_.localStreams.pop();o.webrtc("MEDIA   | disableAudioVideoMedia : All local streams stopped and removed: "+n)}if(e){if(e.localStreams.length>0){var r=e.localStreams.length;for(e.localStreams.forEach((function(e){e.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),e.stop&&e.stop(),e=null})),_.localStreams=_.localStreams.filter((function(t){return!e.localStreams.includes(t)}));e.localStreams.length>0;)e.localStreams.pop();o.webrtc("MEDIA   | disableAudioVideoMedia : Session streams stopped and removed: "+r+". Remaining local streams: "+_.localStreams.length)}}else if(t){var i=_.localStreams.filter((function(e){return e.callId===t}));i&&(r=i.length,i.forEach((function(e){e.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),e.stop&&e.stop(),_.localStreams.splice(_.localStreams.indexOf(e),1),e=null})),o.webrtc("MEDIA   | disableAudioVideoMedia : Locals streams for sessionId "+t+" stopped and removed: "+r+". Remaining local streams: "+_.localStreams.length))}_.statsInterval&&(window.clearInterval(_.statsInterval),_.statsinterval=null)},this.clearSrcObjectsFromElements=function(){this.RTC.clearMediaStream(angular.element("#largevideo"),null),this.RTC.clearMediaStream(angular.element("#globalVideoTag"),null),this.RTC.clearMediaStream(angular.element("#globalAudioTag"),null)},this.attachDistantMediaStreamsUnifiedPlan=function(e){var t=d.a.connection.jingle.sessions[e.id];t?(t.remoteStreamsObject[0]&&(o.webrtc("attachDistantMediaStreamsUnifiedPlan audio track for element globalAudioTag "+t.remoteStreamsObject[0].id),this.RTC.attachMediaStream(angular.element("#globalAudioTag"),t.remoteStreamsObject[0])),t.remoteStreamsObject[1]&&t.remoteStreamsObject[2]?(this.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),t.remoteStreamsObject[2],t.remoteStreamsObject[2].id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0),this.RTC.attachMediaStreamIfNeeded(angular.element("#p2pSecondVideo"),t.remoteStreamsObject[1],t.remoteStreamsObject[1].id),angular.element("#p2pSecondVideo")[0]&&(angular.element("#p2pSecondVideo")[0].muted=!0,angular.element("#p2pSecondVideo")[0].volume=0)):t.remoteStreamsObject[1]?(this.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),t.remoteStreamsObject[1],t.remoteStreamsObject[1].id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0)):t.remoteStreamsObject[2]&&(this.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),t.remoteStreamsObject[2],t.remoteStreamsObject[2].id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0))):o.warn("[videoService] attachDistantMediaStreamsUnifiedPlan -- missing session "+e.id)},this.attachDistantMediaStreams=function(e,t){if(e){if(_.alreadyAttaching)return;if(_.alreadyAttaching=!0,t.unifiedPlanActivated)return _.attachDistantMediaStreamsUnifiedPlan(t),void(_.alreadyAttaching=!1);var n=d.a.connection.jingle.sessions[t.id];if(null==n)return void(_.alreadyAttaching=!1);if(n.remoteStreams){var r,i;if(n.remoteStreams.length>1)n.remoteStreams[0].getAudioTracks().length?(i=n.remoteStreams[0],r=n.remoteStreams[1]):(r=n.remoteStreams[0],i=n.remoteStreams[1]),r.getVideoTracks().length>0&&(o.webrtc("attachDistantMediaStreams video track for element largevideo "+r.id),_.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),r,r.id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0)),r.getAudioTracks().length>0&&(o.webrtc("attachDistantMediaStreams audio track for element globalAudioTag "+r.id),_.RTC.attachMediaStream(angular.element("#globalAudioTag"),r)),i.getVideoTracks().length>0&&(o.webrtc("attachDistantMediaStreams video track for element p2pSecondVideo "+i.id),_.RTC.attachMediaStreamIfNeeded(angular.element("#p2pSecondVideo"),i,i.id),angular.element("#p2pSecondVideo")[0]&&(angular.element("#p2pSecondVideo")[0].muted=!0,angular.element("#p2pSecondVideo")[0].volume=0)),i.getAudioTracks().length>0&&(o.webrtc("attachDistantMediaStreams audio track for element globalAudioTag "+i.id),_.RTC.attachMediaStream(angular.element("#globalAudioTag"),i));else n.remoteStreams.forEach((function(e){e.getVideoTracks().length>0&&(o.webrtc("attachDistantMediaStreams video track"),_.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),e,e.id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0),_.RTC.attachMediaStreamIfNeeded(angular.element("#p2pSecondVideo"),e,e.id),angular.element("#p2pSecondVideo")[0]&&(angular.element("#p2pSecondVideo")[0].muted=!0,angular.element("#p2pSecondVideo")[0].volume=0)),e.getAudioTracks().length>0&&(o.webrtc("attachDistantMediaStreams audio track"),_.RTC.attachMediaStream(angular.element("#globalAudioTag"),e))}));_.alreadyAttaching=!1}}else _.isUserContactInCall()||(this.RTC.clearMediaStream(angular.element("#largevideo"),null),this.RTC.clearMediaStream(angular.element("#globalVideoTag"),null),this.RTC.clearMediaStream(angular.element("#globalAudioTag"),null))},this.attachLocalVideoOnlyStreamToElement=function(e,t){o.webrtc("attachLocalVideoOnlyStreamToElement "+e),e?(this.localStreams&&this.localStreams.length&&this.localStreams.forEach((function(e){e.getVideoTracks().length&&e.getAudioTracks().length||e.getVideoTracks().length&&_.RTC.attachMediaStreamIfNeeded(t,e,e.id)})),t[0]&&(t[0].volume=0)):this.RTC.clearMediaStream(t,null)},this.attachLocalAudioVideoStreamToElement=function(e,t){o.webrtc("attachLocalAudioVideoStreamToElement "+e),e?(this.localStreams&&this.localStreams.length&&this.localStreams.forEach((function(e){e.getVideoTracks().length&&e.getAudioTracks().length&&_.RTC.attachMediaStreamIfNeeded(t,e,e.id)})),t[0]&&(t[0].volume=0)):this.RTC.clearMediaStream(t,null)},this.attachLocalMediaStreams=function(e){if(o.webrtc("attachLocalMediaStreams "+e),e){if(this.localStreams&&this.localStreams.length){var t=!1;this.localStreams.forEach((function(e){e.getVideoTracks().length&&e.getAudioTracks().length?(t?_.RTC.attachMediaStreamIfNeeded($("#minivideo2"),e,e.id):(t=!0,_.RTC.attachMediaStreamIfNeeded($("#minivideo"),e,e.id)),_.RTC.attachMediaStreamIfNeeded($("#callVideoPip"),e,e.id)):e.getVideoTracks().length&&(t?_.RTC.attachMediaStreamIfNeeded($("#minivideo2"),e,e.id):(t=!0,_.RTC.attachMediaStreamIfNeeded($("#minivideo"),e,e.id)),_.RTC.attachMediaStreamIfNeeded($("#callSharingPip"),e,e.id))}))}$("#callVideoPip")[0]&&($("#callVideoPip")[0].volume=0),$("#minivideo")[0]&&($("#minivideo")[0].volume=0),$("#minivideo2")[0]&&($("#minivideo2")[0].volume=0),$("#callSharingPip")[0]&&($("#callSharingPip")[0].volume=0)}else this.RTC.clearMediaStream($("#minivideo"),null),this.RTC.clearMediaStream($("#minivideo2"),null),this.RTC.clearMediaStream($("#callVideoPip"),null),this.RTC.clearMediaStream($("#callSharingPip"),null)},this.removeConferencePip=function(){return this.RTC.clearMediaStream($("#conferenceSharingPip"),null),this.RTC.clearMediaStream($("#conferenceVideoPip"),null),!0},this.pushInLocalStreams=function(e,t){e.callId=t,_.localStreams.push(e)},this.openErrorPopup=function(e){e||(e="cameraNotAvailable"),t.$broadcast("ON_WEBRTC_CALL_ERROR_EVENT",e)},this.openCalendarBusyPopup=function(e){t.$broadcast("ON_WEBRTC_CALENDAR_BUSY_EVENT",e)},this.makeVideoCall=function(e){_.makeCall(e,"videoOnly")},this.makeCall=function(e,t,n){o.webrtc("MEDIA   | makeCall to "+JSON.stringify({displayName:e.nameForLog,resources:e.resources})),_.makingCall?o.info("MEDIA   | makeCall already making a call !"):(_.makingCall=!0,this.videoEventHandler.sendProposition(e,t,n))},this.makeJingleCall=function(e,n,r){o.webrtc("MEDIA   | makeJingleCall"),_.setWebrtcConfiguration().then((function(){var i="";e.localMedia&a.Call.Media.AUDIO&&(i="audio"),e.localMedia&a.Call.Media.VIDEO&&(i=i?"audio+video":"video"),n&&""!==n&&o.webrtc("MEDIA   | makeJingleCall in mediaPillar case for number : "+r),n&&""!==n&&r&&""!==r?(i="sip",d.a.connection.jingle.initiate(n,d.a.connection.jid,i,_.localStreams,e.id,null,r)):d.a.connection.jingle.initiate(e.fullJid,d.a.connection.jid,i,_.localStreams,e.id,null,null,e.unifiedPlanActivated),e.status=a.Call.Status.CONNECTING,t.$broadcast("ON_CALL_UPDATED_EVENT",e)})).catch((function(t){o.webrtc("MEDIA   | makeCall failure : "+JSON.stringify({error:t.message})),_.makingCall=!1,e&&_.removeCallObject(e),_.resetToSafeState()}))},this.makeJingleSharingCall=function(e){o.webrtc("MEDIA   | makeJingleSharingCall - make desktop sharing call");var n="sharing";e.localMedia===a.Call.Media.SHARING&&(n="sharing-only"),_.setWebrtcConfiguration().then((function(){o.webrtc("SHARING | getUserMedia success");var r=_.getMediaPillarSession(),i=r?_.localStreams.filter((function(e){return!(r.localStreams&&r.localStreams.includes(e))})):_.localStreams;d.a.connection.jingle.initiate(e.fullJid,d.a.connection.jid,n,i,e.id,null,null,e.unifiedPlanActivated),e.status=a.Call.Status.CONNECTING,t.$broadcast("ON_CALL_UPDATED_EVENT",e)})).catch((function(t){_.makingCall=!1,e&&_.removeCallObject(e),_.resetToSafeState(),o.webrtc("MEDIA   | makeJingleSharingCall failure : "+JSON.stringify({error:t.message}))}))},this.startDesktopSharing=function(e,t){_.makingCall?o.info("MEDIA   | startDesktopSharing already making a call !"):(_.makingCall=!0,!_.askToStartSharing(e.jid,t)&&_.makeDesktopSharingCall(e,t))},this.startSharingCancelled=function(){_.makingCall=!1},this.makeDesktopSharingCall=function(e,t){t||(t="sharing"),_.makingCall=!0,o.webrtc("MEDIA   | makeDesktopSharingCall - trying to start a desktop sharing call with media "+t),this.videoEventHandler.sendProposition(e,t),this.sendEvent("startHighlighting")},this.answerJingleCall=function(e){o.webrtc("MEDIA   | answerJingleCall "+e.id);var n=[],r="audio";e.localMedia&a.Call.Media.AUDIO&&n.push("audio"),e.localMedia&a.Call.Media.VIDEO&&(n.push("video"),r="audio+video"),e.localMedia===a.Call.Media.VIDEO&&(r="video");var i={};e.isInConversationWithMobile()&&(i=_.getMobileMediaConstraints("video")),_.setWebrtcConfiguration().then((function(){_.getBrowserMedia(n,i.fixedVideoWidth,i.fixedVideoHeight,i.fixedFrameRate).then((function(n){var i=d.a.connection.jingle.sessions[e.id];n?(_.pushInLocalStreams(n,e.id),i.addStream(_.localStreams[0]),i.localStreams.push(_.localStreams[0])):r=null,i.localType=r,i.sendAnswer(),i.accept(),t.$broadcast("ON_CALL_UPDATED_EVENT",e)})).catch((function(t){o.webrtc("MEDIA   | answerJingleCall failure for : "+e+" failure : "+t.message),-1!==t.toString().indexOf("getUserMedia")&&(_.releaseCall(e),_.openErrorPopup()),_.resetToSafeState()}))}))},this.answerCall=function(e,t){this.videoEventHandler.acceptProposition(e,t)},this.rejectCall=function(e,t){e?(_.makingCall=!1,_.autoreleaseTimeout&&u.cancel(_.autoreleaseTimeout),d.a.connection.jingle.sessions[e.id]?_.releaseCall(e):e.isInitiator?this.videoEventHandler.retractProposition(e):this.videoEventHandler.rejectProposition(e,t)):o.webrtc("MEDIA   | rejectCall - trying to rejectCall a non existing call !")},this.onCallTransferredToConference=function(e){var t=d.a.connection.jingle.sessions[e.id];this.disableAudioVideoMedia(t),this.autoreleaseTimeout&&u.cancel(this.autoreleaseTimeout),this.createOrUpdateStatisticsForCall(e.id),this.callsStats[e.id]&&delete this.callsStats[e.id],this.callsStatsSimplified[e.id]&&delete this.callsStatsSimplified[e.id],this.removeCallObject(e),this.displayWebRTCStats(e.id)},this.releaseCall=function(e,t,n){e?(_.makingCall=!1,this.execute("releaseCall",(function(){o.webrtc("MEDIA   | releaseCall : "+e);try{var r=d.a.connection.jingle.sessions[e.id];_.disableAudioVideoMedia(r),m.a.resetBusyState(),_.autoreleaseTimeout&&u.cancel(_.autoreleaseTimeout),_.createOrUpdateStatisticsForCall(e.id),_.callsStats[e.id]&&delete _.callsStats[e.id],_.callsStatsSimplified[e.id]&&delete _.callsStatsSimplified[e.id],_.removeCallObject(e,t,n),_.displayWebRTCStats(e.id),_.isUserContactInCall()||_.clearSrcObjectsFromElements()}catch(i){o.webrtc("MEDIA   | releaseCall ERROR"),o.error(i),_.createOrUpdateStatisticsForCall(e.id),_.callsStats[e.id]&&delete _.callsStats[e.id],_.callsStatsSimplified[e.id]&&delete _.callsStatsSimplified[e.id],_.resetToSafeState(),_.displayWebRTCStats(e.id),_.removeCallObject(e)}}))):o.webrtc("MEDIA   | releaseCall - trying to release a non existing call !")},this.askToAddDesktopSharing=function(e){o.webrtc("MEDIA   | askToAddDesktopSharing - Desktop sharing escalation"),!_.askToAddSharing(e.id)&&_.addSharingToCall(e.videoCall)},this.addAudioToCall=function(e,t){o.webrtc("MEDIA   | addAudioToCall");var n=d.a.connection.jingle.sessions[e.id];n.isRenegotiating=!0,this.getBrowserMedia(["audio"]).then((function(r){_.stopActiveAudioVideoStreams(n),_.pushInLocalStreams(r,e.id);for(var i=0;i<_.localStreams.length;i++)n.removeStream(_.localStreams[i]);var a=t?"contentModify":"contentAdd";_.updateCurrentCall(e,n,"audio",a)})).catch((function(t){o.webrtc("MEDIA   | addAudioToCall failure : "+t),_.releaseCall(e),_.resetToSafeState()}))},this.addSharingToCall=function(e){o.webrtc("MEDIA   | addSharingToCall - Desktop sharing escalation");var t=d.a.connection.jingle.sessions[e.id];t.isRenegotiating=!0;var n={};e.isInConversationWithMobile()&&(n=_.getMobileMediaConstraints("sharing")),this.getBrowserMedia(["sharing"],null,null,n.fixedFrameRate,e).then((function(n){for(var r=0;r<_.localStreams.length;r++)t.removeStream(_.localStreams[r]),t.localStreams[r]=null;for(t.localStreams=[],_.pushInLocalStreams(n,e.id),r=0;r<_.localStreams.length;r++)t.removeStream(_.localStreams[r]);_.updateCurrentCall(e,t,"sharing","contentAdd"),_.sendEvent("startHighlighting")})).catch((function(e){o.webrtc("MEDIA   | addSharingToCall failure : "+e),t.isRenegotiating=!1,-1!==e.toString().indexOf("getUserMedia")&&_.openErrorPopup()}))},this.addVideoToCall=function(e,t){o.webrtc("MEDIA   | addVideoToCall");var n=d.a.connection.jingle.sessions[e.id];n.isRenegotiating=!0;var r={};e.isInConversationWithMobile()&&(r=_.getMobileMediaConstraints("video")),_.getBrowserMedia(["audio","video"],r.fixedVideoWidth,r.fixedVideoHeight,r.fixedFrameRate).then((function(r){_.stopActiveAudioVideoStreams(n),_.pushInLocalStreams(r,e.id);for(var i=0;i<_.localStreams.length;i++)n.removeStream(_.localStreams[i]);var a=t?"contentModify":"contentAdd";_.updateCurrentCall(e,n,"video",a),n.muteAudio(e.isMuted)})).catch((function(t){o.webrtc("MEDIA   | addVideoToCall failure for : "+e+" failure : "+t.message),-1!==t.toString().indexOf("getUserMedia")?(o.info("addVideoToCall impossible, no webcam plugged"),_.openErrorPopup()):(_.releaseCall(e),_.resetToSafeState())}))},this.removeSharingFromCall=function(e){o.webrtc("MEDIA   | removeSharingFromCall");var t=d.a.connection.jingle.sessions[e.id];this.stopActiveSharingStream(t),t.isRenegotiating=!0,_.updateCurrentCall(e,t,"sharing","contentRemove"),_.sendEvent("stopHighlighting")},this.removeVideoFromCall=function(e){o.webrtc("MEDIA   | removeVideoFromCall"),this.reverseAudioCallInitiated=!0;var t=d.a.connection.jingle.sessions[e.id];this.stopActiveAudioVideoStreams(t),this.localStreams.forEach((function(e){t.removeStream(e)})),t.isRenegotiating=!0,_.getBrowserMedia(["audio"]).then((function(n){_.pushInLocalStreams(n,e.id),_.updateCurrentCall(e,t,"video","contentRemove"),t.muteAudio(e.isMuted)})).catch((function(t){o.webrtc("MEDIA   | removeVideoFromCall failure for : "+e+" failure : "+t),-1!==t.toString().indexOf("getUserMedia")&&_.openErrorPopup(),_.releaseCall(e),_.resetToSafeState()}))},this.calculatePresenceMessage=function(e){var t="audio";return e&&e.localMedia&a.Call.Media.VIDEO&&(t="video"),e&&e.remoteMedia&a.Call.Media.VIDEO&&(t="video"),e&&e.localMedia&a.Call.Media.SHARING&&(t="sharing"),t},this.calculateAudioState=function(e){var t=0;return e.availableIncomingAudioBandwidth&&(t=e.availableIncomingAudioBandwidth<15&&e.availableIncomingAudioBandwidth>0?1:e.availableIncomingAudioBandwidth>=15&&e.availableIncomingAudioBandwidth<30?2:3),t},this.calculateVideoState=function(e){var t=0;return e.availableIncomingVideoBandwidth&&(t=e.availableIncomingVideoBandwidth<300?1:e.availableIncomingVideoBandwidth>=300&&e.availableIncomingVideoBandwidth<500?2:3),t},this.execute=function(e,t,n){this.started||"releaseCall"===e?t(n):o.webrtc("MEDIA   | "+e+" failure : videoService is not started")},this.getOrCreateCallByCallId=function(e){var t=_.calls[e];if(!t){var n=d.a.connection.jingle.sessions[e],r=d.a.getBareJidFromJid(n.peerjid),i=m.a.getContactByJid(r);t=a.Call.create(a.Call.Status.UNKNOWN,e,a.Call.Type.WEBRTC,i),_.calls[t.id]=t}return t},this.getCallByContact=function(e){for(var t in this.calls)if(this.calls.hasOwnProperty(t)){var n=_.calls[t];if(n.contact&&e.jid===n.contact.jid)return n}return null},this.removeCallObject=function(e,n,r){try{if(e){o.debug("removeCallObject Call id: "+e.id),e.status=a.Call.Status.UNKNOWN,e.stopDuration();var i=d.a.connection.jingle.sessions?d.a.connection.jingle.sessions[e.id]:null;_.disableAudioVideoMedia(i,e.id),delete _.calls[e.id],t.$broadcast("ON_CALL_UPDATED_EVENT",e),i&&d.a.connection.jingle.terminate(e.id,n,r),_.sendEvent("stopHighlighting")}}catch(s){o.error("removeCallObject error "+s)}},this.updateRemoteTypeMedia=function(e,t){switch(e){case"audio":t.remoteMedia=a.Call.Media.AUDIO;break;case"video":t.remoteMedia=a.Call.Media.VIDEO;break;case"audio+video":t.remoteMedia=a.Call.Media.AUDIO|a.Call.Media.VIDEO;break;case"sharing":t.remoteMedia=a.Call.Media.SHARING|a.Call.Media.AUDIO;break;case"sharing-only":t.remoteMedia=a.Call.Media.SHARING;break;default:t.remoteMedia=null}o.debug("REMOTE TYPE || REMOTE MEDIA  "+t.remoteMedia)},this.checkStreamAndStatus=function(e,t){return e&&(0===e.getAudioTracks().length&&0===e.getVideoTracks().length||!1===e.active)?(_.openErrorPopup(),!1):!(t.capabilities&&!t.capabilities.webRTC)||(o.webrtc("MEDIA   | initSharedDesktop failure : remote contact is no more available"),e.stop&&e.stop(),_.openErrorPopup("remoteUserNoMoreAvailable"),!1)},this.displayWebRTCStats=function(e){try{var t=null,n=0;if(p.hasStatsForCall(e)){if(o.webrtc("STATS   | Bundle policy used: "+p.getBundlePolicyForCall(e)),0===(t=p.getStreamsDetailsFromCall(e)).length)o.webrtc("STATS   | No channel information available for call "+e);else for(n=0;n<t.length;n++)o.webrtc("STATS   | "+t[n].id+": "+JSON.stringify(t[n].streams));var r=p.getCodecDetailsFromCall(e);o.webrtc("STATS   | codecs used: "+JSON.stringify(r)),y.trackCodecsUsed(r.codec.audio,r.codec.video)}else if(v.hasStatsForCall(e))if(o.webrtc("STATS   | Bundle policy used: "+v.getBundlePolicyForCall(e)),0===(t=v.getStreamsDetailsFromCall(e)).length)o.webrtc("STATS   | No channel information available for call "+e);else for(n=0;n<t.length;n++)o.webrtc("STATS   | "+t[n].id+": "+JSON.stringify(t[n].streams))}catch(i){o.error("[videoService] displayWebRTCStats error : "+i)}},this.muteAudio=function(e,n){var r=e.videoCall;if(r){o.webrtc("MEDIA   | mute audio: "+r+" | state: "+n),e.isMutedAudio=n,r.isMuted=n;var i=d.a.connection.jingle.sessions[r.id];i?(i.muteAudio(n),t.$broadcast("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",{conversation:e,call:r})):o.webrtc("MEDIA   | muteAudio - trying to mute a non existing session !")}else o.webrtc("MEDIA   | muteAudio - trying to mute a non existing call !")},this.referTo=function(e,t,n){e?e.sendRefer(t,n):o.webrtc("MEDIA   | referTo - trying to transfer a non existing session !")},this.sendReferStatus=function(e,t){var n=d.a.connection.jingle.sessions[e];n?(o.webrtc("MEDIA   | sendReferStatus - "+t),n.sendReferStatus(t)):o.webrtc("MEDIA   | sendReferStatus - trying to transfer a non existing session !")},this.muteVideo=function(e,n){var r=e.videoCall;if(r){o.webrtc("MEDIA   | muteVideo: "+r);var i=d.a.connection.jingle.sessions[r.id];i&&(i.muteVideo(n),i.sendMute(n)),t.$broadcast("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",{conversation:e,call:r})}else o.webrtc("MEDIA   | muteVideo - trying to mute a non existing call !")},this.stopActiveSharingStream=function(e){if(_.localStreams.length>0){_.localStreams.forEach((function(e){e.getVideoTracks().length&&!e.getAudioTracks().length&&(e.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),e.stop&&e.stop(),e=null)}));for(var t=0;t<_.localStreams.length;t++)if(_.localStreams[t]&&!_.localStreams[t].getAudioTracks().length&&_.localStreams[t].getVideoTracks().length){_.localStreams.splice(t,1);null}}e&&e.localStreams&&(e.localStreams.forEach((function(t){t.getVideoTracks().length&&!t.getAudioTracks().length&&(t.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),t.stop&&t.stop()),e.removeStream(t)})),e.localStreams=[]),e&&d.a.connection.jingle.localStream&&e.removeStream(d.a.connection.jingle.localStream)},this.stopAllActiveStreams=function(e){this.stopActiveAudioVideoStreams(e,!0)},this.stopActiveAudioVideoStreams=function(e,t){if(_.localStreams.length>0)if(_.localStreams.forEach((function(e){(e.getAudioTracks().length||t)&&(e.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),e.stop&&e.stop(),e=null)})),t)for(;_.localStreams.length;)_.localStreams.pop();else for(var n=0;n<_.localStreams.length;n++)_.localStreams[n]&&_.localStreams[n].getAudioTracks().length&&_.localStreams.splice(n,1);if(e&&e.localStreams){if(e.localStreams.forEach((function(n){(n.getAudioTracks().length||t)&&(n.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),n.stop&&n.stop(),e.removeStream(n))})),t)for(;e.localStreams.length;)e.localStreams.pop();e.localStreams=[]}e&&d.a.connection.jingle.localStream&&e.removeStream(d.a.connection.jingle.localStream)},this.resetToSafeState=function(){o.webrtc("MEDIA   | resetToSafeState"),_.autoreleaseTimeout&&u.cancel(_.autoreleaseTimeout),(_.localStream||_.localStreams.length)&&_.disableAudioVideoMedia(),m.a.resetBusyState()},this.vidRes={1080:[1920,1080],720:[1280,720],360:[640,360],180:[320,180],960:[960,720],640:[640,480],320:[320,240]},this.getMobileMediaConstraints=function(e){return this.mobileVideoQualityConfiguration[e]},this.setVideoQualityConfigurationForCompany=function(){this.companyConfig&&this.companyConfig.video&&(this.videoQualityConfiguration.video.fixedVideoHeight=this.companyConfig.video.height?this.companyConfig.video.height.ideal:this.videoQualityConfiguration.video.fixedVideoHeight,this.videoQualityConfiguration.video.fixedVideoWidth=this.companyConfig.video.width?this.companyConfig.video.width:this.videoQualityConfiguration.video.fixedVideoWidth,this.videoQualityConfiguration.video.fixedFrameRate=this.companyConfig.video.frameRate?this.companyConfig.video.frameRate:this.videoQualityConfiguration.video.fixedFrameRate)},this.videoQualityConfiguration={video:{fixedFrameRate:30,fixedVideoWidth:1280,fixedVideoHeight:720},sharing:{fixedFrameRate:10,fixedVideoWidth:1280,fixedVideoHeight:720}},this.mobileVideoQualityConfiguration={video:{fixedFrameRate:20,fixedVideoWidth:640,fixedVideoHeight:480},sharing:{fixedFrameRate:10,fixedVideoWidth:640,fixedVideoHeight:480}},this.minFirefoxWebRTCVersion=45,this.minChromeWebRTCVersion=42,this.minEdgeWebRTCVersion=25,this.firefoxPreferedSharing="screen",this.getBrowserMedia=function(n,r,i,a,s){return n&&0!==n.length?new Promise((function(c,l){var u=e.defer(),d=!1,h={audio:!1,video:!1},f=r||_.videoQualityConfiguration.video.fixedVideoWidth,p=i||_.videoQualityConfiguration.video.fixedVideoHeight,m=[];if(g.allowDevicesManagement()){if(n.indexOf("audio")>=0){var v=e.defer();g.getCurrentMicrophone().then((function(e){h.audio=!e||{optional:[{sourceId:e.id},{googEchoCancellation:!0},{autoGainControl:!0},{noiseSuppression:!0},{googHighpassFilter:!0},{googAudioMirroring:!0}]},v.resolve(h);var t="default";e&&(t="id - "+e.id+" and label "+e.label),o.info("[VideoService] GetUserMedia for microphone "+t)})),m.push(v.promise)}if(n.indexOf("video")>=0){var b=a||_.videoQualityConfiguration.video.fixedFrameRate,C=e.defer();g.getCurrentCamera().then((function(e){e&&"default"!==e.id?h.video={width:f,height:p,frameRate:b,deviceId:{exact:e.id}}:h.video={width:f,height:p,frameRate:b},C.resolve(h);var t="default";e&&(t="id - "+e.id+" and label "+e.label),o.info("[VideoService] GetUserMedia for camera "+t)})),m.push(C.promise)}}else n.indexOf("audio")>=0&&(h.audio={optional:[{googEchoCancellation:!0},{autoGainControl:!0},{noiseSuppression:!0},{googHighpassFilter:!0},{googAudioMirroring:!0}]}),n.indexOf("video")>=0&&(h.video={width:f,height:p});if(n.indexOf("sharing")>=0){b=a||_.videoQualityConfiguration.sharing.fixedFrameRate,f=r||_.videoQualityConfiguration.sharing.fixedVideoWidth,p=i||_.videoQualityConfiguration.sharing.fixedVideoHeight;var w=!0;if(S.extensionFound)h.video={mandatory:{chromeMediaSource:"desktop",maxFrameRate:b}},m.push(S.getStreamToShareFromExtension(h));else if(_.isNativeApplication()||"chrome"!==adapter.default.browserDetails.browser)if("firefox"===adapter.default.browserDetails.browser)h.video={mediaSource:_.firefoxPreferedSharing};else{var E=_.getDesktopSharingSource(),T=E&&E.chromeMediaSource?E.chromeMediaSource:"desktop",k=E&&E.chromeMediaSourceId?E.chromeMediaSourceId:null;k&&(w=-1!==k.indexOf("screen")),h.video={mandatory:{chromeMediaSource:T,maxFrameRate:b}},k&&(h.video.mandatory.chromeMediaSourceId=k)}else d=!0,h={},h={video:{chromeMediaSource:"desktop",frameRate:b}}}s&&(s.isSharingScreen=w),e.all(m).then((function(){u.resolve(h)})).catch((function(){u.resolve()})),u.promise.then((function(e){if(o.info("[VideoService] GetUserMedia with constraint "+JSON.stringify(e)),e)try{d?navigator.mediaDevices.getDisplayMedia(e).then((function(e){o.webrtc("MEDIA   | getDisplayMedia success"),e.getVideoTracks().length&&o.info("[videoService] getDisplayMedia video stream kind "+e.getVideoTracks()[0].kind+", id "+e.getVideoTracks()[0].id+", label "+e.getVideoTracks()[0].label+", readyState "+e.getVideoTracks()[0].readyState+", enabled "+e.getVideoTracks()[0].enabled),e&&(0===e.getAudioTracks().length&&0===e.getVideoTracks().length||!1===e.active)&&(o.webrtc("Stream has no active audio or video tracks"),y.trackGetUserMediaErrorNoTrack(),l(new Error("getDisplayMedia failure : Stream has no active audio or video tracks"))),e.getVideoTracks()[0].onended=function(){o.info("Stop screensharing in chrome has been triggered"),t.$broadcast("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED")},c(e),y.trackGetUserMediaSuccess()})).catch((function(e){o.webrtc("MEDIA   | getDisplayMedia failure: "+e),y.trackGetUserMediaError(),t.$broadcast("ON_WEBRTC_GETUSERMEDIA_ERROR",e),l(new Error("getDisplayMedia failure "+e))})):navigator.mediaDevices.getUserMedia(e).then((function(e){o.webrtc("MEDIA   | getUserMedia success"),e.getAudioTracks().length&&o.info("[videoService] getUserMedia audio stream kind "+e.getAudioTracks()[0].kind+", id "+e.getAudioTracks()[0].id+", label "+e.getAudioTracks()[0].label+", readyState "+e.getAudioTracks()[0].readyState+", enabled "+e.getAudioTracks()[0].enabled),e.getVideoTracks().length&&o.info("[videoService] getUserMedia video stream kind "+e.getVideoTracks()[0].kind+", id "+e.getVideoTracks()[0].id+", label "+e.getVideoTracks()[0].label+", readyState "+e.getVideoTracks()[0].readyState+", enabled "+e.getVideoTracks()[0].enabled),e&&(0===e.getAudioTracks().length&&0===e.getVideoTracks().length||!1===e.active)&&(o.webrtc("Stream has no active audio or video tracks"),y.trackGetUserMediaErrorNoTrack(),l(new Error("getUserMedia failure : Stream has no active audio or video tracks"))),S.extensionFound&&n.indexOf("sharing")>=0&&(e.getVideoTracks()[0].onended=function(){o.info("Stop screensharing in chrome has been triggered"),t.$broadcast("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED")}),e&&e.getAudioTracks().length&&(e.getAudioTracks()[0].onended=function(e){o.error("[videoService] getUserMedia -- audio stream track ended"),console.log(this),console.log(e)}),c(e),y.trackGetUserMediaSuccess()})).catch((function(e){o.webrtc("MEDIA   | getUserMedia failure: "+e),y.trackGetUserMediaError(),t.$broadcast("ON_WEBRTC_GETUSERMEDIA_ERROR",e),l(new Error("getUserMedia failure "+e))}))}catch(r){o.webrtc("MEDIA   | getUserMedia failure: "+r),y.trackGetUserMediaError(),l(new Error("getUserMedia failure "+r))}else l({message:"getUserMedia cancelled"})}))})):e.when()},this.getBrowserMethodHandler=function(){var e="",t=null;if(navigator.mozGetUserMedia&&n.mozRTCPeerConnection){if(e=h.extractBrowserVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),o.webrtc("BROWSER | Detect Firefox navigator (version "+e+")"),e<this.minFirefoxWebRTCVersion)return o.webrtc("BROWSER | Firefox navigator is not WebRTC capable before version "+this.minFirefoxWebRTCVersion),t;t={browser:"firefox",attachMediaStream:function(e,t){e&&e[0]&&(e[0].mozSrcObject=t,e[0].srcObject=t,e[0].play())},pc_constraints:{},clearMediaStream:function(e){try{angular.isDefined(e[0])&&(e[0].pause(),e[0].mozSrcObject=null,e[0].srcObject=null,e[0].uniqueId=null)}catch(t){o.webrtc("BROWSER | clearMediaStream failure "+t)}},attachMediaStreamIfNeeded:function(e,t,n){o.webrtc("BROWSER | attachMediaStreamIfNeeded for ID "+n),e&&e[0]&&(e[0].uniqueId!==n||!e[0].mozSrcObject&&!e[0].srcObject)&&(e[0].uniqueId=n,_.RTC.attachMediaStream(e,t))}}}else if(navigator.webkitGetUserMedia&&n.webkitRTCPeerConnection){if(e=h.extractBrowserVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),o.webrtc("BROWSER | Detect Chrome navigator (version "+e+")"),e<this.minChromeWebRTCVersion)return o.webrtc("BROWSER | Chrome navigator is not WebRTC capable before version "+this.minChromeWebRTCVersion),t;t={browser:"chrome",attachMediaStream:function(e,t){o.webrtc("BROWSER | attachMediaStream to element"),e&&e[0]&&(e[0].srcObject=t)},pc_constraints:{},clearMediaStream:function(e){angular.isDefined(e[0])&&(e[0].pause(),e[0].srcObject=null,e[0].uniqueId=null)},attachMediaStreamIfNeeded:function(e,t,n){o.webrtc("BROWSER | attachMediaStreamIfNeeded for ID "+n),!e||!e[0]||e[0].uniqueId===n&&e[0].srcObject||(e[0].uniqueId=n,_.RTC.attachMediaStream(e,t))}}}else window.RTCPeerConnection&&navigator.userAgent.match(/AppleWebKit\/(\d+)\./)&&(t={browser:"safari",attachMediaStream:function(e,t){e&&e[0]&&(e[0].setAttribute("playsinline",!0),e[0].srcObject=t,e[0].play())},pc_constraints:{},clearMediaStream:function(e){try{angular.isDefined(e[0])&&(e[0].pause(),e[0].srcObject=null,e[0].uniqueId=null)}catch(t){o.webrtc("BROWSER | clearMediaStream failure "+t)}},attachMediaStreamIfNeeded:function(e,t,n){o.webrtc("BROWSER | attachMediaStreamIfNeeded for ID "+n),!e||!e[0]||e[0].uniqueId===n&&e[0].srcObject||(e[0].uniqueId=n,_.RTC.attachMediaStream(e,t))}});return t},this.getIceConfig=function(){return e((function(e,t){var n=s.a.getSetting("geoip"),r="";n&&(r="&geoip="+n);var i=config.restServerUrl+"/api/rainbow/geolocation/v1.0/";c({method:"GET",url:i+"settings/iceservers?nbServers=2"+r,headers:l.a.getRequestHeader()}).then((function(t){o.info("[videoService] getIceConfig success"),_.ttl=t.data.ttl,_.ttl&&(_.ttlTimeout=u((function(){_.ttl=0,_.setWebrtcConfiguration()}),1e3*t.data.ttl,1));var n=t.data.data,r=[];n.forEach((function(e){e.dc&&!r.includes(e.dc)&&r.push(e.dc),delete e.dc,delete e.id}),this),e({iceServers:n,dc:r})})).catch((function(e){o.error("[videoService] getIceConfig failure -- "+e.message),t(e)}))}))},this.getCompanyWebrtcConfig=function(){return e((function(e,t){var n=config.restServerUrl+"/api/rainbow/enduser/v1.0/settings/webrtc";c({method:"GET",url:n,headers:l.a.getRequestHeader()}).then((function(t){o.info("[videoService] getCompanyWebrtcConfig success");var n=t.data.data;e(n)})).catch((function(n){var r=n&&n.data?n.data.errorDetails:"Unknown error";if(n&&n.data&&400100==n.data.errorDetailsCode)return o.info("[videoService] getCompanyWebrtcConfig -- "+r),e({});o.error("[videoService] getCompanyWebrtcConfig failure -- "+r),t(n)}))}))},this.calculateNewCallType=function(e,t,n,r){var i=t.localType;return"contentAdd"===r&&("video"===n?(i=e.localMedia&a.Call.Media.SHARING?"sharing+video":"video",e.localMedia=e.localMedia|a.Call.Media.VIDEO):"sharing"===n?(i=e.localMedia&a.Call.Media.VIDEO?"sharing+video":"sharing",e.localMedia=e.localMedia|a.Call.Media.SHARING):"audio"===n&&(e.localMedia&a.Call.Media.SHARING?(i="sharing",e.localMedia=e.localMedia|a.Call.Media.AUDIO):(i="audio",e.localMedia=a.Call.Media.AUDIO))),"contentRemove"===r&&("video"===n?e.localMedia&a.Call.Media.SHARING?(i="sharing",e.localMedia=a.Call.Media.AUDIO|a.Call.Media.SHARING):(i="audio",e.localMedia=a.Call.Media.AUDIO):"sharing"===n&&(e.localMedia&a.Call.Media.VIDEO?(i="video",e.localMedia=a.Call.Media.AUDIO|a.Call.Media.VIDEO):(i="audio",e.localMedia=a.Call.Media.AUDIO))),"contentModify"===r&&e.localMedia&a.Call.Media.VIDEO&&!(e.localMedia&a.Call.Media.SHARING)&&(i="video"),o.info("[videoService] calculateNewCallType for type "+n+" and action "+r+" with result "+i),i},this.updateCurrentCall=function(e,n,r,i){o.info("[videoService] updateCurrentCall for type "+r+" and action "+i);for(var a=this.calculateNewCallType(e,n,r,i),s=0;s<_.localStreams.length;s++)"chrome"===adapter.default.browserDetails.browser?n.addStream(_.localStreams[s]):n.replaceStream(_.localStreams[s]),n.localStreams.push(_.localStreams[s]);switch(i){case"contentAdd":n.contentAdd(a);break;case"contentRemove":n.contentRemove(a);break;case"contentModify":n.contentModify(a)}m.a.setBusyState("dnd",_.calculatePresenceMessage(e)),t.$broadcast("ON_CALL_UPDATED_EVENT",e),t.$broadcast("ON_WEBRTC_CALL_ESCALATION",e)},this.createOrUpdateStatisticsForCall=function(e){var t=this.calls[e];if(t){var n=[];if(this.callsStats[e])return this.callsStats[e].RainMetrics&&this.callsStats[e].push(this.callsStats[e].RainMetrics),n.push({connectionId:e,stats:this.callsStats[e]}),void this.updateStatisticsForCall(this.callsStats[e].id,e,t.contact.dbId,"ended",n);o.info("[videoService] createOrUpdateStatisticsForCall "+e),this.callsStats[e]={},n.push({connectionId:e,stats:this.callsStats[e]}),this.createStatisticsForSession(e,t.contact.dbId,"pending",n).then((function(t){_.callsStats[e].id=t,o.info("[videoService] createOrUpdateStatisticsForCall success for session "+e+" with id "+t)})).catch((function(e){o.error("[videoService] createOrUpdateStatisticsForCall "+e.message)}))}else o.warn("[videoService] createOrUpdateStatisticsForCall -- missing call "+e)},this.createStatisticsForSession=function(t,n,r,i){return e((function(e,i){o.info("[videoService] createStatisticsForSession "+t);var a=config.restServerUrl+"/api/rainbow/metrics/v1.0/";c({method:"POST",url:a+"webrtcmetrics",headers:l.a.getRequestHeader(),data:{callId:t,peerId:n,callState:r}}).then((function(n){o.info("[videoService] createStatisticsForSession success"),n&&n.data&&n.data.data&&n.data.data.id&&(_.callsStats[t]||(_.callsStats[t]={}),e(n.data.data.id))}),(function(e){o.error("[videoService] createStatisticsForSession failure "+e.errorMsg),i(new Error(e.errorMsg))}))}))},this.updateStatisticsForCall=function(e,t,n,r,i){if(o.info("[videoService] updateStatisticsForCall "+t),e){var a=config.restServerUrl+"/api/rainbow/metrics/v1.0/";c({method:"POST",url:a+"webrtcmetrics/"+e+"/metrics",headers:l.a.getRequestHeader(),data:{metrics:i}}).then((function(){o.info("[videoService] updateStatisticsForCall success"),"ended"===r&&(o.info("[videoService] updateStatisticsForCall -- update call state with "+r),c({method:"PUT",url:a+"webrtcmetrics/"+e,headers:l.a.getRequestHeader(),data:{callState:r}}).then((function(){o.info("[videoService] updateStatisticsForCall -- update call state success")}),(function(e){o.error("[videoService] updateStatisticsForCall failure "+e.errorMsg)})))}),(function(e){o.error("[videoService] updateStatisticsForCall failure "+e.errorMsg)}))}else o.warn("[videoService] updateStatisticsForCall -- missing id for callId "+t)},this.sendDTMF=function(e,t,n){var r=d.a.connection.jingle.sessions[t.id];if(r&&r.peerconnection){var i=r.peerconnection.getSenders().find((function(e){return e.dtmf&&e.track&&e.track.enabled&&"audio"===e.track.kind})),a=i?i.dtmf:null;a?(o.debug("[videoService] sendDTMF: dtmf sender found on webrtc session for call id "+t.id+" dialstring: "+e),a.ontonechange=n?this.silentToneChangeEventHandle:this.handleToneChangeEvent,a.insertDTMF(e)):o.error("[videoService] sendDTMF: no dtmf sender found on webrtc session for call id "+t.id)}else o.error("[videoService] sendDTMF: no webrtc session found for call id "+t.id)},this.handleToneChangeEvent=function(e){""!==e.tone&&(o.debug("[videoService] Dtmf Tone played: "+e.tone),t.$broadcast("ON_DTMF_SENT",e.tone))},this.silentToneChangeEventHandle=function(e){o.debug("[videoService] Dtmf Tone played: "+e.tone)},angular.element(document).bind("transportreplace.jingle",(function(e,t){o.webrtc("JINGLE  | transportreplace.jingle "+t);var n=d.a.connection.jingle.sessions[t];n?n.sendAnswer(void 0,"transport-accept"):o.warn("JINGLE  | transportreplace.jingle no such session !")})),angular.element(document).bind("callactive.jingle",(function(e,t){o.webrtc("JINGLE  | callactive "+t)})),angular.element(document).bind("remotestreamadded.jingle",(function(e,n,r){o.webrtc("JINGLE  | remoteStreamadded "+n);var i=d.a.connection.jingle.sessions[n];if(i&&i.remoteStreams&&!i.confId){var a=_.calls[n];a&&_.attachDistantMediaStreams(!0,a),t.$broadcast("ON_WEBRTC_REMOTE_STREAM_ADDED",i.remoteStreams)}r&&_.resetAudioOutputElement()})),angular.element(document).bind("remotestreamremoved.jingle",(function(e,t){o.webrtc("JINGLE  | remotestreamremoved "+t);var n=_.calls[t],r=d.a.connection.jingle.sessions[t];n&&r&&_.attachDistantMediaStreams(!0,n)})),angular.element(document).bind("callaccepted.jingle",(function(e,t){o.webrtc("JINGLE  | callaccepted "+t);var n=_.calls[t],r=d.a.connection.jingle.sessions[t];n&&r&&(_.statsInterval&&(o.webrtc("JINGLE  | remove getStats interval"),window.clearInterval(_.statsInterval),_.statsinterval=null),_.createOrUpdateStatisticsForCall(n.id),o.webrtc("JINGLE  | start getStats interval"),_.statsInterval=r.getStats(3e3)),n&&n.status.key!==a.Call.Status.ACTIVE.key&&(o.webrtc("INFO    | call has been accepted. Set current call to ACTIVE state"),angular.element(document).trigger("callactive.jingle",[t]))})),angular.element(document).bind("nostuncandidates.jingle",(function(e,t){o.webrtc("JINGLE  | nostuncandidates "+t),y.trackICENoSTUNCandidate()})),angular.element(document).bind("ringing.jingle",(function(e,t){o.webrtc("JINGLE  | callremoteringing "+t)})),angular.element(document).bind("mediafailure.jingle",(function(){o.webrtc("JINGLE  | callmediafailure")})),angular.element(document).bind("mute.jingle",(function(e,n){o.webrtc("JINGLE  | mute "+n);var r=_.calls[n];r.isRemoteVideoMuted=!0,t.$broadcast("ON_CALL_UPDATED_EVENT",r)})),angular.element(document).bind("unmute.jingle",(function(e,n){o.webrtc("JINGLE  | unmute "+n);var r=_.calls[n];r.isRemoteVideoMuted=!1,t.$broadcast("ON_CALL_UPDATED_EVENT",r)})),angular.element(document).bind("hold.jingle",(function(e,n){o.webrtc("JINGLE  | hold "+n);var r=d.a.connection.jingle.sessions[n];r?(r.muteAudio(!0),t.$broadcast("ON_HOLD_TONE_EVENT","hold")):o.webrtc("MEDIA   | hold - received on a non existing session !")})),angular.element(document).bind("unhold.jingle",(function(e,n){o.webrtc("JINGLE  | unhold "+n);var r=d.a.connection.jingle.sessions[n];r?(r.muteAudio(!1),t.$broadcast("ON_HOLD_TONE_EVENT","unhold")):o.webrtc("MEDIA   | unhold - received on a non existing session !")})),angular.element(document).bind("remoteIceFailed.jingle",(function(e){o.webrtc("JINGLE  | remoteIceFailed "+e),_.openErrorPopup("IceConnectionFailed")})),angular.element(document).bind("mediamodified.jingle",(function(e,t,n){o.webrtc("JINGLE  | mediamodified "+t),_.videoEventHandler.mediaModified(t,n)})),angular.element(document).bind("statsChrome.jingle",(function(e,t,n){for(var r=0;r<n.length;++r)switch(n[r].type){case"googComponent":p.addStreamToCall(t,n[r]);break;case"ssrc":p.addSSRCToStream(t,n[r])}})),angular.element(document).bind("statsFirefox.jingle",(function(e,t,n){for(var r=0;r<n.length;++r)switch(n[r].type){case"inboundrtp":case"outboundrtp":v.addStreamToCall(t,n[r]);break;case"candidatepair":v.addCandidatePairToCall(t,n[r])}})),angular.element(document).bind("webrtcFirefoxStats.jingle",(function(e,t,n){if(_.callsStats.sid||(_.callsStats.sid={}),_.callsStats[t]||(_.callsStats[t]={}),_.calls[t]){var r=_.callsStats[t];r&&(n.videoReceived?r.video=n:r.audio=n,_.callsStats[t]=r)}})),angular.element(document).bind("webrtcConnectionType.jingle",(function(e,t,n){var r=_.calls[t];n&&(o.webrtc("STATS   | Local candidate ("+n.localAddress+") type is "+n.localCandidateType),o.webrtc("STATS   | Remote candidate  ("+n.remoteAddress+") type is "+n.remoteCandidateType),r&&r.isInitiator&&y.trackICEUsed(n.localCandidateTypee,n.remoteCandidateType),n.networkType&&(o.webrtc("STATS   | Network type is "+n.networkType),r&&r.isInitiator&&y.trackICETopology(n.networkType)))})),angular.element(document).bind("webrtcSessionStats.jingle",(function(e,t,n){_.callsStats.sid||(_.callsStats.sid={}),_.callsStats[t]||(_.callsStats[t]={});var r=_.callsStats[t].id;_.callsStats[t]=n,_.callsStats[t].id=r}))}])},function(e,t,n){n.r(t);var r=n(0),i=n(27),a=n(4),o=n.n(a),s=n(6),c=n.n(s),l=n(14),u=n.n(l),d=n(1),h=n.n(d);angular.module("rainbow").factory("VideoServiceEventHandler",["$q","$log","$rootScope","$interval","gaService",function(e,t,n,a,s){function l(e){this.videoService=e,this.nameSpace="urn:xmpp:jingle-message:0"}return l.create=function(e){return new l(e)},l.prototype.setRemoteTypeMedia=function(e,n){n.remoteMedia=0;for(var i=0;i<e.length;i++)switch(e[i]){case"audio":n.remoteMedia=n.remoteMedia|r.Call.Media.AUDIO;break;case"video":n.remoteMedia=n.remoteMedia|r.Call.Media.VIDEO;break;case"sharing":n.remoteMedia=n.remoteMedia|r.Call.Media.SHARING;break;default:n.remoteMedia=null}t.debug("REMOTE TYPE || REMOTE MEDIA  "+n.remoteMedia)},l.prototype.setLocalTypeMedia=function(e,n){n.localMedia=0;for(var i=0;i<e.length;i++)switch(e[i]){case"audio":n.localMedia=n.localMedia|r.Call.Media.AUDIO;break;case"video":n.localMedia=n.localMedia|r.Call.Media.VIDEO;break;case"sharing":n.localMedia=n.localMedia|r.Call.Media.SHARING;break;default:n.localMedia=null}t.debug("LOCAL TYPE || LOCAL MEDIA  "+n.localMedia)},l.prototype.sendProposition=function(e,s,l){t.info("[VideoServiceEventHandler]   | sendProposition to "+JSON.stringify({displayName:e.nameForLog,resources:e.resources}));var u=this,d=["audio"],f=[];"video"===s?d.push("video"):"videoOnly"===s?d=["video"]:"sharing"===s?(d=["sharing"],f=["audio"]):"sharingOnly"===s&&(d=["sharing"]);var p="web_"+i(),m=r.Call.create(r.Call.Status.DIALING,p,r.Call.Type.WEBRTC,e);this.videoService.getBrowserMedia(d,void 0,void 0,void 0,m).then((function(r){u.videoService.getBrowserMedia(f).then((function(s){if(u.videoService.makingCall&&u.videoService.started){m.isInitiator=!0,r.callId=p,u.videoService.localStreams.push(r),s&&(s.callId=p,u.videoService.localStreams.push(s),d.push(f.pop())),u.videoService.calls[m.id]=m,u.setLocalTypeMedia(d,m);var v="web_"+i(),g=$msg({from:h.a.userContact.fullJid,to:e.jid,id:v});g.c("propose",{xmlns:u.nameSpace,id:p}),l&&g.c("subject",{xmlns:"urn:xmpp:jingle-subject:0"}).t(l).up(),g.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:d[0]}).up(),d[1]&&(g=g.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:d[1]}).up()),c.a.isFeatureEnabled(c.a.FeaturesEnum.WEBRTC_UNIFIED_PLAN)&&(g=g.c("unifiedplan",{xmlns:"urn:xmpp:jingle:apps:jsep:1"}).up()),o.a.send(g),u.videoService.makingCall=!1,h.a.setBusyState("dnd",u.videoService.calculatePresenceMessage(m)),n.$broadcast("ON_CALL_UPDATED_EVENT",m),u.videoService.autoreleaseTimeout&&a.cancel(u.videoService.autoreleaseTimeout),u.videoService.autoreleaseTimeout=a((function(e){t.webrtc("MEDIA   | send proposition : no response after 30 seconds : release the call"),m&&u.videoService.rejectCall(e)}),3e4,1,!0,m)}else t.warn("[VideoServiceEventHandler]   | sendProposition -- call should no longer be made !"),u.videoService.makingCall=!1,r.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),r.stop&&r.stop(),r=null,s&&(s.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),s.stop&&s.stop(),s=null)})).catch((function(e){t.info("[VideoServiceEventHandler]   | sendProposition failure : "+JSON.stringify({error:e.message})),u.videoService.makingCall=!1,-1!==e.toString().indexOf("getUserMedia")&&u.videoService.openErrorPopup(),u.videoService.removeCallObject(m),u.videoService.isUserContactInCall()||u.videoService.resetToSafeState(),u.videoService.autoreleaseTimeout&&a.cancel(u.videoService.autoreleaseTimeout)}))})).catch((function(e){t.info("[VideoServiceEventHandler]   | sendProposition failure : "+JSON.stringify({error:e.message})),u.videoService.makingCall=!1,d.indexOf("sharing")>=0||-1===e.toString().indexOf("getUserMedia")||u.videoService.openErrorPopup(),u.videoService.removeCallObject(m),u.videoService.isUserContactInCall()||u.videoService.resetToSafeState()}))},l.prototype.retractProposition=function(e){t.info("[VideoServiceEventHandler]   | retractProposition for call "+e.id);var n="web_"+i(),r=$msg({from:h.a.userContact.fullJid,to:e.contact.jid,id:n}).c("retract",{xmlns:this.nameSpace,id:e.id});o.a.send(r),h.a.resetBusyState(),this.videoService.removeCallObject(e)},l.prototype.acceptProposition=function(e,s){if(e.status!==r.Call.Status.ANSWERING){t.info("[VideoServiceEventHandler]   | acceptProposition for call "+e.id),e.status=r.Call.Status.ANSWERING;var c="web_"+i(),l=$msg({from:h.a.userContact.fullJid,to:h.a.userContact.jid,id:c}).c("accept",{xmlns:this.nameSpace,id:e.id});o.a.send(l);var u="web_"+i();l=$msg({from:h.a.userContact.fullJid,to:e.fullJid,id:u}).c("proceed",{xmlns:this.nameSpace,id:e.id}),e.unifiedPlanActivated&&(l=l.c("unifiedplan",{xmlns:"urn:xmpp:jingle:apps:jsep:1"}).up(),o.a.connection.jingle.jid2session[e.fullJid]={unifiedPlan:!0}),o.a.send(l);var d=["audio"];s&&"video"===s&&d.push("video"),e.remoteMedia===r.Call.Media.VIDEO&&(d=["video"]),e.remoteMedia===r.Call.Media.SHARING&&(d=[]),this.setLocalTypeMedia(d,e),h.a.setBusyState("dnd",this.videoService.calculatePresenceMessage(e)),n.$broadcast("ON_CALL_UPDATED_EVENT",e);var f=this;f.videoService.autoreleaseTimeout&&a.cancel(f.videoService.autoreleaseTimeout),f.videoService.autoreleaseTimeout=a((function(n){n&&(null!==e.getMediaPillarCall()?t.warn("[webrtcgateway/VideoServiceEventHandler] | acceptProposition autoreleaseTimeout after 45 s : remove the call :"+n.id):t.webrtc("[VideoServiceEventHandler] | acceptProposition autoreleaseTimeout after 45 s : remove the call "+n.id),f.videoService.removeCallObject(n),h.a.resetBusyState())}),45e3,1,!0,e)}else t.warn("[VideoServiceEventHandler]   | acceptProposition for call "+e.id+" -- ignored! Already answering")},l.prototype.rejectProposition=function(e,s){t.info("[VideoServiceEventHandler]   | rejectProposition for call "+e.id);var c="web_"+i(),l=$msg({from:h.a.userContact.fullJid,to:h.a.userContact.jid,id:c}).c("reject",{xmlns:this.nameSpace,id:e.id});o.a.send(l);var u=e.getMediaPillarCall(),d=u&&u.mediaPillarJid?u.mediaPillarJid:e.contact.jid,f="web_"+i();d?(l=$msg({from:h.a.userContact.fullJid,to:d,id:f}).c("reject",{xmlns:this.nameSpace,id:e.id,reason:s}),o.a.send(l)):t.error("[VideoServiceEventHandler] | rejectProposition -- missing other JID !"),e&&(e.status=r.Call.Status.UNKNOWN,delete this.videoService.calls[e.id],n.$broadcast("ON_CALL_UPDATED_EVENT",e)),this.videoService.setWebrtcConfiguration(),this.videoService.autoreleaseTimeout&&a.cancel(this.videoService.autoreleaseTimeout)},l.prototype.onMessageReceived=function(e){var r=this;try{n.$apply((function(){t.info("[VideoServiceEventHandler]   | onMessageReceived");var n=$(e);n.find("error").length>0||n.find("delay").length>0||$(e).find("service-unavailable").length>0?r.onMessageReceivedError():n.find("propose").length>0?r.onPropositionReceived(e):n.find("retract").length>0?r.onRetractReceived(e):n.find("reject").length>0?r.onRejectReceived(e):n.find("accept").length>0?r.onAcceptReceived(e):n.find("proceed").length>0&&r.onProceedReceived(e)}))}catch(i){return t.error("[VideoServiceEventHandler]   | onMessageReceived error "+i),!0}return!0},l.prototype.onMessageReceivedError=function(e){t.info("[VideoServiceEventHandler]   | onMessageReceivedError");var n=$(e).find("propose").attr("id"),r=this.videoService.calls[n];r&&t.error("[VideoServiceEventHandler]   | onMessageReceivedError call is in "+r.status.value+" state")},l.prototype.getOrCreateContact=function(n,r){if(h.a.isMediaPillarJid(n)){t.info("[VideoServiceEventHandler]   | getOrCreateContact for mediapillar jid "+n);var i=$(r).find("mediapillar");if(i){var a,o=i.find("callernumber"),s=o?o.text():void 0,c=i.find("displayname"),l=c?c.text():void 0;t.info("[VideoServiceEventHandler]   | getOrCreateContact MP for jid "+n+" callernumber: "+u()(s)+" displayname: "+u()(l));var d=h.a.getContactByPhoneNumber(s);return d?a=d:(a=h.a.createBasicContact(null,s),l&&(a.displayName=l)),e.resolve(a)}return h.a.getOrCreateContact(n)}return t.info("[VideoServiceEventHandler]   | getOrCreateContact for jid "+n),h.a.getOrCreateContact(n)},l.prototype.onPropositionReceived=function(e){var i=$(e).find("propose").attr("id");t.info("[VideoServiceEventHandler]   | onPropositionReceived for ID "+i);var s=this.videoService.calls[i],l=this;if(s){if($(e).find("subject").length>0){var u=$(e).find("subject")[0];t.debug("[VideoServiceEventHandler]   | onPropositionReceived subject Detected: "+u.textContent),s.setSubject(u.textContent)}s.setStatus(r.Call.Status.RINGING_INCOMMING),l.videoService.config&&l.videoService.config.unifiedPlan&&(s.unifiedPlanActivated=!0),c.a.isFeatureEnabled(c.a.FeaturesEnum.WEBRTC_UNIFIED_PLAN)&&$(e).find("unifiedplan").length&&(s.unifiedPlanActivated=!0),m=[];for(var d=$(e).find("description").length,h=0;h<d;h++){var f=$(e).find("description")[h];m.push($(f).attr("media"))}this.setRemoteTypeMedia(m,s),n.$broadcast("ON_CALL_UPDATED_EVENT",s),l.videoService.autoreleaseTimeout&&a.cancel(l.videoService.autoreleaseTimeout),l.videoService.autoreleaseTimeout=a((function(e){e&&(t.webrtc("[VideoServiceEventHandler]   | onPropositionReceived autoreleaseTimeout after 2 min : remove the call "+e.id),l.videoService.removeCallObject(e))}),12e4,1,!0,s)}else{var p=$(e).attr("from"),m=[],v=o.a.getBareJidFromJid(p);(s=r.Call.create(r.Call.Status.UNKNOWN,i,r.Call.Type.WEBRTC)).fullJid=p,l.videoService.calls[s.id]=s,l.videoService.config&&l.videoService.config.unifiedPlan&&(s.unifiedPlanActivated=!0),c.a.isFeatureEnabled(c.a.FeaturesEnum.WEBRTC_UNIFIED_PLAN)&&$(e).find("unifiedplan").length&&(s.unifiedPlanActivated=!0),l.getOrCreateContact(v,e).then((function(i){for(var o=$(e).find("description").length,c=0;c<o;c++){var u=$(e).find("description")[c];m.push($(u).attr("media"))}if(l.videoService.calls[s.id]){if(s.contact=i,$(e).find("subject").length>0){var d=$(e).find("subject")[0];t.debug("[VideoServiceEventHandler]   | onPropositionReceived subject Detected: "+d.textContent),s.setSubject(d.textContent)}s.setStatus(r.Call.Status.RINGING_INCOMMING),l.setRemoteTypeMedia(m,s),n.$broadcast("ON_CALL_UPDATED_EVENT",s),l.videoService.autoreleaseTimeout&&a.cancel(l.videoService.autoreleaseTimeout),l.videoService.autoreleaseTimeout=a((function(e){e&&(t.webrtc("[VideoServiceEventHandler]   | onPropositionReceived autoreleaseTimeout after 2 min : remove the call "+e.id),l.videoService.removeCallObject(e))}),12e4,1,!0,s)}})).catch((function(e){t.error("[VideoServiceEventHandler]   | onPropositionReceived error "+e),l.videoService.removeCallObject(s)}))}},l.prototype.onRetractReceived=function(e){t.info("[VideoServiceEventHandler]   | onRetractReceveid");var n=$(e).find("retract").attr("id"),i=this.videoService.calls[n];i&&(i.status===r.Call.Status.ANSWERING&&h.a.resetBusyState(),this.videoService.removeCallObject(i)),this.videoService.autoreleaseTimeout&&a.cancel(this.videoService.autoreleaseTimeout)},l.prototype.onRejectReceived=function(e){t.info("[VideoServiceEventHandler]   | onRejectReceived");var i=$(e).find("reject").attr("id"),o=this.videoService.calls[i],s=$(e).attr("from"),c="calendarBusy"===$(e).find("reject").attr("reason");this.videoService.autoreleaseTimeout&&a.cancel(this.videoService.autoreleaseTimeout),o&&(o.status===r.Call.Status.RINGING_INCOMMING&&(null!==o.getMediaPillarCall()&&n.$broadcast("ON_MEDIAPILLAR_CALL_REMOTE_CTRL_EVENT",o),this.videoService.removeCallObject(o)),o.status===r.Call.Status.DIALING&&(h.a.resetBusyState(),this.videoService.removeCallObject(o)),o.status!==r.Call.Status.ACTIVE&&o.status!==r.Call.Status.CONNECTING||o.fullJid&&o.fullJid===s&&(h.a.resetBusyState(),this.videoService.removeCallObject(o))),c&&this.videoService.openCalendarBusyPopup(o.contact.id)},l.prototype.onAcceptReceived=function(e){t.info("[VideoServiceEventHandler]   | onAcceptReceived");var r=$(e).find("accept").attr("id"),i=this.videoService.calls[r],o=$(e).attr("from");i&&o!==h.a.userContact.fullJid&&(null!==i.getMediaPillarCall()&&n.$broadcast("ON_MEDIAPILLAR_CALL_REMOTE_CTRL_EVENT",i),this.videoService.removeCallObject(i)),o!==h.a.userContact.fullJid&&this.videoService.autoreleaseTimeout&&a.cancel(this.videoService.autoreleaseTimeout)},l.prototype.onProceedReceived=function(e){t.info("[VideoServiceEventHandler]   | onProceedReceived"),this.videoService.autoreleaseTimeout&&a.cancel(this.videoService.autoreleaseTimeout);var n=$(e).find("proceed").attr("id"),i=this.videoService.calls[n],o=$(e).attr("from");if(i.fullJid=o,this.videoService.config&&this.videoService.config.unifiedPlan&&(i.unifiedPlanActivated=!0),$(e).find("unifiedplan").length&&(i.unifiedPlanActivated=!0),i.isInConversationWithMobile()&&i.localMedia&r.Call.Media.VIDEO){var s=this,c=[],l=s.videoService.getMobileMediaConstraints("video");c=["audio","video"],i.localMedia&r.Call.Media.AUDIO||(c=["video"]),s.videoService.getBrowserMedia(c,l.fixedVideoWidth,l.fixedVideoHeight,l.fixedFrameRate).then((function(e){t.info("[VideoServiceEventHandler]   | onProceedReceived --\x3e renegociate video quality"),i.localMedia&r.Call.Media.VIDEO&&s.videoService.stopActiveAudioVideoStreams(null,!0),s.videoService.localStreams.push(e),s.videoService.makeJingleCall(i)})).catch((function(e){t.info("[VideoServiceEventHandler]   | onProceedReceived "+i+" failure : "+e.message),-1!==e.toString().indexOf("getUserMedia")?(t.info("onProceedReceived impossible, no webcam plugged"),s.videoService.openErrorPopup()):(s.videoService.releaseCall(i),s.videoService.resetToSafeState())}))}else i.localMedia&r.Call.Media.SHARING?this.videoService.makeJingleSharingCall(i):this.videoService.makeJingleCall(i)},l.prototype.incomingCall=function(e){t.info("[VideoServiceEventHandler] incomingCall "+e);var r=this,i=null,s=o.a.connection.jingle.sessions[e];if(s&&s.peerjid){var c=o.a.getBareJidFromJid(s.peerjid),l=h.a.getContactByJid(c);(i=this.videoService.calls[e])||(i=this.videoService.getCallByJid(l.jid,s.peerjid))}i?(s.sendRinging(),a((function(e){r.videoService.answerJingleCall(e)}),350,1,!0,i),n.$broadcast("ON_CALL_UPDATED_EVENT",i),this.videoService.autoreleaseTimeout&&a.cancel(this.videoService.autoreleaseTimeout),this.videoService.statsInterval&&(t.info("[VideoServiceEventHandler] remove getStats interval"),window.clearInterval(this.videoService.statsInterval),this.videoService.statsinterval=null),r.videoService.createOrUpdateStatisticsForCall(i.id),t.info("[VideoServiceEventHandler] start getStats interval"),this.videoService.statsInterval=s.getStats(3e3)):(t.warn("[VideoServiceEventHandler] incomingCall no such call ! Terminate the session "),h.a.resetBusyState(),s&&s.terminate())},l.prototype.activeCall=function(e){t.info("[VideoServiceEventHandler] activeCall "+e);var i=o.a.connection.jingle.sessions[e];this.videoService.autoreleaseTimeout&&a.cancel(this.videoService.autoreleaseTimeout);var c=this.videoService.calls[e];this.videoService.updateRemoteTypeMedia(i.remoteType,c),c&&c.status.key!==r.Call.Status.RELEASING.key&&c.status.key!==r.Call.Status.UNKNOWN.key&&(c.setStatus(r.Call.Status.ACTIVE),n.$broadcast("ON_CALL_UPDATED_EVENT",c),c.startDuration(),this.videoService.attachDistantMediaStreams(!0,c)),c.isInitiator&&s.trackCallSuccessNumber(i.localType)},l.prototype.terminatedCall=function(e,n,r){0===Object.keys(o.a.connection.jingle.sessions).length&&t.webrtc("INFO    | all calls terminated");var i=this.videoService.calls[e];i||0===this.videoService.calls.length?("busy"===n&&this.videoService.openErrorPopup("remoteUserNoMoreAvailable"),this.videoService.autoreleaseTimeout&&a.cancel(this.videoService.autoreleaseTimeout),this.videoService.disableAudioVideoMedia(null,e),this.videoService.createOrUpdateStatisticsForCall(e),this.videoService.callsStats[e]&&delete this.videoService.callsStats[e],i&&("cancel"!==n&&s.trackCallDuration((new Date).getTime()-i.startDate.getTime()),this.videoService.removeCallObject(i)),r||a((function(){h.a.resetBusyState()}),1e3,1,!0),this.videoService.statsInterval&&(window.clearInterval(this.videoService.statsInterval),this.videoService.statsinterval=null),this.videoService.displayWebRTCStats(e),this.videoService.isUserContactInCall()||this.videoService.clearSrcObjectsFromElements()):t.webrtc("INFO    | terminatedCall : no call with "+e+" exists.")},l.prototype.onJingleError=function(e){e&&this.videoService.calls[e]&&this.videoService.calls[e].status!==r.Call.Status.ACTIVE&&(this.videoService.removeCallObject(this.calls[e]),this.videoService.resetToSafeState(),this.videoService.openErrorPopup("IceConnectionFailed"))},l.prototype.iceConnectionStateChange=function(e,i){t.info("[VideoServiceEventHandler] iceConnectionStateChange for "+e);var c=this,l=null,u=c.videoService.calls[i.sid];try{if(i.peerconnection&&"stable"===i.peerconnection.signalingState&&"connected"===i.peerconnection.iceConnectionState){t.webrtc("INFO    | ICE Connection established successfully"),angular.element("#globalAudioTag")[0]&&t.info("[VideoServiceEventHandler] sinkId for globalAudioTag is "+angular.element("#globalAudioTag")[0].sinkId),c.videoService.reconnectCall=!1,(l=c.videoService.calls[e])&&l.status!==r.Call.Status.ACTIVE&&(t.webrtc("INFO    | ICE Connection : call is active now !"),this.activeCall(e)),i.isRenegotiating&&(t.webrtc("INFO    | Renegotiating done"),i.isRenegotiating=!1,n.$broadcast("ON_WEBRTC_CALL_ESCALATION",l),n.$broadcast("ON_WEBRTC_CALL_ESCALATION_SUCCESS",l)),i.autoReconnectTimer&&(a.cancel(i.autoReconnectTimer),i.autoReconnectTimer=null),s.endNegotiationTime();var d=s.negotiationTime();d&&(t.webrtc("INFO    | negotiation time: "+d+"ms"),s.trackNegotiationTime()),l&&l.isInitiator&&s.trackICESuccess(e)}i.peerconnection&&"stable"===i.peerconnection.signalingState&&"completed"===i.peerconnection.iceConnectionState&&(t.webrtc("INFO    | ICE Connection completed successfully"),c.videoService.reconnectCall=!1,(l=c.videoService.calls[e])&&l.status!==r.Call.Status.ACTIVE&&(t.webrtc("INFO    | ICE Connection : call is active now !"),this.activeCall(e)),i.isRenegotiating&&(t.webrtc("INFO    | Renegotiating done"),i.isRenegotiating=!1,n.$broadcast("ON_WEBRTC_CALL_ESCALATION",l),n.$broadcast("ON_WEBRTC_CALL_ESCALATION_SUCCESS",l))),i.peerconnection&&"stable"===i.peerconnection.signalingState&&"disconnected"===i.peerconnection.iceConnectionState&&(t.webrtc("INFO    | signalingState disconnected"),u&&u.status!==r.Call.Status.UNKNOWN&&(t.webrtc("INFO    | iceConnectionStateChange go to connecting state"),u.setStatus(r.Call.Status.CONNECTING),n.$broadcast("ON_CALL_UPDATED_EVENT",u)),c.videoService.connected||(c.videoService.reconnectCall=!0),i.autoReconnectTimer||(console.error("arm autoReconnectTimer"),i.autoReconnectTimer=a((function(e){console.error("autoReconnectTimer -- execute"),c.videoService.connected&&(console.error("autoReconnectTimer -- network OK, proceed with reconnect"),e.reconnectSession())}),1e3,1,!0,i))),i.peerconnection&&"stable"===i.peerconnection.signalingState&&"failed"===i.peerconnection.iceConnectionState&&(t.webrtc("INFO    | signalingState FAILED"),u&&u.status!==r.Call.Status.UNKNOWN&&(t.webrtc("INFO    | iceConnectionStateChange go to connecting state"),u.setStatus(r.Call.Status.CONNECTING),n.$broadcast("ON_CALL_UPDATED_EVENT",u),n.$broadcast("ON_RECORDING_CNXLOST_EVENT")),c.videoService.connected||(c.videoService.reconnectCall=!0),c.videoService.connected&&(console.error("[videoServiceEventHandler] signalingState FAILED -- network OK, proceed with reconnect"),i.reconnectSession()))}catch(f){try{t.error("JINGLE  | iceconnectionstatechange error "+f),u?c.videoService.removeCallObject(u,"unsupported-applications"):o.a.connection.jingle.terminate(null,"unsupported-applications"),h.a.resetBusyState()}catch(p){t.error("JINGLE  | iceconnectionstatechange error "+p),h.a.resetBusyState()}}},l.prototype.mediaModified=function(e,i){t.info("[VideoServiceEventHandler] mediaModified "+e);var a=this.videoService.calls[e];o.a.connection.jingle.sessions[e].isRenegotiating=!0,a.remoteMedia="sharing"===i?r.Call.Media.AUDIO|r.Call.Media.SHARING:"video"===i?r.Call.Media.AUDIO|r.Call.Media.VIDEO:"sharing+video"===i?r.Call.Media.AUDIO|r.Call.Media.VIDEO|r.Call.Media.SHARING:r.Call.Media.AUDIO,h.a.setBusyState("dnd",this.videoService.calculatePresenceMessage(a)),n.$broadcast("ON_WEBRTC_CALL_ESCALATION",a)},l}])},function(e,t,n){n.r(t);var r=n(0),i=n(4),a=n.n(i),o=n(1),s=n.n(o),c=n(27);angular.module("rainbow").service("webrtcServiceEventHandler",["$log","$q","$rootScope","videoService","webConferenceService",function(e,t,n,i,o){var l=this;this.nameSpace="urn:xmpp:jingle-message:0",this.messageHandlerRef=null,this.started=!1,this.start=function(){return this.started=!0,this.attachHandlers(),t.when()},this.stop=function(){return this.started=!1,l.removeHandlers(),t.when()},this.attachHandlers=function(){this.removeHandlers(),e.info("[webrtcServiceEventHandler] attachHandlers"),this.messageHandlerRef||(this.messageHandlerRef=a.a.addHandler((function(t){try{return l.onMessageReceived(t),!0}catch(n){return e.error("[webrtcServiceEventHandler] caught error "+n),!0}}),l.nameSpace,"message"))},this.removeHandlers=function(){e.info("[webrtcServiceEventHandler] removeHandlers"),this.messageHandlerRef&&(a.a.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null)},this.onMessageReceived=function(t){var n=$(t).attr("from"),r=a.a.getBareJidFromJid(n),c=$(t).find("propose").find("conference").attr("id");if(o.getConferenceSessionById(c))try{if(e.info("[webrtcServiceEventHandler]   | onMessageReceived"),$(t).find("propose").length>0){var l=$(t).find("propose").attr("id"),u=$msg({from:s.a.userContact.fullJid,to:s.a.userContact.jid}).c("accept",{xmlns:this.nameSpace,id:l});return a.a.send(u),u=$msg({from:s.a.userContact.fullJid,to:r}).c("proceed",{xmlns:this.nameSpace,id:l}),a.a.send(u),!0}}catch(d){return i.videoEventHandler.onMessageReceived(t)}return i.videoEventHandler.onMessageReceived(t)},this.checkSessionAudioSentHealthStatus=function(t){e.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- 0 audio packets sent !");var s=i.calls[t];if(s&&!s.isInCallWithMediaPillar()){if(s.status.key===r.Call.Status.ACTIVE.key&&s.localMedia&r.Call.Media.AUDIO&&!s.isMuted){if(i.callsStatsSimplified[t].numberOfErrorAudioSent+=1,i.callsStatsSimplified[t].numberOfErrorAudioSent%2)return void e.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- ingore");var c=a.a.connection.jingle.sessions[s.id];c&&!c.isRenegotiating&&(e.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- renego P2P call"),i.renegotiateCurrentCall(s)),n.$broadcast("ON_WEBRTC_CALL_AUDIO_ISSUE",!0)}}else{var l=o.getActiveConferenceSession();if(l&&l.id&&l.active&&"connected"===l.status){var u=o.getRemoteAudioSession(l.id);if(u&&u.sid===t){if(i.callsStatsSimplified[t].numberOfErrorAudioSent+=1,i.callsStatsSimplified[t].numberOfErrorAudioSent%2)return void e.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- ingore");e.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- renego SFU conference"),o.onAudioProfileChangeEvent()}}}},this.checkSessionAudioReceivedHealthStatus=function(t){e.info("[webrtcServiceEventHandler]   | checkSessionAudioReceivedHealthStatus --- user hears nothing !");var n=i.calls[t];if(n&&!n.isInCallWithMediaPillar())n.status.key===r.Call.Status.ACTIVE.key&&n.remoteMedia&r.Call.Media.AUDIO&&(i.callsStatsSimplified[t].errorAudioReceived=1,e.info("[webrtcServiceEventHandler]   | checkSessionAudioReceivedHealthStatus --- reset output device"),i.resetAudioOutputElement());else{var a=o.getActiveConferenceSession();if(a&&a.id&&a.active&&"connected"===a.status){var s=o.getRemoteAudioSession(a.id);s&&s.sid===t&&(i.callsStatsSimplified[t].errorAudioReceived=1,e.info("[webrtcServiceEventHandler]   | checkSessionAudioReceivedHealthStatus --- renego SFU conference"),i.resetAudioOutputElement())}}},angular.element(document).bind("callincoming.jingle",(function(t,n){e.webrtc("webrtcServiceEventHandler  | callincoming.jingle "+n);var r=a.a.connection.jingle.sessions[n];r&&r.confId?o.onIncomingCall(n):i.videoEventHandler.incomingCall(n)})),angular.element(document).bind("callterminated.jingle",(function(t,r,a){n.$apply((function(){var t=a||"";if(e.webrtc("webrtcServiceEventHandler  | callterminated "+r+" reason: "+t),"multi-device"===a)o.onConferenceCallSwitched(r);else if(i.calls[r]){var n=o.hasActiveConferenceSession();i.videoEventHandler.terminatedCall(r,t,n)}else o.onTerminatedCall(r)}))})),angular.element(document).bind("iceconnectionstatechange.jingle",(function(t,n,r){r.peerconnection?(e.webrtc("JINGLE  | iceconnectionstatechange "+n+" "+r.peerconnection.iceConnectionState+"|"+r.peerconnection.signalingState),i.calls[n]?i.videoEventHandler.iceConnectionStateChange(n,r):o.onIceConnectionStateChange(n,r)):e.webrtc("JINGLE  | iceconnectionstatechange - peerConnection does not exist anymore !!!")})),angular.element(document).bind("error.jingle",(function(t,n){e.error("JINGLE  | callerror"),n&&n.error&&e.error(JSON.stringify(n.error));var r=n.sid;r&&(i.calls[r]?i.videoEventHandler.onJingleError(r):o.onJingleError(r))})),angular.element(document).bind("webrtcSessionBitRate.jingle",(function(e,t,r){i.config&&i.config.debugWeRTC&&n.$broadcast("ON_WEBRTC_CALL_BITRATE",t,r)})),angular.element(document).bind("webrtcSessionStatsSimplyfied.jingle",(function(t,n,r){if(i.callsStatsSimplified[n]||(i.callsStatsSimplified[n]={},i.callsStatsSimplified[n].errorAudioReceived=0),r.errorAudioReceived=i.callsStatsSimplified[n].errorAudioReceived,r.networkQualityIteration=i.callsStatsSimplified[n].networkQualityIteration,r.conferenceId){if(r.publisherId&&r.conferenceId)if(i.callsStatsSimplified[n].publisherJidIm)r.publisherJidIm=i.callsStatsSimplified[n].publisherJidIm;else{var a=o.conferenceSessions[r.conferenceId];if(a){var s=a.getPublisherById(r.publisherId);r.publisherJidIm=s?s.jid_im:"",i.callsStatsSimplified[n].publisherJidIm=r.publisherJidIm}}e.info("[videoService] on webrtcSessionStatsSimplyfied for session "+n+" related to conferenceID "+r.conferenceId+" : "+JSON.stringify(r))}else e.info("[videoService] on webrtcSessionStatsSimplyfied for session "+n+" : "+JSON.stringify(r));i.callsStatsSimplified[n]=r,r.packetsAudioReceived&&0===r.audioOutputLevel&&0===r.errorAudioReceived&&l.checkSessionAudioReceivedHealthStatus(n);var c=i.calls[n];c?(i.callsStatsSimplified[n].networkQualityFlag===c.networkQuality?(i.callsStatsSimplified[n].networkQualityIteration=i.callsStatsSimplified[n].networkQualityIteration?i.callsStatsSimplified[n].networkQualityIteration+1:1,0===c.networkQuality&&i.callsStatsSimplified[n].networkQualityIteration>=3&&c.publish("badNetworkQuality",c.networkQuality)):i.callsStatsSimplified[n].networkQualityIteration=1,c.networkQuality=r.networkQualityFlag,c.publish("networkQuality",c.networkQuality)):o.onNetworkQualityChange(n)})),angular.element(document).bind("refer.jingle",(function(t,n,r,s,l){e.webrtc("JINGLE  | refer: "+n+" - status: "+r+" - confEndpointId: "+s+" - referTo: "+l);var u=a.a.connection.jingle.sessions[n];if("complete"===r){var d=i.calls[n];i.onCallTransferredToConference(d)}else u?o.transferCall(u,l,s,"web_"+c(),o.MEDIATYPE.WEBRTC).then((function(e){i.sendReferStatus(n,"complete")})):e.error("JINGLE  | refer.jingle -- no session ")}))}])},function(e,t,n){n.r(t);var r=n(18),i=n(2),a=n.n(i),o=n(26),s=n.n(o),c=n(31),l=n.n(c),u=n(64),d=n.n(u),h=n(6),f=n.n(h),p=n(1),m=n.n(p),v=n(19);angular.module("rainbow").service("companyDirectoryService",["$rootScope","$q","$log","$http","errorHelperService","centralizedService","directoryContact",function(e,t,n,i,o,c,u){var h=this,p=[];h.companies=[],h.start=function(e){n.info(""),n.info("[companyDirectoryService] === STARTING ===");var r=performance.now();h.portalURL=config.restServerUrl+"/api/rainbow/directory/v1.0/";var i=Math.round(performance.now()-r);return e.push({service:"companyDirectoryService",startDuration:i}),n.info("[companyDirectoryService] === STARTED ("+i+" ms) ==="),t.when()},h.stop=function(){var e;for(n.info(""),n.info("[companyDirectoryService] === STOPPING ===");e=p.pop();)e();return n.info("[companyDirectoryService] === STOPPED ==="),t.when()},h.getDirectoryContacts=function(e,r,s,c,l,d){return t((function(t,f){var p=h.portalURL+"entries?format="+(d||"full");if(p+="&companyId="+e,p+="&limit="+s,r&&(p+="&offset="+s*(r-1)),c)switch(l){case"phoneNumbers":case"tags":p+="&"+l+"="+encodeURIComponent(c);break;case"name":default:p+="&name="+encodeURIComponent(c)}i({method:"GET",url:p,headers:a.a.getRequestHeader()}).then((function(e){n.info("[companyDirectoryService] getDirectoryContacts success (found "+e.data.total+" contact(s))");var r=e.data.data,i=[];r.forEach((function(e){var t=u(e);i.push(t)})),t({contacts:i,limit:e.data.limit,offset:e.data.offset,total:e.data.total})}),(function(e){var t=o.handleError(e);f(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"getDirectoryContacts"))}))}))},h.createDirectoryContact=function(r){return t((function(t,s){i({method:"POST",url:h.portalURL+"entries",headers:a.a.getRequestHeader(),data:r}).then((function(r){var i=u(r.data.data);n.info("[companyDirectoryService] createDirectoryContact success"),e.$broadcast("ADMIN_DIRECTORY_CHANGE",i),t(i)}),(function(e){var t=o.handleError(e);s(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"createDirectoryContact"))}))}))},h.getDirectoryContact=function(e,r){return t((function(t,s){var c=h.portalURL+"entries/"+e+"?format="+(r||"full");i({method:"GET",url:c,headers:a.a.getRequestHeader()}).then((function(e){n.info("[companyDirectoryService] getDirectoryContact success");var r=u(e.data.data);t(r)}),(function(e){var t=o.handleError(e);s(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"getDirectoryContact"))}))}))},h.updateDirectoryContact=function(r){return t((function(t,s){i({method:"PUT",url:h.portalURL+"entries/"+r.id,headers:a.a.getRequestHeader(),data:r}).then((function(r){var i=u(r.data.data);n.info("[companyDirectoryService] updateDirectoryContact success"),e.$broadcast("ADMIN_DIRECTORY_CHANGE",i),t(i)}),(function(e){var t=o.handleError(e);s(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"updateDirectoryContact"))}))}))},h.deleteDirectoryContact=function(r){return t((function(t,s){i({method:"DELETE",url:h.portalURL+"entries/"+r,headers:a.a.getRequestHeader()}).then((function(){n.info("[companyDirectoryService] deleteDirectoryContact success"),e.$broadcast("ADMIN_DIRECTORY_CHANGE"),t()}),(function(e){var t=o.handleError(e);s(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"deleteDirectoryContact"))}))}))},h.getTags=function(e){return t((function(t,r){var s=h.portalURL+"entries/tags";e&&(s+="?companyId="+e),i({method:"GET",url:s,headers:a.a.getRequestHeader()}).then((function(e){n.info("[companyDirectoryService] getTags success"),t(e.data.data)}),(function(e){var t=o.handleError(e);r(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"getTags"))}))}))},h.getTagsStats=function(e){return t((function(t,r){var s=h.portalURL+"entries/tags/stats";e&&(s+="?companyId="+e),i({method:"GET",url:s,headers:a.a.getRequestHeader()}).then((function(e){var r=e.data.data.stats||[];n.info("[companyDirectoryService] getTagsStats success (find "+r.length+"tags(s))"),t(r)}),(function(e){var t=o.handleError(e);r(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"getTagsStats"))}))}))},h.renameTag=function(e,r,s){return t((function(t,c){var l=h.portalURL+"entries/tags?tag="+encodeURIComponent(e);s&&(l+="&companyId="+s),i({method:"PUT",url:l,headers:a.a.getRequestHeader(),data:{newTagName:r}}).then((function(i){n.info("[companyDirectoryService] renameTag success => old tag: "+e+" => new tag: "+r+": found "+i.data.data.found+" occurence(s)"),t()}),(function(e){var t=o.handleError(e);c(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"renameTag"))}))}))},h.deleteTag=function(e,r){return t((function(t,s){var c=h.portalURL+"entries/tags?tag="+encodeURIComponent(e);r&&(c+="&companyId="+r),i({method:"DELETE",url:c,headers:a.a.getRequestHeader()}).then((function(r){n.info("[companyDirectoryService] deleteTag success (tag "+e+": found "+r.data.data.found+" occurence(s)"),t()}),(function(e){var t=o.handleError(e);s(t),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"deleteTag"))}))}))},h.search=function(e,r){return t((function(t){var s=f.a.isFeatureEnabled(f.a.FeaturesEnum.SEARCH_BY_TAGS)?"search=":"name=",c=h.portalURL+"entries?format=full&"+s+encodeURIComponent(e);r&&(c+="&companyId="+r),i({method:"GET",url:c,headers:a.a.getRequestHeader()}).then((function(e){var r=e.data.data.map((function(e){return h.createAndUpdateContact(e)}));n.info("[companyDirectoryService] search success "+r.length),t(r)}),(function(e){t([]),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"search"))}))}))},h.searchCompanies=function(e,r){return t((function(t){var s=h.portalURL+"entries?format=full&companyName="+encodeURIComponent(e);r&&(s+="&companyId="+r),i({method:"GET",url:s,headers:a.a.getRequestHeader()}).then((function(e){n.info("[companyDirectoryService] searchCompanies success");var r=e.data.data.map((function(e){var t=v.Company.create(e.id,e.companyName);return t.country=e.country,h.getCompanyLogo(t),h.getCompanyBanner(t),h.companies[t.id]=t,t}));t(r)}),(function(e){t([]),n.error("[companyDirectoryService] "+o.getErrorFullMessage(e,"searchCompanies"))}))}))},h.getCompanyLogo=function(r){return t((function(t){var i=l.a.computeUserColor(r.name),a=r.name.substr(0,1);r.logo=l.a.getAvatarImage(r.id,a,i.color,130,r.lastAvatarUpdateDate),e.$broadcast("ON_COMPANY_LOGO_UPDATED",r.id),n.info("[companyService] getCompanyLogo - "+r.getNameForLogs()+" - success"),r.sendChangeEvent("logo"),t(r)}))},h.getCompanyBanner=function(i){return t((function(t){var a=new Image;a.onload=function(){i.banner=a,e.$broadcast("ON_COMPANY_BANNER_UPDATED",i.id),n.info("[getCompanyBanner] - "+i.getNameForLogs()+" - success"),t(i)},a.onerror=function(){n.error("[companyService] Load banner for "+i.getNameForLogs()+" failure"),t(i)};var o=window.rainbowSDK?null:"/cacheV2/images/company-banner-01.svg";if(i.lastBannerUpdateDate){var c=config.webservices.protocol+"://"+config.webservices.currentServer;s.a.cdn&&(c=s.a.cdnServer),o=c+"/api/banner/"+i.id+"?size=831",o+="&update="+Object(r.MD5)(r.enc.Latin1.parse(i.lastBannerUpdateDate)).toString(r.enc.Hex)}a.src=o}))},h.getCompanyById=function(e){if(!e)throw new Error("missing companyId");var t=h.companies[e];return n.info("[companyDirectoryService] getCompanyById (cache) "+e+" - success"),t},h.createAndUpdateContact=function(e){var t=m.a.createBasicContact(e.id,null,!1);return t.mobilePhones=e.mobilePhoneNumbers,t.businessPhones=e.workPhoneNumbers,t.email=e.eMail,t.updateName(e.firstName,e.lastName),t.getAvatar(),t.companyDirectoryFlag=!0,t.businessCompanyId=e.companyId,t.companyName=e.companyName,t.note1=e.custom1,t.note2=e.custom2,t.department=e.department,t.jobTitle=e.jobTitle,t.otherPhoneNumbers=e.otherPhoneNumbers,t.tags=e.tags?e.tags:void 0,t.city=e.city,t.postalCode=e.postalCode,t.street=e.street,t.state=d.a.getStateName(e.country,e.state),t.country=d.a.getCountryName(e.country),t},h.getAllDirectoryContacts=function(e){return t((function(n,r){var i;h.getDirectoryContacts(e,1,1e3).then((function(n){if(i=n,n.total>n.limit){var r=Math.ceil(n.total/1e3),a=Array.apply(null,Array(r-1));a=a.map((function(e,t){return t+2}));for(var o=[];a.length>0;)o.push(a.splice(0,5));return o.reduce((function(n,r){return n.then((function(){var n=r.map((function(t){return h.getDirectoryContacts(e,t,1e3).then((function(e){i.contacts=i.contacts.concat(e.contacts),i.limit+=e.limit}))}));return t.all(n)}))}),t.resolve())}})).then((function(){n(i)})).catch((function(e){r(e)}))}))},h.buildDirectoryCsvBlob=function(e){return t((function(t,r){n.info("[companyDirectoryService] === buildDirectoryCsvBlob ==="),h.getAllDirectoryContacts(e).then((function(e){var n=Math.max(1,e.contacts.reduce((function(e,t){return Math.max(e,t.workPhoneNumbers?t.workPhoneNumbers.length:0)}),0)),r=Math.max(1,e.contacts.reduce((function(e,t){return Math.max(e,t.mobilePhoneNumbers?t.mobilePhoneNumbers.length:0)}),0)),i=Math.max(1,e.contacts.reduce((function(e,t){return Math.max(e,t.otherPhoneNumbers?t.otherPhoneNumbers.length:0)}),0)),a=Array.apply(null,new Array(n)).map((function(e,t){return"workPhoneNumber"+t})),o=Array.apply(null,new Array(n)).map((function(){return";"})),s=Array.apply(null,new Array(r)).map((function(e,t){return"mobilePhoneNumber"+t})),c=Array.apply(null,new Array(r)).map((function(){return";"})),l=Array.apply(null,new Array(i)).map((function(e,t){return"otherPhoneNumber"+t})),u=Array.apply(null,new Array(i)).map((function(){return";"})),d=[];d.push("firstName;lastName;companyName;department;street;city;postalCode;state;country;"+a.join(";")+";"+s.join(";")+";"+l.join(";")+";jobTitle;eMail;custom1;custom2"),e.contacts.forEach((function(e){var t,n="";n+=e.firstName?e.firstName:"",n+=";",n+=e.lastName?e.lastName:"",n+=";",n+=e.companyName?e.companyName:"",n+=";",n+=e.department?e.department:"",n+=";",n+=e.street?e.street:"",n+=";",n+=e.city?e.city:"",n+=";",n+=e.postalCode?e.postalCode:"",n+=";",n+=e.state?e.state:"",n+=";",n+=e.country?e.country:"",n+=";",n+=(t=e.workPhoneNumbers&&e.workPhoneNumbers.length>0?e.workPhoneNumbers:[""]).map((function(e){return e})).join(";"),n+=o.slice(t.length).join(""),n+=";",n+=(t=e.mobilePhoneNumbers&&e.mobilePhoneNumbers.length>0?e.mobilePhoneNumbers:[""]).map((function(e){return e})).join(";"),n+=c.slice(t.length).join(""),n+=";",n+=(t=e.otherPhoneNumbers&&e.otherPhoneNumbers.length>0?e.otherPhoneNumbers:[""]).map((function(e){return e})).join(";"),n+=u.slice(t.length).join(""),n+=";",n+=e.jobTitle?e.jobTitle:"",n+=";",n+=e.eMail?e.eMail:"",n+=";",n+=e.custom1?e.custom1:"",n+=";",n+=e.custom2?e.custom2:"",d.push(n)}));var h=new Blob([d.join("\r\n")],{type:"text/csv; charset=utf-8"});t(h)})).catch((function(e){r(e)}))}))},h.exportDirectoryCsvFile=function(e){return t((function(t,r){n.info("[companyDirectoryService] === exportDirectoryCsvFile ===");var i,a="directory_"+moment().format("YYYY-MM-DD_HH-mm")+".csv";h.buildDirectoryCsvBlob(e).then((function(e){return i=e,c.fileSaver.promptFolderPathAndSavePromise(a)})).then((function(){c.fileSaver.fileDownload(i,null,null,a,!0),t()})).catch((function(e){r(e)}))}))}}])},function(e,t){angular.module("rainbow").service("browserService",[function(){this.extractBrowserVersion=function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}}])},function(e,t){angular.module("rainbow").service("gRTCStatsService",[function(){var e={};this.resetStatsForAllCalls=function(){e={}},this.resetStatsForCall=function(t){t in e&&delete e[t]},this.getCalls=function(){return e},this.nbCalls=function(){return Object.keys(e).length},this.hasStatsForCall=function(t){return t in e},this.addStreamToCall=function(t,n){t in e||(e[t]={});var r=e[t];r[n.id]={},r[n.id].stream=n},this.nbStreamsInACall=function(t){return t in e?Object.keys(e[t]).length:0},this.getBundlePolicyForCall=function(t){if(!(t in e))return"unknown";var n=e[t],r=0,i=this.nbStreamsInACall(t);for(var a in n)"selectedCandidatePairId"in n[a].stream&&r++;if(4===i)switch(r){case 0:return"failed";case 1:return"max-bundle";case 2:return"balanced";case 4:return"max-compat";default:return"unknown"}else{if(2!==i)return"unknown";switch(r){case 0:return"failed";case 1:return"max-bundle";case 2:return"max-compat";default:return"unknown"}}},this.addSSRCToStream=function(t,n){var r,i=null;"ssrc"===n.type&&t in e&&(r=e[t],n.transportId in r&&((i=r[n.transportId]).ssrc||(i.ssrc={}),i.ssrc[n.ssrc]=n))},this.hasSSRCInStream=function(t,n,r){var i,a;return t in e&&n in(i=e[t])&&!!(a=i[n]).ssrc&&r in a.ssrc},this.getSSRCMediaType=function(t,n,r){var i,a;return t in e&&n in(i=e[t])&&(a=i[n]).ssrc&&r in a.ssrc?a.ssrc[r].mediaType:"unknown"},this.getSSRCDirection=function(n,r,i){var a,o,s;return n in e&&r in(a=e[n])&&(o=a[r]).ssrc&&i in o.ssrc?(s=o.ssrc[i],t(s.id)):"unknown"},this.getSSRCAudioCodecName=function(t,n,r){var i,a;return t in e&&n in(i=e[t])&&(a=i[n]).ssrc&&r in a.ssrc?a.ssrc[r].googCodecName:"unknown"},this.isSSRCFlowing=function(n,r,i){var a,o,s;return n in e&&(r in(a=e[n])&&(!!(o=a[r]).ssrc&&(i in o.ssrc&&(s=o.ssrc[i],("IN"===t(s.id)?parseInt(s.bytesReceived,10):parseInt(s.bytesSent,10))>0))))},this.getStreamsDetailsFromCall=function(t){var n=null,r=null;if(!(t in e))return[];n=e[t];var i=[];for(var a in n)if(n.hasOwnProperty(a)){r=n[a];var o="no",s="no",c=!1,l=!1,u=!1,d=!1;for(var h in r.ssrc)if(r.ssrc&&r.ssrc.hasOwnProperty&&r.ssrc.hasOwnProperty(h)){var f=this.getSSRCMediaType(t,a,h),p=this.getSSRCDirection(t,a,h),m=this.isSSRCFlowing(t,a,h);"audio"===f&&"IN"===p&&m?c=!0:"audio"===f&&"OUT"===p&&m?u=!0:"video"===f&&"IN"===p&&m?l=!0:"video"===f&&"OUT"===p&&m&&(d=!0)}c&&u?o="IN|OUT":c?o="IN":u&&(o="OUT"),l&&d?s="IN|OUT":l?s="IN":d&&(s="OUT"),c||u||l||d?i.push({id:a,streams:{audio:o,video:s}}):i.push({id:a,streams:{}})}return i},this.getCodecDetailsFromCall=function(t){var n=null,r=null,i="-",a="-",o={codec:{audio:i,video:a}};if(!(t in e))return o;for(var s in n=e[t])if(n.hasOwnProperty(s))for(var c in(r=n[s]).ssrc)"audio"===r.ssrc[c].mediaType&&(i=this.getSSRCAudioCodecName(t,s,c)),"video"===r.ssrc[c].mediaType&&(a=this.getSSRCAudioCodecName(t,s,c));return o.codec.audio=i,o.codec.video=a,o};var t=function(e){return e.indexOf("recv")>-1?"IN":"OUT"}}])},function(e,t){angular.module("rainbow").service("fRTCStatsService",[function(){var e={};this.getCalls=function(){return e},this.nbCalls=function(){return Object.keys(e).length},this.addStreamToCall=function(t,n){if(!n.isRemote){t in e||(e[t]={});var r=e[t];r.streams||(r.streams={}),r.streams[n.id]={},r.streams[n.id]=n}},this.nbStreamsInACall=function(t){return t in e?Object.keys(e[t].streams).length:0},this.resetStatsForAllCalls=function(){e={}},this.resetStatsForCall=function(t){t in e&&delete e[t]},this.hasStatsForCall=function(t){return t in e},this.hasSSRCInStream=function(t,n,r){var i;return t in e&&!!(i=e[t]).streams&&n in i.streams&&i.streams[n].ssrc===r},this.hasStreamInCall=function(t,n){return t in e&&n in e[t].streams},this.getSSRCMediaType=function(t,n){var r;return t in e&&n in(r=e[t]).streams?r.streams[n].mediaType:"unknown"},this.getStreamsDetailsFromCall=function(n){var r=null;if(!(n in e))return[];r=e[n];var i=[];for(var a in r.streams)if(r.streams.hasOwnProperty(a)){var o=this.getSSRCMediaType(n,a),s=t(a);"audio"===o?i.push({id:a,streams:{audio:s}}):"video"===o&&i.push({id:a,streams:{video:s}})}return i},this.addCandidatePairToCall=function(t,n){var r=null,i=!1;if(t in e){(r=e[t]).candidatesPairs||(r.candidatesPairs=[]);for(var a=0;a<r.candidatesPairs.length;a++)if(r.candidatesPairs[a].id===n.id){i=!0;break}!i&&"succeeded"===n.state&&n.selected&&r.candidatesPairs.push(n)}},this.getNbCandidatePairs=function(t){var n,r=0;return t in e?((n=e[t]).candidatesPairs&&(r=n.candidatesPairs.length),r):r},this.getBundlePolicyForCall=function(t){var n="unknown";if(!(t in e))return n;switch(this.getNbCandidatePairs(t)){case 0:n="failed";break;case 1:n="max-bundle";break;case 2:n=this.nbStreamsInACall(t)>2?"balanced":"max-compat";break;default:n="max-compat"}return n};var t=function(e){return e.indexOf("inbound")>-1?"IN":"OUT"}}])},function(e,t,n){n.r(t);var r=n(5),i=n.n(r),a=n(2),o=n.n(a),s=n(4),c=n.n(s);angular.module("rainbow").service("platformService",["$log","$rootScope","$window","$interval","$q","$filter","$http","errorHelperService",function(e,t,n,r,a,s,l,u){var d=this,h=[],f=null;d.$q=a,this.isWin=navigator.platform.toUpperCase().indexOf("WIN")>=0,d.start=function(n){return a((function(i,a){var o=performance.now();e.info(""),e.info("[platformService] === STARTING ==="),d.languages=["en","fr","es","de"],h.push(t.$on("$translateChangeSuccess",(function(){d.fixDeviceLabels()}))),h.push(t.$on("ON_INPUT_DEVICE_CHANGED_EVENT",_)),h.push(t.$on("ON_OUTPUT_DEVICE_CHANGED_EVENT",w)),f=c.a.subscribeToConnectionEvents((function(e){d.onAuthenticationStatusChangedEvent(e)})),d.isAskingMedia=!1,d.hasAudioPermission=!1,d.hasVideoPermission=!1,d.stopWatcher(),r(d.startWatcher,2e3,1);var s=Math.round(performance.now()-o);n.push({service:"platformService",startDuration:s}),e.info("[platformService] === STARTED ("+s+" ms) ==="),i()}))},d.stop=function(){return e.info("[platformService] === STOPPING ==="),h.forEach((function(e){e()})),f&&f.unsubscribe(),d.stopWatcher(),this.mediaDevicesLength=0,this.mediaDevices=[],e.info("[platformService] === STOPPED ==="),a.when()},d.onAuthenticationStatusChangedEvent=function(t){"ON_XMPP_CONNECTED"===t.name&&(!d.allowDevicesManagement()||!$("#globalAudioTag")[0]||$("#globalAudioTag")[0].sinkId&&"default"!==$("#globalAudioTag")[0].sinkId||(e.info("[platformService] onAuthenticationStatusChangedEvent -- update global audio tag"),d.getCurrentSpeaker().then((function(e){e&&e.id&&T(e.id)}))),d.testGetUserMedia())},this.audioDevices=0,this.videoDevices=0,this.detectRTCLoaded=function(){d.hasAudioPermission=DetectRTC.isWebsiteHasMicrophonePermissions,d.hasVideoPermission=DetectRTC.isWebsiteHasWebcamPermissions,d.fixDeviceLabels();var t=!1,n=!1,r=d.shouldAskGetUserMedia();(DetectRTC.audioInputDevices&&DetectRTC.audioInputDevices.length||DetectRTC.audioOutputDevices&&DetectRTC.audioOutputDevices.length)&&(!d.hasAudioPermission||r.audio?t=!0:m=!0),DetectRTC.videoInputDevices&&DetectRTC.videoInputDevices.length&&(!d.hasVideoPermission||r.video?n=!0:p=!0),t||n?d.isAskingMedia||(d.isAskingMedia=!0,d.getUserMedia(t,n)):(d.fixDeviceLabels(),A().then((function(){d.updateNewDesktopDevicesIds(),C(),d.audioDevices!==DetectRTC.audioInputDevices.length+DetectRTC.audioOutputDevices.length&&(d.audioDevices=DetectRTC.audioInputDevices.length+DetectRTC.audioOutputDevices.length,d.audioMediaDeviceUpdated()),d.videoDevices!==DetectRTC.videoInputDevices.length&&(d.videoDevices=DetectRTC.videoInputDevices.length,d.videoMediaDeviceUpdated()),angular.forEach(DetectRTC.MediaDevices,(function(t){t&&e.info("[PlatformService] DetectRTC.MediaDevices device "+t.id+" with kind "+t.kind+" with label "+t.label)})),d.getCurrentSpeaker().then((function(e){e&&e.id&&T(e.id)})),d.newDevice&&d.checkAndUpdateHandFreeProfile(),d.startWatcher()})))},this.testGetUserMedia=function(){if(d.hasAudioPermission){var t=performance.now();d.getCurrentMicrophone().then((function(n){var r={},i="default";n?(r.audio={optional:[{sourceId:n.id}]},i="id - "+n.id+" and label "+n.label):r.audio=!0,e.info("[PlatformService] testGetUserMedia -- getUserMedia for Mic "+i),navigator.mediaDevices.getUserMedia(r).then((function(n){var r=Math.round(performance.now()-t);e.info("[PlatformService] testGetUserMedia -- getUserMedia success for time : "+r+" ms"),angular.forEach(n.getTracks(),(function(t){e.info("[PlatformService] testGetUserMedia mediaStreamTrack -- "+t.label),t.stop()})),m=!0,d.isAskingMedia=!1})).catch((function(t){e.info("[PlatformService] testGetUserMedia -- getUserMedia error "+t),d.isAskingMedia=!1}))}))}else e.info("[PlatformService] testGetUserMedia -- no audio permission given")},this.shouldAskGetUserMedia=function(){var t={audio:!1,video:!1};return angular.forEach(DetectRTC.MediaDevices,(function(e){e&&e.label&&-1!==e.label.indexOf("invoke getUserMedia")&&("audioinput"===e.kind||"audiooutput"===e.kind?t.audio=!0:t.video=!0)})),e.info("[platformService] shouldAskGetUserMedia : audio "+t.audio+" and video "+t.video),t},this.updateNewDesktopDevicesIds=function(){var e=i.a.getSetting("handFreeInputDeviceName"),t=i.a.getSetting("handFreeOutputDeviceName"),n=i.a.getSetting("headsetDeviceName"),r=i.a.getSetting("customMicrophoneName"),a=i.a.getSetting("customSpeakerName"),o=i.a.getSetting("cameraUsed"),s=i.a.getSetting("ringingSpeakerName");(e||t||n||r||a)&&angular.forEach(DetectRTC.MediaDevices,(function(o){"audioinput"===o.kind?(o.normalizedLabel===n&&i.a.setSetting("headsetMicrophone",o.id),o.normalizedLabel===e&&i.a.setSetting("microphone",o.id),o.normalizedLabel===r&&i.a.setSetting("customMicrophone",o.id)):"audiooutput"===o.kind&&(o.normalizedLabel===n&&i.a.setSetting("headsetSpeaker",o.id),o.normalizedLabel===t&&i.a.setSetting("speaker",o.id),o.normalizedLabel===a&&i.a.setSetting("customSpeaker",o.id))})),o&&angular.forEach(DetectRTC.MediaDevices,(function(e){"videoinput"===e.kind&&e.label===o&&i.a.setSetting("camera",e.id)})),s&&angular.forEach(DetectRTC.MediaDevices,(function(e){"audiooutput"===e.kind&&e.normalizedLabel===s&&i.a.setSetting("ringingSpeaker",e.id)}))},this.mediaDevicesLength=0,this.mediaDevices=[],this.newDevice=null,this.devicesWatcher=function(){navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then((function(t){(d.mediaDevicesLength!==t.length||d.checkForIdChange(t))&&(e.debug("[platformService] MediaDevices count changed ! from "+d.mediaDevicesLength+" to "+t.length),e.debug("[platformService] MediaDevices brut devices list "+JSON.stringify(t)),t.length-d.mediaDevicesLength==1?d.newDevice=d.getNewDevice(d.mediaDevices,t):d.newDevice=null,d.mediaDevicesLength=t.length,d.mediaDevices=t,d.stopWatcher(),DetectRTC.load(d.detectRTCLoaded))}))},d.checkAndUpdateHandFreeProfile=function(){e.info("[platformService] checkAndUpdateHandFreeProfile");var n=d.getActiveAudioProfile();1===n.key&&!0===n.available&&d.getCurrentSpeaker().then((function(n){n&&n.groupId===d.newDevice.groupId&&(e.info("[platformService] checkAndUpdateHandFreeProfile -- should update the Jack Mic"),t.$broadcast("ON_HANDFREE_JACK_MICROPHONE_EVENT",d.newDevice))}))},d.checkForIdChange=function(t){var n=!1;return d.mediaDevices.length&&angular.forEach(d.mediaDevices,(function(e){if("default"!==e.deviceId&&"communications"!==e.deviceId){for(var r=!1,i=0;i<t.length;i++)e.deviceId===t[i].deviceId&&(r=!0);r||(n=!0)}})),n&&e.info("[platformService] checkForIdChange "+n),n},d.getNewDevice=function(e,t){var n=null;return t.length&&angular.forEach(t,(function(t){if("default"!==t.deviceId&&"communications"!==t.deviceId){for(var r=!1,i=0;i<e.length;i++)t.deviceId===e[i].deviceId&&(r=!0);r||"audioinput"!==t.kind||(n=t)}})),n},d.tryToGetUserMediaForEachDevice=function(){e.info("[platformService] tryToGetUserMediaForEachDevice"),DetectRTC.audioInputDevices&&DetectRTC.audioInputDevices.length?function(){for(var n=a.when(),r=0;r<DetectRTC.audioInputDevices.length;r++)!function(e){var t=DetectRTC.audioInputDevices[e];n=n.then((function(){return d.getUserMediaForAudioDevice(t.id)}))}(r);n=n.finally((function(){if(e.info("[platformService] tryToGetUserMediaForEachDevice finally -- has audio permission "+d.hasAudioPermission),d.hasAudioPermission)d.loadDetectRTC();else{m=!1,p=!1,d.isAskingMedia=!1;t.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"information",popupBody:"devicePermission",okLabel:"ok"}),d.startWatcher()}}))}():(e.warn("[platformService] tryToGetUserMediaForEachDevice -- no audio devices found, restart the watcher"),d.isAskingMedia=!1,d.startWatcher())},d.getUserMediaForAudioDevice=function(t){return a((function(n){if(d.hasAudioPermission)return e.info("[platformService] getUserMediaForAudioDevice for id: "+t+" no longer needed !"),void n();if(!t)return e.info("[platformService] getUserMediaForAudioDevice missing id !"),void n();e.info("[platformService] getUserMediaForAudioDevice for id: "+t);var r={};r.audio={optional:[{sourceId:t}]},navigator.mediaDevices.getUserMedia(r).then((function(r){e.info("[platformService] getUserMediaForAudioDevice for id: "+t+" success"),angular.forEach(r.getAudioTracks(),(function(e){e.stop()})),d.hasAudioPermission=!0,m=!0,d.hasVideoPermission=!0,p=!0,n()})).catch((function(r){e.info("[platformService] getUserMediaForAudioDevice for id: "+t+" failed with error "+r),n()}))}))},d.getUserMedia=function(t,n){e.info("[platformService] getUserMedia audio: "+t+" and video: "+n),navigator.mediaDevices.getUserMedia({audio:t,video:n}).then((function(r){e.info("[platformService] getUserMedia audio: "+t+" and video: "+n+" -- success!"),angular.forEach(r.getAudioTracks(),(function(e){e.stop()})),angular.forEach(r.getVideoTracks(),(function(e){e.stop()})),t&&(d.hasAudioPermission=!0,m=!0),n&&(d.hasVideoPermission=!0,p=!0),r=null,d.loadDetectRTC()})).catch((function(t){e.error("[platformService] getUserMedia -- error -- "+t),d.tryToGetUserMediaForEachDevice()}))},d.loadDetectRTC=function(){DetectRTC.load((function(){d.fixDeviceLabels(),A().then((function(){d.updateNewDesktopDevicesIds(),C(),d.isAskingMedia=!1,d.audioDevices!==DetectRTC.audioInputDevices.length+DetectRTC.audioOutputDevices.length&&(d.audioDevices=DetectRTC.audioInputDevices.length+DetectRTC.audioOutputDevices.length,d.audioMediaDeviceUpdated()),d.videoDevices!==DetectRTC.videoInputDevices.length&&(d.videoDevices=DetectRTC.videoInputDevices.length,d.videoMediaDeviceUpdated()),angular.forEach(DetectRTC.MediaDevices,(function(t){t&&e.info("[PlatformService] DetectRTC.MediaDevices device "+t.id+" with kind "+t.kind+" with label "+t.label)})),d.getCurrentSpeaker().then((function(e){e&&e.id&&T(e.id)})),d.startWatcher()}))}))},d.getWhatsNewVersions=function(t){return a((function(n){var r=config.restServerUrl+"/api/rainbow/applications/v1.0/release-notes?format=full";t&&(r+="&limit="+t);var i=o.a.getRequestHeader();fetch(r,{method:"GET",headers:i}).then((function(t){if(!t.ok)throw t;t.json().then((function(t){e.info("[adminPlatformService] getWhatsNewVersions -- success"),n(t.data)}))}))}))},d.getWhatsNew=function(){return a((function(t){var n=config.restServerUrl+"/api/rainbow/enduser/v1.0/settings/changelogs";l({method:"GET",url:n,headers:o.a.getRequestHeader()}).then((function(n){e.info("[adminPlatformService] getWhatsNew -- success");var r=n.data.data.changeLog.split("\xa7%\xa7"),i={};r.forEach((function(e,t){i[d.languages[t]]=e})),Object.keys(i).forEach((function(e){0===i[e].length&&(i[e]=i.en)})),i.en||(i={en:"",fr:"",es:"",de:""}),t(i)}),(function(n){t({en:"",fr:"",es:"",de:""}),e.error("[adminPlatformService] "+u.getErrorFullMessage(n,"getWhatsNew"))}))}))},d.getAvailableLanguage=function(e){var t=e.split("-")[0];return d.languages.find((function(e){return e===t}))||"en"},this.isDesktop=function(){return navigator.userAgent.indexOf(" Rainbow/")>=0},this.allowDevicesManagement=function(){return n.chrome||this.isDesktop()};var p=!1;this.isWebsiteHasWebcamPermissions=function(){return!!d.allowDevicesManagement()&&p};var m=!1;this.isWebsiteHasMicrophonePermissions=function(){return!!d.allowDevicesManagement()&&m};var v={HANDFREE:{key:1,value:"handfree",available:!1},HEADSET:{key:2,value:"headset",available:!1},SPEAKERPHONE:{key:3,value:"speakerphone",available:!1},CUSTOM:{key:4,value:"custom",available:!1}};this.audioProfileEnum=v,this.getAudioProfiles=function(){return v},this.currentAudioProfile=v.HANDFREE,this.getCurrentAudioProfile=function(){var e=null;switch(i.a.getSetting("audioProfile")){case v.HEADSET.value:e=v.HEADSET;break;case v.HANDFREE.value:e=v.HANDFREE;break;case v.SPEAKERPHONE.value:e=v.SPEAKERPHONE;break;case v.CUSTOM.value:e=v.CUSTOM;break;default:e=v.HANDFREE,i.a.setSetting("audioProfile",e.value)}return e},this.getActiveAudioProfile=function(){var e=this.getCurrentAudioProfile();return e.key===v.HANDFREE.key||e.available?e:v.HANDFREE},this.setCurrentAudioProfile=function(e){e&&(d.currentAudioProfile=e)},this.isHandfreeAvailable=function(){return d.isHandfreeMicrophoneAvailable()&&d.isHandfreeSpeakerAvailable()},this.isHeadsetAvailable=function(){return d.isHeadsetMicrophoneAvailable()&&d.isHeadsetSpeakerAvailable()},this.isSpeakerphoneAvailable=function(){return d.isSpeakerphoneMicrophoneAvailable()&&d.isSpeakerphoneSpeakerAvailable()},this.isCustomAvailable=function(){return d.isCustomMicrophoneAvailable()&&d.isCustomSpeakerAvailable()},this.getCurrentMicrophone=function(){if("sdk"===i.a.getSetting("apiMode")){var e=d.getMicrophoneForSDK();if(e)return e}switch(d.getActiveAudioProfile()){case v.SPEAKERPHONE:return d.getSpeakerphoneMicrophone();case v.CUSTOM:return d.getCustomMicrophone();case v.HEADSET:return d.getHeadsetMicrophone();default:return d.getHandfreeMicrophone()}},this.getMicrophoneForSDK=function(){var e=a.defer();return d.getMicrophones().then((function(t){e.resolve(d.getDeviceWithId(t,i.a.getSetting("microphone")))})),e.promise},this.getSecondRingerStatusFromSettings=function(){return i.a.getSetting("hasSecondRinger")},this.setSecondRingerStatusFromSettings=function(e){return i.a.setSetting("hasSecondRinger",e)},this.getHandfreeMicrophoneFromSettings=function(){return i.a.getSetting("microphone")},this.getHandfreeMicrophone=function(){var e=a.defer();return d.getMicrophones().then((function(t){e.resolve(d.getDeviceWithId(t,d.getHandfreeMicrophoneFromSettings()))})),e.promise},this.getHeadsetMicrophoneFromSettings=function(){return i.a.getSetting("headsetMicrophone")},this.getHeadsetMicrophone=function(){var e=a.defer();return d.getMicrophones().then((function(t){e.resolve(d.getDeviceWithId(t,d.getHeadsetMicrophoneFromSettings()))})),e.promise},this.getHeadsetDeviceName=function(){var e=a.defer();return e.resolve(i.a.getSetting("headsetDeviceName")),e.promise},this.getSpeakerphoneMicrophoneFromSettings=function(){return i.a.getSetting("speakerphoneMicrophone")},this.getSpeakerphoneMicrophone=function(){var e=a.defer();return d.getMicrophones().then((function(t){e.resolve(d.getDeviceWithId(t,d.getSpeakerphoneMicrophoneFromSettings()))})),e.promise},this.getSpeakerphoneDeviceName=function(){var e=a.defer();return e.resolve(i.a.getSetting("speakerphoneDeviceName")),e.promise},this.getCustomMicrophoneFromSettings=function(){return i.a.getSetting("customMicrophone")},this.getCustomMicrophone=function(){var e=a.defer();return d.getMicrophones().then((function(t){e.resolve(d.getDeviceWithId(t,d.getCustomMicrophoneFromSettings()))})),e.promise},this.getMicrophones=function(){var t=a.defer();return this.allowDevicesManagement()||t.resolve([]),d.getAudioInputDevices().then((function(e){t.resolve(e&&e.constructor===Array&&m?e:[])})).catch((function(n){return e.info("[PlatformService] === SERVICES FAILURE === : "+n.message),t.reject(n),t.promise})),t.promise},this.isHandfreeMicrophoneAvailable=function(){return d.isDeviceAvailable(d.mediaDevices,d.getHandfreeMicrophoneFromSettings(),"audioinput")},this.isHeadsetMicrophoneAvailable=function(){return d.isDeviceAvailable(d.mediaDevices,d.getHeadsetMicrophoneFromSettings(),"audioinput")},this.isSpeakerphoneMicrophoneAvailable=function(){return d.isDeviceAvailable(d.mediaDevices,d.getSpeakerphoneMicrophoneFromSettings(),"audioinput")},this.isCustomMicrophoneAvailable=function(){return d.isDeviceAvailable(d.mediaDevices,d.getCustomMicrophoneFromSettings(),"audioinput")},this.getCurrentSpeaker=function(){if("sdk"===i.a.getSetting("apiMode")){var e=d.getSpeakerForSDK();if(e)return e}switch(d.getActiveAudioProfile()){case v.SPEAKERPHONE:return d.getSpeakerphoneSpeaker();case v.CUSTOM:return d.getCustomSpeaker();case v.HEADSET:return d.getHeadsetSpeaker();default:return d.getHandfreeSpeaker()}},this.getSpeakerForSDK=function(){var e=a.defer();return d.getSpeakers().then((function(t){e.resolve(d.getDeviceWithId(t,i.a.getSetting("speaker")))})),e.promise},this.getHandfreeSpeakerFromSettings=function(){return i.a.getSetting("speaker")},this.getHandfreeSpeaker=function(){var e=a.defer();return d.getSpeakers().then((function(t){e.resolve(d.getDeviceWithId(t,d.getHandfreeSpeakerFromSettings(),!0))})),e.promise},this.getHeadsetSpeakerFromSettings=function(){return i.a.getSetting("headsetSpeaker")},this.getHeadsetSpeaker=function(){var e=a.defer();return d.getSpeakers().then((function(t){e.resolve(d.getDeviceWithId(t,d.getHeadsetSpeakerFromSettings()))})),e.promise},this.getSpeakerphoneSpeakerFromSettings=function(){return i.a.getSetting("speakerphoneSpeaker")},this.getSpeakerphoneSpeaker=function(){var e=a.defer();return d.getSpeakers().then((function(t){e.resolve(d.getDeviceWithId(t,d.getSpeakerphoneSpeakerFromSettings()))})),e.promise},this.getCustomSpeakerFromSettings=function(){return i.a.getSetting("customSpeaker")},this.getCustomSpeaker=function(){var e=a.defer();return d.getSpeakers().then((function(t){e.resolve(d.getDeviceWithId(t,d.getCustomSpeakerFromSettings()))})),e.promise},this.getRingingSpeakerFromSettings=function(){return i.a.getSetting("ringingSpeaker")},this.getRingingSpeaker=function(){var e=a.defer();return d.getSpeakers().then((function(t){e.resolve(d.getDeviceWithId(t,d.getRingingSpeakerFromSettings()))})),e.promise},this.setSpeakerForElement=function(t,n){var r=a.defer();if(!t||!t.setSinkId)return e.warn("[platformService] setSpeakerForElement -- missing element"),a.when();if(this.allowDevicesManagement()){if(n===t.sinkId)return a.when();t.id&&e.log("[platformService] setSpeakerForElement "+t.id+" with "+n),t.setSinkId(n).then((function(){e.log("[platformService] Success, audio output device attached: "+n),angular.element("#globalAudioTag")[0]&&e.log("[platformService] sinkId for globalAudioTag is "+angular.element("#globalAudioTag")[0].sinkId),r.resolve()})).catch((function(t){var n=t;"SecurityError"===t.name&&(n="[platformService] You need to use HTTPS for selecting audio output device: "+t),e.error("[platformService] "+n),r.resolve()}))}else e.warn("[platformService] Browser does not support output device selection."),r.resolve();return r.promise},this.getSpeakers=function(){var t=a.defer();return d.allowDevicesManagement()||t.resolve([]),d.getAudioOutputDevices().then((function(e){t.resolve(e&&e.constructor===Array&&m?e:[])})).catch((function(n){return e.info("[PlatformService] === SERVICES FAILURE === : "+n.message),t.reject(n),t.promise})),t.promise},this.isHandfreeSpeakerAvailable=function(){return d.isDeviceAvailable(d.mediaDevices,d.getHandfreeSpeakerFromSettings(),"audiooutput")};var g=!1;this.isHeadsetSpeakerAvailable=function(){return d.isDeviceAvailable(d.mediaDevices,d.getHeadsetSpeakerFromSettings(),"audiooutput")};var y=null;this.isSpeakerphoneSpeakerAvailable=function(){return d.isDeviceAvailable(d.mediaDevices,d.getSpeakerphoneSpeakerFromSettings(),"audiooutput")};var b=!1;this.isCustomSpeakerAvailable=function(){return d.isDeviceAvailable(d.mediaDevices,d.getCustomSpeakerFromSettings(),"audiooutput")};var S=!1;function _(){C(),d.isAskingMedia?e.info("[PlatformService] onAudioInputChange -- already asking media -- ignore"):(d.isAskingMedia=!0,r(d.testGetUserMedia,2e3,1))}function C(){var n;n=d.isHandfreeAvailable(),g!==n&&(e.info("[PlatformService] Handfree is now "+(n?"available":"unavailable")),g=n,v.HANDFREE.available=n,t.$broadcast("ON_AUDIO_PROFILE_CHANGED_EVENT",n),t.$broadcast("ON_INPUT_DEVICE_CHANGED_EVENT"),n||d.getCurrentSpeaker().then((function(e){e&&e.id&&T(e.id)}))),function(n){y!==n&&(e.info("[PlatformService] Headset is now "+(n?"available":"unavailable")),y=n,v.HEADSET.available=n,n?i.a.getSetting("audioProfile")===v.HANDFREE.value&&(i.a.setSetting("audioProfile",v.HEADSET.value),d.getCurrentSpeaker().then((function(e){e&&e.id&&T(e.id)}))):(i.a.getSetting("audioProfile")===v.HEADSET.value&&i.a.setSetting("audioProfile",v.HANDFREE.value),d.getCurrentSpeaker().then((function(e){e&&e.id&&T(e.id)}))),t.$broadcast("ON_AUDIO_PROFILE_CHANGED_EVENT",n),t.$broadcast("ON_INPUT_DEVICE_CHANGED_EVENT"))}(d.isHeadsetAvailable()),function(n){b!==n&&(e.info("[PlatformService] Speakerphone is now "+(n?"available":"unavailable")),b=n,v.SPEAKERPHONE.available=n,t.$broadcast("ON_AUDIO_PROFILE_CHANGED_EVENT",n),t.$broadcast("ON_INPUT_DEVICE_CHANGED_EVENT"),n||d.getCurrentSpeaker().then((function(e){e&&e.id&&T(e.id)})))}(d.isSpeakerphoneAvailable()),function(n){S!==n&&(e.info("[PlatformService] Custom is now "+(n?"available":"unavailable")),S=n,v.CUSTOM.available=n,t.$broadcast("ON_AUDIO_PROFILE_CHANGED_EVENT",n),t.$broadcast("ON_INPUT_DEVICE_CHANGED_EVENT"),n||d.getCurrentSpeaker().then((function(e){e&&e.id&&T(e.id)})))}(d.isCustomAvailable())}function w(t,n){C(),e.info("[PlatformService] updateOutputDevice "+n),d.allowDevicesManagement()&&n&&T(n)}var E="";function T(t){e.info("[PlatformService] updateCurrentOutputDevice "+t),angular.element("#globalAudioTag")[0]&&angular.element("#globalAudioTag")[0].sinkId!==t&&E!==t?(E=t,e.info("[PlatformService] updateCurrentOutputDevice current ID "+angular.element("#globalAudioTag")[0].sinkId+" new id "+t),d.setSpeakerForElement(angular.element("#globalAudioTag")[0],"default").then((function(){d.setSpeakerForElement(angular.element("#globalAudioTag")[0],t),E=""})).catch((function(){E=""}))):e.info("[PlatformService] updateCurrentOutputDevice -- ignored ")}var k=[],M=[],D=[],x=[],R=[],O=!0,I=["realtek","soundmax","high definition audio","nomachine"];d.arrayContains=function(e,t){return e.some((function(e){return t.indexOf(e)>-1}))},d.getDeviceType=function(e){return e=e.toLowerCase(),d.arrayContains(I,e)?v.HANDFREE:v.HEADSET},this.normalizeAnyLabel=function(e){return e?("default"===e.id||"communications"===e.id||e.normalizedLabel||(d.isWin?-1!==e.label.indexOf("Realtek Audio")||-1!==e.label.indexOf("Realtek(R) Audio")?e.normalizedLabel=e.label:e.normalizedLabel=e.label.substring(e.label.indexOf("(")+1,e.label.indexOf(")")):e.normalizedLabel=e.label),e):null};var P,A=function(){var n=a.defer();return d.getMicrophones().then((function(e){return k=e,d.getSpeakers()})).then((function(r){M=r;var a=[];angular.forEach(k,(function(e){"default"!==e.id&&"communications"!==e.id&&(e=d.normalizeAnyLabel(e),a.some((function(t){return t.microphone.normalizedLabel===e.normalizedLabel}))||angular.forEach(M,(function(t){if(t=d.normalizeAnyLabel(t),e.normalizedLabel===t.normalizedLabel&&d.getDeviceType(e.normalizedLabel)===v.HEADSET){var n={label:e.normalizedLabel,microphone:e,speaker:t};a.push(n),O&&D.push(n)}})))}));var o=i.a.getSetting("headsetDeviceName");o&&"null"!==o||!a.length||(o=a[0].label,i.a.setSetting("headsetDeviceName",a[0].label),i.a.setSetting("headsetMicrophone",a[0].microphone.id),i.a.setSetting("headsetSpeaker",a[0].speaker.id));var s=i.a.getSetting("ringingSpeakerName");if((!s||"null"===s)&&M.length)for(var c=0;c<M.length;c++)if("default"!==M[c].id&&"communications"!==M[c].id){i.a.setSetting("ringingSpeakerName",M[c].normalizedLabel),i.a.setSetting("ringingSpeaker",M[c].id);break}var l=[];O||(angular.forEach(a,(function(e){x.some((function(t){return t.label===e.label}))||(l.push(e),D.push(e))})),l.length>0&&(e.info("[PlatformService] hotplugged headset(s): "+(l.length>1?l.reduce((function(e,t){return{label:e.Label+", "+t.Label}})).label:l[0].label)),t.$broadcast("ON_AUDIO_HOTPLUG_DEVICES_CHANGED_EVENT",{devices:l,action:"add"})));var u=[];!O&&x.length>a.length&&(angular.forEach(x,(function(e){if(!a.some((function(t){return t.label===e.label}))){u.push(e);var t=D.map((function(e){return e.label})).indexOf(e.label);D.splice(t,1)}})),u.length>0&&(e.info("[PlatformService] unplugged headset(s): "+(u.length>1?u.reduce((function(e,t){return{label:e.Label+", "+t.Label}})).label:u[0].label)),t.$broadcast("ON_AUDIO_HOTPLUG_DEVICES_CHANGED_EVENT",{devices:u,action:"remove"}))),O=!1,x=a,n.resolve(a)})),n.promise};this.getHeadsetDevices=function(){return x},this.getSpeakerphoneDevices=function(){return R},this.getAllDevices=function(){return D},this.getHandFreeDevice=function(){var e=a.defer();return d.getHandfreeMicrophone().then((function(t){var n=t;d.getHandfreeSpeaker().then((function(t){var r=t;(!d.handFreeDevice||d.handFreeDevice.microphone&&d.handFreeDevice.microphone.id!==n.id||d.handFreeDevice.speaker&&d.handFreeDevice.speaker.id!==r.id)&&(d.handFreeDevice={label:"",microphone:n,speaker:r,profile:v.HANDFREE}),e.resolve(d.handFreeDevice)}))})),e.promise},this.getCustomDevice=function(){var e=a.defer();return d.getCustomMicrophone().then((function(t){var n=t;d.getCustomSpeaker().then((function(t){var r=t;(!d.customDevice||d.customDevice.microphone&&d.customDevice.microphone.id!==n.id||d.customDevice.speaker&&d.customDevice.speaker.id!==r.id)&&(d.customDevice={label:"",microphone:n,speaker:r,profile:v.CUSTOM}),e.resolve(d.customDevice)}))})),e.promise},this.getAvailableDevices=function(){var e=a.defer(),t=[];return d.getHandFreeDevice().then((function(n){t.push(n),x.forEach((function(e){e.profile=v.HEADSET,t.push(e)})),R.forEach((function(e){e.profile=v.SPEAKERPHONE,t.push(e)})),d.getCustomDevice().then((function(n){t.push(n),e.resolve(t)}))})),e.promise},this.getStoredDeviceList=function(){return i.a.getSetting("deviceList")},this.saveDeviceList=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n].label;i.a.setSetting("deviceList",angular.toJson(t))},this.getCurrentCamera=function(){var e=a.defer();return d.getCameras().then((function(t){e.resolve(d.getDeviceWithId(t,i.a.getSetting("camera")))})),e.promise},this.getCameraForSDK=function(){return{id:i.a.getSetting("camera")}},this.getCameras=function(){var t=a.defer();return this.allowDevicesManagement()||t.resolve([]),d.getVideoInputDevices().then((function(e){t.resolve(e&&e.constructor===Array&&p?e:[])})).catch((function(n){return e.info("[PlatformService] === SERVICES FAILURE === : "+n.message),t.reject(n),t.promise})),t.promise},this.isDeviceAvailable=function(e,t,n){var r=e.find((function(e){return e.kind===n&&e.deviceId===t}));return angular.isDefined(r)},this.getDeviceWithId=function(e,t,n){if(e.constructor!==Array)return null;var r=null;if("default"===t||"communications"===t)if(n){var i=d.mediaDevices.find((function(e){return e.deviceId===t&&"audioinput"===e.kind}));i&&(r=e.find((function(e){return"default"!==e.id&&"communications"!==e.id&&i.groupId===e.groupId})))}else{var a=e.find((function(e){return e.id===t}));a&&(r=e.find((function(e){return"default"!==e.id&&"communications"!==e.id&&a.groupId===e.groupId})))}if(r)return r;if(!(r=e.find((function(e){return e.id===t})))){if(n){var o=d.mediaDevices.find((function(e){return"default"===e.deviceId&&"audioinput"===e.kind}));o&&(r=e.find((function(e){return"default"!==e.id&&"communications"!==e.id&&o.groupId===e.groupId})))}if(!r){var s=e.find((function(e){return"default"===e.id}));s&&(r=e.find((function(e){return"default"!==e.id&&"communications"!==e.id&&s.groupId===e.groupId})))}}return r||(e.length>0?e[0]:null)},this.startWatcher=function(){if(d.allowDevicesManagement()){if(angular.isDefined(P))return;P=r(d.devicesWatcher,1e3)}},this.stopWatcher=function(){angular.isDefined(P)&&(r.cancel(P),P=void 0)},this.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},this.fixDeviceLabels=function(){angular.forEach(DetectRTC.MediaDevices,(function(t){t&&t.id&&("default"!==t.id||t.label&&"Default"!==t.label?t.id.length<64&&"Please invoke getUserMedia once."===t.label&&(t.label=d.capitalizeFirstLetter(t.id)):t.label=d.findAndUpdateDefaultDeviceLabel(t.kind,t.groupId),e.info("[PlatformService] fixDeviceLabels || update device "+t.id+" with kind "+t.kind+" with label "+t.label))}))},this.findAndUpdateDefaultDeviceLabel=function(e,t){for(var n="audioinput"===e?s("translate")("yourComputerMicrophoneDevice"):s("translate")("yourComputerSpeakerDevice"),r=0;r<DetectRTC.MediaDevices.length;r++)if("default"!==DetectRTC.MediaDevices[r].id&&DetectRTC.MediaDevices[r].kind===e&&DetectRTC.MediaDevices[r].groupId===t){n=n+" - "+DetectRTC.MediaDevices[r].label;break}return n},this.updatePermissions=function(){var e=!1;return angular.forEach(DetectRTC.MediaDevices,(function(t){t&&t.id&&t.id.length>=64&&("Please invoke getUserMedia once."===t.label?e=!0:("videoinput"!==t.kind||p||(p=!0),"audioinput"!==t.kind||m||(m=!0)))})),e},this.isGetUserMediaRequested=function(){return(!p||!m)&&d.updatePermissions(DetectRTC.MediaDevices)},this.audioMediaDeviceUpdated=function(){d.fixDeviceLabels(),t.$broadcast("ON_USER_AUDIO_MEDIA_CHANGED_EVENT")},this.videoMediaDeviceUpdated=function(){d.fixDeviceLabels(),t.$broadcast("ON_USER_VIDEO_MEDIA_CHANGED_EVENT")};var L=function(e){var t=[];return angular.forEach(e,(function(e){t.some((function(t){return t.id===e.id}))||t.push(e)})),t};this.getAudioInputDevices=function(){return a.when(L(DetectRTC.audioInputDevices))},this.getAudioOutputDevices=function(){var e=a.defer();return e.resolve(L(DetectRTC.audioOutputDevices)),e.promise},this.getVideoInputDevices=function(){var e=a.defer();return e.resolve(L(DetectRTC.videoInputDevices)),e.promise}}])},function(e,t){angular.module("rainbow").service("gaService",[function(){var e="webrtc",t="CallsSuccessRate",n="error_failed",r="webrtc",i="CallsSuccessRate",a="success",o="webrtc",s="CallsSuccessRate",c="error_no_stun_candidate",l="webrtc",u="ICEDistribution",d="webrtc",h="ICETopology",f="webrtc",p="ICENegotiation",m="DurationMs",v="webrtc",g="GetUserMediaRate",y="success",b="webrtc",S="GetUserMediaRate",_="error_no_Track",C="webrtc",w="GetUserMediaRate",E="error",T="webrtc",k="CodecsDistribution",M="webrtc",D="CallsDistribution",x="webrtc",R="CallsDurationRange",O="ux",I="dragAndDrop",P="invitations",A="inviteFromProvider",L=null,N=null,j=!1,U=null,F=null,H=null;this.provideGA=function(e){H=e},this.hasGA=function(){return null!==H},this.trackICEUsed=function(e,t){if(H){var n="",r="";switch(e){case"local":n="host";break;case"peerreflexive":case"prflx":case"serverreflexive":n="stun";break;case"relayed":n="relay";break;default:n=e}switch(t){case"local":r="host";break;case"peerreflexive":case"prflx":case"serverreflexive":r="stun";break;case"relayed":r="relay";break;default:r=t}H.send("event",l,u,n+"|"+r)}},this.trackICEFailed=function(r){H&&r&&F!==r&&(H.send("event",e,t,n),F=r)},this.trackICESuccess=function(e){H&&e&&U!==e&&(H.send("event",r,i,a),U=e)},this.trackICENoSTUNCandidate=function(){H&&H.send("event",o,s,c)},this.trackICETopology=function(e){H&&H.send("event",d,h,e)},this.trackGetUserMediaSuccess=function(){H&&H.send("event",v,g,y)},this.trackGetUserMediaErrorNoTrack=function(){H&&H.send("event",b,S,_)},this.trackGetUserMediaError=function(){H&&H.send("event",C,w,E)},this.trackCodecsUsed=function(e,t){H&&H.send("event",T,k,e+"|"+t)},this.negotiationTime=function(){return N&&L?N<L?null:N-L:null},this.startNegotiationTime=function(e){L=e||(new Date).getTime(),j=!0},this.endNegotiationTime=function(e){j&&(N=e||(new Date).getTime(),j=!1)},this.trackNegotiationTime=function(){if(H){var e=this.negotiationTime();e&&H.send("event",f,p,m,e),N=null,L=null}},this.resetProvider=function(){H=null},this.trackCallSuccessNumber=function(e){e&&e.length>0&&H&&H.send("event",M,D,e)},this.trackCallDuration=function(e){if(H&&angular.isDefined(e)&&e>=0){var t,n=Math.round(e/1e3);t=n<15?"very_short_less_15s":n<30?"very_short_less_30s":n<60?"short_less_60s":n<120?"short_less_120s":n<300?"short_less_300s":n<600?"normal_less_600s":n<1200?"normal_less_1200s":n<1800?"normal_less_1800s":n<3600?"long_less_3600s":"long_more_3600s",H.send("event",x,R,t)}},this.trackDragAndDrop=function(e){H&&H.send("event",O,I,e)},this.inviteContactsFromProvider=function(e,t){H&&H.send("event",P,A,e,t)}}])},function(e,t,n){n.r(t);var r=n(1),i=n.n(r);angular.module("rainbow").service("usersService",["$q","$log",function(e,t){var n=this;this.started=!1,this.start=function(r){t.info("[usersService] === STARTING ==="),n.started=!0;var a=performance.now();t.info("[usersService] start"),n.contactsInRoster=n.getAllRosterContacts(),n.lastNameList=n.orderContacts("lastname"),n.firstNameList=n.orderContacts("firstname"),n.companyNameList=n.orderContacts("company"),n.contactServiceSubscription=i.a.subscribe((function(e){"ON_CONTACT_ROSTER_UPDATE_EVENT"===e.name&&n.onContactUpdatedEvent()}));var o=Math.round(performance.now()-a);return r.push({service:"usersService",startDuration:o}),t.info("[usersService] === STARTED ("+o+" ms) ==="),e.when()},this.stop=function(){return t.info("[usersService] === STOPPING ==="),n.started&&(n.started=!1),n.contactServiceSubscription&&n.contactServiceSubscription.unsubscribe(),t.info("[usersService] === STOPPED ==="),e.when()},this.onContactUpdatedEvent=function(){t.info("[usersService] onContactUpdatedEvent");var e=n.getAllRosterContacts();e.length-n.contactsInRoster.length!=0&&(t.info("[usersService] onContactUpdatedEvent - update all user lists"),n.contactsInRoster=e,n.lastNameList=n.orderContacts("lastname"),n.firstNameList=n.orderContacts("firstname"),n.companyNameList=n.orderContacts("company"))},this.getLastNameList=function(){return n.lastNameList},this.getFirstNameList=function(){return n.firstNameList},this.getCompanyNameList=function(){return n.companyNameList},this.getAllRosterContacts=function(){return i.a.getContacts().filter((function(e){return e.displayName&&e.roster}))},this.addSeparators=function(e,t){var n=[],r="",i=0,a=null;return a="company"!==t?function(e){return e[t].charAt(0)}:function(e){return e.company.name},e.forEach((function(e){var t=a(e).toUpperCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"");r!==t&&(r=t,n.push({value:r,type:"separator",id:r,index:i++})),e.index=i++,n.push(e)})),n},this.orderContacts=function(e){var t=n.getOrderedUsers(n.contactsInRoster,e);return n.addSeparators(t,e)},this.getFilterAndOrderUsersGroupedByOrderLabel=function(e,t,r,i){i=Boolean(!0&i);var a=n.getFilterAndOrderUsers(e,t,r,i);return"firstname"===t?n.addSeparators(a,"firstname"):"company"===t?n.addSeparators(a,"company"):n.addSeparators(a,"lastname")},this.getFilterAndOrderUsersGroupedByOrderLabelAndUpdateActivity=function(e,t,r,i){i=Boolean(!0&i);var a=n.getFilterAndOrderUsers(e,t,r,i);return"firstname"===t?n.addSeparators(a,"firstname"):"company"===t?n.addSeparators(a,"company"):n.addSeparators(a,"lastname")},this.getFilterAndOrderUsers=function(e,t,r,i){var a=n.getFilteredUsers(e,r,i);return n.getOrderedUsers(a,t)},this.getFilteredUsers=function(e,t,n){var r;return r=(r=e.filter((function(e){if("separator"===e.type)return!0;var r=e.displayName&&e.roster||n,i="offline"!==e.status&&"wait"!==e.status&&"xa"!==e.status&&"unknown"!==e.status,a="wait"===e.status,o=e.isTerminated;return"online"===t?r&&i:"offline"===t?r&&!i&&!o:"pending"===t?r&&a:"all"===t?r&&!o:r}))).filter((function(e,t){return!!("separator"!==e.type||r[t+1]&&"separator"!==r[t+1].type)}))},this.getOrderedUsers=function(e,t){return e.sort((function(e,n){var r;if("lastname"===t)return 0===(r=e.lastname.localeCompare(n.lastname))?e.firstname.localeCompare(n.firstname):r;if("firstname"===t)return 0===(r=e.firstname.localeCompare(n.firstname))?e.lastname.localeCompare(n.lastname):r;if("company"===t){var i=e.company.name.localeCompare(n.company.name);return 0===i?e.lastname.localeCompare(n.lastname):i}return 0}))}}])},function(e,t,n){(function(e){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),a=n(18),o=n(54),s=n(2),c=n(4),l=n(15),u=n(25),d=n(3),h=function(){function e(t,n){S(this,e),n&&(this.url=URL.createObjectURL(n)),this.fd=t}return C(e,[{key:"release",value:function(){URL.revokeObjectURL(this.url)}}]),e}();t.LocalImage=h;var f=function(){function t(e,n,r,i,a,o,d){S(this,t),this.$q=e,this.$http=n,this.$injector=r,this.TransfertPromiseQueue=i,this.FileDescriptorEventHandler=a,this.errorHelperService=o,this.$rootScope=d,this.ONE_KILOBYTE=1024,this.ONE_MEGABYTE=1048576,this.ONE_GIGABYTE=1073741824,this.started=!1,this.thumbnailPromises=[],this.thumbnailPreviewPromises=[],this.authService=s.default,this.xmppService=c.default,this.logger=l.default,this.fileStorageService=u.default,this.centralizedService=null}return C(t,[{key:"start",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.logger.info("[FileServerService] === STARTING ==="),t.t0="caches"in self,!t.t0){t.next=7;break}return t.next=6,caches.open("RainbowImageCache");case 6:this.cache=t.sent;case 7:return n=performance.now(),this.started=!1,this.portalURL=config.restServerUrl+"/api/rainbow/fileserver/v1.0/files",t.next=12,this.getServercapabilities();case 12:try{this.centralizedService=this.$injector.get("centralizedService")}catch(i){}this.attachHandlers(),this.transfertPromiseQueue=this.TransfertPromiseQueue.create(),r=Math.round(performance.now()-n),e.push({service:"FileServerService",startDuration:r}),this.logger.info("[FileServerService] === STARTED ("+r+" ms) ==="),t.next=21;break;case 18:t.prev=18,t.t1=t.catch(0),this.logger.error("[FileServerService] === STARTING FAILURE === "+t.t1.message);case 21:case"end":return t.stop()}}),t,this,[[0,18]])})))}},{key:"stop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("[FileServerService] === STOPPING ==="),this.started&&(this.started=!1),this.logger.info("[FileServerService] === STOPPED ===");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"attachHandlers",value:function(){var e=this;this.removeHandlers(),this.fileDescriptorEventHandler=this.FileDescriptorEventHandler.create(this),this.fileMessageHandlerRef||(this.fileMessageHandlerRef=this.xmppService.addHandler((function(t){return setTimeout((function(){e.fileDescriptorEventHandler.onManagementMessageReceived(t)}),250),!0}),null,"message","management"))}},{key:"removeHandlers",value:function(){this.fileDescriptorEventHandler=void 0,this.fileMessageHandlerRef=void 0}},{key:"getFileRange",value:function(){return 4*this.ONE_MEGABYTE}},{key:"getFileDescriptorPublicUrl",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a,o,s,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",null);case 2:if(this.centralizedService.isDesktopApp()||!e.publicUrl){t.next=7;break}if(this.logger.info(">getFileDescriptorPublicUrl: publicUrlExpirationDate="+d(e.publicUrlExpirationDate).format("DD-MM-YYYY_H_mm_ss")),this.logger.info(">getFileDescriptorPublicUrl: isDateExpired="+e.isPublicUrlExpired()),n=d(),r=d.duration(d(e.publicUrlExpirationDate).diff(n)).asSeconds(),this.logger.info(">getFileDescriptorPublicUrl: date expiration="+r),!(r>1800)){t.next=7;break}return t.abrupt("return",e.publicUrl);case 7:return t.prev=7,i=new URL(this.portalURL+"/"+e.id+"/temporary-url"),(a=this.authService.getRequestHeader())["Content-Type"]="application/json",t.next=12,fetch(i.href,{method:"GET",headers:a});case 12:if(!(o=t.sent).ok){t.next=20;break}return t.next=16,o.json();case 16:return s=t.sent,e.publicUrl=s.data.url,c=d(s.data.expirationDate),t.abrupt("return",(c.isValid()&&(e.publicUrlExpirationDate=c.toDate(),this.logger.info(">getFileDescriptorPublicUrl: Get PublicUrl Success, publicUrlExpirationDate="+d(e.publicUrlExpirationDate).format("DD-MM-YYYY_H_mm_ss"))),this.logger.info("Get PublicUrl Success"),e.publicUrl));case 20:return t.abrupt("return",null);case 23:throw t.prev=23,t.t0=t.catch(7),this.logger.error("stopPstnConference - ERROR"),this.errorHelperService.handleError(t.t0);case 27:case"end":return t.stop()}}),t,this,[[7,23]])})))}},{key:"getFileDescriptorUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r(this,void 0,void 0,b.a.mark((function r(){var i,a,o;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,i=null,a=new Request("/rainbowImages/".concat(t?"thumbnail/":"").concat(e.id)),!n||!this.cache){r.next=12;break}return r.next=6,this.cache.match(a);case 6:if(o=r.sent,r.t0=o,!r.t0){r.next=12;break}return r.next=11,o.blob();case 11:i=r.sent;case 12:if(r.t1=i,r.t1){r.next=33;break}if(!t){r.next=25;break}if(!e.previewBlob){r.next=19;break}r.t2=e.previewBlob,r.next=22;break;case 19:return r.next=21,this.getBlobThumbnailFromFileDescriptor(e);case 21:r.t2=r.sent;case 22:i=r.t2,r.next=32;break;case 25:return r.next=27,this.getBlobFromFileDescriptor(e,!1,null);case 27:if(i=r.sent,r.t3=!e.orientation&&e.isImage(),!r.t3){r.next=32;break}return r.next=32,this.setImageOrientationForFileDescriptor(e,i).catch((function(){}));case 32:n&&this.cache&&this.cache.put(a,new Response(i));case 33:return r.abrupt("return",URL.createObjectURL(i));case 36:throw r.prev=36,r.t4=r.catch(0),new Error("getFileDescriptorUrl(".concat(e.id,", ").concat(t,") -- failure -- ").concat(r.t4));case 39:case"end":return r.stop()}}),r,this,[[0,36]])})))}},{key:"removeFileDescriptorFromCache",value:function(e){this.cache&&(this.cache.delete("/rainbowImages/thumbnail/"+e.id),this.cache.delete("/rainbowImages/"+e.id))}},{key:"clearCache",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.cache,!e.t0){e.next=7;break}return e.next=4,caches.delete("RainbowImageCache");case 4:return e.next=6,caches.open("RainbowImageCache");case 6:this.cache=e.sent;case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getLocalImage",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return r(this,void 0,void 0,b.a.mark((function r(){var i,a;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,i=this.fileStorageService.getFileDescriptorById(e),r.t0=i,r.t0){r.next=7;break}return r.next=6,this.fileStorageService.retrieveAndStoreOneFileDescriptor(e);case 6:i=r.sent;case 7:if(i.fileName.includes("__rboriginal__")&&(t=!1),a=null,!t||!i.previewBlob||n){r.next=13;break}r.t1=i.previewBlob,r.next=23;break;case 13:if(!t){r.next=19;break}return r.next=16,this.getLargeBlobThumbnail(i);case 16:r.t2=r.sent,r.next=22;break;case 19:return r.next=21,this.getBlobFromFileDescriptor(i,!1,null);case 21:r.t2=r.sent;case 22:r.t1=r.t2;case 23:return a=r.t1,r.abrupt("return",new h(i,a));case 27:throw r.prev=27,r.t3=r.catch(0),this.logger.warn("[fileServerService] getFileLocalURL -- no file descriptor found with ".concat(e,' + " id.')),r.t3;case 30:case"end":return r.stop()}}),r,this,[[0,27]])})))}},{key:"getLargeBlobThumbnail",value:function(e){var t=e.url+"?thumbnail500=true";return this.getBlobFileDescriptorFromUrl(t,e)}},{key:"getPartialDataFromServer",value:function(e,t,n,r,i,a,o){var s=this;return this.$q((function(a,c){s.$http({method:"GET",url:t,headers:s.authService.getRequestHeaderWithRange("bytes="+n+"-"+r),responseType:"arraybuffer",timeout:e.cancelTransfertDefer.promise,eventHandlers:{progress:function(t){if(e.loadingRef===o){var n=Math.floor(100*t.loaded/t.total);e&&(e.chunkPercentArray[i]=n,s.logger.info("[FileServerService] getPartialDataFromServer ProgressChunk: "+n),e.updateProgressInfo())}else s.logger.info("[FileServerService] This load has been canceled - NTIA")}}}).then((function(e){a({data:e.data,index:i})}),(function(e){var t=s.errorHelperService.handleError(e),n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e.data))),r=s.errorHelperService.getLocalizedError(n.errorDetailsCode);s.logger.error(r),c(t)}))}))}},{key:"getFileStorageService",value:function(){return this.fileStorageService}},{key:"getBlobThumbnailFromFileDescriptor",value:function(e){var t=this;if(e.thumbnail.isThumbnailAvailable()||e.isImage()){var n=this.$q.defer(),o=!1,s=e.url;if(e.thumbnail.isThumbnailAvailable()){if(this.thumbnailPreviewPromises[e.id])return this.logger.info("[FileServerService] getBlobThumbnailFromFileDescriptor preview for "+e.id+" already lauched"),this.thumbnailPreviewPromises[e.id].promise;this.thumbnailPreviewPromises[e.id]=n,s+="?thumbnail500=true"}else{if(this.thumbnailPromises[e.id])return this.logger.info("[FileServerService] getBlobThumbnailFromFileDescriptor full image update for "+e.id+" already lauched"),this.thumbnailPromises[e.id].promise;this.thumbnailPromises[e.id]=n,e.uploadedDate&&(s+="?update="+i.MD5(a.enc.Latin1.parse(e.uploadedDate)).toString(a.enc.Hex)),o=!0}return this.getBlobFileDescriptorFromUrl(s,e).then((function(i){return r(t,void 0,void 0,b.a.mark((function t(){var r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=this.fileStorageService.getFileDescriptorById(e.id)).previewBlob?e.previewBlob&&!o&&(e.previewBlob=i):e.previewBlob=i,o||(e.previewDownloaded=!0),t.t0=!e.orientation&&e.isImage()&&o,!t.t0){t.next=6;break}return t.next=6,this.setImageOrientationForFileDescriptor(e,i).catch((function(){}));case 6:e.previewBlobSubject.next(e.previewBlob),this.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"success",type:"download",fileDesc:e}),(r=o?this.thumbnailPromises:this.thumbnailPreviewPromises)[e.id]&&r[e.id].resolve(e.previewBlob),delete r[e.id],n.resolve(i);case 10:case"end":return t.stop()}}),t,this)})))})).catch((function(r){t.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"download",message:r.message,fileDesc:e}),delete(o?t.thumbnailPromises:t.thumbnailPreviewPromises)[e.id],n.reject(r)})),n.promise}return this.$q.reject("No available thumbnail")}},{key:"getBlobFromFileDescriptor",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return this.logger.warn("[FileServerService] getBlobFromFileDescriptor : missing file descriptor"),this.$q.reject();if(this.logger.info("[FileServerService] getBlobFromFileDescriptor: "+e.id),e.state!==o.FileState.UPLOADED)return this.logger.warn("[FileServerService] getBlobFromFileDescriptor : file is not in uploaded state="+e.state),this.$q.reject();var s=e.url;e.uploadedDate&&(s+="?update="+i.MD5(a.enc.Latin1.parse(e.uploadedDate)).toString(a.enc.Hex));var c=this.getFileRange();if(this.capabilities.maxChunkSizeDownload&&0!==e.size&&e.size>c){var l=function(){e.size>=100*c&&(c=e.size/100+t.ONE_KILOBYTE,t.logger.debug("[FileServerService] changing chunk size: "+c));var i=t.$q.defer(),a=new Array,l=[];e.state=o.FileState.DOWNLOADING,e.chunkTotalNumber=Math.ceil(e.size/c),e.chunkPerformedPercent=0,e.chunkWrittenInDisk=-1,e.chunkPercentArray=new Array(e.chunkTotalNumber),e.chunkPercentArray.fill(0);var u=++e.loadingRef;e.cancelTransfertDefer=t.$q.defer(),e.updateProgressInfo(),t.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:e,cancelable:n}),t.logger.info("[FileServerService] getBlobFromFileDescriptor: need to download "+e.chunkTotalNumber+" chunks");for(var d=function(i,o,c,d){c=c<e.size?c:e.size,l.push((function(){var l=t.$q.defer();return p=c,t.getPartialDataFromServer(e,s,o,c,i,n,u).then((function(o){if(e.loadingRef===u)return p=c,e.updateProgressInfo(),t.logger.info("[FileServerService] getBlobFromFileDescriptor : chunk"+i+" downloaded"),t.logger.debug("[FileServerService] refreshFilePercent: chunkPerformedPercent="+e.chunkPerformedPercent),a[o.index]=o.data,t.writeAvailableChunksInDisk(e,a),t.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:e,cancelable:n}),r?r(o,e.id).then((function(){return l.resolve(o.data)})):l.resolve(o);t.logger.info("[FileServerService] This load has been canceled - NTIA")})).catch((function(e){t.logger.info("[FileServerService] error on chunk download="+e),l.reject(e)})),l.promise})),p=c},h=0,f=0,p=c-1,m=Math.ceil(e.size/c);m>0;h++,m--,f+=c,p+=c)d(h,f,p);return{v:(t.transfertPromiseQueue.addPromiseArray(e.id,l,(function(){if(e.loadingRef===u){t.logger.info("[FileServerService] getBlobFromFileDescriptor: promisesCompletion");var n=new Blob(a,{type:e.typeMIME});t.logger.info("[FileServerService] getBlobFromFileDescriptor success"),e.setState(o.FileState.UPLOADED),e.chunkTotalNumber=0,e.chunkPerformedPercent=0,e.updateProgressInfo(),t.writeAvailableChunksInDisk(e,a),e.writeStream&&(t.logger.info("[FileServerService] Close WriteStream"),e.writeStream.end()),t.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:e}),i.resolve(n)}else t.logger.info("[FileServerService] This load has been canceled - NTIA")}),(function(n){if(e.loadingRef===u){var r=t.errorHelperService.handleError(n);e.setState(o.FileState.UPLOADED),e.chunkTotalNumber=0,e.chunkPerformedPercent=0;var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.data))),s=t.errorHelperService.getLocalizedError(a.errorDetailsCode);t.logger.error(s),t.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"download",message:s||r.message,fileDesc:e}),i.reject(r)}else t.logger.info("[FileServerService] This load has been canceled - NTIA")})),i.promise)}}();if("object"===typeof l)return l.v}return e.state=o.FileState.DOWNLOADING,this.getBlobFileDescriptorFromUrl(s,e).then((function(n){return t.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:e}),t.$q.resolve(n)})).catch((function(n){return e.state=o.FileState.UPLOADED,t.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:e}),t.logger.info("[FileServerService] arrayPromise : error "+n.message),t.$q.reject(n)}))}},{key:"writeAvailableChunksInDisk",value:function(t,n){if(this.logger.debug("[FileServerService] >writeAvailableChunksInDisk"),t.writeStream){var r=t.chunkWrittenInDisk+1;this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : We start at "+r);for(var i=r;i<n.length;i++){if(!n[i]){this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : Blob "+i+" NOT available");break}this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : Blob "+i+" available"),t.chunkWrittenInDisk=i,t.writeStream.write(new e(n[i])),n[i]=null}}}},{key:"getBlobFileDescriptorFromUrl",value:function(e,t){var n=this;return this.$q((function(r,i){n.logger.debug("[FileServerService] >getBlobFileDescriptorFromUrl: "+e),t.chunkTotalNumber=1,t.chunkPerformedPercent=0,t.chunkPercentArray=new Array(t.chunkTotalNumber),t.chunkPercentArray.fill(0);var a=++t.loadingRef;t.cancelTransfertDefer=n.$q.defer(),t.updateProgressInfo(),n.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:t,cancelable:!1}),n.$http({method:"GET",url:e,headers:n.authService.getRequestHeader(),responseType:"arraybuffer",timeout:t.cancelTransfertDefer.promise,eventHandlers:{progress:function(e){t.loadingRef===a?(t.chunkPercentArray[0]=Math.floor(100*e.loaded/e.total),t.updateProgressInfo()):n.logger.info("[FileServerService] This load has been canceled - NTIA")}}}).then((function(e){if(t.loadingRef===a){var i=new Blob([e.data],{type:t.typeMIME});t.state=o.FileState.UPLOADED,t.chunkPerformedPercent=0,t.updateProgressInfo(),n.logger.debug("[FileServerService] getBlobFileDescriptorFromUrl success"),r(i)}else n.logger.info("[FileServerService] This load has been canceled - NTIA")}),(function(e){if(t.loadingRef===a){t.state=o.FileState.UPLOADED;var r=n.errorHelperService.handleError(e);n.logger.error("[FileServerService] "+r.translatedMessage),i(r)}else n.logger.info("[FileServerService] This load has been canceled - NTIA")}))}))}},{key:"getBlobUrlAndOrientationByFileDescriptorId",value:function(e){var t=this;return this.$q((function(n,r){var i=t.fileStorageService.getFileDescriptorById(e);i?t.getBlobFromFileDescriptor(i,!1,null).then((function(r){var a={id:e,blob:r,blobUrl:URL.createObjectURL(r)};if(i.orientation)return a.orientation=i.orientation,i.blobOrientationSubject.next(a),void n(a);t.setImageOrientationForFileDescriptor(i,r).then((function(e){a.orientation=e,i.blobOrientationSubject.next(a),n(a)})).catch((function(){i.blobOrientationSubject.next(a),n(a)}))})).catch((function(e){r(e)})):(t.logger.error("[FileServerService] getBlobUrlAndOrientationById no file descriptor found for ID "+e),r(new Error("[FileServerService] getBlobUrlAndOrientationById no file descriptor found")))}))}},{key:"setImageOrientationForFileDescriptor",value:function(e,t){return new Promise((function(n,r){if(e&&e.isImage()){var i=new FileReader;i.onload=function(t){e.orientation=1;var i=t.target.result,a=new DataView(i);if(65496===a.getUint16(0,!1)){for(var o=a.byteLength,s=2;s<o;){if(a.getUint16(s+2,!1)<=8)return void r();var c=a.getUint16(s,!1);if(s+=2,65505===c){if(1165519206!==a.getUint32(s+=2,!1))return void r();var l=18761===a.getUint16(s+=6,!1);s+=a.getUint32(s+4,l);var u=a.getUint16(s,l);s+=2;for(var d=0;d<u;d++)if(274===a.getUint16(s+12*d,l)){var h=a.getUint16(s+12*d+8,l);return e.orientation=h,void n(h)}}else{if(65280!=(65280&c))break;s+=a.getUint16(s,!1)}}r()}else r()},i.readAsArrayBuffer(t)}else r()}))}},{key:"uploadAFile",value:function(e,t,n){var r=this;return this.$q((function(n,i){var a=r.fileStorageService.getFileDescriptorById(e);a&&a.setState(o.FileState.UPLOADING),a.chunkPercentArray=new Array(a.chunkTotalNumber),a.chunkPercentArray.fill(0),a.cancelTransfertDefer=r.$q.defer(),r.$http({method:"PUT",url:r.portalURL+"/"+e,headers:r.authService.getPostHeader("application/octet-stream"),data:t,timeout:a.cancelTransfertDefer.promise,eventHandlers:{progress:function(e){var t=Math.floor(100*e.loaded/e.total);a&&(a.chunkPercentArray[0]=t,a.updateProgressInfo())}}}).then((function(t){var i=r.fileStorageService.getFileDescriptorById(e);i&&(i.setState(o.FileState.UPLOADED),a.updateProgressInfo()),r.logger.info("[FileServerService] uploadAFile success"),r.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"success",type:"upload",fileDesc:i}),r.fileStorageService.orderDocuments(),n(i)}),(function(e){var t=r.errorHelperService.handleError(e);r.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:a}),i(t),r.logger.error("[FileServerService] "+t.message)}))}))}},{key:"sendPartialDataToServer",value:function(e,t,n,r,i,a,o){var s=this;return this.$q((function(c,l){s.$http({method:"PUT",url:s.portalURL+"/"+e.id+"/parts/"+i,headers:s.authService.getPostHeaderWithRange("bytes "+n+"-"+r+"/"+e.size,"application/octet-stream"),data:t,timeout:e.cancelTransfertDefer.promise,uploadEventHandlers:{progress:function(t){var n=Math.floor(100*t.loaded/t.total);e&&(e.chunkPercentArray[i]=n,e.updateProgressInfo(),s.logger.info("[FileServerService] sendPartialDataToServer chunk"+i+" percent="+n),s.logger.info("[FileServerService] sendPartialDataToServer total percent="+e.chunkPerformedPercent))}}}).then((function(n){var r=n.data.data;s.logger.info("[FileServerService] sendPartialDataToServer success"),s.calculateMd5(t,(function(t){s.logger.info("[FileServerService] sendPartialDataToServer calculated checksum="+t),s.logger.info("[FileServerService] sendPartialDataToServer md5sum="+r.md5sum),r.md5sum.localeCompare(t)?(s.logger.error("[FileServerService] Wrong Checksum for chunk detected: "+r.md5sum+"/"+t),l({errorDetailsCode:500,message:"Wrong Checksum for chunk"})):(e.updateProgressInfo(),o&&o(a,e),s.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:e,cancelable:!0}),c(r))}))}),(function(e){var t=s.errorHelperService.handleError(e);l(t),s.logger.error("[FileServerService] "+t.message)}))}))}},{key:"calculateMd5",value:function(e,t){var n=new FileReader;n.readAsBinaryString(e),n.onloadend=function(){t(i.MD5(a.enc.Latin1.parse(n.result)).toString(a.enc.Hex))}}},{key:"uploadAFileByChunk",value:function(e,t,n,r){var i=this;this.logger.info("[FileServerService] >uploadAFileByChunk");var a=this.getFileRange();if(a<t.size){t.size>=100*a&&(a=Math.round(t.size/100+this.ONE_KILOBYTE),this.logger.debug("[FileServerService] changing chunk size: "+a));var s=this.$q.defer();e.chunkTotalNumber=Math.ceil(t.size/a),e.chunkPerformedPercent=0,e.chunkPercentArray=new Array(e.chunkTotalNumber),e.chunkPercentArray.fill(0),e.state=o.FileState.UPLOADING,e.cancelTransfertDefer=this.$q.defer(),this.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:e,cancelable:!0});for(var c=[],l=function(a,o,s,l){var u=l<t.size?l:t.size,d=t.slice(a,u+1);c.push((function(){return i.sendPartialDataToServer(e,d,a,u,s,n,r)}))},u=0,d=0,h=a-1,f=Math.ceil(t.size/a);f>0;u++,f--,d+=a,h+=a)l(d,0,u,h);return this.transfertPromiseQueue.addPromiseArray(e.id,c,(function(){i.$http({method:"PUT",url:i.portalURL+"/"+e.id+"/parts/end",headers:i.authService.getPostHeader("application/octet-stream")}).then((function(t){i.logger.info("[FileServerService] uploadAFileByChunk success"),e.setState(o.FileState.UPLOADED),e.chunkPerformed=0,e.chunkTotalNumber=0,e.chunkPerformedPercent=0,e.fileToSend=null,r&&r(n,e),i.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"success",type:"upload",fileDesc:e}),i.fileStorageService.orderDocuments(),i.fileStorageService.retrieveUserConsumption(),s.resolve(e)}),(function(t){var n=i.errorHelperService.handleError(t);i.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:e}),s.reject(n)}))}),(function(t){var n=i.errorHelperService.handleError(t);i.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:e}),s.reject(n)})),s.promise}return r&&r(n,e),this.uploadAFile(e.id,t,e.typeMIME).then((function(t){return i.logger.info("[FileServerService] uploadAFile success"),r&&r(n,e),t.fileToSend=null,i.fileStorageService.retrieveUserConsumption(),i.$q.resolve(e)}))}},{key:"isTransferInProgress",value:function(){return this.transfertPromiseQueue&&this.transfertPromiseQueue.isTransferInProgress()}},{key:"cancelAllTransfers",value:function(){this.transfertPromiseQueue&&this.transfertPromiseQueue.cancelAllTransfers()}},{key:"cancelCurrentFiletransfer",value:function(e){var t=this.fileStorageService.getFileDescriptorById(e);t&&(t.cancelTransfertDefer&&t.cancelTransfertDefer.resolve(),t.state===o.FileState.UPLOADING?t.state=o.FileState.UPLOAD_CANCELED:t.state===o.FileState.DOWNLOADING&&(t.state=o.FileState.UPLOADED),t.progressSubject.next({})),this.transfertPromiseQueue&&this.transfertPromiseQueue.cancelCurrentFiletransfer(e)}},{key:"getServercapabilities",value:function(){var e=this;return this.$q((function(t,n){e.$http({method:"GET",url:config.restServerUrl+"/api/rainbow/fileserver/v1.0/capabilities",headers:e.authService.getRequestHeader()}).then((function(n){e.logger.info("[FileServerService] getServercapabilities -- success"),e.capabilities=n.data.data,t(e.capabilities)}),(function(t){var r=e.errorHelperService.handleError(t);e.logger.error("[FileServerService] getServercapabilities "+r.message),n(r)}))}))}}]),t}();f.$inject=["$q","$http","$injector","TransfertPromiseQueue","FileDescriptorEventHandler","errorHelperService","$rootScope"],t.FileServerService=f,angular.module("rainbow").service("fileServerService",f)}).call(this,n(57).Buffer)},function(e,t,n){t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=l(e),o=r[0],s=r[1],c=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),u=0,d=s>0?o-4:o;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,s=n-i;o<s;o+=16383)a.push(u(e,o,o+16383>s?s:o+16383));return 1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=o.length;s<c;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,c=(1<<s)-1,l=c>>1,u=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-u)-1,f>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=h,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+d],d+=h,u-=8);if(0===a)a=1-l;else{if(a===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=l}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,c,l=8*a-i-1,u=(1<<l)-1,d=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(o++,c/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*c-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[n+f]=255&o,f+=p,o/=256,l-=8);e[n+f-p]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){n.r(t);var r=n(1),i=n.n(r);angular.module("rainbow").factory("FileDescriptorEventHandler",["$log","$rootScope",function(e,t){function n(n){var r=this;this.fileServerService=n,this.fileStorageService=n.getFileStorageService(),r.onManagementMessageReceived=function(t){try{var n=$(t);return n.find("file").length>0?this.manageFileStanzaData(n.find("file")):n.find("thumbnail").length>0?this.manageThumbnailStanzaData(n.find("thumbnail")):e.info("[FileDescriptorEventHandler] onManagementMessageReceived  -- ignore the message"),!0}catch(r){return e.error("[FileDescriptorEventHandler] onManagementMessageReceived ERROR "+r),!0}},r.manageFileStanzaData=function(n){for(var a=$(n).attr("action"),o=$(n).find("fileid"),s=!1,c=0;c<o.length;c++){var l=$(o[c]).text(),u=this.fileStorageService.getFileDescriptorById(l);switch(e.info("[FileDescriptorEventHandler] manageFileStanzaData -- "+a+" fileDescriptor "+l),a){case"create":e.debug("[FileDescriptorEventHandler] fileDescriptor "+l+" created on server -- do nothing");break;case"delete":u&&(u.ownerId===i.a.userContact.dbId&&"deleted"!==u.state&&(s=!0),this.fileStorageService.deleteFileDescriptorFromCache(l),this.fileStorageService.deleteVoiceMessageFileDescriptor(l),t.$broadcast("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:l}));break;case"update":r.fileStorageService.retrieveAndStoreOneFileDescriptor(l,!0).then((function(n){e.info("[FileDescriptorEventHandler] fileDescriptor retrieved"),!n.ownerId===i.a.userContact.dbId&&this.fileStorageService.retrieveUserConsumption(),!n.previewBlob&&n.isThumbnailPossible()&&r.fileServerService.getBlobThumbnailFromFileDescriptor(n).then((function(e){n.previewBlob=e,n.previewBlobSubject.next(n.previewBlob),t.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:n.id})})).catch((function(t){e.error("[FileDescriptorEventHandler] fileDescriptor retrieve error : ",t)}))})),r.fileStorageService.retrieveAndStoreOneVoiceMessageFileDescriptor(l)}}s&&this.fileStorageService.retrieveUserConsumption()},r.manageThumbnailStanzaData=function(n){var i=$(n).attr("action"),a=$(n).find("fileid").text(),o=$(n).find("url").text(),s=$(n).find("mime").text(),c=$(n).find("size").text(),l=$(n).find("md5sum").text(),u=$(n).find("originalWidth").text(),d=$(n).find("originalHeight").text();e.info("[FileDescriptorEventHandler] manageThumbnailStanzaData -- "+i+" fileDescriptor "+a),e.debug("[FileDescriptorEventHandler]   fileUrl="+o),e.debug("[FileDescriptorEventHandler]   fileMime="+s),e.debug("[FileDescriptorEventHandler]   fileSize="+c),e.debug("[FileDescriptorEventHandler]   md5sum="+l),e.debug("[FileDescriptorEventHandler]   fileId="+a),"create"!==i&&"update"!==i||this.fileStorageService.retrieveAndStoreOneFileDescriptor(a).then((function(){var n=r.fileStorageService.getFileDescriptorById(a);n?(e.debug("[FileDescriptorEventHandler] updating Thumbnail of found FileDescriptor "+a),n.previewBlob&&!n.previewDownloaded||!n.previewBlob?(t.$broadcast("ON_FILE_DESCRIPTOR_THUMBNAIL_READY",n.id),n.thumbnail.availableThumbnail=!0,n.thumbnail.md5sum=l,n.thumbnail.size=c,u&&d&&n.setOriginalImageDimensions(u,d),e.info("[FileDescriptorEventHandler] preview not already downloaded for "+a+" -- download it"),r.fileServerService.getBlobThumbnailFromFileDescriptor(n).then((function(){t.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:n.id})}))):(t.$broadcast("ON_FILE_DESCRIPTOR_THUMBNAIL_READY",n.id),e.info("[FileDescriptorEventHandler] preview already downloaded for "+a+" -- do nothing"))):e.error("[FileDescriptorEventHandler] FileDescriptor not found and we do nothing and its not OK")})).catch((function(){e.error("[FileDescriptorEventHandler] FileDescriptor was not found on server...")}))}}return n.create=function(e){return new n(e)},n}])},function(e,t){angular.module("rainbow").service("extensionSharingService",["$q","$log","$rootScope",function(e,t,n){var r=this;this.extensionFound=!1,this.minVersion="1.5.1",this.port=null,this.currentStreamId="screen",this.start=function(){this.extensionId=this.extensionId||this.getExtensionId(config.webservices.server);var i=e.defer();return t.info("[extensionService] === STARTING ==="),window.chrome&&window.chrome.runtime?(t.info("[extensionService] Chrome extension - try to ping...",this.extensionId),chrome.runtime.sendMessage(this.extensionId,{type:"ping",data:null},null,(function(e){e&&"pong"===e.type?(t.info("[extensionService] Chrome extension - pong received"),t.info("[extensionService] Chrome extension - extension installed and detected"),t.info("[extensionService] Chrome extension - try to connect..."),r.port=chrome.runtime.connect(r.extensionId),r.port?(t.info("[extensionService] Chrome extension - port created"),r.port.onDisconnect.addListener((function(){t.info("Extension DISCONNECTED"),r.extensionFound=!1,r.port=null})),r.port.onMessage.addListener((function(e){switch(t.info("[extensionService] Chrome extension - connected"),e.type){case"loginResponse":r.extensionFound=!0,t.info("[extensionService] Chrome extension - ready!"),t.info("[extensionService] === STARTED ==="),n.$broadcast("ON_EXTENSION_SHARING_READY"),i.resolve();break;case"getVersionResponse":0===e.code&&e.version?(n.$broadcast("ON_EXTENSION_VERSION_UPDATED",e.version),t.info("[extensionService] Chrome extension - Detected version "+e.version)):(n.$broadcast("ON_EXTENSION_VERSION_UPDATED",null),t.error("[extensionService] Chrome extension - No version received"));break;case"startsharingResponse":0===e.code&&e.streamID?(t.info("[extensionService] Chrome extension - stream ID received "+e.streamID),n.$broadcast("ON_EXTENSION_SHARING_STREAM_FOUND",e.streamID)):(t.info("[extensionService] Chrome extension - No stream ID received"),n.$broadcast("ON_EXTENSION_SHARING_STREAM_FOUND",null));break;case"endsharingResponse":t.info("[extensionService] Chrome extension - end sharing session received")}})),r.port.postMessage({type:"login",data:null})):(t.info("[extensionService] Chrome extension - can't create port to contact the extension!!!"),t.info("[extensionService] === STARTED ==="),i.resolve())):(t.info("[extensionService] Chrome extension - not found"),chrome.runtime.lastError&&t.info("[extensionService] Chrome extension - error "+chrome.runtime.lastError),i.resolve())}))):(t.info("[extensionService] Not in chrome"),t.info("[extensionService] === STARTED ==="),i.resolve()),i.promise},this.stop=function(){return t.info("[extensionService] === STOPPING ==="),t.info("[extensionService] === STOPPED ==="),e.when()},this.getExtensionId=function(e){return t.info("Detected domain : "+e),-1!==e.indexOf("openrainbow.net")?"koefhabbjedbiecnldkolbijjfjinogj":-1!==e.indexOf("openrainbow.org")?"ehamhlkmecdnidihfedapmplddlbidee":(-1!==e.indexOf("openrainbow.com")||t.error("Unkown domain, extension may not be available"),"mgneongoclkopahpapenfhbbeckhdmnj")},this.setExtensionId=function(e){t.info("set extensionId to : "+e),this.extensionId=e},this.getStreamToShareFromExtension=function(t){var i=e.defer(),a=n.$on("ON_EXTENSION_SHARING_STREAM_FOUND",(function(e,n){r.currentStreamId=n,a(),n?(t.video.mandatory.chromeMediaSourceId=n,i.resolve()):i.reject()}));return this.port.postMessage({type:"startsharing",data:null}),i.promise},this.getStreamId=function(){return this.currentStreamId},this.isExtensionInstalled=function(){var t=e.defer();return this.extensionFound?t.resolve(!0):this.start().then((function(){t.resolve(r.extensionFound)})),t.promise},this.getExtensionVersion=function(){var t=e.defer(),r=n.$on("ON_EXTENSION_VERSION_UPDATED",(function(e,n){r(),n?t.resolve(n):t.reject()}));return this.port.postMessage({type:"getVersion",data:null}),t.promise},this.checkExtensionStatus=function(){var t=e.defer();return"chrome"!==adapter.default.browserDetails.browser?t.resolve("notNeeded"):this.isExtensionInstalled().then((function(e){e?r.checkVersion().then((function(e){e?t.resolve("good"):t.resolve("needUpdate")})):t.resolve("notInstalled")})),t.promise},this.checkVersion=function(){var t=e.defer();return this.getExtensionVersion().then((function(e){t.resolve(r.cmpVersions(e,r.minVersion)>=0)})),t.promise},this.cmpVersions=function(e,t){var n,r,i=/(\.0+)+$/,a=e.replace(i,"").split("."),o=t.replace(i,"").split("."),s=Math.min(a.length,o.length);for(n=0;n<s;n++)if(r=parseInt(a[n],10)-parseInt(o[n],10))return r;return a.length-o.length}}])},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(27),a=n(1),o=n(5),s=n(2),c=n(10),l=n(24),u=n(4),d=n(6),h=n(33),f=function(){function e(t,n,r,i,l,f,p,m,v,g,y){var b=this;S(this,e),this.$q=t,this.$rootScope=n,this.$log=r,this.$http=i,this.$interval=l,this.videoService=f,this.errorHelperService=p,this.ConferenceSession=m,this.platformService=v,this.Conference=g,this.$translate=y,this.MEDIATYPE={WEBRTC:"webrtc",WEBRTCSHARINGONLY:"webrtcSharingOnly",PSTNAUDIO:"pstnAudio"},this.xmppConnectionSubscription=null,this.started=!1,this.webConferenceRoom=null,this.webrtcConferenceId=null,this.webrtcSharingOnlyRoom=null,this.webrtcSharingOnlyConferenceId=null,this.jingleJid=null,this.makingCall=!1,this.mozaicViewModeValue=!0,this.connected=!1,this.disconnecting=!1,this.reconnecting={},this.audioProfileChanging=!1,this.activeSpeaker=!1,this.addingMedia=!1,this.settingsService=o.default,this.authService=s.default,this.xmppService=u.default,this.profileService=d.default,this.contactService=a.default,this.roomService=h.default,this.conferenceEndpoints={},this.conferenceSessions={},this.rxSubject=new c.Subject,this.attachLocalMediaStream=function(e,t){if(e){var n=!1;if((t.hasLocalVideo||t.hasLocalSharing)&&(n=b.hasRemoteVideoOrSharingSession(t.id)),t.hasLocalVideo){var r=t.sessions[t.localVideoSessionId];if(r){var i=t.localStreams[r.localStreamId];n||t.hasLocalSharing||b.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),i,r.sid),b.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#conferenceVideoPip"),i,r.sid)}}if(t.hasLocalSharing){var a=t.sessions[t.localSharingSessionId];if(a){var o=t.localStreams[a.localStreamId];n?b.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#conferenceSharingPip"),o,a.sid):b.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),o,a.sid)}}}else b.videoService.RTC.clearMediaStream(angular.element("#minivideo"),null)}}return C(e,[{key:"start",value:function(e){var t=this;return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.$log.info("[WebConferenceService] === start skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((function(n){var r=performance.now();t.$log.info("[WebConferenceService] === STARTING ==="),t.confProvPortalURL=config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/",t.confPortalURL=config.restServerUrl+"/api/rainbow/conference/v1.0/conferences/",t.conferenceEndpoints={},t.conferenceSessions={},t.listeners=[],t.statsIntervals=[],t.connected=!0,t.disconnecting=!1,t.webConferenceRoom=null,t.webrtcConferenceId=null,t.webrtcSharingOnlyRoom=null,t.webrtcSharingOnlyConferenceId=null,t.jingleJid=null,t.makingCall=!1,t.videoGalleryElements=[],t.activeSpeaker=t.profileService.isFeatureEnabled(t.profileService.FeaturesEnum.BUBBLE_ACTIVE_SPEAKER),t.attachHandlers(),t.videoGalleryElementsNumber=5,t.started=!0;var i=Math.round(performance.now()-r);e.push({service:"WebConferenceService",startDuration:i}),t.$log.info("[WebConferenceService] === STARTED ("+i+" ms) ==="),n()}))}},{key:"stop",value:function(){return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.$log.info("[WebConferenceService] === stop skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):(this.$log.info("[WebConferenceService] === STOPPING ==="),this.started=!1,this.makingCall=!1,this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.listeners&&this.listeners.forEach((function(e){e()})),this.$log.info("[WebConferenceService] === STOPPED ==="),this.$q.when())}},{key:"attachHandlers",value:function(){var e=this;this.listeners.push(this.$rootScope.$on("ON_INPUT_DEVICE_CHANGED_EVENT",(function(){e.onAudioProfileChangeEvent()}))),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((function(t){e.$log.info("[WebConferenceService] onConnectionStateChangeEvent : "+t.name);try{"ON_XMPP_DISCONNECTED"===t.name?(e.$log.info("[WebConferenceService] onConnectionStateChangeEvent : disconnected"),e.connected=!1):"ON_XMPP_CONNECTED"===t.name&&(e.$log.info("[WebConferenceService] onConnectionStateChangeEvent : connected"),e.connected=!0,Object.keys(e.conferenceSessions).forEach((function(t){var n=e.conferenceSessions[t];if("reconnecting"===n.status)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];("audio"===i.localType||n.localVideoSessionId===r||n.localSharingSessionId===r)&&e.sendTransportReplaceForSession(i,5e3)}e.$interval((function(t){if(e.connected&&t.isActive()&&t.haveJoined){if(t.videoGallery||(e.createVideoGalleryElements(t.conferenceView),t.videoGallery=e.videoGalleryElements),!e.isAlreadySubscribedToDynamicFeed(t.id)){var n,r=null,i=g(t.publishers);try{for(i.s();!(n=i.n()).done;){var a=n.value;if("video"===a.mediaType){r=a;break}}}catch(o){i.e(o)}finally{i.f()}e.subscribeToDynamicFeed(t.id,r,t.videoGallery[0].id,"2",!0)}e.subscribeToPublishers(t)}}),5e3,1,!0,n)})))}catch(n){e.$log.info("[WebConferenceService] onConnectionStateChangeEvent error : "+n)}}))}},{key:"subscribe",value:function(e){return this.rxSubject.subscribe(e)}},{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next(l.RBEvent.create(e,t))}},{key:"retrieveWebConferences",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.MEDIATYPE.WEBRTC;return this.$log.info("[WebConferenceService] retrieveWebConferences with mediaType="+t),this.$q((function(n,r){if(!e.profileService.isFeatureEnabled(e.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED)&&t!==e.MEDIATYPE.WEBRTCSHARINGONLY)return e.$log.warn("[WebConferenceService] retrieveWebConferences - user is not allowed"),void r(new Error("notAllowed"));var i="?scheduled=false&format=full&userId="+e.contactService.userContact.dbId;e.$http({method:"GET",url:e.confProvPortalURL+"conferences"+i,headers:e.authService.getRequestHeader()}).then((function(t){var r=t.data.data;e.$log.info("[WebConferenceService] retrieveWebConferences successfully");var i,a=g(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;switch(o.mediaType){case e.MEDIATYPE.WEBRTC:case e.MEDIATYPE.WEBRTCSHARINGONLY:e.updateOrCreateWebConferenceEndpoint(o);break;case e.MEDIATYPE.PSTNAUDIO:}}}catch(s){a.e(s)}finally{a.f()}n(r)}),(function(t){var n="retrieveWebConferences failure: "+(t.data?t.data.errorDetails:t.data);e.$log.error("[WebConferenceService] "+n),r(new Error(n))}))}))}},{key:"updateSubstreamLevelForPublisher",value:function(e,t,n,r){var i=this;return e&&t&&n&&r&&r.publisherId?(this.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher(confId="+e+" participantId="+t+" publisherId="+r.publisherId+" level="+n+")"),r.simulcast&&r.subStreamLevel!==n?this.$q((function(a,o){if(!i.conferenceSessions[e])return i.$log.error("[WebConferenceService] updateSubstreamLevelForPublisher - no corresponding conference session to update"),void o();var s={option:"update",mediaType:"webrtc",publisherId:r.publisherId,subStreamLevel:n};i.$http({method:"PUT",url:i.confPortalURL+e+"/participants/"+t,headers:i.authService.getRequestHeader(),data:s}).then((function(o){var s=o.data;r.subStreamLevel=n,i.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher( confId="+e+" participantId="+t+" publisherId="+r.publisherId+" level="+n+") successfully"),a(s)}),(function(n){var r=n.data?n.data.errorDetails:n.data,a="updateSubstreamLevelForPublisher( confId="+e+" participantId="+t+") failure: "+r;i.$log.error("[WebConferenceService] "+a),o(new Error(a))}))})):(this.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher - already at same level (or no simulcast proposed)"),this.$q.resolve())):(this.$log.error("[WebConferenceService] updateSubstreamLevelForPublisher - missing a parameter"),this.$q.reject())}},{key:"updateConference",value:function(e,t){var n=this;return this.$log.info("[WebConferenceService] updateConference"),this.$q((function(r,i){if(e)n.$http({method:"PUT",url:n.confProvPortalURL+"conferences/"+e,headers:n.authService.getRequestHeader(),data:t}).then((function(e){var t=e.data.data,i=n.Conference.createFromData(t);t.hasOwnProperty("id")&&(n.conferenceEndpoints[t.id]&&delete n.conferenceEndpoints[t.id],n.conferenceEndpoints[t.id]=i),n.$log.info("[WebConferenceService] updateConference successfully"),r(i)}),(function(e){var t="updateConference failure: "+(e.data?e.data.errorDetails:e.data);n.$log.error("[WebConferenceService] "+t),i(new Error(t))}));else{n.$log.error("[WebConferenceService] updateConference failure : No confEndpoint"),i(new Error("updateConference failure: No confEndpoint"))}}))}},{key:"createVideoGalleryElements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gallery_view";this.videoGalleryElements=[];var t=0;if(t=e===this.ConferenceSession.ConferenceView.SpeakerView?0:e===this.ConferenceSession.ConferenceView.GalleryView?this.videoGalleryElementsNumber:12,this.activeSpeaker){var n={state:"free",sessionId:"",id:"videoGallery_0",publisherId:"",subStreamLevel:null,activeSpeaker:!0,hold:!1};this.videoGalleryElements.push(n)}for(var r=1;r<=t;r++){var i={state:"free",sessionId:"",id:"videoGallery_"+r,publisherId:"",publisherJid:"",subStreamLevel:null,hold:!1};this.videoGalleryElements.push(i)}if(this.activeSpeaker&&this.mozaicViewModeValue)for(var a=t+1;a<=12;a++){var o={state:"busy",sessionId:"",id:"videoGallery_"+a,publisherId:"",publisherJid:"",subStreamLevel:null,hold:!1};this.videoGalleryElements.push(o)}}},{key:"updateVideoGalleryElementsState",value:function(e,t,n){if(!this.activeSpeaker)return t;if("true"===this.settingsService.getSetting("sfuDisableHold"))return t;var r=0,i=0;n===this.ConferenceSession.ConferenceView.SpeakerView?(r=0,i=0):n===this.ConferenceSession.ConferenceView.GalleryView?(r=0,i=this.videoGalleryElementsNumber):(r=1,i=12);for(var a=0;a<r;a++)if("free"===t[a].state)t[a].state="busy";else if("busy"===t[a].state&&t[a].sessionId&&!t[a].hold){var o=e.sessions[t[a].sessionId];o&&o.sendHold(!0),t[a].hold=!0}for(var s=r;s<=i;s++)if("busy"!==t[s].state||t[s].sessionId||t[s].publisherId){if("busy"===t[s].state&&t[s].sessionId&&t[s].hold){t[s].hold=!1;var c=e.sessions[t[s].sessionId];c&&c.sendHold(!1)}}else t[s].state="free";for(var l=i+1;l<=12;l++)if("free"===t[l].state)t[l].state="busy";else if("busy"===t[l].state&&t[l].sessionId&&!t[l].hold){t[l].hold=!0;var u=e.sessions[t[l].sessionId];u&&u.sendHold(!0)}return t}},{key:"holdOrUnholdHiddenSessions",value:function(e,t,n){if(!this.activeSpeaker)return t;for(var r=this.videoGalleryElementsNumber,i=1;i<=r;i++)if("busy"!==t[i].state||t[i].sessionId||t[i].publisherId||(t[i].state="free"),n&&"busy"===t[i].state&&t[i].sessionId&&!t[i].hold&&!t[i].pinned){t[i].hold=!0;var a=e.sessions[t[i].sessionId];a&&a.sendHold(!0)}else if(!n&&"busy"===t[i].state&&t[i].sessionId&&t[i].hold){t[i].hold=!1;var o=e.sessions[t[i].sessionId];o&&o.sendHold(!1)}return t}},{key:"setVideoGalleryElementsNumber",value:function(e){this.videoGalleryElementsNumber=e}},{key:"setActiveSpeakerValue",value:function(e){this.activeSpeaker=e}},{key:"setMozaicViewModeValue",value:function(e){this.mozaicViewModeValue=e}},{key:"isActiveSpeakerEnabled",value:function(){return this.activeSpeaker}},{key:"getConferenceSessions",value:function(){return this.conferenceSessions}},{key:"getConferenceEndpoints",value:function(){return this.conferenceEndpoints}},{key:"addConferenceEndpoint",value:function(e,t){e?this.conferenceEndpoints[e]=t:this.$log.warn("[WebConferenceService] addConferenceEndpoint - missing conferenceEndpointId")}},{key:"getConferenceIdToUse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.MEDIATYPE.WEBRTC,n=this.getPontConfIdForRoom(e,t);if(n)return n;switch(t){case this.MEDIATYPE.WEBRTC:if(e.isUserModerator(this.contactService.userContact)&&this.webrtcConferenceId)return this.webrtcConferenceId;break;case this.MEDIATYPE.WEBRTCSHARINGONLY:if(e.owner&&this.webrtcSharingOnlyConferenceId)return this.webrtcSharingOnlyConferenceId}return""}},{key:"isMyConference",value:function(e){return e&&(this.webrtcConferenceId&&e===this.webrtcConferenceId||this.webrtcSharingOnlyConferenceId&&e===this.webrtcSharingOnlyConferenceId)}},{key:"bubbleDeclineInvitationForWebConference",value:function(e){var t=this;return this.$q((function(n,r){if(!e){var i=new Error("[webConferenceService] bubbleDeclineInvitationForWebConference error - missing parameters for room");return t.$log.error(i.message),void r(i)}var a=t.getConferenceIdToUse(e,t.MEDIATYPE.WEBRTC);if(!a){var o=new Error("[webConferenceService] bubbleDeclineInvitationForWebConference error - no available pont conference");return t.$log.error(o.message),void r(o)}t.$http({method:"PUT",url:t.confPortalURL+a+"/reject",headers:t.authService.getRequestHeader(),data:{mediaType:t.MEDIATYPE.WEBRTC,roomId:e.dbId}}).then((function(){t.$log.debug("[webConferenceService] bubbleDeclineInvitationForWebConference - success -- "),n()}),(function(e){t.makingCall=!1,t.$log.error("[webConferenceService] bubbleDeclineInvitationForWebConference - error on server"),r(t.errorHelperService.handleError(e))}))}))}},{key:"bubbleStartOrJoinWebConference",value:function(e){var t=this;return this.$q((function(n,r){if(!e){var i=new Error("[webConferenceService] bubbleStartOrJoinWebConference error - missing parameters for room");return t.$log.error(i.message),void r(i)}var a=t.getConferenceIdToUse(e,t.MEDIATYPE.WEBRTC);t.isMyConference(a)?t.bubbleStartWebConference(e).then((function(){n()})).catch((function(){r()})):t.bubbleJoinWebConference(e).then((function(){n()})).catch((function(e){r(e)}))}))}},{key:"bubbleStartWebConference",value:function(e){var t=this;return this.$q((function(n,r){if(!e){var i=new Error("[webConferenceService] bubbleStartWebConference error - missing parameters for room");return t.$log.error(i.message),void r(i)}var a=t.getConferenceIdToUse(e,t.MEDIATYPE.WEBRTC);if(!a){var o=new Error("[webConferenceService] bubbleStartWebConference error - no available pont conference");return t.$log.error(o.message),void r(o)}if(t.makingCall)return t.$log.warn("[webConferenceService] already starting a conference"),t.$q.resolve();t.$log.info("[WebConferenceService] bubbleStartWebConference "+a),t.makingCall=!0;var s=t.conferenceSessions[a];if(s&&s.active)return t.$log.info("[webConferenceService] bubbleStartWebConference - No need to start an already active conference"),void n(t.joinWebConference(a,"moderator",!1));var c=t.ConferenceSession.createFromData(a,[],!1,"webrtc");c.status="ringing",c.roomId=e.dbId,c.isMyConference=!0,t.conferenceSessions[a]=c,t.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",t.conferenceSessions[a]),t.$http({method:"PUT",url:t.confPortalURL+a+"/start",headers:t.authService.getRequestHeader(),data:{mediaType:t.MEDIATYPE.WEBRTC,roomId:e.dbId}}).then((function(){return t.$log.info("[webConferenceService] startWebConference - success -- now joining the conference"),n(t.joinWebConference(a,"moderator",!1))}),(function(e){t.makingCall=!1;var n="[webConferenceService] startWebConference - error on server, can't start conference -- ",i="startMeetingFailure";e&&((403620===e.errorDetailsCode||e.data&&403620===e.data.errorDetailsCode)&&(i="startMeetingConflict"),e.errorDetailsLabel?n+=e.errorDetailsLabel:e.data&&(n+=e.data.errorDetailsCode+" "+e.data.errorMsg)),t.$log.error(n),t.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"startConference",popupBody:i,okLabel:"ok"}),t.leaveWebConference(a),t.removeConferenceSession(a),r(t.errorHelperService.handleError(e)),t.$log.error("[webConferenceService] startWebConference "+t.errorHelperService.getErrorFullMessage(e))}))}))}},{key:"bubbleJoinWebConference",value:function(e){var t=this;return this.$q((function(n,r){if(!e){var i=new Error("[webConferenceService] bubbleJoinWebConference error - missing parameters for room");return t.$log.error(i.message),void r(i)}var a=t.getConferenceIdToUse(e,t.MEDIATYPE.WEBRTC);if(!a){var o=new Error("[webConferenceService] bubbleJoinWebConference error - no available pont conference");return t.$log.error(o.message),void r(o)}if(t.makingCall)return t.$log.warn("[webConferenceService] already joining a conference"),t.$q.resolve();t.$log.info("[WebConferenceService] bubbleJoinWebConference "+a),t.makingCall=!0,t.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",e);var s=t.conferenceSessions[a];s||(s=t.ConferenceSession.createFromData(a,[],!1,"webrtc")),s.status="ringing",s.roomId=e.dbId,t.conferenceSessions[a]=s,t.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",t.conferenceSessions[a]);var c=t.isMyConference(a)?"moderator":"member";t.joinWebConference(a,c).then((function(){n()})).catch((function(){r()}))}))}},{key:"startOrJoinWebConference",value:function(e){var t=this;return this.$q((function(n,r){if(!e){var i=new Error("[webConferenceService] startOrJoinWebConference error - missing parameters for room");return t.$log.error(i.message),void r(i)}var a=t.getConferenceIdToUse(e,t.MEDIATYPE.WEBRTC);if(!a){var o=new Error("[webConferenceService] startOrJoinWebConference error - no available pont conference");return t.$log.error(o.message),void r(o)}if(t.$log.info("[WebConferenceService] startOrJoinWebConference -- "+a),t.makingCall)return t.$log.warn("[webConferenceService] already starting a conference"),t.$q.resolve();t.makingCall=!0,t.makeSnapshotForConfId(a,t.MEDIATYPE.WEBRTC).then((function(){var i=t.conferenceSessions[a];if(!(t.isMyConference(a)||i&&i.active)){var o=new Error("[webConferenceService] startOrJoinWebConference error - no active conference to join");return t.$log.error(o.message),r(o),void(t.makingCall=!1)}var s=t.isMyConference(a)?"moderator":"member";i&&i.active?(t.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",e),n(t.joinWebConference(a,s))):n(t.startWebConference(e,a))}),(function(){t.makingCall=!1;var e=new Error("[webConferenceService] startOrJoinWebConference error on snapshot");t.$log.error(e.message),r(e)}))}))}},{key:"startWebConference",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t&&e?(this.makingCall=!0,this.$log.info("[webConferenceService] startWebConference wtih ID "+t),this.$q((function(e){r?(n.$log.debug("[webConferenceService] startWebConference - trigger snapshot for "+t),e(n.makeSnapshotForConfId(t,n.MEDIATYPE.WEBRTC))):e()})).then((function(){return n.conferenceSessions[t].active?(n.$log.info("[webConferenceService] startWebConference - No need to start an already active conference"),n.joinWebConference(t,"moderator",!1)):(n.conferenceSessions[t].status="ringing",n.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",n.conferenceSessions[t]),n.$http({method:"PUT",url:n.confPortalURL+t+"/start",headers:n.authService.getRequestHeader(),data:{mediaType:n.MEDIATYPE.WEBRTC,roomId:e.dbId}}).then((function(){return n.$log.info("[webConferenceService] startWebConference - success -- now joining the conference"),n.joinWebConference(t,"moderator",!1)}),(function(e){throw n.makingCall=!1,n.$log.error("[webConferenceService] startWebConference wtih ID "+t+" failure ... -- "+n.errorHelperService.getErrorFullMessage(e)),n.leaveWebConference(t),n.removeConferenceSession(t),n.errorHelperService.handleError(e)})))})).catch((function(e){n.makingCall=!1;var t="[webConferenceService] startWebConference - error on server, can't start conference -- ",r="startMeetingFailure";return e&&(403620===e.errorDetailsCode&&(r="startMeetingConflict"),e.errorDetailsLabel&&(t+=e.errorDetailsLabel)),n.$log.error(t),n.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"startConference",popupBody:r,okLabel:"ok"}),n.$q.reject(e)}))):(this.$log.error("[startWebConference] No webPontConferenceId or Room!"),this.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"startConference",popupBody:"startMeetingFailure",okLabel:"ok"}),this.$q.reject())}},{key:"joinWebConference",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.$log.info("[webConferenceService] joinWebConference with ID "+e+" and role "+t),e?this.$q((function(t){r?(n.$log.debug("[webConferenceService] joinWebConference - trigger snapshot for "+e),t(n.makeSnapshotForConfId(e,n.MEDIATYPE.WEBRTC))):t()})).then((function(){return n.$q((function(r,a){n.makingCall=!0,n.createVideoGalleryElements(n.conferenceSessions[e].conferenceView),n.conferenceSessions[e].videoGallery=n.videoGalleryElements,"ringing"!==n.conferenceSessions[e].status&&(n.conferenceSessions[e].status="ringing",n.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",n.conferenceSessions[e]));var o="web_"+i(),s=n.profileService.isFeatureEnabled(n.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED),c=n.confPortalURL+e+"/join",l={participant:{role:t,type:"unmuted"},mediaType:n.MEDIATYPE.WEBRTC,delegateCapability:s};n.videoService.config&&n.videoService.config.dc&&(l.dc=n.videoService.config.dc),n.getUserMediaForSession(e).then((function(t){n.$http({method:"POST",url:c,headers:n.authService.getRequestHeader(),data:l}).then((function(t){var i=t.data.data;n.jingleJid=i.jingleJid;var a=i.transportTurn;n.initCall(n.jingleJid,e,o,n.MEDIATYPE.WEBRTC,a),n.conferenceSessions[e].haveJoined=!0,n.makingCall=!1,r()}),(function(t){if(t){var r=t.data?t.data.errorDetails:t.data,i="joinWebConference( confId="+e+") failure: "+r;n.$log.error("[webConferenceService] "+i)}n.makingCall=!1;var o={popupTitle:"warning",popupBody:"joinMeetingFailure",okLabel:"ok"};t&&t.data&&403615===t.data.errorDetailsCode&&(o.popupBody="maximumNumberConferenceParticipantsReach"),t&&t.data&&403060===t.data.errorDetailsCode&&(o.popupBody="lockedConferenceError"),n.leaveWebConference(e),delete n.conferenceSessions[e],n.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",o),a(n.errorHelperService.handleError(t))}))})).catch((function(t){n.$log.error("[webConferenceService] joinWebConference - getUserMediaForSession reject -- "+t),n.makingCall=!1,"ignore"!==t&&n.leaveWebConference(e),a()}))}))})).catch((function(){return n.makingCall=!1,n.$log.error("[webConferenceService] joinWebConference - error on server, can't join conference"),n.$q.reject()})):(this.$log.error("[webConferenceService] joinWebConference - No webPontConferenceId !"),this.$q.reject())}},{key:"joinSharingOnlyConference",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.$log.info("[webConferenceService] joinSharingOnlyConference with ID "+e+" and role "+t),e?this.$q((function(t){r?(n.$log.debug("[webConferenceService] joinSharingOnlyConference - trigger snapshot for "+e),t(n.makeSnapshotForConfId(e,n.MEDIATYPE.WEBRTCSHARINGONLY))):t()})).then((function(){return n.$q((function(r,a){n.makingCall=!0,n.createVideoGalleryElements(),n.conferenceSessions[e].videoGallery=n.videoGalleryElements,"ringing"!==n.conferenceSessions[e].status&&(n.conferenceSessions[e].status="ringing",n.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",n.conferenceSessions[e])),i();var o=n.confPortalURL+e+"/join",s={participant:{role:t,type:"muted"},mediaType:n.MEDIATYPE.WEBRTCSHARINGONLY};n.$http({method:"POST",url:o,headers:n.authService.getRequestHeader(),data:s}).then((function(t){var i=t.data.data;n.jingleJid=i.jingleJid,n.$log.info("[webConferenceService] joinSharingOnlyConference with ID success - jingleJid: "+n.jingleJid),n.conferenceSessions[e].jingleJid=n.jingleJid,n.conferenceSessions[e].haveJoined=!0,n.makingCall=!1,r()}),(function(t){if(t){var r=t.data?t.data.errorDetails:t.data,i="joinSharingOnlyConference( confId="+e+") failure: "+r;n.$log.error("[conferenceService] "+i)}n.makingCall=!1;t&&t.data&&t.data.errorDetailsCode,n.leaveWebConference(e),delete n.conferenceSessions[e],a(n.errorHelperService.handleError(t))}))}))})).catch((function(){return n.makingCall=!1,n.$log.error("[webConferenceService] joinSharingOnlyConference - error on server, can't join conference"),n.$q.reject()})):(this.$log.error("[webConferenceService] joinSharingOnlyConference - No webPontConferenceId !"),this.$q.reject())}},{key:"getFreeVideoGalleryElement",value:function(e){this.$log.info("[webConferenceService] getFreeVideoGalleryElement "+e);var t=this.conferenceSessions[e],n=null;if(t){t.videoGallery||(this.createVideoGalleryElements(t.conferenceView),t.videoGallery=this.videoGalleryElements);for(var r=0;r<t.videoGallery.length;r++)if("free"===t.videoGallery[r].state){n=t.videoGallery[r];break}}return n}},{key:"askToAddSharingToConferenceSession",value:function(e,t){!this.videoService.askToAddSharing(e.id,"sharing")&&this.addMediaToConferenceSession(t,"sharing")}},{key:"addMediaToConferenceSession",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&!this.addingMedia)if("true"!==this.settingsService.getSetting("sfuJoinBundle")||"video"!==t){this.addingMedia=!0;var i=[t],a=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_SIMULCAST),o=17,s=a?1280:640,c=a?720:480;"video"!==t&&(o=10,s=1280,c=720),"sharing"===t&&this.contactService.setBusyState("dnd","sharing");var l=r?this.$q.when(r):this.videoService.getBrowserMedia(i,s,c,o);this.$log.info("[webConferenceService] addMediaToConferenceSession to session "+e.id+" with media "+t),l.then((function(r){n.addingMedia=!1;var i=[r],a=n.videoService.config.unifiedPlan,o=n.xmppService.connection.jingle.initiate(e.jingleJid,n.xmppService.connection.jid,t,i,null,e.id,null,a);e.sessions[o.sid]=o,e.localStreams.push(r),o.localStreamId=e.localStreams.length-1,"video"===t?(e.hasLocalVideo=!0,e.localVideoSessionId=o.sid):(e.hasLocalSharing=!0,e.localSharingSessionId=o.sid,n.sendEvent("startHighlighting")),n.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e),n.videoService.callsStats[o.sid]={},n.updateStatisticsForSession(e.id,o.sid),n.statsIntervals.push(o.getStats(5e3))})).catch((function(){n.addingMedia=!1}))}else this.addBundleMediaToConferenceSession(e)}},{key:"removeMediaFromConferenceSession",value:function(e,t){if(e){"sharing"===t&&this.contactService.setBusyState("dnd","audio"),"webrtcSharingOnly"===e.type&&this.contactService.resetBusyState(),this.$log.info("[webConferenceService] removeMediaFromConferenceSession from session "+e.id);var n="video"===t?e.localVideoSessionId:e.localSharingSessionId;if(e.sessions[n]){var r=e.sessions[n];this.updateStatisticsForSession(e.id,n),this.videoService.disableAudioVideoMedia(r),this.xmppService.connection.jingle.terminate(r.sid),delete e.sessions[n],delete e.localStreams[r.localStreamId],delete this.videoService.callsStats[n],"video"===t?(e.hasLocalVideo=!1,e.localVideoSessionId=null):(e.hasLocalSharing=!1,e.localSharingSessionId=null,this.sendEvent("stopHighlighting"))}this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e)}}},{key:"dropRemoteVideoSession",value:function(e,t){if(e){if(this.$log.info("[webConferenceService] dropRemoteVideoSession fom conference "+e.id+" and session "+t),e.sessions[t]){var n=e.sessions[t];this.updateStatisticsForSession(e.id,t),this.xmppService.connection.jingle.terminate(n.sid),delete e.sessions[t],delete this.videoService.callsStats[t]}this.removeSessionFromVideoGallery(e,t),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e)}}},{key:"getUserMediaForSession",value:function(e){var t=this;return this.$q((function(n,r){var i=t.conferenceSessions[e];i?("ringing"!==i.status&&(t.conferenceSessions[e].status="ringing",t.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",i)),i.haveJoined=!0,t.videoService.getBrowserMedia(["audio"]).then((function(i){t.$log.info("[webConferenceService] getUserMediaForSession -- sucess");var a=t.conferenceSessions[e];if(!a||"ended"===a.status)return t.$log.info("[webConferenceService] getUserMediaForSession -- missing conference"),t.disableMediaStream(i),void r("conference does not exist anymore");if(!t.makingCall)return t.$log.info("[webConferenceService] getUserMediaForSession -- already in the conference -- ignore"),t.disableMediaStream(i),void r("ignore");var o=[i];a.localStreams=o,n()})).catch((function(){t.$log.error("[webConferenceService] getUserMediaForSession error -- getUserMedia failed"),t.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"warning",popupBody:"devicePermission",okLabel:"ok"}),r("failed to get user media")}))):r()}))}},{key:"disableMediaStream",value:function(e){e&&(e.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),e.stop&&e.stop(),e=null)}},{key:"initCall",value:function(e,t,n,i){var a=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=this.conferenceSessions[t];return this.$q((function(e){s||(a.$log.warn("[webConferenceService] initCall - no conferenceSession as though we are trying to init call"),e(a.makeSnapshotForConfId(t,i))),e()})).then((function(){return r(a,void 0,void 0,b.a.mark((function r(){var i,a,c,l=this;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.videoService.setWebrtcConfiguration().catch((function(){l.$log.error("[webConferenceService] initCall - setWebrtcConfiguration failed")}));case 2:return i=!!this.videoService.config&&this.videoService.config.unifiedPlan,a="audio","true"===this.settingsService.getSetting("sfuJoinBundle")&&(a="audio+video"),c=this.xmppService.connection.jingle.initiate(e,this.xmppService.connection.jid,a,s.localStreams,n,t,null,i,o),r.abrupt("return",(s.jingleJid=e,s.sessions[c.sid]=c,s.status="ringing",this.createStatisticsForSession(t,c.sid),this.statsIntervals.push(c.getStats(3e3)),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",s),s));case 7:case"end":return r.stop()}}),r,this)})))}))}},{key:"transferCall",value:function(e,t,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return r(this,void 0,void 0,b.a.mark((function r(){var l,u,d,h,f,p,m,v=this;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,this.makingCall=!0,this.$log.info("[webConferenceService] transferCall to "+n),r.next=5,this.makeSnapshotForConfId(n,a,!0);case 5:return r.next=7,this.videoService.setWebrtcConfiguration().catch((function(){v.$log.error("[webConferenceService] transferCall - setWebrtcConfiguration failed")}));case 7:return l=!!this.videoService.config&&this.videoService.config.unifiedPlan,r.next=10,this.getUserMediaForSession(n);case 10:return(u=this.conferenceSessions[n]).participants&&u.participants.forEach((function(e){o&&e.jid_im!==v.contactService.userContact.jid?e.role="member":o||e.jid_im!==v.contactService.userContact.jid||(e.role="member")})),d="audio","true"===this.settingsService.getSetting("sfuJoinBundle")&&(d="audio+video"),h=this.xmppService.connection.jingle.initiate(t,this.xmppService.connection.jid,d,u.localStreams,i,n,null,l,!1),u.jingleJid=t,u.haveJoined=!0,u.sessions[h.sid]=h,u.status="ringing",u.roomId=s,u.isMyConference=o,this.createVideoGalleryElements(u.conferenceView),u.videoGallery=this.videoGalleryElements,s||(f=this.roomService.findRoomsWithConfId(n))&&f[0]&&(u.roomId=f[0].dbId),this.conferenceSessions[n]=u,this.makingCall=!1,this.createStatisticsForSession(n,h.sid),this.statsIntervals.push(h.getStats(3e3)),r.prev=17,e&&-1!==e.localType.indexOf("sharing")&&(p=e.localStreams.length-1,e.localStreams[e.localStreams.length-1].getAudioTracks().length&&(p=0),m=e.localStreams[p].clone(),this.$interval((function(){v.addMediaToConferenceSession(v.conferenceSessions[n],"sharing",m)}),1500,1,!0,n)),r.abrupt("return",(e&&-1!==e.localType.indexOf("video")&&this.$interval((function(){v.addMediaToConferenceSession(v.conferenceSessions[n],"video")}),1500,1,!0,n),c&&this.$interval((function(){var e=v.conferenceSessions[n].getConnectedParticipantByJid(v.contactService.userContact.jid);e&&v.muteParticipant(n,e.participantId,"mute")}),1e3,1,!0,n),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",u),u));case 22:return r.prev=22,r.t0=r.catch(17),r.abrupt("return",(this.$log.error("[webConferenceService] transferCall error on duplicate stream -- "+r.t0),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",u),u));case 25:r.next=30;break;case 27:r.prev=27,r.t1=r.catch(0),this.makingCall=!1,this.$log.error("[webConferenceService] transferCall error -- "+r.t1);case 30:case"end":return r.stop()}}),r,this,[[0,27],[17,22]])})))}},{key:"muteParticipant",value:function(e,t,n){var r=this;return this.$log.info("[ConferenceService] muteParticipant( confId="+e+"participantId="+t+" option="+n+")"),e&&t&&n?this.$q((function(i,a){if(!r.conferenceSessions[e])return r.$log.error("[ConferenceService] muteParticipant - no corresponding conference session to update"),void a();var o={option:n,mediaType:"webrtc"};r.$http({method:"PUT",url:r.confPortalURL+e+"/participants/"+t,headers:r.authService.getRequestHeader(),data:o}).then((function(n){var a=n.data;r.$log.info("[ConferenceService] muteParticipant( confId="+e+"participantId="+t+") successfully"),i(a)}),(function(n){var i=n.data?n.data.errorDetails:n.data,o="muteParticipant( confId="+e+"participantId="+t+") failure: "+i;r.$log.error("[ConferenceService] "+o),a(new Error(o))}))})):(this.$log.error("[ConferenceService] muteParticipant - missing a parameter"),this.$q.reject())}},{key:"createStatisticsForSession",value:function(e,t){var n=this;if(this.$log.info("[webConferenceService] createStatisticsForSession for conf "+e+" and session "+t),e&&t){this.videoService.callsStats[t]={};var r=[];r.push({connectionId:t,stats:this.videoService.callsStats[t]}),this.videoService.createStatisticsForSession(e,e,"pending",r).then((function(r){n.$log.info("[webConferenceService] createStatisticsForSession success "+r),n.videoService.callsStats[t].id=r,n.conferenceSessions[e].metricsId=r,n.conferenceSessions[e].metricsState="pending"})).catch((function(t){n.$log.error("[webConferenceService] createStatisticsForSession error for conf "+e)}))}else this.$log.warn("[webConferenceService] createStatisticsForSession -- missing parameters")}},{key:"updateStatisticsForSession",value:function(e,t){if(this.$log.info("[webConferenceService] updateStatisticsForSession for conf "+e+" and session "+t),e&&t){var n=this.conferenceSessions[e];if(n&&n.metricsId){n.metricsState||(n.metricsState="pending");var r=[];this.videoService.callsStats[t]&&Object.keys(this.videoService.callsStats[t]).length&&(this.videoService.callsStats[t].RainMetrics&&this.videoService.callsStats[t].push(this.videoService.callsStats[t].RainMetrics),r.push({connectionId:t,stats:this.videoService.callsStats[t]}),this.videoService.updateStatisticsForCall(n.metricsId,e,e,n.metricsState,r))}else this.$log.warn("[webConferenceService] updateStatisticsForSession -- missing webConference or no metricsId")}else this.$log.warn("[webConferenceService] updateStatisticsForSession -- missing parameters")}},{key:"leaveWebConference",value:function(e){if(this.$log.info("[WebConferenceService] leaveWebConference - "+e),this.contactService.resetBusyState(),e){var t=this.conferenceSessions[e];if(this.sendEvent("stopHighlighting"),t){for(var n in t.metricsState="ended",t.sessions)if(t.sessions.hasOwnProperty(n)){var r=t.sessions[n];this.updateStatisticsForSession(t.id,r.sid),this.videoService.disableAudioVideoMedia(r),this.xmppService.connection.jingle.terminate(r.sid),delete this.videoService.callsStats[r.sid]}var i;for(this.videoService.disableStreams(t.localStreams),t.cleanupSessionData(),this.createVideoGalleryElements(t.conferenceView),t.videoGallery=this.videoGalleryElements,t.sessions={};this.statsIntervals.length;)(i=this.statsIntervals.pop())&&(window.clearInterval(i),i=null);this.makingCall=!1,this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",t),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",t),this.videoService.clearSrcObjectsFromElements(),this.contactService.userContact.guestMode&&this.$rootScope.$broadcast("ON_OPEN_POPUP","concludeInvitation")}else this.$log.warn("[WebConferenceService] leaveWebConference - webConference does not exist")}}},{key:"attachDistantMediaStream",value:function(e,t){var n=this;if(e){var r=function(){var e=n.getRemoteAudioVideoBundleSession(t.id);if(e)return{v:void n.attachDistantBundleSession(e)};var r=n.getRemoteVideoSessions(t.id),i=n.getRemoteSharingSession(t.id),a=!1;if(i&&!i.showOnSecondPip||(a=n.updateMainSessionIfNeeded(t,r)),n.$log.info("[WebConferenceService] attachDistantMediaStream for session "+t.id),i&&!i.showOnSecondPip&&(i.remoteStreams.forEach((function(e){e.getVideoTracks().length>0&&n.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),e,i.sid)})),i.remoteStreamsObject[0]&&n.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),i.remoteStreamsObject[0],i.sid)),r.length){var o=function(e){if(r.hasOwnProperty(e)&&(r[e].remoteStreams&&r[e].remoteStreams.forEach((function(a){if(a.getVideoTracks().length>0){i&&!i.showOnSecondPip||!r[e].mainSession||n.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),a,r[e].sid);for(var o=0;o<t.videoGallery.length;o++)if(t.videoGallery[o].sessionId===r[e].sid){n.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#"+t.videoGallery[o].id),a,t.videoGallery[o].sessionId);break}}})),r[e].remoteStreamsObject[0])){i&&!i.showOnSecondPip||!r[e].mainSession||n.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),r[e].remoteStreamsObject[0],r[e].sid);for(var a=0;a<t.videoGallery.length;a++)if(t.videoGallery[a].sessionId===r[e].sid){n.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#"+t.videoGallery[a].id),r[e].remoteStreamsObject[0],t.videoGallery[a].sessionId);break}}};for(var s in r)o(s)}var c=n.getRemoteAudioSession(t.id);c&&c.remoteStreams&&c.remoteStreams.forEach((function(e){e.getAudioTracks().length>0&&n.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),e,c.sid)})),c&&c.remoteStreamsObject[0]&&n.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),c.remoteStreamsObject[0],c.sid),a&&n.updateSubStreamLevelsForConferenceSession(t.id)}();if("object"===typeof r)return r.v}}},{key:"attachGalleryMediaStreams",value:function(e){var t=this,n=this.getRemoteVideoSessions(e.id);n.length&&n.forEach((function(n){for(var r=0;r<e.videoGallery.length;r++)if(e.videoGallery[r].sessionId===n.sid){t.attachSessionVideoToHtmlElement(n,e.videoGallery[r].id);break}}))}},{key:"attachMozaicVideos",value:function(e,t){var n=this,r=this.getRemoteVideoSessions(e.id);r.length&&r.forEach((function(e){t.forEach((function(t,r){t.videoSessionId===e.sid&&n.attachSessionVideoToHtmlElement(e,"mozaic_videoGallery_"+r)}))}));var i=this.getRemoteSharingSession(e.id);i&&this.attachSessionVideoToHtmlElement(i,"mozaicSharingVideo")}},{key:"attachLocalPipVideo",value:function(e){if(e.hasLocalVideo){var t=e.sessions[e.localVideoSessionId];t&&this.attachSessionVideoToHtmlElement(t,"conferenceVideoPip")}}},{key:"attachActiveTalkerLocalAndRemoteMediaStreams",value:function(e){var t=this;this.attachRemoteAudioStream(e);var n=this.getRemoteAudioVideoBundleSession(e.id);if(n)this.attachDistantBundleSession(n);else{var r=this.getRemoteVideoSessions(e.id),i=this.getRemoteSharingSession(e.id);this.updateMainSessionIfNeededToDynamicFeed(e,r),this.$log.info("[WebConferenceService] attachLocalAndRemoteMediaStreams for session "+e.id);var a=!1,o=!1;if(i&&!i.showOnSecondPip?(o=!0,this.attachSessionVideoToHtmlElement(i,"largevideo"),a=!0):i&&i.showOnSecondPip&&(o=!0,this.attachSessionVideoToHtmlElement(i,"sfuActiveSpeakerSecondVideo")),e.hasLocalSharing){var s=e.sessions[e.localSharingSessionId];s&&(o=!0,s.showOnSecondPip?this.attachSessionVideoToHtmlElement(s,"sfuActiveSpeakerSecondVideo"):(this.attachSessionVideoToHtmlElement(s,"largevideo"),a=!0))}if(r.length&&r.forEach((function(e){e.mainSession&&!a?(a=!0,t.attachSessionVideoToHtmlElement(e,"largevideo")):(e.mainSession&&a||!e.mainSession&&e.activeSpeaker&&!o)&&t.attachSessionVideoToHtmlElement(e,"sfuActiveSpeakerSecondVideo")})),e.hasLocalVideo){var c=e.sessions[e.localVideoSessionId];c&&this.attachSessionVideoToHtmlElement(c,"conferenceVideoPip")}}}},{key:"attachRemoteAudioStream",value:function(e){var t=this,n=this.getRemoteAudioSession(e.id);n&&n.remoteStreams&&n.remoteStreams.forEach((function(e){e.getAudioTracks().length>0&&t.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),e,n.sid)})),n&&n.remoteStreamsObject[0]&&this.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),n.remoteStreamsObject[0],n.sid)}},{key:"attachMainMediaStream",value:function(e){var t=this;e&&(this.$log.info("[webConferenceService] attachMainMediaStream"),e.remoteStreams.forEach((function(n){n.getVideoTracks().length>0&&t.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),n,e.sid)})),e&&e.remoteStreamsObject[0]&&this.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),e.remoteStreamsObject[0],e.sid))}},{key:"attachDistantBundleSession",value:function(e){var t=this;e&&(this.$log.info("[webConferenceService] attachDistantBundleSession"),e.remoteStreams.forEach((function(n){n.getVideoTracks().length>0&&t.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),n,e.sid),n.getAudioTracks().length>0&&t.videoService.RTC.attachMediaStream(angular.element("#globalAudioTag"),n)})),e&&e.remoteStreamsObject[0]&&this.videoService.RTC.attachMediaStream(angular.element("#globalAudioTag"),e.remoteStreamsObject[0]),e&&e.remoteStreamsObject[1]&&this.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),e.remoteStreamsObject[1],e.sid))}},{key:"attachSessionVideoToHtmlElement",value:function(e,t){var n=this,r="#"+t;e&&t?(this.$log.info("[webConferenceService] attachSessionVideoToHtmlElement"),e.remoteStreams.forEach((function(t){t.getVideoTracks().length>0&&n.videoService.RTC.attachMediaStreamIfNeeded(angular.element(r),t,e.sid)})),e&&e.remoteStreamsObject[0]&&this.videoService.RTC.attachMediaStreamIfNeeded(angular.element(r),e.remoteStreamsObject[0],e.sid),e.localStreams.forEach((function(t){t.getVideoTracks().length>0&&n.videoService.RTC.attachMediaStreamIfNeeded(angular.element(r),t,e.sid)}))):!e&&t&&this.videoService.RTC.clearMediaStream(angular.element(r),null)}},{key:"updateMainSessionIfNeededToDynamicFeed",value:function(e,t){this.$log.info("[webConferenceService] updateMainSessionIfNeededToDynamicFeed");var n=!0;if(t&&t.length){var r=null,i=null;Object.keys(t).forEach((function(e){var a=t[e];a&&(i||(i=a),!r&&a.activeSpeaker&&(r=a),a.mainSession&&(a.pinned||a.activeSpeaker)&&(n=!1))})),n&&(r?(r.mainSession=!0,r.pinned=!1,e.videoGallery.forEach((function(e){e.pinned=!1,e.mainSession=!1}))):i&&(i.mainSession=!0,i.pinned=!1,e.videoGallery.forEach((function(e){e.pinned=!1,e.sessionId===i.sid?e.mainSession=!0:e.mainSession=!1}))))}return n}},{key:"updateMainSessionIfNeeded",value:function(e,t){this.$log.info("[webConferenceService] updateMainSessionIfNeeded");var n=!0;if(t&&t.length){var r=null;for(var i in t)t.hasOwnProperty(i)&&(r||(r=t[i]),t[i].mainSession&&(n=!1));n&&(r.mainSession=!0,r.pinned=!1,e.videoGallery.forEach((function(e){e.pinned=!1,e.sessionId===r.sid?e.mainSession=!0:e.mainSession=!1})))}return n}},{key:"getRelatedRoomToActiveConferenceSession",value:function(){return this.webConferenceRoom}},{key:"getRelatedRoomToActiveSharingOnlyConferenceSession",value:function(){return this.webrtcSharingOnlyRoom}},{key:"getConferenceBySessionId",value:function(e){var t=null;for(var n in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(n)&&this.conferenceSessions[n].sessions)for(var r in this.conferenceSessions[n].sessions)if(this.conferenceSessions[n].sessions.hasOwnProperty(r)&&this.conferenceSessions[n].sessions[r].sid===e)return t=this.conferenceSessions[n];return t}},{key:"getPontConfIdForRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.MEDIATYPE.WEBRTC;if(e.confEndpoints&&e.confEndpoints.length)for(var n=0;n<e.confEndpoints.length;n++)if(e.confEndpoints[n].mediaType===t)return e.confEndpoints[n].confEndpointId;return""}},{key:"getConferenceSessionById",value:function(e){return this.conferenceSessions[e]}},{key:"getSfuConferenceSessionForRoom",value:function(e){var t=null;return e&&(t=this.conferenceSessions[e.getSFUConfEndpointId()]),t}},{key:"updateWebConferenceInfos",value:function(e){var t=this;this.$log.info("[WebConferenceService] updateWebConferenceInfos"),Object.assign(this.conferenceEndpoints,e),this.webrtcConferenceId=this.getWebRtcConfEndpointId(),this.webrtcConferenceId&&this.roomService.getRoomByConferenceEndpointId(this.webrtcConferenceId).then((function(e){var n="nothing";e&&(n=e.name),t.webConferenceRoom=e,t.$log.info("[WebConferenceService] === updateWebConferenceInfos : webrtcConferenceId is currently attached to "+n)}),(function(){t.$log.info("[WebConferenceService] === updateWebConferenceInfos FAILURE ===")}))}},{key:"updateWebSharingOnlyConferenceInfos",value:function(e){var t=this;this.$log.info("[WebConferenceService] updateWebSharingOnlyConferenceInfos"),Object.assign(this.conferenceEndpoints,e),this.webrtcSharingOnlyConferenceId=this.getWebRtcSharingOnlyConfEndpointId(),this.webrtcSharingOnlyConferenceId&&this.roomService.getRoomByConferenceEndpointId(this.webrtcSharingOnlyConferenceId).then((function(e){var n=e&&e.name?e.name:"nothing";t.webrtcSharingOnlyRoom=e,t.$log.info("[WebConferenceService] === updateWebSharingOnlyConferenceInfos : webrtcSharingOnlyConferenceId is currently attached to "+n)}),(function(){t.$log.info("[WebConferenceService] === updateWebSharingOnlyConferenceInfos FAILURE ===")}))}},{key:"updateWebConferenceRoom",value:function(){var e=this;return this.webrtcConferenceId=this.getWebRtcConfEndpointId(),this.$q((function(t,n){e.roomService.getRoomByConferenceEndpointId(e.webrtcConferenceId).then((function(n){var r="nothing";n&&(r=n.name),e.webConferenceRoom=n,e.$log.info("[WebConferenceService] === updateWebConferenceRoom : room is currently attached to "+r),t()}),(function(){e.$log.info("[WebConferenceService] === updateWebConferenceRoom FAILURE==="),n()}))}))}},{key:"getWebRtcConfEndpointId",value:function(){for(var e in this.conferenceEndpoints)if(this.conferenceEndpoints.hasOwnProperty(e)&&this.conferenceEndpoints[e].mediaType===this.MEDIATYPE.WEBRTC)return this.conferenceEndpoints[e].id;return null}},{key:"getWebRtcSharingOnlyConfEndpointId",value:function(){for(var e in this.conferenceEndpoints)if(this.conferenceEndpoints.hasOwnProperty(e)&&this.conferenceEndpoints[e].mediaType===this.MEDIATYPE.WEBRTCSHARINGONLY)return this.conferenceEndpoints[e].id;return null}},{key:"isJoinWebConferenceAllowed",value:function(){return!0}},{key:"getWebConference",value:function(e){if(e)return this.conferenceSessions[e]}},{key:"removeConferenceSession",value:function(e){if(e){var t;for(this.removeAllJingleSessionsForConferenceSession(e),delete this.conferenceSessions[e];this.statsIntervals.length;)(t=this.statsIntervals.pop())&&(window.clearInterval(t),t=null);this.makingCall=!1}}},{key:"removeAllJingleSessionsForConferenceSession",value:function(e){if(e){var t=this.conferenceSessions[e];if(t){for(var n in t.metricsState="ended",t.sessions)if(t.sessions.hasOwnProperty(n)){var r=t.sessions[n];this.updateStatisticsForSession(t.id,r.sid),delete this.videoService.callsStats[r.sid],this.videoService.disableAudioVideoMedia(r),this.xmppService.connection.jingle.terminate(r.sid)}t.sessions=[]}}}},{key:"hasActiveConferenceSession",value:function(){for(var e in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(e)&&this.conferenceSessions[e].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[e].isActive()&&this.conferenceSessions[e].haveJoined)return!0;return!1}},{key:"hasActiveConferenceSessionWithAnyDevice",value:function(){for(var e in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(e)&&this.conferenceSessions[e].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[e].isActive()&&(this.conferenceSessions[e].haveJoined||this.conferenceSessions[e].joinedFromOtherDevice))return!0;return!1}},{key:"getActiveConferenceSession",value:function(){var e=null;for(var t in this.conferenceSessions)this.conferenceSessions.hasOwnProperty(t)&&this.conferenceSessions[t].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[t].isActive()&&this.conferenceSessions[t].haveJoined&&(e=this.conferenceSessions[t]);return e}},{key:"hasActiveSharingOnlyConferenceSession",value:function(){for(var e in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(e)&&this.conferenceSessions[e].type===this.MEDIATYPE.WEBRTCSHARINGONLY&&this.conferenceSessions[e].isActive())return!0;return!1}},{key:"getActiveSharingOnlyConferenceSession",value:function(){var e=null;for(var t in this.conferenceSessions)this.conferenceSessions.hasOwnProperty(t)&&this.conferenceSessions[t].type===this.MEDIATYPE.WEBRTCSHARINGONLY&&this.conferenceSessions[t].isActive()&&(e=this.conferenceSessions[t]);return e}},{key:"hasIncomingVideoStream",value:function(e){if(e){var t=this.conferenceSessions[e];if(t)for(var n in t.sessions)if(t.sessions.hasOwnProperty(n)){var r=t.sessions[n];if(!r.isInitiator&&("video"===r.remoteType||"sharing"===r.remoteType))return!0}return!1}}},{key:"getRemoteSessionsWithVideoOrSharingStreams",value:function(e){var t=[];if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];i.isInitiator||"video"!==i.remoteType&&"sharing"!==i.remoteType&&"audio+video"!==i.remoteType||t.push(i)}return t}},{key:"getRemoteSharingSession",value:function(e){var t=null;if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];if(!i.isInitiator&&"sharing"===i.remoteType){t=i;break}}return t}},{key:"getSharingSession",value:function(e){var t=null;if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];if("sharing"===i.remoteType||"sharing"===i.localType){t=i;break}}return t}},{key:"hasRemoteVideoOrSharingSession",value:function(e){var t=!1;if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];if(!i.isInitiator&&("video"===i.remoteType||"sharing"===i.remoteType||"audio+video"===i.remoteType)){t=!0;break}}return t}},{key:"getRemoteVideoSessions",value:function(e){var t=[];if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];i.isInitiator||"video"!==i.remoteType||t.push(i)}return t}},{key:"getRemoteAudioVideoBundleSession",value:function(e){var t;if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];if(!i.isInitiator&&"audio+video"===i.remoteType){t=i;break}}return t}},{key:"getRemoteAudioSession",value:function(e){var t;if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];if("audio"===i.localType){t=i;break}}return t}},{key:"getRemoteMainVideoSession",value:function(e){var t;if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];if(!i.isInitiator&&"video"===i.remoteType&&i.mainSession){t=i;break}}return t}},{key:"isAlreadySubscribedToDynamicFeed",value:function(e){if(!e)return!1;var t=!1,n=this.conferenceSessions[e];return n&&n.videoGallery&&"videoGallery_0"===n.videoGallery[0].id&&"busy"===n.videoGallery[0].state&&(t=!0),t}},{key:"isAlreadySubscribedToPublisher",value:function(e,t){if(!e||!t)return!1;var n=!1,r=this.conferenceSessions[e];if(r&&r.videoGallery)for(var i=0;i<r.videoGallery.length;i++)if(!r.videoGallery[i].activeSpeaker&&r.videoGallery[i].publisherId===t){n=!0;break}return n}},{key:"getSessionIdForParticipantByPublisherId",value:function(e,t){var n="";if(!e||!t)return n;var r=this.conferenceSessions[e];if(r&&r.videoGallery)for(var i=0;i<r.videoGallery.length;i++)if(r.videoGallery[i].publisherId===t){n=r.videoGallery[i].sessionId;break}return n}},{key:"relatePublisherToElement",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!e||!t||!n)return!1;this.$log.info("[WebConferenceService] relatePublisherToElement");var a=this.conferenceSessions[e];if(a)if(i)a.videoGallery[0].state="busy",a.videoGallery[0].publisherId="",a.videoGallery[0].simulcast=t.simulcast,a.videoGallery[0].subStreamLevel=r;else for(var o=0;o<a.videoGallery.length;o++)if(a.videoGallery[o].id===n){a.videoGallery[o].state="busy",a.videoGallery[o].publisherId=t.participantId,a.videoGallery[o].publisherJidIm=t.jid_im,a.videoGallery[o].displayName=t.participantId,a.videoGallery[o].simulcast=t.simulcast,a.videoGallery[o].subStreamLevel=r;var s=this.contactService.getContact(t.jid_im);s&&(a.videoGallery[o].displayName=s.displayName);break}this.updateSubStreamLevelsForConferenceSession(e)}},{key:"getRelatedPublisherToElement",value:function(e,t){if(!e||!t)return null;this.$log.info("[WebConferenceService] getRelatedPublisherToElement");var n=null,r=this.conferenceSessions[e];if(r&&r.videoGallery)for(var i=0;i<r.videoGallery.length;i++)if(t===r.videoGallery[i].id&&r.videoGallery[i].publisherId){n=r.videoGallery[i];break}return n}},{key:"getRelatedElementToPublisher",value:function(e,t){if(!e||!t)return null;this.$log.info("[WebConferenceService] getRelatedPublisherToElement");var n=null,r=this.conferenceSessions[e];if(r&&r.videoGallery)for(var i=0;i<r.videoGallery.length;i++)if(r.videoGallery[i].publisherId===t){n=r.videoGallery[i];break}return n}},{key:"relateSessionToPublisher",value:function(e,t,n){if(!e||!t||!n)return!1;this.$log.info("[WebConferenceService] relateSessionToPublisher pubId "+t+" sessionId "+n);var r=!1,i=this.conferenceSessions[e];if(i){for(var a=0;a<i.videoGallery.length;a++)if(t===i.videoGallery[a].publisherId&&!i.videoGallery[a].sessionId){i.videoGallery[a].sessionId=n,r=!0,"videoGallery_0"===i.videoGallery[a].id&&(i.sessions[n].activeSpeaker=!0,i.videoGallery[a].publisherId="");break}this.$log.info(i.videoGallery)}return r}},{key:"removeSessionFromVideoGallery",value:function(e,t){if(e&&t){e.videoGallery||(this.createVideoGalleryElements(e.conferenceView),e.videoGallery=this.videoGalleryElements),this.$log.info("[WebConferenceService] removeSessionFromVideoGallery for conference "+e.id+" sessionId "+t);for(var n=0;n<e.videoGallery.length;n++)e.videoGallery[n].sessionId===t&&(e.videoGallery[n].sessionId="",e.videoGallery[n].state="free",e.videoGallery[n].publisherId="",e.videoGallery[n].publisherJidIm="",e.videoGallery[n].displayName="",e.videoGallery[n].simulcast=null,e.videoGallery[n].subStreamLevel=null,e.videoGallery[n].mainSession=!1,e.videoGallery[n].pinned=!1,e.videoGallery[n].hold=!1);e.videoGallery=this.updateVideoGalleryElementsState(e,e.videoGallery,e.conferenceView)}}},{key:"reInitialiseVideoGalleryElementById",value:function(e,t){if(e&&t){e.videoGallery||(this.createVideoGalleryElements(e.conferenceView),e.videoGallery=this.videoGalleryElements),this.$log.info("[WebConferenceService] reInitialiseVideoGalleryElementById for conference "+e.id+" elementId "+t);for(var n=0;n<e.videoGallery.length;n++)e.videoGallery[n].id===t&&(e.videoGallery[n].sessionId&&this.dropRemoteVideoSession(e,e.videoGallery[n].sessionId),e.videoGallery[n].sessionId="",e.videoGallery[n].state="free",e.videoGallery[n].publisherId="",e.videoGallery[n].publisherJidIm="",e.videoGallery[n].displayName="",e.videoGallery[n].subStreamLevel=null,e.videoGallery[n].simulcast=null,e.videoGallery[n].hold=!1,e.videoGallery[n].reconnecting=!1);e.videoGallery=this.updateVideoGalleryElementsState(e,e.videoGallery,e.conferenceView)}}},{key:"updateMainScreenSession",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){this.$log.info("[WebConferenceService] updateMainScreenSession");var n=this.conferenceSessions[e];if(n){for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];t&&t.sessionId===i.sid?(i.mainSession=!0,i.pinned=!0):(i.mainSession=!1,i.pinned=!1)}return n.videoGallery.forEach((function(e){t&&e.id===t.id?(e.mainSession=!0,e.pinned=!0):(e.mainSession=!1,e.pinned=!1)})),n}}}},{key:"updateSubStreamLevelsForConferenceSession",value:function(e){var t=this;this.$log.info("[WebConferenceService] updateSubStreamLevelsForConferenceSession");var n=this.conferenceSessions[e],r=n.getConnectedParticipantByJid(this.contactService.userContact.jid),i=this.getRemoteSharingSession(n.id);i&&!i.showOnSecondPip?n.videoGallery.forEach((function(e){e.simulcast&&"videoGallery_0"!==e.id&&t.updateSubstreamLevelForPublisher(n.id,r.participantId,"0",e)})):n.videoGallery.forEach((function(e){if(e.simulcast&&"videoGallery_0"!==e.id){var i=n.sessions[e.sessionId];if(i){var a=i.mainSession?"2":"0";t.updateSubstreamLevelForPublisher(n.id,r.participantId,a,e)}}}))}},{key:"getListOfAvailableRemoteVideoPublishers",value:function(e){if(e){this.$log.info("[WebConferenceService] getListOfAvailableRemoteVideoPublishers");var t=this.conferenceSessions[e],n=[];return t&&(t.videoGallery||(this.createVideoGalleryElements(t.conferenceView),t.videoGallery=this.videoGalleryElements),n=(n=t.getListOfRemoteVideoPublishers()).filter((function(e){for(var n=0;n<t.videoGallery.length;n++)if(t.videoGallery[n].publisherId===e.participantId)return!1;return!0}))),n}}},{key:"getListOfPublishersForElementsOnHold",value:function(e){if(e){this.$log.info("[WebConferenceService] getListOfPublishersForElementsOnHold");var t=this.conferenceSessions[e],n=[];if(t){t.videoGallery||(this.createVideoGalleryElements(t.conferenceView),t.videoGallery=this.videoGalleryElements);for(var r=t.getListOfRemoteVideoPublishers(),i=function(e){t.videoGallery[e].publisherId&&t.videoGallery[e].hold&&r.forEach((function(r){r.participantId===t.videoGallery[e].publisherId&&n.push(r)}))},a=0;a<t.videoGallery.length;a++)i(a)}return n}}},{key:"sendTransportReplaceForSession",value:function(e,t){var n=this;e?this.reconnecting[e.sid]?this.$log.warn("[WebConferenceService] sendTransportReplaceForSession already reconnecting for session "+e.id):(this.reconnecting[e.sid]=!0,t||(t=1e3),this.$interval((function(e){if(n.reconnecting[e.sid]=!1,delete n.reconnecting[e.sid],n.connected&&e&&e.peerconnection&&"stable"===e.peerconnection.signalingState&&("failed"===e.peerconnection.iceConnectionState||"disconnected"===e.peerconnection.iceConnectionState)&&(n.$log.info("[WebConferenceService] sendTransportReplaceForSession for session "+e.sid),e.connection=n.xmppService.connection,e.reconnectSession(),e.type!==n.MEDIATYPE.WEBRTCSHARINGONLY)){var t=e.hasLocalSharing?"sharing":"audio";n.contactService.setBusyState("dnd",t)}}),t,1,!0,e)):this.$log.warn("[WebConferenceService] sendTransportReplaceForSession missing session !")}},{key:"onAudioProfileChangeEvent",value:function(){var e=this;if(this.$log.info("[WebConferenceService] onAudioProfileChangeEvent"),this.audioProfileChanging)this.$log.info("[WebConferenceService] onAudioProfileChangeEvent -- already changing");else for(var t in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(t)){var n=this.conferenceSessions[t];for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];"audio"===i.localType&&(this.audioProfileChanging=!0,this.$interval((function(t){e.audioProfileChanging=!1,e.videoService.getBrowserMedia(["audio"]).then((function(n){t.removeStream(t.localStreams[0]),e.videoService.stopActiveAudioVideoStreams(t),t.localStreams.push(n),t.addStream(t.localStreams[0]),t.sendTransportReplace()}))}),500,1,!0,i))}}}},{key:"onJingleError",value:function(e){this.$log.info("[WebConferenceService] onJingleError -- "+e);var t=this.getConferenceBySessionId(e);t&&t.sessions&&("audio"===t.sessions[e].localType?this.leaveWebConference(t.id):(this.updateStatisticsForSession(t.id,e),t.localVideoSessionId===e?this.removeMediaFromConferenceSession(t,"video"):t.localSharingSessionId===e?this.removeMediaFromConferenceSession(t,"sharing"):(this.removeSessionFromVideoGallery(t,e),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",t))))}},{key:"onIceConnectionDisconnectedForSession",value:function(e,t){if(this.$log.info("[WebConferenceService] onIceConnectionDisconnectedForSession -- "+t),e&&e.sessions){var n=e.sessions[t];"audio"===n.localType?(e.status="reconnecting",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e),this.connected&&this.sendTransportReplaceForSession(n,1e3)):e.localVideoSessionId!==t&&e.localSharingSessionId!==t||this.connected&&this.sendTransportReplaceForSession(n,1e3)}}},{key:"onIceConnectionFailedForSession",value:function(e,t){if(this.$log.info("[WebConferenceService] onIceConnectionFailedForSession -- "+t),e&&e.sessions){var n=e.sessions[t];if(!n)return void this.$log.info("[WebConferenceService] onIceConnectionFailedForSession -- session is missing");"audio"===n.localType?(e.status="reconnecting",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e),this.connected&&this.sendTransportReplaceForSession(n,500)):e.localVideoSessionId===t||e.localSharingSessionId===t?this.connected&&this.sendTransportReplaceForSession(n,500):"video"===n.remoteType?(this.xmppService.connection.jingle.terminate(t),this.updateStatisticsForSession(e.id,t),delete this.videoService.callsStats[t],e.videoGallery.forEach((function(e){e.sessionId===t&&(e.sessionId="")})),delete e.sessions[t],this.connected&&this.resubscribeToSessions(e)):(this.xmppService.connection.jingle.terminate(t,"icefailed"),this.updateStatisticsForSession(e.id,t),delete this.videoService.callsStats[t],this.removeSessionFromVideoGallery(e,t),delete e.sessions[t],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e))}}},{key:"onIncomingCall",value:function(e){this.$log.info("[WebConferenceService] onIncomingCall -- "+e);var t=this.xmppService.connection.jingle.sessions[e],n=t.confId,r=this.conferenceSessions[n];if(r){if(r.sessions[e]=t,t.localType=t.remoteType,t.sendAnswer(),t.accept(),"video"===t.remoteType)if(!this.activeSpeaker||t.publisherId&&r.videoGallery[0].sessionId!==t.sid){if(!this.relateSessionToPublisher(n,t.publisherId,t.sid)){this.$log.info("[WebConferenceService] no gallery element related to session, attach to first available");var i=this.getFreeVideoGalleryElement(n);i&&!this.isAlreadySubscribedToPublisher(r.id,t.publisherId)&&(i.state="busy",i.publisherId=t.publisherId,i.sessionId=t.sid)}}else r.videoGallery[0].publisherId="",t.activeSpeaker=!0;"sharing"===t.remoteType&&(this.updateSubStreamLevelsForConferenceSession(n),this.updateConferenceViewIfNeeded(n)),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",r),this.videoService.callsStats[t.sid]={},this.updateStatisticsForSession(r.id,t.sid),this.statsIntervals.push(t.getStats(5e3))}else this.$log.error("[WebConferenceService] onIncomingCall no such conferenceSession "+n)}},{key:"onTerminatedCall",value:function(e){this.$log.info("[WebConferenceService] onTerminatedCall -- "+e);var t=this.xmppService.connection.jingle.sessions[e];if(t){var n=t.confId,r=this.conferenceSessions[n];r?(this.updateStatisticsForSession(r.id,e),t&&"audio"===t.localType&&this.leaveWebConference(r.id),r.localVideoSessionId===e?this.removeMediaFromConferenceSession(r,"video"):r.localSharingSessionId===e?this.removeMediaFromConferenceSession(r,"sharing"):(this.removeSessionFromVideoGallery(r,e),this.videoService.disableAudioVideoMedia(t),this.xmppService.connection.jingle.terminate(t.sid),delete r.sessions[t.sid],delete this.videoService.callsStats[e],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",r))):this.$log.error("[WebConferenceService] onTerminatedCall no such conferenceSession "+n)}else{var i=this.getActiveConferenceSession()?this.getActiveConferenceSession():this.getActiveSharingOnlyConferenceSession();if(i&&i.sessions){var a=i.sessions[e];a&&(i.metricsState="ended"),a&&"audio"===a.localType?this.leaveWebConference(i.id):i.localVideoSessionId===e?this.removeMediaFromConferenceSession(i,"video"):i.localSharingSessionId===e?this.removeMediaFromConferenceSession(i,"sharing"):(this.removeSessionFromVideoGallery(i,e),this.videoService.disableAudioVideoMedia(i.sessions[e]),delete i.sessions[e],delete this.videoService.callsStats[e],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",i),this.updateSubStreamLevelsForConferenceSession(i.id))}}}},{key:"onConferenceCallSwitched",value:function(e){this.$log.info("[WebConferenceService] onConferenceCallSwitched -- "+e);var t=this.getActiveConferenceSession();t&&this.leaveWebConference(t.id)}},{key:"onIceConnectionStateChange",value:function(e,t){var n=this;this.$log.info("[WebConferenceService] onIceConnectionStateChange for session "+e);var r=this.getConferenceBySessionId(e);try{if(r&&t.peerconnection){if("stable"===t.peerconnection.signalingState&&"connected"===t.peerconnection.iceConnectionState){this.$log.info("[WebConferenceService] ICE Connection established successfully");var i=r.getConnectedParticipantByJid(this.contactService.userContact.jid);"connected"!==r.status&&i&&i.mute&&this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",this.$translate.instant("youMuted")),r.status="connected",r.startDuration(),t.remoteStreams&&t.remoteStreams.forEach((function(e){e.getAudioTracks().length>0&&(n.videoService.RTC.attachMediaStream(angular.element("#globalAudioTag"),e),n.videoService.resetAudioOutputElement(!0))})),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",r),this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",r)}"stable"===t.peerconnection.signalingState&&"completed"===t.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection completed successfully"),"connected"!==r.status&&(r.status="connected",r.startDuration(),t.remoteStreams&&t.remoteStreams.forEach((function(e){e.getAudioTracks().length>0&&(n.videoService.RTC.attachMediaStream(angular.element("#globalAudioTag"),e),n.videoService.resetAudioOutputElement(!0))})),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",r),this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",r))),"stable"===t.peerconnection.signalingState&&"disconnected"===t.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection State disconnected"),this.onIceConnectionDisconnectedForSession(r,e)),"stable"===t.peerconnection.signalingState&&"failed"===t.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection State failed"),this.onIceConnectionFailedForSession(r,e))}}catch(a){this.$log.error("[WebConferenceService] onIceConnectionStateChange error "+a)}}},{key:"updateOrCreateConferenceSession",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"webrtc";if(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession for "+e),!e||!t||!t.data)return this.$log.error("[webConferenceService] updateOrCreateConferenceSession - Not enough data"),null;var i=this.conferenceSessions[e];return i?t.data.active!==i.active&&(this.$log.debug("active"),i.updateActiveState(t.data.active),t.data.active?this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",i):this.leaveWebConference(e)):(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession - create new conferencesession with id "+e+"and data: \n"+JSON.stringify(t.data)),i=this.ConferenceSession.createFromData(e,[],t.data.active,r),this.conferenceSessions[e]=i,this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",i)),t.data.participants&&(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession - (is active : "+i.active+") update participants for "+e+" with:\n"+JSON.stringify(t.data.participants)),i.updateParticipants(t.data.participants).then((function(){n.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",i)}))),i}},{key:"updateOrCreateWebConferenceEndpoint",value:function(e){if(this.$log.info("[WebConferenceService] updateOrCreateWebConferenceEndpoint for "+e.id),!e)return this.$log.error("[WebConferenceService] updateOrCreateWebConferenceEndpoint - no conference data !"),null;if(e.mediaType!==this.MEDIATYPE.WEBRTC&&e.mediaType!==this.MEDIATYPE.WEBRTCSHARINGONLY)return this.$log.error("[WebConferenceService] updateOrCreateWebConferenceEndpoint - wrong mediaType:"+e.mediaType),null;var t=this.Conference.createFromData(e);return this.conferenceEndpoints[e.id]=t,t.mediaType===this.MEDIATYPE.WEBRTC?this.updateWebConferenceInfos([t]):this.updateWebSharingOnlyConferenceInfos([t]),this.conferenceEndpoints[e.id]}},{key:"makeSnapshotForConfId",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"webrtc",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t){var i="[webConferenceService] makeSnapshotForConfId - No confId !!";return this.$log.error(i),this.$q.reject(i)}var a=this.conferenceSessions[t];return!r&&a&&a.active&&a.haveJoined?(this.$log.debug("[WebConferenceService] makeSnapshotForConfId skipped, already joined"),this.$q.resolve(a)):!r&&a&&this.makingCall?(this.$log.debug("[WebConferenceService] makeSnapshotForConfId skipped, we're currently joining the conference"),this.$q.resolve(a)):this.$q((function(r,i){e.$http({method:"GET",url:e.confPortalURL+t+"/snapshot?mediaType=webrtc",headers:e.authService.getRequestHeader()}).then((function(i){e.$log.info("[webConferenceService] makeSnapshotForConfId success for confId "+t);var a=i.data;e.updateOrCreateConferenceSession(t,a,n),r(a.data)})).catch((function(n){e.$log.info("[webConferenceService] makeSnapshotForConfId failure for confID "+t),404===n.status?e.$log.error("[webConferenceService] makeSnapshotForConfId - confId "+t+" not found on server"):e.$log.error("[webConferenceService] makeSnapshotForConfId - inconsistent object on server"),e.conferenceSessions[t]&&e.removeConferenceSession(t),i()}))}))}},{key:"refreshConferenceSessions",value:function(){var e=this;return this.$log.info("[webConferenceService] refreshConferenceSessions"),this.$q((function(t,n){var r=[];for(var i in e.conferenceSessions)if(e.conferenceSessions.hasOwnProperty(i)){var a=e.conferenceSessions[i];r.push(e.makeSnapshotForConfId(a.id,a.type))}e.$q.all(r).then((function(){e.$log.info("[webConferenceService] refreshConferenceSessions -- success"),t()})).catch((function(){e.$log.error("[webConferenceService] refreshConferenceSessions -- error -- some session are corrupted and deleted"),n()}))}))}},{key:"removeAllConferenceSessions",value:function(){for(var e in this.$log.info("[webConferenceService] removeAllConferenceSessions"),this.conferenceSessions)this.conferenceSessions.hasOwnProperty(e)&&this.removeConferenceSession(e)}},{key:"getConferenceSessionForRoom",value:function(e){var t=null;if(e&&e.length)for(var n=0;n<e.length;n++)e[n].mediaType!==this.MEDIATYPE.WEBRTC&&e[n].mediaType!==this.MEDIATYPE.WEBRTCSHARINGONLY||(t=this.conferenceSessions[e[n].confEndpointId]);return t}},{key:"removeVideoGalleryVideos",value:function(e){var t=this;e&&e.videoGallery&&e.videoGallery.forEach((function(n){var r=e.sessions[n.sessionId];r&&(t.updateStatisticsForSession(e.id,r.sid),t.videoService.disableAudioVideoMedia(r),delete e.sessions[r.sid],delete e.localStreams[r.localStreamId],delete t.videoService.callsStats[r.sid],t.xmppService.connection.jingle.terminate(r.sid))}))}},{key:"relateSessionToActiveSpeakerElement",value:function(e,t){if(e){var n=this.conferenceSessions[e];n&&n.videoGallery&&(n.videoGallery[0].sessionId=t,n.videoGallery[0].publisherId="")}}},{key:"resubscribeToSessions",value:function(e){var t=this;e&&e.publishers.length&&e.videoGallery.forEach((function(n){if("videoGallery_0"!==n.id||"busy"!==n.state||n.reconnecting||n.sessionId){if("busy"===n.state&&!n.reconnecting&&!n.sessionId&&n.publisherId){n.reconnecting=!0;var r=e.getPublisherById(n.publisherId);t.subscribeToPublisher(e.id,r,n.id,n.subStreamLevel).then((function(){t.$log.info("[ConferenceService] resubscribeToSession for element "+n.id+" and publisher id "+n.publisherId+" -- success"),n.reconnecting=!1})).catch((function(){t.$log.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+n.id),t.reInitialiseVideoGalleryElementById(e,n.id)}))}}else n.reconnecting=!0,t.subscribeToPublisher(e.id,e.publishers[0],n.id,"2",!0).then((function(){t.$log.info("[ConferenceService] resubscribeToSession dynamic feed for element "+n.id+" -- success"),n.reconnecting=!1})).catch((function(){t.$log.error("[ConferenceService] subscribe to publisher dynamic feed failed, reset the video gallery element with id "+n.id),t.reInitialiseVideoGalleryElementById(e,n.id)}))}))}},{key:"subscribeToPublishers",value:function(e){var t=this;e&&e.publishers.length&&e.publishers.forEach((function(n){if("video"===n.mediaType&&!t.isAlreadySubscribedToPublisher(e.id,n.participantId)){var r=t.getFreeVideoGalleryElement(e.id);if(r){r.state="busy",r.publisherId=n.participantId;var i=n.simulcast?"0":null;t.subscribeToPublisher(e.id,n,r.id,i).catch((function(){t.$log.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+r.id),t.reInitialiseVideoGalleryElementById(e,r.id)}))}}}))}},{key:"updateConferenceViewIfNeeded",value:function(e){if(e){var t=this.conferenceSessions[e];t&&t.conferenceView===this.ConferenceSession.ConferenceView.GridView&&this.modifyConferenceView(e,this.ConferenceSession.ConferenceView.GalleryView)}}},{key:"modifyConferenceView",value:function(e,t){if(e){var n=this.conferenceSessions[e];if(n&&n.conferenceView!==t){if(n.conferenceView=t,t===this.ConferenceSession.ConferenceView.GalleryView){if(n.videoGallery=this.updateVideoGalleryElementsState(n,n.videoGallery,t),!this.isAlreadySubscribedToDynamicFeed(n.id)){var r,i=null,a=g(n.publishers);try{for(a.s();!(r=a.n()).done;){var o=r.value;if("video"===o.mediaType){i=o;break}}}catch(d){a.e(d)}finally{a.f()}this.subscribeToDynamicFeed(n.id,i,n.videoGallery[0].id,"2",!0)}this.subscribeToPublishers(n)}else if(t===this.ConferenceSession.ConferenceView.SpeakerView){if(n.videoGallery=this.updateVideoGalleryElementsState(n,n.videoGallery,t),!this.isAlreadySubscribedToDynamicFeed(n.id)){var s,c=null,l=g(n.publishers);try{for(l.s();!(s=l.n()).done;){var u=s.value;if("video"===u.mediaType){c=u;break}}}catch(d){l.e(d)}finally{l.f()}this.subscribeToDynamicFeed(n.id,c,n.videoGallery[0].id,"2",!0)}}else t===this.ConferenceSession.ConferenceView.GridView&&(n.videoGallery=this.updateVideoGalleryElementsState(n,n.videoGallery,t),this.subscribeToPublishers(n));console.error(n.videoGallery),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",n)}}}},{key:"getActiveSpeakerSession",value:function(e){var t=null;if(!e)return t;var n=this.conferenceSessions[e];if(n)for(var r in n.sessions)if(n.sessions.hasOwnProperty(r)){var i=n.sessions[r];if(i.activeSpeaker){t=i;break}}return t}},{key:"getPinnedGalleryElement",value:function(e){var t=null;if(!e)return t;var n=this.conferenceSessions[e];return n&&n.videoGallery&&n.videoGallery.forEach((function(e){e.pinned&&(t=e)})),t}},{key:"subscribeToDynamicFeed",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.$q((function(o,s){if(!t||!n)return e.$log.warn("[WebConferenceService] subscribeToDynamicFeed missing parameters !! Ignore !"),void o();if(!e.activeSpeaker)return e.$log.warn("[WebConferenceService] subscribeToDynamicFeed -- feature not activated"),void o();if(e.conferenceSessions[t].videoGallery[0].state="busy",e.conferenceSessions[t].conferenceView===e.ConferenceSession.ConferenceView.GalleryView&&!e.isAlreadySubscribedToPublisher(t,n.participantId)){var c=e.getFreeVideoGalleryElement(t);c&&(c.state="busy",c.publisherId=n.participantId,e.$interval((function(t,n,r){e.subscribeToPublisher(t,n,r,"0")}),2500,1,!0,t,n,c.id))}return e.subscribeToPublisher(t,n,r,i,a)}))}},{key:"subscribeToPublisher",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.$q((function(o,s){if(!t||!n)return e.$log.warn("[WebConferenceService] subscribeToPublisher missing parameters !! Ignore !"),void o();e.$log.info("[WebConferenceService] subscribeToPublisher for confId "+t+" and publisher "+n.participantId),r&&e.relatePublisherToElement(t,n,r,i,a);var c=i?{subStreamLevel:i}:{};a&&(c.dynamicFeed=!0,"true"===e.settingsService.getSetting("dynamicFeedMediumStream")&&(c.subStreamLevel="1")),e.$http({method:"POST",url:e.confPortalURL+t+"/participants/"+n.participantId+"/subscribe",headers:e.authService.getRequestHeader(),data:c}).then((function(n){e.$log.info("[WebConferenceService] subscribeToPublisher successfully"),a&&e.relateSessionToActiveSpeakerElement(t,n.data.data.sid),o(n.data)}),(function(t){var n="subscribeToPublisher failure: "+(t.data?t.data.errorDetails:t.data);e.$log.error("[WebConferenceService] "+n),s(new Error(n))}))}))}},{key:"onNetworkQualityChange",value:function(e){var t=this.getConferenceBySessionId(e);if(t&&t.sessions){var n=t.sessions[e];n&&"audio"===n.localType&&(this.videoService.callsStatsSimplified[e].networkQualityFlag===t.networkQuality?(this.videoService.callsStatsSimplified[e].networkQualityIteration=this.videoService.callsStatsSimplified[e].networkQualityIteration?this.videoService.callsStatsSimplified[e].networkQualityIteration+1:1,0===t.networkQuality&&this.videoService.callsStatsSimplified[e].networkQualityIteration>=3&&this.$rootScope.$broadcast("ON_CONFERENCE_NETWORK_UPDATE_EVENT",t,"badNetworkQuality",t.networkQuality)):this.videoService.callsStatsSimplified[e].networkQualityIteration=1,t.networkQuality=this.videoService.callsStatsSimplified[e].networkQualityFlag,this.$rootScope.$broadcast("ON_CONFERENCE_NETWORK_UPDATE_EVENT",t,"networkQuality",t.networkQuality))}}},{key:"delegateConferenceToParticipant",value:function(e,t){var n=this;return this.$q((function(r,i){n.$http({method:"PUT",url:n.confPortalURL+e+"/participants/"+t+"/delegate",headers:n.authService.getRequestHeader()}).then((function(e){n.$log.info("[WebConferenceService] delegateConferenceToParticipant successfully"),r(e.data)}),(function(e){var t="delegateConferenceToParticipant failure: "+(e.data?e.data.errorDetails:e.data);n.$log.error("[WebConferenceService] "+t),i(new Error(t))}))}))}},{key:"onConferenceDelegated",value:function(e,t){var n=this;this.$log.info("[WebConferenceService] onConferenceDelegated from "+e+" to "+t),this.conferenceSessions[t]=this.conferenceSessions[e],this.conferenceSessions[t].id=t,this.isMyConference(t)&&(this.conferenceSessions[t].isMyConference=!0,this.conferenceSessions[t].participants&&this.conferenceSessions[t].participants.length&&this.conferenceSessions[t].participants.forEach((function(e){e.jid_im!==n.contactService.userContact.jid?e.role="member":e.jid_im===n.contactService.userContact.jid&&(e.role="moderator")}))),this.isMyConference(e)&&(this.conferenceSessions[t].isMyConference=!1,this.conferenceSessions[t].participants&&this.conferenceSessions[t].participants.length&&this.conferenceSessions[t].participants.forEach((function(e){e.jid_im===n.contactService.userContact.jid&&(e.role="member")}))),delete this.conferenceSessions[e],this.roomService.updateRoomConfEndpoint(e,t),this.$rootScope.$broadcast("ON_CONFERENCE_DELEGATED_EVENT",e,t),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[t]),!this.isMyConference(t)&&this.conferenceSessions[t].haveJoined&&this.$interval((function(e){return r(n,void 0,void 0,b.a.mark((function n(){var r,i;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getConferenceEndpointInfos(e);case 2:(r=n.sent)&&r.data&&r.data.userId&&((i=this.contactService.getContactById(r.data.userId))&&this.conferenceSessions[t].participants&&this.conferenceSessions[t].participants.length&&this.conferenceSessions[t].participants.forEach((function(e){e.jid_im===i.jid&&(e.role="moderator")})),this.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",this.conferenceSessions[t]));case 4:case"end":return n.stop()}}),n,this)})))}),100,1,!0,t)}},{key:"getConferenceEndpointInfos",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";return this.$q((function(r,i){if(!e)return t.$log.error("[WebConferenceService] getConferenceEndpointInfos -- missing endpointId "),void i("[WebConferenceService] getConferenceEndpointInfos -- missing endpointId ");t.$http({method:"GET",url:t.confProvPortalURL+"conferences/"+e+"?format="+n,headers:t.authService.getRequestHeader()}).then((function(e){t.$log.info("[WebConferenceService] getConferenceEndpointInfos successfully"),r(e.data)}),(function(e){var n="getConferenceEndpointInfos failure: "+(e.data?e.data.errorDetails:e.data);t.$log.error("[WebConferenceService] "+n),i(new Error(n))}))}))}},{key:"addBundleMediaToConferenceSession",value:function(e){var t,n=this;if(this.$log.info("[WebConferenceService] addBundleMediaToConferenceSession"),e)for(var r in e.sessions)if(e.sessions.hasOwnProperty(r)){var i=e.sessions[r];if("audio"===i.localType||"audio+video"===i.localType){t=i;break}}if(t){this.addingMedia=!0;var a=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_SIMULCAST),o=a?1280:640,s=a?720:480;this.videoService.getBrowserMedia(["audio","video"],o,s,17).then((function(r){n.addingMedia=!1,n.videoService.stopActiveAudioVideoStreams(t),t.removeStream(e.localStreams[0]),t.localStreams=[],e.localStreams[0]=r,t.localStreams.push(r),t.addStream(e.localStreams[0],!0),t.contentAdd("video",!0),e.hasLocalVideo=!0,e.localVideoSessionId=t.sid,t.localStreamId=0,n.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e)})).catch((function(){n.addingMedia=!1}))}}}]),e}();f.$inject=["$q","$rootScope","$log","$http","$interval","videoService","errorHelperService","ConferenceSession","platformService","Conference","$translate"],angular.module("rainbow").service("webConferenceService",f)},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(392),a=n(10),o=n(24),s=n(393),c=n(1),l=n(2),u=n(4),d=n(6),h=n(58),f=n(33),p=n(15),m=n(37),v=function(){function e(t,n,r,i,o,v){S(this,e),this.$q=t,this.$rootScope=n,this.$interval=r,this.$translate=i,this.$http=o,this.webConferenceService=v,this.MEDIATYPE={PSTNAUDIO:"pstnAudio",WEBRTC:"webrtc",WEBRTCSHARINGONLY:"webrtcSharingOnly"},this.started=!1,this.rxUpdateSubject=new a.Subject,this.hasConferenceRights=!1,this.maxNumberOfUsersSFU=0,this.authService=l.default,this.xmppService=u.default,this.profileService=d.default,this.contactService=c.default,this.roomService=f.default,this.pgiConferenceService=h.default,this.utilitiesService=s.default,this.logger=p.default,this.errorHelperService=m.default,this.listeners=[],this.conferenceRef=null}return C(e,[{key:"start",value:function(e){var t=this;return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] === start skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((function(n){var r=performance.now();return t.logger.info("[ConferenceService] === STARTING ==="),t.hasConferenceRights=t.profileService.isFeatureEnabled(t.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED),t.maxNumberOfUsersSFU=t.profileService.getFeatureLimitMax(t.profileService.FeaturesEnum.WEBRTC_CONFERENCE_PARTICIPANT_COUNT),t.maxNumberOfUsersSFU||(t.maxNumberOfUsersSFU=20),t.confProvPortalURL=config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/",t.confPortalURL=config.restServerUrl+"/api/rainbow/conference/v1.0/conferences/",t.attachHandlers(),t.webConferenceService.retrieveWebConferences(t.MEDIATYPE.WEBRTC).then((function(){return t.webConferenceService.retrieveWebConferences(t.MEDIATYPE.WEBRTCSHARINGONLY)})).then((function(){return t.makeSnapshots()})).then((function(){t.started=!0;var i=Math.round(performance.now()-r);e.push({service:"conferenceService",startDuration:i}),t.logger.info("[ConferenceService] === STARTED ("+i+" ms) ==="),n()})).catch((function(e){t.logger.info("[ConferenceService] === STARTING FAILURE === "+e.message),n()}))}))}},{key:"stop",value:function(){var e=this;return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] === stop skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((function(t){e.logger.info(""),e.logger.info("[ConferenceService] === STOPPING ==="),e.listeners&&e.listeners.forEach((function(e){e()})),e.started=!1,e.logger.info("[ConferenceService] === STOPPED ==="),t()}))}},{key:"attachHandlers",value:function(){var e=this;this.logger.info("[ConferenceService] attachHandlers"),this.conferenceRef&&(this.xmppService.connection.deleteHandler(this.conferenceRef),this.conferenceRef=null),this.conferenceRef=this.xmppService.connection.addHandler((function(t){return e.onConferenceUpdate(t)}),"jabber:iq:conference","message",null)}},{key:"reconnectService",value:function(){!this.contactService.userContact||this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] reconnectService"),this.attachHandlers(),this.refreshConferenceSessions()):this.logger.info("[ConferenceService] === reconnectService skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled)}},{key:"subscribe",value:function(e,t){return"update"===e?this.rxUpdateSubject.subscribe(t):null}},{key:"getWebConferenceEndpoints",value:function(){return this.webConferenceService.conferenceEndpoints}},{key:"makeSnapshotsForList",value:function(e){var t=this;return this.$q((function(n){if(t.logger.info("[ConferenceService] makeSnapshotsForList"),e&&e.length){for(var r=[],i=0;i<e.length;i++)e[i].mediaType===t.MEDIATYPE.PSTNAUDIO?r.push(t.pgiConferenceService.makeSnapshotForConfId(e[i].confEndpointId)):r.push(t.webConferenceService.makeSnapshotForConfId(e[i].confEndpointId,e[i].mediaType));t.$q.all(r).finally((function(){n(t.getConferenceSessionForRoom(e))}))}else n()}))}},{key:"getConferenceSessionForRoom",value:function(e){var t=null,n=null;if(e&&e.length)for(var r=0;r<e.length;r++)e[r].mediaType===this.MEDIATYPE.PSTNAUDIO?t=this.pgiConferenceService.getConferenceSessionById(e[r].confEndpointId):n=this.webConferenceService.conferenceSessions[e[r].confEndpointId];return t||n}},{key:"getMatchingConferenceSession",value:function(e,t){var n=null;if(e&&e.length)for(var r=0;r<e.length;r++)e[r].confEndpointId===t&&(n=e[r].mediaType===this.MEDIATYPE.PSTNAUDIO?this.pgiConferenceService.getConferenceSessionById(t):this.webConferenceService.conferenceSessions[t]);return n}},{key:"makeSnapshots",value:function(){var e=this;return this.logger.info("[ConferenceService] makeSnapshots"),this.$q((function(t){var n=[];for(var r in e.webConferenceService.conferenceEndpoints)if(e.webConferenceService.conferenceEndpoints.hasOwnProperty(r)){var i=e.webConferenceService.conferenceEndpoints[r];n.push(e.webConferenceService.makeSnapshotForConfId(i.id,i.mediaType))}e.$q.all(n).finally((function(){e.logger.info("[ConferenceService] makeSnapshots done"),t()}))}))}},{key:"onConferenceUpdate",value:function(e){var t=$(e).find("conference-id").text(),n=$(e).find("conference-info").length?$(e).find("conference-info").attr("action"):"",r=this.webConferenceService.conferenceSessions[t];if("reject"===n){var i=this.roomService.findRoomsWithConfId(t);return i&&i.length&&this.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",i[0]),!0}if("delegate"===n){var a=$(e).find("new-conference-id").text();return this.webConferenceService.onConferenceDelegated(t,a),!0}return r?r.haveJoined?this.updateConferenceSession(e,r):(this.updateConferenceSessionActiveState(e,r),this.checkIfUserHasJoinedConferenceFromOtherDevice(e,t,r)):this.checkIfUserHasJoinedConferenceFromOtherDevice(e,t),!0}},{key:"checkIfUserHasJoinedConferenceFromOtherDevice",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var i=$(e).find("participants");r&&(r.joinedFromOtherDevice=!1),i&&i.length&&i.find("participant").each((function(e,i){if($(i).find("jid-im").text()===n.contactService.userContact.jid){var a=n.roomService.findRoomsWithConfId(t);a&&a.length&&n.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",a[0]),r&&(r.joinedFromOtherDevice=!0)}}))}catch(a){return}}},{key:"updateConferenceSession",value:function(e,t){var n=this;this.logger.info("[ConferenceService] updateConferenceSession");var r,i=$(e),a=i.find("conference-state");if(a.length){var o="true"===a.find("active").text(),s="true"===a.find("talker-active").text(),c="true"===a.find("recording-started").text(),l="true"===a.find("lock").text(),u=a.find("locked-by").text();u||(u=a.find("unlocked-by").text());var d="";!o&&a.find("reason")&&(d=a.find("reason").text()),this.updateState(t,o,s,c,l,u,d)}var h=i.find("talkers");if(h.length){var f=[];h.find("participant-id").each((function(e,t){var n=$(t).text();f.push(n)})),i.find("conference-id").text(),this.updateTalkers(t,f)}var p=i.find("participants");if(0===p.length&&(p=i.find("updated-participants")),p.length||(p=i.find("added-participants")),p.length){var m=[];p.find("participant").each((function(e,t){var n=$(t),i=n.find("participant-id").text(),a=n.find("jid-im").text(),o=n.find("phone-number").text(),s=n.find("role").text(),c=n.find("mute").text(),l=n.find("hold").text(),u=n.find("cnx-state").text(),d=n.find("delegate-capability").text(),h="true"===n.find("talking").text();m.push({participantId:i,jid_im:a,phoneNumber:o,participantRole:s,mute:"on"===c,held:"on"===l,participantState:u,delegateCapability:"true"===d}),h&&(r=i)})),m.length>0&&(t.conferenceStats&&(t.conferenceStats.isUpdate=!1),this.createOrUpdateParticipants(t,m))}var v=i.find("removed-participants");if(v.length){var g=[];v.find("participant-id").each((function(e,t){var n=$(t).text();g.push(n)})),this.removeParticipants(t,g),t.participants.length<=1&&(i.find("conference-id").text(),this.updateTalkers(t,[])),t.conferenceStats&&(t.conferenceStats.isUpdate=!1)}var y=i.find("added-publishers");y.length&&(y.find("publisher").each((function(e,r){var i=$(r),a=i.find("publisher-id").text(),o=i.find("media-type").text(),s=i.find("jid-im").text(),c="true"===i.find("simulcast").text();n.addPublisher(t,a,o,s,c)})),this.$rootScope.$broadcast("ON_CONFERENCE_PUBLISHER_UPDATED",t));var b=i.find("removed-publishers");b.length&&(b.find("publisher").each((function(e,r){for(var i=$(r),a=i.find("participant-id").text(),o=i.find("media-type").text(),s=0;s<t.publishers.length;s++){var c=t.publishers[s];if(c.participantId===a&&c.mediaType===o){t.publishers.splice(s,1);break}}if("video"===o&&n.webConferenceService.isAlreadySubscribedToPublisher(t.id,a)){n.logger.info("[ConferenceService] removed-publishers : subscribed to this publisher, so re-init the element");var l=n.webConferenceService.getRelatedElementToPublisher(t.id,a);l&&n.webConferenceService.reInitialiseVideoGalleryElementById(t,l.id)}})),this.$rootScope.$broadcast("ON_CONFERENCE_PUBLISHER_UPDATED",t));var S=i.find("publishers");return S.length&&(S.find("publisher").each((function(e,r){var i=$(r),a=i.find("publisher-id").text(),o=i.find("media-type").text(),s=i.find("jid-im").text(),c="true"===i.find("simulcast").text();n.addPublisher(t,a,o,s,c)})),this.$rootScope.$broadcast("ON_CONFERENCE_PUBLISHER_UPDATED",t)),r&&this.updateTalkers(t,[r]),!0}},{key:"updateConferenceSessionActiveState",value:function(e,t){var n=$(e).find("conference-state");if(n.length){this.logger.info("[ConferenceService] updateConferenceSessionActiveState");var r="true"===n.find("active").text(),i="true"===n.find("talker-active").text(),a="true"===n.find("recording-started").text(),o="";!r&&n.find("reason")&&(o=n.find("reason").text()),this.updateState(t,r,i,a,null,null,o)}}},{key:"updateState",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";if(t||this.contactService.resetBusyState(),e.active&&!t){if(this.contactService.userContact.guestMode&&e.type!==this.MEDIATYPE.WEBRTCSHARINGONLY)this.$rootScope.$broadcast("ON_OPEN_POPUP","concludeInvitation");else{var s=this.roomService.findRoomsWithConfId(e.id);if(s&&s.length&&!s[0].owner)switch(e.type){case this.MEDIATYPE.WEBRTCSHARINGONLY:break;case this.MEDIATYPE.PSTNAUDIO:case this.MEDIATYPE.WEBRTC:default:if(e.isParticipantConnectedByJid(this.contactService.userContact.dbId)){var c=_escape(s[0].ownerContact.displayName),l=_escape(s[0].name),u=this.$translate.instant("meetingEndBy",{owner:c,meeting:l});this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",u)}}}e.participants=[],e.status="ended",o&&"noOwnerFound"===o&&this.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"conference",popupBody:"autoDelegationNotPossible",okLabel:"ok"})}e.updateStateFromData(t,n,r,i),this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",e),a&&this.$rootScope.$broadcast("ON_CONFERENCE_LOCKED_EVENT",i,a),t||this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT")}},{key:"updateTalkers",value:function(e,t){e.updateTalkers(t),this.$rootScope.$broadcast("ON_CONFERENCE_TALKER_EVENT",e)}},{key:"getServerConferenceStats",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,a,o,s,c,l,u,d=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(config.restServerUrl,"/api/rainbow/conference/v1.0/conferences/").concat(e,"/talkingtime"),a=this.authService.getRequestHeader(),t.next=5,fetch(n,{method:"GET",headers:a});case 5:if((o=t.sent).ok){t.next=8;break}throw o;case 8:return t.next=10,o.json();case 10:if(0!==(s=t.sent).data.participants.length){t.next=13;break}return t.abrupt("return",null);case 13:return c=new i.ConferenceStats,t.next=16,this.utilitiesService.asyncForEach(s.data.participants,(function(e){return r(d,void 0,void 0,b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.talkingTime>0)){t.next=8;break}return n=new i.ConferenceStatsParticipant(e.userId),t.next=4,this.contactService.getContactByDBId(e.userId);case 4:n.contact=t.sent,n.talkDuration=1e3*e.talkingTime,c.participants.push(n),c.talkDuration+=n.talkDuration;case 8:case"end":return t.stop()}}),t,this)})))}));case 16:if(c.participants=c.participants.sort((function(e,t){return t.talkDuration-e.talkDuration})),!(c.participants.length>0)){t.next=20;break}l=c.participants[0].talkDuration,c.participants.forEach((function(e){e.talkDisplay=Math.trunc(100*e.talkDuration/l)}));case 20:return t.abrupt("return",c);case 23:return t.prev=23,t.t0=t.catch(0),t.next=27,this.errorHelperService.getErrorInfo(t.t0,"getServerConferenceStats");case 27:throw u=t.sent,this.logger.error("[ConferenceService] "+u.message),u.error;case 29:case"end":return t.stop()}}),t,this,[[0,23]])})))}},{key:"createOrUpdateParticipants",value:function(e,t){var n=this;e.updateParticipants(t).then((function(t){if(e.participants.find((function(e){return e.jid_im===n.contactService.userContact.id&&"disconnected"!==e.state}))&&e.type===n.MEDIATYPE.WEBRTC){var r=e.hasLocalSharing?"sharing":"audio";n.contactService.setBusyState("dnd",r)}n.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",e),"webrtc"===e.type&&t&&n.$rootScope.$broadcast("ON_WEB_CONFENRECE_PARTICIPANT_JOINED_EVENT",e,t)}))}},{key:"removeParticipants",value:function(e,t){var n=this;if(e.removeParticipants(t),!e.participants.find((function(e){return e.jid_im===n.contactService.userContact.id})))switch(this.contactService.resetBusyState(),e.type){case this.MEDIATYPE.WEBRTC:if(this.webConferenceService.removeAllJingleSessionsForConferenceSession(e.id),e.active){var r=this.roomService.findRoomsWithConfId(e.id);if(r.length&&!this.webConferenceService.isMyConference(e.id)){var i=_escape(r[0].name),a=this.$translate.instant("meetingDisconnect",{meeting:i});this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",a)}}e.cleanupSessionData(),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e);break;case this.MEDIATYPE.WEBRTCSHARINGONLY:this.webConferenceService.removeAllJingleSessionsForConferenceSession(e.id),e.cleanupSessionData()}this.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",e)}},{key:"addPublisher",value:function(e,t,n,r){for(var i=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=!0,s=0;s<e.publishers.length;s++){var c=e.publishers[s];if(c.participantId===t&&c.mediaType===n){o=!1;break}}var l={participantId:t,mediaType:n,jid_im:r,simulcast:a};if(o&&e.publishers.push(l),o&&"video"===n){var u=this.webConferenceService.getFreeVideoGalleryElement(e.id),d=!1;this.webConferenceService.isActiveSpeakerEnabled()&&u&&"videoGallery_0"===u.id&&(d=!0),u&&!this.webConferenceService.isAlreadySubscribedToPublisher(e.id,l.participantId)&&(this.logger.info("[ConferenceService] will subscribe to publisher "+e.id+" for id "+t+"and element id "+u.id+" in few moments"),u.state="busy",u.publisherId=l.participantId,this.$interval((function(e,t,n,r){if("busy"===n.state&&n.publisherId===t.participantId){i.logger.info("[ConferenceService] subscribe to publisher "+e.id+" for id "+t.participantId+"and element id "+n.id);var a=null;t.simulcast&&(r?(a="2",n.publisherId=""):a="0"),r?i.webConferenceService.subscribeToDynamicFeed(e.id,t,n.id,a,r).catch((function(){i.logger.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+n.id),i.webConferenceService.reInitialiseVideoGalleryElementById(e,n.id)})):i.webConferenceService.subscribeToPublisher(e.id,t,n.id,a,r).catch((function(){i.logger.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+n.id),i.webConferenceService.reInitialiseVideoGalleryElementById(e,n.id)}))}}),1500,1,!0,e,l,u,d))}}},{key:"stopConference",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.MEDIATYPE.WEBRTC,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.logger.info("[ConferenceService] stopConference( confId="+t+", type="+n+")"),!t||!r&&n!==this.MEDIATYPE.PSTNAUDIO)return this.logger.warn("[ConferenceService] stopConference missing conf ID or roomID"),this.$q.reject();var i=this.webConferenceService.conferenceSessions[t];return i&&i.isActive()?this.$q((function(i,a){e.$http({method:"PUT",url:e.confPortalURL+t+"/stop",headers:e.authService.getPostHeader(),data:{mediaType:n,roomId:r}}).then((function(){e.contactService.resetBusyState();var n=e.webConferenceService.conferenceSessions[t];n&&(e.updateState(n,!1,!1,!1),n.cleanupSessionData(),e.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",n)),e.logger.info("[ConferenceService] stopConference( confId="+t+") successfully"),i()}),(function(n){var r=n.data?n.data.errorDetails:n.data,i="stopConference( confId="+t+") failure: "+r;if(e.logger.error("[ConferenceService] "+i),404e3!==n.data.errorDetailsCode)e.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"warning",popupBody:"stopMeetingFailure",okLabel:"ok"});else{var o=e.webConferenceService.conferenceSessions[t];o&&(o.active=!1,o.participants=[],e.removeConferenceSession(o),e.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",o))}a(new Error(i))}))})):(this.logger.warn("[ConferenceService] stopConference - no active conference session to stop"),this.$q.reject())}},{key:"removeConferenceSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(e.type===this.MEDIATYPE.WEBRTC||e.type===this.MEDIATYPE.WEBRTCSHARINGONLY?(this.webConferenceService.leaveWebConference(e.id),this.webConferenceService.removeConferenceSession(e.id)):this.pgiConferenceService.removeConferenceSession(e.id))}},{key:"disconnectsParticipant",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.MEDIATYPE.PSTNAUDIO;return e&&t?this.$q((function(i,a){n.logger.info("[ConferenceService] disconnectsParticipant( confId="+e+"participantId="+t+")"),n.$http({method:"DELETE",url:n.confPortalURL+e+"/participants/"+t+"?mediaType="+r,headers:n.authService.getRequestHeader()}).then((function(){n.logger.info("[ConferenceService] disconnectsParticipant( confId="+e+"participantId="+t+") successfully"),i()}),(function(r){var i=r.data?r.data.errorDetails:r.data,o="disconnectsParticipant( confId="+e+"participantId="+t+") failure: "+i;n.logger.error("[ConferenceService] "+o),a(new Error(o))}))})):(this.logger.warn("[ConferenceService] disconnectsParticipant missing conf ID or participantId"),this.$q.reject())}},{key:"updateConference",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.MEDIATYPE.PSTNAUDIO;return n===this.MEDIATYPE.PSTNAUDIO?this.pgiConferenceService.updateConference(e,t):this.webConferenceService.updateConference(e,t)}},{key:"updateConferenceState",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.MEDIATYPE.PSTNAUDIO;return this.logger.info("[ConferenceService] updateConferenceState( confId="+e+", option="+t+" mediaType="+r+")"),e&&t?this.$q((function(i,a){var o;if(!(o=r===n.MEDIATYPE.PSTNAUDIO?n.pgiConferenceService.getConferenceSessionById(e):n.webConferenceService.conferenceSessions[e]))return n.logger.error("[ConferenceService] updateConferenceState - no corresponding conference session to update"),void a();n.$http({method:"PUT",url:n.confPortalURL+e+"/update",headers:n.authService.getRequestHeader(),data:{option:t,mediaType:o.type}}).then((function(t){var r=t.data.data;n.logger.info("[ConferenceService] updateConferenceState( confId="+e+") successfully"),i(r)}),(function(t){var r=t.data?t.data.errorDetails:t.data,i="updatsConferenceState( confId="+e+") failure: "+r;n.logger.error("[ConferenceService] "+i),a(new Error(i))}))})):(this.logger.error("[ConferenceService] updateConferenceState - missing a parameter"),this.$q.reject())}},{key:"updateParticipantState",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.MEDIATYPE.PSTNAUDIO,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return this.logger.info("[ConferenceService] updateParticipantState( confId="+e+"participantId="+t+" option="+n+" mediaType="+i+")"),e&&t&&n?this.$q((function(l,u){var d;if(!(d=i===r.MEDIATYPE.PSTNAUDIO?r.pgiConferenceService.getConferenceSessionById(e):r.webConferenceService.conferenceSessions[e]))return r.logger.error("[ConferenceService] updateParticipantState - no corresponding conference session to update"),void u();var h={option:n,mediaType:d.type};a&&(h.media=a),o&&(h.bitRate=o),c&&(h.publisherId=c),s&&(h.subStreamLevel=s),r.$http({method:"PUT",url:r.confPortalURL+e+"/participants/"+t,headers:r.authService.getRequestHeader(),data:h}).then((function(n){var i=n.data;r.logger.info("[ConferenceService] updateParticipantState( confId="+e+"participantId="+t+") successfully"),l(i)}),(function(n){var i=n.data?n.data.errorDetails:n.data,a="updateParticipantState( confId="+e+"participantId="+t+") failure: "+i;r.logger.error("[ConferenceService] "+a),u(new Error(a))}))})):(this.logger.error("[ConferenceService] updateParticipantState - missing a parameter"),this.$q.reject())}},{key:"isUserContactInCall",value:function(){for(var e in this.webConferenceService.conferenceSessions)if(this.webConferenceService.conferenceSessions.hasOwnProperty(e)&&this.webConferenceService.conferenceSessions[e].isParticipantConnectedByJid(this.contactService.userContact.jid))return!0;return!1}},{key:"refreshConferenceSessions",value:function(){var e=[];return e.push(this.webConferenceService.refreshConferenceSessions()),this.$q.all(e)}},{key:"computeJoinStartForSFUConference",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={showStartButton:!1,showJoinButton:!1,isActionDisabled:!1,startOrJoinTooltip:""},r=e.room.getUserByJid(this.contactService.userContact.jid);if(r&&"unsubscribed"===r.status)return this.rxUpdateSubject.next(new o.RBEvent("CONFERENCE_BUTTON_STATUS",n)),n;if(!e.room.isMeetingRoom()&&!this.contactService.userContact.webrtcAudioEnabled)return n.showStartButton=!1,n.showJoinButton=!1,n;var i=t||this.webConferenceService.getConferenceSessionForRoom(e.room.confEndpoints);if(i&&i.status&&"ended"!==i.status)n.showStartButton=!1,n.showJoinButton=!1;else if(i&&i.isActive()&&!i.haveJoined)n.showStartButton=!1,n.showJoinButton=!0;else if(e.room.isUserModerator(this.contactService.userContact)){if(n.showStartButton=!0,!this.hasConferenceRights)return n.isActionDisabled=!0,n.startOrJoinTooltip="startConferenceNoRights",this.rxUpdateSubject.next(new o.RBEvent("CONFERENCE_BUTTON_STATUS",n)),n;var a=e.room.users.filter((function(e){return e.contact&&e.contact.initialized&&!e.contact.isAnonymousGuest()&&!e.contact.isBadGuest()&&!e.contact.isTerminated&&("invited"===e.status||"accepted"===e.status)})),s=0;return e.room.guestEmails&&(s=e.room.guestEmails.length),a.length+s>this.maxNumberOfUsersSFU?(n.isActionDisabled=!0,n.startOrJoinTooltip=this.$translate.instant("disabledStartConference",{number:this.maxNumberOfUsersSFU}),this.rxUpdateSubject.next(new o.RBEvent("CONFERENCE_BUTTON_STATUS",n)),n):(n.isActionDisabled=!1,n.startOrJoinTooltip="startConference",this.rxUpdateSubject.next(new o.RBEvent("CONFERENCE_BUTTON_STATUS",n)),n)}return this.rxUpdateSubject.next(new o.RBEvent("CONFERENCE_BUTTON_STATUS",n)),n}}]),e}();v.$inject=["$q","$rootScope","$interval","$translate","$http","webConferenceService"],t.ConferenceService=v,angular.module("rainbow").service("conferenceService",v)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ConferenceStats=function(){return function e(){S(this,e),this.participants=[],this.talkDuration=0}}(),t.ConferenceStatsParticipant=function(){return function e(t){S(this,e),this.talkerId=null,this.contact=null,this.talkDuration=0,this.activeSince=null,this.talkDisplay=0,this.talkerId=t}}()},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){S(this,e),this.rtlDirCheck=new RegExp("^[^\u0591-\u07ff\u200f\u202b\u202e\ufb1d-\ufdfd\ufe70-\ufefc]*?[\u0591-\u07ff\u200f\u202b\u202e\ufb1d-\ufdfd\ufe70-\ufefc]")}return C(e,[{key:"emojiShortnameToImage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e,r="";if(t)for(var i=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,a=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/",o=/^mailto:/,s=null;s=n.match(i);){var c=s[0];s[2]===s[3]&&(c="mailto:"+c);var l=emojione.shortnameToImage(n.substr(0,s.index));c.match(a)?r+="".concat(l,'<span class="publiclink" >').concat(s[0].replace(o,""),"</span>"):r+="".concat(l,'<a target="_blank" href="').concat(c,'">').concat(s[0].replace(o,""),"</a>"),n=n.substring(s.index+s[0].length)}return r+=emojione.shortnameToImage(n)}},{key:"asyncForEach",value:function(e,t){return r(this,void 0,void 0,b.a.mark((function n(){var r;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=0;case 1:if(!(r<e.length)){n.next=7;break}return n.next=4,t(e[r],r,e);case 4:r++,n.next=1;break;case 7:case"end":return n.stop()}}),n)})))}},{key:"isRTL",value:function(e){return this.rtlDirCheck.test(e.charAt(0))}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.utilitiesService||(t.rainbow.utilitiesService=new e),t.rainbow.utilitiesService}}]),e}();t.UtilitiesService=i,t.default=i.getInstance()},function(e,t,n){n.r(t);var r=n(23),i=n(5),a=n.n(i),s=n(2),c=n.n(s),l=n(4),u=n.n(l),d=n(6),h=n.n(d);angular.module("rainbow").service("calendarService",["$q","$rootScope","$log","$http","$interval","contactService","errorHelperService","conversationService",function(e,t,n,i,s,l,d,f){var p=this;this.intervalID=null,this.subscriptions=[],this.start=function(t){n.info(""),n.info("[calendarService] === STARTING ===");var i=performance.now();p.eventSubject=new r.a,p.serviceActivated=!1,p.serviceState=null,p.calendarState=null,p.autorizationLink="",p.calendaRejectIfBusyActivated=!1,n.info("[calendarService] listen 'out of office' status for roster contacts"),s(p.getAutoReplyForEachContact,15e3,1),p.intervalID=s(p.updateAutoReplyForEachContact,9e5),p.officeCalendarPresenceEnabled=h.a.isFeatureEnabled(h.a.FeaturesEnum.MSO365_CALENDAR_PRESENCE),p.googleCalendarPresenceEnabled=h.a.isFeatureEnabled(h.a.FeaturesEnum.GOOGLE_CALENDAR_PRESENCE),p.calendarPresenceEnabled=p.officeCalendarPresenceEnabled||p.googleCalendarPresenceEnabled,n.info("[calendarService] calendar presence status from profileService : "+p.calendarPresenceEnabled),p.disableCalendarPresencePrompt="true"===a.a.getSetting("disableCalendarPresence"),n.info("[calendarService] calendar presence prompt status from userSettings : "+!p.disableCalendarPresencePrompt);var o=Math.round(performance.now()-i);return t.push({service:"calendarService",startDuration:o}),n.info("[calendarService] === STARTED ("+o+" ms) ==="),p.calendarPresenceEnabled&&!l.userContact.guestMode&&(p.attachHandlers(),p.xmppConnectionSubscription=u.a.subscribeToConnectionEvents((function(e){p.onConnectionStateChange(e)})),p.subscriptions.push(u.a.subscribeToContactEvents((function(e){"ON_CONTACT_PRESENCE_EVENT"===e.name&&p.onCalendarPresenceChange(e.data)}))),p.getCalendarState().then((function(){"enabled"===p.serviceState&&p.handleEnableState()})).catch((function(e){p.serviceActivated=!1,p.serviceState="failed",n.error("[calendarService] === STARTING FAILURE === "+e.message)}))),e.when()},this.attachHandlers=function(){n.info("[calendarService] attachHandlers"),p.messageHandlerRef&&(u.a.deleteHandler(p.messageHandlerRef),p.messageHandlerRef=null),p.messageHandlerRef=u.a.addHandler((function(e){return p.onUpdateMessageReceived(e),!0}),"jabber:iq:configuration","message",null)},this.stop=function(){return n.info("[calendarService] === STOPPING ==="),p.serviceActivated=!1,p.subscriptions&&p.subscriptions.forEach((function(e){e.unsubscribe()})),p.xmppConnectionSubscription&&p.xmppConnectionSubscription.unsubscribe(),p.messageHandlerRef&&(u.a.deleteHandler(p.messageHandlerRef),p.messageHandlerRef=null),p.intervalID&&s.cancel(p.intervalID),n.info("[calendarService] === STOPPED ==="),e.when()},this.onConnectionStateChange=function(e){"ON_XMPP_CONNECTED"===e.name&&(n.info("[calendarService] onConnectionStateChange state:"+e.name),p.getCalendarState().then((function(){"enabled"===p.serviceState&&p.handleEnableState(),"consent_required"===p.serviceState&&p.handleConsentRequiredState()})).catch((function(e){p.serviceActivated=!1,p.serviceState="failed",n.error("[calendarService] === FAILURE === "+e.message)})))},this.handleEnableState=function(){var e=this.calendarState.until?new Date(this.calendarState.until):null,t=this.calendarState.busy?"dnd":"online",n=this.calendarState.busy?"busy":"";p.updateCalendarPresenceForUser(l.userContact.jid,t,e,n)},this.handleConsentRequiredState=o(b.a.mark((function e(){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getRegistrationParams(!1);case 2:n=e.sent,t.$broadcast("ON_OPEN_CALENDARSELECTION_POPUP",n);case 4:case"end":return e.stop()}}),e)}))),this.onUpdateMessageReceived=function(e){var t=$(e).find("calendar");return t.length&&(p.serviceState=t.attr("status"),p.serviceActivated="enabled"===p.serviceState,p.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:p.serviceActivated}),n.info("[calendarService] onUpdateMessageReceived with state : "+p.serviceState),"consent_required"===p.serviceState&&p.handleConsentRequiredState()),!0},this.onCalendarPresenceChange=function(e){if(l.isTelJid(e.jid)&&"calendar"===l.getResourceFromJid(e.jid)){var t=l.getImJid(e.jid);t&&(n.info("[calendarService] onCalendarPresenceChange -- status: "+e.status+" -- until: "+e.until+" -- message: "+e.message+" -- auto dnd: "+e.applyCalendarPresence),p.updateCalendarPresenceForUser(t,e.status,e.until,e.message,e.applyCalendarPresence))}},this.updateAutoReplyForEachContact=function(){p.getAutoReplyInfoForContact(l.userContact),p.getAutoReplyForEachContact()},this.getAutoReplyForEachContact=function(){n.info("[calendarService] getAutoReplyForEachContact"),f.getConversations().forEach((function(e){null!==e.contact&&p.getAutoReplyInfoForContact(e.contact)}))},this.getAutoReplyInfoForContact=function(t){return e((function(e,r){if(!t.calendarState.status)return n.info("[calendarService] getAutoReplyInfoForContact user has no calendar state"),void e();if(t.calendarState.lastUpdate){var a=moment.duration(t.calendarState.lastUpdate.diff(moment()));if(Math.abs(Math.floor(a.asMinutes()))<15)return n.info("[calendarService] getAutoReplyInfoForContact state has been updated in the last 15min"),void e()}t.calendarState.lastUpdate=moment(),i({method:"GET",url:config.restServerUrl+"/api/rainbow/calendar/v1.0/automatic_reply?userid="+t.dbId,headers:c.a.getRequestHeader()}).then((function(r){p.treatOutOfOfficeState(r.data,t),n.info("[calendarService] getAutoReplyInfoForContact success for contact "+t.dbId),e()}),(function(e){var t=d.handleError(e);n.error("[calendarService] "+d.getErrorFullMessage(e,"getAutoReplyInfoForContact")),r(t)}))}))},this.getCalendarState=function(){return e((function(e,t){i({method:"GET",url:config.restServerUrl+"/api/rainbow/calendar/v1.0",headers:c.a.getRequestHeader()}).then((function(t){var r="[calendarService] getCalendarState success -- ",i=t.data;"busy"===i.status||"free"===i.status||"out_of_office"===i.status?(p.serviceState="enabled",p.calendarState=i,r+=p.serviceState+" "+p.calendarState.status):(p.serviceState=i.status,p.calendarState=null,r+=p.serviceState),n.info(r),e(t.data)}),(function(){n.error("[calendarService] getCalendarState failure -- CalendarService portal not responding"),t()}))}))},this.getRegistrationParams=function(t){return e((function(r){n.info("[calendarService] getRegistrationParams");var i=[];p.officeCalendarPresenceEnabled&&i.push(p.getCalendarRegistrationInfo("office365")),p.googleCalendarPresenceEnabled&&i.push(p.getCalendarRegistrationInfo("googleCalendar")),e.all(i).finally((function(){p.autorizationGoogleLink||p.autorizationMicrosoftLink?(n.info("[calendarService] getRegistrationParams -- show registration popup or tooltip"),r({authentMicrosoftUrl:p.autorizationMicrosoftLink,authentGoogleUrl:p.autorizationGoogleLink,fromSettings:t})):(n.error("[calendarService] getRegistrationParams -- no calendar provider response"),r())}))}))},this.getCalendarRegistrationInfo=function(t){var r="o365",o="office365";return"googleCalendar"===t&&(r="gcal",o="google"),e((function(e,s){var l=a.a.getAppliLanguage().code;i({method:"POST",url:config.restServerUrl+"/api/rainbow/calendar/v1.0/register",headers:c.a.getRequestHeader(),data:{type:o,callback:window.location.origin+"/redirectO365.html?provider="+r+"&lang="+l}}).then((function(r){n.info("[calendarService] getCalendarRegistrationInfo for "+t+" -- success"),p.autorizationLink=r.data.url,"googleCalendar"===t?p.autorizationGoogleLink=p.autorizationLink:p.autorizationMicrosoftLink=p.autorizationLink,e(p.autorizationLink)}),(function(e){n.error("[calendarService] getCalendarRegistrationInfo failure"),n.error(e),s()}))}))},this.deactivateCalendar=function(){return n.info("[calendarService] deactivateCalendar"),e((function(e,t){i({method:"DELETE",url:config.restServerUrl+"/api/rainbow/calendar/v1.0",headers:c.a.getRequestHeader()}).then((function(){n.info("[calendarService] deactivateCalendar success"),p.serviceActivated=!1,p.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:p.serviceActivated}),e()}),(function(e){n.error("[calendarService] deactivateCalendar failure"),n.error(e),t()}))}))},this.updateCalendarPresenceForUser=function(e,r,i,a,o){l.getOrCreateContact(e).then((function(s){s.calendarState.status=r,s.calendarState.message=a,s.calendarState.applyCalendarPresence=o,s.calendarState.applyCalendarPresence=!1;var c=null;"online"===r||i||(i=new Date),i&&(c=moment(i)),s.calendarState.mdate=c,c?c.isSame(moment(),"d")?(s.calendarState.until=c.format("LT"),s.calendarState.untilDate=!1):(s.calendarState.until=c.format("ll"),s.calendarState.untilDate=!0):(i||(i=new Date),s.calendarState.until=i,s.calendarState.untilDate=!1),l.isUserContact(s)?(n.info("[calendarService] updateCalendarPresenceForUser for my user : "+r+" until "+i+" auto dnd "+o),p.serviceActivated||"offline"===r||(p.serviceActivated=!0,p.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:p.serviceActivated})),p.getAutoReplyInfoForContact(l.userContact)):n.info("[calendarService] updateCalendarPresenceForUser for user : "+e+" with : "+r+" until "+i+" auto dnd "+o),t.$broadcast("ON_CONTACT_CALENDAR_STATUS_CHANGE",s)})).catch((function(t){n.error("[calendarService] updateCalendarPresenceForUser failure for user "+e+" with error : "+t)}))},this.treatOutOfOfficeState=function(e,r){if(n.info("[calendarService] treatOutOfOfficeState for user : "+r.jid+" with data enabled "+e.enabled+" and date end "+e.end),e.enabled){if(r.calendarState.autoReplyOn=!0,r.calendarState.autoReplyInfos={},e.message_text&&(r.calendarState.autoReplyInfos.message=e.message_text),e.end){var i=moment(e.end);r.calendarState.autoReplyInfos.mdate=i,i?i.isSame(moment(),"d")?(r.calendarState.autoReplyInfos.until=i.format("LT"),r.calendarState.autoReplyInfos.untilDate=!1):(r.calendarState.autoReplyInfos.until=i.format("ll"),r.calendarState.autoReplyInfos.untilDate=!0):(r.calendarState.autoReplyInfos.until=e.end,r.calendarState.autoReplyInfos.untilDate=!0)}}else r.calendarState.autoReplyOn=!1,r.calendarState.autoReplyInfos={};t.$broadcast("ON_CONTACT_CALENDAR_STATUS_CHANGE",r),p.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:p.serviceActivated})},this.calendarCancelCallback=function(){p.serviceActivated=!1,a.a.setSetting("disableCalendarPresence",!0),l.setUserSettings({promptForCalendarPresence:!1}),p.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:p.serviceActivated})},this.calendarLaterCallback=function(){p.serviceActivated=!1,p.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:!1})},this.setCalendarRejectIfBusy=function(e){p.calendaRejectIfBusyActivated=!1},this.getCalendarRejectIfBusy=function(){return p.calendaRejectIfBusyActivated}}])},function(e,t,n){(function(e){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var a=n(396),o=n(0),s=n(3),c=n(10),l=n(4),u=n(25),d=function(){function e(t,n){S(this,e),this.callType="",this.recordingFeature=!1,this.conversation=null,this.webrtcCallRef=null,this.isRecorded=!1,this.displayRecordTime=null,this.pauseRecord=null,this.recorder=null,this.updateTimer=null,this.actualRecordTime=0,this.durationTimer=null,this.callType=t,this.recordingFeature=n}return C(e,[{key:"getWebrtcCallRef",value:function(){return this.webrtcCallRef}},{key:"setWebrtcCallRef",value:function(e){this.webrtcCallRef=e}},{key:"getConversation",value:function(){return this.conversation}},{key:"setConversation",value:function(e){this.conversation=e}}],[{key:"create",value:function(t,n){return new e(t,n)}}]),e}();t.CallAreaRecordContext=d;var h=function(){function t(e,n,r,i,a,o,s,c,d,h){S(this,t),this.$q=e,this.$rootScope=n,this.$log=r,this.fileServerService=i,this.centralizedService=a,this.ringingService=o,this.conversationService=s,this.$interval=c,this.$translate=d,this.$window=h,this.started=!1,this.recording=!1,this.upload=!1,this.filename="",this.recordStopOrigin="LOCAL",this.xmppService=l.default,this.fileStorageService=u.default,this.durationTimer=null,this.metadataBuf=new ArrayBuffer(0),this.last_duration=0,this.clusterPtrs=[],this.recordedStartedEvent=null,this.conversationEndedEvent=null,this.tempUploadedFileDescriptor=null}return C(t,[{key:"start",value:function(){var e=this;return this.started=!1,this.recording=!1,this.recorder=null,this.chunk=null,this.writeStream=null,this.data=new Blob([],{type:"video/webm"}),this.audioContext=null,this.recordFile=null,this.decoder=new a.Decoder,this.initConversationRecordContext(),this.recordedStartedEvent&&this.recordedStartedEvent(),this.conversationEndedEvent&&this.conversationEndedEvent(),this.recordedStartedEvent=this.$rootScope.$on("ON_RECORDING_START_MSG_RECEIVED",(function(){e.ringingService.playRecordTone()})),this.conversationEndedEvent=this.$rootScope.$on("ON_CONVERSATION_CALL_UPDATED_EVENT",(function(t,n){e.conversationRecordContext&&n.conversation&&e.conversationRecordContext.conversationId===n.conversation.id&&n.conversation.videoCall&&"Unknown"===n.conversation.videoCall.status.value&&(e.setRecordStopOrigin("LOCAL"),e.stopRecording(),e.conversationService.sendRecordingMessage(n.conversation,"stop"))})),this.$log.info("[RecordsService] start"),this.$q.when()}},{key:"stop",value:function(){return this.$log.info("[RecordsService stop"),this.started&&(this.started=!1),this.recordedStartedEvent&&this.recordedStartedEvent(),this.conversationEndedEvent&&this.conversationEndedEvent(),this.$q.when()}},{key:"onDataAvailable",value:function(t){return r(this,void 0,void 0,b.a.mark((function n(){var r,i,a,o=this;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.$log.info("[RecordsService] >onDataAvailable: size = "+t.data.size),!(t.data.size>0)){n.next=10;break}if(this.chunk=t.data,!this.writeStream){n.next=9;break}return this.writeStream.on("finish",(function(){o.$log.info("[RecordsService] WriteStream finish event")})),n.next=5,this.chunk.arrayBuffer();case 5:r=n.sent,i=e.from(r),a=this.writeStream.write(i),this.writeStream.end(),this.$log.info("[RecordsService] write result = "+a);case 9:this.data=new Blob([this.data,this.chunk],{type:this.chunk.type}),this.chunk=null;case 10:case"end":return n.stop()}}),n,this)})))}},{key:"canRecord",value:function(){try{return!!MediaRecorder}catch(e){return!1}}},{key:"onStop",value:function(){return r(this,void 0,void 0,b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.durationTimer=c.interval(1e3).subscribe((function(){return r(t,void 0,void 0,b.a.mark((function e(){var t,n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$log.info("[RecordsService] On stop recording"),this.durationTimer.unsubscribe(),this.durationTimer=null,this.data&&this.data.size>1e7&&(t=this.$translate.instant("recordingInProgress"),this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",t)),!this.writeStream){e.next=5;break}this.durationTimer=c.interval(3e3).subscribe((function(){return r(n,void 0,void 0,b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.$log.info("[RecordsService] Destroy WriteStream"),this.writeStream.destroy(),this.writeStream=null,this.durationTimer.unsubscribe(),this.durationTimer=null,e.next=7,this.injectMetadata(this.data);case 7:this.updatedBlob=e.sent,this.onStopCreateFileFromBlob(this.updatedBlob);case 9:case"end":return e.stop()}}),e,this)})))})),e.next=28;break;case 5:if(!navigator.mediaDevices.getUserMedia||!this.$window.mozRTCPeerConnection){e.next=9;break}this.onStopCreateFileFromBlob(this.data),e.next=28;break;case 9:if(!navigator.mediaDevices.getUserMedia||!this.$window.webkitRTCPeerConnection){e.next=28;break}return this.$log.info("[RecordsService] On stop recording for Chrome with size "+this.data.size),this.recordFile={name:this.filename,extension:"mp4",size:this.data.size},e.prev=11,e.next=14,this.createBackupFile();case 14:return this.tempUploadedFileDescriptor=e.sent,this.$log.info("[RecordsService] backup created"),e.next=18,this.injectMetadata(this.data);case 18:this.updatedBlob=e.sent,this.onStopCreateFileFromBlob(this.updatedBlob),e.next=28;break;case 22:return e.prev=22,e.t0=e.catch(11),e.next=26,this.injectMetadata(this.data);case 26:this.updatedBlob=e.sent,this.onStopCreateFileFromBlob(this.updatedBlob);case 28:case"end":return e.stop()}}),e,this,[[11,22]])})))}));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"onCreateFileFromBlobForSafari",value:function(e){this.updatedBlob=e,this.$log.info("[RecordsService] Size of updatedBlob : "+e.size),this.filename=this.filename.replace("mp4","wav"),this.recordFile={name:this.filename,extension:"wav",size:e.size},this.recording=!1,this.recorder=null,this.chunk=null,this.$rootScope.$broadcast("ON_OPEN_RECORDINGFILESTORAGE_POPUP",this.recordFile,this.recordStopOrigin),this.$rootScope.$broadcast("ON_WEBRTC_RECORD_SAVED",this.recordFile,e,this.recordStopOrigin),this.recordStopOrigin="LOCAL"}},{key:"onStopCreateFileFromBlob",value:function(e){this.$log.info("[RecordsService] Size of updatedBlob : "+e.size),this.recordFile={name:this.filename,extension:"mp4",size:e.size},this.centralizedService.fileSystem&&this.centralizedService.fileSystem.unlink&&this.centralizedService.fileSystem.unlink(this.fullFileName+".temp"),this.tempUploadedFileDescriptor&&(this.fileStorageService.deleteFileDescriptor(this.tempUploadedFileDescriptor.id),this.tempUploadedFileDescriptor=null),this.recording=!1,this.recorder=null,this.chunk=null,this.$rootScope.$broadcast("ON_OPEN_RECORDINGFILESTORAGE_POPUP",this.recordFile,this.recordStopOrigin),this.$rootScope.$broadcast("ON_WEBRTC_RECORD_SAVED",this.recordFile,e,this.recordStopOrigin),this.recordStopOrigin="LOCAL"}},{key:"readAsArrayBuffer",value:function(e){return new Promise((function(t,n){var r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){t(r.result)},r.onerror=function(){n()}}))}},{key:"injectMetadata",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.$log.info("[RecordsService] injectMetadata"),n=e.type,t.next=4,this.readAsArrayBuffer(e);case 4:return r=t.sent,t.abrupt("return",(e=null,this.data=null,this.injectMetadataFromArrayBuffer(r,n)));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"injectMetadataFromArrayBuffer",value:function(e,t){this.$log.info("[RecordsService] injectMetadataFromArrayBuffer");var n=new a.Decoder,r=new a.Reader;r.logging=!1,r.drop_default_duration=!1,n.decode(e).forEach((function(e){r.read(e)})),r.stop();var i=a.tools.makeMetadataSeekable(r.metadatas,r.duration,r.cues),o=e.slice(r.metadataSize);return new Blob([i,o],{type:t})}},{key:"closeAudioContext",value:function(){this.audioContext&&(this.audioContext.destination&&this.audioContext.destination.disconnect(),"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null))}},{key:"cleanRecord",value:function(){!1!==this.recording?this.$log.error("[RecordsService] Unexpected record cleaning while recording not stopped"):(this.updatedBlob=null,this.recordFile=null,this.data=null)}},{key:"onError",value:function(e){this.$log.error("[RecordsService] error : "+e.message||!1),this.recording=!1,this.stopConvTimer(),this.$rootScope.$broadcast("ON_WEBRTC_RECORD_ERROR")}},{key:"createRecord",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"REMOTE",o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0,u=null,d=null,h=null,f=null,p=null,m=null,v=[];this.recorder=null,this.upload=o,this.filename=s;var g=!1,y=null,b=null,S=null,_="safari"===adapter.default.browserDetails.browser,C="firefox"===adapter.default.browserDetails.browser;if(this.decoder=new a.Decoder,this.data=new Blob([],{type:"video/webm"}),_&&(l="audio/wave"),l&&MediaRecorder.isTypeSupported(l)?u={mimeType:l}:c?MediaRecorder.isTypeSupported("audio/webm")&&(u={mimeType:"audio/webm"}):MediaRecorder.isTypeSupported("video/webm;codecs=vp8")?u={mimeType:"video/webm; codecs=vp8"}:MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?u={mimeType:"video/webm; codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm;codecs=h264")?u={mimeType:"video/webm; codecs=h264"}:MediaRecorder.isTypeSupported("video/mpeg")&&(u={mimeType:"video/mpeg"}),C&&(u={}),null===u)return this.$log.error("[RecordsService] Codecs : "+l+" are not available for the navigator"),!1;this.$log.info("[RecordsService] createRecord -- mimeType used "+u.mimeType);var w=null;if(e){if((w=this.xmppService.connection.jingle.sessions[e])&&(d=this.xmppService.connection.jingle.sessions[e].localStreams,w.remoteStreams&&w.remoteStreams.length?h=w.remoteStreams:w.remoteStreams&&w.remoteStreams.length||!w.remoteStreamsObject||(h=Object.values(w.remoteStreamsObject))),t){var E=this.xmppService.connection.jingle.sessions[t];d=d?d.concat(this.xmppService.connection.jingle.sessions[t].localStreams):this.xmppService.connection.jingle.sessions[t].localStreams,E.remoteStream&&E.remoteStreams.length?h=h?h.concat(E.remoteStreams):E.remoteStreams:E.remoteStreams&&E.remoteStreams.length||!E.remoteStreamsObject||(h=h?h.concat(Object.values(E.remoteStreamsObject)):Object.values(E.remoteStreamsObject))}}else{if(!t)return this.$log.error("[RecordsService] no callId"),!1;w=this.xmppService.connection.jingle.sessions[t],d=this.xmppService.connection.jingle.sessions[t].localStreams,w.remoteStream&&w.remoteStreams.length?h=w.remoteStreams:w.remoteStreams&&w.remoteStreams.length||!w.remoteStreamsObject||(h=Object.values(w.remoteStreamsObject))}return g=d&&d.length&&null!==d[0]||h&&h.length&&null!==h[0],null===this.recorder&&g?(function(){var e,t=null;for(e=0;e<h.length;e++)h[e]&&null!==h[e]&&(t=e,h[e].getAudioTracks().forEach((function(n){v.push(n),S=e,t=null})),null!==t&&(b=t));for(t=null,e=0;e<d.length;e++)d[e]&&null!==d[e]&&(t=e,d[e].getAudioTracks().forEach((function(n){v.push(n),e,t=null})),null!==t&&(y=t));if(n.audioContext&&(n.$log.error("[RecordsService] anomaly audio Context not previously released"),n.closeAudioContext()),v.length)if(_)m=new MediaStream,v.forEach((function(e){m.addTrack(e)}));else{n.audioContext=new AudioContext;var a=v.map((function(e){return n.audioContext.createMediaStreamSource(new MediaStream([e]))})),o=n.audioContext.createMediaStreamDestination();a.forEach((function(e){return e.connect(o)})),m=o.stream}c||_||(p=new MediaStream,"LOCAL"===r&&null!==y?d[y].getVideoTracks().forEach((function(e){p.addTrack(e)})):null!==b?h[b].getVideoTracks().forEach((function(e){p.addTrack(e)})):h[S].getVideoTracks().forEach((function(e){p.addTrack(e)}))),f=m&&p?new MediaStream([].concat(Object(i.a)(m.getTracks()),Object(i.a)(p.getTracks()))):m&&!p?m:p,n.centralizedService.fileSystem&&n.centralizedService.fileSystem.createWriteStream&&n.centralizedService.fileSystem.unlink&&(n.fullFileName=n.centralizedService.fileSaver.getFolderPath()+"/"+s,n.centralizedService.fileSystem.createWriteStream(n.fullFileName+".temp").then((function(e){n.writeStream=e,n.writeStream.on("error",(function(){n.$log.info("[RecordsService] WriteStream error event")})),n.writeStream.on("drain",(function(){n.$log.info("[RecordsService] WriteStream drain event")}))}))),_?(n.recorder=new MediaRecorder(f),n.recorder.addEventListener("dataavailable",function(e){this.onCreateFileFromBlobForSafari(e.data)}.bind(n)),n.recorder.onstop=n.onStop.bind(n),n.recorder.onerror=n.onError.bind(n)):(n.recorder=new MediaRecorder(f,u),n.recorder.ondataavailable=n.onDataAvailable.bind(n),n.recorder.onstop=n.onStop.bind(n),n.recorder.onerror=n.onError.bind(n))}(),!0):(this.$log.error("[RecordsService] Cannot get Stream"),!1)}},{key:"createBackupFile",value:function(){var e=this;return this.$q((function(t,n){var r=e.data,i=e.recordFile;return!1!==e.recording?(e.$log.error("[RecordsService] createBackupFile Unexpected uploading file when recording not stopped"),void n("recording not stopped pb")):0===i.size?(e.$log.error("[RecordsService] createBackupFile error uploading empty file"),void n("empty file pb")):void e.fileStorageService.createFileDescriptor(i.name,i.extension,i.size).then((function(i){e.fileServerService.uploadAFileByChunk(i,r,(function(){})).then((function(){return e.$log.info("[RecordsService] createBackupFile success"),t(i)})).catch((function(t){return e.$log.error("[RecordsService] createBackupFile Unexpected error while uploading file",t),n("server pb")}))})).catch((function(t){e.$log.error("[RecordsService] createBackupFile Unexpected error while creating file descriptor!",t),n("file descriptor pb")}))}))}},{key:"uploadFile",value:function(){var e=this;return this.$q((function(t,n){var r=e.updatedBlob?e.updatedBlob:e.data,i=e.recordFile;return!1!==e.recording?(e.$log.error("[RecordsService] Unexpected uploading file when recording not stopped"),void n("recording not stopped pb")):0===i.size?(e.$log.error("[RecordsService] error uploading empty file"),void n("empty file pb")):void e.fileStorageService.createFileDescriptor(i.name,i.extension,i.size).then((function(i){e.fileServerService.uploadAFileByChunk(i,r,void 0,(function(){})).then((function(){e.$log.info("[RecordsService] uploadFile success"),e.cleanRecord(),t()})).catch((function(t){e.$log.error("[RecordsService] Unexpected error while uploading file",t),n("server pb")}))})).catch((function(t){e.$log.error("[RecordsService] Unexpected error while creating file descriptor!",t),n("file descriptor pb")}))}))}},{key:"setRecordStopOrigin",value:function(e){e&&""!==e&&(this.recordStopOrigin=e)}},{key:"localSaveFile",value:function(){var e=this.updatedBlob?this.updatedBlob:this.data,t=this.recordFile;!1===this.recording?(this.downloadFile(e,null,null,t.name,!0),this.cleanRecord()):this.$log.error("[RecordsService] Unexpected file local storage when recording not stopped")}},{key:"downloadFile",value:function(e,t,n,r,i){this.$log.info("[RecordsService] downloadFile -- default function"),this.centralizedService.fileSaver&&this.centralizedService.fileSaver.fileDownload(e,t,n,r,i)}},{key:"startRecording",value:function(e){null!==this.recorder&&(e?this.recorder.start(e):this.recorder.start(),this.recording=!0,this.startConvTimer())}},{key:"stopRecording",value:function(){null!==this.recorder&&(this.recorder.stop(),this.recording=!1,this.closeAudioContext()),this.stopConvTimer(),this.initConversationRecordContext()}},{key:"pauseResumeRecording",value:function(){null!==this.recorder&&("recording"===this.recorder.state?(this.recorder.pause(),this.conversationRecordContext.pause=!0,this.stopConvTimer()):(this.recorder.resume(),this.conversationRecordContext.pause=!1,this.startConvTimer()))}},{key:"setOnDataAvailableCallback",value:function(e){null!==this.recorder&&(this.recorder.ondataavailable=e)}},{key:"setOnErrorCallback",value:function(e){null!==this.recorder&&(this.recorder.onerror=e)}},{key:"setOnPauseCallback",value:function(e){null!==this.recorder&&(this.recorder.onpause=e)}},{key:"setOnResumeCallback",value:function(e){null!==this.recorder&&(this.recorder.onresume=e)}},{key:"setOnStartCallback",value:function(e){null!==this.recorder&&(this.recorder.onstart=e)}},{key:"setOnStopCallback",value:function(e){null!==this.recorder&&(this.recorder.onstop=e)}},{key:"initConversationRecordContext",value:function(){this.conversationRecordContext={conversationId:"",recorder:!1,pause:!1,actualRecordTime:0,updateTimer:null,recordStopSource:"LOCAL"}}},{key:"getConversationRecordContext",value:function(e){return e===this.conversationRecordContext.conversationId?this.conversationRecordContext:null}},{key:"setConversationRecordContext",value:function(e,t,n,r,i){e&&""!==e&&(this.conversationRecordContext.conversationId=e,this.conversationRecordContext.recorder=t&&this.recording,this.conversationRecordContext.pause=n,this.conversationRecordContext.actualRecordTime=r,this.conversationRecordContext.recordStopSource=i)}},{key:"startConvTimer",value:function(){var e=this;this.conversationRecordContext.updateTimer=this.$interval((function(){e.conversationRecordContext.actualRecordTime++}),1e3)}},{key:"stopConvTimer",value:function(){null!==this.conversationRecordContext.updateTimer&&(this.$interval.cancel(this.conversationRecordContext.updateTimer),this.conversationRecordContext.updateTimer=null)}},{key:"getDurationTime",value:function(e){if(!e)return"";var t=e,n={};return n.hour=Math.trunc(t/3600),t-=3600*n.hour,n.minute=Math.trunc(t/60),t-=60*n.minute,n.seconde=t,0===n.hour?s(n.minute+":"+n.seconde,"mm:ss").format("mm:ss"):s(n.hour+":"+n.minute+":"+n.seconde,"HH:mm:ss").format("HH:mm:ss")}},{key:"initRecordTimer",value:function(e){var t=this;e.updateTimer=this.$interval((function(){e.actualRecordTime++,e.displayRecordTime=t.getDurationTime(e.actualRecordTime)}),1e3)}},{key:"stopRecordTimer",value:function(e){null!==e.updateTimer&&(this.$interval.cancel(e.updateTimer),e.updateTimer=null)}},{key:"handleRecordPauseResume",value:function(e){var t=this.getConversationRecordContext(e.conversation.id);e.recorder&&t&&(e.pauseRecord=t.pause,e.pauseRecord?(this.$interval.cancel(e.updateTimer),e.updateTimer=null):e.updateTimer||this.initRecordTimer(e))}},{key:"pauseOrResumeRecording",value:function(e){e.recorder&&this.pauseResumeRecording()}},{key:"startRecord",value:function(e,t){if(!e.recorder){e.recorder=!0;var n,r=e.conversation,i=null,a=null;if("PHONE_MP"===e.callType){var c=e.getConversation().contact;n="conv_"+c.firstname.substr(0,1)+"_"+c.lastname+"_"+s().format("DD-MM-YYYY_H_mm_ss")+".mp4"}else n="conv_"+r.contact.firstname.substr(0,1)+"_"+r.contact.lastname+"_"+s().format("DD-MM-YYYY_H_mm_ss")+".mp4";var l=r.videoCall.localMedia&o.Call.Media.SHARING?"LOCAL":"REMOTE";if(r.videoCall&&r.videoCall.id&&(i=r.videoCall.id),e.webrtcCallRef&&e.webrtcCallRef.id&&(a=e.webrtcCallRef.id),!i&&!a)return void(e.recorder=!1);this.createRecord(i,a,l,!0,n)?(this.startRecording(),this.setConversationRecordContext(r.id,e.recorder,!1,0,"LOCAL"),this.manageRecordButtons(e,t),this.conversationService.sendRecordingMessage(r,"start")):e.recorder=!1}}},{key:"stopRecord",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LOCAL";e.recorder&&(this.setRecordStopOrigin(n),this.stopRecording(),e.recorder=!1,this.manageRecordButtons(e,t),e.displayRecordTime=null,e.updateTimer&&(this.stopRecordTimer(e),e.updateTimer=null),this.conversationService.sendRecordingMessage(e.conversation,"stop"))}},{key:"manageActiveRecorder",value:function(e){var t=this;if(!e.updateTimer){this.setOnPauseCallback((function(){t.handleRecordPauseResume(e)})),this.setOnResumeCallback((function(){t.handleRecordPauseResume(e)}));var n=this.getConversationRecordContext(e.conversation.id);n&&n.recorder&&(e.pauseRecord=n.pause,e.actualRecordTime=n.actualRecordTime,e.updateTimer=null,e.pauseRecord||this.initRecordTimer(e),e.displayRecordTime=this.getDurationTime(e.actualRecordTime))}}},{key:"manageRecordButtons",value:function(e,t){if(e.recordingFeature&&e.conversation&&("WEBRTC"===e.callType&&e.conversation.videoCall&&(e.isRecorded=e.conversation.videoCall.isRecorded),"PHONE_MP"===e.callType)){var n=this.getConversationRecordContext(e.conversation.id);n&&n.recorder?(e.recorder=n.recorder,t.stopRecord=!0,t.startRecord=!1,this.manageActiveRecorder(e)):(t.stopRecord=!1,t.startRecord=!0)}}}]),t}();h.$inject=["$q","$rootScope","$log","fileServerService","centralizedService","ringingService","conversationService","$interval","$translate","$window"],angular.module("rainbow").service("recordsService",h)}).call(this,n(57).Buffer)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(397);t.Decoder=r.default;var i=n(231);t.Encoder=i.default;var a=n(402);t.Reader=a.default;var o=n(48);t.tools=o;var s=n(404).version;t.version=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(48),a=n(230),o=n(48),s=n(232).byEbmlID;!function(e){e[e.STATE_TAG=1]="STATE_TAG",e[e.STATE_SIZE=2]="STATE_SIZE",e[e.STATE_CONTENT=3]="STATE_CONTENT"}(r||(r={}));var c=function(){function e(){this._buffer=new i.Buffer(0),this._tag_stack=[],this._state=r.STATE_TAG,this._cursor=0,this._total=0,this._schema=s,this._result=[]}return e.prototype.decode=function(e){this.readChunk(e);var t=this._result;return this._result=[],t},e.prototype.readChunk=function(e){for(this._buffer=o.concat([this._buffer,new i.Buffer(e)]);this._cursor<this._buffer.length&&(this._state!==r.STATE_TAG||this.readTag())&&(this._state!==r.STATE_SIZE||this.readSize())&&(this._state!==r.STATE_CONTENT||this.readContent()););},e.prototype.getSchemaInfo=function(e){return this._schema[e]||{name:"unknown",level:-1,type:"unknown",description:"unknown"}},e.prototype.readTag=function(){if(this._cursor>=this._buffer.length)return!1;var e=i.readVint(this._buffer,this._cursor);if(null==e)return!1;var t=this._buffer.slice(this._cursor,this._cursor+e.length).reduce((function(e,t,n,r){return e+t*Math.pow(16,2*(r.length-1-n))}),0),n=this.getSchemaInfo(t),a={EBML_ID:t.toString(16),schema:n,type:n.type,name:n.name,level:n.level,tagStart:this._total,tagEnd:this._total+e.length,sizeStart:this._total+e.length,sizeEnd:null,dataStart:null,dataEnd:null,dataSize:null,data:null};return this._tag_stack.push(a),this._cursor+=e.length,this._total+=e.length,this._state=r.STATE_SIZE,!0},e.prototype.readSize=function(){if(this._cursor>=this._buffer.length)return!1;var e=i.readVint(this._buffer,this._cursor);if(null==e)return!1;var t=this._tag_stack[this._tag_stack.length-1];return t.sizeEnd=t.sizeStart+e.length,t.dataStart=t.sizeEnd,t.dataSize=e.value,-1===e.value?(t.dataEnd=-1,"m"===t.type&&(t.unknownSize=!0)):t.dataEnd=t.sizeEnd+e.value,this._cursor+=e.length,this._total+=e.length,this._state=r.STATE_CONTENT,!0},e.prototype.readContent=function(){var e=this._tag_stack[this._tag_stack.length-1];if("m"===e.type){if(e.isEnd=!1,this._result.push(e),this._state=r.STATE_TAG,0===e.dataSize){var t=Object.assign({},e,{isEnd:!0});this._result.push(t),this._tag_stack.pop()}return!0}if(this._buffer.length<this._cursor+e.dataSize)return!1;var n=this._buffer.slice(this._cursor,this._cursor+e.dataSize);switch(this._buffer=this._buffer.slice(this._cursor+e.dataSize),e.data=n,e.type){case"u":e.value=n.readUIntBE(0,n.length);break;case"i":e.value=n.readIntBE(0,n.length);break;case"f":e.value=4===e.dataSize?n.readFloatBE(0):8===e.dataSize?n.readDoubleBE(0):(console.warn("cannot read "+e.dataSize+" octets float. failback to 0"),0);break;case"s":e.value=n.toString("ascii");break;case"8":e.value=n.toString("utf8");break;case"b":e.value=n;break;case"d":e.value=i.convertEBMLDateToJSDate(new a.Int64BE(n).toNumber())}if(null===e.value)throw new Error("unknown tag type:"+e.type);for(this._result.push(e),this._total+=e.dataSize,this._state=r.STATE_TAG,this._cursor=0,this._tag_stack.pop();this._tag_stack.length>0;){var o=this._tag_stack[this._tag_stack.length-1];if(o.dataEnd<0)return this._tag_stack.pop(),!0;if(this._total<o.dataEnd)break;if("m"!==o.type)throw new Error("parent element is not master element");t=Object.assign({},o,{isEnd:!0}),this._result.push(t),this._tag_stack.pop()}return!0},e}();t.default=c},function(e,t,n){(function(t){var n={readVint:function(e,t){t=t||0;for(var n=1;n<=8&&!(e[t]>=Math.pow(2,8-n));n++);if(n>8)throw new Error("Unrepresentable length: "+n+" "+e.toString("hex",t,t+n));if(t+n>e.length)return null;for(var r=e[t]&(1<<8-n)-1,i=1;i<n;i++){if(7===i&&r>=Math.pow(2,45)&&e[t+7]>0)return{length:n,value:-1};r*=Math.pow(2,8),r+=e[t+i]}return{length:n,value:r}},writeVint:function(e){if(e<0||e>Math.pow(2,53))throw new Error("Unrepresentable value: "+e);for(var n=1;n<=8&&!(e<Math.pow(2,7*n)-1);n++);for(var r=new t(n),i=1;i<=n;i++){var a=255&e;r[n-i]=a,e-=a,e/=Math.pow(2,8)}return r[0]=r[0]|1<<8-n,r}};e.exports=n}).call(this,n(57).Buffer)},function(e,t,n){var r=n(400);e.exports=function(e){var t={},n=new r(e);t.trackNumber=n.nextUIntV(),t.timecode=n.nextInt16BE();var i=n.nextUInt8();t.invisible=!!(8&i),t.keyframe=!!(128&i),t.discardable=!!(1&i);var a=(6&i)>>1;return t.frames=function(e,t){if(!t)return[e.nextBuffer()];var n,r,i=[],a=e.nextUInt8()+1;if(2===t){if(e.length%a!=0)throw new Error("Fixed-Size Lacing Error");for(r=e.length/a,n=0;n<a;n++)i.push(e.nextBuffer(r));return i}var o=[];if(1===t)for(n=0;n<a-1;n++){var s;r=0;do{r+=s=e.nextUInt8()}while(255===s);o.push(r)}else if(3===t)for(r=e.nextUIntV(),o.push(r),n=1;n<a-1;n++)r+=e.nextIntV(),o.push(r);for(n=0;n<a-1;n++)i.push(e.nextBuffer(o[n]));return i.push(e.nextBuffer()),i}(n,a),t}},function(e,t,n){var r=n(401);function i(e){this.buffer=e,this.offset=0}i.prototype.nextInt16BE=function(){var e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e},i.prototype.nextUInt8=function(){var e=this.buffer.readUInt8(this.offset);return this.offset+=1,e},i.prototype.nextUIntV=function(){var e=r(this.buffer,this.offset);return this.offset+=e.length,e.value},i.prototype.nextIntV=function(){var e=r(this.buffer,this.offset,!0);return this.offset+=e.length,e.value},i.prototype.nextBuffer=function(e){var t=e?this.buffer.slice(this.offset,this.offset+e):this.buffer.slice(this.offset);return this.offset+=e||this.length,t},Object.defineProperty(i.prototype,"length",{get:function(){return this.buffer.length-this.offset}}),e.exports=i},function(e,t){e.exports=function(e,t,n){t=t||0;for(var r=1;r<=8&&!(e[t]>=Math.pow(2,8-r));r++);if(r>8)throw new Error("Unrepresentable length: "+r+" "+e.toString("hex",t,t+r));if(t+r>e.length)return null;var i,a=e[t]&(1<<8-r)-1;for(i=1;i<r;i++){if(7===i&&a>=Math.pow(2,45)&&e[t+7]>0)return{length:r,value:-1};a*=Math.pow(2,8),a+=e[t+i]}return n&&(a-=Math.pow(2,7*r-1)-1),{length:r,value:a}}},function(e,t,n){var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(403),o=n(48),s=function(e){function t(){var t=e.call(this)||this;return t.logGroup="",t.hasLoggingStarted=!1,t.metadataloaded=!1,t.chunks=[],t.stack=[],t.segmentOffset=0,t.last2SimpleBlockVideoTrackTimecode=[0,0],t.last2SimpleBlockAudioTrackTimecode=[0,0],t.lastClusterTimecode=0,t.lastClusterPosition=0,t.timecodeScale=1e6,t.metadataSize=0,t.metadatas=[],t.cues=[],t.firstVideoBlockRead=!1,t.firstAudioBlockRead=!1,t.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null},t.trackTypes=[],t.trackDefaultDuration=[],t.trackCodecDelay=[],t.trackInfo={type:"nothing"},t.ended=!1,t.logging=!1,t.use_duration_every_simpleblock=!1,t.use_webp=!1,t.use_segment_info=!0,t.drop_default_duration=!0,t}return i(t,e),t.prototype.stop=function(){for(this.ended=!0,this.emit_segment_info();this.stack.length;)this.stack.pop(),this.logging&&console.groupEnd();this.logging&&this.hasLoggingStarted&&this.logGroup&&console.groupEnd()},t.prototype.emit_segment_info=function(){var e=this.chunks;if(this.chunks=[],this.metadataloaded){if(!this.use_segment_info)return;var t=this.lastClusterTimecode,n=this.duration,r=this.timecodeScale;this.emit("cluster",{timecode:t,data:e}),this.emit("duration",{timecodeScale:r,duration:n})}else{this.metadataloaded=!0,this.metadatas=e;var i=this.trackTypes.indexOf(1),a=this.trackTypes.indexOf(2);if(this.trackInfo=i>=0&&a>=0?{type:"both",trackNumber:i}:i>=0?{type:"video",trackNumber:i}:a>=0?{type:"audio",trackNumber:a}:{type:"nothing"},!this.use_segment_info)return;this.emit("metadata",{data:e,metadataSize:this.metadataSize})}},t.prototype.read=function(e){var t=this,n=!1;if(!this.ended){if("m"===e.type)if(e.isEnd)this.stack.pop();else{var r=this.stack[this.stack.length-1];if(null!=r&&r.level>=e.level){this.stack.pop(),this.logging&&console.groupEnd(),r.dataEnd=e.dataEnd,r.dataSize=e.dataEnd-r.dataStart,r.unknownSize=!1;var i=Object.assign({},r,{name:r.name,type:r.type,isEnd:!0});this.chunks.push(i)}this.stack.push(e)}if("m"===e.type&&"Segment"==e.name)0!=this.segmentOffset&&console.warn("Multiple segments detected!"),this.segmentOffset=e.dataStart,this.emit("segment_offset",this.segmentOffset);else if("b"===e.type&&"SimpleBlock"===e.name){var a=o.ebmlBlock(e.data),s=a.timecode,c=a.trackNumber,l=a.frames;if(1===this.trackTypes[c]){if(!this.firstVideoBlockRead&&(this.firstVideoBlockRead=!0,"both"===this.trackInfo.type||"video"===this.trackInfo.type)){var u=this.lastClusterTimecode+s;this.cues.push({CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:u}),this.emit("cue_info",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:u})}this.last2SimpleBlockVideoTrackTimecode=[this.last2SimpleBlockVideoTrackTimecode[1],s]}else 2===this.trackTypes[c]&&(this.firstAudioBlockRead||(this.firstAudioBlockRead=!0,"audio"!==this.trackInfo.type)||(u=this.lastClusterTimecode+s,this.cues.push({CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:u}),this.emit("cue_info",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:u})),this.last2SimpleBlockAudioTrackTimecode=[this.last2SimpleBlockAudioTrackTimecode[1],s]);this.use_duration_every_simpleblock&&this.emit("duration",{timecodeScale:this.timecodeScale,duration:this.duration}),this.use_webp&&l.forEach((function(e){if("9d012a"===e.slice(3,6).toString("hex")){var n=o.VP8BitStreamToRiffWebPBuffer(e),r=new Blob([n],{type:"image/webp"}),i=t.duration;t.emit("webp",{currentTime:i,webp:r})}}))}else"m"===e.type&&"Cluster"===e.name&&!1===e.isEnd?(this.firstVideoBlockRead=!1,this.firstAudioBlockRead=!1,this.emit_segment_info(),this.emit("cluster_ptr",e.tagStart),this.lastClusterPosition=e.tagStart):"u"===e.type&&"Timecode"===e.name?this.lastClusterTimecode=e.value:"u"===e.type&&"TimecodeScale"===e.name?this.timecodeScale=e.value:"m"===e.type&&"TrackEntry"===e.name?e.isEnd?(this.trackTypes[this.currentTrack.TrackNumber]=this.currentTrack.TrackType,this.trackDefaultDuration[this.currentTrack.TrackNumber]=this.currentTrack.DefaultDuration,this.trackCodecDelay[this.currentTrack.TrackNumber]=this.currentTrack.CodecDelay):this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null}:"u"===e.type&&"TrackType"===e.name?this.currentTrack.TrackType=e.value:"u"===e.type&&"TrackNumber"===e.name?this.currentTrack.TrackNumber=e.value:"u"===e.type&&"CodecDelay"===e.name?this.currentTrack.CodecDelay=e.value:"u"===e.type&&"DefaultDuration"===e.name?this.drop_default_duration?(console.warn("DefaultDuration detected!, remove it"),n=!0):this.currentTrack.DefaultDuration=e.value:"unknown"===e.name&&console.warn(e);!this.metadataloaded&&e.dataEnd>0&&(this.metadataSize=e.dataEnd),n||this.chunks.push(e),this.logging&&this.put(e)}},Object.defineProperty(t.prototype,"duration",{get:function(){if("nothing"===this.trackInfo.type)return console.warn("no video, no audio track"),0;var e=0,t=0,n=0,r=this.trackDefaultDuration[this.trackInfo.trackNumber];if("number"==typeof r)e=r;else if("both"===this.trackInfo.type)this.last2SimpleBlockAudioTrackTimecode[1]>this.last2SimpleBlockVideoTrackTimecode[1]?(e=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale,"number"==typeof(i=this.trackCodecDelay[this.trackTypes.indexOf(2)])&&(t=i),n=this.last2SimpleBlockAudioTrackTimecode[1]):(e=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale,"number"==typeof(i=this.trackCodecDelay[this.trackTypes.indexOf(1)])&&(t=i),n=this.last2SimpleBlockVideoTrackTimecode[1]);else if("video"===this.trackInfo.type)e=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale,"number"==typeof(i=this.trackCodecDelay[this.trackInfo.trackNumber])&&(t=i),n=this.last2SimpleBlockVideoTrackTimecode[1];else if("audio"===this.trackInfo.type){var i;e=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale,"number"==typeof(i=this.trackCodecDelay[this.trackInfo.trackNumber])&&(t=i),n=this.last2SimpleBlockAudioTrackTimecode[1]}var a=((this.lastClusterTimecode+n)*this.timecodeScale+e-t)/this.timecodeScale;return Math.floor(a)},enumerable:!0,configurable:!0}),t.prototype.addListener=function(t,n){return e.prototype.addListener.call(this,t,n)},t.prototype.put=function(e){this.hasLoggingStarted||(this.hasLoggingStarted=!0,this.logging&&this.logGroup&&console.groupCollapsed(this.logGroup)),"m"===e.type?e.isEnd?console.groupEnd():console.group(e.name+":"+e.tagStart):"b"===e.type?console.log(e.name,e.type):console.log(e.name,e.tagStart,e.type,e.value)},t}(a.EventEmitter);t.default=s},function(e,t,n){var r,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(){void 0!==a&&e.removeListener("error",a),n([].slice.call(arguments))}var a;"error"!==t&&(a=function(n){e.removeListener(t,i),r(n)},e.once("error",a)),e.once(t,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,a,o,s;if(l(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,s=c,console&&console.warn&&console.warn(s)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):v(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var l=c.length,u=v(c,l);for(n=0;n<l;++n)a(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return l(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,a,o;if(l(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},s.prototype.listenerCount=m,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e){e.exports=JSON.parse('{"name":"ts-ebml","version":"2.0.2","description":"ebml decoder and encoder","scripts":{"setup":"npm install -g http-server;","init":"npm run update; npm run mkdir; npm run build","update":"npm run reset; npm update","reset":"rm -rf node_modules","mkdir":"mkdir lib dist 2>/dev/null","clean":"rm -rf lib/* dist/* test/*.js; mkdir -p dist","build":"npm run clean   && tsc    -p .; npm run browserify","start":"http-server . -s & tsc -w -p .& watchify lib/example_seekable.js -o test/example_seekable.js","stop":"killall -- node */tsc -w -p","browserify":"browserify lib/index.js --standalone EBML -o dist/EBML.js","watchify":"watchify lib/index.js --standalone EBML -o dist/EBMl.js -v","test":"tsc; espower lib/test.js > lib/test.tmp; mv -f lib/test.tmp lib/test.js; browserify lib/test.js -o test/test.js","example":"tsc; browserify lib/example_seekable.js -o test/example_seekable.js","examples":"tsc; for file in `find lib -name \'example_*.js\' -type f -printf \'%f\\\\n\'`; do browserify lib/$file -o test/$file; done","examples_bsd":"tsc; for file in `find lib -name \'example_*.js\' -type f -print`; do browserify lib/$(basename $file) -o test/$(basename $file); done","check":"tsc -w --noEmit -p ./","lint":"tslint -c ./tslint.json --project ./tsconfig.json --type-check","doc":"typedoc --mode modules --out doc --disableOutputCheck"},"repository":{"type":"git","url":"git+https://github.com/legokichi/ts-ebml.git"},"keywords":["ebml","webm","mkv","matrosika","webp"],"author":"legokichi duckscallion","license":"MIT","bugs":{"url":"https://github.com/legokichi/ts-ebml/issues"},"homepage":"https://github.com/legokichi/ts-ebml#readme","dependencies":{"buffer":"^5.0.7","commander":"^2.11.0","ebml":"^2.2.1","ebml-block":"^1.1.0","events":"^1.1.1","int64-buffer":"^0.1.9","matroska":"^2.2.3"},"devDependencies":{"@types/commander":"^2.9.1","@types/qunit":"^2.0.31","browserify":"^13.1.0","empower":"^1.2.3","espower-cli":"^1.1.0","power-assert":"^1.4.4","power-assert-formatter":"^1.4.1","qunit-tap":"^1.5.1","qunitjs":"^2.4.0","tslint":"^3.15.1","typedoc":"^0.5.3","typescript":"^2.4.2","watchify":"^3.7.0"},"bin":"./lib/cli.js","main":"./lib/index.js","typings":"./lib/index.d.ts"}')},function(e,t,n){n.r(t);var r=n(5),a=n.n(r),o=n(2),s=n.n(o),c=n(59),l=n.n(c),u=n(1),d=n.n(u),h=n(19);angular.module("rainbow").service("adminCompanyService",["$q","$log","$http","$rootScope","errorHelperService","Site","CompanyInvitation","pushImageHelperService","CompanyRequest","Bot",function(e,t,n,r,o,c,u,f,p,m){var v=this;v.start=function(){return t.info("[adminCompanyService] === STARTING ==="),v.portalURL=config.restServerUrl+"/api/rainbow/admin/v1.0/",t.info("[adminCompanyService] === STARTED ==="),e.when()},v.stop=function(){return t.info("[adminCompanyService] === STOPPING ==="),t.info("[adminCompanyService] === STOPPED ==="),e.when()},v.getCompanies=function(r,i,a,c,u,f,p,m,g,y,b,S){var _=e.defer(),C=d.a.userContact;if(!(C.isSuperadmin()||C.isBusinessAdmin()||C.isBPAdmin()||C.isOrganizationAdmin()))return v.getCompany(C.company.id).then((function(e){return{companies:[e]}}));var w=v.portalURL+"companies?format="+(u||"full");return r&&(w+="&organisationId="+r),i&&a&&(w+="&offset="+a*(i-1)),a&&(w+="&limit="+a),c&&(w+="&name="+encodeURIComponent(c)),f&&(w+="&bpId="+f),p&&(Array.isArray(p)?p.forEach((function(e){w+="&status="+e})):w+="&status="+p),null!=m&&(w+="&isBP="+m),g&&(w+="&bpType="+g),y&&(w+="&offerCanBeSold="+y),b&&(w+="&externalReference="+encodeURIComponent(b)),n({method:"GET",url:w,headers:s.a.getRequestHeader()}).then((function(e){var n=e.data.data;t.info("[adminCompanyService] getCompanies success");var r=[];n.forEach((function(e){var t=h.Company.createFromData(e);!angular.isUndefined(S)&&S||l.a.getCompanyLogo(t),r.push(t)})),_.resolve({companies:r,limit:e.data.limit,offset:e.data.offset,total:e.data.total})}),(function(e){var n=o.handleError(e);_.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanies"))})),_.promise},v.getAllCompaniesSmall=function(e,t,n,r,i){return v.getAllCompanies(e,t,n,r,i,"small")},v.getAllCompanies=function(t,n,r,a,o,s){return e((function(c,l){var u;v.getCompanies(t,1,1e3,null,s,n,r,a,o).then((function(c){if(u=c,c.total>c.limit){var l=Math.ceil(c.total/1e3),d=Array.apply(void 0,Object(i.a)(Array(l-1)));d=d.map((function(e,t){return t+2}));for(var h=[];d.length>0;)h.push(d.splice(0,5));return h.reduce((function(i,l){return i.then((function(){var i=l.map((function(e){return v.getCompanies(t,e,1e3,null,s,n,r,a,o).then((function(e){c.companies=c.companies.concat(e.companies),c.limit+=e.limit}))}));return e.all(i)}))}),e.resolve())}return e.resolve()})).then((function(){c(u)})).catch((function(e){l(e)}))}))},v.getCompany=function(r,i){return e((function(e,a){n({method:"GET",url:v.portalURL+"companies/"+r+"?format="+(i||"full"),headers:s.a.getRequestHeader()}).then((function(n){t.info("[adminCompanyService] getCompany success");var r=n.data.data,i=h.Company.createFromData(r);l.a.getCompanyLogo(i),l.a.getCompanyBanner(i),e(i)}),(function(e){var n=o.handleError(e);a(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompany"))}))}))},v.getDefaultCompany=function(){return e((function(e,r){n({method:"GET",url:v.portalURL+"companies/default",headers:s.a.getRequestHeader()}).then((function(n){t.info("[adminCompanyService] getDefaultCompany success");var r=n.data.data,i=h.Company.createFromData(r);e(i)}),(function(e){var n=o.handleError(e);r(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getDefaultCompany"))}))}))},v.searchCompanies=function(t){var n=e.defer(),r=t.toLowerCase();return v.getCompanies().then((function(e){var t=e.companies.filter((function(e){return e.name.toLowerCase().indexOf(r)>-1}));n.resolve(t)})),n.promise},v.createCompany=function(i){var a=h.Company.prune(i,d.a.userContact),c=e.defer();return n({method:"POST",url:v.portalURL+"companies",headers:s.a.getRequestHeader(),data:a}).then((function(e){t.info("[adminCompanyService] createCompany success");var n=h.Company.createFromData(e.data.data);r.$broadcast("ADMIN_COMPANIES_CHANGE"),c.resolve(n)}),(function(e){var n=o.handleError(e);c.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"createCompany"))})),c.promise},v.createCompanyEndUser=function(r){var i=h.Company.prune(r,d.a.userContact),a=e.defer();return n({method:"POST",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/companies",headers:s.a.getRequestHeader(),data:i}).then((function(e){t.info("[adminCompanyService] createCompany success");var n=e.data.data,r=h.Company.createFromData(n);a.resolve(r)}),(function(e){var n=o.handleError(e);a.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"createCompanyEndUser"))})),a.promise},v.updateCompany=function(i){var a=h.Company.prune(i,d.a.userContact),c=e.defer();return n({method:"PUT",url:v.portalURL+"companies/"+i.id,headers:s.a.getRequestHeader(),data:a}).then((function(e){t.info("[adminCompanyService] updateCompany success");var n=e.data.data,a=h.Company.createFromData(n);c.resolve(a),r.$broadcast("ON_COMPANY_CHANGE_EVENT",i.id)}),(function(e){var n=o.handleError(e);c.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"updateCompany"))})),c.promise},v.setDefaultLicenseGroup=function(e,t){var n={id:e,defaultLicenseGroup:t||null};return v.updateCompany(n)},v.addVisibility=function(r,i){var a=e.defer();return n({method:"POST",url:v.portalURL+"companies/"+r+"/visible-by/"+i,headers:s.a.getRequestHeader()}).then((function(){t.info("[adminCompanyService] addVisibility success"),a.resolve()}),(function(e){var n=o.handleError(e);a.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"addVisibility"))})),a.promise},v.removeVisibility=function(r,i){var a=e.defer();return n({method:"DELETE",url:v.portalURL+"companies/"+r+"/visible-by/"+i,headers:s.a.getRequestHeader()}).then((function(){t.info("[adminCompanyService] removeVisibility success"),a.resolve()}),(function(e){var n=o.handleError(e);a.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"removeVisibility"))})),a.promise},v.getAllSiteCompany=function(r){var i=e.defer();return n({method:"GET",url:v.portalURL+"companies/"+r+"/sites",headers:s.a.getRequestHeader()}).then((function(e){t.info("[adminCompanyService] getAllSiteCompany success");var n=e.data.data,r=[];n.forEach((function(e){var t=c.createFromData(e);r.push(t)})),i.resolve(r)}),(function(e){var n=o.handleError(e);i.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getAllSiteCompany"))})),i.promise},v.getCompanyAdministrators=function(r){return e((function(e,i){n({method:"GET",url:v.portalURL+"companies/"+r+"/administrators",headers:s.a.getRequestHeader()}).then((function(n){t.info("[adminCompanyService] getCompanyAdministrators success");var r=n.data.data,i=[];r.forEach((function(e){var t={id:e.id};i.push(t)})),e(i)}),(function(e){var n=o.handleError(e);i(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanyAdministrators"))}))}))},v.deleteCompany=function(r){var i=e.defer();return n({method:"DELETE",url:v.portalURL+"companies/"+r,headers:s.a.getRequestHeader()}).then((function(){t.info("[adminCompanyService] deleteCompany success"),i.resolve()}),(function(e){var n=o.handleError(e);i.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"deleteCompany"))})),i.promise},v.pushLogo=function(n,i,a){return e((function(o,s){var c=v.portalURL+"companies/"+n+"/avatar";(angular.isDefined(i)&&null!==i?f.pushImage(c,i):e.resolve()).then((function(){return v.getCompany(n)})).then((function(e){return e.avatarShape=a,v.updateCompany(e)})).then((function(){r.$broadcast("ON_COMPANY_CHANGE_EVENT",n),t.info("[adminCompanyService] pushLogo success"),o()})).catch((function(e){s(e)}))}))},v.deleteLogo=function(i){return e((function(e,a){n({method:"DELETE",url:v.portalURL+"companies/"+i+"/avatar",headers:s.a.getRequestHeader()}).then((function(){r.$broadcast("ON_COMPANY_CHANGE_EVENT",i),v.getCompany(i).then((function(e){return e.avatarShape="circle",v.updateCompany(e)})).then((function(){t.info("[adminCompanyService] deleteLogo success"),e()})).catch((function(e){a(e)}))}),(function(e){var n=o.handleError(e);a(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"deleteLogo"))}))}))},v.pushBanner=function(t,n,i){return e((function(e,a){var o=v.portalURL+"companies/"+t+"/banner";return f.pushImage(o,n,i).then((function(){r.$broadcast("ON_COMPANY_CHANGE_EVENT",t),e()})).catch((function(e){a(e)}))}))},v.deleteBanner=function(i){return e((function(e,a){n({method:"DELETE",url:v.portalURL+"companies/"+i+"/banner",headers:s.a.getRequestHeader()}).then((function(){r.$broadcast("ON_COMPANY_CHANGE_EVENT",i),t.info("[adminCompanyService] deleteBanner success"),e()}),(function(e){var n=o.handleError(e);a(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"deleteBanner"))}))}))},v.getCompanySupportBot=function(r){return e((function(e,i){var a=v.portalURL+"bots/rainbow-support";r&&(a+="?companyId="+r),n({method:"GET",url:a,headers:s.a.getRequestHeader()}).then((function(n){t.info("[companyService] getCompanySupportBot success");var r=m.create(n.data.data);e(r)})).catch((function(e){var n="getCompanySupportBot failure "+e.data.errorDetails+" with status "+e.status;t.error("[companyService] "+n),i(new Error(n))}))}))},v.pushCompanyBotAvatar=function(n,r,i){return e((function(a,o){var s=v.portalURL+"bots/"+n+"/companies/"+r+"/avatar";(angular.isDefined(i)&&null!==i?f.pushImage(s,i):e.resolve()).then((function(){t.info("[adminCompanyService] pushCompanyBotAvatar success"),a()})).catch((function(e){o(e)}))}))},v.deleteCompanyBotAvatar=function(r,i){return e((function(e,a){n({method:"DELETE",url:v.portalURL+"bots/"+r+"/companies/"+i+"/avatar",headers:s.a.getRequestHeader()}).then((function(){t.info("[adminCompanyService] deleteCompanyBotAvatar success"),e()}),(function(e){var n=o.handleError(e);a(n),t.error("[botService] "+o.getErrorFullMessage(e,"deleteCompanyBotAvatar"))}))}))},v.getCompanyInvitations=function(r,i,a){return e((function(e,c){var l=v.portalURL+"companies/"+r+"/join-companies/invitations?format=medium&status=pending declined&limit="+a;i&&(l+="&offset="+a*(i-1)),n({method:"GET",url:l,headers:s.a.getRequestHeader()}).then((function(n){var r=[];n.data.data.forEach((function(e){var t=u.createFromData(e);r.push(t)})),t.info("[adminCompanyService] getCompanyInvitations success (found "+r.length+" invitation(s))"),e({invitations:r,total:n.data.total})}),(function(e){var n=o.handleError(e);c(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanyInvitations"))}))}))},v.joinCompanyInvitation=function(r,i,c,l,u,d){var h=e.defer(),f={lang:a.a.getAppliLanguageCodeForServer()};return l&&(f.customMessage=l),c?f.invitedUserId=c:i&&(f.email=i),u&&(f.invitedToBeCompanyAdmin=u),d&&(f.invitedToBeBpAdmin=d),n({method:"POST",url:v.portalURL+"companies/"+r+"/join-companies/invitations",headers:s.a.getRequestHeader(),data:f}).then((function(){t.info("[adminCompanyService] joinCompanyInvitation success"),h.resolve()}),(function(e){var n=o.handleError(e);h.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"joinCompanyInvitation"))})),h.promise},v.cancelJoinCompanyInvitation=function(r,i){var a=e.defer();return n({method:"POST",url:v.portalURL+"companies/"+r+"/join-companies/invitations/"+i+"/cancel",headers:s.a.getRequestHeader()}).then((function(e){var n=u.createFromData(e.data.data);t.info("[adminCompanyService] cancelJoinCompanyInvitation success"),a.resolve(n)}),(function(e){var n=o.handleError(e);a.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"cancelJoinCompanyInvitation"))})),a.promise},v.resendJoinCompanyInvitation=function(r,i){var a=e.defer();return n({method:"POST",url:v.portalURL+"companies/"+r+"/join-companies/invitations/"+i+"/re-send",headers:s.a.getRequestHeader()}).then((function(e){var n=u.createFromData(e.data.data);t.info("[adminCompanyService] resendJoinCompanyInvitation success"),a.resolve(n)}),(function(e){var n=o.handleError(e);a.reject(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"resendJoinCompanyInvitation"))})),a.promise},v.getCompanyJoinRequests=function(r){return e((function(e,i){n({method:"GET",url:v.portalURL+"companies/"+r+"/join-companies/requests?format=medium&status=pending",headers:s.a.getRequestHeader()}).then((function(n){var r=[];n.data.data.forEach((function(e){var t=p.createFromData(e);r.push(t)})),t.info("[adminCompanyService] getCompanyJoinRequests success (found "+n.data.total+" invitation(s))"),e({companyRequests:r,total:n.data.total})}),(function(e){var n=o.handleError(e);i(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanyJoinRequests"))}))}))},v.getJoinCompanyRequest=function(r,i){return e((function(e,a){n({method:"GET",url:v.portalURL+"companies/"+r+"/join-companies/requests/"+i+"?status=pending",headers:s.a.getRequestHeader()}).then((function(n){var r=p.createFromData(n.data.data);t.info("[adminCompanyService] getJoinCompanyRequest success"),e(r)}),(function(e){var n=o.handleError(e);a(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getJoinCompanyRequest"))}))}))},v.acceptCompanyJoinRequests=function(r,i){return e((function(e,a){n({method:"POST",url:v.portalURL+"companies/"+r+"/join-companies/requests/"+i+"/accept",headers:s.a.getRequestHeader()}).then((function(n){var r=p.createFromData(n.data.data);t.info("[adminCompanyService] acceptCompanyJoinRequests success"),e(r)}),(function(e){var n=o.handleError(e);t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"acceptCompanyJoinRequests")),a(n)}))}))},v.declineCompanyJoinRequests=function(r,i){return e((function(e,a){n({method:"POST",url:v.portalURL+"companies/"+r+"/join-companies/requests/"+i+"/decline",headers:s.a.getRequestHeader()}).then((function(n){var r=p.createFromData(n.data.data);t.info("[adminCompanyService] declineCompanyJoinRequests success"),e(r)}),(function(e){var n=o.handleError(e);t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"declineCompanyJoinRequests")),a(n)}))}))},v.getOAuthConsentUrl=function(){var r=a.a.getAppliLanguage().code;return e((function(e,i){n({method:"GET",url:config.restServerUrl+"/api/rainbow/office365/v1.0/consent?callback="+window.location.origin+"/redirectO365.html?provider=o365AD&lang="+r,headers:s.a.getRequestHeader()}).then((function(n){var r=n.data.url;t.info("[adminCompanyService] getOAuthConsentUrl success: "+r),e(r)}),(function(e){var n=o.handleError(e);t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getOAuthConsentUrl")),i(n)}))}))},v.getCompanyConferenceSettings=function(r){return e((function(e,i){n({method:"GET",url:v.portalURL+"companies/"+r+"/settings/conferences",headers:s.a.getRequestHeader()}).then((function(n){t.info("[adminCompanyService] getCompanyConferenceSettings success");var r=n.data.data;e(r)}),(function(e){var n=o.handleError(e);i(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanyConferenceSettings"))}))}))},v.setCompanyConferenceSettings=function(r,i){return e((function(e,a){var c={confDialOutDisabled:!i};n({method:"PUT",url:v.portalURL+"companies/"+r+"/settings/conferences",headers:s.a.getRequestHeader(),data:c}).then((function(n){t.info("[adminCompanyService] setCompanyConferenceSettings success");var r=n.data.data;e(r)}),(function(e){var n=o.handleError(e);a(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"setCompanyConferenceSettings"))}))}))},v.getCompanySAMLConfigurationFile=function(n){return e((function(e,r){s.a.getCompanySAMLConfiguration(n).then((function(t){var n=new Blob([t],{type:"application/xml"});e(n)})).catch((function(e){var n=o.handleError(e);r(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanySAMLConfigurationFile"))}))}))},v.createCompanySingleSignOnServerConfig=function(r,i,a){return e((function(e,c){a.type=i,n({method:"POST",url:v.portalURL+"companies/"+r+"/settings/sso",headers:s.a.getRequestHeader(),data:a}).then((function(n){t.info("[adminCompanyService] createCompanySingleSignOnServerConfig success");var r=n.data.data;e(r)}),(function(e){var n=o.handleError(e);c(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"createCompanySingleSignOnServerConfig"))}))}))},v.deleteCompanySingleSignOnServerConfig=function(r,i){return e((function(e,a){n({method:"DELETE",url:v.portalURL+"companies/"+r+"/settings/sso/"+i,headers:s.a.getRequestHeader()}).then((function(){t.info("[adminCompanyService] deleteCompanySingleSignOnServerConfig success"),e()}),(function(e){var n=o.handleError(e);a(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"deleteCompanySingleSignOnServerConfig"))}))}))},v.getCompanySingleSignOnServerConfig=function(r){return e((function(e,i){n({method:"GET",url:v.portalURL+"companies/"+r+"/settings/sso",headers:s.a.getRequestHeader()}).then((function(n){t.info("[adminCompanyService] getCompanySingleSignOnServerConfig success");var r=n.data.data?n.data.data:n.data;e(r)}),(function(e){var n=o.handleError(e);i(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanySingleSignOnServerConfig"))}))}))},v.updateCompanySingleSignOnServerConfig=function(r,i,a){return e((function(e,c){n({method:"PUT",url:v.portalURL+"companies/"+r+"/settings/sso/"+i,headers:s.a.getRequestHeader(),data:a}).then((function(n){t.info("[adminCompanyService] updateCompanySingleSignOnConfig success");var r=n.data.data;e(r)}),(function(e){var n=o.handleError(e);c(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"updateCompanySingleSignOnConfig"))}))}))},v.getCompanySingleSignOnSAMLOptions=function(r){return e((function(e,i){n({method:"GET",url:v.portalURL+"companies/"+r+"/settings/sso/SAML/shared-options",headers:s.a.getRequestHeader()}).then((function(n){t.info("[adminCompanyService] getCompanySingleSignOnSAMLOptions success"),e(n.data.data)}),(function(e){var n=o.handleError(e);i(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanySingleSignOnSAMLOptions"))}))}))},v.updateCompanySingleSignOnSAMLOptions=function(r,i){return e((function(e,a){n({method:"PUT",url:v.portalURL+"companies/"+r+"/settings/sso/SAML/shared-options",headers:s.a.getRequestHeader(),data:i}).then((function(n){t.info("[adminCompanyService] updateCompanySingleSignOnSAMLOptions success"),e(n.data.data)}),(function(e){var n=o.handleError(e);a(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"updateCompanySingleSignOnSAMLOptions"))}))}))},v.deleteCompanySingleSignOnSAMLOptions=function(r){return e((function(e,i){n({method:"DELETE",url:v.portalURL+"companies/"+r+"/settings/sso/SAML/shared-options",headers:s.a.getRequestHeader()}).then((function(){t.info("[adminCompanyService] deleteCompanySingleSignOnSAMLOptions success"),e()}),(function(n){var r=o.handleError(n);404===r.status?(e(),t.info("[adminCompanyService] "+o.getErrorFullMessage(n,"deleteCompanySingleSignOnSAMLOptions"))):(i(r),t.error("[adminCompanyService] "+o.getErrorFullMessage(n,"deleteCompanySingleSignOnSAMLOptions")))}))}))},v.getCompanyBpBusinessTypes=function(){return e((function(e,r){n({method:"GET",url:v.portalURL+"companies/bpbusinesstypes",headers:s.a.getRequestHeader()}).then((function(n){t.info("[adminCompanyService] getCompanyBpBusinessTypes success");var r=n.data.data;e(r)}),(function(e){var n=o.handleError(e);r(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getCompanyBpBusinessTypes"))}))}))},v.getVoIPSettingsForCompany=function(r){return e((function(e,i){n({method:"GET",url:v.portalURL+"companies/"+r+"/settings/webrtcs",headers:s.a.getRequestHeader()}).then((function(n){t.info("[adminCompanyService] getVoIPSettingsForCompany success");var r=n.data.data;e(r)}),(function(e){var n=o.handleError(e);i(n),t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"getVoIPSettingsForCompany"))}))}))},v.createVoIPSettingsForCompany=function(r,i){return e((function(e,a){n({method:"POST",url:v.portalURL+"companies/"+r+"/settings/webrtcs",headers:s.a.getRequestHeader(),data:i}).then((function(){e()}),(function(e){var n=o.handleError(e);t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"createVoIPSettingsForCompany")),a(n)}))}))},v.updateVoIPSettingsForCompany=function(r,i,a){return e((function(e,c){n({method:"PUT",url:v.portalURL+"companies/"+r+"/settings/webrtcs/"+i,headers:s.a.getRequestHeader(),data:a}).then((function(){e()}),(function(e){var n=o.handleError(e);t.error("[adminCompanyService] "+o.getErrorFullMessage(e,"createVoIPSettingsForCompany")),c(n)}))}))}}])},function(e,t,n){n.r(t);var r=n(2),i=n.n(r),a=n(31),o=n.n(a),s=n(1),c=n.n(s),l=n(19);angular.module("rainbow").service("adminUserService",["$q","$log","$http","errorHelperService","User","Site","Organisation","PhoneNumber",function(e,t,n,r,a,s,u,d){var h=this;h.start=function(){return t.info("[adminUserService] === STARTING ==="),h.portalURL=config.restServerUrl+"/api/rainbow/admin/v1.0/",t.info("[adminUserService] === STARTED ==="),e.when()},h.stop=function(){return t.info("[adminUserService] === STOPPING ==="),t.info("[adminUserService] === STOPPED ==="),e.when()},h.getUsersByEmail=function(o,c){return e((function(e,d){var f=h.portalURL+"users?format=full";o&&o instanceof u&&(f+="&organisationId="+o.id),o&&o instanceof l.Company&&(f+="&companyId="+o.id),o&&o instanceof s&&(f+="&siteId="+o.id),c&&(f+="&email="+encodeURIComponent(c)),n({method:"GET",url:f,headers:i.a.getRequestHeader()}).then((function(n){var r=n.data.data;t.info("[adminUserService] getUsersByEmail success (find "+n.data.total+" user(s))");var i=[];r.forEach((function(e){var t=a.createFromData(e);i.push(t)})),e({users:i,total:n.data.total})}),(function(e){var n=r.handleError(e);d(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"getUsersByEmail"))}))}))},h.getUsers=function(o,c,d,f,p,m,v,g,y,b){return e((function(e,S){var _=h.portalURL+"users?format=full&limit="+d;"string"==typeof o&&(_+="&companyId="+o),o&&o instanceof l.Company&&(_+="&companyId="+o.id),o&&o instanceof u&&(_+="&organisationId="+o.id),o&&o instanceof s&&(_+="&siteId="+o.id),c&&(_+="&offset="+d*(c-1)),f&&(_+="&displayName="+encodeURIComponent(f)+"&useEmails=true"),g&&(_+="&tags="+encodeURIComponent(g)),b&&(_+="&selectedAppCustomisationTemplate="+encodeURIComponent(b)),null!=p&&(_+="&isTerminated="+p),_+=m?"&roles=admin&roles=bp_admin&roles=bp_finance&roles=superadmin&roles=business_admin":"&excludeRoles=tv",angular.isDefined(y)&&(_+="&isActivated="+y),n({method:"GET",url:_+="&sortField=reverseDisplayName",headers:i.a.getRequestHeader()}).then((function(n){var r=n.data.data;t.info("[adminUserService] getUsers success (find "+n.data.total+" user(s))");var i=[];r.forEach((function(e){var t=a.createFromData(e,v);i.push(t)})),e({users:i,limit:n.data.limit,offset:n.data.offset,total:n.data.total})}),(function(e){var n=r.handleError(e);S(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"getUsers"))}))}))},h.searchUsers=function(o,s,c,l){return e((function(e,u){var d=config.restServerUrl+"/api/rainbow/search/v1.0/users?limit="+c;o&&(d+="&companyId="+o.id),s&&(d+="&offset="+c*(s-1)),l&&(d+="&displayName="+encodeURIComponent(l)),n({method:"GET",url:d,headers:i.a.getRequestHeader()}).then((function(n){var r=n.data.data;t.info("[adminUserService] searchUsers success (find "+n.data.total+" user(s))");var i=[];r.forEach((function(e){var t=a.createFromData(e);i.push(t)})),e({users:i,total:n.data.total})}),(function(e){var n=r.handleError(e);u(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"searchUsers"))}))}))},h.getUser=function(o){var s=e.defer();return n({method:"GET",url:h.portalURL+"users/"+o,headers:i.a.getRequestHeader()}).then((function(e){t.info("[adminUserService] getUser success");var n=e.data.data,r=a.createFromData(n);s.resolve(r)}),(function(e){var n=r.handleError(e);s.reject(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"getUser"))})),s.promise},h.createUser=function(o,s){var l=a.prune(o,c.a.userContact),u=h.portalURL+"users";s&&null!=s.sendInvitationEmail&&(u+="?sendInvitationEmail="+s.sendInvitationEmail);var d=e.defer();return n({method:"POST",url:u,headers:i.a.getRequestHeader(),data:l}).then((function(e){var n=a.createFromData(e.data.data);t.info("[adminUserService] createUser success"),d.resolve(n)}),(function(e){var n=r.handleError(e);d.reject(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"createUser"))})),d.promise},h.deleteUser=function(a){var o=e.defer();return n({method:"DELETE",url:h.portalURL+"users/"+a.id,headers:i.a.getRequestHeader()}).then((function(){t.info("[adminUserService] deleteUser success"),o.resolve()}),(function(e){var n=r.handleError(e);o.reject(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"deleteUser"))})),o.promise},h.updateUser=function(o){var s=a.prune(o,c.a.userContact),l=e.defer();return n({method:"PUT",url:h.portalURL+"users/"+o.id,headers:i.a.getRequestHeader(),data:s}).then((function(e){t.info("[adminUserService] updateUser success");var n=a.createFromData(e.data.data);l.resolve(n)}),(function(e){var n=r.handleError(e);l.reject(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"updateUser"))})),l.promise},h.getUserAvatar=function(e){var t=o.a.computeUserColor(e.firstName+" "+e.lastName).color;e.image=o.a.getAvatarImage(e.id,e.initials,t,50,e.lastAvatarUpdateDate)},h.expandTelephonyInfo=function(e){var t={};if(e.phoneNumbers){var n=[];e.phoneNumbers.forEach((function(e){var r=e.number,i=e.numberE164,a=e.deviceType;switch(e.type){case"work":if("landline"===a){var o=d.createFromData(e);n.push(o),e.isCloudPbxDDI||e.isOxoPbxDDI?(t.phonePro=e.number,t.phoneProCan=e.numberE164,t.phoneProDdiNumber=o):t.phoneProNumber&&t.phoneProNumber.systemId||(t.phoneProDdiNumber||(t.phonePro=r,t.phoneProCan=i),t.phoneProExt=e.shortNumber,t.phoneProIsMonitored=e.isMonitored,t.phoneProNumber=o)}"mobile"===a&&(t.mobilePro=r,t.mobileProCan=i);break;case"home":"landline"===a&&(t.phonePerso=r,t.phonePersoCan=i),"mobile"===a&&(t.mobilePerso=r,t.mobilePersoCan=i);break;case"rainbow":t.rainbowPhoneNumber=r}})),t.alternativePhoneProNumbers=n.filter((function(e){return!e.systemId&&!e.isFromSystem&&e.id!==t.phoneProNumber.id}))}return t},h.getAllUsers=function(t,n){return e((function(r,i){var a;h.getUsers(t,1,1e3,void 0,void 0,void 0,n).then((function(r){if(a=r,r.total>r.limit){var i=Math.ceil(r.total/1e3),o=Array.apply(null,Array(i-1));o=o.map((function(e,t){return t+2}));for(var s=[];o.length>0;)s.push(o.splice(0,5));return s.reduce((function(r,i){return r.then((function(){var r=i.map((function(e){return h.getUsers(t,e,1e3,void 0,void 0,void 0,n).then((function(e){a.users=a.users.concat(e.users),a.limit+=e.limit}))}));return e.all(r)}))}),e.resolve())}})).then((function(){r(a)})).catch((function(e){i(e)}))}))},h.getUserTags=function(a){return e((function(e,o){var s=h.portalURL+"users/tags";a&&(s+="?companyId="+a),n({method:"GET",url:s,headers:i.a.getRequestHeader()}).then((function(n){var r=n.data.data.tags||[];t.info("[adminUserService] getUserTags success (find "+r.length+"tags(s))"),e(r)}),(function(e){var n=r.handleError(e);o(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"getUserTags"))}))}))},h.getTagsStats=function(a){return e((function(e,o){var s=h.portalURL+"users/tags/stats";a&&(s+="?companyId="+a),n({method:"GET",url:s,headers:i.a.getRequestHeader()}).then((function(n){var r=n.data.data.stats||[];t.info("[adminUserService] getTagsStats success (find "+r.length+"tags(s))"),e(r)}),(function(e){var n=r.handleError(e);o(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"getTagsStats"))}))}))},h.renameTag=function(a,o,s){return e((function(e,c){var l=h.portalURL+"users/tags?tag="+encodeURIComponent(a);s&&(l+="&companyId="+s),n({method:"PUT",url:l,headers:i.a.getRequestHeader(),data:{newTagName:o}}).then((function(n){t.info("[adminUserService] renameTag success => old tag: "+a+" => new tag: "+o+": found "+n.data.data.found+" occurence(s)"),e()}),(function(e){var n=r.handleError(e);c(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"renameTag"))}))}))},h.deleteTag=function(a,o){return e((function(e,s){var c=h.portalURL+"users/tags?tag="+encodeURIComponent(a);o&&(c+="&companyId="+o),n({method:"DELETE",url:c,headers:i.a.getRequestHeader()}).then((function(n){t.info("[adminUserService] deleteTag success (tag "+a+": found "+n.data.data.found+" occurence(s)"),e()}),(function(e){var n=r.handleError(e);s(n),t.error("[adminUserService] "+r.getErrorFullMessage(e,"deleteTag"))}))}))},h.getUserProfilesFeatures=function(a){return e((function(e,o){n({method:"GET",url:config.restServerUrl+"/api/rainbow/admin/v1.0/users/"+a+"/profiles/features",headers:i.a.getRequestHeader()}).then((function(n){var r={};n.data.data.forEach((function(e){t.debug("[adminUserService] getUserProfilesFeatures === response ==="+JSON.stringify(e)),e.hasOwnProperty("featureUniqueRef")&&(r[e.featureUniqueRef]=e)})),e(r)}),(function(n){if(404===n.status)t.debug("[adminUserService] getUserProfilesFeatures : features found for user: "+a),e();else{var i=r.handleError(n);o(i),t.error("[adminUserService] "+r.getErrorFullMessage(n,"getUserProfilesFeatures"))}}))}))},h.getUserPresenceInformation=function(a){return e((function(e,o){n({method:"GET",url:config.restServerUrl+"/api/rainbow/admin/v1.0/users/"+a+"/presences",headers:i.a.getRequestHeader()}).then((function(n){t.debug("[adminUserService] getUserPresenceInformation for user Id "+a+" === response === "+JSON.stringify(n.data.data));var r={};n.data.data.jid_im.forEach((function(e){r[e.resource]={},r[e.resource].show=e.show?e.show:"online",r[e.resource].status=e.status?e.status:"",r[e.resource].stamp=e.date,r[e.resource].type="jid_im"})),n.data.data.jid_tel.forEach((function(e){"calendar"!==e.resource&&(r[e.resource]={},r[e.resource].show=e.show?e.show:"online",r[e.resource].stamp=e.date,r[e.resource].type="phone")}));var i=h.calculatePresenceFromUserResources(r);e(i)}),(function(e){var n=r.handleError(e);t.error("[adminUserService] "+r.getErrorFullMessage(e,"getUserPresenceInformation")),o(n)}))}))},h.calculatePresenceFromUserResources=function(e){var t=!1,n=!1,r=!1,i=!1,a=!1,o=!1,s="",c=!1,l=!1,u=!1,d="offline",h="";for(var f in e)if(e.hasOwnProperty(f)){var p=e[f];"phone"!==p.type?"xa"===p.show&&""===p.status?n=!0:"dnd"===p.show&&""===p.status?r=!0:"xa"===p.show&&"away"===p.status?i=!0:"dnd"===p.show&&"presentation"===p.status?a=!0:"dnd"===p.show&&p.status?(o=!0,s=p.status):""!==p.show&&"online"!==p.show||""!==p.status&&"mode=auto"!==p.status?"away"===p.show&&""===p.status&&(u=!0):-1!==f.indexOf("mobile_")?l=!0:c=!0:t="EVT_SERVICE_INITIATED"===p.status||"EVT_ESTABLISHED"===p.status}return t?(d="busy",h="phone"):n?(d="xa",h=""):r?(d="dnd",h=""):i?(d="away",h=""):a?(d="dnd",h="presentation"):o?(d="busy",h=s):c?(d="online",h=""):l?(d="online-mobile",h=""):u&&(d="away",h=""),{presence:d,status:h}}}])},function(e,t){angular.module("rainbow").filter("emojione",(function(){return function(e){return e}})),angular.module("rainbow").filter("emojiUnicodeToShort",(function(){return function(e){return e}})),angular.module("rainbow").filter("emojiShortToUnicode",(function(){return function(e){return e}}))},function(e,t){angular.module("rainbow").service("centralizedService",(function(){})),angular.module("rainbow").service("translateService",(function(){}))},function(e,t){angular.module("rainbow").factory("TransfertPromiseQueue",["$log","$q",function(e,t){function n(){var n=this;n.fileQueue=[],n.clearContext=function(){n.currentId=null,n.currentQueue=[],n.promiseCompletion=void 0,n.promiseReject=void 0,n.initialQueueSize=0,n.promisesDone=0,n.chunkErrorCounter=0,n.currentPromise=void 0},n.clearContext(),n.addPromiseArray=function(r,i,a,o){e.debug("[TransfertPromiseQueue] adding promiseArray");var s={};return s.id=r,s.promiseArray=i,s.promiseCompletion=a,s.promiseReject=o,0!==n.fileQueue.length||n.currentPromise?(n.fileQueue.push(s),e.debug("[TransfertPromiseQueue] adding PromiseArray in FileQueue: "+n.fileQueue.length)):(e.debug("[TransfertPromiseQueue] configuring file to transfert: "+s.promiseArray.length),n.fileQueue.push(s),n.popFileQueue()),e.debug("[TransfertPromiseQueue] adding promise on FileQueue: "+n.fileQueue.length),t},n.popFileQueue=function(){if(n.fileQueue.length>0){e.debug("[TransfertPromiseQueue] go to next file");var t=n.fileQueue.shift();n.currentId=t.id,n.currentQueue=t.promiseArray,n.promiseCompletion=t.promiseCompletion,n.promiseReject=t.promiseReject,n.initialQueueSize=n.currentQueue.length,n.promisesDone=0,n.chunkErrorCounter=0,n.currentPromise=[];for(var r=0;r<10&&n.currentQueue.length>0;r++)n.currentPromise.push(n.currentQueue.shift()());n.execute()}else e.debug("[TransfertPromiseQueue] no more file to transfert"),n.clearContext()},n.execute=function(){e.debug("[TransfertPromiseQueue] execute"),n.currentPromise?t.all(n.currentPromise).then((function(){if(e.debug("[TransfertPromiseQueue] promise success go to next one"),n.chunkErrorCounter=0,0===n.currentQueue.length)n.promiseCompletion&&n.promiseCompletion(),n.popFileQueue();else{n.currentPromise=[];for(var t=0;t<10&&n.currentQueue.length>0;t++)n.currentPromise.push(n.currentQueue.shift()());n.execute()}})).catch((function(t){var r=t&&t.message?t.message:"Unknown error";if(e.error("[TransfertPromiseQueue] failure executing promise -- "+r),n.chunkErrorCounter++,t&&t.errorDetailsCode>=500&&n.chunkErrorCounter<=3&&n.currentPromise){var i=n.currentPromise;n.currentPromise=[],i.forEach((function(e){n.currentPromise.push(e())})),n.execute()}else e.error("[TransfertPromiseQueue] 3 chunk failed - ABORT File Upload"),n.promiseReject(t),n.popFileQueue()})):(e.debug("[TransfertPromiseQueue] no promise to perform"),n.currentPromise=void 0)},n.isTransferInProgress=function(){return e.debug("[TransfertPromiseQueue] >isTransferInProgress: "+n.fileQueue.length+"/"+n.currentQueue.length),n.fileQueue.length>0||n.currentQueue.length>0||n.currentPromise},n.cancelAllTransfers=function(){e.debug("[TransfertPromiseQueue] cancelAllTransfers"),n.fileQueue=[],n.currentQueue=[]},n.cancelCurrentFiletransfer=function(t){if(e.debug("[TransfertPromiseQueue] cancelCurrentFiletransfer"),n.currentId===t)e.debug("[TransfertPromiseQueue] cancelling current promise"),n.popFileQueue();else{var r=n.fileQueue.find((function(e){return e.id===t}));if(r){var i=n.fileQueue.indexOf(r);e.debug("[TransfertPromiseQueue] promise to remove at position="+i),n.fileQueue.splice(i,1)}}}}return n.create=function(){return e.debug("[TransfertPromiseQueue] >create"),new n},n}])},function(e,t,n){n.r(t),window.sdk=angular.module("sdk",["pascalprecht.translate","ngSanitize","ngFileSaver","rainbow","rainbowAdmin"],(function(){})),t.default={sdk:sdk}},function(e,t,n){n.r(t);var r=n(39);sdk.remoteConsole={debug:!1,log:!1,info:!1,warn:!1,error:!1},sdk.hasVerboseLog=!1,sdk.hasBeenLaunchedFromConfig=!1,sdk.key={appID:"",appSecret:"",host:"openrainbow.com"},sdk.config(["consoleLogsProvider","$provide","$httpProvider","$translateProvider",function(e,t,n,i){var a=function(e){return e.toDateString()+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)};t.decorator("$log",["$delegate",function(t){var n=t.debug;t.debug=function(){var t=[].slice.call(arguments);sdk.remoteConsole.debug&&console.re.debug(t[0]),r.sdkConfig.verboseLog&&n.apply(null,t),e.setLogs(["["+a(new Date)+"]"]+"debug : "+t+"\n")};var i=t.log;t.log=function(){var t=[].slice.call(arguments);sdk.remoteConsole.log&&console.re.log(t[0]),r.sdkConfig.verboseLog&&i.apply(null,t),e.setLogs(["["+a(new Date)+"]"]+"log : "+t+"\n")};var o=t.info;t.info=function(){var t=[].slice.call(arguments);sdk.remoteConsole.info&&console.re.info(t[0]),r.sdkConfig.verboseLog&&o.apply(null,t),e.setLogs(["["+a(new Date)+"]"]+"info : "+t+"\n")};var s=t.warn;t.warn=function(){var t=[].slice.call(arguments);sdk.remoteConsole.warn&&console.re.warn(t[0]),s.apply(null,t),e.setLogs(["["+a(new Date)+"]"]+"warn : "+t+"\n")};var c=t.error;return t.error=function(){var t=[].slice.call(arguments);sdk.remoteConsole.error&&console.re.error(t[0]),c.apply(null,t),e.setLogs(["["+a(new Date)+"]"]+"error : "+t+"\n")},t.webrtc=function(){var t=[].slice.call(arguments),r="rtcweb : "+t[0];t[0]="%c "+a(new Date)+" | RTCWEB | "+t[0],t[t.length]="color:green",sdk.remoteConsole.log&&console.re.log(t[0]),n.apply(null,t),e.setLogs(["["+a(new Date)+"]"]+r+"\n")},t.sdk=function(){var t=[].slice.call(arguments),r="RBW-SDK : "+t[0];t[0]="%c "+a(new Date)+" | RBW-SDK | "+t[0],t[t.length]="color:green",sdk.remoteConsole.log&&console.re.log(t[0]),n.apply(null,t),e.setLogs(["["+a(new Date)+"]"]+r+"\n")},t}]),n.defaults.useXDomain=!0,i.useSanitizeValueStrategy(null)}]),sdk.run([function(){}]),sdk.provider("consoleLogs",[function(){this.logsBuffer=[],this.logsMaxLength=2e6,this.$get=function(){var e=this.logsBuffer;return{getLogs:function(){return e}}},this.cleanBuffer=function(){this.logsBuffer.length>this.logsMaxLength&&(this.logsBuffer=this.logsBuffer.slice(-this.logsMaxLength))},this.setLogs=function(e){1e3===this.logsBuffer&&this.logsBuffer.shift(),this.logsBuffer.push(e)}}])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(31),i=function(){function e(t,n,r,i,a,o,s,c,l,u,d){var h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null;S(this,e),this.id=t,this.invitedUserId=n,this.invitedUserEmail=r,this.invitedPhoneNumber=h,this.invitingUserId=i,this.invitingUserEmail=a,this.requestNotificationLanguage=o,this.invitingDate=s,this.lastNotificationDate=c,this.status=l,this.type=u,this.defaultAvatar=null,this.inviteToJoinMeeting=d}return C(e,[{key:"createDefaultAvatar",value:function(){if(!this.defaultAvatar&&this.invitedUserEmail){var e=r.default.computeUserColor(this.invitedUserEmail),t=this.invitedUserEmail.substring(0,2).toUpperCase();this.defaultAvatar=r.default.createDefaultAvatarImage(t,e)}}}],[{key:"create",value:function(t,n,r,i,a,o,s,c,l,u,d){return new e(t,n,r,i,a,o,s,c,l,u,d)}},{key:"createFromData",value:function(t){var n=new e(t.id,t.invitedUserId,t.invitedUserEmail,t.invitingUserId,t.invitingUserEmail,t.requestNotificationLanguage,t.invitingDate,t.lastNotificationDate,t.status,t.type,t.inviteToJoinMeeting,t.invitedPhoneNumber);return n.createDefaultAvatar(),n}}]),e}();t.Invitation=i},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),a=n(32),o=n(19),s=n(18),c=n(2),l=n(26),u=n(31),d=n(6),h=n(1),f=function(){function e(){S(this,e),this.isOffice365AdSearchAllowed=!1,this.isOffice365ContactSearchAllowed=!1,this.url=config.restServerUrl+"/api/rainbow/office365/v1.0/users",this.companies={},this.eventService=a.default,this.logger=i.default,this.authService=c.default,this.mainService=l.default,this.userInfoService=u.default,this.profileService=d.default,this.contactService=h.default,this.isOffice365AdSearchAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_DIRECTORY_SEARCH),this.isOffice365ContactSearchAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_CONTACT_SEARCH)}return C(e,[{key:"search",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_CONTACT_SEARCH)){t.next=2;break}return t.abrupt("return",[]);case 2:if(this.logger.info("search office365 Contact from Ad with pattern "+e),t.prev=3,n=this.authService.getPostHeader(),!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.SEARCH_BY_TAGS)){t.next=11;break}return t.next=8,fetch(this.url+"/search",{method:"POST",mode:"cors",headers:n,body:JSON.stringify({search:e,includeContacts:this.isOffice365ContactSearchAllowed})});case 8:t.t0=t.sent,t.next=14;break;case 11:return t.next=13,fetch(this.url+"/search",{method:"POST",mode:"cors",headers:n,body:JSON.stringify({name:e,includeContacts:this.isOffice365ContactSearchAllowed})});case 13:t.t0=t.sent;case 14:return r=t.t0,t.next=17,r.json();case 17:return i=t.sent.data,t.abrupt("return",i.map((function(e){var t=a.contactService.createBasicContact(e.oid,null,!1);return a.updateContactWithData(t,e),t})));case 21:return t.prev=21,t.t1=t.catch(3),t.abrupt("return",(this.logger.error("search office365 Contact from Ad with pattern ".concat(e," --- FAILURE --- ").concat(t.t1.message)),[]));case 24:case"end":return t.stop()}}),t,this,[[3,21]])})))}},{key:"searchCompanies",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isOffice365AdSearchAllowed){t.next=2;break}return t.abrupt("return",[]);case 2:return this.logger.info("search office365 Company from Ad with pattern "+e),t.prev=3,n=this.authService.getPostHeader(),t.next=7,fetch(this.url+"/search",{method:"POST",mode:"cors",headers:n,body:JSON.stringify({companyName:e,includeContacts:!1})});case 7:return r=t.sent,t.next=10,r.json();case 10:return i=t.sent.data,t.abrupt("return",i.map((function(e){var t=o.Company.create(e.oid,e.companyName);return a.getCompanyLogo(t),a.getCompanyBanner(t),a.companies[t.id]=t,t})));case 14:return t.prev=14,t.t0=t.catch(3),t.abrupt("return",(this.logger.error("search office365 Company from Ad with pattern ".concat(e," --- FAILURE --- ").concat(t.t0.message)),[]));case 17:case"end":return t.stop()}}),t,this,[[3,14]])})))}},{key:"getCompanyLogo",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=this.userInfoService.computeUserColor(e.name),r=e.name.substr(0,1),t.abrupt("return",(e.logo=this.userInfoService.getAvatarImage(e.id,r,n.color,130,e.lastAvatarUpdateDate),this.eventService.publish("ON_COMPANY_LOGO_UPDATED",e.id),this.logger.info("[getCompanyLogo] - "+e.getNameForLogs()+" - success"),e.sendChangeEvent("logo"),e));case 5:throw t.prev=5,t.t0=t.catch(0),new Error("getCompanyLogo -- FAILURE -- "+t.t0.message);case 8:case"end":return t.stop()}}),t,this,[[0,5]])})))}},{key:"getCompanyBanner",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n=this;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r=new Image;r.onload=function(){e.banner=r,n.eventService.publish("ON_COMPANY_BANNER_UPDATED",e.id),n.logger.info("[getCompanyBanner] - "+e.getNameForLogs()+" - success"),t(e)},r.onerror=function(){n.logger.error("[companyService] Load banner for "+e.getNameForLogs()+" failure"),t(e)};var i="/cacheV2/images/company-banner-01.svg";if(e.lastBannerUpdateDate){var a=config.webservices.protocol+"://"+config.webservices.currentServer;n.mainService.cdn&&(a=n.mainService.cdnServer),i=a+"/api/banner/"+e.id+"?size=831",i+="&update="+s.MD5(s.CryptoJSEnc.Latin1.parse(e.lastBannerUpdateDate)).toString(s.CryptoJSEnc.Hex)}r.src=i})));case 1:case"end":return t.stop()}}),t)})))}},{key:"getCompanyById",value:function(e){if(!e)throw new Error("missing companyId");var t=this.companies[e];return this.logger.info("[office365adService] getCompanyById (cache) "+e+" - success"),t}},{key:"getUserDetails",value:function(e){return r(this,void 0,void 0,b.a.mark((function t(){var n,r,i,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isOffice365AdSearchAllowed||!e.o365Flag){t.next=19;break}return this.logger.info("getUserDetails for "+e.oid),t.prev=2,n=this.authService.getRequestHeader(),r="".concat(this.url,"/details/").concat(encodeURIComponent(e.id)),t.next=7,fetch(r,{method:"GET",mode:"cors",headers:n});case 7:if((i=t.sent).ok){t.next=10;break}throw this.logger.debug("Request ".concat(i.headers.get("x-rainbow-request-id")," failed with status ").concat(i.status)),new Error(i.statusText);case 10:return t.next=12,i.json();case 12:a=t.sent,this.updateContactWithOffice365Data(e,a),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(2),this.logger.error("getUserDetails -- FAILURE -- "+t.t0.message);case 19:case"end":return t.stop()}}),t,this,[[2,16]])})))}},{key:"updateContactWithData",value:function(e,t){e.o365Flag=!0,e.updateName(t.firstName,t.lastName),e.companyName=this.contactService.userContact.company.name,e.jobTitle=t.jobTitle,e.department=t.department,e.webAddress=t.mySite,e.mobilePhones=t.mobilePhonesE164,e.businessPhones=t.businessPhonesE164,e.email=t.mail,e.isContact=t.isContact}},{key:"updateContactWithOffice365Data",value:function(e,t){e.o365Flag=!0,e.updateName(t.givenName,t.surname),e.companyName=this.contactService.userContact.company.name,e.jobTitle=t.jobTitle,e.department=t.department,e.webAddress=t.mySite,e.email=t.mail,e.isContact?(e.street=t.addresses[0]&&t.addresses[0].street?t.addresses[0].street:"",e.city=t.addresses[0]&&t.addresses[0].city?t.addresses[0].city:"",e.country=t.addresses[0]&&t.addresses[0].countryOrRegion?t.addresses[0].countryOrRegion:"",e.postCode=t.addresses[0]&&t.addresses[0].postalCode?t.addresses[0].postalCode:"",e.state=t.addresses[0]&&t.addresses[0].state?t.addresses[0].state:""):(e.street=t.streetAddress,e.city=t.city,e.country=t.country,e.postCode=t.postalCode,e.state=t.state)}}],[{key:"getInstance",value:function(){var t=window;return t.rainbow||(t.rainbow={}),t.rainbow.office365AdService||(t.rainbow.office365AdService=new e),t.rainbow.office365AdService}}]),e}();t.Office365AdService=f,t.default=f.getInstance()},function(e,t){Strophe.addNamespace("RSM","http://jabber.org/protocol/rsm"),Strophe.RSM=function(e){if(this.attribs=["max","first","last","after","before","index","count"],void 0!==e.xml)this.fromXMLElement(e.xml);else for(var t=0;t<this.attribs.length;t++){var n=this.attribs[t];this[n]=e[n]}},Strophe.RSM.prototype={toXML:function(){for(var e=$build("set",{xmlns:Strophe.NS.RSM}),t=0;t<this.attribs.length;t++){var n=this.attribs[t];void 0!==this[n]&&(e=e.c(n).t(this[n].toString()).up())}return e.tree()},next:function(e){return new Strophe.RSM({max:e,after:this.last})},previous:function(e){return new Strophe.RSM({max:e,before:this.first})},fromXMLElement:function(e){for(var t=0;t<this.attribs.length;t++){var n=this.attribs[t],r=e.getElementsByTagName(n)[0];null!=r&&(this[n]=Strophe.getText(r),"first"==n&&(this.index=r.getAttribute("index")))}}}},function(e,t){Strophe.addConnectionPlugin("ping",{_c:null,init:function(e){this._c=e,Strophe.addNamespace("PING","urn:xmpp:ping")},ping:function(e,t,n,r){var i=this._c.getUniqueId("ping"),a=$iq({type:"get",to:e,id:i}).c("ping",{xmlns:Strophe.NS.PING});this._c.sendIQ(a,t,n,r)},pong:function(e){var t=e.getAttribute("from"),n=e.getAttribute("id"),r=$iq({type:"result",to:t,id:n});this._c.sendIQ(r)},addPingHandler:function(e){return this._c.addHandler(e,Strophe.NS.PING,"iq","get")}})},function(e,t){Strophe.addConnectionPlugin("lastactivity",{_c:null,_n:0,init:function(e){this._c=e,Strophe.addNamespace("LAST_ACTIVITY","jabber:iq:last")},query:function(e,t){var n={type:"get",id:"lastActivityId"+this._n++,from:this._c.jid,to:e},r={xmlns:Strophe.NS.LAST_ACTIVITY},i=$iq(n).c("query",r),a=t.onResponse;return delete t.onResponse,this._c.addHandler(null,Strophe.NS.LAST_ACTIVITY,"message",null),this._c.sendIQ(i,a)}})},function(e,t,n){n.r(t);var r=n(9);Strophe.addConnectionPlugin("jingle",{connection:null,sessions:{},jid2session:{},ice_config:{iceServers:[]},company_config:{},pc_constraints:{rtcpMuxPolicy:"require",bundlePolicy:"max-bundle"},media_constraints:{},localStream:null,connectionRef:null,jingleIqTimeout:15e3,init:function(e){for(var t in this.connection=e,this.connection.disco&&(this.connection.disco.addFeature("urn:xmpp:jingle:1"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.connection.disco.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:video"),this.connection.disco.addFeature("urn:ietf:rfc:5761")),this.connectionRef&&(this.connection.deleteHandler(this.connectionRef),this.connectionRef=null),config&&config.jingleIqTimeout?this.jingleIqTimeout=config.jingleIqTimeout:this.jingleIqTimeout=15e3,this.connectionRef=this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null),this.sessions)if(this.sessions.hasOwnProperty(t)){var n=this.sessions[t];n.connection=this.connection,null!==n.statsinterval&&(window.clearInterval(n.statsinterval),n.statsinterval=null)}},attachHandlers:function(){this.connectionRef&&(this.connection.deleteHandler(this.connectionRef),this.connectionRef=null),this.connectionRef=this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null)},onJingle:function(e){r.rainbowLogger.sdk("[Strophe.jingle] onJingle");try{var t=$(e).find("jingle").attr("sid"),n=$(e).find("jingle").attr("action"),i=$iq({type:"result",to:e.getAttribute("from"),id:e.getAttribute("id")}),a=this.sessions[t];if("session-initiate"!=n){if(null==a)return i.type="error",i.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(i),$(document).trigger("callterminated.jingle",[t]),!0;if(Strophe.getBareJidFromJid(e.getAttribute("from"))!=Strophe.getBareJidFromJid(a.peerjid))return console.warn("[Strophe.jingle] jid mismatch for session id",t,e.getAttribute("from"),a.peerjid),i.type="error",i.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(i),!0}else if(void 0!==a)return i.type="error",i.c("error",{type:"cancel"}).c("service-unavailable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up(),console.warn("[Strophe.jingle] duplicate session id",t),this.connection.send(i),!0;switch("transport-replace"!==n&&this.connection.send(i),n){case"session-initiate":var o=$(e).find("jingle").attr("localType");r.rainbowLogger.sdk("REMOTE TYPE || "+o),(a=new JingleSession($(e).attr("to"),$(e).find("jingle").attr("sid"),this.connection,this.jingleIqTimeout)).media_constraints=this.media_constraints,a.pc_constraints=this.pc_constraints,a.ice_config=this.ice_config,a.company_config=this.company_config,this.jid2session[$(e).attr("from")]&&this.jid2session[$(e).attr("from")].unifiedPlan&&(a.unifiedPlanActivated=!0),a.initiate($(e).attr("from"),!1),a.remoteType=o,a.confId=$(e).find("jingle").attr("confId"),a.publisherId=$(e).find("conference").attr("publisherId");var s=$(e).find("conference").attr("id");s&&(a.conference_id=s),a.setRemoteDescription($(e).find(">jingle"),"offer"),this.sessions[a.sid]=a,this.jid2session[a.peerjid]=a,$(document).trigger("callincoming.jingle",[a.sid]);break;case"transport-replace":a.isReconnecting=!0,r.rainbowLogger.sdk("[strophe jingle] Transport replace"),o=$(e).find("jingle").attr("localType"),r.rainbowLogger.sdk("REMOTE TYPE || "+o),a.media_constraints=this.media_constraints,a.pc_constraints=this.pc_constraints,a.ice_config=this.ice_config,a.company_config=this.company_config,a.remoteType=o,this.sessions[a.sid]=a,this.jid2session[a.peerjid]=a,a.hasSentTransportReplace?(r.rainbowLogger.sdk("[strophe jingle] Transport replace -- put on hold"),a.saveIncomingTransportReplace($(e).find(">jingle"),"offer",i)):(r.rainbowLogger.sdk("[strophe jingle] Transport replace is accepted"),this.connection.send(i),a.setRemoteDescription($(e).find(">jingle"),"offer"),$(document).trigger("transportreplace.jingle",[a.sid]));break;case"session-accept":a.setRemoteDescription($(e).find(">jingle"),"answer"),o=$(e).find(">jingle").attr("localType"),a.remoteType=o,r.rainbowLogger.sdk("REMOTE TYPE || session-accept remoteType "+a.remoteType),r.rainbowLogger.sdk("REMOTE TYPE || session-accept localType "+a.localType),a.accept(),$(document).trigger("callaccepted.jingle",[a.sid]);break;case"transport-accept":a.setRemoteDescription($(e).find(">jingle"),"answer"),a.isReconnecting=!1,o=$(e).find(">jingle").attr("localType"),a.remoteType=o,r.rainbowLogger.sdk("REMOTE TYPE || transport-accept remoteType "+a.remoteType),r.rainbowLogger.sdk("REMOTE TYPE || transport-accept localType "+a.localType),$(document).trigger("callaccepted.jingle",[a.sid]);break;case"session-terminate":a.terminate(),this.terminate(a.sid),$(e).find(">jingle>conference").length&&$(e).find(">jingle>conference").attr("reason")?$(document).trigger("callterminated.jingle",[a.sid,"multi-device"]):$(e).find(">jingle>reason").length?$(document).trigger("callterminated.jingle",[a.sid,$(e).find(">jingle>reason>:first")[0].tagName,$(e).find(">jingle>reason>text").text()]):$(document).trigger("callterminated.jingle",[a.sid]);break;case"transport-info":r.rainbowLogger.sdk("[JINGLE] transport-info"),a.addIceCandidate($(e).find(">jingle>content"));break;case"session-info":var c;$(e).find('>jingle>ringing[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?$(document).trigger("ringing.jingle",[a.sid]):$(e).find('>jingle>mute[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?(c=$(e).find('>jingle>mute[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("name"),$(document).trigger("mute.jingle",[a.sid,c])):$(e).find('>jingle>unmute[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?(c=$(e).find('>jingle>unmute[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("name"),$(document).trigger("unmute.jingle",[a.sid,c])):$(e).find('>jingle>iceFailed[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?$(document).trigger("remoteIceFailed.jingle",[a.sid]):$(e).find('>jingle>hold[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?$(document).trigger("hold.jingle",[a.sid]):$(e).find('>jingle>unhold[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length&&$(document).trigger("unhold.jingle",[a.sid]);break;case"content-add":r.rainbowLogger.sdk("[Strophe Jingle] Content-add");var l=$(e).find(">jingle").attr("mediaType");a.remoteType=l,r.rainbowLogger.sdk("REMOTE TYPE || content-add remoteType "+a.remoteType),r.rainbowLogger.sdk("REMOTE TYPE || content-add localType "+a.localType),a.setRemoteDescription($(e).find(">jingle"),"offer"),a.mediaModified(),$(document).trigger("mediamodified.jingle",[a.sid,l]);break;case"content-modify":r.rainbowLogger.sdk("[Strophe Jingle] Content-modify"),l=$(e).find(">jingle").attr("mediaType"),a.remoteType=l,r.rainbowLogger.sdk("REMOTE TYPE || content-modify remoteType "+a.remoteType),r.rainbowLogger.sdk("REMOTE TYPE || content-modify localType "+a.localType),a.setRemoteDescription($(e).find(">jingle"),"offer"),a.mediaModified(),$(document).trigger("mediamodified.jingle",[a.sid,l]);break;case"content-remove":r.rainbowLogger.sdk("[Strophe Jingle] Content-remove"),l=$(e).find(">jingle").attr("mediaType"),a.remoteType=l,a.setRemoteDescription($(e).find(">jingle"),"offer"),a.mediaModified(!0),$(document).trigger("mediamodified.jingle",[a.sid,l]);break;case"content-accept":r.rainbowLogger.sdk("[Strophe Jingle] Content-accept"),a.setRemoteDescription($(e).find(">jingle"),"answer");break;case"addsource":a.addSource($(e).find(">jingle>content"));break;case"removesource":a.removeSource($(e).find(">jingle>content"));break;default:console.warn("[Strophe.jingle] jingle action not implemented",n)}}catch(u){return console.error("[Strophe.jingle] On Jingle error catch: "+u),!0}return!0},initiate:function(e,t,n,r,i,a,o,s){var c=i||Math.random().toString(36).substr(2,12),l=new JingleSession(t||this.connection.jid,c,this.connection,this.jingleIqTimeout);if(r&&r.length)for(var u=0;u<r.length;u++)l.localStreams.push(r[u]);return l.media_constraints=this.media_constraints,l.ice_config=this.ice_config,l.company_config=this.company_config,n&&(l.localType=n),void 0!==a&&(l.conference_id=a),l.calledNumber=o&&""!==o?o:null,s&&(l.unifiedPlanActivated=!0),l.initiate(e,!0),this.sessions[l.sid]=l,this.jid2session[l.peerjid]=l,l.sendOffer(!0),l},terminate:function(e,t,n){if(null==e)for(e in this.sessions)"ended"!=this.sessions[e].state&&(this.sessions[e].sendTerminate(t||(this.sessions[e].active()?null:"cancel"),n),this.sessions[e].terminate()),delete this.jid2session[this.sessions[e].peerjid],delete this.sessions[e];else this.sessions.hasOwnProperty(e)&&("ended"!=this.sessions[e].state&&(this.sessions[e].sendTerminate(t||(this.sessions[e].active()?null:"cancel"),n),this.sessions[e].terminate()),delete this.jid2session[this.sessions[e].peerjid],delete this.sessions[e])},terminateByJid:function(e){if(this.jid2session.hasOwnProperty(e)){var t=this.jid2session[e];t&&(t.terminate(),delete this.sessions[t.sid],delete this.jid2session[e],$(document).trigger("callterminated.jingle",[t.sid,"gone"]))}}})},function(e,t,n){n.r(t);var r=n(9);window.SDP=function(e){this.media=e.split("\r\nm=");for(var t=1;t<this.media.length;t++)this.media[t]="m="+this.media[t],t!=this.media.length-1&&(this.media[t]+="\r\n");this.session=this.media.shift()+"\r\n",this.raw=this.session+this.media.join("")},SDP.prototype.mangle=function(){var e,t,n,r,i,a;for(e=0;e<this.media.length;e++)if((r=this.media[e].split("\r\n")).pop(),"audio"==(n=SDPUtil.parse_mline(r.shift())).media){for(a="",n.fmt.length=0,t=0;t<r.length;t++)if("a=rtpmap:"==r[t].substr(0,9)){if("CN"==(i=SDPUtil.parse_rtpmap(r[t])).name||"ISAC"==i.name)continue;n.fmt.push(i.id),a+=r[t]+"\r\n"}else a+=r[t]+"\r\n";this.media[e]=SDPUtil.build_mline(n)+"\r\n",this.media[e]+=a}this.raw=this.session+this.media.join("")},SDP.prototype.removeSessionLines=function(e){var t=this,n=SDPUtil.find_lines(this.session,e);return n.forEach((function(e){t.session=t.session.replace(e+"\r\n","")})),this.raw=this.session+this.media.join(""),n},SDP.prototype.removeMediaLines=function(e,t){var n=this,r=SDPUtil.find_lines(this.media[e],t);return r.forEach((function(t){n.media[e]=n.media[e].replace(t+"\r\n","")})),this.raw=this.session+this.media.join(""),r},SDP.prototype.toJingle=function(e,t,n){var r,i,a,o,s,c,l,u,d;if(SDPUtil.find_line(this.session,"a=group:"))for(u=SDPUtil.find_lines(this.session,"a=group:"),r=0;r<u.length;r++){var h=(l=u[r].split(" ")).shift().substr(8);for(e.c("group",{xmlns:"urn:xmpp:jingle:apps:grouping:0",semantics:h}),i=0;i<l.length;i++)e.c("content",{name:l[i]}).up();e.up()}for(SDPUtil.find_line(this.session,"a=group:BUNDLE")&&SDPUtil.find_line(this.session,"a=group:BUNDLE ").split(" ").shift(),r=0;r<this.media.length;r++)if("audio"==(o=SDPUtil.parse_mline(this.media[r].split("\r\n")[0])).media||"video"==o.media){if(s=!!SDPUtil.find_line(this.media[r],"a=ssrc:")&&SDPUtil.find_line(this.media[r],"a=ssrc:").substring(7).split(" ")[0],d=!!SDPUtil.find_line(this.media[r],"a=simulcast:")&&SDPUtil.find_line(this.media[r],"a=simulcast:").substring(12).trim(),e.c("content",{creator:t,name:o.media}),SDPUtil.find_line(this.media[r],"a=mid:")){var f=SDPUtil.parse_mid(SDPUtil.find_line(this.media[r],"a=mid:"));e.attrs({name:f})}if(SDPUtil.find_line(this.media[r],"a=rtpmap:").length){for(e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:o.media}),s&&e.attrs({ssrc:s}),i=0;i<o.fmt.length;i++){if(c=SDPUtil.find_line(this.media[r],"a=rtpmap:"+o.fmt[i]),e.c("payload-type",SDPUtil.parse_rtpmap(c)),SDPUtil.find_line(this.media[r],"a=fmtp:"+o.fmt[i]))for(l=SDPUtil.parse_fmtp(SDPUtil.find_line(this.media[r],"a=fmtp:"+o.fmt[i])),a=0;a<l.length;a++)e.c("parameter",l[a]).up();this.RtcpFbToJingle(r,e,o.fmt[i]),e.up()}if(SDPUtil.find_line(this.media[r],"a=crypto:",this.session)&&(e.c("encryption",{required:1}),SDPUtil.find_lines(this.media[r],"a=crypto:",this.session).forEach((function(t){e.c("crypto",SDPUtil.parse_crypto(t)).up()})),e.up()),s&&(e.c("source",{ssrc:s,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),SDPUtil.find_lines(this.media[r],"a=ssrc:").forEach((function(t){idx=t.indexOf(" ");var n=t.substr(0,idx).substr(7);n!=s&&(e.up(),s=n,e.c("source",{ssrc:s,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}));var r=t.substr(idx+1);e.c("parameter"),-1==r.indexOf(":")?e.attrs({name:r}):(e.attrs({name:r.split(":",2)[0]}),e.attrs({value:r.split(":",2)[1]})),e.up()})),e.up()),d&&(e.c("simulcast",{rids:d,xmlns:"urn:xmpp:jingle:apps:rtp:sim:0"}),SDPUtil.find_lines(this.media[r],"a=rid:").forEach((function(t){var n=t.indexOf(" "),r=t.substr(0,n).substr(6);e.c("rid",{xmlns:"urn:xmpp:jingle:apps:rtp:rid:0",name:r}),e.up()})),e.up()),SDPUtil.find_lines(this.media[r],"a=ssrc-group").forEach((function(t){var n=t.indexOf(" "),r=t.substr(0,n).substr(13);e.c("ssrc-group",{xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0",semantics:r});for(var i=t.substr(n+1);i.length>0;){var a;(n=i.indexOf(" "))>0?(a=i.substr(0,n),i=i.substr(n+1)):(a=i.substr(0,i.length),i=""),e.c("source",{ssrc:a}).up()}e.up()})),SDPUtil.find_line(this.media[r],"a=rtcp-mux")&&e.c("rtcp-mux").up(),this.RtcpFbToJingle(r,e,"*"),SDPUtil.find_line(this.media[r],"a=extmap:"))for(u=SDPUtil.find_lines(this.media[r],"a=extmap:"),i=0;i<u.length;i++){if(l=SDPUtil.parse_extmap(u[i]),e.c("rtp-hdrext",{xmlns:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",uri:l.uri,id:l.value}),l.hasOwnProperty("direction"))switch(l.direction){case"sendonly":e.attrs({senders:"responder"});break;case"recvonly":e.attrs({senders:"initiator"});break;case"sendrecv":e.attrs({senders:"both"});break;case"inactive":e.attrs({senders:"none"})}e.up()}e.up()}this.TransportToJingle(r,e),SDPUtil.find_line(this.media[r],"a=sendrecv",this.session)?e.attrs({senders:"both"}):SDPUtil.find_line(this.media[r],"a=sendonly",this.session)?e.attrs({senders:"initiator"}):SDPUtil.find_line(this.media[r],"a=recvonly",this.session)?e.attrs({senders:"responder"}):SDPUtil.find_line(this.media[r],"a=inactive",this.session)&&e.attrs({senders:"none"}),"0"!=o.port||SDPUtil.find_line(this.media[r],"a=bundle-only",this.session)||e.attrs({senders:"rejected"}),e.up()}return n&&-1!==n&&(e.c("conference",{xmlns:"urn:xmpp:janus:1",id:n}),e.up()),e.up(),e},SDP.prototype.TransportToJingle=function(e,t){var n,r=this;t.c("transport"),SDPUtil.find_lines(this.media[e],"a=fingerprint:",this.session).forEach((function(i){(n=SDPUtil.parse_fingerprint(i)).xmlns="urn:xmpp:jingle:apps:dtls:0",t.c("fingerprint").t(n.fingerprint),delete n.fingerprint,(i=SDPUtil.find_line(r.media[e],"a=setup:",r.session))&&(n.setup=i.substr(8)),t.attrs(n),t.up()})),(n=SDPUtil.iceparams(this.media[e],this.session))&&(n.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.attrs(n),SDPUtil.find_line(this.media[e],"a=candidate:",this.session))&&SDPUtil.find_lines(this.media[e],"a=candidate:",this.session).forEach((function(e){t.c("candidate",SDPUtil.candidateToJingle(e)).up()})),t.up()},SDP.prototype.RtcpFbToJingle=function(e,t,n){SDPUtil.find_lines(this.media[e],"a=rtcp-fb:"+n).forEach((function(e){var n=SDPUtil.parse_rtcpfb(e);"trr-int"==n.type?(t.c("rtcp-fb-trr-int",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",value:n.params[0]}),t.up()):(t.c("rtcp-fb",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",type:n.type}),n.params.length>0&&t.attrs({subtype:n.params[0]}),t.up())}))},SDP.prototype.RtcpFbFromJingle=function(e,t){var n="",r=e.find('>rtcp-fb-trr-int[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]');return r.length&&(n+="a=rtcp-fb:* trr-int ",r.attr("value")?n+=r.attr("value"):n+="0",n+="\r\n"),(r=e.find('>rtcp-fb[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]')).each((function(){n+="a=rtcp-fb:"+t+" "+$(this).attr("type"),$(this).attr("subtype")&&(n+=" "+$(this).attr("subtype")),n+="\r\n"})),n},SDP.prototype.fromJingle=function(e){var t=this;if(this.raw="v=0\r\no=- 1923518516 2 IN IP4 0.0.0.0\r\ns=-\r\nt=0 0\r\n",$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]').length)$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]').each((function(e,n){var r=$(n).find(">content").map((function(e,t){return t.getAttribute("name")})).get();r.length>0&&(t.raw+="a=group:"+(n.getAttribute("semantics")||n.getAttribute("type"))+" "+r.join(" ")+"\r\n")}));else if($(e).find('>group[xmlns="urn:ietf:rfc:5888"]').length)$(e).find('>group[xmlns="urn:ietf:rfc:5888"]').each((function(e,n){var r=$(n).find(">content").map((function(e,t){return t.getAttribute("name")})).get();null!==n.getAttribute("type")&&r.length>0&&(t.raw+="a=group:"+n.getAttribute("type")+" "+r.join(" ")+"\r\n")}));else{var n=$(e).find(">content").filter((function(e,t){return $(t).find(">bundle").length>0})).map((function(e,t){return t.getAttribute("name")})).get();n.length&&(this.raw+="a=group:BUNDLE "+n.join(" ")+"\r\n")}this.raw+="a=ice-options:trickle\r\n",this.session=this.raw,e.find(">content").each((function(){var e=t.jingle2media($(this));t.media.push(e)}));var r=SDPUtil.parse_ssrc(this.raw);r.hasOwnProperty("mslabel")&&r.mslabel&&(this.session+="a=msid-semantic: WMS "+r.mslabel+"\r\n"),this.raw=this.session+this.media.join("")},SDP.prototype.jingle2media=function(e){var t,n="",r=e.find("description"),i=(r.attr("ssrc"),this);if((t={media:r.attr("media")}).port="1","rejected"==e.attr("senders")&&(t.port="0"),e.find(">transport>fingerprint").length||r.find("encryption").length?t.proto="RTP/SAVPF":t.proto="RTP/AVPF",t.fmt=r.find("payload-type").map((function(){return this.getAttribute("id")})).get(),n+=SDPUtil.build_mline(t)+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:1 IN IP4 0.0.0.0\r\n",(t=e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]')).length&&(t.attr("ufrag")&&(n+=SDPUtil.build_iceufrag(t.attr("ufrag"))+"\r\n"),t.attr("pwd")&&(n+=SDPUtil.build_icepwd(t.attr("pwd"))+"\r\n"),t.find(">fingerprint").each((function(){n+="a=fingerprint:"+this.getAttribute("hash"),n+=" "+$(this).text(),n+="\r\n",this.getAttribute("setup")&&(n+="a=setup:"+this.getAttribute("setup")+"\r\n")}))),(t=e.find('description>simulcast[xmlns="urn:xmpp:jingle:apps:rtp:sim:0"]')).length){var a=t.attr("rids");a&&(n+="a=simulcast: "+a+"\r\n"),t.find(">rid").each((function(){n+="a=rid:"+this.getAttribute("name")+" recv",n+="\r\n"}))}switch(e.attr("senders")){case"initiator":n+="a=sendonly\r\n";break;case"responder":n+="a=recvonly\r\n";break;case"none":n+="a=inactive\r\n";break;case"both":n+="a=sendrecv\r\n"}return n+="a=mid:"+e.attr("name")+"\r\n",r.find("rtcp-mux").length&&(n+="a=rtcp-mux\r\n"),r.find("encryption").length&&r.find("encryption>crypto").each((function(){n+="a=crypto:"+this.getAttribute("tag"),n+=" "+this.getAttribute("crypto-suite"),n+=" "+this.getAttribute("key-params"),this.getAttribute("session-params")&&(n+=" "+this.getAttribute("session-params")),n+="\r\n"})),r.find("payload-type").each((function(){n+=SDPUtil.build_rtpmap(this)+"\r\n",$(this).find(">parameter").length&&(n+="a=fmtp:"+this.getAttribute("id")+" ",n+=$(this).find("parameter").map((function(){return(this.getAttribute("name")?this.getAttribute("name")+"=":"")+this.getAttribute("value")})).get().join(";"),n+="\r\n"),n+=i.RtcpFbFromJingle($(this),this.getAttribute("id"))})),n+=i.RtcpFbFromJingle(r,"*"),(t=r.find('>rtp-hdrext[xmlns="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0"]')).each((function(){n+="a=extmap:"+this.getAttribute("id")+" "+this.getAttribute("uri")+"\r\n"})),e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]>candidate').each((function(){n+=SDPUtil.candidateFromJingle(this)})),(t=e.find('description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]')).each((function(){var e=this.getAttribute("ssrc");$(this).find(">parameter").each((function(){this.getAttribute("name")&&this.getAttribute("name").length&&this.getAttribute("value")&&this.getAttribute("value").length&&(n+="a=ssrc:"+e+" "+this.getAttribute("name")+":"+this.getAttribute("value")),n+="\r\n"}))})),(t=e.find('description>ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]')).each((function(){var e=this.getAttribute("semantics");n+="a=ssrc-group:"+e,$(this).find(">source").each((function(){n+=" "+this.getAttribute("ssrc")})),n+="\r\n"})),n},window.SDPUtil={iceparams:function(e,t){var n=null;return SDPUtil.find_line(e,"a=ice-ufrag:",t)&&SDPUtil.find_line(e,"a=ice-pwd:",t)&&(n={ufrag:SDPUtil.parse_iceufrag(SDPUtil.find_line(e,"a=ice-ufrag:",t)),pwd:SDPUtil.parse_icepwd(SDPUtil.find_line(e,"a=ice-pwd:",t))}),n},parse_iceufrag:function(e){return e.substring(12)},build_iceufrag:function(e){return"a=ice-ufrag:"+e},parse_icepwd:function(e){return e.substring(10)},build_icepwd:function(e){return"a=ice-pwd:"+e},parse_mid:function(e){return e.substring(6)},parse_mline:function(e){var t=e.substring(2).split(" "),n={};return n.media=t.shift(),n.port=t.shift(),n.proto=t.shift(),""===t[t.length-1]&&t.pop(),n.fmt=t,n},build_mline:function(e){return"m="+e.media+" "+e.port+" "+e.proto+" "+e.fmt.join(" ")},parse_rtpmap:function(e){var t=e.substring(9).split(" "),n={};return n.id=t.shift(),t=t[0].split("/"),n.name=t.shift(),n.clockrate=t.shift(),n.channels=t.length?t.shift():"1",n},build_rtpmap:function(e){var t="a=rtpmap:"+e.getAttribute("id")+" "+e.getAttribute("name")+"/"+e.getAttribute("clockrate");return e.getAttribute("channels")&&"1"!=e.getAttribute("channels")&&(t+="/"+e.getAttribute("channels")),t},parse_simulcast:function(e){var t=e.substr(13).split(" "),n={};return n.direction=t.shift(),n.rid=t.shift().substr(4),n},parse_crypto:function(e){var t=e.substring(9).split(" "),n={};return n.tag=t.shift(),n["crypto-suite"]=t.shift(),n["key-params"]=t.shift(),t.length&&(n["session-params"]=t.join(" ")),n},parse_fingerprint:function(e){var t=e.substring(14).split(" "),n={};return n.hash=t.shift(),n.fingerprint=t.shift(),n},parse_fmtp:function(e){var t,n,r,i=e.split(" "),a=[];for(i.shift(),i=i.join(" ").split(";"),t=0;t<i.length;t++){for(n=i[t].split("=")[0];n.length&&" "==n[0];)n=n.substring(1);r=i[t].split("=")[1],n&&r?a.push({name:n,value:r}):n&&a.push({name:"",value:n})}return a},parse_icecandidate:function(e){r.rainbowLogger.sdk("[Strophe.jingle] jingle.sdp.parse_icecandidate "+e);var t={},n=e.split(" ");t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation=0;for(var i=8;i<n.length;i+=2)switch(n[i]){case"raddr":t["rel-addr"]=n[i+1];break;case"rport":t["rel-port"]=n[i+1];break;case"generation":t.generation=n[i+1];break;case"tcptype":t.tcptype=n[i+1];break;default:r.rainbowLogger.sdk('[Strophe.jingle] parse_icecandidate not translating "'+n[i]+'" = "'+n[i+1]+'"')}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},build_icecandidate:function(e){var t=["a=candidate:"+e.foundation,e.component,e.protocol,e.priority,e.ip,e.port,"typ",e.type].join(" ");switch(t+=" ",e.type){case"srflx":case"prflx":case"relay":e.hasOwnAttribute("rel-addr")&&e.hasOwnAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e["rel-addr"],t+=" ",t+="rport",t+=" ",t+=e["rel-port"],t+=" ")}return e.hasOwnAttribute("tcptype")&&(t+="tcptype",t+=" ",t+=e.tcptype,t+=" "),t+="generation",t+=" ",t+=e.hasOwnAttribute("generation")?e.generation:"0",r.rainbowLogger.sdk("[Strophe.jingle] jingle.sdp.build_icecandidate "+t),t},parse_ssrc:function(e){for(var t=e.split("\r\n"),n={},r=0;r<t.length;r++)if("a=ssrc:"==t[r].substring(0,7)){var i=t[r].indexOf(" ");n[t[r].substr(i+1).split(":",2)[0]]=t[r].substr(i+1).split(":",2)[1]}return n},parse_rtcpfb:function(e){var t=e.substr(10).split(" "),n={};return n.pt=t.shift(),n.type=t.shift(),n.params=t,n},parse_extmap:function(e){var t=e.substr(9).split(" "),n={};return n.value=t.shift(),-1!=n.value.indexOf("/")?(n.direction=n.value.substr(n.value.indexOf("/")+1),n.value=n.value.substr(0,n.value.indexOf("/"))):n.direction="both",n.uri=t.shift(),n.params=t,n},find_line:function(e,t,n){for(var r=e.split("\r\n"),i=0;i<r.length;i++)if(r[i].substring(0,t.length)==t)return r[i];if(!n)return!1;r=n.split("\r\n");for(var a=0;a<r.length;a++)if(r[a].substring(0,t.length)==t)return r[a];return!1},find_lines:function(e,t,n){for(var r=e.split("\r\n"),i=[],a=0;a<r.length;a++)r[a].substring(0,t.length)==t&&i.push(r[a]);if(i.length||!n)return i;r=n.split("\r\n");for(var o=0;o<r.length;o++)r[o].substring(0,t.length)==t&&i.push(r[o]);return i},candidateToJingle:function(e){if(r.rainbowLogger.sdk("[Strophe.jingle] !!! jingle.sdp.candidateToJingle "+e),0===e.indexOf("candidate:"))e="a="+e;else if("a=candidate:"!=e.substring(0,12))return r.rainbowLogger.sdk("[Strophe.jingle] parseCandidate called with a line that is not a candidate line"),r.rainbowLogger.sdk("[Strophe.jingle] "+e),null;"\r\n"==e.substring(e.length-2)&&(e=e.substring(0,e.length-2));var t,n={},i=e.split(" ");if("typ"!=i[6])return r.rainbowLogger.sdk("[Strophe.jingle] did not find typ in the right place"),r.rainbowLogger.sdk("[Strophe.jingle] "+e),null;for(n.foundation=i[0].substring(12),n.component=i[1],n.protocol=i[2].toLowerCase(),n.priority=i[3],n.ip=i[4],n.port=i[5],n.type=i[7],n.generation="0",t=8;t<i.length;t+=2)switch(i[t]){case"raddr":n["rel-addr"]=i[t+1];break;case"rport":n["rel-port"]=i[t+1];break;case"generation":n.generation=i[t+1];break;case"tcptype":n.tcptype=i[t+1];break;case"network-cost":n.cost=i[t+1];break;case"network-id":n.network=i[t+1];break;default:r.rainbowLogger.sdk('[Strophe.jingle] not translating "'+i[t]+'" = "'+i[t+1]+'"')}return n.id=Math.random().toString(36).substr(2,10),n},candidateFromJingle:function(e,t,n){var r=["a=candidate:"+e.getAttribute("foundation"),e.getAttribute("component"),e.getAttribute("protocol"),e.getAttribute("priority"),e.getAttribute("ip"),e.getAttribute("port"),"typ",e.getAttribute("type")];switch(e.getAttribute("type")){case"srflx":case"prflx":case"relay":e.getAttribute("rel-addr")&&e.getAttribute("rel-port")&&(r.push("raddr"),r.push(e.getAttribute("rel-addr")),r.push("rport"),r.push(e.getAttribute("rel-port")))}return r.push("generation"),r.push(e.getAttribute("generation")||"0"),e.getAttribute("network")&&(r.push("network-id"),r.push(e.getAttribute("network"))),e.getAttribute("cost")&&(r.push("network-cost"),r.push(e.getAttribute("cost"))),t&&(r.push("ufrag"),r.push(t)),n&&(r.push("pwd"),r.push(n)),r.join(" ")+"\r\n"}}},function(e,t){window.idx=-1,window.JingleSession=function(e,t,n,r){this.me=e,this.sid=t,this.connection=n,this.initiator=null,this.responder=null,this.isInitiator=null,this.peerjid=null,this.state=null,this.peerconnection=null,this.remoteStream=null,this.localSDP=null,this.remoteSDP=null,this.localStreams=[],this.localTransceivers=[],this.remoteStreams=[],this.remoteStreamsObject={},this.startTime=null,this.stopTime=null,this.media_constraints=null,this.pc_constraints=null,this.ice_config={},this.company_config={},this.hadstuncandidate=!1,this.hadturncandidate=!1,this.statsinterval=null,this.reason=null,this.addssrc=[],this.removessrc=[],this.pendingop=null,this.wait=!0,this.isRenegotiating=!1,this.remoteType=null,this.localType=null,this.videoSender=null,this.jingleIqTimeout=15e3,r&&(this.jingleIqTimeout=r),this.conference_id=-1,this.calledNumber=null,this.DTX=!1,this.unifiedPlanActivated=!1,this.hasSentTransportReplace=!1,this.iceFilterList=[]},JingleSession.prototype.initiate=function(e,t){Strophe.log("","[Strophe.jingle] initiate");var n=this;if(null===this.state){this.isInitiator=t,this.initiator=t?this.me:e,this.responder=t?e:this.me,this.peerjid=e;var r={};if(this.ice_config.sdpSemantics="plan-b",adapter&&adapter.default&&"chrome"===adapter.default.browserDetails.browser&&adapter.default.browserDetails.version>=70){var i=function(e){var t=null;if(e){var n=e.indexOf("web_sdk");-1!==n&&(t=e.substr(n+10,2),t=parseInt(t,10))}return t}(e);i&&i<53&&(Strophe.log("","[Strophe.jingle] Unified plan activated"),this.ice_config.sdpSemantics="unified-plan")}this.unifiedPlanActivated&&(this.ice_config.sdpSemantics="unified-plan"),Strophe.log("","[Strophe.jingle] SDP activated: "+this.ice_config.sdpSemantics),this.ice_config.unifiedPlan&&(this.unifiedPlanActivated=!0,Strophe.log("","[Strophe.jingle] FORCED Unified plan activated"),this.ice_config.sdpSemantics="unified-plan"),this.ice_config.enableDSCP&&(Strophe.log("","[Strophe.jingle] googDscp activated"),r={optional:[{googDscp:!0}]}),this.ice_config.dtx&&(Strophe.log("","[Strophe.jingle] Discontinuous Transmission (DTX) activated"),this.DTX=!0),this.company_config&&this.company_config.negotiation&&this.company_config.negotiation.iceFiltering&&(this.iceFilterList=this.company_config.negotiation.iceFiltering.length?this.company_config.negotiation.iceFiltering:[]);try{this.peerconnection=new window.RTCPeerConnection(this.ice_config,r)}catch(a){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] Failed to create PeerConnection, exception: ",a.message),Strophe.log(Strophe.LogLevel.ERROR,a);try{this.peerconnection=new window.RTCPeerConnection,this.peerconnection.setConfiguration&&this.peerconnection.setConfiguration(this.ice_config)}catch(o){return Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] Failed to create PeerConnection, exception: ",a.message),void Strophe.log(Strophe.LogLevel.ERROR,o)}}this.peerconnection.onicecandidate=function(e){window.isRenegotiating?Strophe.log("","[Strophe.jingle] onicecandidate not added due to renegotiation"):n.sendIceCandidate(e.candidate)},this.peerconnection.onaddstream=function(e){if(!n.unifiedPlanActivated){Strophe.log("","[Strophe.jingle] onAddStream");var t=e.stream;if(n.remoteStream=t,"audio"===n.remoteType||"video"===n.remoteType)for(;n.remoteStreams.length>0;)n.remoteStreams.pop();else for(var r=0;r<n.remoteStreams.length&&n.remoteStreams[r];r++)n.remoteStreams[r].active?t.getAudioTracks().length?n.remoteStreams[r].getAudioTracks().length&&n.remoteStreams.splice(r,1):!n.remoteStreams[r].getAudioTracks().length&&n.remoteStreams[r].getVideoTracks().length&&n.remoteStreams.splice(r,1):n.remoteStreams.splice(r,1);for(n.remoteStreams.push(t),Strophe.log("",n.remoteStreams),Strophe.log("","[Strophe.jingle] peer.onaddstream",t.id,t),t.hasOwnProperty("active")&&Strophe.log("","[Strophe.jingle] stream active ? ",t.active),Strophe.log("","[Strophe.jingle] audio Tracks: "+t.getAudioTracks().length+" | Video Tracks: "+t.getVideoTracks().length),r=0;r<t.getAudioTracks().length;r++){var i=t.getAudioTracks()[r];Strophe.log("","[Strophe.jingle] audio Track: "+i.id+" | "+i.kind+" | "+i.enabled+" | "+i.readyState,i)}for(r=0;r<t.getVideoTracks().length;r++)i=t.getVideoTracks()[r],Strophe.log("","[Strophe.jingle] video Track: "+i.id+" | "+i.kind+" | "+i.enabled+" | "+i.readyState,i);t.onactive=function(){Strophe.log("","[Strophe.jingle] stream.onactive",t)},t.onaddtrack=function(e){Strophe.log("","[Strophe.jingle] stream.onaddtrack: "+e.track.id+" | "+e.track.kind+" | "+e.track.enabled+" | "+e.track.readyState,e.track)},t.onremovetrack=function(e){Strophe.log("","[Strophe.jingle] stream.onremovetrack: "+e.track.id+" | "+e.track.kind+" | "+e.track.enabled+" | "+e.track.readyState,e.track)},t.oninactive=function(){Strophe.log("","[Strophe.jingle] stream.oninactive",t)},$(document).trigger("remotestreamadded.jingle",[n.sid,t.getAudioTracks().length])}},this.peerconnection.ontrack=function(e){n.unifiedPlanActivated&&(window.conference_id&&-1!==window.conference_id?n.createRemoteStreamForConference(e.transceiver):n.createOrUpdateRemoteStreams(e.transceiver))},this.peerconnection.onremovetrack=function(e){n.unifiedPlanActivated},this.peerconnection.onremovestream=function(e){Strophe.log("","[Strophe.jingle] peer.onremovestream"),$(document).trigger("remotestreamremoved.jingle",[e,n.sid])},this.peerconnection.onsignalingstatechange=function(e){n&&n.peerconnection&&$(document).trigger("iceconnectionstatechange.jingle",[n.sid,n])},this.peerconnection.oniceconnectionstatechange=function(e){if(n&&n.peerconnection){switch(n.peerconnection.iceConnectionState){case"connected":this.startTime=new Date,Strophe.log("","[Strophe.jingle] iceConnectionState is connected, try to update the RTP Sender ");break;case"closed":case"disconnected":this.stopTime=new Date}$(document).trigger("iceconnectionstatechange.jingle",[n.sid,n])}},this.localStreams.forEach((function(e){n.unifiedPlanActivated?n.addStream(e):n.peerconnection.addStream(e)}))}else Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] attempt to initiate on session "+this.sid+"in state "+this.state)},JingleSession.prototype.createRemoteStreamForConference=function(e){var t=new MediaStream;t.addTrack(e.receiver.track),this.remoteStreamsObject[0]=t},JingleSession.prototype.createOrUpdateRemoteStreams=function(e){var t=parseInt(e.mid),n=new MediaStream;this.remoteStreamsObject[t]?(this.remoteStreamsObject[t].removeTrack(this.remoteStreamsObject[t].getTracks()[0]),this.remoteStreamsObject[t].addTrack(e.receiver.track)):(n.addTrack(e.receiver.track),this.remoteStreamsObject[t]=n)},JingleSession.prototype.updateRemoteStreams=function(){var e=this;this.localTransceivers.forEach((function(t){t.currentDirection&&"sendonly"!==t.currentDirection&&"inactive"!==t.currentDirection||(e.remoteStreamsObject[t.mid]=null)}))},JingleSession.prototype.addStream=function(e){var t=this;if(t.unifiedPlanActivated){if(t.conference_id&&-1!==t.conference_id){var n=e.getAudioTracks().length?"audio":"video";return t.localTransceivers[0]||(t.localTransceivers[0]=t.peerconnection.addTransceiver(n)),t.localTransceivers[0].sender.replaceTrack("audio"===n?e.getAudioTracks()[0]:e.getVideoTracks()[0]),void(t.localTransceivers[0].direction="sendrecv")}return e.getAudioTracks().length>0&&(t.localTransceivers[0]||(t.localTransceivers[0]=t.peerconnection.addTransceiver("audio")),t.localTransceivers[0].sender.replaceTrack(e.getAudioTracks()[0]),t.localTransceivers[0].direction="sendrecv"),e.getVideoTracks().length>0&&e.getAudioTracks().length>0&&(t.localTransceivers[0]||(t.localTransceivers[0]=t.peerconnection.addTransceiver("audio",{direction:"recvonly"})),t.localTransceivers[1]||(t.localTransceivers[1]=t.peerconnection.addTransceiver("video")),t.localTransceivers[1].sender.replaceTrack(e.getVideoTracks()[0]),t.localTransceivers[1].direction="sendrecv"),void(e.getVideoTracks().length>0&&!e.getAudioTracks().length&&(t.localTransceivers[0]||(t.localTransceivers[0]=t.peerconnection.addTransceiver("audio",{direction:"recvonly"})),t.localTransceivers[1]||t.localTransceivers.push(t.peerconnection.addTransceiver("video",{direction:"recvonly"})),"videoOnly"===t.localType?(t.localTransceivers[1].sender.replaceTrack(e.getVideoTracks()[0]),t.localTransceivers[1].direction="sendrecv"):(t.localTransceivers[2]||t.localTransceivers.push(t.peerconnection.addTransceiver("video")),t.localTransceivers[2].sender.replaceTrack(e.getVideoTracks()[0]),t.localTransceivers[2].direction="sendrecv")))}switch(adapter.default.browserDetails.browser){case"chrome":case"edge":t.peerconnection.addStream(e);break;case"firefox":case"safari":e.getAudioTracks().length>0&&t.peerconnection.addTrack(e.getAudioTracks()[0],e),e.getVideoTracks().length>0&&t.peerconnection.addTrack(e.getVideoTracks()[0],e)}},JingleSession.prototype.removeStream=function(e,t){var n=this;if(Strophe.log("","[Strophe.jingle] detected WebRTC browser is "+adapter.default.browserDetails.browser),n.unifiedPlanActivated)return n.peerconnection.getTransceivers().forEach((function(e){e.sender.replaceTrack(null),e.direction="recvonly"})),void(n.localTransceivers=n.peerconnection.getTransceivers());switch(adapter.default.browserDetails.browser){case"chrome":case"edge":n.peerconnection.removeStream(e)}},JingleSession.prototype.addTrack=function(e){e.getAudioTracks().length>0&&this.peerconnection.addTrack(e.getAudioTracks()[0],e),e.getVideoTracks().length>0&&this.peerconnection.addTrack(e.getVideoTracks()[0],e)},JingleSession.prototype.replaceStream=function(e){var t=this;switch(Strophe.log("","[Strophe.jingle] detected WebRTC browser is "+adapter.default.browserDetails.browser),adapter.default.browserDetails.browser){case"chrome":break;case"firefox":case"safari":if(t.unifiedPlanActivated)return void t.addStream(e);var n=e.getAudioTracks()[0],r=e.getVideoTracks()[0];Strophe.log(Strophe.LogLevel.ERROR,n),Strophe.log(Strophe.LogLevel.ERROR,r);var i=!1,a=!1;if(t.peerconnection.getSenders().forEach((function(e){r&&e.track&&"video"===e.track.kind&&(e.replaceTrack(r),Strophe.log("","[Strophe.jingle] replaceTrack video "+e),i=!0),n&&e.track&&"audio"===e.track.kind&&(Strophe.log("","[Strophe.jingle] replaceTrack audio "+e),e.replaceTrack(n),a=!0)})),r&&!i)Strophe.log("","[Strophe.jingle] addTrack yourVideoTrack"),this.videoSender=t.peerconnection.addTrack(r,e);else if(this.videoSender){Strophe.log("","[Strophe.jingle] removeTrack yourVideoTrack");try{t.peerconnection.removeTrack(this.videoSender),this.videoSender=null}catch(o){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] removeTrack error "+o)}}n&&!a&&(Strophe.log("","[Strophe.jingle] add new audio track"),t.peerconnection.addTrack(n,e))}},JingleSession.prototype.addConferenceInfo=function(e){-1!==this.conference_id&&(e.c("conference",{xmlns:"urn:xmpp:janus:1",id:this.conference_id}),e.up())},JingleSession.prototype.accept=function(){try{var e=this;this.state="active";var t=this.peerconnection.localDescription;if(!t||"pranswer"!=t.type)return;for(Strophe.log("","[Strophe.jingle] going from pranswer to answer");SDPUtil.find_line(t.sdp,"a=inactive");)t.sdp=t.sdp.replace("a=inactive","a=sendrecv");t=this.hackMsLabelSDP(t);var n=new SDP(t.sdp),r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-accept",initiator:this.initiator,responder:this.responder,sid:this.sid,localType:this.localType});n.toJingle(r,this.initiator==this.me?"initiator":"responder",this.conference_id,this.calledNumber),this.connection.sendIQ(r,(function(){$(document).trigger("ack.jingle",[e.sid,{source:"answer"}])}),(function(t){var n=$(t).find("error").length?{code:$(t).find("error").attr("code"),reason:$(t).find("error :first")[0].tagName}:{};n.source="answer",$(document).trigger("error.jingle",{sid:e.sid,error:n})}),this.jingleIqTimeout);for(var i=this.peerconnection.localDescription.sdp;SDPUtil.find_line(i,"a=inactive");)i=i.replace("a=inactive","a=sendrecv");this.peerconnection.setLocalDescription(new window.RTCSessionDescription({type:"answer",sdp:i}),(function(){$(document).trigger("setLocalDescription.jingle",[e.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success, try to update the RTP Sender "),e.ice_config.enableDSCP&&e.peerconnection.getSenders().forEach((function(e){if(e.getParameters&&e.setParameters){var t=e.getParameters();t.encodings.forEach((function(e){e.priority="high",e.networkPriority="high"})),e.setParameters(t),Strophe.log("","[Strophe.jingle] RTP Sender parameters are updated "+e.getParameters())}}))}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}catch(a){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.accept failed: "+a)}},JingleSession.prototype.terminate=function(e){this.state="ended",this.reason=e,this.peerconnection&&"closed"!==this.peerconnection.signalingState&&this.peerconnection.close(),Strophe.log("","[Strophe.jingle] Clear peerconnection"),this.peerconnection=null,null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),this.localStreams&&this.localStreams.length&&this.localStreams.forEach((function(e){e.getTracks().forEach((function(e){e.enabled=!1,e.stop(),e=null})),e.stop&&e.stop(),e=null}))},JingleSession.prototype.active=function(){return"active"==this.state},JingleSession.prototype.sendIceCandidate=function(e){var t=this;if(e&&t.iceFilterList&&t.iceFilterList.length&&-1!==t.iceFilterList.indexOf(e.type))Strophe.log("","[Strophe.jingle] ICE candidate "+e.type+" is filtered");else if(e){Strophe.log("","[Strophe.jingle] sendIceCandidate "+e);var n=SDPUtil.iceparams(this.localSDP.media[e.sdpMLineIndex],this.localSDP.session),r=SDPUtil.candidateToJingle(e.candidate);if(!n||!r)return void Strophe.log("","[Strophe.jingle] failed to get ice && jcand");n.xmlns="urn:xmpp:jingle:transports:ice-udp:1",Strophe.log("","[Strophe.jingle] sending single candidate"),t.isRenegotiating?Strophe.log("","[Strophe.jingle] NOT sending candidate due to Renegotiation"):t.sendIceCandidates([e])}},JingleSession.prototype.sendIceCandidates=function(e){try{Strophe.log("","[Strophe.jingle] sendIceCandidates",e);for(var t=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-info",initiator:this.initiator,sid:this.sid,localType:this.localType}),n=0;n<this.localSDP.media.length;n++){var r=e.filter((function(e){return e.sdpMLineIndex==n})),i=SDPUtil.parse_mline(this.localSDP.media[n].split("\r\n")[0]);if(r.length>0){var a=SDPUtil.iceparams(this.localSDP.media[n],this.localSDP.session);a.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.c("content",{creator:this.initiator==this.me?"initiator":"responder",name:r[0].sdpMid?r[0].sdpMid:i.media}).c("transport",a);for(var o=0;o<r.length;o++)t.c("candidate",SDPUtil.candidateToJingle(r[o].candidate)).up();if(SDPUtil.find_line(this.localSDP.media[n],"a=fingerprint:",this.localSDP.session)){var s=SDPUtil.parse_fingerprint(SDPUtil.find_line(this.localSDP.media[n],"a=fingerprint:",this.localSDP.session));s.required=!0,t.c("fingerprint").t(s.fingerprint),delete s.fingerprint,t.attrs(s),t.up()}t.up(),t.up()}}if(config.turnOn&&!(t.node.innerHTML.indexOf('type="relay')>-1))return void Strophe.log("","[Strophe.jingle] Debug flag turnOn : Ignore candidate");Strophe.log("","[Strophe.jingle] try to send ack(transportinfo)..."),this.connection.sendIQ(t,(function(){Strophe.log("","Sent session initiate (ACK, transportinfo)..."),$(document).trigger("ack.jingle",[window.sid,{source:"transportinfo"}])}),(function(e){var t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="transportinfo",$(document).trigger("error.jingle",{sid:this.sid,error:t})}),this.jingleIqTimeout)}catch(c){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendIceCandidates failed: "+c)}},JingleSession.prototype.hackOfferSDP=function(e){return"firefox"!==adapter.default.browserDetails.browser&&(e.sdp=e.sdp.replace(/a=sendonly/g,"a=sendrecv")),-1!==this.conference_id&&"video"===this.localType&&(e.sdp=e.sdp.replace(/a=sendrecv/g,"a=sendonly")),navigator.platform.toUpperCase().indexOf("MAC")>=0&&(e.sdp=this.forceCodecTo(e.sdp,"H264/90000","video")),this.ice_config.simulcast&&-1!==this.conference_id&&"video"===this.localType&&adapter&&adapter.default&&"chrome"===adapter.default.browserDetails.browser&&adapter.default.browserDetails.version>=70&&(Strophe.log("","[Strophe.jingle] Enabling Simulcasting for Chrome (sdp munging)"),e.sdp=this.mungeSdpForSimulcasting(e.sdp)),e},JingleSession.prototype.hackMsLabelSDP=function(e){for(var t=e.sdp.split("\r\n"),n=0;n<t.length;n++)if("a=ssrc:"==t[n].substring(0,7)){var r=t[n].indexOf(" ");!t[n].substr(r+1).split(":",2)[0]||void 0!==t[n].substr(r+1).split(":",2)[1]&&""!==t[n].substr(r+1).split(":",2)[1]||t.splice(n,1)}return e.sdp=t.join("\r\n"),e},JingleSession.prototype.sendTransportReplace=function(){Strophe.log("","[Strophe.jingle] sendTransportReplace");var e=this;e.isReconnecting?Strophe.log("","[Strophe.jingle] sendTransportReplace ignored because we're already connecting"):(e.isReconnecting=!0,this.peerconnection.createOffer((function(t){e.createdOffer(t,"transport-replace")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createOffer failed",e)}),{iceRestart:!0}))},JingleSession.prototype.reconnectSession=function(){Strophe.log("","[Strophe.jingle] reconnectSession");var e=this;e.isReconnecting?Strophe.log("","[Strophe.jingle] reconnectSession ignored because we're already connecting"):(e.isReconnecting=!0,e.hasSentTransportReplace=!0,this.peerconnection.createOffer((function(t){e.sendCreatedOfferWithAckWait(t,"transport-replace")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createOffer failed",e)}),{iceRestart:!0}))},JingleSession.prototype.saveIncomingTransportReplace=function(e,t,n){Strophe.log("","[Strophe.jingle] saveIncomingTransportReplace"),this.savedIncomingTransportReplace={elem:e,desctype:t,ack:n}},JingleSession.prototype.acceptSavedIncomingTransportReplace=function(){Strophe.log("","[Strophe.jingle] acceptSavedIncomingTransportReplace"),this.connection.send(this.savedIncomingTransportReplace.ack),this.setRemoteDescription(this.savedIncomingTransportReplace.elem,this.savedIncomingTransportReplace.desctype),$(document).trigger("transportreplace.jingle",[this.sid]),this.savedIncomingTransportReplace=null},JingleSession.prototype.rejectSavedIncomingTransportReplace=function(){if(Strophe.log("","[Strophe.jingle] rejectSavedIncomingTransportReplace"),this.savedIncomingTransportReplace&&this.savedIncomingTransportReplace.ack){var e=this.savedIncomingTransportReplace.ack;e.type="error",e.c("error",{type:"reject"}),this.connection.send(e)}this.savedIncomingTransportReplace=null},JingleSession.prototype.sendCreatedOfferWithAckWait=function(e,t){try{e=this.hackOfferSDP(e),e=this.hackMsLabelSDP(e);var n=this;this.localSDP=new SDP(e.sdp);var r=t||"session-initiate";Strophe.log("","[Strophe.jingle] sendCreatedOfferWithAckWait with SDP : "+e.sdp+" and action : "+r);var i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:r,initiator:this.initiator,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&((i=i.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),i.up()),this.localSDP.toJingle(i,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(i,(function(t){if(t&&$(t).find("error").length)return Strophe.log("","[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ ACK with error"),n.hasSentTransportReplace=!1,void(n.savedIncomingTransportReplace&&n.acceptSavedIncomingTransportReplace());if(Strophe.log("","[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ ACK received, set local description"),n.hasSentTransportReplace=!1,n.savedIncomingTransportReplace){if(!n.isInitiator)return void n.acceptSavedIncomingTransportReplace();n.rejectSavedIncomingTransportReplace()}e.sdp=n.localSDP.raw,n.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[n.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}),(function(){Strophe.log("","[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ rejected"),n.hasSentTransportReplace=!1,n.savedIncomingTransportReplace?n.acceptSavedIncomingTransportReplace():n.isReconnecting=!1}),this.jingleIqTimeout)}catch(a){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.createdOffer failed: "+a)}},JingleSession.prototype.sendOffer=function(e){Strophe.log("","[Strophe.jingle] sendOffer");var t=this;if(e){Strophe.log("","ice restart");var n={};if((-1===this.conference_id&&!this.calledNumber||"video"!==this.localType)&&(n.iceRestart=!0),this.ice_config.simulcast&&-1!==this.conference_id&&"video"===this.localType&&adapter&&adapter.default&&"firefox"===adapter.default.browserDetails.browser){Strophe.log("","[Strophe.jingle] Enabling Simulcasting for Firefox (RID)");var r=this.peerconnection.getSenders().find((function(e){return"video"==e.track.kind}));if(r){var i=r.getParameters();i||(i={}),i.encodings=[{rid:"h",active:!0,maxBitrate:9e5},{rid:"m",active:!0,maxBitrate:3e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:1e5,scaleResolutionDownBy:4}],r.setParameters(i)}}this.peerconnection.createOffer((function(e){t.createdOffer(e)}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createOffer failed",e)}),n)}else this.peerconnection.createOffer((function(e){t.createdOffer(e)}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createOffer failed",e)}),this.media_constraints)},JingleSession.prototype.createdOffer=function(e,t){try{e=this.hackOfferSDP(e),e=this.hackMsLabelSDP(e);var n=this;this.localSDP=new SDP(e.sdp);var r=t||"session-initiate";Strophe.log("","[Strophe.jingle] createdOffer with SDP : "+e.sdp+" and action : "+r);var i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:r,initiator:this.initiator,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&((i=i.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),i.up()),this.localSDP.toJingle(i,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(i,(function(){$(document).trigger("ack.jingle",[n.sid,{source:"offer"}])}),(function(e){n.state="error",n.peerconnection&&"closed"!==n.peerconnection.signalingState&&(Strophe.log("","[Strophe.jingle] Clear peerconnection"),n.peerconnection.close(),n.peerconnection=null);var t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="offer",$(document).trigger("error.jingle",{sid:n.sid,error:t})}),this.jingleIqTimeout),e.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[n.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}catch(a){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.createdOffer failed: "+a)}},JingleSession.prototype.contentRemove=function(e){Strophe.log("","[Strophe.jingle] contentRemove");var t=this;this.peerconnection.createOffer((function(n){t.contentUpdateOffer(n,e,"remove")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] contentRemove failed",e)}),this.media_constraints)},JingleSession.prototype.contentAdd=function(e){Strophe.log("","[Strophe.jingle] contentAdd");var t=this;this.peerconnection.createOffer((function(n){t.contentUpdateOffer(n,e,"add")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] contentAdd failed",e)}),this.media_constraints)},JingleSession.prototype.contentModify=function(e){Strophe.log("","[Strophe.jingle] contentModify");var t=this;this.peerconnection.createOffer((function(n){t.contentUpdateOffer(n,e,"modify")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] contentModify failed",e)}),this.media_constraints)},JingleSession.prototype.contentUpdateOffer=function(e,t,n){try{Strophe.log("","[Strophe.jingle] contentUpdateOffer",e.sdp);var r=this;e=this.hackMsLabelSDP(e),this.localSDP=new SDP(e.sdp),"audio"===t?r.localType="audio":"video"===t?r.localType="audio+video":"sharing"===t?r.localType="sharing":"sharing+video"===t&&(r.localType="sharing+video");var i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-"+n,initiator:this.initiator,sid:this.sid,mediaType:t});this.calledNumber&&""!==this.calledNumber&&((i=i.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),i.up()),this.localSDP.toJingle(i,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(i,(function(){$(document).trigger("ack.jingle",[r.sid,{source:"offer"}])}),(function(e){r.state="error",r.peerconnection&&(Strophe.log("","[Strophe.jingle] Clear peerconnection"),r.peerconnection.close(),r.peerconnection=null);var t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="offer",$(document).trigger("error.jingle",{sid:r.sid,error:t})}),this.jingleIqTimeout),e.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[r.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}catch(a){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.contentUpdateOffer failed: "+a)}},JingleSession.prototype.contentChangeAnswer=function(e,t){try{Strophe.log("","[Strophe.jingle] contentChangeAnswer",e.sdp);var n=this;e=this.hackMsLabelSDP(e),this.localSDP=new SDP(e.sdp);var r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-accept",initiator:this.initiator,sid:this.sid});this.calledNumber&&""!==this.calledNumber&&((r=r.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),r.up()),this.localSDP.toJingle(r,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(r,(function(){$(document).trigger("ack.jingle",[n.sid,{source:"offer"}])}),(function(e){n.state="error",n.peerconnection&&(Strophe.log("","[Strophe.jingle] Clear peerconnection"),n.peerconnection.close(),n.peerconnection=null);var t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="offer",$(document).trigger("error.jingle",{sid:n.sid,error:t})}),this.jingleIqTimeout),e.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[n.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success"),n.unifiedPlanActivated&&t&&n.updateRemoteStreams()}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}catch(i){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.contentChangeAnswer failed: "+i)}},JingleSession.prototype.updateBandwidthRestriction=function(e,t,n){var r=t||n?500:1200;if("audio"===this.localType||t)return Strophe.log("","[Strophe.jingle] do not updateBandwidthRestriction"),e;"sharing"!==this.localType&&"sharing"!==this.remoteType||(r=t||n?800:1500),"sharing+video"===this.localType&&(r=n?1300:2700);var i="AS";if("firefox"===adapter.default.browserDetails.browser&&(r=1e3*(r>>>0),i="TIAS"),r>0)if(-1===e.indexOf("b="+i+":")){var a=e.indexOf("m=video");if(a>0){var o=e.substring(a);o=o.replace(/c=IN (.*)\r\n/,"c=IN $1\r\nb="+i+":"+r+"\r\n"),e=e.substring(0,a)+o}}else e=e.replace(new RegExp("b="+i+":.*\r\n"),"b="+i+":"+r+"\r\n");else e.replace(new RegExp("b="+i+":.*\r\n"),"");return Strophe.log("","[Strophe.jingle] updateBandwidthRestriction to ",r),e},JingleSession.prototype.setRemoteDescription=function(e,t){Strophe.log("","[Strophe.jingle] setRemoteDescription ",t);var n=this;if(this.remoteSDP=new SDP(""),this.remoteSDP.fromJingle(e),this.isInitiator?this.remoteSDP.raw=this.remoteSDP.raw.replace(/a=setup:passive/g,"a=setup:active"):this.remoteSDP.raw=this.remoteSDP.raw.replace(/a=setup:active/g,"a=setup:passive"),navigator.platform.toUpperCase().indexOf("MAC")>=0&&(this.remoteSDP.raw=this.forceCodecTo(this.remoteSDP.raw,"H264/90000","video")),-1!==this.conference_id||this.confId||this.publisherId)this.remoteSDP.raw=this.updateBandwidthRestriction(this.remoteSDP.raw,!0);else{var r=!1;this.peerjid&&(r=-1!==this.peerjid.indexOf("mobile_android")||-1!==this.peerjid.indexOf("mobile_ios")||-1!==this.peerjid.indexOf("deskphone")),this.remoteSDP.raw=this.updateBandwidthRestriction(this.remoteSDP.raw,!1,r)}this.DTX&&(Strophe.log("","[Strophe.jingle] activate Discontinuous Transmission (DTX)"),this.remoteSDP.raw=this.remoteSDP.raw.replace("useinbandfec=1","useinbandfec=1;usedtx=1")),Strophe.log("","[Strophe.jingle] setRemoteDescription after parsing "+this.remoteSDP.raw);var i=new window.RTCSessionDescription({type:t,sdp:this.remoteSDP.raw});Strophe.log("","[Strophe.jingle] setRemoteDescription object ",i),this.peerconnection.setRemoteDescription(i,(function(){Strophe.log("","[Strophe.jingle] setRemoteDescription success"),n.unifiedPlanActivated&&(n.localTransceivers=n.peerconnection.getTransceivers())}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setRemoteDescription error "+e)})),Strophe.log("","[Strophe.jingle] setRemoteDescription is setting, try to update the RTP Sender "),this.ice_config.enableDSCP&&this.peerconnection.getSenders().forEach((function(e){if(console.error(e),e.getParameters&&e.setParameters){var t=e.getParameters();console.error(t),t.encodings.forEach((function(e){e.priority="high",e.networkPriority="high"})),e.setParameters(t),console.error(e.getParameters())}}))},JingleSession.prototype.addIceCandidate=function(e){Strophe.log("","[Strophe.jingle] addIceCandidate");var t=this;e.each((function(){var e,n=-1;for(e=0;e<t.remoteSDP.media.length;e++)if(SDPUtil.find_line(t.remoteSDP.media[e],"a=mid:"+$(this).attr("name"))||0===t.remoteSDP.media[e].indexOf("m="+$(this).attr("name"))){n=e;break}if(-1==n)for(e=0;e<t.localSDP.media.length;e++)if(SDPUtil.find_line(t.localSDP.media[e],"a=mid:"+$(this).attr("name"))||0===t.localSDP.media[e].indexOf("m="+$(this).attr("name"))){n=e;break}var r,i,a=$(this).attr("name");$(this).find("content>transport").each((function(){r=this.getAttribute("ufrag"),i=this.getAttribute("pwd")})),$(this).find("transport>candidate").each((function(){var e,o;e=SDPUtil.candidateFromJingle(this,r,i),o=new window.RTCIceCandidate({sdpMLineIndex:n,sdpMid:a,candidate:e});try{if(o&&t.iceFilterList&&t.iceFilterList.length&&-1!==t.iceFilterList.indexOf(o.type))return void Strophe.log("","[Strophe.jingle] Received ICE candidate "+o.type+" is filtered");t.peerconnection.addIceCandidate(o)}catch(s){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] addIceCandidate failed",s.toString(),e)}}))}))},JingleSession.prototype.sendAnswer=function(e,t){Strophe.log("","[Strophe.jingle] sendAnswer",e);var n=this;this.peerconnection.createAnswer((function(r){n.createdAnswer(r,e,t)}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createAnswer failed",e)}),this.media_constraints)},JingleSession.prototype.createdAnswer=function(e,t,n){try{Strophe.log("","[Strophe.jingle] createdAnswer");var r=this;e=this.hackMsLabelSDP(e),this.localSDP=new SDP(e.sdp),this.usepranswer=!0===t;var i=n||"session-accept";n&&(r.isReconnecting=!1),Strophe.log("","sdp is "+e.sdp);var a=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:i,initiator:this.initiator,responder:this.responder,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&((a=a.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),a.up()),this.localSDP.toJingle(a,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(a,(function(){$(document).trigger("ack.jingle",[r.sid,{source:"answer"}])}),(function(e){var t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="answer",$(document).trigger("error.jingle",{sid:r.sid,error:t})}),this.jingleIqTimeout),e.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[r.sid]),Strophe.log("","[Strophe.jingle] createdAnswer -- setLocalDescription success, try to update the RTP Sender "),r.ice_config.enableDSCP&&r.peerconnection.getSenders().forEach((function(e){if(e.getParameters&&e.setParameters){var t=e.getParameters();t.encodings.forEach((function(e){e.priority="high",e.networkPriority="high"})),e.setParameters(t),Strophe.log("","[Strophe.jingle] RTP Sender parameters are updated "+e.getParameters())}}))}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}));for(var o=SDPUtil.find_lines(this.localSDP.raw,"a=candidate:"),s=0;s<o.length;s++){var c=SDPUtil.parse_icecandidate(o[s]);"srflx"==c.type?this.hadstuncandidate=!0:"relay"==c.type&&(this.hadturncandidate=!0)}}catch(l){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.createdAnswer failed: "+l)}},JingleSession.prototype.sendTerminate=function(e,t){try{var n=this,r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-terminate",initiator:this.initiator,sid:this.sid}).c("reason").c(e||"success");t&&r.up().c("text").t(t),this.connection.sendIQ(r,(function(){!n.peerconnection||"closed"===n.peerconnection.signalingState&&"undefined"!=n.peerconnection.signalingState||(n.peerconnection.close(),n.terminate()),Strophe.log("","[Strophe.jingle] Clear peerconnection"),n.peerconnection=null;$(document).trigger("ack.jingle",[n.sid,{source:"terminate"}])}),(function(e){var t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};$(document).trigger("ack.jingle",[n.sid,t])}),this.jingleIqTimeout),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null)}catch(i){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendTerminate failed: "+i)}},JingleSession.prototype.mediaModified=function(e){var t=this;this.peerconnection.createAnswer((function(n){t.contentChangeAnswer(n,e)}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] contentChange failed",e)}),this.media_constraints)},JingleSession.prototype.addSource=function(e){Strophe.log("","[Strophe.jingle] addssrc",(new Date).getTime()),Strophe.log("","[Strophe.jingle] ice",this.peerconnection.iceConnectionState);var t=new SDP(this.peerconnection.remoteDescription.sdp),n=this;$(e).each((function(e,r){var i=$(r).attr("name"),a="";tmp=$(r).find('>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),tmp.each((function(){var e=$(this).attr("ssrc");$(this).find(">parameter").each((function(){a+="a=ssrc:"+e+" "+$(this).attr("name"),$(this).attr("value")&&$(this).attr("value").length&&(a+=":"+$(this).attr("value")),a+="\r\n"}))})),t.media.forEach((function(e,r){SDPUtil.find_line(e,"a=mid:"+i)&&(t.media[r]+=a,n.addssrc[r]||(n.addssrc[r]=""),n.addssrc[r]+=a)})),t.raw=t.session+t.media.join("")})),this.modifySources()},JingleSession.prototype.removeSource=function(e){Strophe.log("","[Strophe.jingle] removessrc",(new Date).getTime()),Strophe.log("","[Strophe.jingle] ice",this.peerconnection.iceConnectionState);var t=new SDP(this.peerconnection.remoteDescription.sdp),n=this;$(e).each((function(e,r){var i=$(r).attr("name"),a="";tmp=$(r).find('>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),tmp.each((function(){var e=$(this).attr("ssrc");$(this).find(">parameter").each((function(){a+="a=ssrc:"+e+" "+$(this).attr("name"),$(this).attr("value")&&$(this).attr("value").length&&(a+=":"+$(this).attr("value")),a+="\r\n"}))})),t.media.forEach((function(e,r){SDPUtil.find_line(e,"a=mid:"+i)&&(t.media[r]+=a,n.addssrc[r]||(n.removessrc[r]=""),n.removessrc[r]+=a)})),t.raw=t.session+t.media.join("")})),this.modifySources()},JingleSession.prototype.modifySources=function(){var e=this;if(this.peerconnection&&"closed"!=this.peerconnection.signalingState&&(this.addssrc.length||this.removessrc.length||null!==this.pendingop)){if(!this.wait&&("stable"!=this.peerconnection.signalingState||"connected"!=this.peerconnection.iceConnectionState&&"completed"!=this.peerconnection.iceConnectionState))return console.warn("[Strophe.jingle] modifySources not yet",this.peerconnection.signalingState,this.peerconnection.iceConnectionState),this.wait=!0,void window.setTimeout((function(){e.modifySources()}),1500);if(this.wait)return window.setTimeout((function(){e.modifySources()}),2500),void(this.wait=!1);var t=new SDP(this.peerconnection.remoteDescription.sdp);this.addssrc.forEach((function(e,n){t.media[n]+=e})),this.addssrc=[],this.removessrc.forEach((function(e,n){(e=e.split("\r\n")).pop(),e.forEach((function(e){t.media[n]=t.media[n].replace(e+"\r\n","")}))})),this.removessrc=[],t.raw=t.session+t.media.join(""),this.peerconnection.setRemoteDescription(new window.RTCSessionDescription({type:"offer",sdp:t.raw}),(function(){e.peerconnection.createAnswer((function(t){if(null!==e.pendingop){var n=new SDP(t.sdp);if(n.media.length>1){switch(e.pendingop){case"mute":n.media[1]=n.media[1].replace("a=sendrecv","a=recvonly");break;case"unmute":n.media[1]=n.media[1].replace("a=recvonly","a=sendrecv")}n.raw=n.session+n.media.join(""),t.sdp=n.raw}e.pendingop=null}e.peerconnection.setLocalDescription(t,(function(){$(document).trigger("setLocalDescription.jingle",[e.sid])}),(function(e){Strophe.log("","[Strophe.jingle] modified setLocalDescription failed")}))}),(function(e){Strophe.log("","[Strophe.jingle] modified answer failed")}))}),(function(e){Strophe.log("","[Strophe.jingle] modify failed")}))}},JingleSession.prototype.hardMuteVideo=function(e){this.connection.jingle.localStream&&(this.pendingop=e?"mute":"unmute",this.modifySources(),this.connection.jingle.localStream.getVideoTracks().forEach((function(t){t.enabled=!e})))},JingleSession.prototype.mute=function(e){this.connection.jingle.localStream&&(this.pendingop=e?"mute":"unmute",this.modifySources(),this.connection.jingle.localStream.getVideoTracks().forEach((function(t){t.enabled=!e})),this.connection.jingle.localStream.getAudioTracks().forEach((function(t){t.enabled=!e})))},JingleSession.prototype.muteVideo=function(e){this.connection.jingle.localStream&&(this.pendingop=e?"mute":"unmute",this.modifySources(),this.connection.jingle.localStream.getVideoTracks().forEach((function(t){t.enabled=!e})))},JingleSession.prototype.muteAudio=function(e){this.connection.jingle.localStream&&this.connection.jingle.localStream.getAudioTracks().forEach((function(t){t.enabled=!e})),this.localStreams.length>=1&&this.localStreams.forEach((function(t){t.getAudioTracks().forEach((function(t){t.enabled=!e}))}))},JingleSession.prototype.sendMute=function(e,t){try{var n=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});n.c(e?"mute":"unmute",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),n.attrs({creator:this.me==this.initiator?"creator":"responder"}),t&&n.attrs({name:t}),this.connection.sendIQ(n)}catch(r){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendMute failed: "+r)}},JingleSession.prototype.sendHold=function(e){try{var t=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});t.c(e?"hold":"unhold",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(t)}catch(n){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendMute failed: "+n)}},JingleSession.prototype.sendIceFailed=function(){try{var e=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});e.c("iceFailed",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(e)}catch(t){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendIceFailed failed: "+t)}},JingleSession.prototype.sendRinging=function(){try{var e=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});e.c("ringing",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(e)}catch(t){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendRinging failed: "+t)}},JingleSession.prototype.forceCodecTo=function(e,t,n){for(var r,i,a,o,s,c=e.split("\r\n"),l=-1,u=-1,d=[],h=[],f=0,p=c.length;f<p;f++){var m=c[f];if(m.indexOf("m="+n)>-1&&(l=f,u=m.indexOf("RTP/SAVPF")+10,h=m.substring(u).split(" ")),m.indexOf(t)>-1){for(r=m.indexOf(":"),i=m.indexOf(" "),a=m.substring(r+1,i),o=-1,d.push(a),s=0;s<h.length;s++)if(h[s]===a){o=s;break}o>-1&&h.splice(o,1)}if("PCMU/8000"===t&&m.indexOf("PCMA/8000")>-1){for(r=m.indexOf(":"),i=m.indexOf(" "),a=m.substring(r+1,i),o=-1,d.push(a),s=0;s<h.length;s++)if(h[s]===a){o=s;break}o>-1&&h.splice(o,1)}}if(-1!==l){c[l]=c[l].substr(0,u-1);for(var v=0;v<d.length;v++)c[l]+=" "+d[v];h.length>0&&(c[l]+=" "+h.join(" ")),e=c.join("\r\n")}return e},JingleSession.prototype.mungeSdpForSimulcasting=function(e){for(var t=e.split("\r\n"),n=!1,r=[-1],i=[-1],a=null,o=null,s=null,c=null,l=-1,u=0;u<t.length;u++)if(h=t[u].match(/m=(\w+) */)){if("video"===h[1]){if(!(r[0]<0)){l=u;break}n=!0}else if(r[0]>-1){l=u;break}}else if(n){var d=t[u].match(/a=ssrc-group:FID (\d+) (\d+)/);if(d)r[0]=d[1],i[0]=d[2],t.splice(u,1),u--;else{if(r[0]){if((p=t[u].match("a=ssrc:"+r[0]+" cname:(.+)"))&&(a=p[1]),(p=t[u].match("a=ssrc:"+r[0]+" msid:(.+)"))&&(o=p[1]),(p=t[u].match("a=ssrc:"+r[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[u].match("a=ssrc:"+r[0]+" label:(.+)"))&&(c=p[1]),0===t[u].indexOf("a=ssrc:"+i[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+r[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}if(r[0]<0)for(l=-1,n=!1,u=0;u<t.length;u++){var h;if(h=t[u].match(/m=(\w+) */)){if("video"===h[1]){if(!(r[0]<0)){l=u;break}n=!0}else if(r[0]>-1){l=u;break}}else if(n){if(r[0]<0){var f=t[u].match(/a=ssrc:(\d+)/);if(f){r[0]=f[1],t.splice(u,1),u--;continue}}else{var p;if((p=t[u].match("a=ssrc:"+r[0]+" cname:(.+)"))&&(a=p[1]),(p=t[u].match("a=ssrc:"+r[0]+" msid:(.+)"))&&(o=p[1]),(p=t[u].match("a=ssrc:"+r[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[u].match("a=ssrc:"+r[0]+" label:(.+)"))&&(c=p[1]),0===t[u].indexOf("a=ssrc:"+i[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+r[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}if(r[0]<0)return Janus.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;for(l<0&&(l=t.length),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random()),i[1]=Math.floor(4294967295*Math.random()),i[2]=Math.floor(4294967295*Math.random()),u=0;u<r.length;u++)a&&(t.splice(l,0,"a=ssrc:"+r[u]+" cname:"+a),l++),o&&(t.splice(l,0,"a=ssrc:"+r[u]+" msid:"+o),l++),s&&(t.splice(l,0,"a=ssrc:"+r[u]+" mslabel:"+s),l++),c&&(t.splice(l,0,"a=ssrc:"+r[u]+" label:"+c),l++),a&&(t.splice(l,0,"a=ssrc:"+i[u]+" cname:"+a),l++),o&&(t.splice(l,0,"a=ssrc:"+i[u]+" msid:"+o),l++),s&&(t.splice(l,0,"a=ssrc:"+i[u]+" mslabel:"+s),l++),c&&(t.splice(l,0,"a=ssrc:"+i[u]+" label:"+c),l++);return t.splice(l,0,"a=ssrc-group:FID "+r[2]+" "+i[2]),t.splice(l,0,"a=ssrc-group:FID "+r[1]+" "+i[1]),t.splice(l,0,"a=ssrc-group:FID "+r[0]+" "+i[0]),t.splice(l,0,"a=ssrc-group:SIM "+r[0]+" "+r[1]+" "+r[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n"),e},JingleSession.prototype.getStats=function(e){var t=this,n={audio:0,video:0},r={audio:0,video:0},i={audio:0,video:0},a={audio:0,video:0},o={audio:0,video:0},s={audio:0,video:0},c=e/1e3,l=!0,u=0,d=0,h=0,f=0,p=0,m=0,v=0,g=0,y=0,b=0,S="",_={bitrate:{}},C="",w="";return this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),this.ice_config.debugWebRTC&&(e=1e3),this.statsinterval=window.setInterval((function(){t&&t.peerconnection?navigator.mozGetUserMedia?t.peerconnection.getStats().then((function(e){var n=[];e.forEach((function(e){n.push(e)})),function(e){$(document).trigger("statsFirefox.jingle",[t.sid,e]);for(var n,r,i=new Object,a=0,o=0,u=[],d=0;d<e.length;++d){if("audio"==e[d].mediaType&&e[d].bytesReceived){s.audio||(s.audio=e[d].bytesReceived);var h=e[d].bytesReceived-s.audio;s.audio=e[d].bytesReceived,a=8*h/(1024*c),i.audioReceived={bytesReceived:s.audio,packetsLost:e[d].packetsLost,packetsReceived:e[d].packetsReceived}}else"audio"==e[d].mediaType&&e[d].bytesSent?i.audioSent={bytesSent:e[d].bytesSent,packetsSent:e[d].packetsSent}:"video"==e[d].mediaType&&e[d].bytesReceived?(s.video||(s.video=e[d].bytesReceived),h=e[d].bytesReceived-s.video,s.video=e[d].bytesReceived,o=h?8*h/(1024*c):0,i.videoReceived={bytesReceived:s.video,packetsLost:e[d].packetsLost,packetsReceived:e[d].packetsReceived}):"video"==e[d].mediaType&&e[d].bytesSent&&(i.videoSent={bytesSent:e[d].bytesSent,packetsSent:e[d].packetsSent});"candidate-pair"===e[d].type&&"succeeded"===e[d].state&&!0===e[d].selected&&(n=e[d].localCandidateId,r=e[d].remoteCandidateId),l&&"localcandidate"===e[d].type&&e[d].id===n&&(i.connectionType||(i.connectionType={}),i.connectionType.local={candidateType:e[d].candidateType,ipAddress:e[d].ipAddress+":"+e[d].portNumber,transport:e[d].transport}),l&&"remotecandidate"===e[d].type&&e[d].id===r&&(i.connectionType||(i.connectionType={}),i.connectionType.remote={candidateType:e[d].candidateType,ipAddress:e[d].ipAddress+":"+e[d].portNumber}),("candidate-pair"!==e[d].type||e[d].selected)&&("local-candidate"===e[d].type&&e[d].id!==n||"remote-candidate"===e[d].type&&e[d].id!==r||u.push(e[d]));var f=e[d],p=!1;if(("video"===f.mediaType||f.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===f.type&&f.id.indexOf("rtcp")<0?p=!0:"ssrc"!=f.type||!f.bytesReceived||"VP8"!==f.googCodecName&&""!==f.googCodecName||(p=!0),p)if(_.bitrate.bsnow=f.bytesReceived,_.bitrate.tsnow=f.timestamp,void 0===_.bitrate.bsbefore||void 0===_.bitrate.tsbefore)_.bitrate.bsbefore=_.bitrate.bsnow,_.bitrate.tsbefore=_.bitrate.tsnow;else{var m=_.bitrate.tsnow-_.bitrate.tsbefore;"safari"==adapter.default.browserDetails.browser&&(m/=1e3);var v=Math.round(8*(_.bitrate.bsnow-_.bitrate.bsbefore)/m);"safari"===adapter.default.browserDetails.browser&&(v=parseInt(v/1e3)),_.bitrate.value=v+" kbits/sec",_.bitrate.bsbefore=_.bitrate.bsnow,_.bitrate.tsbefore=_.bitrate.tsnow,$(document).trigger("webrtcSessionBitRate.jingle",[t.sid,_.bitrate])}}i.availableIncomingAudioBandwidth=a,i.availableIncomingVideoBandwidth=o,i.connectionType&&(l=!1,$(document).trigger("webrtcConnectionType.jingle",[t.sid,i.connectionType])),$(document).trigger("webrtcFirefoxStats.jingle",[t.sid,i])}(n)})):t.peerconnection.getStats?t.peerconnection.getStats((function(e){var E=[];e.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,E.push(t)})),function(e){$(document).trigger("statsChrome.jingle",[t.sid,e]);for(var E,T,k,M=0,D=0,x=0,R=0,O=0,I=0,P=new Object,A=[],L=0,N=0,j=0,U=0,F=0,H=0,W=0,Y=0,B=0,V=0,G=0,z=!1,q=!1,J=!1,K=!1,Q=e.length-1;Q>=0;Q--){if("ssrc"==e[Q].type)if(-1!==e[Q].id.indexOf("send"))if("opus"!==e[Q].googCodecName&&"PCMA"!==e[Q].googCodecName&&"PCMU"!==e[Q].googCodecName||z)"VP8"!=e[Q].googCodecName||q||(q=!0,D=e[Q].packetsSent,e[Q].packetsLost,e[Q].googFrameRateSent&&e[Q].googFrameRateSent,o.video||(o.video=e[Q].bytesSent),e[Q].googRtt&&!j&&(j=parseInt(e[Q].googRtt,10)),X=e[Q].bytesSent-o.video,o.video=e[Q].bytesSent,8*X/(1024*c));else{z=!0,M=e[Q].packetsSent,e[Q].packetsLost,L=e[Q].audioInputLevel,e[Q].googRtt&&!j&&(j=parseInt(e[Q].googRtt,10)),o.audio||(o.audio=e[Q].bytesSent);var X=e[Q].bytesSent-o.audio;o.audio=e[Q].bytesSent,8*X/(1024*c)}else if("opus"!==e[Q].googCodecName&&"PCMA"!==e[Q].googCodecName||J)"VP8"!=e[Q].googCodecName||K||(K=!0,R=e[Q].packetsReceived,I+=e[Q].packetsLost,e[Q].googFrameRateReceived&&e[Q].googFrameRateReceived,a.video=r.video,i.video=n.video,n.video=parseInt(R,10),r.video=parseInt(I,10),s.video||(s.video=e[Q].bytesReceived),X=e[Q].bytesReceived-s.video,s.video=e[Q].bytesReceived,8*X/(1024*c));else{J=!0,x=e[Q].packetsReceived,O+=e[Q].packetsLost,N=e[Q].audioOutputLevel,a.audio=r.audio,i.audio=n.audio,n.audio=parseInt(x,10),r.audio=parseInt(O,10),U=parseInt(e[Q].googJitterBufferMs,10),F=parseInt(e[Q].googJitterReceived,10),H=parseInt(e[Q].packetsReceived,10)-d,d=parseInt(e[Q].packetsReceived,10),H<0&&(H=0),W=parseInt(e[Q].packetsLost,10)-u,u=parseInt(e[Q].packetsLost,10),W<0&&(W=0),G=W/(50*c)*100,V=e[Q].googCurrentDelayMs,s.audio||(s.audio=e[Q].bytesReceived);X=e[Q].bytesReceived-s.audio;s.audio=e[Q].bytesReceived,8*X/(1024*c)}"googCandidatePair"==e[Q].type&&"true"===e[Q].googWritable&&l&&(P.localCandidateType=e[Q].googLocalCandidateType,P.localAddress=e[Q].googLocalAddress,P.localTransportType=e[Q].googTransportType,P.remoteCandidateType=e[Q].googRemoteCandidateType,P.remoteAddress=e[Q].googRemoteAddress,w=e[Q].googLocalAddress.split(":")[0],e[Q].googRemoteAddress.split(":")[0],S=P.localAddress+" [ "+P.localCandidateType+" ] <-> "+P.remoteAddress+" [ "+P.remoteCandidateType+" ] || "+P.localTransportType),"localcandidate"===e[Q].type&&e[Q].ipAddress===w&&(P.networkType=e[Q].networkType,C=P.networkType),"googCandidatePair"===e[Q].type&&"0"===e[Q].requestsReceived||"remotecandidate"===e[Q].type||"localcandidate"===e[Q].type||"googCertificate"===e[Q].type||"googComponent"===e[Q].type||"googTrack"===e[Q].type||"googLibjingleSession"===e[Q].type||"VideoBwe"===e[Q].type||A.push(e[Q]);var Z=e[Q],ee=!1;if(("video"===Z.mediaType||Z.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===Z.type&&Z.id.indexOf("rtcp")<0?ee=!0:"ssrc"!=Z.type||!Z.bytesReceived||"VP8"!==Z.googCodecName&&""!==Z.googCodecName||(ee=!0),ee)if(_.bitrate.bsnow=Z.bytesReceived,_.bitrate.tsnow=Z.timestamp,void 0===_.bitrate.bsbefore||void 0===_.bitrate.tsbefore)_.bitrate.bsbefore=_.bitrate.bsnow,_.bitrate.tsbefore=_.bitrate.tsnow;else{var te=_.bitrate.tsnow-_.bitrate.tsbefore;"safari"==adapter.default.browserDetails.browser&&(te/=1e3);var ne=Math.round(8*(_.bitrate.bsnow-_.bitrate.bsbefore)/te);"safari"===adapter.default.browserDetails.browser&&(ne=parseInt(ne/1e3)),_.bitrate.value=ne+" kbits/sec",_.bitrate.bsbefore=_.bitrate.bsnow,_.bitrate.tsbefore=_.bitrate.tsnow,$(document).trigger("webrtcSessionBitRate.jingle",[t.sid,_.bitrate])}}H&&(B=.18*(Y=93.2-G)*Y-27.9*Y+1126.62),k=(T=B-(.024*(E=V)+.11*(E-177.3)*(E-177.3<0?0:1)))<0?1:T>100?4.5:1+.035*T+T*(T-60)*(100-T)*7*1e-6;var re=0;T>=80?re=2:T<80&&T>=60&&(re=1),P.googRTTAudio=j,P.googJitterBufferMsAudio=U,P.googJitterReceived=F,P.mosPacketsReceivedAudio=H,P.mosPacketsLostAudio=W,P.MOS=k,P.candidatePair=S,k&&(h+=1,f+=k,p+=j,m+=F,v+=U,P.iteration=h,P.currentDelay=E,P.MOS=k,P.networkQualityFlag=re,P.meanMOS=f/h,g=g<j?j:g,y=y<F?F:y,b=b<U?U:b),P.packetsAudioSent=parseInt(M,10),P.packetsAudioReceived=parseInt(x,10),P.audioInputLevel=parseInt(L,10),P.audioOutputLevel=parseInt(N,10),P.packetsVideoSent=parseInt(D,10),P.packetsVideoReceived=parseInt(R,10),P.bytesSent=o,P.bytesReceived=s,P.localCandidateType&&(l=!1,$(document).trigger("webrtcConnectionType.jingle",[t.sid,P])),A.RainMetrics={type:"mscore",meanRTT:p/h,maxRTT:g,meanJitter:m/h,maxJitter:y,meanJitterDepth:v/h,maxJitterDepth:b,candidatePair:P.candidatePair,networkType:C,meanMOS:P.meanMOS},$(document).trigger("webrtcSessionStats.jingle",[t.sid,A]),$(document).trigger("webrtcSessionStatsSimplyfied.jingle",[t.sid,P]),P&&Strophe.log("","[Strophe.jingle] webrtcChromeStats audio packets received : "+P.packetsAudioReceived+" / audio packets sent : "+P.packetsAudioSent+" / for session "+t.sid)}(E)})):Strophe.log("","[Strophe.jingle] getStats does not exist..."):Strophe.log("","[Strophe.jingle] getStats no peerconnection")}),e||1e3),this.statsinterval}},function(e,t){Strophe.addConnectionPlugin("mam",{_c:null,_p:["with","start","end"],init:function(e){this._c=e,Strophe.addNamespace("MAM","urn:xmpp:mam:1")},query:function(e,t){var n=this._p,r={type:"set",id:e},i={xmlns:Strophe.NS.MAM};t.queryid&&(i.queryid=t.queryid,delete t.queryid);var a,o=$iq(r).c("query",i).c("x",{xmlns:"jabber:x:data",type:"submit"});for(o.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up(),a=0;a<this._p.length;a++){var s=n[a],c=t[s];delete t[s],c&&o.c("field",{var:s}).c("value").t(c).up().up()}o.up(),delete t.onMessage;var l=t.onComplete;return delete t.onComplete,o.cnode(new Strophe.RSM(t).toXML()),this._c.sendIQ(o,l)},querymuc:function(e,t,n){var r=this._p,i={to:t,type:"set",id:e},a={xmlns:Strophe.NS.MAM};n.queryid&&(a.queryid=n.queryid,delete n.queryid);var o,s=$iq(i).c("query",a).c("x",{xmlns:"jabber:x:data",type:"submit"});for(s.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up(),o=0;o<this._p.length;o++){var c=r[o],l=n[c];delete n[c],l&&s.c("field",{var:c}).c("value").t(l).up().up()}s.up();var u=n.onComplete;return delete n.onComplete,s.cnode(new Strophe.RSM(n).toXML()),this._c.sendIQ(s,u)},delete:function(e,t){var n=this._p,r={type:"set",id:e},i={xmlns:Strophe.NS.MAM};t.queryid&&(i.queryid=t.queryid,delete t.queryid);var a,o=$iq(r).c("delete",i).c("x",{xmlns:"jabber:x:data",type:"submit"});for(o.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up(),a=0;a<this._p.length;a++){var s=n[a],c=t[s];c&&o.c("field",{var:s}).c("value").t(c).up().up()}o.up(),delete t.onMessage;var l=t.onComplete;return delete t.onComplete,o.cnode(new Strophe.RSM(t).toXML()),this._c.sendIQ(o,l)}})},function(e,t){Strophe.addConnectionPlugin("calllog",{_c:null,_p:["with"],init:function(e){this._c=e,Strophe.addNamespace("CALLLOG","jabber:iq:telephony:call:log")},query:function(e,t){var n,r=this._p,i={type:"set",id:130,from:e},a={xmlns:Strophe.NS.CALLLOG},o=$iq(i).c("query",a).c("x",{xmlns:"jabber:x:data",type:"submit"});for(o.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("jabber:iq:telephony:call:log").up().up(),n=0;n<this._p.length;n++){var s=r[n],c=t[s];delete t[s],c&&o.c("field",{var:s}).c("value").t(c).up().up()}o.up(),t.onMessage,delete t.onMessage;var l=t.onComplete;return delete t.onComplete,o.cnode(new Strophe.RSM(t).toXML()),this._c.sendIQ(o,l)}})},function(e,t){!function(){function e(){}function t(e,t){var n=!1;return $('si feature x field[var="stream-method"] value',e).each((function(e,r){$(r).text()===t&&(n=!0)})),n}Strophe.addConnectionPlugin("si_filetransfer",{_c:null,_cb:null,init:function(e){this._c=e,Strophe.addNamespace("SI","http://jabber.org/protocol/si"),Strophe.addNamespace("SI_FILE_TRANSFER",Strophe.NS.SI+"/profile/file-transfer"),Strophe.addNamespace("FEATURE_NEG","http://jabber.org/protocol/feature-neg"),e.addHandler(this._receive.bind(this),Strophe.NS.SI,"iq","set")},_receive:function(e){var n=$(e),r=n.attr("from"),i=n.attr("id"),a=$("si",n).attr("id");if(Object.hasOwnProperty.call(this._c,"ibb")&&t(e,Strophe.NS.IBB))var o=$("file",n);var s=o.attr("name"),c=o.attr("size"),l=$("si",n).attr("mime-type"),u=$("desc",n).text();return"function"==typeof this._cb&&this._cb(r,a,s,c,l,i,u),!0},_success:function(e,n){var r;t(n,Strophe.NS.IBB)||(r=new Error("In-Band Bytestream not supported")),e(r)},_fail:function(e,t){var n="timed out";t&&(n=t),e(new Error(n))},_send:function(e,t,n){this._c.sendIQ(e,t,n,18e4)},send:function(e,t,n,r,i,a,o){if(Object.hasOwnProperty.call(this._c,"ibb")){var s=$iq({type:"set",to:e,id:this._c.getUniqueId("si-filetransfer")}).c("si",{xmlns:Strophe.NS.SI,id:t,profile:Strophe.NS.SI_FILE_TRANSFER,"mime-type":i}).c("file",{xmlns:Strophe.NS.SI_FILE_TRANSFER,name:n,size:r}).c("desc").t(a).up().c("feature",{xmlns:Strophe.NS.FEATURE_NEG}).c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"stream-method",type:"list-single"}).c("option").c("value").t(Strophe.NS.IBB);this._send(s,this._success.bind(this,o),this._fail.bind(this,o))}else Strophe.warn("The In-Band Bytestream plugin is required.")},responseOk:function(t,n,r){var i=$iq({type:"result",to:t,id:r}).c("si",{xmlns:Strophe.NS.SI,id:n}).c("file",{xmlns:Strophe.NS.SI_FILE_TRANSFER}).up().c("feature",{xmlns:Strophe.NS.FEATURE_NEG}).c("x",{xmlns:"jabber:x:data",type:"submit"}).c("field",{var:"stream-method"});i.c("value").t(Strophe.NS.IBB),this._send(i,e,e)},responseError:function(t,n,r,i){var a=$iq({type:"error",to:t,id:r}).c("error",{code:i,type:"cancel"}).c("forbidden",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});a.c("value").t(Strophe.NS.IBB),this._send(a,e,e)},addFileHandler:function(e){this._cb=e}})}()},function(e,t,n){n.r(t);var i={};n.r(i),n.d(i,"shimGetUserMedia",(function(){return w})),n.d(i,"shimGetDisplayMedia",(function(){return E})),n.d(i,"shimMediaStream",(function(){return T})),n.d(i,"shimOnTrack",(function(){return k})),n.d(i,"shimGetSendersWithDtmf",(function(){return M})),n.d(i,"shimGetStats",(function(){return D})),n.d(i,"shimSenderReceiverGetStats",(function(){return x})),n.d(i,"shimAddTrackRemoveTrackWithNative",(function(){return R})),n.d(i,"shimAddTrackRemoveTrack",(function(){return O})),n.d(i,"shimPeerConnection",(function(){return I})),n.d(i,"fixNegotiationNeeded",(function(){return P}));var a={};n.r(a),n.d(a,"shimGetUserMedia",(function(){return N})),n.d(a,"shimGetDisplayMedia",(function(){return j})),n.d(a,"shimPeerConnection",(function(){return U})),n.d(a,"shimReplaceTrack",(function(){return F}));var o={};n.r(o),n.d(o,"shimGetUserMedia",(function(){return H})),n.d(o,"shimGetDisplayMedia",(function(){return W})),n.d(o,"shimOnTrack",(function(){return Y})),n.d(o,"shimPeerConnection",(function(){return B})),n.d(o,"shimSenderGetStats",(function(){return V})),n.d(o,"shimReceiverGetStats",(function(){return $})),n.d(o,"shimRemoveStream",(function(){return G})),n.d(o,"shimRTCDataChannel",(function(){return z})),n.d(o,"shimAddTransceiver",(function(){return q})),n.d(o,"shimCreateOffer",(function(){return J})),n.d(o,"shimCreateAnswer",(function(){return K}));var s={};n.r(s),n.d(s,"shimLocalStreamsAPI",(function(){return Q})),n.d(s,"shimRemoteStreamsAPI",(function(){return X})),n.d(s,"shimCallbacksAPI",(function(){return Z})),n.d(s,"shimGetUserMedia",(function(){return ee})),n.d(s,"shimConstraints",(function(){return te})),n.d(s,"shimRTCIceServerUrls",(function(){return ne})),n.d(s,"shimTrackEventTransceiver",(function(){return re})),n.d(s,"shimCreateOfferLegacy",(function(){return ie}));var c={};n.r(c),n.d(c,"shimRTCIceCandidate",(function(){return se})),n.d(c,"shimMaxMessageSize",(function(){return ce})),n.d(c,"shimSendThrowTypeError",(function(){return le})),n.d(c,"shimConnectionState",(function(){return ue})),n.d(c,"removeAllowExtmapMixed",(function(){return de}));var l={};n.r(l),n.d(l,"default",(function(){return he}));var u=!0,d=!0;function h(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function f(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var a=function(e){var t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=a,i.apply(this,[e,a])};var a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return a.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(u=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function m(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(d=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function v(){if("object"==typeof window){if(u)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function g(e,t){d&&console.warn(e+" is deprecated, please use "+t+" instead.")}function y(e){var t=e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=h(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=h(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=h(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=h(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n}function b(e){return"[object Object]"===Object.prototype.toString.call(e)}function S(e){return b(e)?Object.keys(e).reduce((function(t,n){var i=b(e[n]),a=i?S(e[n]):e[n],o=i&&!Object.keys(a).length;return void 0===a||o?t:Object.assign(t,Object(r.a)({},n,a))}),{}):e}function _(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var a=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach((function(i){i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach((function(n){e(t,t.get(n),r)}))})))}(e,n,i)}))})),i}var C=v;function w(e){var t=e&&e.navigator;if(t.mediaDevices){var n=y(e),r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};"number"==typeof r.ideal?(a[i("min",n)]=r.ideal,t.optional.push(a),(a={})[i("max",n)]=r.ideal,t.optional.push(a)):(a[i("",n)]=r.ideal,t.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){var o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var s,c=n.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?s=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(s=["front"]),s)return t.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return s.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&s.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=o.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=r(e.video),C("chrome: "+JSON.stringify(e)),i(e)}));e.video=r(e.video)}return C("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){i(e,(function(e){t.webkitGetUserMedia(e,n,(function(e){r&&r(a(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return o(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(a(e))}))}))}}}}function E(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function T(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function k(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],n.dispatchEvent(a)})),t.stream.getTracks().forEach((function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],n.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else f(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function M(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function D(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],i=n[1],a=n[2];if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(o(e)))};return t.apply(this,[c,r])}return new Promise((function(n,r){t.apply(e,[function(e){n(s(o(e)))},r])})).then(i,a)}}}function x(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return _(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),f(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return _(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,a=arguments[0];return this.getSenders().forEach((function(e){e.track===a&&(t?r=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===a&&(n?r=!0:n=e),e.track===a})),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function R(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),i.apply(this,arguments)}}function O(e){if(e.RTCPeerConnection){var t=y(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return R(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var a=this.getSenders().find((function(e){return e.track===t}));if(a)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[n.id]=s,this._reverseStreams[s.id]=n,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=Object(r.a)({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(n){var r=c(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return c(e,t)}))}));e.RTCPeerConnection.prototype[t]=i[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=l(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(r){n._streams[r].getTracks().find((function(t){return e.track===t}))&&(t=n._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function l(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}}function I(e){var t=y(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=Object(r.a)({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=i[t]}));var i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}function P(e){f(e,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))}var A=n(234),L=n.n(A);function N(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}function j(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function U(e){var t=y(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=L()(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&g("RTCIceServer.url","RTCIceServer.urls");var r="string"==typeof t;return r&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=r?t[0]:t,!!t.length}}))}(e.iceServers,t.version),v("ICE servers after filtering:",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype}function F(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function H(e){var t=y(e),n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){g("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},r&&r.prototype.getSettings){var o=r.prototype.getSettings;r.prototype.getSettings=function(){var e=o.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function W(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function Y(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function B(e){var t=y(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=Object(r.a)({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=i[t]})),t.version<68){var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),n=e[0],r=e[1],o=e[2];return a.apply(this,[n||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,o)}}}function V(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function $(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),f(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function G(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;g("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})}function z(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function q(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var i=r.sender,a=i.getParameters();"encodings"in a||(a.encodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(a).catch((function(){}))))}return r})}}function J(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function K(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function Q(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}}function X(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function Z(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}}function ee(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(te(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function te(e){return e&&void 0!==e.video?Object.assign({},e,{video:S(e.video)}):e}function ne(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(g("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[i])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}function re(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function ie(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}}var ae=n(52),oe=n.n(ae);function se(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),r=oe.a.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,f(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function ce(e){if(e.RTCPeerConnection){var t=y(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=oe.a.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=oe.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=oe.a.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var c,l=r(arguments[0]),u=i(l),d=a(arguments[0],l);c=0===u&&0===d?Number.POSITIVE_INFINITY:0===u||0===d?Math.max(u,d):Math.min(u,d);var h={};Object.defineProperty(h,"maxMessageSize",{get:function(){return c}}),this._sctp=h}return o.apply(this,arguments)}}}function le(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},f(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function ue(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}}function de(e){if(e.RTCPeerConnection){var t=y(e);if(!("chrome"===t.browser&&t.version>=71)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),n.apply(this,arguments)}}}}var he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=v,l=y(t),u={browserDetails:l,commonShim:c,extractVersion:h,disableLog:p,disableWarnings:m};switch(l.browser){case"chrome":if(!i||!I||!n.shimChrome)return r("Chrome shim is not included in this adapter release."),u;r("adapter.js shimming chrome."),u.browserShim=i,w(t),T(t),I(t),k(t),O(t),M(t),D(t),x(t),P(t),se(t),ue(t),ce(t),le(t),de(t);break;case"firefox":if(!o||!B||!n.shimFirefox)return r("Firefox shim is not included in this adapter release."),u;r("adapter.js shimming firefox."),u.browserShim=o,H(t),B(t),Y(t),G(t),V(t),$(t),z(t),q(t),J(t),K(t),se(t),ue(t),ce(t),le(t);break;case"edge":if(!a||!U||!n.shimEdge)return r("MS edge shim is not included in this adapter release."),u;r("adapter.js shimming edge."),u.browserShim=a,N(t),j(t),U(t),F(t),ce(t),le(t);break;case"safari":if(!s||!n.shimSafari)return r("Safari shim is not included in this adapter release."),u;r("adapter.js shimming safari."),u.browserShim=s,ne(t),ie(t),Z(t),Q(t),X(t),re(t),ee(t),se(t),ce(t),le(t),de(t);break;default:r("Unsupported browser!")}return u}({window:window}),fe=n(235),pe=n(236),me=n(237),ve=n(238),ge=n(239),ye=n(240),be=n(241),Se=n(242),_e=n(243),Ce=n(244),we=n(245),Ee=n(246),Te=n(247),ke=n(248),Me=n(249),De=n(250),xe=n(251),Re=n(252),Oe=n(28),Ie=n(0);n(253),n(254),n(255),window.adapter=l,window.emojione=null,n(256),n(257),n(410),n(28),n(411),angular.module("sdk").service("connectionService",fe.ConnectionService),angular.module("sdk").service("presenceService",pe.PresenceService),angular.module("sdk").service("userProfileService",me.UserProfileService),angular.module("sdk").service("contactsService",ve.ContactsService),angular.module("sdk").service("pbxService",ge.PbxService),angular.module("sdk").service("conversationsService",ye.ConversationsService),angular.module("sdk").service("imService",be.ImService),angular.module("sdk").service("webRTCService",Se.WebRTCService),angular.module("sdk").service("bubblesService",_e.BubblesService),angular.module("sdk").service("conferencesService",Ce.ConferencesService),angular.module("sdk").service("groupsService",we.GroupsService),angular.module("sdk").service("callsLogService",Ee.CallsLogService),angular.module("sdk").service("favoritesService",Te.FavoritesService),angular.module("sdk").service("filesStorageService",ke.FilesStorageService),angular.module("sdk").service("capabilitiesService",Me.CapabilitiesService),angular.module("sdk").service("adminService",De.AdminService),angular.module("sdk").service("channelsService",xe.ChannelsService),angular.module("sdk").service("rainbowSDK",Re.SdkService),angular.module("sdk")||angular.bootstrap(document,["sdk"]).get("rainbowSDK"),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422);var Pe=angular.injector(["sdk"]).get("rainbowSDK");Pe.Call=Ie.Call,Pe.SDK=Oe.SDK,t.default=Pe}]);t.a=w.default},,function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1),i=n(27);function a(e,t){return r.useMemo((function(){return null==e&&null==t?null:function(n){Object(i.a)(e,n),Object(i.a)(t,n)}}),[e,t])}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(43);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(104)},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return d})),n.d(t,"e",(function(){return h}));var r=n(93);function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function a(e){if(e.type)return e;if("#"===e.charAt(0))return a(function(e){e=e.substr(1);var t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g"),n=e.match(t);return n&&1===n[0].length&&(n=n.map((function(e){return e+e}))),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map((function(e,t){return t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3})).join(", "),")"):""}(e));var t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla"].indexOf(n))throw new Error(Object(r.a)(3,e));var i=e.substring(t+1,e.length-1).split(",");return{type:n,values:i=i.map((function(e){return parseFloat(e)}))}}function o(e){var t=e.type,n=e.values;return-1!==t.indexOf("rgb")?n=n.map((function(e,t){return t<3?parseInt(e,10):e})):-1!==t.indexOf("hsl")&&(n[1]="".concat(n[1],"%"),n[2]="".concat(n[2],"%")),"".concat(t,"(").concat(n.join(", "),")")}function s(e,t){var n=c(e),r=c(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function c(e){var t="hsl"===(e=a(e)).type?a(function(e){var t=(e=a(e)).values,n=t[0],r=t[1]/100,i=t[2]/100,s=r*Math.min(i,1-i),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return i-s*Math.max(Math.min(t-3,9-t,1),-1)},l="rgb",u=[Math.round(255*c(0)),Math.round(255*c(8)),Math.round(255*c(4))];return"hsla"===e.type&&(l+="a",u.push(t[3])),o({type:l,values:u})}(e)).values:e.values;return t=t.map((function(e){return(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)})),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;return c(e)>.5?d(e,t):h(e,t)}function u(e,t){return e=a(e),t=i(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),e.values[3]=t,o(e)}function d(e,t){if(e=a(e),t=i(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]*=1-t;return o(e)}function h(e,t){if(e=a(e),t=i(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;return o(e)}},function(e,t,n){"use strict";function r(e){return e&&e.ownerDocument||document}n.d(t,"a",(function(){return r}))},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){var r=n(114);function i(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(38)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1),i="undefined"!==typeof window?r.useLayoutEffect:r.useEffect;function a(e){var t=r.useRef(e);return i((function(){t.current=e})),r.useCallback((function(){return t.current.apply(void 0,arguments)}),[])}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(56);var i=n(50);function a(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(i.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";function r(e){var t=e.props,n=e.states,r=e.muiFormControl;return n.reduce((function(e,n){return e[n]=t[n],r&&"undefined"===typeof t[n]&&(e[n]=r[n]),e}),{})}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1),i=n(41);function a(){return r.useContext(i.a)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));var r=n(4),i={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},a={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function o(e){return"".concat(Math.round(e),"ms")}t.a={easing:i,duration:a,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.duration,s=void 0===n?a.standard:n,c=t.easing,l=void 0===c?i.easeInOut:c,u=t.delay,d=void 0===u?0:u;Object(r.a)(t,["duration","easing","delay"]);return(Array.isArray(e)?e:[e]).map((function(e){return"".concat(e," ").concat("string"===typeof s?s:o(s)," ").concat(l," ").concat("string"===typeof d?d:o(d))})).join(",")},getAutoHeightDuration:function(e){if(!e)return 0;var t=e/36;return Math.round(10*(4+15*Math.pow(t,.25)+t/5))}}},,function(e,t,n){"use strict";function r(e,t){"function"===typeof e?e(t):e&&(e.current=t)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return null==t?e:function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r),t.apply(this,r)}}),(function(){}))}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(81);var i=n(62),a=n(82);function o(e,t){return Object(r.a)(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(e,t)||Object(i.a)(e,t)||Object(a.a)()}},function(e,t,n){"use strict";var r=n(1),i=r.createContext({});t.a=i},,function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(9),l={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p"},u=a.forwardRef((function(e,t){var n=e.align,s=void 0===n?"inherit":n,u=e.classes,d=e.className,h=e.color,f=void 0===h?"initial":h,p=e.component,m=e.display,v=void 0===m?"initial":m,g=e.gutterBottom,y=void 0!==g&&g,b=e.noWrap,S=void 0!==b&&b,_=e.paragraph,C=void 0!==_&&_,w=e.variant,E=void 0===w?"body1":w,T=e.variantMapping,k=void 0===T?l:T,M=Object(i.a)(e,["align","classes","className","color","component","display","gutterBottom","noWrap","paragraph","variant","variantMapping"]),D=p||(C?"p":k[E]||l[E])||"span";return a.createElement(D,Object(r.a)({className:Object(o.a)(u.root,d,"inherit"!==E&&u[E],"initial"!==f&&u["color".concat(Object(c.a)(f))],S&&u.noWrap,y&&u.gutterBottom,C&&u.paragraph,"inherit"!==s&&u["align".concat(Object(c.a)(s))],"initial"!==v&&u["display".concat(Object(c.a)(v))]),ref:t},M))}));t.a=Object(s.a)((function(e){return{root:{margin:0},body2:e.typography.body2,body1:e.typography.body1,caption:e.typography.caption,button:e.typography.button,h1:e.typography.h1,h2:e.typography.h2,h3:e.typography.h3,h4:e.typography.h4,h5:e.typography.h5,h6:e.typography.h6,subtitle1:e.typography.subtitle1,subtitle2:e.typography.subtitle2,overline:e.typography.overline,srOnly:{position:"absolute",height:1,width:1,overflow:"hidden"},alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"},alignJustify:{textAlign:"justify"},noWrap:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},gutterBottom:{marginBottom:"0.35em"},paragraph:{marginBottom:16},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorTextPrimary:{color:e.palette.text.primary},colorTextSecondary:{color:e.palette.text.secondary},colorError:{color:e.palette.error.main},displayInline:{display:"inline"},displayBlock:{display:"block"}}}),{name:"MuiTypography"})(u)},function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(118),i=(n(1),n(51));function a(){return Object(r.a)()||i.a}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(1);function i(e,t){return r.isValidElement(e)&&-1!==t.indexOf(e.type.muiName)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(58);var i=n(80),a=n(62);function o(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(i.a)(e)||Object(a.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var r=function(e){return e.scrollTop};function i(e,t){var n=e.timeout,r=e.style,i=void 0===r?{}:r;return{duration:i.transitionDuration||"number"===typeof n?n:n[t.mode]||0,delay:i.transitionDelay}}},function(e,t,n){"use strict";n.r(t),n.d(t,"capitalize",(function(){return r.a})),n.d(t,"createChainedFunction",(function(){return i.a})),n.d(t,"createSvgIcon",(function(){return a.a})),n.d(t,"debounce",(function(){return o.a})),n.d(t,"deprecatedPropType",(function(){return s})),n.d(t,"isMuiElement",(function(){return c.a})),n.d(t,"ownerDocument",(function(){return l.a})),n.d(t,"ownerWindow",(function(){return u.a})),n.d(t,"requirePropFactory",(function(){return d.a})),n.d(t,"setRef",(function(){return h.a})),n.d(t,"unsupportedProp",(function(){return f.a})),n.d(t,"useControlled",(function(){return p.a})),n.d(t,"useEventCallback",(function(){return m.a})),n.d(t,"useForkRef",(function(){return v.a})),n.d(t,"unstable_useId",(function(){return y})),n.d(t,"useIsFocusVisible",(function(){return b.a}));var r=n(9),i=n(28),a=n(49),o=n(46);function s(e,t){return function(){return null}}var c=n(35),l=n(17),u=n(48),d=n(71),h=n(27),f=n(72),p=n(47),m=n(21),v=n(12),g=n(1);function y(e){var t=g.useState(e),n=t[0],r=t[1],i=e||n;return g.useEffect((function(){null==n&&r("mui-".concat(Math.round(1e5*Math.random())))}),[n]),i}var b=n(61)},function(e,t,n){"use strict";function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));var r=n(1),i=r.createContext();function a(){return r.useContext(i)}t.a=i},function(e,t,n){"use strict";function r(e){return null!=e&&!(Array.isArray(e)&&0===e.length)}function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&(r(e.value)&&""!==e.value||t&&r(e.defaultValue)&&""!==e.defaultValue)}function a(e){return e.startAdornment}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"}),"Phone");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"}),"CallEnd");t.default=o},function(e,t,n){"use strict";function r(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function r(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=this,s=function(){e.apply(o,i)};clearTimeout(t),t=setTimeout(s,n)}return r.clear=function(){clearTimeout(t)},r}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(1);function i(e){var t=e.controlled,n=e.default,i=(e.name,e.state,r.useRef(void 0!==t).current),a=r.useState(n),o=a[0],s=a[1];return[i?t:o,r.useCallback((function(e){i||s(e)}),[])]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(17);function i(e){return Object(r.a)(e).defaultView||window}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(3),i=n(1),a=n.n(i),o=n(4),s=(n(7),n(5)),c=n(6),l=n(9),u=i.forwardRef((function(e,t){var n=e.children,a=e.classes,c=e.className,u=e.color,d=void 0===u?"inherit":u,h=e.component,f=void 0===h?"svg":h,p=e.fontSize,m=void 0===p?"default":p,v=e.htmlColor,g=e.titleAccess,y=e.viewBox,b=void 0===y?"0 0 24 24":y,S=Object(o.a)(e,["children","classes","className","color","component","fontSize","htmlColor","titleAccess","viewBox"]);return i.createElement(f,Object(r.a)({className:Object(s.a)(a.root,c,"inherit"!==d&&a["color".concat(Object(l.a)(d))],"default"!==m&&a["fontSize".concat(Object(l.a)(m))]),focusable:"false",viewBox:b,color:v,"aria-hidden":!g||void 0,role:g?"img":void 0,ref:t},S),n,g?i.createElement("title",null,g):null)}));u.muiName="SvgIcon";var d=Object(c.a)((function(e){return{root:{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,fontSize:e.typography.pxToRem(24),transition:e.transitions.create("fill",{duration:e.transitions.duration.shorter})},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorAction:{color:e.palette.action.active},colorError:{color:e.palette.error.main},colorDisabled:{color:e.palette.action.disabled},fontSizeInherit:{fontSize:"inherit"},fontSizeSmall:{fontSize:e.typography.pxToRem(20)},fontSizeLarge:{fontSize:e.typography.pxToRem(35)}}}),{name:"MuiSvgIcon"})(u);function h(e,t){var n=function(t,n){return a.a.createElement(d,Object(r.a)({ref:n},t),e)};return n.muiName=d.muiName,a.a.memo(a.a.forwardRef(n))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(56);function i(e,t){if(e){if("string"===typeof e)return Object(r.a)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r.a)(e,t):void 0}}},function(e,t,n){"use strict";var r=n(15),i=n(4),a=n(150),o=n(3),s=["xs","sm","md","lg","xl"];function c(e){var t=e.values,n=void 0===t?{xs:0,sm:600,md:960,lg:1280,xl:1920}:t,r=e.unit,a=void 0===r?"px":r,c=e.step,l=void 0===c?5:c,u=Object(i.a)(e,["values","unit","step"]);function d(e){var t="number"===typeof n[e]?n[e]:e;return"@media (min-width:".concat(t).concat(a,")")}function h(e,t){var r=s.indexOf(t);return r===s.length-1?d(e):"@media (min-width:".concat("number"===typeof n[e]?n[e]:e).concat(a,") and ")+"(max-width:".concat((-1!==r&&"number"===typeof n[s[r+1]]?n[s[r+1]]:t)-l/100).concat(a,")")}return Object(o.a)({keys:s,values:n,up:d,down:function(e){var t=s.indexOf(e)+1,r=n[s[t]];return t===s.length?d("xs"):"@media (max-width:".concat(("number"===typeof r&&t>0?r:e)-l/100).concat(a,")")},between:h,only:function(e){return h(e,e)},width:function(e){return n[e]}},u)}function l(e,t,n){var i;return Object(o.a)({gutters:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o.a)({paddingLeft:t(2),paddingRight:t(2)},n,Object(r.a)({},e.up("sm"),Object(o.a)({paddingLeft:t(3),paddingRight:t(3)},n[e.up("sm")])))},toolbar:(i={minHeight:56},Object(r.a)(i,"".concat(e.up("xs")," and (orientation: landscape)"),{minHeight:48}),Object(r.a)(i,e.up("sm"),{minHeight:64}),i)},n)}var u=n(93),d={black:"#000",white:"#fff"},h={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"},f={50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",A100:"#8c9eff",A200:"#536dfe",A400:"#3d5afe",A700:"#304ffe"},p={50:"#fce4ec",100:"#f8bbd0",200:"#f48fb1",300:"#f06292",400:"#ec407a",500:"#e91e63",600:"#d81b60",700:"#c2185b",800:"#ad1457",900:"#880e4f",A100:"#ff80ab",A200:"#ff4081",A400:"#f50057",A700:"#c51162"},m={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},v={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},g={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},y={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},b=n(16),S={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:d.white,default:h[50]},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},_={text:{primary:d.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",hint:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:h[800],default:"#303030"},action:{active:d.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function C(e,t,n,r){var i=r.light||r,a=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=Object(b.e)(e.main,i):"dark"===t&&(e.dark=Object(b.a)(e.main,a)))}function w(e){var t=e.primary,n=void 0===t?{light:f[300],main:f[500],dark:f[700]}:t,r=e.secondary,s=void 0===r?{light:p.A200,main:p.A400,dark:p.A700}:r,c=e.error,l=void 0===c?{light:m[300],main:m[500],dark:m[700]}:c,w=e.warning,E=void 0===w?{light:v[300],main:v[500],dark:v[700]}:w,T=e.info,k=void 0===T?{light:g[300],main:g[500],dark:g[700]}:T,M=e.success,D=void 0===M?{light:y[300],main:y[500],dark:y[700]}:M,x=e.type,R=void 0===x?"light":x,O=e.contrastThreshold,I=void 0===O?3:O,P=e.tonalOffset,A=void 0===P?.2:P,L=Object(i.a)(e,["primary","secondary","error","warning","info","success","type","contrastThreshold","tonalOffset"]);function N(e){return Object(b.d)(e,_.text.primary)>=I?_.text.primary:S.text.primary}var j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:700;if(!(e=Object(o.a)({},e)).main&&e[t]&&(e.main=e[t]),!e.main)throw new Error(Object(u.a)(4,t));if("string"!==typeof e.main)throw new Error(Object(u.a)(5,JSON.stringify(e.main)));return C(e,"light",n,A),C(e,"dark",r,A),e.contrastText||(e.contrastText=N(e.main)),e},U={dark:_,light:S};return Object(a.a)(Object(o.a)({common:d,type:R,primary:j(n),secondary:j(s,"A400","A200","A700"),error:j(l),warning:j(E),info:j(k),success:j(D),grey:h,contrastThreshold:I,getContrastText:N,augmentColor:j,tonalOffset:A},U[R]),L)}function E(e){return Math.round(1e5*e)/1e5}var T={textTransform:"uppercase"},k='"Roboto", "Helvetica", "Arial", sans-serif';function M(e,t){var n="function"===typeof t?t(e):t,r=n.fontFamily,s=void 0===r?k:r,c=n.fontSize,l=void 0===c?14:c,u=n.fontWeightLight,d=void 0===u?300:u,h=n.fontWeightRegular,f=void 0===h?400:h,p=n.fontWeightMedium,m=void 0===p?500:p,v=n.fontWeightBold,g=void 0===v?700:v,y=n.htmlFontSize,b=void 0===y?16:y,S=n.allVariants,_=n.pxToRem,C=Object(i.a)(n,["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"]);var w=l/14,M=_||function(e){return"".concat(e/b*w,"rem")},D=function(e,t,n,r,i){return Object(o.a)({fontFamily:s,fontWeight:e,fontSize:M(t),lineHeight:n},s===k?{letterSpacing:"".concat(E(r/t),"em")}:{},i,S)},x={h1:D(d,96,1.167,-1.5),h2:D(d,60,1.2,-.5),h3:D(f,48,1.167,0),h4:D(f,34,1.235,.25),h5:D(f,24,1.334,0),h6:D(m,20,1.6,.15),subtitle1:D(f,16,1.75,.15),subtitle2:D(m,14,1.57,.1),body1:D(f,16,1.5,.15),body2:D(f,14,1.43,.15),button:D(m,14,1.75,.4,T),caption:D(f,12,1.66,.4),overline:D(f,12,2.66,1,T)};return Object(a.a)(Object(o.a)({htmlFontSize:b,pxToRem:M,round:E,fontFamily:s,fontSize:l,fontWeightLight:d,fontWeightRegular:f,fontWeightMedium:m,fontWeightBold:g},x),C,{clone:!1})}function D(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}var x=["none",D(0,2,1,-1,0,1,1,0,0,1,3,0),D(0,3,1,-2,0,2,2,0,0,1,5,0),D(0,3,3,-2,0,3,4,0,0,1,8,0),D(0,2,4,-1,0,4,5,0,0,1,10,0),D(0,3,5,-1,0,5,8,0,0,1,14,0),D(0,3,5,-1,0,6,10,0,0,1,18,0),D(0,4,5,-2,0,7,10,1,0,2,16,1),D(0,5,5,-3,0,8,10,1,0,3,14,2),D(0,5,6,-3,0,9,12,1,0,3,16,2),D(0,6,6,-3,0,10,14,1,0,4,18,3),D(0,6,7,-4,0,11,15,1,0,4,20,3),D(0,7,8,-4,0,12,17,2,0,5,22,4),D(0,7,8,-4,0,13,19,2,0,5,24,4),D(0,7,9,-4,0,14,21,2,0,5,26,4),D(0,8,9,-5,0,15,22,2,0,6,28,5),D(0,8,10,-5,0,16,24,2,0,6,30,5),D(0,8,11,-5,0,17,26,2,0,6,32,5),D(0,9,11,-5,0,18,28,2,0,7,34,6),D(0,9,12,-6,0,19,29,2,0,7,36,6),D(0,10,13,-6,0,20,31,3,0,8,38,7),D(0,10,13,-6,0,21,33,3,0,8,40,7),D(0,10,14,-6,0,22,35,3,0,8,42,7),D(0,11,14,-7,0,23,36,3,0,9,44,8),D(0,11,15,-7,0,24,38,3,0,9,46,8)],R={borderRadius:4},O=n(29),I=(n(36),n(39));n(7);var P=function(e,t){return t?Object(a.a)(e,t,{clone:!1}):e},A={xs:0,sm:600,md:960,lg:1280,xl:1920},L={keys:["xs","sm","md","lg","xl"],up:function(e){return"@media (min-width:".concat(A[e],"px)")}};var N={m:"margin",p:"padding"},j={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},U={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},F=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){if(e.length>2){if(!U[e])return[e];e=U[e]}var t=e.split(""),n=Object(O.a)(t,2),r=n[0],i=n[1],a=N[r],o=j[i]||"";return Array.isArray(o)?o.map((function(e){return a+e})):[a+o]})),H=["m","mt","mr","mb","ml","mx","my","p","pt","pr","pb","pl","px","py","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY"];function W(e){var t=e.spacing||8;return"number"===typeof t?function(e){return t*e}:Array.isArray(t)?function(e){return t[e]}:"function"===typeof t?t:function(){}}function Y(e,t){return function(n){return e.reduce((function(e,r){return e[r]=function(e,t){if("string"===typeof t||null==t)return t;var n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:"-".concat(n)}(t,n),e}),{})}}function B(e){var t=W(e.theme);return Object.keys(e).map((function(n){if(-1===H.indexOf(n))return null;var r=Y(F(n),t),i=e[n];return function(e,t,n){if(Array.isArray(t)){var r=e.theme.breakpoints||L;return t.reduce((function(e,i,a){return e[r.up(r.keys[a])]=n(t[a]),e}),{})}if("object"===Object(I.a)(t)){var i=e.theme.breakpoints||L;return Object.keys(t).reduce((function(e,r){return e[i.up(r)]=n(t[r]),e}),{})}return n(t)}(e,i,r)})).reduce(P,{})}B.propTypes={},B.filterProps=H;function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;var t=W({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return 0===n.length?t(1):1===n.length?t(n[0]):n.map((function(e){if("string"===typeof e)return e;var n=t(e);return"number"===typeof n?"".concat(n,"px"):n})).join(" ")};return Object.defineProperty(n,"unit",{get:function(){return e}}),n.mui=!0,n}var $=n(25),G=n(63);var z=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.breakpoints,n=void 0===t?{}:t,r=e.mixins,o=void 0===r?{}:r,s=e.palette,u=void 0===s?{}:s,d=e.spacing,h=e.typography,f=void 0===h?{}:h,p=Object(i.a)(e,["breakpoints","mixins","palette","spacing","typography"]),m=w(u),v=c(n),g=V(d),y=Object(a.a)({breakpoints:v,direction:"ltr",mixins:l(v,g,o),overrides:{},palette:m,props:{},shadows:x,typography:M(m,f),spacing:g,shape:R,transitions:$.a,zIndex:G.a},p),b=arguments.length,S=new Array(b>1?b-1:0),_=1;_<b;_++)S[_-1]=arguments[_];return y=S.reduce((function(e,t){return Object(a.a)(e,t)}),y)}();t.a=z},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";var r=n(1),i=n.n(r);t.a=i.a.createContext(null)},,function(e,t,n){"use strict";e.exports=n(113)},function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");t.default=o},,function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(1),i=n(14),a=!0,o=!1,s=null,c={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function l(e){e.metaKey||e.altKey||e.ctrlKey||(a=!0)}function u(){a=!1}function d(){"hidden"===this.visibilityState&&o&&(a=!0)}function h(e){var t=e.target;try{return t.matches(":focus-visible")}catch(n){}return a||function(e){var t=e.type,n=e.tagName;return!("INPUT"!==n||!c[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}function f(){o=!0,window.clearTimeout(s),s=window.setTimeout((function(){o=!1}),100)}function p(){return{isFocusVisible:h,onBlurVisible:f,ref:r.useCallback((function(e){var t,n=i.findDOMNode(e);null!=n&&((t=n.ownerDocument).addEventListener("keydown",l,!0),t.addEventListener("mousedown",u,!0),t.addEventListener("pointerdown",u,!0),t.addEventListener("touchstart",u,!0),t.addEventListener("visibilitychange",d,!0))}),[])}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(58);function i(e,t){if(e){if("string"===typeof e)return Object(r.a)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r.a)(e,t):void 0}}},function(e,t,n){"use strict";t.a={mobileStepper:1e3,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500}},function(e,t,n){"use strict";function r(){var e=document.createElement("div");e.style.width="99px",e.style.height="99px",e.style.position="absolute",e.style.top="-9999px",e.style.overflow="scroll",document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"}),"FormatListBulleted");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"}),"RemoveCircle");t.default=o},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=n.n(a),s=(n(7),n(14)),c=n(5),l=n(12),u=n(21),d=n(6),h=n(61),f=n(36),p=n(33),m=n(57),v=n(40),g=n(53);function y(e,t){var n=Object.create(null);return e&&a.Children.map(e,(function(e){return e})).forEach((function(e){n[e.key]=function(e){return t&&Object(a.isValidElement)(e)?t(e):e}(e)})),n}function b(e,t,n){return null!=n[t]?n[t]:e.props[t]}function S(e,t,n){var r=y(e.children),i=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,i=Object.create(null),a=[];for(var o in e)o in t?a.length&&(i[o]=a,a=[]):a.push(o);var s={};for(var c in t){if(i[c])for(r=0;r<i[c].length;r++){var l=i[c][r];s[i[c][r]]=n(l)}s[c]=n(c)}for(r=0;r<a.length;r++)s[a[r]]=n(a[r]);return s}(t,r);return Object.keys(i).forEach((function(o){var s=i[o];if(Object(a.isValidElement)(s)){var c=o in t,l=o in r,u=t[o],d=Object(a.isValidElement)(u)&&!u.props.in;!l||c&&!d?l||!c||d?l&&c&&Object(a.isValidElement)(u)&&(i[o]=Object(a.cloneElement)(s,{onExited:n.bind(null,s),in:u.props.in,exit:b(s,"exit",e),enter:b(s,"enter",e)})):i[o]=Object(a.cloneElement)(s,{in:!1}):i[o]=Object(a.cloneElement)(s,{onExited:n.bind(null,s),in:!0,exit:b(s,"exit",e),enter:b(s,"enter",e)})}})),i}var _=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},C=function(e){function t(t,n){var r,i=(r=e.call(this,t,n)||this).handleExited.bind(Object(m.a)(r));return r.state={contextValue:{isMounting:!0},handleExited:i,firstRender:!0},r}Object(v.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(e,t){var n,r,i=t.children,o=t.handleExited;return{children:t.firstRender?(n=e,r=o,y(n.children,(function(e){return Object(a.cloneElement)(e,{onExited:r.bind(null,e),in:!0,appear:b(e,"appear",n),enter:b(e,"enter",n),exit:b(e,"exit",n)})}))):S(e,i,o),firstRender:!1}},n.handleExited=function(e,t){var n=y(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=Object(r.a)({},t.children);return delete n[e.key],{children:n}})))},n.render=function(){var e=this.props,t=e.component,n=e.childFactory,r=Object(p.a)(e,["component","childFactory"]),i=this.state.contextValue,a=_(this.state.children).map(n);return delete r.appear,delete r.enter,delete r.exit,null===t?o.a.createElement(g.a.Provider,{value:i},a):o.a.createElement(g.a.Provider,{value:i},o.a.createElement(t,r,a))},t}(o.a.Component);C.propTypes={},C.defaultProps={component:"div",childFactory:function(e){return e}};var w=C,E="undefined"===typeof window?a.useEffect:a.useLayoutEffect;var T=function(e){var t=e.classes,n=e.pulsate,r=void 0!==n&&n,i=e.rippleX,o=e.rippleY,s=e.rippleSize,l=e.in,d=e.onExited,h=void 0===d?function(){}:d,f=e.timeout,p=a.useState(!1),m=p[0],v=p[1],g=Object(c.a)(t.ripple,t.rippleVisible,r&&t.ripplePulsate),y={width:s,height:s,top:-s/2+o,left:-s/2+i},b=Object(c.a)(t.child,m&&t.childLeaving,r&&t.childPulsate),S=Object(u.a)(h);return E((function(){if(!l){v(!0);var e=setTimeout(S,f);return function(){clearTimeout(e)}}}),[S,l,f]),a.createElement("span",{className:g,style:y},a.createElement("span",{className:b}))},k=a.forwardRef((function(e,t){var n=e.center,o=void 0!==n&&n,s=e.classes,l=e.className,u=Object(i.a)(e,["center","classes","className"]),d=a.useState([]),h=d[0],p=d[1],m=a.useRef(0),v=a.useRef(null);a.useEffect((function(){v.current&&(v.current(),v.current=null)}),[h]);var g=a.useRef(!1),y=a.useRef(null),b=a.useRef(null),S=a.useRef(null);a.useEffect((function(){return function(){clearTimeout(y.current)}}),[]);var _=a.useCallback((function(e){var t=e.pulsate,n=e.rippleX,r=e.rippleY,i=e.rippleSize,o=e.cb;p((function(e){return[].concat(Object(f.a)(e),[a.createElement(T,{key:m.current,classes:s,timeout:550,pulsate:t,rippleX:n,rippleY:r,rippleSize:i})])})),m.current+=1,v.current=o}),[s]),C=a.useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=t.pulsate,i=void 0!==r&&r,a=t.center,s=void 0===a?o||t.pulsate:a,c=t.fakeElement,l=void 0!==c&&c;if("mousedown"===e.type&&g.current)g.current=!1;else{"touchstart"===e.type&&(g.current=!0);var u,d,h,f=l?null:S.current,p=f?f.getBoundingClientRect():{width:0,height:0,left:0,top:0};if(s||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)u=Math.round(p.width/2),d=Math.round(p.height/2);else{var m=e.touches?e.touches[0]:e,v=m.clientX,C=m.clientY;u=Math.round(v-p.left),d=Math.round(C-p.top)}if(s)(h=Math.sqrt((2*Math.pow(p.width,2)+Math.pow(p.height,2))/3))%2===0&&(h+=1);else{var w=2*Math.max(Math.abs((f?f.clientWidth:0)-u),u)+2,E=2*Math.max(Math.abs((f?f.clientHeight:0)-d),d)+2;h=Math.sqrt(Math.pow(w,2)+Math.pow(E,2))}e.touches?null===b.current&&(b.current=function(){_({pulsate:i,rippleX:u,rippleY:d,rippleSize:h,cb:n})},y.current=setTimeout((function(){b.current&&(b.current(),b.current=null)}),80)):_({pulsate:i,rippleX:u,rippleY:d,rippleSize:h,cb:n})}}),[o,_]),E=a.useCallback((function(){C({},{pulsate:!0})}),[C]),k=a.useCallback((function(e,t){if(clearTimeout(y.current),"touchend"===e.type&&b.current)return e.persist(),b.current(),b.current=null,void(y.current=setTimeout((function(){k(e,t)})));b.current=null,p((function(e){return e.length>0?e.slice(1):e})),v.current=t}),[]);return a.useImperativeHandle(t,(function(){return{pulsate:E,start:C,stop:k}}),[E,C,k]),a.createElement("span",Object(r.a)({className:Object(c.a)(s.root,l),ref:S},u),a.createElement(w,{component:null,exit:!0},h))})),M=Object(d.a)((function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(550,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(550,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}}),{flip:!1,name:"MuiTouchRipple"})(a.memo(k)),D=a.forwardRef((function(e,t){var n=e.action,o=e.buttonRef,d=e.centerRipple,f=void 0!==d&&d,p=e.children,m=e.classes,v=e.className,g=e.component,y=void 0===g?"button":g,b=e.disabled,S=void 0!==b&&b,_=e.disableRipple,C=void 0!==_&&_,w=e.disableTouchRipple,E=void 0!==w&&w,T=e.focusRipple,k=void 0!==T&&T,D=e.focusVisibleClassName,x=e.onBlur,R=e.onClick,O=e.onFocus,I=e.onFocusVisible,P=e.onKeyDown,A=e.onKeyUp,L=e.onMouseDown,N=e.onMouseLeave,j=e.onMouseUp,U=e.onTouchEnd,F=e.onTouchMove,H=e.onTouchStart,W=e.onDragLeave,Y=e.tabIndex,B=void 0===Y?0:Y,V=e.TouchRippleProps,$=e.type,G=void 0===$?"button":$,z=Object(i.a)(e,["action","buttonRef","centerRipple","children","classes","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","onBlur","onClick","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","onDragLeave","tabIndex","TouchRippleProps","type"]),q=a.useRef(null);var J=a.useRef(null),K=a.useState(!1),Q=K[0],X=K[1];S&&Q&&X(!1);var Z=Object(h.a)(),ee=Z.isFocusVisible,te=Z.onBlurVisible,ne=Z.ref;function re(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E;return Object(u.a)((function(r){return t&&t(r),!n&&J.current&&J.current[e](r),!0}))}a.useImperativeHandle(n,(function(){return{focusVisible:function(){X(!0),q.current.focus()}}}),[]),a.useEffect((function(){Q&&k&&!C&&J.current.pulsate()}),[C,k,Q]);var ie=re("start",L),ae=re("stop",W),oe=re("stop",j),se=re("stop",(function(e){Q&&e.preventDefault(),N&&N(e)})),ce=re("start",H),le=re("stop",U),ue=re("stop",F),de=re("stop",(function(e){Q&&(te(e),X(!1)),x&&x(e)}),!1),he=Object(u.a)((function(e){q.current||(q.current=e.currentTarget),ee(e)&&(X(!0),I&&I(e)),O&&O(e)})),fe=function(){var e=s.findDOMNode(q.current);return y&&"button"!==y&&!("A"===e.tagName&&e.href)},pe=a.useRef(!1),me=Object(u.a)((function(e){k&&!pe.current&&Q&&J.current&&" "===e.key&&(pe.current=!0,e.persist(),J.current.stop(e,(function(){J.current.start(e)}))),e.target===e.currentTarget&&fe()&&" "===e.key&&e.preventDefault(),P&&P(e),e.target===e.currentTarget&&fe()&&"Enter"===e.key&&!S&&(e.preventDefault(),R&&R(e))})),ve=Object(u.a)((function(e){k&&" "===e.key&&J.current&&Q&&!e.defaultPrevented&&(pe.current=!1,e.persist(),J.current.stop(e,(function(){J.current.pulsate(e)}))),A&&A(e),R&&e.target===e.currentTarget&&fe()&&" "===e.key&&!e.defaultPrevented&&R(e)})),ge=y;"button"===ge&&z.href&&(ge="a");var ye={};"button"===ge?(ye.type=G,ye.disabled=S):("a"===ge&&z.href||(ye.role="button"),ye["aria-disabled"]=S);var be=Object(l.a)(o,t),Se=Object(l.a)(ne,q),_e=Object(l.a)(be,Se),Ce=a.useState(!1),we=Ce[0],Ee=Ce[1];a.useEffect((function(){Ee(!0)}),[]);var Te=we&&!C&&!S;return a.createElement(ge,Object(r.a)({className:Object(c.a)(m.root,v,Q&&[m.focusVisible,D],S&&m.disabled),onBlur:de,onClick:R,onFocus:he,onKeyDown:me,onKeyUp:ve,onMouseDown:ie,onMouseLeave:se,onMouseUp:oe,onDragLeave:ae,onTouchEnd:le,onTouchMove:ue,onTouchStart:ce,ref:_e,tabIndex:S?-1:B},ye,z),p,Te?a.createElement(M,Object(r.a)({ref:J,center:f},V)):null)}));t.a=Object(d.a)({root:{display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle","-moz-appearance":"none","-webkit-appearance":"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},"&$disabled":{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}},disabled:{},focusVisible:{}},{name:"MuiButtonBase"})(D)},,function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,s,c=o(e),l=1;l<arguments.length;l++){for(var u in n=Object(arguments[l]))i.call(n,u)&&(c[u]=n[u]);if(r){s=r(n);for(var d=0;d<s.length;d++)a.call(n,s[d])&&(c[s[d]]=n[s[d]])}}return c}},function(e,t,n){"use strict";function r(e){return function(){return null}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t,n,r,i){return null}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M19 13H5v-2h14v2z"}),"Remove");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");t.default=o},,,,,,function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(55),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(e){return r.isMemo(e)?o:s[e.$$typeof]||i}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=o;var l=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(p){var i=f(n);i&&i!==p&&e(t,i,r)}var o=u(n);d&&(o=o.concat(d(n)));for(var s=c(t),m=c(n),v=0;v<o.length;++v){var g=o[v];if(!a[g]&&(!r||!r[g])&&(!m||!m[g])&&(!s||!s[g])){var y=h(n,g);try{l(t,g,y)}catch(b){}}}}return t}},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z"}),"Headset");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}),"Help");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}),"Timer");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5z"}),"PanTool");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"}),"Menu");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"ExitToApp");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M9.93 13.5h4.14L12 7.98zM20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-4.05 16.5l-1.14-3H9.17l-1.12 3H5.96l5.11-13h1.86l5.11 13h-2.09z"}),"FontDownload");t.default=o},function(e,t,n){"use strict";var r=n(18),i=n(19);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(1)),o=(0,r(n(20)).default)(a.createElement("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"}),"Settings");t.default=o},function(e,t,n){"use strict";function r(e){for(var t="https://material-ui.com/production-error/?code="+e,n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified Material-UI error #"+e+"; visit "+t+" for the full message."}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(4),i=n(3),a=n(1),o=(n(7),n(5)),s=n(6),c=a.forwardRef((function(e,t){var n=e.classes,s=e.className,c=e.component,l=void 0===c?"div":c,u=e.square,d=void 0!==u&&u,h=e.elevation,f=void 0===h?1:h,p=e.variant,m=void 0===p?"elevation":p,v=Object(r.a)(e,["classes","className","component","square","elevation","variant"]);return a.createElement(l,Object(i.a)({className:Object(o.a)(n.root,s,"outlined"===m?n.outlined:n["elevation".concat(f)],!d&&n.rounded),ref:t},v))}));t.a=Object(s.a)((function(e){var t={};return e.shadows.forEach((function(e,n){t["elevation".concat(n)]={boxShadow:e}})),Object(i.a)({root:{backgroundColor:e.palette.background.paper,color:e.palette.text.primary,transition:e.transitions.create("box-shadow")},rounded:{borderRadius:e.shape.borderRadius},outlined:{border:"1px solid ".concat(e.palette.divider)}},t)}),{name:"MuiPaper"})(c)},function(e,t,n){"use strict";var r=n(4),i=n(3),a=n(93),o=n(1),s=(n(7),n(5)),c=n(23),l=n(41),u=n(6),d=n(9),h=n(12),f=n(46);function p(e,t){return parseInt(e[t],10)||0}var m="undefined"!==typeof window?o.useLayoutEffect:o.useEffect,v={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"},g=o.forwardRef((function(e,t){var n=e.onChange,a=e.rows,s=e.rowsMax,c=e.rowsMin,l=void 0===c?1:c,u=e.style,d=e.value,g=Object(r.a)(e,["onChange","rows","rowsMax","rowsMin","style","value"]),y=a||l,b=o.useRef(null!=d).current,S=o.useRef(null),_=Object(h.a)(t,S),C=o.useRef(null),w=o.useRef(0),E=o.useState({}),T=E[0],k=E[1],M=o.useCallback((function(){var t=S.current,n=window.getComputedStyle(t),r=C.current;r.style.width=n.width,r.value=t.value||e.placeholder||"x","\n"===r.value.slice(-1)&&(r.value+=" ");var i=n["box-sizing"],a=p(n,"padding-bottom")+p(n,"padding-top"),o=p(n,"border-bottom-width")+p(n,"border-top-width"),c=r.scrollHeight-a;r.value="x";var l=r.scrollHeight-a,u=c;y&&(u=Math.max(Number(y)*l,u)),s&&(u=Math.min(Number(s)*l,u));var d=(u=Math.max(u,l))+("border-box"===i?a+o:0),h=Math.abs(u-c)<=1;k((function(e){return w.current<20&&(d>0&&Math.abs((e.outerHeightStyle||0)-d)>1||e.overflow!==h)?(w.current+=1,{overflow:h,outerHeightStyle:d}):e}))}),[s,y,e.placeholder]);o.useEffect((function(){var e=Object(f.a)((function(){w.current=0,M()}));return window.addEventListener("resize",e),function(){e.clear(),window.removeEventListener("resize",e)}}),[M]),m((function(){M()})),o.useEffect((function(){w.current=0}),[d]);return o.createElement(o.Fragment,null,o.createElement("textarea",Object(i.a)({value:d,onChange:function(e){w.current=0,b||M(),n&&n(e)},ref:_,rows:y,style:Object(i.a)({height:T.outerHeightStyle,overflow:T.overflow?"hidden":null},u)},g)),o.createElement("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:C,tabIndex:-1,style:Object(i.a)({},v,u)}))})),y=n(42),b="undefined"===typeof window?o.useEffect:o.useLayoutEffect,S=o.forwardRef((function(e,t){var n=e["aria-describedby"],u=e.autoComplete,f=e.autoFocus,p=e.classes,m=e.className,v=(e.color,e.defaultValue),S=e.disabled,_=e.endAdornment,C=(e.error,e.fullWidth),w=void 0!==C&&C,E=e.id,T=e.inputComponent,k=void 0===T?"input":T,M=e.inputProps,D=void 0===M?{}:M,x=e.inputRef,R=(e.margin,e.multiline),O=void 0!==R&&R,I=e.name,P=e.onBlur,A=e.onChange,L=e.onClick,N=e.onFocus,j=e.onKeyDown,U=e.onKeyUp,F=e.placeholder,H=e.readOnly,W=e.renderSuffix,Y=e.rows,B=e.rowsMax,V=e.rowsMin,$=e.startAdornment,G=e.type,z=void 0===G?"text":G,q=e.value,J=Object(r.a)(e,["aria-describedby","autoComplete","autoFocus","classes","className","color","defaultValue","disabled","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","rowsMax","rowsMin","startAdornment","type","value"]),K=null!=D.value?D.value:q,Q=o.useRef(null!=K).current,X=o.useRef(),Z=o.useCallback((function(e){0}),[]),ee=Object(h.a)(D.ref,Z),te=Object(h.a)(x,ee),ne=Object(h.a)(X,te),re=o.useState(!1),ie=re[0],ae=re[1],oe=Object(l.b)();var se=Object(c.a)({props:e,muiFormControl:oe,states:["color","disabled","error","hiddenLabel","margin","required","filled"]});se.focused=oe?oe.focused:ie,o.useEffect((function(){!oe&&S&&ie&&(ae(!1),P&&P())}),[oe,S,ie,P]);var ce=oe&&oe.onFilled,le=oe&&oe.onEmpty,ue=o.useCallback((function(e){Object(y.b)(e)?ce&&ce():le&&le()}),[ce,le]);b((function(){Q&&ue({value:K})}),[K,ue,Q]);o.useEffect((function(){ue(X.current)}),[]);var de=k,he=Object(i.a)({},D,{ref:ne});"string"!==typeof de?he=Object(i.a)({inputRef:ne,type:z},he,{ref:null}):O?!Y||B||V?(he=Object(i.a)({rows:Y,rowsMax:B},he),de=g):de="textarea":he=Object(i.a)({type:z},he);return o.useEffect((function(){oe&&oe.setAdornedStart(Boolean($))}),[oe,$]),o.createElement("div",Object(i.a)({className:Object(s.a)(p.root,p["color".concat(Object(d.a)(se.color||"primary"))],m,se.disabled&&p.disabled,se.error&&p.error,w&&p.fullWidth,se.focused&&p.focused,oe&&p.formControl,O&&p.multiline,$&&p.adornedStart,_&&p.adornedEnd,"dense"===se.margin&&p.marginDense),onClick:function(e){X.current&&e.currentTarget===e.target&&X.current.focus(),L&&L(e)},ref:t},J),$,o.createElement(l.a.Provider,{value:null},o.createElement(de,Object(i.a)({"aria-invalid":se.error,"aria-describedby":n,autoComplete:u,autoFocus:f,defaultValue:v,disabled:se.disabled,id:E,onAnimationStart:function(e){ue("mui-auto-fill-cancel"===e.animationName?X.current:{value:"x"})},name:I,placeholder:F,readOnly:H,required:se.required,rows:Y,value:K,onKeyDown:j,onKeyUp:U},he,{className:Object(s.a)(p.input,D.className,se.disabled&&p.disabled,O&&p.inputMultiline,se.hiddenLabel&&p.inputHiddenLabel,$&&p.inputAdornedStart,_&&p.inputAdornedEnd,"search"===z&&p.inputTypeSearch,"dense"===se.margin&&p.inputMarginDense),onBlur:function(e){P&&P(e),D.onBlur&&D.onBlur(e),oe&&oe.onBlur?oe.onBlur(e):ae(!1)},onChange:function(e){if(!Q){var t=e.target||X.current;if(null==t)throw new Error(Object(a.a)(1));ue({value:t.value})}for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];D.onChange&&D.onChange.apply(D,[e].concat(r)),A&&A.apply(void 0,[e].concat(r))},onFocus:function(e){se.disabled?e.stopPropagation():(N&&N(e),D.onFocus&&D.onFocus(e),oe&&oe.onFocus?oe.onFocus(e):ae(!0))}}))),_,W?W(Object(i.a)({},se,{startAdornment:$})):null)}));t.a=Object(u.a)((function(e){var t="light"===e.palette.type,n={color:"currentColor",opacity:t?.42:.5,transition:e.transitions.create("opacity",{duration:e.transitions.duration.shorter})},r={opacity:"0 !important"},a={opacity:t?.42:.5};return{"@global":{"@keyframes mui-auto-fill":{},"@keyframes mui-auto-fill-cancel":{}},root:Object(i.a)({},e.typography.body1,{color:e.palette.text.primary,lineHeight:"1.1876em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center","&$disabled":{color:e.palette.text.disabled,cursor:"default"}}),formControl:{},focused:{},disabled:{},adornedStart:{},adornedEnd:{},error:{},marginDense:{},multiline:{padding:"".concat(6,"px 0 ").concat(7,"px"),"&$marginDense":{paddingTop:3}},colorSecondary:{},fullWidth:{width:"100%"},input:{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"".concat(6,"px 0 ").concat(7,"px"),border:0,boxSizing:"content-box",background:"none",height:"1.1876em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":n,"&::-moz-placeholder":n,"&:-ms-input-placeholder":n,"&::-ms-input-placeholder":n,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{"-webkit-appearance":"none"},"label[data-shrink=false] + $formControl &":{"&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&:-ms-input-placeholder":r,"&::-ms-input-placeholder":r,"&:focus::-webkit-input-placeholder":a,"&:focus::-moz-placeholder":a,"&:focus:-ms-input-placeholder":a,"&:focus::-ms-input-placeholder":a},"&$disabled":{opacity:1},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},inputMarginDense:{paddingTop:3},inputMultiline:{height:"auto",resize:"none",padding:0},inputTypeSearch:{"-moz-appearance":"textfield","-webkit-appearance":"textfield"},inputAdornedStart:{},inputAdornedEnd:{},inputHiddenLabel:{}}}),{name:"MuiInputBase"})(S)},,,,,,,,function(e,t,n){"use strict";var r=n(70),i=60103,a=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var o=60109,s=60110,c=60112;t.Suspense=60113;var l=60115,u=60116;if("function"===typeof Symbol&&Symbol.for){var d=Symbol.for;i=d("react.element"),a=d("react.portal"),t.Fragment=d("react.fragment"),t.StrictMode=d("react.strict_mode"),t.Profiler=d("react.profiler"),o=d("react.provider"),s=d("react.context"),c=d("react.forward_ref"),t.Suspense=d("react.suspense"),l=d("react.memo"),u=d("react.lazy")}var h="function"===typeof Symbol&&Symbol.iterator;function f(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function g(){}function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(f(85));this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},g.prototype=v.prototype;var b=y.prototype=new g;b.constructor=y,r(b,v.prototype),b.isPureReactComponent=!0;var S={current:null},_=Object.prototype.hasOwnProperty,C={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,n){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)_.call(t,r)&&!C.hasOwnProperty(r)&&(a[r]=t[r]);var c=arguments.length-2;if(1===c)a.children=n;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===a[r]&&(a[r]=c[r]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:S.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var T=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,n,r,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case i:case a:c=!0}}if(c)return o=o(c=e),e=""===r?"."+k(c,0):r,Array.isArray(o)?(n="",null!=e&&(n=e.replace(T,"$&/")+"/"),M(o,t,n,"",(function(e){return e}))):null!=o&&(E(o)&&(o=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(T,"$&/")+"/")+e)),t.push(o)),1;if(c=0,r=""===r?".":r+":",Array.isArray(e))for(var l=0;l<e.length;l++){var u=r+k(s=e[l],l);c+=M(s,t,n,u,o)}else if("function"===typeof(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e)))for(e=u.call(e),l=0;!(s=e.next()).done;)c+=M(s=s.value,t,n,u=r+k(s,l++),o);else if("object"===s)throw t=""+e,Error(f(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return c}function D(e,t,n){if(null==e)return e;var r=[],i=0;return M(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function x(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var R={current:null};function O(){var e=R.current;if(null===e)throw Error(f(321));return e}var I={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:S,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:D,forEach:function(e,t,n){D(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return D(e,(function(){t++})),t},toArray:function(e){return D(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error(f(143));return e}},t.Component=v,t.PureComponent=y,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(f(267,e));var a=r({},e.props),o=e.key,s=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,c=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(u in t)_.call(t,u)&&!C.hasOwnProperty(u)&&(a[u]=void 0===t[u]&&void 0!==l?l[u]:t[u])}var u=arguments.length-2;if(1===u)a.children=n;else if(1<u){l=Array(u);for(var d=0;d<u;d++)l[d]=arguments[d+2];a.children=l}return{$$typeof:i,type:e.type,key:o,ref:s,props:a,_owner:c}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:x}},t.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return O().useCallback(e,t)},t.useContext=function(e,t){return O().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return O().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return O().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return O().useLayoutEffect(e,t)},t.useMemo=function(e,t){return O().useMemo(e,t)},t.useReducer=function(e,t,n){return O().useReducer(e,t,n)},t.useRef=function(e){return O().useRef(e)},t.useState=function(e){return O().useState(e)},t.version="17.0.1"},function(e,t,n){"use strict";var r=n(1),i=n(70),a=n(105);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));var s=new Set,c={};function l(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(c[e]=t,e=0;e<t.length;e++)s.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f=Object.prototype.hasOwnProperty,p={},m={};function v(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function S(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!f.call(m,e)||!f.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,b);g[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,b);g[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,b);g[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,C=60103,w=60106,E=60107,T=60108,k=60114,M=60109,D=60110,x=60112,R=60113,O=60120,I=60115,P=60116,A=60121,L=60128,N=60129,j=60130,U=60131;if("function"===typeof Symbol&&Symbol.for){var F=Symbol.for;C=F("react.element"),w=F("react.portal"),E=F("react.fragment"),T=F("react.strict_mode"),k=F("react.profiler"),M=F("react.provider"),D=F("react.context"),x=F("react.forward_ref"),R=F("react.suspense"),O=F("react.suspense_list"),I=F("react.memo"),P=F("react.lazy"),A=F("react.block"),F("react.scope"),L=F("react.opaque.id"),N=F("react.debug_trace_mode"),j=F("react.offscreen"),U=F("react.legacy_hidden")}var H,W="function"===typeof Symbol&&Symbol.iterator;function Y(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=W&&e[W]||e["@@iterator"])?e:null}function B(e){if(void 0===H)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);H=t&&t[1]||""}return"\n"+H+e}var V=!1;function $(e,t){if(!e||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s])return"\n"+i[o].replace(" at new "," at ")}while(1<=o&&0<=s);break}}}finally{V=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?B(e):""}function G(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=$(e.type,!1);case 11:return e=$(e.type.render,!1);case 22:return e=$(e.type._render,!1);case 1:return e=$(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case E:return"Fragment";case w:return"Portal";case k:return"Profiler";case T:return"StrictMode";case R:return"Suspense";case O:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case D:return(e.displayName||"Context")+".Consumer";case M:return(e._context.displayName||"Context")+".Provider";case x:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case I:return z(e.type);case A:return z(e._render);case P:t=e._payload,e=e._init;try{return z(e(t))}catch(n){}}return null}function q(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function J(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=J(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=J(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&S(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=q(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function ae(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function oe(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ce(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function le(e,t){var n=q(t.value),r=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var de="http://www.w3.org/1999/xhtml",he="http://www.w3.org/2000/svg";function fe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?fe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var me,ve,ge=(ve=function(e,t){if(e.namespaceURI!==he||"innerHTML"in e)e.innerHTML=t;else{for((me=me||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=me.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ve(e,t)}))}:ve);function ye(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var be={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Se=["Webkit","ms","Moz","O"];function _e(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||be.hasOwnProperty(e)&&be[e]?(""+t).trim():t+"px"}function Ce(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=_e(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(be).forEach((function(e){Se.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),be[t]=be[e]}))}));var we=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ee(e,t){if(t){if(we[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function Te(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Me=null,De=null,xe=null;function Re(e){if(e=ei(e)){if("function"!==typeof Me)throw Error(o(280));var t=e.stateNode;t&&(t=ni(t),Me(e.stateNode,e.type,t))}}function Oe(e){De?xe?xe.push(e):xe=[e]:De=e}function Ie(){if(De){var e=De,t=xe;if(xe=De=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function Pe(e,t){return e(t)}function Ae(e,t,n,r,i){return e(t,n,r,i)}function Le(){}var Ne=Pe,je=!1,Ue=!1;function Fe(){null===De&&null===xe||(Le(),Ie())}function He(e,t){var n=e.stateNode;if(null===n)return null;var r=ni(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var We=!1;if(d)try{var Ye={};Object.defineProperty(Ye,"passive",{get:function(){We=!0}}),window.addEventListener("test",Ye,Ye),window.removeEventListener("test",Ye,Ye)}catch(ve){We=!1}function Be(e,t,n,r,i,a,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Ve=!1,$e=null,Ge=!1,ze=null,qe={onError:function(e){Ve=!0,$e=e}};function Je(e,t,n,r,i,a,o,s,c){Ve=!1,$e=null,Be.apply(qe,arguments)}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Xe(e){if(Ke(e)!==e)throw Error(o(188))}function Ze(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ke(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Xe(i),e;if(a===r)return Xe(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,c=i.child;c;){if(c===n){s=!0,n=i,r=a;break}if(c===r){s=!0,r=i,n=a;break}c=c.sibling}if(!s){for(c=a.child;c;){if(c===n){s=!0,n=a,r=i;break}if(c===r){s=!0,r=a,n=i;break}c=c.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var tt,nt,rt,it,at=!1,ot=[],st=null,ct=null,lt=null,ut=new Map,dt=new Map,ht=[],ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pt(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function mt(e,t){switch(e){case"focusin":case"focusout":st=null;break;case"dragenter":case"dragleave":ct=null;break;case"mouseover":case"mouseout":lt=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":dt.delete(t.pointerId)}}function vt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e=pt(t,n,r,i,a),null!==t&&(null!==(t=ei(t))&&nt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function gt(e){var t=Zr(e.target);if(null!==t){var n=Ke(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Qe(n)))return e.blockedOn=t,void it(e.lanePriority,(function(){a.unstable_runWithPriority(e.priority,(function(){rt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function yt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ei(n))&&nt(t),e.blockedOn=n,!1;t.shift()}return!0}function bt(e,t,n){yt(e)&&n.delete(t)}function St(){for(at=!1;0<ot.length;){var e=ot[0];if(null!==e.blockedOn){null!==(e=ei(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&ot.shift()}null!==st&&yt(st)&&(st=null),null!==ct&&yt(ct)&&(ct=null),null!==lt&&yt(lt)&&(lt=null),ut.forEach(bt),dt.forEach(bt)}function _t(e,t){e.blockedOn===t&&(e.blockedOn=null,at||(at=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,St)))}function Ct(e){function t(t){return _t(t,e)}if(0<ot.length){_t(ot[0],e);for(var n=1;n<ot.length;n++){var r=ot[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==st&&_t(st,e),null!==ct&&_t(ct,e),null!==lt&&_t(lt,e),ut.forEach(t),dt.forEach(t),n=0;n<ht.length;n++)(r=ht[n]).blockedOn===e&&(r.blockedOn=null);for(;0<ht.length&&null===(n=ht[0]).blockedOn;)gt(n),null===n.blockedOn&&ht.shift()}function wt(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Et={animationend:wt("Animation","AnimationEnd"),animationiteration:wt("Animation","AnimationIteration"),animationstart:wt("Animation","AnimationStart"),transitionend:wt("Transition","TransitionEnd")},Tt={},kt={};function Mt(e){if(Tt[e])return Tt[e];if(!Et[e])return e;var t,n=Et[e];for(t in n)if(n.hasOwnProperty(t)&&t in kt)return Tt[e]=n[t];return e}d&&(kt=document.createElement("div").style,"AnimationEvent"in window||(delete Et.animationend.animation,delete Et.animationiteration.animation,delete Et.animationstart.animation),"TransitionEvent"in window||delete Et.transitionend.transition);var Dt=Mt("animationend"),xt=Mt("animationiteration"),Rt=Mt("animationstart"),Ot=Mt("transitionend"),It=new Map,Pt=new Map,At=["abort","abort",Dt,"animationEnd",xt,"animationIteration",Rt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ot,"transitionEnd","waiting","waiting"];function Lt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Pt.set(r,t),It.set(r,i),l(i,[r])}}(0,a.unstable_now)();var Nt=8;function jt(e){if(0!==(1&e))return Nt=15,1;if(0!==(2&e))return Nt=14,2;if(0!==(4&e))return Nt=13,4;var t=24&e;return 0!==t?(Nt=12,t):0!==(32&e)?(Nt=11,32):0!==(t=192&e)?(Nt=10,t):0!==(256&e)?(Nt=9,256):0!==(t=3584&e)?(Nt=8,t):0!==(4096&e)?(Nt=7,4096):0!==(t=4186112&e)?(Nt=6,t):0!==(t=62914560&e)?(Nt=5,t):67108864&e?(Nt=4,67108864):0!==(134217728&e)?(Nt=3,134217728):0!==(t=805306368&e)?(Nt=2,t):0!==(1073741824&e)?(Nt=1,1073741824):(Nt=8,e)}function Ut(e,t){var n=e.pendingLanes;if(0===n)return Nt=0;var r=0,i=0,a=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(0!==a)r=a,i=Nt=15;else if(0!==(a=134217727&n)){var c=a&~o;0!==c?(r=jt(c),i=Nt):0!==(s&=a)&&(r=jt(s),i=Nt)}else 0!==(a=n&~o)?(r=jt(a),i=Nt):0!==s&&(r=jt(s),i=Nt);if(0===r)return 0;if(r=n&((0>(r=31-Vt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0===(t&o)){if(jt(t),i<=Nt)return t;Nt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Vt(t)),r|=e[n],t&=~i;return r}function Ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ht(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Wt(24&~t))?Ht(10,t):e;case 10:return 0===(e=Wt(192&~t))?Ht(8,t):e;case 8:return 0===(e=Wt(3584&~t))&&(0===(e=Wt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=Wt(805306368&~t))&&(t=268435456),t}throw Error(o(358,e))}function Wt(e){return e&-e}function Yt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Bt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-Vt(t)]=n}var Vt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-($t(e)/Gt|0)|0},$t=Math.log,Gt=Math.LN2;var zt=a.unstable_UserBlockingPriority,qt=a.unstable_runWithPriority,Jt=!0;function Kt(e,t,n,r){je||Le();var i=Xt,a=je;je=!0;try{Ae(i,e,t,n,r)}finally{(je=a)||Fe()}}function Qt(e,t,n,r){qt(zt,Xt.bind(null,e,t,n,r))}function Xt(e,t,n,r){var i;if(Jt)if((i=0===(4&t))&&0<ot.length&&-1<ft.indexOf(e))e=pt(null,e,t,n,r),ot.push(e);else{var a=Zt(e,t,n,r);if(null===a)i&&mt(e,r);else{if(i){if(-1<ft.indexOf(e))return e=pt(a,e,t,n,r),void ot.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return st=vt(st,e,t,n,r,i),!0;case"dragenter":return ct=vt(ct,e,t,n,r,i),!0;case"mouseover":return lt=vt(lt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return ut.set(a,vt(ut.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,dt.set(a,vt(dt.get(a)||null,e,t,n,r,i)),!0}return!1}(a,e,t,n,r))return;mt(e,r)}Ir(e,t,r,null,n)}}}function Zt(e,t,n,r){var i=ke(r);if(null!==(i=Zr(i))){var a=Ke(i);if(null===a)i=null;else{var o=a.tag;if(13===o){if(null!==(i=Qe(a)))return i;i=null}else if(3===o){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return Ir(e,t,r,i,n),null}var en=null,tn=null,nn=null;function rn(){if(nn)return nn;var e,t,n=tn,r=n.length,i="value"in en?en.value:en.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return nn=i.slice(e,1<t?1-t:void 0)}function an(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function on(){return!0}function sn(){return!1}function cn(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?on:sn,this.isPropagationStopped=sn,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=on)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=on)},persist:function(){},isPersistent:on}),t}var ln,un,dn,hn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fn=cn(hn),pn=i({},hn,{view:0,detail:0}),mn=cn(pn),vn=i({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dn&&(dn&&"mousemove"===e.type?(ln=e.screenX-dn.screenX,un=e.screenY-dn.screenY):un=ln=0,dn=e),ln)},movementY:function(e){return"movementY"in e?e.movementY:un}}),gn=cn(vn),yn=cn(i({},vn,{dataTransfer:0})),bn=cn(i({},pn,{relatedTarget:0})),Sn=cn(i({},hn,{animationName:0,elapsedTime:0,pseudoElement:0})),_n=cn(i({},hn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),Cn=cn(i({},hn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},En={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function Mn(){return kn}var Dn=cn(i({},pn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=an(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?En[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mn,charCode:function(e){return"keypress"===e.type?an(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?an(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),xn=cn(i({},vn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rn=cn(i({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mn})),On=cn(i({},hn,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=cn(i({},vn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Pn=[9,13,27,32],An=d&&"CompositionEvent"in window,Ln=null;d&&"documentMode"in document&&(Ln=document.documentMode);var Nn=d&&"TextEvent"in window&&!Ln,jn=d&&(!An||Ln&&8<Ln&&11>=Ln),Un=String.fromCharCode(32),Fn=!1;function Hn(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Yn=!1;var Bn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Bn[e.type]:"textarea"===t}function $n(e,t,n,r){Oe(r),0<(t=Ar(t,"onChange")).length&&(n=new fn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,zn=null;function qn(e){kr(e,0)}function Jn(e){if(Q(ti(e)))return e}function Kn(e,t){if("change"===e)return t}var Qn=!1;if(d){var Xn;if(d){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Xn=Zn}else Xn=!1;Qn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),zn=Gn=null)}function nr(e){if("value"===e.propertyName&&Jn(zn)){var t=[];if($n(t,zn,e,ke(e)),e=qn,je)e(t);else{je=!0;try{Pe(e,t)}finally{je=!1,Fe()}}}}function rr(e,t,n){"focusin"===e?(tr(),zn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(zn)}function ar(e,t){if("click"===e)return Jn(t)}function or(e,t){if("input"===e||"change"===e)return Jn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},cr=Object.prototype.hasOwnProperty;function lr(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!cr.call(t,n[r])||!sr(e[n[r]],t[n[r]]))return!1;return!0}function ur(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=ur(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ur(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mr=d&&"documentMode"in document&&11>=document.documentMode,vr=null,gr=null,yr=null,br=!1;function Sr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==vr||vr!==X(r)||("selectionStart"in(r=vr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&lr(yr,r)||(yr=r,0<(r=Ar(gr,"onSelect")).length&&(t=new fn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}Lt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Lt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Lt(At,2);for(var _r="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Cr=0;Cr<_r.length;Cr++)Pt.set(_r[Cr],0);u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Er=new Set("cancel close invalid load scroll toggle".split(" ").concat(wr));function Tr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,s,c,l){if(Je.apply(this,arguments),Ve){if(!Ve)throw Error(o(198));var u=$e;Ve=!1,$e=null,Ge||(Ge=!0,ze=u)}}(r,t,void 0,e),e.currentTarget=null}function kr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break e;Tr(i,s,l),a=c}else for(o=0;o<r.length;o++){if(c=(s=r[o]).instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break e;Tr(i,s,l),a=c}}}if(Ge)throw e=ze,Ge=!1,ze=null,e}function Mr(e,t){var n=ri(t),r=e+"__bubble";n.has(r)||(Or(t,e,2,!1),n.add(r))}var Dr="_reactListening"+Math.random().toString(36).slice(2);function xr(e){e[Dr]||(e[Dr]=!0,s.forEach((function(t){Er.has(t)||Rr(t,!1,e,null),Rr(t,!0,e,null)})))}function Rr(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=n;if("selectionchange"===e&&9!==n.nodeType&&(a=n.ownerDocument),null!==r&&!t&&Er.has(e)){if("scroll"!==e)return;i|=2,a=r}var o=ri(a),s=e+"__"+(t?"capture":"bubble");o.has(s)||(t&&(i|=4),Or(a,e,i,t),o.add(s))}function Or(e,t,n,r){var i=Pt.get(t);switch(void 0===i?2:i){case 0:i=Kt;break;case 1:i=Qt;break;default:i=Xt}n=i.bind(null,t,n,e),i=void 0,!We||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Ir(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=Zr(s)))return;if(5===(c=o.tag)||6===c){r=a=o;continue e}s=s.parentNode}}r=r.return}!function(e,t,n){if(Ue)return e(t,n);Ue=!0;try{Ne(e,t,n)}finally{Ue=!1,Fe()}}((function(){var r=a,i=ke(n),o=[];e:{var s=It.get(e);if(void 0!==s){var c=fn,l=e;switch(e){case"keypress":if(0===an(n))break e;case"keydown":case"keyup":c=Dn;break;case"focusin":l="focus",c=bn;break;case"focusout":l="blur",c=bn;break;case"beforeblur":case"afterblur":c=bn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=yn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=Rn;break;case Dt:case xt:case Rt:c=Sn;break;case Ot:c=On;break;case"scroll":c=mn;break;case"wheel":c=In;break;case"copy":case"cut":case"paste":c=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=xn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&(null!=(m=He(p,h))&&u.push(Pr(p,m,f)))),d)break;p=p.return}0<u.length&&(s=new c(s,l,null,n,i),o.push({event:s,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(l=n.relatedTarget||n.fromElement)||!Zr(l)&&!l[Qr])&&(c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?Zr(l):null)&&(l!==(d=Ke(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=r),c!==l)){if(u=gn,m="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=xn,m="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==c?s:ti(c),f=null==l?s:ti(l),(s=new u(m,p+"leave",c,n,i)).target=d,s.relatedTarget=f,m=null,Zr(i)===r&&((u=new u(h,p+"enter",l,n,i)).target=f,u.relatedTarget=d,m=u),d=m,c&&l)e:{for(h=l,p=0,f=u=c;f;f=Lr(f))p++;for(f=0,m=h;m;m=Lr(m))f++;for(;0<p-f;)u=Lr(u),p--;for(;0<f-p;)h=Lr(h),f--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Lr(u),h=Lr(h)}u=null}else u=null;null!==c&&Nr(o,s,c,u,!1),null!==l&&null!==d&&Nr(o,d,l,u,!0)}if("select"===(c=(s=r?ti(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var v=Kn;else if(Vn(s))if(Qn)v=or;else{v=ir;var g=rr}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=ar);switch(v&&(v=v(e,r))?$n(o,v,n,i):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ie(s,"number",s.value)),g=r?ti(r):window,e){case"focusin":(Vn(g)||"true"===g.contentEditable)&&(vr=g,gr=r,yr=null);break;case"focusout":yr=gr=vr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,Sr(o,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":Sr(o,n,i)}var y;if(An)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Yn?Hn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(jn&&"ko"!==n.locale&&(Yn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Yn&&(y=rn()):(tn="value"in(en=i)?en.value:en.textContent,Yn=!0)),0<(g=Ar(r,b)).length&&(b=new Cn(b,e,null,n,i),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Wn(n))&&(b.data=y))),(y=Nn?function(e,t){switch(e){case"compositionend":return Wn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Un);case"textInput":return(e=t.data)===Un&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Yn)return"compositionend"===e||!An&&Hn(e,t)?(e=rn(),nn=tn=en=null,Yn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jn&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))&&(0<(r=Ar(r,"onBeforeInput")).length&&(i=new Cn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=y))}kr(o,t)}))}function Pr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ar(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=He(e,n))&&r.unshift(Pr(e,a,i)),null!=(a=He(e,t))&&r.push(Pr(e,a,i))),e=e.return}return r}function Lr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Nr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==l&&(s=l,i?null!=(c=He(n,a))&&o.unshift(Pr(n,c,s)):i||null!=(c=He(n,a))&&o.push(Pr(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}function jr(){}var Ur=null,Fr=null;function Hr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Wr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Yr="function"===typeof setTimeout?setTimeout:void 0,Br="function"===typeof clearTimeout?clearTimeout:void 0;function Vr(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function $r(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Gr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var zr=0;var qr=Math.random().toString(36).slice(2),Jr="__reactFiber$"+qr,Kr="__reactProps$"+qr,Qr="__reactContainer$"+qr,Xr="__reactEvents$"+qr;function Zr(e){var t=e[Jr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Qr]||n[Jr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Gr(e);null!==e;){if(n=e[Jr])return n;e=Gr(e)}return t}n=(e=n).parentNode}return null}function ei(e){return!(e=e[Jr]||e[Qr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ti(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function ni(e){return e[Kr]||null}function ri(e){var t=e[Xr];return void 0===t&&(t=e[Xr]=new Set),t}var ii=[],ai=-1;function oi(e){return{current:e}}function si(e){0>ai||(e.current=ii[ai],ii[ai]=null,ai--)}function ci(e,t){ai++,ii[ai]=e.current,e.current=t}var li={},ui=oi(li),di=oi(!1),hi=li;function fi(e,t){var n=e.type.contextTypes;if(!n)return li;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function mi(){si(di),si(ui)}function vi(e,t,n){if(ui.current!==li)throw Error(o(168));ci(ui,t),ci(di,n)}function gi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in e))throw Error(o(108,z(t)||"Unknown",a));return i({},n,r)}function yi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||li,hi=ui.current,ci(ui,e),ci(di,di.current),!0}function bi(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=gi(e,t,hi),r.__reactInternalMemoizedMergedChildContext=e,si(di),si(ui),ci(ui,e)):si(di),ci(di,n)}var Si=null,_i=null,Ci=a.unstable_runWithPriority,wi=a.unstable_scheduleCallback,Ei=a.unstable_cancelCallback,Ti=a.unstable_shouldYield,ki=a.unstable_requestPaint,Mi=a.unstable_now,Di=a.unstable_getCurrentPriorityLevel,xi=a.unstable_ImmediatePriority,Ri=a.unstable_UserBlockingPriority,Oi=a.unstable_NormalPriority,Ii=a.unstable_LowPriority,Pi=a.unstable_IdlePriority,Ai={},Li=void 0!==ki?ki:function(){},Ni=null,ji=null,Ui=!1,Fi=Mi(),Hi=1e4>Fi?Mi:function(){return Mi()-Fi};function Wi(){switch(Di()){case xi:return 99;case Ri:return 98;case Oi:return 97;case Ii:return 96;case Pi:return 95;default:throw Error(o(332))}}function Yi(e){switch(e){case 99:return xi;case 98:return Ri;case 97:return Oi;case 96:return Ii;case 95:return Pi;default:throw Error(o(332))}}function Bi(e,t){return e=Yi(e),Ci(e,t)}function Vi(e,t,n){return e=Yi(e),wi(e,t,n)}function $i(){if(null!==ji){var e=ji;ji=null,Ei(e)}Gi()}function Gi(){if(!Ui&&null!==Ni){Ui=!0;var e=0;try{var t=Ni;Bi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Ni=null}catch(n){throw null!==Ni&&(Ni=Ni.slice(e+1)),wi(xi,$i),n}finally{Ui=!1}}}var zi=_.ReactCurrentBatchConfig;function qi(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Ji=oi(null),Ki=null,Qi=null,Xi=null;function Zi(){Xi=Qi=Ki=null}function ea(e){var t=Ji.current;si(Ji),e.type._context._currentValue=t}function ta(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function na(e,t){Ki=e,Xi=Qi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ao=!0),e.firstContext=null)}function ra(e,t){if(Xi!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(Xi=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Qi){if(null===Ki)throw Error(o(308));Qi=t,Ki.dependencies={lanes:0,firstContext:t,responders:null}}else Qi=Qi.next=t;return e._currentValue}var ia=!1;function aa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function sa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ca(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function la(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ua(e,t,n,r){var a=e.updateQueue;ia=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,c=a.shared.pending;if(null!==c){a.shared.pending=null;var l=c,u=l.next;l.next=null,null===s?o=u:s.next=u,s=l;var d=e.alternate;if(null!==d){var h=(d=d.updateQueue).lastBaseUpdate;h!==s&&(null===h?d.firstBaseUpdate=u:h.next=u,d.lastBaseUpdate=l)}}if(null!==o){for(h=a.baseState,s=0,d=u=l=null;;){c=o.lane;var f=o.eventTime;if((r&c)===c){null!==d&&(d=d.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,m=o;switch(c=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){h=p.call(f,h,c);break e}h=p;break e;case 3:p.flags=-4097&p.flags|64;case 0:if(null===(c="function"===typeof(p=m.payload)?p.call(f,h,c):p)||void 0===c)break e;h=i({},h,c);break e;case 2:ia=!0}}null!==o.callback&&(e.flags|=32,null===(c=a.effects)?a.effects=[o]:c.push(o))}else f={eventTime:f,lane:c,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(u=d=f,l=h):d=d.next=f,s|=c;if(null===(o=o.next)){if(null===(c=a.shared.pending))break;o=c.next,c.next=null,a.lastBaseUpdate=c,a.shared.pending=null}}null===d&&(l=h),a.baseState=l,a.firstBaseUpdate=u,a.lastBaseUpdate=d,Us|=s,e.lanes=s,e.memoizedState=h}}function da(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var ha=(new r.Component).refs;function fa(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var pa={isMounted:function(e){return!!(e=e._reactInternals)&&Ke(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=lc(),i=uc(e),a=sa(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),ca(e,a),dc(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=lc(),i=uc(e),a=sa(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),ca(e,a),dc(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=lc(),r=uc(e),i=sa(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),ca(e,i),dc(e,r,n)}};function ma(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(i,a))}function va(e,t,n){var r=!1,i=li,a=t.contextType;return"object"===typeof a&&null!==a?a=ra(a):(i=pi(t)?hi:ui.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?fi(e,i):li),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=pa,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ga(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&pa.enqueueReplaceState(t,t.state,null)}function ya(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ha,aa(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=ra(a):(a=pi(t)?hi:ui.current,i.context=fi(e,a)),ua(e,n,i,r),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(fa(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&pa.enqueueReplaceState(i,i.state,null),ua(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4)}var ba=Array.isArray;function Sa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===ha&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function _a(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Ca(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Bc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=zc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=Sa(e,t,n),r.return=e,r):((r=Vc(n.type,n.key,n.props,null,e.mode,r)).ref=Sa(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=qc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=$c(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=zc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case C:return(n=Vc(t.type,t.key,t.props,null,e.mode,n)).ref=Sa(e,null,t),n.return=e,n;case w:return(t=qc(t,e.mode,n)).return=e,t}if(ba(t)||Y(t))return(t=$c(t,e.mode,n,null)).return=e,t;_a(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case C:return n.key===i?n.type===E?d(e,t,n.props.children,r,i):l(e,t,n,r):null;case w:return n.key===i?u(e,t,n,r):null}if(ba(n)||Y(n))return null!==i?null:d(e,t,n,r,null);_a(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case C:return e=e.get(null===r.key?n:r.key)||null,r.type===E?d(t,e,r.props.children,i,r.key):l(t,e,r,i);case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(ba(r)||Y(r))return d(t,e=e.get(n)||null,r,i,null);_a(t,r)}return null}function m(i,o,s,c){for(var l=null,u=null,d=o,m=o=0,v=null;null!==d&&m<s.length;m++){d.index>m?(v=d,d=null):v=d.sibling;var g=f(i,d,s[m],c);if(null===g){null===d&&(d=v);break}e&&d&&null===g.alternate&&t(i,d),o=a(g,o,m),null===u?l=g:u.sibling=g,u=g,d=v}if(m===s.length)return n(i,d),l;if(null===d){for(;m<s.length;m++)null!==(d=h(i,s[m],c))&&(o=a(d,o,m),null===u?l=d:u.sibling=d,u=d);return l}for(d=r(i,d);m<s.length;m++)null!==(v=p(d,i,m,s[m],c))&&(e&&null!==v.alternate&&d.delete(null===v.key?m:v.key),o=a(v,o,m),null===u?l=v:u.sibling=v,u=v);return e&&d.forEach((function(e){return t(i,e)})),l}function v(i,s,c,l){var u=Y(c);if("function"!==typeof u)throw Error(o(150));if(null==(c=u.call(c)))throw Error(o(151));for(var d=u=null,m=s,v=s=0,g=null,y=c.next();null!==m&&!y.done;v++,y=c.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=f(i,m,y.value,l);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(i,m),s=a(b,s,v),null===d?u=b:d.sibling=b,d=b,m=g}if(y.done)return n(i,m),u;if(null===m){for(;!y.done;v++,y=c.next())null!==(y=h(i,y.value,l))&&(s=a(y,s,v),null===d?u=y:d.sibling=y,d=y);return u}for(m=r(i,m);!y.done;v++,y=c.next())null!==(y=p(m,i,v,y.value,l))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=a(y,s,v),null===d?u=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(i,e)})),u}return function(e,r,a,c){var l="object"===typeof a&&null!==a&&a.type===E&&null===a.key;l&&(a=a.props.children);var u="object"===typeof a&&null!==a;if(u)switch(a.$$typeof){case C:e:{for(u=a.key,l=r;null!==l;){if(l.key===u){switch(l.tag){case 7:if(a.type===E){n(e,l.sibling),(r=i(l,a.props.children)).return=e,e=r;break e}break;default:if(l.elementType===a.type){n(e,l.sibling),(r=i(l,a.props)).ref=Sa(e,l,a),r.return=e,e=r;break e}}n(e,l);break}t(e,l),l=l.sibling}a.type===E?((r=$c(a.props.children,e.mode,c,a.key)).return=e,e=r):((c=Vc(a.type,a.key,a.props,null,e.mode,c)).ref=Sa(e,r,a),c.return=e,e=c)}return s(e);case w:e:{for(l=a.key;null!==r;){if(r.key===l){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(e,r.sibling),(r=i(r,a.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=qc(a,e.mode,c)).return=e,e=r}return s(e)}if("string"===typeof a||"number"===typeof a)return a=""+a,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,a)).return=e,e=r):(n(e,r),(r=zc(a,e.mode,c)).return=e,e=r),s(e);if(ba(a))return m(e,r,a,c);if(Y(a))return v(e,r,a,c);if(u&&_a(e,a),"undefined"===typeof a&&!l)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,z(e.type)||"Component"))}return n(e,r)}}var wa=Ca(!0),Ea=Ca(!1),Ta={},ka=oi(Ta),Ma=oi(Ta),Da=oi(Ta);function xa(e){if(e===Ta)throw Error(o(174));return e}function Ra(e,t){switch(ci(Da,t),ci(Ma,e),ci(ka,Ta),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:pe(null,"");break;default:t=pe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}si(ka),ci(ka,t)}function Oa(){si(ka),si(Ma),si(Da)}function Ia(e){xa(Da.current);var t=xa(ka.current),n=pe(t,e.type);t!==n&&(ci(Ma,e),ci(ka,n))}function Pa(e){Ma.current===e&&(si(ka),si(Ma))}var Aa=oi(0);function La(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Na=null,ja=null,Ua=!1;function Fa(e,t){var n=Wc(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ha(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Wa(e){if(Ua){var t=ja;if(t){var n=t;if(!Ha(e,t)){if(!(t=$r(n.nextSibling))||!Ha(e,t))return e.flags=-1025&e.flags|2,Ua=!1,void(Na=e);Fa(Na,n)}Na=e,ja=$r(t.firstChild)}else e.flags=-1025&e.flags|2,Ua=!1,Na=e}}function Ya(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Na=e}function Ba(e){if(e!==Na)return!1;if(!Ua)return Ya(e),Ua=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Wr(t,e.memoizedProps))for(t=ja;t;)Fa(e,t),t=$r(t.nextSibling);if(Ya(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ja=$r(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ja=null}}else ja=Na?$r(e.stateNode.nextSibling):null;return!0}function Va(){ja=Na=null,Ua=!1}var $a=[];function Ga(){for(var e=0;e<$a.length;e++)$a[e]._workInProgressVersionPrimary=null;$a.length=0}var za=_.ReactCurrentDispatcher,qa=_.ReactCurrentBatchConfig,Ja=0,Ka=null,Qa=null,Xa=null,Za=!1,eo=!1;function to(){throw Error(o(321))}function no(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function ro(e,t,n,r,i,a){if(Ja=a,Ka=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,za.current=null===e||null===e.memoizedState?Ro:Oo,e=n(r,i),eo){a=0;do{if(eo=!1,!(25>a))throw Error(o(301));a+=1,Xa=Qa=null,t.updateQueue=null,za.current=Io,e=n(r,i)}while(eo)}if(za.current=xo,t=null!==Qa&&null!==Qa.next,Ja=0,Xa=Qa=Ka=null,Za=!1,t)throw Error(o(300));return e}function io(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Xa?Ka.memoizedState=Xa=e:Xa=Xa.next=e,Xa}function ao(){if(null===Qa){var e=Ka.alternate;e=null!==e?e.memoizedState:null}else e=Qa.next;var t=null===Xa?Ka.memoizedState:Xa.next;if(null!==t)Xa=t,Qa=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Qa=e).memoizedState,baseState:Qa.baseState,baseQueue:Qa.baseQueue,queue:Qa.queue,next:null},null===Xa?Ka.memoizedState=Xa=e:Xa=Xa.next=e}return Xa}function oo(e,t){return"function"===typeof t?t(e):t}function so(e){var t=ao(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=Qa,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var c=s=a=null,l=i;do{var u=l.lane;if((Ja&u)===u)null!==c&&(c=c.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),r=l.eagerReducer===e?l.eagerState:e(r,l.action);else{var d={lane:u,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};null===c?(s=c=d,a=r):c=c.next=d,Ka.lanes|=u,Us|=u}l=l.next}while(null!==l&&l!==i);null===c?a=r:c.next=s,sr(r,t.memoizedState)||(Ao=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function co(e){var t=ao(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);sr(a,t.memoizedState)||(Ao=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function lo(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=(Ja&e)===e)&&(t._workInProgressVersionPrimary=r,$a.push(t))),e)return n(t._source);throw $a.push(t),Error(o(350))}function uo(e,t,n,r){var i=Rs;if(null===i)throw Error(o(349));var a=t._getVersion,s=a(t._source),c=za.current,l=c.useState((function(){return lo(i,t,n)})),u=l[1],d=l[0];l=Xa;var h=e.memoizedState,f=h.refs,p=f.getSnapshot,m=h.source;h=h.subscribe;var v=Ka;return e.memoizedState={refs:f,source:t,subscribe:r},c.useEffect((function(){f.getSnapshot=n,f.setSnapshot=u;var e=a(t._source);if(!sr(s,e)){e=n(t._source),sr(d,e)||(u(e),e=uc(v),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,o=e;0<o;){var c=31-Vt(o),l=1<<c;r[c]|=e,o&=~l}}}),[n,t,r]),c.useEffect((function(){return r(t._source,(function(){var e=f.getSnapshot,n=f.setSnapshot;try{n(e(t._source));var r=uc(v);i.mutableReadLanes|=r&i.pendingLanes}catch(a){n((function(){throw a}))}}))}),[t,r]),sr(p,n)&&sr(m,t)&&sr(h,r)||((e={pending:null,dispatch:null,lastRenderedReducer:oo,lastRenderedState:d}).dispatch=u=Do.bind(null,Ka,e),l.queue=e,l.baseQueue=null,d=lo(i,t,n),l.memoizedState=l.baseState=d),d}function ho(e,t,n){return uo(ao(),e,t,n)}function fo(e){var t=io();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:oo,lastRenderedState:e}).dispatch=Do.bind(null,Ka,e),[t.memoizedState,e]}function po(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Ka.updateQueue)?(t={lastEffect:null},Ka.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function mo(e){return e={current:e},io().memoizedState=e}function vo(){return ao().memoizedState}function go(e,t,n,r){var i=io();Ka.flags|=e,i.memoizedState=po(1|t,n,void 0,void 0===r?null:r)}function yo(e,t,n,r){var i=ao();r=void 0===r?null:r;var a=void 0;if(null!==Qa){var o=Qa.memoizedState;if(a=o.destroy,null!==r&&no(r,o.deps))return void po(t,n,a,r)}Ka.flags|=e,i.memoizedState=po(1|t,n,a,r)}function bo(e,t){return go(516,4,e,t)}function So(e,t){return yo(516,4,e,t)}function _o(e,t){return yo(4,2,e,t)}function Co(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function wo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,yo(4,2,Co.bind(null,t,e),n)}function Eo(){}function To(e,t){var n=ao();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&no(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ko(e,t){var n=ao();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&no(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Mo(e,t){var n=Wi();Bi(98>n?98:n,(function(){e(!0)})),Bi(97<n?97:n,(function(){var n=qa.transition;qa.transition=1;try{e(!1),t()}finally{qa.transition=n}}))}function Do(e,t,n){var r=lc(),i=uc(e),a={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(null===o?a.next=a:(a.next=o.next,o.next=a),t.pending=a,o=e.alternate,e===Ka||null!==o&&o===Ka)eo=Za=!0;else{if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,c=o(s,n);if(a.eagerReducer=o,a.eagerState=c,sr(c,s))return}catch(l){}dc(e,i,r)}}var xo={readContext:ra,useCallback:to,useContext:to,useEffect:to,useImperativeHandle:to,useLayoutEffect:to,useMemo:to,useReducer:to,useRef:to,useState:to,useDebugValue:to,useDeferredValue:to,useTransition:to,useMutableSource:to,useOpaqueIdentifier:to,unstable_isNewReconciler:!1},Ro={readContext:ra,useCallback:function(e,t){return io().memoizedState=[e,void 0===t?null:t],e},useContext:ra,useEffect:bo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,go(4,2,Co.bind(null,t,e),n)},useLayoutEffect:function(e,t){return go(4,2,e,t)},useMemo:function(e,t){var n=io();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=io();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Do.bind(null,Ka,e),[r.memoizedState,e]},useRef:mo,useState:fo,useDebugValue:Eo,useDeferredValue:function(e){var t=fo(e),n=t[0],r=t[1];return bo((function(){var t=qa.transition;qa.transition=1;try{r(e)}finally{qa.transition=t}}),[e]),n},useTransition:function(){var e=fo(!1),t=e[0];return mo(e=Mo.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=io();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},uo(r,e,t,n)},useOpaqueIdentifier:function(){if(Ua){var e=!1,t=function(e){return{$$typeof:L,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(zr++).toString(36))),Error(o(355))})),n=fo(t)[1];return 0===(2&Ka.mode)&&(Ka.flags|=516,po(5,(function(){n("r:"+(zr++).toString(36))}),void 0,null)),t}return fo(t="r:"+(zr++).toString(36)),t},unstable_isNewReconciler:!1},Oo={readContext:ra,useCallback:To,useContext:ra,useEffect:So,useImperativeHandle:wo,useLayoutEffect:_o,useMemo:ko,useReducer:so,useRef:vo,useState:function(){return so(oo)},useDebugValue:Eo,useDeferredValue:function(e){var t=so(oo),n=t[0],r=t[1];return So((function(){var t=qa.transition;qa.transition=1;try{r(e)}finally{qa.transition=t}}),[e]),n},useTransition:function(){var e=so(oo)[0];return[vo().current,e]},useMutableSource:ho,useOpaqueIdentifier:function(){return so(oo)[0]},unstable_isNewReconciler:!1},Io={readContext:ra,useCallback:To,useContext:ra,useEffect:So,useImperativeHandle:wo,useLayoutEffect:_o,useMemo:ko,useReducer:co,useRef:vo,useState:function(){return co(oo)},useDebugValue:Eo,useDeferredValue:function(e){var t=co(oo),n=t[0],r=t[1];return So((function(){var t=qa.transition;qa.transition=1;try{r(e)}finally{qa.transition=t}}),[e]),n},useTransition:function(){var e=co(oo)[0];return[vo().current,e]},useMutableSource:ho,useOpaqueIdentifier:function(){return co(oo)[0]},unstable_isNewReconciler:!1},Po=_.ReactCurrentOwner,Ao=!1;function Lo(e,t,n,r){t.child=null===e?Ea(t,null,n,r):wa(t,e.child,n,r)}function No(e,t,n,r,i){n=n.render;var a=t.ref;return na(t,i),r=ro(e,t,n,r,a,i),null===e||Ao?(t.flags|=1,Lo(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ns(e,t,i))}function jo(e,t,n,r,i,a){if(null===e){var o=n.type;return"function"!==typeof o||Yc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Vc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Uo(e,t,o,r,i,a))}return o=e.child,0===(i&a)&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:lr)(i,r)&&e.ref===t.ref)?ns(e,t,a):(t.flags|=1,(e=Bc(o,r)).ref=t.ref,e.return=t,t.child=e)}function Uo(e,t,n,r,i,a){if(null!==e&&lr(e.memoizedProps,r)&&e.ref===t.ref){if(Ao=!1,0===(a&i))return t.lanes=e.lanes,ns(e,t,a);0!==(16384&e.flags)&&(Ao=!0)}return Wo(e,t,n,r,a)}function Fo(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},bc(t,n);else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},bc(t,e),null;t.memoizedState={baseLanes:0},bc(t,null!==a?a.baseLanes:n)}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,bc(t,r);return Lo(e,t,i,n),t.child}function Ho(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Wo(e,t,n,r,i){var a=pi(n)?hi:ui.current;return a=fi(t,a),na(t,i),n=ro(e,t,n,r,a,i),null===e||Ao?(t.flags|=1,Lo(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ns(e,t,i))}function Yo(e,t,n,r,i){if(pi(n)){var a=!0;yi(t)}else a=!1;if(na(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),va(t,n,r),ya(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=ra(l):l=fi(t,l=pi(n)?hi:ui.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==l)&&ga(t,o,r,l),ia=!1;var h=t.memoizedState;o.state=h,ua(t,r,o,i),c=t.memoizedState,s!==r||h!==c||di.current||ia?("function"===typeof u&&(fa(t,n,u,r),c=t.memoizedState),(s=ia||ma(t,n,s,r,h,c,l))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4)):("function"===typeof o.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4),r=!1)}else{o=t.stateNode,oa(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:qi(t.type,s),o.props=l,d=t.pendingProps,h=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=ra(c):c=fi(t,c=pi(n)?hi:ui.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==d||h!==c)&&ga(t,o,r,c),ia=!1,h=t.memoizedState,o.state=h,ua(t,r,o,i);var p=t.memoizedState;s!==d||h!==p||di.current||ia?("function"===typeof f&&(fa(t,n,f,r),p=t.memoizedState),(l=ia||ma(t,n,l,r,h,p,c))?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),r=!1)}return Bo(e,t,n,r,a,i)}function Bo(e,t,n,r,i,a){Ho(e,t);var o=0!==(64&t.flags);if(!r&&!o)return i&&bi(t,n,!1),ns(e,t,a);r=t.stateNode,Po.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=wa(t,e.child,null,a),t.child=wa(t,null,s,a)):Lo(e,t,s,a),t.memoizedState=r.state,i&&bi(t,n,!0),t.child}function Vo(e){var t=e.stateNode;t.pendingContext?vi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&vi(0,t.context,!1),Ra(e,t.containerInfo)}var $o,Go,zo,qo={dehydrated:null,retryLane:0};function Jo(e,t,n){var r,i=t.pendingProps,a=Aa.current,o=!1;return(r=0!==(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(a|=1),ci(Aa,1&a),null===e?(void 0!==i.fallback&&Wa(t),e=i.children,a=i.fallback,o?(e=Ko(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=qo,e):"number"===typeof i.unstable_expectedLoadTime?(e=Ko(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=qo,t.lanes=33554432,e):((n=Gc({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,o?(i=Xo(e,t,i.children,i.fallback,n),o=t.child,a=e.child.memoizedState,o.memoizedState=null===a?{baseLanes:n}:{baseLanes:a.baseLanes|n},o.childLanes=e.childLanes&~n,t.memoizedState=qo,i):(n=Qo(e,t,i.children,n),t.memoizedState=null,n))}function Ko(e,t,n,r){var i=e.mode,a=e.child;return t={mode:"hidden",children:t},0===(2&i)&&null!==a?(a.childLanes=0,a.pendingProps=t):a=Gc(t,i,0,null),n=$c(n,i,r,null),a.return=e,n.return=e,a.sibling=n,e.child=a,n}function Qo(e,t,n,r){var i=e.child;return e=i.sibling,n=Bc(i,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function Xo(e,t,n,r,i){var a=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:n};return 0===(2&a)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=s,null!==(o=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Bc(o,s),null!==e?r=Bc(e,r):(r=$c(r,a,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function Zo(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),ta(e.return,t)}function es(e,t,n,r,i,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i,o.lastEffect=a)}function ts(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(Lo(e,t,r.children,n),0!==(2&(r=Aa.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Zo(e,n);else if(19===e.tag)Zo(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ci(Aa,r),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===La(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),es(t,!1,i,n,a,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===La(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}es(t,!0,n,null,a,t.lastEffect);break;case"together":es(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ns(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Us|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Bc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Bc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function rs(e,t){if(!Ua)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function is(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return pi(t.type)&&mi(),null;case 3:return Oa(),si(di),si(ui),Ga(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Ba(t)?t.flags|=4:r.hydrate||(t.flags|=256)),null;case 5:Pa(t);var a=xa(Da.current);if(n=t.type,null!==e&&null!=t.stateNode)Go(e,t,n,r),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=xa(ka.current),Ba(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[Jr]=t,r[Kr]=s,n){case"dialog":Mr("cancel",r),Mr("close",r);break;case"iframe":case"object":case"embed":Mr("load",r);break;case"video":case"audio":for(e=0;e<wr.length;e++)Mr(wr[e],r);break;case"source":Mr("error",r);break;case"img":case"image":case"link":Mr("error",r),Mr("load",r);break;case"details":Mr("toggle",r);break;case"input":ee(r,s),Mr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Mr("invalid",r);break;case"textarea":ce(r,s),Mr("invalid",r)}for(var l in Ee(n,s),e=null,s)s.hasOwnProperty(l)&&(a=s[l],"children"===l?"string"===typeof a?r.textContent!==a&&(e=["children",a]):"number"===typeof a&&r.textContent!==""+a&&(e=["children",""+a]):c.hasOwnProperty(l)&&null!=a&&"onScroll"===l&&Mr("scroll",r));switch(n){case"input":K(r),re(r,s,!0);break;case"textarea":K(r),ue(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=jr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(l=9===a.nodeType?a:a.ownerDocument,e===de&&(e=fe(n)),e===de?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[Jr]=t,e[Kr]=r,$o(e,t),t.stateNode=e,l=Te(n,r),n){case"dialog":Mr("cancel",e),Mr("close",e),a=r;break;case"iframe":case"object":case"embed":Mr("load",e),a=r;break;case"video":case"audio":for(a=0;a<wr.length;a++)Mr(wr[a],e);a=r;break;case"source":Mr("error",e),a=r;break;case"img":case"image":case"link":Mr("error",e),Mr("load",e),a=r;break;case"details":Mr("toggle",e),a=r;break;case"input":ee(e,r),a=Z(e,r),Mr("invalid",e);break;case"option":a=ae(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=i({},r,{value:void 0}),Mr("invalid",e);break;case"textarea":ce(e,r),a=se(e,r),Mr("invalid",e);break;default:a=r}Ee(n,a);var u=a;for(s in u)if(u.hasOwnProperty(s)){var d=u[s];"style"===s?Ce(e,d):"dangerouslySetInnerHTML"===s?null!=(d=d?d.__html:void 0)&&ge(e,d):"children"===s?"string"===typeof d?("textarea"!==n||""!==d)&&ye(e,d):"number"===typeof d&&ye(e,""+d):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(c.hasOwnProperty(s)?null!=d&&"onScroll"===s&&Mr("scroll",e):null!=d&&S(e,s,d,l))}switch(n){case"input":K(e),re(e,r,!1);break;case"textarea":K(e),ue(e);break;case"option":null!=r.value&&e.setAttribute("value",""+q(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?oe(e,!!r.multiple,s,!1):null!=r.defaultValue&&oe(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=jr)}Hr(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)zo(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));n=xa(Da.current),xa(ka.current),Ba(t)?(r=t.stateNode,n=t.memoizedProps,r[Jr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Jr]=t,t.stateNode=r)}return null;case 13:return si(Aa),r=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Ba(t):n=null!==e.memoizedState,r&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Aa.current)?0===Ls&&(Ls=3):(0!==Ls&&3!==Ls||(Ls=4),null===Rs||0===(134217727&Us)&&0===(134217727&Fs)||mc(Rs,Is))),(r||n)&&(t.flags|=4),null);case 4:return Oa(),null===e&&xr(t.stateNode.containerInfo),null;case 10:return ea(t),null;case 17:return pi(t.type)&&mi(),null;case 19:if(si(Aa),null===(r=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(l=r.rendering))if(s)rs(r,!1);else{if(0!==Ls||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(l=La(e))){for(t.flags|=64,rs(r,!1),null!==(s=l.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ci(Aa,1&Aa.current|2),t.child}e=e.sibling}null!==r.tail&&Hi()>Bs&&(t.flags|=64,s=!0,rs(r,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=La(l))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),rs(r,!0),null===r.tail&&"hidden"===r.tailMode&&!l.alternate&&!Ua)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Hi()-r.renderingStartTime>Bs&&1073741824!==n&&(t.flags|=64,s=!0,rs(r,!1),t.lanes=33554432);r.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=r.last)?n.sibling=l:t.child=l,r.last=l)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Hi(),n.sibling=null,t=Aa.current,ci(Aa,s?1&t|2:1&t),n):null;case 23:case 24:return Sc(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(o(156,t.tag))}function as(e){switch(e.tag){case 1:pi(e.type)&&mi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Oa(),si(di),si(ui),Ga(),0!==(64&(t=e.flags)))throw Error(o(285));return e.flags=-4097&t|64,e;case 5:return Pa(e),null;case 13:return si(Aa),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return si(Aa),null;case 4:return Oa(),null;case 10:return ea(e),null;case 23:case 24:return Sc(),null;default:return null}}function os(e,t){try{var n="",r=t;do{n+=G(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i}}function ss(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}$o=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Go=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,xa(ka.current);var o,s=null;switch(n){case"input":a=Z(e,a),r=Z(e,r),s=[];break;case"option":a=ae(e,a),r=ae(e,r),s=[];break;case"select":a=i({},a,{value:void 0}),r=i({},r,{value:void 0}),s=[];break;case"textarea":a=se(e,a),r=se(e,r),s=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=jr)}for(d in Ee(n,r),n=null,a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&null!=a[d])if("style"===d){var l=a[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(c.hasOwnProperty(d)?s||(s=[]):(s=s||[]).push(d,null));for(d in r){var u=r[d];if(l=null!=a?a[d]:void 0,r.hasOwnProperty(d)&&u!==l&&(null!=u||null!=l))if("style"===d)if(l){for(o in l)!l.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in u)u.hasOwnProperty(o)&&l[o]!==u[o]&&(n||(n={}),n[o]=u[o])}else n||(s||(s=[]),s.push(d,n)),n=u;else"dangerouslySetInnerHTML"===d?(u=u?u.__html:void 0,l=l?l.__html:void 0,null!=u&&l!==u&&(s=s||[]).push(d,u)):"children"===d?"string"!==typeof u&&"number"!==typeof u||(s=s||[]).push(d,""+u):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(c.hasOwnProperty(d)?(null!=u&&"onScroll"===d&&Mr("scroll",e),s||l===u||(s=[])):"object"===typeof u&&null!==u&&u.$$typeof===L?u.toString():(s=s||[]).push(d,u))}n&&(s=s||[]).push("style",n);var d=s;(t.updateQueue=d)&&(t.flags|=4)}},zo=function(e,t,n,r){n!==r&&(t.flags|=4)};var cs="function"===typeof WeakMap?WeakMap:Map;function ls(e,t,n){(n=sa(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){zs||(zs=!0,qs=r),ss(0,t)},n}function us(e,t,n){(n=sa(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return ss(0,t),r(i)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Js?Js=new Set([this]):Js.add(this),ss(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var ds="function"===typeof WeakSet?WeakSet:Set;function hs(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){jc(e,n)}else t.current=null}function fs(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:qi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Vr(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(o(163))}function ps(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!==(4&(i=i.tag))&&0!==(1&i)&&(Ac(n,e),Pc(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:qi(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&da(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}da(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Hr(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Ct(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(o(163))}function ms(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"===typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty("display")?i.display:null,r.style.display=_e("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function vs(e,t){if(_i&&"function"===typeof _i.onCommitFiberUnmount)try{_i.onCommitFiberUnmount(Si,t)}catch(a){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!==(4&r))Ac(t,n);else{r=t;try{i()}catch(a){jc(r,a)}}n=n.next}while(n!==e)}break;case 1:if(hs(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(a){jc(t,a)}break;case 5:hs(t);break;case 4:Cs(e,t)}}function gs(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function ys(e){return 5===e.tag||3===e.tag||4===e.tag}function bs(e){e:{for(var t=e.return;null!==t;){if(ys(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.flags&&(ye(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ys(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?Ss(e,n,t):_s(e,n,t)}function Ss(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=jr));else if(4!==r&&null!==(e=e.child))for(Ss(e,t,n),e=e.sibling;null!==e;)Ss(e,t,n),e=e.sibling}function _s(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(_s(e,t,n),e=e.sibling;null!==e;)_s(e,t,n),e=e.sibling}function Cs(e,t){for(var n,r,i=t,a=!1;;){if(!a){a=i.return;e:for(;;){if(null===a)throw Error(o(160));switch(n=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===i.tag||6===i.tag){e:for(var s=e,c=i,l=c;;)if(vs(s,l),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===c)break e;for(;null===l.sibling;){if(null===l.return||l.return===c)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}r?(s=n,c=i.stateNode,8===s.nodeType?s.parentNode.removeChild(c):s.removeChild(c)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(vs(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(a=!1)}i.sibling.return=i.return,i=i.sibling}}function ws(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3===(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var a=t.updateQueue;if(t.updateQueue=null,null!==a){for(n[Kr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),Te(e,i),t=Te(e,r),i=0;i<a.length;i+=2){var s=a[i],c=a[i+1];"style"===s?Ce(n,c):"dangerouslySetInnerHTML"===s?ge(n,c):"children"===s?ye(n,c):S(n,s,c,t)}switch(e){case"input":ne(n,r);break;case"textarea":le(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(a=r.value)?oe(n,!!r.multiple,a,!1):e!==!!r.multiple&&(null!=r.defaultValue?oe(n,!!r.multiple,r.defaultValue,!0):oe(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,Ct(n.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Ys=Hi(),ms(t.child,!0)),void Es(t);case 19:return void Es(t);case 17:return;case 23:case 24:return void ms(t,null!==t.memoizedState)}throw Error(o(163))}function Es(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ds),t.forEach((function(t){var r=Fc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function Ts(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var ks=Math.ceil,Ms=_.ReactCurrentDispatcher,Ds=_.ReactCurrentOwner,xs=0,Rs=null,Os=null,Is=0,Ps=0,As=oi(0),Ls=0,Ns=null,js=0,Us=0,Fs=0,Hs=0,Ws=null,Ys=0,Bs=1/0;function Vs(){Bs=Hi()+500}var $s,Gs=null,zs=!1,qs=null,Js=null,Ks=!1,Qs=null,Xs=90,Zs=[],ec=[],tc=null,nc=0,rc=null,ic=-1,ac=0,oc=0,sc=null,cc=!1;function lc(){return 0!==(48&xs)?Hi():-1!==ic?ic:ic=Hi()}function uc(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Wi()?1:2;if(0===ac&&(ac=js),0!==zi.transition){0!==oc&&(oc=null!==Ws?Ws.pendingLanes:0),e=ac;var t=4186112&~oc;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Wi(),0!==(4&xs)&&98===e?e=Ht(12,ac):e=Ht(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),ac),e}function dc(e,t,n){if(50<nc)throw nc=0,rc=null,Error(o(185));if(null===(e=hc(e,t)))return null;Bt(e,t,n),e===Rs&&(Fs|=t,4===Ls&&mc(e,Is));var r=Wi();1===t?0!==(8&xs)&&0===(48&xs)?vc(e):(fc(e,n),0===xs&&(Vs(),$i())):(0===(4&xs)||98!==r&&99!==r||(null===tc?tc=new Set([e]):tc.add(e)),fc(e,n)),Ws=e}function hc(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function fc(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var c=31-Vt(s),l=1<<c,u=a[c];if(-1===u){if(0===(l&r)||0!==(l&i)){u=t,jt(l);var d=Nt;a[c]=10<=d?u+250:6<=d?u+5e3:-1}}else u<=t&&(e.expiredLanes|=l);s&=~l}if(r=Ut(e,e===Rs?Is:0),t=Nt,0===r)null!==n&&(n!==Ai&&Ei(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Ai&&Ei(n)}15===t?(n=vc.bind(null,e),null===Ni?(Ni=[n],ji=wi(xi,Gi)):Ni.push(n),n=Ai):14===t?n=Vi(99,vc.bind(null,e)):n=Vi(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,e))}}(t),pc.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function pc(e){if(ic=-1,oc=ac=0,0!==(48&xs))throw Error(o(327));var t=e.callbackNode;if(Ic()&&e.callbackNode!==t)return null;var n=Ut(e,e===Rs?Is:0);if(0===n)return null;var r=n,i=xs;xs|=16;var a=wc();for(Rs===e&&Is===r||(Vs(),_c(e,r));;)try{kc();break}catch(c){Cc(e,c)}if(Zi(),Ms.current=a,xs=i,null!==Os?r=0:(Rs=null,Is=0,r=Ls),0!==(js&Fs))_c(e,0);else if(0!==r){if(2===r&&(xs|=64,e.hydrate&&(e.hydrate=!1,Vr(e.containerInfo)),0!==(n=Ft(e))&&(r=Ec(e,n))),1===r)throw t=Ns,_c(e,0),mc(e,n),fc(e,Hi()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(o(345));case 2:xc(e);break;case 3:if(mc(e,n),(62914560&n)===n&&10<(r=Ys+500-Hi())){if(0!==Ut(e,0))break;if(((i=e.suspendedLanes)&n)!==n){lc(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Yr(xc.bind(null,e),r);break}xc(e);break;case 4:if(mc(e,n),(4186112&n)===n)break;for(r=e.eventTimes,i=-1;0<n;){var s=31-Vt(n);a=1<<s,(s=r[s])>i&&(i=s),n&=~a}if(n=i,10<(n=(120>(n=Hi()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*ks(n/1960))-n)){e.timeoutHandle=Yr(xc.bind(null,e),n);break}xc(e);break;case 5:xc(e);break;default:throw Error(o(329))}}return fc(e,Hi()),e.callbackNode===t?pc.bind(null,e):null}function mc(e,t){for(t&=~Hs,t&=~Fs,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Vt(t),r=1<<n;e[n]=-1,t&=~r}}function vc(e){if(0!==(48&xs))throw Error(o(327));if(Ic(),e===Rs&&0!==(e.expiredLanes&Is)){var t=Is,n=Ec(e,t);0!==(js&Fs)&&(n=Ec(e,t=Ut(e,t)))}else n=Ec(e,t=Ut(e,0));if(0!==e.tag&&2===n&&(xs|=64,e.hydrate&&(e.hydrate=!1,Vr(e.containerInfo)),0!==(t=Ft(e))&&(n=Ec(e,t))),1===n)throw n=Ns,_c(e,0),mc(e,t),fc(e,Hi()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e),fc(e,Hi()),null}function gc(e,t){var n=xs;xs|=1;try{return e(t)}finally{0===(xs=n)&&(Vs(),$i())}}function yc(e,t){var n=xs;xs&=-2,xs|=8;try{return e(t)}finally{0===(xs=n)&&(Vs(),$i())}}function bc(e,t){ci(As,Ps),Ps|=t,js|=t}function Sc(){Ps=As.current,si(As)}function _c(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Br(n)),null!==Os)for(n=Os.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&mi();break;case 3:Oa(),si(di),si(ui),Ga();break;case 5:Pa(r);break;case 4:Oa();break;case 13:case 19:si(Aa);break;case 10:ea(r);break;case 23:case 24:Sc()}n=n.return}Rs=e,Os=Bc(e.current,null),Is=Ps=js=t,Ls=0,Ns=null,Hs=Fs=Us=0}function Cc(e,t){for(;;){var n=Os;try{if(Zi(),za.current=xo,Za){for(var r=Ka.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}Za=!1}if(Ja=0,Xa=Qa=Ka=null,eo=!1,Ds.current=null,null===n||null===n.return){Ls=1,Ns=t,Os=null;break}e:{var a=e,o=n.return,s=n,c=t;if(t=Is,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c;if(0===(2&s.mode)){var u=s.alternate;u?(s.updateQueue=u.updateQueue,s.memoizedState=u.memoizedState,s.lanes=u.lanes):(s.updateQueue=null,s.memoizedState=null)}var d=0!==(1&Aa.current),h=o;do{var f;if(f=13===h.tag){var p=h.memoizedState;if(null!==p)f=null!==p.dehydrated;else{var m=h.memoizedProps;f=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!d)}}if(f){var v=h.updateQueue;if(null===v){var g=new Set;g.add(l),h.updateQueue=g}else v.add(l);if(0===(2&h.mode)){if(h.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var y=sa(-1,1);y.tag=2,ca(s,y)}s.lanes|=1;break e}c=void 0,s=t;var b=a.pingCache;if(null===b?(b=a.pingCache=new cs,c=new Set,b.set(l,c)):void 0===(c=b.get(l))&&(c=new Set,b.set(l,c)),!c.has(s)){c.add(s);var S=Uc.bind(null,a,l,s);l.then(S,S)}h.flags|=4096,h.lanes=t;break e}h=h.return}while(null!==h);c=Error((z(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Ls&&(Ls=2),c=os(c,s),h=o;do{switch(h.tag){case 3:a=c,h.flags|=4096,t&=-t,h.lanes|=t,la(h,ls(0,a,t));break e;case 1:a=c;var _=h.type,C=h.stateNode;if(0===(64&h.flags)&&("function"===typeof _.getDerivedStateFromError||null!==C&&"function"===typeof C.componentDidCatch&&(null===Js||!Js.has(C)))){h.flags|=4096,t&=-t,h.lanes|=t,la(h,us(h,a,t));break e}}h=h.return}while(null!==h)}Dc(n)}catch(w){t=w,Os===n&&null!==n&&(Os=n=n.return);continue}break}}function wc(){var e=Ms.current;return Ms.current=xo,null===e?xo:e}function Ec(e,t){var n=xs;xs|=16;var r=wc();for(Rs===e&&Is===t||_c(e,t);;)try{Tc();break}catch(i){Cc(e,i)}if(Zi(),xs=n,Ms.current=r,null!==Os)throw Error(o(261));return Rs=null,Is=0,Ls}function Tc(){for(;null!==Os;)Mc(Os)}function kc(){for(;null!==Os&&!Ti();)Mc(Os)}function Mc(e){var t=$s(e.alternate,e,Ps);e.memoizedProps=e.pendingProps,null===t?Dc(e):Os=t,Ds.current=null}function Dc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=is(n,t,Ps)))return void(Os=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Ps)||0===(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=as(t)))return n.flags&=2047,void(Os=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Os=t);Os=t=e}while(null!==t);0===Ls&&(Ls=5)}function xc(e){var t=Wi();return Bi(99,Rc.bind(null,e,t)),null}function Rc(e,t){do{Ic()}while(null!==Qs);if(0!==(48&xs))throw Error(o(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,a=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var s=e.eventTimes,c=e.expirationTimes;0<a;){var l=31-Vt(a),u=1<<l;i[l]=0,s[l]=-1,c[l]=-1,a&=~u}if(null!==tc&&0===(24&r)&&tc.has(e)&&tc.delete(e),e===Rs&&(Os=Rs=null,Is=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=xs,xs|=32,Ds.current=null,Ur=Jt,pr(s=fr())){if("selectionStart"in s)c={start:s.selectionStart,end:s.selectionEnd};else e:if(c=(c=s.ownerDocument)&&c.defaultView||window,(u=c.getSelection&&c.getSelection())&&0!==u.rangeCount){c=u.anchorNode,a=u.anchorOffset,l=u.focusNode,u=u.focusOffset;try{c.nodeType,l.nodeType}catch(k){c=null;break e}var d=0,h=-1,f=-1,p=0,m=0,v=s,g=null;t:for(;;){for(var y;v!==c||0!==a&&3!==v.nodeType||(h=d+a),v!==l||0!==u&&3!==v.nodeType||(f=d+u),3===v.nodeType&&(d+=v.nodeValue.length),null!==(y=v.firstChild);)g=v,v=y;for(;;){if(v===s)break t;if(g===c&&++p===a&&(h=d),g===l&&++m===u&&(f=d),null!==(y=v.nextSibling))break;g=(v=g).parentNode}v=y}c=-1===h||-1===f?null:{start:h,end:f}}else c=null;c=c||{start:0,end:0}}else c=null;Fr={focusedElem:s,selectionRange:c},Jt=!1,sc=null,cc=!1,Gs=r;do{try{Oc()}catch(k){if(null===Gs)throw Error(o(330));jc(Gs,k),Gs=Gs.nextEffect}}while(null!==Gs);sc=null,Gs=r;do{try{for(s=e;null!==Gs;){var b=Gs.flags;if(16&b&&ye(Gs.stateNode,""),128&b){var S=Gs.alternate;if(null!==S){var _=S.ref;null!==_&&("function"===typeof _?_(null):_.current=null)}}switch(1038&b){case 2:bs(Gs),Gs.flags&=-3;break;case 6:bs(Gs),Gs.flags&=-3,ws(Gs.alternate,Gs);break;case 1024:Gs.flags&=-1025;break;case 1028:Gs.flags&=-1025,ws(Gs.alternate,Gs);break;case 4:ws(Gs.alternate,Gs);break;case 8:Cs(s,c=Gs);var C=c.alternate;gs(c),null!==C&&gs(C)}Gs=Gs.nextEffect}}catch(k){if(null===Gs)throw Error(o(330));jc(Gs,k),Gs=Gs.nextEffect}}while(null!==Gs);if(_=Fr,S=fr(),b=_.focusedElem,s=_.selectionRange,S!==b&&b&&b.ownerDocument&&hr(b.ownerDocument.documentElement,b)){null!==s&&pr(b)&&(S=s.start,void 0===(_=s.end)&&(_=S),"selectionStart"in b?(b.selectionStart=S,b.selectionEnd=Math.min(_,b.value.length)):(_=(S=b.ownerDocument||document)&&S.defaultView||window).getSelection&&(_=_.getSelection(),c=b.textContent.length,C=Math.min(s.start,c),s=void 0===s.end?C:Math.min(s.end,c),!_.extend&&C>s&&(c=s,s=C,C=c),c=dr(b,C),a=dr(b,s),c&&a&&(1!==_.rangeCount||_.anchorNode!==c.node||_.anchorOffset!==c.offset||_.focusNode!==a.node||_.focusOffset!==a.offset)&&((S=S.createRange()).setStart(c.node,c.offset),_.removeAllRanges(),C>s?(_.addRange(S),_.extend(a.node,a.offset)):(S.setEnd(a.node,a.offset),_.addRange(S))))),S=[];for(_=b;_=_.parentNode;)1===_.nodeType&&S.push({element:_,left:_.scrollLeft,top:_.scrollTop});for("function"===typeof b.focus&&b.focus(),b=0;b<S.length;b++)(_=S[b]).element.scrollLeft=_.left,_.element.scrollTop=_.top}Jt=!!Ur,Fr=Ur=null,e.current=n,Gs=r;do{try{for(b=e;null!==Gs;){var w=Gs.flags;if(36&w&&ps(b,Gs.alternate,Gs),128&w){S=void 0;var E=Gs.ref;if(null!==E){var T=Gs.stateNode;switch(Gs.tag){case 5:S=T;break;default:S=T}"function"===typeof E?E(S):E.current=S}}Gs=Gs.nextEffect}}catch(k){if(null===Gs)throw Error(o(330));jc(Gs,k),Gs=Gs.nextEffect}}while(null!==Gs);Gs=null,Li(),xs=i}else e.current=n;if(Ks)Ks=!1,Qs=e,Xs=t;else for(Gs=r;null!==Gs;)t=Gs.nextEffect,Gs.nextEffect=null,8&Gs.flags&&((w=Gs).sibling=null,w.stateNode=null),Gs=t;if(0===(r=e.pendingLanes)&&(Js=null),1===r?e===rc?nc++:(nc=0,rc=e):nc=0,n=n.stateNode,_i&&"function"===typeof _i.onCommitFiberRoot)try{_i.onCommitFiberRoot(Si,n,void 0,64===(64&n.current.flags))}catch(k){}if(fc(e,Hi()),zs)throw zs=!1,e=qs,qs=null,e;return 0!==(8&xs)||$i(),null}function Oc(){for(;null!==Gs;){var e=Gs.alternate;cc||null===sc||(0!==(8&Gs.flags)?et(Gs,sc)&&(cc=!0):13===Gs.tag&&Ts(e,Gs)&&et(Gs,sc)&&(cc=!0));var t=Gs.flags;0!==(256&t)&&fs(e,Gs),0===(512&t)||Ks||(Ks=!0,Vi(97,(function(){return Ic(),null}))),Gs=Gs.nextEffect}}function Ic(){if(90!==Xs){var e=97<Xs?97:Xs;return Xs=90,Bi(e,Lc)}return!1}function Pc(e,t){Zs.push(t,e),Ks||(Ks=!0,Vi(97,(function(){return Ic(),null})))}function Ac(e,t){ec.push(t,e),Ks||(Ks=!0,Vi(97,(function(){return Ic(),null})))}function Lc(){if(null===Qs)return!1;var e=Qs;if(Qs=null,0!==(48&xs))throw Error(o(331));var t=xs;xs|=32;var n=ec;ec=[];for(var r=0;r<n.length;r+=2){var i=n[r],a=n[r+1],s=i.destroy;if(i.destroy=void 0,"function"===typeof s)try{s()}catch(l){if(null===a)throw Error(o(330));jc(a,l)}}for(n=Zs,Zs=[],r=0;r<n.length;r+=2){i=n[r],a=n[r+1];try{var c=i.create;i.destroy=c()}catch(l){if(null===a)throw Error(o(330));jc(a,l)}}for(c=e.current.firstEffect;null!==c;)e=c.nextEffect,c.nextEffect=null,8&c.flags&&(c.sibling=null,c.stateNode=null),c=e;return xs=t,$i(),!0}function Nc(e,t,n){ca(e,t=ls(0,t=os(n,t),1)),t=lc(),null!==(e=hc(e,1))&&(Bt(e,1,t),fc(e,t))}function jc(e,t){if(3===e.tag)Nc(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Nc(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Js||!Js.has(r))){var i=us(n,e=os(t,e),1);if(ca(n,i),i=lc(),null!==(n=hc(n,1)))Bt(n,1,i),fc(n,i);else if("function"===typeof r.componentDidCatch&&(null===Js||!Js.has(r)))try{r.componentDidCatch(t,e)}catch(a){}break}}n=n.return}}function Uc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=lc(),e.pingedLanes|=e.suspendedLanes&n,Rs===e&&(Is&n)===n&&(4===Ls||3===Ls&&(62914560&Is)===Is&&500>Hi()-Ys?_c(e,0):Hs|=n),fc(e,t)}function Fc(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Wi()?1:2:(0===ac&&(ac=js),0===(t=Wt(62914560&~ac))&&(t=4194304))),n=lc(),null!==(e=hc(e,t))&&(Bt(e,t,n),fc(e,n))}function Hc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Wc(e,t,n,r){return new Hc(e,t,n,r)}function Yc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bc(e,t){var n=e.alternate;return null===n?((n=Wc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Vc(e,t,n,r,i,a){var s=2;if(r=e,"function"===typeof e)Yc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case E:return $c(n.children,i,a,t);case N:s=8,i|=16;break;case T:s=8,i|=1;break;case k:return(e=Wc(12,n,t,8|i)).elementType=k,e.type=k,e.lanes=a,e;case R:return(e=Wc(13,n,t,i)).type=R,e.elementType=R,e.lanes=a,e;case O:return(e=Wc(19,n,t,i)).elementType=O,e.lanes=a,e;case j:return Gc(n,i,a,t);case U:return(e=Wc(24,n,t,i)).elementType=U,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case M:s=10;break e;case D:s=9;break e;case x:s=11;break e;case I:s=14;break e;case P:s=16,r=null;break e;case A:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Wc(s,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function $c(e,t,n,r){return(e=Wc(7,e,r,t)).lanes=n,e}function Gc(e,t,n,r){return(e=Wc(23,e,r,t)).elementType=j,e.lanes=n,e}function zc(e,t,n){return(e=Wc(6,e,null,t)).lanes=n,e}function qc(e,t,n){return(t=Wc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Jc(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Yt(0),this.expirationTimes=Yt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yt(0),this.mutableSourceEagerHydrationData=null}function Kc(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Qc(e,t,n,r){var i=t.current,a=lc(),s=uc(i);e:if(n){t:{if(Ke(n=n._reactInternals)!==n||1!==n.tag)throw Error(o(170));var c=n;do{switch(c.tag){case 3:c=c.stateNode.context;break t;case 1:if(pi(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break t}}c=c.return}while(null!==c);throw Error(o(171))}if(1===n.tag){var l=n.type;if(pi(l)){n=gi(n,l,c);break e}}n=c}else n=li;return null===t.context?t.context=n:t.pendingContext=n,(t=sa(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),ca(i,t),dc(i,s,a),s}function Xc(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Zc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function el(e,t){Zc(e,t),(e=e.alternate)&&Zc(e,t)}function tl(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Jc(e,t,null!=n&&!0===n.hydrate),t=Wc(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,aa(t),e[Qr]=n.current,xr(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function nl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function rl(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a._internalRoot;if("function"===typeof i){var s=i;i=function(){var e=Xc(o);s.call(e)}}Qc(t,o,e,i)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new tl(e,0,t?{hydrate:!0}:void 0)}(n,r),o=a._internalRoot,"function"===typeof i){var c=i;i=function(){var e=Xc(o);c.call(e)}}yc((function(){Qc(t,o,e,i)}))}return Xc(o)}function il(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nl(t))throw Error(o(200));return Kc(e,t,null,n)}$s=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||di.current)Ao=!0;else{if(0===(n&r)){switch(Ao=!1,t.tag){case 3:Vo(t),Va();break;case 5:Ia(t);break;case 1:pi(t.type)&&yi(t);break;case 4:Ra(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;ci(Ji,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?Jo(e,t,n):(ci(Aa,1&Aa.current),null!==(t=ns(e,t,n))?t.sibling:null);ci(Aa,1&Aa.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(64&e.flags)){if(r)return ts(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),ci(Aa,Aa.current),r)break;return null;case 23:case 24:return t.lanes=0,Fo(e,t,n)}return ns(e,t,n)}Ao=0!==(16384&e.flags)}else Ao=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=fi(t,ui.current),na(t,n),i=ro(null,t,r,e,i,n),t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,pi(r)){var a=!0;yi(t)}else a=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,aa(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&fa(t,r,s,e),i.updater=pa,t.stateNode=i,i._reactInternals=t,ya(t,r,e,n),t=Bo(null,t,r,!0,a,n)}else t.tag=0,Lo(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(a=i._init)(i._payload),t.type=i,a=t.tag=function(e){if("function"===typeof e)return Yc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===x)return 11;if(e===I)return 14}return 2}(i),e=qi(i,e),a){case 0:t=Wo(null,t,i,e,n);break e;case 1:t=Yo(null,t,i,e,n);break e;case 11:t=No(null,t,i,e,n);break e;case 14:t=jo(null,t,i,qi(i.type,e),r,n);break e}throw Error(o(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Wo(e,t,r,i=t.elementType===r?i:qi(r,i),n);case 1:return r=t.type,i=t.pendingProps,Yo(e,t,r,i=t.elementType===r?i:qi(r,i),n);case 3:if(Vo(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,oa(e,t),ua(t,r,null,n),(r=t.memoizedState.element)===i)Va(),t=ns(e,t,n);else{if((a=(i=t.stateNode).hydrate)&&(ja=$r(t.stateNode.containerInfo.firstChild),Na=t,a=Ua=!0),a){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(a=e[i])._workInProgressVersionPrimary=e[i+1],$a.push(a);for(n=Ea(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Lo(e,t,r,n),Va();t=t.child}return t;case 5:return Ia(t),null===e&&Wa(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,Wr(r,i)?s=null:null!==a&&Wr(r,a)&&(t.flags|=16),Ho(e,t),Lo(e,t,s,n),t.child;case 6:return null===e&&Wa(t),null;case 13:return Jo(e,t,n);case 4:return Ra(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=wa(t,null,r,n):Lo(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,No(e,t,r,i=t.elementType===r?i:qi(r,i),n);case 7:return Lo(e,t,t.pendingProps,n),t.child;case 8:case 12:return Lo(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value;var c=t.type._context;if(ci(Ji,c._currentValue),c._currentValue=a,null!==s)if(c=s.value,0===(a=sr(c,a)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(c,a):1073741823))){if(s.children===i.children&&!di.current){t=ns(e,t,n);break e}}else for(null!==(c=t.child)&&(c.return=t);null!==c;){var l=c.dependencies;if(null!==l){s=c.child;for(var u=l.firstContext;null!==u;){if(u.context===r&&0!==(u.observedBits&a)){1===c.tag&&((u=sa(-1,n&-n)).tag=2,ca(c,u)),c.lanes|=n,null!==(u=c.alternate)&&(u.lanes|=n),ta(c.return,n),l.lanes|=n;break}u=u.next}}else s=10===c.tag&&c.type===t.type?null:c.child;if(null!==s)s.return=c;else for(s=c;null!==s;){if(s===t){s=null;break}if(null!==(c=s.sibling)){c.return=s.return,s=c;break}s=s.return}c=s}Lo(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(a=t.pendingProps).children,na(t,n),r=r(i=ra(i,a.unstable_observedBits)),t.flags|=1,Lo(e,t,r,n),t.child;case 14:return a=qi(i=t.type,t.pendingProps),jo(e,t,i,a=qi(i.type,a),r,n);case 15:return Uo(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:qi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pi(r)?(e=!0,yi(t)):e=!1,na(t,n),va(t,r,i),ya(t,r,i,n),Bo(null,t,r,!0,e,n);case 19:return ts(e,t,n);case 23:case 24:return Fo(e,t,n)}throw Error(o(156,t.tag))},tl.prototype.render=function(e){Qc(e,this._internalRoot,null,null)},tl.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Qc(null,e,null,(function(){t[Qr]=null}))},tt=function(e){13===e.tag&&(dc(e,4,lc()),el(e,4))},nt=function(e){13===e.tag&&(dc(e,67108864,lc()),el(e,67108864))},rt=function(e){if(13===e.tag){var t=lc(),n=uc(e);dc(e,n,t),el(e,n)}},it=function(e,t){return t()},Me=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ni(r);if(!i)throw Error(o(90));Q(r),ne(r,i)}}}break;case"textarea":le(e,n);break;case"select":null!=(t=n.value)&&oe(e,!!n.multiple,t,!1)}},Pe=gc,Ae=function(e,t,n,r,i){var a=xs;xs|=4;try{return Bi(98,e.bind(null,t,n,r,i))}finally{0===(xs=a)&&(Vs(),$i())}},Le=function(){0===(49&xs)&&(function(){if(null!==tc){var e=tc;tc=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,fc(e,Hi())}))}$i()}(),Ic())},Ne=function(e,t){var n=xs;xs|=2;try{return e(t)}finally{0===(xs=n)&&(Vs(),$i())}};var al={Events:[ei,ti,ni,Oe,Ie,Ic,{current:!1}]},ol={findFiberByHostInstance:Zr,bundleType:0,version:"17.0.1",rendererPackageName:"react-dom"},sl={bundleType:ol.bundleType,version:ol.version,rendererPackageName:ol.rendererPackageName,rendererConfig:ol.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ze(e))?null:e.stateNode},findFiberByHostInstance:ol.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var cl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cl.isDisabled&&cl.supportsFiber)try{Si=cl.inject(sl),_i=cl}catch(ve){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=al,t.createPortal=il,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=Ze(t))?null:e.stateNode},t.flushSync=function(e,t){var n=xs;if(0!==(48&n))return e(t);xs|=1;try{if(e)return Bi(99,e.bind(null,t))}finally{xs=n,$i()}},t.hydrate=function(e,t,n){if(!nl(t))throw Error(o(200));return rl(null,e,t,!0,n)},t.render=function(e,t,n){if(!nl(t))throw Error(o(200));return rl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!nl(e))throw Error(o(40));return!!e._reactRootContainer&&(yc((function(){rl(null,null,e,!1,(function(){e._reactRootContainer=null,e[Qr]=null}))})),!0)},t.unstable_batchedUpdates=gc,t.unstable_createPortal=function(e,t){return il(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!nl(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return rl(e,t,n,!1,r)},t.version="17.0.1"},function(e,t,n){"use strict";e.exports=n(106)},function(e,t,n){"use strict";var r,i,a,o;if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var c=Date,l=c.now();t.unstable_now=function(){return c.now()-l}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var u=null,d=null,h=function e(){if(null!==u)try{var n=t.unstable_now();u(!0,n),u=null}catch(r){throw setTimeout(e,0),r}};r=function(e){null!==u?setTimeout(r,0,e):(u=e,setTimeout(h,0))},i=function(e,t){d=setTimeout(e,t)},a=function(){clearTimeout(d)},t.unstable_shouldYield=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var f=window.setTimeout,p=window.clearTimeout;if("undefined"!==typeof console){var m=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var v=!1,g=null,y=-1,b=5,S=0;t.unstable_shouldYield=function(){return t.unstable_now()>=S},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<e?Math.floor(1e3/e):5};var _=new MessageChannel,C=_.port2;_.port1.onmessage=function(){if(null!==g){var e=t.unstable_now();S=e+b;try{g(!0,e)?C.postMessage(null):(v=!1,g=null)}catch(n){throw C.postMessage(null),n}}else v=!1},r=function(e){g=e,v||(v=!0,C.postMessage(null))},i=function(e,n){y=f((function(){e(t.unstable_now())}),n)},a=function(){p(y),y=-1}}function w(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<k(i,t)))break e;e[r]=t,e[n]=i,n=r}}function E(e){return void 0===(e=e[0])?null:e}function T(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var a=2*(r+1)-1,o=e[a],s=a+1,c=e[s];if(void 0!==o&&0>k(o,n))void 0!==c&&0>k(c,o)?(e[r]=c,e[s]=n,r=s):(e[r]=o,e[a]=n,r=a);else{if(!(void 0!==c&&0>k(c,n)))break e;e[r]=c,e[s]=n,r=s}}}return t}return null}function k(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var M=[],D=[],x=1,R=null,O=3,I=!1,P=!1,A=!1;function L(e){for(var t=E(D);null!==t;){if(null===t.callback)T(D);else{if(!(t.startTime<=e))break;T(D),t.sortIndex=t.expirationTime,w(M,t)}t=E(D)}}function N(e){if(A=!1,L(e),!P)if(null!==E(M))P=!0,r(j);else{var t=E(D);null!==t&&i(N,t.startTime-e)}}function j(e,n){P=!1,A&&(A=!1,a()),I=!0;var r=O;try{for(L(n),R=E(M);null!==R&&(!(R.expirationTime>n)||e&&!t.unstable_shouldYield());){var o=R.callback;if("function"===typeof o){R.callback=null,O=R.priorityLevel;var s=o(R.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?R.callback=s:R===E(M)&&T(M),L(n)}else T(M);R=E(M)}if(null!==R)var c=!0;else{var l=E(D);null!==l&&i(N,l.startTime-n),c=!1}return c}finally{R=null,O=r,I=!1}}var U=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){P||I||(P=!0,r(j))},t.unstable_getCurrentPriorityLevel=function(){return O},t.unstable_getFirstCallbackNode=function(){return E(M)},t.unstable_next=function(e){switch(O){case 1:case 2:case 3:var t=3;break;default:t=O}var n=O;O=t;try{return e()}finally{O=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=U,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=O;O=e;try{return t()}finally{O=n}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var c=-1;break;case 2:c=250;break;case 5:c=1073741823;break;case 4:c=1e4;break;default:c=5e3}return e={id:x++,callback:n,priorityLevel:e,startTime:o,expirationTime:c=o+c,sortIndex:-1},o>s?(e.sortIndex=o,w(D,e),null===E(M)&&e===E(D)&&(A?a():A=!0,i(N,o-s))):(e.sortIndex=c,w(M,e),P||I||(P=!0,r(j))),e},t.unstable_wrapCallback=function(e){var t=O;return function(){var n=O;O=t;try{return e.apply(this,arguments)}finally{O=n}}}},,function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),o=new M(r||[]);return a._invoke=function(e,t,n){var r=u;return function(i,a){if(r===h)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw a;return x()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=E(o,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===u)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var c=l(e,t,n);if("normal"===c.type){if(r=n.done?f:d,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}e.wrap=c;var u="suspendedStart",d="suspendedYield",h="executing",f="completed",p={};function m(){}function v(){}function g(){}var y={};y[a]=function(){return this};var b=Object.getPrototypeOf,S=b&&b(b(D([])));S&&S!==n&&r.call(S,a)&&(y=S);var _=g.prototype=m.prototype=Object.create(y);function C(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e,t){function n(i,a,o,s){var c=l(e[i],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"===typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(c.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function E(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,p;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(e){if(e){var n=e[a];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:x}}function x(){return{value:t,done:!0}}return v.prototype=_.constructor=g,g.constructor=v,g[s]=v.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},C(w.prototype),w.prototype[o]=function(){return this},e.AsyncIterator=w,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new w(c(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(_),_[s]="Generator",_[a]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=D,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:D(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},,function(e,t,n){"use strict";n(70);var r=n(1),i=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var a=Symbol.for;i=a("react.element"),t.Fragment=a("react.fragment")}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,a={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!c.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:u,props:a,_owner:o.current}}t.jsx=l,t.jsxs=l},function(e,t,n){"use strict";var r=n(112);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";var r="function"===typeof Symbol&&Symbol.for,i=r?Symbol.for("react.element"):60103,a=r?Symbol.for("react.portal"):60106,o=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,c=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,d=r?Symbol.for("react.async_mode"):60111,h=r?Symbol.for("react.concurrent_mode"):60111,f=r?Symbol.for("react.forward_ref"):60112,p=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,v=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,y=r?Symbol.for("react.block"):60121,b=r?Symbol.for("react.fundamental"):60117,S=r?Symbol.for("react.responder"):60118,_=r?Symbol.for("react.scope"):60119;function C(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case d:case h:case o:case c:case s:case p:return e;default:switch(e=e&&e.$$typeof){case u:case f:case g:case v:case l:return e;default:return t}}case a:return t}}}function w(e){return C(e)===h}t.AsyncMode=d,t.ConcurrentMode=h,t.ContextConsumer=u,t.ContextProvider=l,t.Element=i,t.ForwardRef=f,t.Fragment=o,t.Lazy=g,t.Memo=v,t.Portal=a,t.Profiler=c,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return w(e)||C(e)===d},t.isConcurrentMode=w,t.isContextConsumer=function(e){return C(e)===u},t.isContextProvider=function(e){return C(e)===l},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return C(e)===f},t.isFragment=function(e){return C(e)===o},t.isLazy=function(e){return C(e)===g},t.isMemo=function(e){return C(e)===v},t.isPortal=function(e){return C(e)===a},t.isProfiler=function(e){return C(e)===c},t.isStrictMode=function(e){return C(e)===s},t.isSuspense=function(e){return C(e)===p},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===o||e===h||e===c||e===s||e===p||e===m||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===v||e.$$typeof===l||e.$$typeof===u||e.$$typeof===f||e.$$typeof===b||e.$$typeof===S||e.$$typeof===_||e.$$typeof===y)},t.typeOf=C},function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},,function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(68),l=n(35),u=n(12),d=n(30),h=n(14),f="undefined"===typeof window?a.useEffect:a.useLayoutEffect,p=a.forwardRef((function(e,t){var n=e.alignItems,s=void 0===n?"center":n,p=e.autoFocus,m=void 0!==p&&p,v=e.button,g=void 0!==v&&v,y=e.children,b=e.classes,S=e.className,_=e.component,C=e.ContainerComponent,w=void 0===C?"li":C,E=e.ContainerProps,T=(E=void 0===E?{}:E).className,k=Object(i.a)(E,["className"]),M=e.dense,D=void 0!==M&&M,x=e.disabled,R=void 0!==x&&x,O=e.disableGutters,I=void 0!==O&&O,P=e.divider,A=void 0!==P&&P,L=e.focusVisibleClassName,N=e.selected,j=void 0!==N&&N,U=Object(i.a)(e,["alignItems","autoFocus","button","children","classes","className","component","ContainerComponent","ContainerProps","dense","disabled","disableGutters","divider","focusVisibleClassName","selected"]),F=a.useContext(d.a),H={dense:D||F.dense||!1,alignItems:s},W=a.useRef(null);f((function(){m&&W.current&&W.current.focus()}),[m]);var Y=a.Children.toArray(y),B=Y.length&&Object(l.a)(Y[Y.length-1],["ListItemSecondaryAction"]),V=a.useCallback((function(e){W.current=h.findDOMNode(e)}),[]),$=Object(u.a)(V,t),G=Object(r.a)({className:Object(o.a)(b.root,S,H.dense&&b.dense,!I&&b.gutters,A&&b.divider,R&&b.disabled,g&&b.button,"center"!==s&&b.alignItemsFlexStart,B&&b.secondaryAction,j&&b.selected),disabled:R},U),z=_||"li";return g&&(G.component=_||"div",G.focusVisibleClassName=Object(o.a)(b.focusVisible,L),z=c.a),B?(z=G.component||_?z:"div","li"===w&&("li"===z?z="div":"li"===G.component&&(G.component="div")),a.createElement(d.a.Provider,{value:H},a.createElement(w,Object(r.a)({className:Object(o.a)(b.container,T),ref:$},k),a.createElement(z,G,Y),Y.pop()))):a.createElement(d.a.Provider,{value:H},a.createElement(z,Object(r.a)({ref:$},G),Y))}));t.a=Object(s.a)((function(e){return{root:{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,"&$focusVisible":{backgroundColor:e.palette.action.selected},"&$selected, &$selected:hover":{backgroundColor:e.palette.action.selected},"&$disabled":{opacity:.5}},container:{position:"relative"},focusVisible:{},dense:{paddingTop:4,paddingBottom:4},alignItemsFlexStart:{alignItems:"flex-start"},disabled:{},divider:{borderBottom:"1px solid ".concat(e.palette.divider),backgroundClip:"padding-box"},gutters:{paddingLeft:16,paddingRight:16},button:{transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:e.palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}},secondaryAction:{paddingRight:48},selected:{}}}),{name:"MuiListItem"})(p)},function(e,t,n){"use strict";n.d(t,"a",(function(){return mn}));var r=n(4),i=n(3),a=n(1),o=n.n(a),s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c="object"===("undefined"===typeof window?"undefined":s(window))&&"object"===("undefined"===typeof document?"undefined":s(document))&&9===document.nodeType;var l=n(52),u=n(40),d=n(57),h=n(33),f={}.constructor;function p(e){if(null==e||"object"!==typeof e)return e;if(Array.isArray(e))return e.map(p);if(e.constructor!==f)return e;var t={};for(var n in e)t[n]=p(e[n]);return t}function m(e,t,n){void 0===e&&(e="unnamed");var r=n.jss,i=p(t),a=r.plugins.onCreateRule(e,i,n);return a||(e[0],null)}var v=function(e,t){for(var n="",r=0;r<e.length&&"!important"!==e[r];r++)n&&(n+=t),n+=e[r];return n},g=function(e,t){if(void 0===t&&(t=!1),!Array.isArray(e))return e;var n="";if(Array.isArray(e[0]))for(var r=0;r<e.length&&"!important"!==e[r];r++)n&&(n+=", "),n+=v(e[r]," ");else n=v(e,", ");return t||"!important"!==e[e.length-1]||(n+=" !important"),n};function y(e,t){for(var n="",r=0;r<t;r++)n+="  ";return n+e}function b(e,t,n){void 0===n&&(n={});var r="";if(!t)return r;var i=n.indent,a=void 0===i?0:i,o=t.fallbacks;if(e&&a++,o)if(Array.isArray(o))for(var s=0;s<o.length;s++){var c=o[s];for(var l in c){var u=c[l];null!=u&&(r&&(r+="\n"),r+=""+y(l+": "+g(u)+";",a))}}else for(var d in o){var h=o[d];null!=h&&(r&&(r+="\n"),r+=""+y(d+": "+g(h)+";",a))}for(var f in t){var p=t[f];null!=p&&"fallbacks"!==f&&(r&&(r+="\n"),r+=""+y(f+": "+g(p)+";",a))}return(r||n.allowEmpty)&&e?(r&&(r="\n"+r+"\n"),y(e+" {"+r,--a)+y("}",a)):r}var S=/([[\].#*$><+~=|^:(),"'`\s])/g,_="undefined"!==typeof CSS&&CSS.escape,C=function(e){return _?_(e):e.replace(S,"\\$1")},w=function(){function e(e,t,n){this.type="style",this.key=void 0,this.isProcessed=!1,this.style=void 0,this.renderer=void 0,this.renderable=void 0,this.options=void 0;var r=n.sheet,i=n.Renderer;this.key=e,this.options=n,this.style=t,r?this.renderer=r.renderer:i&&(this.renderer=new i)}return e.prototype.prop=function(e,t,n){if(void 0===t)return this.style[e];var r=!!n&&n.force;if(!r&&this.style[e]===t)return this;var i=t;n&&!1===n.process||(i=this.options.jss.plugins.onChangeValue(t,e,this));var a=null==i||!1===i,o=e in this.style;if(a&&!o&&!r)return this;var s=a&&o;if(s?delete this.style[e]:this.style[e]=i,this.renderable&&this.renderer)return s?this.renderer.removeProperty(this.renderable,e):this.renderer.setProperty(this.renderable,e,i),this;var c=this.options.sheet;return c&&c.attached,this},e}(),E=function(e){function t(t,n,r){var i;(i=e.call(this,t,n,r)||this).selectorText=void 0,i.id=void 0,i.renderable=void 0;var a=r.selector,o=r.scoped,s=r.sheet,c=r.generateId;return a?i.selectorText=a:!1!==o&&(i.id=c(Object(d.a)(Object(d.a)(i)),s),i.selectorText="."+C(i.id)),i}Object(u.a)(t,e);var n=t.prototype;return n.applyTo=function(e){var t=this.renderer;if(t){var n=this.toJSON();for(var r in n)t.setProperty(e,r,n[r])}return this},n.toJSON=function(){var e={};for(var t in this.style){var n=this.style[t];"object"!==typeof n?e[t]=n:Array.isArray(n)&&(e[t]=g(n))}return e},n.toString=function(e){var t=this.options.sheet,n=!!t&&t.options.link?Object(i.a)({},e,{allowEmpty:!0}):e;return b(this.selectorText,this.style,n)},Object(l.a)(t,[{key:"selector",set:function(e){if(e!==this.selectorText){this.selectorText=e;var t=this.renderer,n=this.renderable;if(n&&t)t.setSelector(n,e)||t.replaceRule(n,this)}},get:function(){return this.selectorText}}]),t}(w),T={onCreateRule:function(e,t,n){return"@"===e[0]||n.parent&&"keyframes"===n.parent.type?null:new E(e,t,n)}},k={indent:1,children:!0},M=/@([\w-]+)/,D=function(){function e(e,t,n){this.type="conditional",this.at=void 0,this.key=void 0,this.query=void 0,this.rules=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=e;var r=e.match(M);for(var a in this.at=r?r[1]:"unknown",this.query=n.name||"@"+this.at,this.options=n,this.rules=new Q(Object(i.a)({},n,{parent:this})),t)this.rules.add(a,t[a]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.indexOf=function(e){return this.rules.indexOf(e)},t.addRule=function(e,t,n){var r=this.rules.add(e,t,n);return r?(this.options.jss.plugins.onProcessRule(r),r):null},t.toString=function(e){if(void 0===e&&(e=k),null==e.indent&&(e.indent=k.indent),null==e.children&&(e.children=k.children),!1===e.children)return this.query+" {}";var t=this.rules.toString(e);return t?this.query+" {\n"+t+"\n}":""},e}(),x=/@media|@supports\s+/,R={onCreateRule:function(e,t,n){return x.test(e)?new D(e,t,n):null}},O={indent:1,children:!0},I=/@keyframes\s+([\w-]+)/,P=function(){function e(e,t,n){this.type="keyframes",this.at="@keyframes",this.key=void 0,this.name=void 0,this.id=void 0,this.rules=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0;var r=e.match(I);r&&r[1]?this.name=r[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=n;var a=n.scoped,o=n.sheet,s=n.generateId;for(var c in this.id=!1===a?this.name:C(s(this,o)),this.rules=new Q(Object(i.a)({},n,{parent:this})),t)this.rules.add(c,t[c],Object(i.a)({},n,{parent:this}));this.rules.process()}return e.prototype.toString=function(e){if(void 0===e&&(e=O),null==e.indent&&(e.indent=O.indent),null==e.children&&(e.children=O.children),!1===e.children)return this.at+" "+this.id+" {}";var t=this.rules.toString(e);return t&&(t="\n"+t+"\n"),this.at+" "+this.id+" {"+t+"}"},e}(),A=/@keyframes\s+/,L=/\$([\w-]+)/g,N=function(e,t){return"string"===typeof e?e.replace(L,(function(e,n){return n in t?t[n]:e})):e},j=function(e,t,n){var r=e[t],i=N(r,n);i!==r&&(e[t]=i)},U={onCreateRule:function(e,t,n){return"string"===typeof e&&A.test(e)?new P(e,t,n):null},onProcessStyle:function(e,t,n){return"style"===t.type&&n?("animation-name"in e&&j(e,"animation-name",n.keyframes),"animation"in e&&j(e,"animation",n.keyframes),e):e},onChangeValue:function(e,t,n){var r=n.options.sheet;if(!r)return e;switch(t){case"animation":case"animation-name":return N(e,r.keyframes);default:return e}}},F=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).renderable=void 0,t}return Object(u.a)(t,e),t.prototype.toString=function(e){var t=this.options.sheet,n=!!t&&t.options.link?Object(i.a)({},e,{allowEmpty:!0}):e;return b(this.key,this.style,n)},t}(w),H={onCreateRule:function(e,t,n){return n.parent&&"keyframes"===n.parent.type?new F(e,t,n):null}},W=function(){function e(e,t,n){this.type="font-face",this.at="@font-face",this.key=void 0,this.style=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){if(Array.isArray(this.style)){for(var t="",n=0;n<this.style.length;n++)t+=b(this.at,this.style[n]),this.style[n+1]&&(t+="\n");return t}return b(this.at,this.style,e)},e}(),Y=/@font-face/,B={onCreateRule:function(e,t,n){return Y.test(e)?new W(e,t,n):null}},V=function(){function e(e,t,n){this.type="viewport",this.at="@viewport",this.key=void 0,this.style=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){return b(this.key,this.style,e)},e}(),$={onCreateRule:function(e,t,n){return"@viewport"===e||"@-ms-viewport"===e?new V(e,t,n):null}},G=function(){function e(e,t,n){this.type="simple",this.key=void 0,this.value=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=e,this.value=t,this.options=n}return e.prototype.toString=function(e){if(Array.isArray(this.value)){for(var t="",n=0;n<this.value.length;n++)t+=this.key+" "+this.value[n]+";",this.value[n+1]&&(t+="\n");return t}return this.key+" "+this.value+";"},e}(),z={"@charset":!0,"@import":!0,"@namespace":!0},q=[T,R,U,H,B,$,{onCreateRule:function(e,t,n){return e in z?new G(e,t,n):null}}],J={process:!0},K={force:!0,process:!0},Q=function(){function e(e){this.map={},this.raw={},this.index=[],this.counter=0,this.options=void 0,this.classes=void 0,this.keyframes=void 0,this.options=e,this.classes=e.classes,this.keyframes=e.keyframes}var t=e.prototype;return t.add=function(e,t,n){var r=this.options,a=r.parent,o=r.sheet,s=r.jss,c=r.Renderer,l=r.generateId,u=r.scoped,d=Object(i.a)({classes:this.classes,parent:a,sheet:o,jss:s,Renderer:c,generateId:l,scoped:u,name:e,keyframes:this.keyframes,selector:void 0},n),h=e;e in this.raw&&(h=e+"-d"+this.counter++),this.raw[h]=t,h in this.classes&&(d.selector="."+C(this.classes[h]));var f=m(h,t,d);if(!f)return null;this.register(f);var p=void 0===d.index?this.index.length:d.index;return this.index.splice(p,0,f),f},t.get=function(e){return this.map[e]},t.remove=function(e){this.unregister(e),delete this.raw[e.key],this.index.splice(this.index.indexOf(e),1)},t.indexOf=function(e){return this.index.indexOf(e)},t.process=function(){var e=this.options.jss.plugins;this.index.slice(0).forEach(e.onProcessRule,e)},t.register=function(e){this.map[e.key]=e,e instanceof E?(this.map[e.selector]=e,e.id&&(this.classes[e.key]=e.id)):e instanceof P&&this.keyframes&&(this.keyframes[e.name]=e.id)},t.unregister=function(e){delete this.map[e.key],e instanceof E?(delete this.map[e.selector],delete this.classes[e.key]):e instanceof P&&delete this.keyframes[e.name]},t.update=function(){var e,t,n;if("string"===typeof(arguments.length<=0?void 0:arguments[0])?(e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2]):(t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],e=null),e)this.updateOne(this.map[e],t,n);else for(var r=0;r<this.index.length;r++)this.updateOne(this.index[r],t,n)},t.updateOne=function(t,n,r){void 0===r&&(r=J);var i=this.options,a=i.jss.plugins,o=i.sheet;if(t.rules instanceof e)t.rules.update(n,r);else{var s=t,c=s.style;if(a.onUpdate(n,t,o,r),r.process&&c&&c!==s.style){for(var l in a.onProcessStyle(s.style,s,o),s.style){var u=s.style[l];u!==c[l]&&s.prop(l,u,K)}for(var d in c){var h=s.style[d],f=c[d];null==h&&h!==f&&s.prop(d,null,K)}}}},t.toString=function(e){for(var t="",n=this.options.sheet,r=!!n&&n.options.link,i=0;i<this.index.length;i++){var a=this.index[i].toString(e);(a||r)&&(t&&(t+="\n"),t+=a)}return t},e}(),X=function(){function e(e,t){for(var n in this.options=void 0,this.deployed=void 0,this.attached=void 0,this.rules=void 0,this.renderer=void 0,this.classes=void 0,this.keyframes=void 0,this.queue=void 0,this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=Object(i.a)({},t,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),t.Renderer&&(this.renderer=new t.Renderer(this)),this.rules=new Q(this.options),e)this.rules.add(n,e[n]);this.rules.process()}var t=e.prototype;return t.attach=function(){return this.attached||(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy()),this},t.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},t.addRule=function(e,t,n){var r=this.queue;this.attached&&!r&&(this.queue=[]);var i=this.rules.add(e,t,n);return i?(this.options.jss.plugins.onProcessRule(i),this.attached?this.deployed?(r?r.push(i):(this.insertRule(i),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0)),i):i:(this.deployed=!1,i)):null},t.insertRule=function(e){this.renderer&&this.renderer.insertRule(e)},t.addRules=function(e,t){var n=[];for(var r in e){var i=this.addRule(r,e[r],t);i&&n.push(i)}return n},t.getRule=function(e){return this.rules.get(e)},t.deleteRule=function(e){var t="object"===typeof e?e:this.rules.get(e);return!(!t||this.attached&&!t.renderable)&&(this.rules.remove(t),!(this.attached&&t.renderable&&this.renderer)||this.renderer.deleteRule(t.renderable))},t.indexOf=function(e){return this.rules.indexOf(e)},t.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},t.update=function(){var e;return(e=this.rules).update.apply(e,arguments),this},t.updateOne=function(e,t,n){return this.rules.updateOne(e,t,n),this},t.toString=function(e){return this.rules.toString(e)},e}(),Z=function(){function e(){this.plugins={internal:[],external:[]},this.registry=void 0}var t=e.prototype;return t.onCreateRule=function(e,t,n){for(var r=0;r<this.registry.onCreateRule.length;r++){var i=this.registry.onCreateRule[r](e,t,n);if(i)return i}return null},t.onProcessRule=function(e){if(!e.isProcessed){for(var t=e.options.sheet,n=0;n<this.registry.onProcessRule.length;n++)this.registry.onProcessRule[n](e,t);e.style&&this.onProcessStyle(e.style,e,t),e.isProcessed=!0}},t.onProcessStyle=function(e,t,n){for(var r=0;r<this.registry.onProcessStyle.length;r++)t.style=this.registry.onProcessStyle[r](t.style,t,n)},t.onProcessSheet=function(e){for(var t=0;t<this.registry.onProcessSheet.length;t++)this.registry.onProcessSheet[t](e)},t.onUpdate=function(e,t,n,r){for(var i=0;i<this.registry.onUpdate.length;i++)this.registry.onUpdate[i](e,t,n,r)},t.onChangeValue=function(e,t,n){for(var r=e,i=0;i<this.registry.onChangeValue.length;i++)r=this.registry.onChangeValue[i](r,t,n);return r},t.use=function(e,t){void 0===t&&(t={queue:"external"});var n=this.plugins[t.queue];-1===n.indexOf(e)&&(n.push(e),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce((function(e,t){for(var n in t)n in e&&e[n].push(t[n]);return e}),{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},e}(),ee=new(function(){function e(){this.registry=[]}var t=e.prototype;return t.add=function(e){var t=this.registry,n=e.options.index;if(-1===t.indexOf(e))if(0===t.length||n>=this.index)t.push(e);else for(var r=0;r<t.length;r++)if(t[r].options.index>n)return void t.splice(r,0,e)},t.reset=function(){this.registry=[]},t.remove=function(e){var t=this.registry.indexOf(e);this.registry.splice(t,1)},t.toString=function(e){for(var t=void 0===e?{}:e,n=t.attached,r=Object(h.a)(t,["attached"]),i="",a=0;a<this.registry.length;a++){var o=this.registry[a];null!=n&&o.attached!==n||(i&&(i+="\n"),i+=o.toString(r))}return i},Object(l.a)(e,[{key:"index",get:function(){return 0===this.registry.length?0:this.registry[this.registry.length-1].options.index}}]),e}()),te="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),ne="2f1acc6c3a606b082e5eef5e54414ffb";null==te[ne]&&(te[ne]=0);var re=te[ne]++,ie=function(e){void 0===e&&(e={});var t=0;return function(n,r){t+=1;var i="",a="";return r&&(r.options.classNamePrefix&&(a=r.options.classNamePrefix),null!=r.options.jss.id&&(i=String(r.options.jss.id))),e.minify?""+(a||"c")+re+i+t:a+n.key+"-"+re+(i?"-"+i:"")+"-"+t}},ae=function(e){var t;return function(){return t||(t=e()),t}},oe=function(e,t){try{return e.attributeStyleMap?e.attributeStyleMap.get(t):e.style.getPropertyValue(t)}catch(n){return""}},se=function(e,t,n){try{var r=n;if(Array.isArray(n)&&(r=g(n,!0),"!important"===n[n.length-1]))return e.style.setProperty(t,r,"important"),!0;e.attributeStyleMap?e.attributeStyleMap.set(t,r):e.style.setProperty(t,r)}catch(i){return!1}return!0},ce=function(e,t){try{e.attributeStyleMap?e.attributeStyleMap.delete(t):e.style.removeProperty(t)}catch(n){}},le=function(e,t){return e.selectorText=t,e.selectorText===t},ue=ae((function(){return document.querySelector("head")}));function de(e){var t=ee.registry;if(t.length>0){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.attached&&r.options.index>t.index&&r.options.insertionPoint===t.insertionPoint)return r}return null}(t,e);if(n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element};if((n=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e[n];if(r.attached&&r.options.insertionPoint===t.insertionPoint)return r}return null}(t,e))&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element.nextSibling}}var r=e.insertionPoint;if(r&&"string"===typeof r){var i=function(e){for(var t=ue(),n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(8===r.nodeType&&r.nodeValue.trim()===e)return r}return null}(r);if(i)return{parent:i.parentNode,node:i.nextSibling}}return!1}var he=ae((function(){var e=document.querySelector('meta[property="csp-nonce"]');return e?e.getAttribute("content"):null})),fe=function(e,t,n){try{if("insertRule"in e)e.insertRule(t,n);else if("appendRule"in e){e.appendRule(t)}}catch(r){return!1}return e.cssRules[n]},pe=function(e,t){var n=e.cssRules.length;return void 0===t||t>n?n:t},me=function(){function e(e){this.getPropertyValue=oe,this.setProperty=se,this.removeProperty=ce,this.setSelector=le,this.element=void 0,this.sheet=void 0,this.hasInsertedRules=!1,this.cssRules=[],e&&ee.add(e),this.sheet=e;var t=this.sheet?this.sheet.options:{},n=t.media,r=t.meta,i=t.element;this.element=i||function(){var e=document.createElement("style");return e.textContent="\n",e}(),this.element.setAttribute("data-jss",""),n&&this.element.setAttribute("media",n),r&&this.element.setAttribute("data-meta",r);var a=he();a&&this.element.setAttribute("nonce",a)}var t=e.prototype;return t.attach=function(){if(!this.element.parentNode&&this.sheet){!function(e,t){var n=t.insertionPoint,r=de(t);if(!1!==r&&r.parent)r.parent.insertBefore(e,r.node);else if(n&&"number"===typeof n.nodeType){var i=n,a=i.parentNode;a&&a.insertBefore(e,i.nextSibling)}else ue().appendChild(e)}(this.element,this.sheet.options);var e=Boolean(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&e&&(this.hasInsertedRules=!1,this.deploy())}},t.detach=function(){if(this.sheet){var e=this.element.parentNode;e&&e.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent="\n")}},t.deploy=function(){var e=this.sheet;e&&(e.options.link?this.insertRules(e.rules):this.element.textContent="\n"+e.toString()+"\n")},t.insertRules=function(e,t){for(var n=0;n<e.index.length;n++)this.insertRule(e.index[n],n,t)},t.insertRule=function(e,t,n){if(void 0===n&&(n=this.element.sheet),e.rules){var r=e,i=n;if("conditional"===e.type||"keyframes"===e.type){var a=pe(n,t);if(!1===(i=fe(n,r.toString({children:!1}),a)))return!1;this.refCssRule(e,a,i)}return this.insertRules(r.rules,i),i}var o=e.toString();if(!o)return!1;var s=pe(n,t),c=fe(n,o,s);return!1!==c&&(this.hasInsertedRules=!0,this.refCssRule(e,s,c),c)},t.refCssRule=function(e,t,n){e.renderable=n,e.options.parent instanceof X&&(this.cssRules[t]=n)},t.deleteRule=function(e){var t=this.element.sheet,n=this.indexOf(e);return-1!==n&&(t.deleteRule(n),this.cssRules.splice(n,1),!0)},t.indexOf=function(e){return this.cssRules.indexOf(e)},t.replaceRule=function(e,t){var n=this.indexOf(e);return-1!==n&&(this.element.sheet.deleteRule(n),this.cssRules.splice(n,1),this.insertRule(t,n))},t.getRules=function(){return this.element.sheet.cssRules},e}(),ve=0,ge=function(){function e(e){this.id=ve++,this.version="10.5.1",this.plugins=new Z,this.options={id:{minify:!1},createGenerateId:ie,Renderer:c?me:null,plugins:[]},this.generateId=ie({minify:!1});for(var t=0;t<q.length;t++)this.plugins.use(q[t],{queue:"internal"});this.setup(e)}var t=e.prototype;return t.setup=function(e){return void 0===e&&(e={}),e.createGenerateId&&(this.options.createGenerateId=e.createGenerateId),e.id&&(this.options.id=Object(i.a)({},this.options.id,e.id)),(e.createGenerateId||e.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),null!=e.insertionPoint&&(this.options.insertionPoint=e.insertionPoint),"Renderer"in e&&(this.options.Renderer=e.Renderer),e.plugins&&this.use.apply(this,e.plugins),this},t.createStyleSheet=function(e,t){void 0===t&&(t={});var n=t.index;"number"!==typeof n&&(n=0===ee.index?0:ee.index+1);var r=new X(e,Object(i.a)({},t,{jss:this,generateId:t.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:n}));return this.plugins.onProcessSheet(r),r},t.removeStyleSheet=function(e){return e.detach(),ee.remove(e),this},t.createRule=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),"object"===typeof e)return this.createRule(void 0,e,t);var r=Object(i.a)({},n,{name:e,jss:this,Renderer:this.options.Renderer});r.generateId||(r.generateId=this.generateId),r.classes||(r.classes={}),r.keyframes||(r.keyframes={});var a=m(e,t,r);return a&&this.plugins.onProcessRule(a),a},t.use=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.plugins.use(t)})),this},e}();function ye(e){var t=null;for(var n in e){var r=e[n],i=typeof r;if("function"===i)t||(t={}),t[n]=r;else if("object"===i&&null!==r&&!Array.isArray(r)){var a=ye(r);a&&(t||(t={}),t[n]=a)}}return t}var be="object"===typeof CSS&&null!=CSS&&"number"in CSS,Se=function(e){return new ge(e)},_e=(Se(),n(149)),Ce={set:function(e,t,n,r){var i=e.get(t);i||(i=new Map,e.set(t,i)),i.set(n,r)},get:function(e,t,n){var r=e.get(t);return r?r.get(n):void 0},delete:function(e,t,n){e.get(t).delete(n)}},we=n(118),Ee=(n(7),"function"===typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__"),Te=["checked","disabled","error","focused","focusVisible","required","expanded","selected"];var ke=Date.now(),Me="fnValues"+ke,De="fnStyle"+ ++ke,xe=function(){return{onCreateRule:function(e,t,n){if("function"!==typeof t)return null;var r=m(e,{},n);return r[De]=t,r},onProcessStyle:function(e,t){if(Me in t||De in t)return e;var n={};for(var r in e){var i=e[r];"function"===typeof i&&(delete e[r],n[r]=i)}return t[Me]=n,e},onUpdate:function(e,t,n,r){var i=t,a=i[De];a&&(i.style=a(e)||{});var o=i[Me];if(o)for(var s in o)i.prop(s,o[s](e),r)}}},Re="@global",Oe="@global ",Ie=function(){function e(e,t,n){for(var r in this.type="global",this.at=Re,this.rules=void 0,this.options=void 0,this.key=void 0,this.isProcessed=!1,this.key=e,this.options=n,this.rules=new Q(Object(i.a)({},n,{parent:this})),t)this.rules.add(r,t[r]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.addRule=function(e,t,n){var r=this.rules.add(e,t,n);return r&&this.options.jss.plugins.onProcessRule(r),r},t.indexOf=function(e){return this.rules.indexOf(e)},t.toString=function(){return this.rules.toString()},e}(),Pe=function(){function e(e,t,n){this.type="global",this.at=Re,this.options=void 0,this.rule=void 0,this.isProcessed=!1,this.key=void 0,this.key=e,this.options=n;var r=e.substr(Oe.length);this.rule=n.jss.createRule(r,t,Object(i.a)({},n,{parent:this}))}return e.prototype.toString=function(e){return this.rule?this.rule.toString(e):""},e}(),Ae=/\s*,\s*/g;function Le(e,t){for(var n=e.split(Ae),r="",i=0;i<n.length;i++)r+=t+" "+n[i].trim(),n[i+1]&&(r+=", ");return r}var Ne=function(){return{onCreateRule:function(e,t,n){if(!e)return null;if(e===Re)return new Ie(e,t,n);if("@"===e[0]&&e.substr(0,Oe.length)===Oe)return new Pe(e,t,n);var r=n.parent;return r&&("global"===r.type||r.options.parent&&"global"===r.options.parent.type)&&(n.scoped=!1),!1===n.scoped&&(n.selector=e),null},onProcessRule:function(e,t){"style"===e.type&&t&&(function(e,t){var n=e.options,r=e.style,a=r?r[Re]:null;if(a){for(var o in a)t.addRule(o,a[o],Object(i.a)({},n,{selector:Le(o,e.selector)}));delete r[Re]}}(e,t),function(e,t){var n=e.options,r=e.style;for(var a in r)if("@"===a[0]&&a.substr(0,Re.length)===Re){var o=Le(a.substr(Re.length),e.selector);t.addRule(o,r[a],Object(i.a)({},n,{selector:o})),delete r[a]}}(e,t))}}},je=/\s*,\s*/g,Ue=/&/g,Fe=/\$([\w-]+)/g;var He=function(){function e(e,t){return function(n,r){var i=e.getRule(r)||t&&t.getRule(r);return i?(i=i).selector:r}}function t(e,t){for(var n=t.split(je),r=e.split(je),i="",a=0;a<n.length;a++)for(var o=n[a],s=0;s<r.length;s++){var c=r[s];i&&(i+=", "),i+=-1!==c.indexOf("&")?c.replace(Ue,o):o+" "+c}return i}function n(e,t,n){if(n)return Object(i.a)({},n,{index:n.index+1});var r=e.options.nestingLevel;r=void 0===r?1:r+1;var a=Object(i.a)({},e.options,{nestingLevel:r,index:t.indexOf(e)+1});return delete a.name,a}return{onProcessStyle:function(r,a,o){if("style"!==a.type)return r;var s,c,l=a,u=l.options.parent;for(var d in r){var h=-1!==d.indexOf("&"),f="@"===d[0];if(h||f){if(s=n(l,u,s),h){var p=t(d,l.selector);c||(c=e(u,o)),p=p.replace(Fe,c),u.addRule(p,r[d],Object(i.a)({},s,{selector:p}))}else f&&u.addRule(d,{},s).addRule(l.key,r[d],{selector:l.selector});delete r[d]}}return r}}},We=/[A-Z]/g,Ye=/^ms-/,Be={};function Ve(e){return"-"+e.toLowerCase()}var $e=function(e){if(Be.hasOwnProperty(e))return Be[e];var t=e.replace(We,Ve);return Be[e]=Ye.test(t)?"-"+t:t};function Ge(e){var t={};for(var n in e){t[0===n.indexOf("--")?n:$e(n)]=e[n]}return e.fallbacks&&(Array.isArray(e.fallbacks)?t.fallbacks=e.fallbacks.map(Ge):t.fallbacks=Ge(e.fallbacks)),t}var ze=function(){return{onProcessStyle:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)e[t]=Ge(e[t]);return e}return Ge(e)},onChangeValue:function(e,t,n){if(0===t.indexOf("--"))return e;var r=$e(t);return t===r?e:(n.prop(r,e),null)}}},qe=be&&CSS?CSS.px:"px",Je=be&&CSS?CSS.ms:"ms",Ke=be&&CSS?CSS.percent:"%";function Qe(e){var t=/(-[a-z])/g,n=function(e){return e[1].toUpperCase()},r={};for(var i in e)r[i]=e[i],r[i.replace(t,n)]=e[i];return r}var Xe=Qe({"animation-delay":Je,"animation-duration":Je,"background-position":qe,"background-position-x":qe,"background-position-y":qe,"background-size":qe,border:qe,"border-bottom":qe,"border-bottom-left-radius":qe,"border-bottom-right-radius":qe,"border-bottom-width":qe,"border-left":qe,"border-left-width":qe,"border-radius":qe,"border-right":qe,"border-right-width":qe,"border-top":qe,"border-top-left-radius":qe,"border-top-right-radius":qe,"border-top-width":qe,"border-width":qe,"border-block":qe,"border-block-end":qe,"border-block-end-width":qe,"border-block-start":qe,"border-block-start-width":qe,"border-block-width":qe,"border-inline":qe,"border-inline-end":qe,"border-inline-end-width":qe,"border-inline-start":qe,"border-inline-start-width":qe,"border-inline-width":qe,"border-start-start-radius":qe,"border-start-end-radius":qe,"border-end-start-radius":qe,"border-end-end-radius":qe,margin:qe,"margin-bottom":qe,"margin-left":qe,"margin-right":qe,"margin-top":qe,"margin-block":qe,"margin-block-end":qe,"margin-block-start":qe,"margin-inline":qe,"margin-inline-end":qe,"margin-inline-start":qe,padding:qe,"padding-bottom":qe,"padding-left":qe,"padding-right":qe,"padding-top":qe,"padding-block":qe,"padding-block-end":qe,"padding-block-start":qe,"padding-inline":qe,"padding-inline-end":qe,"padding-inline-start":qe,"mask-position-x":qe,"mask-position-y":qe,"mask-size":qe,height:qe,width:qe,"min-height":qe,"max-height":qe,"min-width":qe,"max-width":qe,bottom:qe,left:qe,top:qe,right:qe,inset:qe,"inset-block":qe,"inset-block-end":qe,"inset-block-start":qe,"inset-inline":qe,"inset-inline-end":qe,"inset-inline-start":qe,"box-shadow":qe,"text-shadow":qe,"column-gap":qe,"column-rule":qe,"column-rule-width":qe,"column-width":qe,"font-size":qe,"font-size-delta":qe,"letter-spacing":qe,"text-decoration-thickness":qe,"text-indent":qe,"text-stroke":qe,"text-stroke-width":qe,"word-spacing":qe,motion:qe,"motion-offset":qe,outline:qe,"outline-offset":qe,"outline-width":qe,perspective:qe,"perspective-origin-x":Ke,"perspective-origin-y":Ke,"transform-origin":Ke,"transform-origin-x":Ke,"transform-origin-y":Ke,"transform-origin-z":Ke,"transition-delay":Je,"transition-duration":Je,"vertical-align":qe,"flex-basis":qe,"shape-margin":qe,size:qe,gap:qe,grid:qe,"grid-gap":qe,"row-gap":qe,"grid-row-gap":qe,"grid-column-gap":qe,"grid-template-rows":qe,"grid-template-columns":qe,"grid-auto-rows":qe,"grid-auto-columns":qe,"box-shadow-x":qe,"box-shadow-y":qe,"box-shadow-blur":qe,"box-shadow-spread":qe,"font-line-height":qe,"text-shadow-x":qe,"text-shadow-y":qe,"text-shadow-blur":qe});function Ze(e,t,n){if(null==t)return t;if(Array.isArray(t))for(var r=0;r<t.length;r++)t[r]=Ze(e,t[r],n);else if("object"===typeof t)if("fallbacks"===e)for(var i in t)t[i]=Ze(i,t[i],n);else for(var a in t)t[a]=Ze(e+"-"+a,t[a],n);else if("number"===typeof t&&!Number.isNaN(t)){var o=n[e]||Xe[e];return!o||0===t&&o===qe?t.toString():"function"===typeof o?o(t).toString():""+t+o}return t}var et=function(e){void 0===e&&(e={});var t=Qe(e);return{onProcessStyle:function(e,n){if("style"!==n.type)return e;for(var r in e)e[r]=Ze(r,e[r],t);return e},onChangeValue:function(e,n){return Ze(n,e,t)}}},tt=n(36),nt="",rt="",it="",at="",ot=c&&"ontouchstart"in document.documentElement;if(c){var st={Moz:"-moz-",ms:"-ms-",O:"-o-",Webkit:"-webkit-"},ct=document.createElement("p").style;for(var lt in st)if(lt+"Transform"in ct){nt=lt,rt=st[lt];break}"Webkit"===nt&&"msHyphens"in ct&&(nt="ms",rt=st.ms,at="edge"),"Webkit"===nt&&"-apple-trailing-word"in ct&&(it="apple")}var ut=nt,dt=rt,ht=it,ft=at,pt=ot;var mt={noPrefill:["appearance"],supportedProperty:function(e){return"appearance"===e&&("ms"===ut?"-webkit-"+e:dt+e)}},vt={noPrefill:["color-adjust"],supportedProperty:function(e){return"color-adjust"===e&&("Webkit"===ut?dt+"print-"+e:e)}},gt=/[-\s]+(.)?/g;function yt(e,t){return t?t.toUpperCase():""}function bt(e){return e.replace(gt,yt)}function St(e){return bt("-"+e)}var _t,Ct={noPrefill:["mask"],supportedProperty:function(e,t){if(!/^mask/.test(e))return!1;if("Webkit"===ut){var n="mask-image";if(bt(n)in t)return e;if(ut+St(n)in t)return dt+e}return e}},wt={noPrefill:["text-orientation"],supportedProperty:function(e){return"text-orientation"===e&&("apple"!==ht||pt?e:dt+e)}},Et={noPrefill:["transform"],supportedProperty:function(e,t,n){return"transform"===e&&(n.transform?e:dt+e)}},Tt={noPrefill:["transition"],supportedProperty:function(e,t,n){return"transition"===e&&(n.transition?e:dt+e)}},kt={noPrefill:["writing-mode"],supportedProperty:function(e){return"writing-mode"===e&&("Webkit"===ut||"ms"===ut&&"edge"!==ft?dt+e:e)}},Mt={noPrefill:["user-select"],supportedProperty:function(e){return"user-select"===e&&("Moz"===ut||"ms"===ut||"apple"===ht?dt+e:e)}},Dt={supportedProperty:function(e,t){return!!/^break-/.test(e)&&("Webkit"===ut?"WebkitColumn"+St(e)in t&&dt+"column-"+e:"Moz"===ut&&("page"+St(e)in t&&"page-"+e))}},xt={supportedProperty:function(e,t){if(!/^(border|margin|padding)-inline/.test(e))return!1;if("Moz"===ut)return e;var n=e.replace("-inline","");return ut+St(n)in t&&dt+n}},Rt={supportedProperty:function(e,t){return bt(e)in t&&e}},Ot={supportedProperty:function(e,t){var n=St(e);return"-"===e[0]||"-"===e[0]&&"-"===e[1]?e:ut+n in t?dt+e:"Webkit"!==ut&&"Webkit"+n in t&&"-webkit-"+e}},It={supportedProperty:function(e){return"scroll-snap"===e.substring(0,11)&&("ms"===ut?""+dt+e:e)}},Pt={supportedProperty:function(e){return"overscroll-behavior"===e&&("ms"===ut?dt+"scroll-chaining":e)}},At={"flex-grow":"flex-positive","flex-shrink":"flex-negative","flex-basis":"flex-preferred-size","justify-content":"flex-pack",order:"flex-order","align-items":"flex-align","align-content":"flex-line-pack"},Lt={supportedProperty:function(e,t){var n=At[e];return!!n&&(ut+St(n)in t&&dt+n)}},Nt={flex:"box-flex","flex-grow":"box-flex","flex-direction":["box-orient","box-direction"],order:"box-ordinal-group","align-items":"box-align","flex-flow":["box-orient","box-direction"],"justify-content":"box-pack"},jt=Object.keys(Nt),Ut=function(e){return dt+e},Ft=[mt,vt,Ct,wt,Et,Tt,kt,Mt,Dt,xt,Rt,Ot,It,Pt,Lt,{supportedProperty:function(e,t,n){var r=n.multiple;if(jt.indexOf(e)>-1){var i=Nt[e];if(!Array.isArray(i))return ut+St(i)in t&&dt+i;if(!r)return!1;for(var a=0;a<i.length;a++)if(!(ut+St(i[0])in t))return!1;return i.map(Ut)}return!1}}],Ht=Ft.filter((function(e){return e.supportedProperty})).map((function(e){return e.supportedProperty})),Wt=Ft.filter((function(e){return e.noPrefill})).reduce((function(e,t){return e.push.apply(e,Object(tt.a)(t.noPrefill)),e}),[]),Yt={};if(c){_t=document.createElement("p");var Bt=window.getComputedStyle(document.documentElement,"");for(var Vt in Bt)isNaN(Vt)||(Yt[Bt[Vt]]=Bt[Vt]);Wt.forEach((function(e){return delete Yt[e]}))}function $t(e,t){if(void 0===t&&(t={}),!_t)return e;if(null!=Yt[e])return Yt[e];"transition"!==e&&"transform"!==e||(t[e]=e in _t.style);for(var n=0;n<Ht.length&&(Yt[e]=Ht[n](e,_t.style,t),!Yt[e]);n++);try{_t.style[e]=""}catch(r){return!1}return Yt[e]}var Gt,zt={},qt={transition:1,"transition-property":1,"-webkit-transition":1,"-webkit-transition-property":1},Jt=/(^\s*[\w-]+)|, (\s*[\w-]+)(?![^()]*\))/g;function Kt(e,t,n){if("var"===t)return"var";if("all"===t)return"all";if("all"===n)return", all";var r=t?$t(t):", "+$t(n);return r||(t||n)}function Qt(e,t){var n=t;if(!Gt||"content"===e)return t;if("string"!==typeof n||!isNaN(parseInt(n,10)))return n;var r=e+n;if(null!=zt[r])return zt[r];try{Gt.style[e]=n}catch(i){return zt[r]=!1,!1}if(qt[e])n=n.replace(Jt,Kt);else if(""===Gt.style[e]&&("-ms-flex"===(n=dt+n)&&(Gt.style[e]="-ms-flexbox"),Gt.style[e]=n,""===Gt.style[e]))return zt[r]=!1,!1;return Gt.style[e]="",zt[r]=n,zt[r]}c&&(Gt=document.createElement("p"));var Xt=function(){function e(t){for(var n in t){var r=t[n];if("fallbacks"===n&&Array.isArray(r))t[n]=r.map(e);else{var i=!1,a=$t(n);a&&a!==n&&(i=!0);var o=!1,s=Qt(a,g(r));s&&s!==r&&(o=!0),(i||o)&&(i&&delete t[n],t[a||n]=s||r)}}return t}return{onProcessRule:function(e){if("keyframes"===e.type){var t=e;t.at="-"===(n=t.at)[1]||"ms"===ut?n:"@"+dt+"keyframes"+n.substr(10)}var n},onProcessStyle:function(t,n){return"style"!==n.type?t:e(t)},onChangeValue:function(e,t){return Qt(t,g(e))||e}}};var Zt=function(){var e=function(e,t){return e.length===t.length?e>t?1:-1:e.length-t.length};return{onProcessStyle:function(t,n){if("style"!==n.type)return t;for(var r={},i=Object.keys(t).sort(e),a=0;a<i.length;a++)r[i[a]]=t[i[a]];return r}}};function en(){return{plugins:[xe(),Ne(),He(),ze(),et(),"undefined"===typeof window?null:Xt(),Zt()]}}var tn=Se(en()),nn={disableGeneration:!1,generateClassName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.disableGlobal,n=void 0!==t&&t,r=e.productionPrefix,i=void 0===r?"jss":r,a=e.seed,o=void 0===a?"":a,s=""===o?"":"".concat(o,"-"),c=0,l=function(){return c+=1};return function(e,t){var r=t.options.name;if(r&&0===r.indexOf("Mui")&&!t.options.link&&!n){if(-1!==Te.indexOf(e.key))return"Mui-".concat(e.key);var a="".concat(s).concat(r,"-").concat(e.key);return t.options.theme[Ee]&&""===o?"".concat(a,"-").concat(l()):a}return"".concat(s).concat(i).concat(l())}}(),jss:tn,sheetsCache:null,sheetsManager:new Map,sheetsRegistry:null},rn=o.a.createContext(nn);var an=-1e9;function on(){return an+=1}n(39);var sn=n(150);function cn(e){var t="function"===typeof e;return{create:function(n,r){var a;try{a=t?e(n):e}catch(c){throw c}if(!r||!n.overrides||!n.overrides[r])return a;var o=n.overrides[r],s=Object(i.a)({},a);return Object.keys(o).forEach((function(e){s[e]=Object(sn.a)(s[e],o[e])})),s},options:{}}}var ln={};function un(e,t,n){var r=e.state;if(e.stylesOptions.disableGeneration)return t||{};r.cacheClasses||(r.cacheClasses={value:null,lastProp:null,lastJSS:{}});var i=!1;return r.classes!==r.cacheClasses.lastJSS&&(r.cacheClasses.lastJSS=r.classes,i=!0),t!==r.cacheClasses.lastProp&&(r.cacheClasses.lastProp=t,i=!0),i&&(r.cacheClasses.value=Object(_e.a)({baseClasses:r.cacheClasses.lastJSS,newClasses:t,Component:n})),r.cacheClasses.value}function dn(e,t){var n=e.state,r=e.theme,a=e.stylesOptions,o=e.stylesCreator,s=e.name;if(!a.disableGeneration){var c=Ce.get(a.sheetsManager,o,r);c||(c={refs:0,staticSheet:null,dynamicStyles:null},Ce.set(a.sheetsManager,o,r,c));var l=Object(i.a)({},o.options,a,{theme:r,flip:"boolean"===typeof a.flip?a.flip:"rtl"===r.direction});l.generateId=l.serverGenerateClassName||l.generateClassName;var u=a.sheetsRegistry;if(0===c.refs){var d;a.sheetsCache&&(d=Ce.get(a.sheetsCache,o,r));var h=o.create(r,s);d||((d=a.jss.createStyleSheet(h,Object(i.a)({link:!1},l))).attach(),a.sheetsCache&&Ce.set(a.sheetsCache,o,r,d)),u&&u.add(d),c.staticSheet=d,c.dynamicStyles=ye(h)}if(c.dynamicStyles){var f=a.jss.createStyleSheet(c.dynamicStyles,Object(i.a)({link:!0},l));f.update(t),f.attach(),n.dynamicSheet=f,n.classes=Object(_e.a)({baseClasses:c.staticSheet.classes,newClasses:f.classes}),u&&u.add(f)}else n.classes=c.staticSheet.classes;c.refs+=1}}function hn(e,t){var n=e.state;n.dynamicSheet&&n.dynamicSheet.update(t)}function fn(e){var t=e.state,n=e.theme,r=e.stylesOptions,i=e.stylesCreator;if(!r.disableGeneration){var a=Ce.get(r.sheetsManager,i,n);a.refs-=1;var o=r.sheetsRegistry;0===a.refs&&(Ce.delete(r.sheetsManager,i,n),r.jss.removeStyleSheet(a.staticSheet),o&&o.remove(a.staticSheet)),t.dynamicSheet&&(r.jss.removeStyleSheet(t.dynamicSheet),o&&o.remove(t.dynamicSheet))}}function pn(e,t){var n,r=o.a.useRef([]),i=o.a.useMemo((function(){return{}}),t);r.current!==i&&(r.current=i,n=e()),o.a.useEffect((function(){return function(){n&&n()}}),[i])}function mn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,a=t.classNamePrefix,s=t.Component,c=t.defaultTheme,l=void 0===c?ln:c,u=Object(r.a)(t,["name","classNamePrefix","Component","defaultTheme"]),d=cn(e),h=n||a||"makeStyles";d.options={index:on(),name:n,meta:h,classNamePrefix:h};var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(we.a)()||l,r=Object(i.a)({},o.a.useContext(rn),u),a=o.a.useRef(),c=o.a.useRef();pn((function(){var i={name:n,state:{},stylesCreator:d,stylesOptions:r,theme:t};return dn(i,e),c.current=!1,a.current=i,function(){fn(i)}}),[t,d]),o.a.useEffect((function(){c.current&&hn(a.current,e),c.current=!0}));var h=un(a.current,e.classes,s);return h};return f}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),i=n.n(r);var a=i.a.createContext(null);function o(){return i.a.useContext(a)}},function(e,t,n){"use strict";var r=n(33),i=n(40),a=(n(7),n(1)),o=n.n(a),s=n(14),c=n.n(s),l=!1,u=n(53),d="unmounted",h="exited",f="entering",p="entered",m="exiting",v=function(e){function t(t,n){var r;r=e.call(this,t,n)||this;var i,a=n&&!n.isMounting?t.enter:t.appear;return r.appearStatus=null,t.in?a?(i=h,r.appearStatus=f):i=p:i=t.unmountOnExit||t.mountOnEnter?d:h,r.state={status:i},r.nextCallback=null,r}Object(i.a)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===d?{status:h}:null};var n=t.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==f&&n!==p&&(t=f):n!==f&&n!==p||(t=m)}this.updateStatus(!1,t)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var e,t,n,r=this.props.timeout;return e=t=n=r,null!=r&&"number"!==typeof r&&(e=r.exit,t=r.enter,n=void 0!==r.appear?r.appear:t),{exit:e,enter:t,appear:n}},n.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),t===f?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&this.state.status===h&&this.setState({status:d})},n.performEnter=function(e){var t=this,n=this.props.enter,r=this.context?this.context.isMounting:e,i=this.props.nodeRef?[r]:[c.a.findDOMNode(this),r],a=i[0],o=i[1],s=this.getTimeouts(),u=r?s.appear:s.enter;!e&&!n||l?this.safeSetState({status:p},(function(){t.props.onEntered(a)})):(this.props.onEnter(a,o),this.safeSetState({status:f},(function(){t.props.onEntering(a,o),t.onTransitionEnd(u,(function(){t.safeSetState({status:p},(function(){t.props.onEntered(a,o)}))}))})))},n.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),r=this.props.nodeRef?void 0:c.a.findDOMNode(this);t&&!l?(this.props.onExit(r),this.safeSetState({status:m},(function(){e.props.onExiting(r),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:h},(function(){e.props.onExited(r)}))}))}))):this.safeSetState({status:h},(function(){e.props.onExited(r)}))},n.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},n.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(r){n&&(n=!1,t.nextCallback=null,e(r))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},n.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:c.a.findDOMNode(this),r=null==e&&!this.props.addEndListener;if(n&&!r){if(this.props.addEndListener){var i=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],a=i[0],o=i[1];this.props.addEndListener(a,o)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},n.render=function(){var e=this.state.status;if(e===d)return null;var t=this.props,n=t.children,i=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,Object(r.a)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return o.a.createElement(u.a.Provider,{value:null},"function"===typeof n?n(e,i):o.a.cloneElement(o.a.Children.only(n),i))},t}(o.a.Component);function g(){}v.contextType=u.a,v.propTypes={},v.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:g,onEntering:g,onEntered:g,onExit:g,onExiting:g,onExited:g},v.UNMOUNTED=d,v.EXITED=h,v.ENTERING=f,v.ENTERED=p,v.EXITING=m;t.a=v},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(3),i=n(117),a=n(51);t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(e,Object(r.a)({defaultTheme:a.a},t))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(3);function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.baseClasses,n=e.newClasses;e.Component;if(!n)return t;var i=Object(r.a)({},t);return Object.keys(n).forEach((function(e){n[e]&&(i[e]="".concat(t[e]," ").concat(n[e]))})),i}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(3),i=n(39);function a(e){return e&&"object"===Object(i.a)(e)&&e.constructor===Object}function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0},i=n.clone?Object(r.a)({},e):e;return a(e)&&a(t)&&Object.keys(t).forEach((function(r){"__proto__"!==r&&(a(t[r])&&r in e?i[r]=o(e[r],t[r],n):i[r]=t[r])})),i}},function(e,t,n){"use strict";var r=n(4),i=n(3),a=n(1),o=(n(7),n(5)),s=n(6),c=n(16),l=n(68),u=n(9),d=a.forwardRef((function(e,t){var n=e.children,s=e.classes,c=e.className,d=e.color,h=void 0===d?"default":d,f=e.component,p=void 0===f?"button":f,m=e.disabled,v=void 0!==m&&m,g=e.disableElevation,y=void 0!==g&&g,b=e.disableFocusRipple,S=void 0!==b&&b,_=e.endIcon,C=e.focusVisibleClassName,w=e.fullWidth,E=void 0!==w&&w,T=e.size,k=void 0===T?"medium":T,M=e.startIcon,D=e.type,x=void 0===D?"button":D,R=e.variant,O=void 0===R?"text":R,I=Object(r.a)(e,["children","classes","className","color","component","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"]),P=M&&a.createElement("span",{className:Object(o.a)(s.startIcon,s["iconSize".concat(Object(u.a)(k))])},M),A=_&&a.createElement("span",{className:Object(o.a)(s.endIcon,s["iconSize".concat(Object(u.a)(k))])},_);return a.createElement(l.a,Object(i.a)({className:Object(o.a)(s.root,s[O],c,"inherit"===h?s.colorInherit:"default"!==h&&s["".concat(O).concat(Object(u.a)(h))],"medium"!==k&&[s["".concat(O,"Size").concat(Object(u.a)(k))],s["size".concat(Object(u.a)(k))]],y&&s.disableElevation,v&&s.disabled,E&&s.fullWidth),component:p,disabled:v,focusRipple:!S,focusVisibleClassName:Object(o.a)(s.focusVisible,C),ref:t,type:x},I),a.createElement("span",{className:s.label},P,n,A))}));t.a=Object(s.a)((function(e){return{root:Object(i.a)({},e.typography.button,{boxSizing:"border-box",minWidth:64,padding:"6px 16px",borderRadius:e.shape.borderRadius,color:e.palette.text.primary,transition:e.transitions.create(["background-color","box-shadow","border"],{duration:e.transitions.duration.short}),"&:hover":{textDecoration:"none",backgroundColor:Object(c.c)(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"},"&$disabled":{backgroundColor:"transparent"}},"&$disabled":{color:e.palette.action.disabled}}),label:{width:"100%",display:"inherit",alignItems:"inherit",justifyContent:"inherit"},text:{padding:"6px 8px"},textPrimary:{color:e.palette.primary.main,"&:hover":{backgroundColor:Object(c.c)(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},textSecondary:{color:e.palette.secondary.main,"&:hover":{backgroundColor:Object(c.c)(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},outlined:{padding:"5px 15px",border:"1px solid ".concat("light"===e.palette.type?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),"&$disabled":{border:"1px solid ".concat(e.palette.action.disabledBackground)}},outlinedPrimary:{color:e.palette.primary.main,border:"1px solid ".concat(Object(c.c)(e.palette.primary.main,.5)),"&:hover":{border:"1px solid ".concat(e.palette.primary.main),backgroundColor:Object(c.c)(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},outlinedSecondary:{color:e.palette.secondary.main,border:"1px solid ".concat(Object(c.c)(e.palette.secondary.main,.5)),"&:hover":{border:"1px solid ".concat(e.palette.secondary.main),backgroundColor:Object(c.c)(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{border:"1px solid ".concat(e.palette.action.disabled)}},contained:{color:e.palette.getContrastText(e.palette.grey[300]),backgroundColor:e.palette.grey[300],boxShadow:e.shadows[2],"&:hover":{backgroundColor:e.palette.grey.A100,boxShadow:e.shadows[4],"@media (hover: none)":{boxShadow:e.shadows[2],backgroundColor:e.palette.grey[300]},"&$disabled":{backgroundColor:e.palette.action.disabledBackground}},"&$focusVisible":{boxShadow:e.shadows[6]},"&:active":{boxShadow:e.shadows[8]},"&$disabled":{color:e.palette.action.disabled,boxShadow:e.shadows[0],backgroundColor:e.palette.action.disabledBackground}},containedPrimary:{color:e.palette.primary.contrastText,backgroundColor:e.palette.primary.main,"&:hover":{backgroundColor:e.palette.primary.dark,"@media (hover: none)":{backgroundColor:e.palette.primary.main}}},containedSecondary:{color:e.palette.secondary.contrastText,backgroundColor:e.palette.secondary.main,"&:hover":{backgroundColor:e.palette.secondary.dark,"@media (hover: none)":{backgroundColor:e.palette.secondary.main}}},disableElevation:{boxShadow:"none","&:hover":{boxShadow:"none"},"&$focusVisible":{boxShadow:"none"},"&:active":{boxShadow:"none"},"&$disabled":{boxShadow:"none"}},focusVisible:{},disabled:{},colorInherit:{color:"inherit",borderColor:"currentColor"},textSizeSmall:{padding:"4px 5px",fontSize:e.typography.pxToRem(13)},textSizeLarge:{padding:"8px 11px",fontSize:e.typography.pxToRem(15)},outlinedSizeSmall:{padding:"3px 9px",fontSize:e.typography.pxToRem(13)},outlinedSizeLarge:{padding:"7px 21px",fontSize:e.typography.pxToRem(15)},containedSizeSmall:{padding:"4px 10px",fontSize:e.typography.pxToRem(13)},containedSizeLarge:{padding:"8px 22px",fontSize:e.typography.pxToRem(15)},sizeSmall:{},sizeLarge:{},fullWidth:{width:"100%"},startIcon:{display:"inherit",marginRight:8,marginLeft:-4,"&$iconSizeSmall":{marginLeft:-2}},endIcon:{display:"inherit",marginRight:-4,marginLeft:8,"&$iconSizeSmall":{marginRight:-2}},iconSizeSmall:{"& > *:first-child":{fontSize:18}},iconSizeMedium:{"& > *:first-child":{fontSize:20}},iconSizeLarge:{"& > *:first-child":{fontSize:22}}}}),{name:"MuiButton"})(d)},function(e,t,n){"use strict";function r(e){var t=e.theme,n=e.name,r=e.props;if(!t||!t.props||!t.props[n])return r;var i,a=t.props[n];for(i in a)void 0===r[i]&&(r[i]=a[i]);return r}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(16),l=n(68),u=n(9),d=a.forwardRef((function(e,t){var n=e.edge,s=void 0!==n&&n,c=e.children,d=e.classes,h=e.className,f=e.color,p=void 0===f?"default":f,m=e.disabled,v=void 0!==m&&m,g=e.disableFocusRipple,y=void 0!==g&&g,b=e.size,S=void 0===b?"medium":b,_=Object(i.a)(e,["edge","children","classes","className","color","disabled","disableFocusRipple","size"]);return a.createElement(l.a,Object(r.a)({className:Object(o.a)(d.root,h,"default"!==p&&d["color".concat(Object(u.a)(p))],v&&d.disabled,"small"===S&&d["size".concat(Object(u.a)(S))],{start:d.edgeStart,end:d.edgeEnd}[s]),centerRipple:!0,focusRipple:!y,disabled:v,ref:t},_),a.createElement("span",{className:d.label},c))}));t.a=Object(s.a)((function(e){return{root:{textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:12,borderRadius:"50%",overflow:"visible",color:e.palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{backgroundColor:Object(c.c)(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{backgroundColor:"transparent",color:e.palette.action.disabled}},edgeStart:{marginLeft:-12,"$sizeSmall&":{marginLeft:-3}},edgeEnd:{marginRight:-12,"$sizeSmall&":{marginRight:-3}},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main,"&:hover":{backgroundColor:Object(c.c)(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},colorSecondary:{color:e.palette.secondary.main,"&:hover":{backgroundColor:Object(c.c)(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},disabled:{},sizeSmall:{padding:3,fontSize:e.typography.pxToRem(18)},label:{width:"100%",display:"flex",alignItems:"inherit",justifyContent:"inherit"}}}),{name:"MuiIconButton"})(d)},function(e,t,n){"use strict";var r=n(4),i=n(3),a=n(1),o=(n(7),n(5)),s=n(6),c=[0,1,2,3,4,5,6,7,8,9,10],l=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12];function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=parseFloat(e);return"".concat(n/t).concat(String(e).replace(String(n),"")||"px")}var d=a.forwardRef((function(e,t){var n=e.alignContent,s=void 0===n?"stretch":n,c=e.alignItems,l=void 0===c?"stretch":c,u=e.classes,d=e.className,h=e.component,f=void 0===h?"div":h,p=e.container,m=void 0!==p&&p,v=e.direction,g=void 0===v?"row":v,y=e.item,b=void 0!==y&&y,S=e.justify,_=void 0===S?"flex-start":S,C=e.lg,w=void 0!==C&&C,E=e.md,T=void 0!==E&&E,k=e.sm,M=void 0!==k&&k,D=e.spacing,x=void 0===D?0:D,R=e.wrap,O=void 0===R?"wrap":R,I=e.xl,P=void 0!==I&&I,A=e.xs,L=void 0!==A&&A,N=e.zeroMinWidth,j=void 0!==N&&N,U=Object(r.a)(e,["alignContent","alignItems","classes","className","component","container","direction","item","justify","lg","md","sm","spacing","wrap","xl","xs","zeroMinWidth"]),F=Object(o.a)(u.root,d,m&&[u.container,0!==x&&u["spacing-xs-".concat(String(x))]],b&&u.item,j&&u.zeroMinWidth,"row"!==g&&u["direction-xs-".concat(String(g))],"wrap"!==O&&u["wrap-xs-".concat(String(O))],"stretch"!==l&&u["align-items-xs-".concat(String(l))],"stretch"!==s&&u["align-content-xs-".concat(String(s))],"flex-start"!==_&&u["justify-xs-".concat(String(_))],!1!==L&&u["grid-xs-".concat(String(L))],!1!==M&&u["grid-sm-".concat(String(M))],!1!==T&&u["grid-md-".concat(String(T))],!1!==w&&u["grid-lg-".concat(String(w))],!1!==P&&u["grid-xl-".concat(String(P))]);return a.createElement(f,Object(i.a)({className:F,ref:t},U))})),h=Object(s.a)((function(e){return Object(i.a)({root:{},container:{boxSizing:"border-box",display:"flex",flexWrap:"wrap",width:"100%"},item:{boxSizing:"border-box",margin:"0"},zeroMinWidth:{minWidth:0},"direction-xs-column":{flexDirection:"column"},"direction-xs-column-reverse":{flexDirection:"column-reverse"},"direction-xs-row-reverse":{flexDirection:"row-reverse"},"wrap-xs-nowrap":{flexWrap:"nowrap"},"wrap-xs-wrap-reverse":{flexWrap:"wrap-reverse"},"align-items-xs-center":{alignItems:"center"},"align-items-xs-flex-start":{alignItems:"flex-start"},"align-items-xs-flex-end":{alignItems:"flex-end"},"align-items-xs-baseline":{alignItems:"baseline"},"align-content-xs-center":{alignContent:"center"},"align-content-xs-flex-start":{alignContent:"flex-start"},"align-content-xs-flex-end":{alignContent:"flex-end"},"align-content-xs-space-between":{alignContent:"space-between"},"align-content-xs-space-around":{alignContent:"space-around"},"justify-xs-center":{justifyContent:"center"},"justify-xs-flex-end":{justifyContent:"flex-end"},"justify-xs-space-between":{justifyContent:"space-between"},"justify-xs-space-around":{justifyContent:"space-around"},"justify-xs-space-evenly":{justifyContent:"space-evenly"}},function(e,t){var n={};return c.forEach((function(r){var i=e.spacing(r);0!==i&&(n["spacing-".concat(t,"-").concat(r)]={margin:"-".concat(u(i,2)),width:"calc(100% + ".concat(u(i),")"),"& > $item":{padding:u(i,2)}})})),n}(e,"xs"),e.breakpoints.keys.reduce((function(t,n){return function(e,t,n){var r={};l.forEach((function(e){var t="grid-".concat(n,"-").concat(e);if(!0!==e)if("auto"!==e){var i="".concat(Math.round(e/12*1e8)/1e6,"%");r[t]={flexBasis:i,flexGrow:0,maxWidth:i}}else r[t]={flexBasis:"auto",flexGrow:0,maxWidth:"none"};else r[t]={flexBasis:0,flexGrow:1,maxWidth:"100%"}})),"xs"===n?Object(i.a)(e,r):e[t.breakpoints.up(n)]=r}(t,e,n),t}),{}))}),{name:"MuiGrid"})(d);t.a=h},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(95),c=n(6),l=a.forwardRef((function(e,t){var n=e.disableUnderline,c=e.classes,l=e.fullWidth,u=void 0!==l&&l,d=e.inputComponent,h=void 0===d?"input":d,f=e.multiline,p=void 0!==f&&f,m=e.type,v=void 0===m?"text":m,g=Object(i.a)(e,["disableUnderline","classes","fullWidth","inputComponent","multiline","type"]);return a.createElement(s.a,Object(r.a)({classes:Object(r.a)({},c,{root:Object(o.a)(c.root,!n&&c.underline),underline:null}),fullWidth:u,inputComponent:h,multiline:p,ref:t,type:v},g))}));l.muiName="Input",t.a=Object(c.a)((function(e){var t="light"===e.palette.type?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return{root:{position:"relative"},formControl:{"label + &":{marginTop:16}},focused:{},disabled:{},colorSecondary:{"&$underline:after":{borderBottomColor:e.palette.secondary.main}},underline:{"&:after":{borderBottom:"2px solid ".concat(e.palette.primary.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:e.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:"1px solid ".concat(t),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:not($disabled):before":{borderBottom:"2px solid ".concat(e.palette.text.primary),"@media (hover: none)":{borderBottom:"1px solid ".concat(t)}},"&$disabled:before":{borderBottomStyle:"dotted"}},error:{},marginDense:{},multiline:{},fullWidth:{},input:{},inputMarginDense:{},inputMultiline:{},inputTypeSearch:{}}}),{name:"MuiInput"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(95),c=n(6),l=a.forwardRef((function(e,t){var n=e.disableUnderline,c=e.classes,l=e.fullWidth,u=void 0!==l&&l,d=e.inputComponent,h=void 0===d?"input":d,f=e.multiline,p=void 0!==f&&f,m=e.type,v=void 0===m?"text":m,g=Object(i.a)(e,["disableUnderline","classes","fullWidth","inputComponent","multiline","type"]);return a.createElement(s.a,Object(r.a)({classes:Object(r.a)({},c,{root:Object(o.a)(c.root,!n&&c.underline),underline:null}),fullWidth:u,inputComponent:h,multiline:p,ref:t,type:v},g))}));l.muiName="Input",t.a=Object(c.a)((function(e){var t="light"===e.palette.type,n=t?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",r=t?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.09)";return{root:{position:"relative",backgroundColor:r,borderTopLeftRadius:e.shape.borderRadius,borderTopRightRadius:e.shape.borderRadius,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),"&:hover":{backgroundColor:t?"rgba(0, 0, 0, 0.13)":"rgba(255, 255, 255, 0.13)","@media (hover: none)":{backgroundColor:r}},"&$focused":{backgroundColor:t?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.09)"},"&$disabled":{backgroundColor:t?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)"}},colorSecondary:{"&$underline:after":{borderBottomColor:e.palette.secondary.main}},underline:{"&:after":{borderBottom:"2px solid ".concat(e.palette.primary.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:e.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:"1px solid ".concat(n),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:before":{borderBottom:"1px solid ".concat(e.palette.text.primary)},"&$disabled:before":{borderBottomStyle:"dotted"}},focused:{},disabled:{},adornedStart:{paddingLeft:12},adornedEnd:{paddingRight:12},error:{},marginDense:{},multiline:{padding:"27px 12px 10px","&$marginDense":{paddingTop:23,paddingBottom:6}},input:{padding:"27px 12px 10px","&:-webkit-autofill":{WebkitBoxShadow:"light"===e.palette.type?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===e.palette.type?null:"#fff",caretColor:"light"===e.palette.type?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},inputMarginDense:{paddingTop:23,paddingBottom:6},inputHiddenLabel:{paddingTop:18,paddingBottom:19,"&$inputMarginDense":{paddingTop:10,paddingBottom:11}},inputMultiline:{padding:0},inputAdornedStart:{paddingLeft:0},inputAdornedEnd:{paddingRight:0}}}),{name:"MuiFilledInput"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(42),c=n(6),l=n(9),u=n(35),d=n(41),h=a.forwardRef((function(e,t){var n=e.children,c=e.classes,h=e.className,f=e.color,p=void 0===f?"primary":f,m=e.component,v=void 0===m?"div":m,g=e.disabled,y=void 0!==g&&g,b=e.error,S=void 0!==b&&b,_=e.fullWidth,C=void 0!==_&&_,w=e.focused,E=e.hiddenLabel,T=void 0!==E&&E,k=e.margin,M=void 0===k?"none":k,D=e.required,x=void 0!==D&&D,R=e.size,O=e.variant,I=void 0===O?"standard":O,P=Object(i.a)(e,["children","classes","className","color","component","disabled","error","fullWidth","focused","hiddenLabel","margin","required","size","variant"]),A=a.useState((function(){var e=!1;return n&&a.Children.forEach(n,(function(t){if(Object(u.a)(t,["Input","Select"])){var n=Object(u.a)(t,["Select"])?t.props.input:t;n&&Object(s.a)(n.props)&&(e=!0)}})),e})),L=A[0],N=A[1],j=a.useState((function(){var e=!1;return n&&a.Children.forEach(n,(function(t){Object(u.a)(t,["Input","Select"])&&Object(s.b)(t.props,!0)&&(e=!0)})),e})),U=j[0],F=j[1],H=a.useState(!1),W=H[0],Y=H[1],B=void 0!==w?w:W;y&&B&&Y(!1);var V=a.useCallback((function(){F(!0)}),[]),$={adornedStart:L,setAdornedStart:N,color:p,disabled:y,error:S,filled:U,focused:B,fullWidth:C,hiddenLabel:T,margin:("small"===R?"dense":void 0)||M,onBlur:function(){Y(!1)},onEmpty:a.useCallback((function(){F(!1)}),[]),onFilled:V,onFocus:function(){Y(!0)},registerEffect:undefined,required:x,variant:I};return a.createElement(d.a.Provider,{value:$},a.createElement(v,Object(r.a)({className:Object(o.a)(c.root,h,"none"!==M&&c["margin".concat(Object(l.a)(M))],C&&c.fullWidth),ref:t},P),n))}));t.a=Object(c.a)({root:{display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},marginNormal:{marginTop:16,marginBottom:8},marginDense:{marginTop:8,marginBottom:4},fullWidth:{width:"100%"}},{name:"MuiFormControl"})(h)},function(e,t,n){"use strict";var r=n(3),i=n(29),a=n(4),o=n(1),s=(n(7),n(119)),c=n(34),l=n(37),u=n(12);function d(e){return"scale(".concat(e,", ").concat(Math.pow(e,2),")")}var h={entering:{opacity:1,transform:d(1)},entered:{opacity:1,transform:"none"}},f=o.forwardRef((function(e,t){var n=e.children,f=e.disableStrictModeCompat,p=void 0!==f&&f,m=e.in,v=e.onEnter,g=e.onEntered,y=e.onEntering,b=e.onExit,S=e.onExited,_=e.onExiting,C=e.style,w=e.timeout,E=void 0===w?"auto":w,T=e.TransitionComponent,k=void 0===T?s.a:T,M=Object(a.a)(e,["children","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),D=o.useRef(),x=o.useRef(),R=Object(c.a)(),O=R.unstable_strictMode&&!p,I=o.useRef(null),P=Object(u.a)(n.ref,t),A=Object(u.a)(O?I:void 0,P),L=function(e){return function(t,n){if(e){var r=O?[I.current,t]:[t,n],a=Object(i.a)(r,2),o=a[0],s=a[1];void 0===s?e(o):e(o,s)}}},N=L(y),j=L((function(e,t){Object(l.b)(e);var n,r=Object(l.a)({style:C,timeout:E},{mode:"enter"}),i=r.duration,a=r.delay;"auto"===E?(n=R.transitions.getAutoHeightDuration(e.clientHeight),x.current=n):n=i,e.style.transition=[R.transitions.create("opacity",{duration:n,delay:a}),R.transitions.create("transform",{duration:.666*n,delay:a})].join(","),v&&v(e,t)})),U=L(g),F=L(_),H=L((function(e){var t,n=Object(l.a)({style:C,timeout:E},{mode:"exit"}),r=n.duration,i=n.delay;"auto"===E?(t=R.transitions.getAutoHeightDuration(e.clientHeight),x.current=t):t=r,e.style.transition=[R.transitions.create("opacity",{duration:t,delay:i}),R.transitions.create("transform",{duration:.666*t,delay:i||.333*t})].join(","),e.style.opacity="0",e.style.transform=d(.75),b&&b(e)})),W=L(S);return o.useEffect((function(){return function(){clearTimeout(D.current)}}),[]),o.createElement(k,Object(r.a)({appear:!0,in:m,nodeRef:O?I:void 0,onEnter:j,onEntered:U,onEntering:N,onExit:H,onExited:W,onExiting:F,addEndListener:function(e,t){var n=O?e:t;"auto"===E&&(D.current=setTimeout(n,x.current||0))},timeout:"auto"===E?null:E},M),(function(e,t){return o.cloneElement(n,Object(r.a)({style:Object(r.a)({opacity:0,transform:d(.75),visibility:"exited"!==e||m?void 0:"hidden"},h[e],C,n.props.style),ref:A},t))}))}));f.muiSupportAuto=!0,t.a=f},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(30),l=a.forwardRef((function(e,t){var n=e.children,s=e.classes,l=e.className,u=e.component,d=void 0===u?"ul":u,h=e.dense,f=void 0!==h&&h,p=e.disablePadding,m=void 0!==p&&p,v=e.subheader,g=Object(i.a)(e,["children","classes","className","component","dense","disablePadding","subheader"]),y=a.useMemo((function(){return{dense:f}}),[f]);return a.createElement(c.a.Provider,{value:y},a.createElement(d,Object(r.a)({className:Object(o.a)(s.root,l,f&&s.dense,!m&&s.padding,v&&s.subheader),ref:t},g),v,n))}));t.a=Object(s.a)({root:{listStyle:"none",margin:0,padding:0,position:"relative"},padding:{paddingTop:8,paddingBottom:8},dense:{},subheader:{paddingTop:0}},{name:"MuiList"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(9),l=44,u=a.forwardRef((function(e,t){var n=e.classes,s=e.className,u=e.color,d=void 0===u?"primary":u,h=e.disableShrink,f=void 0!==h&&h,p=e.size,m=void 0===p?40:p,v=e.style,g=e.thickness,y=void 0===g?3.6:g,b=e.value,S=void 0===b?0:b,_=e.variant,C=void 0===_?"indeterminate":_,w=Object(i.a)(e,["classes","className","color","disableShrink","size","style","thickness","value","variant"]),E={},T={},k={};if("determinate"===C||"static"===C){var M=2*Math.PI*((l-y)/2);E.strokeDasharray=M.toFixed(3),k["aria-valuenow"]=Math.round(S),E.strokeDashoffset="".concat(((100-S)/100*M).toFixed(3),"px"),T.transform="rotate(-90deg)"}return a.createElement("div",Object(r.a)({className:Object(o.a)(n.root,s,"inherit"!==d&&n["color".concat(Object(c.a)(d))],{determinate:n.determinate,indeterminate:n.indeterminate,static:n.static}[C]),style:Object(r.a)({width:m,height:m},T,v),ref:t,role:"progressbar"},k,w),a.createElement("svg",{className:n.svg,viewBox:"".concat(22," ").concat(22," ").concat(l," ").concat(l)},a.createElement("circle",{className:Object(o.a)(n.circle,f&&n.circleDisableShrink,{determinate:n.circleDeterminate,indeterminate:n.circleIndeterminate,static:n.circleStatic}[C]),style:E,cx:l,cy:l,r:(l-y)/2,fill:"none",strokeWidth:y})))}));t.a=Object(s.a)((function(e){return{root:{display:"inline-block"},static:{transition:e.transitions.create("transform")},indeterminate:{animation:"$circular-rotate 1.4s linear infinite"},determinate:{transition:e.transitions.create("transform")},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},svg:{display:"block"},circle:{stroke:"currentColor"},circleStatic:{transition:e.transitions.create("stroke-dashoffset")},circleIndeterminate:{animation:"$circular-dash 1.4s ease-in-out infinite",strokeDasharray:"80px, 200px",strokeDashoffset:"0px"},circleDeterminate:{transition:e.transitions.create("stroke-dashoffset")},"@keyframes circular-rotate":{"0%":{transformOrigin:"50% 50%"},"100%":{transform:"rotate(360deg)"}},"@keyframes circular-dash":{"0%":{strokeDasharray:"1px, 200px",strokeDashoffset:"0px"},"50%":{strokeDasharray:"100px, 200px",strokeDashoffset:"-15px"},"100%":{strokeDasharray:"100px, 200px",strokeDashoffset:"-125px"}},circleDisableShrink:{animation:"none"}}}),{name:"MuiCircularProgress",flip:!1})(u)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(30),l=a.forwardRef((function(e,t){var n=e.classes,s=e.className,l=Object(i.a)(e,["classes","className"]),u=a.useContext(c.a);return a.createElement("div",Object(r.a)({className:Object(o.a)(n.root,s,"flex-start"===u.alignItems&&n.alignItemsFlexStart),ref:t},l))}));t.a=Object(s.a)({root:{minWidth:56,flexShrink:0},alignItemsFlexStart:{marginTop:8}},{name:"MuiListItemAvatar"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(32),l=n(30),u=a.forwardRef((function(e,t){var n=e.children,s=e.classes,u=e.className,d=e.disableTypography,h=void 0!==d&&d,f=e.inset,p=void 0!==f&&f,m=e.primary,v=e.primaryTypographyProps,g=e.secondary,y=e.secondaryTypographyProps,b=Object(i.a)(e,["children","classes","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"]),S=a.useContext(l.a).dense,_=null!=m?m:n;null==_||_.type===c.a||h||(_=a.createElement(c.a,Object(r.a)({variant:S?"body2":"body1",className:s.primary,component:"span",display:"block"},v),_));var C=g;return null==C||C.type===c.a||h||(C=a.createElement(c.a,Object(r.a)({variant:"body2",className:s.secondary,color:"textSecondary",display:"block"},y),C)),a.createElement("div",Object(r.a)({className:Object(o.a)(s.root,u,S&&s.dense,p&&s.inset,_&&C&&s.multiline),ref:t},b),_,C)}));t.a=Object(s.a)({root:{flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},multiline:{marginTop:6,marginBottom:6},dense:{},inset:{paddingLeft:56},primary:{},secondary:{}},{name:"MuiListItemText"})(u)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=a.forwardRef((function(e,t){var n=e.classes,s=e.className,c=Object(i.a)(e,["classes","className"]);return a.createElement("div",Object(r.a)({className:Object(o.a)(n.root,s),ref:t},c))}));c.muiName="ListItemSecondaryAction",t.a=Object(s.a)({root:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"}},{name:"MuiListItemSecondaryAction"})(c)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(94),c=n(6),l=a.forwardRef((function(e,t){var n=e.classes,c=e.className,l=e.raised,u=void 0!==l&&l,d=Object(i.a)(e,["classes","className","raised"]);return a.createElement(s.a,Object(r.a)({className:Object(o.a)(n.root,c),elevation:u?8:1,ref:t},d))}));t.a=Object(c.a)({root:{overflow:"hidden"}},{name:"MuiCard"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(32),l=a.forwardRef((function(e,t){var n=e.action,s=e.avatar,l=e.classes,u=e.className,d=e.component,h=void 0===d?"div":d,f=e.disableTypography,p=void 0!==f&&f,m=e.subheader,v=e.subheaderTypographyProps,g=e.title,y=e.titleTypographyProps,b=Object(i.a)(e,["action","avatar","classes","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"]),S=g;null==S||S.type===c.a||p||(S=a.createElement(c.a,Object(r.a)({variant:s?"body2":"h5",className:l.title,component:"span",display:"block"},y),S));var _=m;return null==_||_.type===c.a||p||(_=a.createElement(c.a,Object(r.a)({variant:s?"body2":"body1",className:l.subheader,color:"textSecondary",component:"span",display:"block"},v),_)),a.createElement(h,Object(r.a)({className:Object(o.a)(l.root,u),ref:t},b),s&&a.createElement("div",{className:l.avatar},s),a.createElement("div",{className:l.content},S,_),n&&a.createElement("div",{className:l.action},n))}));t.a=Object(s.a)({root:{display:"flex",alignItems:"center",padding:16},avatar:{flex:"0 0 auto",marginRight:16},action:{flex:"0 0 auto",alignSelf:"flex-start",marginTop:-8,marginRight:-8},content:{flex:"1 1 auto"},title:{},subheader:{}},{name:"MuiCardHeader"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(16),l=a.forwardRef((function(e,t){var n=e.absolute,s=void 0!==n&&n,c=e.classes,l=e.className,u=e.component,d=void 0===u?"hr":u,h=e.flexItem,f=void 0!==h&&h,p=e.light,m=void 0!==p&&p,v=e.orientation,g=void 0===v?"horizontal":v,y=e.role,b=void 0===y?"hr"!==d?"separator":void 0:y,S=e.variant,_=void 0===S?"fullWidth":S,C=Object(i.a)(e,["absolute","classes","className","component","flexItem","light","orientation","role","variant"]);return a.createElement(d,Object(r.a)({className:Object(o.a)(c.root,l,"fullWidth"!==_&&c[_],s&&c.absolute,f&&c.flexItem,m&&c.light,"vertical"===g&&c.vertical),role:b,ref:t},C))}));t.a=Object(s.a)((function(e){return{root:{height:1,margin:0,border:"none",flexShrink:0,backgroundColor:e.palette.divider},absolute:{position:"absolute",bottom:0,left:0,width:"100%"},inset:{marginLeft:72},light:{backgroundColor:Object(c.c)(e.palette.divider,.08)},middle:{marginLeft:e.spacing(2),marginRight:e.spacing(2)},vertical:{height:"100%",width:1},flexItem:{alignSelf:"stretch",height:"auto"}}}),{name:"MuiDivider"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=a.forwardRef((function(e,t){var n=e.classes,s=e.className,c=e.component,l=void 0===c?"div":c,u=Object(i.a)(e,["classes","className","component"]);return a.createElement(l,Object(r.a)({className:Object(o.a)(n.root,s),ref:t},u))}));t.a=Object(s.a)({root:{padding:16,"&:last-child":{paddingBottom:24}}},{name:"MuiCardContent"})(c)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(32),l=a.forwardRef((function(e,t){var n=e.children,s=e.classes,l=e.className,u=e.disableTypography,d=void 0!==u&&u,h=Object(i.a)(e,["children","classes","className","disableTypography"]);return a.createElement("div",Object(r.a)({className:Object(o.a)(s.root,l),ref:t},h),d?n:a.createElement(c.a,{component:"h2",variant:"h6"},n))}));t.a=Object(s.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=a.forwardRef((function(e,t){var n=e.classes,s=e.className,c=e.row,l=void 0!==c&&c,u=Object(i.a)(e,["classes","className","row"]);return a.createElement("div",Object(r.a)({className:Object(o.a)(n.root,s,l&&n.row),ref:t},u))}));t.a=Object(s.a)({root:{display:"flex",flexDirection:"column",flexWrap:"wrap"},row:{flexDirection:"row"}},{name:"MuiFormGroup"})(c)},function(e,t,n){"use strict";var r=n(4),i=n(15),a=n(3),o=n(1),s=(n(7),n(5)),c=n(6),l=n(116),u=o.forwardRef((function(e,t){var n,i=e.classes,c=e.className,u=e.component,d=void 0===u?"li":u,h=e.disableGutters,f=void 0!==h&&h,p=e.ListItemClasses,m=e.role,v=void 0===m?"menuitem":m,g=e.selected,y=e.tabIndex,b=Object(r.a)(e,["classes","className","component","disableGutters","ListItemClasses","role","selected","tabIndex"]);return e.disabled||(n=void 0!==y?y:-1),o.createElement(l.a,Object(a.a)({button:!0,role:v,tabIndex:n,component:d,selected:g,disableGutters:f,classes:Object(a.a)({dense:i.dense},p),className:Object(s.a)(i.root,c,g&&i.selected,!f&&i.gutters),ref:t},b))}));t.a=Object(c.a)((function(e){return{root:Object(a.a)({},e.typography.body1,Object(i.a)({minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",width:"auto",overflow:"hidden",whiteSpace:"nowrap"},e.breakpoints.up("sm"),{minHeight:"auto"})),gutters:{},selected:{},dense:Object(a.a)({},e.typography.body2,{minHeight:"auto"})}}),{name:"MuiMenuItem"})(u)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(9),l=n(94),u=a.forwardRef((function(e,t){var n=e.classes,s=e.className,u=e.color,d=void 0===u?"primary":u,h=e.position,f=void 0===h?"fixed":h,p=Object(i.a)(e,["classes","className","color","position"]);return a.createElement(l.a,Object(r.a)({square:!0,component:"header",elevation:4,className:Object(o.a)(n.root,n["position".concat(Object(c.a)(f))],n["color".concat(Object(c.a)(d))],s,"fixed"===f&&"mui-fixed"),ref:t},p))}));t.a=Object(s.a)((function(e){var t="light"===e.palette.type?e.palette.grey[100]:e.palette.grey[900];return{root:{display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",zIndex:e.zIndex.appBar,flexShrink:0},positionFixed:{position:"fixed",top:0,left:"auto",right:0,"@media print":{position:"absolute"}},positionAbsolute:{position:"absolute",top:0,left:"auto",right:0},positionSticky:{position:"sticky",top:0,left:"auto",right:0},positionStatic:{position:"static"},positionRelative:{position:"relative"},colorDefault:{backgroundColor:t,color:e.palette.getContrastText(t)},colorPrimary:{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText},colorSecondary:{backgroundColor:e.palette.secondary.main,color:e.palette.secondary.contrastText},colorInherit:{color:"inherit"},colorTransparent:{backgroundColor:"transparent",color:"inherit"}}}),{name:"MuiAppBar"})(u)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(15),o=n(1),s=(n(7),n(5)),c=n(6),l=o.forwardRef((function(e,t){var n=e.classes,a=e.className,c=e.component,l=void 0===c?"div":c,u=e.disableGutters,d=void 0!==u&&u,h=e.variant,f=void 0===h?"regular":h,p=Object(i.a)(e,["classes","className","component","disableGutters","variant"]);return o.createElement(l,Object(r.a)({className:Object(s.a)(n.root,n[f],a,!d&&n.gutters),ref:t},p))}));t.a=Object(c.a)((function(e){return{root:{position:"relative",display:"flex",alignItems:"center"},gutters:Object(a.a)({paddingLeft:e.spacing(2),paddingRight:e.spacing(2)},e.breakpoints.up("sm"),{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}),regular:e.mixins.toolbar,dense:{minHeight:48}}}),{name:"MuiToolbar"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(55),n(7),n(5)),s=n(6),c=a.forwardRef((function(e,t){var n=e.children,s=e.classes,c=e.className,l=e.component,u=void 0===l?"div":l,d=e.onChange,h=e.showLabels,f=void 0!==h&&h,p=e.value,m=Object(i.a)(e,["children","classes","className","component","onChange","showLabels","value"]);return a.createElement(u,Object(r.a)({className:Object(o.a)(s.root,c),ref:t},m),a.Children.map(n,(function(e,t){if(!a.isValidElement(e))return null;var n=void 0===e.props.value?t:e.props.value;return a.cloneElement(e,{selected:n===p,showLabel:void 0!==e.props.showLabel?e.props.showLabel:f,value:n,onChange:d})})))}));t.a=Object(s.a)((function(e){return{root:{display:"flex",justifyContent:"center",height:56,backgroundColor:e.palette.background.paper}}}),{name:"MuiBottomNavigation"})(c)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(68),l=a.forwardRef((function(e,t){var n=e.classes,s=e.className,l=e.icon,u=e.label,d=e.onChange,h=e.onClick,f=e.selected,p=e.showLabel,m=e.value,v=Object(i.a)(e,["classes","className","icon","label","onChange","onClick","selected","showLabel","value"]);return a.createElement(c.a,Object(r.a)({ref:t,className:Object(o.a)(n.root,s,f?n.selected:!p&&n.iconOnly),focusRipple:!0,onClick:function(e){d&&d(e,m),h&&h(e)}},v),a.createElement("span",{className:n.wrapper},l,a.createElement("span",{className:Object(o.a)(n.label,f?n.selected:!p&&n.iconOnly)},u)))}));t.a=Object(s.a)((function(e){return{root:{transition:e.transitions.create(["color","padding-top"],{duration:e.transitions.duration.short}),padding:"6px 12px 8px",minWidth:80,maxWidth:168,color:e.palette.text.secondary,flex:"1","&$iconOnly":{paddingTop:16},"&$selected":{paddingTop:6,color:e.palette.primary.main}},selected:{},iconOnly:{},wrapper:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"100%",flexDirection:"column"},label:{fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(12),opacity:1,transition:"font-size 0.2s, opacity 0.2s",transitionDelay:"0.1s","&$iconOnly":{opacity:0,transitionDelay:"0s"},"&$selected":{fontSize:e.typography.pxToRem(14)}}}}),{name:"MuiBottomNavigationAction"})(l)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(149)),s=n(29),c=n(39),l=n(93),u=(n(55),n(5)),d=n(17),h=n(9),f=n(6),p=n(14),m=n(46),v=n(48),g=n(28),y=n(177),b=n(158),S=n(94);function _(e,t){var n=0;return"number"===typeof t?n=t:"center"===t?n=e.height/2:"bottom"===t&&(n=e.height),n}function C(e,t){var n=0;return"number"===typeof t?n=t:"center"===t?n=e.width/2:"right"===t&&(n=e.width),n}function w(e){return[e.horizontal,e.vertical].map((function(e){return"number"===typeof e?"".concat(e,"px"):e})).join(" ")}function E(e){return"function"===typeof e?e():e}var T=a.forwardRef((function(e,t){var n=e.action,o=e.anchorEl,s=e.anchorOrigin,c=void 0===s?{vertical:"top",horizontal:"left"}:s,l=e.anchorPosition,h=e.anchorReference,f=void 0===h?"anchorEl":h,T=e.children,k=e.classes,M=e.className,D=e.container,x=e.elevation,R=void 0===x?8:x,O=e.getContentAnchorEl,I=e.marginThreshold,P=void 0===I?16:I,A=e.onEnter,L=e.onEntered,N=e.onEntering,j=e.onExit,U=e.onExited,F=e.onExiting,H=e.open,W=e.PaperProps,Y=void 0===W?{}:W,B=e.transformOrigin,V=void 0===B?{vertical:"top",horizontal:"left"}:B,$=e.TransitionComponent,G=void 0===$?b.a:$,z=e.transitionDuration,q=void 0===z?"auto":z,J=e.TransitionProps,K=void 0===J?{}:J,Q=Object(i.a)(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),X=a.useRef(),Z=a.useCallback((function(e){if("anchorPosition"===f)return l;var t=E(o),n=(t&&1===t.nodeType?t:Object(d.a)(X.current).body).getBoundingClientRect(),r=0===e?c.vertical:"center";return{top:n.top+_(n,r),left:n.left+C(n,c.horizontal)}}),[o,c.horizontal,c.vertical,l,f]),ee=a.useCallback((function(e){var t=0;if(O&&"anchorEl"===f){var n=O(e);if(n&&e.contains(n)){var r=function(e,t){for(var n=t,r=0;n&&n!==e;)r+=(n=n.parentElement).scrollTop;return r}(e,n);t=n.offsetTop+n.clientHeight/2-r||0}0}return t}),[c.vertical,f,O]),te=a.useCallback((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{vertical:_(e,V.vertical)+t,horizontal:C(e,V.horizontal)}}),[V.horizontal,V.vertical]),ne=a.useCallback((function(e){var t=ee(e),n={width:e.offsetWidth,height:e.offsetHeight},r=te(n,t);if("none"===f)return{top:null,left:null,transformOrigin:w(r)};var i=Z(t),a=i.top-r.vertical,s=i.left-r.horizontal,c=a+n.height,l=s+n.width,u=Object(v.a)(E(o)),d=u.innerHeight-P,h=u.innerWidth-P;if(a<P){var p=a-P;a-=p,r.vertical+=p}else if(c>d){var m=c-d;a-=m,r.vertical+=m}if(s<P){var g=s-P;s-=g,r.horizontal+=g}else if(l>h){var y=l-h;s-=y,r.horizontal+=y}return{top:"".concat(Math.round(a),"px"),left:"".concat(Math.round(s),"px"),transformOrigin:w(r)}}),[o,f,Z,ee,te,P]),re=a.useCallback((function(){var e=X.current;if(e){var t=ne(e);null!==t.top&&(e.style.top=t.top),null!==t.left&&(e.style.left=t.left),e.style.transformOrigin=t.transformOrigin}}),[ne]),ie=a.useCallback((function(e){X.current=p.findDOMNode(e)}),[]);a.useEffect((function(){H&&re()})),a.useImperativeHandle(n,(function(){return H?{updatePosition:function(){re()}}:null}),[H,re]),a.useEffect((function(){if(H){var e=Object(m.a)((function(){re()}));return window.addEventListener("resize",e),function(){e.clear(),window.removeEventListener("resize",e)}}}),[H,re]);var ae=q;"auto"!==q||G.muiSupportAuto||(ae=void 0);var oe=D||(o?Object(d.a)(E(o)).body:void 0);return a.createElement(y.a,Object(r.a)({container:oe,open:H,ref:t,BackdropProps:{invisible:!0},className:Object(u.a)(k.root,M)},Q),a.createElement(G,Object(r.a)({appear:!0,in:H,onEnter:A,onEntered:L,onExit:j,onExited:U,onExiting:F,timeout:ae},K,{onEntering:Object(g.a)((function(e,t){N&&N(e,t),re()}),K.onEntering)}),a.createElement(S.a,Object(r.a)({elevation:R,ref:ie},Y,{className:Object(u.a)(k.paper,Y.className)}),T)))})),k=Object(f.a)({root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}},{name:"MuiPopover"})(T),M=n(159),D=n(64),x=n(12);function R(e,t,n){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:n?null:e.firstChild}function O(e,t,n){return e===t?n?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:n?null:e.lastChild}function I(e,t){if(void 0===t)return!0;var n=e.innerText;return void 0===n&&(n=e.textContent),0!==(n=n.trim().toLowerCase()).length&&(t.repeating?n[0]===t.keys[0]:0===n.indexOf(t.keys.join("")))}function P(e,t,n,r,i,a){for(var o=!1,s=i(e,t,!!t&&n);s;){if(s===e.firstChild){if(o)return;o=!0}var c=!r&&(s.disabled||"true"===s.getAttribute("aria-disabled"));if(s.hasAttribute("tabindex")&&I(s,a)&&!c)return void s.focus();s=i(e,s,n)}}var A="undefined"===typeof window?a.useEffect:a.useLayoutEffect,L=a.forwardRef((function(e,t){var n=e.actions,o=e.autoFocus,s=void 0!==o&&o,c=e.autoFocusItem,l=void 0!==c&&c,u=e.children,h=e.className,f=e.disabledItemsFocusable,m=void 0!==f&&f,v=e.disableListWrap,g=void 0!==v&&v,y=e.onKeyDown,b=e.variant,S=void 0===b?"selectedMenu":b,_=Object(i.a)(e,["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"]),C=a.useRef(null),w=a.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});A((function(){s&&C.current.focus()}),[s]),a.useImperativeHandle(n,(function(){return{adjustStyleForScrollbar:function(e,t){var n=!C.current.style.width;if(e.clientHeight<C.current.clientHeight&&n){var r="".concat(Object(D.a)(!0),"px");C.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=r,C.current.style.width="calc(100% + ".concat(r,")")}return C.current}}}),[]);var E=a.useCallback((function(e){C.current=p.findDOMNode(e)}),[]),T=Object(x.a)(E,t),k=-1;a.Children.forEach(u,(function(e,t){a.isValidElement(e)&&(e.props.disabled||("selectedMenu"===S&&e.props.selected||-1===k)&&(k=t))}));var L=a.Children.map(u,(function(e,t){if(t===k){var n={};return l&&(n.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===S&&(n.tabIndex=0),a.cloneElement(e,n)}return e}));return a.createElement(M.a,Object(r.a)({role:"menu",ref:T,className:h,onKeyDown:function(e){var t=C.current,n=e.key,r=Object(d.a)(t).activeElement;if("ArrowDown"===n)e.preventDefault(),P(t,r,g,m,R);else if("ArrowUp"===n)e.preventDefault(),P(t,r,g,m,O);else if("Home"===n)e.preventDefault(),P(t,null,g,m,R);else if("End"===n)e.preventDefault(),P(t,null,g,m,O);else if(1===n.length){var i=w.current,a=n.toLowerCase(),o=performance.now();i.keys.length>0&&(o-i.lastTime>500?(i.keys=[],i.repeating=!0,i.previousKeyMatched=!0):i.repeating&&a!==i.keys[0]&&(i.repeating=!1)),i.lastTime=o,i.keys.push(a);var s=r&&!i.repeating&&I(r,i);i.previousKeyMatched&&(s||P(t,r,!1,m,R,i))?e.preventDefault():i.previousKeyMatched=!1}y&&y(e)},tabIndex:s?0:-1},_),L)})),N=n(27),j=n(34),U={vertical:"top",horizontal:"right"},F={vertical:"top",horizontal:"left"},H=a.forwardRef((function(e,t){var n=e.autoFocus,o=void 0===n||n,s=e.children,c=e.classes,l=e.disableAutoFocusItem,d=void 0!==l&&l,h=e.MenuListProps,f=void 0===h?{}:h,m=e.onClose,v=e.onEntering,g=e.open,y=e.PaperProps,b=void 0===y?{}:y,S=e.PopoverClasses,_=e.transitionDuration,C=void 0===_?"auto":_,w=e.variant,E=void 0===w?"selectedMenu":w,T=Object(i.a)(e,["autoFocus","children","classes","disableAutoFocusItem","MenuListProps","onClose","onEntering","open","PaperProps","PopoverClasses","transitionDuration","variant"]),M=Object(j.a)(),D=o&&!d&&g,x=a.useRef(null),R=a.useRef(null),O=-1;a.Children.map(s,(function(e,t){a.isValidElement(e)&&(e.props.disabled||("menu"!==E&&e.props.selected||-1===O)&&(O=t))}));var I=a.Children.map(s,(function(e,t){return t===O?a.cloneElement(e,{ref:function(t){R.current=p.findDOMNode(t),Object(N.a)(e.ref,t)}}):e}));return a.createElement(k,Object(r.a)({getContentAnchorEl:function(){return R.current},classes:S,onClose:m,onEntering:function(e,t){x.current&&x.current.adjustStyleForScrollbar(e,M),v&&v(e,t)},anchorOrigin:"rtl"===M.direction?U:F,transformOrigin:"rtl"===M.direction?U:F,PaperProps:Object(r.a)({},b,{classes:Object(r.a)({},b.classes,{root:c.paper})}),open:g,ref:t,transitionDuration:C},T),a.createElement(L,Object(r.a)({onKeyDown:function(e){"Tab"===e.key&&(e.preventDefault(),m&&m(e,"tabKeyDown"))},actions:x,autoFocus:o&&(-1===O||d),autoFocusItem:D,variant:E},f,{className:Object(u.a)(c.list,f.className)}),I))})),W=Object(f.a)({paper:{maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"},list:{outline:0}},{name:"MuiMenu"})(H),Y=n(42),B=n(47);function V(e,t){return"object"===Object(c.a)(t)&&null!==t?e===t:String(e)===String(t)}var $=a.forwardRef((function(e,t){var n=e["aria-label"],o=e.autoFocus,c=e.autoWidth,f=e.children,p=e.classes,m=e.className,v=e.defaultValue,g=e.disabled,y=e.displayEmpty,b=e.IconComponent,S=e.inputRef,_=e.labelId,C=e.MenuProps,w=void 0===C?{}:C,E=e.multiple,T=e.name,k=e.onBlur,M=e.onChange,D=e.onClose,R=e.onFocus,O=e.onOpen,I=e.open,P=e.readOnly,A=e.renderValue,L=e.SelectDisplayProps,N=void 0===L?{}:L,j=e.tabIndex,U=(e.type,e.value),F=e.variant,H=void 0===F?"standard":F,$=Object(i.a)(e,["aria-label","autoFocus","autoWidth","children","classes","className","defaultValue","disabled","displayEmpty","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"]),G=Object(B.a)({controlled:U,default:v,name:"Select"}),z=Object(s.a)(G,2),q=z[0],J=z[1],K=a.useRef(null),Q=a.useState(null),X=Q[0],Z=Q[1],ee=a.useRef(null!=I).current,te=a.useState(),ne=te[0],re=te[1],ie=a.useState(!1),ae=ie[0],oe=ie[1],se=Object(x.a)(t,S);a.useImperativeHandle(se,(function(){return{focus:function(){X.focus()},node:K.current,value:q}}),[X,q]),a.useEffect((function(){o&&X&&X.focus()}),[o,X]),a.useEffect((function(){if(X){var e=Object(d.a)(X).getElementById(_);if(e){var t=function(){getSelection().isCollapsed&&X.focus()};return e.addEventListener("click",t),function(){e.removeEventListener("click",t)}}}}),[_,X]);var ce,le,ue=function(e,t){e?O&&O(t):D&&D(t),ee||(re(c?null:X.clientWidth),oe(e))},de=a.Children.toArray(f),he=function(e){return function(t){var n;if(E||ue(!1,t),E){n=Array.isArray(q)?q.slice():[];var r=q.indexOf(e.props.value);-1===r?n.push(e.props.value):n.splice(r,1)}else n=e.props.value;e.props.onClick&&e.props.onClick(t),q!==n&&(J(n),M&&(t.persist(),Object.defineProperty(t,"target",{writable:!0,value:{value:n,name:T}}),M(t,e)))}},fe=null!==X&&(ee?I:ae);delete $["aria-invalid"];var pe=[],me=!1;(Object(Y.b)({value:q})||y)&&(A?ce=A(q):me=!0);var ve=de.map((function(e){if(!a.isValidElement(e))return null;var t;if(E){if(!Array.isArray(q))throw new Error(Object(l.a)(2));(t=q.some((function(t){return V(t,e.props.value)})))&&me&&pe.push(e.props.children)}else(t=V(q,e.props.value))&&me&&(le=e.props.children);return t&&!0,a.cloneElement(e,{"aria-selected":t?"true":void 0,onClick:he(e),onKeyUp:function(t){" "===t.key&&t.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(t)},role:"option",selected:t,value:void 0,"data-value":e.props.value})}));me&&(ce=E?pe.join(", "):le);var ge,ye=ne;!c&&ee&&X&&(ye=X.clientWidth),ge="undefined"!==typeof j?j:g?null:0;var be=N.id||(T?"mui-component-select-".concat(T):void 0);return a.createElement(a.Fragment,null,a.createElement("div",Object(r.a)({className:Object(u.a)(p.root,p.select,p.selectMenu,p[H],m,g&&p.disabled),ref:Z,tabIndex:ge,role:"button","aria-disabled":g?"true":void 0,"aria-expanded":fe?"true":void 0,"aria-haspopup":"listbox","aria-label":n,"aria-labelledby":[_,be].filter(Boolean).join(" ")||void 0,onKeyDown:function(e){if(!P){-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),ue(!0,e))}},onMouseDown:g||P?null:function(e){0===e.button&&(e.preventDefault(),X.focus(),ue(!0,e))},onBlur:function(e){!fe&&k&&(e.persist(),Object.defineProperty(e,"target",{writable:!0,value:{value:q,name:T}}),k(e))},onFocus:R},N,{id:be}),function(e){return null==e||"string"===typeof e&&!e.trim()}(ce)?a.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}}):ce),a.createElement("input",Object(r.a)({value:Array.isArray(q)?q.join(","):q,name:T,ref:K,"aria-hidden":!0,onChange:function(e){var t=de.map((function(e){return e.props.value})).indexOf(e.target.value);if(-1!==t){var n=de[t];J(n.props.value),M&&M(e,n)}},tabIndex:-1,className:p.nativeInput,autoFocus:o},$)),a.createElement(b,{className:Object(u.a)(p.icon,p["icon".concat(Object(h.a)(H))],fe&&p.iconOpen,g&&p.disabled)}),a.createElement(W,Object(r.a)({id:"menu-".concat(T||""),anchorEl:X,open:fe,onClose:function(e){ue(!1,e)}},w,{MenuListProps:Object(r.a)({"aria-labelledby":_,role:"listbox",disableListWrap:!0},w.MenuListProps),PaperProps:Object(r.a)({},w.PaperProps,{style:Object(r.a)({minWidth:ye},null!=w.PaperProps?w.PaperProps.style:null)})}),ve))})),G=n(23),z=n(24),q=n(49),J=Object(q.a)(a.createElement("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),K=n(155),Q=a.forwardRef((function(e,t){var n=e.classes,o=e.className,s=e.disabled,c=e.IconComponent,l=e.inputRef,d=e.variant,f=void 0===d?"standard":d,p=Object(i.a)(e,["classes","className","disabled","IconComponent","inputRef","variant"]);return a.createElement(a.Fragment,null,a.createElement("select",Object(r.a)({className:Object(u.a)(n.root,n.select,n[f],o,s&&n.disabled),disabled:s,ref:l||t},p)),e.multiple?null:a.createElement(c,{className:Object(u.a)(n.icon,n["icon".concat(Object(h.a)(f))],s&&n.disabled)}))})),X=function(e){return{root:{},select:{"-moz-appearance":"none","-webkit-appearance":"none",userSelect:"none",borderRadius:0,minWidth:16,cursor:"pointer","&:focus":{backgroundColor:"light"===e.palette.type?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",borderRadius:0},"&::-ms-expand":{display:"none"},"&$disabled":{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:e.palette.background.paper},"&&":{paddingRight:24}},filled:{"&&":{paddingRight:32}},outlined:{borderRadius:e.shape.borderRadius,"&&":{paddingRight:32}},selectMenu:{height:"auto",minHeight:"1.1876em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},disabled:{},icon:{position:"absolute",right:0,top:"calc(50% - 12px)",pointerEvents:"none",color:e.palette.action.active,"&$disabled":{color:e.palette.action.disabled}},iconOpen:{transform:"rotate(180deg)"},iconFilled:{right:7},iconOutlined:{right:7},nativeInput:{bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%"}}},Z=a.createElement(K.a,null),ee=a.forwardRef((function(e,t){var n=e.children,o=e.classes,s=e.IconComponent,c=void 0===s?J:s,l=e.input,u=void 0===l?Z:l,d=e.inputProps,h=(e.variant,Object(i.a)(e,["children","classes","IconComponent","input","inputProps","variant"])),f=Object(z.a)(),p=Object(G.a)({props:e,muiFormControl:f,states:["variant"]});return a.cloneElement(u,Object(r.a)({inputComponent:Q,inputProps:Object(r.a)({children:n,classes:o,IconComponent:c,variant:p.variant,type:void 0},d,u?u.props.inputProps:{}),ref:t},h))}));ee.muiName="Select";Object(f.a)(X,{name:"MuiNativeSelect"})(ee);var te=n(156),ne=n(181),re=X,ie=a.createElement(K.a,null),ae=a.createElement(te.a,null),oe=a.forwardRef((function e(t,n){var s=t.autoWidth,c=void 0!==s&&s,l=t.children,u=t.classes,d=t.displayEmpty,h=void 0!==d&&d,f=t.IconComponent,p=void 0===f?J:f,m=t.id,v=t.input,g=t.inputProps,y=t.label,b=t.labelId,S=t.labelWidth,_=void 0===S?0:S,C=t.MenuProps,w=t.multiple,E=void 0!==w&&w,T=t.native,k=void 0!==T&&T,M=t.onClose,D=t.onOpen,x=t.open,R=t.renderValue,O=t.SelectDisplayProps,I=t.variant,P=void 0===I?"standard":I,A=Object(i.a)(t,["autoWidth","children","classes","displayEmpty","IconComponent","id","input","inputProps","label","labelId","labelWidth","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"]),L=k?Q:$,N=Object(z.a)(),j=Object(G.a)({props:t,muiFormControl:N,states:["variant"]}).variant||P,U=v||{standard:ie,outlined:a.createElement(ne.a,{label:y,labelWidth:_}),filled:ae}[j];return a.cloneElement(U,Object(r.a)({inputComponent:L,inputProps:Object(r.a)({children:l,IconComponent:p,variant:j,type:void 0,multiple:E},k?{id:m}:{autoWidth:c,displayEmpty:h,labelId:b,MenuProps:C,onClose:M,onOpen:D,open:x,renderValue:R,SelectDisplayProps:Object(r.a)({id:m},O)},g,{classes:g?Object(o.a)({baseClasses:u,newClasses:g.classes,Component:e}):u},v?v.props.inputProps:{}),ref:n},A))}));oe.muiName="Select";t.a=Object(f.a)(re,{name:"MuiSelect"})(oe)},function(e,t,n){"use strict";var r=n(4),i=n(3),a=n(1),o=(n(7),n(5)),s=n(16),c=n(6),l=n(94),u=n(49),d=Object(u.a)(a.createElement("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),h=Object(u.a)(a.createElement("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),f=Object(u.a)(a.createElement("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),p=Object(u.a)(a.createElement("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined"),m=Object(u.a)(a.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),v=n(153),g=n(9),y={success:a.createElement(d,{fontSize:"inherit"}),warning:a.createElement(h,{fontSize:"inherit"}),error:a.createElement(f,{fontSize:"inherit"}),info:a.createElement(p,{fontSize:"inherit"})},b=a.createElement(m,{fontSize:"small"}),S=a.forwardRef((function(e,t){var n=e.action,s=e.children,c=e.classes,u=e.className,d=e.closeText,h=void 0===d?"Close":d,f=e.color,p=e.icon,m=e.iconMapping,S=void 0===m?y:m,_=e.onClose,C=e.role,w=void 0===C?"alert":C,E=e.severity,T=void 0===E?"success":E,k=e.variant,M=void 0===k?"standard":k,D=Object(r.a)(e,["action","children","classes","className","closeText","color","icon","iconMapping","onClose","role","severity","variant"]);return a.createElement(l.a,Object(i.a)({role:w,square:!0,elevation:0,className:Object(o.a)(c.root,c["".concat(M).concat(Object(g.a)(f||T))],u),ref:t},D),!1!==p?a.createElement("div",{className:c.icon},p||S[T]||y[T]):null,a.createElement("div",{className:c.message},s),null!=n?a.createElement("div",{className:c.action},n):null,null==n&&_?a.createElement("div",{className:c.action},a.createElement(v.a,{size:"small","aria-label":h,title:h,color:"inherit",onClick:_},b)):null)}));t.a=Object(c.a)((function(e){var t="light"===e.palette.type?s.a:s.e,n="light"===e.palette.type?s.e:s.a;return{root:Object(i.a)({},e.typography.body2,{borderRadius:e.shape.borderRadius,backgroundColor:"transparent",display:"flex",padding:"6px 16px"}),standardSuccess:{color:t(e.palette.success.main,.6),backgroundColor:n(e.palette.success.main,.9),"& $icon":{color:e.palette.success.main}},standardInfo:{color:t(e.palette.info.main,.6),backgroundColor:n(e.palette.info.main,.9),"& $icon":{color:e.palette.info.main}},standardWarning:{color:t(e.palette.warning.main,.6),backgroundColor:n(e.palette.warning.main,.9),"& $icon":{color:e.palette.warning.main}},standardError:{color:t(e.palette.error.main,.6),backgroundColor:n(e.palette.error.main,.9),"& $icon":{color:e.palette.error.main}},outlinedSuccess:{color:t(e.palette.success.main,.6),border:"1px solid ".concat(e.palette.success.main),"& $icon":{color:e.palette.success.main}},outlinedInfo:{color:t(e.palette.info.main,.6),border:"1px solid ".concat(e.palette.info.main),"& $icon":{color:e.palette.info.main}},outlinedWarning:{color:t(e.palette.warning.main,.6),border:"1px solid ".concat(e.palette.warning.main),"& $icon":{color:e.palette.warning.main}},outlinedError:{color:t(e.palette.error.main,.6),border:"1px solid ".concat(e.palette.error.main),"& $icon":{color:e.palette.error.main}},filledSuccess:{color:"#fff",fontWeight:e.typography.fontWeightMedium,backgroundColor:e.palette.success.main},filledInfo:{color:"#fff",fontWeight:e.typography.fontWeightMedium,backgroundColor:e.palette.info.main},filledWarning:{color:"#fff",fontWeight:e.typography.fontWeightMedium,backgroundColor:e.palette.warning.main},filledError:{color:"#fff",fontWeight:e.typography.fontWeightMedium,backgroundColor:e.palette.error.main},icon:{marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9},message:{padding:"8px 0"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}}}),{name:"MuiAlert"})(S)},function(e,t,n){"use strict";var r=n(4),i=n(3),a=n(1),o=n(14),s=(n(7),n(118)),c=n(152),l=n(17),u=n(27),d=n(12);var h="undefined"!==typeof window?a.useLayoutEffect:a.useEffect;var f=a.forwardRef((function(e,t){var n=e.children,r=e.container,i=e.disablePortal,s=void 0!==i&&i,c=e.onRendered,l=a.useState(null),f=l[0],p=l[1],m=Object(d.a)(a.isValidElement(n)?n.ref:null,t);return h((function(){s||p(function(e){return e="function"===typeof e?e():e,o.findDOMNode(e)}(r)||document.body)}),[r,s]),h((function(){if(f&&!s)return Object(u.a)(t,f),function(){Object(u.a)(t,null)}}),[t,f,s]),h((function(){c&&(f||s)&&c()}),[c,f,s]),s?a.isValidElement(n)?a.cloneElement(n,{ref:m}):n:f?o.createPortal(n,f):f})),p=n(28),m=n(21),v=n(63);var g=n(52),y=n(36),b=n(64),S=n(48);function _(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function C(e){return parseInt(window.getComputedStyle(e)["padding-right"],10)||0}function w(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0,a=[t,n].concat(Object(y.a)(r)),o=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(e.children,(function(e){1===e.nodeType&&-1===a.indexOf(e)&&-1===o.indexOf(e.tagName)&&_(e,i)}))}function E(e,t){var n=-1;return e.some((function(e,r){return!!t(e)&&(n=r,!0)})),n}function T(e,t){var n,r=[],i=[],a=e.container;if(!t.disableScrollLock){if(function(e){var t=Object(l.a)(e);return t.body===e?Object(S.a)(t).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(a)){var o=Object(b.a)();r.push({value:a.style.paddingRight,key:"padding-right",el:a}),a.style["padding-right"]="".concat(C(a)+o,"px"),n=Object(l.a)(a).querySelectorAll(".mui-fixed"),[].forEach.call(n,(function(e){i.push(e.style.paddingRight),e.style.paddingRight="".concat(C(e)+o,"px")}))}var s=a.parentElement,c="HTML"===s.nodeName&&"scroll"===window.getComputedStyle(s)["overflow-y"]?s:a;r.push({value:c.style.overflow,key:"overflow",el:c}),c.style.overflow="hidden"}return function(){n&&[].forEach.call(n,(function(e,t){i[t]?e.style.paddingRight=i[t]:e.style.removeProperty("padding-right")})),r.forEach((function(e){var t=e.value,n=e.el,r=e.key;t?n.style.setProperty(r,t):n.style.removeProperty(r)}))}}var k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modals=[],this.containers=[]}return Object(g.a)(e,[{key:"add",value:function(e,t){var n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&_(e.modalRef,!1);var r=function(e){var t=[];return[].forEach.call(e.children,(function(e){e.getAttribute&&"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);w(t,e.mountNode,e.modalRef,r,!0);var i=E(this.containers,(function(e){return e.container===t}));return-1!==i?(this.containers[i].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblingNodes:r}),n)}},{key:"mount",value:function(e,t){var n=E(this.containers,(function(t){return-1!==t.modals.indexOf(e)})),r=this.containers[n];r.restore||(r.restore=T(r,t))}},{key:"remove",value:function(e){var t=this.modals.indexOf(e);if(-1===t)return t;var n=E(this.containers,(function(t){return-1!==t.modals.indexOf(e)})),r=this.containers[n];if(r.modals.splice(r.modals.indexOf(e),1),this.modals.splice(t,1),0===r.modals.length)r.restore&&r.restore(),e.modalRef&&_(e.modalRef,!0),w(r.container,e.mountNode,e.modalRef,r.hiddenSiblingNodes,!1),this.containers.splice(n,1);else{var i=r.modals[r.modals.length-1];i.modalRef&&_(i.modalRef,!1)}return t}},{key:"isTopModal",value:function(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}]),e}();var M=function(e){var t=e.children,n=e.disableAutoFocus,r=void 0!==n&&n,i=e.disableEnforceFocus,s=void 0!==i&&i,c=e.disableRestoreFocus,u=void 0!==c&&c,h=e.getDoc,f=e.isEnabled,p=e.open,m=a.useRef(),v=a.useRef(null),g=a.useRef(null),y=a.useRef(),b=a.useRef(null),S=a.useCallback((function(e){b.current=o.findDOMNode(e)}),[]),_=Object(d.a)(t.ref,S),C=a.useRef();return a.useEffect((function(){C.current=p}),[p]),!C.current&&p&&"undefined"!==typeof window&&(y.current=h().activeElement),a.useEffect((function(){if(p){var e=Object(l.a)(b.current);r||!b.current||b.current.contains(e.activeElement)||(b.current.hasAttribute("tabIndex")||b.current.setAttribute("tabIndex",-1),b.current.focus());var t=function(){null!==b.current&&(e.hasFocus()&&!s&&f()&&!m.current?b.current&&!b.current.contains(e.activeElement)&&b.current.focus():m.current=!1)},n=function(t){!s&&f()&&9===t.keyCode&&e.activeElement===b.current&&(m.current=!0,t.shiftKey?g.current.focus():v.current.focus())};e.addEventListener("focus",t,!0),e.addEventListener("keydown",n,!0);var i=setInterval((function(){t()}),50);return function(){clearInterval(i),e.removeEventListener("focus",t,!0),e.removeEventListener("keydown",n,!0),u||(y.current&&y.current.focus&&y.current.focus(),y.current=null)}}}),[r,s,u,f,p]),a.createElement(a.Fragment,null,a.createElement("div",{tabIndex:0,ref:v,"data-test":"sentinelStart"}),a.cloneElement(t,{ref:_}),a.createElement("div",{tabIndex:0,ref:g,"data-test":"sentinelEnd"}))},D={root:{zIndex:-1,position:"fixed",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},invisible:{backgroundColor:"transparent"}},x=a.forwardRef((function(e,t){var n=e.invisible,o=void 0!==n&&n,s=e.open,c=Object(r.a)(e,["invisible","open"]);return s?a.createElement("div",Object(i.a)({"aria-hidden":!0,ref:t},c,{style:Object(i.a)({},D.root,o?D.invisible:{},c.style)})):null}));var R=new k,O=a.forwardRef((function(e,t){var n=Object(s.a)(),u=Object(c.a)({name:"MuiModal",props:Object(i.a)({},e),theme:n}),h=u.BackdropComponent,g=void 0===h?x:h,y=u.BackdropProps,b=u.children,S=u.closeAfterTransition,C=void 0!==S&&S,w=u.container,E=u.disableAutoFocus,T=void 0!==E&&E,k=u.disableBackdropClick,D=void 0!==k&&k,O=u.disableEnforceFocus,I=void 0!==O&&O,P=u.disableEscapeKeyDown,A=void 0!==P&&P,L=u.disablePortal,N=void 0!==L&&L,j=u.disableRestoreFocus,U=void 0!==j&&j,F=u.disableScrollLock,H=void 0!==F&&F,W=u.hideBackdrop,Y=void 0!==W&&W,B=u.keepMounted,V=void 0!==B&&B,$=u.manager,G=void 0===$?R:$,z=u.onBackdropClick,q=u.onClose,J=u.onEscapeKeyDown,K=u.onRendered,Q=u.open,X=Object(r.a)(u,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),Z=a.useState(!0),ee=Z[0],te=Z[1],ne=a.useRef({}),re=a.useRef(null),ie=a.useRef(null),ae=Object(d.a)(ie,t),oe=function(e){return!!e.children&&e.children.props.hasOwnProperty("in")}(u),se=function(){return Object(l.a)(re.current)},ce=function(){return ne.current.modalRef=ie.current,ne.current.mountNode=re.current,ne.current},le=function(){G.mount(ce(),{disableScrollLock:H}),ie.current.scrollTop=0},ue=Object(m.a)((function(){var e=function(e){return e="function"===typeof e?e():e,o.findDOMNode(e)}(w)||se().body;G.add(ce(),e),ie.current&&le()})),de=a.useCallback((function(){return G.isTopModal(ce())}),[G]),he=Object(m.a)((function(e){re.current=e,e&&(K&&K(),Q&&de()?le():_(ie.current,!0))})),fe=a.useCallback((function(){G.remove(ce())}),[G]);if(a.useEffect((function(){return function(){fe()}}),[fe]),a.useEffect((function(){Q?ue():oe&&C||fe()}),[Q,fe,oe,C,ue]),!V&&!Q&&(!oe||ee))return null;var pe=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}}(n||{zIndex:v.a}),me={};return void 0===b.props.tabIndex&&(me.tabIndex=b.props.tabIndex||"-1"),oe&&(me.onEnter=Object(p.a)((function(){te(!1)}),b.props.onEnter),me.onExited=Object(p.a)((function(){te(!0),C&&fe()}),b.props.onExited)),a.createElement(f,{ref:he,container:w,disablePortal:N},a.createElement("div",Object(i.a)({ref:ae,onKeyDown:function(e){"Escape"===e.key&&de()&&(J&&J(e),A||(e.stopPropagation(),q&&q(e,"escapeKeyDown")))},role:"presentation"},X,{style:Object(i.a)({},pe.root,!Q&&ee?pe.hidden:{},X.style)}),Y?null:a.createElement(g,Object(i.a)({open:Q,onClick:function(e){e.target===e.currentTarget&&(z&&z(e),!D&&q&&q(e,"backdropClick"))}},y)),a.createElement(M,{disableEnforceFocus:I,disableAutoFocus:T,disableRestoreFocus:U,getDoc:se,isEnabled:de,open:Q},a.cloneElement(b,me))))}));t.a=O},function(e,t,n){"use strict";var r=n(4),i=n(15),a=n(3),o=n(1),s=(n(7),n(5)),c=n(6),l=n(25),u=n(14),d=n(17),h=n(12),f=n(21);function p(e){return e.substring(2).toLowerCase()}var m=function(e){var t=e.children,n=e.disableReactTree,r=void 0!==n&&n,i=e.mouseEvent,a=void 0===i?"onClick":i,s=e.onClickAway,c=e.touchEvent,l=void 0===c?"onTouchEnd":c,m=o.useRef(!1),v=o.useRef(null),g=o.useRef(!1),y=o.useRef(!1);o.useEffect((function(){return setTimeout((function(){g.current=!0}),0),function(){g.current=!1}}),[]);var b=o.useCallback((function(e){v.current=u.findDOMNode(e)}),[]),S=Object(h.a)(t.ref,b),_=Object(f.a)((function(e){var t=y.current;if(y.current=!1,g.current&&v.current&&!function(e){return document.documentElement.clientWidth<e.clientX||document.documentElement.clientHeight<e.clientY}(e))if(m.current)m.current=!1;else{var n;if(e.composedPath)n=e.composedPath().indexOf(v.current)>-1;else n=!Object(d.a)(v.current).documentElement.contains(e.target)||v.current.contains(e.target);n||!r&&t||s(e)}})),C=function(e){return function(n){y.current=!0;var r=t.props[e];r&&r(n)}},w={ref:S};return!1!==l&&(w[l]=C(l)),o.useEffect((function(){if(!1!==l){var e=p(l),t=Object(d.a)(v.current),n=function(){m.current=!0};return t.addEventListener(e,_),t.addEventListener("touchmove",n),function(){t.removeEventListener(e,_),t.removeEventListener("touchmove",n)}}}),[_,l]),!1!==a&&(w[a]=C(a)),o.useEffect((function(){if(!1!==a){var e=p(a),t=Object(d.a)(v.current);return t.addEventListener(e,_),function(){t.removeEventListener(e,_)}}}),[_,a]),o.createElement(o.Fragment,null,o.cloneElement(t,w))},v=n(9),g=n(28),y=n(158),b=n(94),S=n(16),_=o.forwardRef((function(e,t){var n=e.action,i=e.classes,c=e.className,l=e.message,u=e.role,d=void 0===u?"alert":u,h=Object(r.a)(e,["action","classes","className","message","role"]);return o.createElement(b.a,Object(a.a)({role:d,square:!0,elevation:6,className:Object(s.a)(i.root,c),ref:t},h),o.createElement("div",{className:i.message},l),n?o.createElement("div",{className:i.action},n):null)})),C=Object(c.a)((function(e){var t="light"===e.palette.type?.8:.98,n=Object(S.b)(e.palette.background.default,t);return{root:Object(a.a)({},e.typography.body2,Object(i.a)({color:e.palette.getContrastText(n),backgroundColor:n,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:e.shape.borderRadius,flexGrow:1},e.breakpoints.up("sm"),{flexGrow:"initial",minWidth:288})),message:{padding:"8px 0"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}}}),{name:"MuiSnackbarContent"})(_),w=o.forwardRef((function(e,t){var n=e.action,i=e.anchorOrigin,c=(i=void 0===i?{vertical:"bottom",horizontal:"center"}:i).vertical,u=i.horizontal,d=e.autoHideDuration,h=void 0===d?null:d,p=e.children,b=e.classes,S=e.className,_=e.ClickAwayListenerProps,w=e.ContentProps,E=e.disableWindowBlurListener,T=void 0!==E&&E,k=e.message,M=e.onClose,D=e.onEnter,x=e.onEntered,R=e.onEntering,O=e.onExit,I=e.onExited,P=e.onExiting,A=e.onMouseEnter,L=e.onMouseLeave,N=e.open,j=e.resumeHideDuration,U=e.TransitionComponent,F=void 0===U?y.a:U,H=e.transitionDuration,W=void 0===H?{enter:l.b.enteringScreen,exit:l.b.leavingScreen}:H,Y=e.TransitionProps,B=Object(r.a)(e,["action","anchorOrigin","autoHideDuration","children","classes","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onClose","onEnter","onEntered","onEntering","onExit","onExited","onExiting","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"]),V=o.useRef(),$=o.useState(!0),G=$[0],z=$[1],q=Object(f.a)((function(){M&&M.apply(void 0,arguments)})),J=Object(f.a)((function(e){M&&null!=e&&(clearTimeout(V.current),V.current=setTimeout((function(){q(null,"timeout")}),e))}));o.useEffect((function(){return N&&J(h),function(){clearTimeout(V.current)}}),[N,h,J]);var K=function(){clearTimeout(V.current)},Q=o.useCallback((function(){null!=h&&J(null!=j?j:.5*h)}),[h,j,J]);return o.useEffect((function(){if(!T&&N)return window.addEventListener("focus",Q),window.addEventListener("blur",K),function(){window.removeEventListener("focus",Q),window.removeEventListener("blur",K)}}),[T,Q,N]),!N&&G?null:o.createElement(m,Object(a.a)({onClickAway:function(e){M&&M(e,"clickaway")}},_),o.createElement("div",Object(a.a)({className:Object(s.a)(b.root,b["anchorOrigin".concat(Object(v.a)(c)).concat(Object(v.a)(u))],S),onMouseEnter:function(e){A&&A(e),K()},onMouseLeave:function(e){L&&L(e),Q()},ref:t},B),o.createElement(F,Object(a.a)({appear:!0,in:N,onEnter:Object(g.a)((function(){z(!1)}),D),onEntered:x,onEntering:R,onExit:O,onExited:Object(g.a)((function(){z(!0)}),I),onExiting:P,timeout:W,direction:"top"===c?"down":"up"},Y),p||o.createElement(C,Object(a.a)({message:k,action:n},w)))))}));t.a=Object(c.a)((function(e){var t={top:8},n={bottom:8},r={justifyContent:"flex-end"},o={justifyContent:"flex-start"},s={top:24},c={bottom:24},l={right:24},u={left:24},d={left:"50%",right:"auto",transform:"translateX(-50%)"};return{root:{zIndex:e.zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},anchorOriginTopCenter:Object(a.a)({},t,Object(i.a)({},e.breakpoints.up("sm"),Object(a.a)({},s,d))),anchorOriginBottomCenter:Object(a.a)({},n,Object(i.a)({},e.breakpoints.up("sm"),Object(a.a)({},c,d))),anchorOriginTopRight:Object(a.a)({},t,r,Object(i.a)({},e.breakpoints.up("sm"),Object(a.a)({left:"auto"},s,l))),anchorOriginBottomRight:Object(a.a)({},n,r,Object(i.a)({},e.breakpoints.up("sm"),Object(a.a)({left:"auto"},c,l))),anchorOriginTopLeft:Object(a.a)({},t,o,Object(i.a)({},e.breakpoints.up("sm"),Object(a.a)({right:"auto"},s,u))),anchorOriginBottomLeft:Object(a.a)({},n,o,Object(i.a)({},e.breakpoints.up("sm"),Object(a.a)({right:"auto"},c,u)))}}),{flip:!1,name:"MuiSnackbar"})(w)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(15),o=n(1),s=(n(7),n(5)),c=n(6),l=n(9),u=n(177),d=n(29),h=n(119),f=n(25),p=n(34),m=n(37),v=n(12),g={entering:{opacity:1},entered:{opacity:1}},y={enter:f.b.enteringScreen,exit:f.b.leavingScreen},b=o.forwardRef((function(e,t){var n=e.children,a=e.disableStrictModeCompat,s=void 0!==a&&a,c=e.in,l=e.onEnter,u=e.onEntered,f=e.onEntering,b=e.onExit,S=e.onExited,_=e.onExiting,C=e.style,w=e.TransitionComponent,E=void 0===w?h.a:w,T=e.timeout,k=void 0===T?y:T,M=Object(i.a)(e,["children","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","TransitionComponent","timeout"]),D=Object(p.a)(),x=D.unstable_strictMode&&!s,R=o.useRef(null),O=Object(v.a)(n.ref,t),I=Object(v.a)(x?R:void 0,O),P=function(e){return function(t,n){if(e){var r=x?[R.current,t]:[t,n],i=Object(d.a)(r,2),a=i[0],o=i[1];void 0===o?e(a):e(a,o)}}},A=P(f),L=P((function(e,t){Object(m.b)(e);var n=Object(m.a)({style:C,timeout:k},{mode:"enter"});e.style.webkitTransition=D.transitions.create("opacity",n),e.style.transition=D.transitions.create("opacity",n),l&&l(e,t)})),N=P(u),j=P(_),U=P((function(e){var t=Object(m.a)({style:C,timeout:k},{mode:"exit"});e.style.webkitTransition=D.transitions.create("opacity",t),e.style.transition=D.transitions.create("opacity",t),b&&b(e)})),F=P(S);return o.createElement(E,Object(r.a)({appear:!0,in:c,nodeRef:x?R:void 0,onEnter:L,onEntered:N,onEntering:A,onExit:U,onExited:F,onExiting:j,timeout:k},M),(function(e,t){return o.cloneElement(n,Object(r.a)({style:Object(r.a)({opacity:0,visibility:"exited"!==e||c?void 0:"hidden"},g[e],C,n.props.style),ref:I},t))}))})),S=o.forwardRef((function(e,t){var n=e.children,a=e.classes,c=e.className,l=e.invisible,u=void 0!==l&&l,d=e.open,h=e.transitionDuration,f=e.TransitionComponent,p=void 0===f?b:f,m=Object(i.a)(e,["children","classes","className","invisible","open","transitionDuration","TransitionComponent"]);return o.createElement(p,Object(r.a)({in:d,timeout:h},m),o.createElement("div",{className:Object(s.a)(a.root,c,u&&a.invisible),"aria-hidden":!0,ref:t},n))})),_=Object(c.a)({root:{zIndex:-1,position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},invisible:{backgroundColor:"transparent"}},{name:"MuiBackdrop"})(S),C=n(94),w={enter:f.b.enteringScreen,exit:f.b.leavingScreen},E=o.forwardRef((function(e,t){var n=e.BackdropProps,a=e.children,c=e.classes,d=e.className,h=e.disableBackdropClick,f=void 0!==h&&h,p=e.disableEscapeKeyDown,m=void 0!==p&&p,v=e.fullScreen,g=void 0!==v&&v,y=e.fullWidth,S=void 0!==y&&y,E=e.maxWidth,T=void 0===E?"sm":E,k=e.onBackdropClick,M=e.onClose,D=e.onEnter,x=e.onEntered,R=e.onEntering,O=e.onEscapeKeyDown,I=e.onExit,P=e.onExited,A=e.onExiting,L=e.open,N=e.PaperComponent,j=void 0===N?C.a:N,U=e.PaperProps,F=void 0===U?{}:U,H=e.scroll,W=void 0===H?"paper":H,Y=e.TransitionComponent,B=void 0===Y?b:Y,V=e.transitionDuration,$=void 0===V?w:V,G=e.TransitionProps,z=e["aria-describedby"],q=e["aria-labelledby"],J=Object(i.a)(e,["BackdropProps","children","classes","className","disableBackdropClick","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClose","onEnter","onEntered","onEntering","onEscapeKeyDown","onExit","onExited","onExiting","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps","aria-describedby","aria-labelledby"]),K=o.useRef();return o.createElement(u.a,Object(r.a)({className:Object(s.a)(c.root,d),BackdropComponent:_,BackdropProps:Object(r.a)({transitionDuration:$},n),closeAfterTransition:!0,disableBackdropClick:f,disableEscapeKeyDown:m,onEscapeKeyDown:O,onClose:M,open:L,ref:t},J),o.createElement(B,Object(r.a)({appear:!0,in:L,timeout:$,onEnter:D,onEntering:R,onEntered:x,onExit:I,onExiting:A,onExited:P,role:"none presentation"},G),o.createElement("div",{className:Object(s.a)(c.container,c["scroll".concat(Object(l.a)(W))]),onMouseUp:function(e){e.target===e.currentTarget&&e.target===K.current&&(K.current=null,k&&k(e),!f&&M&&M(e,"backdropClick"))},onMouseDown:function(e){K.current=e.target}},o.createElement(j,Object(r.a)({elevation:24,role:"dialog","aria-describedby":z,"aria-labelledby":q},F,{className:Object(s.a)(c.paper,c["paperScroll".concat(Object(l.a)(W))],c["paperWidth".concat(Object(l.a)(String(T)))],F.className,g&&c.paperFullScreen,S&&c.paperFullWidth)}),a))))}));t.a=Object(c.a)((function(e){return{root:{"@media print":{position:"absolute !important"}},scrollPaper:{display:"flex",justifyContent:"center",alignItems:"center"},scrollBody:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&:after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}},container:{height:"100%","@media print":{height:"auto"},outline:0},paper:{margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},paperScrollPaper:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},paperScrollBody:{display:"inline-block",verticalAlign:"middle",textAlign:"left"},paperWidthFalse:{maxWidth:"calc(100% - 64px)"},paperWidthXs:{maxWidth:Math.max(e.breakpoints.values.xs,444),"&$paperScrollBody":Object(a.a)({},e.breakpoints.down(Math.max(e.breakpoints.values.xs,444)+64),{maxWidth:"calc(100% - 64px)"})},paperWidthSm:{maxWidth:e.breakpoints.values.sm,"&$paperScrollBody":Object(a.a)({},e.breakpoints.down(e.breakpoints.values.sm+64),{maxWidth:"calc(100% - 64px)"})},paperWidthMd:{maxWidth:e.breakpoints.values.md,"&$paperScrollBody":Object(a.a)({},e.breakpoints.down(e.breakpoints.values.md+64),{maxWidth:"calc(100% - 64px)"})},paperWidthLg:{maxWidth:e.breakpoints.values.lg,"&$paperScrollBody":Object(a.a)({},e.breakpoints.down(e.breakpoints.values.lg+64),{maxWidth:"calc(100% - 64px)"})},paperWidthXl:{maxWidth:e.breakpoints.values.xl,"&$paperScrollBody":Object(a.a)({},e.breakpoints.down(e.breakpoints.values.xl+64),{maxWidth:"calc(100% - 64px)"})},paperFullWidth:{width:"calc(100% - 64px)"},paperFullScreen:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,"&$paperScrollBody":{margin:0,maxWidth:"100%"}}}}),{name:"MuiDialog"})(E)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(155),c=n(156),l=n(181),u=n(182),d=n(157),h=n(23),f=n(24),p=n(6),m=a.forwardRef((function(e,t){var n=e.children,s=e.classes,c=e.className,l=e.component,u=void 0===l?"p":l,d=(e.disabled,e.error,e.filled,e.focused,e.margin,e.required,e.variant,Object(i.a)(e,["children","classes","className","component","disabled","error","filled","focused","margin","required","variant"])),p=Object(f.a)(),m=Object(h.a)({props:e,muiFormControl:p,states:["variant","margin","disabled","error","filled","focused","required"]});return a.createElement(u,Object(r.a)({className:Object(o.a)(s.root,("filled"===m.variant||"outlined"===m.variant)&&s.contained,c,m.disabled&&s.disabled,m.error&&s.error,m.filled&&s.filled,m.focused&&s.focused,m.required&&s.required,"dense"===m.margin&&s.marginDense),ref:t},d)," "===n?a.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}}):n)})),v=Object(p.a)((function(e){return{root:Object(r.a)({color:e.palette.text.secondary},e.typography.caption,{textAlign:"left",marginTop:3,margin:0,"&$disabled":{color:e.palette.text.disabled},"&$error":{color:e.palette.error.main}}),error:{},disabled:{},marginDense:{marginTop:4},contained:{marginLeft:14,marginRight:14},focused:{},filled:{},required:{}}}),{name:"MuiFormHelperText"})(m),g=n(175),y={standard:s.a,filled:c.a,outlined:l.a},b=a.forwardRef((function(e,t){var n=e.autoComplete,s=e.autoFocus,c=void 0!==s&&s,l=e.children,h=e.classes,f=e.className,p=e.color,m=void 0===p?"primary":p,b=e.defaultValue,S=e.disabled,_=void 0!==S&&S,C=e.error,w=void 0!==C&&C,E=e.FormHelperTextProps,T=e.fullWidth,k=void 0!==T&&T,M=e.helperText,D=e.hiddenLabel,x=e.id,R=e.InputLabelProps,O=e.inputProps,I=e.InputProps,P=e.inputRef,A=e.label,L=e.multiline,N=void 0!==L&&L,j=e.name,U=e.onBlur,F=e.onChange,H=e.onFocus,W=e.placeholder,Y=e.required,B=void 0!==Y&&Y,V=e.rows,$=e.rowsMax,G=e.select,z=void 0!==G&&G,q=e.SelectProps,J=e.type,K=e.value,Q=e.variant,X=void 0===Q?"standard":Q,Z=Object(i.a)(e,["autoComplete","autoFocus","children","classes","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","hiddenLabel","id","InputLabelProps","inputProps","InputProps","inputRef","label","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","rowsMax","select","SelectProps","type","value","variant"]);var ee={};if("outlined"===X&&(R&&"undefined"!==typeof R.shrink&&(ee.notched=R.shrink),A)){var te,ne=null!==(te=null===R||void 0===R?void 0:R.required)&&void 0!==te?te:B;ee.label=a.createElement(a.Fragment,null,A,ne&&"\xa0*")}z&&(q&&q.native||(ee.id=void 0),ee["aria-describedby"]=void 0);var re=M&&x?"".concat(x,"-helper-text"):void 0,ie=A&&x?"".concat(x,"-label"):void 0,ae=y[X],oe=a.createElement(ae,Object(r.a)({"aria-describedby":re,autoComplete:n,autoFocus:c,defaultValue:b,fullWidth:k,multiline:N,name:j,rows:V,rowsMax:$,type:J,value:K,id:x,inputRef:P,onBlur:U,onChange:F,onFocus:H,placeholder:W,inputProps:O},ee,I));return a.createElement(d.a,Object(r.a)({className:Object(o.a)(h.root,f),disabled:_,error:w,fullWidth:k,hiddenLabel:D,ref:t,required:B,color:m,variant:X},Z),A&&a.createElement(u.a,Object(r.a)({htmlFor:x,id:ie},R),A),z?a.createElement(g.a,Object(r.a)({"aria-describedby":re,id:x,labelId:ie,value:K,input:oe},q),l):oe,M&&a.createElement(v,Object(r.a)({id:re},E),M))}));t.a=Object(p.a)({root:{}},{name:"MuiTextField"})(b)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(95),c=n(15),l=n(6),u=n(34),d=n(9),h=a.forwardRef((function(e,t){e.children;var n=e.classes,s=e.className,l=e.label,h=e.labelWidth,f=e.notched,p=e.style,m=Object(i.a)(e,["children","classes","className","label","labelWidth","notched","style"]),v="rtl"===Object(u.a)().direction?"right":"left";if(void 0!==l)return a.createElement("fieldset",Object(r.a)({"aria-hidden":!0,className:Object(o.a)(n.root,s),ref:t,style:p},m),a.createElement("legend",{className:Object(o.a)(n.legendLabelled,f&&n.legendNotched)},l?a.createElement("span",null,l):a.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}})));var g=h>0?.75*h+8:.01;return a.createElement("fieldset",Object(r.a)({"aria-hidden":!0,style:Object(r.a)(Object(c.a)({},"padding".concat(Object(d.a)(v)),8),p),className:Object(o.a)(n.root,s),ref:t},m),a.createElement("legend",{className:n.legend,style:{width:f?g:.01}},a.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}})))})),f=Object(l.a)((function(e){return{root:{position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden"},legend:{textAlign:"left",padding:0,lineHeight:"11px",transition:e.transitions.create("width",{duration:150,easing:e.transitions.easing.easeOut})},legendLabelled:{display:"block",width:"auto",textAlign:"left",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:e.transitions.create("max-width",{duration:50,easing:e.transitions.easing.easeOut}),"& > span":{paddingLeft:5,paddingRight:5,display:"inline-block"}},legendNotched:{maxWidth:1e3,transition:e.transitions.create("max-width",{duration:100,easing:e.transitions.easing.easeOut,delay:50})}}}),{name:"PrivateNotchedOutline"})(h),p=a.forwardRef((function(e,t){var n=e.classes,c=e.fullWidth,l=void 0!==c&&c,u=e.inputComponent,d=void 0===u?"input":u,h=e.label,p=e.labelWidth,m=void 0===p?0:p,v=e.multiline,g=void 0!==v&&v,y=e.notched,b=e.type,S=void 0===b?"text":b,_=Object(i.a)(e,["classes","fullWidth","inputComponent","label","labelWidth","multiline","notched","type"]);return a.createElement(s.a,Object(r.a)({renderSuffix:function(e){return a.createElement(f,{className:n.notchedOutline,label:h,labelWidth:m,notched:"undefined"!==typeof y?y:Boolean(e.startAdornment||e.filled||e.focused)})},classes:Object(r.a)({},n,{root:Object(o.a)(n.root,n.underline),notchedOutline:null}),fullWidth:l,inputComponent:d,multiline:g,ref:t,type:S},_))}));p.muiName="Input";t.a=Object(l.a)((function(e){var t="light"===e.palette.type?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{root:{position:"relative",borderRadius:e.shape.borderRadius,"&:hover $notchedOutline":{borderColor:e.palette.text.primary},"@media (hover: none)":{"&:hover $notchedOutline":{borderColor:t}},"&$focused $notchedOutline":{borderColor:e.palette.primary.main,borderWidth:2},"&$error $notchedOutline":{borderColor:e.palette.error.main},"&$disabled $notchedOutline":{borderColor:e.palette.action.disabled}},colorSecondary:{"&$focused $notchedOutline":{borderColor:e.palette.secondary.main}},focused:{},disabled:{},adornedStart:{paddingLeft:14},adornedEnd:{paddingRight:14},error:{},marginDense:{},multiline:{padding:"18.5px 14px","&$marginDense":{paddingTop:10.5,paddingBottom:10.5}},notchedOutline:{borderColor:t},input:{padding:"18.5px 14px","&:-webkit-autofill":{WebkitBoxShadow:"light"===e.palette.type?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===e.palette.type?null:"#fff",caretColor:"light"===e.palette.type?null:"#fff",borderRadius:"inherit"}},inputMarginDense:{paddingTop:10.5,paddingBottom:10.5},inputMultiline:{padding:0},inputAdornedStart:{paddingLeft:0},inputAdornedEnd:{paddingRight:0}}}),{name:"MuiOutlinedInput"})(p)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(23),c=n(24),l=n(6),u=n(9),d=a.forwardRef((function(e,t){var n=e.children,l=e.classes,d=e.className,h=(e.color,e.component),f=void 0===h?"label":h,p=(e.disabled,e.error,e.filled,e.focused,e.required,Object(i.a)(e,["children","classes","className","color","component","disabled","error","filled","focused","required"])),m=Object(c.a)(),v=Object(s.a)({props:e,muiFormControl:m,states:["color","required","focused","disabled","error","filled"]});return a.createElement(f,Object(r.a)({className:Object(o.a)(l.root,l["color".concat(Object(u.a)(v.color||"primary"))],d,v.disabled&&l.disabled,v.error&&l.error,v.filled&&l.filled,v.focused&&l.focused,v.required&&l.required),ref:t},p),n,v.required&&a.createElement("span",{"aria-hidden":!0,className:Object(o.a)(l.asterisk,v.error&&l.error)},"\u2009","*"))})),h=Object(l.a)((function(e){return{root:Object(r.a)({color:e.palette.text.secondary},e.typography.body1,{lineHeight:1,padding:0,"&$focused":{color:e.palette.primary.main},"&$disabled":{color:e.palette.text.disabled},"&$error":{color:e.palette.error.main}}),colorSecondary:{"&$focused":{color:e.palette.secondary.main}},focused:{},disabled:{},error:{},filled:{},required:{},asterisk:{"&$error":{color:e.palette.error.main}}}}),{name:"MuiFormLabel"})(d),f=a.forwardRef((function(e,t){var n=e.classes,l=e.className,u=e.disableAnimation,d=void 0!==u&&u,f=(e.margin,e.shrink),p=(e.variant,Object(i.a)(e,["classes","className","disableAnimation","margin","shrink","variant"])),m=Object(c.a)(),v=f;"undefined"===typeof v&&m&&(v=m.filled||m.focused||m.adornedStart);var g=Object(s.a)({props:e,muiFormControl:m,states:["margin","variant"]});return a.createElement(h,Object(r.a)({"data-shrink":v,className:Object(o.a)(n.root,l,m&&n.formControl,!d&&n.animated,v&&n.shrink,"dense"===g.margin&&n.marginDense,{filled:n.filled,outlined:n.outlined}[g.variant]),classes:{focused:n.focused,disabled:n.disabled,error:n.error,required:n.required,asterisk:n.asterisk},ref:t},p))}));t.a=Object(l.a)((function(e){return{root:{display:"block",transformOrigin:"top left"},focused:{},disabled:{},error:{},required:{},asterisk:{},formControl:{position:"absolute",left:0,top:0,transform:"translate(0, 24px) scale(1)"},marginDense:{transform:"translate(0, 21px) scale(1)"},shrink:{transform:"translate(0, 1.5px) scale(0.75)",transformOrigin:"top left"},animated:{transition:e.transitions.create(["color","transform"],{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut})},filled:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 20px) scale(1)","&$marginDense":{transform:"translate(12px, 17px) scale(1)"},"&$shrink":{transform:"translate(12px, 10px) scale(0.75)","&$marginDense":{transform:"translate(12px, 7px) scale(0.75)"}}},outlined:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 20px) scale(1)","&$marginDense":{transform:"translate(14px, 12px) scale(1)"},"&$shrink":{transform:"translate(14px, -6px) scale(0.75)"}}}}),{name:"MuiInputLabel"})(f)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(49),l=Object(c.a)(a.createElement("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");var u=a.forwardRef((function(e,t){var n=e.alt,s=e.children,c=e.classes,u=e.className,d=e.component,h=void 0===d?"div":d,f=e.imgProps,p=e.sizes,m=e.src,v=e.srcSet,g=e.variant,y=void 0===g?"circle":g,b=Object(i.a)(e,["alt","children","classes","className","component","imgProps","sizes","src","srcSet","variant"]),S=null,_=function(e){var t=e.src,n=e.srcSet,r=a.useState(!1),i=r[0],o=r[1];return a.useEffect((function(){if(t||n){o(!1);var e=!0,r=new Image;return r.src=t,r.srcSet=n,r.onload=function(){e&&o("loaded")},r.onerror=function(){e&&o("error")},function(){e=!1}}}),[t,n]),i}({src:m,srcSet:v}),C=m||v,w=C&&"error"!==_;return S=w?a.createElement("img",Object(r.a)({alt:n,src:m,srcSet:v,sizes:p,className:c.img},f)):null!=s?s:C&&n?n[0]:a.createElement(l,{className:c.fallback}),a.createElement(h,Object(r.a)({className:Object(o.a)(c.root,c.system,c[y],u,!w&&c.colorDefault),ref:t},b),S)}));t.a=Object(s.a)((function(e){return{root:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none"},colorDefault:{color:e.palette.background.default,backgroundColor:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[600]},circle:{},circular:{},rounded:{borderRadius:e.shape.borderRadius},square:{borderRadius:0},img:{width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4},fallback:{width:"75%",height:"75%"}}}),{name:"MuiAvatar"})(u)},function(e,t,n){"use strict";var r=n(3),i=n(4),a=n(1),o=(n(7),n(5)),s=n(6),c=n(16),l=n(9),u=n(29),d=n(47),h=n(24),f=n(153),p=a.forwardRef((function(e,t){var n=e.autoFocus,s=e.checked,c=e.checkedIcon,l=e.classes,p=e.className,m=e.defaultChecked,v=e.disabled,g=e.icon,y=e.id,b=e.inputProps,S=e.inputRef,_=e.name,C=e.onBlur,w=e.onChange,E=e.onFocus,T=e.readOnly,k=e.required,M=e.tabIndex,D=e.type,x=e.value,R=Object(i.a)(e,["autoFocus","checked","checkedIcon","classes","className","defaultChecked","disabled","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"]),O=Object(d.a)({controlled:s,default:Boolean(m),name:"SwitchBase",state:"checked"}),I=Object(u.a)(O,2),P=I[0],A=I[1],L=Object(h.a)(),N=v;L&&"undefined"===typeof N&&(N=L.disabled);var j="checkbox"===D||"radio"===D;return a.createElement(f.a,Object(r.a)({component:"span",className:Object(o.a)(l.root,p,P&&l.checked,N&&l.disabled),disabled:N,tabIndex:null,role:void 0,onFocus:function(e){E&&E(e),L&&L.onFocus&&L.onFocus(e)},onBlur:function(e){C&&C(e),L&&L.onBlur&&L.onBlur(e)},ref:t},R),a.createElement("input",Object(r.a)({autoFocus:n,checked:s,defaultChecked:m,className:l.input,disabled:N,id:j&&y,name:_,onChange:function(e){var t=e.target.checked;A(t),w&&w(e,t)},readOnly:T,ref:S,required:k,tabIndex:M,type:D,value:x},b)),P?c:g)})),m=Object(s.a)({root:{padding:9},checked:{},disabled:{},input:{cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}},{name:"PrivateSwitchBase"})(p),v=a.forwardRef((function(e,t){var n=e.classes,s=e.className,c=e.color,u=void 0===c?"secondary":c,d=e.edge,h=void 0!==d&&d,f=e.size,p=void 0===f?"medium":f,v=Object(i.a)(e,["classes","className","color","edge","size"]),g=a.createElement("span",{className:n.thumb});return a.createElement("span",{className:Object(o.a)(n.root,s,{start:n.edgeStart,end:n.edgeEnd}[h],"small"===p&&n["size".concat(Object(l.a)(p))])},a.createElement(m,Object(r.a)({type:"checkbox",icon:g,checkedIcon:g,classes:{root:Object(o.a)(n.switchBase,n["color".concat(Object(l.a)(u))]),input:n.input,checked:n.checked,disabled:n.disabled},ref:t},v)),a.createElement("span",{className:n.track}))}));t.a=Object(s.a)((function(e){return{root:{display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},edgeStart:{marginLeft:-8},edgeEnd:{marginRight:-8},switchBase:{position:"absolute",top:0,left:0,zIndex:1,color:"light"===e.palette.type?e.palette.grey[50]:e.palette.grey[400],transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),"&$checked":{transform:"translateX(20px)"},"&$disabled":{color:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[800]},"&$checked + $track":{opacity:.5},"&$disabled + $track":{opacity:"light"===e.palette.type?.12:.1}},colorPrimary:{"&$checked":{color:e.palette.primary.main,"&:hover":{backgroundColor:Object(c.c)(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[800]},"&$checked + $track":{backgroundColor:e.palette.primary.main},"&$disabled + $track":{backgroundColor:"light"===e.palette.type?e.palette.common.black:e.palette.common.white}},colorSecondary:{"&$checked":{color:e.palette.secondary.main,"&:hover":{backgroundColor:Object(c.c)(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[800]},"&$checked + $track":{backgroundColor:e.palette.secondary.main},"&$disabled + $track":{backgroundColor:"light"===e.palette.type?e.palette.common.black:e.palette.common.white}},sizeSmall:{width:40,height:24,padding:7,"& $thumb":{width:16,height:16},"& $switchBase":{padding:4,"&$checked":{transform:"translateX(16px)"}}},checked:{},disabled:{},input:{left:"-100%",width:"300%"},thumb:{boxShadow:e.shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"},track:{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:"light"===e.palette.type?e.palette.common.black:e.palette.common.white,opacity:"light"===e.palette.type?.38:.3}}}),{name:"MuiSwitch"})(v)}]]);
//# sourceMappingURL=2.7777f3a5.chunk.js.map