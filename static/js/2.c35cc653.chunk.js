/*! For license information please see 2.c35cc653.chunk.js.LICENSE.txt */
(this["webpackJsonpstarter-kit-rainbow"]=this["webpackJsonpstarter-kit-rainbow"]||[]).push([[2],[function(module,exports,__webpack_require__){module.exports=__webpack_require__(108)},function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(103)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}__webpack_require__.d(__webpack_exports__,"a",(function(){return _extends}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return _objectWithoutProperties}));var _objectWithoutPropertiesLoose__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(32);function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=Object(_objectWithoutPropertiesLoose__WEBPACK_IMPORTED_MODULE_0__.a)(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}},function(module,__webpack_exports__,__webpack_require__){"use strict";function toVal(mix){var k,y,str="";if("string"===typeof mix||"number"===typeof mix)str+=mix;else if("object"===typeof mix)if(Array.isArray(mix))for(k=0;k<mix.length;k++)mix[k]&&(y=toVal(mix[k]))&&(str&&(str+=" "),str+=y);else for(k in mix)mix[k]&&(str&&(str+=" "),str+=k);return str}__webpack_exports__.a=function(){for(var tmp,x,i=0,str="";i<arguments.length;)(tmp=arguments[i++])&&(x=toVal(tmp))&&(str&&(str+=" "),str+=x);return str}},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),react=__webpack_require__(1),react_default=__webpack_require__.n(react),hoist_non_react_statics_cjs=(__webpack_require__(6),__webpack_require__(82)),hoist_non_react_statics_cjs_default=__webpack_require__.n(hoist_non_react_statics_cjs),makeStyles=__webpack_require__(116),getThemeProps=__webpack_require__(151),useTheme=__webpack_require__(117),esm_withStyles_withStyles=function(stylesOrCreator){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(Component){var defaultTheme=options.defaultTheme,_options$withTheme=options.withTheme,withTheme=void 0!==_options$withTheme&&_options$withTheme,name=options.name,stylesOptions=Object(objectWithoutProperties.a)(options,["defaultTheme","withTheme","name"]);var classNamePrefix=name,useStyles=Object(makeStyles.a)(stylesOrCreator,Object(esm_extends.a)({defaultTheme:defaultTheme,Component:Component,name:name||Component.displayName,classNamePrefix:classNamePrefix},stylesOptions)),WithStyles=react_default.a.forwardRef((function(props,ref){props.classes;var theme,innerRef=props.innerRef,other=Object(objectWithoutProperties.a)(props,["classes","innerRef"]),classes=useStyles(Object(esm_extends.a)({},Component.defaultProps,props)),more=other;return("string"===typeof name||withTheme)&&(theme=Object(useTheme.a)()||defaultTheme,name&&(more=Object(getThemeProps.a)({theme:theme,name:name,props:other})),withTheme&&!more.theme&&(more.theme=theme)),react_default.a.createElement(Component,Object(esm_extends.a)({ref:innerRef||ref,classes:classes},more))}));return hoist_non_react_statics_cjs_default()(WithStyles,Component),WithStyles}},styles_defaultTheme=__webpack_require__(50);__webpack_exports__.a=function(stylesOrCreator,options){return esm_withStyles_withStyles(stylesOrCreator,Object(esm_extends.a)({defaultTheme:styles_defaultTheme.a},options))}},function(module,exports,__webpack_require__){module.exports=__webpack_require__(110)()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return _slicedToArray}));var unsupportedIterableToArray=__webpack_require__(49);function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,i)||Object(unsupportedIterableToArray.a)(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return capitalize}));var _material_ui_utils__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(92);function capitalize(string){if("string"!==typeof string)throw new Error(Object(_material_ui_utils__WEBPACK_IMPORTED_MODULE_0__.a)(7));return string.charAt(0).toUpperCase()+string.slice(1)}},function(module,__webpack_exports__,__webpack_require__){"use strict";var defineProperty=__webpack_require__(42),toConsumableArray=__webpack_require__(21);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var slicedToArray=__webpack_require__(7);function _readOnlyError(name){throw new Error('"'+name+'" is read-only')}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function get_get(target,property,receiver){return(get_get="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=function(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _typeof(obj){return(_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!==typeof call?function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}var unsupportedIterableToArray=__webpack_require__(49);function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=Object(unsupportedIterableToArray.a)(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}var regenerator=__webpack_require__(0),regenerator_default=__webpack_require__.n(regenerator);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var rainbow_sdk_min_rainbowSDK=function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=423)}([function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),Call=function(){function Call(status,id,type,contact){_classCallCheck(this,Call),this.isVm=!1,this.remoteMedia=0,this.localMedia=0,this.isEscalated=!1,this.isError=!1,this.startDate=new Date,this.isInitiator=!1,this.participants=null,this.isRemoteVideoMuted=!1,this.isConference=!1,this.subject=void 0,this.currentCalled={contactPhoneNumber:"",contact:null,participantsPhoneNumbers:[],participants:[]},this.fullJid="",this.mediaPillarCall=null,this.isSecondary=!1,this.relevant=!0,this.relevantEquipmentId="unknown",this.deviceId=null,this.isOwner=void 0,this.pbxConnectionDown=void 0,this.isMuted=!1,this.duration=0,this.durationTimer=null,this.unifiedPlanActivated=!1,this.globalCallId=null,this.correlatorData=null,this.activeControl=!1,this.hasRemoteControlling=!1,this.networkQuality=0,this.sipWiseData=null,this.errorMessage=null,this.lastCause=null,this.rxSubject=new rxjs_1.Subject,this.status=status,this.type=type,this.id=id,this.conversationId=null,this.connectionId=null,this.isVm=null,this.contact=contact,this.remoteMedia=0,this.localMedia=0,this.isEscalated=!1,this.startDate=new Date,this.isInitiator=!1,this.participants=null,this.isRemoteVideoMuted=!1,this.isConference=!1,this.avatars=contact&&contact.avatar?[this.contact.avatar.src]:[],this.subject=void 0,this.currentCalled={contactPhoneNumber:"",contact:null,participantsPhoneNumbers:[],participants:[]},this.fullJid="",this.mediaPillarCall=null,this.isSecondary=!1,this.relevant=!1,this.relevantEquipmentId="unknown",this.deviceId=null,this.isOwner=void 0,this.pbxConnectionDown=void 0,this.isMuted=!1,this.duration=0,this.statusInfo=null,this.globalCallId=void 0,this.correlatorData=void 0,this.activeControl=!1,this.hasRemoteControlling=!1,this.networkQuality=0,this.sipWiseData={initCause:"",direction:"",called:{phoneNumber:"",displayName:""}}}return _createClass(Call,[{key:"setCallId",value:function(id){this.id=id}},{key:"getGlobalCallId",value:function(id){return this.globalCallId}},{key:"setGlobalCallId",value:function(id){this.globalCallId=id}},{key:"setConversationId",value:function(conversationId){this.conversationId=conversationId}},{key:"setStatus",value:function(status){this.status=status}},{key:"setCorrelatorData",value:function(correlatorData){this.correlatorData=correlatorData}},{key:"setType",value:function(type){this.type=type}},{key:"setIsVm",value:function(isVM){this.isVm=isVM}},{key:"setContact",value:function(contact){this.contact=contact,this.avatars=[this.contact.avatar.src]}},{key:"getCurrentCalled",value:function(){return this.currentCalled}},{key:"setSubject",value:function(subject){this.subject=subject}},{key:"setCurrentCalledContactNumber",value:function(number){this.currentCalled.contactPhoneNumber=number}},{key:"setRelevantEquipmentId",value:function(relevantEquipmentId){this.relevantEquipmentId=relevantEquipmentId}},{key:"setParticipants",value:function(participants){var _this9=this;this.participants=participants,this.avatars=[],this.participants.forEach((function(participant){_this9.avatars.push(participant.avatar.src)}))}},{key:"setConnectionId",value:function(connectionId){this.connectionId=connectionId,this.id=Call.getIdFromConnectionId(connectionId)}},{key:"isInConversationWithMobile",value:function(){return!!this.fullJid&&(-1!==this.fullJid.indexOf("mobile_android")||-1!==this.fullJid.indexOf("mobile_ios"))}},{key:"isInConversationWithDesktopApp",value:function(){return!!this.fullJid&&-1!==this.fullJid.indexOf("desk_")}},{key:"setCurrentCalled",value:function(currentCalled){currentCalled?this.contact&&this.contact.id?(this.currentCalled.contactPhoneNumber=currentCalled.contactPhoneNumber&&""!==currentCalled.contactPhoneNumber?currentCalled.contactPhoneNumber:"",this.currentCalled.contact=currentCalled.contact?currentCalled.contact:null,this.currentCalled.participantsPhoneNumbers=null,this.currentCalled.participants=null):(this.currentCalled.contactPhoneNumber="",this.currentCalled.contact=null,this.currentCalled.participantsPhoneNumbers=currentCalled.participantsPhoneNumbers&&currentCalled.participantsPhoneNumbers.length>0?currentCalled.participantsPhoneNumbers:null,this.currentCalled.participants=currentCalled.participants&&currentCalled.participants.length>0?currentCalled.participants:null):(this.currentCalled.contactPhoneNumber="",this.currentCalled.contact=null,this.currentCalled.participantsPhoneNumbers=null,this.currentCalled.participants=null)}},{key:"isMediaPillarCall",value:function(){return null!==this.mediaPillarCall}},{key:"getMediaPillarCall",value:function(){return this.mediaPillarCall}},{key:"setMediaPillarCall",value:function(mediaPillarCallContext){this.mediaPillarCall=mediaPillarCallContext||null}},{key:"setDeviceIdSipWise",value:function(deviceId){this.deviceId=deviceId||null}},{key:"getDeviceIdSipWise",value:function(){return this.deviceId}},{key:"setConnectionIdSipWise",value:function(connectionId){this.connectionId=connectionId}},{key:"getConnectionIdSipWise",value:function(){return this.connectionId}},{key:"resetSipWiseData",value:function(){this.sipWiseData={initCause:"",direction:"",called:{phoneNumber:"",displayName:""}}}},{key:"setInitCauseSipWiseData",value:function(cause){this.sipWiseData.initCause=cause,this.lastCause=cause}},{key:"getInitCauseSipWiseData",value:function(){return this.sipWiseData.initCause}},{key:"setDirectionSipWiseData",value:function(direction){this.sipWiseData.direction=direction}},{key:"getDirectionSipWiseData",value:function(){return this.sipWiseData.direction}},{key:"setCalledSipWiseData",value:function(called){this.sipWiseData.called=called}},{key:"getCalledSipWiseData",value:function(){return this.sipWiseData.called}},{key:"isHuntingGroupCallSipWise",value:function(){return"distributed"===this.sipWiseData.initCause}},{key:"getHuntingGroupCalledInfo",value:function(){return this.isHuntingGroupCallSipWise()?this.getCalledSipWiseData():null}},{key:"getDeviceIdFromConnectionIdFromCall",value:function(){return this.deviceId?this.deviceId:this.connectionId?this.connectionId.split("#")[1]:null}},{key:"startDuration",value:function(){var _this10=this;this.durationTimer||(this.durationTimer=rxjs_1.interval(1e3).subscribe((function(){_this10.duration++})))}},{key:"stopDuration",value:function(){this.durationTimer&&(this.durationTimer.unsubscribe(),this.durationTimer=null)}},{key:"toString",value:function(){return"(type:"+this.type.value+", id:"+this.id+", status:"+this.status.value+(this.isConference?" conference":"")+")"}},{key:"isInCallWithMediaPillar",value:function(){return this.fullJid&&-1!==this.fullJid.indexOf("mp_")}},{key:"subscribe",value:function(observer){return this.rxSubject.subscribe(observer)}},{key:"publish",value:function(name){var value=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next({name:name,value:value})}}],[{key:"create",value:function(status,id,type,contact){return new Call(status,id,type,contact)}},{key:"getIdFromConnectionId",value:function(connectionId){return connectionId}},{key:"getCallIdFromConnectionId",value:function(connectionId){return connectionId?connectionId.split("#")[0]:null}},{key:"getDeviceIdFromConnectionId",value:function(connectionId){return(connectionId?connectionId.split("#")[1]:null)||null}}]),Call}();Call.Status={UNKNOWN:{key:0,value:"Unknown"},DIALING:{key:1,value:"dialing"},QUEUED_INCOMMING:{key:2,value:"queuedIncomming"},QUEUED_OUTGOING:{key:10,value:"queuedOutGoing"},RINGING_INCOMMING:{key:3,value:"incommingCall"},RINGING_OUTGOING:{key:4,value:"ringingOutgoing"},ACTIVE:{key:5,value:"active"},HOLD:{key:6,value:"held"},PUT_ON_HOLD:{key:7,value:"putOnHold"},RELEASING:{key:8,value:"releasing"},ANSWERING:{key:9,value:"answering"},CONNECTING:{key:12,value:"connecting"},ERROR:{key:11,value:"error"}},Call.Type={WEBRTC:{key:1,value:"Video"},PHONE:{key:2,value:"Phone"}},Call.Media={AUDIO:1,VIDEO:2,PHONE:4,SHARING:8},exports.Call=Call},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var event_service_1=__webpack_require__(32),main_service_1=__webpack_require__(26),logger_service_1=__webpack_require__(15),errorHelper_service_1=__webpack_require__(37),settings_service_1=__webpack_require__(5),auth_service_1=__webpack_require__(2),i18n_service_1=__webpack_require__(38),company_service_1=__webpack_require__(59),xmpp_service_1=__webpack_require__(4),anonymizer_1=__webpack_require__(14),promiseQueue_1=__webpack_require__(49),contact_model_1=__webpack_require__(43),rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24),imageUtils_service_1=__webpack_require__(74),_escape=__webpack_require__(60),moment=__webpack_require__(3),ContactService=function(){function ContactService(){_classCallCheck(this,ContactService),this.userContact=null,this.contacts={},this.dbContacts={},this.jtelContacts={},this.currentLanguage=null,this.eventService=event_service_1.default,this.settingsService=settings_service_1.default,this.mainService=main_service_1.default,this.logger=logger_service_1.default,this.errorHelperService=errorHelper_service_1.default,this.authService=auth_service_1.default,this.i18nService=i18n_service_1.default,this.companyService=company_service_1.default,this.xmppService=xmpp_service_1.default,this.rxSubject=new rxjs_1.Subject,this.subscriptions=[],this._displayOrder=null,this.contactLastActivityInterval=null,this.calendarPresenceEventHandlerCleaner=null,this.xmppConnectionSubscription=null,this.presentationModeEventHandlerCleaner=null,this.subscriptionPromiseQueue=promiseQueue_1.PromiseQueue.create(),this.getContactPromises=[],this.contactConfigRef=null,this.lastUpdatePresentationMode=null,this.presentationModeTimeout=null,this.presentationModeActive=!1,this.awayStateActive=!1,this.busyState={status:null,message:null},this.manualState=!1}return _createClass(ContactService,[{key:"displayOrder",get:function(){return this._displayOrder},set:function(displayOrder){var _this11=this;this._displayOrder=displayOrder,Object.keys(this.contacts).forEach((function(key){var contact=_this11.contacts[key];contact.displayOrder=displayOrder,contact.computeDisplayName()}))}},{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee(){var serverLanguageCode,settings,shouldUpdatecustomData,_this12=this;return regenerator_default.a.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return this.currentLanguage=this.settingsService.getSetting("lang"),this.displayOrder=this.settingsService.getSetting("displayOrder"),this.settingsService.subscribeUpdateEvent("SETTINGS_UPDATED",(function(){_this12.currentLanguage=_this12.settingsService.getSetting("lang"),_this12.displayOrder=_this12.settingsService.getSetting("displayOrder"),_this12.updateContactsLastActivityMessage()})),this.subscriptions.push(this.xmppService.subscribeToContactEvents((function(event){switch(event.name){case"ON_CONTACT_PRESENCE_EVENT":_this12.contactPresenceChangedHandler(event.data);break;case"ON_CONTACT_UPDATE_EVENT":_this12.onContactChangeEvent(event.data.from,event.data.type);break;case"ON_ROSTER_CHANGED_EVENT":_this12.subscriptionPromiseQueue.add((function(){return _this12.rosterChangedHandlerPromise(event.data)}))}}))),this.xmppService.contactServiceReady=!0,this.calendarPresenceEventHandlerCleaner&&this.calendarPresenceEventHandlerCleaner(),this.calendarPresenceEventHandlerCleaner=this.eventService.subscribe("ON_CONTACT_CALENDAR_STATUS_CHANGE",(function(__event,contact){_this12.updateContactCalendarPresenceInfo(contact)})),this.presentationModeEventHandlerCleaner&&this.presentationModeEventHandlerCleaner(),this.presentationModeEventHandlerCleaner=this.eventService.subscribe("ON_PRESENTATION_MODE_CHANGED_EVENT",(function(__event,status){_this12.onPresentationModeChangedEvent(status)})),this.logger.info("[contactService] Create userContact ("+this.xmppService.jid+")"),this.userContact=this.createContact(),this.userContact.ask=null,this.userContact.subscription=null,this.userContact.id=this.xmppService.jid,this.userContact.jid=this.xmppService.jid,this.userContact.fullJid=this.xmppService.fullJid,this.userContact.language=this.currentLanguage,this.userContact.updateFromUserData(this.authService.loggedInUser),this.userContact.getAvatar(),this.updateContactRichStatus(this.userContact),this.dbContacts[this.userContact.dbId]=this.userContact,this.contacts[this.userContact.id]=this.userContact,this.jtelContacts[this.userContact.jidtel]=this.userContact,this.authService.loggedInUser.language||(serverLanguageCode=this.settingsService.getAppliLanguageCodeForServer(),this.updateUserContact({language:serverLanguageCode})),_context2.next=3,this.getUserSettings();case 3:return settings=_context2.sent,this.manageCalendarPresencePrompt(settings),this.settingsService.setSetting("activeAlarm",settings.activeAlarm),this.settingsService.setSetting("activeNotif",settings.activeNotif),this.settingsService.setSetting("protectionAgainstMailTypeOffline",settings.protectionAgainstMailTypeOffline),this.settingsService.setSetting("applyCalendarPresence",String(settings.applyCalendarPresence)),this.logger.info("[contactService] Get alarm & notif data ("+settings.activeAlarm+" / "+settings.activeNotif+")"),this.logger.info("[contactService] Get mail setting data ("+settings.protectionAgainstMailTypeOffline+")"),shouldUpdatecustomData=!1,void 0===this.userContact.customData.pushToTalkEnabled&&(shouldUpdatecustomData=!0,this.userContact.customData.pushToTalkEnabled=!1),void 0===this.userContact.customData.pushToTalkKey&&(shouldUpdatecustomData=!0,this.userContact.customData.pushToTalkKey="Shift"),void 0===this.userContact.customData.pushToTalkDelay&&(shouldUpdatecustomData=!0,this.userContact.customData.pushToTalkDelay=0),void 0===this.userContact.customData.enablePushToTalkTone&&(shouldUpdatecustomData=!0,this.userContact.customData.enablePushToTalkTone=!1),shouldUpdatecustomData&&this.updateUserContact({customData:this.userContact.customData}),_context2.next=13,this.companyService.getCompanyById(this.userContact.company.id);case 13:return this.userContact.company=_context2.sent,_context2.next=16,this.companyService.getCompanyAlertNotificationState(this.userContact.company);case 16:return this.userContact.alertNotificationEnabledForMyCompany=_context2.sent,this.attachHandlers(),_context2.next=20,this.getNetwork();case 20:return _context2.next=22,this.updateNetworkWithRosterInfo();case 22:this.subscriptions.push(this.mainService.subscribe((function(appActive){return _this12.logger.info("[contactService] AppActive changed : "+appActive),!appActive&&_this12.userContact&&"online"===_this12.userContact.status&&(_this12.awayStateActive=!0),appActive&&_this12.awayStateActive&&(_this12.awayStateActive=!1),_this12.updatePresence(!0),!0}))),this.getMissedPresenceMessages(),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((function(event){_this12.onConnectionStateChangeEvent(event)})),this.contactLastActivityInterval=setInterval((function(){_this12.updateContactsLastActivityMessage()}),6e4);case 27:case"end":return _context2.stop()}}),_callee,this)})))}},{key:"attachHandlers",value:function(){var _this13=this;this.logger.info("[contactService] AttachHandlers"),this.contactConfigRef&&(this.xmppService.deleteHandler(this.contactConfigRef),this.contactConfigRef=null),this.contactConfigRef=this.xmppService.addHandler((function(stanza){return _this13.onUserManagementEvent(stanza)}),null,"message","management")}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee2(){return regenerator_default.a.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:this.userContact=null,this.contacts={},this.dbContacts={},this.jtelContacts={},this.presentationModeActive=!1,this.awayStateActive=!1,this.busyState={status:null,message:null},this.manualState=!1,this.contactLastActivityInterval&&(clearInterval(this.contactLastActivityInterval),this.contactLastActivityInterval=null),this.subscriptions&&this.subscriptions.forEach((function(subscription){subscription.unsubscribe()})),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.calendarPresenceEventHandlerCleaner&&(this.calendarPresenceEventHandlerCleaner(),this.calendarPresenceEventHandlerCleaner=null);case 1:case"end":return _context3.stop()}}),_callee2,this)})))}},{key:"subscribe",value:function(handler){return this.rxSubject.subscribe(handler)}},{key:"sendEvent",value:function(name){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next(event_model_1.RBEvent.create(name,data))}},{key:"sendUpdateEvent",value:function(contact){contact.rxSubject.next({name:"update",data:contact});var event=this.isUserContact(contact)?"ON_USER_CONTACT_UPDATED_EVENT":"ON_CONTACT_UPDATED_EVENT";this.eventService.publish(event,contact)}},{key:"onConnectionStateChangeEvent",value:function(event){var _this14=this;"ON_XMPP_DISCONNECTED"===event.name&&this.userContact&&(this.userContact.resources={},Object.keys(this.contacts).forEach((function(key){var contact=_this14.contacts[key];contact.isBot||(contact.resources={},"unknown"!==contact.status&&"none"!==contact.subscription&&(contact.status="offline",contact.imStatusStamp=[]))})),this.presentationModeActive=!1,this.awayStateActive=!1,this.busyState={status:null,message:null},this.manualState=!1)}},{key:"createContact",value:function(){var jid=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,firstname=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,lastname=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,company=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,login=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,contact=new contact_model_1.Contact(jid,null,company);return contact.login=login,contact.avatarServerURL=this.mainService.cdn?this.mainService.cdnServer:config.webservices.protocol+"://"+config.webservices.currentServer,contact.firstname=firstname,contact.lastname=lastname,contact.displayOrder=this.displayOrder,contact.computeDisplayName(),contact}},{key:"createBotContact",value:function(jid,name,id,botAvatarUrl,botCapabilities){var contact=this.contacts[jid];return contact||((contact=new contact_model_1.Contact(jid)).botDetails="emilyDetails"),contact.displayOrder=this.displayOrder,contact.lastname=name,contact.isBot=!0,contact.status="online",contact.imStatus="online",contact.subscription="both",contact.computeDisplayName(),contact.avatar=window.rainbowSDK?null:{src:botAvatarUrl},contact.dbId=id,contact.isBotSharing=!!botCapabilities&&botCapabilities.some((function(param){return"SHARING"===param})),this.contacts[contact.id]=this.dbContacts[id]=contact,contact}},{key:"isMediaPillarJid",value:function(jid){return jid&&0===jid.indexOf("mp_")}},{key:"isUserContactJid",value:function(jid){return!(!this.userContact||!jid||0===jid.length)&&jid.startsWith(this.userContact.jid)}},{key:"isUserContact",value:function(contact){return!(!contact||!contact.jid)&&this.isUserContactJid(contact.jid)}},{key:"searchContacts",value:function(criteria){var _this15=this;return this.getContacts().filter((function(contact){return(contact.roster||contact.isBot)&&!contact.isTerminated&&_this15.contactMatcher(contact,criteria)}))}},{key:"contactMatcher",value:function(contact,criteria){var displayname=contact.firstname+" "+contact.lastname,queries=criteria.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ ]+/),names=displayname.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ ]+/);return queries.every((function(query){return names.some((function(name,index){return!(!name.length||0!==name.indexOf(query))&&(names[index]="",!0)}))}))}},{key:"getContacts",value:function(){var _this16=this;return Object.keys(this.contacts).map((function(key){return _this16.contacts[key]}))}},{key:"getContact",value:function(jid){var phoneNumber=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,contactId=jid||phoneNumber;return this.isUserContactJid(contactId)?this.userContact:this.contacts[contactId]}},{key:"getContactByJid",value:function(jid){return this.getContact(jid)}},{key:"getContactById",value:function(dbId){return this.dbContacts[dbId]}},{key:"getContactByEmail",value:function(email){var _this17=this,contactKey=Object.keys(this.contacts).find((function(key){return _this17.contacts[key].containsEmail(email)}));return contactKey?this.contacts[contactKey]:null}},{key:"getContactByPhoneNumber",value:function(phonenumber){var _this18=this,contactKey=Object.keys(this.contacts).find((function(key){return _this18.contacts[key].containsPhoneNumber(phonenumber)}));return contactKey?this.contacts[contactKey]:null}},{key:"getContactByDBId",value:function(dbId){var force=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee3(){var existingContact,url,response,contactData,contact,errorInfo;return regenerator_default.a.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(_context4.prev=0,existingContact=this.dbContacts[dbId],force||!existingContact){_context4.next=4;break}return _context4.abrupt("return",existingContact);case 4:if(this.getContactPromises[dbId]){_context4.next=16;break}return url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(dbId,"?format=full"),_context4.next=8,fetch(url,{method:"GET",headers:this.authService.getRequestHeader()});case 8:if((response=_context4.sent).ok){_context4.next=11;break}throw response;case 11:return _context4.next=13,response.json();case 13:return contactData=_context4.sent.data,contact=existingContact||this.createBasicContact(contactData.jid_im),_context4.abrupt("return",(contact.updateFromUserData(contactData),contact.getAvatar(),this.dbContacts[contact.dbId]=contact,this.jtelContacts[contact.jidtel]=contact,delete this.getContactPromises[dbId],this.logger.info("[contactService] GetContactByDBId ("+dbId+") -- "+contactData.jid_im+" -- success"),contact));case 16:return _context4.abrupt("return",this.getContactPromises[dbId]);case 19:return _context4.prev=19,_context4.t0=_context4.catch(0),delete this.getContactPromises[dbId],_context4.next=24,this.errorHelperService.getErrorInfo(_context4.t0,"getContactByDBId");case 24:throw errorInfo=_context4.sent,this.logger.error(errorInfo.message),errorInfo.error;case 26:case"end":return _context4.stop()}}),_callee3,this,[[0,19]])})))}},{key:"getContactsByEmails",value:function(emails){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee4(){var url,loginEmail,response,responseData,contacts,contactsArray,errorInfo,_this19=this;return regenerator_default.a.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.prev=0,this.logger.info("[contactService] getContactsByEmails with ["+emails.join()+"]"),url=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/loginemails",loginEmail=emails.map((function(email){return email.toLowerCase()})),_context5.next=6,fetch(url,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify({loginEmail:loginEmail})});case 6:if((response=_context5.sent).ok){_context5.next=9;break}throw response;case 9:return _context5.next=11,response.json();case 11:return responseData=_context5.sent,contacts={},contactsArray=responseData.data.map((function(userData){var contact=_this19.dbContacts[userData.id];return contact||(contact=_this19.createContact(),_this19.contacts[contact.id]=contact,_this19.dbContacts[contact.dbId]=contact,_this19.jtelContacts[contact.jidtel]=contact),contact.updateFromUserData(userData),contact.getAvatar(),contacts[contact.loginEmail]=contact,loginEmail.splice(loginEmail.indexOf(contact.loginEmail.toLowerCase()),1),contact})),_context5.abrupt("return",{contacts:contacts,contactsArray:contactsArray,emails:loginEmail});case 17:return _context5.prev=17,_context5.t0=_context5.catch(0),_context5.next=21,this.errorHelperService.getErrorInfo(_context5.t0,"getContactsByEmails");case 21:throw errorInfo=_context5.sent,this.logger.error(errorInfo.message),errorInfo.error;case 23:case"end":return _context5.stop()}}),_callee4,this,[[0,17]])})))}},{key:"getContactsByJids",value:function(jids){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee5(){var url,response,errorInfo,_this20=this;return regenerator_default.a.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.prev=0,this.logger.info("[contactService] getContactsByJids with [".concat(jids.join(),"]")),url=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/jids?limit=1000",_context6.next=5,fetch(url,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify({jid_im:jids})});case 5:if((response=_context6.sent).ok){_context6.next=8;break}throw response;case 8:return _context6.next=10,response.json();case 10:_context6.sent.data.forEach((function(userData){var contact=_this20.getContact(userData.jid_im);contact||(contact=_this20.createContact()),contact.updateFromUserData(userData),contact.isAnonymousGuest()||(_this20.contacts[contact.id]=contact,_this20.dbContacts[contact.dbId]=contact,_this20.jtelContacts[contact.jidtel]=contact,contact.getAvatar(),contact.temp=!1)})),_context6.next=19;break;case 13:return _context6.prev=13,_context6.t0=_context6.catch(0),_context6.next=17,this.errorHelperService.getErrorInfo(_context6.t0,"getContactsByJids");case 17:throw errorInfo=_context6.sent,this.logger.error(errorInfo.message),errorInfo.error;case 19:case"end":return _context6.stop()}}),_callee5,this,[[0,13]])})))}},{key:"createBasicContact",value:function(jid){var phoneNumber=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,append=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger.debug("[contactService] CreateContact ".concat(jid," ").concat(anonymizer_1.default(phoneNumber)));var contact=this.createContact();if(!jid)return contact.id=phoneNumber,contact.initials="?",contact.displayName=phoneNumber||"Unknown contact",contact.lastname=phoneNumber||"Unknown contact",contact.firstname="",contact.phoneProCan=phoneNumber||"",contact.phonePro=contact.phoneProCan,contact.temp=!0,contact.avatar={src:"/resources/skins/rainbow/images/conversations/unknownUser.jpeg"},contact.nameUpdatePrio=contact_model_1.Contact.NameUpdatePrio.NO_UPDATE_PRIO,contact;var contactId=jid;return contactId||(contactId=phoneNumber,contact.phoneProCan=phoneNumber),contactId||(contactId="anonymous"),contact.jid=jid,contact.id=contactId,contact.ask="none",contact.subscription="none",this.updateContactRichStatus(contact),!1!==append&&(this.contacts[contact.id]=contact),contact}},{key:"createEmptyContact",value:function(jid){var contact=this.createBasicContact(jid);return contact.initials="?",contact.displayName="Unknown contact",contact.lastname="Unknown contact",contact.firstname="",contact.temp=!0,contact.avatar={src:"/resources/skins/rainbow/images/conversations/unknownUser.jpeg"},contact}},{key:"getOrCreateContact",value:function(jid){var _this21=this,phoneNumber=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!jid&&!phoneNumber)return Promise.reject(new Error("No jid or no phoneNumber"));var existingContact=this.getContact(jid,phoneNumber);if(existingContact)return Promise.resolve(existingContact);if(jid&&-1===jid.indexOf("@"))throw new Error("Invalid jid "+jid);var contactId=jid||phoneNumber;return jid?(this.getContactPromises[contactId]||(this.getContactPromises[contactId]=new Promise((function(resolve,reject){var contact=_this21.createBasicContact(jid,phoneNumber,!1);_this21.updateContactFromServer(contact).then((function(){_this21.contacts[contact.id]=contact,_this21.dbContacts[contact.dbId]=contact,_this21.jtelContacts[contact.jidtel]=contact,delete _this21.getContactPromises[contactId],resolve(contact)})).catch((function(error){_this21.logger.error("[contactService] getOrCreateContact -- failure -- "+error.message),delete _this21.getContactPromises[contactId],reject(error)}))}))),this.getContactPromises[contactId]):Promise.resolve(this.createBasicContact(null,phoneNumber))}},{key:"updateContactFromServer",value:function(contact){var shouldSkipAvatar=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee6(){var url,response,responseData,errorInfo;return regenerator_default.a.wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/jids/").concat(contact.jid),_context7.next=4,fetch(url,{headers:this.authService.getRequestHeader()});case 4:if((response=_context7.sent).ok){_context7.next=7;break}throw response;case 7:return _context7.next=9,response.json();case 9:responseData=_context7.sent,contact.updateFromUserData(responseData.data),this.updateContactRichStatus(contact,this.isUserContactJid(contact.jid)),shouldSkipAvatar||contact.getAvatar(),this.sendUpdateEvent(contact),_context7.next=19;break;case 13:return _context7.prev=13,_context7.t0=_context7.catch(0),_context7.next=17,this.errorHelperService.getErrorInfo(_context7.t0,"updateContactFromServer");case 17:throw errorInfo=_context7.sent,this.logger.error(errorInfo.message),errorInfo.error;case 19:case"end":return _context7.stop()}}),_callee6,this,[[0,13]])})))}},{key:"getContactInfoByEmail",value:function(email){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee7(){var url,response,errorInfo;return regenerator_default.a.wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.prev=0,url=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/loginemails?format=full",_context8.next=4,fetch(url,{method:"POST",headers:this.authService.getRequestHeader(),body:JSON.stringify({loginEmail:[email]})});case 4:if((response=_context8.sent).ok){_context8.next=7;break}throw response;case 7:return _context8.next=9,response.json();case 9:return _context8.abrupt("return",_context8.sent.data);case 12:return _context8.prev=12,_context8.t0=_context8.catch(0),_context8.next=16,this.errorHelperService.getErrorInfo(_context8.t0,"getContactInfoByEmail");case 16:throw errorInfo=_context8.sent,this.logger.error(errorInfo.message),errorInfo.error;case 18:case"end":return _context8.stop()}}),_callee7,this,[[0,12]])})))}},{key:"onContactChangeEvent",value:function(jid,type){var _this22=this;this.logger.info("[contactService] onContactChangeEvent event: "+event+" || status: "+jid+" || type: "+type),setTimeout((function(){return __awaiter(_this22,void 0,void 0,regenerator_default.a.mark((function _callee8(){var contact;return regenerator_default.a.wrap((function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(contact=this.getContact(jid),_context9.t0=contact,!_context9.t0){_context9.next=7;break}return _context9.next=5,this.updateContactFromServer(contact,!0);case 5:"avatar"===type&&contact.getAvatar(256,!0),this.sendUpdateEvent(contact);case 7:case"end":return _context9.stop()}}),_callee8,this)})))}),2e3)}},{key:"onUserManagementEvent",value:function(stanza){try{var userSettingsElem=$(stanza).find("usersettings");if(userSettingsElem.length&&"update"===userSettingsElem.attr("action"))return this.logger.info("[contactService] onUserManagementEvent - should update the presence"),this.sendPresenceFromConfiguration(),!0;var userPasswordElem=$(stanza).find("userpassword");return!userPasswordElem.length||"update"!==userPasswordElem.attr("action")||(this.logger.info("[contactService] onUserManagementEvent - userPassword updated"),this.xmppService.changePasswordInfo||(this.xmppService.changePasswordInfo={fromThirdParty:!0}),!0)}catch(error){return!0}}},{key:"sendPresenceFromConfiguration",value:function(){var sendAuthInfo=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee9(){var setting,message,presence,myRessource,userOptions,_userOptions;return regenerator_default.a.wrap((function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return this.logger.info("(with auth info)"),_context10.prev=1,_context10.next=4,this.getUserSettings();case 4:setting=_context10.sent,message="","invisible"===(presence=setting.presence)?presence="xa":"away"===presence&&(presence="xa",message="away"),this.logger.info("[contactService] sendPresenceFromConfiguration -> getUserSettings are "+presence+" || message : "+message),this.userContact&&this.userContact.resources&&this.userContact.resources[this.userContact.fullJid]?(myRessource=this.userContact.resources[this.userContact.fullJid])&&(myRessource.show!==presence||"xa"===myRessource.show&&myRessource.status!==message)?this.busyState&&"dnd"===this.busyState.status&&!this.manualState||(this.logger.info("[contactService] sendPresenceFromConfiguration should update my status from "+myRessource.show+" to "+presence+" ("+message+")"),userOptions={im:this.userContact.instantMessagesEnabled,alert:this.userContact.alertNotificationEnabledForMyCompany},this.setUserContactStatus(presence,message,sendAuthInfo,userOptions)):this.eventService.publish("ON_RELOAD_CAPABILITIES_FOR_MY_CONYTACT"):(_userOptions={im:this.userContact.instantMessagesEnabled,alert:this.userContact.alertNotificationEnabledForMyCompany},this.logger.info("[contactService] sendPresenceFromConfiguration set initial presence "),this.setUserContactStatus(presence,message,sendAuthInfo,_userOptions)),_context10.next=12;break;case 9:_context10.prev=9,_context10.t0=_context10.catch(1),this.logger.info("[contactService] sendPresenceFromConfiguration failure, send online"),this.setUserContactStatus("online",null,sendAuthInfo);case 12:case"end":return _context10.stop()}}),_callee9,this,[[1,9]])})))}},{key:"changeMyPresence",value:function(status){var _this23=this;if(this.logger.info("[contactService] changeMyPresence "+status+" "+this.userContact.message),("dnd"!==status||"presentation"!==this.userContact.message)&&"busy"!==status){var message="";"online"===status&&(message="mode=auto"),"away"===status&&(status="xa",message="away"),this.setUserContactStatus(status,message),"online"===status&&setTimeout((function(){_this23.manualState=!1,_this23.updatePresence()}),1e3);var presence="online";"xa"===status&&"away"===message?presence="away":"dnd"===status?presence="dnd":"xa"===status&&(presence="invisible"),this.setUserSettings({presence:presence})}}},{key:"updateUserContact",value:function(userData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee10(){var responseData,url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return responseData=null,_context11.prev=1,this.logger.info("[contactService] updateUserContact"),url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.authService.userId),headers=this.authService.getPostHeader(),_context11.next=7,fetch(url,{method:"PUT",headers:headers,body:JSON.stringify(userData)});case 7:if((response=_context11.sent).ok){_context11.next=10;break}throw response;case 10:return _context11.next=12,response.json();case 12:responseData=_context11.sent.data,this.userContact.updateFromUserData(responseData),this.authService.loggedInUser=responseData,this.logger.info("[contactService] updateUserContact successfully"),_context11.next=24;break;case 18:return _context11.prev=18,_context11.t0=_context11.catch(1),_context11.next=22,this.errorHelperService.getErrorInfo(_context11.t0,"updateUserContact");case 22:throw errorInfo=_context11.sent,this.logger.error(errorInfo.message),errorInfo.error;case 24:case"end":return _context11.stop()}}),_callee10,this,[[1,18]])})))}},{key:"updateUserContactFullJid",value:function(){this.userContact.fullJid=this.xmppService.fullJid,this.attachHandlers()}},{key:"completeContactPhoneNumbers",value:function(contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee11(){return regenerator_default.a.wrap((function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(!contact.isBot){_context12.next=2;break}throw new Error("No phone numbers for bot contacts");case 2:if(!contact.phoneNumbersInitialized){_context12.next=4;break}return _context12.abrupt("return",contact);case 4:if(!contact.dbId){_context12.next=14;break}return _context12.prev=5,_context12.next=8,this.getContactByDBId(contact.dbId,!0);case 8:return _context12.abrupt("return",_context12.sent);case 11:throw _context12.prev=11,_context12.t0=_context12.catch(5),new Error(_context12.t0.message);case 14:return _context12.abrupt("return",contact);case 15:case"end":return _context12.stop()}}),_callee11,this,[[5,11]])})))}},{key:"updateUserPassword",value:function(oldPassword,newPassword){var _this24=this,async=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(resolve,reject){var login=_this24.userContact.loginEmail;_this24.xmppService.changePasswordInfo={resolve:async?resolve:null,login:login,newPassword:newPassword};var url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(_this24.authService.userId,"/change-password"),headers=_this24.authService.getPostHeader();fetch(url,{method:"PUT",headers:headers,body:JSON.stringify({oldPassword:oldPassword,newPassword:newPassword})}).then((function(response){if(!response.ok)throw response;async||resolve()})).catch((function(error){return __awaiter(_this24,void 0,void 0,regenerator_default.a.mark((function _callee12(){var errorInfo;return regenerator_default.a.wrap((function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return this.xmppService.changePasswordInfo=null,_context13.next=3,this.errorHelperService.getErrorInfo(error,"updateUserPassword");case 3:errorInfo=_context13.sent,this.logger.error(errorInfo.message),reject(errorInfo.error);case 5:case"end":return _context13.stop()}}),_callee12,this)})))}))}))}},{key:"getNetwork",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee13(){var url,headers,response,responseData,errorInfo,_this25=this;return regenerator_default.a.wrap((function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return _context14.prev=0,url=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/networks?limit=2000&format=full",headers=this.authService.getRequestHeader(),_context14.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context14.sent).ok){_context14.next=8;break}throw response;case 8:return _context14.next=10,response.json();case 10:responseData=_context14.sent,this.logger.info("[contactService] GetNetwork success -- find ".concat(responseData.data.length," contact(s)")),responseData.data.forEach((function(contactData){var contact=_this25.createContact();contact.updateFromUserData(contactData),_this25.contacts[contact.id]=contact,_this25.dbContacts[contact.dbId]=contact,_this25.jtelContacts[contact.jidtel]=contact,_this25.updateContactRichStatus(contact),contact.getAvatar(),_this25.sendUpdateEvent(contact)})),_context14.next=20;break;case 14:return _context14.prev=14,_context14.t0=_context14.catch(0),_context14.next=18,this.errorHelperService.getErrorInfo(_context14.t0,"getNetwork");case 18:throw errorInfo=_context14.sent,this.logger.error(errorInfo.message),errorInfo.error;case 20:case"end":return _context14.stop()}}),_callee13,this,[[0,14]])})))}},{key:"updateNetworkWithRosterInfo",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee14(){var stanza,_this26=this;return regenerator_default.a.wrap((function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.prev=0,_context15.next=3,this.xmppService.sendIQ($iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}));case 3:stanza=_context15.sent,this.logger.info("[contactService] Get rosters info successfully"),$(stanza).find("item").each((function(__index,item){var rosterElem=$(item),jid=_this26.xmppService.getBareJidFromJid(rosterElem.attr("jid"));if(jid&&jid.length&&!_this26.isTelJid(jid)){var contact=_this26.contacts[jid];if(contact){var ask=rosterElem.attr("ask"),subscription=rosterElem.attr("subscription");contact.ask=ask||"none",contact.subscription=subscription||"none",contact.roster=!0,_this26.updateContactRichStatus(contact),_this26.logger.info("[contactService] Update contact from roster ("+contact.ask+", "+contact.subscription+") "+jid)}}})),_context15.next=10;break;case 7:throw _context15.prev=7,_context15.t0=_context15.catch(0),this.logger.error("[contactService] Get rosters failure : "+_context15.t0.message),new Error(_context15.t0.message);case 10:case"end":return _context15.stop()}}),_callee14,this,[[0,7]])})))}},{key:"getUserSettings",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee15(){var url,headers,response,responseData,presence,activeAlarm,activeNotif,promptForCalendarPresence,protectionAgainstMailTypeOffline,applyCalendarPresence,errorInfo;return regenerator_default.a.wrap((function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return _context16.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userContact.dbId,"/settings"),headers=this.authService.getRequestHeader(),_context16.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context16.sent).ok){_context16.next=8;break}throw response;case 8:return _context16.next=10,response.json();case 10:return responseData=_context16.sent,presence=responseData.data.presence&&this.userContact.changePresenceEnabled?responseData.data.presence:"online",activeAlarm=responseData.data.activeAlarm||"relax1",activeNotif=responseData.data.activeNotif||"notif1",promptForCalendarPresence=responseData.data.promptForCalendarPresence,protectionAgainstMailTypeOffline=responseData.data.protectionAgainstMailTypeOffline,applyCalendarPresence=Boolean(responseData.data.applyCalendarPresence),_context16.abrupt("return",(this.logger.info("[contactService] GetUserSettings success"),{presence:presence,activeAlarm:activeAlarm,activeNotif:activeNotif,promptForCalendarPresence:promptForCalendarPresence,protectionAgainstMailTypeOffline:protectionAgainstMailTypeOffline,applyCalendarPresence:applyCalendarPresence}));case 20:return _context16.prev=20,_context16.t0=_context16.catch(0),_context16.next=24,this.errorHelperService.getErrorInfo(_context16.t0,"getUserSettings");case 24:return errorInfo=_context16.sent,_context16.abrupt("return",(this.logger.error(errorInfo.message),{presence:"online",activeAlarm:"relax1",activeNotif:"notif1",promptForCalendarPresence:!1}));case 26:case"end":return _context16.stop()}}),_callee15,this,[[0,20]])})))}},{key:"setUserSettings",value:function(params){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee16(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:return _context17.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userContact.dbId,"/settings"),headers=this.authService.getPostHeader(),_context17.next=5,fetch(url,{method:"PUT",headers:headers,body:JSON.stringify(params)});case 5:if((response=_context17.sent).ok){_context17.next=8;break}throw response;case 8:this.logger.info("[contactService] SetUserSettings ".concat(JSON.stringify(params)," -- success")),_context17.next=17;break;case 11:return _context17.prev=11,_context17.t0=_context17.catch(0),_context17.next=15,this.errorHelperService.getErrorInfo(_context17.t0,"setUserSettings");case 15:throw errorInfo=_context17.sent,this.logger.error(errorInfo.message),errorInfo.error.errorDetailsCode&&403153===errorInfo.error.errorDetailsCode&&(this.setUserContactStatus("online","mode=auto"),this.eventService.publish("ON_OPEN_GLOBAL_POPUP",{popupTitle:"presence",popupBody:"changePresenceDisabled",okLabel:"ok"})),errorInfo.error;case 17:case"end":return _context17.stop()}}),_callee16,this,[[0,11]])})))}},{key:"manageCalendarPresencePrompt",value:function(settings){if(void 0!==settings.promptForCalendarPresence)this.settingsService.setSetting("disableCalendarPresence",settings.promptForCalendarPresence?"false":"true"),this.logger.info("[contactService] promptForCalendarPresence -- "+settings.promptForCalendarPresence);else{var promptForCalendarPresence="true"!==this.settingsService.getSetting("disableCalendarPresence");this.logger.info("[contactService] MIGRATION NECESSARY -- promptForCalendarPresence : "+promptForCalendarPresence),this.setUserSettings({promptForCalendarPresence:promptForCalendarPresence})}}},{key:"updateContactCalendarPresenceInfo",value:function(contact){var calendarState=contact.calendarState,calendarParams=null,calendarMessage=null;calendarState.iconId=null;var calendarLabelKey=null;if(calendarState.autoReplyOn)calendarState.iconId="calendar--busy",calendarMessage="<div style='text-align:left'>"+_escape(calendarState.autoReplyInfos.message).replace(/\n/g,"<br/>")+"</div>",calendarParams={meetingDate:calendarState.autoReplyInfos.until,message:calendarMessage},calendarLabelKey=calendarState.autoReplyInfos.until?calendarState.autoReplyInfos.untilDate?"calendarAutoReply-date":"calendarAutoReply":"calendarAutoReplySimple";else{if("busy"===calendarState.message)calendarState.iconId="calendar--ok",calendarLabelKey=calendarState.untilDate?"calendar-busy-date":"calendar-busy";else if("out_of_office"===calendarState.message)calendarState.iconId="calendar--busy",calendarLabelKey=calendarState.untilDate?"calendar-outofoffice-date":"calendar-outofoffice";else if("online"===calendarState.status){var isBusyToday=calendarState.mdate&&calendarState.mdate.isSame(moment(),"d");calendarState.tooltip=isBusyToday?this.i18nService.translate("calendar-free",{meetingDate:calendarState.until}):this.i18nService.translate("calendar-noappointment")}calendarParams={meetingDate:calendarState.until}}calendarLabelKey&&(calendarState.tooltip=this.i18nService.translate(calendarLabelKey,{meetingDate:calendarParams.meetingDate}),calendarParams.message&&(calendarParams.message=calendarParams.message.replace(/<script>/g,""),calendarParams.message=calendarParams.message.replace(/(?:<br?\/?>\s*){2,}/g,"<br/>"),calendarState.tooltip=calendarState.tooltip+" "+calendarParams.message)),this.updateContactRichStatus(contact,this.isUserContactJid(contact.jid))}},{key:"isTelJid",value:function(jid){return 0===jid.indexOf("tel_")}},{key:"getResourceFromJid",value:function(jid){return this.xmppService.getResourceFromJid(jid)}},{key:"getImJid",value:function(jid){var bareJid=this.xmppService.getBareJidFromJid(jid);if(this.isTelJid(bareJid)){var contact=this.jtelContacts[bareJid];return contact?contact.jid:(this.logger.warn("[contactService] -- getIMJid("+jid+") -- failure -- no associated contact"),null)}return bareJid}},{key:"rosterChangedHandlerPromise",value:function(attr){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee17(){var contact;return regenerator_default.a.wrap((function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:if(_context18.prev=0,!this.isTelJid(attr.jid)){_context18.next=3;break}return _context18.abrupt("return",void this.logger.debug("[contactService] Contact changed ("+attr.jid+") ignored"));case 3:return _context18.next=5,this.getOrCreateContact(attr.jid);case 5:contact=_context18.sent,"remove"===attr.subscription?(contact.ask="none",contact.subscription="none",contact.roster=!1):(contact.ask=attr.ask,contact.subscription=attr.subscription,contact.roster=!0,"both"===attr.subscription&&this.updatePresence(!0)),this.updateContactRichStatus(contact),this.sendUpdateEvent(contact),this.sendEvent("ON_CONTACT_ROSTER_UPDATE_EVENT"),this.logger.info("[contactService] rosterChangedHandler - contact "+attr.jid+" changed ("+attr.ask+", "+attr.subscription+") success"),_context18.next=12;break;case 9:_context18.prev=9,_context18.t0=_context18.catch(0),this.logger.error("[contactService] rosterChangedHandler - contact "+attr.jid+" failure - "+_context18.t0.message);case 12:case"end":return _context18.stop()}}),_callee17,this,[[0,9]])})))}},{key:"contactPresenceChangedHandler",value:function(attr){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee18(){var resource,jidIm,contact,isUserContact,_this27=this;return regenerator_default.a.wrap((function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:if("calendar"!==(resource=this.getResourceFromJid(attr.jid))){_context19.next=3;break}return _context19.abrupt("return");case 3:if(jidIm=this.getImJid(attr.jid)){_context19.next=6;break}return _context19.abrupt("return");case 6:if(!jidIm.startsWith("room")){_context19.next=8;break}return _context19.abrupt("return");case 8:return _context19.next=10,this.getOrCreateContact(jidIm);case 10:contact=_context19.sent,isUserContact=this.isUserContact(contact),this.isTelJid(attr.jid)?(this.logger.info("[contactService] Update telephony presence ("+jidIm+") source: "+resource),this.logger.info("[contactService] Update telephony presence ("+jidIm+") msg: "+attr.message+" / status: "+attr.status),this.updateContactTelephonyStatus(contact,attr,isUserContact)):(this.logger.info("[contactService] Update im presence contact ("+jidIm+") status: "+attr.status+" "+attr.stamp),this.isUserContact(contact)&&"mode=auto"===attr.message&&"online"!==contact.status&&contact.resources.hasOwnProperty(attr.jid)&&attr.jid!==contact.fullJid&&"EVT_SERVICE_INITIATED"!==contact.telStatus&&"EVT_ESTABLISHED"!==contact.telStatus&&(contact.resources[contact.fullJid]&&"online"===contact.resources[contact.fullJid].show?this.logger.info("[contactService] Current ressource is already online, ignore message!"):(this.manualState&&(this.logger.info("[contactService] User is in manual state, leave it"),this.setUserContactStatus("online","mode=auto")),this.busyState&&"dnd"===this.busyState.status&&"busy"!==this.userContact.status&&(this.logger.info("[contactService] User is in call, re-update presence state"),setTimeout((function(){_this27.updatePresence(!0)}),500)))),this.updateContactIMStatus(contact,attr,this.isUserContact(contact)),this.updateLastActivity(contact)),this.sendUpdateEvent(contact);case 13:case"end":return _context19.stop()}}),_callee18,this)})))}},{key:"getMissedPresenceMessages",value:function(){this.logger.info("[contactService] GetMissedPresenceMessages");try{var list=this.xmppService.getPresenceWaitingList();if(list.length){for(this.logger.info("[contactService] GetMissedPresenceMessages length "+list.length);list.length>0;){var item=list.pop();this.contactPresenceChangedHandler(item)}this.xmppService.resetPresenceWaitingList()}}catch(error){this.logger.error("[contactService] GetMissedPresenceMessages error "+error)}}},{key:"computeStatusList",value:function(){var list=[];return this.userContact&&this.userContact.status&&(this.logger.info("[contactService] computeStatusList "+this.userContact.status+" "+this.userContact.message),list=this.userContact.changePresenceEnabled?"offline"===this.userContact.status?["online"]:"busy"===this.userContact.status?["busy"]:"dnd"===this.userContact.status&&"presentation"===this.userContact.message?["dnd"]:["online","away","xa","dnd"]:[]),list}},{key:"resetBusyState",value:function(){this.logger.info("[contactService] resetBusyState"),this.setBusyState(null,null,!0),this.sendPresenceFromConfiguration()}},{key:"setBusyState",value:function(status,message){var noUpdate=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.logger.info("[contactService] setBusyState -- "+status+" -- "+message),this.busyState={status:status,message:message},noUpdate||this.updatePresence()}},{key:"contactCalendarPresenceChangedHandler",value:function(){}},{key:"updateContactRichStatus",value:function(contact){var isMe=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("EVT_SERVICE_INITIATED"===contact.telStatus||"EVT_ESTABLISHED"===contact.telStatus)contact.status="busy",contact.message="audioPhone";else{if("subscribe"===contact.ask)contact.status="wait";else if("none"===contact.subscription||"from"===contact.subscription)contact.status="unknown";else{var calculatedStatus=this.calculateContactStatusFromResources(contact,isMe);"xa"===calculatedStatus.presence&&(""!==calculatedStatus.message||isMe?"away"===calculatedStatus.message&&(calculatedStatus.presence="away",calculatedStatus.message=""):calculatedStatus.presence="offline"),contact.calendarState.applyCalendarPresence&&"busy"===contact.calendarState.message&&(calculatedStatus.presence="dnd",calculatedStatus.message="appointment"),contact.status=calculatedStatus.presence,contact.message=calculatedStatus.message,this.logger.info("[contactService] updateContactRichStatus ".concat(isMe?"MY ":"USER"," PRESENCE : ").concat(calculatedStatus.presence," || message : ").concat(calculatedStatus.message))}this.updateContactStatusMessage(contact)}isMe&&this.eventService.publish("ON_UPDATE_MYCONTACT_EVENT"),this.eventService.publish("ON_UPDATE_CONTACT_RICH_STATUS_EVENT",contact)}},{key:"calculateContactStatusFromResources",value:function(contact,isMe){var presence="offline",message="",initStamp=null,stamp=null,fullJid=contact.fullJid,desktopPresence=!1,allowMobiles=config.webrtcWithMobiles;for(var key in contact.resources)if(contact.resources.hasOwnProperty(key)){var resource=contact.resources[key];if("dnd"===resource.show&&"phone"===resource.status){presence="busy",message="audioPhone",desktopPresence=!0,fullJid=key;break}if("xa"===resource.show||"dnd"===resource.show&&""===resource.status){var toUpdate=!1;resource.initStamp?initStamp?resource.initStamp.getTime()>initStamp.getTime()&&(initStamp=resource.initStamp,toUpdate=!0):(initStamp=resource.initStamp,toUpdate=!0):stamp?resource.stamp.getTime()>stamp.getTime()&&(stamp=resource.stamp,initStamp=resource.stamp,toUpdate=!0):(stamp=resource.stamp,initStamp=resource.stamp,toUpdate=!0),toUpdate&&(presence=resource.show,message=resource.status)}else"xa"!==presence&&("dnd"!==presence||"dnd"===presence&&""!==message)&&"dnd"===resource.show&&""!==resource.status?("presentation"===resource.status?(presence=resource.show,message="presentation"):(presence="busy",message=resource.status),fullJid=key,desktopPresence=!0):isMe&&"online"===resource.show&&"mode=auto"===resource.status&&key===contact.fullJid?"busy"!==presence&&"dnd"!==presence&&"presentation"!==message&&(presence="online",message="",resource.status="",this.xmppService.isMobileResource(key)?presence="online-mobile":desktopPresence=!0):"online"===resource.show&&"xa"!==presence&&"dnd"!==presence&&"busy"!==presence?(message="","online-mobile"!==presence&&(presence="online"),resource.status="",this.xmppService.isMobileResource(key)?presence="online-mobile":(fullJid=key,desktopPresence=!0),allowMobiles&&(fullJid=key)):"away"===resource.show&&"offline"===presence&&(presence="away",message="",fullJid=key);"mode=auto"===resource.status&&(resource.status="")}for(var _key2 in contact.resources)contact.resources.hasOwnProperty(_key2)&&"mode=auto"===contact.resources[_key2].status&&(contact.resources[_key2].status="");return isMe||contact.fullJid||(contact.fullJid=fullJid),"online-mobile"===presence&&desktopPresence?(presence="online",message=""):"online-mobile"!==presence||isMe||allowMobiles||(contact.fullJid=null,message=""),{presence:presence,message:message}}},{key:"updatePresence",value:function(){var _this28=this,forced=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger.info("[contactService] updatePresence"),this.manualState?(this.logger.info("[contactService] updatePresence manualState"),"away"===this.userContact.status&&this.busyState&&"dnd"===this.busyState.status&&(this.setUserContactStatus("online","mode=auto"),setTimeout((function(){_this28.updatePresence()}),1e3))):!this.presentationModeActive||this.busyState&&this.busyState.status?this.busyState&&"dnd"===this.busyState.status?(this.logger.info("[contactService] updatePresence dnd "+this.busyState.message),this.xmppService.sendPresence("dnd",this.busyState.message)):this.awayStateActive?(this.logger.info("[contactService] updatePresence away"),this.xmppService.sendPresence("away","")):this.userContact&&"online"!==this.userContact.status?(this.logger.info("[contactService] updatePresence online"),this.setUserContactStatus("online")):forced&&this.userContact&&"online"===this.userContact.status&&(this.logger.info("[contactService] updatePresence forced online"),this.setUserContactStatus("online")):(this.logger.info("[contactService] updatePresence dnd presentation"),this.xmppService.sendPresence("dnd","presentation"))}},{key:"setUserContactStatus",value:function(status){var message=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,withAuthInfo=arguments.length>2&&void 0!==arguments[2]&&arguments[2],userOptions=arguments.length>3?arguments[3]:void 0;try{this.logger.info("[contactService] Set userContact status : "+status+(message?"("+message+")":"")),this.xmppService.started&&("online"===status?(this.manualState=!1,this.xmppService.sendPresence(null,message,withAuthInfo,userOptions)):(this.manualState=!0,"away"===status?this.xmppService.sendPresence("away",message,withAuthInfo,userOptions):"dnd"===status?this.xmppService.sendPresence("dnd",message,withAuthInfo,userOptions):"xa"===status&&this.xmppService.sendPresence("xa",message,withAuthInfo,userOptions)))}catch(error){this.logger.error("[contactService] Set userContact status error : "+error)}}},{key:"updateContactTelephonyStatus",value:function(contact,attr,isMe){var statusOrg=contact.telStatus;if("pcg2"===this.getResourceFromJid(attr.jid))switch(attr.status){case"offline":contact.telStatus="";break;case"online":contact.telStatus="EVT_CONNECTION_CLEARED";break;case"dnd":contact.telStatus="EVT_ESTABLISHED";break;default:contact.telStatus=""}else contact.telStatus=attr.message;this.updateContactRichStatus(contact,isMe),isMe&&statusOrg!==contact.telStatus&&this.eventService.publish("ON_UPDATE_MYTELEPHONY_STATUS_EVENT")}},{key:"updateContactIMStatus",value:function(contact,attr,isMe){if(contact.imStatusStamp[attr.jid]&&contact.imStatusStamp[attr.jid]>attr.stamp)this.logger.info("[contactService] Ignore obsolete presence message for contact "+contact.jid);else{this.logger.info("[contactService] updateIMStatus "+JSON.stringify(attr)),contact.imStatusStamp[attr.jid]=attr.stamp,attr.status&&(contact.imStatus=attr.status);var status=attr.message?attr.message:"";if("offline"===contact.imStatus?(contact.fullJid===attr.jid&&(contact.fullJid=null),delete contact.resources[attr.jid],delete contact.imStatusStamp[attr.jid],0===contact.resources.length&&(contact.message="")):(contact.resources[attr.jid]?(contact.resources[attr.jid].show=contact.imStatus,contact.resources[attr.jid].status=status,contact.resources[attr.jid].stamp=attr.stamp):contact.resources[attr.jid]={show:contact.imStatus,status:status,initStamp:attr.stamp,stamp:attr.stamp},this.logger.info("[Contact] updateIMStatus user resources after update "+JSON.stringify(contact.resources)),this.xmppService.isMobileResource(attr.jid)||isMe||(contact.fullJid=attr.jid),!isMe&&config.webrtcWithMobiles&&(contact.fullJid=attr.jid)),this.updateContactRichStatus(contact,isMe),isMe&&this.xmppService.isMobileResource(attr.jid)&&("offline"!==attr.status&&null===contact.mobileResource&&(contact.mobileResource=attr.jid,this.logger.info("[Contact] updateIMStatus: post event ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT"),this.eventService.publish("ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT","started")),"offline"===attr.status)){var otherMobileResource=null;for(var key in contact.resources)if(contact.resources.hasOwnProperty(key)&&this.xmppService.isMobileResource(key)){otherMobileResource=key;break}contact.mobileResource=otherMobileResource,null===contact.mobileResource&&this.eventService.publish("ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT","stopped")}}}},{key:"getContactLastActivityMessage",value:function(contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee19(){var _this29=this;return regenerator_default.a.wrap((function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:if(_context20.prev=0,!contact.lastActivityMessage){_context20.next=3;break}return _context20.abrupt("return");case 3:this.xmppService.connection.lastactivity.query(contact.jid,{onResponse:function(stanza){var inactivityInMSeconds=1e3*Number.parseInt($(stanza).find("query").attr("seconds"),10),dateInMSeconds=(new Date).getTime(),lastActivityDate=new Date(dateInMSeconds-inactivityInMSeconds);_this29.updateContactLastActivityDate(contact,lastActivityDate)}}),_context20.next=9;break;case 6:throw _context20.prev=6,_context20.t0=_context20.catch(0),new Error("[contactService] getInitialContactLastActivityMessage -- Failure -- "+_context20.t0.message);case 9:case"end":return _context20.stop()}}),_callee19,this,[[0,6]])})))}},{key:"updateContactsLastActivityMessage",value:function(){var _this30=this;this.contacts&&Object.keys(this.contacts).forEach((function(key){_this30.updateContactStatusMessage(_this30.contacts[key])}))}},{key:"updateLastActivity",value:function(contact){var lastActivityDate=null;"offline"!==contact.status&&"away"!==contact.status||Object.keys(contact.imStatusStamp).forEach((function(key){var stamp=contact.imStatusStamp[key];(!lastActivityDate||lastActivityDate<stamp)&&(lastActivityDate=stamp)})),this.updateContactLastActivityDate(contact,lastActivityDate)}},{key:"updateContactLastActivityDate",value:function(contact,lastActivityDate){contact.lastActivityDate=lastActivityDate,this.updateContactStatusMessage(contact)}},{key:"updateContactStatusMessage",value:function(contact){if(contact.lastActivityDate){var mdate=moment(contact.lastActivityDate);moment.locale().startsWith("de")?(contact.lastActivityMessage=mdate.fromNow(!0).replace("Tage","Tagen"),contact.lastActivityMessage=contact.lastActivityMessage.replace("eine Stunde","einer Stunde")):contact.lastActivityMessage=mdate.fromNow(!0)}else contact.lastActivityMessage="";if("unknown"===contact.status?contact.statusMessage=this.i18nService.translate("unknown"):"offline"===contact.status&&""===contact.lastActivityMessage?contact.statusMessage=this.i18nService.translate("offlineFilter"):"away"===contact.status&&""===contact.lastActivityMessage?contact.statusMessage=this.i18nService.translate("shortAway"):contact.statusMessage=this.i18nService.translate(contact.status,{offlineDate:contact.lastActivityMessage}),contact.message){var message=this.i18nService.translate(contact.message);"("!==message.charAt(0)&&(message="("+message+")"),contact.statusMessage+=" "+message}}},{key:"deleteUserAccount",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee20(){var url,response,errorInfo;return regenerator_default.a.wrap((function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return _context21.prev=0,this.logger.info("[contactService] deleteUserAccount"),url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userContact.dbId),_context21.next=5,fetch(url,{method:"DELETE",headers:this.authService.getRequestHeader()});case 5:if((response=_context21.sent).ok){_context21.next=8;break}throw response;case 8:return _context21.next=10,response.json();case 10:_context21.next=18;break;case 12:return _context21.prev=12,_context21.t0=_context21.catch(0),_context21.next=16,this.errorHelperService.getErrorInfo(_context21.t0,"deleteUserAccount");case 16:throw errorInfo=_context21.sent,this.logger.error(errorInfo.message),errorInfo.error;case 18:case"end":return _context21.stop()}}),_callee20,this,[[0,12]])})))}},{key:"removeContact",value:function(contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee21(){var url,response,errorInfo;return regenerator_default.a.wrap((function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:if(_context22.prev=0,contact&&contact.dbId){_context22.next=3;break}throw new Error("[contactService] removeContact : wrongContact");case 3:return url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/networks/").concat(contact.dbId),_context22.next=6,fetch(url,{method:"DELETE",headers:this.authService.getRequestHeader()});case 6:if((response=_context22.sent).ok){_context22.next=9;break}throw response;case 9:return _context22.next=11,response.json();case 11:this.logger.info("[contactService] removeContact ".concat(contact.dbId," -- SUCCESS")),_context22.next=20;break;case 14:return _context22.prev=14,_context22.t0=_context22.catch(0),_context22.next=18,this.errorHelperService.getErrorInfo(_context22.t0,"removeContact");case 18:throw errorInfo=_context22.sent,this.logger.error(errorInfo.message),errorInfo.error;case 20:case"end":return _context22.stop()}}),_callee21,this,[[0,14]])})))}},{key:"pushAvatarImage",value:function(avatarImg){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee22(){var oldImage,resizedImage,binaryData,url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return oldImage=this.userContact.avatar,_context23.prev=1,this.logger.info("[contactService] Push avatar image"),_context23.next=5,imageUtils_service_1.resizeImage(avatarImg,512,512);case 5:return resizedImage=_context23.sent,binaryData=imageUtils_service_1.getBinaryData(resizedImage),url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userContact.dbId,"/avatar"),headers=this.authService.getPostHeader("image/"+binaryData.type),_context23.next=11,fetch(url,{method:"POST",headers:headers,body:binaryData.data});case 11:if((response=_context23.sent).ok){_context23.next=14;break}throw response;case 14:return _context23.next=16,response.json();case 16:_context23.next=25;break;case 18:return _context23.prev=18,_context23.t0=_context23.catch(1),this.userContact.avatar=oldImage,_context23.next=23,this.errorHelperService.getErrorInfo(_context23.t0,"pushAvatarImage");case 23:throw errorInfo=_context23.sent,this.logger.error(errorInfo.message),errorInfo.error;case 25:case"end":return _context23.stop()}}),_callee22,this,[[1,18]])})))}},{key:"notifyImByEmail",value:function(contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee23(){var responseData,url,headers,response,mail,errorInfo;return regenerator_default.a.wrap((function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return responseData=null,_context24.prev=1,url=config.restServerUrl+"/api/rainbow/enduser/v1.0/notifications/emails/offline",headers=this.authService.getRequestHeader(),_context24.next=6,fetch(url,{method:"POST",headers:headers,body:JSON.stringify({userId:contact.dbId})});case 6:if((response=_context24.sent).ok){_context24.next=9;break}throw response;case 9:return _context24.next=11,response.json();case 11:responseData=_context24.sent,mail="",responseData.data&&responseData.data.email&&(mail=responseData.data.email.substr(0,3)+"***"+responseData.data.email.substr(-3)),this.logger.info("[contactService] notifyImByEmail "+mail+" - success"),_context24.next=22;break;case 16:return _context24.prev=16,_context24.t0=_context24.catch(1),_context24.next=20,this.errorHelperService.getErrorInfo(_context24.t0,"notifyImByEmail");case 20:throw errorInfo=_context24.sent,this.logger.error(errorInfo.message),errorInfo.error;case 22:case"end":return _context24.stop()}}),_callee23,this,[[1,16]])})))}},{key:"myMobileAvailable",value:function(){return this.userContact?this.userContact.mobileResource:null}},{key:"sendSubscribeInvitation",value:function(jid){return this.logger.info("[contactService] Send subscribe invitation to "+jid),this.xmppService.send($pres({to:jid,type:"subscribe"}))}},{key:"onPresentationModeChangedEvent",value:function(status){"active"===status?this.presentationModeActive=!0:"disable"===status&&(this.presentationModeActive=!1),null===this.lastUpdatePresentationMode&&(this.logger.debug("[contactService] onPresentationModeChangedEvent '".concat(status,"' request presence update")),this.lastUpdatePresentationMode=this.presentationModeActive,this.updatePresence()),this.startUpdatePresentationModeRefreshTimer()}},{key:"startUpdatePresentationModeRefreshTimer",value:function(){var _this31=this;this.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer"),null!==this.presentationModeTimeout&&(clearTimeout(this.presentationModeTimeout),this.presentationModeTimeout=null),this.presentationModeTimeout=setTimeout((function(){_this31.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval reach"),_this31.lastUpdatePresentationMode!==_this31.presentationModeActive?(_this31.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval - request presence update"),_this31.lastUpdatePresentationMode=_this31.presentationModeActive,_this31.updatePresence(),_this31.startUpdatePresentationModeRefreshTimer()):(_this31.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval - no presence update needed"),_this31.lastUpdatePresentationMode=null)}),1e3)}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.contactService||(win.rainbow.contactService=new ContactService),win.rainbow.contactService}}]),ContactService}();exports.ContactService=ContactService,exports.default=ContactService.getInstance()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var logger_service_1=__webpack_require__(15),settings_service_1=__webpack_require__(5),event_service_1=__webpack_require__(32),crypto_js_1=__webpack_require__(18),authSettings_model_1=__webpack_require__(300),jwtDecode=__webpack_require__(301),fetchWithTimeout_1=__webpack_require__(304),rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24);window.moduleIds.push("$$APP_PWD_PART1$$"),window.moduleIds.push("$$APP_PWD_PART2$$"),window.moduleIds.push("$$APP_PWD_PART3$$"),window.moduleIds.push("$$APP_PWD_PART4$$");var AuthService=function(){function AuthService(){_classCallCheck(this,AuthService),this.SSO_LOGIN_POPUP_WINDOW_NAME="Single Sign-On Login",this.token=null,this.appToken=null,this.login=null,this.userId=null,this.jidIm=null,this.jidTel=null,this.jidPwd=null,this.xmppDomain=null,this.companyId=null,this.firstUseNewVersion=!1,this.initialized=!1,this.isGuest=!1,this.authType="RAINBOW",this.fromSDK=!1,this.authSettings=null,this.browserFingerprint=null,this.visibilityHandlerRemoval=null,this.renewTokenInterval=null,this.renewAppTokenInterval=null,this.sdkHostForced=null,this.win=window,this.rxSubject=new rxjs_1.Subject;var storedVersion=localStorage.getItem("version"),storedMajorVersion=this.getMajorVersion(storedVersion),currentMajorVersion=this.getMajorVersion(this.win.version);config.appModuleKey||(config.appModuleKey=this.win.moduleIds?this.win.moduleIds.join(""):"default"),storedMajorVersion!==currentMajorVersion&&(this.firstUseNewVersion=!0),localStorage.setItem("version",this.win.version),this.getServerApiUrls()}return _createClass(AuthService,[{key:"subscribe",value:function(handler){return this.rxSubject.subscribe(handler)}},{key:"emitEvent",value:function(eventName){this.rxSubject.next(event_model_1.RBEvent.create(eventName))}},{key:"logon",value:function(login,password,rememberMe){var authSettings=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee24(){var url,headers,clientKey,response,responseData,errorMessage,errorStatus,errorCode,errorData,_responseData;return regenerator_default.a.wrap((function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if(_context25.prev=0,-1!==login.indexOf("@")){_context25.next=3;break}throw this.createError("Wrong login format '".concat(login,"'"),"errorUnauthorized",401500,void 0,!0);case 3:return url=config.restServerUrl+"/api/rainbow/authentication/v1.0/login",authSettings&&("RAINBOW"===authSettings.type?url=authSettings.loginUrl:authSettings.safetyUrl&&(url=authSettings.safetyUrl,this.authType=authSettings.type)),(headers={}).Authorization="Basic "+window.btoa(unescape(encodeURIComponent(login+":"+password))),headers.Accept="application/json",this.setInformationHeaders(headers),clientKey=null,config.rainbowApiClientKey&&(clientKey=config.rainbowApiClientKey+":"+crypto_js_1.SHA256(config.appModuleKey+password)),this.fromSDK&&this.appToken&&this.appToken.appID&&(clientKey=this.appToken.appID+":"+crypto_js_1.SHA256(this.appToken.appSecret+password)),clientKey&&(headers["x-rainbow-app-auth"]="Basic "+window.btoa(unescape(encodeURIComponent(clientKey)))),_context25.next=11,fetchWithTimeout_1.default(url,{method:"GET",headers:headers,credentials:"include"});case 11:if((response=_context25.sent).ok){_context25.next=14;break}throw response;case 14:return _context25.next=16,response.json();case 16:responseData=_context25.sent,this.token=responseData.token,this.extractUserInfo(responseData.loggedInUser),rememberMe?(logger_service_1.default.info("[AuthService] Store authentication info in local storage"),localStorage.setItem("login",this.login),localStorage.setItem("id",this.userId),localStorage.setItem("token",this.token),localStorage.setItem("authType",this.authType)):this.removeCredentials(),localStorage.setItem("firstUse","false"),logger_service_1.default.info("[AuthService] Authenticate with ".concat(login," -- SUCCESS")),this.registerEventsHandler(),this.startTokenSurvey(),_context25.next=35;break;case 20:if(_context25.prev=20,_context25.t0=_context25.catch(0),errorMessage="authenticate for login ".concat(login," -- FAILURE -- "),!_context25.t0.localError){_context25.next=25;break}throw logger_service_1.default.error("[AuthService] ".concat(errorMessage," ").concat(_context25.t0)),_context25.t0;case 25:if(errorStatus="errorUltimateUnknownError",errorCode=null,errorData=null,0!==_context25.t0.status&&-1!==_context25.t0.status){_context25.next=30;break}errorMessage+="No server response",errorStatus="errorNoServerResponse",_context25.next=34;break;case 30:return _context25.next=32,_context25.t0.json();case 32:_responseData=_context25.sent,401===_context25.t0.status?(this.removeCredentials(),errorMessage+=_responseData.errorDetails,errorCode=_responseData.errorDetailsCode,401500===_responseData.errorDetailsCode?errorStatus="errorUnauthorized":401501===_responseData.errorDetailsCode&&(errorStatus="errorLoginForbidden",_responseData.errorDetailsData&&(errorData={delay:_responseData.errorDetailsData.forbiddenDelay}))):500===_context25.t0.status&&(errorMessage+=_responseData.errorDetails,errorStatus="errorInternalServerError");case 34:throw logger_service_1.default.error("[AuthService] "+errorMessage),this.createError(errorMessage,errorStatus,errorCode,errorData);case 35:case"end":return _context25.stop()}}),_callee24,this,[[0,20]])})))}},{key:"logonWithToken",value:function(){var token=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee25(){var decodedToken,errorMessage;return regenerator_default.a.wrap((function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:if(_context26.prev=0,logger_service_1.default.info("[authService] logonWithToken -- "+token),token||(token=localStorage.getItem("token")),token){_context26.next=3;break}throw new Error("No token");case 3:return decodedToken=jwtDecode(token),this.token=token,this.login=decodedToken.user.loginEmail,this.userId=decodedToken.user.id,this.authType="RAINBOW",decodedToken.saml&&(this.authType="SAML"),decodedToken.oidc&&(this.authType="OIDC"),localStorage.setItem("token",this.token),localStorage.setItem("login",this.login),localStorage.setItem("id",this.userId),localStorage.setItem("authType",this.authType),_context26.next=16,this.getUserData();case 16:return _context26.next=18,this.startTokenSurvey();case 18:return _context26.next=20,this.getUserAuthenticationSettings(this.login);case 20:this.authSettings=_context26.sent,this.registerEventsHandler(),_context26.next=28;break;case 24:throw _context26.prev=24,_context26.t0=_context26.catch(0),"No token"===(errorMessage=_context26.t0?_context26.t0.message:"Unknown error")?logger_service_1.default.debug("[AuthService] AuthenticateWithToken -- No available token"):logger_service_1.default.error("[AuthService] AuthenticateWithToken -- FAILURE -- "+errorMessage),new Error(errorMessage);case 28:case"end":return _context26.stop()}}),_callee25,this,[[0,24]])})))}},{key:"sdkLogOn",value:function(login,password,host,appToken,token){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee26(){return regenerator_default.a.wrap((function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return _context27.abrupt("return",(this.sdkHostForced=host,this.appToken=appToken,this.fromSDK=!0,this.getServerApiUrls(),token?this.logonWithToken(token):this.logon(login,password,!1)));case 1:case"end":return _context27.stop()}}),_callee26,this)})))}},{key:"logout",value:function(){var _this32=this;return this.removeCredentials(),this.authSettings&&this.authSettings.logoutUrl&&"RAINBOW"!==this.authType?(logger_service_1.default.info("[authService] Logout -- "+this.authType),this.authSettings.setParameter("token",(function(){return _this32.token})),this.authSettings.logoutUrl):(logger_service_1.default.info("[AuthService] Logout -- SUCCESS"),null)}},{key:"getUserAuthenticationSettings",value:function(){var login=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,inAppAuth=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee27(){var defaultLoginUrl,url,headers,response,responseData,authSettings,errorMessage,errorStatus,_responseData2,newError,_this33=this;return regenerator_default.a.wrap((function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:if(_context28.prev=0,defaultLoginUrl=config.restServerUrl+"/api/rainbow/authentication/v1.0/login",config.disableSSO&&(inAppAuth=!0),!inAppAuth){_context28.next=4;break}return _context28.abrupt("return",authSettings_model_1.AuthSettings.createFromData([{type:"RAINBOW",loginUrl:defaultLoginUrl}]));case 4:return url="".concat(config.restServerUrl,"/api/rainbow/authentication/v1.0/urls?uid=").concat(encodeURIComponent(login)),headers={},this.setInformationHeaders(headers),_context28.next=8,fetchWithTimeout_1.default(url,{method:"GET",headers:headers});case 8:if((response=_context28.sent).ok){_context28.next=11;break}throw response;case 11:return _context28.next=13,response.json();case 13:return responseData=_context28.sent,authSettings=authSettings_model_1.AuthSettings.createFromData(responseData.data),_context28.abrupt("return",(authSettings.setParameter("uid",(function(){return login})),authSettings.setParameter("x-rainbow-app-auth",(function(challenge){return _this33.getRainbowAppAuth(config.rainbowApiClientKey,config.appModuleKey,challenge)})),!window||-1===window.location.href.indexOf("localhost")&&-1===window.location.href.indexOf("openrainbow.red")||authSettings.setParameter("safetyUrl",(function(){return defaultLoginUrl})),authSettings));case 18:if(_context28.prev=18,_context28.t0=_context28.catch(0),errorMessage='authenticate for login "'+login+'" failure : ',errorStatus="errorUltimateUnknownError",0!==_context28.t0.status&&-1!==_context28.t0.status){_context28.next=25;break}errorMessage+="No server response",errorStatus="errorNoServerResponse",_context28.next=29;break;case 25:return _context28.next=27,_context28.t0.json();case 27:_responseData2=_context28.sent,400===_context28.t0.status||404===_context28.t0.status?(errorMessage+=_responseData2.errorDetails,errorStatus="noMatchingAccount"):500===_context28.t0.status&&(errorMessage+=_responseData2.errorDetails,errorStatus="errorInternalServerError");case 29:throw logger_service_1.default.info("[authService] "+errorMessage),(newError=new Error(errorMessage)).details=errorStatus,newError;case 32:case"end":return _context28.stop()}}),_callee27,this,[[0,18]])})))}},{key:"removeCredentials",value:function(){this.authType="RAINBOW",localStorage.removeItem("id"),localStorage.removeItem("token"),localStorage.removeItem("authType"),localStorage.removeItem("token"),this.isGuest&&(localStorage.removeItem("login"),this.isGuest=!1),this.resetUserEnvironment(),logger_service_1.default.debug("[AuthService] removeCredentials -- SUCCESS")}},{key:"resetUserEnvironment",value:function(){config.defaultEnvironment&&(config.xmpp.currentServer=config.defaultEnvironment,config.xmpp.server=config.defaultEnvironment,config.webservices.currentServer=config.defaultEnvironment,config.webservices.server=config.defaultEnvironment)}},{key:"getRequestHeader",value:function(accept){return{Authorization:"Bearer "+this.token,Accept:accept||"application/json"}}},{key:"getRequestHeaderWithRange",value:function(range){var header=this.getRequestHeader();return header.Range=range,header}},{key:"getPostHeader",value:function(){var contentType=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,accept=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,header=this.getRequestHeader(accept);return header["Content-Type"]=contentType||"application/json",header}},{key:"getPostHeaderWithRange",value:function(range,contentType){var header=this.getPostHeader(contentType);return header["Content-Range"]=range,header}},{key:"setInformationHeaders",value:function(headers){headers["x-rainbow-client"]=this.getInformationHeadersApp(),headers["x-rainbow-client-version"]=this.getInformationHeadersAppVersion()}},{key:"getInformationHeadersApp",value:function(){return"web_sdk"}},{key:"getInformationHeadersAppVersion",value:function(){var winAsAny=window;return winAsAny.sdkversion?winAsAny.sdkversion:"9.9.99"}},{key:"startTokenSurvey",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee28(){var newError;return regenerator_default.a.wrap((function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:return _context29.prev=0,_context29.next=3,this.startAppTokenSurvey();case 3:return _context29.next=5,this.startUserTokenSurvey();case 5:logger_service_1.default.debug("[AuthService] StartTokenSurvey -- SUCCESS"),_context29.next=12;break;case 8:throw _context29.prev=8,_context29.t0=_context29.catch(0),newError=_context29.t0&&_context29.t0.message?_context29.t0:new Error("Unknown error"),logger_service_1.default.error("[AuthService] StartTokenSurvey -- FAILURE -- "+newError.message),newError;case 12:case"end":return _context29.stop()}}),_callee28,this,[[0,8]])})))}},{key:"getRainbowAppAuth",value:function(appId,appSecret){var password=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return window.btoa(unescape(encodeURIComponent((appId||"")+":"+crypto_js_1.SHA256((appSecret||"")+(password||"")))))}},{key:"registerEventsHandler",value:function(){var _this34=this;this.visibilityHandlerRemoval&&this.visibilityHandlerRemoval(),this.visibilityHandlerRemoval=event_service_1.default.subscribe("ON_APP_VISIBLE_CHANGE_EVENT",(function(__event,visible){visible&&_this34.startTokenSurvey()}))}},{key:"getMajorVersion",value:function(appVersion){if(!appVersion)return null;var result=/\d+\.\d+/g.exec(appVersion);return result&&result.length>0?result[0]:null}},{key:"getServerApiUrls",value:function(){var server=localStorage.getItem("server");server&&"null"!==server&&"undefined"!==server?(logger_service_1.default.debug("[AuthService] getServerApiUrls -- Find server data from local storage -- "+server),config.xmpp.currentServer=config.webservices.currentServer=server,"openrainbow.net"===server&&(config.appModuleKey=config.dotNetAppModuleKey,config.rainbowApiClientKey=config.dotNetRainbowApiClientKey,config.multiEnvServer="openrainbow.net"),"openrainbow.com"===server&&(config.appModuleKey=config.dotComAppModuleKey,config.rainbowApiClientKey=config.dotComRainbowApiClientKey,config.multiEnvServer="openrainbow.com"),"openrainbow.red"===server&&(config.appModuleKey=config.dotComAppModuleKey,config.rainbowApiClientKey=config.dotComRainbowApiClientKey,config.multiEnvServer="openrainbow.com"),config.defaultEnvironment||(config.defaultEnvironment=config.xmpp.currentServer)):this.sdkHostForced?(config.xmpp.currentServer=config.webservices.currentServer=this.sdkHostForced,logger_service_1.default.debug("[AuthService] getServerApiUrls -- Use forced sdk server -- "+this.sdkHostForced)):config.xmpp&&(config.xmpp.currentServer=config.xmpp.server,config.webservices.currentServer=config.webservices.server,logger_service_1.default.debug("[AuthService] getServerApiUrls -- Use default config server -- "+config.xmpp.server)),config.webservices&&(config.restServerUrl="".concat(config.webservices.protocol,"://").concat(config.webservices.currentServer,":").concat(config.webservices.port))}},{key:"startAppTokenSurvey",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee29(){var decodedToken,tokenExpirationTimestamp,expirationDate,tokenExpirationDuration,usedExpirationDuration,_this35=this;return regenerator_default.a.wrap((function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:if(this.appToken&&"string"==typeof this.appToken&&this.appToken.length){_context30.next=2;break}return _context30.abrupt("return",void logger_service_1.default.info("[AuthService] startAppTokenSurvey -- No application token."));case 2:if(decodedToken=jwtDecode(this.appToken),tokenExpirationTimestamp=1e3*decodedToken.exp,expirationDate=new Date(tokenExpirationTimestamp),tokenExpirationDuration=tokenExpirationTimestamp-(new Date).valueOf(),this.renewAppTokenInterval&&clearTimeout(this.renewAppTokenInterval),logger_service_1.default.info("[AuthService] startAppTokenSurvey -- Extract application token info (countRenewed: "+decodedToken.countRenewed+", maxTokenRenew: "+decodedToken.maxTokenRenew+")"),!(tokenExpirationDuration<0)){_context30.next=8;break}return logger_service_1.default.info("[AuthService] startAppTokenSurvey -- Application token has already expired, re-new it immediately"),_context30.next=7,this.renewAppToken();case 7:return _context30.abrupt("return",void _context30.sent);case 8:if(!(tokenExpirationDuration<3e4)){_context30.next=13;break}return logger_service_1.default.info("[AuthService] startAppTokenSurvey -- Application token will expire in less 5 minutes, re-new it immediately"),_context30.next=12,this.renewAppToken();case 12:return _context30.abrupt("return",void _context30.sent);case 13:usedExpirationDuration=tokenExpirationDuration-24e3,logger_service_1.default.info("[authService] startAppTokenSurvey -- Start application token survey (expirationDate: "+expirationDate+" tokenExpirationDuration: "+tokenExpirationDuration+"ms usedExpirationDuration: "+usedExpirationDuration+"ms)"),this.renewAppTokenInterval=setTimeout((function(){_this35.renewAppToken()}),usedExpirationDuration);case 15:case"end":return _context30.stop()}}),_callee29,this)})))}},{key:"renewAppToken",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee30(){var url,response,responseData,_responseData3,errorMessage,newError;return regenerator_default.a.wrap((function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:return _context31.prev=0,url=config.restServerUrl+"/api/rainbow/applications/v1.0/authentication/renew",_context31.next=4,fetchWithTimeout_1.default(url,{method:"GET",headers:this.getRequestHeader()});case 4:if((response=_context31.sent).ok){_context31.next=7;break}throw response;case 7:return _context31.next=9,response.json();case 9:responseData=_context31.sent,logger_service_1.default.info("[AuthService] renewAppToken -- Renew application token success"),this.appToken=responseData.token,localStorage.setItem("appToken",this.appToken),this.emitEvent("ON_APP_TOKEN_RENEW"),this.startAppTokenSurvey(),_context31.next=22;break;case 13:return _context31.prev=13,_context31.t0=_context31.catch(0),this.renewAppTokenInterval&&clearTimeout(this.renewAppTokenInterval),_context31.next=18,_context31.t0.json();case 18:throw _responseData3=_context31.sent,errorMessage="Renew application token failure -- "+(_responseData3&&_responseData3.errorDetails?_responseData3.errorDetails:"no details"),(newError=new Error(errorMessage)).details="APP_TOKEN_EXPIRED",logger_service_1.default.error("[AuthService] renewAppToken -- FAILURE --"+errorMessage),this.emitEvent("ON_APP_TOKEN_EXPIRE"),newError;case 22:case"end":return _context31.stop()}}),_callee30,this,[[0,13]])})))}},{key:"startUserTokenSurvey",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee31(){var decodedToken,tokenExpirationTimestamp,halfTokenDuration,expirationDate,tokenExpirationDuration,usedExpirationDuration,_this36=this;return regenerator_default.a.wrap((function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:if(this.token&&"string"==typeof this.token&&this.token.length){_context32.next=2;break}return _context32.abrupt("return",void logger_service_1.default.info("[AuthService] No token."));case 2:if(decodedToken=jwtDecode(this.token),tokenExpirationTimestamp=1e3*decodedToken.exp,halfTokenDuration=(tokenExpirationTimestamp-1e3*decodedToken.iat)/2,expirationDate=new Date(tokenExpirationTimestamp),tokenExpirationDuration=tokenExpirationTimestamp-(new Date).valueOf(),this.renewTokenInterval&&clearTimeout(this.renewTokenInterval),logger_service_1.default.info("[AuthService] startUserTokenSurvey -- Extract auth token info (countRenewed: "+decodedToken.countRenewed+", maxTokenRenew: "+decodedToken.maxTokenRenew+", tokenExpirationDuration: "+tokenExpirationDuration+")"),!(tokenExpirationDuration<0)){_context32.next=5;break}throw logger_service_1.default.info("[AuthService] startUserTokenSurvey --  Auth token has already expired, display login page"),this.token=null,this.emitEvent("ON_AUTH_TOKEN_EXPIRE"),new Error("Token expired");case 5:if(!(tokenExpirationDuration<halfTokenDuration)){_context32.next=10;break}return logger_service_1.default.info("[AuthService] startUserTokenSurvey -- Auth token will expire in less "+halfTokenDuration/1e3+" seconds, re-new it immediately"),_context32.next=9,this.renewAuthToken();case 9:return _context32.abrupt("return",void _context32.sent);case 10:usedExpirationDuration=tokenExpirationDuration-halfTokenDuration,logger_service_1.default.info("[AuthService] startUserTokenSurvey -- Start auth token survey (expirationDate: "+expirationDate+" tokenExpirationDuration: "+tokenExpirationDuration+"ms usedExpirationDuration: "+usedExpirationDuration+"ms)"),this.renewTokenInterval=setTimeout((function(){_this36.renewAuthToken()}),usedExpirationDuration);case 12:case"end":return _context32.stop()}}),_callee31,this)})))}},{key:"renewAuthToken",value:function(){var restartTokenSurvey=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee32(){var url,response,responseData,_responseData4,errorMessage,newError;return regenerator_default.a.wrap((function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:return _context33.prev=0,url=config.restServerUrl+"/api/rainbow/authentication/v1.0/renew",_context33.next=4,fetchWithTimeout_1.default(url,{method:"GET",headers:this.getRequestHeader()});case 4:if((response=_context33.sent).ok){_context33.next=7;break}throw response;case 7:return _context33.next=9,response.json();case 9:responseData=_context33.sent,logger_service_1.default.info("[AuthService] renewAuthToken -- Renew authentication token success"),this.token=responseData.token,localStorage.setItem("token",this.token),this.emitEvent("ON_AUTH_TOKEN_RENEW"),restartTokenSurvey&&!0!==restartTokenSurvey||this.startTokenSurvey(),_context33.next=22;break;case 13:return _context33.prev=13,_context33.t0=_context33.catch(0),this.renewTokenInterval&&clearTimeout(this.renewTokenInterval),_context33.next=18,_context33.t0.json();case 18:throw _responseData4=_context33.sent,errorMessage="Renew authentication token failure -- "+(_responseData4&&_responseData4.errorDetails?_responseData4.errorDetails:"no details"),(newError=new Error(errorMessage)).details="AUTH_TOKEN_EXPIRED",logger_service_1.default.error("[AuthService] renewAuthToken -- FAILURE -- "+errorMessage),this.emitEvent("ON_AUTH_TOKEN_EXPIRE"),newError;case 22:case"end":return _context33.stop()}}),_callee32,this,[[0,13]])})))}},{key:"getUserData",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee33(){var url,response,responseData;return regenerator_default.a.wrap((function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:return _context34.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.userId),_context34.next=4,fetchWithTimeout_1.default(url,{method:"GET",headers:this.getRequestHeader()});case 4:if((response=_context34.sent).ok){_context34.next=7;break}throw response;case 7:return _context34.next=9,response.json();case 9:responseData=_context34.sent,this.extractUserInfo(responseData.data),_context34.next=18;break;case 13:if(_context34.prev=13,_context34.t0=_context34.catch(0),this.removeCredentials(),!(_context34.t0 instanceof Response)){_context34.next=17;break}throw new Error("Wrong token -- "+_context34.t0.statusText);case 17:throw new Error("Wrong token -- "+_context34.t0.message);case 18:case"end":return _context34.stop()}}),_callee33,this,[[0,13]])})))}},{key:"getUserEnvironments",value:function(login){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee34(){var url,response,errorMessage;return regenerator_default.a.wrap((function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:if(_context35.prev=0,config.multiEnvServer){_context35.next=3;break}return _context35.abrupt("return",[{environmentApiUrl:"https://"+config.xmpp.currentServer}]);case 3:return config.defaultEnvironment||(config.defaultEnvironment=config.xmpp.server),url=config.webservices.protocol+"://"+config.multiEnvServer+":"+config.webservices.port+"/api/rainbow/multienvironments/v1.0/environments?loginEmail="+encodeURIComponent(login),_context35.next=7,fetchWithTimeout_1.default(url,{method:"GET"});case 7:if((response=_context35.sent).ok){_context35.next=10;break}throw response;case 10:return _context35.next=12,response.json();case 12:return _context35.abrupt("return",_context35.sent.data);case 15:if(_context35.prev=15,_context35.t0=_context35.catch(0),errorMessage='getUserEnvironments for login "'+login+'" failure : ',0!==_context35.t0.status&&-1!==_context35.t0.status){_context35.next=22;break}errorMessage+="No server response",_context35.next=27;break;case 22:if(500!==_context35.t0.status){_context35.next=27;break}return _context35.t1=errorMessage,_context35.next=26,_context35.t0.json();case 26:errorMessage=_context35.t1+=_context35.sent.errorDetails;case 27:return _context35.abrupt("return",(logger_service_1.default.info("[authService] "+errorMessage),logger_service_1.default.info("[authService] getUserEnvironment -- continue with default environment"),null));case 28:case"end":return _context35.stop()}}),_callee34,null,[[0,15]])})))}},{key:"getCompanySAMLConfiguration",value:function(companyId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee35(){var url,response;return regenerator_default.a.wrap((function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:return _context36.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/authentication/v1.0/saml/").concat(companyId,"/metadata.xml"),_context36.next=4,fetchWithTimeout_1.default(url,{method:"GET",headers:this.getRequestHeader()});case 4:if((response=_context36.sent).ok){_context36.next=7;break}throw response;case 7:return logger_service_1.default.debug("[AuthService] getCompanySAMLConfiguration -- SUCCESS"),_context36.next=10,response.text();case 10:return _context36.abrupt("return",_context36.sent);case 13:throw _context36.prev=13,_context36.t0=_context36.catch(0),logger_service_1.default.error("[AuthService] getCompanySAMLConfiguration -- FAILURE -- "+JSON.stringify(_context36.t0)),new Error("getCompanySAMLConfiguration failure");case 16:case"end":return _context36.stop()}}),_callee35,this,[[0,13]])})))}},{key:"getFingerPrint",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee36(){var browserTests;return regenerator_default.a.wrap((function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:if(this.browserFingerprint){_context37.next=5;break}return browserTests=["audio","availableScreenResolution","canvas","colorDepth","cookies","cpuClass","deviceDpi","doNotTrack","indexedDb","installedFonts","language","localStorage","pixelRatio","platform","plugins","processorCores","screenResolution","sessionStorage","timezoneOffset","touchSupport","userAgent","webGl"],_context37.next=4,imprint.test(browserTests);case 4:this.browserFingerprint=_context37.sent;case 5:return _context37.abrupt("return",this.browserFingerprint);case 6:case"end":return _context37.stop()}}),_callee36,this)})))}},{key:"handleUserLanguage",value:function(){var userServerLanguage=this.loggedInUser.language;userServerLanguage&&settings_service_1.default.setAppliLangageCodeFromServer(userServerLanguage)}},{key:"createError",value:function(message){var details=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,detailsCode=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,detailsData=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,localError=arguments.length>4&&void 0!==arguments[4]&&arguments[4],error=new Error(message);return error.details=details,error.detailsCode=detailsCode,error.detailsData=detailsData,error.localError=localError,error}},{key:"extractUserInfo",value:function(responseData){this.loggedInUser=responseData,this.login=this.loggedInUser.loginEmail,this.userId=this.loggedInUser.id,this.jidIm=this.loggedInUser.jid_im,this.jidPwd=this.loggedInUser.jid_password,this.jidTel=this.loggedInUser.jid_tel,this.initialized=this.loggedInUser.isInitialized,this.isGuest=this.loggedInUser.guestMode,this.companyId=this.loggedInUser.companyId,this.xmppDomain=this.jidIm.split("@")[1],this.handleUserLanguage()}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.authService||(win.rainbow.authService=new AuthService),win.rainbow.authService}}]),AuthService}();exports.AuthService=AuthService,exports.default=AuthService.getInstance()},function(module,exports,__webpack_require__){(function(module){module.exports=function(){var hookCallback,some;function hooks(){return hookCallback.apply(null,arguments)}function isArray(input){return input instanceof Array||"[object Array]"===Object.prototype.toString.call(input)}function isObject(input){return null!=input&&"[object Object]"===Object.prototype.toString.call(input)}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function isObjectEmpty(obj){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(obj).length;var k;for(k in obj)if(hasOwnProp(obj,k))return!1;return!0}function isUndefined(input){return void 0===input}function isNumber(input){return"number"==typeof input||"[object Number]"===Object.prototype.toString.call(input)}function isDate(input){return input instanceof Date||"[object Date]"===Object.prototype.toString.call(input)}function map(arr,fn){var i,res=[];for(i=0;i<arr.length;++i)res.push(fn(arr[i],i));return res}function extend(a,b){for(var i in b)hasOwnProp(b,i)&&(a[i]=b[i]);return hasOwnProp(b,"toString")&&(a.toString=b.toString),hasOwnProp(b,"valueOf")&&(a.valueOf=b.valueOf),a}function createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,!0).utc()}function getParsingFlags(m){return null==m._pf&&(m._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),m._pf}function isValid(m){if(null==m._isValid){var flags=getParsingFlags(m),parsedParts=some.call(flags.parsedDateParts,(function(i){return null!=i})),isNowValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidEra&&!flags.invalidMonth&&!flags.invalidWeekday&&!flags.weekdayMismatch&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated&&(!flags.meridiem||flags.meridiem&&parsedParts);if(m._strict&&(isNowValid=isNowValid&&0===flags.charsLeftOver&&0===flags.unusedTokens.length&&void 0===flags.bigHour),null!=Object.isFrozen&&Object.isFrozen(m))return isNowValid;m._isValid=isNowValid}return m._isValid}function createInvalid(flags){var m=createUTC(NaN);return null!=flags?extend(getParsingFlags(m),flags):getParsingFlags(m).userInvalidated=!0,m}some=Array.prototype.some?Array.prototype.some:function(fun){var i,t=Object(this),len=t.length>>>0;for(i=0;i<len;i++)if(i in t&&fun.call(this,t[i],i,t))return!0;return!1};var momentProperties=hooks.momentProperties=[],updateInProgress=!1;function copyConfig(to,from){var i,prop,val;if(isUndefined(from._isAMomentObject)||(to._isAMomentObject=from._isAMomentObject),isUndefined(from._i)||(to._i=from._i),isUndefined(from._f)||(to._f=from._f),isUndefined(from._l)||(to._l=from._l),isUndefined(from._strict)||(to._strict=from._strict),isUndefined(from._tzm)||(to._tzm=from._tzm),isUndefined(from._isUTC)||(to._isUTC=from._isUTC),isUndefined(from._offset)||(to._offset=from._offset),isUndefined(from._pf)||(to._pf=getParsingFlags(from)),isUndefined(from._locale)||(to._locale=from._locale),momentProperties.length>0)for(i=0;i<momentProperties.length;i++)isUndefined(val=from[prop=momentProperties[i]])||(to[prop]=val);return to}function Moment(config){copyConfig(this,config),this._d=new Date(null!=config._d?config._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===updateInProgress&&(updateInProgress=!0,hooks.updateOffset(this),updateInProgress=!1)}function isMoment(obj){return obj instanceof Moment||null!=obj&&null!=obj._isAMomentObject}function warn(msg){!1===hooks.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+msg)}function deprecate(msg,fn){var firstTime=!0;return extend((function(){if(null!=hooks.deprecationHandler&&hooks.deprecationHandler(null,msg),firstTime){var arg,i,key,args=[];for(i=0;i<arguments.length;i++){if(arg="","object"==typeof arguments[i]){for(key in arg+="\n["+i+"] ",arguments[0])hasOwnProp(arguments[0],key)&&(arg+=key+": "+arguments[0][key]+", ");arg=arg.slice(0,-2)}else arg=arguments[i];args.push(arg)}warn(msg+"\nArguments: "+Array.prototype.slice.call(args).join("")+"\n"+(new Error).stack),firstTime=!1}return fn.apply(this,arguments)}),fn)}var keys,deprecations={};function deprecateSimple(name,msg){null!=hooks.deprecationHandler&&hooks.deprecationHandler(name,msg),deprecations[name]||(warn(msg),deprecations[name]=!0)}function isFunction(input){return"undefined"!=typeof Function&&input instanceof Function||"[object Function]"===Object.prototype.toString.call(input)}function mergeConfigs(parentConfig,childConfig){var prop,res=extend({},parentConfig);for(prop in childConfig)hasOwnProp(childConfig,prop)&&(isObject(parentConfig[prop])&&isObject(childConfig[prop])?(res[prop]={},extend(res[prop],parentConfig[prop]),extend(res[prop],childConfig[prop])):null!=childConfig[prop]?res[prop]=childConfig[prop]:delete res[prop]);for(prop in parentConfig)hasOwnProp(parentConfig,prop)&&!hasOwnProp(childConfig,prop)&&isObject(parentConfig[prop])&&(res[prop]=extend({},res[prop]));return res}function Locale(config){null!=config&&this.set(config)}function zeroFill(number,targetLength,forceSign){var absNumber=""+Math.abs(number),zerosToFill=targetLength-absNumber.length;return(number>=0?forceSign?"+":"":"-")+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}hooks.suppressDeprecationWarnings=!1,hooks.deprecationHandler=null,keys=Object.keys?Object.keys:function(obj){var i,res=[];for(i in obj)hasOwnProp(obj,i)&&res.push(i);return res};var formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,formatFunctions={},formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;"string"==typeof callback&&(func=function(){return this[callback]()}),token&&(formatTokenFunctions[token]=func),padded&&(formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}),ordinal&&(formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)})}function formatMoment(m,format){return m.isValid()?(format=expandFormat(format,m.localeData()),formatFunctions[format]=formatFunctions[format]||function(format){var i,length,input,array=format.match(formattingTokens);for(i=0,length=array.length;i<length;i++)formatTokenFunctions[array[i]]?array[i]=formatTokenFunctions[array[i]]:array[i]=(input=array[i]).match(/\[[\s\S]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"");return function(mom){var i,output="";for(i=0;i<length;i++)output+=isFunction(array[i])?array[i].call(mom,format):array[i];return output}}(format),formatFunctions[format](m)):m.localeData().invalidDate()}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}for(localFormattingTokens.lastIndex=0;i>=0&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,replaceLongDateFormatTokens),localFormattingTokens.lastIndex=0,i-=1;return format}var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return"string"==typeof units?aliases[units]||aliases[units.toLowerCase()]:void 0}function normalizeObjectUnits(inputObject){var normalizedProp,prop,normalizedInput={};for(prop in inputObject)hasOwnProp(inputObject,prop)&&(normalizedProp=normalizeUnits(prop))&&(normalizedInput[normalizedProp]=inputObject[prop]);return normalizedInput}var priorities={};function addUnitPriority(unit,priority){priorities[unit]=priority}function isLeapYear(year){return year%4==0&&year%100!=0||year%400==0}function absFloor(number){return number<0?Math.ceil(number)||0:Math.floor(number)}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;return 0!==coercedNumber&&isFinite(coercedNumber)&&(value=absFloor(coercedNumber)),value}function makeGetSet(unit,keepTime){return function(value){return null!=value?(set$1(this,unit,value),hooks.updateOffset(this,keepTime),this):get(this,unit)}}function get(mom,unit){return mom.isValid()?mom._d["get"+(mom._isUTC?"UTC":"")+unit]():NaN}function set$1(mom,unit,value){mom.isValid()&&!isNaN(value)&&("FullYear"===unit&&isLeapYear(mom.year())&&1===mom.month()&&29===mom.date()?(value=toInt(value),mom._d["set"+(mom._isUTC?"UTC":"")+unit](value,mom.month(),daysInMonth(value,mom.month()))):mom._d["set"+(mom._isUTC?"UTC":"")+unit](value))}var regexes,match1=/\d/,match2=/\d\d/,match3=/\d{3}/,match4=/\d{4}/,match6=/[+-]?\d{6}/,match1to2=/\d\d?/,match3to4=/\d\d\d\d?/,match5to6=/\d\d\d\d\d\d?/,match1to3=/\d{1,3}/,match1to4=/\d{1,4}/,match1to6=/[+-]?\d{1,6}/,matchUnsigned=/\d+/,matchSigned=/[+-]?\d+/,matchOffset=/Z|[+-]\d\d:?\d\d/gi,matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi,matchWord=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict,localeData){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){return hasOwnProp(regexes,token)?regexes[token](config._strict,config._locale):new RegExp(regexEscape(token.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}))))}function regexEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}regexes={};var indexOf,tokens={};function addParseToken(token,callback){var i,func=callback;for("string"==typeof token&&(token=[token]),isNumber(callback)&&(func=function(input,array){array[callback]=toInt(input)}),i=0;i<token.length;i++)tokens[token[i]]=func}function addWeekParseToken(token,callback){addParseToken(token,(function(input,array,config,token){config._w=config._w||{},callback(input,config._w,config,token)}))}function addTimeToArrayFromToken(token,input,config){null!=input&&hasOwnProp(tokens,token)&&tokens[token](input,config._a,config,token)}function daysInMonth(year,month){if(isNaN(year)||isNaN(month))return NaN;var modMonth=(month%12+12)%12;return year+=(month-modMonth)/12,1===modMonth?isLeapYear(year)?29:28:31-modMonth%7%2}indexOf=Array.prototype.indexOf?Array.prototype.indexOf:function(o){var i;for(i=0;i<this.length;++i)if(this[i]===o)return i;return-1},addFormatToken("M",["MM",2],"Mo",(function(){return this.month()+1})),addFormatToken("MMM",0,0,(function(format){return this.localeData().monthsShort(this,format)})),addFormatToken("MMMM",0,0,(function(format){return this.localeData().months(this,format)})),addUnitAlias("month","M"),addUnitPriority("month",8),addRegexToken("M",match1to2),addRegexToken("MM",match1to2,match2),addRegexToken("MMM",(function(isStrict,locale){return locale.monthsShortRegex(isStrict)})),addRegexToken("MMMM",(function(isStrict,locale){return locale.monthsRegex(isStrict)})),addParseToken(["M","MM"],(function(input,array){array[1]=toInt(input)-1})),addParseToken(["MMM","MMMM"],(function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);null!=month?array[1]=month:getParsingFlags(config).invalidMonth=input}));var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,defaultMonthsShortRegex=matchWord,defaultMonthsRegex=matchWord;function handleStrictParse(monthName,format,strict){var i,ii,mom,llc=monthName.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],i=0;i<12;++i)mom=createUTC([2e3,i]),this._shortMonthsParse[i]=this.monthsShort(mom,"").toLocaleLowerCase(),this._longMonthsParse[i]=this.months(mom,"").toLocaleLowerCase();return strict?"MMM"===format?-1!==(ii=indexOf.call(this._shortMonthsParse,llc))?ii:null:-1!==(ii=indexOf.call(this._longMonthsParse,llc))?ii:null:"MMM"===format?-1!==(ii=indexOf.call(this._shortMonthsParse,llc))||-1!==(ii=indexOf.call(this._longMonthsParse,llc))?ii:null:-1!==(ii=indexOf.call(this._longMonthsParse,llc))||-1!==(ii=indexOf.call(this._shortMonthsParse,llc))?ii:null}function setMonth(mom,value){var dayOfMonth;if(!mom.isValid())return mom;if("string"==typeof value)if(/^\d+$/.test(value))value=toInt(value);else if(!isNumber(value=mom.localeData().monthsParse(value)))return mom;return dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value)),mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth),mom}function getSetMonth(value){return null!=value?(setMonth(this,value),hooks.updateOffset(this,!0),this):get(this,"Month")}function computeMonthsParse(){function cmpLenRev(a,b){return b.length-a.length}var i,mom,shortPieces=[],longPieces=[],mixedPieces=[];for(i=0;i<12;i++)mom=createUTC([2e3,i]),shortPieces.push(this.monthsShort(mom,"")),longPieces.push(this.months(mom,"")),mixedPieces.push(this.months(mom,"")),mixedPieces.push(this.monthsShort(mom,""));for(shortPieces.sort(cmpLenRev),longPieces.sort(cmpLenRev),mixedPieces.sort(cmpLenRev),i=0;i<12;i++)shortPieces[i]=regexEscape(shortPieces[i]),longPieces[i]=regexEscape(longPieces[i]);for(i=0;i<24;i++)mixedPieces[i]=regexEscape(mixedPieces[i]);this._monthsRegex=new RegExp("^("+mixedPieces.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+longPieces.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i")}function daysInYear(year){return isLeapYear(year)?366:365}addFormatToken("Y",0,0,(function(){var y=this.year();return y<=9999?zeroFill(y,4):"+"+y})),addFormatToken(0,["YY",2],0,(function(){return this.year()%100})),addFormatToken(0,["YYYY",4],0,"year"),addFormatToken(0,["YYYYY",5],0,"year"),addFormatToken(0,["YYYYYY",6,!0],0,"year"),addUnitAlias("year","y"),addUnitPriority("year",1),addRegexToken("Y",matchSigned),addRegexToken("YY",match1to2,match2),addRegexToken("YYYY",match1to4,match4),addRegexToken("YYYYY",match1to6,match6),addRegexToken("YYYYYY",match1to6,match6),addParseToken(["YYYYY","YYYYYY"],0),addParseToken("YYYY",(function(input,array){array[0]=2===input.length?hooks.parseTwoDigitYear(input):toInt(input)})),addParseToken("YY",(function(input,array){array[0]=hooks.parseTwoDigitYear(input)})),addParseToken("Y",(function(input,array){array[0]=parseInt(input,10)})),hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",!0);function createDate(y,m,d,h,M,s,ms){var date;return y<100&&y>=0?(date=new Date(y+400,m,d,h,M,s,ms),isFinite(date.getFullYear())&&date.setFullYear(y)):date=new Date(y,m,d,h,M,s,ms),date}function createUTCDate(y){var date,args;return y<100&&y>=0?((args=Array.prototype.slice.call(arguments))[0]=y+400,date=new Date(Date.UTC.apply(null,args)),isFinite(date.getUTCFullYear())&&date.setUTCFullYear(y)):date=new Date(Date.UTC.apply(null,arguments)),date}function firstWeekOffset(year,dow,doy){var fwd=7+dow-doy;return-(7+createUTCDate(year,0,fwd).getUTCDay()-dow)%7+fwd-1}function dayOfYearFromWeeks(year,week,weekday,dow,doy){var resYear,resDayOfYear,dayOfYear=1+7*(week-1)+(7+weekday-dow)%7+firstWeekOffset(year,dow,doy);return dayOfYear<=0?resDayOfYear=daysInYear(resYear=year-1)+dayOfYear:dayOfYear>daysInYear(year)?(resYear=year+1,resDayOfYear=dayOfYear-daysInYear(year)):(resYear=year,resDayOfYear=dayOfYear),{year:resYear,dayOfYear:resDayOfYear}}function weekOfYear(mom,dow,doy){var resWeek,resYear,weekOffset=firstWeekOffset(mom.year(),dow,doy),week=Math.floor((mom.dayOfYear()-weekOffset-1)/7)+1;return week<1?resWeek=week+weeksInYear(resYear=mom.year()-1,dow,doy):week>weeksInYear(mom.year(),dow,doy)?(resWeek=week-weeksInYear(mom.year(),dow,doy),resYear=mom.year()+1):(resYear=mom.year(),resWeek=week),{week:resWeek,year:resYear}}function weeksInYear(year,dow,doy){var weekOffset=firstWeekOffset(year,dow,doy),weekOffsetNext=firstWeekOffset(year+1,dow,doy);return(daysInYear(year)-weekOffset+weekOffsetNext)/7}function shiftWeekdays(ws,n){return ws.slice(n,7).concat(ws.slice(0,n))}addFormatToken("w",["ww",2],"wo","week"),addFormatToken("W",["WW",2],"Wo","isoWeek"),addUnitAlias("week","w"),addUnitAlias("isoWeek","W"),addUnitPriority("week",5),addUnitPriority("isoWeek",5),addRegexToken("w",match1to2),addRegexToken("ww",match1to2,match2),addRegexToken("W",match1to2),addRegexToken("WW",match1to2,match2),addWeekParseToken(["w","ww","W","WW"],(function(input,week,config,token){week[token.substr(0,1)]=toInt(input)})),addFormatToken("d",0,"do","day"),addFormatToken("dd",0,0,(function(format){return this.localeData().weekdaysMin(this,format)})),addFormatToken("ddd",0,0,(function(format){return this.localeData().weekdaysShort(this,format)})),addFormatToken("dddd",0,0,(function(format){return this.localeData().weekdays(this,format)})),addFormatToken("e",0,0,"weekday"),addFormatToken("E",0,0,"isoWeekday"),addUnitAlias("day","d"),addUnitAlias("weekday","e"),addUnitAlias("isoWeekday","E"),addUnitPriority("day",11),addUnitPriority("weekday",11),addUnitPriority("isoWeekday",11),addRegexToken("d",match1to2),addRegexToken("e",match1to2),addRegexToken("E",match1to2),addRegexToken("dd",(function(isStrict,locale){return locale.weekdaysMinRegex(isStrict)})),addRegexToken("ddd",(function(isStrict,locale){return locale.weekdaysShortRegex(isStrict)})),addRegexToken("dddd",(function(isStrict,locale){return locale.weekdaysRegex(isStrict)})),addWeekParseToken(["dd","ddd","dddd"],(function(input,week,config,token){var weekday=config._locale.weekdaysParse(input,token,config._strict);null!=weekday?week.d=weekday:getParsingFlags(config).invalidWeekday=input})),addWeekParseToken(["d","e","E"],(function(input,week,config,token){week[token]=toInt(input)}));var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),defaultWeekdaysRegex=matchWord,defaultWeekdaysShortRegex=matchWord,defaultWeekdaysMinRegex=matchWord;function handleStrictParse$1(weekdayName,format,strict){var i,ii,mom,llc=weekdayName.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],i=0;i<7;++i)mom=createUTC([2e3,1]).day(i),this._minWeekdaysParse[i]=this.weekdaysMin(mom,"").toLocaleLowerCase(),this._shortWeekdaysParse[i]=this.weekdaysShort(mom,"").toLocaleLowerCase(),this._weekdaysParse[i]=this.weekdays(mom,"").toLocaleLowerCase();return strict?"dddd"===format?-1!==(ii=indexOf.call(this._weekdaysParse,llc))?ii:null:"ddd"===format?-1!==(ii=indexOf.call(this._shortWeekdaysParse,llc))?ii:null:-1!==(ii=indexOf.call(this._minWeekdaysParse,llc))?ii:null:"dddd"===format?-1!==(ii=indexOf.call(this._weekdaysParse,llc))||-1!==(ii=indexOf.call(this._shortWeekdaysParse,llc))||-1!==(ii=indexOf.call(this._minWeekdaysParse,llc))?ii:null:"ddd"===format?-1!==(ii=indexOf.call(this._shortWeekdaysParse,llc))||-1!==(ii=indexOf.call(this._weekdaysParse,llc))||-1!==(ii=indexOf.call(this._minWeekdaysParse,llc))?ii:null:-1!==(ii=indexOf.call(this._minWeekdaysParse,llc))||-1!==(ii=indexOf.call(this._weekdaysParse,llc))||-1!==(ii=indexOf.call(this._shortWeekdaysParse,llc))?ii:null}function computeWeekdaysParse(){function cmpLenRev(a,b){return b.length-a.length}var i,mom,minp,shortp,longp,minPieces=[],shortPieces=[],longPieces=[],mixedPieces=[];for(i=0;i<7;i++)mom=createUTC([2e3,1]).day(i),minp=regexEscape(this.weekdaysMin(mom,"")),shortp=regexEscape(this.weekdaysShort(mom,"")),longp=regexEscape(this.weekdays(mom,"")),minPieces.push(minp),shortPieces.push(shortp),longPieces.push(longp),mixedPieces.push(minp),mixedPieces.push(shortp),mixedPieces.push(longp);minPieces.sort(cmpLenRev),shortPieces.sort(cmpLenRev),longPieces.sort(cmpLenRev),mixedPieces.sort(cmpLenRev),this._weekdaysRegex=new RegExp("^("+mixedPieces.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+longPieces.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+minPieces.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function meridiem(token,lowercase){addFormatToken(token,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)}))}function matchMeridiem(isStrict,locale){return locale._meridiemParse}addFormatToken("H",["HH",2],0,"hour"),addFormatToken("h",["hh",2],0,hFormat),addFormatToken("k",["kk",2],0,(function(){return this.hours()||24})),addFormatToken("hmm",0,0,(function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)})),addFormatToken("hmmss",0,0,(function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)})),addFormatToken("Hmm",0,0,(function(){return""+this.hours()+zeroFill(this.minutes(),2)})),addFormatToken("Hmmss",0,0,(function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)})),meridiem("a",!0),meridiem("A",!1),addUnitAlias("hour","h"),addUnitPriority("hour",13),addRegexToken("a",matchMeridiem),addRegexToken("A",matchMeridiem),addRegexToken("H",match1to2),addRegexToken("h",match1to2),addRegexToken("k",match1to2),addRegexToken("HH",match1to2,match2),addRegexToken("hh",match1to2,match2),addRegexToken("kk",match1to2,match2),addRegexToken("hmm",match3to4),addRegexToken("hmmss",match5to6),addRegexToken("Hmm",match3to4),addRegexToken("Hmmss",match5to6),addParseToken(["H","HH"],3),addParseToken(["k","kk"],(function(input,array,config){var kInput=toInt(input);array[3]=24===kInput?0:kInput})),addParseToken(["a","A"],(function(input,array,config){config._isPm=config._locale.isPM(input),config._meridiem=input})),addParseToken(["h","hh"],(function(input,array,config){array[3]=toInt(input),getParsingFlags(config).bigHour=!0})),addParseToken("hmm",(function(input,array,config){var pos=input.length-2;array[3]=toInt(input.substr(0,pos)),array[4]=toInt(input.substr(pos)),getParsingFlags(config).bigHour=!0})),addParseToken("hmmss",(function(input,array,config){var pos1=input.length-4,pos2=input.length-2;array[3]=toInt(input.substr(0,pos1)),array[4]=toInt(input.substr(pos1,2)),array[5]=toInt(input.substr(pos2)),getParsingFlags(config).bigHour=!0})),addParseToken("Hmm",(function(input,array,config){var pos=input.length-2;array[3]=toInt(input.substr(0,pos)),array[4]=toInt(input.substr(pos))})),addParseToken("Hmmss",(function(input,array,config){var pos1=input.length-4,pos2=input.length-2;array[3]=toInt(input.substr(0,pos1)),array[4]=toInt(input.substr(pos1,2)),array[5]=toInt(input.substr(pos2))}));var globalLocale,getSetHour=makeGetSet("Hours",!0),baseConfig={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:defaultLocaleMonths,monthsShort:defaultLocaleMonthsShort,week:{dow:0,doy:6},weekdays:defaultLocaleWeekdays,weekdaysMin:defaultLocaleWeekdaysMin,weekdaysShort:defaultLocaleWeekdaysShort,meridiemParse:/[ap]\.?m?\.?/i},locales={},localeFamilies={};function commonPrefix(arr1,arr2){var i,minl=Math.min(arr1.length,arr2.length);for(i=0;i<minl;i+=1)if(arr1[i]!==arr2[i])return i;return minl}function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function loadLocale(name){var oldLocale=null;if(void 0===locales[name]&&void 0!==module&&module&&module.exports)try{oldLocale=globalLocale._abbr,__webpack_require__(271)("./"+name),getSetGlobalLocale(oldLocale)}catch(e){locales[name]=null}return locales[name]}function getSetGlobalLocale(key,values){var data;return key&&((data=isUndefined(values)?getLocale(key):defineLocale(key,values))?globalLocale=data:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+key+" not found. Did you forget to load it?")),globalLocale._abbr}function defineLocale(name,config){if(null!==config){var locale,parentConfig=baseConfig;if(config.abbr=name,null!=locales[name])deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),parentConfig=locales[name]._config;else if(null!=config.parentLocale)if(null!=locales[config.parentLocale])parentConfig=locales[config.parentLocale]._config;else{if(null==(locale=loadLocale(config.parentLocale)))return localeFamilies[config.parentLocale]||(localeFamilies[config.parentLocale]=[]),localeFamilies[config.parentLocale].push({name:name,config:config}),null;parentConfig=locale._config}return locales[name]=new Locale(mergeConfigs(parentConfig,config)),localeFamilies[name]&&localeFamilies[name].forEach((function(x){defineLocale(x.name,x.config)})),getSetGlobalLocale(name),locales[name]}return delete locales[name],null}function getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr&&(key=key._locale._abbr),!key)return globalLocale;if(!isArray(key)){if(locale=loadLocale(key))return locale;key=[key]}return function(names){for(var j,next,locale,split,i=0;i<names.length;){for(j=(split=normalizeLocale(names[i]).split("-")).length,next=(next=normalizeLocale(names[i+1]))?next.split("-"):null;j>0;){if(locale=loadLocale(split.slice(0,j).join("-")))return locale;if(next&&next.length>=j&&commonPrefix(split,next)>=j-1)break;j--}i++}return globalLocale}(key)}function checkOverflow(m){var overflow,a=m._a;return a&&-2===getParsingFlags(m).overflow&&(overflow=a[1]<0||a[1]>11?1:a[2]<1||a[2]>daysInMonth(a[0],a[1])?2:a[3]<0||a[3]>24||24===a[3]&&(0!==a[4]||0!==a[5]||0!==a[6])?3:a[4]<0||a[4]>59?4:a[5]<0||a[5]>59?5:a[6]<0||a[6]>999?6:-1,getParsingFlags(m)._overflowDayOfYear&&(overflow<0||overflow>2)&&(overflow=2),getParsingFlags(m)._overflowWeeks&&-1===overflow&&(overflow=7),getParsingFlags(m)._overflowWeekday&&-1===overflow&&(overflow=8),getParsingFlags(m).overflow=overflow),m}var extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,tzRegex=/Z|[+-]\d\d(?::?\d\d)?/,isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],isoTimes=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],aspNetJsonRegex=/^\/?Date\((-?\d+)/i,rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,obsOffsets={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function configFromISO(config){var i,l,allowTime,dateFormat,timeFormat,tzFormat,string=config._i,match=extendedIsoRegex.exec(string)||basicIsoRegex.exec(string);if(match){for(getParsingFlags(config).iso=!0,i=0,l=isoDates.length;i<l;i++)if(isoDates[i][1].exec(match[1])){dateFormat=isoDates[i][0],allowTime=!1!==isoDates[i][2];break}if(null==dateFormat)return void(config._isValid=!1);if(match[3]){for(i=0,l=isoTimes.length;i<l;i++)if(isoTimes[i][1].exec(match[3])){timeFormat=(match[2]||" ")+isoTimes[i][0];break}if(null==timeFormat)return void(config._isValid=!1)}if(!allowTime&&null!=timeFormat)return void(config._isValid=!1);if(match[4]){if(!tzRegex.exec(match[4]))return void(config._isValid=!1);tzFormat="Z"}config._f=dateFormat+(timeFormat||"")+(tzFormat||""),configFromStringAndFormat(config)}else config._isValid=!1}function untruncateYear(yearStr){var year=parseInt(yearStr,10);return year<=49?2e3+year:year<=999?1900+year:year}function configFromRFC2822(config){var parsedArray,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr,result,match=rfc2822.exec(config._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(match){if(yearStr=match[4],monthStr=match[3],dayStr=match[2],hourStr=match[5],minuteStr=match[6],secondStr=match[7],result=[untruncateYear(yearStr),defaultLocaleMonthsShort.indexOf(monthStr),parseInt(dayStr,10),parseInt(hourStr,10),parseInt(minuteStr,10)],secondStr&&result.push(parseInt(secondStr,10)),parsedArray=result,!function(weekdayStr,parsedInput,config){return!weekdayStr||defaultLocaleWeekdaysShort.indexOf(weekdayStr)===new Date(parsedInput[0],parsedInput[1],parsedInput[2]).getDay()||(getParsingFlags(config).weekdayMismatch=!0,config._isValid=!1,!1)}(match[1],parsedArray,config))return;config._a=parsedArray,config._tzm=function(obsOffset,militaryOffset,numOffset){if(obsOffset)return obsOffsets[obsOffset];if(militaryOffset)return 0;var hm=parseInt(numOffset,10),m=hm%100;return(hm-m)/100*60+m}(match[8],match[9],match[10]),config._d=createUTCDate.apply(null,config._a),config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm),getParsingFlags(config).rfc2822=!0}else config._isValid=!1}function defaults(a,b,c){return null!=a?a:null!=b?b:c}function configFromArray(config){var i,date,currentDate,expectedWeekday,yearToUse,input=[];if(!config._d){for(currentDate=function(config){var nowValue=new Date(hooks.now());return config._useUTC?[nowValue.getUTCFullYear(),nowValue.getUTCMonth(),nowValue.getUTCDate()]:[nowValue.getFullYear(),nowValue.getMonth(),nowValue.getDate()]}(config),config._w&&null==config._a[2]&&null==config._a[1]&&function(config){var w,weekYear,week,weekday,dow,doy,temp,weekdayOverflow,curWeek;null!=(w=config._w).GG||null!=w.W||null!=w.E?(dow=1,doy=4,weekYear=defaults(w.GG,config._a[0],weekOfYear(createLocal(),1,4).year),week=defaults(w.W,1),((weekday=defaults(w.E,1))<1||weekday>7)&&(weekdayOverflow=!0)):(dow=config._locale._week.dow,doy=config._locale._week.doy,curWeek=weekOfYear(createLocal(),dow,doy),weekYear=defaults(w.gg,config._a[0],curWeek.year),week=defaults(w.w,curWeek.week),null!=w.d?((weekday=w.d)<0||weekday>6)&&(weekdayOverflow=!0):null!=w.e?(weekday=w.e+dow,(w.e<0||w.e>6)&&(weekdayOverflow=!0)):weekday=dow),week<1||week>weeksInYear(weekYear,dow,doy)?getParsingFlags(config)._overflowWeeks=!0:null!=weekdayOverflow?getParsingFlags(config)._overflowWeekday=!0:(temp=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),config._a[0]=temp.year,config._dayOfYear=temp.dayOfYear)}(config),null!=config._dayOfYear&&(yearToUse=defaults(config._a[0],currentDate[0]),(config._dayOfYear>daysInYear(yearToUse)||0===config._dayOfYear)&&(getParsingFlags(config)._overflowDayOfYear=!0),date=createUTCDate(yearToUse,0,config._dayOfYear),config._a[1]=date.getUTCMonth(),config._a[2]=date.getUTCDate()),i=0;i<3&&null==config._a[i];++i)config._a[i]=input[i]=currentDate[i];for(;i<7;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];24===config._a[3]&&0===config._a[4]&&0===config._a[5]&&0===config._a[6]&&(config._nextDay=!0,config._a[3]=0),config._d=(config._useUTC?createUTCDate:createDate).apply(null,input),expectedWeekday=config._useUTC?config._d.getUTCDay():config._d.getDay(),null!=config._tzm&&config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm),config._nextDay&&(config._a[3]=24),config._w&&void 0!==config._w.d&&config._w.d!==expectedWeekday&&(getParsingFlags(config).weekdayMismatch=!0)}}function configFromStringAndFormat(config){if(config._f!==hooks.ISO_8601)if(config._f!==hooks.RFC_2822){config._a=[],getParsingFlags(config).empty=!0;var i,parsedInput,tokens,token,skipped,era,string=""+config._i,stringLength=string.length,totalParsedInputLength=0;for(tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[],i=0;i<tokens.length;i++)token=tokens[i],(parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0])&&((skipped=string.substr(0,string.indexOf(parsedInput))).length>0&&getParsingFlags(config).unusedInput.push(skipped),string=string.slice(string.indexOf(parsedInput)+parsedInput.length),totalParsedInputLength+=parsedInput.length),formatTokenFunctions[token]?(parsedInput?getParsingFlags(config).empty=!1:getParsingFlags(config).unusedTokens.push(token),addTimeToArrayFromToken(token,parsedInput,config)):config._strict&&!parsedInput&&getParsingFlags(config).unusedTokens.push(token);getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength,string.length>0&&getParsingFlags(config).unusedInput.push(string),config._a[3]<=12&&!0===getParsingFlags(config).bigHour&&config._a[3]>0&&(getParsingFlags(config).bigHour=void 0),getParsingFlags(config).parsedDateParts=config._a.slice(0),getParsingFlags(config).meridiem=config._meridiem,config._a[3]=function(locale,hour,meridiem){var isPm;return null==meridiem?hour:null!=locale.meridiemHour?locale.meridiemHour(hour,meridiem):null!=locale.isPM?((isPm=locale.isPM(meridiem))&&hour<12&&(hour+=12),isPm||12!==hour||(hour=0),hour):hour}(config._locale,config._a[3],config._meridiem),null!==(era=getParsingFlags(config).era)&&(config._a[0]=config._locale.erasConvertYear(era,config._a[0])),configFromArray(config),checkOverflow(config)}else configFromRFC2822(config);else configFromISO(config)}function prepareConfig(config){var input=config._i,format=config._f;return config._locale=config._locale||getLocale(config._l),null===input||void 0===format&&""===input?createInvalid({nullInput:!0}):("string"==typeof input&&(config._i=input=config._locale.preparse(input)),isMoment(input)?new Moment(checkOverflow(input)):(isDate(input)?config._d=input:isArray(format)?function(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore,validFormatFound,bestFormatIsValid=!1;if(0===config._f.length)return getParsingFlags(config).invalidFormat=!0,void(config._d=new Date(NaN));for(i=0;i<config._f.length;i++)currentScore=0,validFormatFound=!1,tempConfig=copyConfig({},config),null!=config._useUTC&&(tempConfig._useUTC=config._useUTC),tempConfig._f=config._f[i],configFromStringAndFormat(tempConfig),isValid(tempConfig)&&(validFormatFound=!0),currentScore+=getParsingFlags(tempConfig).charsLeftOver,currentScore+=10*getParsingFlags(tempConfig).unusedTokens.length,getParsingFlags(tempConfig).score=currentScore,bestFormatIsValid?currentScore<scoreToBeat&&(scoreToBeat=currentScore,bestMoment=tempConfig):(null==scoreToBeat||currentScore<scoreToBeat||validFormatFound)&&(scoreToBeat=currentScore,bestMoment=tempConfig,validFormatFound&&(bestFormatIsValid=!0));extend(config,bestMoment||tempConfig)}(config):format?configFromStringAndFormat(config):function(config){var input=config._i;isUndefined(input)?config._d=new Date(hooks.now()):isDate(input)?config._d=new Date(input.valueOf()):"string"==typeof input?function(config){var matched=aspNetJsonRegex.exec(config._i);null===matched?(configFromISO(config),!1===config._isValid&&(delete config._isValid,configFromRFC2822(config),!1===config._isValid&&(delete config._isValid,config._strict?config._isValid=!1:hooks.createFromInputFallback(config)))):config._d=new Date(+matched[1])}(config):isArray(input)?(config._a=map(input.slice(0),(function(obj){return parseInt(obj,10)})),configFromArray(config)):isObject(input)?function(config){if(!config._d){var i=normalizeObjectUnits(config._i),dayOrDate=void 0===i.day?i.date:i.day;config._a=map([i.year,i.month,dayOrDate,i.hour,i.minute,i.second,i.millisecond],(function(obj){return obj&&parseInt(obj,10)})),configFromArray(config)}}(config):isNumber(input)?config._d=new Date(input):hooks.createFromInputFallback(config)}(config),isValid(config)||(config._d=null),config))}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};return!0!==format&&!1!==format||(strict=format,format=void 0),!0!==locale&&!1!==locale||(strict=locale,locale=void 0),(isObject(input)&&isObjectEmpty(input)||isArray(input)&&0===input.length)&&(input=void 0),c._isAMomentObject=!0,c._useUTC=c._isUTC=isUTC,c._l=locale,c._i=input,c._f=format,c._strict=strict,function(config){var res=new Moment(checkOverflow(prepareConfig(config)));return res._nextDay&&(res.add(1,"d"),res._nextDay=void 0),res}(c)}function createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,!1)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))})),hooks.ISO_8601=function(){},hooks.RFC_2822=function(){};var prototypeMin=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var other=createLocal.apply(null,arguments);return this.isValid()&&other.isValid()?other<this?this:other:createInvalid()})),prototypeMax=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var other=createLocal.apply(null,arguments);return this.isValid()&&other.isValid()?other>this?this:other:createInvalid()}));function pickBy(fn,moments){var res,i;if(1===moments.length&&isArray(moments[0])&&(moments=moments[0]),!moments.length)return createLocal();for(res=moments[0],i=1;i<moments.length;++i)moments[i].isValid()&&!moments[i][fn](res)||(res=moments[i]);return res}var ordering=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||normalizedInput.isoWeek||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._isValid=function(m){var key,i,unitHasDecimal=!1;for(key in m)if(hasOwnProp(m,key)&&(-1===indexOf.call(ordering,key)||null!=m[key]&&isNaN(m[key])))return!1;for(i=0;i<ordering.length;++i)if(m[ordering[i]]){if(unitHasDecimal)return!1;parseFloat(m[ordering[i]])!==toInt(m[ordering[i]])&&(unitHasDecimal=!0)}return!0}(normalizedInput),this._milliseconds=+milliseconds+1e3*seconds+6e4*minutes+1e3*hours*60*60,this._days=+days+7*weeks,this._months=+months+3*quarters+12*years,this._data={},this._locale=getLocale(),this._bubble()}function isDuration(obj){return obj instanceof Duration}function absRound(number){return number<0?-1*Math.round(-1*number):Math.round(number)}function offset(token,separator){addFormatToken(token,0,0,(function(){var offset=this.utcOffset(),sign="+";return offset<0&&(offset=-offset,sign="-"),sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)}))}offset("Z",":"),offset("ZZ",""),addRegexToken("Z",matchShortOffset),addRegexToken("ZZ",matchShortOffset),addParseToken(["Z","ZZ"],(function(input,array,config){config._useUTC=!0,config._tzm=offsetFromString(matchShortOffset,input)}));var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(matcher,string){var parts,minutes,matches=(string||"").match(matcher);return null===matches?null:0===(minutes=60*(parts=((matches[matches.length-1]||[])+"").match(chunkOffset)||["-",0,0])[1]+toInt(parts[2]))?0:"+"===parts[0]?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;return model._isUTC?(res=model.clone(),diff=(isMoment(input)||isDate(input)?input.valueOf():createLocal(input).valueOf())-res.valueOf(),res._d.setTime(res._d.valueOf()+diff),hooks.updateOffset(res,!1),res):createLocal(input).local()}function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset())}function isUtc(){return!!this.isValid()&&this._isUTC&&0===this._offset}hooks.updateOffset=function(){};var aspNetRegex=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,isoRegex=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(input,key){var sign,ret,diffRes,base,other,res,duration=input,match=null;return isDuration(input)?duration={ms:input._milliseconds,d:input._days,M:input._months}:isNumber(input)||!isNaN(+input)?(duration={},key?duration[key]=+input:duration.milliseconds=+input):(match=aspNetRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:0,d:toInt(match[2])*sign,h:toInt(match[3])*sign,m:toInt(match[4])*sign,s:toInt(match[5])*sign,ms:toInt(absRound(1e3*match[6]))*sign}):(match=isoRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),w:parseIso(match[4],sign),d:parseIso(match[5],sign),h:parseIso(match[6],sign),m:parseIso(match[7],sign),s:parseIso(match[8],sign)}):null==duration?duration={}:"object"==typeof duration&&("from"in duration||"to"in duration)&&(base=createLocal(duration.from),other=createLocal(duration.to),diffRes=base.isValid()&&other.isValid()?(other=cloneWithOffset(other,base),base.isBefore(other)?res=positiveMomentsDifference(base,other):((res=positiveMomentsDifference(other,base)).milliseconds=-res.milliseconds,res.months=-res.months),res):{milliseconds:0,months:0},(duration={}).ms=diffRes.milliseconds,duration.M=diffRes.months),ret=new Duration(duration),isDuration(input)&&hasOwnProp(input,"_locale")&&(ret._locale=input._locale),isDuration(input)&&hasOwnProp(input,"_isValid")&&(ret._isValid=input._isValid),ret}function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={};return res.months=other.month()-base.month()+12*(other.year()-base.year()),base.clone().add(res.months,"M").isAfter(other)&&--res.months,res.milliseconds=+other-+base.clone().add(res.months,"M"),res}function createAdder(direction,name){return function(val,period){var tmp;return null===period||isNaN(+period)||(deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),tmp=val,val=period,period=tmp),addSubtract(this,createDuration(val,period),direction),this}}function addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=absRound(duration._days),months=absRound(duration._months);mom.isValid()&&(updateOffset=null==updateOffset||updateOffset,months&&setMonth(mom,get(mom,"Month")+months*isAdding),days&&set$1(mom,"Date",get(mom,"Date")+days*isAdding),milliseconds&&mom._d.setTime(mom._d.valueOf()+milliseconds*isAdding),updateOffset&&hooks.updateOffset(mom,days||months))}createDuration.fn=Duration.prototype,createDuration.invalid=function(){return createDuration(NaN)};var add=createAdder(1,"add"),subtract=createAdder(-1,"subtract");function isString(input){return"string"==typeof input||input instanceof String}function isMomentInput(input){return isMoment(input)||isDate(input)||isString(input)||isNumber(input)||function(input){var arrayTest=isArray(input),dataTypeTest=!1;return arrayTest&&(dataTypeTest=0===input.filter((function(item){return!isNumber(item)&&isString(input)})).length),arrayTest&&dataTypeTest}(input)||function(input){var i,objectTest=isObject(input)&&!isObjectEmpty(input),propertyTest=!1,properties=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"];for(i=0;i<properties.length;i+=1)propertyTest=propertyTest||hasOwnProp(input,properties[i]);return objectTest&&propertyTest}(input)||null==input}function isCalendarSpec(input){var i,objectTest=isObject(input)&&!isObjectEmpty(input),propertyTest=!1,properties=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"];for(i=0;i<properties.length;i+=1)propertyTest=propertyTest||hasOwnProp(input,properties[i]);return objectTest&&propertyTest}function monthDiff(a,b){if(a.date()<b.date())return-monthDiff(b,a);var wholeMonthDiff=12*(b.year()-a.year())+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months");return-(wholeMonthDiff+(b-anchor<0?(b-anchor)/(anchor-a.clone().add(wholeMonthDiff-1,"months")):(b-anchor)/(a.clone().add(wholeMonthDiff+1,"months")-anchor)))||0}function locale(key){var newLocaleData;return void 0===key?this._locale._abbr:(null!=(newLocaleData=getLocale(key))&&(this._locale=newLocaleData),this)}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(key){return void 0===key?this.localeData():this.locale(key)}));function localeData(){return this._locale}function mod$1(dividend,divisor){return(dividend%divisor+divisor)%divisor}function localStartOfDate(y,m,d){return y<100&&y>=0?new Date(y+400,m,d)-126227808e5:new Date(y,m,d).valueOf()}function utcStartOfDate(y,m,d){return y<100&&y>=0?Date.UTC(y+400,m,d)-126227808e5:Date.UTC(y,m,d)}function matchEraAbbr(isStrict,locale){return locale.erasAbbrRegex(isStrict)}function computeErasParse(){var i,l,abbrPieces=[],namePieces=[],narrowPieces=[],mixedPieces=[],eras=this.eras();for(i=0,l=eras.length;i<l;++i)namePieces.push(regexEscape(eras[i].name)),abbrPieces.push(regexEscape(eras[i].abbr)),narrowPieces.push(regexEscape(eras[i].narrow)),mixedPieces.push(regexEscape(eras[i].name)),mixedPieces.push(regexEscape(eras[i].abbr)),mixedPieces.push(regexEscape(eras[i].narrow));this._erasRegex=new RegExp("^("+mixedPieces.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+namePieces.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+abbrPieces.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+narrowPieces.join("|")+")","i")}function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}function getSetWeekYearHelper(input,week,weekday,dow,doy){var weeksTarget;return null==input?weekOfYear(this,dow,doy).year:(week>(weeksTarget=weeksInYear(input,dow,doy))&&(week=weeksTarget),setWeekAll.call(this,input,week,weekday,dow,doy))}function setWeekAll(weekYear,week,weekday,dow,doy){var dayOfYearData=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),date=createUTCDate(dayOfYearData.year,0,dayOfYearData.dayOfYear);return this.year(date.getUTCFullYear()),this.month(date.getUTCMonth()),this.date(date.getUTCDate()),this}addFormatToken("N",0,0,"eraAbbr"),addFormatToken("NN",0,0,"eraAbbr"),addFormatToken("NNN",0,0,"eraAbbr"),addFormatToken("NNNN",0,0,"eraName"),addFormatToken("NNNNN",0,0,"eraNarrow"),addFormatToken("y",["y",1],"yo","eraYear"),addFormatToken("y",["yy",2],0,"eraYear"),addFormatToken("y",["yyy",3],0,"eraYear"),addFormatToken("y",["yyyy",4],0,"eraYear"),addRegexToken("N",matchEraAbbr),addRegexToken("NN",matchEraAbbr),addRegexToken("NNN",matchEraAbbr),addRegexToken("NNNN",(function(isStrict,locale){return locale.erasNameRegex(isStrict)})),addRegexToken("NNNNN",(function(isStrict,locale){return locale.erasNarrowRegex(isStrict)})),addParseToken(["N","NN","NNN","NNNN","NNNNN"],(function(input,array,config,token){var era=config._locale.erasParse(input,token,config._strict);era?getParsingFlags(config).era=era:getParsingFlags(config).invalidEra=input})),addRegexToken("y",matchUnsigned),addRegexToken("yy",matchUnsigned),addRegexToken("yyy",matchUnsigned),addRegexToken("yyyy",matchUnsigned),addRegexToken("yo",(function(isStrict,locale){return locale._eraYearOrdinalRegex||matchUnsigned})),addParseToken(["y","yy","yyy","yyyy"],0),addParseToken(["yo"],(function(input,array,config,token){var match;config._locale._eraYearOrdinalRegex&&(match=input.match(config._locale._eraYearOrdinalRegex)),config._locale.eraYearOrdinalParse?array[0]=config._locale.eraYearOrdinalParse(input,match):array[0]=parseInt(input,10)})),addFormatToken(0,["gg",2],0,(function(){return this.weekYear()%100})),addFormatToken(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),addWeekYearFormatToken("gggg","weekYear"),addWeekYearFormatToken("ggggg","weekYear"),addWeekYearFormatToken("GGGG","isoWeekYear"),addWeekYearFormatToken("GGGGG","isoWeekYear"),addUnitAlias("weekYear","gg"),addUnitAlias("isoWeekYear","GG"),addUnitPriority("weekYear",1),addUnitPriority("isoWeekYear",1),addRegexToken("G",matchSigned),addRegexToken("g",matchSigned),addRegexToken("GG",match1to2,match2),addRegexToken("gg",match1to2,match2),addRegexToken("GGGG",match1to4,match4),addRegexToken("gggg",match1to4,match4),addRegexToken("GGGGG",match1to6,match6),addRegexToken("ggggg",match1to6,match6),addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],(function(input,week,config,token){week[token.substr(0,2)]=toInt(input)})),addWeekParseToken(["gg","GG"],(function(input,week,config,token){week[token]=hooks.parseTwoDigitYear(input)})),addFormatToken("Q",0,"Qo","quarter"),addUnitAlias("quarter","Q"),addUnitPriority("quarter",7),addRegexToken("Q",match1),addParseToken("Q",(function(input,array){array[1]=3*(toInt(input)-1)})),addFormatToken("D",["DD",2],"Do","date"),addUnitAlias("date","D"),addUnitPriority("date",9),addRegexToken("D",match1to2),addRegexToken("DD",match1to2,match2),addRegexToken("Do",(function(isStrict,locale){return isStrict?locale._dayOfMonthOrdinalParse||locale._ordinalParse:locale._dayOfMonthOrdinalParseLenient})),addParseToken(["D","DD"],2),addParseToken("Do",(function(input,array){array[2]=toInt(input.match(match1to2)[0])}));var getSetDayOfMonth=makeGetSet("Date",!0);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear"),addUnitAlias("dayOfYear","DDD"),addUnitPriority("dayOfYear",4),addRegexToken("DDD",match1to3),addRegexToken("DDDD",match3),addParseToken(["DDD","DDDD"],(function(input,array,config){config._dayOfYear=toInt(input)})),addFormatToken("m",["mm",2],0,"minute"),addUnitAlias("minute","m"),addUnitPriority("minute",14),addRegexToken("m",match1to2),addRegexToken("mm",match1to2,match2),addParseToken(["m","mm"],4);var getSetMinute=makeGetSet("Minutes",!1);addFormatToken("s",["ss",2],0,"second"),addUnitAlias("second","s"),addUnitPriority("second",15),addRegexToken("s",match1to2),addRegexToken("ss",match1to2,match2),addParseToken(["s","ss"],5);var token,getSetMillisecond,getSetSecond=makeGetSet("Seconds",!1);for(addFormatToken("S",0,0,(function(){return~~(this.millisecond()/100)})),addFormatToken(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),addFormatToken(0,["SSS",3],0,"millisecond"),addFormatToken(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),addFormatToken(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),addFormatToken(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),addFormatToken(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),addFormatToken(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),addFormatToken(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),addUnitAlias("millisecond","ms"),addUnitPriority("millisecond",16),addRegexToken("S",match1to3,match1),addRegexToken("SS",match1to3,match2),addRegexToken("SSS",match1to3,match3),token="SSSS";token.length<=9;token+="S")addRegexToken(token,matchUnsigned);function parseMs(input,array){array[6]=toInt(1e3*("0."+input))}for(token="S";token.length<=9;token+="S")addParseToken(token,parseMs);getSetMillisecond=makeGetSet("Milliseconds",!1),addFormatToken("z",0,0,"zoneAbbr"),addFormatToken("zz",0,0,"zoneName");var proto=Moment.prototype;function preParsePostFormat(string){return string}proto.add=add,proto.calendar=function(time,formats){1===arguments.length&&(arguments[0]?isMomentInput(arguments[0])?(time=arguments[0],formats=void 0):isCalendarSpec(arguments[0])&&(formats=arguments[0],time=void 0):(time=void 0,formats=void 0));var now=time||createLocal(),sod=cloneWithOffset(now,this).startOf("day"),format=hooks.calendarFormat(this,sod)||"sameElse",output=formats&&(isFunction(formats[format])?formats[format].call(this,now):formats[format]);return this.format(output||this.localeData().calendar(format,this,createLocal(now)))},proto.clone=function(){return new Moment(this)},proto.diff=function(input,units,asFloat){var that,zoneDelta,output;if(!this.isValid())return NaN;if(!(that=cloneWithOffset(input,this)).isValid())return NaN;switch(zoneDelta=6e4*(that.utcOffset()-this.utcOffset()),units=normalizeUnits(units)){case"year":output=monthDiff(this,that)/12;break;case"month":output=monthDiff(this,that);break;case"quarter":output=monthDiff(this,that)/3;break;case"second":output=(this-that)/1e3;break;case"minute":output=(this-that)/6e4;break;case"hour":output=(this-that)/36e5;break;case"day":output=(this-that-zoneDelta)/864e5;break;case"week":output=(this-that-zoneDelta)/6048e5;break;default:output=this-that}return asFloat?output:absFloor(output)},proto.endOf=function(units){var time,startOfDate;if(void 0===(units=normalizeUnits(units))||"millisecond"===units||!this.isValid())return this;switch(startOfDate=this._isUTC?utcStartOfDate:localStartOfDate,units){case"year":time=startOfDate(this.year()+1,0,1)-1;break;case"quarter":time=startOfDate(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":time=startOfDate(this.year(),this.month()+1,1)-1;break;case"week":time=startOfDate(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":time=startOfDate(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":time=startOfDate(this.year(),this.month(),this.date()+1)-1;break;case"hour":time=this._d.valueOf(),time+=36e5-mod$1(time+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":time=this._d.valueOf(),time+=6e4-mod$1(time,6e4)-1;break;case"second":time=this._d.valueOf(),time+=1e3-mod$1(time,1e3)-1}return this._d.setTime(time),hooks.updateOffset(this,!0),this},proto.format=function(inputString){inputString||(inputString=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat);var output=formatMoment(this,inputString);return this.localeData().postformat(output)},proto.from=function(time,withoutSuffix){return this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())?createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix):this.localeData().invalidDate()},proto.fromNow=function(withoutSuffix){return this.from(createLocal(),withoutSuffix)},proto.to=function(time,withoutSuffix){return this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())?createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix):this.localeData().invalidDate()},proto.toNow=function(withoutSuffix){return this.to(createLocal(),withoutSuffix)},proto.get=function(units){return isFunction(this[units=normalizeUnits(units)])?this[units]():this},proto.invalidAt=function(){return getParsingFlags(this).overflow},proto.isAfter=function(input,units){var localInput=isMoment(input)?input:createLocal(input);return!(!this.isValid()||!localInput.isValid())&&("millisecond"===(units=normalizeUnits(units)||"millisecond")?this.valueOf()>localInput.valueOf():localInput.valueOf()<this.clone().startOf(units).valueOf())},proto.isBefore=function(input,units){var localInput=isMoment(input)?input:createLocal(input);return!(!this.isValid()||!localInput.isValid())&&("millisecond"===(units=normalizeUnits(units)||"millisecond")?this.valueOf()<localInput.valueOf():this.clone().endOf(units).valueOf()<localInput.valueOf())},proto.isBetween=function(from,to,units,inclusivity){var localFrom=isMoment(from)?from:createLocal(from),localTo=isMoment(to)?to:createLocal(to);return!!(this.isValid()&&localFrom.isValid()&&localTo.isValid())&&("("===(inclusivity=inclusivity||"()")[0]?this.isAfter(localFrom,units):!this.isBefore(localFrom,units))&&(")"===inclusivity[1]?this.isBefore(localTo,units):!this.isAfter(localTo,units))},proto.isSame=function(input,units){var inputMs,localInput=isMoment(input)?input:createLocal(input);return!(!this.isValid()||!localInput.isValid())&&("millisecond"===(units=normalizeUnits(units)||"millisecond")?this.valueOf()===localInput.valueOf():(inputMs=localInput.valueOf(),this.clone().startOf(units).valueOf()<=inputMs&&inputMs<=this.clone().endOf(units).valueOf()))},proto.isSameOrAfter=function(input,units){return this.isSame(input,units)||this.isAfter(input,units)},proto.isSameOrBefore=function(input,units){return this.isSame(input,units)||this.isBefore(input,units)},proto.isValid=function(){return isValid(this)},proto.lang=lang,proto.locale=locale,proto.localeData=localeData,proto.max=prototypeMax,proto.min=prototypeMin,proto.parsingFlags=function(){return extend({},getParsingFlags(this))},proto.set=function(units,value){if("object"==typeof units){var i,prioritized=function(unitsObj){var u,units=[];for(u in unitsObj)hasOwnProp(unitsObj,u)&&units.push({unit:u,priority:priorities[u]});return units.sort((function(a,b){return a.priority-b.priority})),units}(units=normalizeObjectUnits(units));for(i=0;i<prioritized.length;i++)this[prioritized[i].unit](units[prioritized[i].unit])}else if(isFunction(this[units=normalizeUnits(units)]))return this[units](value);return this},proto.startOf=function(units){var time,startOfDate;if(void 0===(units=normalizeUnits(units))||"millisecond"===units||!this.isValid())return this;switch(startOfDate=this._isUTC?utcStartOfDate:localStartOfDate,units){case"year":time=startOfDate(this.year(),0,1);break;case"quarter":time=startOfDate(this.year(),this.month()-this.month()%3,1);break;case"month":time=startOfDate(this.year(),this.month(),1);break;case"week":time=startOfDate(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":time=startOfDate(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":time=startOfDate(this.year(),this.month(),this.date());break;case"hour":time=this._d.valueOf(),time-=mod$1(time+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":time=this._d.valueOf(),time-=mod$1(time,6e4);break;case"second":time=this._d.valueOf(),time-=mod$1(time,1e3)}return this._d.setTime(time),hooks.updateOffset(this,!0),this},proto.subtract=subtract,proto.toArray=function(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]},proto.toObject=function(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}},proto.toDate=function(){return new Date(this.valueOf())},proto.toISOString=function(keepOffset){if(!this.isValid())return null;var utc=!0!==keepOffset,m=utc?this.clone().utc():this;return m.year()<0||m.year()>9999?formatMoment(m,utc?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):isFunction(Date.prototype.toISOString)?utc?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",formatMoment(m,"Z")):formatMoment(m,utc?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},proto.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var prefix,year,suffix,func="moment",zone="";return this.isLocal()||(func=0===this.utcOffset()?"moment.utc":"moment.parseZone",zone="Z"),prefix="["+func+'("]',year=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",suffix=zone+'[")]',this.format(prefix+year+"-MM-DD[T]HH:mm:ss.SSS"+suffix)},"undefined"!=typeof Symbol&&null!=Symbol.for&&(proto[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),proto.toJSON=function(){return this.isValid()?this.toISOString():null},proto.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},proto.unix=function(){return Math.floor(this.valueOf()/1e3)},proto.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},proto.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},proto.eraName=function(){var i,l,val,eras=this.localeData().eras();for(i=0,l=eras.length;i<l;++i){if(val=this.clone().startOf("day").valueOf(),eras[i].since<=val&&val<=eras[i].until)return eras[i].name;if(eras[i].until<=val&&val<=eras[i].since)return eras[i].name}return""},proto.eraNarrow=function(){var i,l,val,eras=this.localeData().eras();for(i=0,l=eras.length;i<l;++i){if(val=this.clone().startOf("day").valueOf(),eras[i].since<=val&&val<=eras[i].until)return eras[i].narrow;if(eras[i].until<=val&&val<=eras[i].since)return eras[i].narrow}return""},proto.eraAbbr=function(){var i,l,val,eras=this.localeData().eras();for(i=0,l=eras.length;i<l;++i){if(val=this.clone().startOf("day").valueOf(),eras[i].since<=val&&val<=eras[i].until)return eras[i].abbr;if(eras[i].until<=val&&val<=eras[i].since)return eras[i].abbr}return""},proto.eraYear=function(){var i,l,dir,val,eras=this.localeData().eras();for(i=0,l=eras.length;i<l;++i)if(dir=eras[i].since<=eras[i].until?1:-1,val=this.clone().startOf("day").valueOf(),eras[i].since<=val&&val<=eras[i].until||eras[i].until<=val&&val<=eras[i].since)return(this.year()-hooks(eras[i].since).year())*dir+eras[i].offset;return this.year()},proto.year=getSetYear,proto.isLeapYear=function(){return isLeapYear(this.year())},proto.weekYear=function(input){return getSetWeekYearHelper.call(this,input,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},proto.isoWeekYear=function(input){return getSetWeekYearHelper.call(this,input,this.isoWeek(),this.isoWeekday(),1,4)},proto.quarter=proto.quarters=function(input){return null==input?Math.ceil((this.month()+1)/3):this.month(3*(input-1)+this.month()%3)},proto.month=getSetMonth,proto.daysInMonth=function(){return daysInMonth(this.year(),this.month())},proto.week=proto.weeks=function(input){var week=this.localeData().week(this);return null==input?week:this.add(7*(input-week),"d")},proto.isoWeek=proto.isoWeeks=function(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add(7*(input-week),"d")},proto.weeksInYear=function(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)},proto.weeksInWeekYear=function(){var weekInfo=this.localeData()._week;return weeksInYear(this.weekYear(),weekInfo.dow,weekInfo.doy)},proto.isoWeeksInYear=function(){return weeksInYear(this.year(),1,4)},proto.isoWeeksInISOWeekYear=function(){return weeksInYear(this.isoWeekYear(),1,4)},proto.date=getSetDayOfMonth,proto.day=proto.days=function(input){if(!this.isValid())return null!=input?this:NaN;var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=input?(input=function(input,locale){return"string"!=typeof input?input:isNaN(input)?"number"==typeof(input=locale.weekdaysParse(input))?input:null:parseInt(input,10)}(input,this.localeData()),this.add(input-day,"d")):day},proto.weekday=function(input){if(!this.isValid())return null!=input?this:NaN;var weekday=(this.day()+7-this.localeData()._week.dow)%7;return null==input?weekday:this.add(input-weekday,"d")},proto.isoWeekday=function(input){if(!this.isValid())return null!=input?this:NaN;if(null!=input){var weekday=function(input,locale){return"string"==typeof input?locale.weekdaysParse(input)%7||7:isNaN(input)?null:input}(input,this.localeData());return this.day(this.day()%7?weekday:weekday-7)}return this.day()||7},proto.dayOfYear=function(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==input?dayOfYear:this.add(input-dayOfYear,"d")},proto.hour=proto.hours=getSetHour,proto.minute=proto.minutes=getSetMinute,proto.second=proto.seconds=getSetSecond,proto.millisecond=proto.milliseconds=getSetMillisecond,proto.utcOffset=function(input,keepLocalTime,keepMinutes){var localAdjust,offset=this._offset||0;if(!this.isValid())return null!=input?this:NaN;if(null!=input){if("string"==typeof input){if(null===(input=offsetFromString(matchShortOffset,input)))return this}else Math.abs(input)<16&&!keepMinutes&&(input*=60);return!this._isUTC&&keepLocalTime&&(localAdjust=getDateOffset(this)),this._offset=input,this._isUTC=!0,null!=localAdjust&&this.add(localAdjust,"m"),offset!==input&&(!keepLocalTime||this._changeInProgress?addSubtract(this,createDuration(input-offset,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,hooks.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?offset:getDateOffset(this)},proto.utc=function(keepLocalTime){return this.utcOffset(0,keepLocalTime)},proto.local=function(keepLocalTime){return this._isUTC&&(this.utcOffset(0,keepLocalTime),this._isUTC=!1,keepLocalTime&&this.subtract(getDateOffset(this),"m")),this},proto.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var tZone=offsetFromString(matchOffset,this._i);null!=tZone?this.utcOffset(tZone):this.utcOffset(0,!0)}return this},proto.hasAlignedHourOffset=function(input){return!!this.isValid()&&(input=input?createLocal(input).utcOffset():0,(this.utcOffset()-input)%60==0)},proto.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},proto.isLocal=function(){return!!this.isValid()&&!this._isUTC},proto.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},proto.isUtc=isUtc,proto.isUTC=isUtc,proto.zoneAbbr=function(){return this._isUTC?"UTC":""},proto.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth),proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth),proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear),proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",(function(input,keepLocalTime){return null!=input?("string"!=typeof input&&(input=-input),this.utcOffset(input,keepLocalTime),this):-this.utcOffset()})),proto.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",(function(){if(!isUndefined(this._isDSTShifted))return this._isDSTShifted;var other,c={};return copyConfig(c,this),(c=prepareConfig(c))._a?(other=c._isUTC?createUTC(c._a):createLocal(c._a),this._isDSTShifted=this.isValid()&&function(array1,array2,dontConvert){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;i<len;i++)toInt(array1[i])!==toInt(array2[i])&&diffs++;return diffs+lengthDiff}(c._a,other.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}));var proto$1=Locale.prototype;function get$1(format,index,field,setter){var locale=getLocale(),utc=createUTC().set(setter,index);return locale[field](utc,format)}function listMonthsImpl(format,index,field){if(isNumber(format)&&(index=format,format=void 0),format=format||"",null!=index)return get$1(format,index,field,"month");var i,out=[];for(i=0;i<12;i++)out[i]=get$1(format,i,field,"month");return out}function listWeekdaysImpl(localeSorted,format,index,field){"boolean"==typeof localeSorted?(isNumber(format)&&(index=format,format=void 0),format=format||""):(index=format=localeSorted,localeSorted=!1,isNumber(format)&&(index=format,format=void 0),format=format||"");var i,locale=getLocale(),shift=localeSorted?locale._week.dow:0,out=[];if(null!=index)return get$1(format,(index+shift)%7,field,"day");for(i=0;i<7;i++)out[i]=get$1(format,(i+shift)%7,field,"day");return out}proto$1.calendar=function(key,mom,now){var output=this._calendar[key]||this._calendar.sameElse;return isFunction(output)?output.call(mom,now):output},proto$1.longDateFormat=function(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];return format||!formatUpper?format:(this._longDateFormat[key]=formatUpper.match(formattingTokens).map((function(tok){return"MMMM"===tok||"MM"===tok||"DD"===tok||"dddd"===tok?tok.slice(1):tok})).join(""),this._longDateFormat[key])},proto$1.invalidDate=function(){return this._invalidDate},proto$1.ordinal=function(number){return this._ordinal.replace("%d",number)},proto$1.preparse=preParsePostFormat,proto$1.postformat=preParsePostFormat,proto$1.relativeTime=function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return isFunction(output)?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)},proto$1.pastFuture=function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return isFunction(format)?format(output):format.replace(/%s/i,output)},proto$1.set=function(config){var prop,i;for(i in config)hasOwnProp(config,i)&&(isFunction(prop=config[i])?this[i]=prop:this["_"+i]=prop);this._config=config,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},proto$1.eras=function(m,format){var i,l,date,eras=this._eras||getLocale("en")._eras;for(i=0,l=eras.length;i<l;++i){switch(typeof eras[i].since){case"string":date=hooks(eras[i].since).startOf("day"),eras[i].since=date.valueOf()}switch(typeof eras[i].until){case"undefined":eras[i].until=1/0;break;case"string":date=hooks(eras[i].until).startOf("day").valueOf(),eras[i].until=date.valueOf()}}return eras},proto$1.erasParse=function(eraName,format,strict){var i,l,name,abbr,narrow,eras=this.eras();for(eraName=eraName.toUpperCase(),i=0,l=eras.length;i<l;++i)if(name=eras[i].name.toUpperCase(),abbr=eras[i].abbr.toUpperCase(),narrow=eras[i].narrow.toUpperCase(),strict)switch(format){case"N":case"NN":case"NNN":if(abbr===eraName)return eras[i];break;case"NNNN":if(name===eraName)return eras[i];break;case"NNNNN":if(narrow===eraName)return eras[i]}else if([name,abbr,narrow].indexOf(eraName)>=0)return eras[i]},proto$1.erasConvertYear=function(era,year){var dir=era.since<=era.until?1:-1;return void 0===year?hooks(era.since).year():hooks(era.since).year()+(year-era.offset)*dir},proto$1.erasAbbrRegex=function(isStrict){return hasOwnProp(this,"_erasAbbrRegex")||computeErasParse.call(this),isStrict?this._erasAbbrRegex:this._erasRegex},proto$1.erasNameRegex=function(isStrict){return hasOwnProp(this,"_erasNameRegex")||computeErasParse.call(this),isStrict?this._erasNameRegex:this._erasRegex},proto$1.erasNarrowRegex=function(isStrict){return hasOwnProp(this,"_erasNarrowRegex")||computeErasParse.call(this),isStrict?this._erasNarrowRegex:this._erasRegex},proto$1.months=function(m,format){return m?isArray(this._months)?this._months[m.month()]:this._months[(this._months.isFormat||MONTHS_IN_FORMAT).test(format)?"format":"standalone"][m.month()]:isArray(this._months)?this._months:this._months.standalone},proto$1.monthsShort=function(m,format){return m?isArray(this._monthsShort)?this._monthsShort[m.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(format)?"format":"standalone"][m.month()]:isArray(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},proto$1.monthsParse=function(monthName,format,strict){var i,mom,regex;if(this._monthsParseExact)return handleStrictParse.call(this,monthName,format,strict);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(mom=createUTC([2e3,i]),strict&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")),strict||this._monthsParse[i]||(regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,""),this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")),strict&&"MMMM"===format&&this._longMonthsParse[i].test(monthName))return i;if(strict&&"MMM"===format&&this._shortMonthsParse[i].test(monthName))return i;if(!strict&&this._monthsParse[i].test(monthName))return i}},proto$1.monthsRegex=function(isStrict){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),isStrict?this._monthsStrictRegex:this._monthsRegex):(hasOwnProp(this,"_monthsRegex")||(this._monthsRegex=defaultMonthsRegex),this._monthsStrictRegex&&isStrict?this._monthsStrictRegex:this._monthsRegex)},proto$1.monthsShortRegex=function(isStrict){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),isStrict?this._monthsShortStrictRegex:this._monthsShortRegex):(hasOwnProp(this,"_monthsShortRegex")||(this._monthsShortRegex=defaultMonthsShortRegex),this._monthsShortStrictRegex&&isStrict?this._monthsShortStrictRegex:this._monthsShortRegex)},proto$1.week=function(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week},proto$1.firstDayOfYear=function(){return this._week.doy},proto$1.firstDayOfWeek=function(){return this._week.dow},proto$1.weekdays=function(m,format){var weekdays=isArray(this._weekdays)?this._weekdays:this._weekdays[m&&!0!==m&&this._weekdays.isFormat.test(format)?"format":"standalone"];return!0===m?shiftWeekdays(weekdays,this._week.dow):m?weekdays[m.day()]:weekdays},proto$1.weekdaysMin=function(m){return!0===m?shiftWeekdays(this._weekdaysMin,this._week.dow):m?this._weekdaysMin[m.day()]:this._weekdaysMin},proto$1.weekdaysShort=function(m){return!0===m?shiftWeekdays(this._weekdaysShort,this._week.dow):m?this._weekdaysShort[m.day()]:this._weekdaysShort},proto$1.weekdaysParse=function(weekdayName,format,strict){var i,mom,regex;if(this._weekdaysParseExact)return handleStrictParse$1.call(this,weekdayName,format,strict);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),i=0;i<7;i++){if(mom=createUTC([2e3,1]).day(i),strict&&!this._fullWeekdaysParse[i]&&(this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(mom,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(mom,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(mom,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[i]||(regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,""),this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")),strict&&"dddd"===format&&this._fullWeekdaysParse[i].test(weekdayName))return i;if(strict&&"ddd"===format&&this._shortWeekdaysParse[i].test(weekdayName))return i;if(strict&&"dd"===format&&this._minWeekdaysParse[i].test(weekdayName))return i;if(!strict&&this._weekdaysParse[i].test(weekdayName))return i}},proto$1.weekdaysRegex=function(isStrict){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),isStrict?this._weekdaysStrictRegex:this._weekdaysRegex):(hasOwnProp(this,"_weekdaysRegex")||(this._weekdaysRegex=defaultWeekdaysRegex),this._weekdaysStrictRegex&&isStrict?this._weekdaysStrictRegex:this._weekdaysRegex)},proto$1.weekdaysShortRegex=function(isStrict){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),isStrict?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(hasOwnProp(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=defaultWeekdaysShortRegex),this._weekdaysShortStrictRegex&&isStrict?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},proto$1.weekdaysMinRegex=function(isStrict){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),isStrict?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(hasOwnProp(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=defaultWeekdaysMinRegex),this._weekdaysMinStrictRegex&&isStrict?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},proto$1.isPM=function(input){return"p"===(input+"").toLowerCase().charAt(0)},proto$1.meridiem=function(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"},getSetGlobalLocale("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10;return number+(1===toInt(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")}}),hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale),hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var mathAbs=Math.abs;function addSubtract$1(duration,input,value,direction){var other=createDuration(input,value);return duration._milliseconds+=direction*other._milliseconds,duration._days+=direction*other._days,duration._months+=direction*other._months,duration._bubble()}function absCeil(number){return number<0?Math.floor(number):Math.ceil(number)}function daysToMonths(days){return 4800*days/146097}function monthsToDays(months){return 146097*months/4800}function makeAs(alias){return function(){return this.as(alias)}}var asMilliseconds=makeAs("ms"),asSeconds=makeAs("s"),asMinutes=makeAs("m"),asHours=makeAs("h"),asDays=makeAs("d"),asWeeks=makeAs("w"),asMonths=makeAs("M"),asQuarters=makeAs("Q"),asYears=makeAs("y");function makeGetter(name){return function(){return this.isValid()?this._data[name]:NaN}}var milliseconds=makeGetter("milliseconds"),seconds=makeGetter("seconds"),minutes=makeGetter("minutes"),hours=makeGetter("hours"),days=makeGetter("days"),months=makeGetter("months"),years=makeGetter("years"),round=Math.round,thresholds={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}var abs$1=Math.abs;function sign(x){return(x>0)-(x<0)||+x}function toISOString$1(){if(!this.isValid())return this.localeData().invalidDate();var minutes,hours,years,s,totalSign,ymSign,daysSign,hmsSign,seconds=abs$1(this._milliseconds)/1e3,days=abs$1(this._days),months=abs$1(this._months),total=this.asSeconds();return total?(minutes=absFloor(seconds/60),hours=absFloor(minutes/60),seconds%=60,minutes%=60,years=absFloor(months/12),months%=12,s=seconds?seconds.toFixed(3).replace(/\.?0+$/,""):"",totalSign=total<0?"-":"",ymSign=sign(this._months)!==sign(total)?"-":"",daysSign=sign(this._days)!==sign(total)?"-":"",hmsSign=sign(this._milliseconds)!==sign(total)?"-":"",totalSign+"P"+(years?ymSign+years+"Y":"")+(months?ymSign+months+"M":"")+(days?daysSign+days+"D":"")+(hours||minutes||seconds?"T":"")+(hours?hmsSign+hours+"H":"")+(minutes?hmsSign+minutes+"M":"")+(seconds?hmsSign+s+"S":"")):"P0D"}var proto$2=Duration.prototype;return proto$2.isValid=function(){return this._isValid},proto$2.abs=function(){var data=this._data;return this._milliseconds=mathAbs(this._milliseconds),this._days=mathAbs(this._days),this._months=mathAbs(this._months),data.milliseconds=mathAbs(data.milliseconds),data.seconds=mathAbs(data.seconds),data.minutes=mathAbs(data.minutes),data.hours=mathAbs(data.hours),data.months=mathAbs(data.months),data.years=mathAbs(data.years),this},proto$2.add=function(input,value){return addSubtract$1(this,input,value,1)},proto$2.subtract=function(input,value){return addSubtract$1(this,input,value,-1)},proto$2.as=function(units){if(!this.isValid())return NaN;var days,months,milliseconds=this._milliseconds;if("month"===(units=normalizeUnits(units))||"quarter"===units||"year"===units)switch(days=this._days+milliseconds/864e5,months=this._months+daysToMonths(days),units){case"month":return months;case"quarter":return months/3;case"year":return months/12}else switch(days=this._days+Math.round(monthsToDays(this._months)),units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return 24*days+milliseconds/36e5;case"minute":return 1440*days+milliseconds/6e4;case"second":return 86400*days+milliseconds/1e3;case"millisecond":return Math.floor(864e5*days)+milliseconds;default:throw new Error("Unknown unit "+units)}},proto$2.asMilliseconds=asMilliseconds,proto$2.asSeconds=asSeconds,proto$2.asMinutes=asMinutes,proto$2.asHours=asHours,proto$2.asDays=asDays,proto$2.asWeeks=asWeeks,proto$2.asMonths=asMonths,proto$2.asQuarters=asQuarters,proto$2.asYears=asYears,proto$2.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12):NaN},proto$2._bubble=function(){var seconds,minutes,hours,years,monthsFromDays,milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data;return milliseconds>=0&&days>=0&&months>=0||milliseconds<=0&&days<=0&&months<=0||(milliseconds+=864e5*absCeil(monthsToDays(months)+days),days=0,months=0),data.milliseconds=milliseconds%1e3,seconds=absFloor(milliseconds/1e3),data.seconds=seconds%60,minutes=absFloor(seconds/60),data.minutes=minutes%60,hours=absFloor(minutes/60),data.hours=hours%24,days+=absFloor(hours/24),months+=monthsFromDays=absFloor(daysToMonths(days)),days-=absCeil(monthsToDays(monthsFromDays)),years=absFloor(months/12),months%=12,data.days=days,data.months=months,data.years=years,this},proto$2.clone=function(){return createDuration(this)},proto$2.get=function(units){return units=normalizeUnits(units),this.isValid()?this[units+"s"]():NaN},proto$2.milliseconds=milliseconds,proto$2.seconds=seconds,proto$2.minutes=minutes,proto$2.hours=hours,proto$2.days=days,proto$2.weeks=function(){return absFloor(this.days()/7)},proto$2.months=months,proto$2.years=years,proto$2.humanize=function(argWithSuffix,argThresholds){if(!this.isValid())return this.localeData().invalidDate();var locale,output,withSuffix=!1,th=thresholds;return"object"==typeof argWithSuffix&&(argThresholds=argWithSuffix,argWithSuffix=!1),"boolean"==typeof argWithSuffix&&(withSuffix=argWithSuffix),"object"==typeof argThresholds&&(th=Object.assign({},thresholds,argThresholds),null!=argThresholds.s&&null==argThresholds.ss&&(th.ss=argThresholds.s-1)),output=function(posNegDuration,withoutSuffix,thresholds,locale){var duration=createDuration(posNegDuration).abs(),seconds=round(duration.as("s")),minutes=round(duration.as("m")),hours=round(duration.as("h")),days=round(duration.as("d")),months=round(duration.as("M")),weeks=round(duration.as("w")),years=round(duration.as("y")),a=seconds<=thresholds.ss&&["s",seconds]||seconds<thresholds.s&&["ss",seconds]||minutes<=1&&["m"]||minutes<thresholds.m&&["mm",minutes]||hours<=1&&["h"]||hours<thresholds.h&&["hh",hours]||days<=1&&["d"]||days<thresholds.d&&["dd",days];return null!=thresholds.w&&(a=a||weeks<=1&&["w"]||weeks<thresholds.w&&["ww",weeks]),(a=a||months<=1&&["M"]||months<thresholds.M&&["MM",months]||years<=1&&["y"]||["yy",years])[2]=withoutSuffix,a[3]=+posNegDuration>0,a[4]=locale,substituteTimeAgo.apply(null,a)}(this,!withSuffix,th,locale=this.localeData()),withSuffix&&(output=locale.pastFuture(+this,output)),locale.postformat(output)},proto$2.toISOString=toISOString$1,proto$2.toString=toISOString$1,proto$2.toJSON=toISOString$1,proto$2.locale=locale,proto$2.localeData=localeData,proto$2.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1),proto$2.lang=lang,addFormatToken("X",0,0,"unix"),addFormatToken("x",0,0,"valueOf"),addRegexToken("x",matchSigned),addRegexToken("X",/[+-]?\d+(\.\d{1,3})?/),addParseToken("X",(function(input,array,config){config._d=new Date(1e3*parseFloat(input))})),addParseToken("x",(function(input,array,config){config._d=new Date(toInt(input))})),hooks.version="2.29.1",hookCallback=createLocal,hooks.fn=proto,hooks.min=function(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)},hooks.max=function(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)},hooks.now=function(){return Date.now?Date.now():+new Date},hooks.utc=createUTC,hooks.unix=function(input){return createLocal(1e3*input)},hooks.months=function(format,index){return listMonthsImpl(format,index,"months")},hooks.isDate=isDate,hooks.locale=getSetGlobalLocale,hooks.invalid=createInvalid,hooks.duration=createDuration,hooks.isMoment=isMoment,hooks.weekdays=function(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdays")},hooks.parseZone=function(){return createLocal.apply(null,arguments).parseZone()},hooks.localeData=getLocale,hooks.isDuration=isDuration,hooks.monthsShort=function(format,index){return listMonthsImpl(format,index,"monthsShort")},hooks.weekdaysMin=function(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysMin")},hooks.defineLocale=defineLocale,hooks.updateLocale=function(name,config){if(null!=config){var locale,tmpLocale,parentConfig=baseConfig;null!=locales[name]&&null!=locales[name].parentLocale?locales[name].set(mergeConfigs(locales[name]._config,config)):(null!=(tmpLocale=loadLocale(name))&&(parentConfig=tmpLocale._config),config=mergeConfigs(parentConfig,config),null==tmpLocale&&(config.abbr=name),(locale=new Locale(config)).parentLocale=locales[name],locales[name]=locale),getSetGlobalLocale(name)}else null!=locales[name]&&(null!=locales[name].parentLocale?(locales[name]=locales[name].parentLocale,name===getSetGlobalLocale()&&getSetGlobalLocale(name)):null!=locales[name]&&delete locales[name]);return locales[name]},hooks.locales=function(){return keys(locales)},hooks.weekdaysShort=function(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysShort")},hooks.normalizeUnits=normalizeUnits,hooks.relativeTimeRounding=function(roundingFunction){return void 0===roundingFunction?round:"function"==typeof roundingFunction&&(round=roundingFunction,!0)},hooks.relativeTimeThreshold=function(threshold,limit){return void 0!==thresholds[threshold]&&(void 0===limit?thresholds[threshold]:(thresholds[threshold]=limit,"s"===threshold&&(thresholds.ss=limit-1),!0))},hooks.calendarFormat=function(myMoment,now){var diff=myMoment.diff(now,"days",!0);return diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse"},hooks.prototype=proto,hooks.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},hooks}()}).call(this,__webpack_require__(270)(module))},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24),logger_service_1=__webpack_require__(15),settings_service_1=__webpack_require__(5),auth_service_1=__webpack_require__(2),randomString_1=__webpack_require__(219),main_service_1=__webpack_require__(26),anonymizer_1=__webpack_require__(14),$=__webpack_require__(305),XmppService=function(){function XmppService(){_classCallCheck(this,XmppService),this.rxConnectionSubject=new rxjs_1.Subject,this.rxContactSubject=new rxjs_1.Subject,this.showBodyMessage=!1,this.presenceWaitingList=[],this.xmppServerURL=null,this.stropheStatus=null,this.presenceStatus="offline",this.pingTimeout=null,this.connecting=!1,this.disconnectInfo=null,this.connectionWatcherTimout=null,this.isInitialPresenceSent=!1,this.historyHandler=null,this.bulkHistoryHandler=null,this.searchTextHandler=null,this.callLogHandler=null,this.reconnectInProgress=!1,this.reconnectionDelay=250,this.reconnectTimeout=null,this.connectivityEventSubscription=null,this.lastPingDate=null,this.started=!1,this.connection=null,this.jid=null,this.fullJid=null,this.changePasswordInfo=null,this.contactServiceReady=!1,this.connected=!1}return _createClass(XmppService,[{key:"onHandleConnectivity",value:function(online){online?(logger_service_1.default.info("[xmppService] -- onHandleConnectivityEvent -- retrieve connectivity"),this.autoReconnect(!0)):(logger_service_1.default.info("[xmppService] -- onHandleConnectivityEvent -- lost connectivity"),this.stropheStatus===Strophe.Status.CONNECTED&&(this.interruptAutoReconnect(),this.disconnect("NO_NETWORK")))}},{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee37(){var _this37=this;return regenerator_default.a.wrap((function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:if(_context38.prev=0,this.connectivityEventSubscription=main_service_1.default.subscribeToConnectivityEvents((function(online){_this37.onHandleConnectivity(online)})),auth_service_1.default.jidIm&&auth_service_1.default.jidPwd){_context38.next=3;break}throw new Error("No valid XMPP credentials");case 3:return this.xmppServerURL="".concat(config.xmpp.protocol,"://").concat(config.xmpp.currentServer,":").concat(config.xmpp.port,"/websocket"),this.showBodyMessage=settings_service_1.default.getBooleanSetting("showBodyMessage"),this.pingTimeout=config.xmpp.pingInterval?2*parseInt(config.xmpp.pingInterval,10):12e4,_context38.next=8,this.connect();case 8:this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"LOGIN"}),_context38.next=14;break;case 11:throw _context38.prev=11,_context38.t0=_context38.catch(0),logger_service_1.default.error("[xmppService] start -- FAILURE -- "+_context38.t0.message),_context38.t0;case 14:case"end":return _context38.stop()}}),_callee37,this,[[0,11]])})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee38(){return regenerator_default.a.wrap((function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:return _context39.prev=0,_context39.next=3,this.disconnect("LOGOUT");case 3:_context39.next=7;break;case 5:_context39.prev=5,_context39.t0=_context39.catch(0);case 7:this.started=!1,this.connected=!1,this.stropheStatus=null,this.presenceStatus="offline",this.fullJid=null,this.lastPingDate=null,this.connectivityEventSubscription&&(this.connectivityEventSubscription.unsubscribe(),this.connectivityEventSubscription=null);case 8:case"end":return _context39.stop()}}),_callee38,this,[[0,5]])})))}},{key:"connect",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee39(){var error,client,clientVersion,xmppDomain,iq,_this38=this;return regenerator_default.a.wrap((function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:if(_context40.prev=0,this.stropheStatus!==Strophe.Status.CONNECTING&&this.stropheStatus!==Strophe.Status.CONNECTED&&this.stropheStatus!==Strophe.Status.AUTHENTICATING){_context40.next=4;break}throw(error=new Error("XMPP service already connected or connecting")).details=this.stropheStatus===Strophe.Status.CONNECTING?"XMPP_IN_CONNECTING_STATE":"XMPP_ALREADY_CONNECTED",error;case 4:if(client=auth_service_1.default.getInformationHeadersApp(),clientVersion=auth_service_1.default.getInformationHeadersAppVersion(),xmppDomain=auth_service_1.default.xmppDomain,null!==client&&null!==clientVersion&&null!==xmppDomain){_context40.next=7;break}throw new Error("XMPP service -- Missing connection data");case 7:return this.connection=new Strophe.Connection("".concat(this.xmppServerURL,"?x-rainbow-client=").concat(client,"&x-rainbow-client-version=").concat(clientVersion,"&x-rainbow-xmpp-dom=").concat(xmppDomain)),this.connection.rawInput=function(data){_this38.handleRawXmppMessage(data,"Recv: ")},this.connection.rawOutput=function(data){_this38.handleRawXmppMessage(data,"Sent: ")},this.jid=auth_service_1.default.jidIm,this.fullJid||(this.fullJid=this.generateRandomFullJid(this.jid)),_context40.next=14,this.stropheConnect();case 14:this.connected=!0,this.connection.ping.addPingHandler((function(ping){return logger_service_1.default.info("[xmppService] -- onKeepAlivePingEvent (".concat(new Date,")")),_this38.connected&&(_this38.connection.ping.pong(ping),_this38.lastPingDate=new Date),!0})),this.addHandler((function(stanza){return _this38.onRosterChangedMessageReceived(stanza)}),"jabber:iq:roster","iq","set"),this.addHandler((function(stanza){return _this38.onMamMessageReceived(stanza)}),Strophe.NS.MAM,"message",null),this.addHandler((function(stanza){return _this38.onMamMessageReceived(stanza)}),Strophe.NS.MAM,"iq",null),this.addHandler((function(stanza){return _this38.onMamBulkMessageReceived(stanza)}),"urn:xmpp:mam:1:bulk","message",null),this.addHandler((function(stanza){return _this38.onMamBulkMessageReceived(stanza)}),"urn:xmpp:mam:1:bulk","iq",null),this.addHandler((function(stanza){return _this38.onSearchTextMessageReceived(stanza)}),"urn:xmpp:mam:tmp","message",null),this.addHandler((function(stanza){return _this38.onPresenceMessageReceived(stanza)}),null,"presence"),this.connection.jingle&&this.connection.jingle.attachHandlers(),this.presenceWaitingList=[],(iq=$iq({type:"set"})).c("enable",{xmlns:"urn:xmpp:carbons:2"}),this.sendIQ(iq),this.started=!0,_context40.next=32;break;case 29:throw _context40.prev=29,_context40.t0=_context40.catch(0),logger_service_1.default.error("[xmppService] connect -- FAILURE -- "+_context40.t0.message),_context40.t0;case 32:case"end":return _context40.stop()}}),_callee39,this,[[0,29]])})))}},{key:"disconnect",value:function(reason){var _this39=this;return new Promise((function(resolve){_this39.connected?_this39.stropheStatus===Strophe.Status.CONNECTED&&(logger_service_1.default.info("[xmppService] disconnect -- "+reason),_this39.disconnectInfo={reason:reason,resolve:resolve},_this39.connection.disconnect(reason)):(logger_service_1.default.info("[xmppService] disconnect - service is not started"),resolve())}))}},{key:"stropheConnect",value:function(){var _this40=this;return new Promise((function(resolve,reject){_this40.connecting=!0,_this40.connection.connect(_this40.fullJid,auth_service_1.default.jidPwd,(function(status){var reason=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(_this40.stropheStatus=status,status){case Strophe.Status.CONNECTING:_this40.publishConnectionEvent("ON_XMPP_CONNECTING");break;case Strophe.Status.AUTHFAIL:logger_service_1.default.error("[xmppService] -- onAuthenticationFailureEvent -- ".concat(reason," -- ").concat(_this40.fullJid)),_this40.connecting=!1,reject(new Error("Authentication failure -- "+reason));break;case Strophe.Status.CONNFAIL:if(!_this40.connecting)break;logger_service_1.default.error("[xmppService] -- onConnectionFailureEvent -- ConnectionFail -- "+_this40.fullJid),_this40.connecting=!1,reject(new Error("Connection failure -- "+reason));break;case Strophe.Status.CONNECTED:logger_service_1.default.info("[xmppService] -- onConnectedEvent -- "+_this40.fullJid),_this40.connecting=!1,resolve();break;case Strophe.Status.DISCONNECTED:if(_this40.connecting){logger_service_1.default.error("[xmppService] -- onConnectionFailureEvent -- Disconnected -- "+_this40.fullJid),reject(new Error("Connection failure -- "+reason));break}_this40.reconnectInProgress||_this40.onDisconnectEvent(reason)}}))}))}},{key:"connectionWatcher",value:function(){try{if(logger_service_1.default.error("[xmppService] -- Connection watcher : so bad, no message since "+this.pingTimeout/1e3+" seconds (no ping)"),this.connection){var message=this.stropheStatus===Strophe.Status.CONNECTED?"Have lost connectivity":"Stuck in reconnecting state";logger_service_1.default.info("[xmppService] -- Connection watcher -- "+message),this.stropheStatus=null,this.connection.disconnect("No ping")}}catch(error){logger_service_1.default.error("connectionWatcher error "+error)}}},{key:"generateRandomFullJid",value:function(jid){var OS=navigator.platform.toUpperCase().indexOf("MAC")>=0?"osx":"win",platform="desk_"+OS;return main_service_1.default.isDesktopApp()||(platform=auth_service_1.default.fromSDK?"web_sdk":"web_"+OS),"".concat(jid,"/").concat(platform,"_").concat(version,"_").concat(randomString_1.default(8))}},{key:"handleRawXmppMessage",value:function(data,direction){var _this41=this;if(this.connectionWatcherTimout&&clearTimeout(this.connectionWatcherTimout),this.connectionWatcherTimout=setTimeout((function(){_this41.connectionWatcher()}),this.pingTimeout),!(data.indexOf("<PHOTO>")>-1)){var log=direction;if(data.indexOf("urn:xmpp:mam:1:bulk")>-1)"true"===settings_service_1.default.getSetting("devMode")&&"true"===settings_service_1.default.getSetting("showBodyMessage")?log+=data:log+="Hidden content -- bulk";else if(data.indexOf("xmlns='jabber:x:bubble:conference'")>-1&&(data.indexOf("name='invitation'")>-1||data.indexOf("name='conferenceAdd'")>-1||data.indexOf("name='conferenceRemove'")>-1))log+="Hidden content";else if(data.indexOf("xmlns='urn:xmpp:jingle:1'")>-1&&(data.indexOf("displayname")>-1||data.indexOf("number")>-1))log+="Hidden content";else if(data.indexOf("urn:xmpp:janus:1")>-1&&(data.indexOf("displayName")>-1||data.indexOf("displayname")>-1||data.indexOf("number")>-1))log+="Hidden content";else if(data.indexOf("<message")>-1&&(data.indexOf("<body")>-1||data.indexOf("<content>")>-1||data.indexOf("<thumbnail")>-1))log+=this.messageBodyDiscretion(data);else{var result=data,dataElem=$(data).find("data");if(dataElem&&"http://jabber.org/protocol/ibb"===dataElem.attr("xmlns")&&(dataElem.html("Encoded file in base 64"),log+=dataElem.html()),!this.showBodyMessage){if(-1!==data.indexOf("<identity")){var firstName=data.indexOf("firstName="),firstNameIndex=data.indexOf("'",firstName);if(-1!==firstName&&-1!==firstNameIndex){var firstNameLastIndex=data.indexOf("'",firstNameIndex+1);firstNameIndex+1!==firstNameLastIndex&&(result=data.substr(0,firstNameIndex+2)+"***"+data.substr(firstNameLastIndex))}var lastName=result.indexOf("lastName="),lastNameIndex=result.indexOf("'",lastName);if(-1!==lastName&&-1!==lastNameIndex){var lastNameLastIndex=result.indexOf("'",lastNameIndex+1);lastNameIndex+1!==lastNameLastIndex&&(result=result.substr(0,lastNameIndex+2)+"***"+result.substr(lastNameLastIndex))}}if(-1!==result.indexOf("<caller_info")||-1!==result.indexOf("<callee_info")){var number=result.indexOf("number="),numberIndex=result.indexOf("'",number);if(-1!==number&&-1!==numberIndex){var numberLastIndex=result.indexOf("'",numberIndex+1);if(numberIndex+1!==numberLastIndex){var numberText=result.substr(numberIndex+1,numberLastIndex-numberIndex-1);result=result.substr(0,numberIndex+1)+anonymizer_1.default(numberText)+result.substr(numberLastIndex)}}}if(-1!==result.indexOf("<caller>")){var caller=result.indexOf("<caller>"),endCaller=result.indexOf("</caller>",caller),_numberText=result.substring(caller+8,endCaller);-1===_numberText.indexOf("@")&&-1===_numberText.indexOf("janus")&&(result=result.substr(0,caller+8)+anonymizer_1.default(_numberText)+result.substr(endCaller))}if(-1!==result.indexOf("<callee>")){var callee=result.indexOf("<callee>"),endCallee=result.indexOf("</callee>",callee),_numberText2=result.substring(callee+8,endCallee);-1===_numberText2.indexOf("@")&&-1===_numberText2.indexOf("janus")&&(result=result.substr(0,callee+8)+anonymizer_1.default(_numberText2)+result.substr(endCallee))}if(-1!==result.indexOf("<event")){var message=result.indexOf("<message>"),endMessage=result.indexOf("</message>",message);result=result.substr(0,message+9)+"***"+result.substr(endMessage)}var endpointTel=result.indexOf("endpointTel='");if(-1!==endpointTel){var endEndpointTel=result.indexOf("'",endpointTel+13),_numberText3=result.substring(endpointTel+13,endEndpointTel);result=result.substr(0,endpointTel+13)+anonymizer_1.default(_numberText3)+result.substr(endEndpointTel)}var destination=result.indexOf("destination='");if(-1!==destination){var endDestination=result.indexOf("'",destination+13),_numberText4=result.substring(destination+13,endDestination);result=result.substr(0,destination+13)+anonymizer_1.default(_numberText4)+result.substr(endDestination)}if(-1!==result.indexOf("<name>")){var _message=result.indexOf("<name>"),_endMessage=result.indexOf("</name>",_message);result=result.substr(0,_message+6)+"***"+result.substr(_endMessage)}}log+=result}logger_service_1.default.debug(log)}}},{key:"messageBodyDiscretion",value:function(data){return this.showBodyMessage?data:(data=this.messageTagDiscretion("content",data),data=this.messageTagDiscretion("body",data),data=this.messageTagDiscretion("subject",data),data=this.messageTagDiscretion("filename",data))}},{key:"messageTagDiscretion",value:function(tag,data){var startTagIndex=data.indexOf("<"+tag);if(-1!==startTagIndex){var endTagIndex=data.indexOf(">",startTagIndex),endEmptyTagIndex=data.indexOf("/>",startTagIndex);if(-1!==endTagIndex&&endTagIndex!==endEmptyTagIndex+1)return data.substr(0,endTagIndex+2)+"***"+data.substr(data.indexOf("</"+tag+">")-1)}return data}},{key:"onDisconnectEvent",value:function(reason){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee40(){return regenerator_default.a.wrap((function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:if(this.connectionWatcherTimout&&clearTimeout(this.connectionWatcherTimout),this.isInitialPresenceSent=!1,!this.started){_context41.next=23;break}if(!this.disconnectInfo){_context41.next=3;break}return _context41.abrupt("return",(logger_service_1.default.info("[xmppService] -- onDisconnectEvent -- Expected disconnection -- ".concat(this.disconnectInfo.reason," -- ").concat(this.fullJid)),this.connected=!1,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:this.disconnectInfo.reason}),this.disconnectInfo.resolve(),void(this.disconnectInfo=null)));case 3:if(!this.changePasswordInfo){_context41.next=20;break}if(this.connected=!1,!this.changePasswordInfo.fromThirdParty){_context41.next=8;break}logger_service_1.default.error("[xmppService] -- onDisconnectEvent -- Expected disconnection -- change password from third party -- "+this.fullJid),this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"3RD_PARTY_CHANGE_PWD"}),_context41.next=18;break;case 8:return logger_service_1.default.error("[xmppService] -- onDisconnectEvent -- Expected disconnection -- change password -- "+this.fullJid),_context41.prev=9,_context41.next=12,auth_service_1.default.logon(this.changePasswordInfo.login,this.changePasswordInfo.newPassword,!0);case 12:_context41.next=17;break;case 14:_context41.prev=14,_context41.t0=_context41.catch(9),this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"CHANGE_PWD_ERROR"});case 17:this.changePasswordInfo.resolve&&this.changePasswordInfo.resolve(),this.changePasswordInfo=null,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"CHANGE_PWD"}),this.autoReconnect();case 18:_context41.next=21;break;case 20:logger_service_1.default.error("[xmppService] -- onDisconnectEvent -- Unexpected disconnection -- ".concat(reason," -- ").concat(this.fullJid)),this.connected=!1,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"UNKNOWN"}),this.autoReconnect();case 21:_context41.next=24;break;case 23:logger_service_1.default.info("[xmppService] -- onDisconnectEvent -- service not started -- ignored");case 24:case"end":return _context41.stop()}}),_callee40,this,[[9,14]])})))}},{key:"interruptAutoReconnect",value:function(){var force=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.reconnectInProgress||force)&&(logger_service_1.default.info("[xmppService] interrupt auto-reconnection"),this.reconnectionDelay=250,this.reconnectInProgress=!1,this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.connectionWatcherTimout&&(logger_service_1.default.info("[xmppService] Clear connection watcher timeout"),clearTimeout(this.connectionWatcherTimout)))}},{key:"autoReconnect",value:function(){var force=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee41(){var error,_this42=this;return regenerator_default.a.wrap((function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:return _context42.prev=0,this.interruptAutoReconnect(force),logger_service_1.default.info("[xmppService] autoReconnect"),this.reconnectInProgress=!0,_context42.next=6,auth_service_1.default.startTokenSurvey();case 6:return _context42.next=8,this.connect();case 8:this.reconnectionDelay=250,this.reconnectInProgress=!1,logger_service_1.default.info("[xmppService] autoReconnect -- SUCCESS"),this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"RECONNECTION",lastActivityDate:this.lastPingDate}),_context42.next=27;break;case 14:_context42.prev=14,_context42.t0=_context42.catch(0),error=_context42.t0,_context42.t1=(_context42.t0&&_context42.t0.details||((error=new Error).details="UNKNOWN"),error.details),_context42.next="AUTH_TOKEN_EXPIRED"===_context42.t1?20:"XMPP_ALREADY_CONNECTED"===_context42.t1?22:"XMPP_IN_CONNECTING_STATE"===_context42.t1?24:26;break;case 20:return logger_service_1.default.error("[xmppService] Impossible to renew token, redirect to login page"),this.interruptAutoReconnect(),auth_service_1.default.logout(),this.reconnectInProgress=!1,_context42.abrupt("break",27);case 22:return logger_service_1.default.error("[xmppService] In auto-reconnect, but already connected -- ignore"),this.reconnectInProgress=!1,_context42.abrupt("break",27);case 24:return logger_service_1.default.error("[xmppService] xmpp is still connecting -- wait"),_context42.abrupt("break",27);case 26:this.reconnectInProgress&&(this.reconnectionDelay=2*this.reconnectionDelay,this.reconnectionDelay>15e3&&(this.reconnectionDelay=15e3),logger_service_1.default.info("[xmppService] Auto-reconnection failure (next try in "+this.reconnectionDelay+"ms)"),this.reconnectTimeout=setTimeout((function(){_this42.autoReconnect()}),this.reconnectionDelay)),this.reconnectInProgress=!1;case 27:case"end":return _context42.stop()}}),_callee41,this,[[0,14]])})))}},{key:"subscribeToContactEvents",value:function(observer){return this.rxContactSubject.subscribe(observer)}},{key:"subscribeToConnectionEvents",value:function(observer){return this.rxConnectionSubject.subscribe(observer)}},{key:"publishContactEvent",value:function(name,params){this.rxContactSubject.next(event_model_1.RBEvent.create(name,params))}},{key:"publishConnectionEvent",value:function(name){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxConnectionSubject.next(event_model_1.RBEvent.create(name,data))}},{key:"onRosterChangedMessageReceived",value:function(stanza){var _this43=this;try{return $(stanza).find("item").each((function(__index,data){var elem=$(data),jid=_this43.getBareJidFromJid(elem.attr("jid")),favorite="favorites"===elem.find("group").first().text(),sub=elem.attr("subscription"),ask=elem.attr("ask");_this43.publishContactEvent("ON_ROSTER_CHANGED_EVENT",{jid:jid,subscription:sub||"none",favorite:favorite,ask:ask||"none"})})),!0}catch(error){return!0}}},{key:"sendPresence",value:function(show,message){var auth=arguments.length>2&&void 0!==arguments[2]&&arguments[2],userOptions=arguments.length>3?arguments[3]:void 0;if(this.connection&&this.connection.send&&this.stropheStatus===Strophe.Status.CONNECTED)try{logger_service_1.default.info("Send presence "+show+" - "+message+" ("+this.jid+")");var presenceIq=$pres();presenceIq.c("priority").t("5"),presenceIq.up(),show&&"online"!==show&&presenceIq.c("show").t(show),!message||show&&"online"!==show?message&&presenceIq.up().c("status").t(message):presenceIq.c("status").t(message),!0===auth&&(show&&"online"!==show&&presenceIq.up(),presenceIq.c("application",{xmlns:"jabber:iq:application"}),presenceIq.c("appid").t(config.rainbowApiClientKey).up(),presenceIq.c("userid").t(auth_service_1.default.userId).up().up(),presenceIq.c("parameters",{xmlns:"jabber:iq:configuration"}),presenceIq.c("user_options",{alert:userOptions.alert,im:userOptions.im})),this.connection.send(presenceIq)}catch(error){return void logger_service_1.default.error("this.connection.send error : "+error)}else logger_service_1.default.error('[xmppService] Try to send "presence IQ" but no xmpp connection')}},{key:"resetPresence",value:function(status){logger_service_1.default.info("Reset presence to ".concat(this.presenceStatus," (").concat(this.jid,")")),this.sendPresence(status.show,status.status)}},{key:"onPresenceMessageReceived",value:function(presence){try{var pres=$(presence),fromJid=pres.attr("from"),fromBareJid=this.getBareJidFromJid(fromJid),namespace=pres.find("x").attr("xmlns"),ptype=pres.attr("type");if(namespace&&0===namespace.indexOf(Strophe.NS.MUC))return!0;if(pres.find("actor").length>0&&"jabber:iq:configuration"===pres.find("actor").attr("xmlns")&&(pres.find("avatar").length>0?this.publishContactEvent("ON_CONTACT_UPDATE_EVENT",{from:fromBareJid,type:"avatar"}):pres.find("data").length>0&&this.publishContactEvent("ON_CONTACT_UPDATE_EVENT",{from:fromBareJid,type:"data"}),pres.find("x").length&&"vcard-temp:x:update"===pres.find("x").attr("xmlns")&&!pres.find("delay").length))return!0;if("error"===ptype)logger_service_1.default.error("Receive error presence message");else if("subscribe"===ptype)logger_service_1.default.info("Receive subscribe from ("+fromBareJid+")");else{var presenceStatus="offline",presenceMessage="";if("unavailable"!==ptype){var show=pres.find("show").text();presenceMessage=pres.find("status").text(),presenceStatus=""===show||"chat"===show?"online":"dnd"===show?"dnd":"xa"===show?"xa":"away"}var applyCalendarPresence=pres.find("applyCalendarPresence").text(),stamp=pres.find("delay").attr("stamp"),presStamp=stamp?new Date(stamp):new Date,until=pres.find("until").text(),eventAttr={jid:fromJid,status:presenceStatus,message:presenceMessage,stamp:presStamp,until:until=until?new Date(until):null,applyCalendarPresence:applyCalendarPresence};this.isConnectedJid(fromJid)&&!this.isInitialPresenceSent&&(this.isInitialPresenceSent=!0,this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"PRESENCE"})),this.contactServiceReady?this.publishContactEvent("ON_CONTACT_PRESENCE_EVENT",eventAttr):(logger_service_1.default.info("[xmppService] Receive presence message but contact service is not ready yet"),this.presenceWaitingList.push(eventAttr))}return!0}catch(error){return!0}}},{key:"getPresenceWaitingList",value:function(){return this.presenceWaitingList}},{key:"resetPresenceWaitingList",value:function(){this.presenceWaitingList=[]}},{key:"addHistoryHandler",value:function(handler){this.historyHandler=handler}},{key:"addBulkHistoryHandler",value:function(handler){this.bulkHistoryHandler=handler}},{key:"addSearchTextHandler",value:function(handler){this.searchTextHandler=handler}},{key:"addHistoryCallLogsHandler",value:function(handler){this.callLogHandler=handler}},{key:"onMamBulkMessageReceived",value:function(stanza){try{this.bulkHistoryHandler(stanza)}catch(error){return!0}return!0}},{key:"onMamMessageReceived",value:function(stanza){try{var queryId=$(stanza).find("result").attr("queryid");return queryId||(queryId=$(stanza).find("fin").attr("queryid")),queryId&&(-1!==queryId.indexOf("tel_")||-1!==queryId.indexOf("cache_"))&&this.historyHandler?this.historyHandler(stanza):this.callLogHandler&&this.callLogHandler(stanza),!0}catch(error){return!0}}},{key:"onSearchTextMessageReceived",value:function(stanza){try{var queryId=angular.element(stanza).find("result").attr("queryid");return queryId||(queryId=angular.element(stanza).find("fin").attr("queryid")),this.searchTextHandler&&this.searchTextHandler(queryId,stanza),!0}catch(error){return!0}}},{key:"getBareJidFromJid",value:function(jid){return Strophe.getBareJidFromJid(jid)}},{key:"getResourceFromJid",value:function(jid){return Strophe.getResourceFromJid(jid)}},{key:"isMobileResource",value:function(jid){return-1!==jid.indexOf("mobile_")}},{key:"addHandler",value:function(handler,ns){var name=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,type=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this.connection.addHandler(handler,ns,name,type)}},{key:"deleteHandler",value:function(handRef){this.connection&&this.connection.deleteHandler(handRef)}},{key:"isConnectedJid",value:function(jid){return!(!jid||0===jid.length)&&jid.startsWith(this.jid)}},{key:"send",value:function(stanza){var _this44=this;return new Promise((function(resolve){try{if(!_this44.connection&&_this44.stropheStatus!==Strophe.Status.CONNECTED)throw logger_service_1.default.error('[xmppService] Try to send "stanza" but no xmpp connection'),new Error("No XMPP connection");_this44.connection.send(stanza)}catch(error){logger_service_1.default.error("[xmppService] this.connection.send error : "+error)}resolve()}))}},{key:"sendIQ",value:function(iq){var _this45=this,timeout=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(resolve,reject){try{if(!_this45.connection&&_this45.stropheStatus!==Strophe.Status.CONNECTED)throw logger_service_1.default.error('[xmppService] Try to send "iq" but no xmpp connection'),new Error("No XMPP connection");_this45.connection.sendIQ(iq,(function(data){resolve(data)}),(function(error){reject(new Error(error?error.innerHTML:"XMPP request timeout"))}),timeout&&timeout>XmppService.REQUEST_TIMEOUT?timeout:XmppService.REQUEST_TIMEOUT)}catch(error){logger_service_1.default.error("[xmppService] this.connection.sendIQ error : "+error),reject(new Error("this.connection.sendIQ error"))}}))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.xmppService||(win.rainbow.xmppService=new XmppService),win.rainbow.xmppService}}]),XmppService}();XmppService.REQUEST_TIMEOUT=1e4,exports.XmppService=XmppService,exports.default=XmppService.getInstance()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24),SettingsService=function(){function SettingsService(){_classCallCheck(this,SettingsService),this.redirectVoIP=!1,this.automaticHookOff=!1,this.automaticHookOffTime=0,this.languageCodes=null,this.defaultLanguage={label:"English",settingCode:"en",code:"en",isoCode:"en",codeMoment:"en",unicode:"1f1ec-1f1e7"},this.languages=[this.defaultLanguage,{label:"Fran\xe7ais",settingCode:"fr",code:"fr",isoCode:"fr",codeMoment:"fr",unicode:"1f1eb-1f1f7"},{label:"Catal\xe0",settingCode:"ca",code:"ca",isoCode:"ca",codeMoment:"ca",unicode:"1f1ea-1f1f8"},{label:"Czech",settingCode:"cs",code:"cs",isoCode:"cs",codeMoment:"cs",unicode:"1F1E8-1F1FF"},{label:"Deutsch",settingCode:"de",code:"de",isoCode:"de",codeMoment:"de",unicode:"1f1e9-1f1ea"},{label:"Espa\xf1ol",settingCode:"es-es",code:"es-es",isoCode:"es-ES",codeMoment:"es",unicode:"1f1ea-1f1f8"},{label:"Suomi",settingCode:"fi",code:"fi",isoCode:"fi",codeMoment:"fi",unicode:"1f1eb-1f1ee"},{label:"Italiano",settingCode:"it",code:"it",isoCode:"it",codeMoment:"it",unicode:"1f1ee-1f1f9"},{label:"\u05e2\u05d1\u05e8\u05d9\u05ea",settingCode:"he",code:"he",isoCode:"he",codeMoment:"he",unicode:"1f1ee-1f1f1"},{label:"\u65e5\u672c\u8a9e",settingCode:"ja",code:"ja",isoCode:"ja",codeMoment:"ja",unicode:"1f1ef-1f1f5"},{label:"\ud55c\uad6d\uc5b4",settingCode:"ko",code:"ko",isoCode:"ko",codeMoment:"ko",unicode:"1f1f0-1f1f7"},{label:"Nederlands",settingCode:"nl",code:"nl",isoCode:"nl",codeMoment:"nl",unicode:"1F1F3-1F1F1"},{label:"Nynorsk",settingCode:"no",code:"no",isoCode:"no",codeMoment:"nn",unicode:"1F1F3-1F1F4"},{label:"Portugu\xeas do Brasil",settingCode:"pt-br",code:"pt-BR",isoCode:"pt-BR",codeMoment:"pt-br",unicode:"1F1E7-1F1F7"},{label:"Portugu\xeas",settingCode:"pt-pt",code:"pt-PT",isoCode:"pt-PT",codeMoment:"pt",unicode:"1F1F5-1F1F9"},{label:"Polski",settingCode:"pl",code:"pl",isoCode:"pl",codeMoment:"pl",unicode:"1F1F5-1F1F1"},{label:"P\u0443\u0441\u0441\u043a\u0438\u0439",settingCode:"ru",code:"ru",isoCode:"ru",codeMoment:"ru",unicode:"1F1F7 1F1FA"},{label:"Svenskt",settingCode:"sv-se",code:"sv-SE",isoCode:"sv-SE",codeMoment:"sv",unicode:"1F1F8-1F1EA"},{label:"T\xfcrk\xe7e",settingCode:"tr",code:"tr",isoCode:"tr",codeMoment:"tr",unicode:"1f1f9-1f1f7"},{label:"\u4e2d\u6587",settingCode:"zh-cn",code:"zh-cn",isoCode:"zh-CN",codeMoment:"zh-cn",unicode:"1f1e8-1f1f3"},{label:"\u7e41\u9ad4\u4e2d\u6587",settingCode:"zh-tw",code:"zh-TW",isoCode:"zh-TW",codeMoment:"zh-tw",unicode:"1F1F9-1F1FC"},{label:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",settingCode:"ar",code:"ar",isoCode:"ar",codeMoment:"ar",unicode:"0600\u201306FF"}],this.settings={init:!0,lang:"en",imSound:"true",imNotif:"true",displayOrder:"FL",nbMaxConversations:"100",microphone:"default",headsetMicrophone:null,speakerphoneMicrophone:null,customMicrophone:null,headsetDeviceName:null,speakerphoneDeviceName:null,speaker:"default",headsetSpeaker:null,speakerphoneSpeaker:null,customSpeaker:null,ringingSpeaker:"default",ringingSpeakerName:"",camera:"default",cameraUsed:"",audioProfile:"handfree",currentDevice:null,iceConfig:null,sdk:!1,userWiewOrderType:"lastname",userWiewFilterType:"all",autoStartAnimatedGif:"false",fixedLayout:"false",theme:"default",translationMsg:"false",newUI:"false",autoAcceptRoomInvite:"false",server:null,activeAlarm:"relax1",activeNotif:"stairs",devMode:"false",hasSecondRinger:"false",validationMode:"false",disableCalendarPresence:"false",deviceList:"[]",displayFilesType:"filesListCell--as-grid",displayRoomsAsGrid:"true",handFreeInputDeviceName:null,handFreeOutputDeviceName:null,customSpeakerName:null,customMicrophoneName:null,showBodyMessage:"false",bubblesFilterType:"all",bubblesOrderType:"lastActivityDate",webinarsFilterType:"all",webinarsOrderType:"lastActivityDate",displayWebinarsAsGrid:"false",protectionAgainstMailTypeOffline:!1,channelMarkdown:"false",chrisPrankMode:"true",joinSfuSound:"true",searchFilterValue:"NoFiltering",enableSingleSignOnWebAuthPopup:"false",enableSingleSignOnConfig:"false",extension:"false",enableDSCP:!1,filterIce:!1,dtx:!1,simulcast:!1,debugWebRTC:!1,unifiedPlan:!1,sipWiseMode:"false",fontSize:"62.5%",lastInactiveBubbleShownDate:null,meetingsOrderType:"lastActivityDate",meetingsFilterType:"all",filesOrderBy:"date",filesFilterBy:"all",enterKeyAction:"enterSend",activeTalker:!1,forceConsoleLog:!1,sfuJoinBundle:!1,geoip:"",applyCalendarPresence:!1,informationImSound:"ding",importantImSound:"important",emergencyImSound:"emergency"},this.updateSubject=new rxjs_1.Subject}return _createClass(SettingsService,[{key:"configure",value:function(){var _this46=this,defaultLanguage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.redirectVoIP="true"===localStorage.getItem("redirectVoIP"),this.languageCodes=this.languages.map((function(language){return language.settingCode}));var localSettings=this.getLocalStorageSettings();if(localSettings.init)defaultLanguage&&(localSettings.lang=this.getMappedLanguage(defaultLanguage),this.setAppliLanguageCode(localSettings.lang)),Object.keys(localSettings).forEach((function(key){null!==localSettings[key]&&(_this46.settings[key]=localSettings[key])}));else{var browser=navigator,browserLanguage=browser.languages?browser.languages[0]:browser.language||browser.userLanguage,preferredLanguage=defaultLanguage||browserLanguage;this.settings.lang=this.getMappedLanguage(preferredLanguage),this.setAppliLanguageCode(this.settings.lang),Object.keys(this.settings).forEach((function(key){localStorage.setItem(key,_this46.settings[key])}))}this.sendUpdateEvent(event_model_1.RBEvent.create("SETTINGS_UPDATED"))}},{key:"setSetting",value:function(key,value){this.settings[key]=value,localStorage.setItem(key,value)}},{key:"getSetting",value:function(key){return this.settings[key]}},{key:"getBooleanSetting",value:function(key){return"true"===this.settings[key]}},{key:"sendUpdateEvent",value:function(event){this.updateSubject.next(event)}},{key:"subscribeUpdateEvent",value:function(eventName,handler){return this.updateSubject.subscribe((function(event){event.name===eventName&&handler(event.data)}))}},{key:"getLocalStorageSettings",value:function(){var settings={};return Object.keys(this.settings).forEach((function(key){settings[key]=localStorage.getItem(key)})),settings.nbMaxConversations?parseInt(settings.nbMaxConversations,10)<15&&this.setSetting("nbMaxConversations","15"):settings.nbMaxConversations=this.settings.nbMaxConversations,"default"===settings.headsetMicrophone&&(settings.headsetMicrophone=null),"default"===settings.headsetSpeaker&&(settings.headsetSpeaker=null),"default"===settings.speakerphoneMicrophone&&(settings.speakerphoneMicrophone=null),"default"===settings.speakerphoneSpeaker&&(settings.speakerphoneSpeaker=null),"default"===settings.customMicrophone&&(settings.customMicrophone=null),"default"===settings.customSpeaker&&(settings.customSpeaker=null),settings}},{key:"getRedirectVoIP",value:function(){return this.redirectVoIP}},{key:"setRedirectVoIP",value:function(redirectVoIP){this.redirectVoIP=redirectVoIP,localStorage.setItem("redirectVoIP",redirectVoIP.toString())}},{key:"isAutomaticHookOff",value:function(){return this.automaticHookOff}},{key:"setAutomaticHookOff",value:function(isActivated){this.automaticHookOff=isActivated}},{key:"getAutomaticHookOffTime",value:function(){return this.automaticHookOffTime}},{key:"setAutomaticHookOffTime",value:function(milliseconds){this.automaticHookOffTime=milliseconds}},{key:"setIceConfig",value:function(iceConfig){this.settings.iceConfig=iceConfig}},{key:"getAvailableLanguages",value:function(){return this.languages}},{key:"getAppliLanguage",value:function(){var _this47=this;return this.languages.filter((function(lang){return lang.settingCode===_this47.settings.lang}))[0]||this.defaultLanguage}},{key:"getAppliLanguageCodeForServer",value:function(){var langArray=this.settings.lang.split("-");return 1===langArray.length?this.settings.lang:langArray[0]+"-"+langArray[1].toUpperCase()}},{key:"setAppliLangageCodeFromServer",value:function(serverCode){var langArray=serverCode.split("-"),clientCode=langArray[0];clientCode&&(clientCode=clientCode.toLowerCase()),2===langArray.length&&(clientCode+="-"+langArray[1].toLowerCase()),clientCode=this.getMappedLanguage(clientCode),clientCode=this.languageCodes.indexOf(clientCode)>=0?clientCode:"en",this.setAppliLanguageCode(clientCode)}},{key:"setAppliLanguageCode",value:function(lang){var save=arguments.length>1&&void 0!==arguments[1]&&arguments[1];save?this.setSetting("lang",lang):this.settings.lang=lang,this.sendUpdateEvent(event_model_1.RBEvent.create("LANGUAGE_UPDATED",lang))}},{key:"getBestLanguageForIsoCode",value:function(isoCode){var language=this.getLanguageByIsoCode(isoCode);if(language)return language;if(-1!==isoCode.indexOf("-")){var isoLanguageWithoutCountry=isoCode.split("-")[0];return this.getLanguageByIsoCode(isoLanguageWithoutCountry)}return this.getLanguageByIsoCode("en")}},{key:"getLanguageByIsoCode",value:function(isoCode){return this.languages.find((function(lang){return lang.isoCode===isoCode}))}},{key:"getMappedLanguage",value:function(codedLanguage){if(!codedLanguage)return"en";var codedLang=codedLanguage.toLowerCase();switch(codedLang.split("-")[0]){case"ar":return"ar";case"ca":return"ca";case"cs":return"cs";case"en":return"en";case"fr":return"fr";case"de":return"de";case"es":return"es-es";case"fi":return"fi";case"it":return"it";case"he":return"he";case"ja":return"ja";case"ko":return"ko";case"nl":return"nl";case"no":return"no";case"pt":return"pt-br"===codedLang?"pt-br":"pt-pt";case"pl":return"pl";case"ru":return"ru";case"sv":return"sv-se";case"tr":return"tr";case"zh":return["zh-cn","zh-tw"].indexOf(codedLang)>=0?codedLang:"zh-cn";default:return"en"}}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.settingsService||(win.rainbow.settingsService=new SettingsService),win.rainbow.settingsService}}]),SettingsService}();exports.SettingsService=SettingsService,exports.default=SettingsService.getInstance()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),logger_service_1=__webpack_require__(15),rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24),offer_model_1=__webpack_require__(315),contact_service_1=__webpack_require__(1),ProfileService=function(){function ProfileService(){_classCallCheck(this,ProfileService),this.FeaturesEnum={COMPANY_ADMIN_COUNT:"COMPANY_ADMIN_COUNT",COMPANY_LOGO_MODIFICATION:"COMPANY_LOGO_MODIFICATION",COMPANY_DOMAIN_NAME_MODIFICATION:"COMPANY_DOMAIN_NAME_MODIFICATION",COMPANY_DETAILS_MODIFICATION:"COMPANY_DETAILS_MODIFICATION",COMPANY_SINGLE_SIGN_ON_SAML:"COMPANY_SINGLE_SIGN_ON_SAML",COMPANY_SINGLE_SIGN_ON_OIDC:"COMPANY_SINGLE_SIGN_ON_OIDC",WEBRTC_FOR_MOBILE:"WEBRTC_FOR_MOBILE",BUBBLE_PARTICIPANT_COUNT:"BUBBLE_PARTICIPANT_COUNT",TELEPHONY_BASIC_CALL:"TELEPHONY_BASIC_CALL",TELEPHONY_SECOND_CALL:"TELEPHONY_SECOND_CALL",TELEPHONY_TRANSFER_CALL:"TELEPHONY_TRANSFER_CALL",TELEPHONY_CONFERENCE_CALL:"TELEPHONY_CONFERENCE_CALL",TELEPHONY_DEFLECT_CALL:"TELEPHONY_DEFLECT_CALL",TELEPHONY_PHONE_BOOK:"TELEPHONY_PHONE_BOOK",TELEPHONY_VOICE_MAIL:"TELEPHONY_VOICE_MAIL",TELEPHONY_CALL_FORWARD:"TELEPHONY_CALL_FORWARD",TELEPHONY_NOMADIC:"TELEPHONY_NOMADIC",CONFERENCE_PARTICIPANT_COUNT:"CONFERENCE_PARTICIPANT_COUNT",WEBRTC_CONFERENCE_ALLOWED:"WEBRTC_CONFERENCE_ALLOWED",WEBRTC_CONFERENCE_PARTICIPANT_COUNT:"WEBRTC_CONFERENCE_PARTICIPANT_COUNT",WEBRTC_PARTICIPANT_ALLOWED:"WEBRTC_PARTICIPANT_ALLOWED",CONFERENCE_ALLOWED:"CONFERENCE_ALLOWED",CONFERENCE_DIAL_OUT:"CONFERENCE_DIAL_OUT",CONFERENCE_RECORDING:"CONFERENCE_RECORDING",MSO365_CALENDAR_PRESENCE:"MSO365_CALENDAR_PRESENCE",MSO365_DIRECTORY_PROVISIONING:"MSO365_DIRECTORY_PROVISIONING",MSO365_DIRECTORY_SEARCH:"MSO365_DIRECTORY_SEARCH",MSO365_CONTACT_SEARCH:"MSO365_CONTACT_SEARCH",MS_OUTLOOK_PLUGIN:"MS_OUTLOOK_PLUGIN",MS_SKYPE_PLUGIN:"MS_SKYPE_PLUGIN",FILE_SHARING_QUOTA_GB:"FILE_SHARING_QUOTA_GB",GOOGLE_CALENDAR_PRESENCE:"GOOGLE_CALENDAR_PRESENCE",WEBRTC_P2P_RECORDING:"WEBRTC_P2P_RECORDING",BUBBLE_PROMOTE_MEMBER:"BUBBLE_PROMOTE_MEMBER",BUBBLE_GUESTS_ALLOWED:"BUBBLE_GUESTS_ALLOWED",BUBBLE_ACTIVE_SPEAKER:"BUBBLE_ACTIVE_SPEAKER",TELEPHONY_WEBRTC_GATEWAY:"TELEPHONY_WEBRTC_GATEWAY",TELEPHONY_WEBRTC_PSTN_CALLING:"TELEPHONY_WEBRTC_PSTN_CALLING",ANALYTICS_DASHBOARD_EC:"ANALYTICS_DASHBOARD_EC",ANALYTICS_DASHBOARD_BP:"ANALYTICS_DASHBOARD_BP",TELEPHONY_CALL_SUBJECT:"CALL_SUBJECT",CHANNEL_CREATE:"CHANNEL_CREATE",CHANNEL_CREATE_ADMIN_ROLE_BYPASS:"CHANNEL_CREATE_ADMIN_ROLE_BYPASS",CHANNEL_ACTIVATED:"CHANNEL_ACTIVATED",MANAGE_ANDROID_TV:"MANAGE_ANDROID_TV",USE_ANDROID_TV:"USE_ANDROID_TV",MASSPRO_USER_PROVISIONING_CSV:"MASSPRO_USER_PROVISIONING_CSV",SEARCH_BY_TAGS:"SEARCH_BY_TAGS",TELEPHONY_3DPARTY_ASSOC:"TELEPHONY_3DPARTY_ASSOC",WEBCLIENT_UI_2_0:"WEBCLIENT_UI_2_0",WEBRTC_UNIFIED_PLAN:"WEBRTC_UNIFIED_PLAN",WEBRTC_CONFERENCE_SIMULCAST:"WEBRTC_CONFERENCE_SIMULCAST",USE_CLOUD_PBX:"USE_CLOUD_PBX",USE_OXO_MANAGED_PBX:"USE_OXO_MANAGED_PBX",SOFTPHONE_MODE_ONLY:"SOFTPHONE_MODE_ONLY",GIVE_REQUEST_REMOTE_CONTROL:"GIVE_REQUEST_REMOTE_CONTROL",BUBBLE_MAX_LOAD_STARTUP:"BUBBLE_MAX_LOAD_STARTUP",BUBBLE_COUNT:"BUBBLE_COUNT",BUBBLE_MEETING_SCHEDULER:"BUBBLE_MEETING_SCHEDULER",BUBBLE_TALKING_TIME:"BUBBLE_TALKING_TIME",APP_PERMISSIONS:"APP_PERMISSIONS",FREE_UI_CUSTOMIZATION:"FREE_UI_CUSTOMIZATION",PREMIUM_UI_CUSTOMIZATION:"PREMIUM_UI_CUSTOMIZATION",TELEPHONY_MAKE_CALL_CTI_APP:"TELEPHONY_MAKE_CALL_CTI_APP",CLOUD_PBX_WELCOME:"CLOUD_PBX_WELCOME",BUBBLE_TAG_COUNT:"BUBBLE_TAG_COUNT",TELEPHONY_CCD_AGENT:"TELEPHONY_CCD_AGENT",ALERT_NOTIFICATIONS_ALLOWED:"ALERT_NOTIFICATIONS_ALLOWED",BUBBLE_FOLDER_COUNT:"BUBBLE_FOLDER_COUNT"},this.started=!1,this.features={},this.profiles=[],this.mainOffers=[],this.thirdPartyApps=null,this.profileEventHandler=null,this.rxSubject=new rxjs_1.Subject,this.timer=null,this.contactService=contact_service_1.default}return _createClass(ProfileService,[{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee42(){return regenerator_default.a.wrap((function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:return _context43.prev=0,logger_service_1.default.info(""),logger_service_1.default.info("[profileService] === STARTING ==="),this.attachHandlers(),_context43.next=6,this.getServerProfile();case 6:this.started=!0,logger_service_1.default.info("[profileService] === STARTED ==="),this.rxSubject.next(event_model_1.RBEvent.create("ON_PROFILE_FEATURES_UPDATED")),_context43.next=14;break;case 11:throw _context43.prev=11,_context43.t0=_context43.catch(0),logger_service_1.default.info("[profileService] === STARTING FAILURE === "+_context43.t0.message),_context43.t0;case 14:case"end":return _context43.stop()}}),_callee42,this,[[0,11]])})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee43(){return regenerator_default.a.wrap((function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:logger_service_1.default.info("[profileService] === STOPPING ==="),this.detachHandlers(),this.started=!1,logger_service_1.default.info("[profileService] === STOPPED ===");case 1:case"end":return _context44.stop()}}),_callee43,this)})))}},{key:"restart",value:function(){logger_service_1.default.info("[profileService] === RESTART ==="),this.attachHandlers(),this.onUserUpdateNeeded()}},{key:"subscribe",value:function(handler){return this.rxSubject.subscribe(handler)}},{key:"attachHandlers",value:function(){var _this48=this;this.detachHandlers(),logger_service_1.default.info("[profileService] attachHandlers"),this.profileEventHandler=xmpp_service_1.default.addHandler((function(stanza){return _this48.onManagementMessageReceived(stanza)}),null,"message","management")}},{key:"detachHandlers",value:function(){logger_service_1.default.info("[profileService] detachHandlers"),this.profileEventHandler&&(xmpp_service_1.default.deleteHandler(this.profileEventHandler),this.profileEventHandler=null)}},{key:"onManagementMessageReceived",value:function(stanza){try{var userprofileElem=$(stanza).find("userprofile");if(logger_service_1.default.info("[profileService] onManagementMessageReceived  -- on userprofile management message received"),userprofileElem.length)switch(userprofileElem.attr("action")){case"create":case"update":case"delete":this.onUserUpdateNeeded();break;default:logger_service_1.default.info("[profileService] onManagementMessageReceived  -- unknown action")}return!0}catch(error){return logger_service_1.default.error("[profileService] onManagementMessageReceived ERROR "+error),!0}}},{key:"onUserUpdateNeeded",value:function(){var _this49=this;this.timer||(this.timer=setTimeout((function(){return __awaiter(_this49,void 0,void 0,regenerator_default.a.mark((function _callee44(){return regenerator_default.a.wrap((function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:return _context45.prev=0,_context45.next=3,this.getServerProfile();case 3:this.rxSubject.next(event_model_1.RBEvent.create("ON_PROFILE_FEATURES_UPDATED")),this.timer=null,_context45.next=10;break;case 7:_context45.prev=7,_context45.t0=_context45.catch(0),this.timer=null,logger_service_1.default.info("[profileService] === onUserUpdateNeeded FAILURE === "+_context45.t0.message);case 10:case"end":return _context45.stop()}}),_callee44,this,[[0,7]])})))}),3e3))}},{key:"getServerProfile",value:function(){return Promise.all([this.getServerProfiles(),this.getServerProfilesFeatures()])}},{key:"getServerProfiles",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee45(){var url,headers,response,responseData,errorMessage,_this50=this;return regenerator_default.a.wrap((function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:return _context46.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/profiles"),headers=auth_service_1.default.getRequestHeader(),_context46.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context46.sent).ok){_context46.next=8;break}throw response;case 8:return _context46.next=10,response.json();case 10:responseData=_context46.sent,this.profiles=[],this.mainOffers=[],responseData.data.forEach((function(profileData){logger_service_1.default.debug("[profileService] getServerProfiles === response === "+profileData),_this50.profiles.push(profileData);var offer=offer_model_1.Offer.createFromProfileData(profileData);(offer.isExclusive||offer.isDefault)&&_this50.mainOffers.push(offer)})),this.mainOffers.sort(offer_model_1.Offer.offerComparator),_context46.next=18;break;case 14:throw _context46.prev=14,_context46.t0=_context46.catch(0),errorMessage="getServerProfiles failure: no server response",_context46.t0&&(errorMessage="getServerProfiles failure: "+JSON.stringify(_context46.t0)),logger_service_1.default.error("[profileService] "+errorMessage),new Error(errorMessage);case 18:case"end":return _context46.stop()}}),_callee45,this,[[0,14]])})))}},{key:"getServerProfilesFeatures",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee46(){var url,headers,response,responseData,errorMessage,_this51=this;return regenerator_default.a.wrap((function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:return _context47.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/profiles/features"),headers=auth_service_1.default.getRequestHeader(),_context47.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context47.sent).ok){_context47.next=8;break}throw response;case 8:return _context47.next=10,response.json();case 10:responseData=_context47.sent,this.features={},responseData.data.forEach((function(featureData){logger_service_1.default.debug("[profileService] getServerProfilesFeatures === response === "+JSON.stringify(featureData)),featureData.hasOwnProperty("featureUniqueRef")&&(_this51.features[featureData.featureUniqueRef]=featureData)})),_context47.next=18;break;case 14:throw _context47.prev=14,_context47.t0=_context47.catch(0),errorMessage="getServerProfilesFeatures failure: no server response",_context47.t0&&(errorMessage="getServerProfilesFeatures failure: "+JSON.stringify(_context47.t0)),logger_service_1.default.error("[profileService] "+errorMessage),new Error(errorMessage);case 18:case"end":return _context47.stop()}}),_callee46,this,[[0,14]])})))}},{key:"isFeatureEnabled",value:function(featureUniqueRef){var features=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return features||(features=this.features),!(!config.urgencyNotifReceptionForced||"ALERT_NOTIFICATIONS_ALLOWED"!==featureUniqueRef)||(this.started&&features.hasOwnProperty(featureUniqueRef)&&features[featureUniqueRef].hasOwnProperty("featureType")&&"boolean"===features[featureUniqueRef].featureType&&features[featureUniqueRef].hasOwnProperty("isEnabled")?features[featureUniqueRef].isEnabled:(logger_service_1.default.info("[profileService] isFeatureEnabled("+featureUniqueRef+"): service not started or feature not enabled"),!1))}},{key:"getFeatureLimitMax",value:function(featureUniqueRef){if(this.started&&this.features.hasOwnProperty(featureUniqueRef)&&this.features[featureUniqueRef].hasOwnProperty("featureType")&&"number"===this.features[featureUniqueRef].featureType&&this.features[featureUniqueRef].hasOwnProperty("limitMax")){var limitMax=this.features[featureUniqueRef].limitMax;return logger_service_1.default.debug("[profileService] getFeatureLimitMax("+featureUniqueRef+"): "+limitMax),limitMax}return logger_service_1.default.info("[profileService] getFeatureLimitMax("+featureUniqueRef+"): service not started or feature not enabled"),0}},{key:"getFeatureLimitMin",value:function(featureUniqueRef){if(this.started&&this.features.hasOwnProperty(featureUniqueRef)&&this.features[featureUniqueRef].hasOwnProperty("featureType")&&"number"===this.features[featureUniqueRef].featureType&&this.features[featureUniqueRef].hasOwnProperty("limitMin")){var limitMin=this.features[featureUniqueRef].limitMin;return logger_service_1.default.debug("[profileService] getFeatureLimitMin("+featureUniqueRef+"): "+limitMin),limitMin}return logger_service_1.default.info("[profileService] getFeatureLimitMin("+featureUniqueRef+"): service not started or feature not enabled"),0}},{key:"getMyProfileOffer",value:function(){return this.mainOffers.length>0?this.mainOffers.slice(-1)[0]:null}},{key:"getMyProfileName",value:function(){var profile=this.getMyProfileOffer();return profile?profile.name:null}},{key:"getMyProfiles",value:function(){var profiles=[];return this.started?profiles=this.profiles:logger_service_1.default.warn("[profileService] getMyProfiles(): service not started"),profiles}},{key:"getMyProfileFeatures",value:function(){var _this52=this,profileFeatures={};return this.started?Object.keys(this.features).forEach((function(featureUniqueRef){var originalFeature=_this52.features[featureUniqueRef],feature={};Object.keys(originalFeature).filter((function(featureProperty){return"featureUniqueRef"===featureProperty||"featureType"===featureProperty||"limitMin"===featureProperty||"limitMax"===featureProperty||"isEnabled"===featureProperty})).forEach((function(featureProperty){feature[featureProperty]=originalFeature[featureProperty]})),profileFeatures[featureUniqueRef]=feature})):logger_service_1.default.warn("[profileService] getMyProfileFeatures(): service not started"),profileFeatures}},{key:"getThirdPartyApps",value:function(){var force=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee47(){var url,headers,response,responseData,errorMessage;return regenerator_default.a.wrap((function(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:if(_context48.prev=0,null===this.thirdPartyApps||force){_context48.next=3;break}return _context48.abrupt("return",(logger_service_1.default.info("[profileService] getThirdPartyApps -- from cache"),this.thirdPartyApps));case 3:return url=config.restServerUrl+"/api/rainbow/authentication/v1.0/oauth/tokens?format=medium",headers=auth_service_1.default.getRequestHeader(),_context48.next=7,fetch(url,{method:"GET",headers:headers});case 7:if((response=_context48.sent).ok){_context48.next=10;break}throw response;case 10:return _context48.next=12,response.json();case 12:return responseData=_context48.sent,_context48.abrupt("return",(logger_service_1.default.info("[profileService] getThirdPartyApps from server -- success"),this.thirdPartyApps=responseData&&responseData.data?responseData.data:[],this.thirdPartyApps));case 16:throw _context48.prev=16,_context48.t0=_context48.catch(0),errorMessage="getThirdPartyApps from server failed -- no answer from server",_context48.t0&&(errorMessage="getThirdPartyApps from server failed -- "+JSON.stringify(_context48.t0)),logger_service_1.default.error("[profileService] "+errorMessage),new Error(errorMessage);case 20:case"end":return _context48.stop()}}),_callee47,this,[[0,16]])})))}},{key:"revokeThirdPartyAccess",value:function(tokenId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee48(){var url,headers,response,responseData,errorMessage,_this53=this;return regenerator_default.a.wrap((function(_context49){for(;;)switch(_context49.prev=_context49.next){case 0:if(_context49.prev=0,tokenId){_context49.next=3;break}throw logger_service_1.default.warn("[profileService] revokeThirdPartyAccess missing token"),new Error("No tokenId");case 3:return logger_service_1.default.info("[profileService] revokeThirdPartyAccess with token -- "+tokenId),url="".concat(config.restServerUrl,"/api/rainbow/authentication/v1.0/oauth/tokens/").concat(tokenId),headers=auth_service_1.default.getRequestHeader(),_context49.next=8,fetch(url,{method:"DELETE",headers:headers});case 8:if((response=_context49.sent).ok){_context49.next=11;break}throw response;case 11:return _context49.next=13,response.json();case 13:return responseData=_context49.sent,_context49.abrupt("return",(logger_service_1.default.info("[profileService] revokeThirdPartyAccess -- success"),this.thirdPartyApps=responseData&&responseData.data?responseData.data:[],this.thirdPartyApps.forEach((function(app,index){app.id===tokenId&&_this53.thirdPartyApps.splice(index,1)})),this.thirdPartyApps));case 17:throw _context49.prev=17,_context49.t0=_context49.catch(0),errorMessage="revokeThirdPartyAccess from server failed -- no answer from server",_context49.t0&&(errorMessage="revokeThirdPartyAccess from server failed -- "+JSON.stringify(_context49.t0)),logger_service_1.default.error("[profileService] "+errorMessage),new Error(errorMessage);case 21:case"end":return _context49.stop()}}),_callee48,this,[[0,17]])})))}},{key:"getProfilesByName",value:function(name){return this.profiles.filter((function(profile){return-1!==profile.profileName.toLowerCase().indexOf(name)}))}},{key:"setUserData",value:function(params){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee49(){var url,headers,body,response,responseData,errorMessage;return regenerator_default.a.wrap((function(_context50){for(;;)switch(_context50.prev=_context50.next){case 0:return _context50.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(contact_service_1.default.userContact.dbId),headers=auth_service_1.default.getPostHeader(),body=JSON.stringify(params),_context50.next=6,fetch(url,{method:"PUT",headers:headers,body:body});case 6:if((response=_context50.sent).ok){_context50.next=9;break}throw response;case 9:return _context50.next=11,response.json();case 11:return responseData=_context50.sent,_context50.abrupt("return",(logger_service_1.default.info("[profileService] setUserData ".concat(body," -- success")),responseData));case 15:throw _context50.prev=15,_context50.t0=_context50.catch(0),errorMessage="setUserData failure: no server response",_context50.t0&&(errorMessage="setUserData failure: "+JSON.stringify(_context50.t0)),logger_service_1.default.error("[profileService] "+errorMessage),new Error(errorMessage);case 19:case"end":return _context50.stop()}}),_callee49,null,[[0,15]])})))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.profileService||(win.rainbow.profileService=new ProfileService),win.rainbow.profileService}}]),ProfileService}();exports.ProfileService=ProfileService,exports.default=ProfileService.getInstance()},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return __extends}));var _extendStatics=function(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};function __extends(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}},function(module,__webpack_exports__,__webpack_require__){var canReportError=__webpack_require__(51),Subscriber=__webpack_require__(11),rxSubscriber=__webpack_require__(41),Observer=__webpack_require__(53),observable=__webpack_require__(29),pipe=__webpack_require__(62),config=__webpack_require__(21);__webpack_require__.d(__webpack_exports__,"a",(function(){return Observable_Observable}));var Observable_Observable=function(){function Observable(subscribe){this._isScalar=!1,subscribe&&(this._subscribe=subscribe)}return Observable.prototype.lift=function(operator){var observable=new Observable;return observable.source=this,observable.operator=operator,observable},Observable.prototype.subscribe=function(observerOrNext,error,complete){var operator=this.operator,sink=function(nextOrObserver,error,complete){if(nextOrObserver){if(nextOrObserver instanceof Subscriber.a)return nextOrObserver;if(nextOrObserver[rxSubscriber.a])return nextOrObserver[rxSubscriber.a]()}return nextOrObserver||error||complete?new Subscriber.a(nextOrObserver,error,complete):new Subscriber.a(Observer.a)}(observerOrNext,error,complete);if(operator?sink.add(operator.call(sink,this.source)):sink.add(this.source||config.a.useDeprecatedSynchronousErrorHandling&&!sink.syncErrorThrowable?this._subscribe(sink):this._trySubscribe(sink)),config.a.useDeprecatedSynchronousErrorHandling&&sink.syncErrorThrowable&&(sink.syncErrorThrowable=!1,sink.syncErrorThrown))throw sink.syncErrorValue;return sink},Observable.prototype._trySubscribe=function(sink){try{return this._subscribe(sink)}catch(err){config.a.useDeprecatedSynchronousErrorHandling&&(sink.syncErrorThrown=!0,sink.syncErrorValue=err),Object(canReportError.a)(sink)?sink.error(err):console.warn(err)}},Observable.prototype.forEach=function(next,promiseCtor){var _this=this;return new(promiseCtor=getPromiseCtor(promiseCtor))((function(resolve,reject){var subscription;subscription=_this.subscribe((function(value){try{next(value)}catch(err){reject(err),subscription&&subscription.unsubscribe()}}),reject,resolve)}))},Observable.prototype._subscribe=function(subscriber){var source=this.source;return source&&source.subscribe(subscriber)},Observable.prototype[observable.a]=function(){return this},Observable.prototype.pipe=function(){for(var operations=[],_i=0;_i<arguments.length;_i++)operations[_i]=arguments[_i];return 0===operations.length?this:Object(pipe.b)(operations)(this)},Observable.prototype.toPromise=function(promiseCtor){var _this=this;return new(promiseCtor=getPromiseCtor(promiseCtor))((function(resolve,reject){var value;_this.subscribe((function(x){return value=x}),(function(err){return reject(err)}),(function(){return resolve(value)}))}))},Observable.create=function(subscribe){return new Observable(subscribe)},Observable}();function getPromiseCtor(promiseCtor){if(promiseCtor||(promiseCtor=config.a.Promise||Promise),!promiseCtor)throw new Error("no Promise impl found");return promiseCtor}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var sdkConfig_1=__webpack_require__(39),rainbowLogger=new(function(){function _class(){_classCallCheck(this,_class)}return _createClass(_class,[{key:"sdk",value:function(message){if(sdkConfig_1.sdkConfig.verboseLog){var date=(new Date).toUTCString();message=message||"",console.log("%c"+date+" | Rainbow Web SDK  | "+message,"color:green")}}},{key:"webrtc",value:function(message){if(sdkConfig_1.sdkConfig.verboseLog){var date=(new Date).toUTCString();console.log("%c"+date+" | RTCWEB | "+message,"color:green")}}},{key:"info",value:function(message){if(sdkConfig_1.sdkConfig.verboseLog){var date=(new Date).toUTCString();console.info("%c"+date+" | Rainbow Web SDK  | "+message,"color:green")}}},{key:"error",value:function(message){if(sdkConfig_1.sdkConfig.verboseLog){var date=(new Date).toUTCString();console.error("%c"+date+" | Rainbow Web SDK  | "+message,"color:green")}}},{key:"debug",value:function(message){if(sdkConfig_1.sdkConfig.verboseLog){var date=(new Date).toUTCString();console.debug("%c"+date+" | Rainbow Web SDK  | "+message,"color:green")}}},{key:"time",value:function(timerName){sdkConfig_1.sdkConfig.measurePerformance&&console.time(timerName)}},{key:"timeLog",value:function(timerName){sdkConfig_1.sdkConfig.measurePerformance&&console.timeLog(timerName)}},{key:"timeEnd",value:function(timerName){sdkConfig_1.sdkConfig.measurePerformance&&console.timeEnd(timerName)}}]),_class}());exports.rainbowLogger=rainbowLogger},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var Observable=__webpack_require__(8),tslib_es6=__webpack_require__(7),Subject=__webpack_require__(23),Subscriber=__webpack_require__(11),Subscription=__webpack_require__(13),RefCountOperator=function(){function RefCountOperator(connectable){this.connectable=connectable}return RefCountOperator.prototype.call=function(subscriber,source){var connectable=this.connectable;connectable._refCount++;var refCounter=new refCount_RefCountSubscriber(subscriber,connectable),subscription=source.subscribe(refCounter);return refCounter.closed||(refCounter.connection=connectable.connect()),subscription},RefCountOperator}(),refCount_RefCountSubscriber=function(_super){function RefCountSubscriber(destination,connectable){var _this=_super.call(this,destination)||this;return _this.connectable=connectable,_this}return tslib_es6.a(RefCountSubscriber,_super),RefCountSubscriber.prototype._unsubscribe=function(){var connectable=this.connectable;if(connectable){this.connectable=null;var refCount=connectable._refCount;if(refCount<=0)this.connection=null;else if(connectable._refCount=refCount-1,refCount>1)this.connection=null;else{var connection=this.connection,sharedConnection=connectable._connection;this.connection=null,!sharedConnection||connection&&sharedConnection!==connection||sharedConnection.unsubscribe()}}else this.connection=null},RefCountSubscriber}(Subscriber.a),ConnectableObservable_ConnectableObservable=function(_super){function ConnectableObservable(source,subjectFactory){var _this=_super.call(this)||this;return _this.source=source,_this.subjectFactory=subjectFactory,_this._refCount=0,_this._isComplete=!1,_this}return tslib_es6.a(ConnectableObservable,_super),ConnectableObservable.prototype._subscribe=function(subscriber){return this.getSubject().subscribe(subscriber)},ConnectableObservable.prototype.getSubject=function(){var subject=this._subject;return subject&&!subject.isStopped||(this._subject=this.subjectFactory()),this._subject},ConnectableObservable.prototype.connect=function(){var connection=this._connection;return connection||(this._isComplete=!1,(connection=this._connection=new Subscription.a).add(this.source.subscribe(new ConnectableObservable_ConnectableSubscriber(this.getSubject(),this))),connection.closed&&(this._connection=null,connection=Subscription.a.EMPTY)),connection},ConnectableObservable.prototype.refCount=function(){return(source=this).lift(new RefCountOperator(source));var source},ConnectableObservable}(Observable.a),ConnectableObservable_ConnectableSubscriber=function(_super){function ConnectableSubscriber(destination,connectable){var _this=_super.call(this,destination)||this;return _this.connectable=connectable,_this}return tslib_es6.a(ConnectableSubscriber,_super),ConnectableSubscriber.prototype._error=function(err){this._unsubscribe(),_super.prototype._error.call(this,err)},ConnectableSubscriber.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),_super.prototype._complete.call(this)},ConnectableSubscriber.prototype._unsubscribe=function(){var connectable=this.connectable;if(connectable){this.connectable=null;var connection=connectable._connection;connectable._refCount=0,connectable._subject=null,connectable._connection=null,connection&&connection.unsubscribe()}},ConnectableSubscriber}(Subject.b);Subscriber.a,Subscriber.a;!function(_super){function GroupDurationSubscriber(key,group,parent){var _this=_super.call(this,group)||this;return _this.key=key,_this.group=group,_this.parent=parent,_this}tslib_es6.a(GroupDurationSubscriber,_super),GroupDurationSubscriber.prototype._next=function(value){this.complete()},GroupDurationSubscriber.prototype._unsubscribe=function(){var parent=this.parent,key=this.key;this.key=this.parent=null,parent&&parent.removeGroup(key)}}(Subscriber.a);var groupBy_GroupedObservable=function(_super){function GroupedObservable(key,groupSubject,refCountSubscription){var _this=_super.call(this)||this;return _this.key=key,_this.groupSubject=groupSubject,_this.refCountSubscription=refCountSubscription,_this}return tslib_es6.a(GroupedObservable,_super),GroupedObservable.prototype._subscribe=function(subscriber){var subscription=new Subscription.a,refCountSubscription=this.refCountSubscription,groupSubject=this.groupSubject;return refCountSubscription&&!refCountSubscription.closed&&subscription.add(new groupBy_InnerRefCountSubscription(refCountSubscription)),subscription.add(groupSubject.subscribe(subscriber)),subscription},GroupedObservable}(Observable.a),groupBy_InnerRefCountSubscription=function(_super){function InnerRefCountSubscription(parent){var _this=_super.call(this)||this;return _this.parent=parent,parent.count++,_this}return tslib_es6.a(InnerRefCountSubscription,_super),InnerRefCountSubscription.prototype.unsubscribe=function(){var parent=this.parent;parent.closed||this.closed||(_super.prototype.unsubscribe.call(this),parent.count-=1,0===parent.count&&parent.attemptedToUnsubscribe&&parent.unsubscribe())},InnerRefCountSubscription}(Subscription.a),symbol_observable=__webpack_require__(29),BehaviorSubject=__webpack_require__(77),AsyncAction_AsyncAction=function(_super){function AsyncAction(scheduler,work){var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this.pending=!1,_this}return tslib_es6.a(AsyncAction,_super),AsyncAction.prototype.schedule=function(state,delay){if(void 0===delay&&(delay=0),this.closed)return this;this.state=state;var id=this.id,scheduler=this.scheduler;return null!=id&&(this.id=this.recycleAsyncId(scheduler,id,delay)),this.pending=!0,this.delay=delay,this.id=this.id||this.requestAsyncId(scheduler,this.id,delay),this},AsyncAction.prototype.requestAsyncId=function(scheduler,id,delay){return void 0===delay&&(delay=0),setInterval(scheduler.flush.bind(scheduler,this),delay)},AsyncAction.prototype.recycleAsyncId=function(scheduler,id,delay){if(void 0===delay&&(delay=0),null!==delay&&this.delay===delay&&!1===this.pending)return id;clearInterval(id)},AsyncAction.prototype.execute=function(state,delay){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var error=this._execute(state,delay);if(error)return error;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},AsyncAction.prototype._execute=function(state,delay){var errored=!1,errorValue=void 0;try{this.work(state)}catch(e){errored=!0,errorValue=!!e&&e||new Error(e)}if(errored)return this.unsubscribe(),errorValue},AsyncAction.prototype._unsubscribe=function(){var id=this.id,scheduler=this.scheduler,actions=scheduler.actions,index=actions.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==index&&actions.splice(index,1),null!=id&&(this.id=this.recycleAsyncId(scheduler,id,null)),this.delay=null},AsyncAction}(function(_super){function Action(scheduler,work){return _super.call(this)||this}return tslib_es6.a(Action,_super),Action.prototype.schedule=function(state,delay){return void 0===delay&&(delay=0),this},Action}(Subscription.a)),QueueAction_QueueAction=function(_super){function QueueAction(scheduler,work){var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this}return tslib_es6.a(QueueAction,_super),QueueAction.prototype.schedule=function(state,delay){return void 0===delay&&(delay=0),delay>0?_super.prototype.schedule.call(this,state,delay):(this.delay=delay,this.state=state,this.scheduler.flush(this),this)},QueueAction.prototype.execute=function(state,delay){return delay>0||this.closed?_super.prototype.execute.call(this,state,delay):this._execute(state,delay)},QueueAction.prototype.requestAsyncId=function(scheduler,id,delay){return void 0===delay&&(delay=0),null!==delay&&delay>0||null===delay&&this.delay>0?_super.prototype.requestAsyncId.call(this,scheduler,id,delay):scheduler.flush(this)},QueueAction}(AsyncAction_AsyncAction),Scheduler=function(){function Scheduler(SchedulerAction,now){void 0===now&&(now=Scheduler.now),this.SchedulerAction=SchedulerAction,this.now=now}return Scheduler.prototype.schedule=function(work,delay,state){return void 0===delay&&(delay=0),new this.SchedulerAction(this,work).schedule(state,delay)},Scheduler.now=function(){return Date.now()},Scheduler}(),AsyncScheduler_AsyncScheduler=function(_super){function AsyncScheduler(SchedulerAction,now){void 0===now&&(now=Scheduler.now);var _this=_super.call(this,SchedulerAction,(function(){return AsyncScheduler.delegate&&AsyncScheduler.delegate!==_this?AsyncScheduler.delegate.now():now()}))||this;return _this.actions=[],_this.active=!1,_this.scheduled=void 0,_this}return tslib_es6.a(AsyncScheduler,_super),AsyncScheduler.prototype.schedule=function(work,delay,state){return void 0===delay&&(delay=0),AsyncScheduler.delegate&&AsyncScheduler.delegate!==this?AsyncScheduler.delegate.schedule(work,delay,state):_super.prototype.schedule.call(this,work,delay,state)},AsyncScheduler.prototype.flush=function(action){var actions=this.actions;if(this.active)actions.push(action);else{var error;this.active=!0;do{if(error=action.execute(action.state,action.delay))break}while(action=actions.shift());if(this.active=!1,error){for(;action=actions.shift();)action.unsubscribe();throw error}}},AsyncScheduler}(Scheduler),queueScheduler=new(function(_super){function QueueScheduler(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_es6.a(QueueScheduler,_super),QueueScheduler}(AsyncScheduler_AsyncScheduler))(QueueAction_QueueAction),queue=queueScheduler,EMPTY=new Observable.a((function(subscriber){return subscriber.complete()}));function empty(scheduler){return scheduler?function(scheduler){return new Observable.a((function(subscriber){return scheduler.schedule((function(){return subscriber.complete()}))}))}(scheduler):EMPTY}function isScheduler(value){return value&&"function"==typeof value.schedule}var NotificationKind,subscribeToArray=function(array){return function(subscriber){for(var i=0,len=array.length;i<len&&!subscriber.closed;i++)subscriber.next(array[i]);subscriber.complete()}};function scheduleArray(input,scheduler){return new Observable.a((function(subscriber){var sub=new Subscription.a,i=0;return sub.add(scheduler.schedule((function(){i!==input.length?(subscriber.next(input[i++]),subscriber.closed||sub.add(this.schedule())):subscriber.complete()}))),sub}))}function fromArray(input,scheduler){return scheduler?scheduleArray(input,scheduler):new Observable.a(subscribeToArray(input))}function of(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var scheduler=args[args.length-1];return isScheduler(scheduler)?(args.pop(),scheduleArray(args,scheduler)):fromArray(args)}function throwError(error,scheduler){return scheduler?new Observable.a((function(subscriber){return scheduler.schedule(dispatch,0,{error:error,subscriber:subscriber})})):new Observable.a((function(subscriber){return subscriber.error(error)}))}function dispatch(_a){var error=_a.error;_a.subscriber.error(error)}NotificationKind||(NotificationKind={});var Notification_Notification=function(){function Notification(kind,value,error){this.kind=kind,this.value=value,this.error=error,this.hasValue="N"===kind}return Notification.prototype.observe=function(observer){switch(this.kind){case"N":return observer.next&&observer.next(this.value);case"E":return observer.error&&observer.error(this.error);case"C":return observer.complete&&observer.complete()}},Notification.prototype.do=function(next,error,complete){switch(this.kind){case"N":return next&&next(this.value);case"E":return error&&error(this.error);case"C":return complete&&complete()}},Notification.prototype.accept=function(nextOrObserver,error,complete){return nextOrObserver&&"function"==typeof nextOrObserver.next?this.observe(nextOrObserver):this.do(nextOrObserver,error,complete)},Notification.prototype.toObservable=function(){switch(this.kind){case"N":return of(this.value);case"E":return throwError(this.error);case"C":return empty()}throw new Error("unexpected notification kind value")},Notification.createNext=function(value){return void 0!==value?new Notification("N",value):Notification.undefinedValueNotification},Notification.createError=function(err){return new Notification("E",void 0,err)},Notification.createComplete=function(){return Notification.completeNotification},Notification.completeNotification=new Notification("C"),Notification.undefinedValueNotification=new Notification("N",void 0),Notification}(),observeOn_ObserveOnSubscriber=function(_super){function ObserveOnSubscriber(destination,scheduler,delay){void 0===delay&&(delay=0);var _this=_super.call(this,destination)||this;return _this.scheduler=scheduler,_this.delay=delay,_this}return tslib_es6.a(ObserveOnSubscriber,_super),ObserveOnSubscriber.dispatch=function(arg){var notification=arg.notification,destination=arg.destination;notification.observe(destination),this.unsubscribe()},ObserveOnSubscriber.prototype.scheduleMessage=function(notification){this.destination.add(this.scheduler.schedule(ObserveOnSubscriber.dispatch,this.delay,new ObserveOnMessage(notification,this.destination)))},ObserveOnSubscriber.prototype._next=function(value){this.scheduleMessage(Notification_Notification.createNext(value))},ObserveOnSubscriber.prototype._error=function(err){this.scheduleMessage(Notification_Notification.createError(err)),this.unsubscribe()},ObserveOnSubscriber.prototype._complete=function(){this.scheduleMessage(Notification_Notification.createComplete()),this.unsubscribe()},ObserveOnSubscriber}(Subscriber.a),ObserveOnMessage=function(notification,destination){this.notification=notification,this.destination=destination},ObjectUnsubscribedError=__webpack_require__(30),SubjectSubscription=__webpack_require__(63),ReplaySubject_ReplaySubject=function(_super){function ReplaySubject(bufferSize,windowTime,scheduler){void 0===bufferSize&&(bufferSize=Number.POSITIVE_INFINITY),void 0===windowTime&&(windowTime=Number.POSITIVE_INFINITY);var _this=_super.call(this)||this;return _this.scheduler=scheduler,_this._events=[],_this._infiniteTimeWindow=!1,_this._bufferSize=bufferSize<1?1:bufferSize,_this._windowTime=windowTime<1?1:windowTime,windowTime===Number.POSITIVE_INFINITY?(_this._infiniteTimeWindow=!0,_this.next=_this.nextInfiniteTimeWindow):_this.next=_this.nextTimeWindow,_this}return tslib_es6.a(ReplaySubject,_super),ReplaySubject.prototype.nextInfiniteTimeWindow=function(value){if(!this.isStopped){var _events=this._events;_events.push(value),_events.length>this._bufferSize&&_events.shift()}_super.prototype.next.call(this,value)},ReplaySubject.prototype.nextTimeWindow=function(value){this.isStopped||(this._events.push(new ReplayEvent(this._getNow(),value)),this._trimBufferThenGetEvents()),_super.prototype.next.call(this,value)},ReplaySubject.prototype._subscribe=function(subscriber){var subscription,_infiniteTimeWindow=this._infiniteTimeWindow,_events=_infiniteTimeWindow?this._events:this._trimBufferThenGetEvents(),scheduler=this.scheduler,len=_events.length;if(this.closed)throw new ObjectUnsubscribedError.a;if(this.isStopped||this.hasError?subscription=Subscription.a.EMPTY:(this.observers.push(subscriber),subscription=new SubjectSubscription.a(this,subscriber)),scheduler&&subscriber.add(subscriber=new observeOn_ObserveOnSubscriber(subscriber,scheduler)),_infiniteTimeWindow)for(var i=0;i<len&&!subscriber.closed;i++)subscriber.next(_events[i]);else for(i=0;i<len&&!subscriber.closed;i++)subscriber.next(_events[i].value);return this.hasError?subscriber.error(this.thrownError):this.isStopped&&subscriber.complete(),subscription},ReplaySubject.prototype._getNow=function(){return(this.scheduler||queue).now()},ReplaySubject.prototype._trimBufferThenGetEvents=function(){for(var now=this._getNow(),_bufferSize=this._bufferSize,_windowTime=this._windowTime,_events=this._events,eventsCount=_events.length,spliceCount=0;spliceCount<eventsCount&&!(now-_events[spliceCount].time<_windowTime);)spliceCount++;return eventsCount>_bufferSize&&(spliceCount=Math.max(spliceCount,eventsCount-_bufferSize)),spliceCount>0&&_events.splice(0,spliceCount),_events},ReplaySubject}(Subject.a),ReplayEvent=function(time,value){this.time=time,this.value=value},AsyncSubject_AsyncSubject=function(_super){function AsyncSubject(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.value=null,_this.hasNext=!1,_this.hasCompleted=!1,_this}return tslib_es6.a(AsyncSubject,_super),AsyncSubject.prototype._subscribe=function(subscriber){return this.hasError?(subscriber.error(this.thrownError),Subscription.a.EMPTY):this.hasCompleted&&this.hasNext?(subscriber.next(this.value),subscriber.complete(),Subscription.a.EMPTY):_super.prototype._subscribe.call(this,subscriber)},AsyncSubject.prototype.next=function(value){this.hasCompleted||(this.value=value,this.hasNext=!0)},AsyncSubject.prototype.error=function(error){this.hasCompleted||_super.prototype.error.call(this,error)},AsyncSubject.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&_super.prototype.next.call(this,this.value),_super.prototype.complete.call(this)},AsyncSubject}(Subject.a),nextHandle=1,RESOLVED=Promise.resolve(),activeHandles={};function findAndClearHandle(handle){return handle in activeHandles&&(delete activeHandles[handle],!0)}var AsapAction_AsapAction=function(_super){function AsapAction(scheduler,work){var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this}return tslib_es6.a(AsapAction,_super),AsapAction.prototype.requestAsyncId=function(scheduler,id,delay){return void 0===delay&&(delay=0),null!==delay&&delay>0?_super.prototype.requestAsyncId.call(this,scheduler,id,delay):(scheduler.actions.push(this),scheduler.scheduled||(scheduler.scheduled=function(cb){var handle=nextHandle++;return activeHandles[handle]=!0,RESOLVED.then((function(){return findAndClearHandle(handle)&&cb()})),handle}(scheduler.flush.bind(scheduler,null))))},AsapAction.prototype.recycleAsyncId=function(scheduler,id,delay){if(void 0===delay&&(delay=0),null!==delay&&delay>0||null===delay&&this.delay>0)return _super.prototype.recycleAsyncId.call(this,scheduler,id,delay);0===scheduler.actions.length&&(findAndClearHandle(id),scheduler.scheduled=void 0)},AsapAction}(AsyncAction_AsyncAction),asapScheduler=new(function(_super){function AsapScheduler(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_es6.a(AsapScheduler,_super),AsapScheduler.prototype.flush=function(action){this.active=!0,this.scheduled=void 0;var error,actions=this.actions,index=-1,count=actions.length;action=action||actions.shift();do{if(error=action.execute(action.state,action.delay))break}while(++index<count&&(action=actions.shift()));if(this.active=!1,error){for(;++index<count&&(action=actions.shift());)action.unsubscribe();throw error}},AsapScheduler}(AsyncScheduler_AsyncScheduler))(AsapAction_AsapAction),asap=asapScheduler,asyncScheduler=new AsyncScheduler_AsyncScheduler(AsyncAction_AsyncAction),async_async=asyncScheduler,AnimationFrameAction_AnimationFrameAction=function(_super){function AnimationFrameAction(scheduler,work){var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this}return tslib_es6.a(AnimationFrameAction,_super),AnimationFrameAction.prototype.requestAsyncId=function(scheduler,id,delay){return void 0===delay&&(delay=0),null!==delay&&delay>0?_super.prototype.requestAsyncId.call(this,scheduler,id,delay):(scheduler.actions.push(this),scheduler.scheduled||(scheduler.scheduled=requestAnimationFrame((function(){return scheduler.flush(null)}))))},AnimationFrameAction.prototype.recycleAsyncId=function(scheduler,id,delay){if(void 0===delay&&(delay=0),null!==delay&&delay>0||null===delay&&this.delay>0)return _super.prototype.recycleAsyncId.call(this,scheduler,id,delay);0===scheduler.actions.length&&(cancelAnimationFrame(id),scheduler.scheduled=void 0)},AnimationFrameAction}(AsyncAction_AsyncAction),animationFrameScheduler=new(function(_super){function AnimationFrameScheduler(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_es6.a(AnimationFrameScheduler,_super),AnimationFrameScheduler.prototype.flush=function(action){this.active=!0,this.scheduled=void 0;var error,actions=this.actions,index=-1,count=actions.length;action=action||actions.shift();do{if(error=action.execute(action.state,action.delay))break}while(++index<count&&(action=actions.shift()));if(this.active=!1,error){for(;++index<count&&(action=actions.shift());)action.unsubscribe();throw error}},AnimationFrameScheduler}(AsyncScheduler_AsyncScheduler))(AnimationFrameAction_AnimationFrameAction),animationFrame=animationFrameScheduler,VirtualTimeScheduler_VirtualTimeScheduler=function(_super){function VirtualTimeScheduler(SchedulerAction,maxFrames){void 0===SchedulerAction&&(SchedulerAction=VirtualTimeScheduler_VirtualAction),void 0===maxFrames&&(maxFrames=Number.POSITIVE_INFINITY);var _this=_super.call(this,SchedulerAction,(function(){return _this.frame}))||this;return _this.maxFrames=maxFrames,_this.frame=0,_this.index=-1,_this}return tslib_es6.a(VirtualTimeScheduler,_super),VirtualTimeScheduler.prototype.flush=function(){for(var error,action,actions=this.actions,maxFrames=this.maxFrames;(action=actions[0])&&action.delay<=maxFrames&&(actions.shift(),this.frame=action.delay,!(error=action.execute(action.state,action.delay))););if(error){for(;action=actions.shift();)action.unsubscribe();throw error}},VirtualTimeScheduler.frameTimeFactor=10,VirtualTimeScheduler}(AsyncScheduler_AsyncScheduler),VirtualTimeScheduler_VirtualAction=function(_super){function VirtualAction(scheduler,work,index){void 0===index&&(index=scheduler.index+=1);var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this.index=index,_this.active=!0,_this.index=scheduler.index=index,_this}return tslib_es6.a(VirtualAction,_super),VirtualAction.prototype.schedule=function(state,delay){if(void 0===delay&&(delay=0),!this.id)return _super.prototype.schedule.call(this,state,delay);this.active=!1;var action=new VirtualAction(this.scheduler,this.work);return this.add(action),action.schedule(state,delay)},VirtualAction.prototype.requestAsyncId=function(scheduler,id,delay){void 0===delay&&(delay=0),this.delay=scheduler.frame+delay;var actions=scheduler.actions;return actions.push(this),actions.sort(VirtualAction.sortActions),!0},VirtualAction.prototype.recycleAsyncId=function(scheduler,id,delay){void 0===delay&&(delay=0)},VirtualAction.prototype._execute=function(state,delay){if(!0===this.active)return _super.prototype._execute.call(this,state,delay)},VirtualAction.sortActions=function(a,b){return a.delay===b.delay?a.index===b.index?0:a.index>b.index?1:-1:a.delay>b.delay?1:-1},VirtualAction}(AsyncAction_AsyncAction),pipe=__webpack_require__(62);function noop(){}var identity=__webpack_require__(34);function isObservable(obj){return!!obj&&(obj instanceof Observable.a||"function"==typeof obj.lift&&"function"==typeof obj.subscribe)}var ArgumentOutOfRangeError=function(){function ArgumentOutOfRangeErrorImpl(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return ArgumentOutOfRangeErrorImpl.prototype=Object.create(Error.prototype),ArgumentOutOfRangeErrorImpl}(),EmptyError=function(){function EmptyErrorImpl(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return EmptyErrorImpl.prototype=Object.create(Error.prototype),EmptyErrorImpl}(),UnsubscriptionError=__webpack_require__(42),TimeoutError=function(){function TimeoutErrorImpl(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return TimeoutErrorImpl.prototype=Object.create(Error.prototype),TimeoutErrorImpl}();function map(project,thisArg){return function(source){if("function"!=typeof project)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return source.lift(new MapOperator(project,thisArg))}}var MapOperator=function(){function MapOperator(project,thisArg){this.project=project,this.thisArg=thisArg}return MapOperator.prototype.call=function(subscriber,source){return source.subscribe(new map_MapSubscriber(subscriber,this.project,this.thisArg))},MapOperator}(),map_MapSubscriber=function(_super){function MapSubscriber(destination,project,thisArg){var _this=_super.call(this,destination)||this;return _this.project=project,_this.count=0,_this.thisArg=thisArg||_this,_this}return tslib_es6.a(MapSubscriber,_super),MapSubscriber.prototype._next=function(value){var result;try{result=this.project.call(this.thisArg,value,this.count++)}catch(err){return void this.destination.error(err)}this.destination.next(result)},MapSubscriber}(Subscriber.a),canReportError=__webpack_require__(51),isArray=__webpack_require__(17);function bindCallback(callbackFunc,resultSelector,scheduler){if(resultSelector){if(!isScheduler(resultSelector))return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return bindCallback(callbackFunc,scheduler).apply(void 0,args).pipe(map((function(args){return Object(isArray.a)(args)?resultSelector.apply(void 0,args):resultSelector(args)})))};scheduler=resultSelector}return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var subject,context=this,params={context:context,subject:subject,callbackFunc:callbackFunc,scheduler:scheduler};return new Observable.a((function(subscriber){if(scheduler){var state={args:args,subscriber:subscriber,params:params};return scheduler.schedule(bindCallback_dispatch,0,state)}if(!subject){subject=new AsyncSubject_AsyncSubject;try{callbackFunc.apply(context,args.concat([function(){for(var innerArgs=[],_i=0;_i<arguments.length;_i++)innerArgs[_i]=arguments[_i];subject.next(innerArgs.length<=1?innerArgs[0]:innerArgs),subject.complete()}]))}catch(err){Object(canReportError.a)(subject)?subject.error(err):console.warn(err)}}return subject.subscribe(subscriber)}))}}function bindCallback_dispatch(state){var _this=this,args=state.args,subscriber=state.subscriber,params=state.params,callbackFunc=params.callbackFunc,context=params.context,scheduler=params.scheduler,subject=params.subject;if(!subject){subject=params.subject=new AsyncSubject_AsyncSubject;try{callbackFunc.apply(context,args.concat([function(){for(var innerArgs=[],_i=0;_i<arguments.length;_i++)innerArgs[_i]=arguments[_i];var value=innerArgs.length<=1?innerArgs[0]:innerArgs;_this.add(scheduler.schedule(dispatchNext,0,{value:value,subject:subject}))}]))}catch(err){subject.error(err)}}this.add(subject.subscribe(subscriber))}function dispatchNext(state){var value=state.value,subject=state.subject;subject.next(value),subject.complete()}function bindNodeCallback(callbackFunc,resultSelector,scheduler){if(resultSelector){if(!isScheduler(resultSelector))return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return bindNodeCallback(callbackFunc,scheduler).apply(void 0,args).pipe(map((function(args){return Object(isArray.a)(args)?resultSelector.apply(void 0,args):resultSelector(args)})))};scheduler=resultSelector}return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var params={subject:void 0,args:args,callbackFunc:callbackFunc,scheduler:scheduler,context:this};return new Observable.a((function(subscriber){var context=params.context,subject=params.subject;if(scheduler)return scheduler.schedule(bindNodeCallback_dispatch,0,{params:params,subscriber:subscriber,context:context});if(!subject){subject=params.subject=new AsyncSubject_AsyncSubject;try{callbackFunc.apply(context,args.concat([function(){for(var innerArgs=[],_i=0;_i<arguments.length;_i++)innerArgs[_i]=arguments[_i];var err=innerArgs.shift();err?subject.error(err):(subject.next(innerArgs.length<=1?innerArgs[0]:innerArgs),subject.complete())}]))}catch(err){Object(canReportError.a)(subject)?subject.error(err):console.warn(err)}}return subject.subscribe(subscriber)}))}}function bindNodeCallback_dispatch(state){var _this=this,params=state.params,subscriber=state.subscriber,context=state.context,callbackFunc=params.callbackFunc,args=params.args,scheduler=params.scheduler,subject=params.subject;if(!subject){subject=params.subject=new AsyncSubject_AsyncSubject;try{callbackFunc.apply(context,args.concat([function(){for(var innerArgs=[],_i=0;_i<arguments.length;_i++)innerArgs[_i]=arguments[_i];var err=innerArgs.shift();if(err)_this.add(scheduler.schedule(bindNodeCallback_dispatchError,0,{err:err,subject:subject}));else{var value=innerArgs.length<=1?innerArgs[0]:innerArgs;_this.add(scheduler.schedule(bindNodeCallback_dispatchNext,0,{value:value,subject:subject}))}}]))}catch(err){this.add(scheduler.schedule(bindNodeCallback_dispatchError,0,{err:err,subject:subject}))}}this.add(subject.subscribe(subscriber))}function bindNodeCallback_dispatchNext(arg){var value=arg.value,subject=arg.subject;subject.next(value),subject.complete()}function bindNodeCallback_dispatchError(arg){var err=arg.err;arg.subject.error(err)}var OuterSubscriber_OuterSubscriber=function(_super){function OuterSubscriber(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_es6.a(OuterSubscriber,_super),OuterSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){this.destination.next(innerValue)},OuterSubscriber.prototype.notifyError=function(error,innerSub){this.destination.error(error)},OuterSubscriber.prototype.notifyComplete=function(innerSub){this.destination.complete()},OuterSubscriber}(Subscriber.a),InnerSubscriber_InnerSubscriber=function(_super){function InnerSubscriber(parent,outerValue,outerIndex){var _this=_super.call(this)||this;return _this.parent=parent,_this.outerValue=outerValue,_this.outerIndex=outerIndex,_this.index=0,_this}return tslib_es6.a(InnerSubscriber,_super),InnerSubscriber.prototype._next=function(value){this.parent.notifyNext(this.outerValue,value,this.outerIndex,this.index++,this)},InnerSubscriber.prototype._error=function(error){this.parent.notifyError(error,this),this.unsubscribe()},InnerSubscriber.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},InnerSubscriber}(Subscriber.a),hostReportError=__webpack_require__(36);var iterator_iterator="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",isArrayLike=function(x){return x&&"number"==typeof x.length&&"function"!=typeof x};function isPromise(value){return!!value&&"function"!=typeof value.subscribe&&"function"==typeof value.then}var isObject=__webpack_require__(50),subscribeTo=function(result){if(result&&"function"==typeof result[symbol_observable.a])return obj=result,function(subscriber){var obs=obj[symbol_observable.a]();if("function"!=typeof obs.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return obs.subscribe(subscriber)};if(isArrayLike(result))return subscribeToArray(result);if(isPromise(result))return promise=result,function(subscriber){return promise.then((function(value){subscriber.closed||(subscriber.next(value),subscriber.complete())}),(function(err){return subscriber.error(err)})).then(null,hostReportError.a),subscriber};if(result&&"function"==typeof result[iterator_iterator])return iterable=result,function(subscriber){for(var iterator=iterable[iterator_iterator]();;){var item=void 0;try{item=iterator.next()}catch(err){return subscriber.error(err),subscriber}if(item.done){subscriber.complete();break}if(subscriber.next(item.value),subscriber.closed)break}return"function"==typeof iterator.return&&subscriber.add((function(){iterator.return&&iterator.return()})),subscriber};var iterable,promise,obj,value=Object(isObject.a)(result)?"an invalid object":"'"+result+"'";throw new TypeError("You provided "+value+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function subscribeToResult(outerSubscriber,result,outerValue,outerIndex,innerSubscriber){if(void 0===innerSubscriber&&(innerSubscriber=new InnerSubscriber_InnerSubscriber(outerSubscriber,outerValue,outerIndex)),!innerSubscriber.closed)return result instanceof Observable.a?result.subscribe(innerSubscriber):subscribeTo(result)(innerSubscriber)}var NONE={};function combineLatest(){for(var observables=[],_i=0;_i<arguments.length;_i++)observables[_i]=arguments[_i];var resultSelector=void 0,scheduler=void 0;return isScheduler(observables[observables.length-1])&&(scheduler=observables.pop()),"function"==typeof observables[observables.length-1]&&(resultSelector=observables.pop()),1===observables.length&&Object(isArray.a)(observables[0])&&(observables=observables[0]),fromArray(observables,scheduler).lift(new CombineLatestOperator(resultSelector))}var CombineLatestOperator=function(){function CombineLatestOperator(resultSelector){this.resultSelector=resultSelector}return CombineLatestOperator.prototype.call=function(subscriber,source){return source.subscribe(new combineLatest_CombineLatestSubscriber(subscriber,this.resultSelector))},CombineLatestOperator}(),combineLatest_CombineLatestSubscriber=function(_super){function CombineLatestSubscriber(destination,resultSelector){var _this=_super.call(this,destination)||this;return _this.resultSelector=resultSelector,_this.active=0,_this.values=[],_this.observables=[],_this}return tslib_es6.a(CombineLatestSubscriber,_super),CombineLatestSubscriber.prototype._next=function(observable){this.values.push(NONE),this.observables.push(observable)},CombineLatestSubscriber.prototype._complete=function(){var observables=this.observables,len=observables.length;if(0===len)this.destination.complete();else{this.active=len,this.toRespond=len;for(var i=0;i<len;i++){var observable=observables[i];this.add(subscribeToResult(this,observable,void 0,i))}}},CombineLatestSubscriber.prototype.notifyComplete=function(unused){0==(this.active-=1)&&this.destination.complete()},CombineLatestSubscriber.prototype.notifyNext=function(_outerValue,innerValue,outerIndex){var values=this.values,oldVal=values[outerIndex],toRespond=this.toRespond?oldVal===NONE?--this.toRespond:this.toRespond:0;values[outerIndex]=innerValue,0===toRespond&&(this.resultSelector?this._tryResultSelector(values):this.destination.next(values.slice()))},CombineLatestSubscriber.prototype._tryResultSelector=function(values){var result;try{result=this.resultSelector.apply(this,values)}catch(err){return void this.destination.error(err)}this.destination.next(result)},CombineLatestSubscriber}(OuterSubscriber_OuterSubscriber);function scheduled(input,scheduler){if(null!=input){if(function(input){return input&&"function"==typeof input[symbol_observable.a]}(input))return function(input,scheduler){return new Observable.a((function(subscriber){var sub=new Subscription.a;return sub.add(scheduler.schedule((function(){var observable=input[symbol_observable.a]();sub.add(observable.subscribe({next:function(value){sub.add(scheduler.schedule((function(){return subscriber.next(value)})))},error:function(err){sub.add(scheduler.schedule((function(){return subscriber.error(err)})))},complete:function(){sub.add(scheduler.schedule((function(){return subscriber.complete()})))}}))}))),sub}))}(input,scheduler);if(isPromise(input))return function(input,scheduler){return new Observable.a((function(subscriber){var sub=new Subscription.a;return sub.add(scheduler.schedule((function(){return input.then((function(value){sub.add(scheduler.schedule((function(){subscriber.next(value),sub.add(scheduler.schedule((function(){return subscriber.complete()})))})))}),(function(err){sub.add(scheduler.schedule((function(){return subscriber.error(err)})))}))}))),sub}))}(input,scheduler);if(isArrayLike(input))return scheduleArray(input,scheduler);if(function(input){return input&&"function"==typeof input[iterator_iterator]}(input)||"string"==typeof input)return function(input,scheduler){if(!input)throw new Error("Iterable cannot be null");return new Observable.a((function(subscriber){var iterator,sub=new Subscription.a;return sub.add((function(){iterator&&"function"==typeof iterator.return&&iterator.return()})),sub.add(scheduler.schedule((function(){iterator=input[iterator_iterator](),sub.add(scheduler.schedule((function(){if(!subscriber.closed){var value,done;try{var result=iterator.next();value=result.value,done=result.done}catch(err){return void subscriber.error(err)}done?subscriber.complete():(subscriber.next(value),this.schedule())}})))}))),sub}))}(input,scheduler)}throw new TypeError((null!==input&&typeof input||input)+" is not observable")}function from(input,scheduler){return scheduler?scheduled(input,scheduler):input instanceof Observable.a?input:new Observable.a(subscribeTo(input))}var innerSubscribe_SimpleInnerSubscriber=function(_super){function SimpleInnerSubscriber(parent){var _this=_super.call(this)||this;return _this.parent=parent,_this}return tslib_es6.a(SimpleInnerSubscriber,_super),SimpleInnerSubscriber.prototype._next=function(value){this.parent.notifyNext(value)},SimpleInnerSubscriber.prototype._error=function(error){this.parent.notifyError(error),this.unsubscribe()},SimpleInnerSubscriber.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},SimpleInnerSubscriber}(Subscriber.a),innerSubscribe_SimpleOuterSubscriber=(Subscriber.a,function(_super){function SimpleOuterSubscriber(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_es6.a(SimpleOuterSubscriber,_super),SimpleOuterSubscriber.prototype.notifyNext=function(innerValue){this.destination.next(innerValue)},SimpleOuterSubscriber.prototype.notifyError=function(err){this.destination.error(err)},SimpleOuterSubscriber.prototype.notifyComplete=function(){this.destination.complete()},SimpleOuterSubscriber}(Subscriber.a));function innerSubscribe(result,innerSubscriber){if(!innerSubscriber.closed)return result instanceof Observable.a?result.subscribe(innerSubscriber):subscribeTo(result)(innerSubscriber)}function mergeMap(project,resultSelector,concurrent){return void 0===concurrent&&(concurrent=Number.POSITIVE_INFINITY),"function"==typeof resultSelector?function(source){return source.pipe(mergeMap((function(a,i){return from(project(a,i)).pipe(map((function(b,ii){return resultSelector(a,b,i,ii)})))}),concurrent))}:("number"==typeof resultSelector&&(concurrent=resultSelector),function(source){return source.lift(new MergeMapOperator(project,concurrent))})}Subscriber.a;var MergeMapOperator=function(){function MergeMapOperator(project,concurrent){void 0===concurrent&&(concurrent=Number.POSITIVE_INFINITY),this.project=project,this.concurrent=concurrent}return MergeMapOperator.prototype.call=function(observer,source){return source.subscribe(new mergeMap_MergeMapSubscriber(observer,this.project,this.concurrent))},MergeMapOperator}(),mergeMap_MergeMapSubscriber=function(_super){function MergeMapSubscriber(destination,project,concurrent){void 0===concurrent&&(concurrent=Number.POSITIVE_INFINITY);var _this=_super.call(this,destination)||this;return _this.project=project,_this.concurrent=concurrent,_this.hasCompleted=!1,_this.buffer=[],_this.active=0,_this.index=0,_this}return tslib_es6.a(MergeMapSubscriber,_super),MergeMapSubscriber.prototype._next=function(value){this.active<this.concurrent?this._tryNext(value):this.buffer.push(value)},MergeMapSubscriber.prototype._tryNext=function(value){var result,index=this.index++;try{result=this.project(value,index)}catch(err){return void this.destination.error(err)}this.active++,this._innerSub(result)},MergeMapSubscriber.prototype._innerSub=function(ish){var innerSubscriber=new innerSubscribe_SimpleInnerSubscriber(this),destination=this.destination;destination.add(innerSubscriber);var innerSubscription=innerSubscribe(ish,innerSubscriber);innerSubscription!==innerSubscriber&&destination.add(innerSubscription)},MergeMapSubscriber.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},MergeMapSubscriber.prototype.notifyNext=function(innerValue){this.destination.next(innerValue)},MergeMapSubscriber.prototype.notifyComplete=function(){var buffer=this.buffer;this.active--,buffer.length>0?this._next(buffer.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},MergeMapSubscriber}(innerSubscribe_SimpleOuterSubscriber);function mergeAll(concurrent){return void 0===concurrent&&(concurrent=Number.POSITIVE_INFINITY),mergeMap(identity.a,concurrent)}function concatAll(){return mergeAll(1)}function concat(){for(var observables=[],_i=0;_i<arguments.length;_i++)observables[_i]=arguments[_i];return concatAll()(of.apply(void 0,observables))}function defer(observableFactory){return new Observable.a((function(subscriber){var input;try{input=observableFactory()}catch(err){return void subscriber.error(err)}return(input?from(input):empty()).subscribe(subscriber)}))}function forkJoin(){for(var sources=[],_i=0;_i<arguments.length;_i++)sources[_i]=arguments[_i];if(1===sources.length){var first_1=sources[0];if(Object(isArray.a)(first_1))return forkJoinInternal(first_1,null);if(Object(isObject.a)(first_1)&&Object.getPrototypeOf(first_1)===Object.prototype){var keys=Object.keys(first_1);return forkJoinInternal(keys.map((function(key){return first_1[key]})),keys)}}if("function"==typeof sources[sources.length-1]){var resultSelector_1=sources.pop();return forkJoinInternal(sources=1===sources.length&&Object(isArray.a)(sources[0])?sources[0]:sources,null).pipe(map((function(args){return resultSelector_1.apply(void 0,args)})))}return forkJoinInternal(sources,null)}function forkJoinInternal(sources,keys){return new Observable.a((function(subscriber){var len=sources.length;if(0!==len)for(var values=new Array(len),completed=0,emitted=0,_loop_1=function(i){var source=from(sources[i]),hasValue=!1;subscriber.add(source.subscribe({next:function(value){hasValue||(hasValue=!0,emitted++),values[i]=value},error:function(err){return subscriber.error(err)},complete:function(){++completed!==len&&hasValue||(emitted===len&&subscriber.next(keys?keys.reduce((function(result,key,i){return result[key]=values[i],result}),{}):values),subscriber.complete())}}))},i=0;i<len;i++)_loop_1(i);else subscriber.complete()}))}var isFunction=__webpack_require__(35);function fromEvent(target,eventName,options,resultSelector){return Object(isFunction.a)(options)&&(resultSelector=options,options=void 0),resultSelector?fromEvent(target,eventName,options).pipe(map((function(args){return Object(isArray.a)(args)?resultSelector.apply(void 0,args):resultSelector(args)}))):new Observable.a((function(subscriber){!function setupSubscription(sourceObj,eventName,handler,subscriber,options){var unsubscribe;if(function(sourceObj){return sourceObj&&"function"==typeof sourceObj.addEventListener&&"function"==typeof sourceObj.removeEventListener}(sourceObj)){var source_1=sourceObj;sourceObj.addEventListener(eventName,handler,options),unsubscribe=function(){return source_1.removeEventListener(eventName,handler,options)}}else if(function(sourceObj){return sourceObj&&"function"==typeof sourceObj.on&&"function"==typeof sourceObj.off}(sourceObj)){var source_2=sourceObj;sourceObj.on(eventName,handler),unsubscribe=function(){return source_2.off(eventName,handler)}}else if(function(sourceObj){return sourceObj&&"function"==typeof sourceObj.addListener&&"function"==typeof sourceObj.removeListener}(sourceObj)){var source_3=sourceObj;sourceObj.addListener(eventName,handler),unsubscribe=function(){return source_3.removeListener(eventName,handler)}}else{if(!sourceObj||!sourceObj.length)throw new TypeError("Invalid event target");for(var i=0,len=sourceObj.length;i<len;i++)setupSubscription(sourceObj[i],eventName,handler,subscriber,options)}subscriber.add(unsubscribe)}(target,eventName,(function(e){arguments.length>1?subscriber.next(Array.prototype.slice.call(arguments)):subscriber.next(e)}),subscriber,options)}))}function fromEventPattern(addHandler,removeHandler,resultSelector){return resultSelector?fromEventPattern(addHandler,removeHandler).pipe(map((function(args){return Object(isArray.a)(args)?resultSelector.apply(void 0,args):resultSelector(args)}))):new Observable.a((function(subscriber){var retValue,handler=function(){for(var e=[],_i=0;_i<arguments.length;_i++)e[_i]=arguments[_i];return subscriber.next(1===e.length?e[0]:e)};try{retValue=addHandler(handler)}catch(err){return void subscriber.error(err)}if(Object(isFunction.a)(removeHandler))return function(){return removeHandler(handler,retValue)}}))}function generate(initialStateOrOptions,condition,iterate,resultSelectorOrObservable,scheduler){var resultSelector,initialState;if(1==arguments.length){var options=initialStateOrOptions;initialState=options.initialState,condition=options.condition,iterate=options.iterate,resultSelector=options.resultSelector||identity.a,scheduler=options.scheduler}else void 0===resultSelectorOrObservable||isScheduler(resultSelectorOrObservable)?(initialState=initialStateOrOptions,resultSelector=identity.a,scheduler=resultSelectorOrObservable):(initialState=initialStateOrOptions,resultSelector=resultSelectorOrObservable);return new Observable.a((function(subscriber){var state=initialState;if(scheduler)return scheduler.schedule(generate_dispatch,0,{subscriber:subscriber,iterate:iterate,condition:condition,resultSelector:resultSelector,state:state});for(;;){if(condition){var conditionResult=void 0;try{conditionResult=condition(state)}catch(err){return void subscriber.error(err)}if(!conditionResult){subscriber.complete();break}}var value=void 0;try{value=resultSelector(state)}catch(err){return void subscriber.error(err)}if(subscriber.next(value),subscriber.closed)break;try{state=iterate(state)}catch(err){return void subscriber.error(err)}}}))}function generate_dispatch(state){var subscriber=state.subscriber,condition=state.condition;if(!subscriber.closed){if(state.needIterate)try{state.state=state.iterate(state.state)}catch(err){return void subscriber.error(err)}else state.needIterate=!0;if(condition){var conditionResult=void 0;try{conditionResult=condition(state.state)}catch(err){return void subscriber.error(err)}if(!conditionResult)return void subscriber.complete();if(subscriber.closed)return}var value;try{value=state.resultSelector(state.state)}catch(err){return void subscriber.error(err)}if(!subscriber.closed&&(subscriber.next(value),!subscriber.closed))return this.schedule(state)}}function iif(condition,trueResult,falseResult){return void 0===trueResult&&(trueResult=EMPTY),void 0===falseResult&&(falseResult=EMPTY),defer((function(){return condition()?trueResult:falseResult}))}function isNumeric(val){return!Object(isArray.a)(val)&&val-parseFloat(val)+1>=0}function interval(period,scheduler){return void 0===period&&(period=0),void 0===scheduler&&(scheduler=async_async),(!isNumeric(period)||period<0)&&(period=0),scheduler&&"function"==typeof scheduler.schedule||(scheduler=async_async),new Observable.a((function(subscriber){return subscriber.add(scheduler.schedule(interval_dispatch,period,{subscriber:subscriber,counter:0,period:period})),subscriber}))}function interval_dispatch(state){var subscriber=state.subscriber,counter=state.counter,period=state.period;subscriber.next(counter),this.schedule({subscriber:subscriber,counter:counter+1,period:period},period)}function merge(){for(var observables=[],_i=0;_i<arguments.length;_i++)observables[_i]=arguments[_i];var concurrent=Number.POSITIVE_INFINITY,scheduler=null,last=observables[observables.length-1];return isScheduler(last)?(scheduler=observables.pop(),observables.length>1&&"number"==typeof observables[observables.length-1]&&(concurrent=observables.pop())):"number"==typeof last&&(concurrent=observables.pop()),null===scheduler&&1===observables.length&&observables[0]instanceof Observable.a?observables[0]:mergeAll(concurrent)(fromArray(observables,scheduler))}var NEVER=new Observable.a(noop);function never(){return NEVER}function onErrorResumeNext(){for(var sources=[],_i=0;_i<arguments.length;_i++)sources[_i]=arguments[_i];if(0===sources.length)return EMPTY;var first=sources[0],remainder=sources.slice(1);return 1===sources.length&&Object(isArray.a)(first)?onErrorResumeNext.apply(void 0,first):new Observable.a((function(subscriber){var subNext=function(){return subscriber.add(onErrorResumeNext.apply(void 0,remainder).subscribe(subscriber))};return from(first).subscribe({next:function(value){subscriber.next(value)},error:subNext,complete:subNext})}))}function pairs(obj,scheduler){return scheduler?new Observable.a((function(subscriber){var keys=Object.keys(obj),subscription=new Subscription.a;return subscription.add(scheduler.schedule(pairs_dispatch,0,{keys:keys,index:0,subscriber:subscriber,subscription:subscription,obj:obj})),subscription})):new Observable.a((function(subscriber){for(var keys=Object.keys(obj),i=0;i<keys.length&&!subscriber.closed;i++){var key=keys[i];obj.hasOwnProperty(key)&&subscriber.next([key,obj[key]])}subscriber.complete()}))}function pairs_dispatch(state){var keys=state.keys,index=state.index,subscriber=state.subscriber,subscription=state.subscription,obj=state.obj;if(!subscriber.closed)if(index<keys.length){var key=keys[index];subscriber.next([key,obj[key]]),subscription.add(this.schedule({keys:keys,index:index+1,subscriber:subscriber,subscription:subscription,obj:obj}))}else subscriber.complete()}function not(pred,thisArg){function notPred(){return!notPred.pred.apply(notPred.thisArg,arguments)}return notPred.pred=pred,notPred.thisArg=thisArg,notPred}function filter(predicate,thisArg){return function(source){return source.lift(new FilterOperator(predicate,thisArg))}}var FilterOperator=function(){function FilterOperator(predicate,thisArg){this.predicate=predicate,this.thisArg=thisArg}return FilterOperator.prototype.call=function(subscriber,source){return source.subscribe(new filter_FilterSubscriber(subscriber,this.predicate,this.thisArg))},FilterOperator}(),filter_FilterSubscriber=function(_super){function FilterSubscriber(destination,predicate,thisArg){var _this=_super.call(this,destination)||this;return _this.predicate=predicate,_this.thisArg=thisArg,_this.count=0,_this}return tslib_es6.a(FilterSubscriber,_super),FilterSubscriber.prototype._next=function(value){var result;try{result=this.predicate.call(this.thisArg,value,this.count++)}catch(err){return void this.destination.error(err)}result&&this.destination.next(value)},FilterSubscriber}(Subscriber.a);function partition(source,predicate,thisArg){return[filter(predicate,thisArg)(new Observable.a(subscribeTo(source))),filter(not(predicate,thisArg))(new Observable.a(subscribeTo(source)))]}function race(){for(var observables=[],_i=0;_i<arguments.length;_i++)observables[_i]=arguments[_i];if(1===observables.length){if(!Object(isArray.a)(observables[0]))return observables[0];observables=observables[0]}return fromArray(observables,void 0).lift(new RaceOperator)}var RaceOperator=function(){function RaceOperator(){}return RaceOperator.prototype.call=function(subscriber,source){return source.subscribe(new race_RaceSubscriber(subscriber))},RaceOperator}(),race_RaceSubscriber=function(_super){function RaceSubscriber(destination){var _this=_super.call(this,destination)||this;return _this.hasFirst=!1,_this.observables=[],_this.subscriptions=[],_this}return tslib_es6.a(RaceSubscriber,_super),RaceSubscriber.prototype._next=function(observable){this.observables.push(observable)},RaceSubscriber.prototype._complete=function(){var observables=this.observables,len=observables.length;if(0===len)this.destination.complete();else{for(var i=0;i<len&&!this.hasFirst;i++){var subscription=subscribeToResult(this,observables[i],void 0,i);this.subscriptions&&this.subscriptions.push(subscription),this.add(subscription)}this.observables=null}},RaceSubscriber.prototype.notifyNext=function(_outerValue,innerValue,outerIndex){if(!this.hasFirst){this.hasFirst=!0;for(var i=0;i<this.subscriptions.length;i++)if(i!==outerIndex){var subscription=this.subscriptions[i];subscription.unsubscribe(),this.remove(subscription)}this.subscriptions=null}this.destination.next(innerValue)},RaceSubscriber}(OuterSubscriber_OuterSubscriber);function range(start,count,scheduler){return void 0===start&&(start=0),new Observable.a((function(subscriber){void 0===count&&(count=start,start=0);var index=0,current=start;if(scheduler)return scheduler.schedule(range_dispatch,0,{index:index,count:count,start:start,subscriber:subscriber});for(;;){if(index++>=count){subscriber.complete();break}if(subscriber.next(current++),subscriber.closed)break}}))}function range_dispatch(state){var start=state.start,index=state.index,count=state.count,subscriber=state.subscriber;index>=count?subscriber.complete():(subscriber.next(start),subscriber.closed||(state.index=index+1,state.start=start+1,this.schedule(state)))}function timer(dueTime,periodOrScheduler,scheduler){void 0===dueTime&&(dueTime=0);var period=-1;return isNumeric(periodOrScheduler)?period=Number(periodOrScheduler)<1?1:Number(periodOrScheduler):isScheduler(periodOrScheduler)&&(scheduler=periodOrScheduler),isScheduler(scheduler)||(scheduler=async_async),new Observable.a((function(subscriber){var due=isNumeric(dueTime)?dueTime:+dueTime-scheduler.now();return scheduler.schedule(timer_dispatch,due,{index:0,period:period,subscriber:subscriber})}))}function timer_dispatch(state){var index=state.index,period=state.period,subscriber=state.subscriber;if(subscriber.next(index),!subscriber.closed){if(-1===period)return subscriber.complete();state.index=index+1,this.schedule(state,period)}}function using(resourceFactory,observableFactory){return new Observable.a((function(subscriber){var resource,result;try{resource=resourceFactory()}catch(err){return void subscriber.error(err)}try{result=observableFactory(resource)}catch(err){return void subscriber.error(err)}var subscription=(result?from(result):EMPTY).subscribe(subscriber);return function(){subscription.unsubscribe(),resource&&resource.unsubscribe()}}))}function zip(){for(var observables=[],_i=0;_i<arguments.length;_i++)observables[_i]=arguments[_i];var resultSelector=observables[observables.length-1];return"function"==typeof resultSelector&&observables.pop(),fromArray(observables,void 0).lift(new ZipOperator(resultSelector))}var ZipOperator=function(){function ZipOperator(resultSelector){this.resultSelector=resultSelector}return ZipOperator.prototype.call=function(subscriber,source){return source.subscribe(new zip_ZipSubscriber(subscriber,this.resultSelector))},ZipOperator}(),zip_ZipSubscriber=function(_super){function ZipSubscriber(destination,resultSelector,values){void 0===values&&(values=Object.create(null));var _this=_super.call(this,destination)||this;return _this.resultSelector=resultSelector,_this.iterators=[],_this.active=0,_this.resultSelector="function"==typeof resultSelector?resultSelector:void 0,_this}return tslib_es6.a(ZipSubscriber,_super),ZipSubscriber.prototype._next=function(value){var iterators=this.iterators;Object(isArray.a)(value)?iterators.push(new zip_StaticArrayIterator(value)):"function"==typeof value[iterator_iterator]?iterators.push(new StaticIterator(value[iterator_iterator]())):iterators.push(new zip_ZipBufferIterator(this.destination,this,value))},ZipSubscriber.prototype._complete=function(){var iterators=this.iterators,len=iterators.length;if(this.unsubscribe(),0!==len){this.active=len;for(var i=0;i<len;i++){var iterator=iterators[i];iterator.stillUnsubscribed?this.destination.add(iterator.subscribe()):this.active--}}else this.destination.complete()},ZipSubscriber.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},ZipSubscriber.prototype.checkIterators=function(){for(var iterators=this.iterators,len=iterators.length,destination=this.destination,i=0;i<len;i++)if("function"==typeof(iterator=iterators[i]).hasValue&&!iterator.hasValue())return;var shouldComplete=!1,args=[];for(i=0;i<len;i++){var iterator,result=(iterator=iterators[i]).next();if(iterator.hasCompleted()&&(shouldComplete=!0),result.done)return void destination.complete();args.push(result.value)}this.resultSelector?this._tryresultSelector(args):destination.next(args),shouldComplete&&destination.complete()},ZipSubscriber.prototype._tryresultSelector=function(args){var result;try{result=this.resultSelector.apply(this,args)}catch(err){return void this.destination.error(err)}this.destination.next(result)},ZipSubscriber}(Subscriber.a),StaticIterator=function(){function StaticIterator(iterator){this.iterator=iterator,this.nextResult=iterator.next()}return StaticIterator.prototype.hasValue=function(){return!0},StaticIterator.prototype.next=function(){var result=this.nextResult;return this.nextResult=this.iterator.next(),result},StaticIterator.prototype.hasCompleted=function(){var nextResult=this.nextResult;return Boolean(nextResult&&nextResult.done)},StaticIterator}(),zip_StaticArrayIterator=function(){function StaticArrayIterator(array){this.array=array,this.index=0,this.length=0,this.length=array.length}return StaticArrayIterator.prototype[iterator_iterator]=function(){return this},StaticArrayIterator.prototype.next=function(value){var i=this.index++,array=this.array;return i<this.length?{value:array[i],done:!1}:{value:null,done:!0}},StaticArrayIterator.prototype.hasValue=function(){return this.array.length>this.index},StaticArrayIterator.prototype.hasCompleted=function(){return this.array.length===this.index},StaticArrayIterator}(),zip_ZipBufferIterator=function(_super){function ZipBufferIterator(destination,parent,observable){var _this=_super.call(this,destination)||this;return _this.parent=parent,_this.observable=observable,_this.stillUnsubscribed=!0,_this.buffer=[],_this.isComplete=!1,_this}return tslib_es6.a(ZipBufferIterator,_super),ZipBufferIterator.prototype[iterator_iterator]=function(){return this},ZipBufferIterator.prototype.next=function(){var buffer=this.buffer;return 0===buffer.length&&this.isComplete?{value:null,done:!0}:{value:buffer.shift(),done:!1}},ZipBufferIterator.prototype.hasValue=function(){return this.buffer.length>0},ZipBufferIterator.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},ZipBufferIterator.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},ZipBufferIterator.prototype.notifyNext=function(innerValue){this.buffer.push(innerValue),this.parent.checkIterators()},ZipBufferIterator.prototype.subscribe=function(){return innerSubscribe(this.observable,new innerSubscribe_SimpleInnerSubscriber(this))},ZipBufferIterator}(innerSubscribe_SimpleOuterSubscriber),config=__webpack_require__(21);__webpack_require__.d(__webpack_exports__,"Observable",(function(){return Observable.a})),__webpack_require__.d(__webpack_exports__,"ConnectableObservable",(function(){return ConnectableObservable_ConnectableObservable})),__webpack_require__.d(__webpack_exports__,"GroupedObservable",(function(){return groupBy_GroupedObservable})),__webpack_require__.d(__webpack_exports__,"observable",(function(){return symbol_observable.a})),__webpack_require__.d(__webpack_exports__,"Subject",(function(){return Subject.a})),__webpack_require__.d(__webpack_exports__,"BehaviorSubject",(function(){return BehaviorSubject.a})),__webpack_require__.d(__webpack_exports__,"ReplaySubject",(function(){return ReplaySubject_ReplaySubject})),__webpack_require__.d(__webpack_exports__,"AsyncSubject",(function(){return AsyncSubject_AsyncSubject})),__webpack_require__.d(__webpack_exports__,"asap",(function(){return asap})),__webpack_require__.d(__webpack_exports__,"asapScheduler",(function(){return asapScheduler})),__webpack_require__.d(__webpack_exports__,"async",(function(){return async_async})),__webpack_require__.d(__webpack_exports__,"asyncScheduler",(function(){return asyncScheduler})),__webpack_require__.d(__webpack_exports__,"queue",(function(){return queue})),__webpack_require__.d(__webpack_exports__,"queueScheduler",(function(){return queueScheduler})),__webpack_require__.d(__webpack_exports__,"animationFrame",(function(){return animationFrame})),__webpack_require__.d(__webpack_exports__,"animationFrameScheduler",(function(){return animationFrameScheduler})),__webpack_require__.d(__webpack_exports__,"VirtualTimeScheduler",(function(){return VirtualTimeScheduler_VirtualTimeScheduler})),__webpack_require__.d(__webpack_exports__,"VirtualAction",(function(){return VirtualTimeScheduler_VirtualAction})),__webpack_require__.d(__webpack_exports__,"Scheduler",(function(){return Scheduler})),__webpack_require__.d(__webpack_exports__,"Subscription",(function(){return Subscription.a})),__webpack_require__.d(__webpack_exports__,"Subscriber",(function(){return Subscriber.a})),__webpack_require__.d(__webpack_exports__,"Notification",(function(){return Notification_Notification})),__webpack_require__.d(__webpack_exports__,"NotificationKind",(function(){return NotificationKind})),__webpack_require__.d(__webpack_exports__,"pipe",(function(){return pipe.a})),__webpack_require__.d(__webpack_exports__,"noop",(function(){return noop})),__webpack_require__.d(__webpack_exports__,"identity",(function(){return identity.a})),__webpack_require__.d(__webpack_exports__,"isObservable",(function(){return isObservable})),__webpack_require__.d(__webpack_exports__,"ArgumentOutOfRangeError",(function(){return ArgumentOutOfRangeError})),__webpack_require__.d(__webpack_exports__,"EmptyError",(function(){return EmptyError})),__webpack_require__.d(__webpack_exports__,"ObjectUnsubscribedError",(function(){return ObjectUnsubscribedError.a})),__webpack_require__.d(__webpack_exports__,"UnsubscriptionError",(function(){return UnsubscriptionError.a})),__webpack_require__.d(__webpack_exports__,"TimeoutError",(function(){return TimeoutError})),__webpack_require__.d(__webpack_exports__,"bindCallback",(function(){return bindCallback})),__webpack_require__.d(__webpack_exports__,"bindNodeCallback",(function(){return bindNodeCallback})),__webpack_require__.d(__webpack_exports__,"combineLatest",(function(){return combineLatest})),__webpack_require__.d(__webpack_exports__,"concat",(function(){return concat})),__webpack_require__.d(__webpack_exports__,"defer",(function(){return defer})),__webpack_require__.d(__webpack_exports__,"empty",(function(){return empty})),__webpack_require__.d(__webpack_exports__,"forkJoin",(function(){return forkJoin})),__webpack_require__.d(__webpack_exports__,"from",(function(){return from})),__webpack_require__.d(__webpack_exports__,"fromEvent",(function(){return fromEvent})),__webpack_require__.d(__webpack_exports__,"fromEventPattern",(function(){return fromEventPattern})),__webpack_require__.d(__webpack_exports__,"generate",(function(){return generate})),__webpack_require__.d(__webpack_exports__,"iif",(function(){return iif})),__webpack_require__.d(__webpack_exports__,"interval",(function(){return interval})),__webpack_require__.d(__webpack_exports__,"merge",(function(){return merge})),__webpack_require__.d(__webpack_exports__,"never",(function(){return never})),__webpack_require__.d(__webpack_exports__,"of",(function(){return of})),__webpack_require__.d(__webpack_exports__,"onErrorResumeNext",(function(){return onErrorResumeNext})),__webpack_require__.d(__webpack_exports__,"pairs",(function(){return pairs})),__webpack_require__.d(__webpack_exports__,"partition",(function(){return partition})),__webpack_require__.d(__webpack_exports__,"race",(function(){return race})),__webpack_require__.d(__webpack_exports__,"range",(function(){return range})),__webpack_require__.d(__webpack_exports__,"throwError",(function(){return throwError})),__webpack_require__.d(__webpack_exports__,"timer",(function(){return timer})),__webpack_require__.d(__webpack_exports__,"using",(function(){return using})),__webpack_require__.d(__webpack_exports__,"zip",(function(){return zip})),__webpack_require__.d(__webpack_exports__,"scheduled",(function(){return scheduled})),__webpack_require__.d(__webpack_exports__,"EMPTY",(function(){return EMPTY})),__webpack_require__.d(__webpack_exports__,"NEVER",(function(){return NEVER})),__webpack_require__.d(__webpack_exports__,"config",(function(){return config.a}))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return Subscriber}));var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_util_isFunction__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(35),_Observer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(53),_Subscription__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(13),_internal_symbol_rxSubscriber__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(41),_config__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(21),_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(36),Subscriber=function(_super){function Subscriber(destinationOrNext,error,complete){var _this=_super.call(this)||this;switch(_this.syncErrorValue=null,_this.syncErrorThrown=!1,_this.syncErrorThrowable=!1,_this.isStopped=!1,arguments.length){case 0:_this.destination=_Observer__WEBPACK_IMPORTED_MODULE_2__.a;break;case 1:if(!destinationOrNext){_this.destination=_Observer__WEBPACK_IMPORTED_MODULE_2__.a;break}if("object"==typeof destinationOrNext){destinationOrNext instanceof Subscriber?(_this.syncErrorThrowable=destinationOrNext.syncErrorThrowable,_this.destination=destinationOrNext,destinationOrNext.add(_this)):(_this.syncErrorThrowable=!0,_this.destination=new SafeSubscriber(_this,destinationOrNext));break}default:_this.syncErrorThrowable=!0,_this.destination=new SafeSubscriber(_this,destinationOrNext,error,complete)}return _this}return tslib__WEBPACK_IMPORTED_MODULE_0__.a(Subscriber,_super),Subscriber.prototype[_internal_symbol_rxSubscriber__WEBPACK_IMPORTED_MODULE_4__.a]=function(){return this},Subscriber.create=function(next,error,complete){var subscriber=new Subscriber(next,error,complete);return subscriber.syncErrorThrowable=!1,subscriber},Subscriber.prototype.next=function(value){this.isStopped||this._next(value)},Subscriber.prototype.error=function(err){this.isStopped||(this.isStopped=!0,this._error(err))},Subscriber.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},Subscriber.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,_super.prototype.unsubscribe.call(this))},Subscriber.prototype._next=function(value){this.destination.next(value)},Subscriber.prototype._error=function(err){this.destination.error(err),this.unsubscribe()},Subscriber.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},Subscriber.prototype._unsubscribeAndRecycle=function(){var _parentOrParents=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=_parentOrParents,this},Subscriber}(_Subscription__WEBPACK_IMPORTED_MODULE_3__.a),SafeSubscriber=function(_super){function SafeSubscriber(_parentSubscriber,observerOrNext,error,complete){var next,_this=_super.call(this)||this;_this._parentSubscriber=_parentSubscriber;var context=_this;return Object(_util_isFunction__WEBPACK_IMPORTED_MODULE_1__.a)(observerOrNext)?next=observerOrNext:observerOrNext&&(next=observerOrNext.next,error=observerOrNext.error,complete=observerOrNext.complete,observerOrNext!==_Observer__WEBPACK_IMPORTED_MODULE_2__.a&&(context=Object.create(observerOrNext),Object(_util_isFunction__WEBPACK_IMPORTED_MODULE_1__.a)(context.unsubscribe)&&_this.add(context.unsubscribe.bind(context)),context.unsubscribe=_this.unsubscribe.bind(_this))),_this._context=context,_this._next=next,_this._error=error,_this._complete=complete,_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.a(SafeSubscriber,_super),SafeSubscriber.prototype.next=function(value){if(!this.isStopped&&this._next){var _parentSubscriber=this._parentSubscriber;_config__WEBPACK_IMPORTED_MODULE_5__.a.useDeprecatedSynchronousErrorHandling&&_parentSubscriber.syncErrorThrowable?this.__tryOrSetError(_parentSubscriber,this._next,value)&&this.unsubscribe():this.__tryOrUnsub(this._next,value)}},SafeSubscriber.prototype.error=function(err){if(!this.isStopped){var _parentSubscriber=this._parentSubscriber,useDeprecatedSynchronousErrorHandling=_config__WEBPACK_IMPORTED_MODULE_5__.a.useDeprecatedSynchronousErrorHandling;if(this._error)useDeprecatedSynchronousErrorHandling&&_parentSubscriber.syncErrorThrowable?(this.__tryOrSetError(_parentSubscriber,this._error,err),this.unsubscribe()):(this.__tryOrUnsub(this._error,err),this.unsubscribe());else if(_parentSubscriber.syncErrorThrowable)useDeprecatedSynchronousErrorHandling?(_parentSubscriber.syncErrorValue=err,_parentSubscriber.syncErrorThrown=!0):Object(_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__.a)(err),this.unsubscribe();else{if(this.unsubscribe(),useDeprecatedSynchronousErrorHandling)throw err;Object(_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__.a)(err)}}},SafeSubscriber.prototype.complete=function(){var _this=this;if(!this.isStopped){var _parentSubscriber=this._parentSubscriber;if(this._complete){var wrappedComplete=function(){return _this._complete.call(_this._context)};_config__WEBPACK_IMPORTED_MODULE_5__.a.useDeprecatedSynchronousErrorHandling&&_parentSubscriber.syncErrorThrowable?(this.__tryOrSetError(_parentSubscriber,wrappedComplete),this.unsubscribe()):(this.__tryOrUnsub(wrappedComplete),this.unsubscribe())}else this.unsubscribe()}},SafeSubscriber.prototype.__tryOrUnsub=function(fn,value){try{fn.call(this._context,value)}catch(err){if(this.unsubscribe(),_config__WEBPACK_IMPORTED_MODULE_5__.a.useDeprecatedSynchronousErrorHandling)throw err;Object(_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__.a)(err)}},SafeSubscriber.prototype.__tryOrSetError=function(parent,fn,value){if(!_config__WEBPACK_IMPORTED_MODULE_5__.a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{fn.call(this._context,value)}catch(err){return _config__WEBPACK_IMPORTED_MODULE_5__.a.useDeprecatedSynchronousErrorHandling?(parent.syncErrorValue=err,parent.syncErrorThrown=!0,!0):(Object(_util_hostReportError__WEBPACK_IMPORTED_MODULE_6__.a)(err),!0)}return!1},SafeSubscriber.prototype._unsubscribe=function(){var _parentSubscriber=this._parentSubscriber;this._context=null,this._parentSubscriber=null,_parentSubscriber.unsubscribe()},SafeSubscriber}(Subscriber)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=CryptoJS=CryptoJS||function(Math,undefined){var create=Object.create||function(){function F(){}return function(obj){var subtype;return F.prototype=obj,subtype=new F,F.prototype=null,subtype}}(),C={},C_lib=C.lib={},Base=C_lib.Base={extend:function(overrides){var subtype=create(this);return overrides&&subtype.mixIn(overrides),subtype.hasOwnProperty("init")&&this.init!==subtype.init||(subtype.init=function(){subtype.$super.init.apply(this,arguments)}),subtype.init.prototype=subtype,subtype.$super=this,subtype},create:function(){var instance=this.extend();return instance.init.apply(instance,arguments),instance},init:function(){},mixIn:function(properties){for(var propertyName in properties)properties.hasOwnProperty(propertyName)&&(this[propertyName]=properties[propertyName]);properties.hasOwnProperty("toString")&&(this.toString=properties.toString)},clone:function(){return this.init.prototype.extend(this)}},WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[],this.sigBytes=null!=sigBytes?sigBytes:4*words.length},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words,thatWords=wordArray.words,thisSigBytes=this.sigBytes,thatSigBytes=wordArray.sigBytes;if(this.clamp(),thisSigBytes%4)for(var i=0;i<thatSigBytes;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}else for(i=0;i<thatSigBytes;i+=4)thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2];return this.sigBytes+=thatSigBytes,this},clamp:function(){var words=this.words,sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8,words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);return clone.words=this.words.slice(0),clone},random:function(nBytes){for(var rcache,words=[],r=function(m_w){m_w=m_w;var m_z=987654321,mask=4294967295;return function(){var result=((m_z=36969*(65535&m_z)+(m_z>>16)&mask)<<16)+(m_w=18e3*(65535&m_w)+(m_w>>16)&mask)&mask;return result/=4294967296,(result+=.5)*(Math.random()>.5?1:-1)}},i=0;i<nBytes;i+=4){var _r=r(4294967296*(rcache||Math.random()));rcache=987654071*_r(),words.push(4294967296*_r()|0)}return new WordArray.init(words,nBytes)}}),C_enc=C.enc={},Hex=C_enc.Hex={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,hexChars=[],i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16)),hexChars.push((15&bite).toString(16))}return hexChars.join("")},parse:function(hexStr){for(var hexStrLength=hexStr.length,words=[],i=0;i<hexStrLength;i+=2)words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4;return new WordArray.init(words,hexStrLength/2)}},Latin1=C_enc.Latin1={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,latin1Chars=[],i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){for(var latin1StrLength=latin1Str.length,words=[],i=0;i<latin1StrLength;i++)words[i>>>2]|=(255&latin1Str.charCodeAt(i))<<24-i%4*8;return new WordArray.init(words,latin1StrLength)}},Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}},BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init,this._nDataBytes=0},_append:function(data){"string"==typeof data&&(data=Utf8.parse(data)),this._data.concat(data),this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data,dataWords=data.words,dataSigBytes=data.sigBytes,blockSize=this.blockSize,nBlocksReady=dataSigBytes/(4*blockSize),nWordsReady=(nBlocksReady=doFlush?Math.ceil(nBlocksReady):Math.max((0|nBlocksReady)-this._minBufferSize,0))*blockSize,nBytesReady=Math.min(4*nWordsReady,dataSigBytes);if(nWordsReady){for(var offset=0;offset<nWordsReady;offset+=blockSize)this._doProcessBlock(dataWords,offset);var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0}),C_algo=(C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg),this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this),this._doReset()},update:function(messageUpdate){return this._append(messageUpdate),this._process(),this},finalize:function(messageUpdate){return messageUpdate&&this._append(messageUpdate),this._doFinalize()},blockSize:16,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}}),C.algo={});return C}(Math)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return Subscription}));var _util_isArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17),_util_isObject__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(50),_util_isFunction__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(35),_util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(42),Subscription=function(){function Subscription(unsubscribe){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,unsubscribe&&(this._ctorUnsubscribe=!0,this._unsubscribe=unsubscribe)}var empty;return Subscription.prototype.unsubscribe=function(){var errors;if(!this.closed){var _parentOrParents=this._parentOrParents,_ctorUnsubscribe=this._ctorUnsubscribe,_unsubscribe=this._unsubscribe,_subscriptions=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,_parentOrParents instanceof Subscription)_parentOrParents.remove(this);else if(null!==_parentOrParents)for(var index=0;index<_parentOrParents.length;++index)_parentOrParents[index].remove(this);if(Object(_util_isFunction__WEBPACK_IMPORTED_MODULE_2__.a)(_unsubscribe)){_ctorUnsubscribe&&(this._unsubscribe=void 0);try{_unsubscribe.call(this)}catch(e){errors=e instanceof _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_3__.a?flattenUnsubscriptionErrors(e.errors):[e]}}if(Object(_util_isArray__WEBPACK_IMPORTED_MODULE_0__.a)(_subscriptions)){index=-1;for(var len=_subscriptions.length;++index<len;){var sub=_subscriptions[index];if(Object(_util_isObject__WEBPACK_IMPORTED_MODULE_1__.a)(sub))try{sub.unsubscribe()}catch(e){errors=errors||[],e instanceof _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_3__.a?errors=errors.concat(flattenUnsubscriptionErrors(e.errors)):errors.push(e)}}}if(errors)throw new _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_3__.a(errors)}},Subscription.prototype.add=function(teardown){var subscription=teardown;if(!teardown)return Subscription.EMPTY;switch(typeof teardown){case"function":subscription=new Subscription(teardown);case"object":if(subscription===this||subscription.closed||"function"!=typeof subscription.unsubscribe)return subscription;if(this.closed)return subscription.unsubscribe(),subscription;if(!(subscription instanceof Subscription)){var tmp=subscription;(subscription=new Subscription)._subscriptions=[tmp]}break;default:throw new Error("unrecognized teardown "+teardown+" added to Subscription.")}var _parentOrParents=subscription._parentOrParents;if(null===_parentOrParents)subscription._parentOrParents=this;else if(_parentOrParents instanceof Subscription){if(_parentOrParents===this)return subscription;subscription._parentOrParents=[_parentOrParents,this]}else{if(-1!==_parentOrParents.indexOf(this))return subscription;_parentOrParents.push(this)}var subscriptions=this._subscriptions;return null===subscriptions?this._subscriptions=[subscription]:subscriptions.push(subscription),subscription},Subscription.prototype.remove=function(subscription){var subscriptions=this._subscriptions;if(subscriptions){var subscriptionIndex=subscriptions.indexOf(subscription);-1!==subscriptionIndex&&subscriptions.splice(subscriptionIndex,1)}},Subscription.EMPTY=((empty=new Subscription).closed=!0,empty),Subscription}();function flattenUnsubscriptionErrors(errors){return errors.reduce((function(errs,err){return errs.concat(err instanceof _util_UnsubscriptionError__WEBPACK_IMPORTED_MODULE_3__.a?err.errors:err)}),[])}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(text){if(!text)return null;if(config&&config.debug)return text;var result="";return 0===text.indexOf("+")&&(result="+"),result=text.length>4?result+"*".repeat(text.length-4-result.length)+text.slice(text.length-4):text}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var settings_service_1=__webpack_require__(5),LoggerService=function(){function LoggerService(){var _this54=this;_classCallCheck(this,LoggerService),this.colors={trace:"blue",debug:"gray",info:"teal",log:"teal",warn:"red",error:"red",webrtc:"green"},this.logsBuffer=[],this.enableConsoleLog=!1,this.desktopMode=!1,window.LoggerService=this,this.computeConsoleStatus(),settings_service_1.default.subscribeUpdateEvent("SETTINGS_UPDATED",(function(){_this54.computeConsoleStatus()}));var ua=navigator.userAgent.toLowerCase();this.desktopMode=ua.indexOf("qtwebengine")>-1||ua.indexOf("electron/")>-1}return _createClass(LoggerService,[{key:"computeConsoleStatus",value:function(){"true"===settings_service_1.default.getSetting("forceConsoleLog")?this.enableConsoleLog=!0:this.enableConsoleLog=window.config&&window.config.consoleLog||!1}},{key:"error",value:function(message){this.logger("error",message)}},{key:"warn",value:function(message){this.logger("warn",message)}},{key:"info",value:function(message){this.logger("info",message)}},{key:"log",value:function(message){this.logger("log",message)}},{key:"debug",value:function(message){this.logger("debug",message)}},{key:"getLogs",value:function(){return this.logsBuffer}},{key:"logger",value:function(level,text){if(this.desktopMode)console[level]("".concat(level.toUpperCase()," ").concat(text));else{var tzoffset=6e4*(new Date).getTimezoneOffset(),message="".concat(new Date(Date.now()-tzoffset).toISOString().slice(0,-1)," ").concat(level.toUpperCase()," ").concat(text);this.enableConsoleLog&&console[level]("%c "+message,"color:"+this.colors[level]),6e3===this.logsBuffer.length&&this.logsBuffer.shift(),this.logsBuffer.push(message+"\n")}}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.loggerService||(win.rainbow.loggerService=new LoggerService),win.rainbow.loggerService}}]),LoggerService}();exports.LoggerService=LoggerService,exports.default=LoggerService.getInstance()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),replaceMsg_1=__webpack_require__(222),Message=function(){function Message(id,type,date,from,side,data,status){var fileId=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,isMarkdown=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,additionalContent=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,subject=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,fileName=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,answeredMsgId=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,answeredMsgDate=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,geoloc=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null,alternativeContent=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null,mentions=arguments.length>16&&void 0!==arguments[16]?arguments[16]:null;_classCallCheck(this,Message),this.urgencyAck=!1,this.urgencyHandler=null,this.translatedText=null,this.historyIndex=null,this.fileErrorMsg=null,this.attachedMsgId=null,this.forwardedMsg=null,this.id=id,this.type=type,this.date=date,this.from=from,this.side=side;var toShort=emojione?emojione.toShort:function(text){return text};this.data=toShort(data),this.status=status,this.fileId=fileId,this.isMarkdown=isMarkdown,this.additionalContent=additionalContent,this.subject=subject,this.fileName=fileName,this.answeredMsgId=answeredMsgId,this.answeredMsgDate=answeredMsgDate,this.geoloc=geoloc,this.alternativeContent=alternativeContent,this.mentions=mentions,this.receiptStatus=Message.ReceiptStatus.NONE,this.serverAckTimer=null,this.index=null,this.showCorrectedMessages=!1,this.replaceMsgs=[],this.rxSubject=new rxjs_1.Subject,this.isMerged=!1}return _createClass(Message,[{key:"sendUpdateEvent",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.rxSubject.next(data)}},{key:"listenUpdateEvent",value:function(callback){return this.rxSubject.subscribe(callback)}},{key:"isTextModified",value:function(){return this.replaceMsgs.length>0}},{key:"isModified",value:function(){return this.replaceMsgs.length>0&&""!==this.getLastTextModified()}},{key:"isDeleted",value:function(){return 0===this.getLastTextModified().length}},{key:"getLastTextModified",value:function(){return this.replaceMsgs.length>0?this.replaceMsgs[this.replaceMsgs.length-1].body:this.data}},{key:"addReplaceMsg",value:function(messageId,replacedMsgBody){var replacedMsg=replaceMsg_1.ReplaceMsg.create(messageId,replacedMsgBody);this.replaceMsgs.push(replacedMsg)}},{key:"setReceiptStatus",value:function(receiptStatus){return this.serverAckTimer&&receiptStatus>Message.ReceiptStatus.IN_PROGRESS&&(clearTimeout(this.serverAckTimer),this.serverAckTimer=null),receiptStatus>this.receiptStatus&&(this.receiptStatus=receiptStatus),this.sendUpdateEvent(),this}},{key:"getInfoForLogs",value:function(){var body=this.data.length?this.data.substr(0,1)+"***"+this.data.substr(this.data.length-1):"";return"Id "+this.id+", type "+this.type.value+", side "+this.side+", date "+this.date+" and data "+body}}],[{key:"create",value:function(id,date,from,side,data,status){var isMarkdown=arguments.length>6&&void 0!==arguments[6]&&arguments[6],additionalContent=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,subject=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,answeredMsgId=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,answeredMsgDate=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,alternativeContent=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,mentions=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,type=additionalContent&&additionalContent["form/json"]?Message.Type.FORM:Message.Type.CHAT;return new Message(id,type,date,from,side,data,status,null,isMarkdown,additionalContent,subject,null,answeredMsgId,answeredMsgDate,null,alternativeContent,mentions)}},{key:"createFromMsg",value:function(origMsg){var message=Message.create(origMsg.id,origMsg.date,origMsg.from,origMsg.side,origMsg.data,origMsg.status,origMsg.isMarkdown);return origMsg.fileId&&(message.type=Message.Type.FS,message.fileId=origMsg.fileId,message.fileName=origMsg.fileName),origMsg.geoloc&&(message.geoloc=origMsg.geoloc),message}},{key:"createFileSharingMessage",value:function(id,date,from,side,data,status,fileId,fileName,attachedInfos,geoloc){var attention=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,msg=new Message(id,Message.Type.FS,date,from,side,data,status,fileId,null,null,null,fileName,null,null,geoloc,null,attention);return attachedInfos&&(msg.attachedMsgId=attachedInfos.attachedMsgId,msg.attachIndex=attachedInfos.index,msg.attachNumber=attachedInfos.number),msg}},{key:"createFileMessage",value:function(id,date,from,side,data,status){return new Message(id,Message.Type.FILE,date,from,side,data,status)}},{key:"createWebRTCMessage",value:function(id,date,from,side,data,status){return new Message(id,Message.Type.WEBRTC,date,from,side,data,status)}},{key:"createBubbleAdminMessage",value:function(id,date,from,type){return new Message(id,Message.Type.CHAT,date,from,Message.Side.ADMIN,type+"MsgRoom",null)}},{key:"createRecordingAdminMessage",value:function(id,date,from,type,cmd){return new Message(id,Message.Type.RECORDING,date,from,Message.Side.ADMIN,cmd+"Recording",null)}}]),Message}();Message.Type={CHAT:{key:0,value:"Chat"},FILE:{key:1,value:"File"},FS:{key:2,value:"FileSharing"},WEBRTC:{key:4,value:"WebRTC CAll"},RECORDING:{key:5,value:"Recording"},FORM:{key:6,value:"FORM"},FORWARD:{key:7,value:"FORWARD"}},Message.ReceiptStatus={NONE:0,ERROR:1,IN_PROGRESS:2,SENT:3,UNREAD:4,READ:5},Message.ReceiptStatusText=["close","error--filled","calllog","check","done","read"],Message.Side={LEFT:"L",RIGHT:"R",ADMIN:"ADMIN"},exports.Message=Message,exports.AnswerMessage=function(){return function _class2(name,messageAnswered,answeredMessageData){_classCallCheck(this,_class2),this.name=name,this.messageAnswered=messageAnswered,this.answeredMessageData=answeredMessageData}}()},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return isArray}));var isArray=Array.isArray||function(x){return x&&"number"==typeof x.length}},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(61),__webpack_require__(277),__webpack_require__(278),__webpack_require__(46),__webpack_require__(47),__webpack_require__(72),__webpack_require__(217),__webpack_require__(279),__webpack_require__(218),__webpack_require__(280),__webpack_require__(281),__webpack_require__(282),__webpack_require__(73),__webpack_require__(283),__webpack_require__(40),__webpack_require__(20),__webpack_require__(284),__webpack_require__(285),__webpack_require__(286),__webpack_require__(287),__webpack_require__(288),__webpack_require__(289),__webpack_require__(290),__webpack_require__(291),__webpack_require__(292),__webpack_require__(293),__webpack_require__(294),__webpack_require__(295),__webpack_require__(296),__webpack_require__(297),__webpack_require__(298),__webpack_require__(299),CryptoJS)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),Company=function(){function Company(data){var _this55=this;_classCallCheck(this,Company),this.logo=null,this.nameForLogs="",this.banner=null,this.office365ScopesGranted=[],this.visibility="public",Company.attributes.forEach((function(attribute){void 0!==data[attribute.name]?_this55[attribute.name]=data[attribute.name]:void 0!==attribute.defaultValue&&(_this55[attribute.name]=attribute.defaultValue)})),this.state=data.state?data.state:"USA"===data.country?"AL":"CAN"===data.country?"AB":null,this.name&&(this.filterName=this.name.toLowerCase()),this.rxSubject=new rxjs_1.Subject}return _createClass(Company,[{key:"updateFromData",value:function(data){var _this56=this;Company.attributes.forEach((function(attribute){void 0!==data[attribute.name]&&(_this56[attribute.name]=data[attribute.name])}))}},{key:"getNameForLogs",value:function(){return!this.nameForLogs&&this.name&&(this.nameForLogs=this.name.charAt(0)+this.name.replace(/[^\s](?=.{1,}$)/g,"*").substr(1)),this.nameForLogs}},{key:"isActive",value:function(){return"active"===this.status}},{key:"isInitializing",value:function(){return"initializing"===this.status}},{key:"isInvited",value:function(){return"invited"===this.status}},{key:"isFreemium",value:function(){return"freemium"===this.offerType}},{key:"isPremium",value:function(){return"premium"===this.offerType}},{key:"isVAD",value:function(){return this.isBP&&"VAD"===this.bpType}},{key:"isIR",value:function(){return this.isBP&&"IR"===this.bpType}},{key:"isDR",value:function(){return this.isBP&&"DR"===this.bpType}},{key:"isEC",value:function(){return!this.isBP}},{key:"onChange",value:function(callback){return this.rxSubject.subscribe(callback)}},{key:"sendChangeEvent",value:function(type){var value=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next({type:type,value:value})}}],[{key:"create",value:function(id,name){return new Company({id:id,name:name})}},{key:"createFromData",value:function(data){return new Company(data)}},{key:"prune",value:function(data,userContact){var dataCopy=Object.assign({},data);return delete dataCopy.dataLocation,delete dataCopy.businessSpecific,delete dataCopy.giphyEnabled,dataCopy.isBP||(delete dataCopy.bpType,delete dataCopy.bpBusinessModel,delete dataCopy.bpApplicantNumber,delete dataCopy.bpCRDid,delete dataCopy.bpHasRightToSell,delete dataCopy.bpHasRightToConnect,delete dataCopy.bpIsContractAccepted),""===dataCopy.economicActivityClassification&&delete dataCopy.economicActivityClassification,userContact&&(userContact.isSuperadmin()||userContact.isBPAdminFinance())||(delete dataCopy.bpType,delete dataCopy.adminHasRightToUpdateSubscriptions,delete dataCopy.adminAllowedUpdateSubscriptionsOps),userContact&&userContact.isSuperadmin()||delete dataCopy.superadminComment,userContact&&(userContact.isSuperadmin()||null!==dataCopy.supportEmail&&""!==dataCopy.supportEmail)||delete dataCopy.supportEmail,userContact&&(userContact.isSuperadmin()||null!==dataCopy.privateDC&&""!==dataCopy.privateDC)||delete dataCopy.privateDC,dataCopy}}]),Company}();Company.StatusValues=["initializing","active","alerting","hold","terminated"],Company.VisibilityValuesWithOrganization=["public","private","organization","closed","isolated"],Company.VisibilityValues=["public","private","closed","isolated"],Company.SizeValues=["self-employed","1-10 employees","11-50 employees","51-200 employees","201-500 employees","501-1000 employees","1001-5000 employees","5001-10,000 employees","10,001+ employees"],Company.OfferTypes=["freemium","premium"],Company.BPTypes=["VAD","DR","IR"],Company.BPTypeLabels={IR:"Indirect Reseller",VAD:"Value Added Distributor",DR:"Direct Reseller"},Company.BPBusinessModels=["resell"],Company.BPBusinessModelLabels={resell:"Resell",referral:"Referral"},Company.adminAllowedUpdateSubscriptionsOperations=["all","increase_only"],Company.BPBusinessTypes={DEFAULT:"default",VOICE_BY_ALE:"voice_by_ale",VOICE_BY_PARTNER:"voice_by_partner",CONFERENCE:"conference"},Company.EconomicActivityClassificationTypes={NONE:"notDefined-f",A:"agriculture",B:"mining",C:"manufacturing",D:"electricity",E:"water supply",F:"construction",G:"wholesale",H:"transportation",I:"accommodation",J:"information and communication",K:"financial",L:"real estate activities",M:"professional",N:"administrative",O:"public administration",P:"education",Q:"human health",R:"arts",S:"other service activities",T:"activities of households as employer",U:"activities of extraterritorial organisations and bodies"},Company.PrivateDCValues=["HDS"],Company.attributes=[{name:"id",defaultValue:void 0},{name:"name",defaultValue:""},{name:"creationDate",defaultValue:void 0},{name:"companyContactId",defaultValue:void 0},{name:"adminEmail",defaultValue:""},{name:"supportEmail",defaultValue:void 0},{name:"status",defaultValue:"active"},{name:"economicActivityClassification",defaultValue:"NONE"},{name:"website",defaultValue:void 0},{name:"description",defaultValue:void 0},{name:"visibility",defaultValue:"private"},{name:"visibleBy",defaultValue:[]},{name:"organisationId",defaultValue:""},{name:"userSelfRegisterEnabled",defaultValue:!1},{name:"userSelfRegisterAllowedDomains",defaultValue:[]},{name:"offerType",defaultValue:"freemium"},{name:"street",defaultValue:void 0},{name:"city",defaultValue:void 0},{name:"postalCode",defaultValue:void 0},{name:"country",defaultValue:void 0},{name:"state",defaultValue:null},{name:"size",defaultValue:void 0},{name:"slogan",defaultValue:void 0},{name:"isBP",defaultValue:!1},{name:"bpType",defaultValue:void 0},{name:"bpBusinessModel",defaultValue:void 0},{name:"bpApplicantNumber",defaultValue:void 0},{name:"bpCRDid",defaultValue:void 0},{name:"bpHasRightToSell",defaultValue:void 0},{name:"bpId",defaultValue:void 0},{name:"bpHasRightToConnect",defaultValue:void 0},{name:"adminHasRightToUpdateSubscriptions",defaultValue:!1},{name:"adminAllowedUpdateSubscriptionsOps",defaultValue:"all"},{name:"externalReference",defaultValue:void 0},{name:"externalReference2",defaultValue:void 0},{name:"lastAvatarUpdateDate",defaultValue:null},{name:"lastBannerUpdateDate",defaultValue:null},{name:"avatarShape",defaultValue:"circle"},{name:"catalogId",defaultValue:void 0},{name:"office365Tenant",defaultValue:void 0},{name:"office365ScopesGranted",defaultValue:void 0},{name:"isCentrex",defaultValue:void 0},{name:"tenantCallNumber",defaultValue:void 0},{name:"tenantName",defaultValue:void 0},{name:"numberUsers",defaultValue:void 0},{name:"dataLocation",defaultValue:void 0},{name:"privateDC",defaultValue:void 0},{name:"businessSpecific",defaultValue:void 0},{name:"superadminComment",defaultValue:void 0},{name:"bpBusinessType",defaultValue:[]},{name:"voIPSettings",defaultValue:void 0},{name:"allowUsersSelectTheme",defaultValue:!0},{name:"allowUsersSelectPublicTheme",defaultValue:!0},{name:"selectedTheme",defaultValue:void 0},{name:"tryNewUiCustomisation",defaultValue:void 0},{name:"softphoneOnlyCustomisation",defaultValue:void 0},{name:"fileSharingCustomisation",defaultValue:"enabled"},{name:"userTitleNameCustomisation",defaultValue:void 0},{name:"useRoomCustomisation",defaultValue:"enabled"},{name:"phoneMeetingCustomisation",defaultValue:"enabled"},{name:"useChannelCustomisation",defaultValue:"enabled"},{name:"useWebRTCVideoCustomisation",defaultValue:"enabled"},{name:"useWebRTCAudioCustomisation",defaultValue:"enabled"},{name:"instantMessagesCustomisation",defaultValue:"enabled"},{name:"userProfileCustomisation",defaultValue:"enabled"},{name:"fileStorageCustomisation",defaultValue:"enabled"},{name:"overridePresenceCustomisation",defaultValue:"enabled"},{name:"changeSettingsCustomisation",defaultValue:"enabled"},{name:"changeTelephonyCustomisation",defaultValue:"enabled"},{name:"recordingConversationCustomisation",defaultValue:"enabled"},{name:"useGifCustomisation",defaultValue:"enabled"},{name:"useDialOutCustomisation",defaultValue:"enabled"},{name:"selectedAppCustomisationTemplate",defaultValue:void 0},{name:"mobilePermanentConnectionMode",defaultValue:void 0},{name:"allowCloudPbxRecording",defaultValue:void 0},{name:"defaultLicenseGroup",defaultValue:void 0}],exports.Company=Company},function(module,exports,__webpack_require__){var CryptoJS,C,C_lib,Base,WordArray,BufferedBlockAlgorithm,C_enc,Base64,EvpKDF,Cipher,C_mode,BlockCipherMode,CBC,Pkcs7,CipherParams,OpenSSLFormatter,SerializableCipher,OpenSSLKdf,PasswordBasedCipher;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(40),void(CryptoJS.lib.Cipher||(C=CryptoJS,C_lib=C.lib,Base=C_lib.Base,WordArray=C_lib.WordArray,BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm,C_enc=C.enc,C_enc.Utf8,Base64=C_enc.Base64,EvpKDF=C.algo.EvpKDF,Cipher=C_lib.Cipher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),createEncryptor:function(key,cfg){return this.create(this._ENC_XFORM_MODE,key,cfg)},createDecryptor:function(key,cfg){return this.create(this._DEC_XFORM_MODE,key,cfg)},init:function(xformMode,key,cfg){this.cfg=this.cfg.extend(cfg),this._xformMode=xformMode,this._key=key,this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this),this._doReset()},process:function(dataUpdate){return this._append(dataUpdate),this._process()},finalize:function(dataUpdate){return dataUpdate&&this._append(dataUpdate),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(key){return"string"==typeof key?PasswordBasedCipher:SerializableCipher}return function(cipher){return{encrypt:function(message,key,cfg){return selectCipherStrategy(key).encrypt(cipher,message,key,cfg)},decrypt:function(ciphertext,key,cfg){return selectCipherStrategy(key).decrypt(cipher,ciphertext,key,cfg)}}}}()}),C_lib.StreamCipher=Cipher.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),C_mode=C.mode={},BlockCipherMode=C_lib.BlockCipherMode=Base.extend({createEncryptor:function(cipher,iv){return this.Encryptor.create(cipher,iv)},createDecryptor:function(cipher,iv){return this.Decryptor.create(cipher,iv)},init:function(cipher,iv){this._cipher=cipher,this._iv=iv}}),CBC=C_mode.CBC=function(){var CBC=BlockCipherMode.extend();function xorBlock(words,offset,blockSize){var iv=this._iv;if(iv){var block=iv;this._iv=void 0}else block=this._prevBlock;for(var i=0;i<blockSize;i++)words[offset+i]^=block[i]}return CBC.Encryptor=CBC.extend({processBlock:function(words,offset){var cipher=this._cipher,blockSize=cipher.blockSize;xorBlock.call(this,words,offset,blockSize),cipher.encryptBlock(words,offset),this._prevBlock=words.slice(offset,offset+blockSize)}}),CBC.Decryptor=CBC.extend({processBlock:function(words,offset){var cipher=this._cipher,blockSize=cipher.blockSize,thisBlock=words.slice(offset,offset+blockSize);cipher.decryptBlock(words,offset),xorBlock.call(this,words,offset,blockSize),this._prevBlock=thisBlock}}),CBC}(),Pkcs7=(C.pad={}).Pkcs7={pad:function(data,blockSize){for(var blockSizeBytes=4*blockSize,nPaddingBytes=blockSizeBytes-data.sigBytes%blockSizeBytes,paddingWord=nPaddingBytes<<24|nPaddingBytes<<16|nPaddingBytes<<8|nPaddingBytes,paddingWords=[],i=0;i<nPaddingBytes;i+=4)paddingWords.push(paddingWord);var padding=WordArray.create(paddingWords,nPaddingBytes);data.concat(padding)},unpad:function(data){var nPaddingBytes=255&data.words[data.sigBytes-1>>>2];data.sigBytes-=nPaddingBytes}},C_lib.BlockCipher=Cipher.extend({cfg:Cipher.cfg.extend({mode:CBC,padding:Pkcs7}),reset:function(){Cipher.reset.call(this);var cfg=this.cfg,iv=cfg.iv,mode=cfg.mode;if(this._xformMode==this._ENC_XFORM_MODE)var modeCreator=mode.createEncryptor;else modeCreator=mode.createDecryptor,this._minBufferSize=1;this._mode&&this._mode.__creator==modeCreator?this._mode.init(this,iv&&iv.words):(this._mode=modeCreator.call(mode,this,iv&&iv.words),this._mode.__creator=modeCreator)},_doProcessBlock:function(words,offset){this._mode.processBlock(words,offset)},_doFinalize:function(){var padding=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){padding.pad(this._data,this.blockSize);var finalProcessedBlocks=this._process(!0)}else finalProcessedBlocks=this._process(!0),padding.unpad(finalProcessedBlocks);return finalProcessedBlocks},blockSize:4}),CipherParams=C_lib.CipherParams=Base.extend({init:function(cipherParams){this.mixIn(cipherParams)},toString:function(formatter){return(formatter||this.formatter).stringify(this)}}),OpenSSLFormatter=(C.format={}).OpenSSL={stringify:function(cipherParams){var ciphertext=cipherParams.ciphertext,salt=cipherParams.salt;if(salt)var wordArray=WordArray.create([1398893684,1701076831]).concat(salt).concat(ciphertext);else wordArray=ciphertext;return wordArray.toString(Base64)},parse:function(openSSLStr){var ciphertext=Base64.parse(openSSLStr),ciphertextWords=ciphertext.words;if(1398893684==ciphertextWords[0]&&1701076831==ciphertextWords[1]){var salt=WordArray.create(ciphertextWords.slice(2,4));ciphertextWords.splice(0,4),ciphertext.sigBytes-=16}return CipherParams.create({ciphertext:ciphertext,salt:salt})}},SerializableCipher=C_lib.SerializableCipher=Base.extend({cfg:Base.extend({format:OpenSSLFormatter}),encrypt:function(cipher,message,key,cfg){cfg=this.cfg.extend(cfg);var encryptor=cipher.createEncryptor(key,cfg),ciphertext=encryptor.finalize(message),cipherCfg=encryptor.cfg;return CipherParams.create({ciphertext:ciphertext,key:key,iv:cipherCfg.iv,algorithm:cipher,mode:cipherCfg.mode,padding:cipherCfg.padding,blockSize:cipher.blockSize,formatter:cfg.format})},decrypt:function(cipher,ciphertext,key,cfg){return cfg=this.cfg.extend(cfg),ciphertext=this._parse(ciphertext,cfg.format),cipher.createDecryptor(key,cfg).finalize(ciphertext.ciphertext)},_parse:function(ciphertext,format){return"string"==typeof ciphertext?format.parse(ciphertext,this):ciphertext}}),OpenSSLKdf=(C.kdf={}).OpenSSL={execute:function(password,keySize,ivSize,salt){salt||(salt=WordArray.random(8));var key=EvpKDF.create({keySize:keySize+ivSize}).compute(password,salt),iv=WordArray.create(key.words.slice(keySize),4*ivSize);return key.sigBytes=4*keySize,CipherParams.create({key:key,iv:iv,salt:salt})}},PasswordBasedCipher=C_lib.PasswordBasedCipher=SerializableCipher.extend({cfg:SerializableCipher.cfg.extend({kdf:OpenSSLKdf}),encrypt:function(cipher,message,password,cfg){var derivedParams=(cfg=this.cfg.extend(cfg)).kdf.execute(password,cipher.keySize,cipher.ivSize);cfg.iv=derivedParams.iv;var ciphertext=SerializableCipher.encrypt.call(this,cipher,message,derivedParams.key,cfg);return ciphertext.mixIn(derivedParams),ciphertext},decrypt:function(cipher,ciphertext,password,cfg){cfg=this.cfg.extend(cfg),ciphertext=this._parse(ciphertext,cfg.format);var derivedParams=cfg.kdf.execute(password,cipher.keySize,cipher.ivSize,ciphertext.salt);return cfg.iv=derivedParams.iv,SerializableCipher.decrypt.call(this,cipher,ciphertext,derivedParams.key,cfg)}}))))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return config}));var _enable_super_gross_mode_that_will_cause_bad_things=!1,config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(value){value&&(new Error).stack,_enable_super_gross_mode_that_will_cause_bad_things=value},get useDeprecatedSynchronousErrorHandling(){return _enable_super_gross_mode_that_will_cause_bad_things}}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var eventsService=new(function(){function _class3(){_classCallCheck(this,_class3)}return _createClass(_class3,[{key:"dispatchEvent",value:function(eventName){var eventDetail=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;document.dispatchEvent(new CustomEvent(eventName,{detail:eventDetail}))}}]),_class3}());exports.eventsService=eventsService},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"b",(function(){return SubjectSubscriber})),__webpack_require__.d(__webpack_exports__,"a",(function(){return Subject}));var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_Observable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8),_Subscriber__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11),_Subscription__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(13),_util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(30),_SubjectSubscription__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(63),_internal_symbol_rxSubscriber__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(41),SubjectSubscriber=function(_super){function SubjectSubscriber(destination){var _this=_super.call(this,destination)||this;return _this.destination=destination,_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.a(SubjectSubscriber,_super),SubjectSubscriber}(_Subscriber__WEBPACK_IMPORTED_MODULE_2__.a),Subject=function(_super){function Subject(){var _this=_super.call(this)||this;return _this.observers=[],_this.closed=!1,_this.isStopped=!1,_this.hasError=!1,_this.thrownError=null,_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.a(Subject,_super),Subject.prototype[_internal_symbol_rxSubscriber__WEBPACK_IMPORTED_MODULE_6__.a]=function(){return new SubjectSubscriber(this)},Subject.prototype.lift=function(operator){var subject=new AnonymousSubject(this,this);return subject.operator=operator,subject},Subject.prototype.next=function(value){if(this.closed)throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_4__.a;if(!this.isStopped)for(var observers=this.observers,len=observers.length,copy=observers.slice(),i=0;i<len;i++)copy[i].next(value)},Subject.prototype.error=function(err){if(this.closed)throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_4__.a;this.hasError=!0,this.thrownError=err,this.isStopped=!0;for(var observers=this.observers,len=observers.length,copy=observers.slice(),i=0;i<len;i++)copy[i].error(err);this.observers.length=0},Subject.prototype.complete=function(){if(this.closed)throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_4__.a;this.isStopped=!0;for(var observers=this.observers,len=observers.length,copy=observers.slice(),i=0;i<len;i++)copy[i].complete();this.observers.length=0},Subject.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},Subject.prototype._trySubscribe=function(subscriber){if(this.closed)throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_4__.a;return _super.prototype._trySubscribe.call(this,subscriber)},Subject.prototype._subscribe=function(subscriber){if(this.closed)throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_4__.a;return this.hasError?(subscriber.error(this.thrownError),_Subscription__WEBPACK_IMPORTED_MODULE_3__.a.EMPTY):this.isStopped?(subscriber.complete(),_Subscription__WEBPACK_IMPORTED_MODULE_3__.a.EMPTY):(this.observers.push(subscriber),new _SubjectSubscription__WEBPACK_IMPORTED_MODULE_5__.a(this,subscriber))},Subject.prototype.asObservable=function(){var observable=new _Observable__WEBPACK_IMPORTED_MODULE_1__.a;return observable.source=this,observable},Subject.create=function(destination,source){return new AnonymousSubject(destination,source)},Subject}(_Observable__WEBPACK_IMPORTED_MODULE_1__.a),AnonymousSubject=function(_super){function AnonymousSubject(destination,source){var _this=_super.call(this)||this;return _this.destination=destination,_this.source=source,_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.a(AnonymousSubject,_super),AnonymousSubject.prototype.next=function(value){var destination=this.destination;destination&&destination.next&&destination.next(value)},AnonymousSubject.prototype.error=function(err){var destination=this.destination;destination&&destination.error&&this.destination.error(err)},AnonymousSubject.prototype.complete=function(){var destination=this.destination;destination&&destination.complete&&this.destination.complete()},AnonymousSubject.prototype._subscribe=function(subscriber){return this.source?this.source.subscribe(subscriber):_Subscription__WEBPACK_IMPORTED_MODULE_3__.a.EMPTY},AnonymousSubject}(Subject)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var RBEvent=function(){function RBEvent(name,data){_classCallCheck(this,RBEvent),this.name=null,this.data=null,this.name=name,this.data=data}return _createClass(RBEvent,null,[{key:"create",value:function(name){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new RBEvent(name,data)}}]),RBEvent}();exports.RBEvent=RBEvent},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var fileDescriptor_1=__webpack_require__(54),fileViewer_1=__webpack_require__(71),rxjs_1=__webpack_require__(10),filePublicDownload_1=__webpack_require__(330),distinctUntilChanged_1=__webpack_require__(75),logger_service_1=__webpack_require__(15),contact_service_1=__webpack_require__(1),auth_service_1=__webpack_require__(2),event_service_1=__webpack_require__(32),errorHelper_service_1=__webpack_require__(37),FileStorageService=function(){function FileStorageService(){_classCallCheck(this,FileStorageService),this.started=!1,this.listeners=[],this.currentOrder="date",this.voiceMessageFileDescriptors=[],this.fileDescriptors=[],this.receivedFileDescriptors=[],this.mergedFileDescriptors=[],this.contactService=contact_service_1.default,this.logger=logger_service_1.default,this.errorHelperService=errorHelper_service_1.default,this.eventService=event_service_1.default,this.deleteFileWoConfirm=!1,this.fileDescriptorsSubject=null,this.publicFileDownload=[],this.publicFileDownloadSubject=null,this.startedSubject=new rxjs_1.BehaviorSubject(!1),this.retrieveFileDescriptorPromises=[],this.authService=auth_service_1.default}return _createClass(FileStorageService,[{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee51(){var _this57=this;return regenerator_default.a.wrap((function(_context52){for(;;)switch(_context52.prev=_context52.next){case 0:this.started=!1,this.portalURL=config.restServerUrl+"/api/rainbow/filestorage/v1.0/files",this.fileDescriptors=[],this.receivedFileDescriptors=[],this.mergedFileDescriptors=[],this.voiceMessageFileDescriptors=[],this.fileDescriptorsSubject=new rxjs_1.Subject,this.publicFileDownload=[],this.publicFileDownloadSubject=new rxjs_1.Subject,this.contactService.userContact.fileStorageEnabledSubject.pipe(distinctUntilChanged_1.distinctUntilChanged()).subscribe((function(fileStorageEnabled){return __awaiter(_this57,void 0,void 0,regenerator_default.a.mark((function _callee50(){var _this58=this;return regenerator_default.a.wrap((function(_context51){for(;;)switch(_context51.prev=_context51.next){case 0:if(!fileStorageEnabled){_context51.next=18;break}return this.logger.info("[FileStorageService] === STARTING ==="),_context51.prev=2,this.consumptionData={},_context51.next=6,this.getFileDescriptorsFromServer();case 6:this.started=!0,this.logger.info("[FileStorageService] === STARTED ==="),this.startedSubject.next(!0),this.contactService.userContact.fileStorageEnabledSubject.pipe(distinctUntilChanged_1.distinctUntilChanged()).subscribe((function(fileStorageEnable){fileStorageEnable||_this58.stop()})),_context51.next=15;break;case 12:_context51.prev=12,_context51.t0=_context51.catch(2),this.logger.error("[FileStorageService] === STARTING === failure -- "+_context51.t0.message),this.startedSubject.next(!1);case 15:this.retrieveUserConsumption(),this.retrieveVoiceMessageFileDescriptorsListPerOwner().then((function(){_this58.logger.info("[FileStorageService] === STARTED (retrieveVoiceMessageFileDescriptorsListPerOwner)")})).catch((function(){_this58.logger.error("[FileStorageService] === STARTING === failure -- (retrieveVoiceMessageFileDescriptorsListPerOwner)")})),this.listeners.push(this.eventService.subscribe("ROOM_UPDATE_EVENT",(function(__event,room,action){action&&"remove"===action&&(_this58.logger.info("[FileStorageService] ROOM_UPDATE_EVENT REMOVED for roomId="+room.dbId),_this58.removeRoomFileViewer(room))}))),_context51.next=19;break;case 18:this.logger.info("start skipped - fileStorageEnabled : false");case 19:case"end":return _context51.stop()}}),_callee50,this,[[2,12]])})))}));case 1:case"end":return _context52.stop()}}),_callee51,this)})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee52(){return regenerator_default.a.wrap((function(_context53){for(;;)switch(_context53.prev=_context53.next){case 0:this.logger.info("[FileStorageService] === STOPPING ==="),this.started&&(this.started=!1),this.listeners&&this.listeners.forEach((function(unregisterListener){unregisterListener()})),this.logger.info("[FileStorageService] === STOPPED ==="),this.startedSubject.next(!1);case 1:case"end":return _context53.stop()}}),_callee52,this)})))}},{key:"reinit",value:function(isBlocking){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee53(){return regenerator_default.a.wrap((function(_context54){for(;;)switch(_context54.prev=_context54.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.fileStorageEnabled){_context54.next=4;break}this.logger.info("reinit skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled),_context54.next=10;break;case 4:if(!isBlocking){_context54.next=9;break}return _context54.next=7,this.reinitInternal();case 7:_context54.next=10;break;case 9:this.reinitInternal();case 10:case"end":return _context54.stop()}}),_callee53,this)})))}},{key:"reinitInternal",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee54(){return regenerator_default.a.wrap((function(_context55){for(;;)switch(_context55.prev=_context55.next){case 0:return _context55.prev=0,_context55.next=3,this.retrieveFileDescriptorsListPerOwner();case 3:return _context55.next=5,this.retrieveReceivedFiles(this.contactService.userContact.dbId);case 5:this.orderDocuments(),this.logger.info("[FileStorageService] reinitInternal done"),_context55.next=12;break;case 9:throw _context55.prev=9,_context55.t0=_context55.catch(0),this.logger.error("[FileStorageService] reinitInternal failure -- "+_context55.t0.message),_context55.t0;case 12:case"end":return _context55.stop()}}),_callee54,this,[[0,9]])})))}},{key:"removeRoomFileViewer",value:function(room){if(this.contactService&&this.contactService.userContact&&!this.contactService.userContact.fileStorageEnabled)this.logger.info("removeRoomFileViewer skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled);else{var fileDesc;this.logger.info("[FileStorageService] >removeRoomFileViewer: "+room.dbId);do{if(fileDesc=this.getFileDescriptorByViewerId(room.dbId)){var viewerFound=fileDesc.viewers.find((function(element){return element.viewerId===room.dbId}));viewerFound&&(this.logger.info("[FileStorageService] >viewer found delete it"),fileDesc.viewers.splice(fileDesc.viewers.indexOf(viewerFound),1))}}while(fileDesc)}}},{key:"getNewDocuments",value:function(set){switch(set){case"mine":return this.fileDescriptors;case"received":return this.receivedFileDescriptors;default:return this.mergedFileDescriptors}}},{key:"getDocuments",value:function(orderedBy,received){return this.currentOrder!==orderedBy&&(this.currentOrder=orderedBy,this.orderDocuments()),received?this.receivedFileDescriptors:this.fileDescriptors}},{key:"getFileDescriptorById",value:function(id){var _step,_iterator=_createForOfIteratorHelper(this.fileDescriptors);try{for(_iterator.s();!(_step=_iterator.n()).done;){var fileDescriptor=_step.value;if(fileDescriptor.id===id)return fileDescriptor}}catch(err){_iterator.e(err)}finally{_iterator.f()}var _step2,_iterator2=_createForOfIteratorHelper(this.receivedFileDescriptors);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _fileDescriptor2=_step2.value;if(_fileDescriptor2.id===id)return _fileDescriptor2}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return null}},{key:"getFileDescriptorByViewerId",value:function(id){var _step3,_iterator3=_createForOfIteratorHelper(this.fileDescriptors);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _step5,fileDescriptor=_step3.value,_iterator5=_createForOfIteratorHelper(fileDescriptor.viewers);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){if(_step5.value.viewerId===id)return fileDescriptor}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}var _step4,_iterator4=_createForOfIteratorHelper(this.receivedFileDescriptors);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _fileDescriptor3=_step4.value;if(_fileDescriptor3.id===id)return _fileDescriptor3}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}return null}},{key:"getReceivedFileDescriptorsFromConversation",value:function(conversation){var _this59=this;return conversation.contact?this.receivedFileDescriptors.filter((function(file){return conversation.contact.dbId===file.ownerId&&void 0!==file.viewers.find((function(viewer){return viewer.viewerId===_this59.contactService.userContact.dbId}))}))||[]:conversation.room&&this.receivedFileDescriptors.filter((function(file){return file.ownerId!==_this59.contactService.userContact.dbId&&void 0!==file.viewers.find((function(viewer){return viewer.viewerId===conversation.room.dbId}))}))||[]}},{key:"getReceivedFilesFromContact",value:function(dbId){return this.receivedFileDescriptors.filter((function(file){return file.ownerId===dbId}))}},{key:"getSentFilesToContact",value:function(dbId){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.fileStorageEnabled?(this.logger.info("getSentFilesToContact skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled),[]):this.fileDescriptors.filter((function(file){for(var i=0;i<file.viewers.length;i++)if(file.viewers[i].viewerId===dbId)return!0;return!1}))}},{key:"getReceivedFilesForRoom",value:function(dbId){var _this60=this;return this.receivedFileDescriptors.filter((function(file){for(var i=0;i<file.viewers.length;i++)if(file.viewers[i].viewerId===dbId&&file.ownerId!==_this60.contactService.userContact.dbId)return!0;return!1}))}},{key:"getConsumptionData",value:function(){return this.consumptionData}},{key:"getVoiceMessageFileDescriptorByMsgId",value:function(msgId){return this.voiceMessageFileDescriptors.find((function(file){return null!==file.tags&&file.tags.msgId===msgId}))}},{key:"createFileDescriptor",value:function(fileName,extension,size){var viewers=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],voiceMessageData=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee55(){var data,url,headers,body,response,fileDescriptorData,fileDescriptor,errorInfo;return regenerator_default.a.wrap((function(_context56){for(;;)switch(_context56.prev=_context56.next){case 0:return _context56.prev=0,data={fileName:fileName,extension:extension,size:size,viewers:viewers},voiceMessageData&&(data.voicemessage=!0,data.encoding=!0,data.duration=voiceMessageData.duration),url=this.portalURL,headers=this.authService.getPostHeader(),body=JSON.stringify(data),_context56.next=8,fetch(url,{method:"POST",headers:headers,body:body});case 8:if((response=_context56.sent).ok){_context56.next=11;break}throw response;case 11:return _context56.next=13,response.json();case 13:return fileDescriptorData=_context56.sent.data,fileDescriptor=this.createFileDescriptorFromData(fileDescriptorData),_context56.abrupt("return",(fileDescriptor&&this.fileDescriptors.push(fileDescriptor),this.logger.info("[FileStorageService] createFileDescriptor -- "+fileDescriptor.id+" -- success"),this.orderDocuments(),fileDescriptor));case 18:return _context56.prev=18,_context56.t0=_context56.catch(0),_context56.next=22,this.errorHelperService.getErrorInfo(_context56.t0,"createFileDescriptor");case 22:throw 403153===(errorInfo=_context56.sent).error.errorDetailsCode&&(this.contactService.userContact.fileSharingEnabled=!1,this.contactService.userContact.rxSubject.next()),this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 24:case"end":return _context56.stop()}}),_callee55,this,[[0,18]])})))}},{key:"createFileDescriptorFromData",value:function(data){if(data){var viewers=[];data.viewers&&(viewers=fileViewer_1.FileViewer.createFromData(data.viewers));var url=data.url;url||(url=config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+data.id);var virusScanState,state=data.isUploaded?"uploaded":"not_uploaded",voiceMessage=data.tags&&"voicemail"===data.tags.purpose;return virusScanState=null===data.isClean?"notScanned":!0===data.isClean?"isClean":"isInfected",fileDescriptor_1.FileDescriptor.create(data.id,url,data.ownerId,data.fileName,data.extension,data.typeMIME,data.size,data.registrationDate,data.uploadedDate,data.dateToSort,viewers,state,data.thumbnail,data.orientation,data.original_w,data.original_h,data.tags,virusScanState,voiceMessage)}return null}},{key:"deleteFileDescriptor",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee56(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context57){for(;;)switch(_context57.prev=_context57.next){case 0:return _context57.prev=0,url="".concat(this.portalURL,"/").concat(id),headers=this.authService.getRequestHeader(),_context57.next=5,fetch(url,{method:"DELETE",headers:headers});case 5:if((response=_context57.sent).ok){_context57.next=8;break}throw response;case 8:this.logger.info("[FileStorageService] deleteFileDescriptor -- SUCCESS"),this.deleteFileDescriptorFromCache(id),this.eventService.publish("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:id}),this.retrieveUserConsumption(),_context57.next=17;break;case 11:return _context57.prev=11,_context57.t0=_context57.catch(0),_context57.next=15,this.errorHelperService.getErrorInfo(_context57.t0,"deleteFileDescriptor");case 15:throw errorInfo=_context57.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 17:case"end":return _context57.stop()}}),_callee56,this,[[0,11]])})))}},{key:"deleteAllFileDescriptor",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee57(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context58){for(;;)switch(_context58.prev=_context58.next){case 0:return _context58.prev=0,url=this.portalURL+"/all",headers=this.authService.getRequestHeader(),_context58.next=5,fetch(url,{method:"DELETE",headers:headers});case 5:if((response=_context58.sent).ok){_context58.next=8;break}throw response;case 8:this.logger.info("[FileStorageService] deleteAllFileDescriptor -- success"),this.deleteAllFilesDescriptorsFromCache(),this.retrieveUserConsumption(),_context58.next=17;break;case 11:return _context58.prev=11,_context58.t0=_context58.catch(0),_context58.next=15,this.errorHelperService.getErrorInfo(_context58.t0,"deleteAllFileDescriptor");case 15:throw errorInfo=_context58.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 17:case"end":return _context58.stop()}}),_callee57,this,[[0,11]])})))}},{key:"getFileDescriptorsFromServer",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee58(){return regenerator_default.a.wrap((function(_context59){for(;;)switch(_context59.prev=_context59.next){case 0:return _context59.prev=0,_context59.next=3,Promise.all([this.retrieveFileDescriptorsListPerOwner(),this.retrieveReceivedFiles(this.contactService.userContact.dbId)]);case 3:this.orderDocuments(),_context59.next=8;break;case 6:_context59.prev=6,_context59.t0=_context59.catch(0);case 8:case"end":return _context59.stop()}}),_callee58,this,[[0,6]])})))}},{key:"retrieveFileDescriptorsListPerOwner",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee59(){var url,headers,response,fileDescriptorsResponse,fileDescriptorsData,limit,total,getAllFileDescriptorPromise,offset,requestCount,requestArray,index,_iterator6,_step6,fileDescriptorData,fileDescriptor,errorInfo;return regenerator_default.a.wrap((function(_context60){for(;;)switch(_context60.prev=_context60.next){case 0:return _context60.prev=0,this.fileDescriptors=[],url=this.portalURL+"?format=full&limit=1000",headers=this.authService.getRequestHeader(),_context60.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((response=_context60.sent).ok){_context60.next=9;break}throw response;case 9:return _context60.next=11,response.json();case 11:if(fileDescriptorsResponse=_context60.sent,fileDescriptorsData=fileDescriptorsResponse.data){_context60.next=15;break}return _context60.abrupt("return",this.fileDescriptors);case 15:if(limit=fileDescriptorsResponse.limit,total=fileDescriptorsResponse.total,getAllFileDescriptorPromise=null,total<=limit)getAllFileDescriptorPromise=Promise.resolve([]);else{for(offset=limit,requestCount=total/limit,requestArray=[],index=1;index<requestCount;index++)requestArray.push(this.retrieveFileDescriptorsListPerOwnerwithOffset(offset,limit)),offset+=limit;getAllFileDescriptorPromise=Promise.all(requestArray)}return _context60.next=20,getAllFileDescriptorPromise;case 20:_context60.sent.forEach((function(responseData){fileDescriptorsData=fileDescriptorsData.concat(responseData)})),_iterator6=_createForOfIteratorHelper(fileDescriptorsData);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;)fileDescriptorData=_step6.value,fileDescriptor=this.createFileDescriptorFromData(fileDescriptorData),this.fileDescriptors.push(fileDescriptor)}catch(err){_iterator6.e(err)}finally{_iterator6.f()}return _context60.abrupt("return",(this.logger.info("[FileStorageService] retrieveFileDescriptorsListPerOwner -- success"),this.fileDescriptors));case 26:return _context60.prev=26,_context60.t0=_context60.catch(0),_context60.next=30,this.errorHelperService.getErrorInfo(_context60.t0,"retrieveFileDescriptorsListPerOwner");case 30:throw errorInfo=_context60.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 32:case"end":return _context60.stop()}}),_callee59,this,[[0,26]])})))}},{key:"retrieveFileDescriptorsListPerOwnerwithOffset",value:function(offset,limit){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee60(){var url,headers,response;return regenerator_default.a.wrap((function(_context61){for(;;)switch(_context61.prev=_context61.next){case 0:return url="".concat(this.portalURL,"?format=full&limit=").concat(limit,"&offset=").concat(offset),headers=this.authService.getRequestHeader(),_context61.next=4,fetch(url,{method:"GET",headers:headers});case 4:if((response=_context61.sent).ok){_context61.next=7;break}throw response;case 7:return _context61.next=9,response.json();case 9:return _context61.abrupt("return",_context61.sent.data);case 10:case"end":return _context61.stop()}}),_callee60,this)})))}},{key:"retrieveVoiceMessageFileDescriptorsListPerOwner",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee61(){var url,headers,response,fileDescriptorsData,errorInfo,_this61=this;return regenerator_default.a.wrap((function(_context62){for(;;)switch(_context62.prev=_context62.next){case 0:return _context62.prev=0,url=this.portalURL+"?format=full&path=/voice-messages",headers=this.authService.getRequestHeader(),_context62.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context62.sent).ok){_context62.next=8;break}throw response;case 8:return _context62.next=10,response.json();case 10:return fileDescriptorsData=_context62.sent.data,_context62.abrupt("return",fileDescriptorsData?(this.voiceMessageFileDescriptors=fileDescriptorsData.reduce((function(fileDescriptors,fileDescriptorData){var fileDescriptor=_this61.createFileDescriptorFromData(fileDescriptorData);return"not_uploaded"===fileDescriptor.state?(_this61.logger.info("[FileStorageService] file ".concat(fileDescriptor.fileName," not uploaded")),fileDescriptor.ownerId===_this61.contactService.userContact.dbId?(_this61.logger.info("[FileStorageService] file ".concat(fileDescriptor.fileName," is our property, we can delete it")),_this61.deleteFileDescriptor(fileDescriptor.id)):_this61.logger.info("[FileStorageService] file ".concat(fileDescriptor.fileName," is NOT our property, we CANNOT delete it"))):fileDescriptors.push(fileDescriptor),fileDescriptors}),[]),this.logger.info("[FileStorageService] retrieveVoiceMessageFileDescriptorsListPerOwner -- success"),this.voiceMessageFileDescriptors):[]);case 14:return _context62.prev=14,_context62.t0=_context62.catch(0),_context62.next=18,this.errorHelperService.getErrorInfo(_context62.t0,"retrieveVoiceMessageFileDescriptorsListPerOwner");case 18:throw errorInfo=_context62.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 20:case"end":return _context62.stop()}}),_callee61,this,[[0,14]])})))}},{key:"retrieveFilesReceivedFromPeer",value:function(userId,peerId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee62(){var url,headers,response,receivedFileDescriptors,errorInfo,_this62=this;return regenerator_default.a.wrap((function(_context63){for(;;)switch(_context63.prev=_context63.next){case 0:return _context63.prev=0,url="".concat(this.portalURL,"/viewers/").concat(userId,"?ownerId=").concat(peerId,"&format=full"),headers=this.authService.getRequestHeader(),_context63.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context63.sent).ok){_context63.next=8;break}throw response;case 8:return _context63.next=10,response.json();case 10:return receivedFileDescriptors=_context63.sent.data.map((function(fileDescriptorData){return _this62.createFileDescriptorFromData(fileDescriptorData)})),_context63.abrupt("return",(this.logger.info("[FileStorageService] retrieveFilesReceivedFromPeer success"),receivedFileDescriptors));case 14:return _context63.prev=14,_context63.t0=_context63.catch(0),_context63.next=18,this.errorHelperService.getErrorInfo(_context63.t0,"retrieveFilesReceivedFromPeer");case 18:throw errorInfo=_context63.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 20:case"end":return _context63.stop()}}),_callee62,this,[[0,14]])})))}},{key:"retrieveSentFiles",value:function(peerId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee63(){var url,headers,response,errorInfo,_this63=this;return regenerator_default.a.wrap((function(_context64){for(;;)switch(_context64.prev=_context64.next){case 0:return _context64.prev=0,this.logger.info("[FileStorageService] >retrieveSentFiles"),url="".concat(this.portalURL,"?format=full&viewerId=").concat(peerId),headers=this.authService.getRequestHeader(),_context64.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((response=_context64.sent).ok){_context64.next=9;break}throw response;case 9:return _context64.next=11,response.json();case 11:return _context64.abrupt("return",_context64.sent.data.reduce((function(fileDescriptors,fileDescriptorData){var fileDescriptor=_this63.createFileDescriptorFromData(fileDescriptorData);return fileDescriptor.state===fileDescriptor_1.FileState.NOT_UPLOADED?_this63.logger.warn("[FileStorageService] file ".concat(fileDescriptor.fileName," not uploaded")):fileDescriptors.push(fileDescriptor),fileDescriptors}),[]));case 14:return _context64.prev=14,_context64.t0=_context64.catch(0),_context64.next=18,this.errorHelperService.getErrorInfo(_context64.t0,"retrieveSentFiles");case 18:throw errorInfo=_context64.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 20:case"end":return _context64.stop()}}),_callee63,this,[[0,14]])})))}},{key:"retrieveReceivedFilesForRoom",value:function(roomId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee64(){var url,headers,response,fileDescriptorsData,errorInfo,_this64=this;return regenerator_default.a.wrap((function(_context65){for(;;)switch(_context65.prev=_context65.next){case 0:return _context65.prev=0,url="".concat(this.portalURL,"/viewers/").concat(roomId,"?format=full"),headers=this.authService.getRequestHeader(),_context65.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context65.sent).ok){_context65.next=8;break}throw response;case 8:return _context65.next=10,response.json();case 10:return fileDescriptorsData=_context65.sent.data,_context65.abrupt("return",fileDescriptorsData?fileDescriptorsData.reduce((function(fileDescriptors,fileDescriptorData){if(fileDescriptorData.ownerId!==_this64.contactService.userContact.dbId){fileDescriptorData.viewers=[];var newFileDesc=_this64.createFileDescriptorFromData(fileDescriptorData);if(!newFileDesc.viewers.length){var viewerAdded=fileViewer_1.FileViewer.createFromData([{viewerId:roomId,type:"room"}])[0];newFileDesc.viewers.push(viewerAdded)}fileDescriptors.push(newFileDesc),_this64.receivedFileDescriptors.find((function(fd){return fd.id===fileDescriptorData.id}))||_this64.receivedFileDescriptors.push(newFileDesc)}return fileDescriptors}),[]):[]);case 14:return _context65.prev=14,_context65.t0=_context65.catch(0),_context65.next=18,this.errorHelperService.getErrorInfo(_context65.t0,"retrieveReceivedFilesForRoom");case 18:throw errorInfo=_context65.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 20:case"end":return _context65.stop()}}),_callee64,this,[[0,14]])})))}},{key:"retrieveReceivedFiles",value:function(viewerId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee65(){var url,headers,response,fileDescriptorsResponse,fileDescriptorsData,limit,total,getReceivedFileDescriptorPromise,offset,requestCount,requestArray,index,errorInfo,_this65=this;return regenerator_default.a.wrap((function(_context66){for(;;)switch(_context66.prev=_context66.next){case 0:return _context66.prev=0,this.receivedFileDescriptors=[],url="".concat(this.portalURL,"/viewers/").concat(viewerId,"?format=full&limit=1000"),headers=this.authService.getRequestHeader(),_context66.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((response=_context66.sent).ok){_context66.next=9;break}throw response;case 9:return _context66.next=11,response.json();case 11:if(fileDescriptorsResponse=_context66.sent,fileDescriptorsData=fileDescriptorsResponse.data){_context66.next=15;break}return _context66.abrupt("return",this.receivedFileDescriptors);case 15:if(limit=fileDescriptorsResponse.limit,total=fileDescriptorsResponse.total,getReceivedFileDescriptorPromise=null,total<=limit)getReceivedFileDescriptorPromise=Promise.resolve([]);else{for(offset=limit,requestCount=total/limit,requestArray=[],index=1;index<requestCount;index++)requestArray.push(this.retrieveReceivedFilesWithOffset(viewerId,offset,limit)),offset+=limit;getReceivedFileDescriptorPromise=Promise.all(requestArray)}return _context66.next=20,getReceivedFileDescriptorPromise;case 20:return _context66.sent.forEach((function(responseData){fileDescriptorsData=fileDescriptorsData.concat(responseData)})),this.receivedFileDescriptors=fileDescriptorsData.reduce((function(fileDescriptors,fileDescriptorData){var fileDescriptor=_this65.createFileDescriptorFromData(fileDescriptorData);if(fileDescriptor.ownerId!==_this65.contactService.userContact.dbId){var oldFileDesc=_this65.getFileDescriptorById(fileDescriptor.id);oldFileDesc&&(fileDescriptor.previewBlob=oldFileDesc.previewBlob,fileDescriptor.previewBlobSubject.next(URL.createObjectURL(fileDescriptor.previewBlob))),fileDescriptors.push(fileDescriptor)}return fileDescriptors}),[]),this.logger.info("[FileStorageService] retrieveReceivedFiles -- success"),_context66.abrupt("return",this.receivedFileDescriptors);case 26:return _context66.prev=26,_context66.t0=_context66.catch(0),_context66.next=30,this.errorHelperService.getErrorInfo(_context66.t0,"retrieveReceivedFiles");case 30:throw errorInfo=_context66.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 32:case"end":return _context66.stop()}}),_callee65,this,[[0,26]])})))}},{key:"retrieveReceivedFilesWithOffset",value:function(viewerId,offset,limit){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee66(){var url,headers,response;return regenerator_default.a.wrap((function(_context67){for(;;)switch(_context67.prev=_context67.next){case 0:return url="".concat(this.portalURL,"/viewers/").concat(viewerId,"?format=full&limit=1000&limit=").concat(limit,"&offset=").concat(offset),headers=this.authService.getRequestHeader(),_context67.next=4,fetch(url,{method:"GET",headers:headers});case 4:return response=_context67.sent,_context67.next=7,response.json();case 7:return _context67.abrupt("return",_context67.sent.data);case 8:case"end":return _context67.stop()}}),_callee66,this)})))}},{key:"retrieveUserConsumption",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee67(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context68){for(;;)switch(_context68.prev=_context68.next){case 0:return _context68.prev=0,url=config.restServerUrl+"/api/rainbow/filestorage/v1.0/users/consumption",headers=this.authService.getRequestHeader(),_context68.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context68.sent).ok){_context68.next=8;break}throw response;case 8:return _context68.next=10,response.json();case 10:return this.consumptionData=_context68.sent.data,this.logger.info("[FileStorageService] retrieveUserConsumption success"),this.eventService.publish("ON_CONSUMPTION_DATA_UPDATED_EVENT"),_context68.abrupt("return",this.consumptionData);case 16:return _context68.prev=16,_context68.t0=_context68.catch(0),_context68.next=20,this.errorHelperService.getErrorInfo(_context68.t0,"retrieveUserConsumption");case 20:throw errorInfo=_context68.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 22:case"end":return _context68.stop()}}),_callee67,this,[[0,16]])})))}},{key:"deleteFileViewer",value:function(viewerId,fileId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee68(){var url,headers,response,fileDescriptor,index,errorInfo;return regenerator_default.a.wrap((function(_context69){for(;;)switch(_context69.prev=_context69.next){case 0:return _context69.prev=0,url="".concat(this.portalURL,"/").concat(fileId,"/viewers/").concat(viewerId),headers=this.authService.getRequestHeader(),_context69.next=5,fetch(url,{method:"DELETE",headers:headers});case 5:if((response=_context69.sent).ok){_context69.next=8;break}throw response;case 8:this.logger.info("[FileStorageService] deleteFileViewer "+response.statusText),(fileDescriptor=this.getFileDescriptorById(fileId))&&-1!==(index=fileDescriptor.viewers.findIndex((function(viewer){return viewer.viewerId===viewerId})))&&fileDescriptor.viewers.splice(index,1),_context69.next=19;break;case 13:return _context69.prev=13,_context69.t0=_context69.catch(0),_context69.next=17,this.errorHelperService.getErrorInfo(_context69.t0,"deleteFileViewer");case 17:throw errorInfo=_context69.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 19:case"end":return _context69.stop()}}),_callee68,this,[[0,13]])})))}},{key:"addFileViewer",value:function(fileId,viewerId,type){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee69(){var fileDescriptor,url,headers,body,response,viewerAdded,errorInfo;return regenerator_default.a.wrap((function(_context70){for(;;)switch(_context70.prev=_context70.next){case 0:if(!(fileDescriptor=this.getFileDescriptorById(fileId))){_context70.next=24;break}if(!fileDescriptor.isAlreadyFileViewer(viewerId)){_context70.next=4;break}return _context70.abrupt("return",fileDescriptor);case 4:return _context70.prev=4,url="".concat(this.portalURL,"/").concat(fileId,"/viewers"),headers=this.authService.getPostHeader(),body=JSON.stringify({viewerId:viewerId,type:type}),_context70.next=10,fetch(url,{method:"POST",headers:headers,body:body});case 10:if((response=_context70.sent).ok){_context70.next=13;break}throw response;case 13:return this.logger.info("[FileStorageService] addFileViewer success"),viewerAdded=fileViewer_1.FileViewer.createFromData([{viewerId:viewerId,type:type}])[0],_context70.abrupt("return",(fileDescriptor.viewers.push(viewerAdded),fileDescriptor));case 18:return _context70.prev=18,_context70.t0=_context70.catch(4),_context70.next=22,this.errorHelperService.getErrorInfo(_context70.t0,"addFileViewer");case 22:throw errorInfo=_context70.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 24:return _context70.abrupt("return",null);case 25:case"end":return _context70.stop()}}),_callee69,this,[[4,18]])})))}},{key:"copyFileToUserCloudStorage",value:function(fileId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee70(){var url,headers,response,responseData,errorInfo;return regenerator_default.a.wrap((function(_context71){for(;;)switch(_context71.prev=_context71.next){case 0:return _context71.prev=0,url="".concat(this.portalURL,"/").concat(fileId,"/copy"),headers=this.authService.getPostHeader(),_context71.next=5,fetch(url,{method:"POST",headers:headers});case 5:if((response=_context71.sent).ok){_context71.next=8;break}throw response;case 8:return _context71.next=10,response.json();case 10:return responseData=_context71.sent.data,this.logger.info("[FileStorageService] copyFileToUserCloudStorage | copyFile ".concat(fileId," -- success")),_context71.next=14,this.retrieveAndStoreOneFileDescriptor(responseData.id,!0);case 14:return _context71.abrupt("return",_context71.sent);case 17:return _context71.prev=17,_context71.t0=_context71.catch(0),_context71.next=21,this.errorHelperService.getErrorInfo(_context71.t0,"copyFileToUserCloudStorage");case 21:throw errorInfo=_context71.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 23:case"end":return _context71.stop()}}),_callee70,this,[[0,17]])})))}},{key:"retrieveOneFileDescriptor",value:function(fileId){var _this66=this;return this.retrieveFileDescriptorPromises[fileId]?(this.logger.info("[FileStorageService] retrieveOneFileDescriptor for ".concat(fileId," already lauched")),this.retrieveFileDescriptorPromises[fileId]):(this.retrieveFileDescriptorPromises[fileId]=__awaiter(_this66,void 0,void 0,regenerator_default.a.mark((function _callee71(){var url,headers,response,responseData,fileDescriptor,errorInfo;return regenerator_default.a.wrap((function(_context72){for(;;)switch(_context72.prev=_context72.next){case 0:return _context72.prev=0,this.logger.info("[FileStorageService] retrieveOneFileDescriptor "+fileId),url="".concat(this.portalURL,"/").concat(fileId,"?format=full"),headers=this.authService.getRequestHeader(),_context72.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((response=_context72.sent).ok){_context72.next=9;break}throw response;case 9:return _context72.next=11,response.json();case 11:return responseData=_context72.sent.data,fileDescriptor=this.createFileDescriptorFromData(responseData),_context72.abrupt("return",(this.logger.info("[FileStorageService] retrieveOneFileDescriptor ".concat(fileId," -- success")),delete this.retrieveFileDescriptorPromises[fileId],fileDescriptor));case 16:return _context72.prev=16,_context72.t0=_context72.catch(0),_context72.next=20,this.errorHelperService.getErrorInfo(_context72.t0,"retrieveOneFileDescriptor");case 20:throw errorInfo=_context72.sent,this.logger.error("[fileStorageService] "+errorInfo.message),errorInfo.error;case 22:case"end":return _context72.stop()}}),_callee71,this,[[0,16]])}))),this.retrieveFileDescriptorPromises[fileId])}},{key:"retrieveAndStoreOneFileDescriptor",value:function(fileId){var _this67=this,forceRetrieve=arguments.length>1&&void 0!==arguments[1]&&arguments[1],fileDescriptor=this.getFileDescriptorById(fileId);return fileDescriptor&&!forceRetrieve?(this.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- return existing fileDescriptor "+fileId),Promise.resolve(fileDescriptor)):this.retrieveOneFileDescriptor(fileId).then((function(retrievedFileDescriptor){fileDescriptor&&fileDescriptor.isImage()&&(retrievedFileDescriptor.previewBlob=fileDescriptor.previewBlob,retrievedFileDescriptor.previewBlobSubject.next(retrievedFileDescriptor.previewBlob));var currentFileDescriptor=_this67.fileDescriptors.find((function(_fileDescriptor){return _fileDescriptor.id===retrievedFileDescriptor.id}));currentFileDescriptor&&currentFileDescriptor.update(retrievedFileDescriptor);var currentReceivedFileDescriptor=_this67.receivedFileDescriptors.find((function(_fileDescriptor){return _fileDescriptor.id===retrievedFileDescriptor.id}));return currentReceivedFileDescriptor&&currentReceivedFileDescriptor.update(retrievedFileDescriptor),currentFileDescriptor||currentReceivedFileDescriptor||(retrievedFileDescriptor.ownerId===_this67.contactService.userContact.dbId?(_this67.fileDescriptors.push(retrievedFileDescriptor),_this67.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- fileDescriptor "+retrievedFileDescriptor.id+" -- now stored in my files")):(_this67.receivedFileDescriptors.push(retrievedFileDescriptor),_this67.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- fileDescriptor "+retrievedFileDescriptor.id+" -- now stored in received files")),_this67.fileDescriptorsSubject.next({action:"new",fd:retrievedFileDescriptor})),_this67.orderDocuments(),_this67.eventService.publish("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:retrievedFileDescriptor.id}),Promise.resolve(retrievedFileDescriptor)})).catch((function(error){return _this67.logger.warn("[FileStorageService] Error on getting FileDescriptor: "+error.errorDetailsCode),error.status>=400&&error.status<500&&fileDescriptor&&(404===error.status&&_this67.deleteFileDescriptorFromCache(fileDescriptor.id),_this67.orderDocuments(),_this67.logger.debug("[FileStorageService] Sending ON_FILE_REMOVED_FROM_STORE_EVENT"),_this67.eventService.publish("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:fileDescriptor.id})),Promise.reject(error)}))}},{key:"deleteFileDescriptorFromCache",value:function(id){this.logger.info("[FileStorageService] deleteFileDescriptorFromCache "+id);for(var index=0;index<this.receivedFileDescriptors.length;index++){var fileDescriptor=this.receivedFileDescriptors[index];if(fileDescriptor.id===id){this.receivedFileDescriptors.splice(index,1),fileDescriptor.setState(fileDescriptor_1.FileState.DELETED);break}}for(var _index=0;_index<this.fileDescriptors.length;_index++){var _fileDescriptor4=this.fileDescriptors[_index];if(_fileDescriptor4.id===id){this.fileDescriptors.splice(_index,1),_fileDescriptor4.setState(fileDescriptor_1.FileState.DELETED);break}}this.orderDocuments()}},{key:"deleteAllFilesDescriptorsFromCache",value:function(){var _this68=this;this.logger.info("[FileStorageService] deleteAllFilesDesceiptorsFromCache"),this.fileDescriptors.forEach((function(fileDescriptor){fileDescriptor.setState(fileDescriptor_1.FileState.DELETED),_this68.receivedFileDescriptors.forEach((function(receivedFileDescriptor,index){receivedFileDescriptor.id===fileDescriptor.id&&_this68.receivedFileDescriptors.splice(index,1)}))})),this.fileDescriptors=[],this.orderDocuments(),this.fileDescriptorsSubject.next({action:"listUpdate"})}},{key:"orderDocuments",value:function(){var set=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";this.logger.debug("[FileStorageService] orderDocuments");var documentsSet=null;switch(set){case"mine":documentsSet=this.fileDescriptors;break;case"received":documentsSet=this.receivedFileDescriptors;break;default:this.mergedFileDescriptors=this.fileDescriptors.concat(this.receivedFileDescriptors),documentsSet=this.mergedFileDescriptors}switch(this.currentOrder){default:documentsSet.sort((function(fda,fdb){return fdb.time-fda.time}));break;case"name":documentsSet.sort((function(fda,fdb){return fda.fileName.localeCompare(fdb.fileName)}));break;case"size":documentsSet.sort((function(fda,fdb){return fda.size-fdb.size}))}}},{key:"extractFileIdFromUrl",value:function(url){var parts=url.split("/");return parts.pop()||parts.pop()}},{key:"retrieveAndStoreOneVoiceMessageFileDescriptor",value:function(fileId){var _this69=this;this.retrieveOneFileDescriptor(fileId).then((function(retrievedFileDescriptor){if(retrievedFileDescriptor.tags&&"/voice-messages"===retrievedFileDescriptor.tags.path)if(void 0!==_this69.voiceMessageFileDescriptors.find((function(file){return file.id===fileId}))){var fileDescriptorIndex=_this69.voiceMessageFileDescriptors.findIndex((function(oneFileDescriptor){return oneFileDescriptor.id===retrievedFileDescriptor.id}));fileDescriptorIndex>-1&&_this69.voiceMessageFileDescriptors.splice(fileDescriptorIndex,1,retrievedFileDescriptor),_this69.logger.info("[FileStorageService] getRetrieveAndStoreOneVoiceMessageFileDescriptor "+fileId+" -- success")}else _this69.voiceMessageFileDescriptors.push(retrievedFileDescriptor)}))}},{key:"deleteVoiceMessageFileDescriptor",value:function(fileId){this.logger.info("[FileStorageService] deleteVoiceMessageFileDescriptore "+fileId);var fileDescriptorExist=this.voiceMessageFileDescriptors.find((function(file){return file.id===fileId}));if(void 0!==fileDescriptorExist){var fileDescriptorIndex=this.voiceMessageFileDescriptors.findIndex((function(oneFileDescriptor){return oneFileDescriptor.id===fileDescriptorExist.id}));fileDescriptorIndex>-1&&this.voiceMessageFileDescriptors.splice(fileDescriptorIndex,1)}}},{key:"getPublicFileDownloads",value:function(){return this.publicFileDownload}},{key:"clearPublicFileDownloads",value:function(){this.publicFileDownload=[]}},{key:"findPublicFileDownload",value:function(fileUrl){return this.publicFileDownload.find((function(element){return element.url===fileUrl}))}},{key:"updatePublicFileDownloadArray",value:function(filesPublicDownload,fileSystem){var _this70=this;this.logger.info("[FileStorageService] >updatePublicFileDownloadArray"),filesPublicDownload.forEach((function(element){var fileDownload=_this70.findPublicFileDownload(element.url);if(fileDownload)_this70.logger.info("[FileStorageService] file ("+element.url+") Found - to update"),fileDownload.receivedBytes=element.receivedBytes,fileDownload.savePath=element.savePath,fileDownload.isDownloadFinished()&&fileDownload.openFolderOnceDownloadFinished&&(_this70.logger.debug("[FileStorageService] showItemInFolder auto on download completion"),fileSystem.showItemInFolder(fileDownload.savePath)),_this70.logger.debug("[FileStorageService] fileName="+fileDownload.fileName),_this70.logger.debug("[FileStorageService] file receivedBytes="+fileDownload.receivedBytes),_this70.logger.debug("[FileStorageService] file totalBytes="+fileDownload.totalBytes),_this70.logger.debug("[FileStorageService] file savePath="+fileDownload.savePath),fileDownload.progressSubject.next();else{_this70.logger.info("[FileStorageService] file Not Found");var newFile=filePublicDownload_1.FilePublicDownload.create(element.url,element.fileName,element.totalBytes,element.receivedBytes,element.savePath);_this70.publicFileDownload.unshift(newFile)}_this70.publicFileDownloadSubject.next()}))}},{key:"removePublicFileDownload",value:function(file){if(file&&file.url){var index=this.publicFileDownload.indexOf(file);index>=0&&(this.publicFileDownload.splice(index,1),this.publicFileDownloadSubject.next())}}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.fileStorageService||(win.rainbow.fileStorageService=new FileStorageService),win.rainbow.fileStorageService}}]),FileStorageService}();exports.FileStorageService=FileStorageService,exports.default=FileStorageService.getInstance()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),logger_service_1=__webpack_require__(15),MainService=function(){function MainService(){var _this71=this;_classCallCheck(this,MainService),this.appActive=!0,this.appActiveSubject=null,this.detectionInterval=180,this.detectionTimeout=null,this.onActivityListener=null,this.appConnectivitySubject=null,this.connectivityTimeout=null,this.connectivityUp=!1,this.cdn="",this.cdnImages="",this.cdnServer="";var win=window;win.moduleIds||(win.moduleIds=[]),win.config||(win.config={xmpp:{protocol:"wss",currentServer:null,port:"443",pingInterval:"60000"},webservices:{protocol:"https",currentServer:null,port:"443"}}),this.updateCDN(),this.appActiveSubject=new rxjs_1.Subject,this.onActivityListener=function(){_this71.appActive||_this71.onStateChanged("active"),_this71.detectionTimeout&&(clearTimeout(_this71.detectionTimeout),_this71.detectionTimeout=null),window.document.removeEventListener("mousemove",_this71.onActivityListener),window.document.removeEventListener("keypress",_this71.onActivityListener),setTimeout((function(){_this71.startTimer()}),2e3)},this.appConnectivitySubject=new rxjs_1.Subject,this.connectivityUp=navigator.onLine,window.addEventListener("offline",(function(){logger_service_1.default.debug("[MainService] Connectivity change : down"),_this71.connectivityTimeout&&(clearInterval(_this71.connectivityTimeout),_this71.connectivityTimeout=null),_this71.connectivityUp&&(_this71.connectivityUp=!1,_this71.connectivityTimeout=setTimeout((function(){_this71.appConnectivitySubject.next(!1)}),2500))})),window.addEventListener("online",(function(){logger_service_1.default.debug("[MainService] Connectivity change : up"),_this71.connectivityTimeout&&(clearInterval(_this71.connectivityTimeout),_this71.connectivityTimeout=null),_this71.connectivityUp||(_this71.connectivityUp=!0,_this71.connectivityTimeout=setTimeout((function(){_this71.appConnectivitySubject.next(!0)}),1e3))}))}return _createClass(MainService,[{key:"configure",value:function(){var _this72=this,centralizedService=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;logger_service_1.default.info("[MainService] STARTED"),centralizedService&&centralizedService.isDesktopApp()?(centralizedService.idle.setDetectionInterval(this.detectionInterval),centralizedService.idle.onStateChanged.addListener((function(state){_this72.onStateChanged(state)}))):this.startTimer()}},{key:"subscribe",value:function(appActiveHandler){return this.appActiveSubject.subscribe(appActiveHandler)}},{key:"subscribeToConnectivityEvents",value:function(appActiveHandler){return this.appConnectivitySubject.subscribe(appActiveHandler)}},{key:"updateCDN",value:function(){}},{key:"onStateChanged",value:function(state){this.appActive="active"===state,this.appActiveSubject.next(this.appActive)}},{key:"startTimer",value:function(){var _this73=this;this.detectionTimeout&&(clearTimeout(this.detectionTimeout),this.detectionTimeout=null),this.detectionTimeout=setTimeout((function(){_this73.onStateChanged("idle")}),1e3*this.detectionInterval),window.document.addEventListener("mousemove",this.onActivityListener),window.document.addEventListener("keypress",this.onActivityListener)}},{key:"isDesktopApp",value:function(){var ua=navigator.userAgent.toLowerCase();return ua.indexOf("qtwebengine")>-1||ua.indexOf("electron/")>-1}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.mainService||(win.rainbow.mainService=new MainService),win.rainbow.mainService}}]),MainService}();exports.MainService=MainService,exports.default=MainService.getInstance()},function(module,exports,__webpack_require__){var v1=__webpack_require__(310),v4=__webpack_require__(311),uuid=v4;uuid.v1=v1,uuid.v4=v4,module.exports=uuid},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.SDK={OK:1,ERROR:-1,ERRORUNAUTHORIZED:-2,ERRORXMPP:-4,ERRORXMPPJID:-8,ERRORBADREQUEST:-16,ERRORUNSUPPORTED:-32,ERRORNOTFOUND:-64}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return observable}));var observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return ObjectUnsubscribedError}));var ObjectUnsubscribedError=function(){function ObjectUnsubscribedErrorImpl(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return ObjectUnsubscribedErrorImpl.prototype=Object.create(Error.prototype),ObjectUnsubscribedErrorImpl}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var crypto_js_1=__webpack_require__(18),crypto_js_2=__webpack_require__(18),settings_service_1=__webpack_require__(5),main_service_1=__webpack_require__(26),logger_service_1=__webpack_require__(15),UserInfoService=function(){function UserInfoService(){_classCallCheck(this,UserInfoService),this.userColors=["#ca8741","#e44647","#c62582","#9b4ce7","#6573ee","#1b70e0","#6ec7d9","#98d1b1","#7fbd40","#b2d334","#dcd232","#f1be00"],this.userColorNames=["purple-lavender","purple-violet","red-coral","blue-jeanlouisdavid","green-mint","green-yellow","orange-jade","pink-lady","yellow-submarine","blue-teal"]}return _createClass(UserInfoService,[{key:"getAvatarImage",value:function(objId,initials,color,size,lastAvatarUpdate){if(!(lastAvatarUpdate=void 0!==lastAvatarUpdate&&lastAvatarUpdate))return initials?this.createDefaultAvatarImage(initials,color):null;var serverURL=config.webservices.protocol+"://"+config.webservices.currentServer;main_service_1.default.cdn&&(serverURL=main_service_1.default.cdnServer);var src=serverURL+"/api/avatar/"+objId+"?size="+(size||256);return lastAvatarUpdate&&(src+="&update="+crypto_js_1.MD5(crypto_js_2.enc.Latin1.parse(lastAvatarUpdate)).toString(crypto_js_2.enc.Hex)),{src:src}}},{key:"getNameInformation",value:function(firstName,lastName){var result={displayName:"",initials:""};return 1!==lastName.length&&2!==firstName.length?"FL"===settings_service_1.default.getSetting("displayOrder")?(result.displayName=firstName+" "+lastName,result.initials=firstName.charAt(0).toUpperCase()+lastName.charAt(0).toUpperCase()):(result.displayName=lastName+" "+firstName,result.initials=lastName.charAt(0).toUpperCase()+firstName.charAt(0).toUpperCase()):("FL"===settings_service_1.default.getSetting("displayOrder")?result.displayName=firstName+" "+lastName:result.displayName=lastName+" "+firstName,result.initials=firstName.charAt(0).toUpperCase()+firstName.charAt(1).toUpperCase()),result}},{key:"createDefaultAvatarImage",value:function(initials,color){var image=new Image,canvas=document.createElement("canvas");canvas.width=image.width=225,canvas.height=image.height=225;var ctx=canvas.getContext("2d");return ctx.rect(0,0,225,225),ctx.fillStyle=color,ctx.fill(),ctx.font="bold 100px Helvetica",ctx.textAlign="center",ctx.fillStyle="white",ctx.fillText(initials,110,150),image.src=canvas.toDataURL("image/png"),image}},{key:"computeUserColor",value:function(displayName){var result={colorIndex:0,color:this.userColors[0],colorName:this.userColorNames[0]};try{for(var upperCaseDisplayName=displayName.toUpperCase(),sum=0,i=0;i<upperCaseDisplayName.length;i++)sum+=upperCaseDisplayName.charCodeAt(i);result.colorIndex=sum%12,result.color=this.userColors[result.colorIndex],result.colorName=this.userColorNames[result.colorIndex]}catch(error){logger_service_1.default.error("[UserInfoService] computeUserColor failure"),result.colorIndex=1,result.color=this.userColors[result.colorIndex],result.colorName=this.userColorNames[result.colorIndex]}return result}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.userInfoService||(win.rainbow.userInfoService=new UserInfoService),win.rainbow.userInfoService}}]),UserInfoService}();exports.UserInfoService=UserInfoService,exports.default=UserInfoService.getInstance()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var EventService=function(){function EventService(){_classCallCheck(this,EventService),this.$rootScope=null}return _createClass(EventService,[{key:"configure",value:function(){var $rootScope=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.$rootScope=$rootScope}},{key:"subscribe",value:function(eventName,handler){return this.$rootScope?this.$rootScope.$on(eventName,handler):function(){}}},{key:"unsubscribe",value:function(subscription){subscription()}},{key:"publish",value:function(eventName){for(var _this$$rootScope,_len=arguments.length,args=new Array(_len>1?_len-1:0),_key3=1;_key3<_len;_key3++)args[_key3-1]=arguments[_key3];this.$rootScope&&(_this$$rootScope=this.$rootScope).$broadcast.apply(_this$$rootScope,[eventName].concat(args))}},{key:"publishWithApply",value:function(eventName){for(var _this74=this,_len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key4=1;_key4<_len2;_key4++)args[_key4-1]=arguments[_key4];this.$rootScope&&this.$rootScope.$apply((function(){var _this74$$rootScope;(_this74$$rootScope=_this74.$rootScope).$broadcast.apply(_this74$$rootScope,[eventName].concat(args))}))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.eventService||(win.rainbow.eventService=new EventService),win.rainbow.eventService}}]),EventService}();exports.EventService=EventService,exports.default=EventService.getInstance()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var crypto_js_1=__webpack_require__(18),crypto_js_2=__webpack_require__(18),room_model_1=__webpack_require__(226),rxjs_1=__webpack_require__(10),strophe_js_1=__webpack_require__(76),event_model_1=__webpack_require__(24),imageUtils_service_1=__webpack_require__(74),rxjs_2=__webpack_require__(10),settings_service_1=__webpack_require__(5),auth_service_1=__webpack_require__(2),main_service_1=__webpack_require__(26),xmpp_service_1=__webpack_require__(4),profile_service_1=__webpack_require__(6),contact_service_1=__webpack_require__(1),fileStorage_service_1=__webpack_require__(25),logger_service_1=__webpack_require__(15),i18n_service_1=__webpack_require__(38),randomString_1=__webpack_require__(219),event_service_1=__webpack_require__(32),errorHelper_service_1=__webpack_require__(37),AbstractRoomService=function AbstractRoomService(){_classCallCheck(this,AbstractRoomService)};exports.AbstractRoomService=AbstractRoomService;var RoomService=function(_AbstractRoomService){_inherits(RoomService,_AbstractRoomService);var _super2=_createSuper(RoomService);function RoomService(){var _this75;return _classCallCheck(this,RoomService),(_this75=_super2.call(this)).ROOM_UPDATE_EVENT="ROOM_UPDATE_EVENT",_this75.ROOM_USER_UPDATE_EVENT="ROOM_USER_UPDATE_EVENT",_this75.ROOM_AVATAR_UPDATE_EVENT="ROOM_AVATAR_UPDATE_EVENT",_this75.ROOM_HISTORY_UPDATE_EVENT="ROOM_HISTORY_UPDATE_EVENT",_this75.ROOM_ADMIN_MESSAGE_EVENT="ROOM_ADMIN_MESSAGE_EVENT",_this75.ROOM_INVITATION="ROOM_INVITATION",_this75.ROOM_ADD_CONF_ENDPOINT_EVENT="ROOM_ADD_CONF_ENDPOINT_EVENT",_this75.ROOM_REMOVE_CONF_ENDPOINT_EVENT="ROOM_REMOVE_CONF_ENDPOINT_EVENT",_this75.ROOM_ADD_USERS_EVENT="ROOM_ADD_USERS_EVENT",_this75.ROOM_DELETE_USERS_EVENT="ROOM_DELETE_USERS_EVENT",_this75.RoomUserStatus={INVITED:"invited",ACCEPTED:"accepted",UNSUBSCRIBED:"unsubscribed",REJECTED:"rejected",DELETED:"deleted"},_this75.openInviteIdByRoomIdSubject=new rxjs_1.Subject,_this75.rxSubject=new rxjs_1.Subject,_this75.portalURL=null,_this75.listeners=[],_this75.xmppConnectionSubscription=null,_this75.roomPresenceWaitingList=[],_this75.userContact=null,_this75.invitationCounter=0,_this75.meetingInvitationCounter=0,_this75._rooms={},_this75.roomsByJids={},_this75.roomsInProgress={},_this75.updateLater={},_this75.maxRoomsUsers=0,_this75.maxRoomsStartupLoad=0,_this75.personalAudioRoomId="",_this75.currentPersonalAudioRoomId="",_this75.openInviteIdByRoomId={},_this75.getRoomByJidPromises={},_this75._roomTags=[],_this75.roomPresenceRef=null,_this75.roomMessageRef=null,_this75.roomInfoMessageRef=null,_this75.roomMessageConfigRef=null,_this75.roomHistoryInfoRef=null,_this75.roomNotificationRef=null,_this75.settingsService=settings_service_1.default,_this75.contactService=contact_service_1.default,_this75.profileService=profile_service_1.default,_this75.authService=auth_service_1.default,_this75.eventService=event_service_1.default,_this75.logger=logger_service_1.default,_this75.xmppService=xmpp_service_1.default,_this75.fileStorageService=fileStorage_service_1.default,_this75.errorHelperService=errorHelper_service_1.default,_this75.i18n=i18n_service_1.default,_this75}return _createClass(RoomService,[{key:"rooms",get:function(){return this._rooms},set:function(value){this._rooms=value}},{key:"roomTags",get:function(){return this._roomTags},set:function(value){this._roomTags=value}},{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee72(){return regenerator_default.a.wrap((function(_context73){for(;;)switch(_context73.prev=_context73.next){case 0:if(_context73.prev=0,this.userContact=this.contactService.userContact,!this.userContact||this.userContact.roomsEnabled){_context73.next=3;break}return _context73.abrupt("return",void this.logger.info("[roomService] === Start skipped - roomsEnabled : false"));case 3:return this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/",this.invitationCounter=0,this.meetingInvitationCounter=0,this.rooms={},this.roomsByJids={},this.roomsInProgress={},this.updateLater={},this.maxRoomsUsers=profile_service_1.default.getFeatureLimitMax(profile_service_1.default.FeaturesEnum.BUBBLE_PARTICIPANT_COUNT),this.maxRoomsStartupLoad=profile_service_1.default.getFeatureLimitMax(profile_service_1.default.FeaturesEnum.BUBBLE_MAX_LOAD_STARTUP),this.personalAudioRoomId="",this.currentPersonalAudioRoomId="",this.openInviteIdByRoomId={},this.getRoomByJidPromises={},this.roomTags=[],this.logger.info(""),this.logger.info("[roomService] === STARTING ==="),this.attachHandlers(),_context73.next=22,this.getServerRooms();case 22:this.computeInvitationCounter(),this.retrieveOpenInviteData(),this.profileService.isFeatureEnabled(profile_service_1.default.FeaturesEnum.CONFERENCE_ALLOWED)&&(this.retrievePersonalAudioRoom(),this.retrieveCurrentPersonalAudioRoom()),this.logger.info("[roomService] === STARTED ==="),_context73.next=31;break;case 28:_context73.prev=28,_context73.t0=_context73.catch(0),this.logger.error("[roomService] === STARTING FAILURE === "+_context73.t0.message),this.computeInvitationCounter(),this.reconnect();case 31:case"end":return _context73.stop()}}),_callee72,this,[[0,28]])})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee73(){return regenerator_default.a.wrap((function(_context74){for(;;)switch(_context74.prev=_context74.next){case 0:this.logger.info(""),this.logger.info("[roomService] === STOPPING ==="),this.listeners.forEach((function(listener){listener()})),this.rooms={},this.roomsByJids={},this.roomPresenceWaitingList=[],this.logger.info("[roomService] === STOPPED ===");case 1:case"end":return _context74.stop()}}),_callee73,this)})))}},{key:"attachHandlers",value:function(){var _this76=this;this.logger.info("[roomService] attachHandlers"),this.roomPresenceRef&&(this.xmppService.connection.deleteHandler(this.roomPresenceRef),this.roomPresenceRef=null),this.roomPresenceRef=this.xmppService.connection.addHandler((function(stanza){return _this76.onRoomPresence(stanza)}),"http://jabber.org/protocol/muc#user","presence"),this.roomMessageRef&&(this.xmppService.connection.deleteHandler(this.roomMessageRef),this.roomMessageRef=null),this.roomMessageRef=this.xmppService.connection.addHandler((function(stanza){return _this76.onRoomMessage(stanza)}),"jabber:x:conference","message"),this.roomInfoMessageRef&&(this.xmppService.connection.deleteHandler(this.roomInfoMessageRef),this.roomInfoMessageRef=null),this.roomInfoMessageRef=this.xmppService.connection.addHandler((function(stanza){return _this76.onRoomInfoMessage(stanza)}),null,"message","groupchat"),this.roomMessageConfigRef&&(this.xmppService.connection.deleteHandler(this.roomMessageConfigRef),this.roomMessageConfigRef=null),this.roomMessageConfigRef=this.xmppService.connection.addHandler((function(stanza){return _this76.onRoomMessageConfig(stanza)}),null,"message","management"),this.roomHistoryInfoRef&&(this.xmppService.connection.deleteHandler(this.roomHistoryInfoRef),this.roomHistoryInfoRef=null),this.roomHistoryInfoRef=this.xmppService.connection.addHandler((function(stanza){return _this76.onRoomHistoryInfoMessage(stanza)}),"jabber:iq:notification","message"),this.roomNotificationRef&&(this.xmppService.connection.deleteHandler(this.roomNotificationRef),this.roomNotificationRef=null),this.roomNotificationRef=this.xmppService.connection.addHandler((function(stanza){return _this76.onRoomNotificationMessage(stanza)}),"jabber:x:bubble:conference","message"),this.listeners.forEach((function(listener){listener()})),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((function(event){_this76.onConnectionStateChange(event)}))}},{key:"reconnect",value:function(){var attempt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee74(){return regenerator_default.a.wrap((function(_context75){for(;;)switch(_context75.prev=_context75.next){case 0:if(this.userContact&&!this.userContact.roomsEnabled){_context75.next=18;break}return _context75.prev=1,this.logger.info("[roomService] reconnect"),attempt++,this.attachHandlers(),_context75.next=7,this.getServerRooms();case 7:this.computeInvitationCounter(),this.retrieveOpenInviteData(),this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED)&&(this.retrievePersonalAudioRoom(),this.retrieveCurrentPersonalAudioRoom()),this.logger.info("[roomService] reconnect success"),_context75.next=16;break;case 13:_context75.prev=13,_context75.t0=_context75.catch(1),this.logger.error("[roomService] reconnect failure -- "+_context75.t0.message),1===attempt&&this.reconnect(attempt);case 16:_context75.next=19;break;case 18:this.logger.info("[roomService] === Reconnect skipped - roomsEnabled : false");case 19:case"end":return _context75.stop()}}),_callee74,this,[[1,13]])})))}},{key:"onConnectionStateChange",value:function(event){var _this77=this;this.logger.info("[roomService] onConnectionStateChange status:"+event.name),"ON_XMPP_DISCONNECTED"===event.name&&this.rooms&&(Object.keys(this.rooms).forEach((function(key){var room=_this77.rooms[key];room&&(room.initPresenceAck=!1,room.initPresInterval&&(_this77.logger.info("[roomService] onConnectionStateChange cancel initPresence retryer for room: "+room.jid+" "+room.getNameForLogs()),room.initPresInterval.unsubscribe(),room.initPresInterval=null),room.initPresPromise&&(_this77.logger.info("[roomService] onConnectionStateChange remove initPresPromise for room: "+room.jid+" "+room.getNameForLogs()),room.initPresPromise=null,room.initPresPromiseResolve=null))})),this.roomPresenceWaitingList=[])}},{key:"subscribe",value:function(callback){return this.rxSubject.subscribe(callback)}},{key:"sendEvent",value:function(type,value){this.rxSubject.next({type:type,value:value})}},{key:"getRooms",value:function(){var _this78=this,roomArray=[];return Object.keys(this.rooms).forEach((function(key){roomArray.push(_this78.rooms[key])})),roomArray}},{key:"searchRooms",value:function(criteria){var queries=criteria.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return this.getRooms().filter((function(room){if(!contact_service_1.default.userContact.phoneMeetingsEnabled&&room.isMeetingRoom())return!1;if("accepted"!==room.status)return!1;room.filterName=room.name.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"");var names=room.filterName.split(/[ -]+/);return queries.every((function(query){return names.some((function(name,index){return!(!name.length||-1===name.indexOf(query))&&(names[index]="",!0)}))}))}))}},{key:"getRoomInvitations",value:function(){return this.getRooms().filter((function(room){return"invited"===room.status&&"Rainbow_OutlookCreation_InternalUseOnly"!==room.desc&&!room.isMeetingRoom()&&!room.isWebinarRoom()}))}},{key:"getMeetingInvitations",value:function(){return this.getRooms().filter((function(room){return!room.isWebinarRoom()&&"invited"===room.status&&"Rainbow_OutlookCreation_InternalUseOnly"!==room.desc&&room.isMeetingRoom()&&!room.isWebinarRoom()}))}},{key:"getWebinarInvitations",value:function(){return this.getRooms().filter((function(room){return"invited"===room.status&&room.isWebinarRoom()&&null!==room.webinarId}))}},{key:"getMyRooms",value:function(){return this.getRooms().filter((function(room){return room.owner}))}},{key:"getRoomById",value:function(roomId){return this.rooms[roomId]}},{key:"getRoomByJid",value:function(jid){return this.roomsByJids[jid]}},{key:"getRoomsByContainerId",value:function(containerId){return this.getRooms().filter((function(room){return room.containerId===containerId}))}},{key:"computeInvitationCounter",value:function(){var _this79=this;this.invitationCounter=0,this.meetingInvitationCounter=0,Object.keys(this.rooms).forEach((function(key){var room=_this79.rooms[key];"invited"===room.status&&(room.isMeetingRoom()?_this79.meetingInvitationCounter+=1:_this79.invitationCounter+=1)}))}},{key:"getOrderedRooms",value:function(order){var rooms=this.getRooms();switch(order){case"lastActivityDate":return rooms.sort((function(roomA,roomB){return roomB.getLastActivityDate().getTime()-roomA.getLastActivityDate().getTime()}));case"creationDate":return rooms.sort((function(roomA,roomB){return roomB.getCreationDate().getTime()-roomA.getCreationDate().getTime()}));default:return rooms.sort((function(roomA,roomB){return roomA.name.localeCompare(roomB.name)}))}}},{key:"getMyOrderedRooms",value:function(order){var rooms=this.getMyRooms();switch(order){case"lastActivityDate":return rooms.sort((function(roomA,roomB){return roomB.getLastActivityDate().getTime()-roomA.getLastActivityDate().getTime()}));case"creationDate":return rooms.sort((function(roomA,roomB){return roomB.getCreationDate().getTime()-roomA.getCreationDate().getTime()}));default:return rooms.sort((function(roomA,roomB){return roomA.name.localeCompare(roomB.name)}))}}},{key:"updateRoomFromServer",value:function(room){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee75(){var response,roomData;return regenerator_default.a.wrap((function(_context76){for(;;)switch(_context76.prev=_context76.next){case 0:return this.logger.info("updateRoomFromServer(".concat(room.dbId,")")),_context76.prev=1,_context76.next=4,fetch("".concat(this.portalURL,"rooms/").concat(room.dbId,"?format=full"),{headers:auth_service_1.default.getRequestHeader()});case 4:return response=_context76.sent,_context76.next=7,response.json();case 7:return roomData=_context76.sent.data,_context76.next=10,this.getAllRoomsParticipants([roomData]);case 10:this.updateRoomData(room,roomData),_context76.next=16;break;case 13:_context76.prev=13,_context76.t0=_context76.catch(1),this.logger.error("updateRoomFromServer -- FAILURE -- "+_context76.t0.message);case 16:case"end":return _context76.stop()}}),_callee75,this,[[1,13]])})))}},{key:"updateRoomData",value:function(room,newRoomData){if(room.name=newRoomData.name,room.desc=newRoomData.topic,room.users=[],newRoomData.users.forEach((function(userData){var contact=contact_service_1.default.getContactById(userData.userId);contact&&(room.users.push({contact:contact,status:userData.status,date:new Date(userData.additionDate),privilege:userData.privilege}),contact_service_1.default.isUserContact(contact)&&(room.status=userData.status))})),this.refreshMemberAndOrganizerLists(room),room.isModerator=room.status!==this.RoomUserStatus.UNSUBSCRIBED&&room.isUserModerator(contact_service_1.default.userContact),newRoomData.lastAvatarUpdateDate&&newRoomData.lastAvatarUpdateDate!==room.lastAvatarUpdate){room.lastAvatarUpdate=newRoomData.lastAvatarUpdateDate;var avatarServerUrl=main_service_1.default.cdn?main_service_1.default.cdnServer:config.restServerUrl,updateToken=crypto_js_1.MD5(crypto_js_2.enc.Latin1.parse(room.lastAvatarUpdate)).toString(crypto_js_2.enc.Hex);room.avatar="".concat(avatarServerUrl,"/api/room-avatar/").concat(room.dbId,"?size=512&update=").concat(updateToken)}room.updateAvatarInfo(),room.guestEmails=newRoomData.guestEmails,room.confEndpoints=newRoomData.confEndpoints}},{key:"getServerRoom",value:function(roomId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee76(){var url,headers,response,roomData,roomsData,errorInfo;return regenerator_default.a.wrap((function(_context77){for(;;)switch(_context77.prev=_context77.next){case 0:return _context77.prev=0,url="".concat(this.portalURL,"rooms/").concat(roomId,"?format=full"),headers=this.authService.getRequestHeader(),_context77.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context77.sent).ok){_context77.next=8;break}throw response;case 8:return _context77.next=10,response.json();case 10:return roomData=_context77.sent.data,this.logger.info("[roomService] getServerRoom(".concat(roomId,") -- SUCCESS")),_context77.next=14,this.getAllRoomsParticipants([roomData]);case 14:return roomsData=_context77.sent,_context77.abrupt("return",this.createRoomFromData(roomsData[0]));case 18:return _context77.prev=18,_context77.t0=_context77.catch(0),_context77.next=22,this.errorHelperService.getErrorInfo(_context77.t0,"getServerRoom");case 22:throw errorInfo=_context77.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 24:case"end":return _context77.stop()}}),_callee76,this,[[0,18]])})))}},{key:"getServerRoomByJid",value:function(roomJid){var _this80=this;return this.logger.info("[roomService] getServerRoomByJid(".concat(roomJid,")")),this.getRoomByJidPromises[roomJid]||(this.getRoomByJidPromises[roomJid]=__awaiter(_this80,void 0,void 0,regenerator_default.a.mark((function _callee77(){var url,headers,response,roomData,roomsData,errorInfo;return regenerator_default.a.wrap((function(_context78){for(;;)switch(_context78.prev=_context78.next){case 0:return _context78.prev=0,url="".concat(this.portalURL,"rooms/jids/").concat(roomJid,"?format=full"),headers=this.authService.getRequestHeader(),_context78.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context78.sent).ok){_context78.next=8;break}throw response;case 8:return _context78.next=10,response.json();case 10:return roomData=_context78.sent.data,this.logger.info("[roomService] getServerRoomByJid(".concat(roomJid,") -- SUCCESS")),_context78.next=14,this.getAllRoomsParticipants([roomData]);case 14:return roomsData=_context78.sent,_context78.abrupt("return",(delete this.getRoomByJidPromises[roomJid],this.createRoomFromData(roomsData[0])));case 18:return _context78.prev=18,_context78.t0=_context78.catch(0),_context78.next=22,this.errorHelperService.getErrorInfo(_context78.t0,"getServerRoomByJid");case 22:throw errorInfo=_context78.sent,this.logger.error("[roomService] "+errorInfo.message),delete this.getRoomByJidPromises[roomJid],errorInfo.error;case 24:case"end":return _context78.stop()}}),_callee77,this,[[0,18]])})))),this.getRoomByJidPromises[roomJid]}},{key:"getServerRooms",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee79(){var getAllRooms,limit,response,errorMessage,_this81=this;return regenerator_default.a.wrap((function(_context80){for(;;)switch(_context80.prev=_context80.next){case 0:return getAllRooms=function getAllRooms(page,limit,rooms){return __awaiter(_this81,void 0,void 0,regenerator_default.a.mark((function _callee78(){var url,headers,response,responseData;return regenerator_default.a.wrap((function(_context79){for(;;)switch(_context79.prev=_context79.next){case 0:return _context79.prev=0,url="".concat(this.portalURL,"rooms?format=full&userId=").concat(this.userContact.dbId,"&sortField=lastActivityDate&status=invited&status=accepted&status=unsubscribed&offset=").concat(page,"&limit=").concat(limit),headers=this.authService.getRequestHeader(),_context79.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context79.sent).ok){_context79.next=8;break}throw response;case 8:return _context79.next=10,response.json();case 10:if(responseData=_context79.sent,rooms=rooms.concat(responseData.data),this.logger.info("[roomService] getServerRooms retrieved ".concat(responseData.data.length," rooms, total ").concat(rooms.length,", existing ").concat(responseData.total)),rooms.length!==responseData.total){_context79.next=17;break}_context79.t0=(this.logger.info("[roomService] getServerRooms no need to loop again. All rooms retrieved..."),rooms),_context79.next=22;break;case 17:return page+=limit,this.logger.info("[roomService] getServerRooms need another loop to get more rooms... "),_context79.next=21,getAllRooms(page,limit,rooms);case 21:_context79.t0=_context79.sent;case 22:return _context79.abrupt("return",_context79.t0);case 25:return _context79.prev=25,_context79.t1=_context79.catch(0),_context79.next=29,this.errorHelperService.getErrorInfo(_context79.t1,"getSetOfRooms");case 29:throw _context79.sent.error;case 30:case"end":return _context79.stop()}}),_callee78,this,[[0,25]])})))},_context80.prev=1,limit=this.maxRoomsStartupLoad?this.maxRoomsStartupLoad:1e3,_context80.next=5,getAllRooms(0,limit,[]);case 5:return response=_context80.sent,this.logger.info("[roomService] getServerRooms successfully: find ".concat(response.length," room(s)")),_context80.prev=7,_context80.next=10,this.getAllRoomsParticipants(response);case 10:_context80.sent.forEach((function(roomData){_this81.createRoomFromData(roomData,!0)})),_context80.next=16;break;case 13:_context80.prev=13,_context80.t0=_context80.catch(7),this.logger.info("[roomService] getServerRooms issue while retrieving all participant"),response.forEach((function(roomData){_this81.createRoomFromData(roomData,!0)}));case 16:this.sendInitialPresenceForAllRooms(),_context80.next=23;break;case 19:throw _context80.prev=19,_context80.t1=_context80.catch(1),errorMessage="getServerRooms failure: "+(_context80.t1.data?_context80.t1.data.errorDetails:_context80.t1.message),this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 23:case"end":return _context80.stop()}}),_callee79,this,[[1,19],[7,13]])})))}},{key:"getRoomParticipants",value:function(roomData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee80(){var roomId,total,usersData,requestCount,offset,requests,i,errorInfo;return regenerator_default.a.wrap((function(_context81){for(;;)switch(_context81.prev=_context81.next){case 0:if(_context81.prev=0,100,roomId=roomData.id,total=roomData.activeUsersCounter,usersData=roomData.users.concat(),!(total>100)){_context81.next=13;break}for(usersData=[],requestCount=total/100+1,offset=0,requests=[],i=1;i<requestCount;i++)requests.push(this.getRoomParticipantPage(roomId,offset,100)),offset+=100;return _context81.next=11,Promise.all(requests);case 11:_context81.sent.forEach((function(page){usersData=usersData.concat(page.data)})),roomData.users=usersData;case 13:return _context81.abrupt("return",usersData);case 16:return _context81.prev=16,_context81.t0=_context81.catch(0),_context81.next=20,this.errorHelperService.getErrorInfo(_context81.t0,"getSetOfUsers");case 20:throw errorInfo=_context81.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 22:case"end":return _context81.stop()}}),_callee80,this,[[0,16]])})))}},{key:"getRoomParticipantPage",value:function(roomId,offset,limit){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee81(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context82){for(;;)switch(_context82.prev=_context82.next){case 0:return _context82.prev=0,url="".concat(this.portalURL,"rooms/").concat(roomId,"/users?format=full&offset=").concat(offset,"&limit=").concat(limit),headers=auth_service_1.default.getRequestHeader(),_context82.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context82.sent).ok){_context82.next=8;break}throw response;case 8:return _context82.next=10,response.json();case 10:return _context82.abrupt("return",_context82.sent);case 13:return _context82.prev=13,_context82.t0=_context82.catch(0),_context82.next=17,this.errorHelperService.getErrorInfo(_context82.t0,"getRoomParticipantPage");case 17:throw errorInfo=_context82.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 19:case"end":return _context82.stop()}}),_callee81,this,[[0,13]])})))}},{key:"getAllRoomsParticipants",value:function(roomsData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee82(){var startDate,roomsUsersJids,missingRoomsUsersJids,endDate,_this82=this;return regenerator_default.a.wrap((function(_context83){for(;;)switch(_context83.prev=_context83.next){case 0:return _context83.prev=0,startDate=performance.now(),_context83.next=4,Promise.all(roomsData.map((function(roomData){return _this82.getRoomParticipants(roomData)})));case 4:if(roomsUsersJids=_context83.sent.reduce((function(jids,roomUsers){return roomUsers.forEach((function(roomUser){jids[roomUser.jid_im]||(jids[roomUser.jid_im]=!0)})),jids}),{}),missingRoomsUsersJids=Object.keys(roomsUsersJids).filter((function(jid){var contact=contact_service_1.default.getContactByJid(jid);return!contact||contact.temp})),_context83.t0=missingRoomsUsersJids&&missingRoomsUsersJids.length,!_context83.t0){_context83.next=10;break}return _context83.next=10,contact_service_1.default.getContactsByJids(missingRoomsUsersJids);case 10:return _context83.next=12,Promise.all(roomsData.map((function(roomData){return contact_service_1.default.getContactByDBId(roomData.creator)})));case 12:return endDate=performance.now(),_context83.abrupt("return",(this.logger.info('[roomService] getAllRoomsParticipants - get "'.concat(missingRoomsUsersJids.length," participants in ").concat(Math.round(endDate-startDate)," ms")),roomsData));case 16:throw _context83.prev=16,_context83.t1=_context83.catch(0),this.logger.error("[roomService] "+_context83.t1.message),_context83.t1;case 19:case"end":return _context83.stop()}}),_callee82,this,[[0,16]])})))}},{key:"createRoomFromData",value:function(roomData){var doNotSendPresence=arguments.length>1&&void 0!==arguments[1]&&arguments[1],room=room_model_1.Room.create(roomData.id,roomData.jid,roomData.name,roomData.topic,roomData.creationDate,roomData.confEndpoints,roomData.history,roomData.customData,roomData.conference,roomData.avatar,roomData.isActive,roomData.lastActivityDate,roomData.autoRegister,roomData.autoAcceptInvitation,roomData.tags,roomData.containerId,roomData.containerName),owner=contact_service_1.default.dbContacts[roomData.creator];owner?(room.ownerContact=owner,room.owner=owner.jid===contact_service_1.default.userContact.jid):this.logger.warn("[roomService] createRoomFromData -- failure -- Impossible to find owner of room "+roomData.name+" --- ignored"),roomData.users.forEach((function(userData){var contact=contact_service_1.default.getContactById(userData.userId);contact&&(room.users.push({contact:contact,status:userData.status,date:new Date(userData.additionDate),privilege:userData.privilege}),contact_service_1.default.isUserContact(contact)&&(room.status=userData.status))})),room.guestEmails=roomData.guestEmails,this.refreshMemberAndOrganizerLists(room);var ownUser=room.getUserByJid(contact_service_1.default.userContact.jid);if(room.isModerator=ownUser&&ownUser.status!==this.RoomUserStatus.UNSUBSCRIBED&&room.isUserModerator(contact_service_1.default.userContact),this.rooms[room.dbId]&&(this.rooms[room.dbId].initPresPromise&&(room.initPresPromise=this.rooms[room.dbId].initPresPromise,room.initPresInterval=this.rooms[room.dbId].initPresInterval,room.initPresPromiseResolve=this.rooms[room.dbId].initPresPromiseResolve),room.rxSubject=this.rooms[room.dbId].rxSubject,room.initPresenceAck=this.rooms[room.dbId].initPresenceAck),room.updateAvatarInfo(),roomData.lastAvatarUpdateDate){var url=main_service_1.default.cdn?main_service_1.default.cdnServer:config.restServerUrl;room.avatar=url+"/api/room-avatar/"+roomData.id+"?size=512&update="+crypto_js_1.MD5(crypto_js_2.enc.Latin1.parse(roomData.lastAvatarUpdateDate)).toString(crypto_js_2.enc.Hex)}return room.conference&&room.conference.webinarId&&(room.webinarId=room.conference.webinarId),this.rooms[room.dbId]=room,this.roomsByJids[room.jid]=room,this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),"accepted"!==room.status||!room.isActive||room.initPresenceAck||doNotSendPresence||this.sendInitialRoomPresenceSync(room),room}},{key:"refreshMemberAndOrganizerLists",value:function(room){var _this83=this;room.organizers=[],room.members=[],room.users.forEach((function(user){(user.status===_this83.RoomUserStatus.ACCEPTED||user.status===_this83.RoomUserStatus.INVITED||room.ownerContact&&user.contact.jid===room.ownerContact.jid)&&(user.privilege===room_model_1.Room.Privilege.MODERATOR?room.organizers.push(user):room.members.push(user))}))}},{key:"equalContactsArrayByDbId",value:function(contactsA,contactsB){if(contactsA===contactsB)return!0;if(null===contactsA||null===contactsB)return!1;if(contactsA.length!==contactsB.length)return!1;for(var i=0;i<contactsA.length;++i)if(contactsA[i].dbId!==contactsB[i].dbId)return!1;return!0}},{key:"getOrCreateRoomWithContacts",value:function(newContacts,newEmails){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee83(){var foundRoom,participants,roomNameRoot,escalatedRooms,roomName,index,_loop,_this84=this;return regenerator_default.a.wrap((function(_context84){for(;;)switch(_context84.prev=_context84.next){case 0:if(_context84.prev=0,foundRoom=null,participants=[].concat([contact_service_1.default.userContact],newContacts).sort(this.sortObjectByProperty("dbId")),this.getMyRooms().some((function(room){return!(!room||room.status!==_this84.RoomUserStatus.ACCEPTED||!_this84.equalContactsArrayByDbId(room.users.map((function(user){return user.contact})).sort(_this84.sortObjectByProperty("dbId")),participants))&&(foundRoom=room,_this84.logger.debug("[roomService] getOrCreateRoomWithContacts - Found Room "+room.getNameForLogs()),!0)})),!foundRoom){_context84.next=9;break}if(_context84.t0=newEmails.length,!_context84.t0){_context84.next=8;break}return _context84.next=8,this.addRoomUsers(foundRoom,null,newEmails);case 8:return _context84.abrupt("return",foundRoom);case 9:return _context84.next=11,this.retrieveRoomConsumption();case 11:if(!(_context84.sent>profile_service_1.default.getFeatureLimitMax(profile_service_1.default.FeaturesEnum.BUBBLE_COUNT))){_context84.next=14;break}return _context84.abrupt("return",(this.eventService.publish("ON_OPEN_GLOBAL_POPUP",{popupTitle:"createBubble",popupBody:"maxCollabSpaceReached",okLabel:"ok"}),null));case 14:for(roomNameRoot=contact_service_1.default.userContact.initials+" "+this.i18n.translate("new")+" "+this.i18n.translate("bubble")+" ",escalatedRooms=this.getMyRooms().filter((function(room){return room&&0===room.name.indexOf(roomNameRoot)})),roomName=null,index=1,_loop=function(){var tempRoomName=roomNameRoot+index.toString();escalatedRooms.sort(_this84.sortObjectByProperty("name")).some((function(room){return room&&room.name===tempRoomName}))||(roomName=tempRoomName),index++};!roomName;)_loop();return _context84.next=20,this.createRoomWithContacts(roomName,"",newContacts,newEmails);case 20:return _context84.abrupt("return",_context84.sent);case 23:throw _context84.prev=23,_context84.t1=_context84.catch(0),this.logger.error("[roomService] getOrCreateRoomWithContacts failure"),_context84.t1;case 26:case"end":return _context84.stop()}}),_callee83,this,[[0,23]])})))}},{key:"createRoomWithContacts",value:function(roomName,topic,contacts,emails){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee84(){var room,errorMessage;return regenerator_default.a.wrap((function(_context85){for(;;)switch(_context85.prev=_context85.next){case 0:return _context85.prev=0,_context85.next=3,this.createRoom(roomName,topic,!0,null,!0,null,!0);case 3:return room=_context85.sent,_context85.next=6,this.addRoomUsers(room,contacts,emails);case 6:return _context85.abrupt("return",room);case 9:throw _context85.prev=9,_context85.t0=_context85.catch(0),errorMessage=_context85.t0&&_context85.t0.message?"createRoomWithContacts failure: "+_context85.t0.message:"createRoomWithContacts failure",this.logger.error("[roomService] "+errorMessage),_context85.t0&&_context85.t0.errorDetailsLabel?_context85.t0:new Error(errorMessage);case 13:case"end":return _context85.stop()}}),_callee84,this,[[0,9]])})))}},{key:"setAvatarRoom",value:function(roomData,avatarImg){var width=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,height=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee85(){var resizedImage,binaryData,url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context86){for(;;)switch(_context86.prev=_context86.next){case 0:if(avatarImg){_context86.next=2;break}return _context86.abrupt("return",roomData);case 2:return _context86.prev=2,_context86.next=5,imageUtils_service_1.resizeImage(avatarImg,width,height);case 5:return resizedImage=_context86.sent,binaryData=imageUtils_service_1.getBinaryData(resizedImage),url="".concat(this.portalURL,"rooms/").concat(roomData.id,"/avatar"),headers=this.authService.getPostHeader("image/"+binaryData.type),_context86.next=11,fetch(url,{method:"POST",headers:headers,body:binaryData.data});case 11:if((response=_context86.sent).ok){_context86.next=14;break}throw response;case 14:return _context86.next=16,response.json();case 16:return this.logger.info("[roomService] setAvatarRoom -- SUCCESS"),roomData.avatar="".concat(config.restServerUrl,"/api/room-avatar/").concat(roomData.id,"?size=512&rand=").concat(randomString_1.default()),_context86.abrupt("return",roomData);case 21:return _context86.prev=21,_context86.t0=_context86.catch(2),_context86.next=25,this.errorHelperService.getErrorInfo(_context86.t0,"setAvatarRoom");case 25:throw errorInfo=_context86.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 27:case"end":return _context86.stop()}}),_callee85,this,[[2,21]])})))}},{key:"deleteAvatarRoom",value:function(roomId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee86(){var url,headers,response;return regenerator_default.a.wrap((function(_context87){for(;;)switch(_context87.prev=_context87.next){case 0:return url="".concat(this.portalURL,"rooms/").concat(roomId,"/avatar"),headers=this.authService.getRequestHeader(),_context87.next=4,fetch(url,{method:"DELETE",headers:headers});case 4:if((response=_context87.sent).ok){_context87.next=7;break}throw response;case 7:this.logger.info("[roomService] avatar room sucessfully deleted");case 8:case"end":return _context87.stop()}}),_callee86,this)})))}},{key:"pushContactInRoom",value:function(user,room){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee87(){var contact;return regenerator_default.a.wrap((function(_context88){for(;;)switch(_context88.prev=_context88.next){case 0:return _context88.prev=0,_context88.next=3,this.contactService.getContactByDBId(user.userId);case 3:contact=_context88.sent,room.users.push({contact:contact,status:user.status,date:new Date(user.additionDate),privilege:user.privilege}),this.contactService.isUserContact(contact)&&(room.status=user.status),this.logger.info("[roomService] pushContactInRoom success"),_context88.next=10;break;case 7:_context88.prev=7,_context88.t0=_context88.catch(0),this.logger.info("[roomService] pushContactInRoom failure : "+_context88.t0.message);case 10:case"end":return _context88.stop()}}),_callee87,this,[[0,7]])})))}},{key:"addRoomUser",value:function(room,contact){var reason=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,privilege=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,withoutInvitation=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee88(){var profileError,userStatus,userReason,userPrivilege,url,headers,body,response,userData,user,errorInfo,_this85=this;return regenerator_default.a.wrap((function(_context89){for(;;)switch(_context89.prev=_context89.next){case 0:if(_context89.prev=0,!room.users.some((function(user){return(user.status===_this85.RoomUserStatus.INVITED||user.status===_this85.RoomUserStatus.ACCEPTED||user.status===_this85.RoomUserStatus.REJECTED)&&user.contact.dbId===contact.dbId}))){_context89.next=3;break}return _context89.abrupt("return",(this.logger.debug("[roomService] user: ".concat(contact.dbId," already invited or accepted, will not be added")),room));case 3:if(!(room.users.filter((function(user){return user.status!==_this85.RoomUserStatus.DELETED})).length>=this.maxRoomsUsers)){_context89.next=6;break}throw(profileError=new Error("addRoomUser failure - Not Allowed : Participants max limit has been reached: "+this.maxRoomsUsers)).status=profileError.errorDetailsCode="403",profileError.errorDetailsLabel="MaximumNumberRoomUsersReach",profileError.errorDetailsCode="403620",this.logger.error("[roomService] "+profileError.message),profileError;case 6:return userStatus="boolean"==typeof withoutInvitation&&withoutInvitation?this.RoomUserStatus.ACCEPTED:this.RoomUserStatus.INVITED,userReason=reason||"JustForFun",userPrivilege=privilege||room_model_1.Room.Privilege.USER,url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/users"),headers=this.authService.getPostHeader(),body=JSON.stringify({userId:contact.dbId,privilege:userPrivilege,reason:userReason,status:userStatus}),_context89.next=14,fetch(url,{method:"POST",headers:headers,body:body});case 14:if((response=_context89.sent).ok){_context89.next=17;break}throw response;case 17:return this.logger.info("[roomService] addRoomUser ".concat(contact.nameForLogs," to room ").concat(room.dbId," (").concat(room.getNameForLogs(),") success")),_context89.next=20,response.json();case 20:return userData=_context89.sent.data,user=room.getUserByJid(userData.jid_im),_context89.abrupt("return",(user?(user.status=userData.status,user.date=new Date,user.privilege=userData.privilege):room.users.push({contact:contact,status:userStatus,date:new Date,privilege:userPrivilege}),this.refreshMemberAndOrganizerLists(room),this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),room));case 25:return _context89.prev=25,_context89.t0=_context89.catch(0),_context89.next=29,this.errorHelperService.getErrorInfo(_context89.t0,"addRoomUser");case 29:throw errorInfo=_context89.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 31:case"end":return _context89.stop()}}),_callee88,this,[[0,25]])})))}},{key:"addRoomUsers",value:function(room,contacts){var emails=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee89(){var addRoomUserPromises,errorMessage,_this86=this;return regenerator_default.a.wrap((function(_context90){for(;;)switch(_context90.prev=_context90.next){case 0:return _context90.prev=0,addRoomUserPromises=[],contacts.forEach((function(contact){room.users.some((function(user){if(user.contact.dbId===contact.dbId){switch(user.status){case _this86.RoomUserStatus.REJECTED:case _this86.RoomUserStatus.UNSUBSCRIBED:addRoomUserPromises.push(_this86.ownerReinviteRejectedUser(room,contact));break;case _this86.RoomUserStatus.DELETED:addRoomUserPromises.push(_this86.ownerReinviteDeletedUser(room,contact))}return!0}return!1}))||addRoomUserPromises.push(_this86.addRoomUser(room,contact))})),_context90.next=5,Promise.all(addRoomUserPromises);case 5:this.logger.info("[roomService] addRoomUsers success"),this.eventService.publish(this.ROOM_ADD_USERS_EVENT,room),this.inviteGuestEmailToJoinRoom(room,emails),_context90.next=14;break;case 10:throw _context90.prev=10,_context90.t0=_context90.catch(0),errorMessage="addRoomUsers failure: "+_context90.t0.message,this.logger.error("[roomService] "+errorMessage),_context90.t0;case 14:case"end":return _context90.stop()}}),_callee89,this,[[0,10]])})))}},{key:"deleteRoomUsers",value:function(room,contacts){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee90(){var deleteRoomUserPromises,errorMessage,_this87=this;return regenerator_default.a.wrap((function(_context91){for(;;)switch(_context91.prev=_context91.next){case 0:return _context91.prev=0,deleteRoomUserPromises=[],contacts.forEach((function(contact){room.users.some((function(user){return user.contact.dbId===contact.dbId}))&&deleteRoomUserPromises.push(_this87.ownerDeletesUserFromRoom(room,contact))})),_context91.next=5,Promise.all(deleteRoomUserPromises);case 5:return this.logger.info("[roomService] deleteRoomUsers success"),this.eventService.publish(this.ROOM_DELETE_USERS_EVENT,room),_context91.abrupt("return",room);case 10:throw _context91.prev=10,_context91.t0=_context91.catch(0),errorMessage="deleteRoomUsers failure: "+_context91.t0.message,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 14:case"end":return _context91.stop()}}),_callee90,this,[[0,10]])})))}},{key:"addRoomAndroidTVs",value:function(room,contactAndroidTVs){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee91(){var addRoomAndroidTVPromises,errorMessage,_this88=this;return regenerator_default.a.wrap((function(_context92){for(;;)switch(_context92.prev=_context92.next){case 0:return _context92.prev=0,addRoomAndroidTVPromises=[],contactAndroidTVs.forEach((function(contactAndroidTV){null!==contactAndroidTV&&addRoomAndroidTVPromises.push(_this88.addRoomAndroidTV(room,contactAndroidTV))})),_context92.next=5,Promise.all(addRoomAndroidTVPromises);case 5:return this.logger.info("[roomService] addRoomAndroidTVs success"),this.eventService.publish(this.ROOM_ADD_USERS_EVENT,room),_context92.abrupt("return",room);case 10:throw _context92.prev=10,_context92.t0=_context92.catch(0),errorMessage="addRoomAndroidTVs failure: "+_context92.t0.message,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 14:case"end":return _context92.stop()}}),_callee91,this,[[0,10]])})))}},{key:"addRoomAndroidTV",value:function(room,contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee92(){var privilege,_status,url,headers,body,response,userData,user,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context93){for(;;)switch(_context93.prev=_context93.next){case 0:return _context93.prev=0,"androidtv",privilege="moderator",_status="accepted",url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/users"),headers=this.authService.getPostHeader(),body=JSON.stringify({userId:contact.dbId,privilege:privilege,reason:"androidtv",status:_status}),_context93.next=9,fetch(url,{method:"POST",headers:headers,body:body});case 9:if((response=_context93.sent).ok){_context93.next=12;break}throw response;case 12:return this.logger.info("[roomService] addRoomAndroidTV ".concat(contact.nameForLog," to room ").concat(room.dbId," (").concat(room.getNameForLogs(),") success")),_context93.next=15,response.json();case 15:return userData=_context93.sent.data,user=room.getUserByJid(userData.jid_im),_context93.abrupt("return",(user?(user.status=userData.status,user.date=new Date,user.privilege=userData.privilege):room.users.push({contact:contact,status:_status,date:new Date,privilege:privilege}),this.refreshMemberAndOrganizerLists(room),this.eventService.publish(this.ROOM_UPDATE_EVENT,room),room));case 20:if(_context93.prev=20,_context93.t0=_context93.catch(0),!_context93.t0.data||!_context93.t0.data.errorDetails){_context93.next=25;break}throw errorMessage="addRoomAndroidTV ".concat(contact.nameForLog," to room ").concat(room.dbId," (").concat(room.getNameForLogs(),") failure: ").concat(_context93.t0.data.errorDetails),this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 25:return _context93.next=27,this.errorHelperService.getErrorInfo(_context93.t0,"addRoomAndroidTV");case 27:throw errorInfo=_context93.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 29:case"end":return _context93.stop()}}),_callee92,this,[[0,20]])})))}},{key:"sendInitialPresenceForAllRooms",value:function(){var _this89=this;Object.keys(this.rooms).forEach((function(key){var room=_this89.rooms[key];room&&!room.initPresPromise&&!room.initPresenceAck&&"accepted"===room.status&&room.isActive&&_this89.roomPresenceWaitingList.push(room)})),this.sendInitialPresenceForRoomsByParts(15)}},{key:"allSettled",value:function(promises){var wrappedPromises=promises.map((function(prom){return Promise.resolve(prom).then((function(val){return{status:"fulfilled",value:val}}),(function(err){return{status:"rejected",reason:err}}))}));return Promise.all(wrappedPromises)}},{key:"sendInitialPresenceForRoomsByParts",value:function(){var _this90=this,groupSize=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,extraDelay=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.roomPresenceWaitingList&&this.roomPresenceWaitingList.length){this.logger.info("[roomService] sendInitialPresenceForRoomsByParts");for(var arrayLength=this.roomPresenceWaitingList.length,presencePromises=[],delay=extraDelay?3e4:7500,i=0;i<groupSize;i++)this.roomPresenceWaitingList[i]&&presencePromises.push(this.sendInitialRoomPresenceSync(this.roomPresenceWaitingList[i],delay));presencePromises.length&&this.allSettled(presencePromises).then((function(){_this90.logger.info("[roomService] sendInitialPresenceForRoomsByParts -- done for group -- presences remaining "+_this90.roomPresenceWaitingList.length);var addDelay=arrayLength===_this90.roomPresenceWaitingList.length;_this90.sendInitialPresenceForRoomsByParts(15,addDelay)}))}}},{key:"sendInitialRoomPresence",value:function(room){var attempt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,attemptInfo=attempt?" -- attempt "+attempt:"";this.logger.info("[roomService] sendInitialRoomPresence "+attemptInfo+" -- "+room.getNameForLogs()+" -- "+room.dbId);var presenceIq=strophe_js_1.$pres({to:room.jid+"/"+this.xmppService.fullJid});presenceIq.c("x",{xmlns:"http://jabber.org/protocol/muc"}).c("history",{maxchars:"0"}),this.xmppService.send(presenceIq)}},{key:"sendInitialRoomPresenceSync",value:function(room){var _this91=this,intervalDelay=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7500;return room.initPresPromise?room.initPresPromise:room.initPresenceAck?(this.logger.info("[roomService] sendInitialRoomPresenceSync -- ".concat(room.getNameForLogs()," -- ").concat(room.dbId," -- room already activated")),Promise.resolve()):(room.initPresPromise=new Promise((function(resolve,reject){room.initPresPromiseResolve=resolve,_this91.sendInitialRoomPresence(room,0);var attemptNumber=0;room.initPresInterval=rxjs_2.interval(intervalDelay).subscribe((function(){attemptNumber<3?(attemptNumber+=1,_this91.sendInitialRoomPresence(room,attemptNumber)):(_this91.logger.error("[roomService] sendInitialRoomPresenceSync : no response after "+attemptNumber+" retries => clean presence promise and interval for "+room.getNameForLogs()+" -- "+room.jid),reject("[roomService] sendInitialRoomPresenceSync : no response"),room.initPresPromise=null,room.initPresInterval&&(room.initPresInterval.unsubscribe(),room.initPresInterval=null),room=_this91.rooms[room.dbId],_this91.eventService.publish(_this91.ROOM_UPDATE_EVENT,room))}))})),room.initPresPromise)}},{key:"sendUnavailableRoomPresence",value:function(room){var presenceIq=strophe_js_1.$pres({to:room.jid+"/"+contact_service_1.default.userContact.jid,type:"unavailable"});presenceIq.c("x",{xmlns:"http://jabber.org/protocol/muc"}),this.xmppService.send(presenceIq)}},{key:"sendAvailableRoomPresence",value:function(room){var presenceIq=strophe_js_1.$pres({to:room.jid+"/"+contact_service_1.default.userContact.jid,type:"available"});presenceIq.c("x",{xmlns:"http://jabber.org/protocol/muc"}),this.xmppService.send(presenceIq)}},{key:"createRoom",value:function(roomName,roomDesc,withHistory,roomAvatar){var disableNotifications=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],mediaType=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,createConversation=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,autoAcceptInvitation=arguments.length>7&&void 0!==arguments[7]&&arguments[7],muteUponEntry=arguments.length>8&&void 0!==arguments[8]&&arguments[8],disableTimeStats=arguments.length>9&&void 0!==arguments[9]&&arguments[9];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee93(){var roomNameForLogs,history,autoAccept,data,url,headers,body,response,roomData,room,errorInfo;return regenerator_default.a.wrap((function(_context94){for(;;)switch(_context94.prev=_context94.next){case 0:return roomNameForLogs=roomName.charAt(0)+"***"+roomName.slice(-1),_context94.prev=1,this.logger.info('[roomService] createRoom "'+roomNameForLogs+'"'),(void 0===disableNotifications||disableNotifications&&"boolean"!=typeof disableNotifications)&&(disableNotifications=!0),createConversation=createConversation||"true",history=withHistory?"all":"none",autoAccept=Boolean(autoAcceptInvitation),data={name:roomName,topic:roomDesc,history:history,disableNotifications:disableNotifications,mediaType:null,createConversation:createConversation,autoAcceptInvitation:autoAccept,muteUponEntry:muteUponEntry,disableTimeStats:!1},mediaType&&(data.mediaType=mediaType),disableTimeStats&&(data.disableTimeStats=disableTimeStats),url=this.portalURL+"rooms/",headers=this.authService.getPostHeader(),body=JSON.stringify(data),_context94.next=10,fetch(url,{method:"POST",headers:headers,body:body});case 10:if((response=_context94.sent).ok){_context94.next=13;break}throw response;case 13:return _context94.next=15,response.json();case 15:return roomData=_context94.sent.data,_context94.prev=16,_context94.next=19,this.setAvatarRoom(roomData,roomAvatar);case 19:_context94.next=23;break;case 21:_context94.prev=21,_context94.t0=_context94.catch(16);case 23:if(!this.rooms[roomData.id]){_context94.next=25;break}return _context94.abrupt("return",(this.logger.info('[roomService] createRoom -- room "'+roomNameForLogs+'" already exists'),this.rooms[roomData.id]));case 25:return(room=room_model_1.Room.create(roomData.id,roomData.jid,roomData.name,roomData.topic,roomData.creationDate,roomData.confEndpoints,roomData.history,roomData.customData,roomData.conference,roomData.avatar,roomData.isActive,roomData.lastActivityDate,roomData.autoRegister,roomData.autoAcceptInvitation,roomData.tags,roomData.containerId,roomData.containerName)).ownerContact=contact_service_1.default.userContact,room.owner=!0,room.isModerator=!0,room.status="accepted",roomData.users.forEach((function(userData){var contact=contact_service_1.default.getContactById(userData.userId);contact&&(room.users.push({contact:contact,status:userData.status,date:new Date(userData.additionDate),privilege:userData.privilege}),contact_service_1.default.isUserContact(contact)&&(room.status=userData.status))})),this.refreshMemberAndOrganizerLists(room),this.rooms[room.dbId]=room,this.roomsByJids[room.jid]=room,this.logger.info('[roomService] createRoom "'+roomNameForLogs+'" -- success'),_context94.next=37,this.sendInitialRoomPresenceSync(room);case 37:return _context94.abrupt("return",this.rooms[room.dbId]);case 40:return _context94.prev=40,_context94.t1=_context94.catch(1),_context94.next=44,this.errorHelperService.getErrorInfo(_context94.t1,"getServerInvitation");case 44:throw errorInfo=_context94.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 46:case"end":return _context94.stop()}}),_callee93,this,[[1,40],[16,21]])})))}},{key:"updateRoomUser",value:function(room,contact){var status=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,privilege=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee94(){var data,url,headers,body,response,userData,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context95){for(;;)switch(_context95.prev=_context95.next){case 0:return _context95.prev=0,data={status:void 0,privilege:void 0},status&&(data.status=status),privilege&&(data.privilege=privilege),url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/users/").concat(contact.dbId),headers=this.authService.getPostHeader(),body=JSON.stringify(data),_context95.next=8,fetch(url,{method:"PUT",headers:headers,body:body});case 8:if((response=_context95.sent).ok){_context95.next=11;break}throw response;case 11:return this.logger.info("[roomService] updateRoomUser ".concat(contact.nameForLogs," to room ").concat(room.dbId," (").concat(room.getNameForLogs(),") success")),_context95.next=14,response.json();case 14:return userData=_context95.sent.data,_context95.abrupt("return",(room.users.forEach((function(user){user.contact.jid===userData.jid_im&&(user.privilege=userData.privilege,user.status=userData.status)})),this.refreshMemberAndOrganizerLists(room),this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),room));case 18:if(_context95.prev=18,_context95.t0=_context95.catch(0),!_context95.t0.data||!_context95.t0.data.errorDetails){_context95.next=23;break}throw errorMessage="updateRoomUser "+contact.nameForLogs+" to room "+room.dbId+"("+room.getNameForLogs()+") failure: "+_context95.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 23:return _context95.next=25,this.errorHelperService.getErrorInfo(_context95.t0,"updateRoomUser");case 25:throw errorInfo=_context95.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 27:case"end":return _context95.stop()}}),_callee94,this,[[0,18]])})))}},{key:"ownerArchiveRoom",value:function(room){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee95(){var unsubscribeRoomUserPromises,_this92=this;return regenerator_default.a.wrap((function(_context96){for(;;)switch(_context96.prev=_context96.next){case 0:return this.logger.info("[roomService] ownerArchiveRoom"),unsubscribeRoomUserPromises=[],room.users.forEach((function(user){contact_service_1.default.isUserContact(user.contact)||user.status===_this92.RoomUserStatus.DELETED||user.status===_this92.RoomUserStatus.REJECTED||unsubscribeRoomUserPromises.push(_this92.unsubscribeUserFromRoom(room,user.contact))})),_context96.prev=3,_context96.next=6,Promise.all(unsubscribeRoomUserPromises);case 6:return this.logger.info("[roomService] unsubscribe all other users successfully"),_context96.next=9,this.unsubscribeMeFromRoom(room);case 9:this.logger.info("[roomService] ownerArchiveRoom successfully"),_context96.next=15;break;case 12:_context96.prev=12,_context96.t0=_context96.catch(3),this.logger.error("[roomService] ownerArchiveRoom failure "+_context96.t0.message);case 15:case"end":return _context96.stop()}}),_callee95,this,[[3,12]])})))}},{key:"unsubscribeUserFromRoom",value:function(room,contact){return this.updateRoomUser(room,contact,this.RoomUserStatus.UNSUBSCRIBED)}},{key:"ownerDeletesUserFromRoom",value:function(room,contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee96(){var url,headers,response,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context97){for(;;)switch(_context97.prev=_context97.next){case 0:return _context97.prev=0,this.logger.info("[roomService] ownerDeletesUserFromRoom"),url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/users/").concat(contact.dbId),headers=this.authService.getRequestHeader(),_context97.next=6,fetch(url,{method:"DELETE",headers:headers});case 6:if((response=_context97.sent).ok){_context97.next=9;break}throw response;case 9:return _context97.abrupt("return",(this.logger.info("[roomService] ownerDeletesUserFromRoom ".concat(contact.dbId," from room ").concat(room.dbId," (").concat(room.getNameForLogs(),") success")),this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),room));case 12:if(_context97.prev=12,_context97.t0=_context97.catch(0),!_context97.t0.data||!_context97.t0.data.errorDetails){_context97.next=17;break}throw errorMessage="ownerDeletesUserFromRoom "+contact.dbId+" from room "+room.dbId+"("+room.getNameForLogs()+") failure: "+_context97.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 17:return _context97.next=19,this.errorHelperService.getErrorInfo(_context97.t0,"ownerDeletesUserFromRoom");case 19:throw errorInfo=_context97.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 21:case"end":return _context97.stop()}}),_callee96,this,[[0,12]])})))}},{key:"ownerReinviteRejectedUser",value:function(room,contact){var reason=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,privilege=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,withoutInvitation=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee97(){var errorMessage;return regenerator_default.a.wrap((function(_context98){for(;;)switch(_context98.prev=_context98.next){case 0:return _context98.prev=0,_context98.next=3,this.ownerDeletesUserFromRoom(room,contact);case 3:return _context98.next=5,this.addRoomUser(room,contact,reason,privilege,withoutInvitation);case 5:return this.logger.info("[roomService] ownerReinviteRejectedUser "+contact.dbId+" from room "+room.dbId+"("+room.getNameForLogs()+") success"),_context98.abrupt("return",room);case 9:throw _context98.prev=9,_context98.t0=_context98.catch(0),errorMessage="ownerReinviteRejectedUser failure: "+_context98.t0.message,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 13:case"end":return _context98.stop()}}),_callee97,this,[[0,9]])})))}},{key:"ownerReinviteDeletedUser",value:function(room,contact){var reason=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,privilege=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,withoutInvitation=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee98(){var errorMessage;return regenerator_default.a.wrap((function(_context99){for(;;)switch(_context99.prev=_context99.next){case 0:return _context99.prev=0,_context99.next=3,this.addRoomUser(room,contact,reason,privilege,withoutInvitation);case 3:return this.logger.info("[roomService] ownerReinviteDeletedUser "+contact.dbId+" from room "+room.dbId+"("+room.getNameForLogs()+") success"),_context99.abrupt("return",room);case 7:throw _context99.prev=7,_context99.t0=_context99.catch(0),errorMessage="ownerReinviteDeletedUser failure: "+_context99.t0.message,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 11:case"end":return _context99.stop()}}),_callee98,this,[[0,7]])})))}},{key:"ownerDeleteRoom",value:function(room){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee99(){var roomId,url,headers,response,errorMessage;return regenerator_default.a.wrap((function(_context100){for(;;)switch(_context100.prev=_context100.next){case 0:if(roomId=room.dbId,_context100.prev=1,roomId){_context100.next=4;break}return _context100.abrupt("return",(this.logger.error("[roomService] ownerDeleteRoom failure because the roomId is empty ..."),null));case 4:return url="".concat(this.portalURL,"rooms/").concat(roomId),headers=this.authService.getRequestHeader(),_context100.next=8,fetch(url,{method:"DELETE",headers:headers});case 8:if((response=_context100.sent).ok){_context100.next=11;break}throw response;case 11:return _context100.abrupt("return",(this.logger.info("[roomService] ownerDeleteRoom "+room.dbId+"("+room.getNameForLogs()+") success"),delete this.rooms[room.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),room.rxSubject.next(),room));case 14:throw _context100.prev=14,_context100.t0=_context100.catch(1),errorMessage="ownerDeleteRoom ("+roomId+") failure: unknown error occurred",_context100.t0&&_context100.t0.data&&(errorMessage="ownerDeleteRoom ("+roomId+") failure: "+_context100.t0.data.errorDetails),_context100.t0&&404===_context100.t0.status&&(this.logger.info("[roomService] ownerDeleteRoom "+room.dbId+"("+room.getNameForLogs()+") not found, deleting it from local storage"),delete this.rooms[room.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room)),this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 18:case"end":return _context100.stop()}}),_callee99,this,[[1,14]])})))}},{key:"ownerUpdateRoom",value:function(roomData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee100(){var url,headers,body,response,room,errorMessage;return regenerator_default.a.wrap((function(_context101){for(;;)switch(_context101.prev=_context101.next){case 0:return _context101.prev=0,this.logger.info("[roomService] ownerUpdateRoom"),url="".concat(this.portalURL,"rooms/").concat(roomData.dbId),headers=this.authService.getPostHeader(),body=JSON.stringify({name:roomData.name,topic:roomData.desc,visibility:roomData.type?"public":"private"}),_context101.next=7,fetch(url,{method:"PUT",headers:headers,body:body});case 7:if((response=_context101.sent).ok){_context101.next=10;break}throw response;case 10:return _context101.next=12,response.json();case 12:return room=_context101.sent.data,_context101.abrupt("return",(this.rooms[room.id].desc=room.topic,this.rooms[room.id].type="private"===room.visibility?room_model_1.Room.Type.PRIVATE:room_model_1.Room.Type.PUBLIC,this.logger.info("[roomService] ownerUpdateRoom successfully ("+room.id+", "+room.jid+")"),this.rooms[room.id]));case 16:throw _context101.prev=16,_context101.t0=_context101.catch(0),errorMessage="ownerUpdateRoom failure: "+_context101.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 20:case"end":return _context101.stop()}}),_callee100,this,[[0,16]])})))}},{key:"checkPromoteOwner",value:function(room,contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee101(){var url,headers,response,errorData,errorDetailsCode,bubbleParticipantCountErrorMsg,bubblePromoteMemberErrorMsg,webRtcConfAllowedErrorMsg,rberror,_this93=this;return regenerator_default.a.wrap((function(_context102){for(;;)switch(_context102.prev=_context102.next){case 0:return _context102.prev=0,url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/owners/").concat(contact.dbId,"/check"),headers=this.authService.getPostHeader(),_context102.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context102.sent).ok){_context102.next=8;break}throw response;case 8:this.logger.info("[roomService] checkPromoteOwner "+contact.nameForLogs+" to room "+room.dbId+"("+room.getNameForLogs()+") success"),_context102.next=21;break;case 11:return _context102.prev=11,_context102.t0=_context102.catch(0),_context102.next=15,_context102.t0.json();case 15:throw errorData=_context102.sent,this.logger.error("[roomService] Error checkPromoteOwner"),errorDetailsCode=errorData.errorDetailsCode,bubbleParticipantCountErrorMsg=null,bubblePromoteMemberErrorMsg=null,webRtcConfAllowedErrorMsg=null,rberror=new RBError(""),409002===errorDetailsCode&&errorData.errorDetailsData&&(Array.isArray(errorData.errorDetailsData)?(errorData.errorDetailsData.forEach((function(errorDetails){"BUBBLE_PARTICIPANT_COUNT"===errorDetails.feature?bubbleParticipantCountErrorMsg=_this93.i18n.translate("promoteToOwnerFailureParticipantCountReached",{name:contact.displayName,maxValue:errorDetails.maxValue}):"WEBRTC_CONFERENCE_ALLOWED"===errorDetails.feature?webRtcConfAllowedErrorMsg=_this93.i18n.translate("promoteToOwnerFailureWebRtcConferenceAllowed",{name:contact.displayName}):"BUBBLE_PROMOTE_MEMBER"===errorDetails.feature&&(bubblePromoteMemberErrorMsg=_this93.i18n.translate("promoteToOwnerFailureBubblePromoteMember",{name:contact.displayName}))})),bubbleParticipantCountErrorMsg?(rberror.message=bubbleParticipantCountErrorMsg,rberror.details={promotePossible:!1}):webRtcConfAllowedErrorMsg?(rberror.message=this.i18n.translate("promoteOrganizerToOwnerMsg",{name:contact.displayName}),rberror.details={promotePossible:!0,secondMessage:webRtcConfAllowedErrorMsg}):bubblePromoteMemberErrorMsg&&(rberror.message=this.i18n.translate("promoteOrganizerToOwnerMsg",{name:contact.displayName}),rberror.details={promotePossible:!0,secondMessage:bubblePromoteMemberErrorMsg})):(rberror.message=this.i18n.translate("promoteToOwnerFailureNotInRoom",{name:contact.displayName}),rberror.details={promotePossible:!1})),rberror;case 21:case"end":return _context102.stop()}}),_callee101,this,[[0,11]])})))}},{key:"getCheckPromoteErrorMsg",value:function(responseData,contact){var _this94=this,errorMessage="";return responseData&&responseData.errorDetailsData&&responseData.errorDetailsData.length>0&&responseData.errorDetailsData.every((function(errorDetails){return"BUBBLE_PARTICIPANT_COUNT"===errorDetails.feature&&(errorMessage=_this94.i18n.translate("promoteToOwnerFailureParticipantCountReached",{name:contact.displayName}),!0)})),errorMessage}},{key:"changeRoomOwner",value:function(room,newOwnerContact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee102(){var msg,confEndpointId,url,headers,body,response,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context103){for(;;)switch(_context103.prev=_context103.next){case 0:if(_context103.prev=0,this.logger.info("[roomService] changeRoomOwner"),room&&newOwnerContact){_context103.next=4;break}throw msg="changeRoomOwner error: - missing room or new owner",this.logger.error("[roomService] "+msg),new Error(msg);case 4:return confEndpointId=room.confEndpoints&&room.confEndpoints.length?room.confEndpoints[0].confEndpointId:"",_context103.next=7,this.deleteRoomConferenceEndPoint(room,confEndpointId);case 7:return url="".concat(this.portalURL,"rooms/").concat(room.dbId),headers=this.authService.getPostHeader(),body=JSON.stringify({owner:newOwnerContact.dbId}),_context103.next=12,fetch(url,{method:"PUT",headers:headers,body:body});case 12:if((response=_context103.sent).ok){_context103.next=15;break}throw response;case 15:return _context103.abrupt("return",(room.ownerContact=newOwnerContact,room.owner=newOwnerContact.jid===contact_service_1.default.userContact.jid,this.logger.info("[roomService] changeRoomOwner successfully ("+room.dbId+")"),this.rooms[room.dbId]));case 18:if(_context103.prev=18,_context103.t0=_context103.catch(0),!_context103.t0.data||!_context103.t0.data.errorDetails){_context103.next=23;break}throw errorMessage="changeRoomOwner failure: "+_context103.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 23:return _context103.next=25,this.errorHelperService.getErrorInfo(_context103.t0,"changeRoomOwner");case 25:throw errorInfo=_context103.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 27:case"end":return _context103.stop()}}),_callee102,this,[[0,18]])})))}},{key:"ownerUpdateRoomCustomData",value:function(roomData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee103(){var url,headers,body,response,data,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context104){for(;;)switch(_context104.prev=_context104.next){case 0:return _context104.prev=0,this.logger.info("[roomService] ownerUpdateRoomCustomData"),url="".concat(this.portalURL,"rooms/").concat(roomData.dbId,"/custom-data"),headers=this.authService.getPostHeader(),body=JSON.stringify({customData:roomData.customData}),_context104.next=7,fetch(url,{method:"PUT",headers:headers,body:body});case 7:if((response=_context104.sent).ok){_context104.next=10;break}throw response;case 10:return _context104.next=12,response.json();case 12:return data=_context104.sent.data,_context104.abrupt("return",(this.logger.info("[roomService] ownerUpdateRoomCustomData successfully got ("+JSON.stringify(data,null,4)+")"),data.customData||{}));case 16:if(_context104.prev=16,_context104.t0=_context104.catch(0),!_context104.t0.data||!_context104.t0.data.errorDetails){_context104.next=21;break}throw errorMessage="ownerUpdateRoomCustomData failure: "+_context104.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 21:return _context104.next=23,this.errorHelperService.getErrorInfo(_context104.t0,"ownerUpdateRoomCustomData");case 23:throw errorInfo=_context104.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 25:case"end":return _context104.stop()}}),_callee103,this,[[0,16]])})))}},{key:"ownerUpdateRoomNameAndDescription",value:function(roomData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee104(){var url,headers,body,response,room,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context105){for(;;)switch(_context105.prev=_context105.next){case 0:return _context105.prev=0,this.logger.info("[roomService] ownerUpdateRoomNameAndDescription"),url="".concat(this.portalURL,"rooms/").concat(roomData.dbId),headers=this.authService.getPostHeader(),body=JSON.stringify({name:roomData.name,topic:roomData.desc,visibility:roomData.type?"public":"private"}),_context105.next=7,fetch(url,{method:"PUT",headers:headers,body:body});case 7:if((response=_context105.sent).ok){_context105.next=10;break}throw response;case 10:return _context105.next=12,response.json();case 12:return room=_context105.sent.data,_context105.abrupt("return",(this.rooms[room.id].desc=room.topic,this.rooms[room.id].type="private"===room.visibility?room_model_1.Room.Type.PRIVATE:room_model_1.Room.Type.PUBLIC,(room.conference||room.confEndpoints)&&(this.rooms[room.id].conference=room.conference?room.conference:null,this.rooms[room.id].confEndpoints=room.confEndpoints?room.confEndpoints:[]),this.logger.info("[roomService] ownerUpdateRoomNameAndDescription successfully ("+room.id+", "+room.jid+")"),this.rooms[room.id]));case 16:return _context105.prev=16,_context105.t0=_context105.catch(0),_context105.t0.data&&_context105.t0.data.errorDetails&&(errorMessage="ownerUpdateRoomNameAndDescription failure: "+_context105.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage)),_context105.next=21,this.errorHelperService.getErrorInfo(_context105.t0,"ownerUpdateRoomNameAndDescription");case 21:throw errorInfo=_context105.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 23:case"end":return _context105.stop()}}),_callee104,this,[[0,16]])})))}},{key:"ownerUpdateAutoRegister",value:function(roomData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee105(){var url,headers,body,response,room,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context106){for(;;)switch(_context106.prev=_context106.next){case 0:return _context106.prev=0,this.logger.info("[roomService] ownerUpdateAutoRegister"),url="".concat(this.portalURL,"rooms/").concat(roomData.dbId),headers=this.authService.getPostHeader(),body=JSON.stringify({autoRegister:roomData.getAutoRegister()}),_context106.next=7,fetch(url,{method:"PUT",headers:headers,body:body});case 7:if((response=_context106.sent).ok){_context106.next=10;break}throw response;case 10:return _context106.next=12,response.json();case 12:return room=_context106.sent.data,_context106.abrupt("return",(this.rooms[room.id].setAutoRegister(room.autoRegister),this.rooms[room.id].desc=room.topic,this.rooms[room.id].type="private"===room.visibility?room_model_1.Room.Type.PRIVATE:room_model_1.Room.Type.PUBLIC,(room.conference||room.confEndpoints)&&(this.rooms[room.id].conference=room.conference?room.conference:null,this.rooms[room.id].confEndpoints=room.confEndpoints?room.confEndpoints:[]),this.logger.info("[roomService] ownerUpdateAutoRegister successfully ("+room.id+", "+room.jid+")"),this.rooms[room.id]));case 16:if(_context106.prev=16,_context106.t0=_context106.catch(0),!_context106.t0.data||!_context106.t0.data.errorDetails){_context106.next=21;break}throw errorMessage="ownerUpdateAutoRegister failure: "+_context106.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 21:return _context106.next=23,this.errorHelperService.getErrorInfo(_context106.t0,"ownerUpdateAutoRegister");case 23:throw errorInfo=_context106.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 25:case"end":return _context106.stop()}}),_callee105,this,[[0,16]])})))}},{key:"moderatorUpdateRoomConfig",value:function(roomData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee106(){var url,headers,body,response,room,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context107){for(;;)switch(_context107.prev=_context107.next){case 0:return _context107.prev=0,this.logger.info("[roomService] moderatorUpdateRoomConfig"),url="".concat(this.portalURL,"rooms/").concat(roomData.dbId),headers=this.authService.getPostHeader(),body=JSON.stringify({muteUponEntry:roomData.getMuteUponEntry(),disableTimeStats:roomData.getDisableTimeStats()}),_context107.next=7,fetch(url,{method:"PUT",headers:headers,body:body});case 7:if((response=_context107.sent).ok){_context107.next=10;break}throw response;case 10:return _context107.next=12,response.json();case 12:return room=_context107.sent.data,_context107.abrupt("return",((room.conference||room.confEndpoints)&&(this.rooms[room.id].conference=room.conference?room.conference:null,this.rooms[room.id].confEndpoints=room.confEndpoints?room.confEndpoints:[]),this.logger.info("[roomService] moderatorUpdateRoomConfig successfully ("+room.id+", "+room.jid+")"),this.rooms[room.id]));case 16:if(_context107.prev=16,_context107.t0=_context107.catch(0),!_context107.t0.data||!_context107.t0.data.errorDetails){_context107.next=21;break}throw errorMessage="moderatorUpdateRoomConfig failure: "+_context107.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 21:return _context107.next=23,this.errorHelperService.getErrorInfo(_context107.t0,"ownerUpdateAutoRegister");case 23:throw errorInfo=_context107.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 25:case"end":return _context107.stop()}}),_callee106,this,[[0,16]])})))}},{key:"updateMyRoomUser",value:function(room,status){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee107(){var url,headers,body,response,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context108){for(;;)switch(_context108.prev=_context108.next){case 0:return _context108.prev=0,url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/users/").concat(contact_service_1.default.userContact.dbId),headers=this.authService.getPostHeader(),body=JSON.stringify({status:status}),_context108.next=6,fetch(url,{method:"PUT",headers:headers,body:body});case 6:if((response=_context108.sent).ok){_context108.next=9;break}throw response;case 9:return _context108.abrupt("return",(this.logger.info("[roomService] updateMyRoomUser "+contact_service_1.default.userContact.nameForLogs+" to room "+room.dbId+"("+room.getNameForLogs()+") success"),room));case 12:if(_context108.prev=12,_context108.t0=_context108.catch(0),!_context108.t0.data||!_context108.t0.data.errorDetails){_context108.next=17;break}throw errorMessage="updateMyRoomUser "+contact_service_1.default.userContact.nameForLogs+" to room "+room.dbId+"("+room.getNameForLogs()+") failure: "+_context108.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 17:return _context108.next=19,this.errorHelperService.getErrorInfo(_context108.t0,"ownerUpdateAutoRegister");case 19:throw errorInfo=_context108.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 21:case"end":return _context108.stop()}}),_callee107,this,[[0,12]])})))}},{key:"unsubscribeMeFromRoom",value:function(room){return this.updateMyRoomUser(room,this.RoomUserStatus.UNSUBSCRIBED)}},{key:"participantCloseRoom",value:function(room){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee108(){var userId,url,headers,response,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context109){for(;;)switch(_context109.prev=_context109.next){case 0:return userId=contact_service_1.default.userContact.dbId,_context109.prev=1,this.logger.info("[roomService] participantCloseRoom"),url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/users/").concat(userId),headers=this.authService.getRequestHeader(),_context109.next=7,fetch(url,{method:"DELETE",headers:headers});case 7:if((response=_context109.sent).ok){_context109.next=10;break}throw response;case 10:return _context109.abrupt("return",(this.logger.info("[roomService] participantCloseRoom "+userId+" from room "+room.dbId+"("+room.getNameForLogs()+") success"),delete this.rooms[room.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),room));case 13:if(_context109.prev=13,_context109.t0=_context109.catch(1),!_context109.t0.data||!_context109.t0.data.errorDetails){_context109.next=18;break}throw errorMessage="participantCloseRoom "+userId+" from room "+room.dbId+"("+room.getNameForLogs()+") failure: "+_context109.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 18:return _context109.next=20,this.errorHelperService.getErrorInfo(_context109.t0,"participantCloseRoom");case 20:throw errorInfo=_context109.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 22:case"end":return _context109.stop()}}),_callee108,this,[[1,13]])})))}},{key:"acceptRoomInvitation",value:function(room){return this.updateMyRoomUser(room,this.RoomUserStatus.ACCEPTED)}},{key:"declineRoomInvitation",value:function(room){return this.updateMyRoomUser(room,this.RoomUserStatus.REJECTED)}},{key:"getRoomConferenceEndPoint",value:function(room,conferenceEndPointId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee109(){var url,headers,response,conferenceData,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context110){for(;;)switch(_context110.prev=_context110.next){case 0:return _context110.prev=0,this.logger.info("[roomService] getRoomConferenceEndPoint"),url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/conference/").concat(conferenceEndPointId),headers=this.authService.getRequestHeader(),_context110.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((response=_context110.sent).ok){_context110.next=9;break}throw response;case 9:return _context110.next=11,response.json();case 11:return conferenceData=_context110.sent.data,_context110.abrupt("return",(this.logger.info("[roomService] getRoomConferenceEndPoint "+conferenceEndPointId+" from room "+room.dbId+"success"),conferenceData));case 15:if(_context110.prev=15,_context110.t0=_context110.catch(0),!_context110.t0.data||!_context110.t0.data.errorDetails){_context110.next=20;break}throw errorMessage="getRoomConferenceEndPoint "+conferenceEndPointId+" from room "+room.dbId+"failure: "+_context110.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 20:return _context110.next=22,this.errorHelperService.getErrorInfo(_context110.t0,"getRoomConferenceEndPoint");case 22:throw errorInfo=_context110.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 24:case"end":return _context110.stop()}}),_callee109,this,[[0,15]])})))}},{key:"addRoomConferenceEndPoint",value:function(room,conferenceEndPoint,mediaType,createConversation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee110(){var alreadyAttached,deleteConfEndpointPromises,url,headers,body,response,conferenceData,errorInfo;return regenerator_default.a.wrap((function(_context111){for(;;)switch(_context111.prev=_context111.next){case 0:if(_context111.prev=0,this.logger.info("[roomService] addRoomConferenceEndPoint"),conferenceEndPoint){_context111.next=3;break}throw new Error("No ConferenceEndPoint to associate with Room");case 3:if(alreadyAttached=!1,room.confEndpoints.forEach((function(endpoint){endpoint.confEndpointId===conferenceEndPoint.id&&(alreadyAttached=!0)})),!alreadyAttached){_context111.next=6;break}return _context111.abrupt("return",(this.logger.info("[roomService] addRoomConferenceEndPoint : already attached to room !"),room));case 6:return deleteConfEndpointPromises=[],mediaType&&"pstnAudio"===mediaType&&Object.keys(this.rooms).forEach((function(key){this.rooms[key].conference&&!this.rooms[key].conference.scheduled&&this.rooms[key].getPstnConfEndpointId()===conferenceEndPoint.id&&deleteConfEndpointPromises.push(this.deleteRoomConferenceEndPoint(this.rooms[key],conferenceEndPoint.id))})),_context111.next=10,Promise.all(deleteConfEndpointPromises);case 10:return url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/conferences"),headers=this.authService.getPostHeader(),body=JSON.stringify({confId:conferenceEndPoint.id,createConversation:createConversation||"true"}),_context111.next=15,fetch(url,{method:"POST",headers:headers,body:body});case 15:if((response=_context111.sent).ok){_context111.next=18;break}throw response;case 18:return _context111.next=20,response.json();case 20:return conferenceData=_context111.sent.data,_context111.abrupt("return",(this.logger.debug("[roomService] addRoomConferenceEndPoint response data:"+JSON.stringify(conferenceData)),room.confEndpoints.push(conferenceData),this.logger.info("[roomService] addRoomConferenceEndPoint "+conferenceEndPoint.id+" to room "+room.dbId+"success"),this.eventService.publish(this.ROOM_ADD_CONF_ENDPOINT_EVENT,room),this.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",room),room));case 24:return _context111.prev=24,_context111.t0=_context111.catch(0),_context111.next=28,this.errorHelperService.getErrorInfo(_context111.t0,"addRoomConferenceEndPoint");case 28:throw errorInfo=_context111.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 30:case"end":return _context111.stop()}}),_callee110,this,[[0,24]])})))}},{key:"deleteRoomConferenceEndPoint",value:function(room,conferenceEndPointId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee111(){var roomHasConfEndpoint,i,url,headers,response,errorData,errorMessage;return regenerator_default.a.wrap((function(_context112){for(;;)switch(_context112.prev=_context112.next){case 0:if(_context112.prev=0,this.logger.info("[roomService] deleteRoomConferenceEndPoint"),room&&conferenceEndPointId){_context112.next=3;break}return _context112.abrupt("return",void this.logger.info("[roomService] deleteRoomConferenceEndPoint : missing parameters "));case 3:if(roomHasConfEndpoint=!1,!room.confEndpoints||!room.confEndpoints.length){_context112.next=13;break}i=0;case 6:if(!(i<room.confEndpoints.length)){_context112.next=13;break}if(room.confEndpoints[i].confEndpointId!==conferenceEndPointId){_context112.next=10;break}return roomHasConfEndpoint=!0,_context112.abrupt("break",13);case 10:i++,_context112.next=6;break;case 13:if(roomHasConfEndpoint){_context112.next=15;break}return _context112.abrupt("return",void this.logger.info("[roomService] deleteRoomConferenceEndPoint : room has no such conference attached"));case 15:return url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/conferences/").concat(conferenceEndPointId),headers=this.authService.getRequestHeader(),_context112.next=19,fetch(url,{method:"DELETE",headers:headers});case 19:if((response=_context112.sent).ok){_context112.next=22;break}throw response;case 22:return _context112.next=24,response.json();case 24:room.confEndpoints=_context112.sent.data,this.logger.info("[roomService] deleteRoomConferenceEndPoint "+conferenceEndPointId+" from room "+room.dbId+"success"),this.eventService.publish(this.ROOM_REMOVE_CONF_ENDPOINT_EVENT,room),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",room),_context112.next=39;break;case 30:return _context112.prev=30,_context112.t0=_context112.catch(0),_context112.next=34,_context112.t0.json();case 34:if(errorData=_context112.sent.data,errorMessage="deleteRoomConferenceEndPoint "+conferenceEndPointId+" from room "+room.dbId+"failure: "+errorData.errorDetails,this.logger.error("[roomService] "+errorMessage),404===_context112.t0.status){_context112.next=38;break}throw new Error(errorMessage);case 38:room.confEndpoints=[],this.eventService.publish(this.ROOM_REMOVE_CONF_ENDPOINT_EVENT,room),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",room);case 39:case"end":return _context112.stop()}}),_callee111,this,[[0,30]])})))}},{key:"inviteGuestEmailToJoinRoom",value:function(room,emails){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee112(){var url,headers,body,response,errorInfo;return regenerator_default.a.wrap((function(_context113){for(;;)switch(_context113.prev=_context113.next){case 0:if(_context113.prev=0,emails&&emails.length){_context113.next=3;break}return _context113.abrupt("return",null);case 3:return this.logger.info("[roomService] inviteGuestEmailToJoinRoom"),url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/invitations"),headers=this.authService.getPostHeader(),body=JSON.stringify({scenario:"chat",emails:emails,lang:contact_service_1.default.userContact.language}),_context113.next=9,fetch(url,{method:"POST",headers:headers,body:body});case 9:if((response=_context113.sent).ok){_context113.next=12;break}throw response;case 12:return _context113.next=14,response.json();case 14:return room.guestEmails=_context113.sent.data.guestEmails,this.eventService.publish("ROOM_UPDATE_EVENT",room),_context113.abrupt("return",room);case 19:return _context113.prev=19,_context113.t0=_context113.catch(0),_context113.next=23,this.errorHelperService.getErrorInfo(_context113.t0,"inviteGuestEmailToJoinRoom");case 23:throw errorInfo=_context113.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 25:case"end":return _context113.stop()}}),_callee112,this,[[0,19]])})))}},{key:"ownerCancelGuestFromRoom",value:function(room,emails){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee113(){var data,url,headers,body,response,errorInfo;return regenerator_default.a.wrap((function(_context114){for(;;)switch(_context114.prev=_context114.next){case 0:if(_context114.prev=0,this.logger.info("[roomService] ownerCancelGuestFromRoom"),emails&&emails.length){_context114.next=3;break}return _context114.abrupt("return",Promise.resolve(room));case 3:return data={emails:emails,scenario:"chat",lang:contact_service_1.default.userContact.language},room&&room.isMyPersonalMeetingRoom()&&room.getPstnConfEndpointId()&&(data.scenario="pstn-conference",data.confId=room.getPstnConfEndpointId()),url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/invitations/cancel"),headers=this.authService.getPostHeader(),body=JSON.stringify(data),_context114.next=10,fetch(url,{method:"POST",headers:headers,body:body});case 10:if((response=_context114.sent).ok){_context114.next=13;break}throw response;case 13:return _context114.next=15,response.json();case 15:return room.guestEmails=_context114.sent.guestEmails,this.eventService.publish("ROOM_UPDATE_EVENT",room),_context114.abrupt("return",room);case 20:return _context114.prev=20,_context114.t0=_context114.catch(0),_context114.next=24,this.errorHelperService.getErrorInfo(_context114.t0,"ownerCancelGuestFromRoom");case 24:throw errorInfo=_context114.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 26:case"end":return _context114.stop()}}),_callee113,this,[[0,20]])})))}},{key:"notifyRoomUsersJoinConference",value:function(room,users,emails){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee114(){var conferenceEndPointId,instantMessage,data,url,headers,body,response,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context115){for(;;)switch(_context115.prev=_context115.next){case 0:if(conferenceEndPointId=room.getPstnConfEndpointId(),_context115.prev=1,this.logger.info("[roomService] notifyRoomUsersJoinConference"),conferenceEndPointId){_context115.next=4;break}return _context115.abrupt("return",room);case 4:return instantMessage=room.desc,data={scenario:"pstn-conference",confId:conferenceEndPointId,noMail:"false",update:"false",users:users?users.map((function(user){return user.dbId})):void 0,emails:emails,instantMessage:instantMessage,lang:contact_service_1.default.userContact.language},url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/invitations"),headers=this.authService.getPostHeader(),body=JSON.stringify(data),_context115.next=11,fetch(url,{method:"POST",headers:headers,body:body});case 11:if((response=_context115.sent).ok){_context115.next=14;break}throw response;case 14:return _context115.abrupt("return",(this.logger.info("[roomService] notifyRoomUsersJoinConference "+conferenceEndPointId+" from room "+room.dbId+"success"),this.rooms[room.dbId].guestEmails=emails,this.eventService.publish("ROOM_UPDATE_EVENT",this.rooms[room.dbId]),this.rooms[room.dbId]));case 17:if(_context115.prev=17,_context115.t0=_context115.catch(1),!_context115.t0.data||!_context115.t0.data.errorDetails){_context115.next=22;break}throw errorMessage="notifyRoomUsersJoinConference "+conferenceEndPointId+" from room "+room.dbId+"failure: "+_context115.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 22:return _context115.next=24,this.errorHelperService.getErrorInfo(_context115.t0,"notifyRoomUsersJoinConference");case 24:throw errorInfo=_context115.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 26:case"end":return _context115.stop()}}),_callee114,this,[[1,17]])})))}},{key:"notifyUsersCancelConference",value:function(room,users,emails){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee115(){var conferenceEndPointId,data,url,headers,body,response,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context116){for(;;)switch(_context116.prev=_context116.next){case 0:if(conferenceEndPointId=room.getPstnConfEndpointId(),_context116.prev=1,this.logger.debug("[roomService] notifyUsersCancelConference"),conferenceEndPointId){_context116.next=4;break}return _context116.abrupt("return",room);case 4:return data={scenario:"pstn-conference",confId:conferenceEndPointId,noMail:"false",users:users?users.map((function(user){return user.dbId})):void 0,emails:emails,lang:contact_service_1.default.userContact.language},url="".concat(this.portalURL,"rooms/").concat(room.dbId,"/invitations"),headers=this.authService.getPostHeader(),body=JSON.stringify(data),_context116.next=10,fetch(url,{method:"DELETE",headers:headers,body:body});case 10:if((response=_context116.sent).ok){_context116.next=13;break}throw response;case 13:return _context116.abrupt("return",(this.logger.info("[roomService] notifyUsersCancelConference "+conferenceEndPointId+" from room "+room.dbId+"success"),this.rooms[room.dbId].guestEmails=this.rooms[room.dbId].guestEmails.filter((function(email){return-1===emails.indexOf(email)})),this.eventService.publish("ROOM_UPDATE_EVENT",this.rooms[room.dbId]),this.rooms[room.dbId]));case 16:if(_context116.prev=16,_context116.t0=_context116.catch(1),!_context116.t0.data||!_context116.t0.data.errorDetails){_context116.next=21;break}throw errorMessage="notifyUsersCancelConference "+conferenceEndPointId+" from room "+room.dbId+"failure: "+_context116.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 21:return _context116.next=23,this.errorHelperService.getErrorInfo(_context116.t0,"notifyUsersCancelConference");case 23:throw errorInfo=_context116.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 25:case"end":return _context116.stop()}}),_callee115,this,[[1,16]])})))}},{key:"getRoomByConferenceEndpointId",value:function(conferenceEndpointId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee116(){var url,headers,response,roomData,errorMessage,errorInfo;return regenerator_default.a.wrap((function(_context117){for(;;)switch(_context117.prev=_context117.next){case 0:return _context117.prev=0,this.logger.info("[roomService] getRoomFromConferenceEndpointId"),url="".concat(this.portalURL,"rooms?userId=").concat(contact_service_1.default.userContact.dbId,"&confId=").concat(conferenceEndpointId,"&format=full"),headers=this.authService.getRequestHeader(),_context117.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((response=_context117.sent).ok){_context117.next=9;break}throw response;case 9:return this.logger.info("[roomService] getRoomFromConferenceEndpointId -- "+conferenceEndpointId+" -- success"),_context117.next=12,response.json();case 12:if(!(roomData=_context117.sent.data).length){_context117.next=15;break}return _context117.abrupt("return",(this.getRoomById(roomData[0].id)||this.createRoomFromData(roomData[0]),this.getRoomById(roomData[0].id)));case 15:throw this.logger.info("[roomService] getRoomFromConferenceEndpointId -- no room with confId "+conferenceEndpointId),new Error("no room with confId "+conferenceEndpointId);case 18:if(_context117.prev=18,_context117.t0=_context117.catch(0),!_context117.t0.data||!_context117.t0.data.errorDetails){_context117.next=23;break}throw errorMessage="getRoomFromConferenceEndpointId -- "+conferenceEndpointId+" -- failure: "+_context117.t0.data.errorDetails,this.logger.error("[roomService] "+errorMessage),new Error(errorMessage);case 23:return _context117.next=25,this.errorHelperService.getErrorInfo(_context117.t0,"getRoomByConferenceEndpointId");case 25:throw errorInfo=_context117.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 27:case"end":return _context117.stop()}}),_callee116,this,[[0,18]])})))}},{key:"onRoomMessage",value:function(stanza){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee117(){var eventElem,eventName,roomId,room;return regenerator_default.a.wrap((function(_context118){for(;;)switch(_context118.prev=_context118.next){case 0:if(this.logger.info("[roomService] onRoomMessage"),_context118.prev=1,!((eventElem=$(stanza).find("event")).length>0)){_context118.next=7;break}if("conferenceAdd"!==(eventName=eventElem.attr("name"))&&"conferenceRemove"!==eventName&&"invitation"!==eventName){_context118.next=7;break}return _context118.abrupt("return",!0);case 7:return roomId=$(stanza).find("x").attr("thread"),_context118.next=10,this.getServerRoom(roomId);case 10:return room=_context118.sent,_context118.abrupt("return",(room.isMeetingRoom()&&this.eventService.publish("MEETING_CREATED_EVENT",room),this.computeInvitationCounter(),this.eventService.publish(this.ROOM_INVITATION,room),this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),!0));case 14:return _context118.prev=14,_context118.t0=_context118.catch(1),_context118.abrupt("return",(this.logger.error("[roomService] onRoomMessage error "+_context118.t0),!0));case 17:case"end":return _context118.stop()}}),_callee117,this,[[1,14]])})))}},{key:"onRoomNotificationMessage",value:function(stanza){var _this95=this;try{var stanzaElem=$(stanza),xElem=stanzaElem.find("x");if(stanzaElem.find("event").length&&xElem.length){var eventName=stanzaElem.find("event").attr("name");if(!eventName||"invitation"!==eventName)return!0;var roomId=$(xElem[0]).attr("roomid");if(!roomId)return this.logger.info("[roomService] onRoomNotificationMessage error -- missing roomId"),!0;this.logger.info("[roomService] onRoomNotificationMessage : room event message with roomId "+roomId+" and event name "+eventName),this.getServerRoom(roomId).then((function(room){room.isMeetingRoom()&&_this95.eventService.publish("MEETING_CREATED_EVENT",room),room.isWebinarRoom()&&(room.webinarId=stanzaElem.find("x[webinarid]").attr("webinarid")),"true"===_this95.settingsService.getSetting("autoAcceptRoomInvite")?_this95.acceptRoomInvitation(room):(_this95.computeInvitationCounter(),_this95.eventService.publish(_this95.ROOM_INVITATION,room),_this95.eventService.publish(_this95.ROOM_UPDATE_EVENT,room),_this95.sendEvent(_this95.ROOM_UPDATE_EVENT,room),"accepted"===room.status&&room.confEndpoints&&room.confEndpoints.length&&"webrtc"===room.confEndpoints[0].mediaType&&_this95.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",room),_this95.logger.info("[roomService] onRoomNotificationMessage -- get server room success for roomId "+room.dbId+" and roomJid"+room.jid+" and name "+room.getNameForLogs()))})).catch((function(error){_this95.logger.error("[roomService] onRoomNotificationMessage failure :  impossible to get associated room : "+error.message)}))}return!0}catch(error){return this.logger.error("[roomService] onRoomNotificationMessage error "+error),!0}}},{key:"onRoomInfoMessage",value:function(stanza){var _this96=this;this.logger.info("[roomService] onRoomInfoMessage");try{if($(stanza).find("event").length>0){this.logger.info("[roomService] onRoomInfoMessage : room event message");var fromJid=$(stanza).attr("from"),roomBareJid=this.xmppService.getBareJidFromJid(fromJid),userJid=$(stanza).find("event").attr("jid"),eventName=$(stanza).find("event").attr("name"),msgId=$(stanza).attr("id");if(this.logger.info("[roomService] onRoomInfoMessage : room event message with parameters "+roomBareJid+" || "+userJid+" || "+eventName+" || "+msgId),roomBareJid&&userJid&&eventName&&msgId){var room=this.getRoomByJid(roomBareJid);if(!room)return this.manageEventForNonExistingRoom(roomBareJid,eventName,userJid),!0;var user=room.getUserByJid(userJid);switch(user&&"deleted"!==user.status&&this.eventService.publish(this.ROOM_ADMIN_MESSAGE_EVENT,roomBareJid,userJid,eventName,msgId),eventName){case"conferenceAdd":setTimeout((function(){_this96.getServerRoom(room.dbId).then((function(updatedRoom){var info=updatedRoom.confEndpoints&&updatedRoom.confEndpoints[0]?updatedRoom.confEndpoints[0].confEndpointId:void 0;updatedRoom.getPstnConfEndpointId()&&updatedRoom.isMeetingRoom()&&(_this96.currentPersonalAudioRoomId=room.dbId),(updatedRoom.isMeetingRoom()||contact_service_1.default.userContact.webrtcAudioEnabled)&&(_this96.logger.info("[roomService] onRoomInfoMessage : conferenceAdd event with conferenceObject related to room : "+info),_this96.eventService.publish("ROOM_UPDATE_CONFID",updatedRoom),_this96.eventService.publish("ROOM_ADD_CONF_ENDPOINT_EVENT",updatedRoom),_this96.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",updatedRoom),updatedRoom.rxSubject.next(event_model_1.RBEvent.create("ROOM_ADD_CONF_ENDPOINT_EVENT")),_this96.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",updatedRoom,user))}))}),1e3);break;case"conferenceRemove":this.getServerRoom(room.dbId).then((function(updatedRoom){room.getPstnConfEndpointId()&&!updatedRoom.getPstnConfEndpointId()&&(_this96.currentPersonalAudioRoomId=""),_this96.logger.info("[roomService] onRoomInfoMessage : conferenceRemove event"),_this96.eventService.publish("ROOM_REMOVE_CONF_ENDPOINT_EVENT",updatedRoom),_this96.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",updatedRoom),updatedRoom.rxSubject.next(event_model_1.RBEvent.create("ROOM_REMOVE_CONF_ENDPOINT_EVENT")),_this96.eventService.publish("ON_CONFERENCE_ENDED_INVITATION",updatedRoom)}));break;case"invitation":!room.isUserModerator(contact_service_1.default.userContact)||user&&user.status!==this.RoomUserStatus.DELETED||this.getServerRoom(room.dbId).then((function(updatedRoom){_this96.eventService.publish(_this96.ROOM_UPDATE_EVENT,updatedRoom),_this96.sendEvent(_this96.ROOM_UPDATE_EVENT,room)}))}}}else if($(stanza).find("subject").length>0){var _fromJid=$(stanza).attr("from"),fromBareJid=this.xmppService.getBareJidFromJid(_fromJid),_room=this.getRoomByJid(fromBareJid),topic=$(stanza).find("subject").text();_room&&topic&&(this.logger.info("[roomService] onRoomInfoMessage : update subject of room"),_room.desc=topic,this.eventService.publish(this.ROOM_UPDATE_EVENT,_room),this.sendEvent(this.ROOM_UPDATE_EVENT,_room))}return!0}catch(error){return this.logger.error("[roomService] onRoomInfoMessage error "+error),!0}}},{key:"onRoomHistoryInfoMessage",value:function(stanza){var changedElem=$(stanza).find("changed");if(changedElem.length>0){var roomId=changedElem.attr("with"),room=this.getRoomByJid(roomId);this.logger.debug("[roomService] onRoomHistoryInfoMessage with "+roomId),this.eventService.publish(this.ROOM_HISTORY_UPDATE_EVENT,room)}return!0}},{key:"onRoomMessageConfig",value:function(stanza){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee118(){var stanzaElem,roomElem,userId,userStatus,delayElem,roomId,logMessage,room,serverUpdateMandatory,topic,name,guestsElem,customData,extractedContent,avatarElem,lastAvatarUpdateDate,avatarType,user,privilege,_user,message,tagsElem,action,tagList,newRoom,openinviteElem,openInviteAction,_roomId,openInviteId,roomType,shouldDeletePreviousPersonalAudioRoomAssociation,meetingElem,meetingAction,_roomId2,roomscontainerElem,containerId,containerName,addedRooms,addedElem,removedRooms,removedElem,_addedRooms,_addedElem,rooms,_this97=this;return regenerator_default.a.wrap((function(_context119){for(;;)switch(_context119.prev=_context119.next){case 0:if(_context119.prev=0,stanzaElem=$(stanza),roomElem=stanzaElem.find("room"),userId=roomElem.attr("userjid"),userStatus=roomElem.attr("status"),!((delayElem=stanzaElem.find("delay")).length>0&&"Offline Storage"===delayElem.text())){_context119.next=4;break}return _context119.abrupt("return",!0);case 4:if(!(roomElem.length>0)){_context119.next=45;break}if(roomId=roomElem.attr("roomid"),logMessage="[roomService] onRoomMessageConfig -- management -- ".concat(roomId," --"),room=this.getRoomById(roomId),serverUpdateMandatory=!1,!room){_context119.next=36;break}if(topic=roomElem.attr("topic"),((name=roomElem.attr("name"))||topic)&&(this.logger.info(logMessage+" update name or topic"),room.name=name,room.desc=topic||""),(guestsElem=roomElem.find("guests")).length>0&&"update"===guestsElem.attr("action")&&(this.logger.info(logMessage+" update guests"),room.guestEmails=[],$(guestsElem).find("email").each((function(__index,emailElem){room.guestEmails.push(emailElem.textContent)}))),customData=roomElem.attr("customData"))try{extractedContent=this.extractHtmlContent(customData),room.customData=JSON.parse(extractedContent),this.logger.info(logMessage+" handle customData")}catch(err){this.logger.error("".concat(logMessage," handle customData -- FAILURE -- ").concat(err.message)),room.customData="{}"}if(avatarElem=stanzaElem.find("avatar"),lastAvatarUpdateDate=roomElem.attr("lastAvatarUpdateDate"),avatarType=avatarElem.length>0&&"delete"===avatarElem.attr("action")?"delete":"update",room&&(lastAvatarUpdateDate||"delete"===avatarType)&&(this.logger.info(logMessage+" update avatar"),serverUpdateMandatory=!0),userStatus&&(this.logger.info(logMessage+" update user status"),(user=room.getUserByJid(userId))?this.updateUserStatus(room,user,userStatus):(this.logger.info(logMessage+" update user status -- room exists, but user not. Update the room"),serverUpdateMandatory=!0)),!(privilege=roomElem.attr("privilege"))){_context119.next=25;break}if(this.logger.info("".concat(logMessage," update user's privilege ").concat(privilege)),_user=userId?room.getUserByJid(userId):null,serverUpdateMandatory=!0,"owner"===privilege&&_user&&_user.contact&&_user.contact.jid===contact_service_1.default.userContact.jid&&(room.ownerContact=_user.contact,room.owner=!0,message=this.i18n.translate("promotedToOwner",{name:escape(room.name)}),this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",message)),_context119.t0=_user&&_user.contact,!_context119.t0){_context119.next=25;break}return _context119.next=25,contact_service_1.default.getContactByDBId(_user.contact.dbId,!0);case 25:if((tagsElem=roomElem.find("tags"))&&tagsElem.length&&(this.logger.info(logMessage+" update room tags"),action=tagsElem.attr("action"),this.logger.info("".concat(logMessage," action = ").concat(action)),tagList=tagsElem.find("tag"),"update"===action&&(room.tags=[],tagList&&tagList.length&&tagList.each((function(__index,tagElem){var value=tagElem.getAttribute("value"),color=tagElem.getAttribute("color"),emoji=tagElem.getAttribute("emoji"),tagData={};value&&(tagData.tag=value),color&&(tagData.color=color),emoji&&(tagData.emoji=emoji),room.tags.push(tagData)})))),_context119.t1=serverUpdateMandatory,!_context119.t1){_context119.next=31;break}return _context119.next=31,this.updateRoomFromServer(room);case 31:this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),room.rxSubject.next(),_context119.next=45;break;case 36:if(void 0!==room||!roomId||this.roomsInProgress[roomId]||"deleted"===userStatus||"rejected"===userStatus){_context119.next=44;break}return this.logger.info(logMessage+" room does not exist, create new one"),this.roomsInProgress[roomId]=!0,_context119.next=40,this.getServerRoom(roomId);case 40:newRoom=_context119.sent,delete this.roomsInProgress[roomId],this.logger.info(logMessage+" sendInitialRoomPresence to the new room"),this.sendInitialRoomPresence(newRoom),this.updateLater[roomId]&&(delete this.updateLater[roomId],this.logger.info("[roomService] onRoomMessageConfig -- later update of the new room"),this.getServerRoom(roomId).then((function(roomToUpdate){roomToUpdate.updateAvatarInfo()}))),_context119.next=45;break;case 44:this.roomsInProgress[roomId]&&(this.updateLater[roomId]=roomId);case 45:if(!((openinviteElem=stanzaElem.find("openinvite")).length>0)){_context119.next=59;break}this.logger.info("[roomService] onRoomMessageConfig -- openinvite"),openInviteAction=openinviteElem.attr("action"),_roomId=openinviteElem.find("roomid").text(),openInviteId=openinviteElem.find("openinviteid").text(),roomType=openinviteElem.find("roomType").text(),_context119.t2=openInviteAction,_context119.next="update"===_context119.t2?52:"create"===_context119.t2?54:"delete"===_context119.t2?56:58;break;case 52:shouldDeletePreviousPersonalAudioRoomAssociation=!1,"personal_audio_room"!==roomType||_roomId||(shouldDeletePreviousPersonalAudioRoomAssociation=!0),Object.keys(this.openInviteIdByRoomId).forEach((function(key){this.openInviteIdByRoomId[key]&&this.openInviteIdByRoomId[key].openInviteId===openInviteId&&key!==_roomId&&(this.logger.info("[roomService] onRoomMessageConfig -- openinviteId removed from "+key),delete this.openInviteIdByRoomId[key],this.openInviteIdByRoomIdSubject.next({openInviteId:openInviteId,roomType:roomType,id:_roomId,action:"deleted"})),shouldDeletePreviousPersonalAudioRoomAssociation&&"personal_audio_room"===this.openInviteIdByRoomId[key].roomType&&delete this.openInviteIdByRoomId[key]}));case 54:return _roomId&&openInviteId&&(this.openInviteIdByRoomId[_roomId]={},this.openInviteIdByRoomId[_roomId].roomType=roomType,this.openInviteIdByRoomId[_roomId].openInviteId=openInviteId,this.openInviteIdByRoomId[_roomId].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+openInviteId,this.openInviteIdByRoomIdSubject.next({openInviteId:openInviteId,roomType:roomType,id:_roomId,action:"updated"}),this.logger.info("[roomService] onRoomMessageConfig -- openinviteId "+openInviteId+" assigned to room "+_roomId),this.eventService.publish("ON_OPEN_INVITE_ID_UPDATED_EVENT",this.rooms[_roomId]),"personal_audio_room"===roomType&&this.eventService.publish("ON_PERSONAL_MEETING_OPEN_INVITE_ID_UPDATED_EVENT")),_context119.abrupt("break",59);case 56:return Object.keys(this.openInviteIdByRoomId).forEach((function(key){this.openInviteIdByRoomId[key]&&this.openInviteIdByRoomId[key].openInviteId===openInviteId&&key===_roomId&&(this.logger.info("[roomService] onRoomMessageConfig -- openinviteId removed from "+key),delete this.openInviteIdByRoomId[key],this.openInviteIdByRoomIdSubject.next({openInviteId:openInviteId,roomType:roomType,id:_roomId,action:"deleted"}),this.eventService.publish("ON_OPEN_INVITE_ID_DELETED_EVENT",this.rooms[_roomId]))})),_context119.abrupt("break",59);case 58:this.logger.info("[roomService] onRoomMessageConfig -- openinviteId - unkown action : "+openInviteAction);case 59:if(meetingElem=stanzaElem.find("meeting"),!("management"===stanzaElem.attr("type")&&meetingElem.length>0)){_context119.next=73;break}this.logger.debug("[roomService] onRoomMessageConfig -- management meeting event"),meetingAction=meetingElem.attr("action"),_roomId2=meetingElem.find("roomid").length?meetingElem.find("roomid").text():"",_context119.t3=meetingAction,_context119.next="saved"===_context119.t3?66:"deleted"===_context119.t3?68:"created"===_context119.t3?70:"updated"===_context119.t3?72:73;break;case 66:return this.currentPersonalAudioRoomId="",this.logger.debug("meeting saved: "+_roomId2),this.sendEvent("ON_MEETING_SAVED_EVENT",_roomId2),_context119.abrupt("break",73);case 68:return this.logger.debug("meeting deleted: "+_roomId2),this.currentPersonalAudioRoomId="",this.sendEvent("ON_MEETING_DELETED_EVENT",_roomId2),_context119.abrupt("break",73);case 70:return this.logger.debug("meeting created: "+_roomId2),this.personalAudioRoomId=_roomId2,this.currentPersonalAudioRoomId=_roomId2,this.sendEvent("ON_MEETING_CREATED_EVENT",_roomId2),_context119.abrupt("break",73);case 72:this.logger.debug("meeting updated: "+_roomId2),this.personalAudioRoomId=_roomId2,this.currentPersonalAudioRoomId=_roomId2,this.sendEvent("ON_MEETING_UPDATED_EVENT",_roomId2);case 73:if(roomscontainerElem=stanzaElem.find("roomscontainer"),!("management"===stanzaElem.attr("type")&&roomscontainerElem.length>0)){_context119.next=90;break}containerId=roomscontainerElem.attr("containerid"),containerName=roomscontainerElem.attr("name"),_context119.t4=roomscontainerElem.attr("action"),_context119.next="update"===_context119.t4?79:"create"===_context119.t4?84:"delete"===_context119.t4?87:90;break;case 79:return addedRooms=[],(addedElem=roomscontainerElem.find("added")).length&&(addedElem.find("roomid").each((function(__index,roomIdElem){addedRooms.push(roomIdElem.textContent)})),addedRooms.forEach((function(roomId){_this97.rooms[roomId]&&(_this97.rooms[roomId].containerId=containerId,_this97.rooms[roomId].containerName=containerName)}))),removedRooms=[],(removedElem=roomscontainerElem.find("removed")).length&&(removedElem.find("roomid").each((function(__index,roomIdElem){removedRooms.push(roomIdElem.textContent)})),removedRooms.forEach((function(roomId){_this97.rooms[roomId]&&(_this97.rooms[roomId].containerId="",_this97.rooms[roomId].containerName="")}))),(addedRooms.length||removedRooms.length)&&this.sendEvent(this.ROOM_UPDATE_EVENT,null),_context119.abrupt("break",90);case 84:return _addedRooms=[],(_addedElem=roomscontainerElem.find("added")).length&&(_addedElem.find("roomid").each((function(__index,roomIdElem){_addedRooms.push(roomIdElem.textContent)})),_addedRooms.forEach((function(roomId){_this97.rooms[roomId]&&(_this97.rooms[roomId].containerId=containerId,_this97.rooms[roomId].containerName=containerName)}))),_addedRooms.length&&this.sendEvent(this.ROOM_UPDATE_EVENT,null),_context119.abrupt("break",90);case 87:return(rooms=this.getRoomsByContainerId(containerId)).forEach((function(room){_this97.rooms[room.dbId].containerId="",_this97.rooms[room.dbId].containerName=""})),rooms.length&&this.sendEvent(this.ROOM_UPDATE_EVENT,null),_context119.abrupt("break",90);case 90:return _context119.abrupt("return",!0);case 93:return _context119.prev=93,_context119.t5=_context119.catch(0),_context119.abrupt("return",(this.logger.info("[roomService] onRoomMessageConfig  -- failure -- "+_context119.t5.message),!0));case 96:case"end":return _context119.stop()}}),_callee118,this,[[0,93]])})))}},{key:"extractHtmlContent",value:function(html){var parser=new DOMParser,content="{}";try{content=parser.parseFromString(html,"text/html").documentElement.textContent}catch(error){this.logger.error("[roomService] error in extractHtmlContent:"+error.message),content="{}"}return content}},{key:"onRoomPresence",value:function(stanza){var _this98=this;try{var stanzaElem=$(stanza),fromJid=stanzaElem.attr("from"),fromRoomBareJid=this.xmppService.getBareJidFromJid(fromJid),fromUserJid=this.xmppService.getResourceFromJid(fromJid),statusElems=stanzaElem.find("status"),statusCode=null;statusElems.each((function(__index,statusElem){"332"===$(statusElem).attr("code")&&(statusCode="332"),"338"===$(statusElem).attr("code")&&(statusCode="338"),"339"===$(statusElem).attr("code")&&(statusCode="339")}));var room=this.getRoomByJid(fromRoomBareJid);return room&&("338"===statusCode?(this.logger.info("[roomService] onRoomPresence - "+room.dbId+"- Deactivated"),room.isActive=!1,this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room)):"339"===statusCode?(this.logger.info("[roomService] onRoomPresence - "+room.dbId+"- Reactivated"),room.initPresenceAck=!1,this.sendInitialRoomPresenceSync(room),room.isActive=!0,this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room)):(this.logger.info("[roomService] onRoomPresence -- "+room.dbId),-1!==fromUserJid.indexOf("/")&&(fromUserJid=this.xmppService.getBareJidFromJid(fromUserJid)),contact_service_1.default.isUserContactJid(fromUserJid)?"332"===statusCode?(this.logger.error("[roomService] disconnected from room "+room.getNameForLogs()+" because of a system shutdown"),room.initPresenceAck=!1,this.sendInitialRoomPresenceSync(room)):(room.initPresenceAck=!0,this.roomPresenceWaitingList&&this.roomPresenceWaitingList.length&&this.roomPresenceWaitingList.forEach((function(waitingListRoom,index){waitingListRoom.dbId===room.dbId&&_this98.roomPresenceWaitingList.splice(index,1)})),room.initPresPromise&&(this.logger.info("[roomService] onRoomPresence - initPresPromise resolved"),room.initPresPromiseResolve(room),room.initPresInterval&&(room.initPresInterval.unsubscribe(),room.initPresInterval=null),room.initPresPromise=null,room.initPresPromiseResolve=null,this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room))):room.dbId&&!this.rooms[room.dbId]&&this.getServerRoom(room.dbId))),!0}catch(error){return this.logger.error("[roomService] onRoomPresence error "+error),!0}}},{key:"updateUserStatus",value:function(room,user,status){var _this99=this;if(this.logger.info("[roomService] "+user.status+" || "+status),contact_service_1.default.isUserContactJid(user.contact.jid)&&user.status!==status)switch(this.logger.info("[roomService] my new status "+status),status){case"deleted":delete this.roomsByJids[room.jid],delete this.rooms[room.dbId],this.logger.info("[roomService] deleteRoom successfully ("+room.dbId+")"),this.sendUnavailableRoomPresence(room),this.computeInvitationCounter(),room.isMeetingRoom()&&this.eventService.publish("MEETING_DELETE_EVENT",room),this.eventService.publish(this.ROOM_UPDATE_EVENT,room,"remove"),this.sendEvent(this.ROOM_UPDATE_EVENT,room);break;case"unsubscribed":this.logger.info("[roomService] unsubscribed successfully ("+room.dbId+")"),this.sendUnavailableRoomPresence(room),room.status=this.RoomUserStatus.UNSUBSCRIBED,user.status=status,room.updateAvatarInfo(),room.isModerator=!1,room.initPresenceAck=!1,this.computeInvitationCounter(),this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room);break;case"accepted":room.status=this.RoomUserStatus.ACCEPTED,user.status=status,this.fileStorageService.retrieveReceivedFilesForRoom(room.dbId).then((function(){_this99.sendInitialRoomPresenceSync(room),room.updateAvatarInfo(),_this99.computeInvitationCounter(),_this99.eventService.publish(_this99.ROOM_UPDATE_EVENT,room),_this99.sendEvent(_this99.ROOM_UPDATE_EVENT,room),_this99.getServerRoom(room.dbId).then((function(updatedRoom){_this99.eventService.publish(_this99.ROOM_UPDATE_EVENT,updatedRoom),_this99.sendEvent(_this99.ROOM_UPDATE_EVENT,updatedRoom),updatedRoom.confEndpoints&&updatedRoom.confEndpoints.length&&"webrtc"===updatedRoom.confEndpoints[0].mediaType&&_this99.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",updatedRoom)})).catch((function(){this.logger.warn("[roomService] getServerRoom "+room.dbId+" failed")}))}));break;case"rejected":delete this.roomsByJids[room.jid],delete this.rooms[room.dbId],room.status=this.RoomUserStatus.REJECTED,user.status=status,this.computeInvitationCounter(),this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room)}else user&&!contact_service_1.default.isUserContactJid(user.contact.jid)&&(this.logger.info("[roomService] Update user with status "+status),user.status===this.RoomUserStatus.DELETED&&status===this.RoomUserStatus.ACCEPTED&&(user.date=new Date,user.privilege===room_model_1.Room.Privilege.MODERATOR&&(user.privilege=room_model_1.Room.Privilege.USER)),user.status=status,room.updateAvatarInfo(),this.refreshMemberAndOrganizerLists(room),this.eventService.publish(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_UPDATE_EVENT,room),this.sendEvent(this.ROOM_USER_UPDATE_EVENT,{room:room,user:user}))}},{key:"findRoomsWithConfId",value:function(confId){return this.getRooms().filter((function(room){return!(!room.confEndpoints||!room.confEndpoints.length)&&room.confEndpoints.some((function(confEndpoint){return confEndpoint.confEndpointId===confId}))}))}},{key:"removeConfIdInAllRooms",value:function(rooms){var _this100=this,actionPromises=[];return rooms.forEach((function(room){room.confEndpoints&&room.confEndpoints.length>0&&actionPromises.push(_this100.deleteRoomConferenceEndPoint(room,room.confEndpoints[0].confEndpointId))})),Promise.all(actionPromises)}},{key:"resetOpenInviteId",value:function(roomId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee119(){var url,headers,body,response,openInviteData;return regenerator_default.a.wrap((function(_context120){for(;;)switch(_context120.prev=_context120.next){case 0:return _context120.prev=0,url="{this.portalURL}users/".concat(contact_service_1.default.userContact.dbId,'"/public-links/reset'),headers=auth_service_1.default.getRequestHeader(),body=JSON.stringify({roomId:roomId}),_context120.next=6,fetch(url,{method:"PUT",headers:headers,body:body});case 6:if((response=_context120.sent).ok){_context120.next=9;break}throw response;case 9:return _context120.next=11,response.json();case 11:return openInviteData=_context120.sent.data,_context120.abrupt("return",(openInviteData&&openInviteData.openInviteId&&openInviteData.roomId&&(this.logger.info("[roomService] resetOpenInviteId success - openinviteId "+openInviteData.openInviteId+" bound to room "+roomId),this.openInviteIdByRoomId[openInviteData.roomId]={},this.openInviteIdByRoomId[openInviteData.roomId].roomType=openInviteData.roomType,this.openInviteIdByRoomId[openInviteData.roomId].openInviteId=openInviteData.openInviteId,this.openInviteIdByRoomId[openInviteData.roomId].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+openInviteData.openInviteId),openInviteData.openInviteId));case 15:throw _context120.prev=15,_context120.t0=_context120.catch(0),"resetOpenInviteId failure",this.logger.error("[contactService] resetOpenInviteId failure"),new Error("resetOpenInviteId failure");case 19:case"end":return _context120.stop()}}),_callee119,this,[[0,15]])})))}},{key:"bindOpenInviteIdToRoom",value:function(room){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee120(){var url,headers,body,response,openInviteData,errorInfo;return regenerator_default.a.wrap((function(_context121){for(;;)switch(_context121.prev=_context121.next){case 0:return _context121.prev=0,url="".concat(this.portalURL,"users/").concat(contact_service_1.default.userContact.dbId,"/public-links/bind"),headers=this.authService.getPostHeader(),body=JSON.stringify({roomId:room.dbId}),_context121.next=6,fetch(url,{method:"POST",headers:headers,body:body});case 6:if((response=_context121.sent).ok){_context121.next=9;break}throw response;case 9:return _context121.next=11,response.json();case 11:if(!((openInviteData=_context121.sent.data)&&openInviteData.roomId&&openInviteData.roomType&&openInviteData.openInviteId)){_context121.next=14;break}return _context121.abrupt("return",(this.logger.info("[roomService] createRoomOpenInviteId -- SUCCESS - room ".concat(openInviteData.roomId," with type ").concat(openInviteData.roomType," bound to openInviteId ").concat(openInviteData.openInviteId)),this.openInviteIdByRoomId[openInviteData.roomId]={},this.openInviteIdByRoomId[openInviteData.roomId].roomType=openInviteData.roomType,this.openInviteIdByRoomId[openInviteData.roomId].openInviteId=openInviteData.openInviteId,this.openInviteIdByRoomId[openInviteData.roomId].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+openInviteData.openInviteId,this.rooms[room.dbId]));case 14:throw new Error("[roomService] No or unvalid openInviteData");case 17:return _context121.prev=17,_context121.t0=_context121.catch(0),_context121.next=21,this.errorHelperService.getErrorInfo(_context121.t0,"bindOpenInviteIdToRoom");case 21:throw errorInfo=_context121.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 23:case"end":return _context121.stop()}}),_callee120,this,[[0,17]])})))}},{key:"unbindOpenInviteFromRoom",value:function(roomId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee121(){var url,headers,body,response,errorInfo;return regenerator_default.a.wrap((function(_context122){for(;;)switch(_context122.prev=_context122.next){case 0:return _context122.prev=0,url="".concat(this.portalURL,"users/").concat(contact_service_1.default.userContact.dbId,"/public-links/unbind"),headers=this.authService.getPostHeader(),body=JSON.stringify({roomId:roomId}),_context122.next=6,fetch(url,{method:"PUT",headers:headers,body:body});case 6:if((response=_context122.sent).ok){_context122.next=9;break}throw response;case 9:return _context122.abrupt("return",void this.logger.info("[roomService] openInvite successfully unbound"));case 12:return _context122.prev=12,_context122.t0=_context122.catch(0),_context122.next=16,this.errorHelperService.getErrorInfo(_context122.t0,"unbindOpenInviteFromRoom");case 16:throw errorInfo=_context122.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 18:case"end":return _context122.stop()}}),_callee121,this,[[0,12]])})))}},{key:"joinRoomUsingOpenInviteId",value:function(openInviteId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee122(){var url,headers,body,response,openInvitesData,errorInfo;return regenerator_default.a.wrap((function(_context123){for(;;)switch(_context123.prev=_context123.next){case 0:return _context123.prev=0,url=config.restServerUrl+"/api/rainbow/enduser/v1.0/rooms/open-invites",headers=this.authService.getPostHeader(),body=JSON.stringify({openInviteId:openInviteId}),_context123.next=6,fetch(url,{method:"POST",headers:headers,body:body});case 6:if((response=_context123.sent).ok){_context123.next=9;break}throw response;case 9:return _context123.next=11,response.json();case 11:if(!(openInvitesData=_context123.sent.data)||!openInvitesData.roomId){_context123.next=14;break}return _context123.abrupt("return",openInvitesData.roomId);case 14:throw new Error("No roomId info in openInvitation");case 17:return _context123.prev=17,_context123.t0=_context123.catch(0),_context123.next=21,this.errorHelperService.getErrorInfo(_context123.t0,"unbindOpenInviteFromRoom");case 21:throw errorInfo=_context123.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 23:case"end":return _context123.stop()}}),_callee122,this,[[0,17]])})))}},{key:"retrieveOpenInviteData",value:function(){var type=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,roomId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee123(){var urlParams,url,headers,response,openInviteData,errorInfo,_this101=this;return regenerator_default.a.wrap((function(_context124){for(;;)switch(_context124.prev=_context124.next){case 0:return this.logger.debug("[roomService] retrieveOpenInviteData - type: "+type+" - roomId: "+roomId),_context124.prev=1,urlParams="",roomId&&(urlParams+="?roomId="+roomId),type&&(urlParams+=urlParams?"&type="+type:"?type="+type),url=this.portalURL+"users/"+contact_service_1.default.userContact.dbId+"/public-links"+urlParams,headers=this.authService.getRequestHeader(),_context124.next=8,fetch(url,{method:"GET",headers:headers});case 8:if((response=_context124.sent).ok){_context124.next=11;break}throw response;case 11:return _context124.next=13,response.json();case 13:(openInviteData=_context124.sent.data)&&openInviteData.length?(this.logger.debug("[roomService] retrieveOpenInviteData -- SUCCESS - found "+openInviteData.length),openInviteData.forEach((function(openInvitePair){openInvitePair.roomId&&(_this101.openInviteIdByRoomId[openInvitePair.roomId]={},_this101.openInviteIdByRoomId[openInvitePair.roomId].roomType=openInvitePair.roomType,_this101.openInviteIdByRoomId[openInvitePair.roomId].openInviteId=openInvitePair.openInviteId,_this101.openInviteIdByRoomId[openInvitePair.roomId].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+openInvitePair.openInviteId,_this101.logger.debug("[roomService] retrieveOpenInviteData - openInviteId "+openInvitePair.openInviteId+" set for room "+openInvitePair.roomId))}))):this.logger.debug("[roomService] retrieveOpenInviteData -- FAILURE - none found"),_context124.next=23;break;case 17:return _context124.prev=17,_context124.t0=_context124.catch(1),_context124.next=21,this.errorHelperService.getErrorInfo(_context124.t0,"retrieveOpenInviteData");case 21:throw errorInfo=_context124.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 23:case"end":return _context124.stop()}}),_callee123,this,[[1,17]])})))}},{key:"retrieveOpenInviteIdForRoom",value:function(roomId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee124(){var url,headers,response,openInviteData,errorInfo;return regenerator_default.a.wrap((function(_context125){for(;;)switch(_context125.prev=_context125.next){case 0:return this.logger.debug("[roomService] retrieveOpenInviteIdForRoom - roomId: "+roomId),_context125.prev=1,url="".concat(this.portalURL,"rooms/").concat(roomId,"/public-links"),headers=this.authService.getRequestHeader(),_context125.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((response=_context125.sent).ok){_context125.next=9;break}throw response;case 9:return _context125.next=11,response.json();case 11:return openInviteData=_context125.sent.data,_context125.abrupt("return",(openInviteData.openInviteId&&(this.openInviteIdByRoomId[roomId]={},this.openInviteIdByRoomId[roomId].roomType="default",this.openInviteIdByRoomId[roomId].openInviteId=openInviteData.openInviteId,this.openInviteIdByRoomId[roomId].openInviteLink=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/"+openInviteData.openInviteId,this.logger.debug("[roomService] retrieveOpenInviteIdForRoom - openInviteId "+openInviteData.openInviteId+" set for room "+roomId)),openInviteData.openInviteId));case 15:return _context125.prev=15,_context125.t0=_context125.catch(1),_context125.next=19,this.errorHelperService.getErrorInfo(_context125.t0,"retrieveOpenInviteIdForRoom");case 19:throw errorInfo=_context125.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 21:case"end":return _context125.stop()}}),_callee124,this,[[1,15]])})))}},{key:"updateRoomConfEndpoint",value:function(oldConfId,newConfId){var _this102=this,rooms=this.findRoomsWithConfId(oldConfId);rooms&&rooms.length&&rooms.forEach((function(room){room.confEndpoints.forEach((function(endpoint){endpoint.confEndpointId===oldConfId&&(endpoint.confEndpointId=newConfId)})),_this102.getServerRoom(room.dbId).then((function(servRoom){_this102.eventService.publish(_this102.ROOM_UPDATE_EVENT,servRoom)})),_this102.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",room)}))}},{key:"retrievePersonalAudioRoom",value:function(){var force=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee125(){var url,headers,response,meetingRoomData,room,errorInfo;return regenerator_default.a.wrap((function(_context126){for(;;)switch(_context126.prev=_context126.next){case 0:if(force||!this.personalAudioRoomId||!this.getRoomById(this.personalAudioRoomId)){_context126.next=2;break}return _context126.abrupt("return",(this.logger.debug("[roomService] retrievePersonalAudioRoom from service data"),this.getRoomById(this.personalAudioRoomId)));case 2:return _context126.prev=2,this.logger.debug("[roomService] retrievePersonalAudioRoom from server"),url=this.portalURL+"meetings/personal",headers=this.authService.getRequestHeader(),_context126.next=8,fetch(url,{method:"GET",headers:headers});case 8:if((response=_context126.sent).ok){_context126.next=11;break}throw response;case 11:return _context126.next=13,response.json();case 13:if(!(meetingRoomData=_context126.sent.data).id){_context126.next=18;break}return this.personalAudioRoomId=meetingRoomData.id,room=this.getRoomById(meetingRoomData.id),_context126.abrupt("return",(room?this.updateRoomData(room,meetingRoomData):this.createRoomFromData(meetingRoomData),this.getRoomById(meetingRoomData.id)));case 18:throw new Error("Wrong data from server");case 21:return _context126.prev=21,_context126.t0=_context126.catch(2),_context126.next=25,this.errorHelperService.getErrorInfo(_context126.t0,"retrievePersonalAudioRoom");case 25:throw errorInfo=_context126.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 27:case"end":return _context126.stop()}}),_callee125,this,[[2,21]])})))}},{key:"retrieveCurrentPersonalAudioRoom",value:function(){var force=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee126(){var url,headers,response,meetingRoomData,room,error,errorInfo;return regenerator_default.a.wrap((function(_context127){for(;;)switch(_context127.prev=_context127.next){case 0:if(force||!this.currentPersonalAudioRoomId||!this.getRoomById(this.currentPersonalAudioRoomId)){_context127.next=2;break}return _context127.abrupt("return",(this.logger.debug("[roomService] retrieveCurrentPersonalAudioRoom from service data"),this.getRoomById(this.currentPersonalAudioRoomId)));case 2:return _context127.prev=2,this.logger.debug("[roomService] retrieveCurrentPersonalAudioRoom from server"),url=this.portalURL+"meetings/current",headers=this.authService.getRequestHeader(),_context127.next=8,fetch(url,{method:"GET",headers:headers});case 8:if((response=_context127.sent).ok){_context127.next=11;break}throw response;case 11:return _context127.next=13,response.json();case 13:if(!(meetingRoomData=_context127.sent.data).id){_context127.next=18;break}return this.currentPersonalAudioRoomId=meetingRoomData.id,room=this.getRoomById(meetingRoomData.id),_context127.abrupt("return",(room?this.updateRoomData(room,meetingRoomData):this.createRoomFromData(meetingRoomData),this.getRoomById(meetingRoomData.id)));case 18:throw error=new Error("Wrong data from server"),this.logger.info("[roomService] "+error.message),error;case 22:return _context127.prev=22,_context127.t0=_context127.catch(2),_context127.next=26,this.errorHelperService.getErrorInfo(_context127.t0,"retrieveCurrentPersonalAudioRoom");case 26:throw errorInfo=_context127.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 28:case"end":return _context127.stop()}}),_callee126,this,[[2,22]])})))}},{key:"reUseMeetingRoom",value:function(roomId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee127(){var error,room,url,headers,response,meetingRoomData,serviceRoom,errorInfo;return regenerator_default.a.wrap((function(_context128){for(;;)switch(_context128.prev=_context128.next){case 0:if(this.logger.debug("[roomService] reUseMeetingRoom - "+roomId),roomId){_context128.next=3;break}throw error=new Error("reUseMeetingRoom - missing parameter"),this.logger.error(error.message),error;case 3:return(room=this.getRoomById(roomId))&&!room.isActive&&this.sendAvailableRoomPresence(room),_context128.prev=5,url="".concat(this.portalURL,"meetings/").concat(roomId,"/reuse"),headers=this.authService.getRequestHeader(),_context128.next=10,fetch(url,{method:"GET",headers:headers});case 10:if((response=_context128.sent).ok){_context128.next=13;break}throw response;case 13:return _context128.next=15,response.json();case 15:if(!(meetingRoomData=_context128.sent.data).id){_context128.next=20;break}return this.currentPersonalAudioRoomId=meetingRoomData.id,serviceRoom=this.getRoomById(meetingRoomData.id),_context128.abrupt("return",(serviceRoom?this.updateRoomData(serviceRoom,meetingRoomData):this.createRoomFromData(meetingRoomData),this.getRoomById(meetingRoomData.id)));case 20:throw new Error("Wrong data from server");case 23:return _context128.prev=23,_context128.t0=_context128.catch(5),_context128.next=27,this.errorHelperService.getErrorInfo(_context128.t0,"reUseMeetingRoom");case 27:throw errorInfo=_context128.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 29:case"end":return _context128.stop()}}),_callee127,this,[[5,23]])})))}},{key:"deletePersonalMeetingRoom",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee128(){var url,headers,response,meetingRoomData,room,errorInfo;return regenerator_default.a.wrap((function(_context129){for(;;)switch(_context129.prev=_context129.next){case 0:return this.logger.debug("[roomService] deletePersonalMeetingRoom"),_context129.prev=1,url=this.portalURL+"meetings/delete",headers=this.authService.getPostHeader(),_context129.next=6,fetch(url,{method:"PUT",headers:headers});case 6:if((response=_context129.sent).ok){_context129.next=9;break}throw response;case 9:return _context129.next=11,response.json();case 11:if(!(meetingRoomData=_context129.sent.data).id){_context129.next=15;break}return room=this.getRoomById(meetingRoomData.id),_context129.abrupt("return",(room?this.updateRoomData(room,meetingRoomData):this.createRoomFromData(meetingRoomData),this.currentPersonalAudioRoomId=meetingRoomData.id,this.personalAudioRoomId=meetingRoomData.id,this.eventService.publish("ON_MEETING_CREATED_EVENT",meetingRoomData.id),room=this.getRoomById(meetingRoomData.id)));case 15:throw new Error("Wrong data from server");case 18:return _context129.prev=18,_context129.t0=_context129.catch(1),_context129.next=22,this.errorHelperService.getErrorInfo(_context129.t0,"deletePersonalMeetingRoom");case 22:throw errorInfo=_context129.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 24:case"end":return _context129.stop()}}),_callee128,this,[[1,18]])})))}},{key:"saveCurrentPersonalMeetingRoom",value:function(name){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee129(){var url,headers,response,meetingRoomData,room,errorInfo;return regenerator_default.a.wrap((function(_context130){for(;;)switch(_context130.prev=_context130.next){case 0:return this.logger.debug("[roomService] saveCurrentPersonalMeetingRoom"),_context130.prev=1,url=this.portalURL+"meetings/save",headers=this.authService.getPostHeader(),_context130.next=6,fetch(url,{method:"PUT",headers:headers,body:JSON.stringify({name:name})});case 6:if((response=_context130.sent).ok){_context130.next=9;break}throw response;case 9:return _context130.next=11,response.json();case 11:if(!(meetingRoomData=_context130.sent.data).id){_context130.next=16;break}return this.currentPersonalAudioRoomId=meetingRoomData.id,room=this.getRoomById(meetingRoomData.id),_context130.abrupt("return",(room?this.updateRoomData(room,meetingRoomData):this.createRoomFromData(meetingRoomData),this.currentPersonalAudioRoomId=meetingRoomData.id,this.personalAudioRoomId=meetingRoomData.id,this.eventService.publish("ON_MEETING_CREATED_EVENT",meetingRoomData.id),room=this.getRoomById(meetingRoomData.id)));case 16:throw new Error("Wrong data from server");case 19:return _context130.prev=19,_context130.t0=_context130.catch(1),_context130.next=23,this.errorHelperService.getErrorInfo(_context130.t0,"saveCurrentPersonalMeetingRoom");case 23:throw errorInfo=_context130.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 25:case"end":return _context130.stop()}}),_callee129,this,[[1,19]])})))}},{key:"getPersonalAudioRoomOpenInviteIdLink",value:function(){return this.getOpenInviteIdLinkForRoom(this.personalAudioRoomId)}},{key:"getOpenInviteIdLinkForRoom",value:function(roomId){return this.openInviteIdByRoomId[roomId]?this.openInviteIdByRoomId[roomId].openInviteLink:null}},{key:"getOpenInviteIdForRoom",value:function(roomId){return this.openInviteIdByRoomId[roomId]?this.openInviteIdByRoomId[roomId].openInviteId:null}},{key:"getName",value:function(room){return room.name}},{key:"sortObjectByProperty",value:function(property_name){return function(aaa,bbb){return aaa[property_name]<bbb[property_name]?-1:aaa[property_name]>bbb[property_name]?1:0}}},{key:"retrieveRoomConsumption",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee130(){var url,headers,response,roomConsumptionData,errorInfo;return regenerator_default.a.wrap((function(_context131){for(;;)switch(_context131.prev=_context131.next){case 0:return this.logger.debug("[roomService] retrieveRoomConsumption"),_context131.prev=1,url=this.portalURL+"rooms/consumption",headers=this.authService.getRequestHeader(),_context131.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((response=_context131.sent).ok){_context131.next=9;break}throw response;case 9:return _context131.next=11,response.json();case 11:return roomConsumptionData=_context131.sent.data,_context131.abrupt("return",(this.logger.debug("[roomService] retrieveRoomConsumption -- SUCCESS -- "+roomConsumptionData.currentValue),roomConsumptionData.currentValue));case 15:return _context131.prev=15,_context131.t0=_context131.catch(1),_context131.next=19,this.errorHelperService.getErrorInfo(_context131.t0,"retrieveRoomConsumption");case 19:throw errorInfo=_context131.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 21:case"end":return _context131.stop()}}),_callee130,this,[[1,15]])})))}},{key:"startAdHocConference",value:function(calleeId){var participantIds=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee131(){var url,headers,response,roomData,errorInfo;return regenerator_default.a.wrap((function(_context132){for(;;)switch(_context132.prev=_context132.next){case 0:return this.logger.debug("[roomService] startAdHocConference with ".concat(calleeId," and ").concat(participantIds)),_context132.prev=1,url=this.portalURL+"adhoc",headers=auth_service_1.default.getPostHeader(),_context132.next=6,fetch(url,{method:"PUT",headers:headers,body:JSON.stringify({calleeId:calleeId,participantIds:participantIds})});case 6:if((response=_context132.sent).ok){_context132.next=9;break}throw response;case 9:return _context132.next=11,response.json();case 11:return roomData=_context132.sent.data,_context132.abrupt("return",(this.logger.debug("[roomService] startAdHocConference -- SUCCESS -- "),roomData));case 15:return _context132.prev=15,_context132.t0=_context132.catch(1),_context132.next=19,this.errorHelperService.getErrorInfo(_context132.t0,"startAdHocConference");case 19:throw errorInfo=_context132.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 21:case"end":return _context132.stop()}}),_callee131,this,[[1,15]])})))}},{key:"manageEventForNonExistingRoom",value:function(roomJid,eventName,userJid){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee133(){var errorInfo,_this103=this;return regenerator_default.a.wrap((function(_context134){for(;;)switch(_context134.prev=_context134.next){case 0:_context134.prev=0,setTimeout((function(){return __awaiter(_this103,void 0,void 0,regenerator_default.a.mark((function _callee132(){var room,user;return regenerator_default.a.wrap((function(_context133){for(;;)switch(_context133.prev=_context133.next){case 0:if(this.logger.debug("[roomService] manageEventForNonExistingRoom for "+roomJid),room=this.getRoomByJid(roomJid),_context133.t0=room,_context133.t0){_context133.next=7;break}return _context133.next=6,this.getServerRoomByJid(roomJid);case 6:room=_context133.sent;case 7:if(user=room.getUserByJid(userJid),"conferenceAdd"!==eventName){_context133.next=12;break}if(room.isMeetingRoom()||contact_service_1.default.userContact.webrtcAudioEnabled){_context133.next=11;break}return _context133.abrupt("return",room);case 11:this.eventService.publish("ROOM_ADD_CONF_ENDPOINT_EVENT",room),this.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",room),this.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",room,user);case 12:return _context133.abrupt("return",room);case 13:case"end":return _context133.stop()}}),_callee132,this)})))}),4e3),_context134.next=10;break;case 4:return _context134.prev=4,_context134.t0=_context134.catch(0),_context134.next=8,this.errorHelperService.getErrorInfo(_context134.t0,"manageEventForNonExistingRoom");case 8:throw errorInfo=_context134.sent,this.logger.error("[roomService] "+errorInfo.message),errorInfo.error;case 10:case"end":return _context134.stop()}}),_callee133,this,[[0,4]])})))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.roomService||(win.rainbow.roomService=new RoomService),win.rainbow.roomService}}]),RoomService}(AbstractRoomService);exports.RoomService=RoomService,exports.default=RoomService.getInstance()},function(module,__webpack_exports__,__webpack_require__){function identity(x){return x}__webpack_require__.d(__webpack_exports__,"a",(function(){return identity}))},function(module,__webpack_exports__,__webpack_require__){function isFunction(x){return"function"==typeof x}__webpack_require__.d(__webpack_exports__,"a",(function(){return isFunction}))},function(module,__webpack_exports__,__webpack_require__){function hostReportError(err){setTimeout((function(){throw err}),0)}__webpack_require__.d(__webpack_exports__,"a",(function(){return hostReportError}))},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var i18n_service_1=__webpack_require__(38),ErrorHelperInfo=function ErrorHelperInfo(){_classCallCheck(this,ErrorHelperInfo),this.message="",this.error=null};exports.ErrorHelperInfo=ErrorHelperInfo;var ErrorHelperService=function(){function ErrorHelperService(){_classCallCheck(this,ErrorHelperService)}return _createClass(ErrorHelperService,[{key:"getErrorInfo",value:function(error){var context=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,params=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee134(){var errorInfo,data,_status2,statusText,errorText,portal,requestId;return regenerator_default.a.wrap((function(_context135){for(;;)switch(_context135.prev=_context135.next){case 0:if(errorInfo=new ErrorHelperInfo,error instanceof Error&&(errorInfo.message=error.message,errorInfo.error=error),!(error instanceof Response)){_context135.next=11;break}return _context135.next=4,error.json();case 4:data=_context135.sent,_status2=data&&data.errorDetailsCode?data.errorDetailsCode:error.status,statusText=this.getStatusText(data,error),errorText=this.getErrorText(data),portal=error.url?error.url.match(/api\/rainbow\/(\w+)\//)[1]:void 0,requestId=error.headers&&error.headers.get("x-rainbow-request-id")?" (x-rainbow-request-id:".concat(error.headers.get("x-rainbow-request-id"),")"):"",context&&(errorInfo.message=context+" -- "),errorInfo.message+="".concat(statusText," -- ").concat(errorText),requestId&&(errorInfo.message+=requestId),errorInfo.error=new Error(errorInfo.message),errorInfo.error.status=error.status,errorInfo.error.fieldErrors=this.getBadRequestFieldErrors(data,error),errorInfo.error.errorDetails=errorText,errorInfo.error.errorDetailsCode=_status2,errorInfo.error.errorDetailsLabel=this.getErrorCodeLabel(_status2,portal),errorInfo.error.translatedMessage=this.getTranslatedErrorMessage(errorInfo.error,params,portal),errorInfo.error.portal=portal;case 11:return _context135.abrupt("return",errorInfo);case 12:case"end":return _context135.stop()}}),_callee134,this)})))}},{key:"getTranslatedErrorMessage",value:function(error,params,portal){var errorMessage="";return error.errorDetailsCode&&(errorMessage=this.getLocalizedError(error.errorDetailsCode,params,portal)),errorMessage}},{key:"getLocalizedError",value:function(errorCode,params,portal){var errorMessage="",errorLabel=this.getErrorCodeLabel(errorCode,portal);if(errorLabel){var translation=i18n_service_1.default.translate(errorLabel,params);translation!==errorLabel&&(errorMessage=translation)}return errorMessage}},{key:"getErrorText",value:function(data){if(!data)return"Unknow error - Something goes really wrong";var message="";return data.errorDetails?data.errorDetails instanceof Array?data.errorDetails.forEach((function(details){message+=details.msg})):data.errorDetails.msg?message+=JSON.stringify(data.errorDetails.msg):message+=data.errorDetails:data.errorMsg&&(message+=data.errorMsg),message}},{key:"getStatusText",value:function(status,response){switch(status){case-1:return"Service unavailable";case 400:return"Bad request";case 401:return"Authorization failure";case 403:return"Access is forbidden";case 404:return"Resource not found";case 413:return"Request Entity Too Large";case 415:return"Unsupported Media Type";case 500:return"Internal server error";default:return response.statusText?response.statusText:"Unknown error"}}},{key:"getBadRequestFieldErrors",value:function(data,response){var fieldErrors={},errorDetails=data?data.errorDetails:null;return 400===response.status&&errorDetails&&(errorDetails instanceof Array?errorDetails.forEach((function(details){fieldErrors[details.param]||(fieldErrors[details.param]={ok:!1,message:details.msg,value:details.value})})):errorDetails.param&&(fieldErrors[errorDetails.param]={ok:!1,message:errorDetails.msg,value:errorDetails.value}),data&&400511===data.errorDetailsCode&&(fieldErrors.office365Tenant={ok:!1,message:ErrorHelperService.ERROR_CODE_LABELS[400511]}),data&&400601===data.errorDetailsCode&&(fieldErrors.outgoingPrefix={ok:!1,message:ErrorHelperService.ERROR_CODE_LABELS[400601]},fieldErrors.numberingPrefix={ok:!1,message:ErrorHelperService.ERROR_CODE_LABELS[400601]})),fieldErrors}},{key:"getErrorCodeLabel",value:function(errorCode,portal){return portal&&ErrorHelperService.PORTAL_ERROR_CODE_LABELS[portal]&&ErrorHelperService.PORTAL_ERROR_CODE_LABELS[portal][errorCode]?ErrorHelperService.PORTAL_ERROR_CODE_LABELS[portal][errorCode]:ErrorHelperService.ERROR_CODE_LABELS[errorCode]}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.errorHelperService||(win.rainbow.errorHelperService=new ErrorHelperService),win.rainbow.errorHelperService}}]),ErrorHelperService}();ErrorHelperService.ERROR_CODE_LABELS={"-1":"unknownError",0:"errorNoServerResponse",400:"Bad request",4e5:"Bad request",400210:"invalidPhoneNumber",400400:"errorWrongPassword",400500:"invalidFile",400504:"companyNameAlreadyExist",400505:"BPCompanyWithoutPaymentConfigurationData",400506:"NoActiveSubscriptionToOffer",400509:"errorDecreaseSubscriptionForbidden",400511:"ActiveDirectoryDomainAlreadyUsed",400552:"BPCompanyAndECCompanyMustNotBeSame",400601:"outboundAndInternalPrefixesCantBeIdentical",400973:"noCreateUserPermission",400975:"userAlreadyExistsInOtherCompany",400983:"userAlreadyExistsInOtherCompany",400990:"noUserFound",400993:"noUserFound",401:"Authorization failure",401102:"Authorization failure",401202:"errorInvalidToken",401500:"errorUnauthorized",401501:"errorLoginForbidden",401510:"errorUnauthorized",401520:"errorUserNotActive",401521:"errorUserNotActive",403:"Forbidden",403e3:"accessDeniedNotRequiredRole",403001:"accessDeniedNotOwner",403034:"cantDeselectDefaultWebRTCGateway",403035:"cantDeleteDefaultWebRTCGateway",403060:"confLockMsg",403072:"errorIsoMd5Mismatch",403153:"notAllowedToAccessMeeting",403154:"notAllowedToAccessMeeting",403200:"notAllowedToChangeRole",403203:"notAllowedToChangeRole",403204:"notAllowedToMoveExistingUserToThisCompany",403205:"notAllowedToManageUser",403301:"notAllowedToManageCompany",403304:"notAllowedToAddAnotherAdmin",403311:"errorRemoveSyncOngoingSubscriptionForbidden",403315:"errorRemoveSubscriptionForbidden",403316:"errorRemoveAdminAllocatedSubscriptionForbidden",403317:"errorRemoveClientAllocatedSubscriptionForbidden",403400:"notAllowedDeleteAppOwner",403500:"notAllowedBlacklistedEmail",403501:"notAllowedBlacklistedEmail",403503:"NotAllowedSelfRegistrationEmail",403504:"notAllowedLoggedInUserEmail",403507:"notAllowedSupportEmail",403513:"companyNotABpCompany",403516:"companyNotABpCompany",403517:"companySeenAsTerminated",403518:"companyBpTypeIncompatible",403519:"companyAlreadyLinkedToBp",403520:"companyNotVadBp",403526:"isolatedUser",403531:"resetPasswordBlocked",403532:"resetPasswordForbidden",403608:"errorAssignSubscriptionSyncOngoing",403609:"errorAssignSubscriptionSyncOngoing",403610:"maxSubscriptionAllocationReached",403611:"notAllowedToCreateAnEquipment",403615:"maximumNumberConferenceParticipantsReach",403616:"subscriptionCompanyAdminEssentialAlreadyExists",403617:"roleCompanyAdminEssentialAlreadyExists",403620:"MaximumNumberRoomUsersReach",403621:"MaximumNumberConvUsersReach",403624:"notAllowedRemoveService",403625:"errorAllocatedSubscriptionRemoveForbidden",403626:"restrictedConvAccess",403630:"uploadErrorMaxQuotaReached",403655:"userAlreadyCompanyMember",403670:"errorOperationForbiddenOnGuest",403700:"errorDeleteSiteWithSystems",403701:"errorDeleteOrganisationLinkedCompany",403702:"errorDeleteCompanyWithSubscriptions",403703:"errorDeleteCompanyWithSites",403704:"errorDeleteCompanyWithUsers",403705:"errorDeleteCompanyStillTerminated",403706:"errorRemoveBusinessPartnerRole",403719:"externalTrunkChangeForbidden",403721:"numberingPlanCantBeUpdated",403722:"outgoingPrefixChangeForbidden",403723:"cannotRemoveCompanyPublicNumber",403724:"notAllowedDeleteCloudPbxWithPublicNumbers",403725:"notAllowedDeleteCloudPbxWithUsedExtensions",404:"resourceNotFound",404e3:"resourceNotFound",404001:"resourceNotFoundUpdateImpossible",404002:"resourceNotFoundDeleteImpossible",404116:"archivedOrDeletedConversation",404300:"noValidOfferReferenceInACTISFile",404301:"offerNotFound",409e3:"userAlreadyCreated",409005:"inviteUsersError",409011:"noMessagesToExport",409251:"DDIAlreadyAssociatedToCompany",409552:"internalNumberAlreadyUsed",409555:"publicNumberAlreadyExists",409557:"notAllowedDeleteUserAssociatedToCloudPbx",409600:"userAlreadyExist",409601:"invitationReSentConflict",409602:"userAlreadyNetworkMember",409603:"invitationReSentConflict",409620:"offerAlreadySubscribed",409623:"conferenceOfferAlreadySubscribed",409625:"errorUpdateSyncOngoingSubscriptionForbidden",409800:"companyNotIrBp",409801:"companyNotLinkedToBp",409802:"actisCompanyAdminMismatch",409803:"actisCompanyNameMismatch",413e3:"uploadErrorTooLarge",500:"errorInternalServerError",1001:"extensionNotLinkedToEquipment",1002:"extensionHasNoIdentifier",1003:"extensionDoesNotExist",1004:"extensionLookupFailure",1005:"extensionConflict",1006:"nonUniqueEquipmentForExtension",1007:"userAlreadyAssociatedToExtension",1008:"extensionAssociatedToAnotherUser",1009:"failedToAttachExtension",1010:"userHasNoExtension",1011:"userHasTooManyExtensions",1012:"failedToDetachExtension"},ErrorHelperService.PORTAL_ERROR_CODE_LABELS={massprovisioning:{4e5:"invalidValue",400501:"invalidFile",400502:"invalidColumnName",400504:"invalidFile",400506:"invalidValueInActionColumn",400600:"deviceTypeCannotBeUpdated",400601:"duplicateDeviceIds",400602:"duplicateMacAdresses",400603:"invalidDeviceTypes",400604:"missingDeviceTypeInLines",400605:"invalidEquipment",403610:"errorMaxSubscriptionReached",404600:"deviceDoesNotExist",404601:"noCloudPbxInCompany"},rvcpprovisioning:{403e3:"overflowConfigurationChangesStillInProgress",403622:"noVoiceLicenceAllocatedToUser",403694:"forbiddenOperationEquipmentHasGroups",403699:"forbiddenOperationEquipmentHasWelcomeService",403728:"forbiddenOperationEquipmentHasDevices",409556:"companyHasAlreadyACloudPbx",409560:"macAddressAlreadyUsed",409561:"deviceStillUsedByUser",409562:"deviceAlreadyUsed",409563:"deviceAlreadyUsedByAnotherSystem",403739:"forbiddenOperationWelcomeServiceUsed",413e3:"fileTooLarge",415e3:"audioFileTypeNotSupported"},authentication:{401102:"Authorization failure",401103:"Authorization failure",401500:"Authorization failure",401520:"Forbidden",401521:"Forbidden",401522:"Forbidden",401523:"Forbidden",401530:"Authorization failure",401600:"Authorization failure",401700:"Authorization failure",403e3:"Authorization failure",5e5:"errorInternalServerError",503e3:"resourceNotFound"},webinar:{403135:"WebinarInvalidRegistrationId"}},exports.ErrorHelperService=ErrorHelperService,exports.default=ErrorHelperService.getInstance()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var settings_service_1=__webpack_require__(5),logger_service_1=__webpack_require__(15),moment=__webpack_require__(3),rxjs_1=__webpack_require__(10),I18nService=function(){function I18nService(){var _this104=this;_classCallCheck(this,I18nService),this.isInitialized=!1,this.subject=new rxjs_1.Subject,this.subscription=settings_service_1.default.subscribeUpdateEvent("LANGUAGE_UPDATED",(function(){_this104.updateTranslationLanguage()}))}return _createClass(I18nService,[{key:"subscribe",value:function(observable){return this.subject.subscribe(observable)}},{key:"configure",value:function(translator){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee135(){return regenerator_default.a.wrap((function(_context136){for(;;)switch(_context136.prev=_context136.next){case 0:return this.translator=translator,_context136.next=3,this.updateTranslationLanguage();case 3:case"end":return _context136.stop()}}),_callee135,this)})))}},{key:"translate",value:function(label){var params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.translator?this.translator.instant(label,params):label}},{key:"getCurrentLanguage",value:function(){return this.translator?this.translator.use():"en"}},{key:"updateTranslationLanguage",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee136(){var currentLanguage,loadedLanguage;return regenerator_default.a.wrap((function(_context137){for(;;)switch(_context137.prev=_context137.next){case 0:if(_context137.prev=0,currentLanguage=settings_service_1.default.getAppliLanguage(),!this.translator){_context137.next=7;break}return _context137.next=5,this.translator.use(currentLanguage.code);case 5:loadedLanguage=_context137.sent,logger_service_1.default.info('[I18nService] updateTranslationLanguage -- "'.concat(loadedLanguage,'" labels are loaded')),this.isInitialized=!0,this.subject.next();case 7:moment.locale(currentLanguage.codeMoment),_context137.next=13;break;case 10:_context137.prev=10,_context137.t0=_context137.catch(0),logger_service_1.default.error("[I18nService] updateTranslationLanguage -- failure");case 13:case"end":return _context137.stop()}}),_callee136,this,[[0,10]])})))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.i18nService||(win.rainbow.i18nService=new I18nService),win.rainbow.i18nService}}]),I18nService}();exports.I18nService=I18nService,exports.default=I18nService.getInstance()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.sdkConfig={verboseLog:!0,measurePerformance:!1,unifiedPlan:!1,credentials:{appID:"",appSecret:"",host:"openrainbow.com"},startService:{connection:!0,presence:!0,contacts:!0,conversations:!0,im:!0,telephony:!0,webRTC:!0,bubbles:!0,groups:!0,callsLog:!0,userProfile:!0,favorites:!0,fileStorage:!0,caps:!0,channels:!0,admin:!0},features:{bots:!0,channels:!0,conference:!0,telephony:!0,profileService:!0,roomService:!0,favoriteService:!0,conversationService:!0}}},function(module,exports,__webpack_require__){var C,C_lib,Base,WordArray,C_algo,MD5,EvpKDF,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(72),__webpack_require__(73),Base=(C_lib=(C=CryptoJS).lib).Base,WordArray=C_lib.WordArray,MD5=(C_algo=C.algo).MD5,EvpKDF=C_algo.EvpKDF=Base.extend({cfg:Base.extend({keySize:4,hasher:MD5,iterations:1}),init:function(cfg){this.cfg=this.cfg.extend(cfg)},compute:function(password,salt){for(var cfg=this.cfg,hasher=cfg.hasher.create(),derivedKey=WordArray.create(),derivedKeyWords=derivedKey.words,keySize=cfg.keySize,iterations=cfg.iterations;derivedKeyWords.length<keySize;){block&&hasher.update(block);var block=hasher.update(password).finalize(salt);hasher.reset();for(var i=1;i<iterations;i++)block=hasher.finalize(block),hasher.reset();derivedKey.concat(block)}return derivedKey.sigBytes=4*keySize,derivedKey}}),C.EvpKDF=function(password,salt,cfg){return EvpKDF.create(cfg).compute(password,salt)},CryptoJS.EvpKDF)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return rxSubscriber}));var rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return UnsubscriptionError}));var UnsubscriptionError=function(){function UnsubscriptionErrorImpl(errors){return Error.call(this),this.message=errors?errors.length+" errors occurred during unsubscription:\n"+errors.map((function(err,i){return i+1+") "+err.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=errors,this}return UnsubscriptionErrorImpl.prototype=Object.create(Error.prototype),UnsubscriptionErrorImpl}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),company_model_1=__webpack_require__(19),crypto_js_1=__webpack_require__(18),Contact=function(){function Contact(){var jid=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,name=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,company=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,Contact),this.id=null,this.dbId=null,this.jid=null,this.fullJid=null,this.jidtel=null,this.login=null,this.temp=!1,this.roster=!1,this.initialized=!1,this.isTerminated=!1,this.ask=null,this.subscription=null,this.guest=!1,this.guestMode=!1,this.confId=null,this.conversation=null,this.personalAudioRoomOpenInviteId=null,this.personalAudioRoomOpenInviteIdSubject=null,this.capabilities=null,this.groups=null,this.nameUpdatePrio=null,this.rxSubject=new rxjs_1.Subject,this.isBot=!1,this.isBotSharing=!1,this.status=null,this.telStatus=null,this.imStatus=null,this.oldImStatus=null,this.imStatusStamp=null,this.resources=null,this.lastActivityDate=null,this.lastActivityMessage=null,this.statusMessage=null,this.message=null,this.loginEmail=null,this.lastname=null,this.firstname=null,this.initials=null,this.name=null,this.nickname=null,this.title=null,this.jobTitle=null,this.company=null,this.isInDefaultCompany=!1,this.language=null,this.country=null,this.timezone=null,this.tags=null,this._displayName=null,this.nameForLogs=null,this.displayShortName=null,this.displayOrder="FL",this._avatar=null,this.defaultAvatar=null,this.avatarSrc=null,this.calendarState=null,this.phoneProCan=null,this.pbxId=null,this.organisationId=null,this.siteId=null,this.systemId=null,this.phoneNumberId=null,this.phonePbx=null,this.phoneInternalNumber=null,this.mobilePro=null,this.mobileProCan=null,this.isMobileProShared=!1,this.phonePerso=null,this.phonePersoCan=null,this.isPhonePersoShared=!1,this.mobilePerso=null,this.mobilePersoCan=null,this.isMobilePersoShared=!1,this.isVirtualTerm=!1,this.systDeviceName=null,this.voicemailNumber=null,this.hasPhoneNumber=!1,this.hasPhoneProDdiNumber=!1,this.phoneNumbersInitialized=!1,this.isCCDAgentEnabled=!1,this.emailPro=null,this.emailPerso=null,this.note1=null,this.note2=null,this.department=null,this.otherPhoneNumbers=null,this.postalCode=null,this.state=null,this.street=null,this.city=null,this.businessCompanyId=null,this.companyName=null,this.isTv=!1,this.rainbowTvData=null,this.roles=null,this.adminType=null,this.customData=null,this.userTitleNameEnabled=!1,this.alertNotificationEnabledForMyCompany=!1,this.giphyEnabled=!0,this.telephonySettingsEnabled=!0,this.recordConversationEnabled=!0,this.changeSettingsEnabled=!0,this.newUiEnabled=!1,this.denySelfRegister=!1,this._fileSharingEnabled=!1,this._fileStorageEnabled=!1,this._instantMessagesEnabled=!1,this._changePresenceEnabled=!1,this._phoneMeetingsEnabled=!1,this._channelsEnabled=!1,this._roomsEnabled=!1,this._webrtcAudioEnabled=!1,this._webrtcVideoEnabled=!1,this._modifyProfileEnabled=!1,this._useDialOutEnabled=!1,this.id=jid,this.dbId=null,this.jid=jid,this.fullJid=null,this.jidtel=null,this.login=null,this.temp=!1,this.roster=!1,this.initialized=!1,this.ask="none",this.subscription="none",this.guest=!1,this.confId="",this.conversation=null,this.personalAudioRoomOpenInviteId=null,this.personalAudioRoomOpenInviteIdSubject=new rxjs_1.BehaviorSubject(this.personalAudioRoomOpenInviteId),this.capabilities=null,this.groups=null,this.nameUpdatePrio=Contact.NameUpdatePrio.MAX_UPDATE_PRIO,this.status="unknown",this.telStatus="",this.imStatus="offline",this.oldImStatus=null,this.imStatusStamp=[],this.resources={},this.mobileResource=null,this.lastActivityDate=null,this.lastActivityMessage=null,this.statusMessage=null,this.message="",this.loginEmail="",this.lastname="",this.firstname="",this.initials="",this.name={value:this._displayName},this.nameForLogs="",this._displayName=name||jid,this.nickname="",this.title="",this.jobTitle="",this.company=company,this.isInDefaultCompany=!1,this.language=null,this.country="",this.timezone="",this.tags=null,this.defaultAvatar=null,this._avatar=null,this.avatarSrc=null,this.calendarState={},this.phonePro="",this.phoneProCan="",this.pbxId="",this.phonePbx="",this.phoneInternalNumber="",this.mobilePro="",this.mobileProCan="",this.isMobileProShared=!1,this.phonePerso="",this.phonePersoCan="",this.isPhonePersoShared=!1,this.mobilePerso="",this.mobilePersoCan="",this.isMobilePersoShared=!1,this.isVirtualTerm=!1,this.systDeviceName=null,this.emailPro="",this.emailPerso="",this.note1="",this.note2="",this.department="",this.otherPhoneNumbers=[],this.postalCode="",this.state="",this.street="",this.city="",this.businessCompanyId="",this.companyName="",this.isTv=!1,this.rainbowTvData={},this.roles=null,this.adminType=null,this.newUiEnabled=!1,this._fileSharingEnabled=!0,this._fileStorageEnabled=!0,this.fileStorageEnabledSubject=new rxjs_1.BehaviorSubject(!0),this._instantMessagesEnabled=!0,this._changePresenceEnabled=!0,this._phoneMeetingsEnabled=!0,this.phoneMeetingsEnabledSubject=new rxjs_1.BehaviorSubject(!0),this._channelsEnabled=!0,this._roomsEnabled=!0,this._webrtcAudioEnabled=!0,this._webrtcVideoEnabled=!0,this._modifyProfileEnabled=!0,this._useDialOutEnabled=!0,this.userTitleNameEnabled=!0,this.giphyEnabled=!0,this.isCCDAgentEnabled=!1,this.denySelfRegister=!1}return _createClass(Contact,[{key:"updateFromUserData",value:function(userData){this.dbId=userData.id,this.loginEmail=userData.loginEmail,this.firstname=userData.firstName,this.lastname=userData.lastName,this.nickname=userData.nickName?userData.nickName:"",this.title=userData.title?userData.title:"",this.jobTitle=userData.jobTitle?userData.jobTitle:"",this.organisationId=userData.organisationId,this.siteId=userData.siteId,this.country=userData.country?userData.country:"FRA",this.timezone=userData.timezone,this.roles=userData.roles,this.adminType=userData.adminType,this.isBot=!1,this.isBotSharing=!1,this.isTerminated=userData.isTerminated,this.isInDefaultCompany=userData.isInDefaultCompany,this.lastAvatarUpdateDate=userData.lastAvatarUpdateDate,this.initialized=userData.isInitialized,this.guestMode=!!userData.guestMode&&userData.guestMode,this.personalAudioRoomOpenInviteId=userData.personalAudioRoomOpenInviteId?userData.personalAudioRoomOpenInviteId:this.personalAudioRoomOpenInviteId,this.personalAudioRoomOpenInviteIdSubject.next(this.personalAudioRoomOpenInviteId),this.isTv=userData.isTv,this.tags=userData.tags,this.department=userData.department,this.customData=userData.customData,this.denySelfRegister=userData.denySelfRegister,userData.jid_im&&(this.id=userData.jid_im,this.jid=userData.jid_im,this.jidtel=userData.jid_tel),this.company&&this.company.id===userData.companyId||(this.company=company_model_1.Company.create(userData.companyId,userData.companyName)),userData.fileSharingCustomisation&&(this._fileSharingEnabled="enabled"===userData.fileSharingCustomisation),userData.fileStorageCustomisation&&(this.fileStorageEnabled="enabled"===userData.fileStorageCustomisation),userData.userTitleNameCustomisation&&(this.userTitleNameEnabled="enabled"===userData.userTitleNameCustomisation),userData.instantMessagesCustomisation&&(this._instantMessagesEnabled="enabled"===userData.instantMessagesCustomisation),userData.overridePresenceCustomisation&&(this._changePresenceEnabled="enabled"===userData.overridePresenceCustomisation),userData.phoneMeetingCustomisation&&(this.phoneMeetingsEnabled="enabled"===userData.phoneMeetingCustomisation),userData.useChannelCustomisation&&(this._channelsEnabled="enabled"===userData.useChannelCustomisation),userData.useRoomCustomisation&&(this._roomsEnabled="enabled"===userData.useRoomCustomisation),userData.useWebRTCAudioCustomisation&&(this._webrtcAudioEnabled="enabled"===userData.useWebRTCAudioCustomisation),userData.useWebRTCVideoCustomisation&&(this._webrtcVideoEnabled="enabled"===userData.useWebRTCVideoCustomisation),userData.userProfileCustomisation&&(this._modifyProfileEnabled="enabled"===userData.userProfileCustomisation),userData.useGifCustomisation&&(this.giphyEnabled="enabled"===userData.useGifCustomisation),userData.changeTelephonyCustomisation&&(this.telephonySettingsEnabled="enabled"===userData.changeTelephonyCustomisation),userData.recordingConversationCustomisation&&(this.recordConversationEnabled="enabled"===userData.recordingConversationCustomisation),userData.changeSettingsCustomisation&&(this.changeSettingsEnabled="enabled"===userData.changeSettingsCustomisation),userData.useDialOutCustomisation&&(this.useDialOutEnabled="enabled"===userData.useDialOutCustomisation),userData.tryNewUiCustomisation&&(this.newUiEnabled="enabled"===userData.tryNewUiCustomisation),this.phonePro=this.phoneProCan="",this.phonePbx="",this.phoneInternalNumber="",this.pbxId="",this.mobilePro=this.mobileProCan="",this.phonePerso=this.phonePersoCan="",this.mobilePerso=this.mobilePersoCan="",this.voicemailNumber="",this.systemId="",this.phoneNumberId="",this.hasPhoneNumber=!1,this.hasPhoneProDdiNumber=!1,this.isCCDAgentEnabled=!1,this.customData||(this.customData={});var that=this;userData.emails&&(that.emailPerso="",userData.emails.forEach((function(email){switch(email.type){case"work":that.emailPro=email.email;break;case"home":that.emailPerso=email.email}}))),userData.phoneNumbers&&(userData.phoneNumbers.forEach((function(phoneNumber){var number=phoneNumber.number,numberCan=phoneNumber.numberE164,deviceType=phoneNumber.deviceType;switch(that.hasPhoneNumber=!0,phoneNumber.type){case"work":"landline"===deviceType&&(phoneNumber.isCloudPbxDDI?(that.phonePro=phoneNumber.number,that.phoneProCan=phoneNumber.numberE164,that.hasPhoneProDdiNumber=!0):that.hasPhoneProDdiNumber||(that.phonePro=number,that.phoneProCan=numberCan),phoneNumber.isFromSystem&&(that.phonePbx=phoneNumber.shortNumber,that.isCCDAgentEnabled="CCD agent"===phoneNumber.userType,phoneNumber.internalNumber&&(that.phoneInternalNumber=phoneNumber.internalNumber,"Remote Extension"===phoneNumber.deviceName||"Any Device"===phoneNumber.deviceName||0===phoneNumber.deviceName.search("UA VIRTUAL")?that.isVirtualTerm=!0:that.isVirtualTerm=!1),that.systDeviceName=phoneNumber.deviceName?phoneNumber.deviceName:null,that.pbxId=phoneNumber.pbxId,that.voicemailNumber=phoneNumber.voiceMailNumber,that.systemId=phoneNumber.systemId,that.phoneNumberId=phoneNumber.phoneNumberId)),"mobile"===deviceType&&(that.mobilePro=number,that.isMobileProShared=phoneNumber.isVisibleByOthers,that.mobileProCan=numberCan);break;case"home":"landline"===deviceType&&(that.phonePerso=number,that.isPhonePersoShared=phoneNumber.isVisibleByOthers,that.phonePersoCan=numberCan),"mobile"===deviceType&&(that.mobilePerso=number,that.isMobilePersoShared=phoneNumber.isVisibleByOthers,that.mobilePersoCan=numberCan)}})),this.phoneNumbersInitialized=!0),this.computeDisplayName()}},{key:"containsEmail",value:function(email){var lowerCaseEmail=email.toLowerCase();return!(!this.loginEmail||this.loginEmail.toLowerCase()!==lowerCaseEmail)||!(!this.emailPro||this.emailPro.toLowerCase()!==lowerCaseEmail)||!(!this.emailPerso||this.emailPerso.toLowerCase()!==lowerCaseEmail)}},{key:"containsPhoneNumber",value:function(phoneNumber){return!!phoneNumber&&[this.phonePbx,this.phoneInternalNumber,this.phonePro,this.phoneProCan,this.mobilePro,this.mobileProCan,this.phonePerso,this.phonePersoCan,this.mobilePerso,this.mobilePersoCan].includes(phoneNumber)}},{key:"getGroups",value:function(){return this.groups}},{key:"setGroups",value:function(groups){this.groups=groups}},{key:"getPersonalAudioRoomOpenInviteId",value:function(){return this.personalAudioRoomOpenInviteId}},{key:"setPersonalAudioRoomOpenInviteId",value:function(openInviteId){this.personalAudioRoomOpenInviteId=openInviteId,this.personalAudioRoomOpenInviteIdSubject.next(this.personalAudioRoomOpenInviteId)}},{key:"avatar",get:function(){return this._avatar?this._avatar:this.avatarSrc?(this._avatar={src:this.avatarSrc},this.defaultAvatar=null,this.rxSubject.next({name:"avatar"}),this._avatar):this.defaultAvatar},set:function(avatar){this._avatar=avatar}},{key:"getAvatarInBase64",value:function(){var contact=this;return new Promise((function(resolve){try{if(contact&&contact.avatar&&contact.avatar.src||resolve(),contact.avatar.src&&!contact.avatar.src.startsWith("data:image/png")){var img=new Image,canvas=document.createElement("canvas");canvas.width=120,canvas.height=120;var ctx=canvas.getContext("2d");ctx.rect(0,0,120,120),ctx.fillStyle=contact.color,ctx.fill(),img.onload=function(){ctx.drawImage(img,0,0,120,120),resolve(canvas.toDataURL("image/png"))},img.src=contact.avatar.src}else resolve(contact.avatar.src)}catch(error){resolve()}}))}},{key:"getAvatar",value:function(){var size=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,forced=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dbId&&this.lastAvatarUpdateDate){var update=crypto_js_1.MD5(crypto_js_1.enc.Latin1.parse(this.lastAvatarUpdateDate)).toString(crypto_js_1.enc.Hex);this.avatarSrc="".concat(this.avatarServerURL,"/api/avatar/").concat(this.dbId,"?size=").concat(size,"&update=").concat(update)}this.createTextAvatarImage(),this.isTv&&(this.defaultAvatar={src:"/resources/skins/rainbow/images/misc/androidtv.svg"}),!forced&&this.lastAvatarUpdateDate||(this.avatar=null)}},{key:"createTextAvatarImage",value:function(){var image=new Image,canvas=document.createElement("canvas");canvas.width=image.width=225,canvas.height=image.height=225;var ctx=canvas.getContext("2d");ctx.rect(0,0,225,225),ctx.fillStyle=this.color,ctx.fill(),ctx.font="bold 100px Helvetica",ctx.textAlign="center",ctx.fillStyle="white",ctx.fillText(this.initials,110,150),image.src=canvas.toDataURL("image/png"),this.defaultAvatar=image}},{key:"displayName",get:function(){return this._displayName},set:function(displayName){this._displayName=displayName,this.nameForLogs=config&&config.debug?displayName:displayName.charAt(0)+displayName.replace(/[^\s](?=.{1,}$)/g,"*").substr(1),this.name.value=displayName,this.rxSubject.next({name:"displayName"})}},{key:"updateName",value:function(firstName,lastName){this.firstname=firstName,this.lastname=lastName,this.computeDisplayName(),this.getAvatar()}},{key:"computeDisplayName",value:function(){var firstName=this.firstname?this.firstname.charAt(0).toUpperCase()+this.firstname.slice(1):null,lastName=this.lastname?this.lastname.charAt(0).toUpperCase()+this.lastname.slice(1):null,nickName=this.nickname?this.nickname.charAt(0).toUpperCase()+this.nickname.slice(1):null;this.isTv?(this.displayName=firstName||lastName,this.initials=this.displayName.charAt(0)):lastName&&firstName?"FL"===this.displayOrder?(this.displayName=firstName+" "+lastName,this.displayShortName=firstName+" "+lastName.charAt(0),this.initials=firstName.charAt(0)+lastName.charAt(0)):(this.displayName=lastName+" "+firstName,this.displayShortName=lastName+" "+firstName.charAt(0),this.initials=lastName.charAt(0)+firstName.charAt(0)):lastName&&!firstName?(this.displayName=this.displayShortName=lastName,this.initials=lastName.charAt(0)):nickName?(this.displayName=nickName,this.displayShortName=nickName,this.initials=nickName.charAt(0)):this.loginEmail?(this.displayName=this.loginEmail,this.displayShortName=this.loginEmail,this.initials=this.loginEmail.substring(0,2).toUpperCase()):firstName?(this.displayName=firstName,this.initials=firstName.charAt(0)):(this.displayName="Anonymous",this.displayShortName="Anonymous",this.initials="A");for(var upperCaseDisplayName=this.displayName.toUpperCase(),sum=0,i=0;i<upperCaseDisplayName.length;i++)sum+=upperCaseDisplayName.charCodeAt(i);this.colorIndex=sum%12,this.color=Contact.textAvatarColor[this.colorIndex],this.colorName=Contact.textAvatarName[this.colorIndex]}},{key:"isCPaaSGuest",value:function(){return this.roles.indexOf("guest")>=0}},{key:"isGuest",value:function(){return this.guestMode}},{key:"isAnonymousGuest",value:function(){return"A"===this.initials||"Anonymous"===this.displayName}},{key:"isBadGuest",value:function(){return this.displayName.startsWith("__guest__")||this.displayName.startsWith("__##__guest__##__")}},{key:"isGuestInitialized",value:function(){return null!==this.firstname&&this.firstname.length>0&&null!==this.lastname&&this.lastname.length>0&&"__##__guest__##__"!==this.firstname}},{key:"hasAdminRights",value:function(){return this.isSuperadmin()||this.isBusinessAdmin()||this.isAdmin()||this.isBPAdmin()}},{key:"isSuperadmin",value:function(){return this.roles.indexOf("superadmin")>=0}},{key:"isBusinessAdmin",value:function(){return this.roles.indexOf("business_admin")>=0}},{key:"isOrganizationAdmin",value:function(){return this.roles.indexOf("admin")>=0&&this.adminType===Contact.AdminType.ORGANIZATION_ADMIN}},{key:"isCompanyAdmin",value:function(){return this.roles.indexOf("admin")>=0&&this.adminType===Contact.AdminType.COMPANY_ADMIN}},{key:"isSiteAdmin",value:function(){return this.roles.indexOf("admin")>=0&&this.adminType===Contact.AdminType.SITE_ADMIN}},{key:"isAdmin",value:function(){return this.roles.indexOf("admin")>=0&&(!this.isOrganizationAdmin()||!this.isBPAdmin())}},{key:"isECAdmin",value:function(){return this.company&&!this.company.isBP&&this.isAdmin()}},{key:"isBPAdmin",value:function(){return this.isBPAdminOperations()||this.isBPAdminFinance()}},{key:"isBPAdminOperations",value:function(){return this.company&&this.company.isBP&&this.roles.indexOf("bp_admin")>=0}},{key:"isBPAdminFinance",value:function(){return this.company&&this.company.isBP&&this.roles.indexOf("bp_finance")>=0}},{key:"isBPAdminDR",value:function(){return this.isBPAdmin()&&this.company.isDR()}},{key:"isBPAdminVAD",value:function(){return this.isBPAdmin()&&this.company.isVAD()}},{key:"isBPAdminIR",value:function(){return this.isBPAdmin()&&this.company.isIR()}},{key:"isDirectoryAdmin",value:function(){return this.roles.indexOf("directory_admin")>=0}},{key:"getAdminType",value:function(){return this.roles.indexOf("admin")>=0?this.adminType:Contact.AdminType.UNDEFINED}},{key:"fileSharingEnabled",get:function(){return this._fileSharingEnabled},set:function(fileSharingEnabled){this._fileSharingEnabled=fileSharingEnabled,this.rxSubject.next({name:"fileSharingEnabled"})}},{key:"fileStorageEnabled",get:function(){return this._fileStorageEnabled},set:function(fileStorageEnabled){this._fileStorageEnabled=fileStorageEnabled,this.fileStorageEnabledSubject.next(this._fileStorageEnabled),this.rxSubject.next({name:"fileStorageEnabled"})}},{key:"instantMessagesEnabled",get:function(){return this._instantMessagesEnabled},set:function(instantMessagesEnabled){this._instantMessagesEnabled=instantMessagesEnabled,this.rxSubject.next({name:"instantMessagesEnabled"})}},{key:"changePresenceEnabled",get:function(){return this._changePresenceEnabled},set:function(changePresenceEnabled){this._changePresenceEnabled=changePresenceEnabled,this.rxSubject.next({name:"changePresenceEnabled"})}},{key:"phoneMeetingsEnabled",get:function(){return this._phoneMeetingsEnabled},set:function(phoneMeetingsEnabled){this._phoneMeetingsEnabled=phoneMeetingsEnabled,this.phoneMeetingsEnabledSubject.next(this._phoneMeetingsEnabled),this.rxSubject.next({name:"phoneMeetingsEnabled"})}},{key:"channelsEnabled",get:function(){return this._channelsEnabled},set:function(channelsEnabled){this._channelsEnabled=channelsEnabled,this.rxSubject.next({name:"channelsEnabled"})}},{key:"roomsEnabled",get:function(){return this._roomsEnabled},set:function(roomsEnabled){this._roomsEnabled=roomsEnabled,this.rxSubject.next({name:"roomsEnabled"})}},{key:"webrtcAudioEnabled",get:function(){return this._webrtcAudioEnabled},set:function(webrtcAudioEnabled){this._webrtcAudioEnabled=webrtcAudioEnabled,this.rxSubject.next({name:"webrtcAudioEnabled"})}},{key:"webrtcVideoEnabled",get:function(){return this._webrtcVideoEnabled},set:function(webrtcVideoEnabled){this._webrtcVideoEnabled=webrtcVideoEnabled,this.rxSubject.next({name:"webrtcVideoEnabled"})}},{key:"modifyProfileEnabled",get:function(){return this._modifyProfileEnabled},set:function(modifyProfileEnabled){this._modifyProfileEnabled=modifyProfileEnabled,this.rxSubject.next({name:"modifyProfileEnabled"})}},{key:"useDialOutEnabled",get:function(){return this._useDialOutEnabled},set:function(useDialOutEnabled){this._useDialOutEnabled=useDialOutEnabled,this.rxSubject.next({name:"useDialOutEnabled"})}},{key:"toString",value:function(){return this.nameForLogs}}]),Contact}();Contact.AdminType={ORGANIZATION_ADMIN:"organization_admin",COMPANY_ADMIN:"company_admin",SITE_ADMIN:"site_admin",UNDEFINED:"undefined"},Contact.NameUpdatePrio={NO_UPDATE_PRIO:0,OUTLOOK_UPDATE_PRIO:1,SERVER_UPDATE_PRIO:2,MAX_UPDATE_PRIO:99},Contact.textAvatarColor=["#ca8741","#e44647","#c62582","#9b4ce7","#6573ee","#1b70e0","#6ec7d9","#98d1b1","#7fbd40","#b2d334","#dcd232","#f1be00"],Contact.textAvatarName=["purple-lavender","purple-violet","red-coral","blue-jeanlouisdavid","green-mint","green-yellow","orange-jade","pink-lady","yellow-submarine","blue-teal"],exports.Contact=Contact},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Group=function(){function Group(id,name){var comment=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",isFavorite=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,Group),this.isFavorite=!1,this.users=[],this.sortedUserList=[],this.id=id,this.name=name,this.comment=comment,this.isFavorite=isFavorite}return _createClass(Group,null,[{key:"createFromData",value:function(data){return new Group(data.id,data.name,data.comment,data.isFavorite)}}]),Group}();exports.Group=Group},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var isArray_1=__webpack_require__(263),isObject_1=__webpack_require__(264),isFunction_1=__webpack_require__(78),UnsubscriptionError_1=__webpack_require__(265),Subscription=function(){function Subscription(unsubscribe){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,unsubscribe&&(this._ctorUnsubscribe=!0,this._unsubscribe=unsubscribe)}var empty;return Subscription.prototype.unsubscribe=function(){var errors;if(!this.closed){var _parentOrParents=this._parentOrParents,_ctorUnsubscribe=this._ctorUnsubscribe,_unsubscribe=this._unsubscribe,_subscriptions=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,_parentOrParents instanceof Subscription)_parentOrParents.remove(this);else if(null!==_parentOrParents)for(var index=0;index<_parentOrParents.length;++index)_parentOrParents[index].remove(this);if(isFunction_1.isFunction(_unsubscribe)){_ctorUnsubscribe&&(this._unsubscribe=void 0);try{_unsubscribe.call(this)}catch(e){errors=e instanceof UnsubscriptionError_1.UnsubscriptionError?flattenUnsubscriptionErrors(e.errors):[e]}}if(isArray_1.isArray(_subscriptions)){index=-1;for(var len=_subscriptions.length;++index<len;){var sub=_subscriptions[index];if(isObject_1.isObject(sub))try{sub.unsubscribe()}catch(e){errors=errors||[],e instanceof UnsubscriptionError_1.UnsubscriptionError?errors=errors.concat(flattenUnsubscriptionErrors(e.errors)):errors.push(e)}}}if(errors)throw new UnsubscriptionError_1.UnsubscriptionError(errors)}},Subscription.prototype.add=function(teardown){var subscription=teardown;if(!teardown)return Subscription.EMPTY;switch(typeof teardown){case"function":subscription=new Subscription(teardown);case"object":if(subscription===this||subscription.closed||"function"!=typeof subscription.unsubscribe)return subscription;if(this.closed)return subscription.unsubscribe(),subscription;if(!(subscription instanceof Subscription)){var tmp=subscription;(subscription=new Subscription)._subscriptions=[tmp]}break;default:throw new Error("unrecognized teardown "+teardown+" added to Subscription.")}var _parentOrParents=subscription._parentOrParents;if(null===_parentOrParents)subscription._parentOrParents=this;else if(_parentOrParents instanceof Subscription){if(_parentOrParents===this)return subscription;subscription._parentOrParents=[_parentOrParents,this]}else{if(-1!==_parentOrParents.indexOf(this))return subscription;_parentOrParents.push(this)}var subscriptions=this._subscriptions;return null===subscriptions?this._subscriptions=[subscription]:subscriptions.push(subscription),subscription},Subscription.prototype.remove=function(subscription){var subscriptions=this._subscriptions;if(subscriptions){var subscriptionIndex=subscriptions.indexOf(subscription);-1!==subscriptionIndex&&subscriptions.splice(subscriptionIndex,1)}},Subscription.EMPTY=((empty=new Subscription).closed=!0,empty),Subscription}();function flattenUnsubscriptionErrors(errors){return errors.reduce((function(errs,err){return errs.concat(err instanceof UnsubscriptionError_1.UnsubscriptionError?err.errors:err)}),[])}exports.Subscription=Subscription},function(module,exports,__webpack_require__){var C,WordArray,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),WordArray=(C=CryptoJS).lib.WordArray,C.enc.Base64={stringify:function(wordArray){var words=wordArray.words,sigBytes=wordArray.sigBytes,map=this._map;wordArray.clamp();for(var base64Chars=[],i=0;i<sigBytes;i+=3)for(var triplet=(words[i>>>2]>>>24-i%4*8&255)<<16|(words[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|words[i+2>>>2]>>>24-(i+2)%4*8&255,j=0;j<4&&i+.75*j<sigBytes;j++)base64Chars.push(map.charAt(triplet>>>6*(3-j)&63));var paddingChar=map.charAt(64);if(paddingChar)for(;base64Chars.length%4;)base64Chars.push(paddingChar);return base64Chars.join("")},parse:function(base64Str){var base64StrLength=base64Str.length,map=this._map,reverseMap=this._reverseMap;if(!reverseMap){reverseMap=this._reverseMap=[];for(var j=0;j<map.length;j++)reverseMap[map.charCodeAt(j)]=j}var paddingChar=map.charAt(64);if(paddingChar){var paddingIndex=base64Str.indexOf(paddingChar);-1!==paddingIndex&&(base64StrLength=paddingIndex)}return function(base64Str,base64StrLength,reverseMap){for(var words=[],nBytes=0,i=0;i<base64StrLength;i++)if(i%4){var bits1=reverseMap[base64Str.charCodeAt(i-1)]<<i%4*2,bits2=reverseMap[base64Str.charCodeAt(i)]>>>6-i%4*2;words[nBytes>>>2]|=(bits1|bits2)<<24-nBytes%4*8,nBytes++}return WordArray.create(words,nBytes)}(base64Str,base64StrLength,reverseMap)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},CryptoJS.enc.Base64)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),function(Math){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,T=[];!function(){for(var i=0;i<64;i++)T[i]=4294967296*Math.abs(Math.sin(i+1))|0}();var MD5=C_algo.MD5=Hasher.extend({_doReset:function(){this._hash=new WordArray.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(M,offset){for(var i=0;i<16;i++){var offset_i=offset+i,M_offset_i=M[offset_i];M[offset_i]=16711935&(M_offset_i<<8|M_offset_i>>>24)|4278255360&(M_offset_i<<24|M_offset_i>>>8)}var H=this._hash.words,M_offset_0=M[offset+0],M_offset_1=M[offset+1],M_offset_2=M[offset+2],M_offset_3=M[offset+3],M_offset_4=M[offset+4],M_offset_5=M[offset+5],M_offset_6=M[offset+6],M_offset_7=M[offset+7],M_offset_8=M[offset+8],M_offset_9=M[offset+9],M_offset_10=M[offset+10],M_offset_11=M[offset+11],M_offset_12=M[offset+12],M_offset_13=M[offset+13],M_offset_14=M[offset+14],M_offset_15=M[offset+15],a=H[0],b=H[1],c=H[2],d=H[3];a=FF(a,b,c,d,M_offset_0,7,T[0]),d=FF(d,a,b,c,M_offset_1,12,T[1]),c=FF(c,d,a,b,M_offset_2,17,T[2]),b=FF(b,c,d,a,M_offset_3,22,T[3]),a=FF(a,b,c,d,M_offset_4,7,T[4]),d=FF(d,a,b,c,M_offset_5,12,T[5]),c=FF(c,d,a,b,M_offset_6,17,T[6]),b=FF(b,c,d,a,M_offset_7,22,T[7]),a=FF(a,b,c,d,M_offset_8,7,T[8]),d=FF(d,a,b,c,M_offset_9,12,T[9]),c=FF(c,d,a,b,M_offset_10,17,T[10]),b=FF(b,c,d,a,M_offset_11,22,T[11]),a=FF(a,b,c,d,M_offset_12,7,T[12]),d=FF(d,a,b,c,M_offset_13,12,T[13]),c=FF(c,d,a,b,M_offset_14,17,T[14]),a=GG(a,b=FF(b,c,d,a,M_offset_15,22,T[15]),c,d,M_offset_1,5,T[16]),d=GG(d,a,b,c,M_offset_6,9,T[17]),c=GG(c,d,a,b,M_offset_11,14,T[18]),b=GG(b,c,d,a,M_offset_0,20,T[19]),a=GG(a,b,c,d,M_offset_5,5,T[20]),d=GG(d,a,b,c,M_offset_10,9,T[21]),c=GG(c,d,a,b,M_offset_15,14,T[22]),b=GG(b,c,d,a,M_offset_4,20,T[23]),a=GG(a,b,c,d,M_offset_9,5,T[24]),d=GG(d,a,b,c,M_offset_14,9,T[25]),c=GG(c,d,a,b,M_offset_3,14,T[26]),b=GG(b,c,d,a,M_offset_8,20,T[27]),a=GG(a,b,c,d,M_offset_13,5,T[28]),d=GG(d,a,b,c,M_offset_2,9,T[29]),c=GG(c,d,a,b,M_offset_7,14,T[30]),a=HH(a,b=GG(b,c,d,a,M_offset_12,20,T[31]),c,d,M_offset_5,4,T[32]),d=HH(d,a,b,c,M_offset_8,11,T[33]),c=HH(c,d,a,b,M_offset_11,16,T[34]),b=HH(b,c,d,a,M_offset_14,23,T[35]),a=HH(a,b,c,d,M_offset_1,4,T[36]),d=HH(d,a,b,c,M_offset_4,11,T[37]),c=HH(c,d,a,b,M_offset_7,16,T[38]),b=HH(b,c,d,a,M_offset_10,23,T[39]),a=HH(a,b,c,d,M_offset_13,4,T[40]),d=HH(d,a,b,c,M_offset_0,11,T[41]),c=HH(c,d,a,b,M_offset_3,16,T[42]),b=HH(b,c,d,a,M_offset_6,23,T[43]),a=HH(a,b,c,d,M_offset_9,4,T[44]),d=HH(d,a,b,c,M_offset_12,11,T[45]),c=HH(c,d,a,b,M_offset_15,16,T[46]),a=II(a,b=HH(b,c,d,a,M_offset_2,23,T[47]),c,d,M_offset_0,6,T[48]),d=II(d,a,b,c,M_offset_7,10,T[49]),c=II(c,d,a,b,M_offset_14,15,T[50]),b=II(b,c,d,a,M_offset_5,21,T[51]),a=II(a,b,c,d,M_offset_12,6,T[52]),d=II(d,a,b,c,M_offset_3,10,T[53]),c=II(c,d,a,b,M_offset_10,15,T[54]),b=II(b,c,d,a,M_offset_1,21,T[55]),a=II(a,b,c,d,M_offset_8,6,T[56]),d=II(d,a,b,c,M_offset_15,10,T[57]),c=II(c,d,a,b,M_offset_6,15,T[58]),b=II(b,c,d,a,M_offset_13,21,T[59]),a=II(a,b,c,d,M_offset_4,6,T[60]),d=II(d,a,b,c,M_offset_11,10,T[61]),c=II(c,d,a,b,M_offset_2,15,T[62]),b=II(b,c,d,a,M_offset_9,21,T[63]),H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;var nBitsTotalH=Math.floor(nBitsTotal/4294967296),nBitsTotalL=nBitsTotal;dataWords[15+(nBitsLeft+64>>>9<<4)]=16711935&(nBitsTotalH<<8|nBitsTotalH>>>24)|4278255360&(nBitsTotalH<<24|nBitsTotalH>>>8),dataWords[14+(nBitsLeft+64>>>9<<4)]=16711935&(nBitsTotalL<<8|nBitsTotalL>>>24)|4278255360&(nBitsTotalL<<24|nBitsTotalL>>>8),data.sigBytes=4*(dataWords.length+1),this._process();for(var hash=this._hash,H=hash.words,i=0;i<4;i++){var H_i=H[i];H[i]=16711935&(H_i<<8|H_i>>>24)|4278255360&(H_i<<24|H_i>>>8)}return hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});function FF(a,b,c,d,x,s,t){var n=a+(b&c|~b&d)+x+t;return(n<<s|n>>>32-s)+b}function GG(a,b,c,d,x,s,t){var n=a+(b&d|c&~d)+x+t;return(n<<s|n>>>32-s)+b}function HH(a,b,c,d,x,s,t){var n=a+(b^c^d)+x+t;return(n<<s|n>>>32-s)+b}function II(a,b,c,d,x,s,t){var n=a+(c^(b|~d))+x+t;return(n<<s|n>>>32-s)+b}C.MD5=Hasher._createHelper(MD5),C.HmacMD5=Hasher._createHmacHelper(MD5)}(Math),CryptoJS.MD5)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var int64_buffer_1=__webpack_require__(230),EBMLEncoder_1=__webpack_require__(231),_Buffer=__webpack_require__(57),_tools=__webpack_require__(398),_block=__webpack_require__(399);function WebPBlockFilter(elms){return elms.reduce((function(lst,elm){return"b"!==elm.type||"SimpleBlock"!==elm.name?lst:exports.ebmlBlock(elm.data).frames.some((function(frame){return"9d012a"===frame.slice(3,6).toString("hex")}))?lst.concat(elm):lst}),[])}function VP8BitStreamToRiffWebPBuffer(frame){var VP8Chunk=createRIFFChunk("VP8 ",frame);return createRIFFChunk("RIFF",concat([new exports.Buffer("WEBP","ascii"),VP8Chunk]))}function createRIFFChunk(FourCC,chunk){var chunkSize=new exports.Buffer(4);return chunkSize.writeUInt32LE(chunk.byteLength,0),concat([new exports.Buffer(FourCC.substr(0,4),"ascii"),chunkSize,chunk,new exports.Buffer(chunk.byteLength%2==0?0:1)])}function removeElement(idName,metadata){for(var start=-1,i=0;i<metadata.length;i++){var element=metadata[i];if(element.name===idName){if("m"!==element.type)return void metadata.splice(i,1);if(element.isEnd){if(-1==start)throw new Error("Detected "+idName+" closing element before finding the start");return void metadata.splice(start,i-start+1)}start=i}}}function extractElement(idName,metadata){for(var result=[],start=-1,i=0;i<metadata.length;i++){var element=metadata[i];if(element.name===idName){if("m"!==element.type){result.push(metadata[i]);break}if(element.isEnd){if(-1==start)throw new Error("Detected "+idName+" closing element before finding the start");result=metadata.slice(start,i+1);break}start=i}}return result}function encodedSizeOfEbml(refinedMetaData){var encorder=new EBMLEncoder_1.default;return refinedMetaData.reduce((function(lst,elm){return lst.concat(encorder.encode([elm]))}),[]).reduce((function(o,buf){return o+buf.byteLength}),0)}function refineMetadata(mesetadata,sizeDiff,info){var duration=info.duration,clusterPtrs=info.clusterPtrs,cues=info.cues,_metadata=mesetadata.slice(0);if("number"==typeof duration){var overwrited_1=!1;_metadata.forEach((function(elm){"f"===elm.type&&"Duration"===elm.name&&(overwrited_1=!0,elm.data=createFloatBuffer(duration,8))})),overwrited_1||insertTag(_metadata,"Info",[{name:"Duration",type:"f",data:createFloatBuffer(duration,8)}])}Array.isArray(cues)&&insertTag(_metadata,"Cues",function(cueInfos,sizeDiff){var cues=[];return cueInfos.forEach((function(_a){var CueTrack=_a.CueTrack,CueClusterPosition=_a.CueClusterPosition,CueTime=_a.CueTime;cues.push({name:"CuePoint",type:"m",isEnd:!1}),cues.push({name:"CueTime",type:"u",data:createUIntBuffer(CueTime)}),cues.push({name:"CueTrackPositions",type:"m",isEnd:!1}),cues.push({name:"CueTrack",type:"u",data:createUIntBuffer(CueTrack)}),cues.push({name:"CueClusterPosition",type:"u",data:createUIntBuffer(CueClusterPosition+sizeDiff)}),cues.push({name:"CueTrackPositions",type:"m",isEnd:!0}),cues.push({name:"CuePoint",type:"m",isEnd:!0})})),cues}(cues,sizeDiff));var seekhead_children=[];return Array.isArray(clusterPtrs)&&(console.warn("append cluster pointers to seekhead is deprecated. please use cues"),seekhead_children=function(clusterPtrs,sizeDiff){var seeks=[];return clusterPtrs.forEach((function(start){seeks.push({name:"Seek",type:"m",isEnd:!1}),seeks.push({name:"SeekID",type:"b",data:new exports.Buffer([31,67,182,117])}),seeks.push({name:"SeekPosition",type:"u",data:createUIntBuffer(start+sizeDiff)}),seeks.push({name:"Seek",type:"m",isEnd:!0})})),seeks}(clusterPtrs,sizeDiff)),insertTag(_metadata,"SeekHead",seekhead_children,!0),_metadata}function insertTag(_metadata,tagName,children,insertHead){void 0===insertHead&&(insertHead=!1);for(var idx=-1,i=0;i<_metadata.length;i++){var elm=_metadata[i];if("m"===elm.type&&elm.name===tagName&&!1===elm.isEnd){idx=i;break}}idx>=0?Array.prototype.splice.apply(_metadata,[idx+1,0].concat(children)):insertHead?[].concat([{name:tagName,type:"m",isEnd:!1}],children,[{name:tagName,type:"m",isEnd:!0}]).reverse().forEach((function(elm){_metadata.unshift(elm)})):(_metadata.push({name:tagName,type:"m",isEnd:!1}),children.forEach((function(elm){_metadata.push(elm)})),_metadata.push({name:tagName,type:"m",isEnd:!0}))}function concat(list){for(var i=0,length=0;i<list.length;++i)length+=list[i].length;var buffer=exports.Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];buf.copy(buffer,pos),pos+=buf.length}return buffer}function createUIntBuffer(value){for(var bytes=1;value>=Math.pow(2,8*bytes);bytes++);if(bytes>=7)return console.warn("7bit or more bigger uint not supported."),new int64_buffer_1.Uint64BE(value).toBuffer();var data=new exports.Buffer(bytes);return data.writeUIntBE(value,0,bytes),data}function createIntBuffer(value){for(var bytes=1;value>=Math.pow(2,8*bytes);bytes++);if(bytes>=7)return console.warn("7bit or more bigger uint not supported."),new int64_buffer_1.Int64BE(value).toBuffer();var data=new exports.Buffer(bytes);return data.writeIntBE(value,0,bytes),data}function createFloatBuffer(value,bytes){var data;if(void 0===bytes&&(bytes=8),8===bytes)return(data=new exports.Buffer(8)).writeDoubleBE(value,0),data;if(4===bytes)return(data=new exports.Buffer(4)).writeFloatBE(value,0),data;throw new Error("float type bits must 4bytes or 8bytes")}exports.Buffer=_Buffer.Buffer,exports.readVint=_tools.readVint,exports.writeVint=_tools.writeVint,exports.ebmlBlock=_block,exports.readBlock=function(buf){return exports.ebmlBlock(new exports.Buffer(buf))},exports.encodeTag=function(tagId,tagData,unknownSize){return void 0===unknownSize&&(unknownSize=!1),concat([tagId,unknownSize?new exports.Buffer("01ffffffffffffff","hex"):exports.writeVint(tagData.length),tagData])},exports.WebPFrameFilter=function(elms){return WebPBlockFilter(elms).reduce((function(lst,elm){return exports.ebmlBlock(elm.data).frames.reduce((function(lst,frame){var webpBuf=VP8BitStreamToRiffWebPBuffer(frame),webp=new Blob([webpBuf],{type:"image/webp"});return lst.concat(webp)}),lst)}),[])},exports.WebPBlockFilter=WebPBlockFilter,exports.VP8BitStreamToRiffWebPBuffer=VP8BitStreamToRiffWebPBuffer,exports.createRIFFChunk=createRIFFChunk,exports.makeMetadataSeekable=function(originalMetadata,duration,cuesInfo){var header=extractElement("EBML",originalMetadata),segmentContentStartPos=encodedSizeOfEbml(header)+12,originalMetadataSize=originalMetadata[originalMetadata.length-1].dataEnd-segmentContentStartPos,info=extractElement("Info",originalMetadata);removeElement("Duration",info),info.splice(1,0,{name:"Duration",type:"f",data:createFloatBuffer(duration,8)});for(var infoSize=encodedSizeOfEbml(info),tracks=extractElement("Tracks",originalMetadata),tracksSize=encodedSizeOfEbml(tracks),seekHeadSize=47,seekHead=[],cuesSize=5+15*cuesInfo.length,cues=[],lastSizeDifference=-1,_loop_1=function(i){var infoStart=seekHeadSize,tracksStart=infoStart+infoSize,cuesStart=tracksStart+tracksSize,sizeDifference=cuesStart+cuesSize-originalMetadataSize;if((seekHead=[]).push({name:"SeekHead",type:"m",isEnd:!1}),seekHead.push({name:"Seek",type:"m",isEnd:!1}),seekHead.push({name:"SeekID",type:"b",data:new exports.Buffer([21,73,169,102])}),seekHead.push({name:"SeekPosition",type:"u",data:createUIntBuffer(infoStart)}),seekHead.push({name:"Seek",type:"m",isEnd:!0}),seekHead.push({name:"Seek",type:"m",isEnd:!1}),seekHead.push({name:"SeekID",type:"b",data:new exports.Buffer([22,84,174,107])}),seekHead.push({name:"SeekPosition",type:"u",data:createUIntBuffer(tracksStart)}),seekHead.push({name:"Seek",type:"m",isEnd:!0}),seekHead.push({name:"Seek",type:"m",isEnd:!1}),seekHead.push({name:"SeekID",type:"b",data:new exports.Buffer([28,83,187,107])}),seekHead.push({name:"SeekPosition",type:"u",data:createUIntBuffer(cuesStart)}),seekHead.push({name:"Seek",type:"m",isEnd:!0}),seekHead.push({name:"SeekHead",type:"m",isEnd:!0}),seekHeadSize=encodedSizeOfEbml(seekHead),(cues=[]).push({name:"Cues",type:"m",isEnd:!1}),cuesInfo.forEach((function(_a){var CueTrack=_a.CueTrack,CueClusterPosition=_a.CueClusterPosition,CueTime=_a.CueTime;cues.push({name:"CuePoint",type:"m",isEnd:!1}),cues.push({name:"CueTime",type:"u",data:createUIntBuffer(CueTime)}),cues.push({name:"CueTrackPositions",type:"m",isEnd:!1}),cues.push({name:"CueTrack",type:"u",data:createUIntBuffer(CueTrack)}),CueClusterPosition-=segmentContentStartPos,CueClusterPosition+=sizeDifference,cues.push({name:"CueClusterPosition",type:"u",data:createUIntBuffer(CueClusterPosition)}),cues.push({name:"CueTrackPositions",type:"m",isEnd:!0}),cues.push({name:"CuePoint",type:"m",isEnd:!0})})),cues.push({name:"Cues",type:"m",isEnd:!0}),cuesSize=encodedSizeOfEbml(cues),lastSizeDifference===sizeDifference)return"break";if(lastSizeDifference=sizeDifference,9===i)throw new Error("Failed to converge to a stable metadata size")},i=0;i<10&&"break"!==_loop_1(i);i++);var finalMetadata=[].concat.apply([],[header,{name:"Segment",type:"m",isEnd:!1,unknownSize:!0},seekHead,info,tracks,cues]);return(new EBMLEncoder_1.default).encode(finalMetadata)},exports.removeElement=removeElement,exports.extractElement=extractElement,exports.putRefinedMetaData=function(metadata,info){Array.isArray(info.cueInfos)&&!Array.isArray(info.cues)&&(console.warn("putRefinedMetaData: info.cueInfos property is deprecated. please use info.cues"),info.cues=info.cueInfos);for(var ebml=[],payload=[],i_1=0;i_1<metadata.length;i_1++){var elm=metadata[i_1];if("m"===elm.type&&"Segment"===elm.name){if(ebml=metadata.slice(0,i_1),payload=metadata.slice(i_1),elm.unknownSize){payload.shift();break}throw new Error("this metadata is not streaming webm file")}}if(!(payload[payload.length-1].dataEnd>0))throw new Error("metadata dataEnd has wrong number");var i,originalPayloadOffsetEnd=payload[payload.length-1].dataEnd,ebmlSize=ebml[ebml.length-1].dataEnd,offsetDiff=(new EBMLEncoder_1.default).encode(ebml).byteLength-ebmlSize,payloadSize=originalPayloadOffsetEnd-payload[0].tagStart,segmentTagBuf=(payload[0].tagStart,payload[0].tagStart,new exports.Buffer([24,83,128,103])),segmentSizeBuf=new exports.Buffer("01ffffffffffffff","hex"),_segmentSize=segmentTagBuf.byteLength+segmentSizeBuf.byteLength,newPayloadSize=payloadSize;for(i=1;i<20;i++){var refined=refineMetadata(payload,offsetDiff+(ebmlSize+_segmentSize+newPayloadSize-originalPayloadOffsetEnd),info),newNewRefinedSize=(new EBMLEncoder_1.default).encode(refined).byteLength;if(newNewRefinedSize===newPayloadSize)return(new EBMLEncoder_1.default).encode([].concat(ebml,[{type:"m",name:"Segment",isEnd:!1,unknownSize:!0}],refined));newPayloadSize=newNewRefinedSize}throw new Error("unable to refine metadata, stable size could not be found in "+i+" iterations!")},exports.concat=concat,exports.encodeValueToBuffer=function(elm){var data=new exports.Buffer(0);if("m"===elm.type)return elm;switch(elm.type){case"u":data=createUIntBuffer(elm.value);break;case"i":data=createIntBuffer(elm.value);break;case"f":data=createFloatBuffer(elm.value);break;case"s":data=new exports.Buffer(elm.value,"ascii");break;case"8":data=new exports.Buffer(elm.value,"utf8");break;case"b":data=elm.value;break;case"d":data=new int64_buffer_1.Int64BE(elm.value.getTime().toString()).toBuffer()}return Object.assign({},elm,{data:data})},exports.createUIntBuffer=createUIntBuffer,exports.createIntBuffer=createIntBuffer,exports.createFloatBuffer=createFloatBuffer,exports.convertEBMLDateToJSDate=function(int64str){return int64str instanceof Date?int64str:new Date(new Date("2001-01-01T00:00:00.000Z").getTime()+Number(int64str)/1e3/1e3)}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var logger_service_1=__webpack_require__(15),PromiseQueue=function(){function PromiseQueue(){_classCallCheck(this,PromiseQueue),this.queue=[],this.started=!1}return _createClass(PromiseQueue,[{key:"add",value:function(promise){this.queue.push(promise),this.started||(this.started=!0,this.execute())}},{key:"execute",value:function(){var _this105=this,promise=this.queue.shift();if(promise)try{this.timeoutPromise(2e4,promise).then((function(){_this105.execute()})).catch((function(error){var errorMessage=error&&error.message?error.message:"Unknown error";logger_service_1.default.error("[PromiseQueue] execute failure -- "+errorMessage),_this105.execute()}))}catch(error){var errorMessage=error&&error.message?error.message:"Unknown error",errorStack=error&&error.stack?error.stack:"Unknown stack";logger_service_1.default.error("[PromiseQueue] execution exception  -- ".concat(errorMessage," : ").concat(errorStack)),this.execute()}else this.started=!1}},{key:"timeoutPromise",value:function(ms,promise){var timeoutId=null,timeout=new Promise((function(__resolve,reject){timeoutId=setTimeout((function(){reject(new Error("Timed out in "+ms+"ms."))}),ms)}));return Promise.race([promise(),timeout]).then((function(value){return clearTimeout(timeoutId),value}))}}],[{key:"create",value:function(){return new PromiseQueue}}]),PromiseQueue}();exports.PromiseQueue=PromiseQueue},function(module,__webpack_exports__,__webpack_require__){function isObject(x){return null!==x&&"object"==typeof x}__webpack_require__.d(__webpack_exports__,"a",(function(){return isObject}))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return canReportError}));var _Subscriber__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11);function canReportError(observer){for(;observer;){var _a=observer,closed_1=_a.closed,destination=_a.destination,isStopped=_a.isStopped;if(closed_1||isStopped)return!1;observer=destination&&destination instanceof _Subscriber__WEBPACK_IMPORTED_MODULE_0__.a?destination:null}return!0}},function(module,exports,__webpack_require__){var SDPUtils={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};SDPUtils.localCName=SDPUtils.generateIdentifier(),SDPUtils.splitLines=function(blob){return blob.trim().split("\n").map((function(line){return line.trim()}))},SDPUtils.splitSections=function(blob){return blob.split("\nm=").map((function(part,index){return(index>0?"m="+part:part).trim()+"\r\n"}))},SDPUtils.getDescription=function(blob){var sections=SDPUtils.splitSections(blob);return sections&&sections[0]},SDPUtils.getMediaSections=function(blob){var sections=SDPUtils.splitSections(blob);return sections.shift(),sections},SDPUtils.matchPrefix=function(blob,prefix){return SDPUtils.splitLines(blob).filter((function(line){return 0===line.indexOf(prefix)}))},SDPUtils.parseCandidate=function(line){for(var parts,candidate={foundation:(parts=0===line.indexOf("a=candidate:")?line.substring(12).split(" "):line.substring(10).split(" "))[0],component:parseInt(parts[1],10),protocol:parts[2].toLowerCase(),priority:parseInt(parts[3],10),ip:parts[4],address:parts[4],port:parseInt(parts[5],10),type:parts[7]},i=8;i<parts.length;i+=2)switch(parts[i]){case"raddr":candidate.relatedAddress=parts[i+1];break;case"rport":candidate.relatedPort=parseInt(parts[i+1],10);break;case"tcptype":candidate.tcpType=parts[i+1];break;case"ufrag":candidate.ufrag=parts[i+1],candidate.usernameFragment=parts[i+1];break;default:candidate[parts[i]]=parts[i+1]}return candidate},SDPUtils.writeCandidate=function(candidate){var sdp=[];sdp.push(candidate.foundation),sdp.push(candidate.component),sdp.push(candidate.protocol.toUpperCase()),sdp.push(candidate.priority),sdp.push(candidate.address||candidate.ip),sdp.push(candidate.port);var type=candidate.type;return sdp.push("typ"),sdp.push(type),"host"!==type&&candidate.relatedAddress&&candidate.relatedPort&&(sdp.push("raddr"),sdp.push(candidate.relatedAddress),sdp.push("rport"),sdp.push(candidate.relatedPort)),candidate.tcpType&&"tcp"===candidate.protocol.toLowerCase()&&(sdp.push("tcptype"),sdp.push(candidate.tcpType)),(candidate.usernameFragment||candidate.ufrag)&&(sdp.push("ufrag"),sdp.push(candidate.usernameFragment||candidate.ufrag)),"candidate:"+sdp.join(" ")},SDPUtils.parseIceOptions=function(line){return line.substr(14).split(" ")},SDPUtils.parseRtpMap=function(line){var parts=line.substr(9).split(" "),parsed={payloadType:parseInt(parts.shift(),10)};return parts=parts[0].split("/"),parsed.name=parts[0],parsed.clockRate=parseInt(parts[1],10),parsed.channels=3===parts.length?parseInt(parts[2],10):1,parsed.numChannels=parsed.channels,parsed},SDPUtils.writeRtpMap=function(codec){var pt=codec.payloadType;void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType);var channels=codec.channels||codec.numChannels||1;return"a=rtpmap:"+pt+" "+codec.name+"/"+codec.clockRate+(1!==channels?"/"+channels:"")+"\r\n"},SDPUtils.parseExtmap=function(line){var parts=line.substr(9).split(" ");return{id:parseInt(parts[0],10),direction:parts[0].indexOf("/")>0?parts[0].split("/")[1]:"sendrecv",uri:parts[1]}},SDPUtils.writeExtmap=function(headerExtension){return"a=extmap:"+(headerExtension.id||headerExtension.preferredId)+(headerExtension.direction&&"sendrecv"!==headerExtension.direction?"/"+headerExtension.direction:"")+" "+headerExtension.uri+"\r\n"},SDPUtils.parseFmtp=function(line){for(var kv,parsed={},parts=line.substr(line.indexOf(" ")+1).split(";"),j=0;j<parts.length;j++)parsed[(kv=parts[j].trim().split("="))[0].trim()]=kv[1];return parsed},SDPUtils.writeFmtp=function(codec){var line="",pt=codec.payloadType;if(void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.parameters&&Object.keys(codec.parameters).length){var params=[];Object.keys(codec.parameters).forEach((function(param){codec.parameters[param]?params.push(param+"="+codec.parameters[param]):params.push(param)})),line+="a=fmtp:"+pt+" "+params.join(";")+"\r\n"}return line},SDPUtils.parseRtcpFb=function(line){var parts=line.substr(line.indexOf(" ")+1).split(" ");return{type:parts.shift(),parameter:parts.join(" ")}},SDPUtils.writeRtcpFb=function(codec){var lines="",pt=codec.payloadType;return void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.rtcpFeedback&&codec.rtcpFeedback.length&&codec.rtcpFeedback.forEach((function(fb){lines+="a=rtcp-fb:"+pt+" "+fb.type+(fb.parameter&&fb.parameter.length?" "+fb.parameter:"")+"\r\n"})),lines},SDPUtils.parseSsrcMedia=function(line){var sp=line.indexOf(" "),parts={ssrc:parseInt(line.substr(7,sp-7),10)},colon=line.indexOf(":",sp);return colon>-1?(parts.attribute=line.substr(sp+1,colon-sp-1),parts.value=line.substr(colon+1)):parts.attribute=line.substr(sp+1),parts},SDPUtils.parseSsrcGroup=function(line){var parts=line.substr(13).split(" ");return{semantics:parts.shift(),ssrcs:parts.map((function(ssrc){return parseInt(ssrc,10)}))}},SDPUtils.getMid=function(mediaSection){var mid=SDPUtils.matchPrefix(mediaSection,"a=mid:")[0];if(mid)return mid.substr(6)},SDPUtils.parseFingerprint=function(line){var parts=line.substr(14).split(" ");return{algorithm:parts[0].toLowerCase(),value:parts[1]}},SDPUtils.getDtlsParameters=function(mediaSection,sessionpart){return{role:"auto",fingerprints:SDPUtils.matchPrefix(mediaSection+sessionpart,"a=fingerprint:").map(SDPUtils.parseFingerprint)}},SDPUtils.writeDtlsParameters=function(params,setupType){var sdp="a=setup:"+setupType+"\r\n";return params.fingerprints.forEach((function(fp){sdp+="a=fingerprint:"+fp.algorithm+" "+fp.value+"\r\n"})),sdp},SDPUtils.parseCryptoLine=function(line){var parts=line.substr(9).split(" ");return{tag:parseInt(parts[0],10),cryptoSuite:parts[1],keyParams:parts[2],sessionParams:parts.slice(3)}},SDPUtils.writeCryptoLine=function(parameters){return"a=crypto:"+parameters.tag+" "+parameters.cryptoSuite+" "+("object"==typeof parameters.keyParams?SDPUtils.writeCryptoKeyParams(parameters.keyParams):parameters.keyParams)+(parameters.sessionParams?" "+parameters.sessionParams.join(" "):"")+"\r\n"},SDPUtils.parseCryptoKeyParams=function(keyParams){if(0!==keyParams.indexOf("inline:"))return null;var parts=keyParams.substr(7).split("|");return{keyMethod:"inline",keySalt:parts[0],lifeTime:parts[1],mkiValue:parts[2]?parts[2].split(":")[0]:void 0,mkiLength:parts[2]?parts[2].split(":")[1]:void 0}},SDPUtils.writeCryptoKeyParams=function(keyParams){return keyParams.keyMethod+":"+keyParams.keySalt+(keyParams.lifeTime?"|"+keyParams.lifeTime:"")+(keyParams.mkiValue&&keyParams.mkiLength?"|"+keyParams.mkiValue+":"+keyParams.mkiLength:"")},SDPUtils.getCryptoParameters=function(mediaSection,sessionpart){return SDPUtils.matchPrefix(mediaSection+sessionpart,"a=crypto:").map(SDPUtils.parseCryptoLine)},SDPUtils.getIceParameters=function(mediaSection,sessionpart){var ufrag=SDPUtils.matchPrefix(mediaSection+sessionpart,"a=ice-ufrag:")[0],pwd=SDPUtils.matchPrefix(mediaSection+sessionpart,"a=ice-pwd:")[0];return ufrag&&pwd?{usernameFragment:ufrag.substr(12),password:pwd.substr(10)}:null},SDPUtils.writeIceParameters=function(params){return"a=ice-ufrag:"+params.usernameFragment+"\r\na=ice-pwd:"+params.password+"\r\n"},SDPUtils.parseRtpParameters=function(mediaSection){for(var description={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},mline=SDPUtils.splitLines(mediaSection)[0].split(" "),i=3;i<mline.length;i++){var pt=mline[i],rtpmapline=SDPUtils.matchPrefix(mediaSection,"a=rtpmap:"+pt+" ")[0];if(rtpmapline){var codec=SDPUtils.parseRtpMap(rtpmapline),fmtps=SDPUtils.matchPrefix(mediaSection,"a=fmtp:"+pt+" ");switch(codec.parameters=fmtps.length?SDPUtils.parseFmtp(fmtps[0]):{},codec.rtcpFeedback=SDPUtils.matchPrefix(mediaSection,"a=rtcp-fb:"+pt+" ").map(SDPUtils.parseRtcpFb),description.codecs.push(codec),codec.name.toUpperCase()){case"RED":case"ULPFEC":description.fecMechanisms.push(codec.name.toUpperCase())}}}return SDPUtils.matchPrefix(mediaSection,"a=extmap:").forEach((function(line){description.headerExtensions.push(SDPUtils.parseExtmap(line))})),description},SDPUtils.writeRtpDescription=function(kind,caps){var sdp="";sdp+="m="+kind+" ",sdp+=caps.codecs.length>0?"9":"0",sdp+=" UDP/TLS/RTP/SAVPF ",sdp+=caps.codecs.map((function(codec){return void 0!==codec.preferredPayloadType?codec.preferredPayloadType:codec.payloadType})).join(" ")+"\r\n",sdp+="c=IN IP4 0.0.0.0\r\n",sdp+="a=rtcp:9 IN IP4 0.0.0.0\r\n",caps.codecs.forEach((function(codec){sdp+=SDPUtils.writeRtpMap(codec),sdp+=SDPUtils.writeFmtp(codec),sdp+=SDPUtils.writeRtcpFb(codec)}));var maxptime=0;return caps.codecs.forEach((function(codec){codec.maxptime>maxptime&&(maxptime=codec.maxptime)})),maxptime>0&&(sdp+="a=maxptime:"+maxptime+"\r\n"),sdp+="a=rtcp-mux\r\n",caps.headerExtensions&&caps.headerExtensions.forEach((function(extension){sdp+=SDPUtils.writeExtmap(extension)})),sdp},SDPUtils.parseRtpEncodingParameters=function(mediaSection){var secondarySsrc,encodingParameters=[],description=SDPUtils.parseRtpParameters(mediaSection),hasRed=-1!==description.fecMechanisms.indexOf("RED"),hasUlpfec=-1!==description.fecMechanisms.indexOf("ULPFEC"),ssrcs=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(parts){return"cname"===parts.attribute})),primarySsrc=ssrcs.length>0&&ssrcs[0].ssrc,flows=SDPUtils.matchPrefix(mediaSection,"a=ssrc-group:FID").map((function(line){return line.substr(17).split(" ").map((function(part){return parseInt(part,10)}))}));flows.length>0&&flows[0].length>1&&flows[0][0]===primarySsrc&&(secondarySsrc=flows[0][1]),description.codecs.forEach((function(codec){if("RTX"===codec.name.toUpperCase()&&codec.parameters.apt){var encParam={ssrc:primarySsrc,codecPayloadType:parseInt(codec.parameters.apt,10)};primarySsrc&&secondarySsrc&&(encParam.rtx={ssrc:secondarySsrc}),encodingParameters.push(encParam),hasRed&&((encParam=JSON.parse(JSON.stringify(encParam))).fec={ssrc:primarySsrc,mechanism:hasUlpfec?"red+ulpfec":"red"},encodingParameters.push(encParam))}})),0===encodingParameters.length&&primarySsrc&&encodingParameters.push({ssrc:primarySsrc});var bandwidth=SDPUtils.matchPrefix(mediaSection,"b=");return bandwidth.length&&(bandwidth=0===bandwidth[0].indexOf("b=TIAS:")?parseInt(bandwidth[0].substr(7),10):0===bandwidth[0].indexOf("b=AS:")?1e3*parseInt(bandwidth[0].substr(5),10)*.95-16e3:void 0,encodingParameters.forEach((function(params){params.maxBitrate=bandwidth}))),encodingParameters},SDPUtils.parseRtcpParameters=function(mediaSection){var rtcpParameters={},remoteSsrc=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(obj){return"cname"===obj.attribute}))[0];remoteSsrc&&(rtcpParameters.cname=remoteSsrc.value,rtcpParameters.ssrc=remoteSsrc.ssrc);var rsize=SDPUtils.matchPrefix(mediaSection,"a=rtcp-rsize");rtcpParameters.reducedSize=rsize.length>0,rtcpParameters.compound=0===rsize.length;var mux=SDPUtils.matchPrefix(mediaSection,"a=rtcp-mux");return rtcpParameters.mux=mux.length>0,rtcpParameters},SDPUtils.parseMsid=function(mediaSection){var parts,spec=SDPUtils.matchPrefix(mediaSection,"a=msid:");if(1===spec.length)return{stream:(parts=spec[0].substr(7).split(" "))[0],track:parts[1]};var planB=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(msidParts){return"msid"===msidParts.attribute}));return planB.length>0?{stream:(parts=planB[0].value.split(" "))[0],track:parts[1]}:void 0},SDPUtils.parseSctpDescription=function(mediaSection){var maxMessageSize,mline=SDPUtils.parseMLine(mediaSection),maxSizeLine=SDPUtils.matchPrefix(mediaSection,"a=max-message-size:");maxSizeLine.length>0&&(maxMessageSize=parseInt(maxSizeLine[0].substr(19),10)),isNaN(maxMessageSize)&&(maxMessageSize=65536);var sctpPort=SDPUtils.matchPrefix(mediaSection,"a=sctp-port:");if(sctpPort.length>0)return{port:parseInt(sctpPort[0].substr(12),10),protocol:mline.fmt,maxMessageSize:maxMessageSize};if(SDPUtils.matchPrefix(mediaSection,"a=sctpmap:").length>0){var parts=SDPUtils.matchPrefix(mediaSection,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(parts[0],10),protocol:parts[1],maxMessageSize:maxMessageSize}}},SDPUtils.writeSctpDescription=function(media,sctp){var output=[];return output="DTLS/SCTP"!==media.protocol?["m="+media.kind+" 9 "+media.protocol+" "+sctp.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+sctp.port+"\r\n"]:["m="+media.kind+" 9 "+media.protocol+" "+sctp.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+sctp.port+" "+sctp.protocol+" 65535\r\n"],void 0!==sctp.maxMessageSize&&output.push("a=max-message-size:"+sctp.maxMessageSize+"\r\n"),output.join("")},SDPUtils.generateSessionId=function(){return Math.random().toString().substr(2,21)},SDPUtils.writeSessionBoilerplate=function(sessId,sessVer,sessUser){var version=void 0!==sessVer?sessVer:2;return"v=0\r\no="+(sessUser||"thisisadapterortc")+" "+(sessId||SDPUtils.generateSessionId())+" "+version+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},SDPUtils.writeMediaSection=function(transceiver,caps,type,stream){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);if(sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters()),sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),"offer"===type?"actpass":"active"),sdp+="a=mid:"+transceiver.mid+"\r\n",transceiver.direction?sdp+="a="+transceiver.direction+"\r\n":transceiver.rtpSender&&transceiver.rtpReceiver?sdp+="a=sendrecv\r\n":transceiver.rtpSender?sdp+="a=sendonly\r\n":transceiver.rtpReceiver?sdp+="a=recvonly\r\n":sdp+="a=inactive\r\n",transceiver.rtpSender){var msid="msid:"+stream.id+" "+transceiver.rtpSender.track.id+"\r\n";sdp+="a="+msid,sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid,transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid,sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n",transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"),sdp},SDPUtils.getDirection=function(mediaSection,sessionpart){for(var lines=SDPUtils.splitLines(mediaSection),i=0;i<lines.length;i++)switch(lines[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return lines[i].substr(2)}return sessionpart?SDPUtils.getDirection(sessionpart):"sendrecv"},SDPUtils.getKind=function(mediaSection){return SDPUtils.splitLines(mediaSection)[0].split(" ")[0].substr(2)},SDPUtils.isRejected=function(mediaSection){return"0"===mediaSection.split(" ",2)[1]},SDPUtils.parseMLine=function(mediaSection){var parts=SDPUtils.splitLines(mediaSection)[0].substr(2).split(" ");return{kind:parts[0],port:parseInt(parts[1],10),protocol:parts[2],fmt:parts.slice(3).join(" ")}},SDPUtils.parseOLine=function(mediaSection){var parts=SDPUtils.matchPrefix(mediaSection,"o=")[0].substr(2).split(" ");return{username:parts[0],sessionId:parts[1],sessionVersion:parseInt(parts[2],10),netType:parts[3],addressType:parts[4],address:parts[5]}},SDPUtils.isValidSDP=function(blob){if("string"!=typeof blob||0===blob.length)return!1;for(var lines=SDPUtils.splitLines(blob),i=0;i<lines.length;i++)if(lines[i].length<2||"="!==lines[i].charAt(1))return!1;return!0},module.exports=SDPUtils},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return empty}));var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_util_hostReportError__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36),empty={closed:!0,next:function(value){},error:function(err){if(_config__WEBPACK_IMPORTED_MODULE_0__.a.useDeprecatedSynchronousErrorHandling)throw err;Object(_util_hostReportError__WEBPACK_IMPORTED_MODULE_1__.a)(err)},complete:function(){}}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var BehaviorSubject_1=__webpack_require__(66),rxjs_1=__webpack_require__(10),_escape=__webpack_require__(60),moment=__webpack_require__(3),FileState=function FileState(){_classCallCheck(this,FileState)};FileState.DELETED="deleted",FileState.UPLOADING="uploading",FileState.UPLOADED="uploaded",FileState.NOT_UPLOADED="not_uploaded",FileState.DOWNLOADING="downloading",FileState.UPLOAD_CANCELED="upload_canceled",FileState.UNKNOWN="unknown",exports.FileState=FileState;var ThumbnailPlaceholder=function ThumbnailPlaceholder(icon,style,type){_classCallCheck(this,ThumbnailPlaceholder),this.icon=icon,this.style=style,this.type=type},Thumbnail=function(){function Thumbnail(data){_classCallCheck(this,Thumbnail),data?(this.availableThumbnail=data.availableThumbnail,this.md5sum=data.md5sum,this.size=data.size,this.wantThumbnailDate=data.wantThumbnailDate):this.availableThumbnail=!1}return _createClass(Thumbnail,[{key:"isThumbnailAvailable",value:function(){return this.availableThumbnail}}]),Thumbnail}(),FileDescriptor=function(){function FileDescriptor(){var id=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,url=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,ownerId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,fileName=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,extension=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,typeMIME=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,size=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,registrationDate=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,uploadedDate=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,dateToSort=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,viewers=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,state=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,thumbnail=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,orientation=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,original_w=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,original_h=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0,tags=arguments.length>16&&void 0!==arguments[16]?arguments[16]:null,virusScanState=arguments.length>17&&void 0!==arguments[17]?arguments[17]:null,voiceMessage=arguments.length>18&&void 0!==arguments[18]&&arguments[18];_classCallCheck(this,FileDescriptor),this.id=id,this.url=url,this.ownerId=ownerId,this.fileName=fileName,this.extension=extension,this.typeMIME=typeMIME,this.thumbnailPlaceholder=this.getThumbnailPlaceholderFromMimetype(typeMIME),this.size=size,this.registrationDate=registrationDate,this.uploadedDate=uploadedDate,this.dateToSort=dateToSort,this.viewers=viewers,this.state=state,this.stateSubject=new BehaviorSubject_1.BehaviorSubject(this.state),this.thumbnail=new Thumbnail(thumbnail),this.fileToSend=void 0,this.previewBlob=void 0,this.previewBlobSubject=new BehaviorSubject_1.BehaviorSubject(this.previewBlob),this.blobOrientation=void 0,this.blobOrientationSubject=new BehaviorSubject_1.BehaviorSubject(this.blobOrientation),this.previewDownloaded=!1,this.tags=tags,this.orientation=orientation||void 0,this.virusScanState=virusScanState,this.original_w=original_w||0,this.original_h=original_h||0,this.voiceMessage=voiceMessage,this.time=this.getDate().getTime(),this.progressSubject=new rxjs_1.Subject,this.loadingRef=0}return _createClass(FileDescriptor,[{key:"isMicrosoftFile",value:function(){var _this106=this;return["docx","doc","ppt","pptx","xls","xlsx"].some((function(ext){return ext===_this106.extension}))}},{key:"isThumbnailPossible",value:function(){return this.isImage()||this.isPDF()}},{key:"isPDF",value:function(){return"application/pdf"===this.typeMIME}},{key:"isSVG",value:function(){return"svg"===this.extension}},{key:"isImage",value:function(){return this.typeMIME&&this.typeMIME.length>="image/".length&&"image/"===this.typeMIME.slice(0,"image/".length)}},{key:"isAudioVideo",value:function(){var _this107=this;return["avi","mpg","wma","mp3","wmv","mkv","mov","wav","ogg","mp4","aac"].some((function(ext){return ext===_this107.extension}))}},{key:"isUploaded",value:function(){return this.state&&this.state===FileState.UPLOADED}},{key:"isPublicUrlExpired",value:function(){if(!this.publicUrlExpirationDate)return!1;var nowDate=moment();return moment(this.publicUrlExpirationDate).isBefore(nowDate)}},{key:"isAlreadyFileViewer",value:function(viewerId){return!(!this.ownerId||this.ownerId!==viewerId)||!!this.viewers&&this.viewers.some((function(viewer){return viewer.viewerId===viewerId}))}},{key:"getDisplayName",value:function(){return this.fileName.replace(/\.[^/.]+$/,"")}},{key:"getDisplayNameTruncated",value:function(){var str=this.fileName.replace(/\.[^/.]+$/,"");return[_escape(str.substring(0,str.length-4)),_escape(str.slice(-4))]}},{key:"getExtension",value:function(){return this.fileName.toUpperCase()===this.extension.toUpperCase()?"":"."+this.extension}},{key:"getDuration",value:function(){return this.tags&&this.tags.duration?Math.floor(this.tags.duration):0}},{key:"getThumbnailPlaceholderFromMimetype",value:function(mime){return mime?"image/vnd.adobe.photoshop"===mime||"image/photoshop"===mime||"image/x-photoshop"===mime||"image/psd"===mime||"application/photoshop"===mime||"application/psd"===mime?new ThumbnailPlaceholder("psd-type","psdStyle","psd"):0===mime.indexOf("image")?new ThumbnailPlaceholder("image-type","imageStyle","image"):"application/msword"===mime||/^application\/vnd.openxmlformats-officedocument.wordprocessingml.*$/.test(mime)||"application/vnd.oasis.opendocument.text"===mime?new ThumbnailPlaceholder("document-type","docStyle","doc"):/^application\/vnd.ms-powerpoint.*$/.test(mime)||/^application\/vnd.openxmlformats-officedocument.presentationml.*$/.test(mime)||"application/vnd.oasis.opendocument.presentation"===mime?new ThumbnailPlaceholder("powerpoint-type","pptStyle","ppt"):0===mime.indexOf("application/vnd.ms-excel")||/^application\/vnd.openxmlformats-officedocument.spreadsheetml.*$/.test(mime)?new ThumbnailPlaceholder("excel-type","xlsStyle","xls"):"application/pdf"===mime||"application/vnd.oasis.opendocument.spreadsheet"===mime?new ThumbnailPlaceholder("pdf-type","pdfStyle","pdf"):0===mime.indexOf("video/")?new ThumbnailPlaceholder("video-type","videoStyle","video"):0===mime.indexOf("audio/")?new ThumbnailPlaceholder("audio-type","audioStyle","audio"):"text/plain"===mime?new ThumbnailPlaceholder("txt-type","txtStyle","txt"):"application/zip"===mime||"application/x-rar-compressed"===mime||"application/x-7z-compressed"===mime||"application/x-tar"===mime?new ThumbnailPlaceholder("archive-type","archiveStyle","archive"):"application/illustrator"===mime||0===mime.indexOf("application/postscript")?new ThumbnailPlaceholder("ai-type","aiStyle","ai"):"text/css"===mime||"text/html"===mime||"application/javascript"===mime||"application/json"===mime||"application/typescript"===mime||"application/xml"===mime?new ThumbnailPlaceholder("code-type","codeStyle","code"):new ThumbnailPlaceholder("unknown-type","otherStyle","other"):new ThumbnailPlaceholder("unknown-type","otherStyle","other")}},{key:"releaseURL",value:function(){this.localURL=void 0}},{key:"setState",value:function(newState){this.state=newState,this.stateSubject.next(this.state)}},{key:"setOriginalImageDimensions",value:function(width,height){this.original_w=width,this.original_h=height}},{key:"update",value:function(fd){this.id=fd.id,this.url=fd.url,this.ownerId=fd.ownerId,this.fileName=fd.fileName,this.extension=fd.extension,this.typeMIME=fd.typeMIME,this.size=fd.size,this.registrationDate=fd.registrationDate,this.uploadedDate=fd.uploadedDate,this.dateToSort=fd.dateToSort,this.viewers=fd.viewers,this.setState(fd.state),this.thumbnail=fd.thumbnail,this.orientation=fd.orientation,this.time=this.getDate().getTime()}},{key:"getDate",value:function(){return this.uploadedDate?new Date(this.uploadedDate):this.registrationDate?new Date(this.registrationDate):new Date(this.dateToSort)}},{key:"refreshFilePercent",value:function(){var chunkPercentTotal=0;this.chunkPercentArray.forEach((function(chunkPercent){chunkPercentTotal+=chunkPercent})),this.chunkPerformedPercent=Math.floor(chunkPercentTotal/this.chunkTotalNumber)}},{key:"updateProgressInfo",value:function(){this.refreshFilePercent(),this.progressSubject.next({})}},{key:"isInfected",value:function(){return"isInfected"===this.virusScanState}}],[{key:"create",value:function(id,url,ownerId,fileName,extension,typeMIME,size,registrationDate,uploadedDate,dateToSort,viewers,state,thumbnail,orientation,original_w,original_h,tags,virusScanState,voiceMessage){return new FileDescriptor(id,url,ownerId,fileName,extension,typeMIME,size,registrationDate,uploadedDate,dateToSort,viewers,state,thumbnail,orientation,original_w,original_h,tags,virusScanState,voiceMessage)}}]),FileDescriptor}();exports.FileDescriptor=FileDescriptor},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var canReportError_1=__webpack_require__(262),toSubscriber_1=__webpack_require__(266),observable_1=__webpack_require__(267),pipe_1=__webpack_require__(268),config_1=__webpack_require__(68),Observable=function(){function Observable(subscribe){this._isScalar=!1,subscribe&&(this._subscribe=subscribe)}return Observable.prototype.lift=function(operator){var observable=new Observable;return observable.source=this,observable.operator=operator,observable},Observable.prototype.subscribe=function(observerOrNext,error,complete){var operator=this.operator,sink=toSubscriber_1.toSubscriber(observerOrNext,error,complete);if(operator?sink.add(operator.call(sink,this.source)):sink.add(this.source||config_1.config.useDeprecatedSynchronousErrorHandling&&!sink.syncErrorThrowable?this._subscribe(sink):this._trySubscribe(sink)),config_1.config.useDeprecatedSynchronousErrorHandling&&sink.syncErrorThrowable&&(sink.syncErrorThrowable=!1,sink.syncErrorThrown))throw sink.syncErrorValue;return sink},Observable.prototype._trySubscribe=function(sink){try{return this._subscribe(sink)}catch(err){config_1.config.useDeprecatedSynchronousErrorHandling&&(sink.syncErrorThrown=!0,sink.syncErrorValue=err),canReportError_1.canReportError(sink)?sink.error(err):console.warn(err)}},Observable.prototype.forEach=function(next,promiseCtor){var _this=this;return new(promiseCtor=getPromiseCtor(promiseCtor))((function(resolve,reject){var subscription;subscription=_this.subscribe((function(value){try{next(value)}catch(err){reject(err),subscription&&subscription.unsubscribe()}}),reject,resolve)}))},Observable.prototype._subscribe=function(subscriber){var source=this.source;return source&&source.subscribe(subscriber)},Observable.prototype[observable_1.observable]=function(){return this},Observable.prototype.pipe=function(){for(var operations=[],_i=0;_i<arguments.length;_i++)operations[_i]=arguments[_i];return 0===operations.length?this:pipe_1.pipeFromArray(operations)(this)},Observable.prototype.toPromise=function(promiseCtor){var _this=this;return new(promiseCtor=getPromiseCtor(promiseCtor))((function(resolve,reject){var value;_this.subscribe((function(x){return value=x}),(function(err){return reject(err)}),(function(){return resolve(value)}))}))},Observable.create=function(subscribe){return new Observable(subscribe)},Observable}();function getPromiseCtor(promiseCtor){if(promiseCtor||(promiseCtor=config_1.config.Promise||Promise),!promiseCtor)throw new Error("no Promise impl found");return promiseCtor}exports.Observable=Observable},function(module,exports,__webpack_require__){var _extendStatics2,__extends=this&&this.__extends||(_extendStatics2=function(d,b){return(_extendStatics2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics2(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var isFunction_1=__webpack_require__(78),Observer_1=__webpack_require__(79),Subscription_1=__webpack_require__(45),rxSubscriber_1=__webpack_require__(69),config_1=__webpack_require__(68),hostReportError_1=__webpack_require__(80),Subscriber=function(_super){function Subscriber(destinationOrNext,error,complete){var _this=_super.call(this)||this;switch(_this.syncErrorValue=null,_this.syncErrorThrown=!1,_this.syncErrorThrowable=!1,_this.isStopped=!1,arguments.length){case 0:_this.destination=Observer_1.empty;break;case 1:if(!destinationOrNext){_this.destination=Observer_1.empty;break}if("object"==typeof destinationOrNext){destinationOrNext instanceof Subscriber?(_this.syncErrorThrowable=destinationOrNext.syncErrorThrowable,_this.destination=destinationOrNext,destinationOrNext.add(_this)):(_this.syncErrorThrowable=!0,_this.destination=new SafeSubscriber(_this,destinationOrNext));break}default:_this.syncErrorThrowable=!0,_this.destination=new SafeSubscriber(_this,destinationOrNext,error,complete)}return _this}return __extends(Subscriber,_super),Subscriber.prototype[rxSubscriber_1.rxSubscriber]=function(){return this},Subscriber.create=function(next,error,complete){var subscriber=new Subscriber(next,error,complete);return subscriber.syncErrorThrowable=!1,subscriber},Subscriber.prototype.next=function(value){this.isStopped||this._next(value)},Subscriber.prototype.error=function(err){this.isStopped||(this.isStopped=!0,this._error(err))},Subscriber.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},Subscriber.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,_super.prototype.unsubscribe.call(this))},Subscriber.prototype._next=function(value){this.destination.next(value)},Subscriber.prototype._error=function(err){this.destination.error(err),this.unsubscribe()},Subscriber.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},Subscriber.prototype._unsubscribeAndRecycle=function(){var _parentOrParents=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=_parentOrParents,this},Subscriber}(Subscription_1.Subscription);exports.Subscriber=Subscriber;var SafeSubscriber=function(_super){function SafeSubscriber(_parentSubscriber,observerOrNext,error,complete){var next,_this=_super.call(this)||this;_this._parentSubscriber=_parentSubscriber;var context=_this;return isFunction_1.isFunction(observerOrNext)?next=observerOrNext:observerOrNext&&(next=observerOrNext.next,error=observerOrNext.error,complete=observerOrNext.complete,observerOrNext!==Observer_1.empty&&(context=Object.create(observerOrNext),isFunction_1.isFunction(context.unsubscribe)&&_this.add(context.unsubscribe.bind(context)),context.unsubscribe=_this.unsubscribe.bind(_this))),_this._context=context,_this._next=next,_this._error=error,_this._complete=complete,_this}return __extends(SafeSubscriber,_super),SafeSubscriber.prototype.next=function(value){if(!this.isStopped&&this._next){var _parentSubscriber=this._parentSubscriber;config_1.config.useDeprecatedSynchronousErrorHandling&&_parentSubscriber.syncErrorThrowable?this.__tryOrSetError(_parentSubscriber,this._next,value)&&this.unsubscribe():this.__tryOrUnsub(this._next,value)}},SafeSubscriber.prototype.error=function(err){if(!this.isStopped){var _parentSubscriber=this._parentSubscriber,useDeprecatedSynchronousErrorHandling=config_1.config.useDeprecatedSynchronousErrorHandling;if(this._error)useDeprecatedSynchronousErrorHandling&&_parentSubscriber.syncErrorThrowable?(this.__tryOrSetError(_parentSubscriber,this._error,err),this.unsubscribe()):(this.__tryOrUnsub(this._error,err),this.unsubscribe());else if(_parentSubscriber.syncErrorThrowable)useDeprecatedSynchronousErrorHandling?(_parentSubscriber.syncErrorValue=err,_parentSubscriber.syncErrorThrown=!0):hostReportError_1.hostReportError(err),this.unsubscribe();else{if(this.unsubscribe(),useDeprecatedSynchronousErrorHandling)throw err;hostReportError_1.hostReportError(err)}}},SafeSubscriber.prototype.complete=function(){var _this=this;if(!this.isStopped){var _parentSubscriber=this._parentSubscriber;if(this._complete){var wrappedComplete=function(){return _this._complete.call(_this._context)};config_1.config.useDeprecatedSynchronousErrorHandling&&_parentSubscriber.syncErrorThrowable?(this.__tryOrSetError(_parentSubscriber,wrappedComplete),this.unsubscribe()):(this.__tryOrUnsub(wrappedComplete),this.unsubscribe())}else this.unsubscribe()}},SafeSubscriber.prototype.__tryOrUnsub=function(fn,value){try{fn.call(this._context,value)}catch(err){if(this.unsubscribe(),config_1.config.useDeprecatedSynchronousErrorHandling)throw err;hostReportError_1.hostReportError(err)}},SafeSubscriber.prototype.__tryOrSetError=function(parent,fn,value){if(!config_1.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{fn.call(this._context,value)}catch(err){return config_1.config.useDeprecatedSynchronousErrorHandling?(parent.syncErrorValue=err,parent.syncErrorThrown=!0,!0):(hostReportError_1.hostReportError(err),!0)}return!1},SafeSubscriber.prototype._unsubscribe=function(){var _parentSubscriber=this._parentSubscriber;this._context=null,this._parentSubscriber=null,_parentSubscriber.unsubscribe()},SafeSubscriber}(Subscriber);exports.SafeSubscriber=SafeSubscriber},function(module,exports,__webpack_require__){(function(global){var base64=__webpack_require__(385),ieee754=__webpack_require__(386),isArray=__webpack_require__(387);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length)).__proto__=Buffer.prototype:(null===that&&(that=new Buffer(length)),that.length=length),that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?function(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");return array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),Buffer.TYPED_ARRAY_SUPPORT?(that=array).__proto__=Buffer.prototype:that=fromArrayLike(that,array),that}(that,value,encodingOrOffset,length):"string"==typeof value?function(that,string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),actual=(that=createBuffer(that,length)).write(string,encoding);return actual!==length&&(that=that.slice(0,actual)),that}(that,value,encodingOrOffset):function(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return 0===(that=createBuffer(that,len)).length||obj.copy(that,0,0,len),that}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||(val=obj.length)!=val?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}var val;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,isNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)hi=(c=str.charCodeAt(i))>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=4096)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=4096));return res}(res)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var n,len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=(n=buf[i])<16?"0"+n.toString(16):n.toString(16);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}exports.Buffer=Buffer,exports.SlowBuffer=function(length){return+length!=length&&(length=0),Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return function(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(null,size):void 0!==fill?"string"==typeof encoding?createBuffer(null,size).fill(fill,encoding):createBuffer(null,size).fill(fill):createBuffer(null,size)}(0,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function(start,end){var newBuf,len=this.length;if((start=~~start)<0?(start+=len)<0&&(start=0):start>len&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset|=0,byteLength|=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset|=0,byteLength|=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}(str).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}}).call(this,__webpack_require__(65))},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var pgi_conference_service_1=__webpack_require__(332),distinctUntilChanged_1=__webpack_require__(75),contact_service_1=__webpack_require__(1),PgiConferenceService=function(_pgi_conference_servi){_inherits(PgiConferenceService,_pgi_conference_servi);var _super3=_createSuper(PgiConferenceService);function PgiConferenceService(){var _this108;return _classCallCheck(this,PgiConferenceService),(_this108=_super3.call(this)).contactService=contact_service_1.ContactService.getInstance(),_this108}return _createClass(PgiConferenceService,[{key:"start",value:function(stats){var _this109=this;this.contactService.userContact.phoneMeetingsEnabledSubject.pipe(distinctUntilChanged_1.distinctUntilChanged()).subscribe((function(phoneMeetingsEnabled){return phoneMeetingsEnabled?get_get(_getPrototypeOf(PgiConferenceService.prototype),"start",_this109).call(_this109,stats):(_this109.logger.info("start skipped - phoneMeetingsEnabled : "+_this109.contactService.userContact.phoneMeetingsEnabled),null)}))}},{key:"makeSnapshotForConfId",value:function(confId){var _this110=this,_super=Object.create(null,{makeSnapshotForConfId:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"makeSnapshotForConfId",_this110)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee137(){return regenerator_default.a.wrap((function(_context138){for(;;)switch(_context138.prev=_context138.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.phoneMeetingsEnabled){_context138.next=4;break}_context138.t0=(this.logger.info("makeSnapshotForConfId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null),_context138.next=7;break;case 4:return _context138.next=6,_super.makeSnapshotForConfId.call(this,confId);case 6:_context138.t0=_context138.sent;case 7:return _context138.abrupt("return",_context138.t0);case 8:case"end":return _context138.stop()}}),_callee137,this)})))}},{key:"removeConferenceSession",value:function(confId){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("removeConferenceSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):get_get(_getPrototypeOf(PgiConferenceService.prototype),"removeConferenceSession",this).call(this,confId)}},{key:"updateOrCreateConferenceSession",value:function(confId,snapshotData){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("updateOrCreateConferenceSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):get_get(_getPrototypeOf(PgiConferenceService.prototype),"updateOrCreateConferenceSession",this).call(this,confId,snapshotData)}},{key:"updateConference",value:function(confEndpointId,confData){var _this111=this,_super=Object.create(null,{updateConference:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"updateConference",_this111)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee138(){return regenerator_default.a.wrap((function(_context139){for(;;)switch(_context139.prev=_context139.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.phoneMeetingsEnabled){_context139.next=4;break}_context139.t0=(this.logger.info("updateConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null),_context139.next=7;break;case 4:return _context139.next=6,_super.updateConference.call(this,confEndpointId,confData);case 6:_context139.t0=_context139.sent;case 7:return _context139.abrupt("return",_context139.t0);case 8:case"end":return _context139.stop()}}),_callee138,this)})))}},{key:"getPstnInstantConferenceEndpoint",value:function(){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getPstnInstantConferenceEndpoint skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):get_get(_getPrototypeOf(PgiConferenceService.prototype),"getPstnInstantConferenceEndpoint",this).call(this)}},{key:"getPstnInstantConferenceEndpointId",value:function(){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getPstnInstantConferenceEndpointId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):get_get(_getPrototypeOf(PgiConferenceService.prototype),"getPstnInstantConferenceEndpointId",this).call(this)}},{key:"retrievePstnConferences",value:function(){var _this112=this,_super=Object.create(null,{retrievePstnConferences:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"retrievePstnConferences",_this112)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee139(){return regenerator_default.a.wrap((function(_context140){for(;;)switch(_context140.prev=_context140.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.phoneMeetingsEnabled){_context140.next=4;break}_context140.t0=(this.logger.info("retrievePstnConferences skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null),_context140.next=7;break;case 4:return _context140.next=6,_super.retrievePstnConferences.call(this);case 6:_context140.t0=_context140.sent;case 7:return _context140.abrupt("return",_context140.t0);case 8:case"end":return _context140.stop()}}),_callee139,this)})))}},{key:"retrieveConference",value:function(confId){var _this113=this,force=arguments.length>1&&void 0!==arguments[1]&&arguments[1],_super=Object.create(null,{retrieveConference:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"retrieveConference",_this113)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee140(){return regenerator_default.a.wrap((function(_context141){for(;;)switch(_context141.prev=_context141.next){case 0:if(!this.contactService||!this.contactService.userContact||this.contactService.userContact.phoneMeetingsEnabled){_context141.next=4;break}_context141.t0=(this.logger.info("retrieveConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null),_context141.next=7;break;case 4:return _context141.next=6,_super.retrieveConference.call(this,confId,force);case 6:_context141.t0=_context141.sent;case 7:return _context141.abrupt("return",_context141.t0);case 8:case"end":return _context141.stop()}}),_callee140,this)})))}},{key:"updateOrCreatePstnConferenceEndpoint",value:function(conferenceData){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("updateOrCreatePstnConferenceEndpoint skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):get_get(_getPrototypeOf(PgiConferenceService.prototype),"updateOrCreatePstnConferenceEndpoint",this).call(this,conferenceData)}},{key:"getConferenceSessionWithConnId",value:function(connId){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getConferenceSessionWithConnId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):get_get(_getPrototypeOf(PgiConferenceService.prototype),"getConferenceSessionWithConnId",this).call(this,connId)}},{key:"getConferenceSessionById",value:function(confId){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getConferenceSessionById skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):get_get(_getPrototypeOf(PgiConferenceService.prototype),"getConferenceSessionById",this).call(this,confId)}},{key:"subscribeToPstnSession",value:function(confId){var _this114=this,_super=Object.create(null,{subscribeToPstnSession:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"subscribeToPstnSession",_this114)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee141(){return regenerator_default.a.wrap((function(_context142){for(;;)switch(_context142.prev=_context142.next){case 0:return _context142.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("subscribeToPstnSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):_super.subscribeToPstnSession.call(this,confId));case 1:case"end":return _context142.stop()}}),_callee141,this)})))}},{key:"unSubscribeParticipantFromPstnSession",value:function(confId,participantId){var _this115=this,_super=Object.create(null,{unSubscribeParticipantFromPstnSession:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"unSubscribeParticipantFromPstnSession",_this115)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee142(){return regenerator_default.a.wrap((function(_context143){for(;;)switch(_context143.prev=_context143.next){case 0:return _context143.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("unSubscribeParticipantFromPstnSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):_super.unSubscribeParticipantFromPstnSession.call(this,confId,participantId));case 1:case"end":return _context143.stop()}}),_callee142,this)})))}},{key:"startPstnConference",value:function(confId){var _this116=this,_super=Object.create(null,{startPstnConference:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"startPstnConference",_this116)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee143(){return regenerator_default.a.wrap((function(_context144){for(;;)switch(_context144.prev=_context144.next){case 0:return _context144.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("startPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):_super.startPstnConference.call(this,confId));case 1:case"end":return _context144.stop()}}),_callee143,this)})))}},{key:"stopPstnConference",value:function(confId){var _this117=this,_super=Object.create(null,{stopPstnConference:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"stopPstnConference",_this117)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee144(){return regenerator_default.a.wrap((function(_context145){for(;;)switch(_context145.prev=_context145.next){case 0:return _context145.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("stopPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):_super.stopPstnConference.call(this,confId));case 1:case"end":return _context145.stop()}}),_callee144,this)})))}},{key:"joinPstnConference",value:function(confId,participantPhoneNumber,participant,country){var _this118=this,_super=Object.create(null,{joinPstnConference:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"joinPstnConference",_this118)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee145(){return regenerator_default.a.wrap((function(_context146){for(;;)switch(_context146.prev=_context146.next){case 0:return _context146.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("joinPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):_super.joinPstnConference.call(this,confId,participantPhoneNumber,participant,country));case 1:case"end":return _context146.stop()}}),_callee145,this)})))}},{key:"disconnectParticipant",value:function(confId,participantId){var _this119=this,_super=Object.create(null,{disconnectParticipant:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"disconnectParticipant",_this119)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee146(){return regenerator_default.a.wrap((function(_context147){for(;;)switch(_context147.prev=_context147.next){case 0:return _context147.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("disconnectParticipant skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):_super.disconnectParticipant.call(this,confId,participantId));case 1:case"end":return _context147.stop()}}),_callee146,this)})))}},{key:"retrievePstnPhoneNumbers",value:function(){var _this120=this,shouldFormatResults=arguments.length>0&&void 0!==arguments[0]&&arguments[0],_super=Object.create(null,{retrievePstnPhoneNumbers:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"retrievePstnPhoneNumbers",_this120)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee147(){return regenerator_default.a.wrap((function(_context148){for(;;)switch(_context148.prev=_context148.next){case 0:return _context148.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("retrievePstnPhoneNumbers skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):_super.retrievePstnPhoneNumbers.call(this,shouldFormatResults));case 1:case"end":return _context148.stop()}}),_callee147,this)})))}},{key:"resetPersonalMeetingRoom",value:function(){var _this121=this,_super=Object.create(null,{resetPersonalMeetingRoom:{get:function(){return get_get(_getPrototypeOf(PgiConferenceService.prototype),"resetPersonalMeetingRoom",_this121)}}});return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee148(){return regenerator_default.a.wrap((function(_context149){for(;;)switch(_context149.prev=_context149.next){case 0:return _context149.abrupt("return",this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("resetPersonalMeetingRoom skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):_super.resetPersonalMeetingRoom.call(this));case 1:case"end":return _context149.stop()}}),_callee148,this)})))}},{key:"subscribeToMyConferenceSessions",value:function(eventHandler){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("subscribeToMyConferenceSessions skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):get_get(_getPrototypeOf(PgiConferenceService.prototype),"subscribeToMyConferenceSessions",this).call(this,eventHandler)}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.pgiConferenceService||(win.rainbow.pgiConferenceService=new PgiConferenceService),win.rainbow.pgiConferenceService}}]),PgiConferenceService}(pgi_conference_service_1.NgPgiConferenceService);exports.PgiConferenceService=PgiConferenceService,exports.default=PgiConferenceService.getInstance()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var event_service_1=__webpack_require__(32),company_model_1=__webpack_require__(19),CryptoJS=__webpack_require__(18),crypto_js_1=__webpack_require__(18),logger_service_1=__webpack_require__(15),auth_service_1=__webpack_require__(2),main_service_1=__webpack_require__(26),userInfo_service_1=__webpack_require__(31),errorHelper_service_1=__webpack_require__(37),xmpp_service_1=__webpack_require__(4),CompanyService=function(){function CompanyService(){var _this122=this;_classCallCheck(this,CompanyService),this.eventService=event_service_1.default,this.logger=logger_service_1.default,this.authService=auth_service_1.default,this.mainService=main_service_1.default,this.userInfoService=userInfo_service_1.default,this.xmppService=xmpp_service_1.default,this.companies={},this.eventService.subscribe("ON_COMPANY_CHANGE_EVENT",(function(__event,companyId){_this122.getCompanyById(companyId,!0)})),this.xmppService.subscribeToConnectionEvents((function(event){"ON_XMPP_DISCONNECTED"===event.name&&"LOGOUT"===event.data.reason&&(_this122.companies={})}))}return _createClass(CompanyService,[{key:"getCompanyById",value:function(companyId){var update=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee149(){var company,headers,url,responseData,companyData,errorMessage;return regenerator_default.a.wrap((function(_context150){for(;;)switch(_context150.prev=_context150.next){case 0:if(_context150.prev=0,companyId){_context150.next=3;break}throw new Error("missing companyId");case 3:if(!(company=this.companies[companyId])||update){_context150.next=6;break}return _context150.abrupt("return",(this.logger.info("[companyService] getCompanyById (cache) "+companyId+" - success"),company));case 6:return headers=this.authService.getRequestHeader(),url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/companies/").concat(companyId),_context150.next=10,fetch(url,{method:"GET",headers:headers});case 10:if((responseData=_context150.sent).ok){_context150.next=13;break}throw new Error(responseData.statusText);case 13:return _context150.next=15,responseData.json();case 15:return companyData=_context150.sent,_context150.abrupt("return",(company?(company.updateFromData(companyData.data),this.logger.info("getCompanyById (update) ".concat(companyId," - success"))):(company=company_model_1.Company.createFromData(companyData.data),this.companies[company.id]=company,this.logger.info("getCompanyById ".concat(companyId," - success"))),this.getCompanyLogo(company),this.getCompanyBanner(company),company));case 19:throw _context150.prev=19,_context150.t0=_context150.catch(0),errorMessage="getCompanyById -- FAILURE -- "+_context150.t0.message,this.logger.error(errorMessage),new Error(errorMessage);case 23:case"end":return _context150.stop()}}),_callee149,this,[[0,19]])})))}},{key:"searchCompanies",value:function(searchText){var hasBP=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,isBP=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,bpType=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee150(){var url,headers,responseData,companiesData,companies,errorMessage,_this123=this;return regenerator_default.a.wrap((function(_context151){for(;;)switch(_context151.prev=_context151.next){case 0:return _context151.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/companies?name=").concat(encodeURIComponent(searchText),"&format=full"),null!=hasBP&&(url+="&hasBP="+hasBP),null!=isBP&&(url+="&isBP="+isBP),bpType&&(url+="&bpType="+bpType),headers=this.authService.getRequestHeader(),_context151.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((responseData=_context151.sent).ok){_context151.next=9;break}throw new Error(responseData.statusText);case 9:return _context151.next=11,responseData.json();case 11:return companiesData=_context151.sent,companies=companiesData.data.reduce((function(result,companyData){if("Default"!==companyData.name&&"Rainbow"!==companyData.name&&"active"===companyData.status){var company=_this123.companies[companyData.id];company||(company=company_model_1.Company.createFromData(companyData),_this123.companies[company.id]=company,_this123.getCompanyLogo(company)),result.push(company)}return result}),[]),_context151.abrupt("return",(this.logger.info("searchCompanies with criteria '"+searchText+"' - success - found "+companiesData.length+" companies : returns "+companies.length+" companies"),companies));case 16:throw _context151.prev=16,_context151.t0=_context151.catch(0),errorMessage="searchCompanies -- FAILURE -- "+_context151.t0.message,this.logger.error(errorMessage),new Error(errorMessage);case 20:case"end":return _context151.stop()}}),_callee150,this,[[0,16]])})))}},{key:"getCompanyAdminsData",value:function(companyId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee151(){var url,headers,responseData,errorMessage;return regenerator_default.a.wrap((function(_context152){for(;;)switch(_context152.prev=_context152.next){case 0:return _context152.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/companies/").concat(companyId,"/administrators"),headers=this.authService.getRequestHeader(),_context152.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((responseData=_context152.sent).ok){_context152.next=8;break}throw new Error(responseData.statusText);case 8:return _context152.next=10,responseData.json();case 10:return _context152.abrupt("return",_context152.sent.data);case 13:throw _context152.prev=13,_context152.t0=_context152.catch(0),errorMessage="getCompanyById -- FAILURE -- "+_context152.t0.message,this.logger.error(errorMessage),new Error(errorMessage);case 17:case"end":return _context152.stop()}}),_callee151,this,[[0,13]])})))}},{key:"getCompanyUsers",value:function(companyId,page,pageSize){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee152(){var url,headers,responseData,errorMessage;return regenerator_default.a.wrap((function(_context153){for(;;)switch(_context153.prev=_context153.next){case 0:return _context153.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/search/v1.0/users?companyId=").concat(companyId,"&limit=").concat(pageSize),headers=this.authService.getRequestHeader(),_context153.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((responseData=_context153.sent).ok){_context153.next=8;break}throw new Error(responseData.statusText);case 8:return _context153.next=10,responseData.json();case 10:_context153.next=16;break;case 12:throw _context153.prev=12,_context153.t0=_context153.catch(0),errorMessage="getCompanyById -- FAILURE -- "+_context153.t0.message,this.logger.error(errorMessage),new Error(errorMessage);case 16:case"end":return _context153.stop()}}),_callee152,this,[[0,12]])})))}},{key:"getCompanyLogo",value:function(company){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee153(){var companyColor,companyInitials;return regenerator_default.a.wrap((function(_context154){for(;;)switch(_context154.prev=_context154.next){case 0:return _context154.prev=0,companyColor=this.userInfoService.computeUserColor(company.name),companyInitials=company.name.substr(0,1),_context154.abrupt("return",(company.logo=this.userInfoService.getAvatarImage(company.id,companyInitials,companyColor.color,130,company.lastAvatarUpdateDate),this.eventService.publish("ON_COMPANY_LOGO_UPDATED",company.id),this.logger.info("[getCompanyLogo] - "+company.getNameForLogs()+" - success"),company.sendChangeEvent("logo"),company));case 5:throw _context154.prev=5,_context154.t0=_context154.catch(0),new Error("getCompanyLogo -- FAILURE -- "+_context154.t0.message);case 8:case"end":return _context154.stop()}}),_callee153,this,[[0,5]])})))}},{key:"getCompanyBanner",value:function(company){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee154(){var _this124=this;return regenerator_default.a.wrap((function(_context155){for(;;)switch(_context155.prev=_context155.next){case 0:return _context155.abrupt("return",new Promise((function(resolve){var image=new Image;image.onload=function(){company.banner=image,_this124.eventService.publish("ON_COMPANY_BANNER_UPDATED",company.id),_this124.logger.info("[getCompanyBanner] - "+company.getNameForLogs()+" - success"),resolve(company)},image.onerror=function(){_this124.logger.error("[companyService] Load banner for "+company.getNameForLogs()+" failure"),resolve(company)};var imgSrc="/cacheV2/images/company-banner-01.svg";if(company.lastBannerUpdateDate){var serverURL=config.webservices.protocol+"://"+config.webservices.currentServer;_this124.mainService.cdn&&(serverURL=_this124.mainService.cdnServer),imgSrc=serverURL+"/api/banner/"+company.id+"?size=831",imgSrc+="&update="+crypto_js_1.MD5(CryptoJS.enc.Latin1.parse(company.lastBannerUpdateDate)).toString(CryptoJS.enc.Hex)}image.src=imgSrc})));case 1:case"end":return _context155.stop()}}),_callee154)})))}},{key:"getCompanyAlertNotificationState",value:function(company){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee155(){var url,headers,responseData,feature,errorInfo;return regenerator_default.a.wrap((function(_context156){for(;;)switch(_context156.prev=_context156.next){case 0:if(!config.urgencyNotifEmissionForced){_context156.next=2;break}return _context156.abrupt("return",!0);case 2:return _context156.prev=2,url="".concat(config.restServerUrl,"/api/rainbow/subscription/v1.0/companies/").concat(company.id,"/subscriptions/features"),headers=this.authService.getRequestHeader(),_context156.next=7,fetch(url,{method:"GET",headers:headers});case 7:if((responseData=_context156.sent).ok){_context156.next=10;break}throw new Error(responseData.statusText);case 10:return _context156.next=12,responseData.json();case 12:if(!(feature=_context156.sent.data.find((function(feat){return"ALERT_NOTIFICATIONS_ALLOWED"===feat.featureUniqueRef})))){_context156.next=15;break}return _context156.abrupt("return",feature.isEnabled);case 15:_context156.next=23;break;case 17:return _context156.prev=17,_context156.t0=_context156.catch(2),_context156.next=21,errorHelper_service_1.default.getErrorInfo(_context156.t0,"getCompanySubscriptions");case 21:errorInfo=_context156.sent,this.logger.warn("[roomService] "+errorInfo.message);case 23:return _context156.abrupt("return",!1);case 24:case"end":return _context156.stop()}}),_callee155,this,[[2,17]])})))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.companyService||(win.rainbow.companyService=new CompanyService),win.rainbow.companyService}}]),CompanyService}();exports.CompanyService=CompanyService,exports.default=CompanyService.getInstance()},function(module,exports,__webpack_require__){(function(global){var object,reUnescapedHtml=/[&<>"'`]/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source),freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),escapeHtmlChar=(object={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},function(key){return null==object?void 0:object[key]}),objectToString=Object.prototype.toString,Symbol=root.Symbol,symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;try{module.exports=function(string){var value;return(string=null==(value=string)?"":function(value){if("string"==typeof value)return value;if(function(value){return"symbol"==typeof value||function(value){return!!value&&"object"==typeof value}(value)&&"[object Symbol]"==objectToString.call(value)}(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}(value))&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}}catch(e){}}).call(this,__webpack_require__(65))},function(module,exports,__webpack_require__){var C,C_lib,Base,X32WordArray,C_x64,CryptoJS;module.exports=(C_lib=(C=CryptoJS=__webpack_require__(12)).lib,Base=C_lib.Base,X32WordArray=C_lib.WordArray,(C_x64=C.x64={}).Word=Base.extend({init:function(high,low){this.high=high,this.low=low}}),C_x64.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[],this.sigBytes=null!=sigBytes?sigBytes:8*words.length},toX32:function(){for(var x64Words=this.words,x64WordsLength=x64Words.length,x32Words=[],i=0;i<x64WordsLength;i++){var x64Word=x64Words[i];x32Words.push(x64Word.high),x32Words.push(x64Word.low)}return X32WordArray.create(x32Words,this.sigBytes)},clone:function(){for(var clone=Base.clone.call(this),words=clone.words=this.words.slice(0),wordsLength=words.length,i=0;i<wordsLength;i++)words[i]=words[i].clone();return clone}}),CryptoJS)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return pipe})),__webpack_require__.d(__webpack_exports__,"b",(function(){return pipeFromArray}));var _identity__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(34);function pipe(){for(var fns=[],_i=0;_i<arguments.length;_i++)fns[_i]=arguments[_i];return pipeFromArray(fns)}function pipeFromArray(fns){return 0===fns.length?_identity__WEBPACK_IMPORTED_MODULE_0__.a:1===fns.length?fns[0]:function(input){return fns.reduce((function(prev,fn){return fn(prev)}),input)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return SubjectSubscription}));var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),SubjectSubscription=function(_super){function SubjectSubscription(subject,subscriber){var _this=_super.call(this)||this;return _this.subject=subject,_this.subscriber=subscriber,_this.closed=!1,_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.a(SubjectSubscription,_super),SubjectSubscription.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var subject=this.subject,observers=subject.observers;if(this.subject=null,observers&&0!==observers.length&&!subject.isStopped&&!subject.closed){var subscriberIndex=observers.indexOf(this.subscriber);-1!==subscriberIndex&&observers.splice(subscriberIndex,1)}}},SubjectSubscription}(__webpack_require__(13).a)},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var auth_service_1=__webpack_require__(2),logger_service_1=__webpack_require__(15),i18n_service_1=__webpack_require__(38),errorHelper_service_1=__webpack_require__(37),CountryService=function(){function CountryService(){_classCallCheck(this,CountryService),this.portalURL=null,this.errorHelperService=errorHelper_service_1.default,this.datacenters=[{name:"France","alpha-3":"FRA","alpha-2":"FR",region:"Europe"},{name:"Germany","alpha-3":"DEU","alpha-2":"DE",region:"Europe"},{name:"Canada","alpha-3":"CAN","alpha-2":"CA",region:"America"},{name:"Singapore","alpha-3":"SGP","alpha-2":"SG",region:"Asia-Pacific"}],this.countries=[{name:"Australia","alpha-3":"AUS","country-code":"036","alpha-2":"AU"},{name:"Austria","alpha-3":"AUT","country-code":"040","alpha-2":"AT"},{name:"Belgium","alpha-3":"BEL","country-code":"056","alpha-2":"BE"},{name:"Brazil","alpha-3":"BRA","country-code":"076","alpha-2":"BR"},{name:"Canada","alpha-3":"CAN","country-code":"124","alpha-2":"CA"},{name:"China","alpha-3":"CHN","country-code":"156","alpha-2":"CN"},{name:"Czech Republic","alpha-3":"CZE","country-code":"203","alpha-2":"CZ"},{name:"Denmark","alpha-3":"DNK","country-code":"208","alpha-2":"DK"},{name:"Finland","alpha-3":"FIN","country-code":"246","alpha-2":"FI"},{name:"France","alpha-3":"FRA","country-code":"250",default:!0,"alpha-2":"FR"},{name:"Germany","alpha-3":"DEU","country-code":"276","alpha-2":"DE"},{name:"Hong Kong","alpha-3":"HKG","country-code":"344","alpha-2":"HK"},{name:"Ireland","alpha-3":"IRL","country-code":"372","alpha-2":"IE"},{name:"Israel","alpha-3":"ISR","country-code":"376","alpha-2":"IL"},{name:"Italy","alpha-3":"ITA","country-code":"380","alpha-2":"IT"},{name:"Mexico","alpha-3":"MEX","country-code":"484","alpha-2":"MX"},{name:"Netherlands","alpha-3":"NLD","country-code":"528","alpha-2":"NL"},{name:"Norway","alpha-3":"NOR","country-code":"578","alpha-2":"NO"},{name:"Poland","alpha-3":"POL","country-code":"616","alpha-2":"PL"},{name:"Portugal","alpha-3":"PRT","country-code":"620","alpha-2":"PT"},{name:"Russia","alpha-3":"RUS","country-code":"643","alpha-2":"RU"},{name:"South Africa","alpha-3":"ZAF","country-code":"710","alpha-2":"ZA"},{name:"South Korea","alpha-3":"KOR","country-code":"410","alpha-2":"KR"},{name:"Spain","alpha-3":"ESP","country-code":"724","alpha-2":"ES"},{name:"Sweden","alpha-3":"SWE","country-code":"752","alpha-2":"SE"},{name:"Switzerland","alpha-3":"CHE","country-code":"756","alpha-2":"CH"},{name:"Taiwan","alpha-3":"TWN","country-code":"158","alpha-2":"TW"},{name:"Turkey","alpha-3":"TUR","country-code":"792","alpha-2":"TR"},{name:"United Kingdom","alpha-3":"GBR","country-code":"826","alpha-2":"GB"},{name:"United States of America","alpha-3":"USA","country-code":"840","alpha-2":"US"},{name:"Afghanistan","alpha-3":"AFG","country-code":"004","alpha-2":"AF"},{name:"Albania","alpha-3":"ALB","country-code":"008","alpha-2":"AL"},{name:"Algeria","alpha-3":"DZA","country-code":"012","alpha-2":"DZ"},{name:"Andorra","alpha-3":"AND","country-code":"020","alpha-2":"AD"},{name:"Angola","alpha-3":"AGO","country-code":"024","alpha-2":"AO"},{name:"Anguilla","alpha-3":"AIA","country-code":"660","alpha-2":"AI"},{name:"Antigua and Barbuda","alpha-3":"ATG","country-code":"028","alpha-2":"AG"},{name:"Argentina","alpha-3":"ARG","country-code":"032","alpha-2":"AR"},{name:"Armenia","alpha-3":"ARM","country-code":"051","alpha-2":"AM"},{name:"Aruba","alpha-3":"ABW","country-code":"533","alpha-2":"AW"},{name:"Azerbaijan","alpha-3":"AZE","country-code":"031","alpha-2":"AZ"},{name:"Bahamas","alpha-3":"BHS","country-code":"044","alpha-2":"BS"},{name:"Bahrain","alpha-3":"BHR","country-code":"048","alpha-2":"BH"},{name:"Bangladesh","alpha-3":"BGD","country-code":"050","alpha-2":"BD"},{name:"Barbados","alpha-3":"BRB","country-code":"052","alpha-2":"BB"},{name:"Belarus","alpha-3":"BLR","country-code":"112","alpha-2":"BY"},{name:"Belize","alpha-3":"BLZ","country-code":"084","alpha-2":"BZ"},{name:"Benin","alpha-3":"BEN","country-code":"204","alpha-2":"BJ"},{name:"Bermuda","alpha-3":"BMU","country-code":"060","alpha-2":"BM"},{name:"Bhutan","alpha-3":"BTN","country-code":"064","alpha-2":"BT"},{name:"Bolivia","alpha-3":"BOL","country-code":"068","alpha-2":"BO"},{name:"Bosnia and Herzegovina","alpha-3":"BIH","country-code":"070","alpha-2":"BA"},{name:"Botswana","alpha-3":"BWA","country-code":"072","alpha-2":"BW"},{name:"British Virgin Islands","alpha-3":"VGB","country-code":"092","alpha-2":"VG"},{name:"Brunei Darussalam","alpha-3":"BRN","country-code":"096","alpha-2":"BN"},{name:"Bulgaria","alpha-3":"BGR","country-code":"100","alpha-2":"BG"},{name:"Burkina Faso","alpha-3":"BFA","country-code":"854","alpha-2":"BF"},{name:"Burundi","alpha-3":"BDI","country-code":"108","alpha-2":"BI"},{name:"Cambodia","alpha-3":"KHM","country-code":"116","alpha-2":"KH"},{name:"Cameroon","alpha-3":"CMR","country-code":"120","alpha-2":"CM"},{name:"Cape Verde","alpha-3":"CPV","country-code":"132","alpha-2":"CV"},{name:"Cayman Islands","alpha-3":"CYM","country-code":"136","alpha-2":"KY"},{name:"Central African Republic","alpha-3":"CAF","country-code":"140","alpha-2":"CF"},{name:"Chad","alpha-3":"TCD","country-code":"148","alpha-2":"TD"},{name:"Chile","alpha-3":"CHL","country-code":"152","alpha-2":"CL"},{name:"Colombia","alpha-3":"COL","country-code":"170","alpha-2":"CO"},{name:"Comoros","alpha-3":"COM","country-code":"174","alpha-2":"KM"},{name:"Congo","alpha-3":"COG","country-code":"178","alpha-2":"CG"},{name:"Congo, Democratic Republic of","alpha-3":"COD","country-code":"180","alpha-2":"CD"},{name:"Costa Rica","alpha-3":"CRI","country-code":"188","alpha-2":"CR"},{name:"Ivory Coast","alpha-3":"CIV","country-code":"384","alpha-2":"CI"},{name:"Croatia","alpha-3":"HRV","country-code":"191","alpha-2":"HR"},{name:"Cyprus","alpha-3":"CYP","country-code":"196","alpha-2":"CY"},{name:"Djibouti","alpha-3":"DJI","country-code":"262","alpha-2":"DJ"},{name:"Dominica","alpha-3":"DMA","country-code":"212","alpha-2":"DM"},{name:"Dominican Republic","alpha-3":"DOM","country-code":"214","alpha-2":"DO"},{name:"Ecuador","alpha-3":"ECU","country-code":"218","alpha-2":"EC"},{name:"El Salvador","alpha-3":"SLV","country-code":"222","alpha-2":"SV"},{name:"Egypt","alpha-3":"EGY","country-code":"818","alpha-2":"EG"},{name:"Eritrea","alpha-3":"ERI","country-code":"232","alpha-2":"ER"},{name:"Estonia","alpha-3":"EST","country-code":"233","alpha-2":"EE"},{name:"Ethiopia","alpha-3":"ETH","country-code":"231","alpha-2":"ET"},{name:"Fiji","alpha-3":"FJI","country-code":"242","alpha-2":"FJ"},{name:"French Guiana","alpha-3":"GUF","country-code":"254","alpha-2":"GF"},{name:"French Polynesia","alpha-3":"PYF","country-code":"258","alpha-2":"PF"},{name:"Gabon","alpha-3":"GAB","country-code":"266","alpha-2":"GA"},{name:"Gambia","alpha-3":"GMB","country-code":"270","alpha-2":"GM"},{name:"Georgia","alpha-3":"GEO","country-code":"268","alpha-2":"GE"},{name:"Ghana","alpha-3":"GHA","country-code":"288","alpha-2":"GH"},{name:"Greece","alpha-3":"GRC","country-code":"300","alpha-2":"GR"},{name:"Grenada","alpha-3":"GRD","country-code":"308","alpha-2":"GD"},{name:"Guadeloupe","alpha-3":"GLP","country-code":"312","alpha-2":"GP"},{name:"Guatemala","alpha-3":"GTM","country-code":"320","alpha-2":"GT"},{name:"Guinea","alpha-3":"GIN","country-code":"324","alpha-2":"GN"},{name:"Guyana","alpha-3":"GUY","country-code":"328","alpha-2":"GY"},{name:"Haiti","alpha-3":"HTI","country-code":"332","alpha-2":"HT"},{name:"Honduras","alpha-3":"HND","country-code":"340","alpha-2":"HN"},{name:"Hungary","alpha-3":"HUN","country-code":"348","alpha-2":"HU"},{name:"Iceland","alpha-3":"ISL","country-code":"352","alpha-2":"IS"},{name:"India","alpha-3":"IND","country-code":"356","alpha-2":"IN"},{name:"Indonesia","alpha-3":"IDN","country-code":"360","alpha-2":"ID"},{name:"Iraq","alpha-3":"IRQ","country-code":"368","alpha-2":"IQ"},{name:"Jamaica","alpha-3":"JAM","country-code":"388","alpha-2":"JM"},{name:"Japan","alpha-3":"JPN","country-code":"392","alpha-2":"JP"},{name:"Jordan","alpha-3":"JOR","country-code":"400","alpha-2":"JO"},{name:"Kazakhstan","alpha-3":"KAZ","country-code":"398","alpha-2":"KZ"},{name:"Kenya","alpha-3":"KEN","country-code":"404","alpha-2":"KE"},{name:"Kuwait","alpha-3":"KWT","country-code":"414","alpha-2":"KW"},{name:"Kyrgyzstan","alpha-3":"KGZ","country-code":"417","alpha-2":"KG"},{name:"Latvia","alpha-3":"LVA","country-code":"428","alpha-2":"LV"},{name:"Lebanon","alpha-3":"LBN","country-code":"422","alpha-2":"LB"},{name:"Lesotho","alpha-3":"LSO","country-code":"426","alpha-2":"LS"},{name:"Liberia","alpha-3":"LBR","country-code":"430","alpha-2":"LR"},{name:"Libya","alpha-3":"LBY","country-code":"434","alpha-2":"LY"},{name:"Liechtenstein","alpha-3":"LIE","country-code":"438","alpha-2":"LI"},{name:"Lithuania","alpha-3":"LTU","country-code":"440","alpha-2":"LT"},{name:"Luxembourg","alpha-3":"LUX","country-code":"442","alpha-2":"LU"},{name:"Macao","alpha-3":"MAC","country-code":"446","alpha-2":"MO"},{name:"Macedonia","alpha-3":"MKD","country-code":"807","alpha-2":"MK"},{name:"Madagascar","alpha-3":"MDG","country-code":"450","alpha-2":"MG"},{name:"Malawi","alpha-3":"MWI","country-code":"454","alpha-2":"MW"},{name:"Malaysia","alpha-3":"MYS","country-code":"458","alpha-2":"MY"},{name:"Maldives","alpha-3":"MDV","country-code":"462","alpha-2":"MV"},{name:"Mali","alpha-3":"MLI","country-code":"466","alpha-2":"ML"},{name:"Malta","alpha-3":"MLT","country-code":"470","alpha-2":"MT"},{name:"Mauritius","alpha-3":"MUS","country-code":"480","alpha-2":"MU"},{name:"Mayotte","alpha-3":"MYT","country-code":"175","alpha-2":"YT"},{name:"Moldova","alpha-3":"MDA","country-code":"498","alpha-2":"MD"},{name:"Monaco","alpha-3":"MCO","country-code":"492","alpha-2":"MC"},{name:"Mongolia","alpha-3":"MNG","country-code":"496","alpha-2":"MN"},{name:"Montenegro","alpha-3":"MNE","country-code":"499","alpha-2":"ME"},{name:"Montserrat","alpha-3":"MSR","country-code":"500","alpha-2":"MS"},{name:"Morocco","alpha-3":"MAR","country-code":"504","alpha-2":"MA"},{name:"Mozambique","alpha-3":"MOZ","country-code":"508","alpha-2":"MZ"},{name:"Myanmar","alpha-3":"MMR","country-code":"104","alpha-2":"MM"},{name:"Namibia","alpha-3":"NAM","country-code":"516","alpha-2":"NA"},{name:"Nepal","alpha-3":"NPL","country-code":"524","alpha-2":"NP"},{name:"New Zealand","alpha-3":"NZL","country-code":"554","alpha-2":"NZ"},{name:"Nicaragua","alpha-3":"NIC","country-code":"558","alpha-2":"NI"},{name:"Niger","alpha-3":"NER","country-code":"562","alpha-2":"NE"},{name:"Nigeria","alpha-3":"NGA","country-code":"566","alpha-2":"NG"},{name:"Oman","alpha-3":"OMN","country-code":"512","alpha-2":"OM"},{name:"Pakistan","alpha-3":"PAK","country-code":"586","alpha-2":"PK"},{name:"Palestine","alpha-3":"PSE","country-code":"275","alpha-2":"PS"},{name:"Panama","alpha-3":"PAN","country-code":"591","alpha-2":"PA"},{name:"Paraguay","alpha-3":"PRY","country-code":"600","alpha-2":"PY"},{name:"Peru","alpha-3":"PER","country-code":"604","alpha-2":"PE"},{name:"Philippines","alpha-3":"PHL","country-code":"608","alpha-2":"PH"},{name:"Puerto Rico","alpha-3":"PRI","country-code":"630","alpha-2":"PR"},{name:"Qatar","alpha-3":"QAT","country-code":"634","alpha-2":"QA"},{name:"Romania","alpha-3":"ROU","country-code":"642","alpha-2":"RO"},{name:"Rwanda","alpha-3":"RWA","country-code":"646","alpha-2":"RW"},{name:"Saint Kitts and Nevis","alpha-3":"KNA","country-code":"659","alpha-2":"KN"},{name:"Saint Lucia","alpha-3":"LCA","country-code":"662","alpha-2":"LC"},{name:"Saint Vincent and the Grenadines","alpha-3":"VCT","country-code":"670","alpha-2":"VC"},{name:"Saudi Arabia","alpha-3":"SAU","country-code":"682","alpha-2":"SA"},{name:"Senegal","alpha-3":"SEN","country-code":"686","alpha-2":"SN"},{name:"Serbia","alpha-3":"SRB","country-code":"688","alpha-2":"RS"},{name:"Sierra Leone","alpha-3":"SLE","country-code":"694","alpha-2":"SL"},{name:"Singapore","alpha-3":"SGP","country-code":"702","alpha-2":"SG"},{name:"Slovakia","alpha-3":"SVK","country-code":"703","alpha-2":"SK"},{name:"Slovenia","alpha-3":"SVN","country-code":"705","alpha-2":"SI"},{name:"South Sudan","alpha-3":"SSD","country-code":"728","alpha-2":"SS"},{name:"Sri Lanka","alpha-3":"LKA","country-code":"144","alpha-2":"LK"},{name:"Sudan","alpha-3":"SDN","country-code":"729","alpha-2":"SD"},{name:"Swaziland","alpha-3":"SWZ","country-code":"748","alpha-2":"SZ"},{name:"Tajikistan","alpha-3":"TJK","country-code":"762","alpha-2":"TJ"},{name:"Tanzania","alpha-3":"TZA","country-code":"834","alpha-2":"TZ"},{name:"Thailand","alpha-3":"THA","country-code":"764","alpha-2":"TH"},{name:"Togo","alpha-3":"TGO","country-code":"768","alpha-2":"TG"},{name:"Trinidad and Tobago","alpha-3":"TTO","country-code":"780","alpha-2":"TT"},{name:"Tunisia","alpha-3":"TUN","country-code":"788","alpha-2":"TN"},{name:"Turkmenistan","alpha-3":"TKM","country-code":"795","alpha-2":"TM"},{name:"Turks and Caicos Islands","alpha-3":"TCA","country-code":"796","alpha-2":"TC"},{name:"Uganda","alpha-3":"UGA","country-code":"800","alpha-2":"UG"},{name:"Ukraine","alpha-3":"UKR","country-code":"804","alpha-2":"UA"},{name:"United Arab Emirates","alpha-3":"ARE","country-code":"784","alpha-2":"AE"},{name:"Virgin Islands, US","alpha-3":"VIR","country-code":"850","alpha-2":"VI"},{name:"Uruguay","alpha-3":"URY","country-code":"858","alpha-2":"UY"},{name:"Uzbekistan","alpha-3":"UZB","country-code":"860","alpha-2":"UZ"},{name:"Venezuela","alpha-3":"VEN","country-code":"862","alpha-2":"VE"},{name:"Vietnam","alpha-3":"VNM","country-code":"704","alpha-2":"VN"},{name:"Zambia","alpha-3":"ZMB","country-code":"894","alpha-2":"ZM"},{name:"Zimbabwe","alpha-3":"ZWE","country-code":"716","alpha-2":"ZW"}],this.statesOfCanada={AB:"Alberta",BC:"British Columbia",MB:"Manitoba",NB:"New Brunswick",NL:"Newfoundland and Labrador",NS:"Nova Scotia",NT:"Northwest Territories",NU:"Nunavut",ON:"Ontario",PE:"Prince Edward Island",QC:"Quebec",SK:"Saskatchewan",YT:"Yukon"},this.statesOfAmerica={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",AA:"Armed Forces America",AE:"Armed Forces",AP:"Armed Forces Pacific",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",GU:"Guam",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VI:"Virgin Islands",VA:"Virginia",WA:"Washington",DC:"Washington DC",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},this.countryToInternationalCallingCodeMapping={AD:"376",AE:"971",AF:"93",AG:"1268",AI:"1264",AL:"355",AM:"374",AN:"599",AO:"244",AQ:"672",AR:"54",AS:"1684",AT:"43",AU:"61",AW:"297",AZ:"994",BA:"387",BB:"1246",BD:"880",BE:"32",BF:"226",BG:"359",BH:"973",BI:"257",BJ:"229",BL:"590",BM:"1441",BN:"673",BO:"591",BR:"55",BS:"1242",BT:"975",BW:"267",BY:"375",BZ:"501",CA:"1",CC:"61",CD:"243",CF:"236",CG:"242",CH:"41",CI:"225",CK:"682",CL:"56",CM:"237",CN:"86",CO:"57",CR:"506",CU:"53",CV:"238",CX:"61",CY:"357",CZ:"420",DE:"49",DJ:"253",DK:"45",DM:"1767",DO:"1809",DZ:"213",EC:"593",EE:"372",EG:"20",ER:"291",ES:"34",ET:"251",FI:"358",FJ:"679",FK:"500",FM:"691",FO:"298",FR:"33",GA:"241",GB:"44",GD:"1473",GE:"995",GH:"233",GI:"350",GL:"299",GM:"220",GN:"224",GQ:"240",GR:"30",GT:"502",GU:"1671",GW:"245",GY:"592",HK:"852",HN:"504",HR:"385",HT:"509",HU:"36",ID:"62",IE:"353",IL:"972",IM:"44",IN:"91",IQ:"964",IR:"98",IS:"354",IT:"39",JM:"1876",JO:"962",JP:"81",KE:"254",KG:"996",KH:"855",KI:"686",KM:"269",KN:"1869",KP:"850",KR:"82",KW:"965",KY:"1345",KZ:"7",LA:"856",LB:"961",LC:"1758",LI:"423",LK:"94",LR:"231",LS:"266",LT:"370",LU:"352",LV:"371",LY:"218",MA:"212",MC:"377",MD:"373",ME:"382",MF:"1599",MG:"261",MH:"692",MK:"389",ML:"223",MM:"95",MN:"976",MO:"853",MP:"1670",MR:"222",MS:"1664",MT:"356",MU:"230",MV:"960",MW:"265",MX:"52",MY:"60",MZ:"258",NA:"264",NC:"687",NE:"227",NG:"234",NI:"505",NL:"31",NO:"47",NP:"977",NR:"674",NU:"683",NZ:"64",OM:"968",PA:"507",PE:"51",PF:"689",PG:"675",PH:"63",PK:"92",PL:"48",PM:"508",PN:"870",PR:"1",PT:"351",PW:"680",PY:"595",QA:"974",RO:"40",RS:"381",RU:"7",RW:"250",SA:"966",SB:"677",SC:"248",SD:"249",SE:"46",SG:"65",SH:"290",SI:"386",SK:"421",SL:"232",SM:"378",SN:"221",SO:"252",SR:"597",ST:"239",SV:"503",SY:"963",SZ:"268",TC:"1649",TD:"235",TG:"228",TH:"66",TJ:"992",TK:"690",TL:"670",TM:"993",TN:"216",TO:"676",TR:"90",TT:"1868",TV:"688",TW:"886",TZ:"255",UA:"380",UG:"256",US:"1",UY:"598",UZ:"998",VA:"39",VC:"1784",VE:"58",VG:"1284",VI:"1340",VN:"84",VU:"678",WF:"681",WS:"685",XK:"381",YE:"967",YT:"262",ZA:"27",ZM:"260",ZW:"263"},this.countryToLanguageMapping={ad:"ca",ae:"ar",af:"fa,ps",ag:"en",ai:"en",al:"sq",am:"hy",an:"nl,en",ao:"pt",ar:"es",as:"en,sm",at:"de",au:"en",aw:"nl,pap",ax:"sv",ba:"bs,hr,sr",bb:"en",bd:"bn",be:"nl,fr,de",bf:"fr",bh:"ar",bi:"fr",bj:"fr",bl:"fr",bm:"en",bn:"ms",bo:"es,qu,ay",br:"pt",bs:"en",bt:"dz",bv:"no",bw:"en,tn",by:"be,ru",bz:"en",ca:"en,fr",cc:"en",cd:"fr",cf:"fr",cg:"fr",ch:"de,fr,it,rm",ci:"fr",ck:"en,rar",cl:"es",cm:"fr,en",cn:"zh",co:"es",cr:"es",cu:"es",cv:"pt",cx:"en",cy:"el,tr",cz:"cs","// de":"de",dj:"fr,ar,so",dk:"da",dm:"en",do:"es",dz:"ar",ec:"es",ee:"et",eg:"ar",eh:"ar,es,fr",er:"ti,ar,en",es:"ast,ca,es,eu,gl",et:"am,om",fi:"fi,sv,se",fj:"en",fk:"en",fm:"en",ga:"fr",gb:"en,ga,cy,gd,kw",gd:"en",ge:"ka",gf:"fr",gg:"en",gh:"en",gi:"en",gl:"kl,da",gm:"en",gn:"fr",gp:"fr",gq:"es,fr,pt",gr:"el",gs:"en",gt:"es",gu:"en,ch",gw:"pt",gy:"en",hk:"zh,en",hm:"en",hn:"es",ht:"fr,ht",ie:"en,ga",il:"he",im:"en",in:"hi,en",io:"en",iq:"ar,ku",ir:"fa",it:"it,de,fr",je:"en",jm:"en",jo:"ar",jp:"ja",ke:"sw,en",kg:"ky,ru",kh:"km",ki:"en",km:"ar,fr",kn:"en",kp:"ko",kr:"ko,en",kw:"ar",ky:"en",kz:"kk,ru",la:"lo",lb:"ar,fr",lc:"en",li:"de",lk:"si,ta",lr:"en",ls:"en,st",lu:"lb,fr,de",ly:"ar",ma:"ar",mc:"fr",md:"ru,uk,ro",me:"srp,sq,bs,hr,sr",mf:"fr",mg:"mg,fr",mh:"en,mh",ml:"fr",mm:"my",mo:"zh,pt",mp:"ch",mq:"fr",mr:"ar,fr",ms:"en",mt:"mt,en",mu:"mfe,fr,en",mv:"dv",mw:"en,ny",mx:"es",my:"ms",mz:"pt",na:"en,sf,de",nc:"fr",ne:"fr",nf:"en,pih",ng:"en",ni:"es",no:"nb,nn,no,se",np:"ne",nr:"na,en",nu:"niu,en",nz:"mi,en",om:"ar",pa:"es",pe:"es",pf:"fr",pg:"en,tpi,ho",ph:"en,tl",pk:"en,ur",pm:"fr",pn:"en,pih",pr:"es,en",ps:"ar,he",pw:"en,pau,ja,sov,tox",py:"es,gn",qa:"ar",re:"fr",rs:"sr",rw:"rw,fr,en",sa:"ar",sb:"en",sc:"fr,en,crs",sd:"ar,en",se:"sv",sg:"en,ms,zh,ta",sh:"en",si:"sl",sj:"no",sl:"en",sm:"it",sn:"fr",so:"so,ar",sr:"nl",st:"pt",ss:"en",sv:"es",sy:"ar",sz:"en,ss",tc:"en",td:"fr,ar",tf:"fr",tg:"fr",tj:"tg,ru",tk:"tkl,en,sm",tl:"pt,tet",tm:"tk",tn:"ar",to:"en",tt:"en",tv:"en",tw:"zh",tz:"sw,en",ua:"uk",ug:"en,sw",um:"en",us:"en",uy:"es",uz:"uz,kaa",va:"it",vc:"en",ve:"es",vg:"en",vi:"en",vn:"vi",vu:"bi,en,fr",wf:"fr",ws:"sm,en",ye:"ar",yt:"fr",za:"zu,xh,af,st,tn,en",zm:"en",zw:"en,sn,nd "}}return _createClass(CountryService,[{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee156(){var availableCountries;return regenerator_default.a.wrap((function(_context157){for(;;)switch(_context157.prev=_context157.next){case 0:return logger_service_1.default.info(""),logger_service_1.default.info("[countryService] === STARTING ==="),this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/",_context157.prev=1,_context157.next=4,this.getAvailableCountries();case 4:availableCountries=_context157.sent,this.countries=availableCountries.map((function(country){var entry={name:country.fullname,"alpha-3":country.isoAlpha3Code,"alpha-2":country.isoAlpha2Code};return"FRA"===country.isoAlpha3Code&&(entry.default=!0),entry})),_context157.next=11;break;case 8:_context157.prev=8,_context157.t0=_context157.catch(1),logger_service_1.default.info("[countryService] === warning === "+_context157.t0.message);case 11:logger_service_1.default.info("[countryService] === STARTED  === "+this.countries.length+" countries"),logger_service_1.default.info("");case 12:case"end":return _context157.stop()}}),_callee156,this,[[1,8]])})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee157(){return regenerator_default.a.wrap((function(_context158){for(;;)switch(_context158.prev=_context158.next){case 0:logger_service_1.default.info("[countryService] STOPPED");case 1:case"end":return _context158.stop()}}),_callee157)})))}},{key:"getCountries",value:function(){var _this125=this,countries=this.countries.map((function(country){var label=_this125.getCountryLabel(country["alpha-2"]);if(label){var name=i18n_service_1.default.translate(label);name&&name!==label&&(country.name=name)}return country}));return countries.sort((function(country1,country2){return country1.name.localeCompare(country2.name,i18n_service_1.default.getCurrentLanguage())})),countries}},{key:"getCountryStates",value:function(country){return country&&"USA"===country["alpha-3"]?this.statesOfAmerica:country&&"CAN"===country["alpha-3"]?this.statesOfCanada:{}}},{key:"getCountry",value:function(countryCode){var defaulted=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!countryCode)return defaulted?this.getDefaultCountry():null;var countries=this.countries.filter((function(country){return country["alpha-3"]===countryCode}));return countries.length>0?countries[0]:null}},{key:"getDefaultCountry",value:function(){var countries=this.countries.filter((function(country){return!0===country.default}));return countries.length>0?countries[0]:this.countries[0]}},{key:"getCountryName",value:function(countryCode){return this.getCountry(countryCode)?this.getCountry(countryCode).name:null}},{key:"getCountryCode",value:function(country){return country?country["alpha-3"]:null}},{key:"getStateName",value:function(country,state){return country&&state?"USA"===country?this.statesOfAmerica[state]:"CAN"===country?this.statesOfCanada[state]:"":""}},{key:"getDefaultState",value:function(country){return country&&"USA"===country["alpha-3"]?"AL":country&&"CAN"===country["alpha-3"]?"AB":null}},{key:"getAlpha2Code",value:function(alpha3Code){if(!alpha3Code)return null;var countries=this.countries.filter((function(country){return country["alpha-3"]===alpha3Code}));return countries.length>0?countries[0]["alpha-2"]:null}},{key:"getCountryLabel",value:function(alphaCode){var alpha2Code;return(alpha2Code=3===alphaCode.length?this.getAlpha2Code(alphaCode):alphaCode)?"country"+alpha2Code:null}},{key:"getDataCenterLabel",value:function(datacenterLocation,companyCountry){var label=this.getRegionLabel(datacenterLocation.name);if(datacenterLocation.country===companyCountry)label=this.getCountryLabel(datacenterLocation.country);else{var datacenter=this.datacenters.find((function(dc){return dc["alpha-3"]===datacenterLocation.country}));datacenter&&(label=this.getRegionLabel(datacenter.region))}return label}},{key:"getRegionLabel",value:function(regionName){return regionName}},{key:"getInternationalCallingCode",value:function(countryAlpha2Code){if(countryAlpha2Code){var countryCode=countryAlpha2Code.toUpperCase();return this.countryToInternationalCallingCodeMapping[countryCode]}}},{key:"mapCountryToLanguages",value:function(countryAlpha2Code){if(countryAlpha2Code){var countryCode=countryAlpha2Code.toLowerCase();return void 0!==this.countryToLanguageMapping[countryCode]?this.countryToLanguageMapping[countryCode].split(","):[countryCode]}}},{key:"getAvailableCountries",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee158(){var response,errorInfo;return regenerator_default.a.wrap((function(_context159){for(;;)switch(_context159.prev=_context159.next){case 0:return _context159.prev=0,_context159.next=3,fetch(this.portalURL+"/countries",{method:"GET",headers:auth_service_1.default.getRequestHeader()});case 3:if((response=_context159.sent).ok){_context159.next=6;break}throw response;case 6:return _context159.next=8,response.json();case 8:return _context159.abrupt("return",_context159.sent.data);case 11:return _context159.prev=11,_context159.t0=_context159.catch(0),_context159.next=15,this.errorHelperService.getErrorInfo(_context159.t0,"getAvailableCountries");case 15:throw errorInfo=_context159.sent,logger_service_1.default.error("[countryService] "+errorInfo.message),errorInfo.error;case 17:case"end":return _context159.stop()}}),_callee158,this,[[0,11]])})))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.countryService||(win.rainbow.countryService=new CountryService),win.rainbow.countryService}}]),CountryService}();exports.CountryService=CountryService,exports.default=CountryService.getInstance()},function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){var _extendStatics3,__extends=this&&this.__extends||(_extendStatics3=function(d,b){return(_extendStatics3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics3(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Subject_1=__webpack_require__(67),ObjectUnsubscribedError_1=__webpack_require__(70),BehaviorSubject=function(_super){function BehaviorSubject(_value){var _this=_super.call(this)||this;return _this._value=_value,_this}return __extends(BehaviorSubject,_super),Object.defineProperty(BehaviorSubject.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),BehaviorSubject.prototype._subscribe=function(subscriber){var subscription=_super.prototype._subscribe.call(this,subscriber);return subscription&&!subscription.closed&&subscriber.next(this._value),subscription},BehaviorSubject.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;return this._value},BehaviorSubject.prototype.next=function(value){_super.prototype.next.call(this,this._value=value)},BehaviorSubject}(Subject_1.Subject);exports.BehaviorSubject=BehaviorSubject},function(module,exports,__webpack_require__){var _extendStatics4,__extends=this&&this.__extends||(_extendStatics4=function(d,b){return(_extendStatics4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics4(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Observable_1=__webpack_require__(55),Subscriber_1=__webpack_require__(56),Subscription_1=__webpack_require__(45),ObjectUnsubscribedError_1=__webpack_require__(70),SubjectSubscription_1=__webpack_require__(81),rxSubscriber_1=__webpack_require__(69),SubjectSubscriber=function(_super){function SubjectSubscriber(destination){var _this=_super.call(this,destination)||this;return _this.destination=destination,_this}return __extends(SubjectSubscriber,_super),SubjectSubscriber}(Subscriber_1.Subscriber);exports.SubjectSubscriber=SubjectSubscriber;var Subject=function(_super){function Subject(){var _this=_super.call(this)||this;return _this.observers=[],_this.closed=!1,_this.isStopped=!1,_this.hasError=!1,_this.thrownError=null,_this}return __extends(Subject,_super),Subject.prototype[rxSubscriber_1.rxSubscriber]=function(){return new SubjectSubscriber(this)},Subject.prototype.lift=function(operator){var subject=new AnonymousSubject(this,this);return subject.operator=operator,subject},Subject.prototype.next=function(value){if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;if(!this.isStopped)for(var observers=this.observers,len=observers.length,copy=observers.slice(),i=0;i<len;i++)copy[i].next(value)},Subject.prototype.error=function(err){if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=err,this.isStopped=!0;for(var observers=this.observers,len=observers.length,copy=observers.slice(),i=0;i<len;i++)copy[i].error(err);this.observers.length=0},Subject.prototype.complete=function(){if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;this.isStopped=!0;for(var observers=this.observers,len=observers.length,copy=observers.slice(),i=0;i<len;i++)copy[i].complete();this.observers.length=0},Subject.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},Subject.prototype._trySubscribe=function(subscriber){if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;return _super.prototype._trySubscribe.call(this,subscriber)},Subject.prototype._subscribe=function(subscriber){if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;return this.hasError?(subscriber.error(this.thrownError),Subscription_1.Subscription.EMPTY):this.isStopped?(subscriber.complete(),Subscription_1.Subscription.EMPTY):(this.observers.push(subscriber),new SubjectSubscription_1.SubjectSubscription(this,subscriber))},Subject.prototype.asObservable=function(){var observable=new Observable_1.Observable;return observable.source=this,observable},Subject.create=function(destination,source){return new AnonymousSubject(destination,source)},Subject}(Observable_1.Observable);exports.Subject=Subject;var AnonymousSubject=function(_super){function AnonymousSubject(destination,source){var _this=_super.call(this)||this;return _this.destination=destination,_this.source=source,_this}return __extends(AnonymousSubject,_super),AnonymousSubject.prototype.next=function(value){var destination=this.destination;destination&&destination.next&&destination.next(value)},AnonymousSubject.prototype.error=function(err){var destination=this.destination;destination&&destination.error&&this.destination.error(err)},AnonymousSubject.prototype.complete=function(){var destination=this.destination;destination&&destination.complete&&this.destination.complete()},AnonymousSubject.prototype._subscribe=function(subscriber){return this.source?this.source.subscribe(subscriber):Subscription_1.Subscription.EMPTY},AnonymousSubject}(Subject);exports.AnonymousSubject=AnonymousSubject},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var _enable_super_gross_mode_that_will_cause_bad_things=!1;exports.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(value){if(value){var error=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+error.stack)}else _enable_super_gross_mode_that_will_cause_bad_things&&console.log("RxJS: Back to a better error behavior. Thank you. <3");_enable_super_gross_mode_that_will_cause_bad_things=value},get useDeprecatedSynchronousErrorHandling(){return _enable_super_gross_mode_that_will_cause_bad_things}}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),exports.$$rxSubscriber=exports.rxSubscriber},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var ObjectUnsubscribedErrorImpl=function(){function ObjectUnsubscribedErrorImpl(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return ObjectUnsubscribedErrorImpl.prototype=Object.create(Error.prototype),ObjectUnsubscribedErrorImpl}();exports.ObjectUnsubscribedError=ObjectUnsubscribedErrorImpl},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var FileViewerType=function FileViewerType(){_classCallCheck(this,FileViewerType)};FileViewerType.USER="user",FileViewerType.ROOM="room";var FileViewer=function(){function FileViewer(viewerId,type){_classCallCheck(this,FileViewer),this.viewerId=null,this.type=null,this.contact=null,this.room=null,this.channel=null,this.viewerId=viewerId,this.type=type}return _createClass(FileViewer,null,[{key:"createFromData",value:function(data){return data.map((function(viewerData){return new FileViewer(viewerData.viewerId,viewerData.type)}))}}]),FileViewer}();exports.FileViewer=FileViewer},function(module,exports,__webpack_require__){var C,C_lib,WordArray,Hasher,C_algo,W,SHA1,CryptoJS;module.exports=(C_lib=(C=CryptoJS=__webpack_require__(12)).lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,W=[],SHA1=C_algo.SHA1=Hasher.extend({_doReset:function(){this._hash=new WordArray.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],i=0;i<80;i++){if(i<16)W[i]=0|M[offset+i];else{var n=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=n<<1|n>>>31}var t=(a<<5|a>>>27)+e+W[i];t+=i<20?1518500249+(b&c|~b&d):i<40?1859775393+(b^c^d):i<60?(b&c|b&d|c&d)-1894007588:(b^c^d)-899497514,e=d,d=c,c=b<<30|b>>>2,b=a,a=t}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[14+(nBitsLeft+64>>>9<<4)]=Math.floor(nBitsTotal/4294967296),dataWords[15+(nBitsLeft+64>>>9<<4)]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}}),C.SHA1=Hasher._createHelper(SHA1),C.HmacSHA1=Hasher._createHmacHelper(SHA1),CryptoJS.SHA1)},function(module,exports,__webpack_require__){var C,Base,Utf8;module.exports=(Base=(C=__webpack_require__(12)).lib.Base,Utf8=C.enc.Utf8,void(C.algo.HMAC=Base.extend({init:function(hasher,key){hasher=this._hasher=new hasher.init,"string"==typeof key&&(key=Utf8.parse(key));var hasherBlockSize=hasher.blockSize,hasherBlockSizeBytes=4*hasherBlockSize;key.sigBytes>hasherBlockSizeBytes&&(key=hasher.finalize(key)),key.clamp();for(var oKey=this._oKey=key.clone(),iKey=this._iKey=key.clone(),oKeyWords=oKey.words,iKeyWords=iKey.words,i=0;i<hasherBlockSize;i++)oKeyWords[i]^=1549556828,iKeyWords[i]^=909522486;oKey.sigBytes=iKey.sigBytes=hasherBlockSizeBytes,this.reset()},reset:function(){var hasher=this._hasher;hasher.reset(),hasher.update(this._iKey)},update:function(messageUpdate){return this._hasher.update(messageUpdate),this},finalize:function(messageUpdate){var hasher=this._hasher,innerHash=hasher.finalize(messageUpdate);return hasher.reset(),hasher.finalize(this._oKey.clone().concat(innerHash))}})))},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.resizeImage=function(avatarImg,maxWidth,maxHeight){return new Promise((function(resolve,reject){var image=new Image;image.onload=function(){var imageWidth=image.width,imageHeight=image.height;imageWidth>imageHeight?imageWidth>maxWidth&&(imageHeight*=maxWidth/imageWidth,imageWidth=maxWidth):imageHeight>maxHeight&&(imageWidth*=maxHeight/imageHeight,imageHeight=maxHeight);var canvas=document.createElement("canvas");canvas.width=imageWidth,canvas.height=imageHeight,image.width=imageWidth,image.height=imageHeight,image.crossOrigin="Anonymous",canvas.getContext("2d").drawImage(image,0,0,imageWidth,imageHeight);var resizedImage=new Image;resizedImage.src=canvas.toDataURL("image/png"),resolve(resizedImage)},image.onerror=function(){reject()},image.src=avatarImg}))},exports.getBinaryData=function(image){for(var typeIndex=image.src.indexOf("image/")+6,binaryIndex=image.src.indexOf(";base64,"),binaryData=image.src.slice(binaryIndex+8),imageType=image.src.slice(typeIndex,binaryIndex),binaryString=window.atob(binaryData),len=binaryString.length,bytes=new Uint8Array(len),i=0;i<len;i++)bytes[i]=binaryString.charCodeAt(i);return{type:imageType,data:bytes}}},function(module,exports,__webpack_require__){var _extendStatics5,__extends=this&&this.__extends||(_extendStatics5=function(d,b){return(_extendStatics5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics5(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Subscriber_1=__webpack_require__(56);exports.distinctUntilChanged=function(compare,keySelector){return function(source){return source.lift(new DistinctUntilChangedOperator(compare,keySelector))}};var DistinctUntilChangedOperator=function(){function DistinctUntilChangedOperator(compare,keySelector){this.compare=compare,this.keySelector=keySelector}return DistinctUntilChangedOperator.prototype.call=function(subscriber,source){return source.subscribe(new DistinctUntilChangedSubscriber(subscriber,this.compare,this.keySelector))},DistinctUntilChangedOperator}(),DistinctUntilChangedSubscriber=function(_super){function DistinctUntilChangedSubscriber(destination,compare,keySelector){var _this=_super.call(this,destination)||this;return _this.keySelector=keySelector,_this.hasKey=!1,"function"==typeof compare&&(_this.compare=compare),_this}return __extends(DistinctUntilChangedSubscriber,_super),DistinctUntilChangedSubscriber.prototype.compare=function(x,y){return x===y},DistinctUntilChangedSubscriber.prototype._next=function(value){var key;try{var keySelector=this.keySelector;key=keySelector?keySelector(value):value}catch(err){return this.destination.error(err)}var result=!1;if(this.hasKey)try{result=(0,this.compare)(this.key,key)}catch(err){return this.destination.error(err)}else this.hasKey=!0;result||(this.key=key,this.destination.next(value))},DistinctUntilChangedSubscriber}(Subscriber_1.Subscriber)},function(module,exports,__webpack_require__){var factory;window,factory=function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="./src/strophe.js")}({"./node_modules/webpack/buildin/global.js":function(module,exports){var g;g=function(){return this}();try{g=g||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(g=window)}module.exports=g},"./src/bosh.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/core.js"),Strophe=core__WEBPACK_IMPORTED_MODULE_0__.default.Strophe,$build=core__WEBPACK_IMPORTED_MODULE_0__.default.$build;Strophe.Request=function(elem,func,rid,sends){this.id=++Strophe._requestId,this.xmlData=elem,this.data=Strophe.serialize(elem),this.origFunc=func,this.func=func,this.rid=rid,this.date=NaN,this.sends=sends||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},Strophe.Request.prototype={getResponse:function(){var node=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(node=this.xhr.responseXML.documentElement).tagName)throw Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(Strophe.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(node=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(node.querySelector("parsererror")){Strophe.error("invalid response received: "+node.querySelector("parsererror").textContent),Strophe.error("responseText: "+this.xhr.responseText);var error=new Error;throw error.name=Strophe.ErrorCondition.BAD_FORMAT,error}}return node},_newXHR:function(){var xhr=null;return window.XMLHttpRequest?(xhr=new XMLHttpRequest).overrideMimeType&&xhr.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(xhr=new ActiveXObject("Microsoft.XMLHTTP")),xhr.onreadystatechange=this.func.bind(null,this),xhr}},Strophe.Bosh=function(connection){this._conn=connection,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},Strophe.Bosh.prototype={strip:null,_buildBody:function(){var bodyWrap=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});return null!==this.sid&&bodyWrap.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),bodyWrap},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(wait,hold,route){this.wait=wait||this.wait,this.hold=hold||this.hold,this.errors=0;var body=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});route&&body.attrs({route:route});var _connect_cb=this._conn._connect_cb;this._requests.push(new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this,_connect_cb.bind(this._conn)),body.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(jid,sid,rid,callback,wait,hold,wind){this._conn.jid=jid,this.sid=sid,this.rid=rid,this._conn.connect_callback=callback,this._conn.domain=Strophe.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=wait||this.wait,this.hold=hold||this.hold,this.window=wind||this.window,this._conn._changeConnectStatus(Strophe.Status.ATTACHED,null)},_restore:function(jid,callback,wait,hold,wind){var session=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=session&&session.rid&&session.sid&&session.jid&&(null==jid||Strophe.getBareJidFromJid(session.jid)===Strophe.getBareJidFromJid(jid)||null===Strophe.getNodeFromJid(jid)&&Strophe.getDomainFromJid(session.jid)===jid))){var error=new Error("_restore: no restoreable session.");throw error.name="StropheSessionError",error}this._conn.restored=!0,this._attach(session.jid,session.sid,session.rid,callback,wait,hold,wind)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(bodyWrap){var typ=bodyWrap.getAttribute("type");if(null!==typ&&"terminate"===typ){var cond=bodyWrap.getAttribute("condition");Strophe.error("BOSH-Connection failed: "+cond);var conflict=bodyWrap.getElementsByTagName("conflict");return null!==cond?("remote-stream-error"===cond&&conflict.length>0&&(cond="conflict"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,cond)):this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(cond),Strophe.Status.CONNFAIL}this.sid||(this.sid=bodyWrap.getAttribute("sid"));var wind=bodyWrap.getAttribute("requests");wind&&(this.window=parseInt(wind,10));var hold=bodyWrap.getAttribute("hold");hold&&(this.hold=parseInt(hold,10));var wait=bodyWrap.getAttribute("wait");wait&&(this.wait=parseInt(wait,10));var inactivity=bodyWrap.getAttribute("inactivity");inactivity&&(this.inactivity=parseInt(inactivity,10))},_disconnect:function(pres){this._sendTerminate(pres)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(req){var reqStatus=this._getRequestStatus(req),err_callback=this._conn.protocolErrorHandlers.HTTP[reqStatus];err_callback&&err_callback.call(this,reqStatus)},_hitError:function(reqStatus){this.errors++,Strophe.warn("request errored, status: "+reqStatus+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(callback){Strophe.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),callback=callback?callback.bind(this._conn):this._conn._connect_cb.bind(this._conn);var body=this._buildBody();this._requests.push(new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this,callback),body.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var req=this._requests.pop();req.abort=!0,req.xhr.abort(),req.xhr.onreadystatechange=function(){}}},_onIdle:function(){var data=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===data.length&&!this._conn.disconnecting&&(Strophe.info("no requests during idle cycle, sending blank request"),data.push(null)),!this._conn.paused){if(this._requests.length<2&&data.length>0){for(var body=this._buildBody(),i=0;i<data.length;i++)null!==data[i]&&("restart"===data[i]?body.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):body.cnode(data[i]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),body.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var time_elapsed=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),time_elapsed>Math.floor(Strophe.TIMEOUT*this.wait)&&(Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(req,def){var reqStatus;if(4===req.xhr.readyState)try{reqStatus=req.xhr.status}catch(e){Strophe.error("Caught an error while retrieving a request's status, reqStatus: "+reqStatus)}return void 0===reqStatus&&(reqStatus="number"==typeof def?def:0),reqStatus},_onRequestStateChange:function(func,req){if(Strophe.debug("request id "+req.id+"."+req.sends+" state changed to "+req.xhr.readyState),req.abort)req.abort=!1;else if(4===req.xhr.readyState){var reqStatus=this._getRequestStatus(req);if(this.lastResponseHeaders=req.xhr.getAllResponseHeaders(),this.disconnecting&&reqStatus>=400)return this._hitError(reqStatus),void this._callProtocolErrorHandlers(req);var valid_request=reqStatus>0&&reqStatus<500,too_many_retries=req.sends>this._conn.maxRetries;if((valid_request||too_many_retries)&&(this._removeRequest(req),Strophe.debug("request id "+req.id+" should now be removed")),200===reqStatus){var reqIs0=this._requests[0]===req;(this._requests[1]===req||reqIs0&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(req.rid)+1),Strophe.debug("request id "+req.id+"."+req.sends+" got 200"),func(req),this.errors=0}else 0===reqStatus||reqStatus>=400&&reqStatus<600||reqStatus>=12e3?(Strophe.error("request id "+req.id+"."+req.sends+" error "+reqStatus+" happened"),this._hitError(reqStatus),this._callProtocolErrorHandlers(req),reqStatus>=400&&reqStatus<500&&(this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING,null),this._conn._doDisconnect())):Strophe.error("request id "+req.id+"."+req.sends+" error "+reqStatus+" happened");valid_request||too_many_retries?too_many_retries&&!this._conn.connected&&this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(i){var _this=this,req=this._requests[i],reqStatus=this._getRequestStatus(req,-1);if(req.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var time_elapsed=req.age(),primary_timeout=!isNaN(time_elapsed)&&time_elapsed>Math.floor(Strophe.TIMEOUT*this.wait),secondary_timeout=null!==req.dead&&req.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait),server_error=4===req.xhr.readyState&&(reqStatus<1||reqStatus>=500);if((primary_timeout||secondary_timeout||server_error)&&(secondary_timeout&&Strophe.error("Request ".concat(this._requests[i].id," timed out (secondary), restarting")),req.abort=!0,req.xhr.abort(),req.xhr.onreadystatechange=function(){},this._requests[i]=new Strophe.Request(req.xmlData,req.origFunc,req.rid,req.sends),req=this._requests[i]),0===req.xhr.readyState){Strophe.debug("request id "+req.id+"."+req.sends+" posting");try{var content_type=this._conn.options.contentType||"text/xml; charset=utf-8";req.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==req.xhr.setRequestHeader&&req.xhr.setRequestHeader("Content-Type",content_type),this._conn.options.withCredentials&&(req.xhr.withCredentials=!0)}catch(e2){return Strophe.error("XHR open failed: "+e2.toString()),this._conn.connected||this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var sendFunc=function(){if(req.date=new Date,_this._conn.options.customHeaders){var headers=_this._conn.options.customHeaders;for(var header in headers)Object.prototype.hasOwnProperty.call(headers,header)&&req.xhr.setRequestHeader(header,headers[header])}req.xhr.send(req.data)};if(req.sends>1){var backoff=1e3*Math.min(Math.floor(Strophe.TIMEOUT*this.wait),Math.pow(req.sends,3));setTimeout((function(){sendFunc()}),backoff)}else sendFunc();req.sends++,this._conn.xmlOutput!==Strophe.Connection.prototype.xmlOutput&&(req.xmlData.nodeName===this.strip&&req.xmlData.childNodes.length?this._conn.xmlOutput(req.xmlData.childNodes[0]):this._conn.xmlOutput(req.xmlData)),this._conn.rawOutput!==Strophe.Connection.prototype.rawOutput&&this._conn.rawOutput(req.data)}else Strophe.debug("_processRequest: "+(0===i?"first":"second")+" request has readyState of "+req.xhr.readyState)}},_removeRequest:function(req){Strophe.debug("removing request");for(var i=this._requests.length-1;i>=0;i--)req===this._requests[i]&&this._requests.splice(i,1);req.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(i){var req=this._requests[i];null===req.dead&&(req.dead=new Date),this._processRequest(i)},_reqToData:function(req){try{return req.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(pres){Strophe.info("_sendTerminate was called");var body=this._buildBody().attrs({type:"terminate"});pres&&body.cnode(pres.tree());var req=new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),body.tree().getAttribute("rid"));this._requests.push(req),this._throttledRequestHandler()},_send:function(){var _this2=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((function(){return _this2._conn._onIdle()}),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?Strophe.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):Strophe.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Strophe",(function(){return Strophe})),__webpack_require__.d(__webpack_exports__,"$build",(function(){return $build})),__webpack_require__.d(__webpack_exports__,"$iq",(function(){return $iq})),__webpack_require__.d(__webpack_exports__,"$msg",(function(){return $msg})),__webpack_require__.d(__webpack_exports__,"$pres",(function(){return $pres}));var md5__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/md5.js");__webpack_require__.d(__webpack_exports__,"MD5",(function(){return md5__WEBPACK_IMPORTED_MODULE_0__.default}));var sha1__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/sha1.js");__webpack_require__.d(__webpack_exports__,"SHA1",(function(){return sha1__WEBPACK_IMPORTED_MODULE_1__.default}));var utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utils.js");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function $build(name,attrs){return new Strophe.Builder(name,attrs)}function $msg(attrs){return new Strophe.Builder("message",attrs)}function $iq(attrs){return new Strophe.Builder("iq",attrs)}function $pres(attrs){return new Strophe.Builder("presence",attrs)}var Strophe={VERSION:"1.3.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(tag){for(var i=0;i<Strophe.XHTML.tags.length;i++)if(tag===Strophe.XHTML.tags[i])return!0;return!1},validAttribute:function(tag,attribute){if(void 0!==Strophe.XHTML.attributes[tag]&&Strophe.XHTML.attributes[tag].length>0)for(var i=0;i<Strophe.XHTML.attributes[tag].length;i++)if(attribute===Strophe.XHTML.attributes[tag][i])return!0;return!1},validCSS:function(style){for(var i=0;i<Strophe.XHTML.css.length;i++)if(style===Strophe.XHTML.css[i])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(name,value){Strophe.NS[name]=value},forEachChild:function(elem,elemName,func){for(var i=0;i<elem.childNodes.length;i++){var childNode=elem.childNodes[i];childNode.nodeType!==Strophe.ElementType.NORMAL||elemName&&!this.isTagEqual(childNode,elemName)||func(childNode)}},isTagEqual:function(el,name){return el.tagName===name},_xmlGenerator:null,_makeGenerator:function(){var doc;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(doc=this._getIEXmlDom()).appendChild(doc.createElement("strophe")):doc=document.implementation.createDocument("jabber:client","strophe",null),doc},xmlGenerator:function(){return Strophe._xmlGenerator||(Strophe._xmlGenerator=Strophe._makeGenerator()),Strophe._xmlGenerator},_getIEXmlDom:function(){for(var doc=null,docStrings=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],d=0;d<docStrings.length&&null===doc;d++)try{doc=new ActiveXObject(docStrings[d])}catch(e){doc=null}return doc},xmlElement:function(name){if(!name)return null;for(var node=Strophe.xmlGenerator().createElement(name),a=1;a<arguments.length;a++){var arg=arguments[a];if(arg)if("string"==typeof arg||"number"==typeof arg)node.appendChild(Strophe.xmlTextNode(arg));else if("object"===_typeof(arg)&&"function"==typeof arg.sort)for(var i=0;i<arg.length;i++){var attr=arg[i];"object"===_typeof(attr)&&"function"==typeof attr.sort&&void 0!==attr[1]&&null!==attr[1]&&node.setAttribute(attr[0],attr[1])}else if("object"===_typeof(arg))for(var k in arg)Object.prototype.hasOwnProperty.call(arg,k)&&void 0!==arg[k]&&null!==arg[k]&&node.setAttribute(k,arg[k])}return node},xmlescape:function(text){return(text=(text=(text=(text=text.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(text){return(text=(text=(text=(text=text.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(text){return Strophe.xmlGenerator().createTextNode(text)},xmlHtmlNode:function(html){var node;return DOMParser?node=(new DOMParser).parseFromString(html,"text/xml"):((node=new ActiveXObject("Microsoft.XMLDOM")).async="false",node.loadXML(html)),node},getText:function(elem){if(!elem)return null;var str="";0===elem.childNodes.length&&elem.nodeType===Strophe.ElementType.TEXT&&(str+=elem.nodeValue);for(var i=0;i<elem.childNodes.length;i++)elem.childNodes[i].nodeType===Strophe.ElementType.TEXT&&(str+=elem.childNodes[i].nodeValue);return Strophe.xmlescape(str)},copyElement:function(elem){var el;if(elem.nodeType===Strophe.ElementType.NORMAL){el=Strophe.xmlElement(elem.tagName);for(var i=0;i<elem.attributes.length;i++)el.setAttribute(elem.attributes[i].nodeName,elem.attributes[i].value);for(var _i=0;_i<elem.childNodes.length;_i++)el.appendChild(Strophe.copyElement(elem.childNodes[_i]))}else elem.nodeType===Strophe.ElementType.TEXT&&(el=Strophe.xmlGenerator().createTextNode(elem.nodeValue));return el},createHtml:function(elem){var el;if(elem.nodeType===Strophe.ElementType.NORMAL){var tag=elem.nodeName.toLowerCase();if(Strophe.XHTML.validTag(tag))try{el=Strophe.xmlElement(tag);for(var i=0;i<Strophe.XHTML.attributes[tag].length;i++){var attribute=Strophe.XHTML.attributes[tag][i],value=elem.getAttribute(attribute);if(null!=value&&""!==value&&!1!==value&&0!==value)if("style"===attribute&&"object"===_typeof(value)&&void 0!==value.cssText&&(value=value.cssText),"style"===attribute){for(var css=[],cssAttrs=value.split(";"),j=0;j<cssAttrs.length;j++){var attr=cssAttrs[j].split(":"),cssName=attr[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(Strophe.XHTML.validCSS(cssName)){var cssValue=attr[1].replace(/^\s*/,"").replace(/\s*$/,"");css.push(cssName+": "+cssValue)}}css.length>0&&(value=css.join("; "),el.setAttribute(attribute,value))}else el.setAttribute(attribute,value)}for(var _i2=0;_i2<elem.childNodes.length;_i2++)el.appendChild(Strophe.createHtml(elem.childNodes[_i2]))}catch(e){el=Strophe.xmlTextNode("")}else{el=Strophe.xmlGenerator().createDocumentFragment();for(var _i3=0;_i3<elem.childNodes.length;_i3++)el.appendChild(Strophe.createHtml(elem.childNodes[_i3]))}}else if(elem.nodeType===Strophe.ElementType.FRAGMENT){el=Strophe.xmlGenerator().createDocumentFragment();for(var _i4=0;_i4<elem.childNodes.length;_i4++)el.appendChild(Strophe.createHtml(elem.childNodes[_i4]))}else elem.nodeType===Strophe.ElementType.TEXT&&(el=Strophe.xmlTextNode(elem.nodeValue));return el},escapeNode:function(node){return"string"!=typeof node?node:node.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(node){return"string"!=typeof node?node:node.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(jid){return jid.indexOf("@")<0?null:jid.split("@")[0]},getDomainFromJid:function(jid){var bare=Strophe.getBareJidFromJid(jid);if(bare.indexOf("@")<0)return bare;var parts=bare.split("@");return parts.splice(0,1),parts.join("@")},getResourceFromJid:function(jid){var s=jid.split("/");return s.length<2?null:(s.splice(0,1),s.join("/"))},getBareJidFromJid:function(jid){return jid?jid.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&Strophe.fatal(e.stack),e.sourceURL?Strophe.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?Strophe.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):Strophe.fatal("error: "+e.message)},log:function(level,msg){level===this.LogLevel.FATAL&&"object"===_typeof(window.console)&&"function"==typeof window.console.error&&window.console.error(msg)},debug:function(msg){this.log(this.LogLevel.DEBUG,msg)},info:function(msg){this.log(this.LogLevel.INFO,msg)},warn:function(msg){this.log(this.LogLevel.WARN,msg)},error:function(msg){this.log(this.LogLevel.ERROR,msg)},fatal:function(msg){this.log(this.LogLevel.FATAL,msg)},serialize:function(elem){if(!elem)return null;"function"==typeof elem.tree&&(elem=elem.tree());var arr,names=(arr=Array(elem.attributes.length).keys(),function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()).map((function(i){return elem.attributes[i].nodeName}));names.sort();var result=names.reduce((function(a,n){return"".concat(a," ").concat(n,'="').concat(Strophe.xmlescape(elem.attributes.getNamedItem(n).value),'"')}),"<".concat(elem.nodeName));if(elem.childNodes.length>0){result+=">";for(var i=0;i<elem.childNodes.length;i++){var child=elem.childNodes[i];switch(child.nodeType){case Strophe.ElementType.NORMAL:result+=Strophe.serialize(child);break;case Strophe.ElementType.TEXT:result+=Strophe.xmlescape(child.nodeValue);break;case Strophe.ElementType.CDATA:result+="<![CDATA["+child.nodeValue+"]]>"}}result+="</"+elem.nodeName+">"}else result+="/>";return result},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(name,ptype){Strophe._connectionPlugins[name]=ptype},Builder:function(name,attrs){"presence"!==name&&"message"!==name&&"iq"!==name||(attrs&&!attrs.xmlns?attrs.xmlns=Strophe.NS.CLIENT:attrs||(attrs={xmlns:Strophe.NS.CLIENT})),this.nodeTree=Strophe.xmlElement(name,attrs),this.node=this.nodeTree}};Strophe.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return Strophe.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(moreattrs){for(var k in moreattrs)Object.prototype.hasOwnProperty.call(moreattrs,k)&&(void 0===moreattrs[k]?this.node.removeAttribute(k):this.node.setAttribute(k,moreattrs[k]));return this},c:function(name,attrs,text){var child=Strophe.xmlElement(name,attrs,text);return this.node.appendChild(child),"string"!=typeof text&&"number"!=typeof text&&(this.node=child),this},cnode:function(elem){var impNode,xmlGen=Strophe.xmlGenerator();try{impNode=void 0!==xmlGen.importNode}catch(e){impNode=!1}var newElem=impNode?xmlGen.importNode(elem,!0):Strophe.copyElement(elem);return this.node.appendChild(newElem),this.node=newElem,this},t:function(text){var child=Strophe.xmlTextNode(text);return this.node.appendChild(child),this},h:function(html){var fragment=document.createElement("body");fragment.innerHTML=html;for(var xhtml=Strophe.createHtml(fragment);xhtml.childNodes.length>0;)this.node.appendChild(xhtml.childNodes[0]);return this}},Strophe.Handler=function(handler,ns,name,type,id,from,options){this.handler=handler,this.ns=ns,this.name=name,this.type=type,this.id=id,this.options=options||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(Strophe.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=from?Strophe.getBareJidFromJid(from):null:this.from=from,this.user=!0},Strophe.Handler.prototype={getNamespace:function(elem){var elNamespace=elem.getAttribute("xmlns");return elNamespace&&this.options.ignoreNamespaceFragment&&(elNamespace=elNamespace.split("#")[0]),elNamespace},namespaceMatch:function(elem){var _this=this,nsMatch=!1;return!this.ns||(Strophe.forEachChild(elem,null,(function(elem){_this.getNamespace(elem)===_this.ns&&(nsMatch=!0)})),nsMatch||this.getNamespace(elem)===this.ns)},isMatch:function(elem){var from=elem.getAttribute("from");this.options.matchBareFromJid&&(from=Strophe.getBareJidFromJid(from));var elem_type=elem.getAttribute("type");return!(!this.namespaceMatch(elem)||this.name&&!Strophe.isTagEqual(elem,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(elem_type):elem_type!==this.type)||this.id&&elem.getAttribute("id")!==this.id||this.from&&from!==this.from)},run:function(elem){var result=null;try{result=this.handler(elem)}catch(e){throw Strophe._handleError(e),e}return result},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},Strophe.TimedHandler=function(period,handler){this.period=period,this.handler=handler,this.lastCalled=(new Date).getTime(),this.user=!0},Strophe.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},Strophe.Connection=function(service,options){var _this2=this;this.service=service,this.options=options||{};var proto=this.options.protocol||"";for(var k in 0===service.indexOf("ws:")||0===service.indexOf("wss:")||0===proto.indexOf("ws")?this._proto=new Strophe.Websocket(this):this._proto=new Strophe.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((function(){return _this2._onIdle()}),100),utils__WEBPACK_IMPORTED_MODULE_2__.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),Strophe._connectionPlugins)if(Object.prototype.hasOwnProperty.call(Strophe._connectionPlugins,k)){var F=function(){};F.prototype=Strophe._connectionPlugins[k],this[k]=new F,this[k].init(this)}},Strophe.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(suffix){var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)}));return"string"==typeof suffix||"number"==typeof suffix?uuid+":"+suffix:uuid+""},addProtocolErrorHandler:function(protocol,status_code,callback){this.protocolErrorHandlers[protocol][status_code]=callback},connect:function(jid,pass,callback,wait,hold,route,authcid){this.jid=jid,this.authzid=Strophe.getBareJidFromJid(this.jid),this.authcid=authcid||Strophe.getNodeFromJid(this.jid),this.pass=pass,this.servtype="xmpp",this.connect_callback=callback,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=Strophe.getDomainFromJid(this.jid),this._changeConnectStatus(Strophe.Status.CONNECTING,null),this._proto._connect(wait,hold,route)},attach:function(jid,sid,rid,callback,wait,hold,wind){if(!(this._proto instanceof Strophe.Bosh)){var error=new Error('The "attach" method can only be used with a BOSH connection.');throw error.name="StropheSessionError",error}this._proto._attach(jid,sid,rid,callback,wait,hold,wind)},restore:function(jid,callback,wait,hold,wind){if(!this._sessionCachingSupported()){var error=new Error('The "restore" method can only be used with a BOSH connection.');throw error.name="StropheSessionError",error}this._proto._restore(jid,callback,wait,hold,wind)},_sessionCachingSupported:function(){if(this._proto instanceof Strophe.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(elem){},xmlOutput:function(elem){},rawInput:function(data){},rawOutput:function(data){},nextValidRid:function(rid){},send:function(elem){if(null!==elem){if("function"==typeof elem.sort)for(var i=0;i<elem.length;i++)this._queueData(elem[i]);else"function"==typeof elem.tree?this._queueData(elem.tree()):this._queueData(elem);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(elem,callback,errback,timeout){var _this3=this,timeoutHandler=null;"function"==typeof elem.tree&&(elem=elem.tree());var id=elem.getAttribute("id");if(id||(id=this.getUniqueId("sendPresence"),elem.setAttribute("id",id)),"function"==typeof callback||"function"==typeof errback){var handler=this.addHandler((function(stanza){timeoutHandler&&_this3.deleteTimedHandler(timeoutHandler),"error"===stanza.getAttribute("type")?errback&&errback(stanza):callback&&callback(stanza)}),null,"presence",null,id);timeout&&(timeoutHandler=this.addTimedHandler(timeout,(function(){return _this3.deleteHandler(handler),errback&&errback(null),!1})))}return this.send(elem),id},sendIQ:function(elem,callback,errback,timeout){var _this4=this,timeoutHandler=null;"function"==typeof elem.tree&&(elem=elem.tree());var id=elem.getAttribute("id");if(id||(id=this.getUniqueId("sendIQ"),elem.setAttribute("id",id)),"function"==typeof callback||"function"==typeof errback){var handler=this.addHandler((function(stanza){timeoutHandler&&_this4.deleteTimedHandler(timeoutHandler);var iqtype=stanza.getAttribute("type");if("result"===iqtype)callback&&callback(stanza);else{if("error"!==iqtype){var error=new Error("Got bad IQ type of ".concat(iqtype));throw error.name="StropheError",error}errback&&errback(stanza)}}),null,"iq",["error","result"],id);timeout&&(timeoutHandler=this.addTimedHandler(timeout,(function(){return _this4.deleteHandler(handler),errback&&errback(null),!1})))}return this.send(elem),id},_queueData:function(element){if(null===element||!element.tagName||!element.childNodes){var error=new Error("Cannot queue non-DOMElement.");throw error.name="StropheError",error}this._data.push(element)},_sendRestart:function(){var _this5=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((function(){return _this5._onIdle()}),100)},addTimedHandler:function(period,handler){var thand=new Strophe.TimedHandler(period,handler);return this.addTimeds.push(thand),thand},deleteTimedHandler:function(handRef){this.removeTimeds.push(handRef)},addHandler:function(handler,ns,name,type,id,from,options){var hand=new Strophe.Handler(handler,ns,name,type,id,from,options);return this.addHandlers.push(hand),hand},deleteHandler:function(handRef){this.removeHandlers.push(handRef);var i=this.addHandlers.indexOf(handRef);i>=0&&this.addHandlers.splice(i,1)},registerSASLMechanisms:function(mechanisms){this.mechanisms={},(mechanisms=mechanisms||[Strophe.SASLAnonymous,Strophe.SASLExternal,Strophe.SASLMD5,Strophe.SASLOAuthBearer,Strophe.SASLXOAuth2,Strophe.SASLPlain,Strophe.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(mechanism){this.mechanisms[mechanism.prototype.name]=mechanism},disconnect:function(reason){if(this._changeConnectStatus(Strophe.Status.DISCONNECTING,reason),Strophe.info("Disconnect was called because: "+reason),this.connected){var pres=!1;this.disconnecting=!0,this.authenticated&&(pres=$pres({xmlns:Strophe.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(pres)}else Strophe.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(status,condition,elem){for(var k in Strophe._connectionPlugins)if(Object.prototype.hasOwnProperty.call(Strophe._connectionPlugins,k)){var plugin=this[k];if(plugin.statusChanged)try{plugin.statusChanged(status,condition)}catch(err){Strophe.error("".concat(k," plugin caused an exception changing status: ").concat(err))}}if(this.connect_callback)try{this.connect_callback(status,condition,elem)}catch(e){Strophe._handleError(e),Strophe.error("User connection callback caused an exception: ".concat(e))}},_doDisconnect:function(condition){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),Strophe.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(Strophe.Status.DISCONNECTED,condition),this.connected=!1},_dataRecv:function(req,raw){var _this6=this;Strophe.info("_dataRecv called");var elem=this._proto._reqToData(req);if(null!==elem){for(this.xmlInput!==Strophe.Connection.prototype.xmlInput&&(elem.nodeName===this._proto.strip&&elem.childNodes.length?this.xmlInput(elem.childNodes[0]):this.xmlInput(elem)),this.rawInput!==Strophe.Connection.prototype.rawInput&&(raw?this.rawInput(raw):this.rawInput(Strophe.serialize(elem)));this.removeHandlers.length>0;){var hand=this.removeHandlers.pop(),i=this.handlers.indexOf(hand);i>=0&&this.handlers.splice(i,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var type=elem.getAttribute("type");if(null!==type&&"terminate"===type){if(this.disconnecting)return;var cond=elem.getAttribute("condition"),conflict=elem.getElementsByTagName("conflict");return null!==cond?("remote-stream-error"===cond&&conflict.length>0&&(cond="conflict"),this._changeConnectStatus(Strophe.Status.CONNFAIL,cond)):this._changeConnectStatus(Strophe.Status.CONNFAIL,Strophe.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(cond)}Strophe.forEachChild(elem,null,(function(child){var newList=_this6.handlers;_this6.handlers=[];for(var _i5=0;_i5<newList.length;_i5++){var _hand=newList[_i5];try{(!_hand.isMatch(child)||!_this6.authenticated&&_hand.user||_hand.run(child))&&_this6.handlers.push(_hand)}catch(e){Strophe.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}}))}}},mechanisms:{},_connect_cb:function(req,_callback,raw){var bodyWrap;Strophe.info("_connect_cb was called"),this.connected=!0;try{bodyWrap=this._proto._reqToData(req)}catch(e){if(e.name!==Strophe.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(Strophe.Status.CONNFAIL,Strophe.ErrorCondition.BAD_FORMAT),this._doDisconnect(Strophe.ErrorCondition.BAD_FORMAT)}if(bodyWrap&&(this.xmlInput!==Strophe.Connection.prototype.xmlInput&&(bodyWrap.nodeName===this._proto.strip&&bodyWrap.childNodes.length?this.xmlInput(bodyWrap.childNodes[0]):this.xmlInput(bodyWrap)),this.rawInput!==Strophe.Connection.prototype.rawInput&&(raw?this.rawInput(raw):this.rawInput(Strophe.serialize(bodyWrap))),this._proto._connect_cb(bodyWrap)!==Strophe.Status.CONNFAIL))if(bodyWrap.getElementsByTagNameNS?bodyWrap.getElementsByTagNameNS(Strophe.NS.STREAM,"features").length>0:bodyWrap.getElementsByTagName("stream:features").length>0||bodyWrap.getElementsByTagName("features").length>0){var matched=[],mechanisms=bodyWrap.getElementsByTagName("mechanism");if(mechanisms.length>0)for(var i=0;i<mechanisms.length;i++){var mech=Strophe.getText(mechanisms[i]);this.mechanisms[mech]&&matched.push(this.mechanisms[mech])}0!==matched.length||0!==bodyWrap.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(matched):this._proto._no_auth_received(_callback)}else this._proto._no_auth_received(_callback)},sortMechanismsByPriority:function(mechanisms){for(var i=0;i<mechanisms.length-1;++i){for(var higher=i,j=i+1;j<mechanisms.length;++j)mechanisms[j].prototype.priority>mechanisms[higher].prototype.priority&&(higher=j);if(higher!==i){var swap=mechanisms[i];mechanisms[i]=mechanisms[higher],mechanisms[higher]=swap}}return mechanisms},_attemptSASLAuth:function(mechanisms){mechanisms=this.sortMechanismsByPriority(mechanisms||[]);for(var mechanism_found=!1,i=0;i<mechanisms.length;++i)if(mechanisms[i].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new mechanisms[i],this._sasl_mechanism.onStart(this);var request_auth_exchange=$build("auth",{xmlns:Strophe.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var response=this._sasl_mechanism.onChallenge(this,null);request_auth_exchange.t(btoa(response))}this.send(request_auth_exchange.tree()),mechanism_found=!0;break}return mechanism_found},_attemptLegacyAuth:function(){null===Strophe.getNodeFromJid(this.jid)?(this._changeConnectStatus(Strophe.Status.CONNFAIL,Strophe.ErrorCondition.MISSING_JID_NODE),this.disconnect(Strophe.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send($iq({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:Strophe.NS.AUTH}).c("username",{}).t(Strophe.getNodeFromJid(this.jid)).tree()))},authenticate:function(matched){this._attemptSASLAuth(matched)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(elem){var challenge=atob(Strophe.getText(elem)),response=this._sasl_mechanism.onChallenge(this,challenge),stanza=$build("response",{xmlns:Strophe.NS.SASL});return""!==response&&stanza.t(btoa(response)),this.send(stanza.tree()),!0},_auth1_cb:function(elem){var iq=$iq({type:"set",id:"_auth_2"}).c("query",{xmlns:Strophe.NS.AUTH}).c("username",{}).t(Strophe.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return Strophe.getResourceFromJid(this.jid)||(this.jid=Strophe.getBareJidFromJid(this.jid)+"/strophe"),iq.up().c("resource",{}).t(Strophe.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(iq.tree()),!1},_sasl_success_cb:function(elem){var _this7=this;if(this._sasl_data["server-signature"]){var serverSignature,matches=atob(Strophe.getText(elem)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===matches[1]&&(serverSignature=matches[2]),serverSignature!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}Strophe.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var streamfeature_handlers=[],wrapper=function(handlers,elem){for(;handlers.length;)_this7.deleteHandler(handlers.pop());return _this7._sasl_auth1_cb(elem),!1};return streamfeature_handlers.push(this._addSysHandler((function(elem){return wrapper(streamfeature_handlers,elem)}),null,"stream:features",null,null)),streamfeature_handlers.push(this._addSysHandler((function(elem){return wrapper(streamfeature_handlers,elem)}),Strophe.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(elem){this.features=elem;for(var i=0;i<elem.childNodes.length;i++){var child=elem.childNodes[i];"bind"===child.nodeName&&(this.do_bind=!0),"session"===child.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(Strophe.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var resource=Strophe.getResourceFromJid(this.jid);return resource?this.send($iq({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Strophe.NS.BIND}).c("resource",{}).t(resource).tree()):this.send($iq({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Strophe.NS.BIND}).tree()),!1},_sasl_bind_cb:function(elem){var condition;if("error"===elem.getAttribute("type"))return Strophe.info("SASL binding failed."),elem.getElementsByTagName("conflict").length>0&&(condition=Strophe.ErrorCondition.CONFLICT),this._changeConnectStatus(Strophe.Status.AUTHFAIL,condition,elem),!1;var bind=elem.getElementsByTagName("bind");if(!(bind.length>0))return Strophe.info("SASL binding failed."),this._changeConnectStatus(Strophe.Status.AUTHFAIL,null,elem),!1;var jidNode=bind[0].getElementsByTagName("jid");jidNode.length>0&&(this.jid=Strophe.getText(jidNode[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send($iq({type:"set",id:"_session_auth_2"}).c("session",{xmlns:Strophe.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(Strophe.Status.CONNECTED,null)))},_sasl_session_cb:function(elem){if("result"===elem.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(Strophe.Status.CONNECTED,null);else if("error"===elem.getAttribute("type"))return Strophe.info("Session creation failed."),this._changeConnectStatus(Strophe.Status.AUTHFAIL,null,elem),!1;return!1},_sasl_failure_cb:function(elem){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(Strophe.Status.AUTHFAIL,null,elem),!1},_auth2_cb:function(elem){return"result"===elem.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(Strophe.Status.CONNECTED,null)):"error"===elem.getAttribute("type")&&(this._changeConnectStatus(Strophe.Status.AUTHFAIL,null,elem),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(period,handler){var thand=new Strophe.TimedHandler(period,handler);return thand.user=!1,this.addTimeds.push(thand),thand},_addSysHandler:function(handler,ns,name,type,id){var hand=new Strophe.Handler(handler,ns,name,type,id);return hand.user=!1,this.addHandlers.push(hand),hand},_onDisconnectTimeout:function(){return Strophe.info("_onDisconnectTimeout was called"),this._changeConnectStatus(Strophe.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var _this8=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var thand=this.removeTimeds.pop(),i=this.timedHandlers.indexOf(thand);i>=0&&this.timedHandlers.splice(i,1)}for(var now=(new Date).getTime(),newList=[],_i6=0;_i6<this.timedHandlers.length;_i6++){var _thand=this.timedHandlers[_i6];!this.authenticated&&_thand.user||(_thand.lastCalled+_thand.period-now<=0?_thand.run()&&newList.push(_thand):newList.push(_thand))}this.timedHandlers=newList,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((function(){return _this8._onIdle()}),100))}},Strophe.SASLMechanism=function(name,isClientFirst,priority){this.name=name,this.isClientFirst=isClientFirst,this.priority=priority},Strophe.SASLMechanism.prototype={test:function(connection){return!0},onStart:function(connection){this._connection=connection},onChallenge:function(connection,challenge){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},Strophe.SASLAnonymous=function(){},Strophe.SASLAnonymous.prototype=new Strophe.SASLMechanism("ANONYMOUS",!1,20),Strophe.SASLAnonymous.prototype.test=function(connection){return null===connection.authcid},Strophe.SASLPlain=function(){},Strophe.SASLPlain.prototype=new Strophe.SASLMechanism("PLAIN",!0,50),Strophe.SASLPlain.prototype.test=function(connection){return null!==connection.authcid},Strophe.SASLPlain.prototype.onChallenge=function(connection){var auth_str=connection.authzid;return auth_str+="\0",auth_str+=connection.authcid,auth_str+="\0",auth_str+=connection.pass,utils__WEBPACK_IMPORTED_MODULE_2__.default.utf16to8(auth_str)},Strophe.SASLSHA1=function(){},Strophe.SASLSHA1.prototype=new Strophe.SASLMechanism("SCRAM-SHA-1",!0,70),Strophe.SASLSHA1.prototype.test=function(connection){return null!==connection.authcid},Strophe.SASLSHA1.prototype.onChallenge=function(connection,challenge,test_cnonce){var cnonce=test_cnonce||md5__WEBPACK_IMPORTED_MODULE_0__.default.hexdigest(1234567890*Math.random()),auth_str="n="+utils__WEBPACK_IMPORTED_MODULE_2__.default.utf16to8(connection.authcid);return auth_str+=",r=",auth_str+=cnonce,connection._sasl_data.cnonce=cnonce,connection._sasl_data["client-first-message-bare"]=auth_str,auth_str="n,,"+auth_str,this.onChallenge=function(connection,challenge){for(var nonce,salt,iter,Hi,U,U_old,i,k,responseText="c=biws,",authMessage="".concat(connection._sasl_data["client-first-message-bare"],",").concat(challenge,","),cnonce=connection._sasl_data.cnonce,attribMatch=/([a-z]+)=([^,]+)(,|$)/;challenge.match(attribMatch);){var matches=challenge.match(attribMatch);switch(challenge=challenge.replace(matches[0],""),matches[1]){case"r":nonce=matches[2];break;case"s":salt=matches[2];break;case"i":iter=matches[2]}}if(nonce.substr(0,cnonce.length)!==cnonce)return connection._sasl_data={},connection._sasl_failure_cb();authMessage+=responseText+="r="+nonce,salt=atob(salt),salt+="\0\0\0\x01";var pass=utils__WEBPACK_IMPORTED_MODULE_2__.default.utf16to8(connection.pass);for(Hi=U_old=sha1__WEBPACK_IMPORTED_MODULE_1__.default.core_hmac_sha1(pass,salt),i=1;i<iter;i++){for(U=sha1__WEBPACK_IMPORTED_MODULE_1__.default.core_hmac_sha1(pass,sha1__WEBPACK_IMPORTED_MODULE_1__.default.binb2str(U_old)),k=0;k<5;k++)Hi[k]^=U[k];U_old=U}Hi=sha1__WEBPACK_IMPORTED_MODULE_1__.default.binb2str(Hi);var clientKey=sha1__WEBPACK_IMPORTED_MODULE_1__.default.core_hmac_sha1(Hi,"Client Key"),serverKey=sha1__WEBPACK_IMPORTED_MODULE_1__.default.str_hmac_sha1(Hi,"Server Key"),clientSignature=sha1__WEBPACK_IMPORTED_MODULE_1__.default.core_hmac_sha1(sha1__WEBPACK_IMPORTED_MODULE_1__.default.str_sha1(sha1__WEBPACK_IMPORTED_MODULE_1__.default.binb2str(clientKey)),authMessage);for(connection._sasl_data["server-signature"]=sha1__WEBPACK_IMPORTED_MODULE_1__.default.b64_hmac_sha1(serverKey,authMessage),k=0;k<5;k++)clientKey[k]^=clientSignature[k];return responseText+",p="+btoa(sha1__WEBPACK_IMPORTED_MODULE_1__.default.binb2str(clientKey))},auth_str},Strophe.SASLMD5=function(){},Strophe.SASLMD5.prototype=new Strophe.SASLMechanism("DIGEST-MD5",!1,60),Strophe.SASLMD5.prototype.test=function(connection){return null!==connection.authcid},Strophe.SASLMD5.prototype._quote=function(str){return'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},Strophe.SASLMD5.prototype.onChallenge=function(connection,challenge,test_cnonce){for(var attribMatch=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,cnonce=test_cnonce||md5__WEBPACK_IMPORTED_MODULE_0__.default.hexdigest(""+1234567890*Math.random()),realm="",host=null,nonce="";challenge.match(attribMatch);){var matches=challenge.match(attribMatch);switch(challenge=challenge.replace(matches[0],""),matches[2]=matches[2].replace(/^"(.+)"$/,"$1"),matches[1]){case"realm":realm=matches[2];break;case"nonce":nonce=matches[2];break;case"qop":matches[2];break;case"host":host=matches[2]}}var digest_uri=connection.servtype+"/"+connection.domain;null!==host&&(digest_uri=digest_uri+"/"+host);var cred=utils__WEBPACK_IMPORTED_MODULE_2__.default.utf16to8(connection.authcid+":"+realm+":"+this._connection.pass),A1=md5__WEBPACK_IMPORTED_MODULE_0__.default.hash(cred)+":"+nonce+":"+cnonce,A2="AUTHENTICATE:"+digest_uri,responseText="";return responseText+="charset=utf-8,",responseText+="username="+this._quote(utils__WEBPACK_IMPORTED_MODULE_2__.default.utf16to8(connection.authcid))+",",responseText+="realm="+this._quote(realm)+",",responseText+="nonce="+this._quote(nonce)+",",responseText+="nc=00000001,",responseText+="cnonce="+this._quote(cnonce)+",",responseText+="digest-uri="+this._quote(digest_uri)+",",responseText+="response="+md5__WEBPACK_IMPORTED_MODULE_0__.default.hexdigest(md5__WEBPACK_IMPORTED_MODULE_0__.default.hexdigest(A1)+":"+nonce+":00000001:"+cnonce+":auth:"+md5__WEBPACK_IMPORTED_MODULE_0__.default.hexdigest(A2))+",",responseText+="qop=auth",this.onChallenge=function(){return""},responseText},Strophe.SASLOAuthBearer=function(){},Strophe.SASLOAuthBearer.prototype=new Strophe.SASLMechanism("OAUTHBEARER",!0,40),Strophe.SASLOAuthBearer.prototype.test=function(connection){return null!==connection.pass},Strophe.SASLOAuthBearer.prototype.onChallenge=function(connection){var auth_str="n,";return null!==connection.authcid&&(auth_str=auth_str+"a="+connection.authzid),auth_str+=",",auth_str+="\x01",auth_str+="auth=Bearer ",auth_str+=connection.pass,auth_str+="\x01",auth_str+="\x01",utils__WEBPACK_IMPORTED_MODULE_2__.default.utf16to8(auth_str)},Strophe.SASLExternal=function(){},Strophe.SASLExternal.prototype=new Strophe.SASLMechanism("EXTERNAL",!0,10),Strophe.SASLExternal.prototype.onChallenge=function(connection){return connection.authcid===connection.authzid?"":connection.authzid},Strophe.SASLXOAuth2=function(){},Strophe.SASLXOAuth2.prototype=new Strophe.SASLMechanism("X-OAUTH2",!0,30),Strophe.SASLXOAuth2.prototype.test=function(connection){return null!==connection.pass},Strophe.SASLXOAuth2.prototype.onChallenge=function(connection){var auth_str="\0";return null!==connection.authcid&&(auth_str+=connection.authzid),auth_str+="\0",auth_str+=connection.pass,utils__WEBPACK_IMPORTED_MODULE_2__.default.utf16to8(auth_str)},__webpack_exports__.default={Strophe:Strophe,$build:$build,$iq:$iq,$msg:$msg,$pres:$pres,SHA1:sha1__WEBPACK_IMPORTED_MODULE_1__.default,MD5:md5__WEBPACK_IMPORTED_MODULE_0__.default,b64_hmac_sha1:sha1__WEBPACK_IMPORTED_MODULE_1__.default.b64_hmac_sha1,b64_sha1:sha1__WEBPACK_IMPORTED_MODULE_1__.default.b64_sha1,str_hmac_sha1:sha1__WEBPACK_IMPORTED_MODULE_1__.default.str_hmac_sha1,str_sha1:sha1__WEBPACK_IMPORTED_MODULE_1__.default.str_sha1}},"./src/md5.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return MD5}));var safe_add=function(x,y){var lsw=(65535&x)+(65535&y);return(x>>16)+(y>>16)+(lsw>>16)<<16|65535&lsw},str2binl=function(str){for(var bin=[],i=0;i<8*str.length;i+=8)bin[i>>5]|=(255&str.charCodeAt(i/8))<<i%32;return bin},md5_cmn=function(q,a,b,x,s,t){return safe_add((num=safe_add(safe_add(a,q),safe_add(x,t)))<<(cnt=s)|num>>>32-cnt,b);var num,cnt},md5_ff=function(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)},md5_gg=function(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)},md5_hh=function(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)},md5_ii=function(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)},core_md5=function(x,len){x[len>>5]|=128<<len%32,x[14+(len+64>>>9<<4)]=len;for(var olda,oldb,oldc,oldd,a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<x.length;i+=16)olda=a,oldb=b,oldc=c,oldd=d,a=md5_ff(a,b,c,d,x[i+0],7,-680876936),d=md5_ff(d,a,b,c,x[i+1],12,-389564586),c=md5_ff(c,d,a,b,x[i+2],17,606105819),b=md5_ff(b,c,d,a,x[i+3],22,-1044525330),a=md5_ff(a,b,c,d,x[i+4],7,-176418897),d=md5_ff(d,a,b,c,x[i+5],12,1200080426),c=md5_ff(c,d,a,b,x[i+6],17,-1473231341),b=md5_ff(b,c,d,a,x[i+7],22,-45705983),a=md5_ff(a,b,c,d,x[i+8],7,1770035416),d=md5_ff(d,a,b,c,x[i+9],12,-1958414417),c=md5_ff(c,d,a,b,x[i+10],17,-42063),b=md5_ff(b,c,d,a,x[i+11],22,-1990404162),a=md5_ff(a,b,c,d,x[i+12],7,1804603682),d=md5_ff(d,a,b,c,x[i+13],12,-40341101),c=md5_ff(c,d,a,b,x[i+14],17,-1502002290),b=md5_ff(b,c,d,a,x[i+15],22,1236535329),a=md5_gg(a,b,c,d,x[i+1],5,-165796510),d=md5_gg(d,a,b,c,x[i+6],9,-1069501632),c=md5_gg(c,d,a,b,x[i+11],14,643717713),b=md5_gg(b,c,d,a,x[i+0],20,-373897302),a=md5_gg(a,b,c,d,x[i+5],5,-701558691),d=md5_gg(d,a,b,c,x[i+10],9,38016083),c=md5_gg(c,d,a,b,x[i+15],14,-660478335),b=md5_gg(b,c,d,a,x[i+4],20,-405537848),a=md5_gg(a,b,c,d,x[i+9],5,568446438),d=md5_gg(d,a,b,c,x[i+14],9,-1019803690),c=md5_gg(c,d,a,b,x[i+3],14,-187363961),b=md5_gg(b,c,d,a,x[i+8],20,1163531501),a=md5_gg(a,b,c,d,x[i+13],5,-1444681467),d=md5_gg(d,a,b,c,x[i+2],9,-51403784),c=md5_gg(c,d,a,b,x[i+7],14,1735328473),b=md5_gg(b,c,d,a,x[i+12],20,-1926607734),a=md5_hh(a,b,c,d,x[i+5],4,-378558),d=md5_hh(d,a,b,c,x[i+8],11,-2022574463),c=md5_hh(c,d,a,b,x[i+11],16,1839030562),b=md5_hh(b,c,d,a,x[i+14],23,-35309556),a=md5_hh(a,b,c,d,x[i+1],4,-1530992060),d=md5_hh(d,a,b,c,x[i+4],11,1272893353),c=md5_hh(c,d,a,b,x[i+7],16,-155497632),b=md5_hh(b,c,d,a,x[i+10],23,-1094730640),a=md5_hh(a,b,c,d,x[i+13],4,681279174),d=md5_hh(d,a,b,c,x[i+0],11,-358537222),c=md5_hh(c,d,a,b,x[i+3],16,-722521979),b=md5_hh(b,c,d,a,x[i+6],23,76029189),a=md5_hh(a,b,c,d,x[i+9],4,-640364487),d=md5_hh(d,a,b,c,x[i+12],11,-421815835),c=md5_hh(c,d,a,b,x[i+15],16,530742520),b=md5_hh(b,c,d,a,x[i+2],23,-995338651),a=md5_ii(a,b,c,d,x[i+0],6,-198630844),d=md5_ii(d,a,b,c,x[i+7],10,1126891415),c=md5_ii(c,d,a,b,x[i+14],15,-1416354905),b=md5_ii(b,c,d,a,x[i+5],21,-57434055),a=md5_ii(a,b,c,d,x[i+12],6,1700485571),d=md5_ii(d,a,b,c,x[i+3],10,-1894986606),c=md5_ii(c,d,a,b,x[i+10],15,-1051523),b=md5_ii(b,c,d,a,x[i+1],21,-2054922799),a=md5_ii(a,b,c,d,x[i+8],6,1873313359),d=md5_ii(d,a,b,c,x[i+15],10,-30611744),c=md5_ii(c,d,a,b,x[i+6],15,-1560198380),b=md5_ii(b,c,d,a,x[i+13],21,1309151649),a=md5_ii(a,b,c,d,x[i+4],6,-145523070),d=md5_ii(d,a,b,c,x[i+11],10,-1120210379),c=md5_ii(c,d,a,b,x[i+2],15,718787259),b=md5_ii(b,c,d,a,x[i+9],21,-343485551),a=safe_add(a,olda),b=safe_add(b,oldb),c=safe_add(c,oldc),d=safe_add(d,oldd);return[a,b,c,d]},MD5={hexdigest:function(s){return function(binarray){for(var str="",i=0;i<4*binarray.length;i++)str+="0123456789abcdef".charAt(binarray[i>>2]>>i%4*8+4&15)+"0123456789abcdef".charAt(binarray[i>>2]>>i%4*8&15);return str}(core_md5(str2binl(s),8*s.length))},hash:function(s){return function(bin){for(var str="",i=0;i<32*bin.length;i+=8)str+=String.fromCharCode(bin[i>>5]>>>i%32&255);return str}(core_md5(str2binl(s),8*s.length))}}},"./src/sha1.js":function(module,__webpack_exports__,__webpack_require__){function core_sha1(x,len){x[len>>5]|=128<<24-len%32,x[15+(len+64>>9<<4)]=len;var i,j,t,olda,oldb,oldc,oldd,olde,w=new Array(80),a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(i=0;i<x.length;i+=16){for(olda=a,oldb=b,oldc=c,oldd=d,olde=e,j=0;j<80;j++)w[j]=j<16?x[i+j]:rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1),t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j))),e=d,d=c,c=rol(b,30),b=a,a=t;a=safe_add(a,olda),b=safe_add(b,oldb),c=safe_add(c,oldc),d=safe_add(d,oldd),e=safe_add(e,olde)}return[a,b,c,d,e]}function sha1_ft(t,b,c,d){return t<20?b&c|~b&d:t<40?b^c^d:t<60?b&c|b&d|c&d:b^c^d}function sha1_kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function core_hmac_sha1(key,data){var bkey=str2binb(key);bkey.length>16&&(bkey=core_sha1(bkey,8*key.length));for(var ipad=new Array(16),opad=new Array(16),i=0;i<16;i++)ipad[i]=909522486^bkey[i],opad[i]=1549556828^bkey[i];var hash=core_sha1(ipad.concat(str2binb(data)),512+8*data.length);return core_sha1(opad.concat(hash),672)}function safe_add(x,y){var lsw=(65535&x)+(65535&y);return(x>>16)+(y>>16)+(lsw>>16)<<16|65535&lsw}function rol(num,cnt){return num<<cnt|num>>>32-cnt}function str2binb(str){for(var bin=[],i=0;i<8*str.length;i+=8)bin[i>>5]|=(255&str.charCodeAt(i/8))<<24-i%32;return bin}function binb2b64(binarray){for(var triplet,j,str="",i=0;i<4*binarray.length;i+=3)for(triplet=(binarray[i>>2]>>8*(3-i%4)&255)<<16|(binarray[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|binarray[i+2>>2]>>8*(3-(i+2)%4)&255,j=0;j<4;j++)8*i+6*j>32*binarray.length?str+="=":str+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(triplet>>6*(3-j)&63);return str}function binb2str(bin){for(var str="",i=0;i<32*bin.length;i+=8)str+=String.fromCharCode(bin[i>>5]>>>24-i%32&255);return str}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return SHA1}));var SHA1={b64_hmac_sha1:function(key,data){return binb2b64(core_hmac_sha1(key,data))},b64_sha1:function(s){return binb2b64(core_sha1(str2binb(s),8*s.length))},binb2str:binb2str,core_hmac_sha1:core_hmac_sha1,str_hmac_sha1:function(key,data){return binb2str(core_hmac_sha1(key,data))},str_sha1:function(s){return binb2str(core_sha1(str2binb(s),8*s.length))}}},"./src/strophe.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),function(global){var core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/core.js");__webpack_require__("./src/bosh.js"),__webpack_require__("./src/websocket.js"),__webpack_require__.d(__webpack_exports__,"default",(function(){return core__WEBPACK_IMPORTED_MODULE_0__.default})),global.Strophe=core__WEBPACK_IMPORTED_MODULE_0__.default.Strophe,global.$build=core__WEBPACK_IMPORTED_MODULE_0__.default.$build,global.$iq=core__WEBPACK_IMPORTED_MODULE_0__.default.$iq,global.$msg=core__WEBPACK_IMPORTED_MODULE_0__.default.$msg,global.$pres=core__WEBPACK_IMPORTED_MODULE_0__.default.$pres}.call(this,__webpack_require__("./node_modules/webpack/buildin/global.js"))},"./src/utils.js":function(module,__webpack_exports__,__webpack_require__){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return utils}));var utils={utf16to8:function(str){var i,c,out="",len=str.length;for(i=0;i<len;i++)(c=str.charCodeAt(i))>=0&&c<=127?out+=str.charAt(i):c>2047?(out+=String.fromCharCode(224|c>>12&15),out+=String.fromCharCode(128|c>>6&63),out+=String.fromCharCode(128|c>>0&63)):(out+=String.fromCharCode(192|c>>6&31),out+=String.fromCharCode(128|c>>0&63));return out},addCookies:function(cookies){for(var cookieName in cookies=cookies||{})if(Object.prototype.hasOwnProperty.call(cookies,cookieName)){var expires="",domain="",path="",cookieObj=cookies[cookieName],isObj="object"===_typeof(cookieObj),cookieValue=escape(unescape(isObj?cookieObj.value:cookieObj));isObj&&(expires=cookieObj.expires?";expires="+cookieObj.expires:"",domain=cookieObj.domain?";domain="+cookieObj.domain:"",path=cookieObj.path?";path="+cookieObj.path:""),document.cookie=cookieName+"="+cookieValue+expires+domain+path}}}},"./src/websocket.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/core.js"),Strophe=core__WEBPACK_IMPORTED_MODULE_0__.default.Strophe,$build=core__WEBPACK_IMPORTED_MODULE_0__.default.$build;Strophe.Websocket=function(connection){this._conn=connection,this.strip="wrapper";var service=connection.service;if(0!==service.indexOf("ws:")&&0!==service.indexOf("wss:")){var new_service="";"ws"===connection.options.protocol&&"https:"!==window.location.protocol?new_service+="ws":new_service+="wss",new_service+="://"+window.location.host,0!==service.indexOf("/")?new_service+=window.location.pathname+service:new_service+=service,connection.service=new_service}},Strophe.Websocket.prototype={_buildStream:function(){return $build("open",{xmlns:Strophe.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(bodyWrap,connectstatus){var errors;if(0===(errors=bodyWrap.getElementsByTagNameNS?bodyWrap.getElementsByTagNameNS(Strophe.NS.STREAM,"error"):bodyWrap.getElementsByTagName("stream:error")).length)return!1;for(var error=errors[0],condition="",text="",i=0;i<error.childNodes.length;i++){var e=error.childNodes[i];if("urn:ietf:params:xml:ns:xmpp-streams"!==e.getAttribute("xmlns"))break;"text"===e.nodeName?text=e.textContent:condition=e.nodeName}var errorString="WebSocket stream error: ";return errorString+=condition||"unknown",text&&(errorString+=" - "+text),Strophe.error(errorString),this._conn._changeConnectStatus(connectstatus,condition),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(bodyWrap){if(this._check_streamerror(bodyWrap,Strophe.Status.CONNFAIL))return Strophe.Status.CONNFAIL},_handleStreamStart:function(message){var error=!1,ns=message.getAttribute("xmlns");"string"!=typeof ns?error="Missing xmlns in <open />":ns!==Strophe.NS.FRAMING&&(error="Wrong xmlns in <open />: "+ns);var ver=message.getAttribute("version");return"string"!=typeof ver?error="Missing version in <open />":"1.0"!==ver&&(error="Wrong version in <open />: "+ver),!error||(this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,error),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(message){if(0===message.data.indexOf("<open ")||0===message.data.indexOf("<?xml")){var data=message.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===data)return;var streamStart=(new DOMParser).parseFromString(data,"text/xml").documentElement;this._conn.xmlInput(streamStart),this._conn.rawInput(message.data),this._handleStreamStart(streamStart)&&this._connect_cb(streamStart)}else if(0===message.data.indexOf("<close ")){var parsedMessage=(new DOMParser).parseFromString(message.data,"text/xml").documentElement;this._conn.xmlInput(parsedMessage),this._conn.rawInput(message.data);var see_uri=parsedMessage.getAttribute("see-other-uri");if(see_uri){var service=this._conn.service;(service.indexOf("wss:")>=0&&see_uri.indexOf("wss:")>=0||service.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(Strophe.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=see_uri,this._connect())}else this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var string=this._streamWrap(message.data),elem=(new DOMParser).parseFromString(string,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(elem,null,message.data)}},_disconnect:function(pres){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){pres&&this._conn.send(pres);var close=$build("close",{xmlns:Strophe.NS.FRAMING});this._conn.xmlOutput(close.tree());var closeString=Strophe.serialize(close);this._conn.rawOutput(closeString);try{this.socket.send(closeString)}catch(e){Strophe.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Strophe.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(stanza){return"<wrapper>"+stanza+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(e){Strophe.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(Strophe.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(Strophe.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):Strophe.info("Websocket closed")},_no_auth_received:function(callback){Strophe.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(Strophe.Status.CONNFAIL,Strophe.ErrorCondition.NO_AUTH_MECH),callback&&callback.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(error){Strophe.error("Websocket error "+error),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var data=this._conn._data;if(data.length>0&&!this._conn.paused){for(var i=0;i<data.length;i++)if(null!==data[i]){var stanza;stanza="restart"===data[i]?this._buildStream().tree():data[i];var rawStanza=Strophe.serialize(stanza);this._conn.xmlOutput(stanza),this._conn.rawOutput(rawStanza),this.socket.send(rawStanza)}this._conn._data=[]}},_onMessage:function(message){var elem,close='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(message.data===close)return this._conn.rawInput(close),this._conn.xmlInput(message),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===message.data.search("<open ")){if(elem=(new DOMParser).parseFromString(message.data,"text/xml").documentElement,!this._handleStreamStart(elem))return}else{var data=this._streamWrap(message.data);elem=(new DOMParser).parseFromString(data,"text/xml").documentElement}return this._check_streamerror(elem,Strophe.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===elem.firstChild.nodeName&&"unavailable"===elem.firstChild.getAttribute("type")?(this._conn.xmlInput(elem),void this._conn.rawInput(Strophe.serialize(elem))):void this._conn._dataRecv(elem,message.data)},_onOpen:function(){Strophe.info("Websocket open");var start=this._buildStream();this._conn.xmlOutput(start.tree());var startString=Strophe.serialize(start);this._conn.rawOutput(startString),this.socket.send(startString)},_reqToData:function(stanza){return stanza},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},module.exports=factory()},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,"a",(function(){return BehaviorSubject}));var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_Subject__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23),_util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(30),BehaviorSubject=function(_super){function BehaviorSubject(_value){var _this=_super.call(this)||this;return _this._value=_value,_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.a(BehaviorSubject,_super),Object.defineProperty(BehaviorSubject.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),BehaviorSubject.prototype._subscribe=function(subscriber){var subscription=_super.prototype._subscribe.call(this,subscriber);return subscription&&!subscription.closed&&subscriber.next(this._value),subscription},BehaviorSubject.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new _util_ObjectUnsubscribedError__WEBPACK_IMPORTED_MODULE_2__.a;return this._value},BehaviorSubject.prototype.next=function(value){_super.prototype.next.call(this,this._value=value)},BehaviorSubject}(_Subject__WEBPACK_IMPORTED_MODULE_1__.a)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.isFunction=function(x){return"function"==typeof x}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var config_1=__webpack_require__(68),hostReportError_1=__webpack_require__(80);exports.empty={closed:!0,next:function(value){},error:function(err){if(config_1.config.useDeprecatedSynchronousErrorHandling)throw err;hostReportError_1.hostReportError(err)},complete:function(){}}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.hostReportError=function(err){setTimeout((function(){throw err}),0)}},function(module,exports,__webpack_require__){var _extendStatics6,__extends=this&&this.__extends||(_extendStatics6=function(d,b){return(_extendStatics6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics6(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var SubjectSubscription=function(_super){function SubjectSubscription(subject,subscriber){var _this=_super.call(this)||this;return _this.subject=subject,_this.subscriber=subscriber,_this.closed=!1,_this}return __extends(SubjectSubscription,_super),SubjectSubscription.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var subject=this.subject,observers=subject.observers;if(this.subject=null,observers&&0!==observers.length&&!subject.isStopped&&!subject.closed){var subscriberIndex=observers.indexOf(this.subscriber);-1!==subscriberIndex&&observers.splice(subscriberIndex,1)}}},SubjectSubscription}(__webpack_require__(45).Subscription);exports.SubjectSubscription=SubjectSubscription},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mrt_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiemParse:/vm|nm/i,isPM:function(input){return/^nm$/i.test(input)},meridiem:function(hours,minutes,isLower){return hours<12?isLower?"vm":"VM":isLower?"nm":"NM"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[M\xf4re om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",ss:"%d sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(number){return number+(1===number||8===number||number>=20?"ste":"de")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0661",2:"\u0662",3:"\u0663",4:"\u0664",5:"\u0665",6:"\u0666",7:"\u0667",8:"\u0668",9:"\u0669",0:"\u0660"},numberMap={"\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9","\u0660":"0"},pluralForm=function(n){return 0===n?0:1===n?1:2===n?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5},plurals={s:["\u0623\u0642\u0644 \u0645\u0646 \u062b\u0627\u0646\u064a\u0629","\u062b\u0627\u0646\u064a\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062b\u0627\u0646\u064a\u062a\u0627\u0646","\u062b\u0627\u0646\u064a\u062a\u064a\u0646"],"%d \u062b\u0648\u0627\u0646","%d \u062b\u0627\u0646\u064a\u0629","%d \u062b\u0627\u0646\u064a\u0629"],m:["\u0623\u0642\u0644 \u0645\u0646 \u062f\u0642\u064a\u0642\u0629","\u062f\u0642\u064a\u0642\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062f\u0642\u064a\u0642\u062a\u0627\u0646","\u062f\u0642\u064a\u0642\u062a\u064a\u0646"],"%d \u062f\u0642\u0627\u0626\u0642","%d \u062f\u0642\u064a\u0642\u0629","%d \u062f\u0642\u064a\u0642\u0629"],h:["\u0623\u0642\u0644 \u0645\u0646 \u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u0629 \u0648\u0627\u062d\u062f\u0629",["\u0633\u0627\u0639\u062a\u0627\u0646","\u0633\u0627\u0639\u062a\u064a\u0646"],"%d \u0633\u0627\u0639\u0627\u062a","%d \u0633\u0627\u0639\u0629","%d \u0633\u0627\u0639\u0629"],d:["\u0623\u0642\u0644 \u0645\u0646 \u064a\u0648\u0645","\u064a\u0648\u0645 \u0648\u0627\u062d\u062f",["\u064a\u0648\u0645\u0627\u0646","\u064a\u0648\u0645\u064a\u0646"],"%d \u0623\u064a\u0627\u0645","%d \u064a\u0648\u0645\u064b\u0627","%d \u064a\u0648\u0645"],M:["\u0623\u0642\u0644 \u0645\u0646 \u0634\u0647\u0631","\u0634\u0647\u0631 \u0648\u0627\u062d\u062f",["\u0634\u0647\u0631\u0627\u0646","\u0634\u0647\u0631\u064a\u0646"],"%d \u0623\u0634\u0647\u0631","%d \u0634\u0647\u0631\u0627","%d \u0634\u0647\u0631"],y:["\u0623\u0642\u0644 \u0645\u0646 \u0639\u0627\u0645","\u0639\u0627\u0645 \u0648\u0627\u062d\u062f",["\u0639\u0627\u0645\u0627\u0646","\u0639\u0627\u0645\u064a\u0646"],"%d \u0623\u0639\u0648\u0627\u0645","%d \u0639\u0627\u0645\u064b\u0627","%d \u0639\u0627\u0645"]},pluralize=function(u){return function(number,withoutSuffix,string,isFuture){var f=pluralForm(number),str=plurals[u][pluralForm(number)];return 2===f&&(str=str[withoutSuffix?0:1]),str.replace(/%d/i,number)}},months=["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"];moment.defineLocale("ar",{months:months,monthsShort:months,weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/\u200fM/\u200fYYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0635|\u0645/,isPM:function(input){return"\u0645"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0635":"\u0645"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u064b\u0627 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0628\u0639\u062f %s",past:"\u0645\u0646\u0630 %s",s:pluralize("s"),ss:pluralize("s"),m:pluralize("m"),mm:pluralize("m"),h:pluralize("h"),hh:pluralize("h"),d:pluralize("d"),dd:pluralize("d"),M:pluralize("M"),MM:pluralize("M"),y:pluralize("y"),yy:pluralize("y")},preparse:function(string){return string.replace(/[\u0661\u0662\u0663\u0664\u0665\u0666\u0667\u0668\u0669\u0660]/g,(function(match){return numberMap[match]})).replace(/\u060c/g,",")},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]})).replace(/,/g,"\u060c")},week:{dow:6,doy:12}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var pluralForm=function(n){return 0===n?0:1===n?1:2===n?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5},plurals={s:["\u0623\u0642\u0644 \u0645\u0646 \u062b\u0627\u0646\u064a\u0629","\u062b\u0627\u0646\u064a\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062b\u0627\u0646\u064a\u062a\u0627\u0646","\u062b\u0627\u0646\u064a\u062a\u064a\u0646"],"%d \u062b\u0648\u0627\u0646","%d \u062b\u0627\u0646\u064a\u0629","%d \u062b\u0627\u0646\u064a\u0629"],m:["\u0623\u0642\u0644 \u0645\u0646 \u062f\u0642\u064a\u0642\u0629","\u062f\u0642\u064a\u0642\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062f\u0642\u064a\u0642\u062a\u0627\u0646","\u062f\u0642\u064a\u0642\u062a\u064a\u0646"],"%d \u062f\u0642\u0627\u0626\u0642","%d \u062f\u0642\u064a\u0642\u0629","%d \u062f\u0642\u064a\u0642\u0629"],h:["\u0623\u0642\u0644 \u0645\u0646 \u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u0629 \u0648\u0627\u062d\u062f\u0629",["\u0633\u0627\u0639\u062a\u0627\u0646","\u0633\u0627\u0639\u062a\u064a\u0646"],"%d \u0633\u0627\u0639\u0627\u062a","%d \u0633\u0627\u0639\u0629","%d \u0633\u0627\u0639\u0629"],d:["\u0623\u0642\u0644 \u0645\u0646 \u064a\u0648\u0645","\u064a\u0648\u0645 \u0648\u0627\u062d\u062f",["\u064a\u0648\u0645\u0627\u0646","\u064a\u0648\u0645\u064a\u0646"],"%d \u0623\u064a\u0627\u0645","%d \u064a\u0648\u0645\u064b\u0627","%d \u064a\u0648\u0645"],M:["\u0623\u0642\u0644 \u0645\u0646 \u0634\u0647\u0631","\u0634\u0647\u0631 \u0648\u0627\u062d\u062f",["\u0634\u0647\u0631\u0627\u0646","\u0634\u0647\u0631\u064a\u0646"],"%d \u0623\u0634\u0647\u0631","%d \u0634\u0647\u0631\u0627","%d \u0634\u0647\u0631"],y:["\u0623\u0642\u0644 \u0645\u0646 \u0639\u0627\u0645","\u0639\u0627\u0645 \u0648\u0627\u062d\u062f",["\u0639\u0627\u0645\u0627\u0646","\u0639\u0627\u0645\u064a\u0646"],"%d \u0623\u0639\u0648\u0627\u0645","%d \u0639\u0627\u0645\u064b\u0627","%d \u0639\u0627\u0645"]},pluralize=function(u){return function(number,withoutSuffix,string,isFuture){var f=pluralForm(number),str=plurals[u][pluralForm(number)];return 2===f&&(str=str[withoutSuffix?0:1]),str.replace(/%d/i,number)}},months=["\u062c\u0627\u0646\u0641\u064a","\u0641\u064a\u0641\u0631\u064a","\u0645\u0627\u0631\u0633","\u0623\u0641\u0631\u064a\u0644","\u0645\u0627\u064a","\u062c\u0648\u0627\u0646","\u062c\u0648\u064a\u0644\u064a\u0629","\u0623\u0648\u062a","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"];moment.defineLocale("ar-dz",{months:months,monthsShort:months,weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/\u200fM/\u200fYYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0635|\u0645/,isPM:function(input){return"\u0645"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0635":"\u0645"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u064b\u0627 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0628\u0639\u062f %s",past:"\u0645\u0646\u0630 %s",s:pluralize("s"),ss:pluralize("s"),m:pluralize("m"),mm:pluralize("m"),h:pluralize("h"),hh:pluralize("h"),d:pluralize("d"),dd:pluralize("d"),M:pluralize("M"),MM:pluralize("M"),y:pluralize("y"),yy:pluralize("y")},postformat:function(string){return string.replace(/,/g,"\u060c")},week:{dow:0,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ar-kw",{months:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648\u0632_\u063a\u0634\u062a_\u0634\u062a\u0646\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0646\u0628\u0631_\u062f\u062c\u0646\u0628\u0631".split("_"),monthsShort:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648\u0632_\u063a\u0634\u062a_\u0634\u062a\u0646\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0646\u0628\u0631_\u062f\u062c\u0646\u0628\u0631".split("_"),weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062a\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0627\u062d\u062f_\u0627\u062a\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u0627 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0641\u064a %s",past:"\u0645\u0646\u0630 %s",s:"\u062b\u0648\u0627\u0646",ss:"%d \u062b\u0627\u0646\u064a\u0629",m:"\u062f\u0642\u064a\u0642\u0629",mm:"%d \u062f\u0642\u0627\u0626\u0642",h:"\u0633\u0627\u0639\u0629",hh:"%d \u0633\u0627\u0639\u0627\u062a",d:"\u064a\u0648\u0645",dd:"%d \u0623\u064a\u0627\u0645",M:"\u0634\u0647\u0631",MM:"%d \u0623\u0634\u0647\u0631",y:"\u0633\u0646\u0629",yy:"%d \u0633\u0646\u0648\u0627\u062a"},week:{dow:0,doy:12}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",0:"0"},pluralForm=function(n){return 0===n?0:1===n?1:2===n?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5},plurals={s:["\u0623\u0642\u0644 \u0645\u0646 \u062b\u0627\u0646\u064a\u0629","\u062b\u0627\u0646\u064a\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062b\u0627\u0646\u064a\u062a\u0627\u0646","\u062b\u0627\u0646\u064a\u062a\u064a\u0646"],"%d \u062b\u0648\u0627\u0646","%d \u062b\u0627\u0646\u064a\u0629","%d \u062b\u0627\u0646\u064a\u0629"],m:["\u0623\u0642\u0644 \u0645\u0646 \u062f\u0642\u064a\u0642\u0629","\u062f\u0642\u064a\u0642\u0629 \u0648\u0627\u062d\u062f\u0629",["\u062f\u0642\u064a\u0642\u062a\u0627\u0646","\u062f\u0642\u064a\u0642\u062a\u064a\u0646"],"%d \u062f\u0642\u0627\u0626\u0642","%d \u062f\u0642\u064a\u0642\u0629","%d \u062f\u0642\u064a\u0642\u0629"],h:["\u0623\u0642\u0644 \u0645\u0646 \u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u0629 \u0648\u0627\u062d\u062f\u0629",["\u0633\u0627\u0639\u062a\u0627\u0646","\u0633\u0627\u0639\u062a\u064a\u0646"],"%d \u0633\u0627\u0639\u0627\u062a","%d \u0633\u0627\u0639\u0629","%d \u0633\u0627\u0639\u0629"],d:["\u0623\u0642\u0644 \u0645\u0646 \u064a\u0648\u0645","\u064a\u0648\u0645 \u0648\u0627\u062d\u062f",["\u064a\u0648\u0645\u0627\u0646","\u064a\u0648\u0645\u064a\u0646"],"%d \u0623\u064a\u0627\u0645","%d \u064a\u0648\u0645\u064b\u0627","%d \u064a\u0648\u0645"],M:["\u0623\u0642\u0644 \u0645\u0646 \u0634\u0647\u0631","\u0634\u0647\u0631 \u0648\u0627\u062d\u062f",["\u0634\u0647\u0631\u0627\u0646","\u0634\u0647\u0631\u064a\u0646"],"%d \u0623\u0634\u0647\u0631","%d \u0634\u0647\u0631\u0627","%d \u0634\u0647\u0631"],y:["\u0623\u0642\u0644 \u0645\u0646 \u0639\u0627\u0645","\u0639\u0627\u0645 \u0648\u0627\u062d\u062f",["\u0639\u0627\u0645\u0627\u0646","\u0639\u0627\u0645\u064a\u0646"],"%d \u0623\u0639\u0648\u0627\u0645","%d \u0639\u0627\u0645\u064b\u0627","%d \u0639\u0627\u0645"]},pluralize=function(u){return function(number,withoutSuffix,string,isFuture){var f=pluralForm(number),str=plurals[u][pluralForm(number)];return 2===f&&(str=str[withoutSuffix?0:1]),str.replace(/%d/i,number)}},months=["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"];moment.defineLocale("ar-ly",{months:months,monthsShort:months,weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/\u200fM/\u200fYYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0635|\u0645/,isPM:function(input){return"\u0645"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0635":"\u0645"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u064b\u0627 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0646\u062f \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0628\u0639\u062f %s",past:"\u0645\u0646\u0630 %s",s:pluralize("s"),ss:pluralize("s"),m:pluralize("m"),mm:pluralize("m"),h:pluralize("h"),hh:pluralize("h"),d:pluralize("d"),dd:pluralize("d"),M:pluralize("M"),MM:pluralize("M"),y:pluralize("y"),yy:pluralize("y")},preparse:function(string){return string.replace(/\u060c/g,",")},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]})).replace(/,/g,"\u060c")},week:{dow:6,doy:12}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ar-ma",{months:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648\u0632_\u063a\u0634\u062a_\u0634\u062a\u0646\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0646\u0628\u0631_\u062f\u062c\u0646\u0628\u0631".split("_"),monthsShort:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648\u0632_\u063a\u0634\u062a_\u0634\u062a\u0646\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0646\u0628\u0631_\u062f\u062c\u0646\u0628\u0631".split("_"),weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0627\u062d\u062f_\u0627\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u0627 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0641\u064a %s",past:"\u0645\u0646\u0630 %s",s:"\u062b\u0648\u0627\u0646",ss:"%d \u062b\u0627\u0646\u064a\u0629",m:"\u062f\u0642\u064a\u0642\u0629",mm:"%d \u062f\u0642\u0627\u0626\u0642",h:"\u0633\u0627\u0639\u0629",hh:"%d \u0633\u0627\u0639\u0627\u062a",d:"\u064a\u0648\u0645",dd:"%d \u0623\u064a\u0627\u0645",M:"\u0634\u0647\u0631",MM:"%d \u0623\u0634\u0647\u0631",y:"\u0633\u0646\u0629",yy:"%d \u0633\u0646\u0648\u0627\u062a"},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0661",2:"\u0662",3:"\u0663",4:"\u0664",5:"\u0665",6:"\u0666",7:"\u0667",8:"\u0668",9:"\u0669",0:"\u0660"},numberMap={"\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9","\u0660":"0"};moment.defineLocale("ar-sa",{months:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a\u0648_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648_\u0623\u063a\u0633\u0637\u0633_\u0633\u0628\u062a\u0645\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0641\u0645\u0628\u0631_\u062f\u064a\u0633\u0645\u0628\u0631".split("_"),monthsShort:"\u064a\u0646\u0627\u064a\u0631_\u0641\u0628\u0631\u0627\u064a\u0631_\u0645\u0627\u0631\u0633_\u0623\u0628\u0631\u064a\u0644_\u0645\u0627\u064a\u0648_\u064a\u0648\u0646\u064a\u0648_\u064a\u0648\u0644\u064a\u0648_\u0623\u063a\u0633\u0637\u0633_\u0633\u0628\u062a\u0645\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0641\u0645\u0628\u0631_\u062f\u064a\u0633\u0645\u0628\u0631".split("_"),weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0635|\u0645/,isPM:function(input){return"\u0645"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0635":"\u0645"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u0627 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0641\u064a %s",past:"\u0645\u0646\u0630 %s",s:"\u062b\u0648\u0627\u0646",ss:"%d \u062b\u0627\u0646\u064a\u0629",m:"\u062f\u0642\u064a\u0642\u0629",mm:"%d \u062f\u0642\u0627\u0626\u0642",h:"\u0633\u0627\u0639\u0629",hh:"%d \u0633\u0627\u0639\u0627\u062a",d:"\u064a\u0648\u0645",dd:"%d \u0623\u064a\u0627\u0645",M:"\u0634\u0647\u0631",MM:"%d \u0623\u0634\u0647\u0631",y:"\u0633\u0646\u0629",yy:"%d \u0633\u0646\u0648\u0627\u062a"},preparse:function(string){return string.replace(/[\u0661\u0662\u0663\u0664\u0665\u0666\u0667\u0668\u0669\u0660]/g,(function(match){return numberMap[match]})).replace(/\u060c/g,",")},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]})).replace(/,/g,"\u060c")},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ar-tn",{months:"\u062c\u0627\u0646\u0641\u064a_\u0641\u064a\u0641\u0631\u064a_\u0645\u0627\u0631\u0633_\u0623\u0641\u0631\u064a\u0644_\u0645\u0627\u064a_\u062c\u0648\u0627\u0646_\u062c\u0648\u064a\u0644\u064a\u0629_\u0623\u0648\u062a_\u0633\u0628\u062a\u0645\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0641\u0645\u0628\u0631_\u062f\u064a\u0633\u0645\u0628\u0631".split("_"),monthsShort:"\u062c\u0627\u0646\u0641\u064a_\u0641\u064a\u0641\u0631\u064a_\u0645\u0627\u0631\u0633_\u0623\u0641\u0631\u064a\u0644_\u0645\u0627\u064a_\u062c\u0648\u0627\u0646_\u062c\u0648\u064a\u0644\u064a\u0629_\u0623\u0648\u062a_\u0633\u0628\u062a\u0645\u0628\u0631_\u0623\u0643\u062a\u0648\u0628\u0631_\u0646\u0648\u0641\u0645\u0628\u0631_\u062f\u064a\u0633\u0645\u0628\u0631".split("_"),weekdays:"\u0627\u0644\u0623\u062d\u062f_\u0627\u0644\u0625\u062b\u0646\u064a\u0646_\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621_\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621_\u0627\u0644\u062e\u0645\u064a\u0633_\u0627\u0644\u062c\u0645\u0639\u0629_\u0627\u0644\u0633\u0628\u062a".split("_"),weekdaysShort:"\u0623\u062d\u062f_\u0625\u062b\u0646\u064a\u0646_\u062b\u0644\u0627\u062b\u0627\u0621_\u0623\u0631\u0628\u0639\u0627\u0621_\u062e\u0645\u064a\u0633_\u062c\u0645\u0639\u0629_\u0633\u0628\u062a".split("_"),weekdaysMin:"\u062d_\u0646_\u062b_\u0631_\u062e_\u062c_\u0633".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0627\u0644\u064a\u0648\u0645 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextDay:"[\u063a\u062f\u0627 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",nextWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastDay:"[\u0623\u0645\u0633 \u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",lastWeek:"dddd [\u0639\u0644\u0649 \u0627\u0644\u0633\u0627\u0639\u0629] LT",sameElse:"L"},relativeTime:{future:"\u0641\u064a %s",past:"\u0645\u0646\u0630 %s",s:"\u062b\u0648\u0627\u0646",ss:"%d \u062b\u0627\u0646\u064a\u0629",m:"\u062f\u0642\u064a\u0642\u0629",mm:"%d \u062f\u0642\u0627\u0626\u0642",h:"\u0633\u0627\u0639\u0629",hh:"%d \u0633\u0627\u0639\u0627\u062a",d:"\u064a\u0648\u0645",dd:"%d \u0623\u064a\u0627\u0645",M:"\u0634\u0647\u0631",MM:"%d \u0623\u0634\u0647\u0631",y:"\u0633\u0646\u0629",yy:"%d \u0633\u0646\u0648\u0627\u062a"},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var suffixes={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-\xfcnc\xfc",4:"-\xfcnc\xfc",100:"-\xfcnc\xfc",6:"-nc\u0131",9:"-uncu",10:"-uncu",30:"-uncu",60:"-\u0131nc\u0131",90:"-\u0131nc\u0131"};moment.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ert\u0259si_\xc7\u0259r\u015f\u0259nb\u0259 ax\u015fam\u0131_\xc7\u0259r\u015f\u0259nb\u0259_C\xfcm\u0259 ax\u015fam\u0131_C\xfcm\u0259_\u015e\u0259nb\u0259".split("_"),weekdaysShort:"Baz_BzE_\xc7Ax_\xc7\u0259r_CAx_C\xfcm_\u015e\u0259n".split("_"),weekdaysMin:"Bz_BE_\xc7A_\xc7\u0259_CA_C\xfc_\u015e\u0259".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bug\xfcn saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[g\u0259l\u0259n h\u0259ft\u0259] dddd [saat] LT",lastDay:"[d\xfcn\u0259n] LT",lastWeek:"[ke\xe7\u0259n h\u0259ft\u0259] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s \u0259vv\u0259l",s:"bir ne\xe7\u0259 saniy\u0259",ss:"%d saniy\u0259",m:"bir d\u0259qiq\u0259",mm:"%d d\u0259qiq\u0259",h:"bir saat",hh:"%d saat",d:"bir g\xfcn",dd:"%d g\xfcn",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiemParse:/gec\u0259|s\u0259h\u0259r|g\xfcnd\xfcz|ax\u015fam/,isPM:function(input){return/^(g\xfcnd\xfcz|ax\u015fam)$/.test(input)},meridiem:function(hour,minute,isLower){return hour<4?"gec\u0259":hour<12?"s\u0259h\u0259r":hour<17?"g\xfcnd\xfcz":"ax\u015fam"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0131nc\u0131|inci|nci|\xfcnc\xfc|nc\u0131|uncu)/,ordinal:function(number){if(0===number)return number+"-\u0131nc\u0131";var a=number%10;return number+(suffixes[a]||suffixes[number%100-a]||suffixes[number>=100?100:null])},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function relativeTimeWithPlural(number,withoutSuffix,key){var num,forms;return"m"===key?withoutSuffix?"\u0445\u0432\u0456\u043b\u0456\u043d\u0430":"\u0445\u0432\u0456\u043b\u0456\u043d\u0443":"h"===key?withoutSuffix?"\u0433\u0430\u0434\u0437\u0456\u043d\u0430":"\u0433\u0430\u0434\u0437\u0456\u043d\u0443":number+" "+(num=+number,forms={ss:withoutSuffix?"\u0441\u0435\u043a\u0443\u043d\u0434\u0430_\u0441\u0435\u043a\u0443\u043d\u0434\u044b_\u0441\u0435\u043a\u0443\u043d\u0434":"\u0441\u0435\u043a\u0443\u043d\u0434\u0443_\u0441\u0435\u043a\u0443\u043d\u0434\u044b_\u0441\u0435\u043a\u0443\u043d\u0434",mm:withoutSuffix?"\u0445\u0432\u0456\u043b\u0456\u043d\u0430_\u0445\u0432\u0456\u043b\u0456\u043d\u044b_\u0445\u0432\u0456\u043b\u0456\u043d":"\u0445\u0432\u0456\u043b\u0456\u043d\u0443_\u0445\u0432\u0456\u043b\u0456\u043d\u044b_\u0445\u0432\u0456\u043b\u0456\u043d",hh:withoutSuffix?"\u0433\u0430\u0434\u0437\u0456\u043d\u0430_\u0433\u0430\u0434\u0437\u0456\u043d\u044b_\u0433\u0430\u0434\u0437\u0456\u043d":"\u0433\u0430\u0434\u0437\u0456\u043d\u0443_\u0433\u0430\u0434\u0437\u0456\u043d\u044b_\u0433\u0430\u0434\u0437\u0456\u043d",dd:"\u0434\u0437\u0435\u043d\u044c_\u0434\u043d\u0456_\u0434\u0437\u0451\u043d",MM:"\u043c\u0435\u0441\u044f\u0446_\u043c\u0435\u0441\u044f\u0446\u044b_\u043c\u0435\u0441\u044f\u0446\u0430\u045e",yy:"\u0433\u043e\u0434_\u0433\u0430\u0434\u044b_\u0433\u0430\u0434\u043e\u045e"}[key].split("_"),num%10==1&&num%100!=11?forms[0]:num%10>=2&&num%10<=4&&(num%100<10||num%100>=20)?forms[1]:forms[2])}moment.defineLocale("be",{months:{format:"\u0441\u0442\u0443\u0434\u0437\u0435\u043d\u044f_\u043b\u044e\u0442\u0430\u0433\u0430_\u0441\u0430\u043a\u0430\u0432\u0456\u043a\u0430_\u043a\u0440\u0430\u0441\u0430\u0432\u0456\u043a\u0430_\u0442\u0440\u0430\u045e\u043d\u044f_\u0447\u044d\u0440\u0432\u0435\u043d\u044f_\u043b\u0456\u043f\u0435\u043d\u044f_\u0436\u043d\u0456\u045e\u043d\u044f_\u0432\u0435\u0440\u0430\u0441\u043d\u044f_\u043a\u0430\u0441\u0442\u0440\u044b\u0447\u043d\u0456\u043a\u0430_\u043b\u0456\u0441\u0442\u0430\u043f\u0430\u0434\u0430_\u0441\u043d\u0435\u0436\u043d\u044f".split("_"),standalone:"\u0441\u0442\u0443\u0434\u0437\u0435\u043d\u044c_\u043b\u044e\u0442\u044b_\u0441\u0430\u043a\u0430\u0432\u0456\u043a_\u043a\u0440\u0430\u0441\u0430\u0432\u0456\u043a_\u0442\u0440\u0430\u0432\u0435\u043d\u044c_\u0447\u044d\u0440\u0432\u0435\u043d\u044c_\u043b\u0456\u043f\u0435\u043d\u044c_\u0436\u043d\u0456\u0432\u0435\u043d\u044c_\u0432\u0435\u0440\u0430\u0441\u0435\u043d\u044c_\u043a\u0430\u0441\u0442\u0440\u044b\u0447\u043d\u0456\u043a_\u043b\u0456\u0441\u0442\u0430\u043f\u0430\u0434_\u0441\u043d\u0435\u0436\u0430\u043d\u044c".split("_")},monthsShort:"\u0441\u0442\u0443\u0434_\u043b\u044e\u0442_\u0441\u0430\u043a_\u043a\u0440\u0430\u0441_\u0442\u0440\u0430\u0432_\u0447\u044d\u0440\u0432_\u043b\u0456\u043f_\u0436\u043d\u0456\u0432_\u0432\u0435\u0440_\u043a\u0430\u0441\u0442_\u043b\u0456\u0441\u0442_\u0441\u043d\u0435\u0436".split("_"),weekdays:{format:"\u043d\u044f\u0434\u0437\u0435\u043b\u044e_\u043f\u0430\u043d\u044f\u0434\u0437\u0435\u043b\u0430\u043a_\u0430\u045e\u0442\u043e\u0440\u0430\u043a_\u0441\u0435\u0440\u0430\u0434\u0443_\u0447\u0430\u0446\u0432\u0435\u0440_\u043f\u044f\u0442\u043d\u0456\u0446\u0443_\u0441\u0443\u0431\u043e\u0442\u0443".split("_"),standalone:"\u043d\u044f\u0434\u0437\u0435\u043b\u044f_\u043f\u0430\u043d\u044f\u0434\u0437\u0435\u043b\u0430\u043a_\u0430\u045e\u0442\u043e\u0440\u0430\u043a_\u0441\u0435\u0440\u0430\u0434\u0430_\u0447\u0430\u0446\u0432\u0435\u0440_\u043f\u044f\u0442\u043d\u0456\u0446\u0430_\u0441\u0443\u0431\u043e\u0442\u0430".split("_"),isFormat:/\[ ?[\u0423\u0443\u045e] ?(?:\u043c\u0456\u043d\u0443\u043b\u0443\u044e|\u043d\u0430\u0441\u0442\u0443\u043f\u043d\u0443\u044e)? ?\] ?dddd/},weekdaysShort:"\u043d\u0434_\u043f\u043d_\u0430\u0442_\u0441\u0440_\u0447\u0446_\u043f\u0442_\u0441\u0431".split("_"),weekdaysMin:"\u043d\u0434_\u043f\u043d_\u0430\u0442_\u0441\u0440_\u0447\u0446_\u043f\u0442_\u0441\u0431".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY \u0433.",LLL:"D MMMM YYYY \u0433., HH:mm",LLLL:"dddd, D MMMM YYYY \u0433., HH:mm"},calendar:{sameDay:"[\u0421\u0451\u043d\u043d\u044f \u045e] LT",nextDay:"[\u0417\u0430\u045e\u0442\u0440\u0430 \u045e] LT",lastDay:"[\u0423\u0447\u043e\u0440\u0430 \u045e] LT",nextWeek:function(){return"[\u0423] dddd [\u045e] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[\u0423 \u043c\u0456\u043d\u0443\u043b\u0443\u044e] dddd [\u045e] LT";case 1:case 2:case 4:return"[\u0423 \u043c\u0456\u043d\u0443\u043b\u044b] dddd [\u045e] LT"}},sameElse:"L"},relativeTime:{future:"\u043f\u0440\u0430\u0437 %s",past:"%s \u0442\u0430\u043c\u0443",s:"\u043d\u0435\u043a\u0430\u043b\u044c\u043a\u0456 \u0441\u0435\u043a\u0443\u043d\u0434",m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:relativeTimeWithPlural,hh:relativeTimeWithPlural,d:"\u0434\u0437\u0435\u043d\u044c",dd:relativeTimeWithPlural,M:"\u043c\u0435\u0441\u044f\u0446",MM:relativeTimeWithPlural,y:"\u0433\u043e\u0434",yy:relativeTimeWithPlural},meridiemParse:/\u043d\u043e\u0447\u044b|\u0440\u0430\u043d\u0456\u0446\u044b|\u0434\u043d\u044f|\u0432\u0435\u0447\u0430\u0440\u0430/,isPM:function(input){return/^(\u0434\u043d\u044f|\u0432\u0435\u0447\u0430\u0440\u0430)$/.test(input)},meridiem:function(hour,minute,isLower){return hour<4?"\u043d\u043e\u0447\u044b":hour<12?"\u0440\u0430\u043d\u0456\u0446\u044b":hour<17?"\u0434\u043d\u044f":"\u0432\u0435\u0447\u0430\u0440\u0430"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0456|\u044b|\u0433\u0430)/,ordinal:function(number,period){switch(period){case"M":case"d":case"DDD":case"w":case"W":return number%10!=2&&number%10!=3||number%100==12||number%100==13?number+"-\u044b":number+"-\u0456";case"D":return number+"-\u0433\u0430";default:return number}},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("bg",{months:"\u044f\u043d\u0443\u0430\u0440\u0438_\u0444\u0435\u0432\u0440\u0443\u0430\u0440\u0438_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0438\u043b_\u043c\u0430\u0439_\u044e\u043d\u0438_\u044e\u043b\u0438_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043f\u0442\u0435\u043c\u0432\u0440\u0438_\u043e\u043a\u0442\u043e\u043c\u0432\u0440\u0438_\u043d\u043e\u0435\u043c\u0432\u0440\u0438_\u0434\u0435\u043a\u0435\u043c\u0432\u0440\u0438".split("_"),monthsShort:"\u044f\u043d\u0443_\u0444\u0435\u0432_\u043c\u0430\u0440_\u0430\u043f\u0440_\u043c\u0430\u0439_\u044e\u043d\u0438_\u044e\u043b\u0438_\u0430\u0432\u0433_\u0441\u0435\u043f_\u043e\u043a\u0442_\u043d\u043e\u0435_\u0434\u0435\u043a".split("_"),weekdays:"\u043d\u0435\u0434\u0435\u043b\u044f_\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u043d\u0438\u043a_\u0432\u0442\u043e\u0440\u043d\u0438\u043a_\u0441\u0440\u044f\u0434\u0430_\u0447\u0435\u0442\u0432\u044a\u0440\u0442\u044a\u043a_\u043f\u0435\u0442\u044a\u043a_\u0441\u044a\u0431\u043e\u0442\u0430".split("_"),weekdaysShort:"\u043d\u0435\u0434_\u043f\u043e\u043d_\u0432\u0442\u043e_\u0441\u0440\u044f_\u0447\u0435\u0442_\u043f\u0435\u0442_\u0441\u044a\u0431".split("_"),weekdaysMin:"\u043d\u0434_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[\u0414\u043d\u0435\u0441 \u0432] LT",nextDay:"[\u0423\u0442\u0440\u0435 \u0432] LT",nextWeek:"dddd [\u0432] LT",lastDay:"[\u0412\u0447\u0435\u0440\u0430 \u0432] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[\u041c\u0438\u043d\u0430\u043b\u0430\u0442\u0430] dddd [\u0432] LT";case 1:case 2:case 4:case 5:return"[\u041c\u0438\u043d\u0430\u043b\u0438\u044f] dddd [\u0432] LT"}},sameElse:"L"},relativeTime:{future:"\u0441\u043b\u0435\u0434 %s",past:"\u043f\u0440\u0435\u0434\u0438 %s",s:"\u043d\u044f\u043a\u043e\u043b\u043a\u043e \u0441\u0435\u043a\u0443\u043d\u0434\u0438",ss:"%d \u0441\u0435\u043a\u0443\u043d\u0434\u0438",m:"\u043c\u0438\u043d\u0443\u0442\u0430",mm:"%d \u043c\u0438\u043d\u0443\u0442\u0438",h:"\u0447\u0430\u0441",hh:"%d \u0447\u0430\u0441\u0430",d:"\u0434\u0435\u043d",dd:"%d \u0434\u0435\u043d\u0430",w:"\u0441\u0435\u0434\u043c\u0438\u0446\u0430",ww:"%d \u0441\u0435\u0434\u043c\u0438\u0446\u0438",M:"\u043c\u0435\u0441\u0435\u0446",MM:"%d \u043c\u0435\u0441\u0435\u0446\u0430",y:"\u0433\u043e\u0434\u0438\u043d\u0430",yy:"%d \u0433\u043e\u0434\u0438\u043d\u0438"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0435\u0432|\u0435\u043d|\u0442\u0438|\u0432\u0438|\u0440\u0438|\u043c\u0438)/,ordinal:function(number){var lastDigit=number%10,last2Digits=number%100;return 0===number?number+"-\u0435\u0432":0===last2Digits?number+"-\u0435\u043d":last2Digits>10&&last2Digits<20?number+"-\u0442\u0438":1===lastDigit?number+"-\u0432\u0438":2===lastDigit?number+"-\u0440\u0438":7===lastDigit||8===lastDigit?number+"-\u043c\u0438":number+"-\u0442\u0438"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("bm",{months:"Zanwuyekalo_Fewuruyekalo_Marisikalo_Awirilikalo_M\u025bkalo_Zuw\u025bnkalo_Zuluyekalo_Utikalo_S\u025btanburukalo_\u0254kut\u0254burukalo_Nowanburukalo_Desanburukalo".split("_"),monthsShort:"Zan_Few_Mar_Awi_M\u025b_Zuw_Zul_Uti_S\u025bt_\u0254ku_Now_Des".split("_"),weekdays:"Kari_Nt\u025bn\u025bn_Tarata_Araba_Alamisa_Juma_Sibiri".split("_"),weekdaysShort:"Kar_Nt\u025b_Tar_Ara_Ala_Jum_Sib".split("_"),weekdaysMin:"Ka_Nt_Ta_Ar_Al_Ju_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"MMMM [tile] D [san] YYYY",LLL:"MMMM [tile] D [san] YYYY [l\u025br\u025b] HH:mm",LLLL:"dddd MMMM [tile] D [san] YYYY [l\u025br\u025b] HH:mm"},calendar:{sameDay:"[Bi l\u025br\u025b] LT",nextDay:"[Sini l\u025br\u025b] LT",nextWeek:"dddd [don l\u025br\u025b] LT",lastDay:"[Kunu l\u025br\u025b] LT",lastWeek:"dddd [t\u025bm\u025bnen l\u025br\u025b] LT",sameElse:"L"},relativeTime:{future:"%s k\u0254n\u0254",past:"a b\u025b %s b\u0254",s:"sanga dama dama",ss:"sekondi %d",m:"miniti kelen",mm:"miniti %d",h:"l\u025br\u025b kelen",hh:"l\u025br\u025b %d",d:"tile kelen",dd:"tile %d",M:"kalo kelen",MM:"kalo %d",y:"san kelen",yy:"san %d"},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u09e7",2:"\u09e8",3:"\u09e9",4:"\u09ea",5:"\u09eb",6:"\u09ec",7:"\u09ed",8:"\u09ee",9:"\u09ef",0:"\u09e6"},numberMap={"\u09e7":"1","\u09e8":"2","\u09e9":"3","\u09ea":"4","\u09eb":"5","\u09ec":"6","\u09ed":"7","\u09ee":"8","\u09ef":"9","\u09e6":"0"};moment.defineLocale("bn",{months:"\u099c\u09be\u09a8\u09c1\u09df\u09be\u09b0\u09bf_\u09ab\u09c7\u09ac\u09cd\u09b0\u09c1\u09df\u09be\u09b0\u09bf_\u09ae\u09be\u09b0\u09cd\u099a_\u098f\u09aa\u09cd\u09b0\u09bf\u09b2_\u09ae\u09c7_\u099c\u09c1\u09a8_\u099c\u09c1\u09b2\u09be\u0987_\u0986\u0997\u09b8\u09cd\u099f_\u09b8\u09c7\u09aa\u09cd\u099f\u09c7\u09ae\u09cd\u09ac\u09b0_\u0985\u0995\u09cd\u099f\u09cb\u09ac\u09b0_\u09a8\u09ad\u09c7\u09ae\u09cd\u09ac\u09b0_\u09a1\u09bf\u09b8\u09c7\u09ae\u09cd\u09ac\u09b0".split("_"),monthsShort:"\u099c\u09be\u09a8\u09c1_\u09ab\u09c7\u09ac\u09cd\u09b0\u09c1_\u09ae\u09be\u09b0\u09cd\u099a_\u098f\u09aa\u09cd\u09b0\u09bf\u09b2_\u09ae\u09c7_\u099c\u09c1\u09a8_\u099c\u09c1\u09b2\u09be\u0987_\u0986\u0997\u09b8\u09cd\u099f_\u09b8\u09c7\u09aa\u09cd\u099f_\u0985\u0995\u09cd\u099f\u09cb_\u09a8\u09ad\u09c7_\u09a1\u09bf\u09b8\u09c7".split("_"),weekdays:"\u09b0\u09ac\u09bf\u09ac\u09be\u09b0_\u09b8\u09cb\u09ae\u09ac\u09be\u09b0_\u09ae\u0999\u09cd\u0997\u09b2\u09ac\u09be\u09b0_\u09ac\u09c1\u09a7\u09ac\u09be\u09b0_\u09ac\u09c3\u09b9\u09b8\u09cd\u09aa\u09a4\u09bf\u09ac\u09be\u09b0_\u09b6\u09c1\u0995\u09cd\u09b0\u09ac\u09be\u09b0_\u09b6\u09a8\u09bf\u09ac\u09be\u09b0".split("_"),weekdaysShort:"\u09b0\u09ac\u09bf_\u09b8\u09cb\u09ae_\u09ae\u0999\u09cd\u0997\u09b2_\u09ac\u09c1\u09a7_\u09ac\u09c3\u09b9\u09b8\u09cd\u09aa\u09a4\u09bf_\u09b6\u09c1\u0995\u09cd\u09b0_\u09b6\u09a8\u09bf".split("_"),weekdaysMin:"\u09b0\u09ac\u09bf_\u09b8\u09cb\u09ae_\u09ae\u0999\u09cd\u0997\u09b2_\u09ac\u09c1\u09a7_\u09ac\u09c3\u09b9_\u09b6\u09c1\u0995\u09cd\u09b0_\u09b6\u09a8\u09bf".split("_"),longDateFormat:{LT:"A h:mm \u09b8\u09ae\u09df",LTS:"A h:mm:ss \u09b8\u09ae\u09df",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u09b8\u09ae\u09df",LLLL:"dddd, D MMMM YYYY, A h:mm \u09b8\u09ae\u09df"},calendar:{sameDay:"[\u0986\u099c] LT",nextDay:"[\u0986\u0997\u09be\u09ae\u09c0\u0995\u09be\u09b2] LT",nextWeek:"dddd, LT",lastDay:"[\u0997\u09a4\u0995\u09be\u09b2] LT",lastWeek:"[\u0997\u09a4] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u09aa\u09b0\u09c7",past:"%s \u0986\u0997\u09c7",s:"\u0995\u09df\u09c7\u0995 \u09b8\u09c7\u0995\u09c7\u09a8\u09cd\u09a1",ss:"%d \u09b8\u09c7\u0995\u09c7\u09a8\u09cd\u09a1",m:"\u098f\u0995 \u09ae\u09bf\u09a8\u09bf\u099f",mm:"%d \u09ae\u09bf\u09a8\u09bf\u099f",h:"\u098f\u0995 \u0998\u09a8\u09cd\u099f\u09be",hh:"%d \u0998\u09a8\u09cd\u099f\u09be",d:"\u098f\u0995 \u09a6\u09bf\u09a8",dd:"%d \u09a6\u09bf\u09a8",M:"\u098f\u0995 \u09ae\u09be\u09b8",MM:"%d \u09ae\u09be\u09b8",y:"\u098f\u0995 \u09ac\u099b\u09b0",yy:"%d \u09ac\u099b\u09b0"},preparse:function(string){return string.replace(/[\u09e7\u09e8\u09e9\u09ea\u09eb\u09ec\u09ed\u09ee\u09ef\u09e6]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u09b0\u09be\u09a4|\u09b8\u0995\u09be\u09b2|\u09a6\u09c1\u09aa\u09c1\u09b0|\u09ac\u09bf\u0995\u09be\u09b2|\u09b0\u09be\u09a4/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u09b0\u09be\u09a4"===meridiem&&hour>=4||"\u09a6\u09c1\u09aa\u09c1\u09b0"===meridiem&&hour<5||"\u09ac\u09bf\u0995\u09be\u09b2"===meridiem?hour+12:hour},meridiem:function(hour,minute,isLower){return hour<4?"\u09b0\u09be\u09a4":hour<10?"\u09b8\u0995\u09be\u09b2":hour<17?"\u09a6\u09c1\u09aa\u09c1\u09b0":hour<20?"\u09ac\u09bf\u0995\u09be\u09b2":"\u09b0\u09be\u09a4"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u09e7",2:"\u09e8",3:"\u09e9",4:"\u09ea",5:"\u09eb",6:"\u09ec",7:"\u09ed",8:"\u09ee",9:"\u09ef",0:"\u09e6"},numberMap={"\u09e7":"1","\u09e8":"2","\u09e9":"3","\u09ea":"4","\u09eb":"5","\u09ec":"6","\u09ed":"7","\u09ee":"8","\u09ef":"9","\u09e6":"0"};moment.defineLocale("bn-bd",{months:"\u099c\u09be\u09a8\u09c1\u09df\u09be\u09b0\u09bf_\u09ab\u09c7\u09ac\u09cd\u09b0\u09c1\u09df\u09be\u09b0\u09bf_\u09ae\u09be\u09b0\u09cd\u099a_\u098f\u09aa\u09cd\u09b0\u09bf\u09b2_\u09ae\u09c7_\u099c\u09c1\u09a8_\u099c\u09c1\u09b2\u09be\u0987_\u0986\u0997\u09b8\u09cd\u099f_\u09b8\u09c7\u09aa\u09cd\u099f\u09c7\u09ae\u09cd\u09ac\u09b0_\u0985\u0995\u09cd\u099f\u09cb\u09ac\u09b0_\u09a8\u09ad\u09c7\u09ae\u09cd\u09ac\u09b0_\u09a1\u09bf\u09b8\u09c7\u09ae\u09cd\u09ac\u09b0".split("_"),monthsShort:"\u099c\u09be\u09a8\u09c1_\u09ab\u09c7\u09ac\u09cd\u09b0\u09c1_\u09ae\u09be\u09b0\u09cd\u099a_\u098f\u09aa\u09cd\u09b0\u09bf\u09b2_\u09ae\u09c7_\u099c\u09c1\u09a8_\u099c\u09c1\u09b2\u09be\u0987_\u0986\u0997\u09b8\u09cd\u099f_\u09b8\u09c7\u09aa\u09cd\u099f_\u0985\u0995\u09cd\u099f\u09cb_\u09a8\u09ad\u09c7_\u09a1\u09bf\u09b8\u09c7".split("_"),weekdays:"\u09b0\u09ac\u09bf\u09ac\u09be\u09b0_\u09b8\u09cb\u09ae\u09ac\u09be\u09b0_\u09ae\u0999\u09cd\u0997\u09b2\u09ac\u09be\u09b0_\u09ac\u09c1\u09a7\u09ac\u09be\u09b0_\u09ac\u09c3\u09b9\u09b8\u09cd\u09aa\u09a4\u09bf\u09ac\u09be\u09b0_\u09b6\u09c1\u0995\u09cd\u09b0\u09ac\u09be\u09b0_\u09b6\u09a8\u09bf\u09ac\u09be\u09b0".split("_"),weekdaysShort:"\u09b0\u09ac\u09bf_\u09b8\u09cb\u09ae_\u09ae\u0999\u09cd\u0997\u09b2_\u09ac\u09c1\u09a7_\u09ac\u09c3\u09b9\u09b8\u09cd\u09aa\u09a4\u09bf_\u09b6\u09c1\u0995\u09cd\u09b0_\u09b6\u09a8\u09bf".split("_"),weekdaysMin:"\u09b0\u09ac\u09bf_\u09b8\u09cb\u09ae_\u09ae\u0999\u09cd\u0997\u09b2_\u09ac\u09c1\u09a7_\u09ac\u09c3\u09b9_\u09b6\u09c1\u0995\u09cd\u09b0_\u09b6\u09a8\u09bf".split("_"),longDateFormat:{LT:"A h:mm \u09b8\u09ae\u09df",LTS:"A h:mm:ss \u09b8\u09ae\u09df",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u09b8\u09ae\u09df",LLLL:"dddd, D MMMM YYYY, A h:mm \u09b8\u09ae\u09df"},calendar:{sameDay:"[\u0986\u099c] LT",nextDay:"[\u0986\u0997\u09be\u09ae\u09c0\u0995\u09be\u09b2] LT",nextWeek:"dddd, LT",lastDay:"[\u0997\u09a4\u0995\u09be\u09b2] LT",lastWeek:"[\u0997\u09a4] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u09aa\u09b0\u09c7",past:"%s \u0986\u0997\u09c7",s:"\u0995\u09df\u09c7\u0995 \u09b8\u09c7\u0995\u09c7\u09a8\u09cd\u09a1",ss:"%d \u09b8\u09c7\u0995\u09c7\u09a8\u09cd\u09a1",m:"\u098f\u0995 \u09ae\u09bf\u09a8\u09bf\u099f",mm:"%d \u09ae\u09bf\u09a8\u09bf\u099f",h:"\u098f\u0995 \u0998\u09a8\u09cd\u099f\u09be",hh:"%d \u0998\u09a8\u09cd\u099f\u09be",d:"\u098f\u0995 \u09a6\u09bf\u09a8",dd:"%d \u09a6\u09bf\u09a8",M:"\u098f\u0995 \u09ae\u09be\u09b8",MM:"%d \u09ae\u09be\u09b8",y:"\u098f\u0995 \u09ac\u099b\u09b0",yy:"%d \u09ac\u099b\u09b0"},preparse:function(string){return string.replace(/[\u09e7\u09e8\u09e9\u09ea\u09eb\u09ec\u09ed\u09ee\u09ef\u09e6]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u09b0\u09be\u09a4|\u09ad\u09cb\u09b0|\u09b8\u0995\u09be\u09b2|\u09a6\u09c1\u09aa\u09c1\u09b0|\u09ac\u09bf\u0995\u09be\u09b2|\u09b8\u09a8\u09cd\u09a7\u09cd\u09af\u09be|\u09b0\u09be\u09a4/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u09b0\u09be\u09a4"===meridiem?hour<4?hour:hour+12:"\u09ad\u09cb\u09b0"===meridiem||"\u09b8\u0995\u09be\u09b2"===meridiem?hour:"\u09a6\u09c1\u09aa\u09c1\u09b0"===meridiem?hour>=3?hour:hour+12:"\u09ac\u09bf\u0995\u09be\u09b2"===meridiem||"\u09b8\u09a8\u09cd\u09a7\u09cd\u09af\u09be"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"\u09b0\u09be\u09a4":hour<6?"\u09ad\u09cb\u09b0":hour<12?"\u09b8\u0995\u09be\u09b2":hour<15?"\u09a6\u09c1\u09aa\u09c1\u09b0":hour<18?"\u09ac\u09bf\u0995\u09be\u09b2":hour<20?"\u09b8\u09a8\u09cd\u09a7\u09cd\u09af\u09be":"\u09b0\u09be\u09a4"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0f21",2:"\u0f22",3:"\u0f23",4:"\u0f24",5:"\u0f25",6:"\u0f26",7:"\u0f27",8:"\u0f28",9:"\u0f29",0:"\u0f20"},numberMap={"\u0f21":"1","\u0f22":"2","\u0f23":"3","\u0f24":"4","\u0f25":"5","\u0f26":"6","\u0f27":"7","\u0f28":"8","\u0f29":"9","\u0f20":"0"};moment.defineLocale("bo",{months:"\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f51\u0f44\u0f0b\u0f54\u0f7c_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f42\u0f49\u0f72\u0f66\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f42\u0f66\u0f74\u0f58\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f5e\u0f72\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f63\u0f94\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f51\u0fb2\u0f74\u0f42\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f62\u0f92\u0fb1\u0f51\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f51\u0f42\u0f74\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f45\u0f74\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f45\u0f74\u0f0b\u0f42\u0f45\u0f72\u0f42\u0f0b\u0f54_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f56\u0f45\u0f74\u0f0b\u0f42\u0f49\u0f72\u0f66\u0f0b\u0f54".split("_"),monthsShort:"\u0f5f\u0fb3\u0f0b1_\u0f5f\u0fb3\u0f0b2_\u0f5f\u0fb3\u0f0b3_\u0f5f\u0fb3\u0f0b4_\u0f5f\u0fb3\u0f0b5_\u0f5f\u0fb3\u0f0b6_\u0f5f\u0fb3\u0f0b7_\u0f5f\u0fb3\u0f0b8_\u0f5f\u0fb3\u0f0b9_\u0f5f\u0fb3\u0f0b10_\u0f5f\u0fb3\u0f0b11_\u0f5f\u0fb3\u0f0b12".split("_"),monthsShortRegex:/^(\u0f5f\u0fb3\u0f0b\d{1,2})/,monthsParseExact:!0,weekdays:"\u0f42\u0f5f\u0f60\u0f0b\u0f49\u0f72\u0f0b\u0f58\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f5f\u0fb3\u0f0b\u0f56\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f58\u0f72\u0f42\u0f0b\u0f51\u0f58\u0f62\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f63\u0fb7\u0f42\u0f0b\u0f54\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f55\u0f74\u0f62\u0f0b\u0f56\u0f74_\u0f42\u0f5f\u0f60\u0f0b\u0f54\u0f0b\u0f66\u0f44\u0f66\u0f0b_\u0f42\u0f5f\u0f60\u0f0b\u0f66\u0fa4\u0f7a\u0f53\u0f0b\u0f54\u0f0b".split("_"),weekdaysShort:"\u0f49\u0f72\u0f0b\u0f58\u0f0b_\u0f5f\u0fb3\u0f0b\u0f56\u0f0b_\u0f58\u0f72\u0f42\u0f0b\u0f51\u0f58\u0f62\u0f0b_\u0f63\u0fb7\u0f42\u0f0b\u0f54\u0f0b_\u0f55\u0f74\u0f62\u0f0b\u0f56\u0f74_\u0f54\u0f0b\u0f66\u0f44\u0f66\u0f0b_\u0f66\u0fa4\u0f7a\u0f53\u0f0b\u0f54\u0f0b".split("_"),weekdaysMin:"\u0f49\u0f72_\u0f5f\u0fb3_\u0f58\u0f72\u0f42_\u0f63\u0fb7\u0f42_\u0f55\u0f74\u0f62_\u0f66\u0f44\u0f66_\u0f66\u0fa4\u0f7a\u0f53".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[\u0f51\u0f72\u0f0b\u0f62\u0f72\u0f44] LT",nextDay:"[\u0f66\u0f44\u0f0b\u0f49\u0f72\u0f53] LT",nextWeek:"[\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f55\u0fb2\u0f42\u0f0b\u0f62\u0f97\u0f7a\u0f66\u0f0b\u0f58], LT",lastDay:"[\u0f41\u0f0b\u0f66\u0f44] LT",lastWeek:"[\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f55\u0fb2\u0f42\u0f0b\u0f58\u0f50\u0f60\u0f0b\u0f58] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0f63\u0f0b",past:"%s \u0f66\u0f94\u0f53\u0f0b\u0f63",s:"\u0f63\u0f58\u0f0b\u0f66\u0f44",ss:"%d \u0f66\u0f90\u0f62\u0f0b\u0f46\u0f0d",m:"\u0f66\u0f90\u0f62\u0f0b\u0f58\u0f0b\u0f42\u0f45\u0f72\u0f42",mm:"%d \u0f66\u0f90\u0f62\u0f0b\u0f58",h:"\u0f46\u0f74\u0f0b\u0f5a\u0f7c\u0f51\u0f0b\u0f42\u0f45\u0f72\u0f42",hh:"%d \u0f46\u0f74\u0f0b\u0f5a\u0f7c\u0f51",d:"\u0f49\u0f72\u0f53\u0f0b\u0f42\u0f45\u0f72\u0f42",dd:"%d \u0f49\u0f72\u0f53\u0f0b",M:"\u0f5f\u0fb3\u0f0b\u0f56\u0f0b\u0f42\u0f45\u0f72\u0f42",MM:"%d \u0f5f\u0fb3\u0f0b\u0f56",y:"\u0f63\u0f7c\u0f0b\u0f42\u0f45\u0f72\u0f42",yy:"%d \u0f63\u0f7c"},preparse:function(string){return string.replace(/[\u0f21\u0f22\u0f23\u0f24\u0f25\u0f26\u0f27\u0f28\u0f29\u0f20]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c|\u0f5e\u0f7c\u0f42\u0f66\u0f0b\u0f40\u0f66|\u0f49\u0f72\u0f53\u0f0b\u0f42\u0f74\u0f44|\u0f51\u0f42\u0f7c\u0f44\u0f0b\u0f51\u0f42|\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c"===meridiem&&hour>=4||"\u0f49\u0f72\u0f53\u0f0b\u0f42\u0f74\u0f44"===meridiem&&hour<5||"\u0f51\u0f42\u0f7c\u0f44\u0f0b\u0f51\u0f42"===meridiem?hour+12:hour},meridiem:function(hour,minute,isLower){return hour<4?"\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c":hour<10?"\u0f5e\u0f7c\u0f42\u0f66\u0f0b\u0f40\u0f66":hour<17?"\u0f49\u0f72\u0f53\u0f0b\u0f42\u0f74\u0f44":hour<20?"\u0f51\u0f42\u0f7c\u0f44\u0f0b\u0f51\u0f42":"\u0f58\u0f5a\u0f53\u0f0b\u0f58\u0f7c"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function relativeTimeWithMutation(number,withoutSuffix,key){return number+" "+function(text,number){return 2===number?function(text){var mutationTable={m:"v",b:"v",d:"z"};return void 0===mutationTable[text.charAt(0)]?text:mutationTable[text.charAt(0)]+text.substring(1)}(text):text}({mm:"munutenn",MM:"miz",dd:"devezh"}[key],number)}var monthsParse=[/^gen/i,/^c[\u02bc\']hwe/i,/^meu/i,/^ebr/i,/^mae/i,/^(mez|eve)/i,/^gou/i,/^eos/i,/^gwe/i,/^her/i,/^du/i,/^ker/i],monthsRegex=/^(genver|c[\u02bc\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu|gen|c[\u02bc\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,minWeekdaysParse=[/^Su/i,/^Lu/i,/^Me([^r]|$)/i,/^Mer/i,/^Ya/i,/^Gw/i,/^Sa/i];moment.defineLocale("br",{months:"Genver_C\u02bchwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C\u02bchwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc\u02bcher_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),weekdaysParse:minWeekdaysParse,fullWeekdaysParse:[/^sul/i,/^lun/i,/^meurzh/i,/^merc[\u02bc\']her/i,/^yaou/i,/^gwener/i,/^sadorn/i],shortWeekdaysParse:[/^Sul/i,/^Lun/i,/^Meu/i,/^Mer/i,/^Yao/i,/^Gwe/i,/^Sad/i],minWeekdaysParse:minWeekdaysParse,monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(genver|c[\u02bc\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu)/i,monthsShortStrictRegex:/^(gen|c[\u02bc\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY HH:mm",LLLL:"dddd, D [a viz] MMMM YYYY HH:mm"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc\u02bchoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec\u02bch da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s \u02bczo",s:"un nebeud segondenno\xf9",ss:"%d eilenn",m:"ur vunutenn",mm:relativeTimeWithMutation,h:"un eur",hh:"%d eur",d:"un devezh",dd:relativeTimeWithMutation,M:"ur miz",MM:relativeTimeWithMutation,y:"ur bloaz",yy:function(number){switch(function lastNumber(number){return number>9?lastNumber(number%10):number}(number)){case 1:case 3:case 4:case 5:case 9:return number+" bloaz";default:return number+" vloaz"}}},dayOfMonthOrdinalParse:/\d{1,2}(a\xf1|vet)/,ordinal:function(number){return number+(1===number?"a\xf1":"vet")},week:{dow:1,doy:4},meridiemParse:/a.m.|g.m./,isPM:function(token){return"g.m."===token},meridiem:function(hour,minute,isLower){return hour<12?"a.m.":"g.m."}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function translate(number,withoutSuffix,key){var result=number+" ";switch(key){case"ss":return result+(1===number?"sekunda":2===number||3===number||4===number?"sekunde":"sekundi");case"m":return withoutSuffix?"jedna minuta":"jedne minute";case"mm":return result+(1===number?"minuta":2===number||3===number||4===number?"minute":"minuta");case"h":return withoutSuffix?"jedan sat":"jednog sata";case"hh":return result+(1===number?"sat":2===number||3===number||4===number?"sata":"sati");case"dd":return result+(1===number?"dan":"dana");case"MM":return result+(1===number?"mjesec":2===number||3===number||4===number?"mjeseca":"mjeseci");case"yy":return result+(1===number?"godina":2===number||3===number||4===number?"godine":"godina")}}moment.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_august_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_\u010detvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._\u010det._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_\u010de_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[ju\u010der u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[pro\u0161lu] dddd [u] LT";case 6:return"[pro\u0161le] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[pro\u0161li] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"dan",dd:translate,M:"mjesec",MM:translate,y:"godinu",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ca",{months:{standalone:"gener_febrer_mar\xe7_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),format:"de gener_de febrer_de mar\xe7_d'abril_de maig_de juny_de juliol_d'agost_de setembre_d'octubre_de novembre_de desembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar\xe7_abr._maig_juny_jul._ag._set._oct._nov._des.".split("_"),monthsParseExact:!0,weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dt_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a les] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a les] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem\xe0 a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"d'aqu\xed %s",past:"fa %s",s:"uns segons",ss:"%d segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t|\xe8|a)/,ordinal:function(number,period){var output=1===number?"r":2===number?"n":3===number?"r":4===number?"t":"\xe8";return"w"!==period&&"W"!==period||(output="a"),number+output},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var months="leden_\xfanor_b\u0159ezen_duben_kv\u011bten_\u010derven_\u010dervenec_srpen_z\xe1\u0159\xed_\u0159\xedjen_listopad_prosinec".split("_"),monthsShort="led_\xfano_b\u0159e_dub_kv\u011b_\u010dvn_\u010dvc_srp_z\xe1\u0159_\u0159\xedj_lis_pro".split("_"),monthsParse=[/^led/i,/^\xfano/i,/^b\u0159e/i,/^dub/i,/^kv\u011b/i,/^(\u010dvn|\u010derven$|\u010dervna)/i,/^(\u010dvc|\u010dervenec|\u010dervence)/i,/^srp/i,/^z\xe1\u0159/i,/^\u0159\xedj/i,/^lis/i,/^pro/i],monthsRegex=/^(leden|\xfanor|b\u0159ezen|duben|kv\u011bten|\u010dervenec|\u010dervence|\u010derven|\u010dervna|srpen|z\xe1\u0159\xed|\u0159\xedjen|listopad|prosinec|led|\xfano|b\u0159e|dub|kv\u011b|\u010dvn|\u010dvc|srp|z\xe1\u0159|\u0159\xedj|lis|pro)/i;function plural(n){return n>1&&n<5&&1!=~~(n/10)}function translate(number,withoutSuffix,key,isFuture){var result=number+" ";switch(key){case"s":return withoutSuffix||isFuture?"p\xe1r sekund":"p\xe1r sekundami";case"ss":return withoutSuffix||isFuture?result+(plural(number)?"sekundy":"sekund"):result+"sekundami";case"m":return withoutSuffix?"minuta":isFuture?"minutu":"minutou";case"mm":return withoutSuffix||isFuture?result+(plural(number)?"minuty":"minut"):result+"minutami";case"h":return withoutSuffix?"hodina":isFuture?"hodinu":"hodinou";case"hh":return withoutSuffix||isFuture?result+(plural(number)?"hodiny":"hodin"):result+"hodinami";case"d":return withoutSuffix||isFuture?"den":"dnem";case"dd":return withoutSuffix||isFuture?result+(plural(number)?"dny":"dn\xed"):result+"dny";case"M":return withoutSuffix||isFuture?"m\u011bs\xedc":"m\u011bs\xedcem";case"MM":return withoutSuffix||isFuture?result+(plural(number)?"m\u011bs\xedce":"m\u011bs\xedc\u016f"):result+"m\u011bs\xedci";case"y":return withoutSuffix||isFuture?"rok":"rokem";case"yy":return withoutSuffix||isFuture?result+(plural(number)?"roky":"let"):result+"lety"}}moment.defineLocale("cs",{months:months,monthsShort:monthsShort,monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(leden|ledna|\xfanora|\xfanor|b\u0159ezen|b\u0159ezna|duben|dubna|kv\u011bten|kv\u011btna|\u010dervenec|\u010dervence|\u010derven|\u010dervna|srpen|srpna|z\xe1\u0159\xed|\u0159\xedjen|\u0159\xedjna|listopadu|listopad|prosinec|prosince)/i,monthsShortStrictRegex:/^(led|\xfano|b\u0159e|dub|kv\u011b|\u010dvn|\u010dvc|srp|z\xe1\u0159|\u0159\xedj|lis|pro)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"ned\u011ble_pond\u011bl\xed_\xfater\xfd_st\u0159eda_\u010dtvrtek_p\xe1tek_sobota".split("_"),weekdaysShort:"ne_po_\xfat_st_\u010dt_p\xe1_so".split("_"),weekdaysMin:"ne_po_\xfat_st_\u010dt_p\xe1_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm",l:"D. M. YYYY"},calendar:{sameDay:"[dnes v] LT",nextDay:"[z\xedtra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v ned\u011bli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve st\u0159edu v] LT";case 4:return"[ve \u010dtvrtek v] LT";case 5:return"[v p\xe1tek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[v\u010dera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou ned\u011bli v] LT";case 1:case 2:return"[minul\xe9] dddd [v] LT";case 3:return"[minulou st\u0159edu v] LT";case 4:case 5:return"[minul\xfd] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"p\u0159ed %s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("cv",{months:"\u043a\u04d1\u0440\u043b\u0430\u0447_\u043d\u0430\u0440\u04d1\u0441_\u043f\u0443\u0448_\u0430\u043a\u0430_\u043c\u0430\u0439_\u04ab\u04d7\u0440\u0442\u043c\u0435_\u0443\u0442\u04d1_\u04ab\u0443\u0440\u043b\u0430_\u0430\u0432\u04d1\u043d_\u044e\u043f\u0430_\u0447\u04f3\u043a_\u0440\u0430\u0448\u0442\u0430\u0432".split("_"),monthsShort:"\u043a\u04d1\u0440_\u043d\u0430\u0440_\u043f\u0443\u0448_\u0430\u043a\u0430_\u043c\u0430\u0439_\u04ab\u04d7\u0440_\u0443\u0442\u04d1_\u04ab\u0443\u0440_\u0430\u0432\u043d_\u044e\u043f\u0430_\u0447\u04f3\u043a_\u0440\u0430\u0448".split("_"),weekdays:"\u0432\u044b\u0440\u0441\u0430\u0440\u043d\u0438\u043a\u0443\u043d_\u0442\u0443\u043d\u0442\u0438\u043a\u0443\u043d_\u044b\u0442\u043b\u0430\u0440\u0438\u043a\u0443\u043d_\u044e\u043d\u043a\u0443\u043d_\u043a\u04d7\u04ab\u043d\u0435\u0440\u043d\u0438\u043a\u0443\u043d_\u044d\u0440\u043d\u0435\u043a\u0443\u043d_\u0448\u04d1\u043c\u0430\u0442\u043a\u0443\u043d".split("_"),weekdaysShort:"\u0432\u044b\u0440_\u0442\u0443\u043d_\u044b\u0442\u043b_\u044e\u043d_\u043a\u04d7\u04ab_\u044d\u0440\u043d_\u0448\u04d1\u043c".split("_"),weekdaysMin:"\u0432\u0440_\u0442\u043d_\u044b\u0442_\u044e\u043d_\u043a\u04ab_\u044d\u0440_\u0448\u043c".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"YYYY [\u04ab\u0443\u043b\u0445\u0438] MMMM [\u0443\u0439\u04d1\u0445\u04d7\u043d] D[-\u043c\u04d7\u0448\u04d7]",LLL:"YYYY [\u04ab\u0443\u043b\u0445\u0438] MMMM [\u0443\u0439\u04d1\u0445\u04d7\u043d] D[-\u043c\u04d7\u0448\u04d7], HH:mm",LLLL:"dddd, YYYY [\u04ab\u0443\u043b\u0445\u0438] MMMM [\u0443\u0439\u04d1\u0445\u04d7\u043d] D[-\u043c\u04d7\u0448\u04d7], HH:mm"},calendar:{sameDay:"[\u041f\u0430\u044f\u043d] LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",nextDay:"[\u042b\u0440\u0430\u043d] LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",lastDay:"[\u04d6\u043d\u0435\u0440] LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",nextWeek:"[\u04aa\u0438\u0442\u0435\u0441] dddd LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",lastWeek:"[\u0418\u0440\u0442\u043d\u04d7] dddd LT [\u0441\u0435\u0445\u0435\u0442\u0440\u0435]",sameElse:"L"},relativeTime:{future:function(output){return output+(/\u0441\u0435\u0445\u0435\u0442$/i.exec(output)?"\u0440\u0435\u043d":/\u04ab\u0443\u043b$/i.exec(output)?"\u0442\u0430\u043d":"\u0440\u0430\u043d")},past:"%s \u043a\u0430\u044f\u043b\u043b\u0430",s:"\u043f\u04d7\u0440-\u0438\u043a \u04ab\u0435\u043a\u043a\u0443\u043d\u0442",ss:"%d \u04ab\u0435\u043a\u043a\u0443\u043d\u0442",m:"\u043f\u04d7\u0440 \u043c\u0438\u043d\u0443\u0442",mm:"%d \u043c\u0438\u043d\u0443\u0442",h:"\u043f\u04d7\u0440 \u0441\u0435\u0445\u0435\u0442",hh:"%d \u0441\u0435\u0445\u0435\u0442",d:"\u043f\u04d7\u0440 \u043a\u0443\u043d",dd:"%d \u043a\u0443\u043d",M:"\u043f\u04d7\u0440 \u0443\u0439\u04d1\u0445",MM:"%d \u0443\u0439\u04d1\u0445",y:"\u043f\u04d7\u0440 \u04ab\u0443\u043b",yy:"%d \u04ab\u0443\u043b"},dayOfMonthOrdinalParse:/\d{1,2}-\u043c\u04d7\u0448/,ordinal:"%d-\u043c\u04d7\u0448",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn \xf4l",s:"ychydig eiliadau",ss:"%d eiliad",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},dayOfMonthOrdinalParse:/\d{1,2}(fed|ain|af|il|ydd|ed|eg)/,ordinal:function(number){var output="";return number>20?output=40===number||50===number||60===number||80===number||100===number?"fed":"ain":number>0&&(output=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"][number]),number+output},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"s\xf8ndag_mandag_tirsdag_onsdag_torsdag_fredag_l\xf8rdag".split("_"),weekdaysShort:"s\xf8n_man_tir_ons_tor_fre_l\xf8r".split("_"),weekdaysMin:"s\xf8_ma_ti_on_to_fr_l\xf8".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd [d.] D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"p\xe5 dddd [kl.] LT",lastDay:"[i g\xe5r kl.] LT",lastWeek:"[i] dddd[s kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f\xe5 sekunder",ss:"%d sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en m\xe5ned",MM:"%d m\xe5neder",y:"et \xe5r",yy:"%d \xe5r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[number+" Tage",number+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[number+" Monate",number+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[number+" Jahre",number+" Jahren"]};return withoutSuffix?format[key][0]:format[key][1]}moment.defineLocale("de",{months:"Januar_Februar_M\xe4rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._M\xe4rz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,w:processRelativeTime,ww:"%d Wochen",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[number+" Tage",number+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[number+" Monate",number+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[number+" Jahre",number+" Jahren"]};return withoutSuffix?format[key][0]:format[key][1]}moment.defineLocale("de-at",{months:"J\xe4nner_Februar_M\xe4rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"J\xe4n._Feb._M\xe4rz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,w:processRelativeTime,ww:"%d Wochen",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[number+" Tage",number+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[number+" Monate",number+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[number+" Jahre",number+" Jahren"]};return withoutSuffix?format[key][0]:format[key][1]}moment.defineLocale("de-ch",{months:"Januar_Februar_M\xe4rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._M\xe4rz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,w:processRelativeTime,ww:"%d Wochen",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var months=["\u0796\u07ac\u0782\u07aa\u0787\u07a6\u0783\u07a9","\u078a\u07ac\u0784\u07b0\u0783\u07aa\u0787\u07a6\u0783\u07a9","\u0789\u07a7\u0783\u07a8\u0797\u07aa","\u0787\u07ad\u0795\u07b0\u0783\u07a9\u078d\u07aa","\u0789\u07ad","\u0796\u07ab\u0782\u07b0","\u0796\u07aa\u078d\u07a6\u0787\u07a8","\u0787\u07af\u078e\u07a6\u0790\u07b0\u0793\u07aa","\u0790\u07ac\u0795\u07b0\u0793\u07ac\u0789\u07b0\u0784\u07a6\u0783\u07aa","\u0787\u07ae\u0786\u07b0\u0793\u07af\u0784\u07a6\u0783\u07aa","\u0782\u07ae\u0788\u07ac\u0789\u07b0\u0784\u07a6\u0783\u07aa","\u0791\u07a8\u0790\u07ac\u0789\u07b0\u0784\u07a6\u0783\u07aa"],weekdays=["\u0787\u07a7\u078b\u07a8\u0787\u07b0\u078c\u07a6","\u0780\u07af\u0789\u07a6","\u0787\u07a6\u0782\u07b0\u078e\u07a7\u0783\u07a6","\u0784\u07aa\u078b\u07a6","\u0784\u07aa\u0783\u07a7\u0790\u07b0\u078a\u07a6\u078c\u07a8","\u0780\u07aa\u0786\u07aa\u0783\u07aa","\u0780\u07ae\u0782\u07a8\u0780\u07a8\u0783\u07aa"];moment.defineLocale("dv",{months:months,monthsShort:months,weekdays:weekdays,weekdaysShort:weekdays,weekdaysMin:"\u0787\u07a7\u078b\u07a8_\u0780\u07af\u0789\u07a6_\u0787\u07a6\u0782\u07b0_\u0784\u07aa\u078b\u07a6_\u0784\u07aa\u0783\u07a7_\u0780\u07aa\u0786\u07aa_\u0780\u07ae\u0782\u07a8".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0789\u0786|\u0789\u078a/,isPM:function(input){return"\u0789\u078a"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0789\u0786":"\u0789\u078a"},calendar:{sameDay:"[\u0789\u07a8\u0787\u07a6\u078b\u07aa] LT",nextDay:"[\u0789\u07a7\u078b\u07a6\u0789\u07a7] LT",nextWeek:"dddd LT",lastDay:"[\u0787\u07a8\u0787\u07b0\u0794\u07ac] LT",lastWeek:"[\u078a\u07a7\u0787\u07a8\u078c\u07aa\u0788\u07a8] dddd LT",sameElse:"L"},relativeTime:{future:"\u078c\u07ac\u0783\u07ad\u078e\u07a6\u0787\u07a8 %s",past:"\u0786\u07aa\u0783\u07a8\u0782\u07b0 %s",s:"\u0790\u07a8\u0786\u07aa\u0782\u07b0\u078c\u07aa\u0786\u07ae\u0785\u07ac\u0787\u07b0",ss:"d% \u0790\u07a8\u0786\u07aa\u0782\u07b0\u078c\u07aa",m:"\u0789\u07a8\u0782\u07a8\u0793\u07ac\u0787\u07b0",mm:"\u0789\u07a8\u0782\u07a8\u0793\u07aa %d",h:"\u078e\u07a6\u0791\u07a8\u0787\u07a8\u0783\u07ac\u0787\u07b0",hh:"\u078e\u07a6\u0791\u07a8\u0787\u07a8\u0783\u07aa %d",d:"\u078b\u07aa\u0788\u07a6\u0780\u07ac\u0787\u07b0",dd:"\u078b\u07aa\u0788\u07a6\u0790\u07b0 %d",M:"\u0789\u07a6\u0780\u07ac\u0787\u07b0",MM:"\u0789\u07a6\u0790\u07b0 %d",y:"\u0787\u07a6\u0780\u07a6\u0783\u07ac\u0787\u07b0",yy:"\u0787\u07a6\u0780\u07a6\u0783\u07aa %d"},preparse:function(string){return string.replace(/\u060c/g,",")},postformat:function(string){return string.replace(/,/g,"\u060c")},week:{dow:7,doy:12}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("el",{monthsNominativeEl:"\u0399\u03b1\u03bd\u03bf\u03c5\u03ac\u03c1\u03b9\u03bf\u03c2_\u03a6\u03b5\u03b2\u03c1\u03bf\u03c5\u03ac\u03c1\u03b9\u03bf\u03c2_\u039c\u03ac\u03c1\u03c4\u03b9\u03bf\u03c2_\u0391\u03c0\u03c1\u03af\u03bb\u03b9\u03bf\u03c2_\u039c\u03ac\u03b9\u03bf\u03c2_\u0399\u03bf\u03cd\u03bd\u03b9\u03bf\u03c2_\u0399\u03bf\u03cd\u03bb\u03b9\u03bf\u03c2_\u0391\u03cd\u03b3\u03bf\u03c5\u03c3\u03c4\u03bf\u03c2_\u03a3\u03b5\u03c0\u03c4\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2_\u039f\u03ba\u03c4\u03ce\u03b2\u03c1\u03b9\u03bf\u03c2_\u039d\u03bf\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2_\u0394\u03b5\u03ba\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2".split("_"),monthsGenitiveEl:"\u0399\u03b1\u03bd\u03bf\u03c5\u03b1\u03c1\u03af\u03bf\u03c5_\u03a6\u03b5\u03b2\u03c1\u03bf\u03c5\u03b1\u03c1\u03af\u03bf\u03c5_\u039c\u03b1\u03c1\u03c4\u03af\u03bf\u03c5_\u0391\u03c0\u03c1\u03b9\u03bb\u03af\u03bf\u03c5_\u039c\u03b1\u0390\u03bf\u03c5_\u0399\u03bf\u03c5\u03bd\u03af\u03bf\u03c5_\u0399\u03bf\u03c5\u03bb\u03af\u03bf\u03c5_\u0391\u03c5\u03b3\u03bf\u03cd\u03c3\u03c4\u03bf\u03c5_\u03a3\u03b5\u03c0\u03c4\u03b5\u03bc\u03b2\u03c1\u03af\u03bf\u03c5_\u039f\u03ba\u03c4\u03c9\u03b2\u03c1\u03af\u03bf\u03c5_\u039d\u03bf\u03b5\u03bc\u03b2\u03c1\u03af\u03bf\u03c5_\u0394\u03b5\u03ba\u03b5\u03bc\u03b2\u03c1\u03af\u03bf\u03c5".split("_"),months:function(momentToFormat,format){return momentToFormat?"string"==typeof format&&/D/.test(format.substring(0,format.indexOf("MMMM")))?this._monthsGenitiveEl[momentToFormat.month()]:this._monthsNominativeEl[momentToFormat.month()]:this._monthsNominativeEl},monthsShort:"\u0399\u03b1\u03bd_\u03a6\u03b5\u03b2_\u039c\u03b1\u03c1_\u0391\u03c0\u03c1_\u039c\u03b1\u03ca_\u0399\u03bf\u03c5\u03bd_\u0399\u03bf\u03c5\u03bb_\u0391\u03c5\u03b3_\u03a3\u03b5\u03c0_\u039f\u03ba\u03c4_\u039d\u03bf\u03b5_\u0394\u03b5\u03ba".split("_"),weekdays:"\u039a\u03c5\u03c1\u03b9\u03b1\u03ba\u03ae_\u0394\u03b5\u03c5\u03c4\u03ad\u03c1\u03b1_\u03a4\u03c1\u03af\u03c4\u03b7_\u03a4\u03b5\u03c4\u03ac\u03c1\u03c4\u03b7_\u03a0\u03ad\u03bc\u03c0\u03c4\u03b7_\u03a0\u03b1\u03c1\u03b1\u03c3\u03ba\u03b5\u03c5\u03ae_\u03a3\u03ac\u03b2\u03b2\u03b1\u03c4\u03bf".split("_"),weekdaysShort:"\u039a\u03c5\u03c1_\u0394\u03b5\u03c5_\u03a4\u03c1\u03b9_\u03a4\u03b5\u03c4_\u03a0\u03b5\u03bc_\u03a0\u03b1\u03c1_\u03a3\u03b1\u03b2".split("_"),weekdaysMin:"\u039a\u03c5_\u0394\u03b5_\u03a4\u03c1_\u03a4\u03b5_\u03a0\u03b5_\u03a0\u03b1_\u03a3\u03b1".split("_"),meridiem:function(hours,minutes,isLower){return hours>11?isLower?"\u03bc\u03bc":"\u039c\u039c":isLower?"\u03c0\u03bc":"\u03a0\u039c"},isPM:function(input){return"\u03bc"===(input+"").toLowerCase()[0]},meridiemParse:/[\u03a0\u039c]\.?\u039c?\.?/i,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendarEl:{sameDay:"[\u03a3\u03ae\u03bc\u03b5\u03c1\u03b1 {}] LT",nextDay:"[\u0391\u03cd\u03c1\u03b9\u03bf {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[\u03a7\u03b8\u03b5\u03c2 {}] LT",lastWeek:function(){switch(this.day()){case 6:return"[\u03c4\u03bf \u03c0\u03c1\u03bf\u03b7\u03b3\u03bf\u03cd\u03bc\u03b5\u03bd\u03bf] dddd [{}] LT";default:return"[\u03c4\u03b7\u03bd \u03c0\u03c1\u03bf\u03b7\u03b3\u03bf\u03cd\u03bc\u03b5\u03bd\u03b7] dddd [{}] LT"}},sameElse:"L"},calendar:function(key,mom){var input,output=this._calendarEl[key],hours=mom&&mom.hours();return input=output,("undefined"!=typeof Function&&input instanceof Function||"[object Function]"===Object.prototype.toString.call(input))&&(output=output.apply(mom)),output.replace("{}",hours%12==1?"\u03c3\u03c4\u03b7":"\u03c3\u03c4\u03b9\u03c2")},relativeTime:{future:"\u03c3\u03b5 %s",past:"%s \u03c0\u03c1\u03b9\u03bd",s:"\u03bb\u03af\u03b3\u03b1 \u03b4\u03b5\u03c5\u03c4\u03b5\u03c1\u03cc\u03bb\u03b5\u03c0\u03c4\u03b1",ss:"%d \u03b4\u03b5\u03c5\u03c4\u03b5\u03c1\u03cc\u03bb\u03b5\u03c0\u03c4\u03b1",m:"\u03ad\u03bd\u03b1 \u03bb\u03b5\u03c0\u03c4\u03cc",mm:"%d \u03bb\u03b5\u03c0\u03c4\u03ac",h:"\u03bc\u03af\u03b1 \u03ce\u03c1\u03b1",hh:"%d \u03ce\u03c1\u03b5\u03c2",d:"\u03bc\u03af\u03b1 \u03bc\u03ad\u03c1\u03b1",dd:"%d \u03bc\u03ad\u03c1\u03b5\u03c2",M:"\u03ad\u03bd\u03b1\u03c2 \u03bc\u03ae\u03bd\u03b1\u03c2",MM:"%d \u03bc\u03ae\u03bd\u03b5\u03c2",y:"\u03ad\u03bd\u03b1\u03c2 \u03c7\u03c1\u03cc\u03bd\u03bf\u03c2",yy:"%d \u03c7\u03c1\u03cc\u03bd\u03b9\u03b1"},dayOfMonthOrdinalParse:/\d{1,2}\u03b7/,ordinal:"%d\u03b7",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")},week:{dow:0,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"YYYY-MM-DD",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("en-ie",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("en-il",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("en-in",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("en-nz",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("en-sg",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_a\u016dgusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mart_apr_maj_jun_jul_a\u016dg_sept_okt_nov_dec".split("_"),weekdays:"diman\u0109o_lundo_mardo_merkredo_\u0135a\u016ddo_vendredo_sabato".split("_"),weekdaysShort:"dim_lun_mard_merk_\u0135a\u016d_ven_sab".split("_"),weekdaysMin:"di_lu_ma_me_\u0135a_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"[la] D[-an de] MMMM, YYYY",LLL:"[la] D[-an de] MMMM, YYYY HH:mm",LLLL:"dddd[n], [la] D[-an de] MMMM, YYYY HH:mm",llll:"ddd, [la] D[-an de] MMM, YYYY HH:mm"},meridiemParse:/[ap]\.t\.m/i,isPM:function(input){return"p"===input.charAt(0).toLowerCase()},meridiem:function(hours,minutes,isLower){return hours>11?isLower?"p.t.m.":"P.T.M.":isLower?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia\u016d je] LT",nextDay:"[Morga\u016d je] LT",nextWeek:"dddd[n je] LT",lastDay:"[Hiera\u016d je] LT",lastWeek:"[pasintan] dddd[n je] LT",sameElse:"L"},relativeTime:{future:"post %s",past:"anta\u016d %s",s:"kelkaj sekundoj",ss:"%d sekundoj",m:"unu minuto",mm:"%d minutoj",h:"unu horo",hh:"%d horoj",d:"unu tago",dd:"%d tagoj",M:"unu monato",MM:"%d monatoj",y:"unu jaro",yy:"%d jaroj"},dayOfMonthOrdinalParse:/\d{1,2}a/,ordinal:"%da",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsShortDot="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),_monthsShort="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),monthsParse=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],monthsRegex=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;moment.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(m,format){return m?/-MMM-/.test(format)?_monthsShort[m.month()]:monthsShortDot[m.month()]:monthsShortDot},monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"domingo_lunes_martes_mi\xe9rcoles_jueves_viernes_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xe9._jue._vie._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma\xf1ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un a\xf1o",yy:"%d a\xf1os"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4},invalidDate:"Fecha inv\xe1lida"})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsShortDot="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),_monthsShort2="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),monthsParse=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],monthsRegex=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;moment.defineLocale("es-do",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(m,format){return m?/-MMM-/.test(format)?_monthsShort2[m.month()]:monthsShortDot[m.month()]:monthsShortDot},monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"domingo_lunes_martes_mi\xe9rcoles_jueves_viernes_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xe9._jue._vie._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma\xf1ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un a\xf1o",yy:"%d a\xf1os"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsShortDot="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),_monthsShort3="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),monthsParse=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],monthsRegex=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;moment.defineLocale("es-mx",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(m,format){return m?/-MMM-/.test(format)?_monthsShort3[m.month()]:monthsShortDot[m.month()]:monthsShortDot},monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"domingo_lunes_martes_mi\xe9rcoles_jueves_viernes_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xe9._jue._vie._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma\xf1ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un a\xf1o",yy:"%d a\xf1os"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:0,doy:4},invalidDate:"Fecha inv\xe1lida"})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsShortDot="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),_monthsShort4="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),monthsParse=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],monthsRegex=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;moment.defineLocale("es-us",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(m,format){return m?/-MMM-/.test(format)?_monthsShort4[m.month()]:monthsShortDot[m.month()]:monthsShortDot},monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"domingo_lunes_martes_mi\xe9rcoles_jueves_viernes_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xe9._jue._vie._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"MM/DD/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma\xf1ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un a\xf1o",yy:"%d a\xf1os"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={s:["m\xf5ne sekundi","m\xf5ni sekund","paar sekundit"],ss:[number+"sekundi",number+"sekundit"],m:["\xfche minuti","\xfcks minut"],mm:[number+" minuti",number+" minutit"],h:["\xfche tunni","tund aega","\xfcks tund"],hh:[number+" tunni",number+" tundi"],d:["\xfche p\xe4eva","\xfcks p\xe4ev"],M:["kuu aja","kuu aega","\xfcks kuu"],MM:[number+" kuu",number+" kuud"],y:["\xfche aasta","aasta","\xfcks aasta"],yy:[number+" aasta",number+" aastat"]};return withoutSuffix?format[key][2]?format[key][2]:format[key][1]:isFuture?format[key][0]:format[key][1]}moment.defineLocale("et",{months:"jaanuar_veebruar_m\xe4rts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_m\xe4rts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"p\xfchap\xe4ev_esmasp\xe4ev_teisip\xe4ev_kolmap\xe4ev_neljap\xe4ev_reede_laup\xe4ev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[T\xe4na,] LT",nextDay:"[Homme,] LT",nextWeek:"[J\xe4rgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s p\xe4rast",past:"%s tagasi",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:"%d p\xe4eva",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),monthsParseExact:!0,weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] HH:mm",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] HH:mm",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] HH:mm",llll:"ddd, YYYY[ko] MMM D[a] HH:mm"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",ss:"%d segundo",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u06f1",2:"\u06f2",3:"\u06f3",4:"\u06f4",5:"\u06f5",6:"\u06f6",7:"\u06f7",8:"\u06f8",9:"\u06f9",0:"\u06f0"},numberMap={"\u06f1":"1","\u06f2":"2","\u06f3":"3","\u06f4":"4","\u06f5":"5","\u06f6":"6","\u06f7":"7","\u06f8":"8","\u06f9":"9","\u06f0":"0"};moment.defineLocale("fa",{months:"\u0698\u0627\u0646\u0648\u06cc\u0647_\u0641\u0648\u0631\u06cc\u0647_\u0645\u0627\u0631\u0633_\u0622\u0648\u0631\u06cc\u0644_\u0645\u0647_\u0698\u0648\u0626\u0646_\u0698\u0648\u0626\u06cc\u0647_\u0627\u0648\u062a_\u0633\u067e\u062a\u0627\u0645\u0628\u0631_\u0627\u06a9\u062a\u0628\u0631_\u0646\u0648\u0627\u0645\u0628\u0631_\u062f\u0633\u0627\u0645\u0628\u0631".split("_"),monthsShort:"\u0698\u0627\u0646\u0648\u06cc\u0647_\u0641\u0648\u0631\u06cc\u0647_\u0645\u0627\u0631\u0633_\u0622\u0648\u0631\u06cc\u0644_\u0645\u0647_\u0698\u0648\u0626\u0646_\u0698\u0648\u0626\u06cc\u0647_\u0627\u0648\u062a_\u0633\u067e\u062a\u0627\u0645\u0628\u0631_\u0627\u06a9\u062a\u0628\u0631_\u0646\u0648\u0627\u0645\u0628\u0631_\u062f\u0633\u0627\u0645\u0628\u0631".split("_"),weekdays:"\u06cc\u06a9\u200c\u0634\u0646\u0628\u0647_\u062f\u0648\u0634\u0646\u0628\u0647_\u0633\u0647\u200c\u0634\u0646\u0628\u0647_\u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647_\u067e\u0646\u062c\u200c\u0634\u0646\u0628\u0647_\u062c\u0645\u0639\u0647_\u0634\u0646\u0628\u0647".split("_"),weekdaysShort:"\u06cc\u06a9\u200c\u0634\u0646\u0628\u0647_\u062f\u0648\u0634\u0646\u0628\u0647_\u0633\u0647\u200c\u0634\u0646\u0628\u0647_\u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647_\u067e\u0646\u062c\u200c\u0634\u0646\u0628\u0647_\u062c\u0645\u0639\u0647_\u0634\u0646\u0628\u0647".split("_"),weekdaysMin:"\u06cc_\u062f_\u0633_\u0686_\u067e_\u062c_\u0634".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/\u0642\u0628\u0644 \u0627\u0632 \u0638\u0647\u0631|\u0628\u0639\u062f \u0627\u0632 \u0638\u0647\u0631/,isPM:function(input){return/\u0628\u0639\u062f \u0627\u0632 \u0638\u0647\u0631/.test(input)},meridiem:function(hour,minute,isLower){return hour<12?"\u0642\u0628\u0644 \u0627\u0632 \u0638\u0647\u0631":"\u0628\u0639\u062f \u0627\u0632 \u0638\u0647\u0631"},calendar:{sameDay:"[\u0627\u0645\u0631\u0648\u0632 \u0633\u0627\u0639\u062a] LT",nextDay:"[\u0641\u0631\u062f\u0627 \u0633\u0627\u0639\u062a] LT",nextWeek:"dddd [\u0633\u0627\u0639\u062a] LT",lastDay:"[\u062f\u06cc\u0631\u0648\u0632 \u0633\u0627\u0639\u062a] LT",lastWeek:"dddd [\u067e\u06cc\u0634] [\u0633\u0627\u0639\u062a] LT",sameElse:"L"},relativeTime:{future:"\u062f\u0631 %s",past:"%s \u067e\u06cc\u0634",s:"\u0686\u0646\u062f \u062b\u0627\u0646\u06cc\u0647",ss:"%d \u062b\u0627\u0646\u06cc\u0647",m:"\u06cc\u06a9 \u062f\u0642\u06cc\u0642\u0647",mm:"%d \u062f\u0642\u06cc\u0642\u0647",h:"\u06cc\u06a9 \u0633\u0627\u0639\u062a",hh:"%d \u0633\u0627\u0639\u062a",d:"\u06cc\u06a9 \u0631\u0648\u0632",dd:"%d \u0631\u0648\u0632",M:"\u06cc\u06a9 \u0645\u0627\u0647",MM:"%d \u0645\u0627\u0647",y:"\u06cc\u06a9 \u0633\u0627\u0644",yy:"%d \u0633\u0627\u0644"},preparse:function(string){return string.replace(/[\u06f0-\u06f9]/g,(function(match){return numberMap[match]})).replace(/\u060c/g,",")},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]})).replace(/,/g,"\u060c")},dayOfMonthOrdinalParse:/\d{1,2}\u0645/,ordinal:"%d\u0645",week:{dow:6,doy:12}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var numbersPast="nolla yksi kaksi kolme nelj\xe4 viisi kuusi seitsem\xe4n kahdeksan yhdeks\xe4n".split(" "),numbersFuture=["nolla","yhden","kahden","kolmen","nelj\xe4n","viiden","kuuden",numbersPast[7],numbersPast[8],numbersPast[9]];function translate(number,withoutSuffix,key,isFuture){var result="";switch(key){case"s":return isFuture?"muutaman sekunnin":"muutama sekunti";case"ss":result=isFuture?"sekunnin":"sekuntia";break;case"m":return isFuture?"minuutin":"minuutti";case"mm":result=isFuture?"minuutin":"minuuttia";break;case"h":return isFuture?"tunnin":"tunti";case"hh":result=isFuture?"tunnin":"tuntia";break;case"d":return isFuture?"p\xe4iv\xe4n":"p\xe4iv\xe4";case"dd":result=isFuture?"p\xe4iv\xe4n":"p\xe4iv\xe4\xe4";break;case"M":return isFuture?"kuukauden":"kuukausi";case"MM":result=isFuture?"kuukauden":"kuukautta";break;case"y":return isFuture?"vuoden":"vuosi";case"yy":result=isFuture?"vuoden":"vuotta"}return function(number,isFuture){return number<10?isFuture?numbersFuture[number]:numbersPast[number]:number}(number,isFuture)+" "+result}moment.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_kes\xe4kuu_hein\xe4kuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes\xe4_hein\xe4_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] HH.mm",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] HH.mm",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] HH.mm",llll:"ddd, Do MMM YYYY, [klo] HH.mm"},calendar:{sameDay:"[t\xe4n\xe4\xe4n] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s p\xe4\xe4st\xe4",past:"%s sitten",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("fil",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(number){return number},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("fo",{months:"januar_februar_mars_apr\xedl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_m\xe1nadagur_t\xfdsdagur_mikudagur_h\xf3sdagur_fr\xedggjadagur_leygardagur".split("_"),weekdaysShort:"sun_m\xe1n_t\xfds_mik_h\xf3s_fr\xed_ley".split("_"),weekdaysMin:"su_m\xe1_t\xfd_mi_h\xf3_fr_le".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D. MMMM, YYYY HH:mm"},calendar:{sameDay:"[\xcd dag kl.] LT",nextDay:"[\xcd morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[\xcd gj\xe1r kl.] LT",lastWeek:"[s\xed\xf0stu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s s\xed\xf0ani",s:"f\xe1 sekund",ss:"%d sekundir",m:"ein minuttur",mm:"%d minuttir",h:"ein t\xedmi",hh:"%d t\xedmar",d:"ein dagur",dd:"%d dagar",M:"ein m\xe1na\xf0ur",MM:"%d m\xe1na\xf0ir",y:"eitt \xe1r",yy:"%d \xe1r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsRegex=/(janv\.?|f\xe9vr\.?|mars|avr\.?|mai|juin|juil\.?|ao\xfbt|sept\.?|oct\.?|nov\.?|d\xe9c\.?|janvier|f\xe9vrier|mars|avril|mai|juin|juillet|ao\xfbt|septembre|octobre|novembre|d\xe9cembre)/i,monthsParse=[/^janv/i,/^f\xe9vr/i,/^mars/i,/^avr/i,/^mai/i,/^juin/i,/^juil/i,/^ao\xfbt/i,/^sept/i,/^oct/i,/^nov/i,/^d\xe9c/i];moment.defineLocale("fr",{months:"janvier_f\xe9vrier_mars_avril_mai_juin_juillet_ao\xfbt_septembre_octobre_novembre_d\xe9cembre".split("_"),monthsShort:"janv._f\xe9vr._mars_avr._mai_juin_juil._ao\xfbt_sept._oct._nov._d\xe9c.".split("_"),monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(janvier|f\xe9vrier|mars|avril|mai|juin|juillet|ao\xfbt|septembre|octobre|novembre|d\xe9cembre)/i,monthsShortStrictRegex:/(janv\.?|f\xe9vr\.?|mars|avr\.?|mai|juin|juil\.?|ao\xfbt|sept\.?|oct\.?|nov\.?|d\xe9c\.?)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd\u2019hui \xe0] LT",nextDay:"[Demain \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[Hier \xe0] LT",lastWeek:"dddd [dernier \xe0] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",w:"une semaine",ww:"%d semaines",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|)/,ordinal:function(number,period){switch(period){case"D":return number+(1===number?"er":"");default:case"M":case"Q":case"DDD":case"d":return number+(1===number?"er":"e");case"w":case"W":return number+(1===number?"re":"e")}},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("fr-ca",{months:"janvier_f\xe9vrier_mars_avril_mai_juin_juillet_ao\xfbt_septembre_octobre_novembre_d\xe9cembre".split("_"),monthsShort:"janv._f\xe9vr._mars_avr._mai_juin_juil._ao\xfbt_sept._oct._nov._d\xe9c.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd\u2019hui \xe0] LT",nextDay:"[Demain \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[Hier \xe0] LT",lastWeek:"dddd [dernier \xe0] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(number,period){switch(period){default:case"M":case"Q":case"D":case"DDD":case"d":return number+(1===number?"er":"e");case"w":case"W":return number+(1===number?"re":"e")}}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("fr-ch",{months:"janvier_f\xe9vrier_mars_avril_mai_juin_juillet_ao\xfbt_septembre_octobre_novembre_d\xe9cembre".split("_"),monthsShort:"janv._f\xe9vr._mars_avr._mai_juin_juil._ao\xfbt_sept._oct._nov._d\xe9c.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd\u2019hui \xe0] LT",nextDay:"[Demain \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[Hier \xe0] LT",lastWeek:"dddd [dernier \xe0] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(number,period){switch(period){default:case"M":case"Q":case"D":case"DDD":case"d":return number+(1===number?"er":"e");case"w":case"W":return number+(1===number?"re":"e")}},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsShortWithDots="jan._feb._mrt._apr._mai_jun._jul._aug._sep._okt._nov._des.".split("_"),monthsShortWithoutDots="jan_feb_mrt_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_");moment.defineLocale("fy",{months:"jannewaris_febrewaris_maart_april_maaie_juny_july_augustus_septimber_oktober_novimber_desimber".split("_"),monthsShort:function(m,format){return m?/-MMM-/.test(format)?monthsShortWithoutDots[m.month()]:monthsShortWithDots[m.month()]:monthsShortWithDots},monthsParseExact:!0,weekdays:"snein_moandei_tiisdei_woansdei_tongersdei_freed_sneon".split("_"),weekdaysShort:"si._mo._ti._wo._to._fr._so.".split("_"),weekdaysMin:"Si_Mo_Ti_Wo_To_Fr_So".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[hjoed om] LT",nextDay:"[moarn om] LT",nextWeek:"dddd [om] LT",lastDay:"[juster om] LT",lastWeek:"[\xf4fr\xfbne] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oer %s",past:"%s lyn",s:"in pear sekonden",ss:"%d sekonden",m:"ien min\xfat",mm:"%d minuten",h:"ien oere",hh:"%d oeren",d:"ien dei",dd:"%d dagen",M:"ien moanne",MM:"%d moannen",y:"ien jier",yy:"%d jierren"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(number){return number+(1===number||8===number||number>=20?"ste":"de")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ga",{months:["Ean\xe1ir","Feabhra","M\xe1rta","Aibre\xe1n","Bealtaine","Meitheamh","I\xfail","L\xfanasa","Me\xe1n F\xf3mhair","Deireadh F\xf3mhair","Samhain","Nollaig"],monthsShort:["Ean","Feabh","M\xe1rt","Aib","Beal","Meith","I\xfail","L\xfan","M.F.","D.F.","Samh","Noll"],monthsParseExact:!0,weekdays:["D\xe9 Domhnaigh","D\xe9 Luain","D\xe9 M\xe1irt","D\xe9 C\xe9adaoin","D\xe9ardaoin","D\xe9 hAoine","D\xe9 Sathairn"],weekdaysShort:["Domh","Luan","M\xe1irt","C\xe9ad","D\xe9ar","Aoine","Sath"],weekdaysMin:["Do","Lu","M\xe1","C\xe9","D\xe9","A","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Inniu ag] LT",nextDay:"[Am\xe1rach ag] LT",nextWeek:"dddd [ag] LT",lastDay:"[Inn\xe9 ag] LT",lastWeek:"dddd [seo caite] [ag] LT",sameElse:"L"},relativeTime:{future:"i %s",past:"%s \xf3 shin",s:"c\xfapla soicind",ss:"%d soicind",m:"n\xf3im\xe9ad",mm:"%d n\xf3im\xe9ad",h:"uair an chloig",hh:"%d uair an chloig",d:"l\xe1",dd:"%d l\xe1",M:"m\xed",MM:"%d m\xedonna",y:"bliain",yy:"%d bliain"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(number){return number+(1===number?"d":number%10==2?"na":"mh")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("gd",{months:["Am Faoilleach","An Gearran","Am M\xe0rt","An Giblean","An C\xe8itean","An t-\xd2gmhios","An t-Iuchar","An L\xf9nastal","An t-Sultain","An D\xe0mhair","An t-Samhain","An D\xf9bhlachd"],monthsShort:["Faoi","Gear","M\xe0rt","Gibl","C\xe8it","\xd2gmh","Iuch","L\xf9n","Sult","D\xe0mh","Samh","D\xf9bh"],monthsParseExact:!0,weekdays:["Did\xf2mhnaich","Diluain","Dim\xe0irt","Diciadain","Diardaoin","Dihaoine","Disathairne"],weekdaysShort:["Did","Dil","Dim","Dic","Dia","Dih","Dis"],weekdaysMin:["D\xf2","Lu","M\xe0","Ci","Ar","Ha","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[An-diugh aig] LT",nextDay:"[A-m\xe0ireach aig] LT",nextWeek:"dddd [aig] LT",lastDay:"[An-d\xe8 aig] LT",lastWeek:"dddd [seo chaidh] [aig] LT",sameElse:"L"},relativeTime:{future:"ann an %s",past:"bho chionn %s",s:"beagan diogan",ss:"%d diogan",m:"mionaid",mm:"%d mionaidean",h:"uair",hh:"%d uairean",d:"latha",dd:"%d latha",M:"m\xecos",MM:"%d m\xecosan",y:"bliadhna",yy:"%d bliadhna"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(number){return number+(1===number?"d":number%10==2?"na":"mh")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("gl",{months:"xaneiro_febreiro_marzo_abril_maio_xu\xf1o_xullo_agosto_setembro_outubro_novembro_decembro".split("_"),monthsShort:"xan._feb._mar._abr._mai._xu\xf1._xul._ago._set._out._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"domingo_luns_martes_m\xe9rcores_xoves_venres_s\xe1bado".split("_"),weekdaysShort:"dom._lun._mar._m\xe9r._xov._ven._s\xe1b.".split("_"),weekdaysMin:"do_lu_ma_m\xe9_xo_ve_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"\xe1s":"\xe1")+"] LT"},nextDay:function(){return"[ma\xf1\xe1 "+(1!==this.hours()?"\xe1s":"\xe1")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"\xe1s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"\xe1":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"\xe1s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(str){return 0===str.indexOf("un")?"n"+str:"en "+str},past:"hai %s",s:"uns segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un d\xeda",dd:"%d d\xedas",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={s:["\u0925\u094b\u0921\u092f\u093e \u0938\u0945\u0915\u0902\u0921\u093e\u0902\u0928\u0940","\u0925\u094b\u0921\u0947 \u0938\u0945\u0915\u0902\u0921"],ss:[number+" \u0938\u0945\u0915\u0902\u0921\u093e\u0902\u0928\u0940",number+" \u0938\u0945\u0915\u0902\u0921"],m:["\u090f\u0915\u093e \u092e\u093f\u0923\u091f\u093e\u0928","\u090f\u0915 \u092e\u093f\u0928\u0942\u091f"],mm:[number+" \u092e\u093f\u0923\u091f\u093e\u0902\u0928\u0940",number+" \u092e\u093f\u0923\u091f\u093e\u0902"],h:["\u090f\u0915\u093e \u0935\u0930\u093e\u0928","\u090f\u0915 \u0935\u0930"],hh:[number+" \u0935\u0930\u093e\u0902\u0928\u0940",number+" \u0935\u0930\u093e\u0902"],d:["\u090f\u0915\u093e \u0926\u093f\u0938\u093e\u0928","\u090f\u0915 \u0926\u0940\u0938"],dd:[number+" \u0926\u093f\u0938\u093e\u0902\u0928\u0940",number+" \u0926\u0940\u0938"],M:["\u090f\u0915\u093e \u092e\u094d\u0939\u092f\u0928\u094d\u092f\u093e\u0928","\u090f\u0915 \u092e\u094d\u0939\u092f\u0928\u094b"],MM:[number+" \u092e\u094d\u0939\u092f\u0928\u094d\u092f\u093e\u0928\u0940",number+" \u092e\u094d\u0939\u092f\u0928\u0947"],y:["\u090f\u0915\u093e \u0935\u0930\u094d\u0938\u093e\u0928","\u090f\u0915 \u0935\u0930\u094d\u0938"],yy:[number+" \u0935\u0930\u094d\u0938\u093e\u0902\u0928\u0940",number+" \u0935\u0930\u094d\u0938\u093e\u0902"]};return isFuture?format[key][0]:format[key][1]}moment.defineLocale("gom-deva",{months:{standalone:"\u091c\u093e\u0928\u0947\u0935\u093e\u0930\u0940_\u092b\u0947\u092c\u094d\u0930\u0941\u0935\u093e\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u090f\u092a\u094d\u0930\u0940\u0932_\u092e\u0947_\u091c\u0942\u0928_\u091c\u0941\u0932\u092f_\u0911\u0917\u0938\u094d\u091f_\u0938\u092a\u094d\u091f\u0947\u0902\u092c\u0930_\u0911\u0915\u094d\u091f\u094b\u092c\u0930_\u0928\u094b\u0935\u094d\u0939\u0947\u0902\u092c\u0930_\u0921\u093f\u0938\u0947\u0902\u092c\u0930".split("_"),format:"\u091c\u093e\u0928\u0947\u0935\u093e\u0930\u0940\u091a\u094d\u092f\u093e_\u092b\u0947\u092c\u094d\u0930\u0941\u0935\u093e\u0930\u0940\u091a\u094d\u092f\u093e_\u092e\u093e\u0930\u094d\u091a\u093e\u091a\u094d\u092f\u093e_\u090f\u092a\u094d\u0930\u0940\u0932\u093e\u091a\u094d\u092f\u093e_\u092e\u0947\u092f\u093e\u091a\u094d\u092f\u093e_\u091c\u0942\u0928\u093e\u091a\u094d\u092f\u093e_\u091c\u0941\u0932\u092f\u093e\u091a\u094d\u092f\u093e_\u0911\u0917\u0938\u094d\u091f\u093e\u091a\u094d\u092f\u093e_\u0938\u092a\u094d\u091f\u0947\u0902\u092c\u0930\u093e\u091a\u094d\u092f\u093e_\u0911\u0915\u094d\u091f\u094b\u092c\u0930\u093e\u091a\u094d\u092f\u093e_\u0928\u094b\u0935\u094d\u0939\u0947\u0902\u092c\u0930\u093e\u091a\u094d\u092f\u093e_\u0921\u093f\u0938\u0947\u0902\u092c\u0930\u093e\u091a\u094d\u092f\u093e".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"\u091c\u093e\u0928\u0947._\u092b\u0947\u092c\u094d\u0930\u0941._\u092e\u093e\u0930\u094d\u091a_\u090f\u092a\u094d\u0930\u0940._\u092e\u0947_\u091c\u0942\u0928_\u091c\u0941\u0932._\u0911\u0917._\u0938\u092a\u094d\u091f\u0947\u0902._\u0911\u0915\u094d\u091f\u094b._\u0928\u094b\u0935\u094d\u0939\u0947\u0902._\u0921\u093f\u0938\u0947\u0902.".split("_"),monthsParseExact:!0,weekdays:"\u0906\u092f\u0924\u093e\u0930_\u0938\u094b\u092e\u093e\u0930_\u092e\u0902\u0917\u0933\u093e\u0930_\u092c\u0941\u0927\u0935\u093e\u0930_\u092c\u093f\u0930\u0947\u0938\u094d\u0924\u093e\u0930_\u0938\u0941\u0915\u094d\u0930\u093e\u0930_\u0936\u0947\u0928\u0935\u093e\u0930".split("_"),weekdaysShort:"\u0906\u092f\u0924._\u0938\u094b\u092e._\u092e\u0902\u0917\u0933._\u092c\u0941\u0927._\u092c\u094d\u0930\u0947\u0938\u094d\u0924._\u0938\u0941\u0915\u094d\u0930._\u0936\u0947\u0928.".split("_"),weekdaysMin:"\u0906_\u0938\u094b_\u092e\u0902_\u092c\u0941_\u092c\u094d\u0930\u0947_\u0938\u0941_\u0936\u0947".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm [\u0935\u093e\u091c\u0924\u093e\u0902]",LTS:"A h:mm:ss [\u0935\u093e\u091c\u0924\u093e\u0902]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [\u0935\u093e\u091c\u0924\u093e\u0902]",LLLL:"dddd, MMMM Do, YYYY, A h:mm [\u0935\u093e\u091c\u0924\u093e\u0902]",llll:"ddd, D MMM YYYY, A h:mm [\u0935\u093e\u091c\u0924\u093e\u0902]"},calendar:{sameDay:"[\u0906\u092f\u091c] LT",nextDay:"[\u092b\u093e\u0932\u094d\u092f\u093e\u0902] LT",nextWeek:"[\u092b\u0941\u0921\u0932\u094b] dddd[,] LT",lastDay:"[\u0915\u093e\u0932] LT",lastWeek:"[\u092b\u093e\u091f\u0932\u094b] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s \u0906\u0926\u0940\u0902",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}(\u0935\u0947\u0930)/,ordinal:function(number,period){switch(period){case"D":return number+"\u0935\u0947\u0930";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return number}},week:{dow:0,doy:3},meridiemParse:/\u0930\u093e\u0924\u0940|\u0938\u0915\u093e\u0933\u0940\u0902|\u0926\u0928\u092a\u093e\u0930\u093e\u0902|\u0938\u093e\u0902\u091c\u0947/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0930\u093e\u0924\u0940"===meridiem?hour<4?hour:hour+12:"\u0938\u0915\u093e\u0933\u0940\u0902"===meridiem?hour:"\u0926\u0928\u092a\u093e\u0930\u093e\u0902"===meridiem?hour>12?hour:hour+12:"\u0938\u093e\u0902\u091c\u0947"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"\u0930\u093e\u0924\u0940":hour<12?"\u0938\u0915\u093e\u0933\u0940\u0902":hour<16?"\u0926\u0928\u092a\u093e\u0930\u093e\u0902":hour<20?"\u0938\u093e\u0902\u091c\u0947":"\u0930\u093e\u0924\u0940"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={s:["thoddea sekondamni","thodde sekond"],ss:[number+" sekondamni",number+" sekond"],m:["eka mintan","ek minut"],mm:[number+" mintamni",number+" mintam"],h:["eka voran","ek vor"],hh:[number+" voramni",number+" voram"],d:["eka disan","ek dis"],dd:[number+" disamni",number+" dis"],M:["eka mhoinean","ek mhoino"],MM:[number+" mhoineamni",number+" mhoine"],y:["eka vorsan","ek voros"],yy:[number+" vorsamni",number+" vorsam"]};return isFuture?format[key][0]:format[key][1]}moment.defineLocale("gom-latn",{months:{standalone:"Janer_Febrer_Mars_Abril_Mai_Jun_Julai_Agost_Setembr_Otubr_Novembr_Dezembr".split("_"),format:"Janerachea_Febrerachea_Marsachea_Abrilachea_Maiachea_Junachea_Julaiachea_Agostachea_Setembrachea_Otubrachea_Novembrachea_Dezembrachea".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"Jan._Feb._Mars_Abr._Mai_Jun_Jul._Ago._Set._Otu._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Aitar_Somar_Mongllar_Budhvar_Birestar_Sukrar_Son'var".split("_"),weekdaysShort:"Ait._Som._Mon._Bud._Bre._Suk._Son.".split("_"),weekdaysMin:"Ai_Sm_Mo_Bu_Br_Su_Sn".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm [vazta]",LTS:"A h:mm:ss [vazta]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [vazta]",LLLL:"dddd, MMMM Do, YYYY, A h:mm [vazta]",llll:"ddd, D MMM YYYY, A h:mm [vazta]"},calendar:{sameDay:"[Aiz] LT",nextDay:"[Faleam] LT",nextWeek:"[Fuddlo] dddd[,] LT",lastDay:"[Kal] LT",lastWeek:"[Fattlo] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s adim",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}(er)/,ordinal:function(number,period){switch(period){case"D":return number+"er";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return number}},week:{dow:0,doy:3},meridiemParse:/rati|sokallim|donparam|sanje/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"rati"===meridiem?hour<4?hour:hour+12:"sokallim"===meridiem?hour:"donparam"===meridiem?hour>12?hour:hour+12:"sanje"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"rati":hour<12?"sokallim":hour<16?"donparam":hour<20?"sanje":"rati"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0ae7",2:"\u0ae8",3:"\u0ae9",4:"\u0aea",5:"\u0aeb",6:"\u0aec",7:"\u0aed",8:"\u0aee",9:"\u0aef",0:"\u0ae6"},numberMap={"\u0ae7":"1","\u0ae8":"2","\u0ae9":"3","\u0aea":"4","\u0aeb":"5","\u0aec":"6","\u0aed":"7","\u0aee":"8","\u0aef":"9","\u0ae6":"0"};moment.defineLocale("gu",{months:"\u0a9c\u0abe\u0aa8\u0acd\u0aaf\u0ac1\u0a86\u0ab0\u0ac0_\u0aab\u0ac7\u0aac\u0acd\u0ab0\u0ac1\u0a86\u0ab0\u0ac0_\u0aae\u0abe\u0ab0\u0acd\u0a9a_\u0a8f\u0aaa\u0acd\u0ab0\u0abf\u0ab2_\u0aae\u0ac7_\u0a9c\u0ac2\u0aa8_\u0a9c\u0ac1\u0ab2\u0abe\u0a88_\u0a91\u0a97\u0ab8\u0acd\u0a9f_\u0ab8\u0aaa\u0acd\u0a9f\u0ac7\u0aae\u0acd\u0aac\u0ab0_\u0a91\u0a95\u0acd\u0a9f\u0acd\u0aac\u0ab0_\u0aa8\u0ab5\u0ac7\u0aae\u0acd\u0aac\u0ab0_\u0aa1\u0abf\u0ab8\u0ac7\u0aae\u0acd\u0aac\u0ab0".split("_"),monthsShort:"\u0a9c\u0abe\u0aa8\u0acd\u0aaf\u0ac1._\u0aab\u0ac7\u0aac\u0acd\u0ab0\u0ac1._\u0aae\u0abe\u0ab0\u0acd\u0a9a_\u0a8f\u0aaa\u0acd\u0ab0\u0abf._\u0aae\u0ac7_\u0a9c\u0ac2\u0aa8_\u0a9c\u0ac1\u0ab2\u0abe._\u0a91\u0a97._\u0ab8\u0aaa\u0acd\u0a9f\u0ac7._\u0a91\u0a95\u0acd\u0a9f\u0acd._\u0aa8\u0ab5\u0ac7._\u0aa1\u0abf\u0ab8\u0ac7.".split("_"),monthsParseExact:!0,weekdays:"\u0ab0\u0ab5\u0abf\u0ab5\u0abe\u0ab0_\u0ab8\u0acb\u0aae\u0ab5\u0abe\u0ab0_\u0aae\u0a82\u0a97\u0ab3\u0ab5\u0abe\u0ab0_\u0aac\u0ac1\u0aa7\u0acd\u0ab5\u0abe\u0ab0_\u0a97\u0ac1\u0ab0\u0ac1\u0ab5\u0abe\u0ab0_\u0ab6\u0ac1\u0a95\u0acd\u0ab0\u0ab5\u0abe\u0ab0_\u0ab6\u0aa8\u0abf\u0ab5\u0abe\u0ab0".split("_"),weekdaysShort:"\u0ab0\u0ab5\u0abf_\u0ab8\u0acb\u0aae_\u0aae\u0a82\u0a97\u0ab3_\u0aac\u0ac1\u0aa7\u0acd_\u0a97\u0ac1\u0ab0\u0ac1_\u0ab6\u0ac1\u0a95\u0acd\u0ab0_\u0ab6\u0aa8\u0abf".split("_"),weekdaysMin:"\u0ab0_\u0ab8\u0acb_\u0aae\u0a82_\u0aac\u0ac1_\u0a97\u0ac1_\u0ab6\u0ac1_\u0ab6".split("_"),longDateFormat:{LT:"A h:mm \u0ab5\u0abe\u0a97\u0acd\u0aaf\u0ac7",LTS:"A h:mm:ss \u0ab5\u0abe\u0a97\u0acd\u0aaf\u0ac7",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u0ab5\u0abe\u0a97\u0acd\u0aaf\u0ac7",LLLL:"dddd, D MMMM YYYY, A h:mm \u0ab5\u0abe\u0a97\u0acd\u0aaf\u0ac7"},calendar:{sameDay:"[\u0a86\u0a9c] LT",nextDay:"[\u0a95\u0abe\u0ab2\u0ac7] LT",nextWeek:"dddd, LT",lastDay:"[\u0a97\u0a87\u0a95\u0abe\u0ab2\u0ac7] LT",lastWeek:"[\u0aaa\u0abe\u0a9b\u0ab2\u0abe] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0aae\u0abe",past:"%s \u0aaa\u0ab9\u0ac7\u0ab2\u0abe",s:"\u0a85\u0aae\u0ac1\u0a95 \u0aaa\u0ab3\u0acb",ss:"%d \u0ab8\u0ac7\u0a95\u0a82\u0aa1",m:"\u0a8f\u0a95 \u0aae\u0abf\u0aa8\u0abf\u0a9f",mm:"%d \u0aae\u0abf\u0aa8\u0abf\u0a9f",h:"\u0a8f\u0a95 \u0a95\u0ab2\u0abe\u0a95",hh:"%d \u0a95\u0ab2\u0abe\u0a95",d:"\u0a8f\u0a95 \u0aa6\u0abf\u0ab5\u0ab8",dd:"%d \u0aa6\u0abf\u0ab5\u0ab8",M:"\u0a8f\u0a95 \u0aae\u0ab9\u0abf\u0aa8\u0acb",MM:"%d \u0aae\u0ab9\u0abf\u0aa8\u0acb",y:"\u0a8f\u0a95 \u0ab5\u0ab0\u0acd\u0ab7",yy:"%d \u0ab5\u0ab0\u0acd\u0ab7"},preparse:function(string){return string.replace(/[\u0ae7\u0ae8\u0ae9\u0aea\u0aeb\u0aec\u0aed\u0aee\u0aef\u0ae6]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u0ab0\u0abe\u0aa4|\u0aac\u0aaa\u0acb\u0ab0|\u0ab8\u0ab5\u0abe\u0ab0|\u0ab8\u0abe\u0a82\u0a9c/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0ab0\u0abe\u0aa4"===meridiem?hour<4?hour:hour+12:"\u0ab8\u0ab5\u0abe\u0ab0"===meridiem?hour:"\u0aac\u0aaa\u0acb\u0ab0"===meridiem?hour>=10?hour:hour+12:"\u0ab8\u0abe\u0a82\u0a9c"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"\u0ab0\u0abe\u0aa4":hour<10?"\u0ab8\u0ab5\u0abe\u0ab0":hour<17?"\u0aac\u0aaa\u0acb\u0ab0":hour<20?"\u0ab8\u0abe\u0a82\u0a9c":"\u0ab0\u0abe\u0aa4"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("he",{months:"\u05d9\u05e0\u05d5\u05d0\u05e8_\u05e4\u05d1\u05e8\u05d5\u05d0\u05e8_\u05de\u05e8\u05e5_\u05d0\u05e4\u05e8\u05d9\u05dc_\u05de\u05d0\u05d9_\u05d9\u05d5\u05e0\u05d9_\u05d9\u05d5\u05dc\u05d9_\u05d0\u05d5\u05d2\u05d5\u05e1\u05d8_\u05e1\u05e4\u05d8\u05de\u05d1\u05e8_\u05d0\u05d5\u05e7\u05d8\u05d5\u05d1\u05e8_\u05e0\u05d5\u05d1\u05de\u05d1\u05e8_\u05d3\u05e6\u05de\u05d1\u05e8".split("_"),monthsShort:"\u05d9\u05e0\u05d5\u05f3_\u05e4\u05d1\u05e8\u05f3_\u05de\u05e8\u05e5_\u05d0\u05e4\u05e8\u05f3_\u05de\u05d0\u05d9_\u05d9\u05d5\u05e0\u05d9_\u05d9\u05d5\u05dc\u05d9_\u05d0\u05d5\u05d2\u05f3_\u05e1\u05e4\u05d8\u05f3_\u05d0\u05d5\u05e7\u05f3_\u05e0\u05d5\u05d1\u05f3_\u05d3\u05e6\u05de\u05f3".split("_"),weekdays:"\u05e8\u05d0\u05e9\u05d5\u05df_\u05e9\u05e0\u05d9_\u05e9\u05dc\u05d9\u05e9\u05d9_\u05e8\u05d1\u05d9\u05e2\u05d9_\u05d7\u05de\u05d9\u05e9\u05d9_\u05e9\u05d9\u05e9\u05d9_\u05e9\u05d1\u05ea".split("_"),weekdaysShort:"\u05d0\u05f3_\u05d1\u05f3_\u05d2\u05f3_\u05d3\u05f3_\u05d4\u05f3_\u05d5\u05f3_\u05e9\u05f3".split("_"),weekdaysMin:"\u05d0_\u05d1_\u05d2_\u05d3_\u05d4_\u05d5_\u05e9".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [\u05d1]MMMM YYYY",LLL:"D [\u05d1]MMMM YYYY HH:mm",LLLL:"dddd, D [\u05d1]MMMM YYYY HH:mm",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[\u05d4\u05d9\u05d5\u05dd \u05d1\u05be]LT",nextDay:"[\u05de\u05d7\u05e8 \u05d1\u05be]LT",nextWeek:"dddd [\u05d1\u05e9\u05e2\u05d4] LT",lastDay:"[\u05d0\u05ea\u05de\u05d5\u05dc \u05d1\u05be]LT",lastWeek:"[\u05d1\u05d9\u05d5\u05dd] dddd [\u05d4\u05d0\u05d7\u05e8\u05d5\u05df \u05d1\u05e9\u05e2\u05d4] LT",sameElse:"L"},relativeTime:{future:"\u05d1\u05e2\u05d5\u05d3 %s",past:"\u05dc\u05e4\u05e0\u05d9 %s",s:"\u05de\u05e1\u05e4\u05e8 \u05e9\u05e0\u05d9\u05d5\u05ea",ss:"%d \u05e9\u05e0\u05d9\u05d5\u05ea",m:"\u05d3\u05e7\u05d4",mm:"%d \u05d3\u05e7\u05d5\u05ea",h:"\u05e9\u05e2\u05d4",hh:function(number){return 2===number?"\u05e9\u05e2\u05ea\u05d9\u05d9\u05dd":number+" \u05e9\u05e2\u05d5\u05ea"},d:"\u05d9\u05d5\u05dd",dd:function(number){return 2===number?"\u05d9\u05d5\u05de\u05d9\u05d9\u05dd":number+" \u05d9\u05de\u05d9\u05dd"},M:"\u05d7\u05d5\u05d3\u05e9",MM:function(number){return 2===number?"\u05d7\u05d5\u05d3\u05e9\u05d9\u05d9\u05dd":number+" \u05d7\u05d5\u05d3\u05e9\u05d9\u05dd"},y:"\u05e9\u05e0\u05d4",yy:function(number){return 2===number?"\u05e9\u05e0\u05ea\u05d9\u05d9\u05dd":number%10==0&&10!==number?number+" \u05e9\u05e0\u05d4":number+" \u05e9\u05e0\u05d9\u05dd"}},meridiemParse:/\u05d0\u05d7\u05d4"\u05e6|\u05dc\u05e4\u05e0\u05d4"\u05e6|\u05d0\u05d7\u05e8\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd|\u05dc\u05e4\u05e0\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd|\u05dc\u05e4\u05e0\u05d5\u05ea \u05d1\u05d5\u05e7\u05e8|\u05d1\u05d1\u05d5\u05e7\u05e8|\u05d1\u05e2\u05e8\u05d1/i,isPM:function(input){return/^(\u05d0\u05d7\u05d4"\u05e6|\u05d0\u05d7\u05e8\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd|\u05d1\u05e2\u05e8\u05d1)$/.test(input)},meridiem:function(hour,minute,isLower){return hour<5?"\u05dc\u05e4\u05e0\u05d5\u05ea \u05d1\u05d5\u05e7\u05e8":hour<10?"\u05d1\u05d1\u05d5\u05e7\u05e8":hour<12?isLower?'\u05dc\u05e4\u05e0\u05d4"\u05e6':"\u05dc\u05e4\u05e0\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd":hour<18?isLower?'\u05d0\u05d7\u05d4"\u05e6':"\u05d0\u05d7\u05e8\u05d9 \u05d4\u05e6\u05d4\u05e8\u05d9\u05d9\u05dd":"\u05d1\u05e2\u05e8\u05d1"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0967",2:"\u0968",3:"\u0969",4:"\u096a",5:"\u096b",6:"\u096c",7:"\u096d",8:"\u096e",9:"\u096f",0:"\u0966"},numberMap={"\u0967":"1","\u0968":"2","\u0969":"3","\u096a":"4","\u096b":"5","\u096c":"6","\u096d":"7","\u096e":"8","\u096f":"9","\u0966":"0"},monthsParse=[/^\u091c\u0928/i,/^\u092b\u093c\u0930|\u092b\u0930/i,/^\u092e\u093e\u0930\u094d\u091a/i,/^\u0905\u092a\u094d\u0930\u0948/i,/^\u092e\u0908/i,/^\u091c\u0942\u0928/i,/^\u091c\u0941\u0932/i,/^\u0905\u0917/i,/^\u0938\u093f\u0924\u0902|\u0938\u093f\u0924/i,/^\u0905\u0915\u094d\u091f\u0942/i,/^\u0928\u0935|\u0928\u0935\u0902/i,/^\u0926\u093f\u0938\u0902|\u0926\u093f\u0938/i];moment.defineLocale("hi",{months:{format:"\u091c\u0928\u0935\u0930\u0940_\u092b\u093c\u0930\u0935\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u0948\u0932_\u092e\u0908_\u091c\u0942\u0928_\u091c\u0941\u0932\u093e\u0908_\u0905\u0917\u0938\u094d\u0924_\u0938\u093f\u0924\u092e\u094d\u092c\u0930_\u0905\u0915\u094d\u091f\u0942\u092c\u0930_\u0928\u0935\u092e\u094d\u092c\u0930_\u0926\u093f\u0938\u092e\u094d\u092c\u0930".split("_"),standalone:"\u091c\u0928\u0935\u0930\u0940_\u092b\u0930\u0935\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u0948\u0932_\u092e\u0908_\u091c\u0942\u0928_\u091c\u0941\u0932\u093e\u0908_\u0905\u0917\u0938\u094d\u0924_\u0938\u093f\u0924\u0902\u092c\u0930_\u0905\u0915\u094d\u091f\u0942\u092c\u0930_\u0928\u0935\u0902\u092c\u0930_\u0926\u093f\u0938\u0902\u092c\u0930".split("_")},monthsShort:"\u091c\u0928._\u092b\u093c\u0930._\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u0948._\u092e\u0908_\u091c\u0942\u0928_\u091c\u0941\u0932._\u0905\u0917._\u0938\u093f\u0924._\u0905\u0915\u094d\u091f\u0942._\u0928\u0935._\u0926\u093f\u0938.".split("_"),weekdays:"\u0930\u0935\u093f\u0935\u093e\u0930_\u0938\u094b\u092e\u0935\u093e\u0930_\u092e\u0902\u0917\u0932\u0935\u093e\u0930_\u092c\u0941\u0927\u0935\u093e\u0930_\u0917\u0941\u0930\u0942\u0935\u093e\u0930_\u0936\u0941\u0915\u094d\u0930\u0935\u093e\u0930_\u0936\u0928\u093f\u0935\u093e\u0930".split("_"),weekdaysShort:"\u0930\u0935\u093f_\u0938\u094b\u092e_\u092e\u0902\u0917\u0932_\u092c\u0941\u0927_\u0917\u0941\u0930\u0942_\u0936\u0941\u0915\u094d\u0930_\u0936\u0928\u093f".split("_"),weekdaysMin:"\u0930_\u0938\u094b_\u092e\u0902_\u092c\u0941_\u0917\u0941_\u0936\u0941_\u0936".split("_"),longDateFormat:{LT:"A h:mm \u092c\u091c\u0947",LTS:"A h:mm:ss \u092c\u091c\u0947",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u092c\u091c\u0947",LLLL:"dddd, D MMMM YYYY, A h:mm \u092c\u091c\u0947"},monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:[/^\u091c\u0928/i,/^\u092b\u093c\u0930/i,/^\u092e\u093e\u0930\u094d\u091a/i,/^\u0905\u092a\u094d\u0930\u0948/i,/^\u092e\u0908/i,/^\u091c\u0942\u0928/i,/^\u091c\u0941\u0932/i,/^\u0905\u0917/i,/^\u0938\u093f\u0924/i,/^\u0905\u0915\u094d\u091f\u0942/i,/^\u0928\u0935/i,/^\u0926\u093f\u0938/i],monthsRegex:/^(\u091c\u0928\u0935\u0930\u0940|\u091c\u0928\.?|\u092b\u093c\u0930\u0935\u0930\u0940|\u092b\u0930\u0935\u0930\u0940|\u092b\u093c\u0930\.?|\u092e\u093e\u0930\u094d\u091a?|\u0905\u092a\u094d\u0930\u0948\u0932|\u0905\u092a\u094d\u0930\u0948\.?|\u092e\u0908?|\u091c\u0942\u0928?|\u091c\u0941\u0932\u093e\u0908|\u091c\u0941\u0932\.?|\u0905\u0917\u0938\u094d\u0924|\u0905\u0917\.?|\u0938\u093f\u0924\u092e\u094d\u092c\u0930|\u0938\u093f\u0924\u0902\u092c\u0930|\u0938\u093f\u0924\.?|\u0905\u0915\u094d\u091f\u0942\u092c\u0930|\u0905\u0915\u094d\u091f\u0942\.?|\u0928\u0935\u092e\u094d\u092c\u0930|\u0928\u0935\u0902\u092c\u0930|\u0928\u0935\.?|\u0926\u093f\u0938\u092e\u094d\u092c\u0930|\u0926\u093f\u0938\u0902\u092c\u0930|\u0926\u093f\u0938\.?)/i,monthsShortRegex:/^(\u091c\u0928\u0935\u0930\u0940|\u091c\u0928\.?|\u092b\u093c\u0930\u0935\u0930\u0940|\u092b\u0930\u0935\u0930\u0940|\u092b\u093c\u0930\.?|\u092e\u093e\u0930\u094d\u091a?|\u0905\u092a\u094d\u0930\u0948\u0932|\u0905\u092a\u094d\u0930\u0948\.?|\u092e\u0908?|\u091c\u0942\u0928?|\u091c\u0941\u0932\u093e\u0908|\u091c\u0941\u0932\.?|\u0905\u0917\u0938\u094d\u0924|\u0905\u0917\.?|\u0938\u093f\u0924\u092e\u094d\u092c\u0930|\u0938\u093f\u0924\u0902\u092c\u0930|\u0938\u093f\u0924\.?|\u0905\u0915\u094d\u091f\u0942\u092c\u0930|\u0905\u0915\u094d\u091f\u0942\.?|\u0928\u0935\u092e\u094d\u092c\u0930|\u0928\u0935\u0902\u092c\u0930|\u0928\u0935\.?|\u0926\u093f\u0938\u092e\u094d\u092c\u0930|\u0926\u093f\u0938\u0902\u092c\u0930|\u0926\u093f\u0938\.?)/i,monthsStrictRegex:/^(\u091c\u0928\u0935\u0930\u0940?|\u092b\u093c\u0930\u0935\u0930\u0940|\u092b\u0930\u0935\u0930\u0940?|\u092e\u093e\u0930\u094d\u091a?|\u0905\u092a\u094d\u0930\u0948\u0932?|\u092e\u0908?|\u091c\u0942\u0928?|\u091c\u0941\u0932\u093e\u0908?|\u0905\u0917\u0938\u094d\u0924?|\u0938\u093f\u0924\u092e\u094d\u092c\u0930|\u0938\u093f\u0924\u0902\u092c\u0930|\u0938\u093f\u0924?\.?|\u0905\u0915\u094d\u091f\u0942\u092c\u0930|\u0905\u0915\u094d\u091f\u0942\.?|\u0928\u0935\u092e\u094d\u092c\u0930|\u0928\u0935\u0902\u092c\u0930?|\u0926\u093f\u0938\u092e\u094d\u092c\u0930|\u0926\u093f\u0938\u0902\u092c\u0930?)/i,monthsShortStrictRegex:/^(\u091c\u0928\.?|\u092b\u093c\u0930\.?|\u092e\u093e\u0930\u094d\u091a?|\u0905\u092a\u094d\u0930\u0948\.?|\u092e\u0908?|\u091c\u0942\u0928?|\u091c\u0941\u0932\.?|\u0905\u0917\.?|\u0938\u093f\u0924\.?|\u0905\u0915\u094d\u091f\u0942\.?|\u0928\u0935\.?|\u0926\u093f\u0938\.?)/i,calendar:{sameDay:"[\u0906\u091c] LT",nextDay:"[\u0915\u0932] LT",nextWeek:"dddd, LT",lastDay:"[\u0915\u0932] LT",lastWeek:"[\u092a\u093f\u091b\u0932\u0947] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u092e\u0947\u0902",past:"%s \u092a\u0939\u0932\u0947",s:"\u0915\u0941\u091b \u0939\u0940 \u0915\u094d\u0937\u0923",ss:"%d \u0938\u0947\u0915\u0902\u0921",m:"\u090f\u0915 \u092e\u093f\u0928\u091f",mm:"%d \u092e\u093f\u0928\u091f",h:"\u090f\u0915 \u0918\u0902\u091f\u093e",hh:"%d \u0918\u0902\u091f\u0947",d:"\u090f\u0915 \u0926\u093f\u0928",dd:"%d \u0926\u093f\u0928",M:"\u090f\u0915 \u092e\u0939\u0940\u0928\u0947",MM:"%d \u092e\u0939\u0940\u0928\u0947",y:"\u090f\u0915 \u0935\u0930\u094d\u0937",yy:"%d \u0935\u0930\u094d\u0937"},preparse:function(string){return string.replace(/[\u0967\u0968\u0969\u096a\u096b\u096c\u096d\u096e\u096f\u0966]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u0930\u093e\u0924|\u0938\u0941\u092c\u0939|\u0926\u094b\u092a\u0939\u0930|\u0936\u093e\u092e/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0930\u093e\u0924"===meridiem?hour<4?hour:hour+12:"\u0938\u0941\u092c\u0939"===meridiem?hour:"\u0926\u094b\u092a\u0939\u0930"===meridiem?hour>=10?hour:hour+12:"\u0936\u093e\u092e"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"\u0930\u093e\u0924":hour<10?"\u0938\u0941\u092c\u0939":hour<17?"\u0926\u094b\u092a\u0939\u0930":hour<20?"\u0936\u093e\u092e":"\u0930\u093e\u0924"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function translate(number,withoutSuffix,key){var result=number+" ";switch(key){case"ss":return result+(1===number?"sekunda":2===number||3===number||4===number?"sekunde":"sekundi");case"m":return withoutSuffix?"jedna minuta":"jedne minute";case"mm":return result+(1===number?"minuta":2===number||3===number||4===number?"minute":"minuta");case"h":return withoutSuffix?"jedan sat":"jednog sata";case"hh":return result+(1===number?"sat":2===number||3===number||4===number?"sata":"sati");case"dd":return result+(1===number?"dan":"dana");case"MM":return result+(1===number?"mjesec":2===number||3===number||4===number?"mjeseca":"mjeseci");case"yy":return result+(1===number?"godina":2===number||3===number||4===number?"godine":"godina")}}moment.defineLocale("hr",{months:{format:"sije\u010dnja_velja\u010de_o\u017eujka_travnja_svibnja_lipnja_srpnja_kolovoza_rujna_listopada_studenoga_prosinca".split("_"),standalone:"sije\u010danj_velja\u010da_o\u017eujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_")},monthsShort:"sij._velj._o\u017eu._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_\u010detvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._\u010det._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_\u010de_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"Do MMMM YYYY",LLL:"Do MMMM YYYY H:mm",LLLL:"dddd, Do MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[ju\u010der u] LT",lastWeek:function(){switch(this.day()){case 0:return"[pro\u0161lu] [nedjelju] [u] LT";case 3:return"[pro\u0161lu] [srijedu] [u] LT";case 6:return"[pro\u0161le] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[pro\u0161li] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"dan",dd:translate,M:"mjesec",MM:translate,y:"godinu",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var weekEndings="vas\xe1rnap h\xe9tf\u0151n kedden szerd\xe1n cs\xfct\xf6rt\xf6k\xf6n p\xe9nteken szombaton".split(" ");function translate(number,withoutSuffix,key,isFuture){var num=number;switch(key){case"s":return isFuture||withoutSuffix?"n\xe9h\xe1ny m\xe1sodperc":"n\xe9h\xe1ny m\xe1sodperce";case"ss":return num+(isFuture||withoutSuffix)?" m\xe1sodperc":" m\xe1sodperce";case"m":return"egy"+(isFuture||withoutSuffix?" perc":" perce");case"mm":return num+(isFuture||withoutSuffix?" perc":" perce");case"h":return"egy"+(isFuture||withoutSuffix?" \xf3ra":" \xf3r\xe1ja");case"hh":return num+(isFuture||withoutSuffix?" \xf3ra":" \xf3r\xe1ja");case"d":return"egy"+(isFuture||withoutSuffix?" nap":" napja");case"dd":return num+(isFuture||withoutSuffix?" nap":" napja");case"M":return"egy"+(isFuture||withoutSuffix?" h\xf3nap":" h\xf3napja");case"MM":return num+(isFuture||withoutSuffix?" h\xf3nap":" h\xf3napja");case"y":return"egy"+(isFuture||withoutSuffix?" \xe9v":" \xe9ve");case"yy":return num+(isFuture||withoutSuffix?" \xe9v":" \xe9ve")}return""}function week(isFuture){return(isFuture?"":"[m\xfalt] ")+"["+weekEndings[this.day()]+"] LT[-kor]"}moment.defineLocale("hu",{months:"janu\xe1r_febru\xe1r_m\xe1rcius_\xe1prilis_m\xe1jus_j\xfanius_j\xfalius_augusztus_szeptember_okt\xf3ber_november_december".split("_"),monthsShort:"jan._feb._m\xe1rc._\xe1pr._m\xe1j._j\xfan._j\xfal._aug._szept._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"vas\xe1rnap_h\xe9tf\u0151_kedd_szerda_cs\xfct\xf6rt\xf6k_p\xe9ntek_szombat".split("_"),weekdaysShort:"vas_h\xe9t_kedd_sze_cs\xfct_p\xe9n_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D. H:mm",LLLL:"YYYY. MMMM D., dddd H:mm"},meridiemParse:/de|du/i,isPM:function(input){return"u"===input.charAt(1).toLowerCase()},meridiem:function(hours,minutes,isLower){return hours<12?!0===isLower?"de":"DE":!0===isLower?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return week.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return week.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s m\xfalva",past:"%s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("hy-am",{months:{format:"\u0570\u0578\u0582\u0576\u057e\u0561\u0580\u056b_\u0583\u0565\u057f\u0580\u057e\u0561\u0580\u056b_\u0574\u0561\u0580\u057f\u056b_\u0561\u057a\u0580\u056b\u056c\u056b_\u0574\u0561\u0575\u056b\u057d\u056b_\u0570\u0578\u0582\u0576\u056b\u057d\u056b_\u0570\u0578\u0582\u056c\u056b\u057d\u056b_\u0585\u0563\u0578\u057d\u057f\u0578\u057d\u056b_\u057d\u0565\u057a\u057f\u0565\u0574\u0562\u0565\u0580\u056b_\u0570\u0578\u056f\u057f\u0565\u0574\u0562\u0565\u0580\u056b_\u0576\u0578\u0575\u0565\u0574\u0562\u0565\u0580\u056b_\u0564\u0565\u056f\u057f\u0565\u0574\u0562\u0565\u0580\u056b".split("_"),standalone:"\u0570\u0578\u0582\u0576\u057e\u0561\u0580_\u0583\u0565\u057f\u0580\u057e\u0561\u0580_\u0574\u0561\u0580\u057f_\u0561\u057a\u0580\u056b\u056c_\u0574\u0561\u0575\u056b\u057d_\u0570\u0578\u0582\u0576\u056b\u057d_\u0570\u0578\u0582\u056c\u056b\u057d_\u0585\u0563\u0578\u057d\u057f\u0578\u057d_\u057d\u0565\u057a\u057f\u0565\u0574\u0562\u0565\u0580_\u0570\u0578\u056f\u057f\u0565\u0574\u0562\u0565\u0580_\u0576\u0578\u0575\u0565\u0574\u0562\u0565\u0580_\u0564\u0565\u056f\u057f\u0565\u0574\u0562\u0565\u0580".split("_")},monthsShort:"\u0570\u0576\u057e_\u0583\u057f\u0580_\u0574\u0580\u057f_\u0561\u057a\u0580_\u0574\u0575\u057d_\u0570\u0576\u057d_\u0570\u056c\u057d_\u0585\u0563\u057d_\u057d\u057a\u057f_\u0570\u056f\u057f_\u0576\u0574\u0562_\u0564\u056f\u057f".split("_"),weekdays:"\u056f\u056b\u0580\u0561\u056f\u056b_\u0565\u0580\u056f\u0578\u0582\u0577\u0561\u0562\u0569\u056b_\u0565\u0580\u0565\u0584\u0577\u0561\u0562\u0569\u056b_\u0579\u0578\u0580\u0565\u0584\u0577\u0561\u0562\u0569\u056b_\u0570\u056b\u0576\u0563\u0577\u0561\u0562\u0569\u056b_\u0578\u0582\u0580\u0562\u0561\u0569_\u0577\u0561\u0562\u0561\u0569".split("_"),weekdaysShort:"\u056f\u0580\u056f_\u0565\u0580\u056f_\u0565\u0580\u0584_\u0579\u0580\u0584_\u0570\u0576\u0563_\u0578\u0582\u0580\u0562_\u0577\u0562\u0569".split("_"),weekdaysMin:"\u056f\u0580\u056f_\u0565\u0580\u056f_\u0565\u0580\u0584_\u0579\u0580\u0584_\u0570\u0576\u0563_\u0578\u0582\u0580\u0562_\u0577\u0562\u0569".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY \u0569.",LLL:"D MMMM YYYY \u0569., HH:mm",LLLL:"dddd, D MMMM YYYY \u0569., HH:mm"},calendar:{sameDay:"[\u0561\u0575\u057d\u0585\u0580] LT",nextDay:"[\u057e\u0561\u0572\u0568] LT",lastDay:"[\u0565\u0580\u0565\u056f] LT",nextWeek:function(){return"dddd [\u0585\u0580\u0568 \u056a\u0561\u0574\u0568] LT"},lastWeek:function(){return"[\u0561\u0576\u0581\u0561\u056e] dddd [\u0585\u0580\u0568 \u056a\u0561\u0574\u0568] LT"},sameElse:"L"},relativeTime:{future:"%s \u0570\u0565\u057f\u0578",past:"%s \u0561\u057c\u0561\u057b",s:"\u0574\u056b \u0584\u0561\u0576\u056b \u057e\u0561\u0575\u0580\u056f\u0575\u0561\u0576",ss:"%d \u057e\u0561\u0575\u0580\u056f\u0575\u0561\u0576",m:"\u0580\u0578\u057a\u0565",mm:"%d \u0580\u0578\u057a\u0565",h:"\u056a\u0561\u0574",hh:"%d \u056a\u0561\u0574",d:"\u0585\u0580",dd:"%d \u0585\u0580",M:"\u0561\u0574\u056b\u057d",MM:"%d \u0561\u0574\u056b\u057d",y:"\u057f\u0561\u0580\u056b",yy:"%d \u057f\u0561\u0580\u056b"},meridiemParse:/\u0563\u056b\u0577\u0565\u0580\u057e\u0561|\u0561\u057c\u0561\u057e\u0578\u057f\u057e\u0561|\u0581\u0565\u0580\u0565\u056f\u057e\u0561|\u0565\u0580\u0565\u056f\u0578\u0575\u0561\u0576/,isPM:function(input){return/^(\u0581\u0565\u0580\u0565\u056f\u057e\u0561|\u0565\u0580\u0565\u056f\u0578\u0575\u0561\u0576)$/.test(input)},meridiem:function(hour){return hour<4?"\u0563\u056b\u0577\u0565\u0580\u057e\u0561":hour<12?"\u0561\u057c\u0561\u057e\u0578\u057f\u057e\u0561":hour<17?"\u0581\u0565\u0580\u0565\u056f\u057e\u0561":"\u0565\u0580\u0565\u056f\u0578\u0575\u0561\u0576"},dayOfMonthOrdinalParse:/\d{1,2}|\d{1,2}-(\u056b\u0576|\u0580\u0564)/,ordinal:function(number,period){switch(period){case"DDD":case"w":case"W":case"DDDo":return 1===number?number+"-\u056b\u0576":number+"-\u0580\u0564";default:return number}},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"pagi"===meridiem?hour:"siang"===meridiem?hour>=11?hour:hour+12:"sore"===meridiem||"malam"===meridiem?hour+12:void 0},meridiem:function(hours,minutes,isLower){return hours<11?"pagi":hours<15?"siang":hours<19?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",ss:"%d detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function plural(n){return n%100==11||n%10!=1}function translate(number,withoutSuffix,key,isFuture){var result=number+" ";switch(key){case"s":return withoutSuffix||isFuture?"nokkrar sek\xfandur":"nokkrum sek\xfandum";case"ss":return plural(number)?result+(withoutSuffix||isFuture?"sek\xfandur":"sek\xfandum"):result+"sek\xfanda";case"m":return withoutSuffix?"m\xedn\xfata":"m\xedn\xfatu";case"mm":return plural(number)?result+(withoutSuffix||isFuture?"m\xedn\xfatur":"m\xedn\xfatum"):withoutSuffix?result+"m\xedn\xfata":result+"m\xedn\xfatu";case"hh":return plural(number)?result+(withoutSuffix||isFuture?"klukkustundir":"klukkustundum"):result+"klukkustund";case"d":return withoutSuffix?"dagur":isFuture?"dag":"degi";case"dd":return plural(number)?withoutSuffix?result+"dagar":result+(isFuture?"daga":"d\xf6gum"):withoutSuffix?result+"dagur":result+(isFuture?"dag":"degi");case"M":return withoutSuffix?"m\xe1nu\xf0ur":isFuture?"m\xe1nu\xf0":"m\xe1nu\xf0i";case"MM":return plural(number)?withoutSuffix?result+"m\xe1nu\xf0ir":result+(isFuture?"m\xe1nu\xf0i":"m\xe1nu\xf0um"):withoutSuffix?result+"m\xe1nu\xf0ur":result+(isFuture?"m\xe1nu\xf0":"m\xe1nu\xf0i");case"y":return withoutSuffix||isFuture?"\xe1r":"\xe1ri";case"yy":return plural(number)?result+(withoutSuffix||isFuture?"\xe1r":"\xe1rum"):result+(withoutSuffix||isFuture?"\xe1r":"\xe1ri")}}moment.defineLocale("is",{months:"jan\xfaar_febr\xfaar_mars_apr\xedl_ma\xed_j\xfan\xed_j\xfal\xed_\xe1g\xfast_september_okt\xf3ber_n\xf3vember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma\xed_j\xfan_j\xfal_\xe1g\xfa_sep_okt_n\xf3v_des".split("_"),weekdays:"sunnudagur_m\xe1nudagur_\xferi\xf0judagur_mi\xf0vikudagur_fimmtudagur_f\xf6studagur_laugardagur".split("_"),weekdaysShort:"sun_m\xe1n_\xferi_mi\xf0_fim_f\xf6s_lau".split("_"),weekdaysMin:"Su_M\xe1_\xder_Mi_Fi_F\xf6_La".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd, D. MMMM YYYY [kl.] H:mm"},calendar:{sameDay:"[\xed dag kl.] LT",nextDay:"[\xe1 morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[\xed g\xe6r kl.] LT",lastWeek:"[s\xed\xf0asta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s s\xed\xf0an",s:translate,ss:translate,m:translate,mm:translate,h:"klukkustund",hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned\xec_marted\xec_mercoled\xec_gioved\xec_venerd\xec_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:function(){return"[Oggi a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextDay:function(){return"[Domani a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextWeek:function(){return"dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastDay:function(){return"[Ieri a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastWeek:function(){switch(this.day()){case 0:return"[La scorsa] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT";default:return"[Lo scorso] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"}},sameElse:"L"},relativeTime:{future:"tra %s",past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",w:"una settimana",ww:"%d settimane",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("it-ch",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned\xec_marted\xec_mercoled\xec_gioved\xec_venerd\xec_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(s){return(/^[0-9].+$/.test(s)?"tra":"in")+" "+s},past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ja",{eras:[{since:"2019-05-01",offset:1,name:"\u4ee4\u548c",narrow:"\u32ff",abbr:"R"},{since:"1989-01-08",until:"2019-04-30",offset:1,name:"\u5e73\u6210",narrow:"\u337b",abbr:"H"},{since:"1926-12-25",until:"1989-01-07",offset:1,name:"\u662d\u548c",narrow:"\u337c",abbr:"S"},{since:"1912-07-30",until:"1926-12-24",offset:1,name:"\u5927\u6b63",narrow:"\u337d",abbr:"T"},{since:"1873-01-01",until:"1912-07-29",offset:6,name:"\u660e\u6cbb",narrow:"\u337e",abbr:"M"},{since:"0001-01-01",until:"1873-12-31",offset:1,name:"\u897f\u66a6",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"\u7d00\u5143\u524d",narrow:"BC",abbr:"BC"}],eraYearOrdinalRegex:/(\u5143|\d+)\u5e74/,eraYearOrdinalParse:function(input,match){return"\u5143"===match[1]?1:parseInt(match[1]||input,10)},months:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u65e5\u66dc\u65e5_\u6708\u66dc\u65e5_\u706b\u66dc\u65e5_\u6c34\u66dc\u65e5_\u6728\u66dc\u65e5_\u91d1\u66dc\u65e5_\u571f\u66dc\u65e5".split("_"),weekdaysShort:"\u65e5_\u6708_\u706b_\u6c34_\u6728_\u91d1_\u571f".split("_"),weekdaysMin:"\u65e5_\u6708_\u706b_\u6c34_\u6728_\u91d1_\u571f".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5 HH:mm",LLLL:"YYYY\u5e74M\u6708D\u65e5 dddd HH:mm",l:"YYYY/MM/DD",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5(ddd) HH:mm"},meridiemParse:/\u5348\u524d|\u5348\u5f8c/i,isPM:function(input){return"\u5348\u5f8c"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u5348\u524d":"\u5348\u5f8c"},calendar:{sameDay:"[\u4eca\u65e5] LT",nextDay:"[\u660e\u65e5] LT",nextWeek:function(now){return now.week()!==this.week()?"[\u6765\u9031]dddd LT":"dddd LT"},lastDay:"[\u6628\u65e5] LT",lastWeek:function(now){return this.week()!==now.week()?"[\u5148\u9031]dddd LT":"dddd LT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}\u65e5/,ordinal:function(number,period){switch(period){case"y":return 1===number?"\u5143\u5e74":number+"\u5e74";case"d":case"D":case"DDD":return number+"\u65e5";default:return number}},relativeTime:{future:"%s\u5f8c",past:"%s\u524d",s:"\u6570\u79d2",ss:"%d\u79d2",m:"1\u5206",mm:"%d\u5206",h:"1\u6642\u9593",hh:"%d\u6642\u9593",d:"1\u65e5",dd:"%d\u65e5",M:"1\u30f6\u6708",MM:"%d\u30f6\u6708",y:"1\u5e74",yy:"%d\u5e74"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("jv",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_Nopember_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nop_Des".split("_"),weekdays:"Minggu_Senen_Seloso_Rebu_Kemis_Jemuwah_Septu".split("_"),weekdaysShort:"Min_Sen_Sel_Reb_Kem_Jem_Sep".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sp".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/enjing|siyang|sonten|ndalu/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"enjing"===meridiem?hour:"siyang"===meridiem?hour>=11?hour:hour+12:"sonten"===meridiem||"ndalu"===meridiem?hour+12:void 0},meridiem:function(hours,minutes,isLower){return hours<11?"enjing":hours<15?"siyang":hours<19?"sonten":"ndalu"},calendar:{sameDay:"[Dinten puniko pukul] LT",nextDay:"[Mbenjang pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kala wingi pukul] LT",lastWeek:"dddd [kepengker pukul] LT",sameElse:"L"},relativeTime:{future:"wonten ing %s",past:"%s ingkang kepengker",s:"sawetawis detik",ss:"%d detik",m:"setunggal menit",mm:"%d menit",h:"setunggal jam",hh:"%d jam",d:"sedinten",dd:"%d dinten",M:"sewulan",MM:"%d wulan",y:"setaun",yy:"%d taun"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ka",{months:"\u10d8\u10d0\u10dc\u10d5\u10d0\u10e0\u10d8_\u10d7\u10d4\u10d1\u10d4\u10e0\u10d5\u10d0\u10da\u10d8_\u10db\u10d0\u10e0\u10e2\u10d8_\u10d0\u10de\u10e0\u10d8\u10da\u10d8_\u10db\u10d0\u10d8\u10e1\u10d8_\u10d8\u10d5\u10dc\u10d8\u10e1\u10d8_\u10d8\u10d5\u10da\u10d8\u10e1\u10d8_\u10d0\u10d2\u10d5\u10d8\u10e1\u10e2\u10dd_\u10e1\u10d4\u10e5\u10e2\u10d4\u10db\u10d1\u10d4\u10e0\u10d8_\u10dd\u10e5\u10e2\u10dd\u10db\u10d1\u10d4\u10e0\u10d8_\u10dc\u10dd\u10d4\u10db\u10d1\u10d4\u10e0\u10d8_\u10d3\u10d4\u10d9\u10d4\u10db\u10d1\u10d4\u10e0\u10d8".split("_"),monthsShort:"\u10d8\u10d0\u10dc_\u10d7\u10d4\u10d1_\u10db\u10d0\u10e0_\u10d0\u10de\u10e0_\u10db\u10d0\u10d8_\u10d8\u10d5\u10dc_\u10d8\u10d5\u10da_\u10d0\u10d2\u10d5_\u10e1\u10d4\u10e5_\u10dd\u10e5\u10e2_\u10dc\u10dd\u10d4_\u10d3\u10d4\u10d9".split("_"),weekdays:{standalone:"\u10d9\u10d5\u10d8\u10e0\u10d0_\u10dd\u10e0\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8_\u10e1\u10d0\u10db\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8_\u10dd\u10d7\u10ee\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8_\u10ee\u10e3\u10d7\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8_\u10de\u10d0\u10e0\u10d0\u10e1\u10d9\u10d4\u10d5\u10d8_\u10e8\u10d0\u10d1\u10d0\u10d7\u10d8".split("_"),format:"\u10d9\u10d5\u10d8\u10e0\u10d0\u10e1_\u10dd\u10e0\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1_\u10e1\u10d0\u10db\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1_\u10dd\u10d7\u10ee\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1_\u10ee\u10e3\u10d7\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1_\u10de\u10d0\u10e0\u10d0\u10e1\u10d9\u10d4\u10d5\u10e1_\u10e8\u10d0\u10d1\u10d0\u10d7\u10e1".split("_"),isFormat:/(\u10ec\u10d8\u10dc\u10d0|\u10e8\u10d4\u10db\u10d3\u10d4\u10d2)/},weekdaysShort:"\u10d9\u10d5\u10d8_\u10dd\u10e0\u10e8_\u10e1\u10d0\u10db_\u10dd\u10d7\u10ee_\u10ee\u10e3\u10d7_\u10de\u10d0\u10e0_\u10e8\u10d0\u10d1".split("_"),weekdaysMin:"\u10d9\u10d5_\u10dd\u10e0_\u10e1\u10d0_\u10dd\u10d7_\u10ee\u10e3_\u10de\u10d0_\u10e8\u10d0".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u10d3\u10e6\u10d4\u10e1] LT[-\u10d6\u10d4]",nextDay:"[\u10ee\u10d5\u10d0\u10da] LT[-\u10d6\u10d4]",lastDay:"[\u10d2\u10e3\u10e8\u10d8\u10dc] LT[-\u10d6\u10d4]",nextWeek:"[\u10e8\u10d4\u10db\u10d3\u10d4\u10d2] dddd LT[-\u10d6\u10d4]",lastWeek:"[\u10ec\u10d8\u10dc\u10d0] dddd LT-\u10d6\u10d4",sameElse:"L"},relativeTime:{future:function(s){return s.replace(/(\u10ec\u10d0\u10db|\u10ec\u10e3\u10d7|\u10e1\u10d0\u10d0\u10d7|\u10ec\u10d4\u10da|\u10d3\u10e6|\u10d7\u10d5)(\u10d8|\u10d4)/,(function($0,$1,$2){return"\u10d8"===$2?$1+"\u10e8\u10d8":$1+$2+"\u10e8\u10d8"}))},past:function(s){return/(\u10ec\u10d0\u10db\u10d8|\u10ec\u10e3\u10d7\u10d8|\u10e1\u10d0\u10d0\u10d7\u10d8|\u10d3\u10e6\u10d4|\u10d7\u10d5\u10d4)/.test(s)?s.replace(/(\u10d8|\u10d4)$/,"\u10d8\u10e1 \u10ec\u10d8\u10dc"):/\u10ec\u10d4\u10da\u10d8/.test(s)?s.replace(/\u10ec\u10d4\u10da\u10d8$/,"\u10ec\u10da\u10d8\u10e1 \u10ec\u10d8\u10dc"):s},s:"\u10e0\u10d0\u10db\u10d3\u10d4\u10dc\u10d8\u10db\u10d4 \u10ec\u10d0\u10db\u10d8",ss:"%d \u10ec\u10d0\u10db\u10d8",m:"\u10ec\u10e3\u10d7\u10d8",mm:"%d \u10ec\u10e3\u10d7\u10d8",h:"\u10e1\u10d0\u10d0\u10d7\u10d8",hh:"%d \u10e1\u10d0\u10d0\u10d7\u10d8",d:"\u10d3\u10e6\u10d4",dd:"%d \u10d3\u10e6\u10d4",M:"\u10d7\u10d5\u10d4",MM:"%d \u10d7\u10d5\u10d4",y:"\u10ec\u10d4\u10da\u10d8",yy:"%d \u10ec\u10d4\u10da\u10d8"},dayOfMonthOrdinalParse:/0|1-\u10da\u10d8|\u10db\u10d4-\d{1,2}|\d{1,2}-\u10d4/,ordinal:function(number){return 0===number?number:1===number?number+"-\u10da\u10d8":number<20||number<=100&&number%20==0||number%100==0?"\u10db\u10d4-"+number:number+"-\u10d4"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var suffixes={0:"-\u0448\u0456",1:"-\u0448\u0456",2:"-\u0448\u0456",3:"-\u0448\u0456",4:"-\u0448\u0456",5:"-\u0448\u0456",6:"-\u0448\u044b",7:"-\u0448\u0456",8:"-\u0448\u0456",9:"-\u0448\u044b",10:"-\u0448\u044b",20:"-\u0448\u044b",30:"-\u0448\u044b",40:"-\u0448\u044b",50:"-\u0448\u0456",60:"-\u0448\u044b",70:"-\u0448\u0456",80:"-\u0448\u0456",90:"-\u0448\u044b",100:"-\u0448\u0456"};moment.defineLocale("kk",{months:"\u049b\u0430\u04a3\u0442\u0430\u0440_\u0430\u049b\u043f\u0430\u043d_\u043d\u0430\u0443\u0440\u044b\u0437_\u0441\u04d9\u0443\u0456\u0440_\u043c\u0430\u043c\u044b\u0440_\u043c\u0430\u0443\u0441\u044b\u043c_\u0448\u0456\u043b\u0434\u0435_\u0442\u0430\u043c\u044b\u0437_\u049b\u044b\u0440\u043a\u04af\u0439\u0435\u043a_\u049b\u0430\u0437\u0430\u043d_\u049b\u0430\u0440\u0430\u0448\u0430_\u0436\u0435\u043b\u0442\u043e\u049b\u0441\u0430\u043d".split("_"),monthsShort:"\u049b\u0430\u04a3_\u0430\u049b\u043f_\u043d\u0430\u0443_\u0441\u04d9\u0443_\u043c\u0430\u043c_\u043c\u0430\u0443_\u0448\u0456\u043b_\u0442\u0430\u043c_\u049b\u044b\u0440_\u049b\u0430\u0437_\u049b\u0430\u0440_\u0436\u0435\u043b".split("_"),weekdays:"\u0436\u0435\u043a\u0441\u0435\u043d\u0431\u0456_\u0434\u04af\u0439\u0441\u0435\u043d\u0431\u0456_\u0441\u0435\u0439\u0441\u0435\u043d\u0431\u0456_\u0441\u04d9\u0440\u0441\u0435\u043d\u0431\u0456_\u0431\u0435\u0439\u0441\u0435\u043d\u0431\u0456_\u0436\u04b1\u043c\u0430_\u0441\u0435\u043d\u0431\u0456".split("_"),weekdaysShort:"\u0436\u0435\u043a_\u0434\u04af\u0439_\u0441\u0435\u0439_\u0441\u04d9\u0440_\u0431\u0435\u0439_\u0436\u04b1\u043c_\u0441\u0435\u043d".split("_"),weekdaysMin:"\u0436\u043a_\u0434\u0439_\u0441\u0439_\u0441\u0440_\u0431\u0439_\u0436\u043c_\u0441\u043d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0411\u04af\u0433\u0456\u043d \u0441\u0430\u0493\u0430\u0442] LT",nextDay:"[\u0415\u0440\u0442\u0435\u04a3 \u0441\u0430\u0493\u0430\u0442] LT",nextWeek:"dddd [\u0441\u0430\u0493\u0430\u0442] LT",lastDay:"[\u041a\u0435\u0448\u0435 \u0441\u0430\u0493\u0430\u0442] LT",lastWeek:"[\u04e8\u0442\u043a\u0435\u043d \u0430\u043f\u0442\u0430\u043d\u044b\u04a3] dddd [\u0441\u0430\u0493\u0430\u0442] LT",sameElse:"L"},relativeTime:{future:"%s \u0456\u0448\u0456\u043d\u0434\u0435",past:"%s \u0431\u04b1\u0440\u044b\u043d",s:"\u0431\u0456\u0440\u043d\u0435\u0448\u0435 \u0441\u0435\u043a\u0443\u043d\u0434",ss:"%d \u0441\u0435\u043a\u0443\u043d\u0434",m:"\u0431\u0456\u0440 \u043c\u0438\u043d\u0443\u0442",mm:"%d \u043c\u0438\u043d\u0443\u0442",h:"\u0431\u0456\u0440 \u0441\u0430\u0493\u0430\u0442",hh:"%d \u0441\u0430\u0493\u0430\u0442",d:"\u0431\u0456\u0440 \u043a\u04af\u043d",dd:"%d \u043a\u04af\u043d",M:"\u0431\u0456\u0440 \u0430\u0439",MM:"%d \u0430\u0439",y:"\u0431\u0456\u0440 \u0436\u044b\u043b",yy:"%d \u0436\u044b\u043b"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0448\u0456|\u0448\u044b)/,ordinal:function(number){return number+(suffixes[number]||suffixes[number%10]||suffixes[number>=100?100:null])},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u17e1",2:"\u17e2",3:"\u17e3",4:"\u17e4",5:"\u17e5",6:"\u17e6",7:"\u17e7",8:"\u17e8",9:"\u17e9",0:"\u17e0"},numberMap={"\u17e1":"1","\u17e2":"2","\u17e3":"3","\u17e4":"4","\u17e5":"5","\u17e6":"6","\u17e7":"7","\u17e8":"8","\u17e9":"9","\u17e0":"0"};moment.defineLocale("km",{months:"\u1798\u1780\u179a\u17b6_\u1780\u17bb\u1798\u17d2\u1797\u17c8_\u1798\u17b8\u1793\u17b6_\u1798\u17c1\u179f\u17b6_\u17a7\u179f\u1797\u17b6_\u1798\u17b7\u1790\u17bb\u1793\u17b6_\u1780\u1780\u17d2\u1780\u178a\u17b6_\u179f\u17b8\u17a0\u17b6_\u1780\u1789\u17d2\u1789\u17b6_\u178f\u17bb\u179b\u17b6_\u179c\u17b7\u1785\u17d2\u1786\u17b7\u1780\u17b6_\u1792\u17d2\u1793\u17bc".split("_"),monthsShort:"\u1798\u1780\u179a\u17b6_\u1780\u17bb\u1798\u17d2\u1797\u17c8_\u1798\u17b8\u1793\u17b6_\u1798\u17c1\u179f\u17b6_\u17a7\u179f\u1797\u17b6_\u1798\u17b7\u1790\u17bb\u1793\u17b6_\u1780\u1780\u17d2\u1780\u178a\u17b6_\u179f\u17b8\u17a0\u17b6_\u1780\u1789\u17d2\u1789\u17b6_\u178f\u17bb\u179b\u17b6_\u179c\u17b7\u1785\u17d2\u1786\u17b7\u1780\u17b6_\u1792\u17d2\u1793\u17bc".split("_"),weekdays:"\u17a2\u17b6\u1791\u17b7\u178f\u17d2\u1799_\u1785\u17d0\u1793\u17d2\u1791_\u17a2\u1784\u17d2\u1782\u17b6\u179a_\u1796\u17bb\u1792_\u1796\u17d2\u179a\u17a0\u179f\u17d2\u1794\u178f\u17b7\u17cd_\u179f\u17bb\u1780\u17d2\u179a_\u179f\u17c5\u179a\u17cd".split("_"),weekdaysShort:"\u17a2\u17b6_\u1785_\u17a2_\u1796_\u1796\u17d2\u179a_\u179f\u17bb_\u179f".split("_"),weekdaysMin:"\u17a2\u17b6_\u1785_\u17a2_\u1796_\u1796\u17d2\u179a_\u179f\u17bb_\u179f".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/\u1796\u17d2\u179a\u17b9\u1780|\u179b\u17d2\u1784\u17b6\u1785/,isPM:function(input){return"\u179b\u17d2\u1784\u17b6\u1785"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u1796\u17d2\u179a\u17b9\u1780":"\u179b\u17d2\u1784\u17b6\u1785"},calendar:{sameDay:"[\u1790\u17d2\u1784\u17c3\u1793\u17c1\u17c7 \u1798\u17c9\u17c4\u1784] LT",nextDay:"[\u179f\u17d2\u17a2\u17c2\u1780 \u1798\u17c9\u17c4\u1784] LT",nextWeek:"dddd [\u1798\u17c9\u17c4\u1784] LT",lastDay:"[\u1798\u17d2\u179f\u17b7\u179b\u1798\u17b7\u1789 \u1798\u17c9\u17c4\u1784] LT",lastWeek:"dddd [\u179f\u1794\u17d2\u178f\u17b6\u17a0\u17cd\u1798\u17bb\u1793] [\u1798\u17c9\u17c4\u1784] LT",sameElse:"L"},relativeTime:{future:"%s\u1791\u17c0\u178f",past:"%s\u1798\u17bb\u1793",s:"\u1794\u17c9\u17bb\u1793\u17d2\u1798\u17b6\u1793\u179c\u17b7\u1793\u17b6\u1791\u17b8",ss:"%d \u179c\u17b7\u1793\u17b6\u1791\u17b8",m:"\u1798\u17bd\u1799\u1793\u17b6\u1791\u17b8",mm:"%d \u1793\u17b6\u1791\u17b8",h:"\u1798\u17bd\u1799\u1798\u17c9\u17c4\u1784",hh:"%d \u1798\u17c9\u17c4\u1784",d:"\u1798\u17bd\u1799\u1790\u17d2\u1784\u17c3",dd:"%d \u1790\u17d2\u1784\u17c3",M:"\u1798\u17bd\u1799\u1781\u17c2",MM:"%d \u1781\u17c2",y:"\u1798\u17bd\u1799\u1786\u17d2\u1793\u17b6\u17c6",yy:"%d \u1786\u17d2\u1793\u17b6\u17c6"},dayOfMonthOrdinalParse:/\u1791\u17b8\d{1,2}/,ordinal:"\u1791\u17b8%d",preparse:function(string){return string.replace(/[\u17e1\u17e2\u17e3\u17e4\u17e5\u17e6\u17e7\u17e8\u17e9\u17e0]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0ce7",2:"\u0ce8",3:"\u0ce9",4:"\u0cea",5:"\u0ceb",6:"\u0cec",7:"\u0ced",8:"\u0cee",9:"\u0cef",0:"\u0ce6"},numberMap={"\u0ce7":"1","\u0ce8":"2","\u0ce9":"3","\u0cea":"4","\u0ceb":"5","\u0cec":"6","\u0ced":"7","\u0cee":"8","\u0cef":"9","\u0ce6":"0"};moment.defineLocale("kn",{months:"\u0c9c\u0ca8\u0cb5\u0cb0\u0cbf_\u0cab\u0cc6\u0cac\u0ccd\u0cb0\u0cb5\u0cb0\u0cbf_\u0cae\u0cbe\u0cb0\u0ccd\u0c9a\u0ccd_\u0c8f\u0caa\u0ccd\u0cb0\u0cbf\u0cb2\u0ccd_\u0cae\u0cc6\u0cd5_\u0c9c\u0cc2\u0ca8\u0ccd_\u0c9c\u0cc1\u0cb2\u0cc6\u0cd6_\u0c86\u0c97\u0cb8\u0ccd\u0c9f\u0ccd_\u0cb8\u0cc6\u0caa\u0ccd\u0c9f\u0cc6\u0c82\u0cac\u0cb0\u0ccd_\u0c85\u0c95\u0ccd\u0c9f\u0cc6\u0cc2\u0cd5\u0cac\u0cb0\u0ccd_\u0ca8\u0cb5\u0cc6\u0c82\u0cac\u0cb0\u0ccd_\u0ca1\u0cbf\u0cb8\u0cc6\u0c82\u0cac\u0cb0\u0ccd".split("_"),monthsShort:"\u0c9c\u0ca8_\u0cab\u0cc6\u0cac\u0ccd\u0cb0_\u0cae\u0cbe\u0cb0\u0ccd\u0c9a\u0ccd_\u0c8f\u0caa\u0ccd\u0cb0\u0cbf\u0cb2\u0ccd_\u0cae\u0cc6\u0cd5_\u0c9c\u0cc2\u0ca8\u0ccd_\u0c9c\u0cc1\u0cb2\u0cc6\u0cd6_\u0c86\u0c97\u0cb8\u0ccd\u0c9f\u0ccd_\u0cb8\u0cc6\u0caa\u0ccd\u0c9f\u0cc6\u0c82_\u0c85\u0c95\u0ccd\u0c9f\u0cc6\u0cc2\u0cd5_\u0ca8\u0cb5\u0cc6\u0c82_\u0ca1\u0cbf\u0cb8\u0cc6\u0c82".split("_"),monthsParseExact:!0,weekdays:"\u0cad\u0cbe\u0ca8\u0cc1\u0cb5\u0cbe\u0cb0_\u0cb8\u0cc6\u0cc2\u0cd5\u0cae\u0cb5\u0cbe\u0cb0_\u0cae\u0c82\u0c97\u0cb3\u0cb5\u0cbe\u0cb0_\u0cac\u0cc1\u0ca7\u0cb5\u0cbe\u0cb0_\u0c97\u0cc1\u0cb0\u0cc1\u0cb5\u0cbe\u0cb0_\u0cb6\u0cc1\u0c95\u0ccd\u0cb0\u0cb5\u0cbe\u0cb0_\u0cb6\u0ca8\u0cbf\u0cb5\u0cbe\u0cb0".split("_"),weekdaysShort:"\u0cad\u0cbe\u0ca8\u0cc1_\u0cb8\u0cc6\u0cc2\u0cd5\u0cae_\u0cae\u0c82\u0c97\u0cb3_\u0cac\u0cc1\u0ca7_\u0c97\u0cc1\u0cb0\u0cc1_\u0cb6\u0cc1\u0c95\u0ccd\u0cb0_\u0cb6\u0ca8\u0cbf".split("_"),weekdaysMin:"\u0cad\u0cbe_\u0cb8\u0cc6\u0cc2\u0cd5_\u0cae\u0c82_\u0cac\u0cc1_\u0c97\u0cc1_\u0cb6\u0cc1_\u0cb6".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[\u0c87\u0c82\u0ca6\u0cc1] LT",nextDay:"[\u0ca8\u0cbe\u0cb3\u0cc6] LT",nextWeek:"dddd, LT",lastDay:"[\u0ca8\u0cbf\u0ca8\u0ccd\u0ca8\u0cc6] LT",lastWeek:"[\u0c95\u0cc6\u0cc2\u0ca8\u0cc6\u0caf] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0ca8\u0c82\u0ca4\u0cb0",past:"%s \u0cb9\u0cbf\u0c82\u0ca6\u0cc6",s:"\u0c95\u0cc6\u0cb2\u0cb5\u0cc1 \u0c95\u0ccd\u0cb7\u0ca3\u0c97\u0cb3\u0cc1",ss:"%d \u0cb8\u0cc6\u0c95\u0cc6\u0c82\u0ca1\u0cc1\u0c97\u0cb3\u0cc1",m:"\u0c92\u0c82\u0ca6\u0cc1 \u0ca8\u0cbf\u0cae\u0cbf\u0cb7",mm:"%d \u0ca8\u0cbf\u0cae\u0cbf\u0cb7",h:"\u0c92\u0c82\u0ca6\u0cc1 \u0c97\u0c82\u0c9f\u0cc6",hh:"%d \u0c97\u0c82\u0c9f\u0cc6",d:"\u0c92\u0c82\u0ca6\u0cc1 \u0ca6\u0cbf\u0ca8",dd:"%d \u0ca6\u0cbf\u0ca8",M:"\u0c92\u0c82\u0ca6\u0cc1 \u0ca4\u0cbf\u0c82\u0c97\u0cb3\u0cc1",MM:"%d \u0ca4\u0cbf\u0c82\u0c97\u0cb3\u0cc1",y:"\u0c92\u0c82\u0ca6\u0cc1 \u0cb5\u0cb0\u0ccd\u0cb7",yy:"%d \u0cb5\u0cb0\u0ccd\u0cb7"},preparse:function(string){return string.replace(/[\u0ce7\u0ce8\u0ce9\u0cea\u0ceb\u0cec\u0ced\u0cee\u0cef\u0ce6]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u0cb0\u0cbe\u0ca4\u0ccd\u0cb0\u0cbf|\u0cac\u0cc6\u0cb3\u0cbf\u0c97\u0ccd\u0c97\u0cc6|\u0cae\u0ca7\u0ccd\u0caf\u0cbe\u0cb9\u0ccd\u0ca8|\u0cb8\u0c82\u0c9c\u0cc6/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0cb0\u0cbe\u0ca4\u0ccd\u0cb0\u0cbf"===meridiem?hour<4?hour:hour+12:"\u0cac\u0cc6\u0cb3\u0cbf\u0c97\u0ccd\u0c97\u0cc6"===meridiem?hour:"\u0cae\u0ca7\u0ccd\u0caf\u0cbe\u0cb9\u0ccd\u0ca8"===meridiem?hour>=10?hour:hour+12:"\u0cb8\u0c82\u0c9c\u0cc6"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"\u0cb0\u0cbe\u0ca4\u0ccd\u0cb0\u0cbf":hour<10?"\u0cac\u0cc6\u0cb3\u0cbf\u0c97\u0ccd\u0c97\u0cc6":hour<17?"\u0cae\u0ca7\u0ccd\u0caf\u0cbe\u0cb9\u0ccd\u0ca8":hour<20?"\u0cb8\u0c82\u0c9c\u0cc6":"\u0cb0\u0cbe\u0ca4\u0ccd\u0cb0\u0cbf"},dayOfMonthOrdinalParse:/\d{1,2}(\u0ca8\u0cc6\u0cd5)/,ordinal:function(number){return number+"\u0ca8\u0cc6\u0cd5"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ko",{months:"1\uc6d4_2\uc6d4_3\uc6d4_4\uc6d4_5\uc6d4_6\uc6d4_7\uc6d4_8\uc6d4_9\uc6d4_10\uc6d4_11\uc6d4_12\uc6d4".split("_"),monthsShort:"1\uc6d4_2\uc6d4_3\uc6d4_4\uc6d4_5\uc6d4_6\uc6d4_7\uc6d4_8\uc6d4_9\uc6d4_10\uc6d4_11\uc6d4_12\uc6d4".split("_"),weekdays:"\uc77c\uc694\uc77c_\uc6d4\uc694\uc77c_\ud654\uc694\uc77c_\uc218\uc694\uc77c_\ubaa9\uc694\uc77c_\uae08\uc694\uc77c_\ud1a0\uc694\uc77c".split("_"),weekdaysShort:"\uc77c_\uc6d4_\ud654_\uc218_\ubaa9_\uae08_\ud1a0".split("_"),weekdaysMin:"\uc77c_\uc6d4_\ud654_\uc218_\ubaa9_\uae08_\ud1a0".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY\ub144 MMMM D\uc77c",LLL:"YYYY\ub144 MMMM D\uc77c A h:mm",LLLL:"YYYY\ub144 MMMM D\uc77c dddd A h:mm",l:"YYYY.MM.DD.",ll:"YYYY\ub144 MMMM D\uc77c",lll:"YYYY\ub144 MMMM D\uc77c A h:mm",llll:"YYYY\ub144 MMMM D\uc77c dddd A h:mm"},calendar:{sameDay:"\uc624\ub298 LT",nextDay:"\ub0b4\uc77c LT",nextWeek:"dddd LT",lastDay:"\uc5b4\uc81c LT",lastWeek:"\uc9c0\ub09c\uc8fc dddd LT",sameElse:"L"},relativeTime:{future:"%s \ud6c4",past:"%s \uc804",s:"\uba87 \ucd08",ss:"%d\ucd08",m:"1\ubd84",mm:"%d\ubd84",h:"\ud55c \uc2dc\uac04",hh:"%d\uc2dc\uac04",d:"\ud558\ub8e8",dd:"%d\uc77c",M:"\ud55c \ub2ec",MM:"%d\ub2ec",y:"\uc77c \ub144",yy:"%d\ub144"},dayOfMonthOrdinalParse:/\d{1,2}(\uc77c|\uc6d4|\uc8fc)/,ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"\uc77c";case"M":return number+"\uc6d4";case"w":case"W":return number+"\uc8fc";default:return number}},meridiemParse:/\uc624\uc804|\uc624\ud6c4/,isPM:function(token){return"\uc624\ud6c4"===token},meridiem:function(hour,minute,isUpper){return hour<12?"\uc624\uc804":"\uc624\ud6c4"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0661",2:"\u0662",3:"\u0663",4:"\u0664",5:"\u0665",6:"\u0666",7:"\u0667",8:"\u0668",9:"\u0669",0:"\u0660"},numberMap={"\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9","\u0660":"0"},months=["\u06a9\u0627\u0646\u0648\u0646\u06cc \u062f\u0648\u0648\u06d5\u0645","\u0634\u0648\u0628\u0627\u062a","\u0626\u0627\u0632\u0627\u0631","\u0646\u06cc\u0633\u0627\u0646","\u0626\u0627\u06cc\u0627\u0631","\u062d\u0648\u0632\u06d5\u06cc\u0631\u0627\u0646","\u062a\u06d5\u0645\u0645\u0648\u0632","\u0626\u0627\u0628","\u0626\u06d5\u06cc\u0644\u0648\u0648\u0644","\u062a\u0634\u0631\u06cc\u0646\u06cc \u06cc\u06d5\u0643\u06d5\u0645","\u062a\u0634\u0631\u06cc\u0646\u06cc \u062f\u0648\u0648\u06d5\u0645","\u0643\u0627\u0646\u0648\u0646\u06cc \u06cc\u06d5\u06a9\u06d5\u0645"];moment.defineLocale("ku",{months:months,monthsShort:months,weekdays:"\u06cc\u0647\u200c\u0643\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u062f\u0648\u0648\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u0633\u06ce\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u0686\u0648\u0627\u0631\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u067e\u06ce\u0646\u062c\u0634\u0647\u200c\u0645\u0645\u0647\u200c_\u0647\u0647\u200c\u06cc\u0646\u06cc_\u0634\u0647\u200c\u0645\u0645\u0647\u200c".split("_"),weekdaysShort:"\u06cc\u0647\u200c\u0643\u0634\u0647\u200c\u0645_\u062f\u0648\u0648\u0634\u0647\u200c\u0645_\u0633\u06ce\u0634\u0647\u200c\u0645_\u0686\u0648\u0627\u0631\u0634\u0647\u200c\u0645_\u067e\u06ce\u0646\u062c\u0634\u0647\u200c\u0645_\u0647\u0647\u200c\u06cc\u0646\u06cc_\u0634\u0647\u200c\u0645\u0645\u0647\u200c".split("_"),weekdaysMin:"\u06cc_\u062f_\u0633_\u0686_\u067e_\u0647_\u0634".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/\u0626\u06ce\u0648\u0627\u0631\u0647\u200c|\u0628\u0647\u200c\u06cc\u0627\u0646\u06cc/,isPM:function(input){return/\u0626\u06ce\u0648\u0627\u0631\u0647\u200c/.test(input)},meridiem:function(hour,minute,isLower){return hour<12?"\u0628\u0647\u200c\u06cc\u0627\u0646\u06cc":"\u0626\u06ce\u0648\u0627\u0631\u0647\u200c"},calendar:{sameDay:"[\u0626\u0647\u200c\u0645\u0631\u06c6 \u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",nextDay:"[\u0628\u0647\u200c\u06cc\u0627\u0646\u06cc \u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",nextWeek:"dddd [\u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",lastDay:"[\u062f\u0648\u06ce\u0646\u06ce \u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",lastWeek:"dddd [\u0643\u0627\u062a\u0698\u0645\u06ce\u0631] LT",sameElse:"L"},relativeTime:{future:"\u0644\u0647\u200c %s",past:"%s",s:"\u0686\u0647\u200c\u0646\u062f \u0686\u0631\u0643\u0647\u200c\u06cc\u0647\u200c\u0643",ss:"\u0686\u0631\u0643\u0647\u200c %d",m:"\u06cc\u0647\u200c\u0643 \u062e\u0648\u0644\u0647\u200c\u0643",mm:"%d \u062e\u0648\u0644\u0647\u200c\u0643",h:"\u06cc\u0647\u200c\u0643 \u0643\u0627\u062a\u0698\u0645\u06ce\u0631",hh:"%d \u0643\u0627\u062a\u0698\u0645\u06ce\u0631",d:"\u06cc\u0647\u200c\u0643 \u0695\u06c6\u0698",dd:"%d \u0695\u06c6\u0698",M:"\u06cc\u0647\u200c\u0643 \u0645\u0627\u0646\u06af",MM:"%d \u0645\u0627\u0646\u06af",y:"\u06cc\u0647\u200c\u0643 \u0633\u0627\u06b5",yy:"%d \u0633\u0627\u06b5"},preparse:function(string){return string.replace(/[\u0661\u0662\u0663\u0664\u0665\u0666\u0667\u0668\u0669\u0660]/g,(function(match){return numberMap[match]})).replace(/\u060c/g,",")},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]})).replace(/,/g,"\u060c")},week:{dow:6,doy:12}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var suffixes={0:"-\u0447\u04af",1:"-\u0447\u0438",2:"-\u0447\u0438",3:"-\u0447\u04af",4:"-\u0447\u04af",5:"-\u0447\u0438",6:"-\u0447\u044b",7:"-\u0447\u0438",8:"-\u0447\u0438",9:"-\u0447\u0443",10:"-\u0447\u0443",20:"-\u0447\u044b",30:"-\u0447\u0443",40:"-\u0447\u044b",50:"-\u0447\u04af",60:"-\u0447\u044b",70:"-\u0447\u0438",80:"-\u0447\u0438",90:"-\u0447\u0443",100:"-\u0447\u04af"};moment.defineLocale("ky",{months:"\u044f\u043d\u0432\u0430\u0440\u044c_\u0444\u0435\u0432\u0440\u0430\u043b\u044c_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0435\u043b\u044c_\u043c\u0430\u0439_\u0438\u044e\u043d\u044c_\u0438\u044e\u043b\u044c_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044c_\u043e\u043a\u0442\u044f\u0431\u0440\u044c_\u043d\u043e\u044f\u0431\u0440\u044c_\u0434\u0435\u043a\u0430\u0431\u0440\u044c".split("_"),monthsShort:"\u044f\u043d\u0432_\u0444\u0435\u0432_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440_\u043c\u0430\u0439_\u0438\u044e\u043d\u044c_\u0438\u044e\u043b\u044c_\u0430\u0432\u0433_\u0441\u0435\u043d_\u043e\u043a\u0442_\u043d\u043e\u044f_\u0434\u0435\u043a".split("_"),weekdays:"\u0416\u0435\u043a\u0448\u0435\u043c\u0431\u0438_\u0414\u04af\u0439\u0448\u04e9\u043c\u0431\u04af_\u0428\u0435\u0439\u0448\u0435\u043c\u0431\u0438_\u0428\u0430\u0440\u0448\u0435\u043c\u0431\u0438_\u0411\u0435\u0439\u0448\u0435\u043c\u0431\u0438_\u0416\u0443\u043c\u0430_\u0418\u0448\u0435\u043c\u0431\u0438".split("_"),weekdaysShort:"\u0416\u0435\u043a_\u0414\u04af\u0439_\u0428\u0435\u0439_\u0428\u0430\u0440_\u0411\u0435\u0439_\u0416\u0443\u043c_\u0418\u0448\u0435".split("_"),weekdaysMin:"\u0416\u043a_\u0414\u0439_\u0428\u0439_\u0428\u0440_\u0411\u0439_\u0416\u043c_\u0418\u0448".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0411\u04af\u0433\u04af\u043d \u0441\u0430\u0430\u0442] LT",nextDay:"[\u042d\u0440\u0442\u0435\u04a3 \u0441\u0430\u0430\u0442] LT",nextWeek:"dddd [\u0441\u0430\u0430\u0442] LT",lastDay:"[\u041a\u0435\u0447\u044d\u044d \u0441\u0430\u0430\u0442] LT",lastWeek:"[\u04e8\u0442\u043a\u04e9\u043d \u0430\u043f\u0442\u0430\u043d\u044b\u043d] dddd [\u043a\u04af\u043d\u04af] [\u0441\u0430\u0430\u0442] LT",sameElse:"L"},relativeTime:{future:"%s \u0438\u0447\u0438\u043d\u0434\u0435",past:"%s \u043c\u0443\u0440\u0443\u043d",s:"\u0431\u0438\u0440\u043d\u0435\u0447\u0435 \u0441\u0435\u043a\u0443\u043d\u0434",ss:"%d \u0441\u0435\u043a\u0443\u043d\u0434",m:"\u0431\u0438\u0440 \u043c\u04af\u043d\u04e9\u0442",mm:"%d \u043c\u04af\u043d\u04e9\u0442",h:"\u0431\u0438\u0440 \u0441\u0430\u0430\u0442",hh:"%d \u0441\u0430\u0430\u0442",d:"\u0431\u0438\u0440 \u043a\u04af\u043d",dd:"%d \u043a\u04af\u043d",M:"\u0431\u0438\u0440 \u0430\u0439",MM:"%d \u0430\u0439",y:"\u0431\u0438\u0440 \u0436\u044b\u043b",yy:"%d \u0436\u044b\u043b"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0447\u0438|\u0447\u044b|\u0447\u04af|\u0447\u0443)/,ordinal:function(number){return number+(suffixes[number]||suffixes[number%10]||suffixes[number>=100?100:null])},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return withoutSuffix?format[key][0]:format[key][1]}function eifelerRegelAppliesToNumber(number){if(number=parseInt(number,10),isNaN(number))return!1;if(number<0)return!0;if(number<10)return 4<=number&&number<=7;if(number<100){var lastDigit=number%10;return eifelerRegelAppliesToNumber(0===lastDigit?number/10:lastDigit)}if(number<1e4){for(;number>=10;)number/=10;return eifelerRegelAppliesToNumber(number)}return eifelerRegelAppliesToNumber(number/=1e3)}moment.defineLocale("lb",{months:"Januar_Februar_M\xe4erz_Abr\xebll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonndeg_M\xe9indeg_D\xebnschdeg_M\xebttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._M\xe9._D\xeb._M\xeb._Do._Fr._Sa.".split("_"),weekdaysMin:"So_M\xe9_D\xeb_M\xeb_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm [Auer]",LTS:"H:mm:ss [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm [Auer]",LLLL:"dddd, D. MMMM YYYY H:mm [Auer]"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[G\xebschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:function(string){return eifelerRegelAppliesToNumber(string.substr(0,string.indexOf(" ")))?"a "+string:"an "+string},past:function(string){return eifelerRegelAppliesToNumber(string.substr(0,string.indexOf(" ")))?"viru "+string:"virun "+string},s:"e puer Sekonnen",ss:"%d Sekonnen",m:processRelativeTime,mm:"%d Minutten",h:processRelativeTime,hh:"%d Stonnen",d:processRelativeTime,dd:"%d Deeg",M:processRelativeTime,MM:"%d M\xe9int",y:processRelativeTime,yy:"%d Joer"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("lo",{months:"\u0ea1\u0eb1\u0e87\u0e81\u0ead\u0e99_\u0e81\u0eb8\u0ea1\u0e9e\u0eb2_\u0ea1\u0eb5\u0e99\u0eb2_\u0ec0\u0ea1\u0eaa\u0eb2_\u0e9e\u0eb6\u0e94\u0eaa\u0eb0\u0e9e\u0eb2_\u0ea1\u0eb4\u0e96\u0eb8\u0e99\u0eb2_\u0e81\u0ecd\u0ea5\u0eb0\u0e81\u0ebb\u0e94_\u0eaa\u0eb4\u0e87\u0eab\u0eb2_\u0e81\u0eb1\u0e99\u0e8d\u0eb2_\u0e95\u0eb8\u0ea5\u0eb2_\u0e9e\u0eb0\u0e88\u0eb4\u0e81_\u0e97\u0eb1\u0e99\u0ea7\u0eb2".split("_"),monthsShort:"\u0ea1\u0eb1\u0e87\u0e81\u0ead\u0e99_\u0e81\u0eb8\u0ea1\u0e9e\u0eb2_\u0ea1\u0eb5\u0e99\u0eb2_\u0ec0\u0ea1\u0eaa\u0eb2_\u0e9e\u0eb6\u0e94\u0eaa\u0eb0\u0e9e\u0eb2_\u0ea1\u0eb4\u0e96\u0eb8\u0e99\u0eb2_\u0e81\u0ecd\u0ea5\u0eb0\u0e81\u0ebb\u0e94_\u0eaa\u0eb4\u0e87\u0eab\u0eb2_\u0e81\u0eb1\u0e99\u0e8d\u0eb2_\u0e95\u0eb8\u0ea5\u0eb2_\u0e9e\u0eb0\u0e88\u0eb4\u0e81_\u0e97\u0eb1\u0e99\u0ea7\u0eb2".split("_"),weekdays:"\u0ead\u0eb2\u0e97\u0eb4\u0e94_\u0e88\u0eb1\u0e99_\u0ead\u0eb1\u0e87\u0e84\u0eb2\u0e99_\u0e9e\u0eb8\u0e94_\u0e9e\u0eb0\u0eab\u0eb1\u0e94_\u0eaa\u0eb8\u0e81_\u0ec0\u0eaa\u0ebb\u0eb2".split("_"),weekdaysShort:"\u0e97\u0eb4\u0e94_\u0e88\u0eb1\u0e99_\u0ead\u0eb1\u0e87\u0e84\u0eb2\u0e99_\u0e9e\u0eb8\u0e94_\u0e9e\u0eb0\u0eab\u0eb1\u0e94_\u0eaa\u0eb8\u0e81_\u0ec0\u0eaa\u0ebb\u0eb2".split("_"),weekdaysMin:"\u0e97_\u0e88_\u0ead\u0e84_\u0e9e_\u0e9e\u0eab_\u0eaa\u0e81_\u0eaa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"\u0ea7\u0eb1\u0e99dddd D MMMM YYYY HH:mm"},meridiemParse:/\u0e95\u0ead\u0e99\u0ec0\u0e8a\u0ebb\u0ec9\u0eb2|\u0e95\u0ead\u0e99\u0ec1\u0ea5\u0e87/,isPM:function(input){return"\u0e95\u0ead\u0e99\u0ec1\u0ea5\u0e87"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0e95\u0ead\u0e99\u0ec0\u0e8a\u0ebb\u0ec9\u0eb2":"\u0e95\u0ead\u0e99\u0ec1\u0ea5\u0e87"},calendar:{sameDay:"[\u0ea1\u0eb7\u0ec9\u0e99\u0eb5\u0ec9\u0ec0\u0ea7\u0ea5\u0eb2] LT",nextDay:"[\u0ea1\u0eb7\u0ec9\u0ead\u0eb7\u0ec8\u0e99\u0ec0\u0ea7\u0ea5\u0eb2] LT",nextWeek:"[\u0ea7\u0eb1\u0e99]dddd[\u0edc\u0ec9\u0eb2\u0ec0\u0ea7\u0ea5\u0eb2] LT",lastDay:"[\u0ea1\u0eb7\u0ec9\u0ea7\u0eb2\u0e99\u0e99\u0eb5\u0ec9\u0ec0\u0ea7\u0ea5\u0eb2] LT",lastWeek:"[\u0ea7\u0eb1\u0e99]dddd[\u0ec1\u0ea5\u0ec9\u0ea7\u0e99\u0eb5\u0ec9\u0ec0\u0ea7\u0ea5\u0eb2] LT",sameElse:"L"},relativeTime:{future:"\u0ead\u0eb5\u0e81 %s",past:"%s\u0e9c\u0ec8\u0eb2\u0e99\u0ea1\u0eb2",s:"\u0e9a\u0ecd\u0ec8\u0ec0\u0e97\u0ebb\u0ec8\u0eb2\u0ec3\u0e94\u0ea7\u0eb4\u0e99\u0eb2\u0e97\u0eb5",ss:"%d \u0ea7\u0eb4\u0e99\u0eb2\u0e97\u0eb5",m:"1 \u0e99\u0eb2\u0e97\u0eb5",mm:"%d \u0e99\u0eb2\u0e97\u0eb5",h:"1 \u0e8a\u0ebb\u0ec8\u0ea7\u0ec2\u0ea1\u0e87",hh:"%d \u0e8a\u0ebb\u0ec8\u0ea7\u0ec2\u0ea1\u0e87",d:"1 \u0ea1\u0eb7\u0ec9",dd:"%d \u0ea1\u0eb7\u0ec9",M:"1 \u0ec0\u0e94\u0eb7\u0ead\u0e99",MM:"%d \u0ec0\u0e94\u0eb7\u0ead\u0e99",y:"1 \u0e9b\u0eb5",yy:"%d \u0e9b\u0eb5"},dayOfMonthOrdinalParse:/(\u0e97\u0eb5\u0ec8)\d{1,2}/,ordinal:function(number){return"\u0e97\u0eb5\u0ec8"+number}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var units={ss:"sekund\u0117_sekund\u017ei\u0173_sekundes",m:"minut\u0117_minut\u0117s_minut\u0119",mm:"minut\u0117s_minu\u010di\u0173_minutes",h:"valanda_valandos_valand\u0105",hh:"valandos_valand\u0173_valandas",d:"diena_dienos_dien\u0105",dd:"dienos_dien\u0173_dienas",M:"m\u0117nuo_m\u0117nesio_m\u0117nes\u012f",MM:"m\u0117nesiai_m\u0117nesi\u0173_m\u0117nesius",y:"metai_met\u0173_metus",yy:"metai_met\u0173_metus"};function translateSingular(number,withoutSuffix,key,isFuture){return withoutSuffix?forms(key)[0]:isFuture?forms(key)[1]:forms(key)[2]}function special(number){return number%10==0||number>10&&number<20}function forms(key){return units[key].split("_")}function translate(number,withoutSuffix,key,isFuture){var result=number+" ";return 1===number?result+translateSingular(0,withoutSuffix,key[0],isFuture):withoutSuffix?result+(special(number)?forms(key)[1]:forms(key)[0]):isFuture?result+forms(key)[1]:result+(special(number)?forms(key)[1]:forms(key)[2])}moment.defineLocale("lt",{months:{format:"sausio_vasario_kovo_baland\u017eio_gegu\u017e\u0117s_bir\u017eelio_liepos_rugpj\u016b\u010dio_rugs\u0117jo_spalio_lapkri\u010dio_gruod\u017eio".split("_"),standalone:"sausis_vasaris_kovas_balandis_gegu\u017e\u0117_bir\u017eelis_liepa_rugpj\u016btis_rugs\u0117jis_spalis_lapkritis_gruodis".split("_"),isFormat:/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?|MMMM?(\[[^\[\]]*\]|\s)+D[oD]?/},monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:{format:"sekmadien\u012f_pirmadien\u012f_antradien\u012f_tre\u010diadien\u012f_ketvirtadien\u012f_penktadien\u012f_\u0161e\u0161tadien\u012f".split("_"),standalone:"sekmadienis_pirmadienis_antradienis_tre\u010diadienis_ketvirtadienis_penktadienis_\u0161e\u0161tadienis".split("_"),isFormat:/dddd HH:mm/},weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_\u0160e\u0161".split("_"),weekdaysMin:"S_P_A_T_K_Pn_\u0160".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], HH:mm [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, HH:mm [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], HH:mm [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, HH:mm [val.]"},calendar:{sameDay:"[\u0160iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Pra\u0117jus\u012f] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie\u0161 %s",s:function(number,withoutSuffix,key,isFuture){return withoutSuffix?"kelios sekund\u0117s":isFuture?"keli\u0173 sekund\u017ei\u0173":"kelias sekundes"},ss:translate,m:translateSingular,mm:translate,h:translateSingular,hh:translate,d:translateSingular,dd:translate,M:translateSingular,MM:translate,y:translateSingular,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}-oji/,ordinal:function(number){return number+"-oji"},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var units={ss:"sekundes_sekund\u0113m_sekunde_sekundes".split("_"),m:"min\u016btes_min\u016bt\u0113m_min\u016bte_min\u016btes".split("_"),mm:"min\u016btes_min\u016bt\u0113m_min\u016bte_min\u016btes".split("_"),h:"stundas_stund\u0101m_stunda_stundas".split("_"),hh:"stundas_stund\u0101m_stunda_stundas".split("_"),d:"dienas_dien\u0101m_diena_dienas".split("_"),dd:"dienas_dien\u0101m_diena_dienas".split("_"),M:"m\u0113ne\u0161a_m\u0113ne\u0161iem_m\u0113nesis_m\u0113ne\u0161i".split("_"),MM:"m\u0113ne\u0161a_m\u0113ne\u0161iem_m\u0113nesis_m\u0113ne\u0161i".split("_"),y:"gada_gadiem_gads_gadi".split("_"),yy:"gada_gadiem_gads_gadi".split("_")};function format(forms,number,withoutSuffix){return withoutSuffix?number%10==1&&number%100!=11?forms[2]:forms[3]:number%10==1&&number%100!=11?forms[0]:forms[1]}function relativeTimeWithPlural(number,withoutSuffix,key){return number+" "+format(units[key],number,withoutSuffix)}function relativeTimeWithSingular(number,withoutSuffix,key){return format(units[key],number,withoutSuffix)}moment.defineLocale("lv",{months:"janv\u0101ris_febru\u0101ris_marts_apr\u012blis_maijs_j\u016bnijs_j\u016blijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_j\u016bn_j\u016bl_aug_sep_okt_nov_dec".split("_"),weekdays:"sv\u0113tdiena_pirmdiena_otrdiena_tre\u0161diena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY.",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, HH:mm",LLLL:"YYYY. [gada] D. MMMM, dddd, HH:mm"},calendar:{sameDay:"[\u0160odien pulksten] LT",nextDay:"[R\u012bt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pag\u0101ju\u0161\u0101] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"p\u0113c %s",past:"pirms %s",s:function(number,withoutSuffix){return withoutSuffix?"da\u017eas sekundes":"da\u017e\u0101m sekund\u0113m"},ss:relativeTimeWithPlural,m:relativeTimeWithSingular,mm:relativeTimeWithPlural,h:relativeTimeWithSingular,hh:relativeTimeWithPlural,d:relativeTimeWithSingular,dd:relativeTimeWithPlural,M:relativeTimeWithSingular,MM:relativeTimeWithPlural,y:relativeTimeWithSingular,yy:relativeTimeWithPlural},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var translator={words:{ss:["sekund","sekunda","sekundi"],m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mjesec","mjeseca","mjeseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(number,wordKey){return 1===number?wordKey[0]:number>=2&&number<=4?wordKey[1]:wordKey[2]},translate:function(number,withoutSuffix,key){var wordKey=translator.words[key];return 1===key.length?withoutSuffix?wordKey[0]:wordKey[1]:number+" "+translator.correctGrammaticalCase(number,wordKey)}};moment.defineLocale("me",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_\u010detvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._\u010det._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_\u010de_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sjutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[ju\u010de u] LT",lastWeek:function(){return["[pro\u0161le] [nedjelje] [u] LT","[pro\u0161log] [ponedjeljka] [u] LT","[pro\u0161log] [utorka] [u] LT","[pro\u0161le] [srijede] [u] LT","[pro\u0161log] [\u010detvrtka] [u] LT","[pro\u0161log] [petka] [u] LT","[pro\u0161le] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"nekoliko sekundi",ss:translator.translate,m:translator.translate,mm:translator.translate,h:translator.translate,hh:translator.translate,d:"dan",dd:translator.translate,M:"mjesec",MM:translator.translate,y:"godinu",yy:translator.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("mi",{months:"Kohi-t\u0101te_Hui-tanguru_Pout\u016b-te-rangi_Paenga-wh\u0101wh\u0101_Haratua_Pipiri_H\u014dngoingoi_Here-turi-k\u014dk\u0101_Mahuru_Whiringa-\u0101-nuku_Whiringa-\u0101-rangi_Hakihea".split("_"),monthsShort:"Kohi_Hui_Pou_Pae_Hara_Pipi_H\u014dngoi_Here_Mahu_Whi-nu_Whi-ra_Haki".split("_"),monthsRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,2}/i,weekdays:"R\u0101tapu_Mane_T\u016brei_Wenerei_T\u0101ite_Paraire_H\u0101tarei".split("_"),weekdaysShort:"Ta_Ma_T\u016b_We_T\u0101i_Pa_H\u0101".split("_"),weekdaysMin:"Ta_Ma_T\u016b_We_T\u0101i_Pa_H\u0101".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [i] HH:mm",LLLL:"dddd, D MMMM YYYY [i] HH:mm"},calendar:{sameDay:"[i teie mahana, i] LT",nextDay:"[apopo i] LT",nextWeek:"dddd [i] LT",lastDay:"[inanahi i] LT",lastWeek:"dddd [whakamutunga i] LT",sameElse:"L"},relativeTime:{future:"i roto i %s",past:"%s i mua",s:"te h\u0113kona ruarua",ss:"%d h\u0113kona",m:"he meneti",mm:"%d meneti",h:"te haora",hh:"%d haora",d:"he ra",dd:"%d ra",M:"he marama",MM:"%d marama",y:"he tau",yy:"%d tau"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("mk",{months:"\u0458\u0430\u043d\u0443\u0430\u0440\u0438_\u0444\u0435\u0432\u0440\u0443\u0430\u0440\u0438_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0438\u043b_\u043c\u0430\u0458_\u0458\u0443\u043d\u0438_\u0458\u0443\u043b\u0438_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043f\u0442\u0435\u043c\u0432\u0440\u0438_\u043e\u043a\u0442\u043e\u043c\u0432\u0440\u0438_\u043d\u043e\u0435\u043c\u0432\u0440\u0438_\u0434\u0435\u043a\u0435\u043c\u0432\u0440\u0438".split("_"),monthsShort:"\u0458\u0430\u043d_\u0444\u0435\u0432_\u043c\u0430\u0440_\u0430\u043f\u0440_\u043c\u0430\u0458_\u0458\u0443\u043d_\u0458\u0443\u043b_\u0430\u0432\u0433_\u0441\u0435\u043f_\u043e\u043a\u0442_\u043d\u043e\u0435_\u0434\u0435\u043a".split("_"),weekdays:"\u043d\u0435\u0434\u0435\u043b\u0430_\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u043d\u0438\u043a_\u0432\u0442\u043e\u0440\u043d\u0438\u043a_\u0441\u0440\u0435\u0434\u0430_\u0447\u0435\u0442\u0432\u0440\u0442\u043e\u043a_\u043f\u0435\u0442\u043e\u043a_\u0441\u0430\u0431\u043e\u0442\u0430".split("_"),weekdaysShort:"\u043d\u0435\u0434_\u043f\u043e\u043d_\u0432\u0442\u043e_\u0441\u0440\u0435_\u0447\u0435\u0442_\u043f\u0435\u0442_\u0441\u0430\u0431".split("_"),weekdaysMin:"\u043de_\u043fo_\u0432\u0442_\u0441\u0440_\u0447\u0435_\u043f\u0435_\u0441a".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[\u0414\u0435\u043d\u0435\u0441 \u0432\u043e] LT",nextDay:"[\u0423\u0442\u0440\u0435 \u0432\u043e] LT",nextWeek:"[\u0412\u043e] dddd [\u0432\u043e] LT",lastDay:"[\u0412\u0447\u0435\u0440\u0430 \u0432\u043e] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[\u0418\u0437\u043c\u0438\u043d\u0430\u0442\u0430\u0442\u0430] dddd [\u0432\u043e] LT";case 1:case 2:case 4:case 5:return"[\u0418\u0437\u043c\u0438\u043d\u0430\u0442\u0438\u043e\u0442] dddd [\u0432\u043e] LT"}},sameElse:"L"},relativeTime:{future:"\u0437\u0430 %s",past:"\u043f\u0440\u0435\u0434 %s",s:"\u043d\u0435\u043a\u043e\u043b\u043a\u0443 \u0441\u0435\u043a\u0443\u043d\u0434\u0438",ss:"%d \u0441\u0435\u043a\u0443\u043d\u0434\u0438",m:"\u0435\u0434\u043d\u0430 \u043c\u0438\u043d\u0443\u0442\u0430",mm:"%d \u043c\u0438\u043d\u0443\u0442\u0438",h:"\u0435\u0434\u0435\u043d \u0447\u0430\u0441",hh:"%d \u0447\u0430\u0441\u0430",d:"\u0435\u0434\u0435\u043d \u0434\u0435\u043d",dd:"%d \u0434\u0435\u043d\u0430",M:"\u0435\u0434\u0435\u043d \u043c\u0435\u0441\u0435\u0446",MM:"%d \u043c\u0435\u0441\u0435\u0446\u0438",y:"\u0435\u0434\u043d\u0430 \u0433\u043e\u0434\u0438\u043d\u0430",yy:"%d \u0433\u043e\u0434\u0438\u043d\u0438"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0435\u0432|\u0435\u043d|\u0442\u0438|\u0432\u0438|\u0440\u0438|\u043c\u0438)/,ordinal:function(number){var lastDigit=number%10,last2Digits=number%100;return 0===number?number+"-\u0435\u0432":0===last2Digits?number+"-\u0435\u043d":last2Digits>10&&last2Digits<20?number+"-\u0442\u0438":1===lastDigit?number+"-\u0432\u0438":2===lastDigit?number+"-\u0440\u0438":7===lastDigit||8===lastDigit?number+"-\u043c\u0438":number+"-\u0442\u0438"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ml",{months:"\u0d1c\u0d28\u0d41\u0d35\u0d30\u0d3f_\u0d2b\u0d46\u0d2c\u0d4d\u0d30\u0d41\u0d35\u0d30\u0d3f_\u0d2e\u0d3e\u0d7c\u0d1a\u0d4d\u0d1a\u0d4d_\u0d0f\u0d2a\u0d4d\u0d30\u0d3f\u0d7d_\u0d2e\u0d47\u0d2f\u0d4d_\u0d1c\u0d42\u0d7a_\u0d1c\u0d42\u0d32\u0d48_\u0d13\u0d17\u0d38\u0d4d\u0d31\u0d4d\u0d31\u0d4d_\u0d38\u0d46\u0d2a\u0d4d\u0d31\u0d4d\u0d31\u0d02\u0d2c\u0d7c_\u0d12\u0d15\u0d4d\u0d1f\u0d4b\u0d2c\u0d7c_\u0d28\u0d35\u0d02\u0d2c\u0d7c_\u0d21\u0d3f\u0d38\u0d02\u0d2c\u0d7c".split("_"),monthsShort:"\u0d1c\u0d28\u0d41._\u0d2b\u0d46\u0d2c\u0d4d\u0d30\u0d41._\u0d2e\u0d3e\u0d7c._\u0d0f\u0d2a\u0d4d\u0d30\u0d3f._\u0d2e\u0d47\u0d2f\u0d4d_\u0d1c\u0d42\u0d7a_\u0d1c\u0d42\u0d32\u0d48._\u0d13\u0d17._\u0d38\u0d46\u0d2a\u0d4d\u0d31\u0d4d\u0d31._\u0d12\u0d15\u0d4d\u0d1f\u0d4b._\u0d28\u0d35\u0d02._\u0d21\u0d3f\u0d38\u0d02.".split("_"),monthsParseExact:!0,weekdays:"\u0d1e\u0d3e\u0d2f\u0d31\u0d3e\u0d34\u0d4d\u0d1a_\u0d24\u0d3f\u0d19\u0d4d\u0d15\u0d33\u0d3e\u0d34\u0d4d\u0d1a_\u0d1a\u0d4a\u0d35\u0d4d\u0d35\u0d3e\u0d34\u0d4d\u0d1a_\u0d2c\u0d41\u0d27\u0d28\u0d3e\u0d34\u0d4d\u0d1a_\u0d35\u0d4d\u0d2f\u0d3e\u0d34\u0d3e\u0d34\u0d4d\u0d1a_\u0d35\u0d46\u0d33\u0d4d\u0d33\u0d3f\u0d2f\u0d3e\u0d34\u0d4d\u0d1a_\u0d36\u0d28\u0d3f\u0d2f\u0d3e\u0d34\u0d4d\u0d1a".split("_"),weekdaysShort:"\u0d1e\u0d3e\u0d2f\u0d7c_\u0d24\u0d3f\u0d19\u0d4d\u0d15\u0d7e_\u0d1a\u0d4a\u0d35\u0d4d\u0d35_\u0d2c\u0d41\u0d27\u0d7b_\u0d35\u0d4d\u0d2f\u0d3e\u0d34\u0d02_\u0d35\u0d46\u0d33\u0d4d\u0d33\u0d3f_\u0d36\u0d28\u0d3f".split("_"),weekdaysMin:"\u0d1e\u0d3e_\u0d24\u0d3f_\u0d1a\u0d4a_\u0d2c\u0d41_\u0d35\u0d4d\u0d2f\u0d3e_\u0d35\u0d46_\u0d36".split("_"),longDateFormat:{LT:"A h:mm -\u0d28\u0d41",LTS:"A h:mm:ss -\u0d28\u0d41",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm -\u0d28\u0d41",LLLL:"dddd, D MMMM YYYY, A h:mm -\u0d28\u0d41"},calendar:{sameDay:"[\u0d07\u0d28\u0d4d\u0d28\u0d4d] LT",nextDay:"[\u0d28\u0d3e\u0d33\u0d46] LT",nextWeek:"dddd, LT",lastDay:"[\u0d07\u0d28\u0d4d\u0d28\u0d32\u0d46] LT",lastWeek:"[\u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e\u0d4d",past:"%s \u0d2e\u0d41\u0d7b\u0d2a\u0d4d",s:"\u0d05\u0d7d\u0d2a \u0d28\u0d3f\u0d2e\u0d3f\u0d37\u0d19\u0d4d\u0d19\u0d7e",ss:"%d \u0d38\u0d46\u0d15\u0d4d\u0d15\u0d7b\u0d21\u0d4d",m:"\u0d12\u0d30\u0d41 \u0d2e\u0d3f\u0d28\u0d3f\u0d31\u0d4d\u0d31\u0d4d",mm:"%d \u0d2e\u0d3f\u0d28\u0d3f\u0d31\u0d4d\u0d31\u0d4d",h:"\u0d12\u0d30\u0d41 \u0d2e\u0d23\u0d3f\u0d15\u0d4d\u0d15\u0d42\u0d7c",hh:"%d \u0d2e\u0d23\u0d3f\u0d15\u0d4d\u0d15\u0d42\u0d7c",d:"\u0d12\u0d30\u0d41 \u0d26\u0d3f\u0d35\u0d38\u0d02",dd:"%d \u0d26\u0d3f\u0d35\u0d38\u0d02",M:"\u0d12\u0d30\u0d41 \u0d2e\u0d3e\u0d38\u0d02",MM:"%d \u0d2e\u0d3e\u0d38\u0d02",y:"\u0d12\u0d30\u0d41 \u0d35\u0d7c\u0d37\u0d02",yy:"%d \u0d35\u0d7c\u0d37\u0d02"},meridiemParse:/\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f|\u0d30\u0d3e\u0d35\u0d3f\u0d32\u0d46|\u0d09\u0d1a\u0d4d\u0d1a \u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e\u0d4d|\u0d35\u0d48\u0d15\u0d41\u0d28\u0d4d\u0d28\u0d47\u0d30\u0d02|\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f/i,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f"===meridiem&&hour>=4||"\u0d09\u0d1a\u0d4d\u0d1a \u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e\u0d4d"===meridiem||"\u0d35\u0d48\u0d15\u0d41\u0d28\u0d4d\u0d28\u0d47\u0d30\u0d02"===meridiem?hour+12:hour},meridiem:function(hour,minute,isLower){return hour<4?"\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f":hour<12?"\u0d30\u0d3e\u0d35\u0d3f\u0d32\u0d46":hour<17?"\u0d09\u0d1a\u0d4d\u0d1a \u0d15\u0d34\u0d3f\u0d1e\u0d4d\u0d1e\u0d4d":hour<20?"\u0d35\u0d48\u0d15\u0d41\u0d28\u0d4d\u0d28\u0d47\u0d30\u0d02":"\u0d30\u0d3e\u0d24\u0d4d\u0d30\u0d3f"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function translate(number,withoutSuffix,key,isFuture){switch(key){case"s":return withoutSuffix?"\u0445\u044d\u0434\u0445\u044d\u043d \u0441\u0435\u043a\u0443\u043d\u0434":"\u0445\u044d\u0434\u0445\u044d\u043d \u0441\u0435\u043a\u0443\u043d\u0434\u044b\u043d";case"ss":return number+(withoutSuffix?" \u0441\u0435\u043a\u0443\u043d\u0434":" \u0441\u0435\u043a\u0443\u043d\u0434\u044b\u043d");case"m":case"mm":return number+(withoutSuffix?" \u043c\u0438\u043d\u0443\u0442":" \u043c\u0438\u043d\u0443\u0442\u044b\u043d");case"h":case"hh":return number+(withoutSuffix?" \u0446\u0430\u0433":" \u0446\u0430\u0433\u0438\u0439\u043d");case"d":case"dd":return number+(withoutSuffix?" \u04e9\u0434\u04e9\u0440":" \u04e9\u0434\u0440\u0438\u0439\u043d");case"M":case"MM":return number+(withoutSuffix?" \u0441\u0430\u0440":" \u0441\u0430\u0440\u044b\u043d");case"y":case"yy":return number+(withoutSuffix?" \u0436\u0438\u043b":" \u0436\u0438\u043b\u0438\u0439\u043d");default:return number}}moment.defineLocale("mn",{months:"\u041d\u044d\u0433\u0434\u04af\u0433\u044d\u044d\u0440 \u0441\u0430\u0440_\u0425\u043e\u0451\u0440\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0413\u0443\u0440\u0430\u0432\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0414\u04e9\u0440\u04e9\u0432\u0434\u04af\u0433\u044d\u044d\u0440 \u0441\u0430\u0440_\u0422\u0430\u0432\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0417\u0443\u0440\u0433\u0430\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0414\u043e\u043b\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u041d\u0430\u0439\u043c\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0415\u0441\u0434\u04af\u0433\u044d\u044d\u0440 \u0441\u0430\u0440_\u0410\u0440\u0430\u0432\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440_\u0410\u0440\u0432\u0430\u043d \u043d\u044d\u0433\u0434\u04af\u0433\u044d\u044d\u0440 \u0441\u0430\u0440_\u0410\u0440\u0432\u0430\u043d \u0445\u043e\u0451\u0440\u0434\u0443\u0433\u0430\u0430\u0440 \u0441\u0430\u0440".split("_"),monthsShort:"1 \u0441\u0430\u0440_2 \u0441\u0430\u0440_3 \u0441\u0430\u0440_4 \u0441\u0430\u0440_5 \u0441\u0430\u0440_6 \u0441\u0430\u0440_7 \u0441\u0430\u0440_8 \u0441\u0430\u0440_9 \u0441\u0430\u0440_10 \u0441\u0430\u0440_11 \u0441\u0430\u0440_12 \u0441\u0430\u0440".split("_"),monthsParseExact:!0,weekdays:"\u041d\u044f\u043c_\u0414\u0430\u0432\u0430\u0430_\u041c\u044f\u0433\u043c\u0430\u0440_\u041b\u0445\u0430\u0433\u0432\u0430_\u041f\u04af\u0440\u044d\u0432_\u0411\u0430\u0430\u0441\u0430\u043d_\u0411\u044f\u043c\u0431\u0430".split("_"),weekdaysShort:"\u041d\u044f\u043c_\u0414\u0430\u0432_\u041c\u044f\u0433_\u041b\u0445\u0430_\u041f\u04af\u0440_\u0411\u0430\u0430_\u0411\u044f\u043c".split("_"),weekdaysMin:"\u041d\u044f_\u0414\u0430_\u041c\u044f_\u041b\u0445_\u041f\u04af_\u0411\u0430_\u0411\u044f".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY \u043e\u043d\u044b MMMM\u044b\u043d D",LLL:"YYYY \u043e\u043d\u044b MMMM\u044b\u043d D HH:mm",LLLL:"dddd, YYYY \u043e\u043d\u044b MMMM\u044b\u043d D HH:mm"},meridiemParse:/\u04ae\u04e8|\u04ae\u0425/i,isPM:function(input){return"\u04ae\u0425"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u04ae\u04e8":"\u04ae\u0425"},calendar:{sameDay:"[\u04e8\u043d\u04e9\u04e9\u0434\u04e9\u0440] LT",nextDay:"[\u041c\u0430\u0440\u0433\u0430\u0430\u0448] LT",nextWeek:"[\u0418\u0440\u044d\u0445] dddd LT",lastDay:"[\u04e8\u0447\u0438\u0433\u0434\u04e9\u0440] LT",lastWeek:"[\u04e8\u043d\u0433\u04e9\u0440\u0441\u04e9\u043d] dddd LT",sameElse:"L"},relativeTime:{future:"%s \u0434\u0430\u0440\u0430\u0430",past:"%s \u04e9\u043c\u043d\u04e9",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2} \u04e9\u0434\u04e9\u0440/,ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+" \u04e9\u0434\u04e9\u0440";default:return number}}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0967",2:"\u0968",3:"\u0969",4:"\u096a",5:"\u096b",6:"\u096c",7:"\u096d",8:"\u096e",9:"\u096f",0:"\u0966"},numberMap={"\u0967":"1","\u0968":"2","\u0969":"3","\u096a":"4","\u096b":"5","\u096c":"6","\u096d":"7","\u096e":"8","\u096f":"9","\u0966":"0"};function relativeTimeMr(number,withoutSuffix,string,isFuture){var output="";if(withoutSuffix)switch(string){case"s":output="\u0915\u093e\u0939\u0940 \u0938\u0947\u0915\u0902\u0926";break;case"ss":output="%d \u0938\u0947\u0915\u0902\u0926";break;case"m":output="\u090f\u0915 \u092e\u093f\u0928\u093f\u091f";break;case"mm":output="%d \u092e\u093f\u0928\u093f\u091f\u0947";break;case"h":output="\u090f\u0915 \u0924\u093e\u0938";break;case"hh":output="%d \u0924\u093e\u0938";break;case"d":output="\u090f\u0915 \u0926\u093f\u0935\u0938";break;case"dd":output="%d \u0926\u093f\u0935\u0938";break;case"M":output="\u090f\u0915 \u092e\u0939\u093f\u0928\u093e";break;case"MM":output="%d \u092e\u0939\u093f\u0928\u0947";break;case"y":output="\u090f\u0915 \u0935\u0930\u094d\u0937";break;case"yy":output="%d \u0935\u0930\u094d\u0937\u0947"}else switch(string){case"s":output="\u0915\u093e\u0939\u0940 \u0938\u0947\u0915\u0902\u0926\u093e\u0902";break;case"ss":output="%d \u0938\u0947\u0915\u0902\u0926\u093e\u0902";break;case"m":output="\u090f\u0915\u093e \u092e\u093f\u0928\u093f\u091f\u093e";break;case"mm":output="%d \u092e\u093f\u0928\u093f\u091f\u093e\u0902";break;case"h":output="\u090f\u0915\u093e \u0924\u093e\u0938\u093e";break;case"hh":output="%d \u0924\u093e\u0938\u093e\u0902";break;case"d":output="\u090f\u0915\u093e \u0926\u093f\u0935\u0938\u093e";break;case"dd":output="%d \u0926\u093f\u0935\u0938\u093e\u0902";break;case"M":output="\u090f\u0915\u093e \u092e\u0939\u093f\u0928\u094d\u092f\u093e";break;case"MM":output="%d \u092e\u0939\u093f\u0928\u094d\u092f\u093e\u0902";break;case"y":output="\u090f\u0915\u093e \u0935\u0930\u094d\u0937\u093e";break;case"yy":output="%d \u0935\u0930\u094d\u0937\u093e\u0902"}return output.replace(/%d/i,number)}moment.defineLocale("mr",{months:"\u091c\u093e\u0928\u0947\u0935\u093e\u0930\u0940_\u092b\u0947\u092c\u094d\u0930\u0941\u0935\u093e\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u090f\u092a\u094d\u0930\u093f\u0932_\u092e\u0947_\u091c\u0942\u0928_\u091c\u0941\u0932\u0948_\u0911\u0917\u0938\u094d\u091f_\u0938\u092a\u094d\u091f\u0947\u0902\u092c\u0930_\u0911\u0915\u094d\u091f\u094b\u092c\u0930_\u0928\u094b\u0935\u094d\u0939\u0947\u0902\u092c\u0930_\u0921\u093f\u0938\u0947\u0902\u092c\u0930".split("_"),monthsShort:"\u091c\u093e\u0928\u0947._\u092b\u0947\u092c\u094d\u0930\u0941._\u092e\u093e\u0930\u094d\u091a._\u090f\u092a\u094d\u0930\u093f._\u092e\u0947._\u091c\u0942\u0928._\u091c\u0941\u0932\u0948._\u0911\u0917._\u0938\u092a\u094d\u091f\u0947\u0902._\u0911\u0915\u094d\u091f\u094b._\u0928\u094b\u0935\u094d\u0939\u0947\u0902._\u0921\u093f\u0938\u0947\u0902.".split("_"),monthsParseExact:!0,weekdays:"\u0930\u0935\u093f\u0935\u093e\u0930_\u0938\u094b\u092e\u0935\u093e\u0930_\u092e\u0902\u0917\u0933\u0935\u093e\u0930_\u092c\u0941\u0927\u0935\u093e\u0930_\u0917\u0941\u0930\u0942\u0935\u093e\u0930_\u0936\u0941\u0915\u094d\u0930\u0935\u093e\u0930_\u0936\u0928\u093f\u0935\u093e\u0930".split("_"),weekdaysShort:"\u0930\u0935\u093f_\u0938\u094b\u092e_\u092e\u0902\u0917\u0933_\u092c\u0941\u0927_\u0917\u0941\u0930\u0942_\u0936\u0941\u0915\u094d\u0930_\u0936\u0928\u093f".split("_"),weekdaysMin:"\u0930_\u0938\u094b_\u092e\u0902_\u092c\u0941_\u0917\u0941_\u0936\u0941_\u0936".split("_"),longDateFormat:{LT:"A h:mm \u0935\u093e\u091c\u0924\u093e",LTS:"A h:mm:ss \u0935\u093e\u091c\u0924\u093e",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u0935\u093e\u091c\u0924\u093e",LLLL:"dddd, D MMMM YYYY, A h:mm \u0935\u093e\u091c\u0924\u093e"},calendar:{sameDay:"[\u0906\u091c] LT",nextDay:"[\u0909\u0926\u094d\u092f\u093e] LT",nextWeek:"dddd, LT",lastDay:"[\u0915\u093e\u0932] LT",lastWeek:"[\u092e\u093e\u0917\u0940\u0932] dddd, LT",sameElse:"L"},relativeTime:{future:"%s\u092e\u0927\u094d\u092f\u0947",past:"%s\u092a\u0942\u0930\u094d\u0935\u0940",s:relativeTimeMr,ss:relativeTimeMr,m:relativeTimeMr,mm:relativeTimeMr,h:relativeTimeMr,hh:relativeTimeMr,d:relativeTimeMr,dd:relativeTimeMr,M:relativeTimeMr,MM:relativeTimeMr,y:relativeTimeMr,yy:relativeTimeMr},preparse:function(string){return string.replace(/[\u0967\u0968\u0969\u096a\u096b\u096c\u096d\u096e\u096f\u0966]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u092a\u0939\u093e\u091f\u0947|\u0938\u0915\u093e\u0933\u0940|\u0926\u0941\u092a\u093e\u0930\u0940|\u0938\u093e\u092f\u0902\u0915\u093e\u0933\u0940|\u0930\u093e\u0924\u094d\u0930\u0940/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u092a\u0939\u093e\u091f\u0947"===meridiem||"\u0938\u0915\u093e\u0933\u0940"===meridiem?hour:"\u0926\u0941\u092a\u093e\u0930\u0940"===meridiem||"\u0938\u093e\u092f\u0902\u0915\u093e\u0933\u0940"===meridiem||"\u0930\u093e\u0924\u094d\u0930\u0940"===meridiem?hour>=12?hour:hour+12:void 0},meridiem:function(hour,minute,isLower){return hour>=0&&hour<6?"\u092a\u0939\u093e\u091f\u0947":hour<12?"\u0938\u0915\u093e\u0933\u0940":hour<17?"\u0926\u0941\u092a\u093e\u0930\u0940":hour<20?"\u0938\u093e\u092f\u0902\u0915\u093e\u0933\u0940":"\u0930\u093e\u0924\u094d\u0930\u0940"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ms",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"pagi"===meridiem?hour:"tengahari"===meridiem?hour>=11?hour:hour+12:"petang"===meridiem||"malam"===meridiem?hour+12:void 0},meridiem:function(hours,minutes,isLower){return hours<11?"pagi":hours<15?"tengahari":hours<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"pagi"===meridiem?hour:"tengahari"===meridiem?hour>=11?hour:hour+12:"petang"===meridiem||"malam"===meridiem?hour+12:void 0},meridiem:function(hours,minutes,isLower){return hours<11?"pagi":hours<15?"tengahari":hours<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("mt",{months:"Jannar_Frar_Marzu_April_Mejju_\u0120unju_Lulju_Awwissu_Settembru_Ottubru_Novembru_Di\u010bembru".split("_"),monthsShort:"Jan_Fra_Mar_Apr_Mej_\u0120un_Lul_Aww_Set_Ott_Nov_Di\u010b".split("_"),weekdays:"Il-\u0126add_It-Tnejn_It-Tlieta_L-Erbg\u0127a_Il-\u0126amis_Il-\u0120img\u0127a_Is-Sibt".split("_"),weekdaysShort:"\u0126ad_Tne_Tli_Erb_\u0126am_\u0120im_Sib".split("_"),weekdaysMin:"\u0126a_Tn_Tl_Er_\u0126a_\u0120i_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Illum fil-]LT",nextDay:"[G\u0127ada fil-]LT",nextWeek:"dddd [fil-]LT",lastDay:"[Il-biera\u0127 fil-]LT",lastWeek:"dddd [li g\u0127adda] [fil-]LT",sameElse:"L"},relativeTime:{future:"f\u2019 %s",past:"%s ilu",s:"ftit sekondi",ss:"%d sekondi",m:"minuta",mm:"%d minuti",h:"sieg\u0127a",hh:"%d sieg\u0127at",d:"\u0121urnata",dd:"%d \u0121ranet",M:"xahar",MM:"%d xhur",y:"sena",yy:"%d sni"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u1041",2:"\u1042",3:"\u1043",4:"\u1044",5:"\u1045",6:"\u1046",7:"\u1047",8:"\u1048",9:"\u1049",0:"\u1040"},numberMap={"\u1041":"1","\u1042":"2","\u1043":"3","\u1044":"4","\u1045":"5","\u1046":"6","\u1047":"7","\u1048":"8","\u1049":"9","\u1040":"0"};moment.defineLocale("my",{months:"\u1007\u1014\u103a\u1014\u101d\u102b\u101b\u102e_\u1016\u1031\u1016\u1031\u102c\u103a\u101d\u102b\u101b\u102e_\u1019\u1010\u103a_\u1027\u1015\u103c\u102e_\u1019\u1031_\u1007\u103d\u1014\u103a_\u1007\u1030\u101c\u102d\u102f\u1004\u103a_\u101e\u103c\u1002\u102f\u1010\u103a_\u1005\u1000\u103a\u1010\u1004\u103a\u1018\u102c_\u1021\u1031\u102c\u1000\u103a\u1010\u102d\u102f\u1018\u102c_\u1014\u102d\u102f\u101d\u1004\u103a\u1018\u102c_\u1012\u102e\u1007\u1004\u103a\u1018\u102c".split("_"),monthsShort:"\u1007\u1014\u103a_\u1016\u1031_\u1019\u1010\u103a_\u1015\u103c\u102e_\u1019\u1031_\u1007\u103d\u1014\u103a_\u101c\u102d\u102f\u1004\u103a_\u101e\u103c_\u1005\u1000\u103a_\u1021\u1031\u102c\u1000\u103a_\u1014\u102d\u102f_\u1012\u102e".split("_"),weekdays:"\u1010\u1014\u1004\u103a\u1039\u1002\u1014\u103d\u1031_\u1010\u1014\u1004\u103a\u1039\u101c\u102c_\u1021\u1004\u103a\u1039\u1002\u102b_\u1017\u102f\u1012\u1039\u1013\u101f\u1030\u1038_\u1000\u103c\u102c\u101e\u1015\u1010\u1031\u1038_\u101e\u1031\u102c\u1000\u103c\u102c_\u1005\u1014\u1031".split("_"),weekdaysShort:"\u1014\u103d\u1031_\u101c\u102c_\u1002\u102b_\u101f\u1030\u1038_\u1000\u103c\u102c_\u101e\u1031\u102c_\u1014\u1031".split("_"),weekdaysMin:"\u1014\u103d\u1031_\u101c\u102c_\u1002\u102b_\u101f\u1030\u1038_\u1000\u103c\u102c_\u101e\u1031\u102c_\u1014\u1031".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u101a\u1014\u1031.] LT [\u1019\u103e\u102c]",nextDay:"[\u1019\u1014\u1000\u103a\u1016\u103c\u1014\u103a] LT [\u1019\u103e\u102c]",nextWeek:"dddd LT [\u1019\u103e\u102c]",lastDay:"[\u1019\u1014\u1031.\u1000] LT [\u1019\u103e\u102c]",lastWeek:"[\u1015\u103c\u102e\u1038\u1001\u1032\u1037\u101e\u1031\u102c] dddd LT [\u1019\u103e\u102c]",sameElse:"L"},relativeTime:{future:"\u101c\u102c\u1019\u100a\u103a\u1037 %s \u1019\u103e\u102c",past:"\u101c\u103d\u1014\u103a\u1001\u1032\u1037\u101e\u1031\u102c %s \u1000",s:"\u1005\u1000\u1039\u1000\u1014\u103a.\u1021\u1014\u100a\u103a\u1038\u1004\u101a\u103a",ss:"%d \u1005\u1000\u1039\u1000\u1014\u1037\u103a",m:"\u1010\u1005\u103a\u1019\u102d\u1014\u1005\u103a",mm:"%d \u1019\u102d\u1014\u1005\u103a",h:"\u1010\u1005\u103a\u1014\u102c\u101b\u102e",hh:"%d \u1014\u102c\u101b\u102e",d:"\u1010\u1005\u103a\u101b\u1000\u103a",dd:"%d \u101b\u1000\u103a",M:"\u1010\u1005\u103a\u101c",MM:"%d \u101c",y:"\u1010\u1005\u103a\u1014\u103e\u1005\u103a",yy:"%d \u1014\u103e\u1005\u103a"},preparse:function(string){return string.replace(/[\u1041\u1042\u1043\u1044\u1045\u1046\u1047\u1048\u1049\u1040]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"s\xf8ndag_mandag_tirsdag_onsdag_torsdag_fredag_l\xf8rdag".split("_"),weekdaysShort:"s\xf8._ma._ti._on._to._fr._l\xf8.".split("_"),weekdaysMin:"s\xf8_ma_ti_on_to_fr_l\xf8".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] HH:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i g\xe5r kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"noen sekunder",ss:"%d sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",w:"en uke",ww:"%d uker",M:"en m\xe5ned",MM:"%d m\xe5neder",y:"ett \xe5r",yy:"%d \xe5r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0967",2:"\u0968",3:"\u0969",4:"\u096a",5:"\u096b",6:"\u096c",7:"\u096d",8:"\u096e",9:"\u096f",0:"\u0966"},numberMap={"\u0967":"1","\u0968":"2","\u0969":"3","\u096a":"4","\u096b":"5","\u096c":"6","\u096d":"7","\u096e":"8","\u096f":"9","\u0966":"0"};moment.defineLocale("ne",{months:"\u091c\u0928\u0935\u0930\u0940_\u092b\u0947\u092c\u094d\u0930\u0941\u0935\u0930\u0940_\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u093f\u0932_\u092e\u0908_\u091c\u0941\u0928_\u091c\u0941\u0932\u093e\u0908_\u0905\u0917\u0937\u094d\u091f_\u0938\u0947\u092a\u094d\u091f\u0947\u092e\u094d\u092c\u0930_\u0905\u0915\u094d\u091f\u094b\u092c\u0930_\u0928\u094b\u092d\u0947\u092e\u094d\u092c\u0930_\u0921\u093f\u0938\u0947\u092e\u094d\u092c\u0930".split("_"),monthsShort:"\u091c\u0928._\u092b\u0947\u092c\u094d\u0930\u0941._\u092e\u093e\u0930\u094d\u091a_\u0905\u092a\u094d\u0930\u093f._\u092e\u0908_\u091c\u0941\u0928_\u091c\u0941\u0932\u093e\u0908._\u0905\u0917._\u0938\u0947\u092a\u094d\u091f._\u0905\u0915\u094d\u091f\u094b._\u0928\u094b\u092d\u0947._\u0921\u093f\u0938\u0947.".split("_"),monthsParseExact:!0,weekdays:"\u0906\u0907\u0924\u092c\u093e\u0930_\u0938\u094b\u092e\u092c\u093e\u0930_\u092e\u0919\u094d\u0917\u0932\u092c\u093e\u0930_\u092c\u0941\u0927\u092c\u093e\u0930_\u092c\u093f\u0939\u093f\u092c\u093e\u0930_\u0936\u0941\u0915\u094d\u0930\u092c\u093e\u0930_\u0936\u0928\u093f\u092c\u093e\u0930".split("_"),weekdaysShort:"\u0906\u0907\u0924._\u0938\u094b\u092e._\u092e\u0919\u094d\u0917\u0932._\u092c\u0941\u0927._\u092c\u093f\u0939\u093f._\u0936\u0941\u0915\u094d\u0930._\u0936\u0928\u093f.".split("_"),weekdaysMin:"\u0906._\u0938\u094b._\u092e\u0902._\u092c\u0941._\u092c\u093f._\u0936\u0941._\u0936.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A\u0915\u094b h:mm \u092c\u091c\u0947",LTS:"A\u0915\u094b h:mm:ss \u092c\u091c\u0947",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A\u0915\u094b h:mm \u092c\u091c\u0947",LLLL:"dddd, D MMMM YYYY, A\u0915\u094b h:mm \u092c\u091c\u0947"},preparse:function(string){return string.replace(/[\u0967\u0968\u0969\u096a\u096b\u096c\u096d\u096e\u096f\u0966]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u0930\u093e\u0924\u093f|\u092c\u093f\u0939\u093e\u0928|\u0926\u093f\u0909\u0901\u0938\u094b|\u0938\u093e\u0901\u091d/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0930\u093e\u0924\u093f"===meridiem?hour<4?hour:hour+12:"\u092c\u093f\u0939\u093e\u0928"===meridiem?hour:"\u0926\u093f\u0909\u0901\u0938\u094b"===meridiem?hour>=10?hour:hour+12:"\u0938\u093e\u0901\u091d"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<3?"\u0930\u093e\u0924\u093f":hour<12?"\u092c\u093f\u0939\u093e\u0928":hour<16?"\u0926\u093f\u0909\u0901\u0938\u094b":hour<20?"\u0938\u093e\u0901\u091d":"\u0930\u093e\u0924\u093f"},calendar:{sameDay:"[\u0906\u091c] LT",nextDay:"[\u092d\u094b\u0932\u093f] LT",nextWeek:"[\u0906\u0909\u0901\u0926\u094b] dddd[,] LT",lastDay:"[\u0939\u093f\u091c\u094b] LT",lastWeek:"[\u0917\u090f\u0915\u094b] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s\u092e\u093e",past:"%s \u0905\u0917\u093e\u0921\u093f",s:"\u0915\u0947\u0939\u0940 \u0915\u094d\u0937\u0923",ss:"%d \u0938\u0947\u0915\u0947\u0923\u094d\u0921",m:"\u090f\u0915 \u092e\u093f\u0928\u0947\u091f",mm:"%d \u092e\u093f\u0928\u0947\u091f",h:"\u090f\u0915 \u0918\u0923\u094d\u091f\u093e",hh:"%d \u0918\u0923\u094d\u091f\u093e",d:"\u090f\u0915 \u0926\u093f\u0928",dd:"%d \u0926\u093f\u0928",M:"\u090f\u0915 \u092e\u0939\u093f\u0928\u093e",MM:"%d \u092e\u0939\u093f\u0928\u093e",y:"\u090f\u0915 \u092c\u0930\u094d\u0937",yy:"%d \u092c\u0930\u094d\u0937"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsShortWithDots="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsShortWithoutDots="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),monthsParse=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],monthsRegex=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;moment.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(m,format){return m?/-MMM-/.test(format)?monthsShortWithoutDots[m.month()]:monthsShortWithDots[m.month()]:monthsShortWithDots},monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"\xe9\xe9n minuut",mm:"%d minuten",h:"\xe9\xe9n uur",hh:"%d uur",d:"\xe9\xe9n dag",dd:"%d dagen",w:"\xe9\xe9n week",ww:"%d weken",M:"\xe9\xe9n maand",MM:"%d maanden",y:"\xe9\xe9n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(number){return number+(1===number||8===number||number>=20?"ste":"de")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsShortWithDots="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsShortWithoutDots="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),monthsParse=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],monthsRegex=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;moment.defineLocale("nl-be",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(m,format){return m?/-MMM-/.test(format)?monthsShortWithoutDots[m.month()]:monthsShortWithDots[m.month()]:monthsShortWithDots},monthsRegex:monthsRegex,monthsShortRegex:monthsRegex,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"\xe9\xe9n minuut",mm:"%d minuten",h:"\xe9\xe9n uur",hh:"%d uur",d:"\xe9\xe9n dag",dd:"%d dagen",M:"\xe9\xe9n maand",MM:"%d maanden",y:"\xe9\xe9n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(number){return number+(1===number||8===number||number>=20?"ste":"de")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"sundag_m\xe5ndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"su._m\xe5._ty._on._to._fr._lau.".split("_"),weekdaysMin:"su_m\xe5_ty_on_to_fr_la".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I g\xe5r klokka] LT",lastWeek:"[F\xf8reg\xe5ande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s sidan",s:"nokre sekund",ss:"%d sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",w:"ei veke",ww:"%d veker",M:"ein m\xe5nad",MM:"%d m\xe5nader",y:"eit \xe5r",yy:"%d \xe5r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("oc-lnc",{months:{standalone:"geni\xe8r_febri\xe8r_mar\xe7_abril_mai_junh_julhet_agost_setembre_oct\xf2bre_novembre_decembre".split("_"),format:"de geni\xe8r_de febri\xe8r_de mar\xe7_d'abril_de mai_de junh_de julhet_d'agost_de setembre_d'oct\xf2bre_de novembre_de decembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar\xe7_abr._mai_junh_julh._ago._set._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"dimenge_diluns_dimars_dim\xe8cres_dij\xf2us_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dm._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dm_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:"[u\xe8i a] LT",nextDay:"[deman a] LT",nextWeek:"dddd [a] LT",lastDay:"[i\xe8r a] LT",lastWeek:"dddd [passat a] LT",sameElse:"L"},relativeTime:{future:"d'aqu\xed %s",past:"fa %s",s:"unas segondas",ss:"%d segondas",m:"una minuta",mm:"%d minutas",h:"una ora",hh:"%d oras",d:"un jorn",dd:"%d jorns",M:"un mes",MM:"%d meses",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t|\xe8|a)/,ordinal:function(number,period){var output=1===number?"r":2===number?"n":3===number?"r":4===number?"t":"\xe8";return"w"!==period&&"W"!==period||(output="a"),number+output},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0a67",2:"\u0a68",3:"\u0a69",4:"\u0a6a",5:"\u0a6b",6:"\u0a6c",7:"\u0a6d",8:"\u0a6e",9:"\u0a6f",0:"\u0a66"},numberMap={"\u0a67":"1","\u0a68":"2","\u0a69":"3","\u0a6a":"4","\u0a6b":"5","\u0a6c":"6","\u0a6d":"7","\u0a6e":"8","\u0a6f":"9","\u0a66":"0"};moment.defineLocale("pa-in",{months:"\u0a1c\u0a28\u0a35\u0a30\u0a40_\u0a2b\u0a3c\u0a30\u0a35\u0a30\u0a40_\u0a2e\u0a3e\u0a30\u0a1a_\u0a05\u0a2a\u0a4d\u0a30\u0a48\u0a32_\u0a2e\u0a08_\u0a1c\u0a42\u0a28_\u0a1c\u0a41\u0a32\u0a3e\u0a08_\u0a05\u0a17\u0a38\u0a24_\u0a38\u0a24\u0a70\u0a2c\u0a30_\u0a05\u0a15\u0a24\u0a42\u0a2c\u0a30_\u0a28\u0a35\u0a70\u0a2c\u0a30_\u0a26\u0a38\u0a70\u0a2c\u0a30".split("_"),monthsShort:"\u0a1c\u0a28\u0a35\u0a30\u0a40_\u0a2b\u0a3c\u0a30\u0a35\u0a30\u0a40_\u0a2e\u0a3e\u0a30\u0a1a_\u0a05\u0a2a\u0a4d\u0a30\u0a48\u0a32_\u0a2e\u0a08_\u0a1c\u0a42\u0a28_\u0a1c\u0a41\u0a32\u0a3e\u0a08_\u0a05\u0a17\u0a38\u0a24_\u0a38\u0a24\u0a70\u0a2c\u0a30_\u0a05\u0a15\u0a24\u0a42\u0a2c\u0a30_\u0a28\u0a35\u0a70\u0a2c\u0a30_\u0a26\u0a38\u0a70\u0a2c\u0a30".split("_"),weekdays:"\u0a10\u0a24\u0a35\u0a3e\u0a30_\u0a38\u0a4b\u0a2e\u0a35\u0a3e\u0a30_\u0a2e\u0a70\u0a17\u0a32\u0a35\u0a3e\u0a30_\u0a2c\u0a41\u0a27\u0a35\u0a3e\u0a30_\u0a35\u0a40\u0a30\u0a35\u0a3e\u0a30_\u0a38\u0a3c\u0a41\u0a71\u0a15\u0a30\u0a35\u0a3e\u0a30_\u0a38\u0a3c\u0a28\u0a40\u0a1a\u0a30\u0a35\u0a3e\u0a30".split("_"),weekdaysShort:"\u0a10\u0a24_\u0a38\u0a4b\u0a2e_\u0a2e\u0a70\u0a17\u0a32_\u0a2c\u0a41\u0a27_\u0a35\u0a40\u0a30_\u0a38\u0a3c\u0a41\u0a15\u0a30_\u0a38\u0a3c\u0a28\u0a40".split("_"),weekdaysMin:"\u0a10\u0a24_\u0a38\u0a4b\u0a2e_\u0a2e\u0a70\u0a17\u0a32_\u0a2c\u0a41\u0a27_\u0a35\u0a40\u0a30_\u0a38\u0a3c\u0a41\u0a15\u0a30_\u0a38\u0a3c\u0a28\u0a40".split("_"),longDateFormat:{LT:"A h:mm \u0a35\u0a1c\u0a47",LTS:"A h:mm:ss \u0a35\u0a1c\u0a47",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm \u0a35\u0a1c\u0a47",LLLL:"dddd, D MMMM YYYY, A h:mm \u0a35\u0a1c\u0a47"},calendar:{sameDay:"[\u0a05\u0a1c] LT",nextDay:"[\u0a15\u0a32] LT",nextWeek:"[\u0a05\u0a17\u0a32\u0a3e] dddd, LT",lastDay:"[\u0a15\u0a32] LT",lastWeek:"[\u0a2a\u0a3f\u0a1b\u0a32\u0a47] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0a35\u0a3f\u0a71\u0a1a",past:"%s \u0a2a\u0a3f\u0a1b\u0a32\u0a47",s:"\u0a15\u0a41\u0a1d \u0a38\u0a15\u0a3f\u0a70\u0a1f",ss:"%d \u0a38\u0a15\u0a3f\u0a70\u0a1f",m:"\u0a07\u0a15 \u0a2e\u0a3f\u0a70\u0a1f",mm:"%d \u0a2e\u0a3f\u0a70\u0a1f",h:"\u0a07\u0a71\u0a15 \u0a18\u0a70\u0a1f\u0a3e",hh:"%d \u0a18\u0a70\u0a1f\u0a47",d:"\u0a07\u0a71\u0a15 \u0a26\u0a3f\u0a28",dd:"%d \u0a26\u0a3f\u0a28",M:"\u0a07\u0a71\u0a15 \u0a2e\u0a39\u0a40\u0a28\u0a3e",MM:"%d \u0a2e\u0a39\u0a40\u0a28\u0a47",y:"\u0a07\u0a71\u0a15 \u0a38\u0a3e\u0a32",yy:"%d \u0a38\u0a3e\u0a32"},preparse:function(string){return string.replace(/[\u0a67\u0a68\u0a69\u0a6a\u0a6b\u0a6c\u0a6d\u0a6e\u0a6f\u0a66]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u0a30\u0a3e\u0a24|\u0a38\u0a35\u0a47\u0a30|\u0a26\u0a41\u0a2a\u0a39\u0a3f\u0a30|\u0a38\u0a3c\u0a3e\u0a2e/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0a30\u0a3e\u0a24"===meridiem?hour<4?hour:hour+12:"\u0a38\u0a35\u0a47\u0a30"===meridiem?hour:"\u0a26\u0a41\u0a2a\u0a39\u0a3f\u0a30"===meridiem?hour>=10?hour:hour+12:"\u0a38\u0a3c\u0a3e\u0a2e"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"\u0a30\u0a3e\u0a24":hour<10?"\u0a38\u0a35\u0a47\u0a30":hour<17?"\u0a26\u0a41\u0a2a\u0a39\u0a3f\u0a30":hour<20?"\u0a38\u0a3c\u0a3e\u0a2e":"\u0a30\u0a3e\u0a24"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var monthsNominative="stycze\u0144_luty_marzec_kwiecie\u0144_maj_czerwiec_lipiec_sierpie\u0144_wrzesie\u0144_pa\u017adziernik_listopad_grudzie\u0144".split("_"),monthsSubjective="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrze\u015bnia_pa\u017adziernika_listopada_grudnia".split("_"),monthsParse=[/^sty/i,/^lut/i,/^mar/i,/^kwi/i,/^maj/i,/^cze/i,/^lip/i,/^sie/i,/^wrz/i,/^pa\u017a/i,/^lis/i,/^gru/i];function plural(n){return n%10<5&&n%10>1&&~~(n/10)%10!=1}function translate(number,withoutSuffix,key){var result=number+" ";switch(key){case"ss":return result+(plural(number)?"sekundy":"sekund");case"m":return withoutSuffix?"minuta":"minut\u0119";case"mm":return result+(plural(number)?"minuty":"minut");case"h":return withoutSuffix?"godzina":"godzin\u0119";case"hh":return result+(plural(number)?"godziny":"godzin");case"ww":return result+(plural(number)?"tygodnie":"tygodni");case"MM":return result+(plural(number)?"miesi\u0105ce":"miesi\u0119cy");case"yy":return result+(plural(number)?"lata":"lat")}}moment.defineLocale("pl",{months:function(momentToFormat,format){return momentToFormat?/D MMMM/.test(format)?monthsSubjective[momentToFormat.month()]:monthsNominative[momentToFormat.month()]:monthsNominative},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa\u017a_lis_gru".split("_"),monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,weekdays:"niedziela_poniedzia\u0142ek_wtorek_\u015broda_czwartek_pi\u0105tek_sobota".split("_"),weekdaysShort:"ndz_pon_wt_\u015br_czw_pt_sob".split("_"),weekdaysMin:"Nd_Pn_Wt_\u015ar_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Dzi\u015b o] LT",nextDay:"[Jutro o] LT",nextWeek:function(){switch(this.day()){case 0:return"[W niedziel\u0119 o] LT";case 2:return"[We wtorek o] LT";case 3:return"[W \u015brod\u0119 o] LT";case 6:return"[W sobot\u0119 o] LT";default:return"[W] dddd [o] LT"}},lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz\u0142\u0105 niedziel\u0119 o] LT";case 3:return"[W zesz\u0142\u0105 \u015brod\u0119 o] LT";case 6:return"[W zesz\u0142\u0105 sobot\u0119 o] LT";default:return"[W zesz\u0142y] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"1 dzie\u0144",dd:"%d dni",w:"tydzie\u0144",ww:translate,M:"miesi\u0105c",MM:translate,y:"rok",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("pt",{months:"janeiro_fevereiro_mar\xe7o_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"Domingo_Segunda-feira_Ter\xe7a-feira_Quarta-feira_Quinta-feira_Sexta-feira_S\xe1bado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_S\xe1b".split("_"),weekdaysMin:"Do_2\xaa_3\xaa_4\xaa_5\xaa_6\xaa_S\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY HH:mm"},calendar:{sameDay:"[Hoje \xe0s] LT",nextDay:"[Amanh\xe3 \xe0s] LT",nextWeek:"dddd [\xe0s] LT",lastDay:"[Ontem \xe0s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[\xdaltimo] dddd [\xe0s] LT":"[\xdaltima] dddd [\xe0s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h\xe1 %s",s:"segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",w:"uma semana",ww:"%d semanas",M:"um m\xeas",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("pt-br",{months:"janeiro_fevereiro_mar\xe7o_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_ter\xe7a-feira_quarta-feira_quinta-feira_sexta-feira_s\xe1bado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_s\xe1b".split("_"),weekdaysMin:"do_2\xaa_3\xaa_4\xaa_5\xaa_6\xaa_s\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [\xe0s] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [\xe0s] HH:mm"},calendar:{sameDay:"[Hoje \xe0s] LT",nextDay:"[Amanh\xe3 \xe0s] LT",nextWeek:"dddd [\xe0s] LT",lastDay:"[Ontem \xe0s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[\xdaltimo] dddd [\xe0s] LT":"[\xdaltima] dddd [\xe0s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h\xe1 %s",s:"poucos segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um m\xeas",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}\xba/,ordinal:"%d\xba",invalidDate:"Data inv\xe1lida"})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function relativeTimeWithPlural(number,withoutSuffix,key){var separator=" ";return(number%100>=20||number>=100&&number%100==0)&&(separator=" de "),number+separator+{ss:"secunde",mm:"minute",hh:"ore",dd:"zile",ww:"s\u0103pt\u0103m\xe2ni",MM:"luni",yy:"ani"}[key]}moment.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._feb._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"duminic\u0103_luni_mar\u021bi_miercuri_joi_vineri_s\xe2mb\u0103t\u0103".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_S\xe2m".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S\xe2".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[m\xe2ine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s \xeen urm\u0103",s:"c\xe2teva secunde",ss:relativeTimeWithPlural,m:"un minut",mm:relativeTimeWithPlural,h:"o or\u0103",hh:relativeTimeWithPlural,d:"o zi",dd:relativeTimeWithPlural,w:"o s\u0103pt\u0103m\xe2n\u0103",ww:relativeTimeWithPlural,M:"o lun\u0103",MM:relativeTimeWithPlural,y:"un an",yy:relativeTimeWithPlural},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function relativeTimeWithPlural(number,withoutSuffix,key){var num,forms;return"m"===key?withoutSuffix?"\u043c\u0438\u043d\u0443\u0442\u0430":"\u043c\u0438\u043d\u0443\u0442\u0443":number+" "+(num=+number,forms={ss:withoutSuffix?"\u0441\u0435\u043a\u0443\u043d\u0434\u0430_\u0441\u0435\u043a\u0443\u043d\u0434\u044b_\u0441\u0435\u043a\u0443\u043d\u0434":"\u0441\u0435\u043a\u0443\u043d\u0434\u0443_\u0441\u0435\u043a\u0443\u043d\u0434\u044b_\u0441\u0435\u043a\u0443\u043d\u0434",mm:withoutSuffix?"\u043c\u0438\u043d\u0443\u0442\u0430_\u043c\u0438\u043d\u0443\u0442\u044b_\u043c\u0438\u043d\u0443\u0442":"\u043c\u0438\u043d\u0443\u0442\u0443_\u043c\u0438\u043d\u0443\u0442\u044b_\u043c\u0438\u043d\u0443\u0442",hh:"\u0447\u0430\u0441_\u0447\u0430\u0441\u0430_\u0447\u0430\u0441\u043e\u0432",dd:"\u0434\u0435\u043d\u044c_\u0434\u043d\u044f_\u0434\u043d\u0435\u0439",ww:"\u043d\u0435\u0434\u0435\u043b\u044f_\u043d\u0435\u0434\u0435\u043b\u0438_\u043d\u0435\u0434\u0435\u043b\u044c",MM:"\u043c\u0435\u0441\u044f\u0446_\u043c\u0435\u0441\u044f\u0446\u0430_\u043c\u0435\u0441\u044f\u0446\u0435\u0432",yy:"\u0433\u043e\u0434_\u0433\u043e\u0434\u0430_\u043b\u0435\u0442"}[key].split("_"),num%10==1&&num%100!=11?forms[0]:num%10>=2&&num%10<=4&&(num%100<10||num%100>=20)?forms[1]:forms[2])}var monthsParse=[/^\u044f\u043d\u0432/i,/^\u0444\u0435\u0432/i,/^\u043c\u0430\u0440/i,/^\u0430\u043f\u0440/i,/^\u043c\u0430[\u0439\u044f]/i,/^\u0438\u044e\u043d/i,/^\u0438\u044e\u043b/i,/^\u0430\u0432\u0433/i,/^\u0441\u0435\u043d/i,/^\u043e\u043a\u0442/i,/^\u043d\u043e\u044f/i,/^\u0434\u0435\u043a/i];moment.defineLocale("ru",{months:{format:"\u044f\u043d\u0432\u0430\u0440\u044f_\u0444\u0435\u0432\u0440\u0430\u043b\u044f_\u043c\u0430\u0440\u0442\u0430_\u0430\u043f\u0440\u0435\u043b\u044f_\u043c\u0430\u044f_\u0438\u044e\u043d\u044f_\u0438\u044e\u043b\u044f_\u0430\u0432\u0433\u0443\u0441\u0442\u0430_\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f_\u043e\u043a\u0442\u044f\u0431\u0440\u044f_\u043d\u043e\u044f\u0431\u0440\u044f_\u0434\u0435\u043a\u0430\u0431\u0440\u044f".split("_"),standalone:"\u044f\u043d\u0432\u0430\u0440\u044c_\u0444\u0435\u0432\u0440\u0430\u043b\u044c_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0435\u043b\u044c_\u043c\u0430\u0439_\u0438\u044e\u043d\u044c_\u0438\u044e\u043b\u044c_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044c_\u043e\u043a\u0442\u044f\u0431\u0440\u044c_\u043d\u043e\u044f\u0431\u0440\u044c_\u0434\u0435\u043a\u0430\u0431\u0440\u044c".split("_")},monthsShort:{format:"\u044f\u043d\u0432._\u0444\u0435\u0432\u0440._\u043c\u0430\u0440._\u0430\u043f\u0440._\u043c\u0430\u044f_\u0438\u044e\u043d\u044f_\u0438\u044e\u043b\u044f_\u0430\u0432\u0433._\u0441\u0435\u043d\u0442._\u043e\u043a\u0442._\u043d\u043e\u044f\u0431._\u0434\u0435\u043a.".split("_"),standalone:"\u044f\u043d\u0432._\u0444\u0435\u0432\u0440._\u043c\u0430\u0440\u0442_\u0430\u043f\u0440._\u043c\u0430\u0439_\u0438\u044e\u043d\u044c_\u0438\u044e\u043b\u044c_\u0430\u0432\u0433._\u0441\u0435\u043d\u0442._\u043e\u043a\u0442._\u043d\u043e\u044f\u0431._\u0434\u0435\u043a.".split("_")},weekdays:{standalone:"\u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435_\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a_\u0432\u0442\u043e\u0440\u043d\u0438\u043a_\u0441\u0440\u0435\u0434\u0430_\u0447\u0435\u0442\u0432\u0435\u0440\u0433_\u043f\u044f\u0442\u043d\u0438\u0446\u0430_\u0441\u0443\u0431\u0431\u043e\u0442\u0430".split("_"),format:"\u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435_\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a_\u0432\u0442\u043e\u0440\u043d\u0438\u043a_\u0441\u0440\u0435\u0434\u0443_\u0447\u0435\u0442\u0432\u0435\u0440\u0433_\u043f\u044f\u0442\u043d\u0438\u0446\u0443_\u0441\u0443\u0431\u0431\u043e\u0442\u0443".split("_"),isFormat:/\[ ?[\u0412\u0432] ?(?:\u043f\u0440\u043e\u0448\u043b\u0443\u044e|\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e|\u044d\u0442\u0443)? ?] ?dddd/},weekdaysShort:"\u0432\u0441_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),weekdaysMin:"\u0432\u0441_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),monthsParse:monthsParse,longMonthsParse:monthsParse,shortMonthsParse:monthsParse,monthsRegex:/^(\u044f\u043d\u0432\u0430\u0440[\u044c\u044f]|\u044f\u043d\u0432\.?|\u0444\u0435\u0432\u0440\u0430\u043b[\u044c\u044f]|\u0444\u0435\u0432\u0440?\.?|\u043c\u0430\u0440\u0442\u0430?|\u043c\u0430\u0440\.?|\u0430\u043f\u0440\u0435\u043b[\u044c\u044f]|\u0430\u043f\u0440\.?|\u043c\u0430[\u0439\u044f]|\u0438\u044e\u043d[\u044c\u044f]|\u0438\u044e\u043d\.?|\u0438\u044e\u043b[\u044c\u044f]|\u0438\u044e\u043b\.?|\u0430\u0432\u0433\u0443\u0441\u0442\u0430?|\u0430\u0432\u0433\.?|\u0441\u0435\u043d\u0442\u044f\u0431\u0440[\u044c\u044f]|\u0441\u0435\u043d\u0442?\.?|\u043e\u043a\u0442\u044f\u0431\u0440[\u044c\u044f]|\u043e\u043a\u0442\.?|\u043d\u043e\u044f\u0431\u0440[\u044c\u044f]|\u043d\u043e\u044f\u0431?\.?|\u0434\u0435\u043a\u0430\u0431\u0440[\u044c\u044f]|\u0434\u0435\u043a\.?)/i,monthsShortRegex:/^(\u044f\u043d\u0432\u0430\u0440[\u044c\u044f]|\u044f\u043d\u0432\.?|\u0444\u0435\u0432\u0440\u0430\u043b[\u044c\u044f]|\u0444\u0435\u0432\u0440?\.?|\u043c\u0430\u0440\u0442\u0430?|\u043c\u0430\u0440\.?|\u0430\u043f\u0440\u0435\u043b[\u044c\u044f]|\u0430\u043f\u0440\.?|\u043c\u0430[\u0439\u044f]|\u0438\u044e\u043d[\u044c\u044f]|\u0438\u044e\u043d\.?|\u0438\u044e\u043b[\u044c\u044f]|\u0438\u044e\u043b\.?|\u0430\u0432\u0433\u0443\u0441\u0442\u0430?|\u0430\u0432\u0433\.?|\u0441\u0435\u043d\u0442\u044f\u0431\u0440[\u044c\u044f]|\u0441\u0435\u043d\u0442?\.?|\u043e\u043a\u0442\u044f\u0431\u0440[\u044c\u044f]|\u043e\u043a\u0442\.?|\u043d\u043e\u044f\u0431\u0440[\u044c\u044f]|\u043d\u043e\u044f\u0431?\.?|\u0434\u0435\u043a\u0430\u0431\u0440[\u044c\u044f]|\u0434\u0435\u043a\.?)/i,monthsStrictRegex:/^(\u044f\u043d\u0432\u0430\u0440[\u044f\u044c]|\u0444\u0435\u0432\u0440\u0430\u043b[\u044f\u044c]|\u043c\u0430\u0440\u0442\u0430?|\u0430\u043f\u0440\u0435\u043b[\u044f\u044c]|\u043c\u0430[\u044f\u0439]|\u0438\u044e\u043d[\u044f\u044c]|\u0438\u044e\u043b[\u044f\u044c]|\u0430\u0432\u0433\u0443\u0441\u0442\u0430?|\u0441\u0435\u043d\u0442\u044f\u0431\u0440[\u044f\u044c]|\u043e\u043a\u0442\u044f\u0431\u0440[\u044f\u044c]|\u043d\u043e\u044f\u0431\u0440[\u044f\u044c]|\u0434\u0435\u043a\u0430\u0431\u0440[\u044f\u044c])/i,monthsShortStrictRegex:/^(\u044f\u043d\u0432\.|\u0444\u0435\u0432\u0440?\.|\u043c\u0430\u0440[\u0442.]|\u0430\u043f\u0440\.|\u043c\u0430[\u044f\u0439]|\u0438\u044e\u043d[\u044c\u044f.]|\u0438\u044e\u043b[\u044c\u044f.]|\u0430\u0432\u0433\.|\u0441\u0435\u043d\u0442?\.|\u043e\u043a\u0442\.|\u043d\u043e\u044f\u0431?\.|\u0434\u0435\u043a\.)/i,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY \u0433.",LLL:"D MMMM YYYY \u0433., H:mm",LLLL:"dddd, D MMMM YYYY \u0433., H:mm"},calendar:{sameDay:"[\u0421\u0435\u0433\u043e\u0434\u043d\u044f, \u0432] LT",nextDay:"[\u0417\u0430\u0432\u0442\u0440\u0430, \u0432] LT",lastDay:"[\u0412\u0447\u0435\u0440\u0430, \u0432] LT",nextWeek:function(now){if(now.week()===this.week())return 2===this.day()?"[\u0412\u043e] dddd, [\u0432] LT":"[\u0412] dddd, [\u0432] LT";switch(this.day()){case 0:return"[\u0412 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0435] dddd, [\u0432] LT";case 1:case 2:case 4:return"[\u0412 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439] dddd, [\u0432] LT";case 3:case 5:case 6:return"[\u0412 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e] dddd, [\u0432] LT"}},lastWeek:function(now){if(now.week()===this.week())return 2===this.day()?"[\u0412\u043e] dddd, [\u0432] LT":"[\u0412] dddd, [\u0432] LT";switch(this.day()){case 0:return"[\u0412 \u043f\u0440\u043e\u0448\u043b\u043e\u0435] dddd, [\u0432] LT";case 1:case 2:case 4:return"[\u0412 \u043f\u0440\u043e\u0448\u043b\u044b\u0439] dddd, [\u0432] LT";case 3:case 5:case 6:return"[\u0412 \u043f\u0440\u043e\u0448\u043b\u0443\u044e] dddd, [\u0432] LT"}},sameElse:"L"},relativeTime:{future:"\u0447\u0435\u0440\u0435\u0437 %s",past:"%s \u043d\u0430\u0437\u0430\u0434",s:"\u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0441\u0435\u043a\u0443\u043d\u0434",ss:relativeTimeWithPlural,m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:"\u0447\u0430\u0441",hh:relativeTimeWithPlural,d:"\u0434\u0435\u043d\u044c",dd:relativeTimeWithPlural,w:"\u043d\u0435\u0434\u0435\u043b\u044f",ww:relativeTimeWithPlural,M:"\u043c\u0435\u0441\u044f\u0446",MM:relativeTimeWithPlural,y:"\u0433\u043e\u0434",yy:relativeTimeWithPlural},meridiemParse:/\u043d\u043e\u0447\u0438|\u0443\u0442\u0440\u0430|\u0434\u043d\u044f|\u0432\u0435\u0447\u0435\u0440\u0430/i,isPM:function(input){return/^(\u0434\u043d\u044f|\u0432\u0435\u0447\u0435\u0440\u0430)$/.test(input)},meridiem:function(hour,minute,isLower){return hour<4?"\u043d\u043e\u0447\u0438":hour<12?"\u0443\u0442\u0440\u0430":hour<17?"\u0434\u043d\u044f":"\u0432\u0435\u0447\u0435\u0440\u0430"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0439|\u0433\u043e|\u044f)/,ordinal:function(number,period){switch(period){case"M":case"d":case"DDD":return number+"-\u0439";case"D":return number+"-\u0433\u043e";case"w":case"W":return number+"-\u044f";default:return number}},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var months=["\u062c\u0646\u0648\u0631\u064a","\u0641\u064a\u0628\u0631\u0648\u0631\u064a","\u0645\u0627\u0631\u0686","\u0627\u067e\u0631\u064a\u0644","\u0645\u0626\u064a","\u062c\u0648\u0646","\u062c\u0648\u0644\u0627\u0621\u0650","\u0622\u06af\u0633\u067d","\u0633\u064a\u067e\u067d\u0645\u0628\u0631","\u0622\u06aa\u067d\u0648\u0628\u0631","\u0646\u0648\u0645\u0628\u0631","\u068a\u0633\u0645\u0628\u0631"],days=["\u0622\u0686\u0631","\u0633\u0648\u0645\u0631","\u0627\u06b1\u0627\u0631\u0648","\u0627\u0631\u0628\u0639","\u062e\u0645\u064a\u0633","\u062c\u0645\u0639","\u0687\u0646\u0687\u0631"];moment.defineLocale("sd",{months:months,monthsShort:months,weekdays:days,weekdaysShort:days,weekdaysMin:days,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd\u060c D MMMM YYYY HH:mm"},meridiemParse:/\u0635\u0628\u062d|\u0634\u0627\u0645/,isPM:function(input){return"\u0634\u0627\u0645"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0635\u0628\u062d":"\u0634\u0627\u0645"},calendar:{sameDay:"[\u0627\u0684] LT",nextDay:"[\u0633\u0680\u0627\u06bb\u064a] LT",nextWeek:"dddd [\u0627\u06b3\u064a\u0646 \u0647\u0641\u062a\u064a \u062a\u064a] LT",lastDay:"[\u06aa\u0627\u0644\u0647\u0647] LT",lastWeek:"[\u06af\u0632\u0631\u064a\u0644 \u0647\u0641\u062a\u064a] dddd [\u062a\u064a] LT",sameElse:"L"},relativeTime:{future:"%s \u067e\u0648\u0621",past:"%s \u0627\u06b3",s:"\u0686\u0646\u062f \u0633\u064a\u06aa\u0646\u068a",ss:"%d \u0633\u064a\u06aa\u0646\u068a",m:"\u0647\u06aa \u0645\u0646\u067d",mm:"%d \u0645\u0646\u067d",h:"\u0647\u06aa \u06aa\u0644\u0627\u06aa",hh:"%d \u06aa\u0644\u0627\u06aa",d:"\u0647\u06aa \u068f\u064a\u0646\u0647\u0646",dd:"%d \u068f\u064a\u0646\u0647\u0646",M:"\u0647\u06aa \u0645\u0647\u064a\u0646\u0648",MM:"%d \u0645\u0647\u064a\u0646\u0627",y:"\u0647\u06aa \u0633\u0627\u0644",yy:"%d \u0633\u0627\u0644"},preparse:function(string){return string.replace(/\u060c/g,",")},postformat:function(string){return string.replace(/,/g,"\u060c")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("se",{months:"o\u0111\u0111ajagem\xe1nnu_guovvam\xe1nnu_njuk\u010dam\xe1nnu_cuo\u014bom\xe1nnu_miessem\xe1nnu_geassem\xe1nnu_suoidnem\xe1nnu_borgem\xe1nnu_\u010dak\u010dam\xe1nnu_golggotm\xe1nnu_sk\xe1bmam\xe1nnu_juovlam\xe1nnu".split("_"),monthsShort:"o\u0111\u0111j_guov_njuk_cuo_mies_geas_suoi_borg_\u010dak\u010d_golg_sk\xe1b_juov".split("_"),weekdays:"sotnabeaivi_vuoss\xe1rga_ma\u014b\u014beb\xe1rga_gaskavahkku_duorastat_bearjadat_l\xe1vvardat".split("_"),weekdaysShort:"sotn_vuos_ma\u014b_gask_duor_bear_l\xe1v".split("_"),weekdaysMin:"s_v_m_g_d_b_L".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"MMMM D. [b.] YYYY",LLL:"MMMM D. [b.] YYYY [ti.] HH:mm",LLLL:"dddd, MMMM D. [b.] YYYY [ti.] HH:mm"},calendar:{sameDay:"[otne ti] LT",nextDay:"[ihttin ti] LT",nextWeek:"dddd [ti] LT",lastDay:"[ikte ti] LT",lastWeek:"[ovddit] dddd [ti] LT",sameElse:"L"},relativeTime:{future:"%s gea\u017ees",past:"ma\u014bit %s",s:"moadde sekunddat",ss:"%d sekunddat",m:"okta minuhta",mm:"%d minuhtat",h:"okta diimmu",hh:"%d diimmut",d:"okta beaivi",dd:"%d beaivvit",M:"okta m\xe1nnu",MM:"%d m\xe1nut",y:"okta jahki",yy:"%d jagit"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("si",{months:"\u0da2\u0db1\u0dc0\u0dcf\u0dbb\u0dd2_\u0db4\u0dd9\u0db6\u0dbb\u0dc0\u0dcf\u0dbb\u0dd2_\u0db8\u0dcf\u0dbb\u0dca\u0dad\u0dd4_\u0d85\u0db4\u0dca\u200d\u0dbb\u0dda\u0dbd\u0dca_\u0db8\u0dd0\u0dba\u0dd2_\u0da2\u0dd6\u0db1\u0dd2_\u0da2\u0dd6\u0dbd\u0dd2_\u0d85\u0d9c\u0ddd\u0dc3\u0dca\u0dad\u0dd4_\u0dc3\u0dd0\u0db4\u0dca\u0dad\u0dd0\u0db8\u0dca\u0db6\u0dbb\u0dca_\u0d94\u0d9a\u0dca\u0dad\u0ddd\u0db6\u0dbb\u0dca_\u0db1\u0ddc\u0dc0\u0dd0\u0db8\u0dca\u0db6\u0dbb\u0dca_\u0daf\u0dd9\u0dc3\u0dd0\u0db8\u0dca\u0db6\u0dbb\u0dca".split("_"),monthsShort:"\u0da2\u0db1_\u0db4\u0dd9\u0db6_\u0db8\u0dcf\u0dbb\u0dca_\u0d85\u0db4\u0dca_\u0db8\u0dd0\u0dba\u0dd2_\u0da2\u0dd6\u0db1\u0dd2_\u0da2\u0dd6\u0dbd\u0dd2_\u0d85\u0d9c\u0ddd_\u0dc3\u0dd0\u0db4\u0dca_\u0d94\u0d9a\u0dca_\u0db1\u0ddc\u0dc0\u0dd0_\u0daf\u0dd9\u0dc3\u0dd0".split("_"),weekdays:"\u0d89\u0dbb\u0dd2\u0daf\u0dcf_\u0dc3\u0db3\u0dd4\u0daf\u0dcf_\u0d85\u0d9f\u0dc4\u0dbb\u0dd4\u0dc0\u0dcf\u0daf\u0dcf_\u0db6\u0daf\u0dcf\u0daf\u0dcf_\u0db6\u0dca\u200d\u0dbb\u0dc4\u0dc3\u0dca\u0db4\u0dad\u0dd2\u0db1\u0dca\u0daf\u0dcf_\u0dc3\u0dd2\u0d9a\u0dd4\u0dbb\u0dcf\u0daf\u0dcf_\u0dc3\u0dd9\u0db1\u0dc3\u0dd4\u0dbb\u0dcf\u0daf\u0dcf".split("_"),weekdaysShort:"\u0d89\u0dbb\u0dd2_\u0dc3\u0db3\u0dd4_\u0d85\u0d9f_\u0db6\u0daf\u0dcf_\u0db6\u0dca\u200d\u0dbb\u0dc4_\u0dc3\u0dd2\u0d9a\u0dd4_\u0dc3\u0dd9\u0db1".split("_"),weekdaysMin:"\u0d89_\u0dc3_\u0d85_\u0db6_\u0db6\u0dca\u200d\u0dbb_\u0dc3\u0dd2_\u0dc3\u0dd9".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"a h:mm",LTS:"a h:mm:ss",L:"YYYY/MM/DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D, a h:mm",LLLL:"YYYY MMMM D [\u0dc0\u0dd0\u0db1\u0dd2] dddd, a h:mm:ss"},calendar:{sameDay:"[\u0d85\u0daf] LT[\u0da7]",nextDay:"[\u0dc4\u0dd9\u0da7] LT[\u0da7]",nextWeek:"dddd LT[\u0da7]",lastDay:"[\u0d8a\u0dba\u0dda] LT[\u0da7]",lastWeek:"[\u0db4\u0dc3\u0dd4\u0d9c\u0dd2\u0dba] dddd LT[\u0da7]",sameElse:"L"},relativeTime:{future:"%s\u0d9a\u0dd2\u0db1\u0dca",past:"%s\u0d9a\u0da7 \u0db4\u0dd9\u0dbb",s:"\u0dad\u0dad\u0dca\u0db4\u0dbb \u0d9a\u0dd2\u0dc4\u0dd2\u0db4\u0dba",ss:"\u0dad\u0dad\u0dca\u0db4\u0dbb %d",m:"\u0db8\u0dd2\u0db1\u0dd2\u0dad\u0dca\u0dad\u0dd4\u0dc0",mm:"\u0db8\u0dd2\u0db1\u0dd2\u0dad\u0dca\u0dad\u0dd4 %d",h:"\u0db4\u0dd0\u0dba",hh:"\u0db4\u0dd0\u0dba %d",d:"\u0daf\u0dd2\u0db1\u0dba",dd:"\u0daf\u0dd2\u0db1 %d",M:"\u0db8\u0dcf\u0dc3\u0dba",MM:"\u0db8\u0dcf\u0dc3 %d",y:"\u0dc0\u0dc3\u0dbb",yy:"\u0dc0\u0dc3\u0dbb %d"},dayOfMonthOrdinalParse:/\d{1,2} \u0dc0\u0dd0\u0db1\u0dd2/,ordinal:function(number){return number+" \u0dc0\u0dd0\u0db1\u0dd2"},meridiemParse:/\u0db4\u0dd9\u0dbb \u0dc0\u0dbb\u0dd4|\u0db4\u0dc3\u0dca \u0dc0\u0dbb\u0dd4|\u0db4\u0dd9.\u0dc0|\u0db4.\u0dc0./,isPM:function(input){return"\u0db4.\u0dc0."===input||"\u0db4\u0dc3\u0dca \u0dc0\u0dbb\u0dd4"===input},meridiem:function(hours,minutes,isLower){return hours>11?isLower?"\u0db4.\u0dc0.":"\u0db4\u0dc3\u0dca \u0dc0\u0dbb\u0dd4":isLower?"\u0db4\u0dd9.\u0dc0.":"\u0db4\u0dd9\u0dbb \u0dc0\u0dbb\u0dd4"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var months="janu\xe1r_febru\xe1r_marec_apr\xedl_m\xe1j_j\xfan_j\xfal_august_september_okt\xf3ber_november_december".split("_"),monthsShort="jan_feb_mar_apr_m\xe1j_j\xfan_j\xfal_aug_sep_okt_nov_dec".split("_");function plural(n){return n>1&&n<5}function translate(number,withoutSuffix,key,isFuture){var result=number+" ";switch(key){case"s":return withoutSuffix||isFuture?"p\xe1r sek\xfand":"p\xe1r sekundami";case"ss":return withoutSuffix||isFuture?result+(plural(number)?"sekundy":"sek\xfand"):result+"sekundami";case"m":return withoutSuffix?"min\xfata":isFuture?"min\xfatu":"min\xfatou";case"mm":return withoutSuffix||isFuture?result+(plural(number)?"min\xfaty":"min\xfat"):result+"min\xfatami";case"h":return withoutSuffix?"hodina":isFuture?"hodinu":"hodinou";case"hh":return withoutSuffix||isFuture?result+(plural(number)?"hodiny":"hod\xedn"):result+"hodinami";case"d":return withoutSuffix||isFuture?"de\u0148":"d\u0148om";case"dd":return withoutSuffix||isFuture?result+(plural(number)?"dni":"dn\xed"):result+"d\u0148ami";case"M":return withoutSuffix||isFuture?"mesiac":"mesiacom";case"MM":return withoutSuffix||isFuture?result+(plural(number)?"mesiace":"mesiacov"):result+"mesiacmi";case"y":return withoutSuffix||isFuture?"rok":"rokom";case"yy":return withoutSuffix||isFuture?result+(plural(number)?"roky":"rokov"):result+"rokmi"}}moment.defineLocale("sk",{months:months,monthsShort:monthsShort,weekdays:"nede\u013ea_pondelok_utorok_streda_\u0161tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_\u0161t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_\u0161t_pi_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nede\u013eu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo \u0161tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[v\u010dera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul\xfa nede\u013eu o] LT";case 1:case 2:return"[minul\xfd] dddd [o] LT";case 3:return"[minul\xfa stredu o] LT";case 4:case 5:return"[minul\xfd] dddd [o] LT";case 6:return"[minul\xfa sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var result=number+" ";switch(key){case"s":return withoutSuffix||isFuture?"nekaj sekund":"nekaj sekundami";case"ss":return result+(1===number?withoutSuffix?"sekundo":"sekundi":2===number?withoutSuffix||isFuture?"sekundi":"sekundah":number<5?withoutSuffix||isFuture?"sekunde":"sekundah":"sekund");case"m":return withoutSuffix?"ena minuta":"eno minuto";case"mm":return result+(1===number?withoutSuffix?"minuta":"minuto":2===number?withoutSuffix||isFuture?"minuti":"minutama":number<5?withoutSuffix||isFuture?"minute":"minutami":withoutSuffix||isFuture?"minut":"minutami");case"h":return withoutSuffix?"ena ura":"eno uro";case"hh":return result+(1===number?withoutSuffix?"ura":"uro":2===number?withoutSuffix||isFuture?"uri":"urama":number<5?withoutSuffix||isFuture?"ure":"urami":withoutSuffix||isFuture?"ur":"urami");case"d":return withoutSuffix||isFuture?"en dan":"enim dnem";case"dd":return result+(1===number?withoutSuffix||isFuture?"dan":"dnem":2===number?withoutSuffix||isFuture?"dni":"dnevoma":withoutSuffix||isFuture?"dni":"dnevi");case"M":return withoutSuffix||isFuture?"en mesec":"enim mesecem";case"MM":return result+(1===number?withoutSuffix||isFuture?"mesec":"mesecem":2===number?withoutSuffix||isFuture?"meseca":"mesecema":number<5?withoutSuffix||isFuture?"mesece":"meseci":withoutSuffix||isFuture?"mesecev":"meseci");case"y":return withoutSuffix||isFuture?"eno leto":"enim letom";case"yy":return result+(1===number?withoutSuffix||isFuture?"leto":"letom":2===number?withoutSuffix||isFuture?"leti":"letoma":number<5?withoutSuffix||isFuture?"leta":"leti":withoutSuffix||isFuture?"let":"leti")}}moment.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljek_torek_sreda_\u010detrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._\u010det._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_\u010de_pe_so".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[v\u010deraj ob] LT",lastWeek:function(){switch(this.day()){case 0:return"[prej\u0161njo] [nedeljo] [ob] LT";case 3:return"[prej\u0161njo] [sredo] [ob] LT";case 6:return"[prej\u0161njo] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[prej\u0161nji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"\u010dez %s",past:"pred %s",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_N\xebntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_N\xebn_Dhj".split("_"),weekdays:"E Diel_E H\xebn\xeb_E Mart\xeb_E M\xebrkur\xeb_E Enjte_E Premte_E Shtun\xeb".split("_"),weekdaysShort:"Die_H\xebn_Mar_M\xebr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M\xeb_E_P_Sh".split("_"),weekdaysParseExact:!0,meridiemParse:/PD|MD/,isPM:function(input){return"M"===input.charAt(0)},meridiem:function(hours,minutes,isLower){return hours<12?"PD":"MD"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Sot n\xeb] LT",nextDay:"[Nes\xebr n\xeb] LT",nextWeek:"dddd [n\xeb] LT",lastDay:"[Dje n\xeb] LT",lastWeek:"dddd [e kaluar n\xeb] LT",sameElse:"L"},relativeTime:{future:"n\xeb %s",past:"%s m\xeb par\xeb",s:"disa sekonda",ss:"%d sekonda",m:"nj\xeb minut\xeb",mm:"%d minuta",h:"nj\xeb or\xeb",hh:"%d or\xeb",d:"nj\xeb dit\xeb",dd:"%d dit\xeb",M:"nj\xeb muaj",MM:"%d muaj",y:"nj\xeb vit",yy:"%d vite"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var translator={words:{ss:["sekunda","sekunde","sekundi"],m:["jedan minut","jedne minute"],mm:["minut","minute","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mesec","meseca","meseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(number,wordKey){return 1===number?wordKey[0]:number>=2&&number<=4?wordKey[1]:wordKey[2]},translate:function(number,withoutSuffix,key){var wordKey=translator.words[key];return 1===key.length?withoutSuffix?wordKey[0]:wordKey[1]:number+" "+translator.correctGrammaticalCase(number,wordKey)}};moment.defineLocale("sr",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljak_utorak_sreda_\u010detvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sre._\u010det._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_\u010de_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D. M. YYYY.",LL:"D. MMMM YYYY.",LLL:"D. MMMM YYYY. H:mm",LLLL:"dddd, D. MMMM YYYY. H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[ju\u010de u] LT",lastWeek:function(){return["[pro\u0161le] [nedelje] [u] LT","[pro\u0161log] [ponedeljka] [u] LT","[pro\u0161log] [utorka] [u] LT","[pro\u0161le] [srede] [u] LT","[pro\u0161log] [\u010detvrtka] [u] LT","[pro\u0161log] [petka] [u] LT","[pro\u0161le] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",ss:translator.translate,m:translator.translate,mm:translator.translate,h:translator.translate,hh:translator.translate,d:"dan",dd:translator.translate,M:"mesec",MM:translator.translate,y:"godinu",yy:translator.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var translator={words:{ss:["\u0441\u0435\u043a\u0443\u043d\u0434\u0430","\u0441\u0435\u043a\u0443\u043d\u0434\u0435","\u0441\u0435\u043a\u0443\u043d\u0434\u0438"],m:["\u0458\u0435\u0434\u0430\u043d \u043c\u0438\u043d\u0443\u0442","\u0458\u0435\u0434\u043d\u0435 \u043c\u0438\u043d\u0443\u0442\u0435"],mm:["\u043c\u0438\u043d\u0443\u0442","\u043c\u0438\u043d\u0443\u0442\u0435","\u043c\u0438\u043d\u0443\u0442\u0430"],h:["\u0458\u0435\u0434\u0430\u043d \u0441\u0430\u0442","\u0458\u0435\u0434\u043d\u043e\u0433 \u0441\u0430\u0442\u0430"],hh:["\u0441\u0430\u0442","\u0441\u0430\u0442\u0430","\u0441\u0430\u0442\u0438"],dd:["\u0434\u0430\u043d","\u0434\u0430\u043d\u0430","\u0434\u0430\u043d\u0430"],MM:["\u043c\u0435\u0441\u0435\u0446","\u043c\u0435\u0441\u0435\u0446\u0430","\u043c\u0435\u0441\u0435\u0446\u0438"],yy:["\u0433\u043e\u0434\u0438\u043d\u0430","\u0433\u043e\u0434\u0438\u043d\u0435","\u0433\u043e\u0434\u0438\u043d\u0430"]},correctGrammaticalCase:function(number,wordKey){return 1===number?wordKey[0]:number>=2&&number<=4?wordKey[1]:wordKey[2]},translate:function(number,withoutSuffix,key){var wordKey=translator.words[key];return 1===key.length?withoutSuffix?wordKey[0]:wordKey[1]:number+" "+translator.correctGrammaticalCase(number,wordKey)}};moment.defineLocale("sr-cyrl",{months:"\u0458\u0430\u043d\u0443\u0430\u0440_\u0444\u0435\u0431\u0440\u0443\u0430\u0440_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0438\u043b_\u043c\u0430\u0458_\u0458\u0443\u043d_\u0458\u0443\u043b_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043f\u0442\u0435\u043c\u0431\u0430\u0440_\u043e\u043a\u0442\u043e\u0431\u0430\u0440_\u043d\u043e\u0432\u0435\u043c\u0431\u0430\u0440_\u0434\u0435\u0446\u0435\u043c\u0431\u0430\u0440".split("_"),monthsShort:"\u0458\u0430\u043d._\u0444\u0435\u0431._\u043c\u0430\u0440._\u0430\u043f\u0440._\u043c\u0430\u0458_\u0458\u0443\u043d_\u0458\u0443\u043b_\u0430\u0432\u0433._\u0441\u0435\u043f._\u043e\u043a\u0442._\u043d\u043e\u0432._\u0434\u0435\u0446.".split("_"),monthsParseExact:!0,weekdays:"\u043d\u0435\u0434\u0435\u0459\u0430_\u043f\u043e\u043d\u0435\u0434\u0435\u0459\u0430\u043a_\u0443\u0442\u043e\u0440\u0430\u043a_\u0441\u0440\u0435\u0434\u0430_\u0447\u0435\u0442\u0432\u0440\u0442\u0430\u043a_\u043f\u0435\u0442\u0430\u043a_\u0441\u0443\u0431\u043e\u0442\u0430".split("_"),weekdaysShort:"\u043d\u0435\u0434._\u043f\u043e\u043d._\u0443\u0442\u043e._\u0441\u0440\u0435._\u0447\u0435\u0442._\u043f\u0435\u0442._\u0441\u0443\u0431.".split("_"),weekdaysMin:"\u043d\u0435_\u043f\u043e_\u0443\u0442_\u0441\u0440_\u0447\u0435_\u043f\u0435_\u0441\u0443".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D. M. YYYY.",LL:"D. MMMM YYYY.",LLL:"D. MMMM YYYY. H:mm",LLLL:"dddd, D. MMMM YYYY. H:mm"},calendar:{sameDay:"[\u0434\u0430\u043d\u0430\u0441 \u0443] LT",nextDay:"[\u0441\u0443\u0442\u0440\u0430 \u0443] LT",nextWeek:function(){switch(this.day()){case 0:return"[\u0443] [\u043d\u0435\u0434\u0435\u0459\u0443] [\u0443] LT";case 3:return"[\u0443] [\u0441\u0440\u0435\u0434\u0443] [\u0443] LT";case 6:return"[\u0443] [\u0441\u0443\u0431\u043e\u0442\u0443] [\u0443] LT";case 1:case 2:case 4:case 5:return"[\u0443] dddd [\u0443] LT"}},lastDay:"[\u0458\u0443\u0447\u0435 \u0443] LT",lastWeek:function(){return["[\u043f\u0440\u043e\u0448\u043b\u0435] [\u043d\u0435\u0434\u0435\u0459\u0435] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u043e\u0433] [\u043f\u043e\u043d\u0435\u0434\u0435\u0459\u043a\u0430] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u043e\u0433] [\u0443\u0442\u043e\u0440\u043a\u0430] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u0435] [\u0441\u0440\u0435\u0434\u0435] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u043e\u0433] [\u0447\u0435\u0442\u0432\u0440\u0442\u043a\u0430] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u043e\u0433] [\u043f\u0435\u0442\u043a\u0430] [\u0443] LT","[\u043f\u0440\u043e\u0448\u043b\u0435] [\u0441\u0443\u0431\u043e\u0442\u0435] [\u0443] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"\u0437\u0430 %s",past:"\u043f\u0440\u0435 %s",s:"\u043d\u0435\u043a\u043e\u043b\u0438\u043a\u043e \u0441\u0435\u043a\u0443\u043d\u0434\u0438",ss:translator.translate,m:translator.translate,mm:translator.translate,h:translator.translate,hh:translator.translate,d:"\u0434\u0430\u043d",dd:translator.translate,M:"\u043c\u0435\u0441\u0435\u0446",MM:translator.translate,y:"\u0433\u043e\u0434\u0438\u043d\u0443",yy:translator.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ss",{months:"Bhimbidvwane_Indlovana_Indlov'lenkhulu_Mabasa_Inkhwekhweti_Inhlaba_Kholwane_Ingci_Inyoni_Imphala_Lweti_Ingongoni".split("_"),monthsShort:"Bhi_Ina_Inu_Mab_Ink_Inh_Kho_Igc_Iny_Imp_Lwe_Igo".split("_"),weekdays:"Lisontfo_Umsombuluko_Lesibili_Lesitsatfu_Lesine_Lesihlanu_Umgcibelo".split("_"),weekdaysShort:"Lis_Umb_Lsb_Les_Lsi_Lsh_Umg".split("_"),weekdaysMin:"Li_Us_Lb_Lt_Ls_Lh_Ug".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Namuhla nga] LT",nextDay:"[Kusasa nga] LT",nextWeek:"dddd [nga] LT",lastDay:"[Itolo nga] LT",lastWeek:"dddd [leliphelile] [nga] LT",sameElse:"L"},relativeTime:{future:"nga %s",past:"wenteka nga %s",s:"emizuzwana lomcane",ss:"%d mzuzwana",m:"umzuzu",mm:"%d emizuzu",h:"lihora",hh:"%d emahora",d:"lilanga",dd:"%d emalanga",M:"inyanga",MM:"%d tinyanga",y:"umnyaka",yy:"%d iminyaka"},meridiemParse:/ekuseni|emini|entsambama|ebusuku/,meridiem:function(hours,minutes,isLower){return hours<11?"ekuseni":hours<15?"emini":hours<19?"entsambama":"ebusuku"},meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"ekuseni"===meridiem?hour:"emini"===meridiem?hour>=11?hour:hour+12:"entsambama"===meridiem||"ebusuku"===meridiem?0===hour?0:hour+12:void 0},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"s\xf6ndag_m\xe5ndag_tisdag_onsdag_torsdag_fredag_l\xf6rdag".split("_"),weekdaysShort:"s\xf6n_m\xe5n_tis_ons_tor_fre_l\xf6r".split("_"),weekdaysMin:"s\xf6_m\xe5_ti_on_to_fr_l\xf6".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [kl.] HH:mm",LLLL:"dddd D MMMM YYYY [kl.] HH:mm",lll:"D MMM YYYY HH:mm",llll:"ddd D MMM YYYY HH:mm"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Ig\xe5r] LT",nextWeek:"[P\xe5] dddd LT",lastWeek:"[I] dddd[s] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"f\xf6r %s sedan",s:"n\xe5gra sekunder",ss:"%d sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en m\xe5nad",MM:"%d m\xe5nader",y:"ett \xe5r",yy:"%d \xe5r"},dayOfMonthOrdinalParse:/\d{1,2}(\:e|\:a)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?":e":1===b||2===b?":a":":e")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("sw",{months:"Januari_Februari_Machi_Aprili_Mei_Juni_Julai_Agosti_Septemba_Oktoba_Novemba_Desemba".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ago_Sep_Okt_Nov_Des".split("_"),weekdays:"Jumapili_Jumatatu_Jumanne_Jumatano_Alhamisi_Ijumaa_Jumamosi".split("_"),weekdaysShort:"Jpl_Jtat_Jnne_Jtan_Alh_Ijm_Jmos".split("_"),weekdaysMin:"J2_J3_J4_J5_Al_Ij_J1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"hh:mm A",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[leo saa] LT",nextDay:"[kesho saa] LT",nextWeek:"[wiki ijayo] dddd [saat] LT",lastDay:"[jana] LT",lastWeek:"[wiki iliyopita] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s baadaye",past:"tokea %s",s:"hivi punde",ss:"sekunde %d",m:"dakika moja",mm:"dakika %d",h:"saa limoja",hh:"masaa %d",d:"siku moja",dd:"siku %d",M:"mwezi mmoja",MM:"miezi %d",y:"mwaka mmoja",yy:"miaka %d"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var symbolMap={1:"\u0be7",2:"\u0be8",3:"\u0be9",4:"\u0bea",5:"\u0beb",6:"\u0bec",7:"\u0bed",8:"\u0bee",9:"\u0bef",0:"\u0be6"},numberMap={"\u0be7":"1","\u0be8":"2","\u0be9":"3","\u0bea":"4","\u0beb":"5","\u0bec":"6","\u0bed":"7","\u0bee":"8","\u0bef":"9","\u0be6":"0"};moment.defineLocale("ta",{months:"\u0b9c\u0ba9\u0bb5\u0bb0\u0bbf_\u0baa\u0bbf\u0baa\u0bcd\u0bb0\u0bb5\u0bb0\u0bbf_\u0bae\u0bbe\u0bb0\u0bcd\u0b9a\u0bcd_\u0b8f\u0baa\u0bcd\u0bb0\u0bb2\u0bcd_\u0bae\u0bc7_\u0b9c\u0bc2\u0ba9\u0bcd_\u0b9c\u0bc2\u0bb2\u0bc8_\u0b86\u0b95\u0bb8\u0bcd\u0b9f\u0bcd_\u0b9a\u0bc6\u0baa\u0bcd\u0b9f\u0bc6\u0bae\u0bcd\u0baa\u0bb0\u0bcd_\u0b85\u0b95\u0bcd\u0b9f\u0bc7\u0bbe\u0baa\u0bb0\u0bcd_\u0ba8\u0bb5\u0bae\u0bcd\u0baa\u0bb0\u0bcd_\u0b9f\u0bbf\u0b9a\u0bae\u0bcd\u0baa\u0bb0\u0bcd".split("_"),monthsShort:"\u0b9c\u0ba9\u0bb5\u0bb0\u0bbf_\u0baa\u0bbf\u0baa\u0bcd\u0bb0\u0bb5\u0bb0\u0bbf_\u0bae\u0bbe\u0bb0\u0bcd\u0b9a\u0bcd_\u0b8f\u0baa\u0bcd\u0bb0\u0bb2\u0bcd_\u0bae\u0bc7_\u0b9c\u0bc2\u0ba9\u0bcd_\u0b9c\u0bc2\u0bb2\u0bc8_\u0b86\u0b95\u0bb8\u0bcd\u0b9f\u0bcd_\u0b9a\u0bc6\u0baa\u0bcd\u0b9f\u0bc6\u0bae\u0bcd\u0baa\u0bb0\u0bcd_\u0b85\u0b95\u0bcd\u0b9f\u0bc7\u0bbe\u0baa\u0bb0\u0bcd_\u0ba8\u0bb5\u0bae\u0bcd\u0baa\u0bb0\u0bcd_\u0b9f\u0bbf\u0b9a\u0bae\u0bcd\u0baa\u0bb0\u0bcd".split("_"),weekdays:"\u0b9e\u0bbe\u0baf\u0bbf\u0bb1\u0bcd\u0bb1\u0bc1\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0ba4\u0bbf\u0b99\u0bcd\u0b95\u0b9f\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0b9a\u0bc6\u0bb5\u0bcd\u0bb5\u0bbe\u0baf\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0baa\u0bc1\u0ba4\u0ba9\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0bb5\u0bbf\u0baf\u0bbe\u0bb4\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0bb5\u0bc6\u0bb3\u0bcd\u0bb3\u0bbf\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8_\u0b9a\u0ba9\u0bbf\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8".split("_"),weekdaysShort:"\u0b9e\u0bbe\u0baf\u0bbf\u0bb1\u0bc1_\u0ba4\u0bbf\u0b99\u0bcd\u0b95\u0bb3\u0bcd_\u0b9a\u0bc6\u0bb5\u0bcd\u0bb5\u0bbe\u0baf\u0bcd_\u0baa\u0bc1\u0ba4\u0ba9\u0bcd_\u0bb5\u0bbf\u0baf\u0bbe\u0bb4\u0ba9\u0bcd_\u0bb5\u0bc6\u0bb3\u0bcd\u0bb3\u0bbf_\u0b9a\u0ba9\u0bbf".split("_"),weekdaysMin:"\u0b9e\u0bbe_\u0ba4\u0bbf_\u0b9a\u0bc6_\u0baa\u0bc1_\u0bb5\u0bbf_\u0bb5\u0bc6_\u0b9a".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, HH:mm",LLLL:"dddd, D MMMM YYYY, HH:mm"},calendar:{sameDay:"[\u0b87\u0ba9\u0bcd\u0bb1\u0bc1] LT",nextDay:"[\u0ba8\u0bbe\u0bb3\u0bc8] LT",nextWeek:"dddd, LT",lastDay:"[\u0ba8\u0bc7\u0bb1\u0bcd\u0bb1\u0bc1] LT",lastWeek:"[\u0b95\u0b9f\u0ba8\u0bcd\u0ba4 \u0bb5\u0bbe\u0bb0\u0bae\u0bcd] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0b87\u0bb2\u0bcd",past:"%s \u0bae\u0bc1\u0ba9\u0bcd",s:"\u0b92\u0bb0\u0bc1 \u0b9a\u0bbf\u0bb2 \u0bb5\u0bbf\u0ba8\u0bbe\u0b9f\u0bbf\u0b95\u0bb3\u0bcd",ss:"%d \u0bb5\u0bbf\u0ba8\u0bbe\u0b9f\u0bbf\u0b95\u0bb3\u0bcd",m:"\u0b92\u0bb0\u0bc1 \u0ba8\u0bbf\u0bae\u0bbf\u0b9f\u0bae\u0bcd",mm:"%d \u0ba8\u0bbf\u0bae\u0bbf\u0b9f\u0b99\u0bcd\u0b95\u0bb3\u0bcd",h:"\u0b92\u0bb0\u0bc1 \u0bae\u0ba3\u0bbf \u0ba8\u0bc7\u0bb0\u0bae\u0bcd",hh:"%d \u0bae\u0ba3\u0bbf \u0ba8\u0bc7\u0bb0\u0bae\u0bcd",d:"\u0b92\u0bb0\u0bc1 \u0ba8\u0bbe\u0bb3\u0bcd",dd:"%d \u0ba8\u0bbe\u0b9f\u0bcd\u0b95\u0bb3\u0bcd",M:"\u0b92\u0bb0\u0bc1 \u0bae\u0bbe\u0ba4\u0bae\u0bcd",MM:"%d \u0bae\u0bbe\u0ba4\u0b99\u0bcd\u0b95\u0bb3\u0bcd",y:"\u0b92\u0bb0\u0bc1 \u0bb5\u0bb0\u0bc1\u0b9f\u0bae\u0bcd",yy:"%d \u0b86\u0ba3\u0bcd\u0b9f\u0bc1\u0b95\u0bb3\u0bcd"},dayOfMonthOrdinalParse:/\d{1,2}\u0bb5\u0ba4\u0bc1/,ordinal:function(number){return number+"\u0bb5\u0ba4\u0bc1"},preparse:function(string){return string.replace(/[\u0be7\u0be8\u0be9\u0bea\u0beb\u0bec\u0bed\u0bee\u0bef\u0be6]/g,(function(match){return numberMap[match]}))},postformat:function(string){return string.replace(/\d/g,(function(match){return symbolMap[match]}))},meridiemParse:/\u0baf\u0bbe\u0bae\u0bae\u0bcd|\u0bb5\u0bc8\u0b95\u0bb1\u0bc8|\u0b95\u0bbe\u0bb2\u0bc8|\u0ba8\u0ba3\u0bcd\u0baa\u0b95\u0bb2\u0bcd|\u0b8e\u0bb1\u0bcd\u0baa\u0bbe\u0b9f\u0bc1|\u0bae\u0bbe\u0bb2\u0bc8/,meridiem:function(hour,minute,isLower){return hour<2?" \u0baf\u0bbe\u0bae\u0bae\u0bcd":hour<6?" \u0bb5\u0bc8\u0b95\u0bb1\u0bc8":hour<10?" \u0b95\u0bbe\u0bb2\u0bc8":hour<14?" \u0ba8\u0ba3\u0bcd\u0baa\u0b95\u0bb2\u0bcd":hour<18?" \u0b8e\u0bb1\u0bcd\u0baa\u0bbe\u0b9f\u0bc1":hour<22?" \u0bae\u0bbe\u0bb2\u0bc8":" \u0baf\u0bbe\u0bae\u0bae\u0bcd"},meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0baf\u0bbe\u0bae\u0bae\u0bcd"===meridiem?hour<2?hour:hour+12:"\u0bb5\u0bc8\u0b95\u0bb1\u0bc8"===meridiem||"\u0b95\u0bbe\u0bb2\u0bc8"===meridiem||"\u0ba8\u0ba3\u0bcd\u0baa\u0b95\u0bb2\u0bcd"===meridiem&&hour>=10?hour:hour+12},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("te",{months:"\u0c1c\u0c28\u0c35\u0c30\u0c3f_\u0c2b\u0c3f\u0c2c\u0c4d\u0c30\u0c35\u0c30\u0c3f_\u0c2e\u0c3e\u0c30\u0c4d\u0c1a\u0c3f_\u0c0f\u0c2a\u0c4d\u0c30\u0c3f\u0c32\u0c4d_\u0c2e\u0c47_\u0c1c\u0c42\u0c28\u0c4d_\u0c1c\u0c41\u0c32\u0c48_\u0c06\u0c17\u0c38\u0c4d\u0c1f\u0c41_\u0c38\u0c46\u0c2a\u0c4d\u0c1f\u0c46\u0c02\u0c2c\u0c30\u0c4d_\u0c05\u0c15\u0c4d\u0c1f\u0c4b\u0c2c\u0c30\u0c4d_\u0c28\u0c35\u0c02\u0c2c\u0c30\u0c4d_\u0c21\u0c3f\u0c38\u0c46\u0c02\u0c2c\u0c30\u0c4d".split("_"),monthsShort:"\u0c1c\u0c28._\u0c2b\u0c3f\u0c2c\u0c4d\u0c30._\u0c2e\u0c3e\u0c30\u0c4d\u0c1a\u0c3f_\u0c0f\u0c2a\u0c4d\u0c30\u0c3f._\u0c2e\u0c47_\u0c1c\u0c42\u0c28\u0c4d_\u0c1c\u0c41\u0c32\u0c48_\u0c06\u0c17._\u0c38\u0c46\u0c2a\u0c4d._\u0c05\u0c15\u0c4d\u0c1f\u0c4b._\u0c28\u0c35._\u0c21\u0c3f\u0c38\u0c46.".split("_"),monthsParseExact:!0,weekdays:"\u0c06\u0c26\u0c3f\u0c35\u0c3e\u0c30\u0c02_\u0c38\u0c4b\u0c2e\u0c35\u0c3e\u0c30\u0c02_\u0c2e\u0c02\u0c17\u0c33\u0c35\u0c3e\u0c30\u0c02_\u0c2c\u0c41\u0c27\u0c35\u0c3e\u0c30\u0c02_\u0c17\u0c41\u0c30\u0c41\u0c35\u0c3e\u0c30\u0c02_\u0c36\u0c41\u0c15\u0c4d\u0c30\u0c35\u0c3e\u0c30\u0c02_\u0c36\u0c28\u0c3f\u0c35\u0c3e\u0c30\u0c02".split("_"),weekdaysShort:"\u0c06\u0c26\u0c3f_\u0c38\u0c4b\u0c2e_\u0c2e\u0c02\u0c17\u0c33_\u0c2c\u0c41\u0c27_\u0c17\u0c41\u0c30\u0c41_\u0c36\u0c41\u0c15\u0c4d\u0c30_\u0c36\u0c28\u0c3f".split("_"),weekdaysMin:"\u0c06_\u0c38\u0c4b_\u0c2e\u0c02_\u0c2c\u0c41_\u0c17\u0c41_\u0c36\u0c41_\u0c36".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[\u0c28\u0c47\u0c21\u0c41] LT",nextDay:"[\u0c30\u0c47\u0c2a\u0c41] LT",nextWeek:"dddd, LT",lastDay:"[\u0c28\u0c3f\u0c28\u0c4d\u0c28] LT",lastWeek:"[\u0c17\u0c24] dddd, LT",sameElse:"L"},relativeTime:{future:"%s \u0c32\u0c4b",past:"%s \u0c15\u0c4d\u0c30\u0c3f\u0c24\u0c02",s:"\u0c15\u0c4a\u0c28\u0c4d\u0c28\u0c3f \u0c15\u0c4d\u0c37\u0c23\u0c3e\u0c32\u0c41",ss:"%d \u0c38\u0c46\u0c15\u0c28\u0c4d\u0c32\u0c41",m:"\u0c12\u0c15 \u0c28\u0c3f\u0c2e\u0c3f\u0c37\u0c02",mm:"%d \u0c28\u0c3f\u0c2e\u0c3f\u0c37\u0c3e\u0c32\u0c41",h:"\u0c12\u0c15 \u0c17\u0c02\u0c1f",hh:"%d \u0c17\u0c02\u0c1f\u0c32\u0c41",d:"\u0c12\u0c15 \u0c30\u0c4b\u0c1c\u0c41",dd:"%d \u0c30\u0c4b\u0c1c\u0c41\u0c32\u0c41",M:"\u0c12\u0c15 \u0c28\u0c46\u0c32",MM:"%d \u0c28\u0c46\u0c32\u0c32\u0c41",y:"\u0c12\u0c15 \u0c38\u0c02\u0c35\u0c24\u0c4d\u0c38\u0c30\u0c02",yy:"%d \u0c38\u0c02\u0c35\u0c24\u0c4d\u0c38\u0c30\u0c3e\u0c32\u0c41"},dayOfMonthOrdinalParse:/\d{1,2}\u0c35/,ordinal:"%d\u0c35",meridiemParse:/\u0c30\u0c3e\u0c24\u0c4d\u0c30\u0c3f|\u0c09\u0c26\u0c2f\u0c02|\u0c2e\u0c27\u0c4d\u0c2f\u0c3e\u0c39\u0c4d\u0c28\u0c02|\u0c38\u0c3e\u0c2f\u0c02\u0c24\u0c4d\u0c30\u0c02/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0c30\u0c3e\u0c24\u0c4d\u0c30\u0c3f"===meridiem?hour<4?hour:hour+12:"\u0c09\u0c26\u0c2f\u0c02"===meridiem?hour:"\u0c2e\u0c27\u0c4d\u0c2f\u0c3e\u0c39\u0c4d\u0c28\u0c02"===meridiem?hour>=10?hour:hour+12:"\u0c38\u0c3e\u0c2f\u0c02\u0c24\u0c4d\u0c30\u0c02"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"\u0c30\u0c3e\u0c24\u0c4d\u0c30\u0c3f":hour<10?"\u0c09\u0c26\u0c2f\u0c02":hour<17?"\u0c2e\u0c27\u0c4d\u0c2f\u0c3e\u0c39\u0c4d\u0c28\u0c02":hour<20?"\u0c38\u0c3e\u0c2f\u0c02\u0c24\u0c4d\u0c30\u0c02":"\u0c30\u0c3e\u0c24\u0c4d\u0c30\u0c3f"},week:{dow:0,doy:6}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("tet",{months:"Janeiru_Fevereiru_Marsu_Abril_Maiu_Ju\xf1u_Jullu_Agustu_Setembru_Outubru_Novembru_Dezembru".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingu_Segunda_Tersa_Kuarta_Kinta_Sesta_Sabadu".split("_"),weekdaysShort:"Dom_Seg_Ters_Kua_Kint_Sest_Sab".split("_"),weekdaysMin:"Do_Seg_Te_Ku_Ki_Ses_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Ohin iha] LT",nextDay:"[Aban iha] LT",nextWeek:"dddd [iha] LT",lastDay:"[Horiseik iha] LT",lastWeek:"dddd [semana kotuk] [iha] LT",sameElse:"L"},relativeTime:{future:"iha %s",past:"%s liuba",s:"segundu balun",ss:"segundu %d",m:"minutu ida",mm:"minutu %d",h:"oras ida",hh:"oras %d",d:"loron ida",dd:"loron %d",M:"fulan ida",MM:"fulan %d",y:"tinan ida",yy:"tinan %d"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var suffixes={0:"-\u0443\u043c",1:"-\u0443\u043c",2:"-\u044e\u043c",3:"-\u044e\u043c",4:"-\u0443\u043c",5:"-\u0443\u043c",6:"-\u0443\u043c",7:"-\u0443\u043c",8:"-\u0443\u043c",9:"-\u0443\u043c",10:"-\u0443\u043c",12:"-\u0443\u043c",13:"-\u0443\u043c",20:"-\u0443\u043c",30:"-\u044e\u043c",40:"-\u0443\u043c",50:"-\u0443\u043c",60:"-\u0443\u043c",70:"-\u0443\u043c",80:"-\u0443\u043c",90:"-\u0443\u043c",100:"-\u0443\u043c"};moment.defineLocale("tg",{months:{format:"\u044f\u043d\u0432\u0430\u0440\u0438_\u0444\u0435\u0432\u0440\u0430\u043b\u0438_\u043c\u0430\u0440\u0442\u0438_\u0430\u043f\u0440\u0435\u043b\u0438_\u043c\u0430\u0439\u0438_\u0438\u044e\u043d\u0438_\u0438\u044e\u043b\u0438_\u0430\u0432\u0433\u0443\u0441\u0442\u0438_\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u0438_\u043e\u043a\u0442\u044f\u0431\u0440\u0438_\u043d\u043e\u044f\u0431\u0440\u0438_\u0434\u0435\u043a\u0430\u0431\u0440\u0438".split("_"),standalone:"\u044f\u043d\u0432\u0430\u0440_\u0444\u0435\u0432\u0440\u0430\u043b_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0435\u043b_\u043c\u0430\u0439_\u0438\u044e\u043d_\u0438\u044e\u043b_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043d\u0442\u044f\u0431\u0440_\u043e\u043a\u0442\u044f\u0431\u0440_\u043d\u043e\u044f\u0431\u0440_\u0434\u0435\u043a\u0430\u0431\u0440".split("_")},monthsShort:"\u044f\u043d\u0432_\u0444\u0435\u0432_\u043c\u0430\u0440_\u0430\u043f\u0440_\u043c\u0430\u0439_\u0438\u044e\u043d_\u0438\u044e\u043b_\u0430\u0432\u0433_\u0441\u0435\u043d_\u043e\u043a\u0442_\u043d\u043e\u044f_\u0434\u0435\u043a".split("_"),weekdays:"\u044f\u043a\u0448\u0430\u043d\u0431\u0435_\u0434\u0443\u0448\u0430\u043d\u0431\u0435_\u0441\u0435\u0448\u0430\u043d\u0431\u0435_\u0447\u043e\u0440\u0448\u0430\u043d\u0431\u0435_\u043f\u0430\u043d\u04b7\u0448\u0430\u043d\u0431\u0435_\u04b7\u0443\u043c\u044a\u0430_\u0448\u0430\u043d\u0431\u0435".split("_"),weekdaysShort:"\u044f\u0448\u0431_\u0434\u0448\u0431_\u0441\u0448\u0431_\u0447\u0448\u0431_\u043f\u0448\u0431_\u04b7\u0443\u043c_\u0448\u043d\u0431".split("_"),weekdaysMin:"\u044f\u0448_\u0434\u0448_\u0441\u0448_\u0447\u0448_\u043f\u0448_\u04b7\u043c_\u0448\u0431".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u0418\u043c\u0440\u04ef\u0437 \u0441\u043e\u0430\u0442\u0438] LT",nextDay:"[\u0424\u0430\u0440\u0434\u043e \u0441\u043e\u0430\u0442\u0438] LT",lastDay:"[\u0414\u0438\u0440\u04ef\u0437 \u0441\u043e\u0430\u0442\u0438] LT",nextWeek:"dddd[\u0438] [\u04b3\u0430\u0444\u0442\u0430\u0438 \u043e\u044f\u043d\u0434\u0430 \u0441\u043e\u0430\u0442\u0438] LT",lastWeek:"dddd[\u0438] [\u04b3\u0430\u0444\u0442\u0430\u0438 \u0433\u0443\u0437\u0430\u0448\u0442\u0430 \u0441\u043e\u0430\u0442\u0438] LT",sameElse:"L"},relativeTime:{future:"\u0431\u0430\u044a\u0434\u0438 %s",past:"%s \u043f\u0435\u0448",s:"\u044f\u043a\u0447\u0430\u043d\u0434 \u0441\u043e\u043d\u0438\u044f",m:"\u044f\u043a \u0434\u0430\u049b\u0438\u049b\u0430",mm:"%d \u0434\u0430\u049b\u0438\u049b\u0430",h:"\u044f\u043a \u0441\u043e\u0430\u0442",hh:"%d \u0441\u043e\u0430\u0442",d:"\u044f\u043a \u0440\u04ef\u0437",dd:"%d \u0440\u04ef\u0437",M:"\u044f\u043a \u043c\u043e\u04b3",MM:"%d \u043c\u043e\u04b3",y:"\u044f\u043a \u0441\u043e\u043b",yy:"%d \u0441\u043e\u043b"},meridiemParse:/\u0448\u0430\u0431|\u0441\u0443\u0431\u04b3|\u0440\u04ef\u0437|\u0431\u0435\u0433\u043e\u04b3/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u0448\u0430\u0431"===meridiem?hour<4?hour:hour+12:"\u0441\u0443\u0431\u04b3"===meridiem?hour:"\u0440\u04ef\u0437"===meridiem?hour>=11?hour:hour+12:"\u0431\u0435\u0433\u043e\u04b3"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){return hour<4?"\u0448\u0430\u0431":hour<11?"\u0441\u0443\u0431\u04b3":hour<16?"\u0440\u04ef\u0437":hour<19?"\u0431\u0435\u0433\u043e\u04b3":"\u0448\u0430\u0431"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0443\u043c|\u044e\u043c)/,ordinal:function(number){return number+(suffixes[number]||suffixes[number%10]||suffixes[number>=100?100:null])},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("th",{months:"\u0e21\u0e01\u0e23\u0e32\u0e04\u0e21_\u0e01\u0e38\u0e21\u0e20\u0e32\u0e1e\u0e31\u0e19\u0e18\u0e4c_\u0e21\u0e35\u0e19\u0e32\u0e04\u0e21_\u0e40\u0e21\u0e29\u0e32\u0e22\u0e19_\u0e1e\u0e24\u0e29\u0e20\u0e32\u0e04\u0e21_\u0e21\u0e34\u0e16\u0e38\u0e19\u0e32\u0e22\u0e19_\u0e01\u0e23\u0e01\u0e0e\u0e32\u0e04\u0e21_\u0e2a\u0e34\u0e07\u0e2b\u0e32\u0e04\u0e21_\u0e01\u0e31\u0e19\u0e22\u0e32\u0e22\u0e19_\u0e15\u0e38\u0e25\u0e32\u0e04\u0e21_\u0e1e\u0e24\u0e28\u0e08\u0e34\u0e01\u0e32\u0e22\u0e19_\u0e18\u0e31\u0e19\u0e27\u0e32\u0e04\u0e21".split("_"),monthsShort:"\u0e21.\u0e04._\u0e01.\u0e1e._\u0e21\u0e35.\u0e04._\u0e40\u0e21.\u0e22._\u0e1e.\u0e04._\u0e21\u0e34.\u0e22._\u0e01.\u0e04._\u0e2a.\u0e04._\u0e01.\u0e22._\u0e15.\u0e04._\u0e1e.\u0e22._\u0e18.\u0e04.".split("_"),monthsParseExact:!0,weekdays:"\u0e2d\u0e32\u0e17\u0e34\u0e15\u0e22\u0e4c_\u0e08\u0e31\u0e19\u0e17\u0e23\u0e4c_\u0e2d\u0e31\u0e07\u0e04\u0e32\u0e23_\u0e1e\u0e38\u0e18_\u0e1e\u0e24\u0e2b\u0e31\u0e2a\u0e1a\u0e14\u0e35_\u0e28\u0e38\u0e01\u0e23\u0e4c_\u0e40\u0e2a\u0e32\u0e23\u0e4c".split("_"),weekdaysShort:"\u0e2d\u0e32\u0e17\u0e34\u0e15\u0e22\u0e4c_\u0e08\u0e31\u0e19\u0e17\u0e23\u0e4c_\u0e2d\u0e31\u0e07\u0e04\u0e32\u0e23_\u0e1e\u0e38\u0e18_\u0e1e\u0e24\u0e2b\u0e31\u0e2a_\u0e28\u0e38\u0e01\u0e23\u0e4c_\u0e40\u0e2a\u0e32\u0e23\u0e4c".split("_"),weekdaysMin:"\u0e2d\u0e32._\u0e08._\u0e2d._\u0e1e._\u0e1e\u0e24._\u0e28._\u0e2a.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY \u0e40\u0e27\u0e25\u0e32 H:mm",LLLL:"\u0e27\u0e31\u0e19dddd\u0e17\u0e35\u0e48 D MMMM YYYY \u0e40\u0e27\u0e25\u0e32 H:mm"},meridiemParse:/\u0e01\u0e48\u0e2d\u0e19\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07|\u0e2b\u0e25\u0e31\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07/,isPM:function(input){return"\u0e2b\u0e25\u0e31\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0e01\u0e48\u0e2d\u0e19\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07":"\u0e2b\u0e25\u0e31\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07"},calendar:{sameDay:"[\u0e27\u0e31\u0e19\u0e19\u0e35\u0e49 \u0e40\u0e27\u0e25\u0e32] LT",nextDay:"[\u0e1e\u0e23\u0e38\u0e48\u0e07\u0e19\u0e35\u0e49 \u0e40\u0e27\u0e25\u0e32] LT",nextWeek:"dddd[\u0e2b\u0e19\u0e49\u0e32 \u0e40\u0e27\u0e25\u0e32] LT",lastDay:"[\u0e40\u0e21\u0e37\u0e48\u0e2d\u0e27\u0e32\u0e19\u0e19\u0e35\u0e49 \u0e40\u0e27\u0e25\u0e32] LT",lastWeek:"[\u0e27\u0e31\u0e19]dddd[\u0e17\u0e35\u0e48\u0e41\u0e25\u0e49\u0e27 \u0e40\u0e27\u0e25\u0e32] LT",sameElse:"L"},relativeTime:{future:"\u0e2d\u0e35\u0e01 %s",past:"%s\u0e17\u0e35\u0e48\u0e41\u0e25\u0e49\u0e27",s:"\u0e44\u0e21\u0e48\u0e01\u0e35\u0e48\u0e27\u0e34\u0e19\u0e32\u0e17\u0e35",ss:"%d \u0e27\u0e34\u0e19\u0e32\u0e17\u0e35",m:"1 \u0e19\u0e32\u0e17\u0e35",mm:"%d \u0e19\u0e32\u0e17\u0e35",h:"1 \u0e0a\u0e31\u0e48\u0e27\u0e42\u0e21\u0e07",hh:"%d \u0e0a\u0e31\u0e48\u0e27\u0e42\u0e21\u0e07",d:"1 \u0e27\u0e31\u0e19",dd:"%d \u0e27\u0e31\u0e19",w:"1 \u0e2a\u0e31\u0e1b\u0e14\u0e32\u0e2b\u0e4c",ww:"%d \u0e2a\u0e31\u0e1b\u0e14\u0e32\u0e2b\u0e4c",M:"1 \u0e40\u0e14\u0e37\u0e2d\u0e19",MM:"%d \u0e40\u0e14\u0e37\u0e2d\u0e19",y:"1 \u0e1b\u0e35",yy:"%d \u0e1b\u0e35"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var suffixes={1:"'inji",5:"'inji",8:"'inji",70:"'inji",80:"'inji",2:"'nji",7:"'nji",20:"'nji",50:"'nji",3:"'\xfcnji",4:"'\xfcnji",100:"'\xfcnji",6:"'njy",9:"'unjy",10:"'unjy",30:"'unjy",60:"'ynjy",90:"'ynjy"};moment.defineLocale("tk",{months:"\xddanwar_Fewral_Mart_Aprel_Ma\xfd_I\xfdun_I\xfdul_Awgust_Sent\xfdabr_Okt\xfdabr_No\xfdabr_Dekabr".split("_"),monthsShort:"\xddan_Few_Mar_Apr_Ma\xfd_I\xfdn_I\xfdl_Awg_Sen_Okt_No\xfd_Dek".split("_"),weekdays:"\xddek\u015fenbe_Du\u015fenbe_Si\u015fenbe_\xc7ar\u015fenbe_Pen\u015fenbe_Anna_\u015eenbe".split("_"),weekdaysShort:"\xddek_Du\u015f_Si\u015f_\xc7ar_Pen_Ann_\u015een".split("_"),weekdaysMin:"\xddk_D\u015f_S\u015f_\xc7r_Pn_An_\u015en".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bug\xfcn sagat] LT",nextDay:"[ertir sagat] LT",nextWeek:"[indiki] dddd [sagat] LT",lastDay:"[d\xfc\xfdn] LT",lastWeek:"[ge\xe7en] dddd [sagat] LT",sameElse:"L"},relativeTime:{future:"%s so\u0148",past:"%s \xf6\u0148",s:"birn\xe4\xe7e sekunt",m:"bir minut",mm:"%d minut",h:"bir sagat",hh:"%d sagat",d:"bir g\xfcn",dd:"%d g\xfcn",M:"bir a\xfd",MM:"%d a\xfd",y:"bir \xfdyl",yy:"%d \xfdyl"},ordinal:function(number,period){switch(period){case"d":case"D":case"Do":case"DD":return number;default:if(0===number)return number+"'unjy";var a=number%10;return number+(suffixes[a]||suffixes[number%100-a]||suffixes[number>=100?100:null])}},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(number){return number},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var numbersNouns="pagh_wa\u2019_cha\u2019_wej_loS_vagh_jav_Soch_chorgh_Hut".split("_");function translate(number,withoutSuffix,string,isFuture){var numberNoun=function(number){var hundred=Math.floor(number%1e3/100),ten=Math.floor(number%100/10),one=number%10,word="";return hundred>0&&(word+=numbersNouns[hundred]+"vatlh"),ten>0&&(word+=(""!==word?" ":"")+numbersNouns[ten]+"maH"),one>0&&(word+=(""!==word?" ":"")+numbersNouns[one]),""===word?"pagh":word}(number);switch(string){case"ss":return numberNoun+" lup";case"mm":return numberNoun+" tup";case"hh":return numberNoun+" rep";case"dd":return numberNoun+" jaj";case"MM":return numberNoun+" jar";case"yy":return numberNoun+" DIS"}}moment.defineLocale("tlh",{months:"tera\u2019 jar wa\u2019_tera\u2019 jar cha\u2019_tera\u2019 jar wej_tera\u2019 jar loS_tera\u2019 jar vagh_tera\u2019 jar jav_tera\u2019 jar Soch_tera\u2019 jar chorgh_tera\u2019 jar Hut_tera\u2019 jar wa\u2019maH_tera\u2019 jar wa\u2019maH wa\u2019_tera\u2019 jar wa\u2019maH cha\u2019".split("_"),monthsShort:"jar wa\u2019_jar cha\u2019_jar wej_jar loS_jar vagh_jar jav_jar Soch_jar chorgh_jar Hut_jar wa\u2019maH_jar wa\u2019maH wa\u2019_jar wa\u2019maH cha\u2019".split("_"),monthsParseExact:!0,weekdays:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysShort:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysMin:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[DaHjaj] LT",nextDay:"[wa\u2019leS] LT",nextWeek:"LLL",lastDay:"[wa\u2019Hu\u2019] LT",lastWeek:"LLL",sameElse:"L"},relativeTime:{future:function(output){var time=output;return-1!==output.indexOf("jaj")?time.slice(0,-3)+"leS":-1!==output.indexOf("jar")?time.slice(0,-3)+"waQ":-1!==output.indexOf("DIS")?time.slice(0,-3)+"nem":time+" pIq"},past:function(output){var time=output;return-1!==output.indexOf("jaj")?time.slice(0,-3)+"Hu\u2019":-1!==output.indexOf("jar")?time.slice(0,-3)+"wen":-1!==output.indexOf("DIS")?time.slice(0,-3)+"ben":time+" ret"},s:"puS lup",ss:translate,m:"wa\u2019 tup",mm:translate,h:"wa\u2019 rep",hh:translate,d:"wa\u2019 jaj",dd:translate,M:"wa\u2019 jar",MM:translate,y:"wa\u2019 DIS",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var suffixes={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'\xfcnc\xfc",4:"'\xfcnc\xfc",100:"'\xfcnc\xfc",6:"'nc\u0131",9:"'uncu",10:"'uncu",30:"'uncu",60:"'\u0131nc\u0131",90:"'\u0131nc\u0131"};moment.defineLocale("tr",{months:"Ocak_\u015eubat_Mart_Nisan_May\u0131s_Haziran_Temmuz_A\u011fustos_Eyl\xfcl_Ekim_Kas\u0131m_Aral\u0131k".split("_"),monthsShort:"Oca_\u015eub_Mar_Nis_May_Haz_Tem_A\u011fu_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal\u0131_\xc7ar\u015famba_Per\u015fembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_\xc7ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_\xc7a_Pe_Cu_Ct".split("_"),meridiem:function(hours,minutes,isLower){return hours<12?isLower?"\xf6\xf6":"\xd6\xd6":isLower?"\xf6s":"\xd6S"},meridiemParse:/\xf6\xf6|\xd6\xd6|\xf6s|\xd6S/,isPM:function(input){return"\xf6s"===input||"\xd6S"===input},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bug\xfcn saat] LT",nextDay:"[yar\u0131n saat] LT",nextWeek:"[gelecek] dddd [saat] LT",lastDay:"[d\xfcn] LT",lastWeek:"[ge\xe7en] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s \xf6nce",s:"birka\xe7 saniye",ss:"%d saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir g\xfcn",dd:"%d g\xfcn",w:"bir hafta",ww:"%d hafta",M:"bir ay",MM:"%d ay",y:"bir y\u0131l",yy:"%d y\u0131l"},ordinal:function(number,period){switch(period){case"d":case"D":case"Do":case"DD":return number;default:if(0===number)return number+"'\u0131nc\u0131";var a=number%10;return number+(suffixes[a]||suffixes[number%100-a]||suffixes[number>=100?100:null])}},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={s:["viensas secunds","'iensas secunds"],ss:[number+" secunds",number+" secunds"],m:["'n m\xedut","'iens m\xedut"],mm:[number+" m\xeduts",number+" m\xeduts"],h:["'n \xfeora","'iensa \xfeora"],hh:[number+" \xfeoras",number+" \xfeoras"],d:["'n ziua","'iensa ziua"],dd:[number+" ziuas",number+" ziuas"],M:["'n mes","'iens mes"],MM:[number+" mesen",number+" mesen"],y:["'n ar","'iens ar"],yy:[number+" ars",number+" ars"]};return isFuture||withoutSuffix?format[key][0]:format[key][1]}moment.defineLocale("tzl",{months:"Januar_Fevraglh_Mar\xe7_Avr\xefu_Mai_G\xfcn_Julia_Guscht_Setemvar_Listop\xe4ts_Noemvar_Zecemvar".split("_"),monthsShort:"Jan_Fev_Mar_Avr_Mai_G\xfcn_Jul_Gus_Set_Lis_Noe_Zec".split("_"),weekdays:"S\xfaladi_L\xfane\xe7i_Maitzi_M\xe1rcuri_Xh\xfaadi_Vi\xe9ner\xe7i_S\xe1turi".split("_"),weekdaysShort:"S\xfal_L\xfan_Mai_M\xe1r_Xh\xfa_Vi\xe9_S\xe1t".split("_"),weekdaysMin:"S\xfa_L\xfa_Ma_M\xe1_Xh_Vi_S\xe1".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"D. MMMM [dallas] YYYY",LLL:"D. MMMM [dallas] YYYY HH.mm",LLLL:"dddd, [li] D. MMMM [dallas] YYYY HH.mm"},meridiemParse:/d\'o|d\'a/i,isPM:function(input){return"d'o"===input.toLowerCase()},meridiem:function(hours,minutes,isLower){return hours>11?isLower?"d'o":"D'O":isLower?"d'a":"D'A"},calendar:{sameDay:"[oxhi \xe0] LT",nextDay:"[dem\xe0 \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[ieiri \xe0] LT",lastWeek:"[s\xfcr el] dddd [lasteu \xe0] LT",sameElse:"L"},relativeTime:{future:"osprei %s",past:"ja%s",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("tzm",{months:"\u2d49\u2d4f\u2d4f\u2d30\u2d62\u2d54_\u2d31\u2d55\u2d30\u2d62\u2d55_\u2d4e\u2d30\u2d55\u2d5a_\u2d49\u2d31\u2d54\u2d49\u2d54_\u2d4e\u2d30\u2d62\u2d62\u2d53_\u2d62\u2d53\u2d4f\u2d62\u2d53_\u2d62\u2d53\u2d4d\u2d62\u2d53\u2d63_\u2d56\u2d53\u2d5b\u2d5c_\u2d5b\u2d53\u2d5c\u2d30\u2d4f\u2d31\u2d49\u2d54_\u2d3d\u2d5f\u2d53\u2d31\u2d55_\u2d4f\u2d53\u2d61\u2d30\u2d4f\u2d31\u2d49\u2d54_\u2d37\u2d53\u2d4a\u2d4f\u2d31\u2d49\u2d54".split("_"),monthsShort:"\u2d49\u2d4f\u2d4f\u2d30\u2d62\u2d54_\u2d31\u2d55\u2d30\u2d62\u2d55_\u2d4e\u2d30\u2d55\u2d5a_\u2d49\u2d31\u2d54\u2d49\u2d54_\u2d4e\u2d30\u2d62\u2d62\u2d53_\u2d62\u2d53\u2d4f\u2d62\u2d53_\u2d62\u2d53\u2d4d\u2d62\u2d53\u2d63_\u2d56\u2d53\u2d5b\u2d5c_\u2d5b\u2d53\u2d5c\u2d30\u2d4f\u2d31\u2d49\u2d54_\u2d3d\u2d5f\u2d53\u2d31\u2d55_\u2d4f\u2d53\u2d61\u2d30\u2d4f\u2d31\u2d49\u2d54_\u2d37\u2d53\u2d4a\u2d4f\u2d31\u2d49\u2d54".split("_"),weekdays:"\u2d30\u2d59\u2d30\u2d4e\u2d30\u2d59_\u2d30\u2d62\u2d4f\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4f\u2d30\u2d59_\u2d30\u2d3d\u2d54\u2d30\u2d59_\u2d30\u2d3d\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4e\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d39\u2d62\u2d30\u2d59".split("_"),weekdaysShort:"\u2d30\u2d59\u2d30\u2d4e\u2d30\u2d59_\u2d30\u2d62\u2d4f\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4f\u2d30\u2d59_\u2d30\u2d3d\u2d54\u2d30\u2d59_\u2d30\u2d3d\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4e\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d39\u2d62\u2d30\u2d59".split("_"),weekdaysMin:"\u2d30\u2d59\u2d30\u2d4e\u2d30\u2d59_\u2d30\u2d62\u2d4f\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4f\u2d30\u2d59_\u2d30\u2d3d\u2d54\u2d30\u2d59_\u2d30\u2d3d\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d4e\u2d61\u2d30\u2d59_\u2d30\u2d59\u2d49\u2d39\u2d62\u2d30\u2d59".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[\u2d30\u2d59\u2d37\u2d45 \u2d34] LT",nextDay:"[\u2d30\u2d59\u2d3d\u2d30 \u2d34] LT",nextWeek:"dddd [\u2d34] LT",lastDay:"[\u2d30\u2d5a\u2d30\u2d4f\u2d5c \u2d34] LT",lastWeek:"dddd [\u2d34] LT",sameElse:"L"},relativeTime:{future:"\u2d37\u2d30\u2d37\u2d45 \u2d59 \u2d62\u2d30\u2d4f %s",past:"\u2d62\u2d30\u2d4f %s",s:"\u2d49\u2d4e\u2d49\u2d3d",ss:"%d \u2d49\u2d4e\u2d49\u2d3d",m:"\u2d4e\u2d49\u2d4f\u2d53\u2d3a",mm:"%d \u2d4e\u2d49\u2d4f\u2d53\u2d3a",h:"\u2d59\u2d30\u2d44\u2d30",hh:"%d \u2d5c\u2d30\u2d59\u2d59\u2d30\u2d44\u2d49\u2d4f",d:"\u2d30\u2d59\u2d59",dd:"%d o\u2d59\u2d59\u2d30\u2d4f",M:"\u2d30\u2d62o\u2d53\u2d54",MM:"%d \u2d49\u2d62\u2d62\u2d49\u2d54\u2d4f",y:"\u2d30\u2d59\u2d33\u2d30\u2d59",yy:"%d \u2d49\u2d59\u2d33\u2d30\u2d59\u2d4f"},week:{dow:6,doy:12}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("tzm-latn",{months:"innayr_br\u02e4ayr\u02e4_mar\u02e4s\u02e4_ibrir_mayyw_ywnyw_ywlywz_\u0263w\u0161t_\u0161wtanbir_kt\u02e4wbr\u02e4_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_br\u02e4ayr\u02e4_mar\u02e4s\u02e4_ibrir_mayyw_ywnyw_ywlywz_\u0263w\u0161t_\u0161wtanbir_kt\u02e4wbr\u02e4_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asi\u1e0dyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asi\u1e0dyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asi\u1e0dyas".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",ss:"%d imik",m:"minu\u1e0d",mm:"%d minu\u1e0d",h:"sa\u025ba",hh:"%d tassa\u025bin",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("ug-cn",{months:"\u064a\u0627\u0646\u06cb\u0627\u0631_\u0641\u06d0\u06cb\u0631\u0627\u0644_\u0645\u0627\u0631\u062a_\u0626\u0627\u067e\u0631\u06d0\u0644_\u0645\u0627\u064a_\u0626\u0649\u064a\u06c7\u0646_\u0626\u0649\u064a\u06c7\u0644_\u0626\u0627\u06cb\u063a\u06c7\u0633\u062a_\u0633\u06d0\u0646\u062a\u06d5\u0628\u0649\u0631_\u0626\u06c6\u0643\u062a\u06d5\u0628\u0649\u0631_\u0646\u0648\u064a\u0627\u0628\u0649\u0631_\u062f\u06d0\u0643\u0627\u0628\u0649\u0631".split("_"),monthsShort:"\u064a\u0627\u0646\u06cb\u0627\u0631_\u0641\u06d0\u06cb\u0631\u0627\u0644_\u0645\u0627\u0631\u062a_\u0626\u0627\u067e\u0631\u06d0\u0644_\u0645\u0627\u064a_\u0626\u0649\u064a\u06c7\u0646_\u0626\u0649\u064a\u06c7\u0644_\u0626\u0627\u06cb\u063a\u06c7\u0633\u062a_\u0633\u06d0\u0646\u062a\u06d5\u0628\u0649\u0631_\u0626\u06c6\u0643\u062a\u06d5\u0628\u0649\u0631_\u0646\u0648\u064a\u0627\u0628\u0649\u0631_\u062f\u06d0\u0643\u0627\u0628\u0649\u0631".split("_"),weekdays:"\u064a\u06d5\u0643\u0634\u06d5\u0646\u0628\u06d5_\u062f\u06c8\u0634\u06d5\u0646\u0628\u06d5_\u0633\u06d5\u064a\u0634\u06d5\u0646\u0628\u06d5_\u0686\u0627\u0631\u0634\u06d5\u0646\u0628\u06d5_\u067e\u06d5\u064a\u0634\u06d5\u0646\u0628\u06d5_\u062c\u06c8\u0645\u06d5_\u0634\u06d5\u0646\u0628\u06d5".split("_"),weekdaysShort:"\u064a\u06d5_\u062f\u06c8_\u0633\u06d5_\u0686\u0627_\u067e\u06d5_\u062c\u06c8_\u0634\u06d5".split("_"),weekdaysMin:"\u064a\u06d5_\u062f\u06c8_\u0633\u06d5_\u0686\u0627_\u067e\u06d5_\u062c\u06c8_\u0634\u06d5".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY-\u064a\u0649\u0644\u0649M-\u0626\u0627\u064a\u0646\u0649\u06adD-\u0643\u06c8\u0646\u0649",LLL:"YYYY-\u064a\u0649\u0644\u0649M-\u0626\u0627\u064a\u0646\u0649\u06adD-\u0643\u06c8\u0646\u0649\u060c HH:mm",LLLL:"dddd\u060c YYYY-\u064a\u0649\u0644\u0649M-\u0626\u0627\u064a\u0646\u0649\u06adD-\u0643\u06c8\u0646\u0649\u060c HH:mm"},meridiemParse:/\u064a\u06d0\u0631\u0649\u0645 \u0643\u06d0\u0686\u06d5|\u0633\u06d5\u06be\u06d5\u0631|\u0686\u06c8\u0634\u062a\u0649\u0646 \u0628\u06c7\u0631\u06c7\u0646|\u0686\u06c8\u0634|\u0686\u06c8\u0634\u062a\u0649\u0646 \u0643\u06d0\u064a\u0649\u0646|\u0643\u06d5\u0686/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u064a\u06d0\u0631\u0649\u0645 \u0643\u06d0\u0686\u06d5"===meridiem||"\u0633\u06d5\u06be\u06d5\u0631"===meridiem||"\u0686\u06c8\u0634\u062a\u0649\u0646 \u0628\u06c7\u0631\u06c7\u0646"===meridiem?hour:"\u0686\u06c8\u0634\u062a\u0649\u0646 \u0643\u06d0\u064a\u0649\u0646"===meridiem||"\u0643\u06d5\u0686"===meridiem?hour+12:hour>=11?hour:hour+12},meridiem:function(hour,minute,isLower){var hm=100*hour+minute;return hm<600?"\u064a\u06d0\u0631\u0649\u0645 \u0643\u06d0\u0686\u06d5":hm<900?"\u0633\u06d5\u06be\u06d5\u0631":hm<1130?"\u0686\u06c8\u0634\u062a\u0649\u0646 \u0628\u06c7\u0631\u06c7\u0646":hm<1230?"\u0686\u06c8\u0634":hm<1800?"\u0686\u06c8\u0634\u062a\u0649\u0646 \u0643\u06d0\u064a\u0649\u0646":"\u0643\u06d5\u0686"},calendar:{sameDay:"[\u0628\u06c8\u06af\u06c8\u0646 \u0633\u0627\u0626\u06d5\u062a] LT",nextDay:"[\u0626\u06d5\u062a\u06d5 \u0633\u0627\u0626\u06d5\u062a] LT",nextWeek:"[\u0643\u06d0\u0644\u06d5\u0631\u0643\u0649] dddd [\u0633\u0627\u0626\u06d5\u062a] LT",lastDay:"[\u062a\u06c6\u0646\u06c8\u06af\u06c8\u0646] LT",lastWeek:"[\u0626\u0627\u0644\u062f\u0649\u0646\u0642\u0649] dddd [\u0633\u0627\u0626\u06d5\u062a] LT",sameElse:"L"},relativeTime:{future:"%s \u0643\u06d0\u064a\u0649\u0646",past:"%s \u0628\u06c7\u0631\u06c7\u0646",s:"\u0646\u06d5\u0686\u0686\u06d5 \u0633\u06d0\u0643\u0648\u0646\u062a",ss:"%d \u0633\u06d0\u0643\u0648\u0646\u062a",m:"\u0628\u0649\u0631 \u0645\u0649\u0646\u06c7\u062a",mm:"%d \u0645\u0649\u0646\u06c7\u062a",h:"\u0628\u0649\u0631 \u0633\u0627\u0626\u06d5\u062a",hh:"%d \u0633\u0627\u0626\u06d5\u062a",d:"\u0628\u0649\u0631 \u0643\u06c8\u0646",dd:"%d \u0643\u06c8\u0646",M:"\u0628\u0649\u0631 \u0626\u0627\u064a",MM:"%d \u0626\u0627\u064a",y:"\u0628\u0649\u0631 \u064a\u0649\u0644",yy:"%d \u064a\u0649\u0644"},dayOfMonthOrdinalParse:/\d{1,2}(-\u0643\u06c8\u0646\u0649|-\u0626\u0627\u064a|-\u06be\u06d5\u067e\u062a\u06d5)/,ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"-\u0643\u06c8\u0646\u0649";case"w":case"W":return number+"-\u06be\u06d5\u067e\u062a\u06d5";default:return number}},preparse:function(string){return string.replace(/\u060c/g,",")},postformat:function(string){return string.replace(/,/g,"\u060c")},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){function relativeTimeWithPlural(number,withoutSuffix,key){var num,forms;return"m"===key?withoutSuffix?"\u0445\u0432\u0438\u043b\u0438\u043d\u0430":"\u0445\u0432\u0438\u043b\u0438\u043d\u0443":"h"===key?withoutSuffix?"\u0433\u043e\u0434\u0438\u043d\u0430":"\u0433\u043e\u0434\u0438\u043d\u0443":number+" "+(num=+number,forms={ss:withoutSuffix?"\u0441\u0435\u043a\u0443\u043d\u0434\u0430_\u0441\u0435\u043a\u0443\u043d\u0434\u0438_\u0441\u0435\u043a\u0443\u043d\u0434":"\u0441\u0435\u043a\u0443\u043d\u0434\u0443_\u0441\u0435\u043a\u0443\u043d\u0434\u0438_\u0441\u0435\u043a\u0443\u043d\u0434",mm:withoutSuffix?"\u0445\u0432\u0438\u043b\u0438\u043d\u0430_\u0445\u0432\u0438\u043b\u0438\u043d\u0438_\u0445\u0432\u0438\u043b\u0438\u043d":"\u0445\u0432\u0438\u043b\u0438\u043d\u0443_\u0445\u0432\u0438\u043b\u0438\u043d\u0438_\u0445\u0432\u0438\u043b\u0438\u043d",hh:withoutSuffix?"\u0433\u043e\u0434\u0438\u043d\u0430_\u0433\u043e\u0434\u0438\u043d\u0438_\u0433\u043e\u0434\u0438\u043d":"\u0433\u043e\u0434\u0438\u043d\u0443_\u0433\u043e\u0434\u0438\u043d\u0438_\u0433\u043e\u0434\u0438\u043d",dd:"\u0434\u0435\u043d\u044c_\u0434\u043d\u0456_\u0434\u043d\u0456\u0432",MM:"\u043c\u0456\u0441\u044f\u0446\u044c_\u043c\u0456\u0441\u044f\u0446\u0456_\u043c\u0456\u0441\u044f\u0446\u0456\u0432",yy:"\u0440\u0456\u043a_\u0440\u043e\u043a\u0438_\u0440\u043e\u043a\u0456\u0432"}[key].split("_"),num%10==1&&num%100!=11?forms[0]:num%10>=2&&num%10<=4&&(num%100<10||num%100>=20)?forms[1]:forms[2])}function processHoursFunction(str){return function(){return str+"\u043e"+(11===this.hours()?"\u0431":"")+"] LT"}}moment.defineLocale("uk",{months:{format:"\u0441\u0456\u0447\u043d\u044f_\u043b\u044e\u0442\u043e\u0433\u043e_\u0431\u0435\u0440\u0435\u0437\u043d\u044f_\u043a\u0432\u0456\u0442\u043d\u044f_\u0442\u0440\u0430\u0432\u043d\u044f_\u0447\u0435\u0440\u0432\u043d\u044f_\u043b\u0438\u043f\u043d\u044f_\u0441\u0435\u0440\u043f\u043d\u044f_\u0432\u0435\u0440\u0435\u0441\u043d\u044f_\u0436\u043e\u0432\u0442\u043d\u044f_\u043b\u0438\u0441\u0442\u043e\u043f\u0430\u0434\u0430_\u0433\u0440\u0443\u0434\u043d\u044f".split("_"),standalone:"\u0441\u0456\u0447\u0435\u043d\u044c_\u043b\u044e\u0442\u0438\u0439_\u0431\u0435\u0440\u0435\u0437\u0435\u043d\u044c_\u043a\u0432\u0456\u0442\u0435\u043d\u044c_\u0442\u0440\u0430\u0432\u0435\u043d\u044c_\u0447\u0435\u0440\u0432\u0435\u043d\u044c_\u043b\u0438\u043f\u0435\u043d\u044c_\u0441\u0435\u0440\u043f\u0435\u043d\u044c_\u0432\u0435\u0440\u0435\u0441\u0435\u043d\u044c_\u0436\u043e\u0432\u0442\u0435\u043d\u044c_\u043b\u0438\u0441\u0442\u043e\u043f\u0430\u0434_\u0433\u0440\u0443\u0434\u0435\u043d\u044c".split("_")},monthsShort:"\u0441\u0456\u0447_\u043b\u044e\u0442_\u0431\u0435\u0440_\u043a\u0432\u0456\u0442_\u0442\u0440\u0430\u0432_\u0447\u0435\u0440\u0432_\u043b\u0438\u043f_\u0441\u0435\u0440\u043f_\u0432\u0435\u0440_\u0436\u043e\u0432\u0442_\u043b\u0438\u0441\u0442_\u0433\u0440\u0443\u0434".split("_"),weekdays:function(m,format){var weekdays={nominative:"\u043d\u0435\u0434\u0456\u043b\u044f_\u043f\u043e\u043d\u0435\u0434\u0456\u043b\u043e\u043a_\u0432\u0456\u0432\u0442\u043e\u0440\u043e\u043a_\u0441\u0435\u0440\u0435\u0434\u0430_\u0447\u0435\u0442\u0432\u0435\u0440_\u043f\u2019\u044f\u0442\u043d\u0438\u0446\u044f_\u0441\u0443\u0431\u043e\u0442\u0430".split("_"),accusative:"\u043d\u0435\u0434\u0456\u043b\u044e_\u043f\u043e\u043d\u0435\u0434\u0456\u043b\u043e\u043a_\u0432\u0456\u0432\u0442\u043e\u0440\u043e\u043a_\u0441\u0435\u0440\u0435\u0434\u0443_\u0447\u0435\u0442\u0432\u0435\u0440_\u043f\u2019\u044f\u0442\u043d\u0438\u0446\u044e_\u0441\u0443\u0431\u043e\u0442\u0443".split("_"),genitive:"\u043d\u0435\u0434\u0456\u043b\u0456_\u043f\u043e\u043d\u0435\u0434\u0456\u043b\u043a\u0430_\u0432\u0456\u0432\u0442\u043e\u0440\u043a\u0430_\u0441\u0435\u0440\u0435\u0434\u0438_\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0430_\u043f\u2019\u044f\u0442\u043d\u0438\u0446\u0456_\u0441\u0443\u0431\u043e\u0442\u0438".split("_")};return!0===m?weekdays.nominative.slice(1,7).concat(weekdays.nominative.slice(0,1)):m?weekdays[/(\[[\u0412\u0432\u0423\u0443]\]) ?dddd/.test(format)?"accusative":/\[?(?:\u043c\u0438\u043d\u0443\u043b\u043e\u0457|\u043d\u0430\u0441\u0442\u0443\u043f\u043d\u043e\u0457)? ?\] ?dddd/.test(format)?"genitive":"nominative"][m.day()]:weekdays.nominative},weekdaysShort:"\u043d\u0434_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),weekdaysMin:"\u043d\u0434_\u043f\u043d_\u0432\u0442_\u0441\u0440_\u0447\u0442_\u043f\u0442_\u0441\u0431".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY \u0440.",LLL:"D MMMM YYYY \u0440., HH:mm",LLLL:"dddd, D MMMM YYYY \u0440., HH:mm"},calendar:{sameDay:processHoursFunction("[\u0421\u044c\u043e\u0433\u043e\u0434\u043d\u0456 "),nextDay:processHoursFunction("[\u0417\u0430\u0432\u0442\u0440\u0430 "),lastDay:processHoursFunction("[\u0412\u0447\u043e\u0440\u0430 "),nextWeek:processHoursFunction("[\u0423] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return processHoursFunction("[\u041c\u0438\u043d\u0443\u043b\u043e\u0457] dddd [").call(this);case 1:case 2:case 4:return processHoursFunction("[\u041c\u0438\u043d\u0443\u043b\u043e\u0433\u043e] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:"\u0437\u0430 %s",past:"%s \u0442\u043e\u043c\u0443",s:"\u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",ss:relativeTimeWithPlural,m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:"\u0433\u043e\u0434\u0438\u043d\u0443",hh:relativeTimeWithPlural,d:"\u0434\u0435\u043d\u044c",dd:relativeTimeWithPlural,M:"\u043c\u0456\u0441\u044f\u0446\u044c",MM:relativeTimeWithPlural,y:"\u0440\u0456\u043a",yy:relativeTimeWithPlural},meridiemParse:/\u043d\u043e\u0447\u0456|\u0440\u0430\u043d\u043a\u0443|\u0434\u043d\u044f|\u0432\u0435\u0447\u043e\u0440\u0430/,isPM:function(input){return/^(\u0434\u043d\u044f|\u0432\u0435\u0447\u043e\u0440\u0430)$/.test(input)},meridiem:function(hour,minute,isLower){return hour<4?"\u043d\u043e\u0447\u0456":hour<12?"\u0440\u0430\u043d\u043a\u0443":hour<17?"\u0434\u043d\u044f":"\u0432\u0435\u0447\u043e\u0440\u0430"},dayOfMonthOrdinalParse:/\d{1,2}-(\u0439|\u0433\u043e)/,ordinal:function(number,period){switch(period){case"M":case"d":case"DDD":case"w":case"W":return number+"-\u0439";case"D":return number+"-\u0433\u043e";default:return number}},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){var months=["\u062c\u0646\u0648\u0631\u06cc","\u0641\u0631\u0648\u0631\u06cc","\u0645\u0627\u0631\u0686","\u0627\u067e\u0631\u06cc\u0644","\u0645\u0626\u06cc","\u062c\u0648\u0646","\u062c\u0648\u0644\u0627\u0626\u06cc","\u0627\u06af\u0633\u062a","\u0633\u062a\u0645\u0628\u0631","\u0627\u06a9\u062a\u0648\u0628\u0631","\u0646\u0648\u0645\u0628\u0631","\u062f\u0633\u0645\u0628\u0631"],days=["\u0627\u062a\u0648\u0627\u0631","\u067e\u06cc\u0631","\u0645\u0646\u06af\u0644","\u0628\u062f\u06be","\u062c\u0645\u0639\u0631\u0627\u062a","\u062c\u0645\u0639\u06c1","\u06c1\u0641\u062a\u06c1"];moment.defineLocale("ur",{months:months,monthsShort:months,weekdays:days,weekdaysShort:days,weekdaysMin:days,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd\u060c D MMMM YYYY HH:mm"},meridiemParse:/\u0635\u0628\u062d|\u0634\u0627\u0645/,isPM:function(input){return"\u0634\u0627\u0645"===input},meridiem:function(hour,minute,isLower){return hour<12?"\u0635\u0628\u062d":"\u0634\u0627\u0645"},calendar:{sameDay:"[\u0622\u062c \u0628\u0648\u0642\u062a] LT",nextDay:"[\u06a9\u0644 \u0628\u0648\u0642\u062a] LT",nextWeek:"dddd [\u0628\u0648\u0642\u062a] LT",lastDay:"[\u06af\u0630\u0634\u062a\u06c1 \u0631\u0648\u0632 \u0628\u0648\u0642\u062a] LT",lastWeek:"[\u06af\u0630\u0634\u062a\u06c1] dddd [\u0628\u0648\u0642\u062a] LT",sameElse:"L"},relativeTime:{future:"%s \u0628\u0639\u062f",past:"%s \u0642\u0628\u0644",s:"\u0686\u0646\u062f \u0633\u06cc\u06a9\u0646\u0688",ss:"%d \u0633\u06cc\u06a9\u0646\u0688",m:"\u0627\u06cc\u06a9 \u0645\u0646\u0679",mm:"%d \u0645\u0646\u0679",h:"\u0627\u06cc\u06a9 \u06af\u06be\u0646\u0679\u06c1",hh:"%d \u06af\u06be\u0646\u0679\u06d2",d:"\u0627\u06cc\u06a9 \u062f\u0646",dd:"%d \u062f\u0646",M:"\u0627\u06cc\u06a9 \u0645\u0627\u06c1",MM:"%d \u0645\u0627\u06c1",y:"\u0627\u06cc\u06a9 \u0633\u0627\u0644",yy:"%d \u0633\u0627\u0644"},preparse:function(string){return string.replace(/\u060c/g,",")},postformat:function(string){return string.replace(/,/g,"\u060c")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("uz",{months:"\u044f\u043d\u0432\u0430\u0440_\u0444\u0435\u0432\u0440\u0430\u043b_\u043c\u0430\u0440\u0442_\u0430\u043f\u0440\u0435\u043b_\u043c\u0430\u0439_\u0438\u044e\u043d_\u0438\u044e\u043b_\u0430\u0432\u0433\u0443\u0441\u0442_\u0441\u0435\u043d\u0442\u044f\u0431\u0440_\u043e\u043a\u0442\u044f\u0431\u0440_\u043d\u043e\u044f\u0431\u0440_\u0434\u0435\u043a\u0430\u0431\u0440".split("_"),monthsShort:"\u044f\u043d\u0432_\u0444\u0435\u0432_\u043c\u0430\u0440_\u0430\u043f\u0440_\u043c\u0430\u0439_\u0438\u044e\u043d_\u0438\u044e\u043b_\u0430\u0432\u0433_\u0441\u0435\u043d_\u043e\u043a\u0442_\u043d\u043e\u044f_\u0434\u0435\u043a".split("_"),weekdays:"\u042f\u043a\u0448\u0430\u043d\u0431\u0430_\u0414\u0443\u0448\u0430\u043d\u0431\u0430_\u0421\u0435\u0448\u0430\u043d\u0431\u0430_\u0427\u043e\u0440\u0448\u0430\u043d\u0431\u0430_\u041f\u0430\u0439\u0448\u0430\u043d\u0431\u0430_\u0416\u0443\u043c\u0430_\u0428\u0430\u043d\u0431\u0430".split("_"),weekdaysShort:"\u042f\u043a\u0448_\u0414\u0443\u0448_\u0421\u0435\u0448_\u0427\u043e\u0440_\u041f\u0430\u0439_\u0416\u0443\u043c_\u0428\u0430\u043d".split("_"),weekdaysMin:"\u042f\u043a_\u0414\u0443_\u0421\u0435_\u0427\u043e_\u041f\u0430_\u0416\u0443_\u0428\u0430".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[\u0411\u0443\u0433\u0443\u043d \u0441\u043e\u0430\u0442] LT [\u0434\u0430]",nextDay:"[\u042d\u0440\u0442\u0430\u0433\u0430] LT [\u0434\u0430]",nextWeek:"dddd [\u043a\u0443\u043d\u0438 \u0441\u043e\u0430\u0442] LT [\u0434\u0430]",lastDay:"[\u041a\u0435\u0447\u0430 \u0441\u043e\u0430\u0442] LT [\u0434\u0430]",lastWeek:"[\u0423\u0442\u0433\u0430\u043d] dddd [\u043a\u0443\u043d\u0438 \u0441\u043e\u0430\u0442] LT [\u0434\u0430]",sameElse:"L"},relativeTime:{future:"\u042f\u043a\u0438\u043d %s \u0438\u0447\u0438\u0434\u0430",past:"\u0411\u0438\u0440 \u043d\u0435\u0447\u0430 %s \u043e\u043b\u0434\u0438\u043d",s:"\u0444\u0443\u0440\u0441\u0430\u0442",ss:"%d \u0444\u0443\u0440\u0441\u0430\u0442",m:"\u0431\u0438\u0440 \u0434\u0430\u043a\u0438\u043a\u0430",mm:"%d \u0434\u0430\u043a\u0438\u043a\u0430",h:"\u0431\u0438\u0440 \u0441\u043e\u0430\u0442",hh:"%d \u0441\u043e\u0430\u0442",d:"\u0431\u0438\u0440 \u043a\u0443\u043d",dd:"%d \u043a\u0443\u043d",M:"\u0431\u0438\u0440 \u043e\u0439",MM:"%d \u043e\u0439",y:"\u0431\u0438\u0440 \u0439\u0438\u043b",yy:"%d \u0439\u0438\u043b"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("uz-latn",{months:"Yanvar_Fevral_Mart_Aprel_May_Iyun_Iyul_Avgust_Sentabr_Oktabr_Noyabr_Dekabr".split("_"),monthsShort:"Yan_Fev_Mar_Apr_May_Iyun_Iyul_Avg_Sen_Okt_Noy_Dek".split("_"),weekdays:"Yakshanba_Dushanba_Seshanba_Chorshanba_Payshanba_Juma_Shanba".split("_"),weekdaysShort:"Yak_Dush_Sesh_Chor_Pay_Jum_Shan".split("_"),weekdaysMin:"Ya_Du_Se_Cho_Pa_Ju_Sha".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[Bugun soat] LT [da]",nextDay:"[Ertaga] LT [da]",nextWeek:"dddd [kuni soat] LT [da]",lastDay:"[Kecha soat] LT [da]",lastWeek:"[O'tgan] dddd [kuni soat] LT [da]",sameElse:"L"},relativeTime:{future:"Yaqin %s ichida",past:"Bir necha %s oldin",s:"soniya",ss:"%d soniya",m:"bir daqiqa",mm:"%d daqiqa",h:"bir soat",hh:"%d soat",d:"bir kun",dd:"%d kun",M:"bir oy",MM:"%d oy",y:"bir yil",yy:"%d yil"},week:{dow:1,doy:7}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("vi",{months:"th\xe1ng 1_th\xe1ng 2_th\xe1ng 3_th\xe1ng 4_th\xe1ng 5_th\xe1ng 6_th\xe1ng 7_th\xe1ng 8_th\xe1ng 9_th\xe1ng 10_th\xe1ng 11_th\xe1ng 12".split("_"),monthsShort:"Thg 01_Thg 02_Thg 03_Thg 04_Thg 05_Thg 06_Thg 07_Thg 08_Thg 09_Thg 10_Thg 11_Thg 12".split("_"),monthsParseExact:!0,weekdays:"ch\u1ee7 nh\u1eadt_th\u1ee9 hai_th\u1ee9 ba_th\u1ee9 t\u01b0_th\u1ee9 n\u0103m_th\u1ee9 s\xe1u_th\u1ee9 b\u1ea3y".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysParseExact:!0,meridiemParse:/sa|ch/i,isPM:function(input){return/^ch$/i.test(input)},meridiem:function(hours,minutes,isLower){return hours<12?isLower?"sa":"SA":isLower?"ch":"CH"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [n\u0103m] YYYY",LLL:"D MMMM [n\u0103m] YYYY HH:mm",LLLL:"dddd, D MMMM [n\u0103m] YYYY HH:mm",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[H\xf4m nay l\xfac] LT",nextDay:"[Ng\xe0y mai l\xfac] LT",nextWeek:"dddd [tu\u1ea7n t\u1edbi l\xfac] LT",lastDay:"[H\xf4m qua l\xfac] LT",lastWeek:"dddd [tu\u1ea7n tr\u01b0\u1edbc l\xfac] LT",sameElse:"L"},relativeTime:{future:"%s t\u1edbi",past:"%s tr\u01b0\u1edbc",s:"v\xe0i gi\xe2y",ss:"%d gi\xe2y",m:"m\u1ed9t ph\xfat",mm:"%d ph\xfat",h:"m\u1ed9t gi\u1edd",hh:"%d gi\u1edd",d:"m\u1ed9t ng\xe0y",dd:"%d ng\xe0y",w:"m\u1ed9t tu\u1ea7n",ww:"%d tu\u1ea7n",M:"m\u1ed9t th\xe1ng",MM:"%d th\xe1ng",y:"m\u1ed9t n\u0103m",yy:"%d n\u0103m"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(number){return number},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("x-pseudo",{months:"J~\xe1\xf1\xfa\xe1~r\xfd_F~\xe9br\xfa~\xe1r\xfd_~M\xe1rc~h_\xc1p~r\xedl_~M\xe1\xfd_~J\xfa\xf1\xe9~_J\xfal~\xfd_\xc1\xfa~g\xfast~_S\xe9p~t\xe9mb~\xe9r_\xd3~ct\xf3b~\xe9r_\xd1~\xf3v\xe9m~b\xe9r_~D\xe9c\xe9~mb\xe9r".split("_"),monthsShort:"J~\xe1\xf1_~F\xe9b_~M\xe1r_~\xc1pr_~M\xe1\xfd_~J\xfa\xf1_~J\xfal_~\xc1\xfag_~S\xe9p_~\xd3ct_~\xd1\xf3v_~D\xe9c".split("_"),monthsParseExact:!0,weekdays:"S~\xfa\xf1d\xe1~\xfd_M\xf3~\xf1d\xe1\xfd~_T\xfa\xe9~sd\xe1\xfd~_W\xe9d~\xf1\xe9sd~\xe1\xfd_T~h\xfars~d\xe1\xfd_~Fr\xedd~\xe1\xfd_S~\xe1t\xfar~d\xe1\xfd".split("_"),weekdaysShort:"S~\xfa\xf1_~M\xf3\xf1_~T\xfa\xe9_~W\xe9d_~Th\xfa_~Fr\xed_~S\xe1t".split("_"),weekdaysMin:"S~\xfa_M\xf3~_T\xfa_~W\xe9_T~h_Fr~_S\xe1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[T~\xf3d\xe1~\xfd \xe1t] LT",nextDay:"[T~\xf3m\xf3~rr\xf3~w \xe1t] LT",nextWeek:"dddd [\xe1t] LT",lastDay:"[\xdd~\xe9st~\xe9rd\xe1~\xfd \xe1t] LT",lastWeek:"[L~\xe1st] dddd [\xe1t] LT",sameElse:"L"},relativeTime:{future:"\xed~\xf1 %s",past:"%s \xe1~g\xf3",s:"\xe1 ~f\xe9w ~s\xe9c\xf3~\xf1ds",ss:"%d s~\xe9c\xf3\xf1~ds",m:"\xe1 ~m\xed\xf1~\xfat\xe9",mm:"%d m~\xed\xf1\xfa~t\xe9s",h:"\xe1~\xf1 h\xf3~\xfar",hh:"%d h~\xf3\xfars",d:"\xe1 ~d\xe1\xfd",dd:"%d d~\xe1\xfds",M:"\xe1 ~m\xf3\xf1~th",MM:"%d m~\xf3\xf1t~hs",y:"\xe1 ~\xfd\xe9\xe1r",yy:"%d \xfd~\xe9\xe1rs"},dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10;return number+(1==~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("yo",{months:"S\u1eb9\u0301r\u1eb9\u0301_E\u0300re\u0300le\u0300_\u1eb8r\u1eb9\u0300na\u0300_I\u0300gbe\u0301_E\u0300bibi_O\u0300ku\u0300du_Ag\u1eb9mo_O\u0300gu\u0301n_Owewe_\u1ecc\u0300wa\u0300ra\u0300_Be\u0301lu\u0301_\u1ecc\u0300p\u1eb9\u0300\u0300".split("_"),monthsShort:"S\u1eb9\u0301r_E\u0300rl_\u1eb8rn_I\u0300gb_E\u0300bi_O\u0300ku\u0300_Ag\u1eb9_O\u0300gu\u0301_Owe_\u1ecc\u0300wa\u0300_Be\u0301l_\u1ecc\u0300p\u1eb9\u0300\u0300".split("_"),weekdays:"A\u0300i\u0300ku\u0301_Aje\u0301_I\u0300s\u1eb9\u0301gun_\u1eccj\u1ecd\u0301ru\u0301_\u1eccj\u1ecd\u0301b\u1ecd_\u1eb8ti\u0300_A\u0300ba\u0301m\u1eb9\u0301ta".split("_"),weekdaysShort:"A\u0300i\u0300k_Aje\u0301_I\u0300s\u1eb9\u0301_\u1eccjr_\u1eccjb_\u1eb8ti\u0300_A\u0300ba\u0301".split("_"),weekdaysMin:"A\u0300i\u0300_Aj_I\u0300s_\u1eccr_\u1eccb_\u1eb8t_A\u0300b".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[O\u0300ni\u0300 ni] LT",nextDay:"[\u1ecc\u0300la ni] LT",nextWeek:"dddd [\u1eccs\u1eb9\u0300 to\u0301n'b\u1ecd] [ni] LT",lastDay:"[A\u0300na ni] LT",lastWeek:"dddd [\u1eccs\u1eb9\u0300 to\u0301l\u1ecd\u0301] [ni] LT",sameElse:"L"},relativeTime:{future:"ni\u0301 %s",past:"%s k\u1ecdja\u0301",s:"i\u0300s\u1eb9ju\u0301 aaya\u0301 die",ss:"aaya\u0301 %d",m:"i\u0300s\u1eb9ju\u0301 kan",mm:"i\u0300s\u1eb9ju\u0301 %d",h:"wa\u0301kati kan",hh:"wa\u0301kati %d",d:"\u1ecdj\u1ecd\u0301 kan",dd:"\u1ecdj\u1ecd\u0301 %d",M:"osu\u0300 kan",MM:"osu\u0300 %d",y:"\u1ecddu\u0301n kan",yy:"\u1ecddu\u0301n %d"},dayOfMonthOrdinalParse:/\u1ecdj\u1ecd\u0301\s\d{1,2}/,ordinal:"\u1ecdj\u1ecd\u0301 %d",week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("zh-cn",{months:"\u4e00\u6708_\u4e8c\u6708_\u4e09\u6708_\u56db\u6708_\u4e94\u6708_\u516d\u6708_\u4e03\u6708_\u516b\u6708_\u4e5d\u6708_\u5341\u6708_\u5341\u4e00\u6708_\u5341\u4e8c\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u661f\u671f\u65e5_\u661f\u671f\u4e00_\u661f\u671f\u4e8c_\u661f\u671f\u4e09_\u661f\u671f\u56db_\u661f\u671f\u4e94_\u661f\u671f\u516d".split("_"),weekdaysShort:"\u5468\u65e5_\u5468\u4e00_\u5468\u4e8c_\u5468\u4e09_\u5468\u56db_\u5468\u4e94_\u5468\u516d".split("_"),weekdaysMin:"\u65e5_\u4e00_\u4e8c_\u4e09_\u56db_\u4e94_\u516d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5Ah\u70b9mm\u5206",LLLL:"YYYY\u5e74M\u6708D\u65e5ddddAh\u70b9mm\u5206",l:"YYYY/M/D",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm"},meridiemParse:/\u51cc\u6668|\u65e9\u4e0a|\u4e0a\u5348|\u4e2d\u5348|\u4e0b\u5348|\u665a\u4e0a/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u51cc\u6668"===meridiem||"\u65e9\u4e0a"===meridiem||"\u4e0a\u5348"===meridiem?hour:"\u4e0b\u5348"===meridiem||"\u665a\u4e0a"===meridiem?hour+12:hour>=11?hour:hour+12},meridiem:function(hour,minute,isLower){var hm=100*hour+minute;return hm<600?"\u51cc\u6668":hm<900?"\u65e9\u4e0a":hm<1130?"\u4e0a\u5348":hm<1230?"\u4e2d\u5348":hm<1800?"\u4e0b\u5348":"\u665a\u4e0a"},calendar:{sameDay:"[\u4eca\u5929]LT",nextDay:"[\u660e\u5929]LT",nextWeek:function(now){return now.week()!==this.week()?"[\u4e0b]dddLT":"[\u672c]dddLT"},lastDay:"[\u6628\u5929]LT",lastWeek:function(now){return this.week()!==now.week()?"[\u4e0a]dddLT":"[\u672c]dddLT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(\u65e5|\u6708|\u5468)/,ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"\u65e5";case"M":return number+"\u6708";case"w":case"W":return number+"\u5468";default:return number}},relativeTime:{future:"%s\u540e",past:"%s\u524d",s:"\u51e0\u79d2",ss:"%d \u79d2",m:"1 \u5206\u949f",mm:"%d \u5206\u949f",h:"1 \u5c0f\u65f6",hh:"%d \u5c0f\u65f6",d:"1 \u5929",dd:"%d \u5929",w:"1 \u5468",ww:"%d \u5468",M:"1 \u4e2a\u6708",MM:"%d \u4e2a\u6708",y:"1 \u5e74",yy:"%d \u5e74"},week:{dow:1,doy:4}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("zh-hk",{months:"\u4e00\u6708_\u4e8c\u6708_\u4e09\u6708_\u56db\u6708_\u4e94\u6708_\u516d\u6708_\u4e03\u6708_\u516b\u6708_\u4e5d\u6708_\u5341\u6708_\u5341\u4e00\u6708_\u5341\u4e8c\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u661f\u671f\u65e5_\u661f\u671f\u4e00_\u661f\u671f\u4e8c_\u661f\u671f\u4e09_\u661f\u671f\u56db_\u661f\u671f\u4e94_\u661f\u671f\u516d".split("_"),weekdaysShort:"\u9031\u65e5_\u9031\u4e00_\u9031\u4e8c_\u9031\u4e09_\u9031\u56db_\u9031\u4e94_\u9031\u516d".split("_"),weekdaysMin:"\u65e5_\u4e00_\u4e8c_\u4e09_\u56db_\u4e94_\u516d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5 HH:mm",LLLL:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm",l:"YYYY/M/D",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm"},meridiemParse:/\u51cc\u6668|\u65e9\u4e0a|\u4e0a\u5348|\u4e2d\u5348|\u4e0b\u5348|\u665a\u4e0a/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u51cc\u6668"===meridiem||"\u65e9\u4e0a"===meridiem||"\u4e0a\u5348"===meridiem?hour:"\u4e2d\u5348"===meridiem?hour>=11?hour:hour+12:"\u4e0b\u5348"===meridiem||"\u665a\u4e0a"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){var hm=100*hour+minute;return hm<600?"\u51cc\u6668":hm<900?"\u65e9\u4e0a":hm<1200?"\u4e0a\u5348":1200===hm?"\u4e2d\u5348":hm<1800?"\u4e0b\u5348":"\u665a\u4e0a"},calendar:{sameDay:"[\u4eca\u5929]LT",nextDay:"[\u660e\u5929]LT",nextWeek:"[\u4e0b]ddddLT",lastDay:"[\u6628\u5929]LT",lastWeek:"[\u4e0a]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(\u65e5|\u6708|\u9031)/,ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"\u65e5";case"M":return number+"\u6708";case"w":case"W":return number+"\u9031";default:return number}},relativeTime:{future:"%s\u5f8c",past:"%s\u524d",s:"\u5e7e\u79d2",ss:"%d \u79d2",m:"1 \u5206\u9418",mm:"%d \u5206\u9418",h:"1 \u5c0f\u6642",hh:"%d \u5c0f\u6642",d:"1 \u5929",dd:"%d \u5929",M:"1 \u500b\u6708",MM:"%d \u500b\u6708",y:"1 \u5e74",yy:"%d \u5e74"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("zh-mo",{months:"\u4e00\u6708_\u4e8c\u6708_\u4e09\u6708_\u56db\u6708_\u4e94\u6708_\u516d\u6708_\u4e03\u6708_\u516b\u6708_\u4e5d\u6708_\u5341\u6708_\u5341\u4e00\u6708_\u5341\u4e8c\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u661f\u671f\u65e5_\u661f\u671f\u4e00_\u661f\u671f\u4e8c_\u661f\u671f\u4e09_\u661f\u671f\u56db_\u661f\u671f\u4e94_\u661f\u671f\u516d".split("_"),weekdaysShort:"\u9031\u65e5_\u9031\u4e00_\u9031\u4e8c_\u9031\u4e09_\u9031\u56db_\u9031\u4e94_\u9031\u516d".split("_"),weekdaysMin:"\u65e5_\u4e00_\u4e8c_\u4e09_\u56db_\u4e94_\u516d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5 HH:mm",LLLL:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm",l:"D/M/YYYY",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm"},meridiemParse:/\u51cc\u6668|\u65e9\u4e0a|\u4e0a\u5348|\u4e2d\u5348|\u4e0b\u5348|\u665a\u4e0a/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u51cc\u6668"===meridiem||"\u65e9\u4e0a"===meridiem||"\u4e0a\u5348"===meridiem?hour:"\u4e2d\u5348"===meridiem?hour>=11?hour:hour+12:"\u4e0b\u5348"===meridiem||"\u665a\u4e0a"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){var hm=100*hour+minute;return hm<600?"\u51cc\u6668":hm<900?"\u65e9\u4e0a":hm<1130?"\u4e0a\u5348":hm<1230?"\u4e2d\u5348":hm<1800?"\u4e0b\u5348":"\u665a\u4e0a"},calendar:{sameDay:"[\u4eca\u5929] LT",nextDay:"[\u660e\u5929] LT",nextWeek:"[\u4e0b]dddd LT",lastDay:"[\u6628\u5929] LT",lastWeek:"[\u4e0a]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(\u65e5|\u6708|\u9031)/,ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"\u65e5";case"M":return number+"\u6708";case"w":case"W":return number+"\u9031";default:return number}},relativeTime:{future:"%s\u5167",past:"%s\u524d",s:"\u5e7e\u79d2",ss:"%d \u79d2",m:"1 \u5206\u9418",mm:"%d \u5206\u9418",h:"1 \u5c0f\u6642",hh:"%d \u5c0f\u6642",d:"1 \u5929",dd:"%d \u5929",M:"1 \u500b\u6708",MM:"%d \u500b\u6708",y:"1 \u5e74",yy:"%d \u5e74"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){!function(moment){moment.defineLocale("zh-tw",{months:"\u4e00\u6708_\u4e8c\u6708_\u4e09\u6708_\u56db\u6708_\u4e94\u6708_\u516d\u6708_\u4e03\u6708_\u516b\u6708_\u4e5d\u6708_\u5341\u6708_\u5341\u4e00\u6708_\u5341\u4e8c\u6708".split("_"),monthsShort:"1\u6708_2\u6708_3\u6708_4\u6708_5\u6708_6\u6708_7\u6708_8\u6708_9\u6708_10\u6708_11\u6708_12\u6708".split("_"),weekdays:"\u661f\u671f\u65e5_\u661f\u671f\u4e00_\u661f\u671f\u4e8c_\u661f\u671f\u4e09_\u661f\u671f\u56db_\u661f\u671f\u4e94_\u661f\u671f\u516d".split("_"),weekdaysShort:"\u9031\u65e5_\u9031\u4e00_\u9031\u4e8c_\u9031\u4e09_\u9031\u56db_\u9031\u4e94_\u9031\u516d".split("_"),weekdaysMin:"\u65e5_\u4e00_\u4e8c_\u4e09_\u56db_\u4e94_\u516d".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY\u5e74M\u6708D\u65e5",LLL:"YYYY\u5e74M\u6708D\u65e5 HH:mm",LLLL:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm",l:"YYYY/M/D",ll:"YYYY\u5e74M\u6708D\u65e5",lll:"YYYY\u5e74M\u6708D\u65e5 HH:mm",llll:"YYYY\u5e74M\u6708D\u65e5dddd HH:mm"},meridiemParse:/\u51cc\u6668|\u65e9\u4e0a|\u4e0a\u5348|\u4e2d\u5348|\u4e0b\u5348|\u665a\u4e0a/,meridiemHour:function(hour,meridiem){return 12===hour&&(hour=0),"\u51cc\u6668"===meridiem||"\u65e9\u4e0a"===meridiem||"\u4e0a\u5348"===meridiem?hour:"\u4e2d\u5348"===meridiem?hour>=11?hour:hour+12:"\u4e0b\u5348"===meridiem||"\u665a\u4e0a"===meridiem?hour+12:void 0},meridiem:function(hour,minute,isLower){var hm=100*hour+minute;return hm<600?"\u51cc\u6668":hm<900?"\u65e9\u4e0a":hm<1130?"\u4e0a\u5348":hm<1230?"\u4e2d\u5348":hm<1800?"\u4e0b\u5348":"\u665a\u4e0a"},calendar:{sameDay:"[\u4eca\u5929] LT",nextDay:"[\u660e\u5929] LT",nextWeek:"[\u4e0b]dddd LT",lastDay:"[\u6628\u5929] LT",lastWeek:"[\u4e0a]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(\u65e5|\u6708|\u9031)/,ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"\u65e5";case"M":return number+"\u6708";case"w":case"W":return number+"\u9031";default:return number}},relativeTime:{future:"%s\u5f8c",past:"%s\u524d",s:"\u5e7e\u79d2",ss:"%d \u79d2",m:"1 \u5206\u9418",mm:"%d \u5206\u9418",h:"1 \u5c0f\u6642",hh:"%d \u5c0f\u6642",d:"1 \u5929",dd:"%d \u5929",M:"1 \u500b\u6708",MM:"%d \u500b\u6708",y:"1 \u5e74",yy:"%d \u5e74"}})}(__webpack_require__(3))},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),function(Math){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,H=[],K=[];!function(){function isPrime(n){for(var sqrtN=Math.sqrt(n),factor=2;factor<=sqrtN;factor++)if(!(n%factor))return!1;return!0}function getFractionalBits(n){return 4294967296*(n-(0|n))|0}for(var n=2,nPrime=0;nPrime<64;)isPrime(n)&&(nPrime<8&&(H[nPrime]=getFractionalBits(Math.pow(n,.5))),K[nPrime]=getFractionalBits(Math.pow(n,1/3)),nPrime++),n++}();var W=[],SHA256=C_algo.SHA256=Hasher.extend({_doReset:function(){this._hash=new WordArray.init(H.slice(0))},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],f=H[5],g=H[6],h=H[7],i=0;i<64;i++){if(i<16)W[i]=0|M[offset+i];else{var gamma0x=W[i-15],gamma0=(gamma0x<<25|gamma0x>>>7)^(gamma0x<<14|gamma0x>>>18)^gamma0x>>>3,gamma1x=W[i-2],gamma1=(gamma1x<<15|gamma1x>>>17)^(gamma1x<<13|gamma1x>>>19)^gamma1x>>>10;W[i]=gamma0+W[i-7]+gamma1+W[i-16]}var maj=a&b^a&c^b&c,sigma0=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),t1=h+((e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25))+(e&f^~e&g)+K[i]+W[i];h=g,g=f,f=e,e=d+t1|0,d=c,c=b,b=a,a=t1+(sigma0+maj)|0}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0,H[5]=H[5]+f|0,H[6]=H[6]+g|0,H[7]=H[7]+h|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[14+(nBitsLeft+64>>>9<<4)]=Math.floor(nBitsTotal/4294967296),dataWords[15+(nBitsLeft+64>>>9<<4)]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});C.SHA256=Hasher._createHelper(SHA256),C.HmacSHA256=Hasher._createHmacHelper(SHA256)}(Math),CryptoJS.SHA256)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(61),function(){var C=CryptoJS,Hasher=C.lib.Hasher,C_x64=C.x64,X64Word=C_x64.Word,X64WordArray=C_x64.WordArray,C_algo=C.algo;function X64Word_create(){return X64Word.create.apply(X64Word,arguments)}var K=[X64Word_create(1116352408,3609767458),X64Word_create(1899447441,602891725),X64Word_create(3049323471,3964484399),X64Word_create(3921009573,2173295548),X64Word_create(961987163,4081628472),X64Word_create(1508970993,3053834265),X64Word_create(2453635748,2937671579),X64Word_create(2870763221,3664609560),X64Word_create(3624381080,2734883394),X64Word_create(310598401,1164996542),X64Word_create(607225278,1323610764),X64Word_create(1426881987,3590304994),X64Word_create(1925078388,4068182383),X64Word_create(2162078206,991336113),X64Word_create(2614888103,633803317),X64Word_create(3248222580,3479774868),X64Word_create(3835390401,2666613458),X64Word_create(4022224774,944711139),X64Word_create(264347078,2341262773),X64Word_create(604807628,2007800933),X64Word_create(770255983,1495990901),X64Word_create(1249150122,1856431235),X64Word_create(1555081692,3175218132),X64Word_create(1996064986,2198950837),X64Word_create(2554220882,3999719339),X64Word_create(2821834349,766784016),X64Word_create(2952996808,2566594879),X64Word_create(3210313671,3203337956),X64Word_create(3336571891,1034457026),X64Word_create(3584528711,2466948901),X64Word_create(113926993,3758326383),X64Word_create(338241895,168717936),X64Word_create(666307205,1188179964),X64Word_create(773529912,1546045734),X64Word_create(1294757372,1522805485),X64Word_create(1396182291,2643833823),X64Word_create(1695183700,2343527390),X64Word_create(1986661051,1014477480),X64Word_create(2177026350,1206759142),X64Word_create(2456956037,344077627),X64Word_create(2730485921,1290863460),X64Word_create(2820302411,3158454273),X64Word_create(3259730800,3505952657),X64Word_create(3345764771,106217008),X64Word_create(3516065817,3606008344),X64Word_create(3600352804,1432725776),X64Word_create(4094571909,1467031594),X64Word_create(275423344,851169720),X64Word_create(430227734,3100823752),X64Word_create(506948616,1363258195),X64Word_create(659060556,3750685593),X64Word_create(883997877,3785050280),X64Word_create(958139571,3318307427),X64Word_create(1322822218,3812723403),X64Word_create(1537002063,2003034995),X64Word_create(1747873779,3602036899),X64Word_create(1955562222,1575990012),X64Word_create(2024104815,1125592928),X64Word_create(2227730452,2716904306),X64Word_create(2361852424,442776044),X64Word_create(2428436474,593698344),X64Word_create(2756734187,3733110249),X64Word_create(3204031479,2999351573),X64Word_create(3329325298,3815920427),X64Word_create(3391569614,3928383900),X64Word_create(3515267271,566280711),X64Word_create(3940187606,3454069534),X64Word_create(4118630271,4000239992),X64Word_create(116418474,1914138554),X64Word_create(174292421,2731055270),X64Word_create(289380356,3203993006),X64Word_create(460393269,320620315),X64Word_create(685471733,587496836),X64Word_create(852142971,1086792851),X64Word_create(1017036298,365543100),X64Word_create(1126000580,2618297676),X64Word_create(1288033470,3409855158),X64Word_create(1501505948,4234509866),X64Word_create(1607167915,987167468),X64Word_create(1816402316,1246189591)],W=[];!function(){for(var i=0;i<80;i++)W[i]=X64Word_create()}();var SHA512=C_algo.SHA512=Hasher.extend({_doReset:function(){this._hash=new X64WordArray.init([new X64Word.init(1779033703,4089235720),new X64Word.init(3144134277,2227873595),new X64Word.init(1013904242,4271175723),new X64Word.init(2773480762,1595750129),new X64Word.init(1359893119,2917565137),new X64Word.init(2600822924,725511199),new X64Word.init(528734635,4215389547),new X64Word.init(1541459225,327033209)])},_doProcessBlock:function(M,offset){for(var H=this._hash.words,H0=H[0],H1=H[1],H2=H[2],H3=H[3],H4=H[4],H5=H[5],H6=H[6],H7=H[7],H0h=H0.high,H0l=H0.low,H1h=H1.high,H1l=H1.low,H2h=H2.high,H2l=H2.low,H3h=H3.high,H3l=H3.low,H4h=H4.high,H4l=H4.low,H5h=H5.high,H5l=H5.low,H6h=H6.high,H6l=H6.low,H7h=H7.high,H7l=H7.low,ah=H0h,al=H0l,bh=H1h,bl=H1l,ch=H2h,cl=H2l,dh=H3h,dl=H3l,eh=H4h,el=H4l,fh=H5h,fl=H5l,gh=H6h,gl=H6l,hh=H7h,hl=H7l,i=0;i<80;i++){var Wi=W[i];if(i<16)var Wih=Wi.high=0|M[offset+2*i],Wil=Wi.low=0|M[offset+2*i+1];else{var gamma0x=W[i-15],gamma0xh=gamma0x.high,gamma0xl=gamma0x.low,gamma0h=(gamma0xh>>>1|gamma0xl<<31)^(gamma0xh>>>8|gamma0xl<<24)^gamma0xh>>>7,gamma0l=(gamma0xl>>>1|gamma0xh<<31)^(gamma0xl>>>8|gamma0xh<<24)^(gamma0xl>>>7|gamma0xh<<25),gamma1x=W[i-2],gamma1xh=gamma1x.high,gamma1xl=gamma1x.low,gamma1h=(gamma1xh>>>19|gamma1xl<<13)^(gamma1xh<<3|gamma1xl>>>29)^gamma1xh>>>6,gamma1l=(gamma1xl>>>19|gamma1xh<<13)^(gamma1xl<<3|gamma1xh>>>29)^(gamma1xl>>>6|gamma1xh<<26),Wi7=W[i-7],Wi7h=Wi7.high,Wi7l=Wi7.low,Wi16=W[i-16],Wi16h=Wi16.high,Wi16l=Wi16.low;Wih=(Wih=(Wih=gamma0h+Wi7h+((Wil=gamma0l+Wi7l)>>>0<gamma0l>>>0?1:0))+gamma1h+((Wil+=gamma1l)>>>0<gamma1l>>>0?1:0))+Wi16h+((Wil+=Wi16l)>>>0<Wi16l>>>0?1:0),Wi.high=Wih,Wi.low=Wil}var t1l,chh=eh&fh^~eh&gh,chl=el&fl^~el&gl,majh=ah&bh^ah&ch^bh&ch,majl=al&bl^al&cl^bl&cl,sigma0h=(ah>>>28|al<<4)^(ah<<30|al>>>2)^(ah<<25|al>>>7),sigma0l=(al>>>28|ah<<4)^(al<<30|ah>>>2)^(al<<25|ah>>>7),sigma1h=(eh>>>14|el<<18)^(eh>>>18|el<<14)^(eh<<23|el>>>9),sigma1l=(el>>>14|eh<<18)^(el>>>18|eh<<14)^(el<<23|eh>>>9),Ki=K[i],Kih=Ki.high,Kil=Ki.low,t1h=hh+sigma1h+((t1l=hl+sigma1l)>>>0<hl>>>0?1:0),t2l=sigma0l+majl;hh=gh,hl=gl,gh=fh,gl=fl,fh=eh,fl=el,eh=dh+(t1h=(t1h=(t1h=t1h+chh+((t1l+=chl)>>>0<chl>>>0?1:0))+Kih+((t1l+=Kil)>>>0<Kil>>>0?1:0))+Wih+((t1l+=Wil)>>>0<Wil>>>0?1:0))+((el=dl+t1l|0)>>>0<dl>>>0?1:0)|0,dh=ch,dl=cl,ch=bh,cl=bl,bh=ah,bl=al,ah=t1h+(sigma0h+majh+(t2l>>>0<sigma0l>>>0?1:0))+((al=t1l+t2l|0)>>>0<t1l>>>0?1:0)|0}H0l=H0.low=H0l+al,H0.high=H0h+ah+(H0l>>>0<al>>>0?1:0),H1l=H1.low=H1l+bl,H1.high=H1h+bh+(H1l>>>0<bl>>>0?1:0),H2l=H2.low=H2l+cl,H2.high=H2h+ch+(H2l>>>0<cl>>>0?1:0),H3l=H3.low=H3l+dl,H3.high=H3h+dh+(H3l>>>0<dl>>>0?1:0),H4l=H4.low=H4l+el,H4.high=H4h+eh+(H4l>>>0<el>>>0?1:0),H5l=H5.low=H5l+fl,H5.high=H5h+fh+(H5l>>>0<fl>>>0?1:0),H6l=H6.low=H6l+gl,H6.high=H6h+gh+(H6l>>>0<gl>>>0?1:0),H7l=H7.low=H7l+hl,H7.high=H7h+hh+(H7l>>>0<hl>>>0?1:0)},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[30+(nBitsLeft+128>>>10<<5)]=Math.floor(nBitsTotal/4294967296),dataWords[31+(nBitsLeft+128>>>10<<5)]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash.toX32()},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone},blockSize:32});C.SHA512=Hasher._createHelper(SHA512),C.HmacSHA512=Hasher._createHmacHelper(SHA512)}(),CryptoJS.SHA512)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){for(var length=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",charactersLength=characters.length,result="",i=0;i<length;i++)result+=characters.charAt(Math.floor(Math.random()*charactersLength));return result}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),Channel=function(){function Channel(name,id,visibility,topic,creatorId,companyId,creationDate,users_count,lastAvatarUpdateDate,subscribed,type,invited,category,mode,subscribers_count,muted){_classCallCheck(this,Channel),this.userRole="none",this.messageRetrieved=!1,this.messages=[],this.subscribed=!1,this.deleted=!1,this.invited=!1,this.type="SIMPLE",this.pageIndex=0,this.isLoading=!1,this.complete=!1,this.users=[],this.publishersRetreived=!1,this.loaded=!1,this.muted=!1,this.name=name,this.id=id,this.visibility=visibility,this.topic=topic,this.creatorId=creatorId,this.companyId=companyId,this.creationDate=creationDate,this.type=type,this.users_count=users_count,this.subscribers_count=subscribers_count,this.category=category,this.mode=mode,this.lastAvatarUpdateDate=lastAvatarUpdateDate;var timestamp=this.lastAvatarUpdateDate?"&ts="+new Date(this.lastAvatarUpdateDate).getTime():"";if(this.avatar=config.restServerUrl+"/api/channel-avatar/"+id+"?size=256"+timestamp,void 0!==subscribed&&(this.subscribed=subscribed),void 0!==type&&(this.userRole=type,this.subscribed="none"!==type),void 0!==invited&&(this.invited=invited),!this.mode)switch(this.visibility){case"company":this.mode="company_public";break;case"public":this.mode="all_public";break;case"private":this.mode="company_private"}this.updateSubject=new rxjs_1.Subject,this.muted=muted}return _createClass(Channel,[{key:"isNotMember",value:function(){return this.userRole="none"}},{key:"isOwner",value:function(){return"owner"===this.userRole}},{key:"isPublisher",value:function(){return this.subscribed&&("owner"===this.userRole||"publisher"===this.userRole)}},{key:"isMember",value:function(){return"member"===this.userRole}},{key:"getAvatarSrc",value:function(){return this.lastAvatarUpdateDate?this.avatar:"/resources/skins/rainbow/images/channels/default_channel_avatar.png"}}],[{key:"create",value:function(data){var channel=new Channel(data.name,data.id,data.visibility,data.topic,data.creatorId,data.companyId,data.creationDate,data.users_count,data.lastAvatarUpdateDate,data.subscribed,data.type,data.invited,data.category,data.mode,data.subscribers_count,data.mute);return channel.category||(channel.category="globalnews"),channel}}]),Channel}();exports.Channel=Channel},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var SearchTextMsgResult=function(){function SearchTextMsgResult(){_classCallCheck(this,SearchTextMsgResult),this.body=void 0,this.date=void 0,this.isRoom=!1,this.isSent=!1,this.messageId=void 0,this.otherJid=null,this.historyIndex=null}return _createClass(SearchTextMsgResult,null,[{key:"SearchTextMsgResultFactory",value:function(){return function(){return new SearchTextMsgResult}}}]),SearchTextMsgResult}();exports.SearchTextMsgResult=SearchTextMsgResult,exports.SearchTextResult=function(){function _class4(convId){_classCallCheck(this,_class4),this.room=null,this.contact=null,this.totalCount=0,this.convRes=[],this.otherJid=convId}return _createClass(_class4,[{key:"addMsgItem",value:function(msgItem){this.convRes.push(msgItem)}},{key:"isRoom",value:function(){return this.conversation?null!=this.conversation.room:null!==this.room}}]),_class4}();var SearchTextConvResults=function(){function SearchTextConvResults(){_classCallCheck(this,SearchTextConvResults),this._searchedText=null,this.normalizedSearchText=null,this.queryIds=[],this.results=[],this.totalCount=0,this.currentMessageId=null,this.isSearching=!1}return _createClass(SearchTextConvResults,[{key:"searchedText",get:function(){return this._searchedText},set:function(searchText){this._searchedText=searchText,this.normalizedSearchText=searchText?searchText.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""):null}},{key:"isEmpty",value:function(){return 0===this.queryIds.length||0===Object.keys(this.results).length}},{key:"clearAll",value:function(){this.searchedText=null,this.queryIds=[],this.partResults=[],this.totalCount=0,this.currentMessageId=null,this.results.splice(0,this.results.length)}},{key:"isCurrentQuery",value:function(queryId){return this.queryIds.indexOf(queryId)>-1}},{key:"getResultByJid",value:function(convJid){return this.results.find((function(result){return result.otherJid===convJid}))}}]),SearchTextConvResults}();exports.SearchTextConvResults=SearchTextConvResults,angular.module("rainbow").factory("SearchTextConvResultsFactory",(function(){return function(){return new SearchTextConvResults}})),angular.module("rainbow").factory("SearchTextMsgResultFactory",SearchTextMsgResult.SearchTextMsgResultFactory)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var ReplaceMsg=function(){function ReplaceMsg(id,body){_classCallCheck(this,ReplaceMsg),this.id=id,this.body=body}return _createClass(ReplaceMsg,null,[{key:"create",value:function(id,body){return new ReplaceMsg(id,(emojione?emojione.toShort:function(text){return text})(body))}}]),ReplaceMsg}();exports.ReplaceMsg=ReplaceMsg},function(module,exports){var getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);module.exports=function(){return getRandomValues(rnds8),rnds8}}else{var rnds=new Array(16);module.exports=function(){for(var r,i=0;i<16;i++)0==(3&i)&&(r=4294967296*Math.random()),rnds[i]=r>>>((3&i)<<3)&255;return rnds}}},function(module,exports){for(var byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);module.exports=function(buf,offset){var i=offset||0,bth=byteToHex;return[bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]]].join("")}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var message_1=__webpack_require__(16),xmpp_service_1=__webpack_require__(4),fileStorage_service_1=__webpack_require__(25),contact_service_1=__webpack_require__(1),logger_service_1=__webpack_require__(15),room_service_1=__webpack_require__(33),moment=__webpack_require__(3),ConversationServiceEventHandler=function(){function ConversationServiceEventHandler($rootScope,Conversation,fileServerService,webrtcGatewayService,conversationService){_classCallCheck(this,ConversationServiceEventHandler),this.$rootScope=$rootScope,this.Conversation=Conversation,this.fileServerService=fileServerService,this.webrtcGatewayService=webrtcGatewayService,this.conversationService=conversationService}return _createClass(ConversationServiceEventHandler,[{key:"onChatMessageReceived",value:function(stanza){var _this126=this;try{var stanzaElem=$(stanza);return stanzaElem.find("event").length>0||stanzaElem.find("propose").length>0||stanzaElem.find("received").length>0?(logger_service_1.default.info("[ConversationServiceEventHandler] onChatMessageReceived ignore the message"),!0):(stanzaElem.find("recording").length>0?(logger_service_1.default.info("[ConversationServiceEventHandler] onChatMessageReceived : recording msg case"),this.onRecordingMessageReceived(stanza)):this.extractStanzaData(stanza).then((function(stanzaData){stanzaData&&(stanzaData.body||stanzaData.oob||stanzaData.conference||stanzaData.replace?(logger_service_1.default.info("[ConversationServiceEventHandler] onChatMessageReceived"),_this126.handleChatMessage(stanzaData)):stanzaData.outgoingMessage||contact_service_1.default.isUserContact(stanzaData.participant)||!stanzaData.status||_this126.handleStatusMessage(stanzaData.conversation,stanzaData.participant,stanza))})),!0)}catch(error){return logger_service_1.default.error("[ConversationServiceEventHandler] onChatMessageReceived ERROR "+error),!0}}},{key:"onConferenceMessageReceived",value:function(stanza){var _this127=this;logger_service_1.default.info("[ConversationServiceEventHandler] onConferenceMessageReceived");try{return 0===$(stanza).find("event").length?logger_service_1.default.info("[ConversationServiceEventHandler] onConferenceMessageReceived ignore the message"):this.extractStanzaData(stanza).then((function(stanzaData){stanzaData.conference&&_this127.handleChatMessage(stanzaData)})),!0}catch(error){return logger_service_1.default.error("[ConversationServiceEventHandler] onConferenceMessageReceived ERROR "+error),!0}}},{key:"onRoomAdminMessageReceived",value:function(conversation,contact,type,msgId){logger_service_1.default.info("[ConversationServiceEventHandler] onRoomAdminMessageReceived");var message=conversation.addAdminBubbleMessage(contact,new Date,type,msgId);conversation.setStatusMessage(contact,this.Conversation.Status.ACTIVE),this.conversationService.sendAckReceivedMessage(conversation,message),conversation===this.conversationService.activeConversation&&this.$rootScope.appVisible||conversation.setMissedCounter(conversation.missedCounter+1),this.$rootScope.$broadcast("ON_CONVERSATION_MESSAGE_RECEIVED",message,conversation,!1),this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation,this.Conversation.EventType.IM)}},{key:"onFileMessageReceived",value:function(stanza){var _this128=this;logger_service_1.default.info("[ConversationServiceEventHandler] onFileMessageReceived");try{return this.extractStanzaData(stanza).then((function(stanzaData){if(stanzaData.body){var conversation=stanzaData.conversation;conversation.addFileMessage(stanzaData.participant,stanzaData.date,stanzaData.body,stanzaData.messageId,stanzaData.urgency),conversation.setStatusMessage(stanzaData.participant,_this128.Conversation.Status.ACTIVE),_this128.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation,_this128.Conversation.EventType.FILE)}})),!0}catch(error){return logger_service_1.default.error("[ConversationServiceEventHandler] onFileMessageReceived ERROR "+error),!0}}},{key:"onWebRTCMessageReceived",value:function(stanza){var _this129=this;logger_service_1.default.info("[ConversationServiceEventHandler] onWebRTCMessageReceived");try{return $(stanza).find("call_log").length>0?this.extractWebrtcStanzaData(stanza).then((function(stanzaData){if(stanzaData&&stanzaData.body){var conversation=stanzaData.conversation,message=conversation.addWebRTCMessage(stanzaData.participant,stanzaData.date,stanzaData.body,stanzaData.messageId);conversation.setStatusMessage(stanzaData.participant,_this129.Conversation.Status.ACTIVE),_this129.conversationService.sendAckReceivedMessage(conversation,message),"R"===message.side||stanzaData.state&&"answered"===stanzaData.state?_this129.conversationService.sendAckReadMessage(conversation,message):conversation===_this129.conversationService.activeConversation&&_this129.$rootScope.appVisible||conversation.setMissedCounter(conversation.missedCounter+1),_this129.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation)}})):this.extractStanzaData(stanza).then((function(stanzaData){if(stanzaData&&stanzaData.body){var conversation=stanzaData.conversation;conversation.addWebRTCMessage(stanzaData.participant,stanzaData.date,stanzaData.body,stanzaData.messageId),conversation.setStatusMessage(stanzaData.participant,_this129.Conversation.Status.ACTIVE),_this129.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation)}})),!0}catch(error){return logger_service_1.default.error("[ConversationServiceEventHandler] onWebRTCMessageReceived error "+error),!0}}},{key:"onManagementMessageReceived",value:function(stanza){var _this130=this;try{var stanzaElem=$(stanza),conversationElem=stanzaElem.find("conversation");if(conversationElem){var action=conversationElem.attr("action"),conversationGetterPromise=null;if("create"===action){var jid=xmpp_service_1.default.getBareJidFromJid(conversationElem.find("peer").text()),convType=conversationElem.find("type").text(),dbId=conversationElem.attr("id");conversationGetterPromise=this.conversationService.getConversationAsyncById(jid,convType,dbId)}else conversationGetterPromise=Promise.resolve(this.conversationService.getConversationByDbId(conversationElem.attr("id")));conversationGetterPromise.then((function(conversation){if(logger_service_1.default.info("[ConversationServiceEventHandler] onManagementMessageReceived ("+action+" conversation)"),conversation)switch(action){case"create":conversation.dbId=conversationElem.attr("id");var lastMessageDate=conversationElem.find("lastMessageDate").text();lastMessageDate&&lastMessageDate.length>0&&(conversation.lastModification=new Date(lastMessageDate)),conversation.missedCounter=parseInt(conversationElem.find("unreadMessageNumber").text(),10)||0,conversation.muted="true"===conversationElem.find("mute").text(),_this130.conversationService.favoriteService.updateFavoriteConversations(conversation),_this130.conversationService.orderConversations(),_this130.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT");break;case"delete":_this130.conversationService.removeConversation(conversation)}else if("create"===action){var convId=xmpp_service_1.default.getBareJidFromJid(conversationElem.find("peer").text()),convDbId=conversationElem.attr("id"),lastModification=new Date(conversationElem.find("lastMessageDate").text()),lastMessageText=conversationElem.find("lastMessageText").text(),lastMessageSender=conversationElem.find("lastMessageSender").text(),missedIMCounter=parseInt(conversationElem.find("unreadMessageNumber").text(),10)||0,muted="true"===conversationElem.find("mute").text(),type=conversationElem.find("type").text(),conversationGetter="room"===type?"getRoomConversation":"getOrCreateOneToOneConversation";_this130.conversationService[conversationGetter](convId).then((function(conv){logger_service_1.default.info("[ConversationServiceEventHandler] onManagementMessageReceived update conversation ("+conv.id+")"),conv.dbId=convDbId,conv.lastModification=lastModification?new Date(lastModification):void 0,conv.lastMessageText=lastMessageText,conv.lastMessageSender=lastMessageSender,conv.muted=muted,conv.preload=!0,conv.setMissedCounter(missedIMCounter),type===_this130.Conversation.Type.BOT&&(conv.type=_this130.Conversation.Type.ONE_TO_ONE),_this130.conversationService.favoriteService.updateFavoriteConversations(conv),_this130.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conv)}))}}))}if(stanzaElem.find("mute")||stanzaElem.find("unmute")){var muteElem=stanzaElem.find("mute"),mute=!1;muteElem.length&&(mute=!muteElem.text().length||"true"===muteElem.text());var conversationDbId=stanzaElem.find("mute").attr("conversation")||stanzaElem.find("unmute").attr("conversation"),conversation=this.conversationService.getConversationByDbId(conversationDbId);conversation&&(logger_service_1.default.info("[ConversationServiceEventHandler] onManagementMessageReceived : mute is changed to "+mute),conversation.muted=mute)}return!0}catch(error){return logger_service_1.default.error("[ConversationServiceEventHandler] onManagementMessageReceived error "+error),!0}}},{key:"onReceiptMessageReceived",value:function(stanza){var _this131=this;try{var stanzaElement=$(stanza),messageSender=xmpp_service_1.default.getBareJidFromJid(stanzaElement.attr("from")),carbonStanza=stanzaElement.find("message");contact_service_1.default.isUserContactJid(messageSender)&&carbonStanza.length>0&&(stanzaElement=$(carbonStanza));var recvMessage=stanzaElement.find("received");if(recvMessage.length&&recvMessage.length>0){logger_service_1.default.info("[ConversationServiceEventHandler] onReceiptMessageReceived");var messageId=$(recvMessage).attr("id"),entity=$(recvMessage).attr("entity"),_event2=$(recvMessage).attr("event");if("server"===entity&&"received"===_event2){var messageInfo=this.conversationService.pendingMessages[messageId];if(messageInfo&&messageInfo.message){var message=messageInfo.message,conversation=messageInfo.conversation;logger_service_1.default.info("[conversationService] Receive server ack ("+conversation.id+", "+message.id+")"),message.setReceiptStatus(message_1.Message.ReceiptStatus.SENT),conversation.updateMessage(message),delete this.conversationService.pendingMessages[messageId],this.$rootScope.$broadcast("ON_CONVERSATION_RECEIPT_RECEIVED",message,conversation,"server")}}else"client"===entity&&this.extractStanzaData(stanza).then((function(stanzaData){_this131.handleReceiptReceiveMessage(stanzaData.conversation,stanza)}))}else if(stanzaElement.find("mark_as_read").length){logger_service_1.default.info("[ConversationServiceEventHandler] onReceiptMessageReceived -- mark_as_read");var conversationId=stanzaElement.find("mark_as_read").attr("with"),_conversation=this.conversationService.getConversationById(conversationId);if(_conversation)switch(stanzaElement.find("mark_as_read").attr("id")){case"all-received":_conversation.setMissedCounter(0);break;case"all-sent":_conversation.ackReadAllSentMessages();break;default:logger_service_1.default.error("[ConversationServiceEventHandler] onReceiptMessageReceived error - unknown read type")}}else stanzaElement.find("voicemessage").length&&logger_service_1.default.debug("[ConversationServiceEventHandler] onReceiptMessageReceived VoiceMessage detected");return!0}catch(error){return logger_service_1.default.error("[ConversationServiceEventHandler] onReceiptMessageReceived error "+error),!0}}},{key:"extractStanzaData",value:function(stanza){var _this132=this;return new Promise((function(resolve,reject){var stanzaElem=$(stanza),from=stanzaElem.attr("from"),messageSender=xmpp_service_1.default.getBareJidFromJid(from),stanzaData={},results=null,carbonStanza=stanzaElem.find("message");if(carbonStanza.length>0&&contact_service_1.default.isUserContactJid(messageSender)){var forwardedCarbonMsg=$(stanzaElem).find("sent forwarded message forwarded message");if(forwardedCarbonMsg&&forwardedCarbonMsg.length){var origMsgId=$(stanzaElem).find("sent forwarded message").attr("id");stanzaElem=$(forwardedCarbonMsg).find("forwarded message"),stanzaData.isForwarded=!0,results=_this132.handleCarbonMsg(carbonStanza,stanzaData,stanzaElem,origMsgId)}else results=_this132.handleCarbonMsg(carbonStanza,stanzaData,stanzaElem,null)}else{var forwardedMsg=$(stanzaElem).find("forwarded[xmlns='urn:xmpp:forward:0']");if(forwardedMsg&&forwardedMsg.length){var _origMsgId=stanzaElem.attr("id");stanzaElem=$(forwardedMsg).find("forwarded message"),stanzaData.isForwarded=!0,results=_this132.handleStandardMsg(stanzaData,stanzaElem,from,_origMsgId,resolve)}else results=_this132.handleStandardMsg(stanzaData,stanzaElem,from,null,resolve)}results&&_this132.handleCommonData(stanza,stanzaData,stanzaElem,results.conversationId,results.delay,results.resource,resolve,reject)}))}},{key:"handleCommonData",value:function(stanza,stanzaData,stanzaElem,conversationId,delay,resource,resolve,reject){var archived="push"===stanzaElem.find("retransmission").attr("source");if(stanzaData.date=new Date,stanzaData.offline=!1,"Offline Storage"===delay.text()&&(stanzaData.date=new Date(delay.attr("stamp")),stanzaData.offline=!0),archived){var conversation=this.conversationService.getConversationById(conversationId);if(conversation)reject();else{var cs=this.conversationService;(conversationId.startsWith("room_")?cs.getRoomConversation(conversationId):cs.getOrCreateOneToOneConversation(conversationId)).then((function(conv){conversation=conv,reject()}))}}else{var existingConv=this.conversationService.getConversationById(conversationId);if(stanzaData.convReady=existingConv&&null!==existingConv.dbId,stanzaData.body||existingConv||stanzaData.oob||stanzaData.conference)if(0===conversationId.indexOf("room_")){var room=room_service_1.default.getRoomByJid(conversationId),subject=stanzaElem.find("subject"),emptySubject=subject.length&&""===subject.text();room&&"accepted"!==room.status||emptySubject?logger_service_1.default.info("[conversationServiceEvent] extractStanzaData -- ignore this stanza message"):this.conversationService.getRoomConversation(conversationId).then((function(roomConv){return stanzaData.conversation=roomConv,stanzaData.conference&&stanzaData.conference.ownerjid?contact_service_1.default.getOrCreateContact(stanzaData.conference.ownerjid):(resource&&-1!==resource.indexOf("/")&&(resource=resource.split("/")[0]),contact_service_1.default.getOrCreateContact(resource))})).then((function(contact){stanzaData.participant=contact,resolve(stanzaData)})).catch((function(error){logger_service_1.default.error("[conversationServiceEventHandler] impossible to fetch conversation "+error.message),reject()}))}else this.conversationService.getOrCreateOneToOneConversation(conversationId).then((function(conv){stanzaData.conversation=conv,stanzaData.participant||(stanzaData.participant=conv.contact),resolve(stanzaData)})).catch((function(error){logger_service_1.default.error("[conversationServiceEventHandler] impossible to fetch conversation "+error.message),reject()}));else if($(stanza).find("deleted")){var deleted=$(stanza).find("deleted")[0];if(deleted&&"all"===deleted.getAttribute("id")){var conv=this.conversationService.getConversationById(deleted.getAttribute("with"));conv&&(logger_service_1.default.info("[conversationServiceEventHandler] Remove all messages for conversation "+conv.id),conv.reset())}resolve()}else logger_service_1.default.debug("[conversationServiceEventHandler] ignored message stanza"),reject()}}},{key:"handleStandardMsg",value:function(stanzaData,stanzaElem,from,msgId,resolve){logger_service_1.default.debug("[conversationServiceEventHandler] > handleStandardMsg "+msgId),stanzaData.outgoingMessage=!1,stanzaData.body=stanzaElem.find("body").text(),stanzaData.messageId=msgId||stanzaElem.attr("id"),stanzaData.carbon=!1,stanzaData.answeredMsg=stanzaElem.find("answeredMsg"),stanzaData.alternativeContent=stanzaElem.find("content"),stanzaData.attention=stanzaElem.find("attention");var conversationId=xmpp_service_1.default.getBareJidFromJid(from),resource=xmpp_service_1.default.getResourceFromJid(from),delay=stanzaElem.find("delay");stanzaData.urgency="std";var headersElem=stanzaElem.find("headers[xmlns='http://jabber.org/protocol/shim']");if(headersElem&&headersElem.length){var urgencyElem=$(headersElem).find("header[name='Urgency']");urgencyElem&&urgencyElem.length&&(stanzaData.urgency=urgencyElem.text()),"undefined"===stanzaData.urgency&&(stanzaData.urgency="std")}var oob=stanzaElem.find("x[xmlns='jabber:x:oob']");if(oob&&oob.length){var oobElem=$(oob),url=oobElem.find("url").text(),mime=oobElem.find("mime").text(),filename=oobElem.find("filename").text(),filesize=oobElem.find("size").text();stanzaData.oob={url:url,mime:mime,filename:filename,filesize:filesize}}var geoloc=stanzaElem.find("geoloc");if(geoloc&&geoloc.length){var geolocElem=$(geoloc),lon=geolocElem.find("lon").text(),lat=geolocElem.find("lat").text();stanzaData.geoloc={lon:lon,lat:lat}}var voiceMessage=stanzaElem.find("voicemessage");voiceMessage&&voiceMessage.length&&(stanzaData.voiceMessage=!0);var conference=stanzaElem.find("x[xmlns='jabber:x:audioconference']");if(conference&&conference.length){var conferenceElem=$(conference),message=conferenceElem.attr("message"),confendpointid=conferenceElem.attr("confendpointid"),jid=conference.attr("jid"),type=conference.attr("type");if(stanzaData.conference={type:type,message:message,confendpointid:confendpointid,roomjid:jid,ownerjid:conversationId},"reminder"!==type)return logger_service_1.default.debug("[conversationServiceEventHandler] ignored message stanza for conference"),resolve(stanzaData),null;conversationId=jid}var replace=stanzaElem.find("replace");replace&&replace.length&&(stanzaData.replace={id:replace.attr("id")});var mentionElem=stanzaElem.find("mention[xmlns='urn:xmpp:attention:0']");mentionElem.length&&(stanzaData.mentions=[],mentionElem.find("jid").each((function(_ind,content){var mention={};mention.jid=$(content).text(),mention.pos=parseInt($(content).attr("pos"),10),mention.size=parseInt($(content).attr("size"),10),mention.jid&&mention.size&&stanzaData.mentions.push(mention)}))),stanzaData.additionalContent=null;var contents=stanzaElem.find("content[xmlns='urn:xmpp:content']");contents&&contents.each((function(){stanzaData.additionalContent||(stanzaData.additionalContent={});var contentType=$(this).attr("type"),content=$(this).text();"text/markdown"===contentType&&(stanzaData.markdown=!0,stanzaData.body=content),stanzaData.additionalContent[contentType]={type:contentType,message:content}}));var subject=stanzaElem.find("subject");subject&&""!==subject.text()&&(stanzaData.subject=subject.text()),stanzaData.status=null;var composing=stanzaElem.find("composing"),paused=stanzaElem.find("paused"),active=stanzaElem.find("active"),inactive=stanzaElem.find("inactive");return composing.length?stanzaData.status="composing":paused.length?stanzaData.status="paused":active.length?stanzaData.status="active":inactive.length&&(stanzaData.status="inactive"),{conversationId:conversationId,resource:resource,delay:delay}}},{key:"handleCarbonMsg",value:function(carbonStanza,stanzaData,stanzaElem,origMsgId){var carbonStanzaElem=$(carbonStanza),from=xmpp_service_1.default.getBareJidFromJid(carbonStanzaElem.attr("from")),fromResource=xmpp_service_1.default.getResourceFromJid(carbonStanzaElem.attr("from")),to=xmpp_service_1.default.getBareJidFromJid(carbonStanzaElem.attr("to")),toResource=xmpp_service_1.default.getResourceFromJid(carbonStanzaElem.attr("to"));stanzaData.outgoingMessage=contact_service_1.default.isUserContactJid(from),stanzaData.body=carbonStanzaElem.find("body").text(),stanzaData.participant=stanzaData.outgoingMessage?contact_service_1.default.userContact:null,stanzaData.messageId=origMsgId||carbonStanzaElem.attr("id"),stanzaData.carbon=!0,stanzaData.answeredMsg=carbonStanzaElem.find("answeredMsg"),stanzaData.alternativeContent=carbonStanzaElem.find("content");var conversationId=stanzaData.outgoingMessage?to:from,resource=stanzaData.outgoingMessage?toResource:fromResource,delay=carbonStanzaElem.find("delay");stanzaData.urgency="std";var headersElem=carbonStanzaElem.find("headers[xmlns='http://jabber.org/protocol/shim']");if(headersElem&&headersElem.length){var urgencyElem=$(headersElem).find("header[name='Urgency']");urgencyElem&&urgencyElem.length&&(stanzaData.urgency=urgencyElem.text())}var oob=carbonStanzaElem.find("x[xmlns='jabber:x:oob']");if(oob&&oob.length){var oobElem=$(oob),url=oobElem.find("url").text(),mime=oobElem.find("mime").text(),filename=oobElem.find("filename").text(),filesize=oobElem.find("size").text();stanzaData.oob={url:url,mime:mime,filename:filename,filesize:filesize}}var conference=stanzaElem.find("x[xmlns='jabber:x:audioconference']");if(conference&&conference.length){var conferenceElem=$(conference),subject=conferenceElem.attr("subject"),confendpointid=conferenceElem.attr("confendpointid"),jid=conference.attr("jid"),type=conference.attr("type");stanzaData.conference={type:type,subject:subject,confendpointid:confendpointid,roomjid:jid,ownerjid:conversationId}}var replace=carbonStanza.find("replace");replace&&replace.length&&(stanzaData.replace={id:replace.attr("id")});var mentionElem=carbonStanza.find("mention[xmlns='urn:xmpp:attention:0']");mentionElem.length&&(stanzaData.mentions=[],mentionElem.find("jid").each((function(_ind,content){var mention={};mention.jid=$(content).text(),mention.pos=parseInt($(content).attr("pos"),10),mention.size=parseInt($(content).attr("size"),10),mention.jid&&mention.size&&stanzaData.mentions.push(mention)}))),stanzaData.status=null;var composing=stanzaElem.find("composing"),paused=stanzaElem.find("paused"),active=stanzaElem.find("active"),inactive=stanzaElem.find("inactive");composing.length?stanzaData.status="composing":paused.length?stanzaData.status="paused":active.length?stanzaData.status="active":inactive.length&&(stanzaData.status="inactive");var geoloc=carbonStanzaElem.find("geoloc");if(geoloc&&geoloc.length){var geolocElem=$(geoloc),lon=geolocElem.find("lon").text(),lat=geolocElem.find("lat").text();stanzaData.geoloc={lon:lon,lat:lat}}var voiceMessage=carbonStanzaElem.find("voicemessage");return voiceMessage&&voiceMessage.length&&(stanzaData.voiceMessage=!0),{conversationId:conversationId,resource:resource,delay:delay}}},{key:"extractWebrtcStanzaData",value:function(stanza){var _this133=this;return new Promise((function(resolve,reject){logger_service_1.default.debug("[conversationServiceEventHandler] extractWebrtcStanzaData");var stanzaData={};stanzaData.messageId=$(stanza).attr("id"),stanzaData.callerJid=$(stanza).find("caller").text(),stanzaData.calleeJid=$(stanza).find("callee").text(),stanzaData.state=$(stanza).find("state").text();var conversationId=null;if(contact_service_1.default.isUserContactJid(stanzaData.callerJid)?(conversationId=stanzaData.calleeJid,stanzaData.participant=contact_service_1.default.userContact):conversationId=stanzaData.callerJid,-1!==conversationId.indexOf("janusgateway"))return logger_service_1.default.debug("[conversationServiceEventHandler] extractWebrtcStanzaData -- ignore Janus message"),void reject();if(_this133.webrtcGatewayService.isMediaPillarJid(stanzaData.callerJid))return logger_service_1.default.debug("[conversationServiceEventHandler] extractWebrtcStanzaData -- ignore MediaPillar message"),void resolve();var duration=0;$(stanza).find("duration")&&(duration=parseInt($(stanza).find("duration").text(),10)),stanzaData.duration=duration>0?"("+moment.duration(duration,"ms").format("h[H] mm[m] ss[s]")+")":0;var date=$(stanza).find("date").text();date&&(stanzaData.date=new Date(date)),stanzaData.body="","missed"===stanzaData.state?stanzaData.body="missedCall||"+stanzaData.date:"answered"===stanzaData.state&&(stanzaData.body="activeCallMsg||"+stanzaData.date+"||"+stanzaData.duration),_this133.conversationService.getOrCreateOneToOneConversation(conversationId).then((function(conversation){stanzaData.conversation=conversation,stanzaData.participant||(stanzaData.participant=conversation.contact),resolve(stanzaData)})).catch((function(error){logger_service_1.default.error("[conversationServiceEventHandler] impossible to fetch conversation "+error.message),reject()}))}))}},{key:"handleChatMessage",value:function(stanzaData){var _this134=this;logger_service_1.default.info("[ConversationServiceEventHandler] handleChatMessage");var body=stanzaData.body,message=null,conversation=stanzaData.conversation;if(conversation&&conversation.room&&(conversation.room.lastActivityDate=new Date),stanzaData.oob){var url=stanzaData.oob.url,fileName=stanzaData.oob.filename,fileId=fileStorage_service_1.default.extractFileIdFromUrl(url),attention=stanzaData.attention&&stanzaData.attention.length;fileStorage_service_1.default.retrieveAndStoreOneFileDescriptor(fileId).then((function(fileDescriptor){message=conversation.addFileSharingMessage(stanzaData.participant,stanzaData.date,stanzaData.body,stanzaData.messageId,fileId,fileName,stanzaData.geoloc,stanzaData.urgency,stanzaData.isForwarded,attention),_this134.acknowledgeHandledChatMessage(stanzaData,conversation,message),_this134.fileServerService.getBlobThumbnailFromFileDescriptor(fileDescriptor).then((function(blob){var newFileDescriptor=fileStorage_service_1.default.getFileDescriptorById(fileDescriptor.id);newFileDescriptor.previewBlob=blob,newFileDescriptor.previewBlobSubject.next(newFileDescriptor.previewBlob),_this134.$rootScope.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:newFileDescriptor.id})})),_this134.$rootScope.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:fileDescriptor.id})})).catch((function(error){logger_service_1.default.info("[ConversationServiceEventHandler] handleChatMessage error "+error)}))}else if(stanzaData.conference){var conferenceDescriptor={type:stanzaData.conference.type,message:stanzaData.conference.subject,confendpointid:stanzaData.conference.confendpointid,roomjid:stanzaData.conference.roomjid};if(conversation=this.conversationService.getConversationById(conferenceDescriptor.roomjid),this.$rootScope.$broadcast("ROOM_UPDATE_CONFID"),!conversation)return;message=conversation.addConferenceMessage(stanzaData.participant,stanzaData.date,stanzaData.messageId,conferenceDescriptor)}else if(stanzaData.replace)(message=conversation.getMessageById(stanzaData.replace.id))&&stanzaData.participant.jid!==message.from.jid?(logger_service_1.default.warn("[ConversationServiceEventHandler] handleChatMessage : message Replaced by somebody else - Skip"),message=null):(message||(message=conversation.addChatMessage(stanzaData.participant,stanzaData.date,"",stanzaData.replace.id,null,stanzaData.markdown,stanzaData.subject,null,null,stanzaData.additionalContent)),message.addReplaceMsg(stanzaData.messageId,body),message.mentions=stanzaData.mentions,conversation.updateAfterReplaceEvent(message));else if(body.length>0){var answeredMsgId=stanzaData.answeredMsg?stanzaData.answeredMsg.text():null,answeredMsgDate=stanzaData.answeredMsg?stanzaData.answeredMsg.attr("stamp"):null,alternativeContent=stanzaData.alternativeContent.length>0?{type:stanzaData.alternativeContent.attr("type"),message:stanzaData.alternativeContent.text()}:null;if(message=conversation.addChatMessage(stanzaData.participant,stanzaData.date,stanzaData.body,stanzaData.messageId,null,stanzaData.markdown,stanzaData.subject,answeredMsgId,answeredMsgDate,stanzaData.additionalContent,alternativeContent,stanzaData.mentions,stanzaData.urgency),answeredMsgId){var answeredMessage=conversation.getMessageById(answeredMsgId);answeredMessage?(answeredMessage.urgencyAck=!0,answeredMessage.urgencyHandler&&answeredMessage.urgencyHandler()):logger_service_1.default.error("[ConversationServiceEventHandler] Not possible to handle answeredMsg because replied msg not found")}}message&&(message.isForwarded=!!stanzaData.isForwarded&&stanzaData.isForwarded,this.acknowledgeHandledChatMessage(stanzaData,conversation,message))}},{key:"acknowledgeHandledChatMessage",value:function(stanzaData,conversation,message){if(logger_service_1.default.info("[ConversationServiceEventHandler] acknowledgeHandledChatMessage"),!message)return message=conversation.getMessageById(stanzaData.messageId),void(conversation.room&&message&&message.side===message_1.Message.Side.RIGHT&&this.conversationService.sendAckReceivedMessage(conversation,message));message.side===message_1.Message.Side.LEFT?(conversation===this.conversationService.activeConversation&&"away"!==contact_service_1.default.userContact.status&&this.$rootScope.appVisible&&!conversation.isFullScreenNoChat?this.conversationService.sendAckReadMessage(conversation,message):(this.conversationService.sendAckReceivedMessage(conversation,message),!stanzaData.offline&&stanzaData.convReady&&conversation.setMissedCounter(conversation.missedCounter+1)),message.isTextModified()&&(message.receiptStatus===message_1.Message.ReceiptStatus.READ&&this.conversationService.sendAckReadOrReceivedMessage(conversation,stanzaData.messageId,"read"),conversation.updateMessage(message))):(stanzaData.carbon?message.setReceiptStatus(message_1.Message.ReceiptStatus.SENT):message.setReceiptStatus(message_1.Message.ReceiptStatus.IN_PROGRESS),conversation.updateMessage(message)),conversation.setStatusMessage(stanzaData.participant,this.Conversation.Status.ACTIVE),this.$rootScope.$broadcast("ON_CONVERSATION_MESSAGE_RECEIVED",message,conversation,stanzaData.carbon),this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation)}},{key:"handleReceiptReceiveMessage",value:function(conversation,stanza){logger_service_1.default.info("[ConversationServiceEventHandler] handleReceiptReceiveMessage");var recvMessage=$(stanza).find("received[xmlns='urn:xmpp:receipts']");if(recvMessage.length){var messageId=$(recvMessage).attr("id"),message=conversation.getMessageById(messageId);if(message){var contactJid=$(stanza).attr("from").split("/")[1];contactJid||(contactJid=$(stanza).attr("from"));var _event3=$(recvMessage).attr("event");(conversation.room&&contact_service_1.default.isUserContactJid(contactJid)||!conversation.room)&&("received"===_event3?message.setReceiptStatus(message_1.Message.ReceiptStatus.UNREAD):"read"===_event3&&(message.setReceiptStatus(message_1.Message.ReceiptStatus.READ),conversation.setMissedCounter(0))),contact_service_1.default.isUserContactJid(contactJid)&&"read"===_event3&&"L"===message.side&&conversation.setMissedCounter(0),conversation.updateMessage(message),this.$rootScope.$broadcast("ON_CONVERSATION_RECEIPT_RECEIVED",message,conversation,_event3),this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation)}else{var temp=$(stanza).attr("from"),_event4=$(recvMessage).attr("event"),_contactJid="";temp&&(_contactJid=temp.split("/")[1]),_contactJid||(_contactJid=temp),contact_service_1.default.isUserContactJid(_contactJid)&&"read"===_event4&&(conversation.setMissedCounter(0),this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation))}}}},{key:"handleStatusMessage",value:function(conversation,participant,stanza){logger_service_1.default.info("[conversationServiceEventHandler] handleStatusMessage ");var status;status="thread"===$(stanza).children().prop("tagName")?this.Conversation.stringToStatus($($(stanza).children()[1]).prop("tagName")):this.Conversation.stringToStatus($(stanza).children().prop("tagName")),conversation.setStatusMessage(participant,status),this.$rootScope.$broadcast("ON_CONVERSATIONS_STATUS_MESSAGE_EVENT",conversation,participant,status)}},{key:"onRecordingMessageReceived",value:function(stanza){var _this135=this;logger_service_1.default.info("[ConversationServiceEventHandler] onRecordingMessageReceived");try{var msgContent=stanza.textContent;return this.extractStanzaData(stanza).then((function(stanzaData){if("start"===msgContent){var conversation=stanzaData.conversation;conversation.addRecordingMessage(stanzaData.participant,stanzaData.date,msgContent,stanzaData.messageId),conversation.setStatusMessage(stanzaData.participant,_this135.Conversation.Status.ACTIVE),conversation.videoCall&&(conversation.videoCall.isRecorded=!0),_this135.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation),_this135.$rootScope.$broadcast("ON_RECORDING_START_MSG_RECEIVED")}else if("stop"===msgContent){var _conversation2=stanzaData.conversation;_conversation2&&(_conversation2.addRecordingMessage(stanzaData.participant,stanzaData.date,msgContent,stanzaData.messageId),_conversation2.videoCall&&(_conversation2.videoCall.isRecorded=!1)),_this135.$rootScope.$broadcast("ON_RECORDING_STOP_MSG_RECEIVED")}else"remoteStopVideo"===msgContent?_this135.$rootScope.$broadcast("ON_RECORDING_REMOTESTOPVIDEO_MSG_RECEIVED"):"remoteChangeMediaVideo"===msgContent?_this135.$rootScope.$broadcast("ON_RECORDING_REMOTECHANGEMEDIAVIDEO_MSG_RECEIVED"):"remoteStopSharing"===msgContent?_this135.$rootScope.$broadcast("ON_RECORDING_REMOTESTOPSHARING_MSG_RECEIVED"):"remoteChangeMediaSharing"===msgContent&&_this135.$rootScope.$broadcast("ON_RECORDING_REMOTECHANGEMEDIASHARING_MSG_RECEIVED")})),!0}catch(error){return logger_service_1.default.error("[ConversationServiceEventHandler] onRecordingMessageReceived error "+error),!0}}}],[{key:"create",value:function($rootScope,Conversation,fileServerService,webrtcGatewayService,conversationService){return new ConversationServiceEventHandler($rootScope,Conversation,fileServerService,webrtcGatewayService,conversationService)}}]),ConversationServiceEventHandler}();exports.ConversationServiceEventHandler=ConversationServiceEventHandler},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24),Room=function(){function Room(dbId,jid,name,desc,creationDate){var conferenceEndpoints=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],history=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Room.History.NONE,customdata=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},conference=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,avatar=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,isActive=arguments.length>10&&void 0!==arguments[10]&&arguments[10],lastActivityDate=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,autoRegister=arguments.length>12&&void 0!==arguments[12]?arguments[12]:"unlock",autoAcceptInvitation=arguments.length>13&&void 0!==arguments[13]&&arguments[13],tags=arguments.length>14&&void 0!==arguments[14]?arguments[14]:[],containerId=arguments.length>15&&void 0!==arguments[15]?arguments[15]:"",containerName=arguments.length>16&&void 0!==arguments[16]?arguments[16]:"";_classCallCheck(this,Room),this.nameForLogs="",this.users=[],this.ownerContact=null,this.organizers=[],this.members=[],this.avatarContacts=[],this.owner=!1,this.isModerator=!1,this.status="none",this.rxSubject=new rxjs_1.Subject,this.initPresPromise=null,this.initPresPromiseResolve=null,this.initPresInterval=null,this.initPresenceAck=!1,this.autoAcceptInvitation=!1,this.tags=[],this.foundByTag=!1,this.filterName=null,this.containerId="",this.containerName="",this.webinarId=null,this.dbId=dbId,this.jid=jid,this.name=name,this.desc=desc,this.creationDate=creationDate,this.type=Room.Type.PRIVATE,this.history=history,this.customData=customdata,this.confEndpoints=conferenceEndpoints,this.conference=conference,this.avatar=avatar,this.isActive=isActive,this.lastActivityDate=lastActivityDate,this.autoRegister=autoRegister,this.autoAcceptInvitation=autoAcceptInvitation,this.tags=tags,this.containerId=containerId||"",this.autoAcceptInvitation=autoAcceptInvitation,this.tags=tags,this.containerId=containerId||"",this.containerName=containerName||""}return _createClass(Room,[{key:"toString",value:function(){return"Room "+this.dbId+" "+this.name+" "+this.jid}},{key:"getCreationDate",value:function(){return this.creationDate?new Date(this.creationDate):new Date}},{key:"getLastActivityDate",value:function(){return this.lastActivityDate?new Date(this.lastActivityDate):this.getCreationDate()}},{key:"subscribe",value:function(handler){return this.rxSubject.subscribe(handler)}},{key:"updateAvatarInfo",value:function(){if(!this.avatar){var avatarContacts=[],orderedContacts=this.users.slice();orderedContacts.sort((function(aa,bb){return new Date(aa.date)>new Date(bb.date)?1:new Date(aa.date)<new Date(bb.date)?-1:0}));for(var _index2=0;_index2<orderedContacts.length;_index2++){var contact=orderedContacts[_index2].contact,_status3=orderedContacts[_index2].status;if(!(this.ownerContact&&contact.dbId===this.ownerContact.dbId||contact.isAnonymousGuest()||contact.isBadGuest()||contact.isTerminated)&&(!this.owner&&!this.isModerator||"accepted"!==_status3&&"invited"!==_status3?"accepted"===_status3&&avatarContacts.push(contact):avatarContacts.push(contact),5===avatarContacts.length))break}this.avatarContacts=avatarContacts,this.rxSubject&&this.rxSubject.next(event_model_1.RBEvent.create("updateAvatarInfo",this.avatarContacts))}}},{key:"isUserOwner",value:function(contact){return!!contact&&this.ownerContact&&this.ownerContact.jid===contact.jid}},{key:"isUserModerator",value:function(contact){return void 0!==this.getOrganizerFromContactJid(contact.jid)}},{key:"isUserStatusAccepted",value:function(contact){var user=this.getUserByJid(contact.jid);return void 0!==user&&"accepted"===user.status}},{key:"isUserStatusAcceptedOrInvited",value:function(contact){var user=this.getUserByJid(contact.jid);return void 0!==user&&("accepted"===user.status||"invited"===user.status)}},{key:"isUserStillBelongToRoom",value:function(userJid){var ownUser=this.getUserByJid(userJid);return!ownUser||"unsubscribed"!==ownUser.status&&"deleted"!==ownUser.status}},{key:"getOrganizerFromContactJid",value:function(contactJid){var user;return this.organizers.forEach((function(organizer){organizer.contact.jid===contactJid&&(user=organizer)})),user}},{key:"getUserByJid",value:function(userJid){for(var i=0;i<this.users.length;i++)if(userJid===this.users[i].contact.jid)return this.users[i];return null}},{key:"getPstnConfEndpointId",value:function(){if(this.confEndpoints&&this.confEndpoints.length)for(var i=0;i<this.confEndpoints.length;i++)if("pstnAudio"===this.confEndpoints[i].mediaType)return this.confEndpoints[i].confEndpointId;return null}},{key:"getSFUConfEndpointId",value:function(){if(this.confEndpoints&&this.confEndpoints.length)for(var i=0;i<this.confEndpoints.length;i++)if("webrtc"===this.confEndpoints[i].mediaType)return this.confEndpoints[i].confEndpointId;return null}},{key:"getSFUSharingConfEndpointId",value:function(){if(this.confEndpoints&&this.confEndpoints.length)for(var i=0;i<this.confEndpoints.length;i++)if("webrtcSharingOnly"===this.confEndpoints[i].mediaType)return this.confEndpoints[i].confEndpointId;return null}},{key:"isMyPersonalMeetingRoom",value:function(){return this.conference&&"pstnAudio"===this.conference.mediaType&&!this.conference.scheduled&&this.conference.personalMeeting&&this.owner}},{key:"isMeetingRoom",value:function(){return this.conference&&"pstnAudio"===this.conference.mediaType}},{key:"isWebinarRoom",value:function(){return this.conference&&this.conference.webinarId}},{key:"isWebConferenceRoom",value:function(){return this.conference&&"pstnAudio"!==this.conference.mediaType&&null!==this.getSFUConfEndpointId()}},{key:"isMeetingOrWebConferenceRoom",value:function(){return this.isMeetingRoom()||null!==this.getSFUConfEndpointId()}},{key:"getNameForLogs",value:function(){if(!this.nameForLogs&&this.name){var temp=this.name.replace(/[^\s](?=.{1,}$)/g,"*");this.nameForLogs=this.name.charAt(0)+temp.substr(1)}return this.nameForLogs}},{key:"getAutoRegister",value:function(){return this.autoRegister?this.autoRegister:"unlock"}},{key:"setAutoRegister",value:function(value){this.autoRegister=value}},{key:"getAutoAcceptInvitation",value:function(){return this.autoAcceptInvitation}},{key:"setAutoAcceptInvitation",value:function(value){this.autoAcceptInvitation=value}},{key:"getMuteUponEntry",value:function(){return this.conference?this.conference.muteUponEntry:"false"}},{key:"setMuteUponEntry",value:function(value){this.conference&&(this.conference.muteUponEntry=value)}},{key:"getDisableTimeStats",value:function(){return this.conference?this.conference.disableTimeStats:"false"}},{key:"setDisableTimeStats",value:function(value){this.conference&&(this.conference.disableTimeStats=value)}},{key:"getAllAcceptedMembers",value:function(){return this.members.filter((function(user){return!user.contact.isBadGuest()&&!user.contact.isAnonymousGuest()&&!user.contact.isTerminated&&"accepted"===user.status}))}},{key:"getAllAcceptedUsers",value:function(){return this.users.filter((function(user){return!user.contact.isBadGuest()&&!user.contact.isAnonymousGuest()&&!user.contact.isTerminated&&"accepted"===user.status}))}},{key:"getTagColor",value:function(tagName){var tagIndex=this.tags.findIndex((function(tag){return tag.tag===tagName}));return tagIndex>-1?this.tags[tagIndex].color:"#ff9900"}}],[{key:"create",value:function(dbId,jid,name,topic,date,conferenceEndpoints,history,customdata,conference,avatar,isActive){var lastActivityDate=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,autoRegister=arguments.length>12&&void 0!==arguments[12]?arguments[12]:"unlock",autoAcceptInvitation=arguments.length>13&&void 0!==arguments[13]&&arguments[13],tags=arguments.length>14&&void 0!==arguments[14]?arguments[14]:[],containerId=arguments.length>15&&void 0!==arguments[15]?arguments[15]:"",containerName=arguments.length>16&&void 0!==arguments[16]?arguments[16]:"",room=new Room(dbId,jid,name,topic,date,conferenceEndpoints,history,customdata,conference,avatar,isActive,lastActivityDate,autoRegister,autoAcceptInvitation,tags,containerId,containerName);return room.lastActivityDate=lastActivityDate,room}}]),Room}();Room.Type={PRIVATE:0,PUBLIC:1},Room.Privilege={USER:"user",MODERATOR:"moderator",GUEST:"guest"},Room.History={ALL:"all",NONE:"none"},exports.Room=Room},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,factory;factory=function(moment){var toLocaleStringWorks=!1,toLocaleStringRoundingWorks=!1,intlNumberFormatWorks=!1,intlNumberFormatRoundingWorks=!1,types="escape years months weeks days hours minutes seconds milliseconds general".split(" "),bubbles=[{type:"seconds",targets:[{type:"minutes",value:60},{type:"hours",value:3600},{type:"days",value:86400},{type:"weeks",value:604800},{type:"months",value:2678400},{type:"years",value:31536e3}]},{type:"minutes",targets:[{type:"hours",value:60},{type:"days",value:1440},{type:"weeks",value:10080},{type:"months",value:44640},{type:"years",value:525600}]},{type:"hours",targets:[{type:"days",value:24},{type:"weeks",value:168},{type:"months",value:744},{type:"years",value:8760}]},{type:"days",targets:[{type:"weeks",value:7},{type:"months",value:31},{type:"years",value:365}]},{type:"months",targets:[{type:"years",value:12}]}];function stringIncludes(str,search){return!(search.length>str.length)&&-1!==str.indexOf(search)}function repeatZero(qty){for(var result="";qty;)result+="0",qty-=1;return result}function cachedNumberFormat(locale,options){var cacheKey=locale+"+"+map(keys(options).sort(),(function(key){return key+":"+options[key]})).join(",");return cachedNumberFormat.cache[cacheKey]||(cachedNumberFormat.cache[cacheKey]=Intl.NumberFormat(locale,options)),cachedNumberFormat.cache[cacheKey]}function formatNumber(number,options,userLocale){var integerString,fractionString,exponentString,useToLocaleString=options.useToLocaleString,useGrouping=options.useGrouping,grouping=useGrouping&&options.grouping.slice(),maximumSignificantDigits=options.maximumSignificantDigits,minimumIntegerDigits=options.minimumIntegerDigits||1,fractionDigits=options.fractionDigits||0,groupingSeparator=options.groupingSeparator,decimalSeparator=options.decimalSeparator;if(useToLocaleString&&userLocale){var roundingOptions,localeStringOptions={minimumIntegerDigits:minimumIntegerDigits,useGrouping:useGrouping};return fractionDigits&&(localeStringOptions.maximumFractionDigits=fractionDigits,localeStringOptions.minimumFractionDigits=fractionDigits),maximumSignificantDigits&&number>0&&(localeStringOptions.maximumSignificantDigits=maximumSignificantDigits),intlNumberFormatWorks?(intlNumberFormatRoundingWorks||((roundingOptions=extend({},options)).useGrouping=!1,roundingOptions.decimalSeparator=".",number=parseFloat(formatNumber(number,roundingOptions),10)),cachedNumberFormat(userLocale,localeStringOptions).format(number)):(toLocaleStringRoundingWorks||((roundingOptions=extend({},options)).useGrouping=!1,roundingOptions.decimalSeparator=".",number=parseFloat(formatNumber(number,roundingOptions),10)),number.toLocaleString(userLocale,localeStringOptions))}var temp=(maximumSignificantDigits?number.toPrecision(maximumSignificantDigits+1):number.toFixed(fractionDigits+1)).split("e");exponentString=temp[1]||"",fractionString=(temp=temp[0].split("."))[1]||"";var integerLength=(integerString=temp[0]||"").length,fractionLength=fractionString.length,digitCount=integerLength+fractionLength,digits=integerString+fractionString;(maximumSignificantDigits&&digitCount===maximumSignificantDigits+1||!maximumSignificantDigits&&fractionLength===fractionDigits+1)&&((digits=function(digits){for(var digitsArray=digits.split("").reverse(),i=0,carry=!0;carry&&i<digitsArray.length;)i?"9"===digitsArray[i]?digitsArray[i]="0":(digitsArray[i]=(parseInt(digitsArray[i],10)+1).toString(),carry=!1):(parseInt(digitsArray[i],10)<5&&(carry=!1),digitsArray[i]="0"),i+=1;return carry&&digitsArray.push("1"),digitsArray.reverse().join("")}(digits)).length===digitCount+1&&(integerLength+=1),fractionLength&&(digits=digits.slice(0,-1)),integerString=digits.slice(0,integerLength),fractionString=digits.slice(integerLength)),maximumSignificantDigits&&(fractionString=fractionString.replace(/0*$/,""));var exponent=parseInt(exponentString,10);exponent>0?fractionString.length<=exponent?(integerString+=fractionString+=repeatZero(exponent-fractionString.length),fractionString=""):(integerString+=fractionString.slice(0,exponent),fractionString=fractionString.slice(exponent)):exponent<0&&(fractionString=repeatZero(Math.abs(exponent)-integerString.length)+integerString+fractionString,integerString="0"),maximumSignificantDigits||((fractionString=fractionString.slice(0,fractionDigits)).length<fractionDigits&&(fractionString+=repeatZero(fractionDigits-fractionString.length)),integerString.length<minimumIntegerDigits&&(integerString=repeatZero(minimumIntegerDigits-integerString.length)+integerString));var group,formattedString="";if(useGrouping)for(temp=integerString;temp.length;)grouping.length&&(group=grouping.shift()),formattedString&&(formattedString=groupingSeparator+formattedString),formattedString=temp.slice(-group)+formattedString,temp=temp.slice(0,-group);else formattedString=integerString;return fractionString&&(formattedString=formattedString+decimalSeparator+fractionString),formattedString}function durationLabelCompare(a,b){return a.label.length>b.label.length?-1:a.label.length<b.label.length?1:0}function durationGetLabels(token,localeData){var labels=[];return each(keys(localeData),(function(localeDataKey){if("_durationLabels"===localeDataKey.slice(0,15)){var labelType=localeDataKey.slice(15).toLowerCase();each(keys(localeData[localeDataKey]),(function(labelKey){labelKey.slice(0,1)===token&&labels.push({type:labelType,key:labelKey,label:localeData[localeDataKey][labelKey]})}))}})),labels}cachedNumberFormat.cache={};var engLocale={durationLabelsStandard:{S:"millisecond",SS:"milliseconds",s:"second",ss:"seconds",m:"minute",mm:"minutes",h:"hour",hh:"hours",d:"day",dd:"days",w:"week",ww:"weeks",M:"month",MM:"months",y:"year",yy:"years"},durationLabelsShort:{S:"msec",SS:"msecs",s:"sec",ss:"secs",m:"min",mm:"mins",h:"hr",hh:"hrs",d:"dy",dd:"dys",w:"wk",ww:"wks",M:"mo",MM:"mos",y:"yr",yy:"yrs"},durationTimeTemplates:{HMS:"h:mm:ss",HM:"h:mm",MS:"m:ss"},durationLabelTypes:[{type:"standard",string:"__"},{type:"short",string:"_"}],durationPluralKey:function(token,integerValue,decimalValue){return 1===integerValue&&null===decimalValue?token:token+token}};function isArray(array){return"[object Array]"===Object.prototype.toString.call(array)}function isObject(obj){return"[object Object]"===Object.prototype.toString.call(obj)}function find(array,callback){var match,index=0,max=array&&array.length||0;for("function"!=typeof callback&&(match=callback,callback=function(item){return item===match});index<max;){if(callback(array[index]))return array[index];index+=1}}function each(array,callback){var index=0,max=array.length;if(array&&max)for(;index<max;){if(!1===callback(array[index],index))return;index+=1}}function map(array,callback){var index=0,max=array.length,ret=[];if(!array||!max)return ret;for(;index<max;)ret[index]=callback(array[index],index),index+=1;return ret}function pluck(array,prop){return map(array,(function(item){return item[prop]}))}function compact(array){var ret=[];return each(array,(function(item){item&&ret.push(item)})),ret}function unique(array){var ret=[];return each(array,(function(_a){find(ret,_a)||ret.push(_a)})),ret}function intersection(a,b){var ret=[];return each(a,(function(_a){each(b,(function(_b){_a===_b&&ret.push(_a)}))})),unique(ret)}function rest(array,callback){var ret=[];return each(array,(function(item,index){if(!callback(item))return ret=array.slice(index),!1})),ret}function initial(array,callback){return rest(array.slice().reverse(),callback).reverse()}function extend(a,b){for(var key in b)b.hasOwnProperty(key)&&(a[key]=b[key]);return a}function keys(a){var ret=[];for(var key in a)a.hasOwnProperty(key)&&ret.push(key);return ret}function any(array,callback){var index=0,max=array.length;if(!array||!max)return!1;for(;index<max;){if(!0===callback(array[index],index))return!0;index+=1}return!1}function flatten(array){var ret=[];return each(array,(function(child){ret=ret.concat(child)})),ret}function featureTestFormatterRounding(formatter){return"3.6"===formatter(3.55,"en",{useGrouping:!1,minimumIntegerDigits:1,minimumFractionDigits:1,maximumFractionDigits:1})}function featureTestFormatter(formatter){var passed=!0;return!!((passed=(passed=(passed=passed&&"1"===formatter(1,"en",{minimumIntegerDigits:1}))&&"01"===formatter(1,"en",{minimumIntegerDigits:2}))&&"001"===formatter(1,"en",{minimumIntegerDigits:3}))&&(passed=(passed=(passed=(passed=passed&&"100"===formatter(99.99,"en",{maximumFractionDigits:0,minimumFractionDigits:0}))&&"100.0"===formatter(99.99,"en",{maximumFractionDigits:1,minimumFractionDigits:1}))&&"99.99"===formatter(99.99,"en",{maximumFractionDigits:2,minimumFractionDigits:2}))&&"99.990"===formatter(99.99,"en",{maximumFractionDigits:3,minimumFractionDigits:3}))&&(passed=(passed=(passed=(passed=(passed=passed&&"100"===formatter(99.99,"en",{maximumSignificantDigits:1}))&&"100"===formatter(99.99,"en",{maximumSignificantDigits:2}))&&"100"===formatter(99.99,"en",{maximumSignificantDigits:3}))&&"99.99"===formatter(99.99,"en",{maximumSignificantDigits:4}))&&"99.99"===formatter(99.99,"en",{maximumSignificantDigits:5}))&&(passed=(passed=passed&&"1,000"===formatter(1e3,"en",{useGrouping:!0}))&&"1000"===formatter(1e3,"en",{useGrouping:!1})))}function durationsFormat(){var durations,args=[].slice.call(arguments),settings={};if(each(args,(function(arg,index){if(!index){if(!isArray(arg))throw"Expected array as the first argument to durationsFormat.";durations=arg}"string"!=typeof arg&&"function"!=typeof arg?"number"!=typeof arg?isObject(arg)&&extend(settings,arg):settings.precision=arg:settings.template=arg})),!durations||!durations.length)return[];settings.returnMomentTypes=!0;var formattedDurations=map(durations,(function(dur){return dur.format(settings)})),outputTypes=intersection(types,unique(pluck(flatten(formattedDurations),"type"))),largest=settings.largest;return largest&&(outputTypes=outputTypes.slice(0,largest)),settings.returnMomentTypes=!1,settings.outputTypes=outputTypes,map(durations,(function(dur){return dur.format(settings)}))}function durationFormat(){var args=[].slice.call(arguments),settings=extend({},this.format.defaults),asMilliseconds=this.asMilliseconds(),asMonths=this.asMonths();"function"==typeof this.isValid&&!1===this.isValid()&&(asMilliseconds=0,asMonths=0);var isNegative=asMilliseconds<0,remainder=moment.duration(Math.abs(asMilliseconds),"milliseconds"),remainderMonths=moment.duration(Math.abs(asMonths),"months");each(args,(function(arg){"string"!=typeof arg&&"function"!=typeof arg?"number"!=typeof arg?isObject(arg)&&extend(settings,arg):settings.precision=arg:settings.template=arg}));var momentTokens={years:"y",months:"M",weeks:"w",days:"d",hours:"h",minutes:"m",seconds:"s",milliseconds:"S"},tokenDefs={escape:/\[(.+?)\]/,years:/\*?[Yy]+/,months:/\*?M+/,weeks:/\*?[Ww]+/,days:/\*?[Dd]+/,hours:/\*?[Hh]+/,minutes:/\*?m+/,seconds:/\*?s+/,milliseconds:/\*?S+/,general:/.+?/};settings.types=types;var typeMap=function(token){return find(types,(function(type){return tokenDefs[type].test(token)}))},tokenizer=new RegExp(map(types,(function(type){return tokenDefs[type].source})).join("|"),"g");settings.duration=this;var template="function"==typeof settings.template?settings.template.apply(settings):settings.template,outputTypes=settings.outputTypes,returnMomentTypes=settings.returnMomentTypes,largest=settings.largest,stopTrim=[];outputTypes||(isArray(settings.stopTrim)&&(settings.stopTrim=settings.stopTrim.join("")),settings.stopTrim&&each(settings.stopTrim.match(tokenizer),(function(token){var type=typeMap(token);"escape"!==type&&"general"!==type&&stopTrim.push(type)})));var localeData=moment.localeData();localeData||(localeData={}),each(keys(engLocale),(function(key){"function"!=typeof engLocale[key]?localeData["_"+key]||(localeData["_"+key]=engLocale[key]):localeData[key]||(localeData[key]=engLocale[key])})),each(keys(localeData._durationTimeTemplates),(function(item){template=template.replace("_"+item+"_",localeData._durationTimeTemplates[item])}));var userLocale=settings.userLocale||moment.locale(),useLeftUnits=settings.useLeftUnits,usePlural=settings.usePlural,precision=settings.precision,forceLength=settings.forceLength,useGrouping=settings.useGrouping,trunc=settings.trunc,useSignificantDigits=settings.useSignificantDigits&&precision>0,significantDigits=useSignificantDigits?settings.precision:0,significantDigitsCache=significantDigits,minValue=settings.minValue,isMinValue=!1,maxValue=settings.maxValue,isMaxValue=!1,useToLocaleString=settings.useToLocaleString,groupingSeparator=settings.groupingSeparator,decimalSeparator=settings.decimalSeparator,grouping=settings.grouping;useToLocaleString=useToLocaleString&&(toLocaleStringWorks||intlNumberFormatWorks);var trim=settings.trim;isArray(trim)&&(trim=trim.join(" ")),null===trim&&(largest||maxValue||useSignificantDigits)&&(trim="all"),null!==trim&&!0!==trim&&"left"!==trim&&"right"!==trim||(trim="large"),!1===trim&&(trim="");var trimIncludes=function(item){return item.test(trim)},rLarge=/large/,rSmall=/small/,rBoth=/both/,rMid=/mid/,rAll=/^all|[^sm]all/,rFinal=/final/,trimLarge=largest>0||any([rLarge,rBoth,rAll],trimIncludes),trimSmall=any([rSmall,rBoth,rAll],trimIncludes),trimMid=any([rMid,rAll],trimIncludes),trimFinal=any([rFinal,rAll],trimIncludes),rawTokens=map(template.match(tokenizer),(function(token,index){var type=typeMap(token);return"*"===token.slice(0,1)&&(token=token.slice(1),"escape"!==type&&"general"!==type&&stopTrim.push(type)),{index:index,length:token.length,text:"",token:"escape"===type?token.replace(tokenDefs.escape,"$1"):token,type:"escape"===type||"general"===type?null:type}})),currentToken={index:0,length:0,token:"",text:"",type:null},tokens=[];useLeftUnits&&rawTokens.reverse(),each(rawTokens,(function(token){if(token.type)return(currentToken.type||currentToken.text)&&tokens.push(currentToken),void(currentToken=token);useLeftUnits?currentToken.text=token.token+currentToken.text:currentToken.text+=token.token})),(currentToken.type||currentToken.text)&&tokens.push(currentToken),useLeftUnits&&tokens.reverse();var momentTypes=intersection(types,unique(compact(pluck(tokens,"type"))));if(!momentTypes.length)return pluck(tokens,"text").join("");momentTypes=map(momentTypes,(function(momentType,index){var rawValue,isSmallest=index+1===momentTypes.length,isLargest=!index;rawValue="years"===momentType||"months"===momentType?remainderMonths.as(momentType):remainder.as(momentType);var wholeValue=Math.floor(rawValue),decimalValue=rawValue-wholeValue,token=find(tokens,(function(token){return momentType===token.type}));return isLargest&&maxValue&&rawValue>maxValue&&(isMaxValue=!0),isSmallest&&minValue&&Math.abs(settings.duration.as(momentType))<minValue&&(isMinValue=!0),isLargest&&null===forceLength&&token.length>1&&(forceLength=!0),remainder.subtract(wholeValue,momentType),remainderMonths.subtract(wholeValue,momentType),{rawValue:rawValue,wholeValue:wholeValue,decimalValue:isSmallest?decimalValue:0,isSmallest:isSmallest,isLargest:isLargest,type:momentType,tokenLength:token.length}}));var truncMethod=trunc?Math.floor:Math.round,truncate=function(value,places){var factor=Math.pow(10,places);return truncMethod(value*factor)/factor},foundFirst=!1,bubbled=!1,formatValue=function(momentType,index){var formatOptions={useGrouping:useGrouping,groupingSeparator:groupingSeparator,decimalSeparator:decimalSeparator,grouping:grouping,useToLocaleString:useToLocaleString};return useSignificantDigits&&(significantDigits<=0?(momentType.rawValue=0,momentType.wholeValue=0,momentType.decimalValue=0):(formatOptions.maximumSignificantDigits=significantDigits,momentType.significantDigits=significantDigits)),isMaxValue&&!bubbled&&(momentType.isLargest?(momentType.wholeValue=maxValue,momentType.decimalValue=0):(momentType.wholeValue=0,momentType.decimalValue=0)),isMinValue&&!bubbled&&(momentType.isSmallest?(momentType.wholeValue=minValue,momentType.decimalValue=0):(momentType.wholeValue=0,momentType.decimalValue=0)),momentType.isSmallest||momentType.significantDigits&&momentType.significantDigits-momentType.wholeValue.toString().length<=0?precision<0?momentType.value=truncate(momentType.wholeValue,precision):0===precision?momentType.value=truncMethod(momentType.wholeValue+momentType.decimalValue):useSignificantDigits?(momentType.value=trunc?truncate(momentType.rawValue,significantDigits-momentType.wholeValue.toString().length):momentType.rawValue,momentType.wholeValue&&(significantDigits-=momentType.wholeValue.toString().length)):(formatOptions.fractionDigits=precision,momentType.value=trunc?momentType.wholeValue+truncate(momentType.decimalValue,precision):momentType.wholeValue+momentType.decimalValue):useSignificantDigits&&momentType.wholeValue?(momentType.value=Math.round(truncate(momentType.wholeValue,momentType.significantDigits-momentType.wholeValue.toString().length)),significantDigits-=momentType.wholeValue.toString().length):momentType.value=momentType.wholeValue,momentType.tokenLength>1&&(forceLength||foundFirst)&&(formatOptions.minimumIntegerDigits=momentType.tokenLength,bubbled&&formatOptions.maximumSignificantDigits<momentType.tokenLength&&delete formatOptions.maximumSignificantDigits),!foundFirst&&(momentType.value>0||""===trim||find(stopTrim,momentType.type)||find(outputTypes,momentType.type))&&(foundFirst=!0),momentType.formattedValue=formatNumber(momentType.value,formatOptions,userLocale),formatOptions.useGrouping=!1,formatOptions.decimalSeparator=".",momentType.formattedValueEn=formatNumber(momentType.value,formatOptions,"en"),2===momentType.tokenLength&&"milliseconds"===momentType.type&&(momentType.formattedValueMS=formatNumber(momentType.value,{minimumIntegerDigits:3,useGrouping:!1},"en").slice(0,2)),momentType};if((momentTypes=compact(momentTypes=map(momentTypes,formatValue))).length>1){var findType=function(type){return find(momentTypes,(function(momentType){return momentType.type===type}))},bubbleTypes=function(bubble){var bubbleMomentType=findType(bubble.type);bubbleMomentType&&each(bubble.targets,(function(target){var targetMomentType=findType(target.type);targetMomentType&&parseInt(bubbleMomentType.formattedValueEn,10)===target.value&&(bubbleMomentType.rawValue=0,bubbleMomentType.wholeValue=0,bubbleMomentType.decimalValue=0,targetMomentType.rawValue+=1,targetMomentType.wholeValue+=1,targetMomentType.decimalValue=0,targetMomentType.formattedValueEn=targetMomentType.wholeValue.toString(),bubbled=!0)}))};each(bubbles,bubbleTypes)}return bubbled&&(foundFirst=!1,significantDigits=significantDigitsCache,momentTypes=compact(momentTypes=map(momentTypes,formatValue))),!outputTypes||isMaxValue&&!settings.trim?(trimLarge&&(momentTypes=rest(momentTypes,(function(momentType){return!momentType.isSmallest&&!momentType.wholeValue&&!find(stopTrim,momentType.type)}))),largest&&momentTypes.length&&(momentTypes=momentTypes.slice(0,largest)),trimSmall&&momentTypes.length>1&&(momentTypes=initial(momentTypes,(function(momentType){return!momentType.wholeValue&&!find(stopTrim,momentType.type)&&!momentType.isLargest}))),trimMid&&(momentTypes=compact(momentTypes=map(momentTypes,(function(momentType,index){return index>0&&index<momentTypes.length-1&&!momentType.wholeValue?null:momentType})))),!trimFinal||1!==momentTypes.length||momentTypes[0].wholeValue||!trunc&&momentTypes[0].isSmallest&&momentTypes[0].rawValue<minValue||(momentTypes=[])):momentTypes=compact(momentTypes=map(momentTypes,(function(momentType){return find(outputTypes,(function(outputType){return momentType.type===outputType}))?momentType:null}))),returnMomentTypes?momentTypes:(each(tokens,(function(token){var key=momentTokens[token.type],momentType=find(momentTypes,(function(momentType){return momentType.type===token.type}));if(key&&momentType){var values=momentType.formattedValueEn.split(".");values[0]=parseInt(values[0],10),values[1]?values[1]=parseFloat("0."+values[1],10):values[1]=null;var pluralKey=localeData.durationPluralKey(key,values[0],values[1]),labels=durationGetLabels(key,localeData),autoLocalized=!1,pluralizedLabels={};each(localeData._durationLabelTypes,(function(labelType){var label=find(labels,(function(label){return label.type===labelType.type&&label.key===pluralKey}));label&&(pluralizedLabels[label.type]=label.label,stringIncludes(token.text,labelType.string)&&(token.text=token.text.replace(labelType.string,label.label),autoLocalized=!0))})),usePlural&&!autoLocalized&&(labels.sort(durationLabelCompare),each(labels,(function(label){return pluralizedLabels[label.type]===label.label?!stringIncludes(token.text,label.label)&&void 0:stringIncludes(token.text,label.label)?(token.text=token.text.replace(label.label,pluralizedLabels[label.type]),!1):void 0})))}})),(tokens=map(tokens,(function(token){if(!token.type)return token.text;var momentType=find(momentTypes,(function(momentType){return momentType.type===token.type}));if(!momentType)return"";var out="";return useLeftUnits&&(out+=token.text),(isNegative&&isMaxValue||!isNegative&&isMinValue)&&(out+="< ",isMaxValue=!1,isMinValue=!1),(isNegative&&isMinValue||!isNegative&&isMaxValue)&&(out+="> ",isMaxValue=!1,isMinValue=!1),isNegative&&(momentType.value>0||""===trim||find(stopTrim,momentType.type)||find(outputTypes,momentType.type))&&(out+="-",isNegative=!1),"milliseconds"===token.type&&momentType.formattedValueMS?out+=momentType.formattedValueMS:out+=momentType.formattedValue,useLeftUnits||(out+=token.text),out}))).join("").replace(/(,| |:|\.)*$/,"").replace(/^(,| |:|\.)*/,""))}function defaultFormatTemplate(){var dur=this.duration,findType=function(type){return dur._data[type]},firstType=find(this.types,findType),lastType=function(array,callback){for(var index=array.length;index-=1;)if(callback(array[index]))return array[index]}(this.types,findType);switch(firstType){case"milliseconds":return"S __";case"seconds":case"minutes":return"*_MS_";case"hours":return"_HMS_";case"days":if(firstType===lastType)return"d __";case"weeks":return firstType===lastType?"w __":(null===this.trim&&(this.trim="both"),"w __, d __, h __");case"months":if(firstType===lastType)return"M __";case"years":return firstType===lastType?"y __":(null===this.trim&&(this.trim="both"),"y __, M __, d __");default:return null===this.trim&&(this.trim="both"),"y __, d __, h __, m __, s __"}}function init(context){if(!context)throw"Moment Duration Format init cannot find moment instance.";context.duration.format=durationsFormat,context.duration.fn.format=durationFormat,context.duration.fn.format.defaults={trim:null,stopTrim:null,largest:null,maxValue:null,minValue:null,precision:0,trunc:!1,forceLength:null,userLocale:null,usePlural:!0,useLeftUnits:!1,useGrouping:!0,useSignificantDigits:!1,template:defaultFormatTemplate,useToLocaleString:!0,groupingSeparator:",",decimalSeparator:".",grouping:[3]},context.updateLocale("en",engLocale)}var toLocaleStringFormatter=function(number,locale,options){return number.toLocaleString(locale,options)};toLocaleStringWorks=function(){try{(0).toLocaleString("i")}catch(e){return"RangeError"===e.name}return!1}()&&featureTestFormatter(toLocaleStringFormatter),toLocaleStringRoundingWorks=toLocaleStringWorks&&featureTestFormatterRounding(toLocaleStringFormatter);var intlNumberFormatFormatter=function(number,locale,options){if("undefined"!=typeof window&&window&&window.Intl&&window.Intl.NumberFormat)return window.Intl.NumberFormat(locale,options).format(number)};return intlNumberFormatWorks=featureTestFormatter(intlNumberFormatFormatter),intlNumberFormatRoundingWorks=intlNumberFormatWorks&&featureTestFormatterRounding(intlNumberFormatFormatter),init(moment),init},__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(3)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=factory)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),this&&(this.momentDurationFormatSetup=this.moment?factory(this.moment):factory)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var ConferenceParticipant=function(){function ConferenceParticipant(participantId,userId,jid_im,jid_tel,participantRole,mute,held,confStartDate,startDate,phoneNumber,participantState,delegateCapability){_classCallCheck(this,ConferenceParticipant),this.participantId=participantId,this.userId=userId,this.jid_im=jid_im,this.jid_tel=jid_tel,this.participantRole=participantRole,this.mute=mute,this.held=held,this.confStartDate=confStartDate,this.startDate=startDate,this.phoneNumber=phoneNumber,this.participantState=participantState,this.delegateCapability=delegateCapability}return _createClass(ConferenceParticipant,[{key:"updateFromData",value:function(data){data.participantId&&(this.participantId=data.participantId),data.userId&&(this.userId=data.userId),this.jid_im=data.jid_im,data.jid_tel&&(this.jid_tel=data.jid_tel),this.participantRole=data.participantRole,this.mute=data.mute,this.held=data.held,this.confStartDate=data.confStartDate,this.startDate=data.startDate,this.phoneNumber=data.phoneNumber,this.participantState=data.participantState,this.delegateCapability=data.delegateCapability}}],[{key:"createFromData",value:function(data){return new ConferenceParticipant(data.participantId,data.userId,data.jid_im,data.jid_tel,data.participantRole,data.mute,data.held,data.confStartDate,data.startDate,data.phoneNumber,data.participantState,data.delegateCapability)}}]),ConferenceParticipant}();exports.ConferenceParticipant=ConferenceParticipant},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Observable_1=__webpack_require__(55),Subscription_1=__webpack_require__(45);exports.scheduleArray=function(input,scheduler){return new Observable_1.Observable((function(subscriber){var sub=new Subscription_1.Subscription,i=0;return sub.add(scheduler.schedule((function(){i!==input.length?(subscriber.next(input[i++]),subscriber.closed||sub.add(this.schedule())):subscriber.complete()}))),sub}))}},function(module,exports,__webpack_require__){(function(Buffer){!function(exports){var storage,BUFFER=void 0!==Buffer&&Buffer,UINT8ARRAY="undefined"!=typeof Uint8Array&&Uint8Array,ARRAYBUFFER="undefined"!=typeof ArrayBuffer&&ArrayBuffer,ZERO=[0,0,0,0,0,0,0,0],isArray=Array.isArray||function(val){return!!val&&"[object Array]"==Object.prototype.toString.call(val)},BIT32=4294967296;function factory(name,bigendian,unsigned){var posH=bigendian?0:4,posL=bigendian?4:0,pos0=bigendian?0:3,pos1=bigendian?1:2,pos2=bigendian?2:1,pos3=bigendian?3:0,fromPositive=bigendian?fromPositiveBE:fromPositiveLE,fromNegative=bigendian?fromNegativeBE:fromNegativeLE,proto=Int64.prototype,isName="is"+name,_isInt64="_"+isName;return proto.buffer=void 0,proto.offset=0,proto[_isInt64]=!0,proto.toNumber=toNumber,proto.toString=function(radix){var buffer=this.buffer,offset=this.offset,high=readInt32(buffer,offset+posH),low=readInt32(buffer,offset+posL),str="",sign=!unsigned&&2147483648&high;for(sign&&(high=~high,low=BIT32-low),radix=radix||10;;){var mod=high%radix*BIT32+low;if(high=Math.floor(high/radix),low=Math.floor(mod/radix),str=(mod%radix).toString(radix)+str,!high&&!low)break}return sign&&(str="-"+str),str},proto.toJSON=toNumber,proto.toArray=toArray,BUFFER&&(proto.toBuffer=toBuffer),UINT8ARRAY&&(proto.toArrayBuffer=toArrayBuffer),Int64[isName]=function(b){return!(!b||!b[_isInt64])},exports[name]=Int64,Int64;function Int64(buffer,offset,value,raddix){return this instanceof Int64?function(that,buffer,offset,value,raddix){UINT8ARRAY&&ARRAYBUFFER&&(buffer instanceof ARRAYBUFFER&&(buffer=new UINT8ARRAY(buffer)),value instanceof ARRAYBUFFER&&(value=new UINT8ARRAY(value))),buffer||offset||value||storage?(isValidBuffer(buffer,offset)||(raddix=offset,value=buffer,offset=0,buffer=new(storage||Array)(8)),that.buffer=buffer,that.offset=offset|=0,void 0!==value&&("string"==typeof value?function(buffer,offset,str,raddix){var pos=0,len=str.length,high=0,low=0;"-"===str[0]&&pos++;for(var sign=pos;pos<len;){var chr=parseInt(str[pos++],raddix);if(!(chr>=0))break;low=low*raddix+chr,high=high*raddix+Math.floor(low/BIT32),low%=BIT32}sign&&(high=~high,low?low=BIT32-low:high++),writeInt32(buffer,offset+posH,high),writeInt32(buffer,offset+posL,low)}(buffer,offset,value,raddix||10):isValidBuffer(value,raddix)?fromArray(buffer,offset,value,raddix):"number"==typeof raddix?(writeInt32(buffer,offset+posH,value),writeInt32(buffer,offset+posL,raddix)):value>0?fromPositive(buffer,offset,value):value<0?fromNegative(buffer,offset,value):fromArray(buffer,offset,ZERO,0))):that.buffer=newArray(ZERO,0)}(this,buffer,offset,value,raddix):new Int64(buffer,offset,value,raddix)}function toNumber(){var buffer=this.buffer,offset=this.offset,high=readInt32(buffer,offset+posH),low=readInt32(buffer,offset+posL);return unsigned||(high|=0),high?high*BIT32+low:low}function writeInt32(buffer,offset,value){buffer[offset+pos3]=255&value,value>>=8,buffer[offset+pos2]=255&value,value>>=8,buffer[offset+pos1]=255&value,value>>=8,buffer[offset+pos0]=255&value}function readInt32(buffer,offset){return 16777216*buffer[offset+pos0]+(buffer[offset+pos1]<<16)+(buffer[offset+pos2]<<8)+buffer[offset+pos3]}}function toArray(raw){var buffer=this.buffer,offset=this.offset;return storage=null,!1!==raw&&0===offset&&8===buffer.length&&isArray(buffer)?buffer:newArray(buffer,offset)}function toBuffer(raw){var buffer=this.buffer,offset=this.offset;if(storage=BUFFER,!1!==raw&&0===offset&&8===buffer.length&&Buffer.isBuffer(buffer))return buffer;var dest=new BUFFER(8);return fromArray(dest,0,buffer,offset),dest}function toArrayBuffer(raw){var buffer=this.buffer,offset=this.offset,arrbuf=buffer.buffer;if(storage=UINT8ARRAY,!1!==raw&&0===offset&&arrbuf instanceof ARRAYBUFFER&&8===arrbuf.byteLength)return arrbuf;var dest=new UINT8ARRAY(8);return fromArray(dest,0,buffer,offset),dest.buffer}function isValidBuffer(buffer,offset){var len=buffer&&buffer.length;return offset|=0,len&&offset+8<=len&&"string"!=typeof buffer[offset]}function fromArray(destbuf,destoff,srcbuf,srcoff){destoff|=0,srcoff|=0;for(var i=0;i<8;i++)destbuf[destoff++]=255&srcbuf[srcoff++]}function newArray(buffer,offset){return Array.prototype.slice.call(buffer,offset,offset+8)}function fromPositiveBE(buffer,offset,value){for(var pos=offset+8;pos>offset;)buffer[--pos]=255&value,value/=256}function fromNegativeBE(buffer,offset,value){var pos=offset+8;for(value++;pos>offset;)buffer[--pos]=255&-value^255,value/=256}function fromPositiveLE(buffer,offset,value){for(var end=offset+8;offset<end;)buffer[offset++]=255&value,value/=256}function fromNegativeLE(buffer,offset,value){var end=offset+8;for(value++;offset<end;)buffer[offset++]=255&-value^255,value/=256}factory("Uint64BE",!0,!0),factory("Int64BE",!0,!1),factory("Uint64LE",!1,!0),factory("Int64LE",!1,!1)}("string"!=typeof exports.nodeName?exports:this||{})}).call(this,__webpack_require__(57).Buffer)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var tools=__webpack_require__(48),tools_1=__webpack_require__(48),byEbmlID=__webpack_require__(232).byEbmlID,EBMLEncoder=function(){function EBMLEncoder(){this._schema=byEbmlID,this._buffers=[],this._stack=[]}return EBMLEncoder.prototype.encode=function(elms){var _this=this;return tools.concat(elms.reduce((function(lst,elm){return lst.concat(_this.encodeChunk(elm))}),[])).buffer},EBMLEncoder.prototype.encodeChunk=function(elm){return"m"===elm.type?elm.isEnd?this.endTag(elm):this.startTag(elm):this.writeTag(elm),this.flush()},EBMLEncoder.prototype.flush=function(){var ret=this._buffers;return this._buffers=[],ret},EBMLEncoder.prototype.getSchemaInfo=function(tagName){for(var tagNums=Object.keys(this._schema).map(Number),i=0;i<tagNums.length;i++){var tagNum=tagNums[i];if(this._schema[tagNum].name===tagName)return new tools_1.Buffer(tagNum.toString(16),"hex")}return null},EBMLEncoder.prototype.writeTag=function(elm){var tagName=elm.name,tagId=this.getSchemaInfo(tagName),tagData=elm.data;if(null==tagId)throw new Error("No schema entry found for "+tagName);var data=tools.encodeTag(tagId,tagData);this._stack.length>0?this._stack[this._stack.length-1].children.push({tagId:tagId,elm:elm,children:[],data:data}):this._buffers=this._buffers.concat(data)},EBMLEncoder.prototype.startTag=function(elm){var tagName=elm.name,tagId=this.getSchemaInfo(tagName);if(null==tagId)throw new Error("No schema entry found for "+tagName);if(elm.unknownSize){var data=tools.encodeTag(tagId,new tools_1.Buffer(0),elm.unknownSize);this._buffers=this._buffers.concat(data)}else{var tag={tagId:tagId,elm:elm,children:[],data:null};this._stack.length>0&&this._stack[this._stack.length-1].children.push(tag),this._stack.push(tag)}},EBMLEncoder.prototype.endTag=function(elm){elm.name;var tag=this._stack.pop();if(null==tag)throw new Error("EBML structure is broken");if(tag.elm.name!==elm.name)throw new Error("EBML structure is broken");var childTagDataBuffers=tag.children.reduce((function(lst,child){if(null===child.data)throw new Error("EBML structure is broken");return lst.concat(child.data)}),[]),childTagDataBuffer=tools.concat(childTagDataBuffers);"m"===tag.elm.type?tag.data=tools.encodeTag(tag.tagId,childTagDataBuffer,tag.elm.unknownSize):tag.data=tools.encodeTag(tag.tagId,childTagDataBuffer),this._stack.length<1&&(this._buffers=this._buffers.concat(tag.data))},EBMLEncoder}();exports.default=EBMLEncoder},function(module,exports,__webpack_require__){var byEbmlID={128:{name:"ChapterDisplay",level:4,type:"m",multiple:!0,minver:1,webm:!0,description:"Contains all possible strings to use for the chapter display."},131:{name:"TrackType",level:3,type:"u",mandatory:!0,minver:1,range:"1-254",description:"A set of track types coded on 8 bits (1: video, 2: audio, 3: complex, 0x10: logo, 0x11: subtitle, 0x12: buttons, 0x20: control)."},133:{name:"ChapString",cppname:"ChapterString",level:5,type:"8",mandatory:!0,minver:1,webm:!0,description:"Contains the string to use as the chapter atom."},134:{name:"CodecID",level:3,type:"s",mandatory:!0,minver:1,description:"An ID corresponding to the codec, see the codec page for more info."},136:{name:"FlagDefault",cppname:"TrackFlagDefault",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if that track (audio, video or subs) SHOULD be active if no language found matches the user preference. (1 bit)"},137:{name:"ChapterTrackNumber",level:5,type:"u",mandatory:!0,multiple:!0,minver:1,webm:!1,range:"not 0",description:"UID of the Track to apply this chapter too. In the absense of a control track, choosing this chapter will select the listed Tracks and deselect unlisted tracks. Absense of this element indicates that the Chapter should be applied to any currently used Tracks."},145:{name:"ChapterTimeStart",level:4,type:"u",mandatory:!0,minver:1,webm:!0,description:"Timestamp of the start of Chapter (not scaled)."},146:{name:"ChapterTimeEnd",level:4,type:"u",minver:1,webm:!1,description:"Timestamp of the end of Chapter (timestamp excluded, not scaled)."},150:{name:"CueRefTime",level:5,type:"u",mandatory:!0,minver:2,webm:!1,description:"Timestamp of the referenced Block."},151:{name:"CueRefCluster",level:5,type:"u",mandatory:!0,webm:!1,description:"The Position of the Cluster containing the referenced Block."},152:{name:"ChapterFlagHidden",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a chapter is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},16980:{name:"ContentCompAlgo",level:6,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The compression algorithm used. Algorithms that have been specified so far are: 0 - zlib,   3 - Header Stripping"},16981:{name:"ContentCompSettings",level:6,type:"b",minver:1,webm:!1,description:"Settings that might be needed by the decompressor. For Header Stripping (ContentCompAlgo=3), the bytes that were removed from the beggining of each frames of the track."},17026:{name:"DocType",level:1,type:"s",mandatory:!0,default:"matroska",minver:1,description:"A string that describes the type of document that follows this EBML header. 'matroska' in our case or 'webm' for webm files."},17029:{name:"DocTypeReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum DocType version an interpreter has to support to read this file."},17030:{name:"EBMLVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of EBML parser used to create the file."},17031:{name:"DocTypeVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of DocType interpreter used to create the file."},17476:{name:"SegmentFamily",level:2,type:"b",multiple:!0,minver:1,webm:!1,bytesize:16,description:"A randomly generated unique ID that all segments related to each other must use (128 bits)."},17505:{name:"DateUTC",level:2,type:"d",minver:1,description:"Date of the origin of timestamp (value 0), i.e. production date."},17540:{name:"TagDefault",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Indication to know if this is the default/original language to use for the given tag. (1 bit)"},17541:{name:"TagBinary",level:4,type:"b",minver:1,webm:!1,description:"The values of the Tag if it is binary. Note that this cannot be used in the same SimpleTag as TagString."},17543:{name:"TagString",level:4,type:"8",minver:1,webm:!1,description:"The value of the Element."},17545:{name:"Duration",level:2,type:"f",minver:1,range:"> 0",description:"Duration of the segment (based on TimecodeScale)."},17816:{name:"ChapterFlagEnabled",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Specify wether the chapter is enabled. It can be enabled/disabled by a Control Track. When disabled, the movie should skip all the content between the TimeStart and TimeEnd of this chapter (see flag notes). (1 bit)"},18016:{name:"FileMimeType",level:3,type:"s",mandatory:!0,minver:1,webm:!1,description:"MIME type of the file."},18017:{name:"FileUsedStartTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18018:{name:"FileUsedEndTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18037:{name:"FileReferral",level:3,type:"b",webm:!1,description:"A binary value that a track/codec can refer to when the attachment is needed."},20529:{name:"ContentEncodingOrder",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Tells when this modification was used during encoding/muxing starting with 0 and counting upwards. The decoder/demuxer has to start with the highest order number it finds and work its way down. This value has to be unique over all ContentEncodingOrder elements in the segment."},20530:{name:"ContentEncodingScope",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"A bit field that describes which elements have been modified in this way. Values (big endian) can be OR'ed. Possible values: 1 - all frame contents, 2 - the track's private data, 4 - the next ContentEncoding (next ContentEncodingOrder. Either the data inside ContentCompression and/or ContentEncryption)"},20531:{name:"ContentEncodingType",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"A value describing what kind of transformation has been done. Possible values: 0 - compression, 1 - encryption"},20532:{name:"ContentCompression",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the compression used. Must be present if the value of ContentEncodingType is 0 and absent otherwise. Each block must be decompressable even if no previous block is available in order not to prevent seeking."},20533:{name:"ContentEncryption",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the encryption used. Must be present if the value of ContentEncodingType is 1 and absent otherwise."},21368:{name:"CueBlockNumber",level:4,type:"u",minver:1,default:1,range:"not 0",description:"Number of the Block in the specified Cluster."},22100:{name:"ChapterStringUID",level:4,type:"8",mandatory:!1,minver:3,webm:!0,description:"A unique string ID to identify the Chapter. Use for WebVTT cue identifier storage."},22337:{name:"WritingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Writing application ("mkvmerge-0.3.3").'},22612:{name:"SilentTracks",cppname:"ClusterSilentTracks",level:2,type:"m",minver:1,webm:!1,description:"The list of tracks that are not used in that part of the stream. It is useful when using overlay tracks on seeking. Then you should decide what track to use."},25152:{name:"ContentEncoding",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Settings for one content encoding like compression or encryption."},25188:{name:"BitDepth",cppname:"AudioBitDepth",level:4,type:"u",minver:1,range:"not 0",description:"Bits per sample, mostly used for PCM."},25906:{name:"SignedElement",level:3,type:"b",multiple:!0,webm:!1,description:"An element ID whose data will be used to compute the signature."},26148:{name:"TrackTranslate",level:3,type:"m",multiple:!0,minver:1,webm:!1,description:"The track identification for the given Chapter Codec."},26897:{name:"ChapProcessCommand",cppname:"ChapterProcessCommand",level:5,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26914:{name:"ChapProcessTime",cppname:"ChapterProcessTime",level:6,type:"u",mandatory:!0,minver:1,webm:!1,description:"Defines when the process command should be handled (0: during the whole chapter, 1: before starting playback, 2: after playback of the chapter)."},26916:{name:"ChapterTranslate",level:2,type:"m",multiple:!0,minver:1,webm:!1,description:"A tuple of corresponding ID used by chapter codecs to represent this segment."},26931:{name:"ChapProcessData",cppname:"ChapterProcessData",level:6,type:"b",mandatory:!0,minver:1,webm:!1,description:"Contains the command information. The data should be interpreted depending on the ChapProcessCodecID value. For ChapProcessCodecID = 1, the data correspond to the binary DVD cell pre/post commands."},26948:{name:"ChapProcess",cppname:"ChapterProcess",level:4,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26965:{name:"ChapProcessCodecID",cppname:"ChapterProcessCodecID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Contains the type of the codec used for the processing. A value of 0 means native Matroska processing (to be defined), a value of 1 means the DVD command set is used. More codec IDs can be added later."},29555:{name:"Tag",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters."},29572:{name:"SegmentFilename",level:2,type:"8",minver:1,webm:!1,description:"A filename corresponding to this segment."},29766:{name:"AttachmentLink",cppname:"TrackAttachmentLink",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"The UID of an attachment that is used by this codec."},2459272:{name:"CodecName",level:3,type:"8",minver:1,description:"A human-readable string specifying the codec."},408125543:{name:"Segment",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"This element contains all other top-level (level 1) elements. Typically a Matroska file is composed of 1 segment."},17530:{name:"TagLanguage",level:4,type:"s",mandatory:!0,minver:1,webm:!1,default:"und",description:"Specifies the language of the tag specified, in the Matroska languages form."},17827:{name:"TagName",level:4,type:"8",mandatory:!0,minver:1,webm:!1,description:"The name of the Tag that is going to be stored."},26568:{name:"SimpleTag",cppname:"TagSimple",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contains general information about the target."},25542:{name:"TagAttachmentUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Attachment(s) the tags belong to. If the value is 0 at this level, the tags apply to all the attachments in the Segment."},25540:{name:"TagChapterUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Chapter(s) the tags belong to. If the value is 0 at this level, the tags apply to all chapters in the Segment."},25545:{name:"TagEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the EditionEntry(s) the tags belong to. If the value is 0 at this level, the tags apply to all editions in the Segment."},25541:{name:"TagTrackUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Track(s) the tags belong to. If the value is 0 at this level, the tags apply to all tracks in the Segment."},25546:{name:"TargetType",cppname:"TagTargetType",level:4,type:"s",minver:1,webm:!1,strong:"informational",description:'An  string that can be used to display the logical level of the target like "ALBUM", "TRACK", "MOVIE", "CHAPTER", etc (see TargetType).'},26826:{name:"TargetTypeValue",cppname:"TagTargetTypeValue",level:4,type:"u",minver:1,webm:!1,default:50,description:"A number to indicate the logical level of the target (see TargetType)."},25536:{name:"Targets",cppname:"TagTargets",level:3,type:"m",mandatory:!0,minver:1,webm:!1,description:"Contain all UIDs where the specified meta data apply. It is empty to describe everything in the segment."},307544935:{name:"Tags",level:1,type:"m",multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters. A list of valid tags can be found here."},17677:{name:"ChapProcessPrivate",cppname:"ChapterProcessPrivate",level:5,type:"b",minver:1,webm:!1,description:'Some optional data attached to the ChapProcessCodecID information. For ChapProcessCodecID = 1, it is the "DVD level" equivalent.'},17278:{name:"ChapCountry",cppname:"ChapterCountry",level:5,type:"s",multiple:!0,minver:1,webm:!1,description:"The countries corresponding to the string, same 2 octets as in Internet domains."},17276:{name:"ChapLanguage",cppname:"ChapterLanguage",level:5,type:"s",mandatory:!0,multiple:!0,minver:1,webm:!0,default:"eng",description:"The languages corresponding to the string, in the bibliographic ISO-639-2 form."},143:{name:"ChapterTrack",level:4,type:"m",minver:1,webm:!1,description:"List of tracks on which the chapter applies. If this element is not present, all tracks apply"},25539:{name:"ChapterPhysicalEquiv",level:4,type:"u",minver:1,webm:!1,description:'Specify the physical equivalent of this ChapterAtom like "DVD" (60) or "SIDE" (50), see complete list of values.'},28348:{name:"ChapterSegmentEditionUID",level:4,type:"u",minver:1,webm:!1,range:"not 0",description:"The EditionUID to play from the segment linked in ChapterSegmentUID."},28263:{name:"ChapterSegmentUID",level:4,type:"b",minver:1,webm:!1,range:">0",bytesize:16,description:"A segment to play in place of this chapter. Edition ChapterSegmentEditionUID should be used for this segment, otherwise no edition is used."},29636:{name:"ChapterUID",level:4,type:"u",mandatory:!0,minver:1,webm:!0,range:"not 0",description:"A unique ID to identify the Chapter."},182:{name:"ChapterAtom",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains the atom information to use as the chapter atom (apply to all tracks)."},17885:{name:"EditionFlagOrdered",level:3,type:"u",minver:1,webm:!1,default:0,range:"0-1",description:"Specify if the chapters can be defined multiple times and the order to play them is enforced. (1 bit)"},17883:{name:"EditionFlagDefault",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a flag is set (1) the edition should be used as the default one. (1 bit)"},17853:{name:"EditionFlagHidden",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If an edition is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},17852:{name:"EditionUID",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"A unique ID to identify the edition. It's useful for tagging an edition."},17849:{name:"EditionEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains all information about a segment edition."},272869232:{name:"Chapters",level:1,type:"m",minver:1,webm:!0,description:"A system to define basic menus and partition data. For more detailed information, look at the Chapters Explanation."},18094:{name:"FileUID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,range:"not 0",description:"Unique ID representing the file, as random as possible."},18012:{name:"FileData",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The data of the file."},18030:{name:"FileName",level:3,type:"8",mandatory:!0,minver:1,webm:!1,description:"Filename of the attached file."},18046:{name:"FileDescription",level:3,type:"8",minver:1,webm:!1,description:"A human-friendly name for the attached file."},24999:{name:"AttachedFile",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"An attached file."},423732329:{name:"Attachments",level:1,type:"m",minver:1,webm:!1,description:"Contain attached files."},235:{name:"CueRefCodecState",level:5,type:"u",webm:!1,default:0,description:"The position of the Codec State corresponding to this referenced element. 0 means that the data is taken from the initial Track Entry."},21343:{name:"CueRefNumber",level:5,type:"u",webm:!1,default:1,range:"not 0",description:"Number of the referenced Block of Track X in the specified Cluster."},219:{name:"CueReference",level:4,type:"m",multiple:!0,minver:2,webm:!1,description:"The Clusters containing the required referenced Blocks."},234:{name:"CueCodecState",level:4,type:"u",minver:2,webm:!1,default:0,description:"The position of the Codec State corresponding to this Cue element. 0 means that the data is taken from the initial Track Entry."},178:{name:"CueDuration",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The duration of the block according to the segment time base. If missing the track's DefaultDuration does not apply and no duration information is available in terms of the cues."},240:{name:"CueRelativePosition",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The relative position of the referenced block inside the cluster with 0 being the first possible position for an element inside that cluster.",position:"clusterRelative"},241:{name:"CueClusterPosition",level:4,type:"u",mandatory:!0,minver:1,description:"The position of the Cluster containing the required Block.",position:"segment"},247:{name:"CueTrack",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track for which a position is given."},183:{name:"CueTrackPositions",level:3,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contain positions for different tracks corresponding to the timestamp."},179:{name:"CueTime",level:3,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp according to the segment time base."},187:{name:"CuePoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains all information relative to a seek point in the segment."},475249515:{name:"Cues",level:1,type:"m",minver:1,description:'A top-level element to speed seeking access. All entries are local to the segment. Should be mandatory for non "live" streams.'},18406:{name:"ContentSigHashAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The hash algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - SHA1-160 2 - MD5"},18405:{name:"ContentSigAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - RSA"},18404:{name:"ContentSigKeyID",level:6,type:"b",minver:1,webm:!1,description:"This is the ID of the private key the data was signed with."},18403:{name:"ContentSignature",level:6,type:"b",minver:1,webm:!1,description:"A cryptographic signature of the contents."},18402:{name:"ContentEncKeyID",level:6,type:"b",minver:1,webm:!1,description:"For public key algorithms this is the ID of the public key the the data was encrypted with."},18401:{name:"ContentEncAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The encryption algorithm used. The value '0' means that the contents have not been encrypted but only signed. Predefined values: 1 - DES, 2 - 3DES, 3 - Twofish, 4 - Blowfish, 5 - AES"},28032:{name:"ContentEncodings",level:3,type:"m",minver:1,webm:!1,description:"Settings for several content encoding mechanisms like compression or encryption."},196:{name:"TrickMasterTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},199:{name:"TrickMasterTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},198:{name:"TrickTrackFlag",level:3,type:"u",divx:!0,default:0,description:"DivX trick track extenstions"},193:{name:"TrickTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},192:{name:"TrickTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},237:{name:"TrackJoinUID",level:5,type:"u",mandatory:!0,multiple:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of a track whose blocks are used to create this virtual track."},233:{name:"TrackJoinBlocks",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all tracks whose Blocks need to be combined to create this virtual track"},230:{name:"TrackPlaneType",level:6,type:"u",mandatory:!0,minver:3,webm:!1,description:"The kind of plane this track corresponds to (0: left eye, 1: right eye, 2: background)."},229:{name:"TrackPlaneUID",level:6,type:"u",mandatory:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of the track representing the plane."},228:{name:"TrackPlane",level:5,type:"m",mandatory:!0,multiple:!0,minver:3,webm:!1,description:"Contains a video plane track that need to be combined to create this 3D track"},227:{name:"TrackCombinePlanes",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all video plane tracks that need to be combined to create this 3D track"},226:{name:"TrackOperation",level:3,type:"m",minver:3,webm:!1,description:"Operation that needs to be applied on tracks to create this virtual track. For more details look at the Specification Notes on the subject."},32123:{name:"ChannelPositions",cppname:"AudioPosition",level:4,type:"b",webm:!1,description:"Table of horizontal angles for each successive channel, see appendix."},159:{name:"Channels",cppname:"AudioChannels",level:4,type:"u",mandatory:!0,minver:1,default:1,range:"not 0",description:"Numbers of channels in the track."},30901:{name:"OutputSamplingFrequency",cppname:"AudioOutputSamplingFreq",level:4,type:"f",minver:1,default:"Sampling Frequency",range:"> 0",description:"Real output sampling frequency in Hz (used for SBR techniques)."},181:{name:"SamplingFrequency",cppname:"AudioSamplingFreq",level:4,type:"f",mandatory:!0,minver:1,default:8e3,range:"> 0",description:"Sampling frequency in Hz."},225:{name:"Audio",cppname:"TrackAudio",level:3,type:"m",minver:1,description:"Audio settings."},2327523:{name:"FrameRate",cppname:"VideoFrameRate",level:4,type:"f",range:"> 0",strong:"Informational",description:"Number of frames per second.  only."},3126563:{name:"GammaValue",cppname:"VideoGamma",level:4,type:"f",webm:!1,range:"> 0",description:"Gamma Value."},3061028:{name:"ColourSpace",cppname:"VideoColourSpace",level:4,type:"b",minver:1,webm:!1,bytesize:4,description:"Same value as in AVI (32 bits)."},21683:{name:"AspectRatioType",cppname:"VideoAspectRatio",level:4,type:"u",minver:1,default:0,description:"Specify the possible modifications to the aspect ratio (0: free resizing, 1: keep aspect ratio, 2: fixed)."},21682:{name:"DisplayUnit",cppname:"VideoDisplayUnit",level:4,type:"u",minver:1,default:0,description:"How DisplayWidth & DisplayHeight should be interpreted (0: pixels, 1: centimeters, 2: inches, 3: Display Aspect Ratio)."},21690:{name:"DisplayHeight",cppname:"VideoDisplayHeight",level:4,type:"u",minver:1,default:"PixelHeight",range:"not 0",description:"Height of the video frames to display. The default value is only valid when DisplayUnit is 0."},21680:{name:"DisplayWidth",cppname:"VideoDisplayWidth",level:4,type:"u",minver:1,default:"PixelWidth",range:"not 0",description:"Width of the video frames to display. The default value is only valid when DisplayUnit is 0."},21725:{name:"PixelCropRight",cppname:"VideoPixelCropRight",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the right of the image."},21708:{name:"PixelCropLeft",cppname:"VideoPixelCropLeft",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the left of the image."},21691:{name:"PixelCropTop",cppname:"VideoPixelCropTop",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the top of the image."},21674:{name:"PixelCropBottom",cppname:"VideoPixelCropBottom",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the bottom of the image (for HDTV content)."},186:{name:"PixelHeight",cppname:"VideoPixelHeight",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Height of the encoded video frames in pixels."},176:{name:"PixelWidth",cppname:"VideoPixelWidth",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Width of the encoded video frames in pixels."},21433:{name:"OldStereoMode",level:4,type:"u",maxver:"0",webm:!1,divx:!1,description:"DEPRECATED, DO NOT USE. Bogus StereoMode value used in old versions of libmatroska. (0: mono, 1: right eye, 2: left eye, 3: both eyes)."},21440:{name:"AlphaMode",cppname:"VideoAlphaMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Alpha Video Mode. Presence of this element indicates that the BlockAdditional element could contain Alpha data."},21432:{name:"StereoMode",cppname:"VideoStereoMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Stereo-3D video mode (0: mono, 1: side by side (left eye is first), 2: top-bottom (right eye is first), 3: top-bottom (left eye is first), 4: checkboard (right is first), 5: checkboard (left is first), 6: row interleaved (right is first), 7: row interleaved (left is first), 8: column interleaved (right is first), 9: column interleaved (left is first), 10: anaglyph (cyan/red), 11: side by side (right eye is first), 12: anaglyph (green/magenta), 13 both eyes laced in one Block (left eye is first), 14 both eyes laced in one Block (right eye is first)) . There are some more details on 3D support in the Specification Notes."},154:{name:"FlagInterlaced",cppname:"VideoFlagInterlaced",level:4,type:"u",mandatory:!0,minver:2,webm:!0,default:0,range:"0-1",description:"Set if the video is interlaced. (1 bit)"},224:{name:"Video",cppname:"TrackVideo",level:3,type:"m",minver:1,description:"Video settings."},26277:{name:"TrackTranslateTrackID",level:4,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this track in the chapter codec data. The format depends on the ChapProcessCodecID used."},26303:{name:"TrackTranslateCodec",level:4,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},26364:{name:"TrackTranslateEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this translation applies. When not specified, it means for all editions found in the segment."},22203:{name:"SeekPreRoll",level:3,type:"u",mandatory:!0,multiple:!1,default:0,minver:4,webm:!0,description:"After a discontinuity, SeekPreRoll is the duration in nanoseconds of the data the decoder must decode before the decoded data is valid."},22186:{name:"CodecDelay",level:3,type:"u",multiple:!1,default:0,minver:4,webm:!0,description:"CodecDelay is The codec-built-in delay in nanoseconds. This value must be subtracted from each block timestamp in order to get the actual timestamp. The value should be small so the muxing of tracks with the same actual timestamp are in the same Cluster."},28587:{name:"TrackOverlay",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify that this track is an overlay track for the Track specified (in the u-integer). That means when this track has a gap (see SilentTracks) the overlay track should be used instead. The order of multiple TrackOverlay matters, the first one is the one that should be used. If not found it should be the second, etc."},170:{name:"CodecDecodeAll",level:3,type:"u",mandatory:!0,minver:2,webm:!1,default:1,range:"0-1",description:"The codec can decode potentially damaged data (1 bit)."},2536e3:{name:"CodecDownloadURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to download about the codec used."},3883072:{name:"CodecInfoURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to find information about the codec used."},3839639:{name:"CodecSettings",level:3,type:"8",webm:!1,description:"A string describing the encoding setting used."},25506:{name:"CodecPrivate",level:3,type:"b",minver:1,description:"Private data only known to the codec."},2274716:{name:"Language",cppname:"TrackLanguage",level:3,type:"s",minver:1,default:"eng",description:"Specifies the language of the track in the Matroska languages form."},21358:{name:"Name",cppname:"TrackName",level:3,type:"8",minver:1,description:"A human-readable track name."},21998:{name:"MaxBlockAdditionID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The maximum value of BlockAdditions for this track."},21375:{name:"TrackOffset",level:3,type:"i",webm:!1,default:0,description:"A value to add to the Block's Timestamp. This can be used to adjust the playback offset of a track."},2306383:{name:"TrackTimecodeScale",level:3,type:"f",mandatory:!0,minver:1,maxver:"3",webm:!1,default:1,range:"> 0",description:"DEPRECATED, DO NOT USE. The scale to apply on this track to work at normal speed in relation with other tracks (mostly used to adjust video speed when the audio length differs)."},2313850:{name:"DefaultDecodedFieldDuration",cppname:"TrackDefaultDecodedFieldDuration",level:3,type:"u",minver:4,range:"not 0",description:"The period in nanoseconds (not scaled by TimcodeScale)\nbetween two successive fields at the output of the decoding process (see the notes)"},2352003:{name:"DefaultDuration",cppname:"TrackDefaultDuration",level:3,type:"u",minver:1,range:"not 0",description:"Number of nanoseconds (not scaled via TimecodeScale) per frame ('frame' in the Matroska sense -- one element put into a (Simple)Block)."},28152:{name:"MaxCache",cppname:"TrackMaxCache",level:3,type:"u",minver:1,webm:!1,description:"The maximum cache size required to store referenced frames in and the current frame. 0 means no cache is needed."},28135:{name:"MinCache",cppname:"TrackMinCache",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The minimum number of frames a player should be able to cache during playback. If set to 0, the reference pseudo-cache system is not used."},156:{name:"FlagLacing",cppname:"TrackFlagLacing",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if the track may contain blocks using lacing. (1 bit)"},21930:{name:"FlagForced",cppname:"TrackFlagForced",level:3,type:"u",mandatory:!0,minver:1,default:0,range:"0-1",description:"Set if that track MUST be active during playback. There can be many forced track for a kind (audio, video or subs), the player should select the one which language matches the user preference or the default + forced track. Overlay MAY happen between a forced and non-forced track of the same kind. (1 bit)"},185:{name:"FlagEnabled",cppname:"TrackFlagEnabled",level:3,type:"u",mandatory:!0,minver:2,webm:!0,default:1,range:"0-1",description:"Set if the track is usable. (1 bit)"},29637:{name:"TrackUID",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"A unique ID to identify the Track. This should be kept the same when making a direct stream copy of the Track to another file."},215:{name:"TrackNumber",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track number as used in the Block Header (using more than 127 tracks is not encouraged, though the design allows an unlimited number)."},174:{name:"TrackEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Describes a track with all elements."},374648427:{name:"Tracks",level:1,type:"m",multiple:!0,minver:1,description:"A top-level block of information with many tracks described."},175:{name:"EncryptedBlock",level:2,type:"b",multiple:!0,webm:!1,description:"Similar to EncryptedBlock Structure)"},202:{name:"ReferenceTimeCode",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},201:{name:"ReferenceOffset",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},200:{name:"ReferenceFrame",level:3,type:"m",multiple:!1,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},207:{name:"SliceDuration",level:5,type:"u",default:0,description:"The (scaled) duration to apply to the element."},206:{name:"Delay",cppname:"SliceDelay",level:5,type:"u",default:0,description:"The (scaled) delay to apply to the element."},203:{name:"BlockAdditionID",cppname:"SliceBlockAddID",level:5,type:"u",default:0,description:"The ID of the BlockAdditional element (0 is the main Block)."},205:{name:"FrameNumber",cppname:"SliceFrameNumber",level:5,type:"u",default:0,description:"The number of the frame to generate from this lace with this delay (allow you to generate many frames from the same Block/Frame)."},204:{name:"LaceNumber",cppname:"SliceLaceNumber",level:5,type:"u",minver:1,default:0,divx:!1,description:"The reverse number of the frame in the lace (0 is the last frame, 1 is the next to last, etc). While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},232:{name:"TimeSlice",level:4,type:"m",multiple:!0,minver:1,divx:!1,description:"Contains extra time information about the data contained in the Block. While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},142:{name:"Slices",level:3,type:"m",minver:1,divx:!1,description:"Contains slices description."},30114:{name:"DiscardPadding",level:3,type:"i",minver:4,webm:!0,description:"Duration in nanoseconds of the silent data added to the Block (padding at the end of the Block for positive value, at the beginning of the Block for negative value). The duration of DiscardPadding is not calculated in the duration of the TrackEntry and should be discarded during playback."},164:{name:"CodecState",level:3,type:"b",minver:2,webm:!1,description:"The new codec state to use. Data interpretation is private to the codec. This information should always be referenced by a seek entry."},253:{name:"ReferenceVirtual",level:3,type:"i",webm:!1,description:"Relative position of the data that should be in position of the virtual block."},251:{name:"ReferenceBlock",level:3,type:"i",multiple:!0,minver:1,description:"Timestamp of another frame used as a reference (ie: B or P frame). The timestamp is relative to the block it's attached to."},250:{name:"ReferencePriority",cppname:"FlagReferenced",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"This frame is referenced and has the specified cache priority. In cache only a frame of the same or higher priority can replace this frame. A value of 0 means the frame is not referenced."},155:{name:"BlockDuration",level:3,type:"u",minver:1,default:"TrackDuration",description:'The duration of the Block (based on TimecodeScale). This element is mandatory when DefaultDuration is set for the track (but can be omitted as other default values). When not written and with no DefaultDuration, the value is assumed to be the difference between the timestamp of this Block and the timestamp of the next Block in "display" order (not coding order). This element can be useful at the end of a Track (as there is not other Block available), or when there is a break in a track like for subtitle tracks. When set to 0 that means the frame is not a keyframe.'},165:{name:"BlockAdditional",level:5,type:"b",mandatory:!0,minver:1,webm:!1,description:"Interpreted by the codec as it wishes (using the BlockAddID)."},238:{name:"BlockAddID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"An ID to identify the BlockAdditional level."},166:{name:"BlockMore",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contain the BlockAdditional and some parameters."},30113:{name:"BlockAdditions",level:3,type:"m",minver:1,webm:!1,description:"Contain additional blocks to complete the main one. An EBML parser that has no knowledge of the Block structure could still see and use/skip these data."},162:{name:"BlockVirtual",level:3,type:"b",webm:!1,description:"A Block with no data. It must be stored in the stream at the place the real Block should be in display order. (see Block Virtual)"},161:{name:"Block",level:3,type:"b",mandatory:!0,minver:1,description:"Block containing the actual data to be rendered and a timestamp relative to the Cluster Timecode. (see Block Structure)"},160:{name:"BlockGroup",level:2,type:"m",multiple:!0,minver:1,description:"Basic container of information containing a single Block or BlockVirtual, and information specific to that Block/VirtualBlock."},163:{name:"SimpleBlock",level:2,type:"b",multiple:!0,minver:2,webm:!0,divx:!0,description:"Similar to SimpleBlock Structure"},171:{name:"PrevSize",cppname:"ClusterPrevSize",level:2,type:"u",minver:1,description:"Size of the previous Cluster, in octets. Can be useful for backward playing.",position:"prevCluster"},167:{name:"Position",cppname:"ClusterPosition",level:2,type:"u",minver:1,webm:!1,description:"The Position of the Cluster in the segment (0 in live broadcast streams). It might help to resynchronise offset on damaged streams.",position:"segment"},22743:{name:"SilentTrackNumber",cppname:"ClusterSilentTrackNumber",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"One of the track number that are not used from now on in the stream. It could change later if not specified as silent in a further Cluster."},231:{name:"Timecode",cppname:"ClusterTimecode",level:2,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp of the cluster (based on TimecodeScale)."},524531317:{name:"Cluster",level:1,type:"m",multiple:!0,minver:1,description:"The lower level element containing the (monolithic) Block structure."},19840:{name:"MuxingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Muxing application or library ("libmatroska-0.4.3").'},31657:{name:"Title",level:2,type:"8",minver:1,webm:!1,description:"General name of the segment."},2807730:{name:"TimecodeScaleDenominator",level:2,type:"u",mandatory:!0,minver:4,default:"1000000000",description:"Timestamp scale numerator, see TimecodeScale."},2807729:{name:"TimecodeScale",level:2,type:"u",mandatory:!0,minver:1,default:"1000000",description:"Timestamp scale in nanoseconds (1.000.000 means all timestamps in the segment are expressed in milliseconds)."},27045:{name:"ChapterTranslateID",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this segment in the chapter codec data. The format depends on the ChapProcessCodecID used."},27071:{name:"ChapterTranslateCodec",level:3,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},27132:{name:"ChapterTranslateEditionUID",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this correspondance applies. When not specified, it means for all editions found in the segment."},4096955:{name:"NextFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the next segment."},4110627:{name:"NextUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the next chained segment (128 bits)."},3965867:{name:"PrevFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the previous segment."},3979555:{name:"PrevUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the previous chained segment (128 bits)."},29604:{name:"SegmentUID",level:2,type:"b",minver:1,webm:!1,range:"not 0",bytesize:16,description:"A randomly generated unique ID to identify the current segment between many others (128 bits)."},357149030:{name:"Info",level:1,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains miscellaneous general information and statistics on the file."},21420:{name:"SeekPosition",level:3,type:"u",mandatory:!0,minver:1,description:"The position of the element in the segment in octets (0 = first level 1 element).",position:"segment"},21419:{name:"SeekID",level:3,type:"b",mandatory:!0,minver:1,description:"The binary ID corresponding to the element name.",type2:"ebmlID"},19899:{name:"Seek",cppname:"SeekPoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains a single seek entry to an EBML element."},290298740:{name:"SeekHead",cppname:"SeekHeader",level:1,type:"m",multiple:!0,minver:1,description:"Contains the position of other level 1 elements."},32379:{name:"SignatureElementList",level:2,type:"m",multiple:!0,webm:!1,i:"Cluster|Block|BlockAdditional",description:"A list consists of a number of consecutive elements that represent one case where data is used in signature. Ex:  means that the BlockAdditional of all Blocks in all Clusters is used for encryption."},32347:{name:"SignatureElements",level:1,type:"m",webm:!1,description:"Contains elements that will be used to compute the signature."},32437:{name:"Signature",level:1,type:"b",webm:!1,description:"The signature of the data (until a new."},32421:{name:"SignaturePublicKey",level:1,type:"b",webm:!1,description:"The public key to use with the algorithm (in the case of a PKI-based signature)."},32410:{name:"SignatureHash",level:1,type:"u",webm:!1,description:"Hash algorithm used (1=SHA1-160, 2=MD5)."},32394:{name:"SignatureAlgo",level:1,type:"u",webm:!1,description:"Signature algorithm used (1=RSA, 2=elliptic)."},458458727:{name:"SignatureSlot",level:-1,type:"m",multiple:!0,webm:!1,description:"Contain signature of some (coming) elements in the stream."},191:{name:"CRC-32",level:-1,type:"b",minver:1,webm:!1,description:"The CRC is computed on all the data of the Master element it's in. The CRC element should be the first in it's parent master for easier reading. All level 1 elements should include a CRC-32. The CRC in use is the IEEE CRC32 Little Endian",crc:!0},236:{name:"Void",level:-1,type:"b",minver:1,description:"Used to void damaged data, to avoid unexpected behaviors when using damaged data. The content is discarded. Also used to reserve space in a sub-element for later use."},17139:{name:"EBMLMaxSizeLength",level:1,type:"u",mandatory:!0,default:8,minver:1,description:"The maximum length of the sizes you'll find in this file (8 or less in Matroska). This does not override the element size indicated at the beginning of an element. Elements that have an indicated size which is larger than what is allowed by EBMLMaxSizeLength shall be considered invalid."},17138:{name:"EBMLMaxIDLength",level:1,type:"u",mandatory:!0,default:4,minver:1,description:"The maximum length of the IDs you'll find in this file (4 or less in Matroska)."},17143:{name:"EBMLReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum EBML version a parser has to support to read this file."},440786851:{name:"EBML",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"Set the EBML characteristics of the data to follow. Each EBML document has to start with this."}},byName={},schema={byEbmlID:byEbmlID,byName:byName};for(var ebmlID in byEbmlID)byName[byEbmlID[ebmlID].name.replace("-","_")]=parseInt(ebmlID,10);module.exports=schema},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var settings_service_1=__webpack_require__(5),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),contact_service_1=__webpack_require__(1),logger_service_1=__webpack_require__(15),errorHelper_service_1=__webpack_require__(37),event_service_1=__webpack_require__(32),invitation_model_1=__webpack_require__(412),rxjs_1=__webpack_require__(10),moment=__webpack_require__(3),InvitationService=function(){function InvitationService(){_classCallCheck(this,InvitationService),this.logger=logger_service_1.default,this.authService=auth_service_1.default,this.xmppService=xmpp_service_1.default,this.contactService=contact_service_1.default,this.settingsService=settings_service_1.default,this.errorHelperService=errorHelper_service_1.default,this.eventService=event_service_1.default,this.subscription=null,this.xmppHandler=null,this.rxSubject=new rxjs_1.Subject,this.portalURL=null,this.receivedInvitations={},this.sentInvitations={},this.acceptedInvitationsArray=[],this.sentInvitationsArray=[],this.receivedInvitationsArray=[]}return _createClass(InvitationService,[{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee159(){var _this136=this;return regenerator_default.a.wrap((function(_context160){for(;;)switch(_context160.prev=_context160.next){case 0:this.logger.info(""),this.logger.info("[invitationService] === STARTING ==="),this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/",this.attachHandlers(),this.getAllSentInvitations(),this.getAllReceivedInvitations(),this.logger.info("[invitationService] === STARTED ==="),this.subscription=this.xmppService.subscribeToContactEvents((function(event){"ON_ROSTER_CHANGED_EVENT"===event.name&&_this136.getAllSentInvitations()}));case 1:case"end":return _context160.stop()}}),_callee159,this)})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee160(){return regenerator_default.a.wrap((function(_context161){for(;;)switch(_context161.prev=_context161.next){case 0:this.logger.info(""),this.logger.info("[invitationService] === STOPPING ==="),this.subscription&&this.subscription.unsubscribe(),this.logger.info("[invitationService] === STOPPED ===");case 1:case"end":return _context161.stop()}}),_callee160,this)})))}},{key:"subscribe",value:function(callback){return this.rxSubject.subscribe(callback)}},{key:"sendEvent",value:function(type){var value=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next({type:type,value:value}),this.eventService.publish(type,value)}},{key:"attachHandlers",value:function(){var _this137=this;this.logger.info("[invitationService] attachHandlers"),this.xmppHandler&&(xmpp_service_1.default.connection.deleteHandler(this.xmppHandler),this.xmppHandler=null),this.xmppHandler=xmpp_service_1.default.connection.addHandler((function(stanza){return _this137.onInvitationsUpdate(stanza)}),null,"message","management")}},{key:"onInvitationsUpdate",value:function(stanza){var userInviteElem=$(stanza).find("userinvite");if(userInviteElem.length){var id=userInviteElem.attr("id"),type=userInviteElem.attr("type"),action=userInviteElem.attr("action");switch(type){case"received":this.handleReceivedInvitation(id,action);break;case"sent":this.handleSentInvitation(id,action);break;default:this.logger.warn("[invitationService] onInvitationsUpdate - received unexpected type - "+type)}}return!0}},{key:"handleReceivedInvitation",value:function(id,action){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee161(){var invitation,updateInvitation,status,contact,_contact;return regenerator_default.a.wrap((function(_context162){for(;;)switch(_context162.prev=_context162.next){case 0:if(this.logger.info("[invitationService] handleReceivedInvitation"),"delete"!==action){_context162.next=2;break}return _context162.abrupt("return",(delete this.receivedInvitations[id],void this.updateReceivedInvitationsArray()));case 2:return _context162.next=4,this.getServerInvitation(id);case 4:invitation=_context162.sent,updateInvitation=null,status="none",_context162.t0=invitation.status,_context162.next="pending"===_context162.t0?9:"accepted"===_context162.t0||"auto-accepted"===_context162.t0?15:21;break;case 9:if(this.receivedInvitations[invitation.id]=invitation,updateInvitation=invitation,status="ask",!invitation.invitingUserId){_context162.next=14;break}return _context162.next=12,this.contactService.getContactByDBId(invitation.invitingUserId,!0);case 12:contact=_context162.sent,this.sendEvent("ON_INVITATION_RECEIVED",contact);case 14:return _context162.abrupt("break",22);case 15:if(this.receivedInvitations[invitation.id]=invitation,this.sendEvent("ON_INVITATION_ACCEPTED",invitation.invitingUserId),!invitation.invitingUserId){_context162.next=20;break}return _context162.next=18,this.contactService.getContactByDBId(invitation.invitingUserId,!0);case 18:_contact=_context162.sent,this.eventService.publish("ON_CONTACT_UPDATED_EVENT",_contact);case 20:return _context162.abrupt("break",22);case 21:delete this.receivedInvitations[invitation.id],status="unknown";case 22:if(_context162.t1=invitation.invitingUserId,!_context162.t1){_context162.next=26;break}return _context162.next=26,this.updateContactInvitationStatus(invitation.invitingUserId,status,updateInvitation);case 26:this.updateReceivedInvitationsArray(),this.sendEvent("ON_INVITATION_CHANGED",invitation);case 28:case"end":return _context162.stop()}}),_callee161,this)})))}},{key:"handleSentInvitation",value:function(id,action){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee162(){var invitation,contactStatus,contact;return regenerator_default.a.wrap((function(_context163){for(;;)switch(_context163.prev=_context163.next){case 0:if(this.logger.info("[invitationService] handleSentInvitation"),"delete"!==action){_context163.next=2;break}return _context163.abrupt("return",(delete this.sentInvitations[id],void this.updateReceivedInvitationsArray()));case 2:return _context163.next=4,this.getServerInvitation(id);case 4:invitation=_context163.sent,contactStatus=null,_context163.t0=invitation.status,_context163.next="pending"===_context163.t0?9:"accepted"===_context163.t0||"auto-accepted"===_context163.t0?11:17;break;case 9:return this.sentInvitations[invitation.id]=invitation,contactStatus="wait",_context163.abrupt("break",18);case 11:if(this.sendEvent("ON_INVITATION_ACCEPTED",invitation.invitedUserId),!invitation.invitedUserId){_context163.next=16;break}return _context163.next=14,this.contactService.getContactByDBId(invitation.invitedUserId,!0);case 14:contact=_context163.sent,this.eventService.publish("ON_CONTACT_UPDATED_EVENT",contact);case 16:return _context163.abrupt("break",18);case 17:delete this.sentInvitations[invitation.id],contactStatus="unknown";case 18:if(_context163.t1=invitation.invitedUserId,!_context163.t1){_context163.next=22;break}return _context163.next=22,this.updateContactInvitationStatus(invitation.invitedUserId,contactStatus,invitation);case 22:this.updateSentInvitationsArray(),"resend"===action&&this.sendEvent("ON_INVITATIONS_RE_SEND",id);case 24:case"end":return _context163.stop()}}),_callee162,this)})))}},{key:"updateReceivedInvitationsArray",value:function(){for(var key in this.receivedInvitationsArray=[],this.acceptedInvitationsArray=[],this.receivedInvitations)if(this.receivedInvitations.hasOwnProperty(key)){var invitation=this.receivedInvitations[key];switch(invitation.status){case"pending":this.receivedInvitationsArray.push(invitation);break;case"accepted":case"auto-accepted":this.acceptedInvitationsArray.push(invitation)}}this.receivedInvitationsArray.sort(this.sortInvitationArray),this.acceptedInvitationsArray=this.acceptedInvitationsArray.filter((function(acceptedInvitation){var lastInvite=moment(acceptedInvitation.lastNotificationDate);return moment.duration(moment().diff(lastInvite)).asHours()<168})),this.acceptedInvitationsArray.sort(this.sortInvitationArray),this.sendEvent("ON_INVITATIONS_NUMBER_UPDATED")}},{key:"updateSentInvitationsArray",value:function(){for(var key in this.sentInvitationsArray=[],this.sentInvitations)this.sentInvitations.hasOwnProperty(key)&&this.sentInvitationsArray.push(this.sentInvitations[key]);this.sentInvitationsArray.sort(this.sortInvitationArray),this.sendEvent("ON_INVITATIONS_NUMBER_UPDATED")}},{key:"getServerInvitation",value:function(invitationId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee163(){var url,headers,response,invitationData,errorInfo;return regenerator_default.a.wrap((function(_context164){for(;;)switch(_context164.prev=_context164.next){case 0:return _context164.prev=0,url="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations/").concat(invitationId),headers=this.authService.getRequestHeader(),_context164.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context164.sent).ok){_context164.next=8;break}throw response;case 8:return _context164.next=10,response.json();case 10:return invitationData=_context164.sent.data,_context164.abrupt("return",(this.logger.info("[invitationService] getServerInvitation success"),invitation_model_1.Invitation.createFromData(invitationData)));case 14:return _context164.prev=14,_context164.t0=_context164.catch(0),_context164.next=18,this.errorHelperService.getErrorInfo(_context164.t0,"getServerInvitation");case 18:throw errorInfo=_context164.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 20:case"end":return _context164.stop()}}),_callee163,this,[[0,14]])})))}},{key:"getReceivedInvitations",value:function(){return this.receivedInvitationsArray}},{key:"getAcceptedInvitations",value:function(){return this.acceptedInvitationsArray}},{key:"getSentInvitations",value:function(){return this.sentInvitationsArray}},{key:"getInvitationsNumberForCounter",value:function(){return this.receivedInvitationsArray.length}},{key:"getAllInvitationsNumber",value:function(){return this.receivedInvitationsArray.length+this.sentInvitationsArray.length+this.acceptedInvitationsArray.length}},{key:"getInvitation",value:function(invitationId){var invitationFound=this.receivedInvitations[invitationId];return invitationFound||(invitationFound=this.acceptedInvitationsArray[invitationId]),invitationFound||(invitationFound=this.sentInvitations[invitationId]),invitationFound}},{key:"joinContactInvitation",value:function(contact){var customMessage=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee164(){var url,headers,data,response,errorInfo;return regenerator_default.a.wrap((function(_context165){for(;;)switch(_context165.prev=_context165.next){case 0:return _context165.prev=0,this.logger.info("[invitationService] joinContactInvitation contact (".concat(contact.jid,")")),url="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations"),headers=this.authService.getPostHeader(),data={invitedUserId:contact.dbId,customMessage:customMessage},_context165.next=7,fetch(url,{method:"POST",headers:headers,body:JSON.stringify(data)});case 7:if((response=_context165.sent).ok){_context165.next=10;break}throw response;case 10:this.logger.info("[invitationService] joinContactInvitation - success (".concat(contact.jid,")")),"unknown"===contact.status&&this.updateContactInvitationStatus(contact.dbId,"wait"),_context165.next=19;break;case 13:return _context165.prev=13,_context165.t0=_context165.catch(0),_context165.next=17,this.errorHelperService.getErrorInfo(_context165.t0,"joinContactInvitation");case 17:throw errorInfo=_context165.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 19:case"end":return _context165.stop()}}),_callee164,this,[[0,13]])})))}},{key:"sendInvitationByEmail",value:function(email){var customMessage=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee165(){var lang,url,headers,data,response,errorInfo;return regenerator_default.a.wrap((function(_context166){for(;;)switch(_context166.prev=_context166.next){case 0:return _context166.prev=0,this.logger.info("[invitationService] sendInvitationByEmail"),lang=this.settingsService.getAppliLanguageCodeForServer(),url="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations"),headers=this.authService.getPostHeader(),data={email:email,lang:lang,customMessage:customMessage},_context166.next=8,fetch(url,{method:"POST",headers:headers,body:JSON.stringify(data)});case 8:if((response=_context166.sent).ok){_context166.next=11;break}throw response;case 11:this.logger.info("[invitationService] sendInvitationByEmail - success"),_context166.next=20;break;case 14:return _context166.prev=14,_context166.t0=_context166.catch(0),_context166.next=18,this.errorHelperService.getErrorInfo(_context166.t0,"sendInvitationByEmail");case 18:throw errorInfo=_context166.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 20:case"end":return _context166.stop()}}),_callee165,this,[[0,14]])})))}},{key:"cancelOneSendInvitation",value:function(invitation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee166(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context167){for(;;)switch(_context167.prev=_context167.next){case 0:return _context167.prev=0,url="".concat(this.portalURL).concat(invitation.invitingUserId,"/invitations/").concat(invitation.id,"/cancel"),headers=this.authService.getPostHeader(),_context167.next=5,fetch(url,{method:"POST",headers:headers});case 5:if((response=_context167.sent).ok){_context167.next=8;break}throw response;case 8:this.logger.info("[invitationService] cancelOneSendInvitation success"),_context167.next=17;break;case 11:return _context167.prev=11,_context167.t0=_context167.catch(0),_context167.next=15,this.errorHelperService.getErrorInfo(_context167.t0,"cancelOneSendInvitation");case 15:throw errorInfo=_context167.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 17:case"end":return _context167.stop()}}),_callee166,this,[[0,11]])})))}},{key:"reSendInvitation",value:function(invitationId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee167(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context168){for(;;)switch(_context168.prev=_context168.next){case 0:return _context168.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/invitations/").concat(invitationId,"/re-send"),headers=this.authService.getPostHeader(),_context168.next=5,fetch(url,{method:"POST",headers:headers});case 5:if((response=_context168.sent).ok){_context168.next=8;break}throw response;case 8:this.logger.info("[invitationService] reSendInvitation ".concat(invitationId," success")),_context168.next=17;break;case 11:return _context168.prev=11,_context168.t0=_context168.catch(0),_context168.next=15,this.errorHelperService.getErrorInfo(_context168.t0,"reSendInvitation");case 15:throw errorInfo=_context168.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 17:case"end":return _context168.stop()}}),_callee167,this,[[0,11]])})))}},{key:"sendInvitationsParBulk",value:function(emails){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee168(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context169){for(;;)switch(_context169.prev=_context169.next){case 0:if(emails.length&&!(emails.length>100)){_context169.next=2;break}throw this.logger.error("[invitationService] sendInvitationsParBulk mail list length not correct"),new Error("sendInvitationsParBulk mail list length not correct");case 2:return _context169.prev=2,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/invitations/bulk"),headers=this.authService.getPostHeader(),_context169.next=7,fetch(url,{method:"POST",headers:headers,body:JSON.stringify({emails:emails})});case 7:if((response=_context169.sent).ok){_context169.next=10;break}throw response;case 10:this.logger.info("[invitationService] sendInvitationsParBulk - success"),_context169.next=19;break;case 13:return _context169.prev=13,_context169.t0=_context169.catch(2),_context169.next=17,this.errorHelperService.getErrorInfo(_context169.t0,"sendInvitationsParBulk");case 17:throw errorInfo=_context169.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 19:case"end":return _context169.stop()}}),_callee168,this,[[2,13]])})))}},{key:"acceptInvitation",value:function(invitation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee169(){var url,headers,response,errorInfo,contact;return regenerator_default.a.wrap((function(_context170){for(;;)switch(_context170.prev=_context170.next){case 0:return _context170.prev=0,url="".concat(this.portalURL).concat(invitation.invitedUserId,"/invitations/").concat(invitation.id,"/accept"),headers=this.authService.getPostHeader(),_context170.next=5,fetch(url,{method:"POST",headers:headers});case 5:if((response=_context170.sent).ok){_context170.next=8;break}throw response;case 8:this.logger.info("[invitationService] acceptInvitation success"),_context170.next=22;break;case 11:return _context170.prev=11,_context170.t0=_context170.catch(0),_context170.next=15,this.errorHelperService.getErrorInfo(_context170.t0,"acceptInvitation");case 15:if((errorInfo=_context170.sent).error.errorDetailsCode&&409605===errorInfo.error.errorDetailsCode){_context170.next=18;break}throw this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 18:return _context170.next=20,this.contactService.getContactByDBId(invitation.invitingUserId,!0);case 20:contact=_context170.sent,this.eventService.publish("ON_CONTACT_UPDATED_EVENT",contact);case 22:case"end":return _context170.stop()}}),_callee169,this,[[0,11]])})))}},{key:"declineInvitation",value:function(invitation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee170(){var url,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context171){for(;;)switch(_context171.prev=_context171.next){case 0:return _context171.prev=0,url="".concat(this.portalURL).concat(invitation.invitedUserId,"/invitations/").concat(invitation.id,"/decline"),headers=this.authService.getPostHeader(),_context171.next=5,fetch(url,{method:"POST",headers:headers});case 5:if((response=_context171.sent).ok){_context171.next=8;break}throw response;case 8:this.logger.info("[invitationService] declineInvitation success"),_context171.next=17;break;case 11:return _context171.prev=11,_context171.t0=_context171.catch(0),_context171.next=15,this.errorHelperService.getErrorInfo(_context171.t0,"declineInvitation");case 15:throw errorInfo=_context171.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 17:case"end":return _context171.stop()}}),_callee170,this,[[0,11]])})))}},{key:"updateContactInvitationStatus",value:function(contactDBId,status){var invitation=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee171(){var contact;return regenerator_default.a.wrap((function(_context172){for(;;)switch(_context172.prev=_context172.next){case 0:return _context172.next=2,this.contactService.getContactByDBId(contactDBId);case 2:contact=_context172.sent,_context172.t0=status,_context172.next="ask"===_context172.t0?6:"wait"===_context172.t0?8:10;break;case 6:return contact.status="unknown",contact.ask="ask",contact.invitation=invitation,_context172.abrupt("break",11);case 8:return contact.status="wait",contact.ask="subscribe",contact.invitation=invitation,_context172.abrupt("break",11);case 10:contact.ask="none",contact.invitation=null;case 11:this.contactService.updateContactRichStatus(contact),contact.rxSubject.next({name:"update",data:contact});case 12:case"end":return _context172.stop()}}),_callee171,this)})))}},{key:"sortInvitationArray",value:function(invitA,invitB){return new Date(invitB.lastNotificationDate).getTime()-new Date(invitA.lastNotificationDate).getTime()}},{key:"getAllReceivedInvitations",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee172(){var url,headers,response,invitationsData,errorInfo,_this138=this;return regenerator_default.a.wrap((function(_context173){for(;;)switch(_context173.prev=_context173.next){case 0:return _context173.prev=0,url="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations/received?format=full&status=pending&limit=500"),headers=this.authService.getRequestHeader(),_context173.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context173.sent).ok){_context173.next=8;break}throw response;case 8:return _context173.next=10,response.json();case 10:return invitationsData=_context173.sent.data,_context173.abrupt("return",(this.logger.info("[invitationService] getAllReceivedInvitations success (find ".concat(invitationsData.length," invitations)")),this.receivedInvitations={},invitationsData.forEach((function(invitationData){if("pending"===invitationData.status&&"registration"!==invitationData.type){var invitation=invitation_model_1.Invitation.createFromData(invitationData);_this138.receivedInvitations[invitationData.id]=invitation,invitationData.invitingUserId&&_this138.updateContactInvitationStatus(invitationData.invitingUserId,"ask",invitation)}else"accepted"!==invitationData.status&&"auto-accepted"!==invitationData.status||(_this138.receivedInvitations[invitationData.id]=invitation_model_1.Invitation.createFromData(invitationData))})),this.updateReceivedInvitationsArray(),this.receivedInvitations));case 14:return _context173.prev=14,_context173.t0=_context173.catch(0),_context173.next=18,this.errorHelperService.getErrorInfo(_context173.t0,"getAllReceivedInvitations");case 18:throw errorInfo=_context173.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 20:case"end":return _context173.stop()}}),_callee172,this,[[0,14]])})))}},{key:"getAllSentInvitations",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee173(){var url,headers,response,invitationsData,errorInfo,_this139=this;return regenerator_default.a.wrap((function(_context174){for(;;)switch(_context174.prev=_context174.next){case 0:return _context174.prev=0,url="".concat(this.portalURL).concat(this.contactService.userContact.dbId,"/invitations/sent?format=full&status=pending&limit=500"),headers=this.authService.getRequestHeader(),_context174.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context174.sent).ok){_context174.next=8;break}throw response;case 8:return _context174.next=10,response.json();case 10:return invitationsData=_context174.sent.data,_context174.abrupt("return",(this.logger.info("[invitationService] getAllSentInvitations success (find "+invitationsData.length+" invitations)"),this.sentInvitations={},invitationsData.forEach((function(invitationData){if("pending"===invitationData.status&&!invitationData.inviteToJoinMeeting){var sentInvitation=invitation_model_1.Invitation.createFromData(invitationData);_this139.sentInvitations[invitationData.id]=sentInvitation,void 0!==sentInvitation.invitedUserId&&_this139.updateContactInvitationStatus(sentInvitation.invitedUserId,"wait",sentInvitation)}})),this.updateSentInvitationsArray(),this.sentInvitations));case 14:return _context174.prev=14,_context174.t0=_context174.catch(0),_context174.next=18,this.errorHelperService.getErrorInfo(_context174.t0,"getAllSentInvitations");case 18:throw errorInfo=_context174.sent,this.logger.error("[invitationService] "+errorInfo.message),errorInfo.error;case 20:case"end":return _context174.stop()}}),_callee173,this,[[0,14]])})))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.invitationService||(win.rainbow.invitationService=new InvitationService),win.rainbow.invitationService}}]),InvitationService}();exports.InvitationService=InvitationService,exports.default=InvitationService.getInstance()},function(module,exports,__webpack_require__){var SDPUtils=__webpack_require__(52);function writeMediaSection(transceiver,caps,type,stream,dtlsRole){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);if(sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters()),sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),"offer"===type?"actpass":dtlsRole||"active"),sdp+="a=mid:"+transceiver.mid+"\r\n",transceiver.rtpSender&&transceiver.rtpReceiver?sdp+="a=sendrecv\r\n":transceiver.rtpSender?sdp+="a=sendonly\r\n":transceiver.rtpReceiver?sdp+="a=recvonly\r\n":sdp+="a=inactive\r\n",transceiver.rtpSender){var trackId=transceiver.rtpSender._initialTrackId||transceiver.rtpSender.track.id;transceiver.rtpSender._initialTrackId=trackId;var msid="msid:"+(stream?stream.id:"-")+" "+trackId+"\r\n";sdp+="a="+msid,sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid,transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid,sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n",transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"),sdp}function getCommonCapabilities(localCapabilities,remoteCapabilities){var commonCapabilities={codecs:[],headerExtensions:[],fecMechanisms:[]},findCodecByPayloadType=function(pt,codecs){pt=parseInt(pt,10);for(var i=0;i<codecs.length;i++)if(codecs[i].payloadType===pt||codecs[i].preferredPayloadType===pt)return codecs[i]},rtxCapabilityMatches=function(lRtx,rRtx,lCodecs,rCodecs){var lCodec=findCodecByPayloadType(lRtx.parameters.apt,lCodecs),rCodec=findCodecByPayloadType(rRtx.parameters.apt,rCodecs);return lCodec&&rCodec&&lCodec.name.toLowerCase()===rCodec.name.toLowerCase()};return localCapabilities.codecs.forEach((function(lCodec){for(var i=0;i<remoteCapabilities.codecs.length;i++){var rCodec=remoteCapabilities.codecs[i];if(lCodec.name.toLowerCase()===rCodec.name.toLowerCase()&&lCodec.clockRate===rCodec.clockRate){if("rtx"===lCodec.name.toLowerCase()&&lCodec.parameters&&rCodec.parameters.apt&&!rtxCapabilityMatches(lCodec,rCodec,localCapabilities.codecs,remoteCapabilities.codecs))continue;(rCodec=JSON.parse(JSON.stringify(rCodec))).numChannels=Math.min(lCodec.numChannels,rCodec.numChannels),commonCapabilities.codecs.push(rCodec),rCodec.rtcpFeedback=rCodec.rtcpFeedback.filter((function(fb){for(var j=0;j<lCodec.rtcpFeedback.length;j++)if(lCodec.rtcpFeedback[j].type===fb.type&&lCodec.rtcpFeedback[j].parameter===fb.parameter)return!0;return!1}));break}}})),localCapabilities.headerExtensions.forEach((function(lHeaderExtension){for(var i=0;i<remoteCapabilities.headerExtensions.length;i++){var rHeaderExtension=remoteCapabilities.headerExtensions[i];if(lHeaderExtension.uri===rHeaderExtension.uri){commonCapabilities.headerExtensions.push(rHeaderExtension);break}}})),commonCapabilities}function isActionAllowedInSignalingState(action,type,signalingState){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[type][action].indexOf(signalingState)}function maybeAddCandidate(iceTransport,candidate){var alreadyAdded=iceTransport.getRemoteCandidates().find((function(remoteCandidate){return candidate.foundation===remoteCandidate.foundation&&candidate.ip===remoteCandidate.ip&&candidate.port===remoteCandidate.port&&candidate.priority===remoteCandidate.priority&&candidate.protocol===remoteCandidate.protocol&&candidate.type===remoteCandidate.type}));return alreadyAdded||iceTransport.addRemoteCandidate(candidate),!alreadyAdded}function makeError(name,description){var e=new Error(description);return e.name=name,e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[name],e}module.exports=function(window,edgeVersion){function addTrackToStreamAndFireEvent(track,stream){stream.addTrack(track),stream.dispatchEvent(new window.MediaStreamTrackEvent("addtrack",{track:track}))}function fireAddTrack(pc,track,receiver,streams){var trackEvent=new Event("track");trackEvent.track=track,trackEvent.receiver=receiver,trackEvent.transceiver={receiver:receiver},trackEvent.streams=streams,window.setTimeout((function(){pc._dispatchEvent("track",trackEvent)}))}var RTCPeerConnection=function(config){var pc=this,_eventTarget=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(method){pc[method]=_eventTarget[method].bind(_eventTarget)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",config=JSON.parse(JSON.stringify(config||{})),this.usingBundle="max-bundle"===config.bundlePolicy,"negotiate"===config.rtcpMuxPolicy)throw makeError("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(config.rtcpMuxPolicy||(config.rtcpMuxPolicy="require"),config.iceTransportPolicy){case"all":case"relay":break;default:config.iceTransportPolicy="all"}switch(config.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:config.bundlePolicy="balanced"}if(config.iceServers=function(iceServers,edgeVersion){var hasTurn=!1;return(iceServers=JSON.parse(JSON.stringify(iceServers))).filter((function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;server.url&&!server.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var isString="string"==typeof urls;return isString&&(urls=[urls]),urls=urls.filter((function(url){return 0!==url.indexOf("turn:")||-1===url.indexOf("transport=udp")||-1!==url.indexOf("turn:[")||hasTurn?0===url.indexOf("stun:")&&edgeVersion>=14393&&-1===url.indexOf("?transport=udp"):(hasTurn=!0,!0)})),delete server.url,server.urls=isString?urls[0]:urls,!!urls.length}}))}(config.iceServers||[],edgeVersion),this._iceGatherers=[],config.iceCandidatePoolSize)for(var i=config.iceCandidatePoolSize;i>0;i--)this._iceGatherers.push(new window.RTCIceGatherer({iceServers:config.iceServers,gatherPolicy:config.iceTransportPolicy}));else config.iceCandidatePoolSize=0;this._config=config,this.transceivers=[],this._sdpSessionId=SDPUtils.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(RTCPeerConnection.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(RTCPeerConnection.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),RTCPeerConnection.prototype.onicecandidate=null,RTCPeerConnection.prototype.onaddstream=null,RTCPeerConnection.prototype.ontrack=null,RTCPeerConnection.prototype.onremovestream=null,RTCPeerConnection.prototype.onsignalingstatechange=null,RTCPeerConnection.prototype.oniceconnectionstatechange=null,RTCPeerConnection.prototype.onconnectionstatechange=null,RTCPeerConnection.prototype.onicegatheringstatechange=null,RTCPeerConnection.prototype.onnegotiationneeded=null,RTCPeerConnection.prototype.ondatachannel=null,RTCPeerConnection.prototype._dispatchEvent=function(name,event){this._isClosed||(this.dispatchEvent(event),"function"==typeof this["on"+name]&&this["on"+name](event))},RTCPeerConnection.prototype._emitGatheringStateChange=function(){var event=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",event)},RTCPeerConnection.prototype.getConfiguration=function(){return this._config},RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams},RTCPeerConnection.prototype._createTransceiver=function(kind,doNotAdd){var hasBundleTransport=this.transceivers.length>0,transceiver={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:kind,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&hasBundleTransport)transceiver.iceTransport=this.transceivers[0].iceTransport,transceiver.dtlsTransport=this.transceivers[0].dtlsTransport;else{var transports=this._createIceAndDtlsTransports();transceiver.iceTransport=transports.iceTransport,transceiver.dtlsTransport=transports.dtlsTransport}return doNotAdd||this.transceivers.push(transceiver),transceiver},RTCPeerConnection.prototype.addTrack=function(track,stream){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var transceiver;if(this.transceivers.find((function(s){return s.track===track})))throw makeError("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==track.kind||(transceiver=this.transceivers[i]);return transceiver||(transceiver=this._createTransceiver(track.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(stream)&&this.localStreams.push(stream),transceiver.track=track,transceiver.stream=stream,transceiver.rtpSender=new window.RTCRtpSender(track,transceiver.dtlsTransport),transceiver.rtpSender},RTCPeerConnection.prototype.addStream=function(stream){var pc=this;if(edgeVersion>=15025)stream.getTracks().forEach((function(track){pc.addTrack(track,stream)}));else{var clonedStream=stream.clone();stream.getTracks().forEach((function(track,idx){var clonedTrack=clonedStream.getTracks()[idx];track.addEventListener("enabled",(function(event){clonedTrack.enabled=event.enabled}))})),clonedStream.getTracks().forEach((function(track){pc.addTrack(track,clonedStream)}))}},RTCPeerConnection.prototype.removeTrack=function(sender){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(sender instanceof window.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var transceiver=this.transceivers.find((function(t){return t.rtpSender===sender}));if(!transceiver)throw makeError("InvalidAccessError","Sender was not created by this connection.");var stream=transceiver.stream;transceiver.rtpSender.stop(),transceiver.rtpSender=null,transceiver.track=null,transceiver.stream=null,-1===this.transceivers.map((function(t){return t.stream})).indexOf(stream)&&this.localStreams.indexOf(stream)>-1&&this.localStreams.splice(this.localStreams.indexOf(stream),1),this._maybeFireNegotiationNeeded()},RTCPeerConnection.prototype.removeStream=function(stream){var pc=this;stream.getTracks().forEach((function(track){var sender=pc.getSenders().find((function(s){return s.track===track}));sender&&pc.removeTrack(sender)}))},RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter((function(transceiver){return!!transceiver.rtpSender})).map((function(transceiver){return transceiver.rtpSender}))},RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter((function(transceiver){return!!transceiver.rtpReceiver})).map((function(transceiver){return transceiver.rtpReceiver}))},RTCPeerConnection.prototype._createIceGatherer=function(sdpMLineIndex,usingBundle){var pc=this;if(usingBundle&&sdpMLineIndex>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var iceGatherer=new window.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(iceGatherer,"state",{value:"new",writable:!0}),this.transceivers[sdpMLineIndex].bufferedCandidateEvents=[],this.transceivers[sdpMLineIndex].bufferCandidates=function(event){var end=!event.candidate||0===Object.keys(event.candidate).length;iceGatherer.state=end?"completed":"gathering",null!==pc.transceivers[sdpMLineIndex].bufferedCandidateEvents&&pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event)},iceGatherer.addEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates),iceGatherer},RTCPeerConnection.prototype._gather=function(mid,sdpMLineIndex){var pc=this,iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;if(!iceGatherer.onlocalcandidate){var bufferedCandidateEvents=this.transceivers[sdpMLineIndex].bufferedCandidateEvents;this.transceivers[sdpMLineIndex].bufferedCandidateEvents=null,iceGatherer.removeEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates),iceGatherer.onlocalcandidate=function(evt){if(!(pc.usingBundle&&sdpMLineIndex>0)){var event=new Event("icecandidate");event.candidate={sdpMid:mid,sdpMLineIndex:sdpMLineIndex};var cand=evt.candidate,end=!cand||0===Object.keys(cand).length;if(end)"new"!==iceGatherer.state&&"gathering"!==iceGatherer.state||(iceGatherer.state="completed");else{"new"===iceGatherer.state&&(iceGatherer.state="gathering"),cand.component=1,cand.ufrag=iceGatherer.getLocalParameters().usernameFragment;var serializedCandidate=SDPUtils.writeCandidate(cand);event.candidate=Object.assign(event.candidate,SDPUtils.parseCandidate(serializedCandidate)),event.candidate.candidate=serializedCandidate,event.candidate.toJSON=function(){return{candidate:event.candidate.candidate,sdpMid:event.candidate.sdpMid,sdpMLineIndex:event.candidate.sdpMLineIndex,usernameFragment:event.candidate.usernameFragment}}}var sections=SDPUtils.getMediaSections(pc._localDescription.sdp);sections[event.candidate.sdpMLineIndex]+=end?"a=end-of-candidates\r\n":"a="+event.candidate.candidate+"\r\n",pc._localDescription.sdp=SDPUtils.getDescription(pc._localDescription.sdp)+sections.join("");var complete=pc.transceivers.every((function(transceiver){return transceiver.iceGatherer&&"completed"===transceiver.iceGatherer.state}));"gathering"!==pc.iceGatheringState&&(pc.iceGatheringState="gathering",pc._emitGatheringStateChange()),end||pc._dispatchEvent("icecandidate",event),complete&&(pc._dispatchEvent("icecandidate",new Event("icecandidate")),pc.iceGatheringState="complete",pc._emitGatheringStateChange())}},window.setTimeout((function(){bufferedCandidateEvents.forEach((function(e){iceGatherer.onlocalcandidate(e)}))}),0)}},RTCPeerConnection.prototype._createIceAndDtlsTransports=function(){var pc=this,iceTransport=new window.RTCIceTransport(null);iceTransport.onicestatechange=function(){pc._updateIceConnectionState(),pc._updateConnectionState()};var dtlsTransport=new window.RTCDtlsTransport(iceTransport);return dtlsTransport.ondtlsstatechange=function(){pc._updateConnectionState()},dtlsTransport.onerror=function(){Object.defineProperty(dtlsTransport,"state",{value:"failed",writable:!0}),pc._updateConnectionState()},{iceTransport:iceTransport,dtlsTransport:dtlsTransport}},RTCPeerConnection.prototype._disposeIceAndDtlsTransports=function(sdpMLineIndex){var iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;iceGatherer&&(delete iceGatherer.onlocalcandidate,delete this.transceivers[sdpMLineIndex].iceGatherer);var iceTransport=this.transceivers[sdpMLineIndex].iceTransport;iceTransport&&(delete iceTransport.onicestatechange,delete this.transceivers[sdpMLineIndex].iceTransport);var dtlsTransport=this.transceivers[sdpMLineIndex].dtlsTransport;dtlsTransport&&(delete dtlsTransport.ondtlsstatechange,delete dtlsTransport.onerror,delete this.transceivers[sdpMLineIndex].dtlsTransport)},RTCPeerConnection.prototype._transceive=function(transceiver,send,recv){var params=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);send&&transceiver.rtpSender&&(params.encodings=transceiver.sendEncodingParameters,params.rtcp={cname:SDPUtils.localCName,compound:transceiver.rtcpParameters.compound},transceiver.recvEncodingParameters.length&&(params.rtcp.ssrc=transceiver.recvEncodingParameters[0].ssrc),transceiver.rtpSender.send(params)),recv&&transceiver.rtpReceiver&&params.codecs.length>0&&("video"===transceiver.kind&&transceiver.recvEncodingParameters&&edgeVersion<15019&&transceiver.recvEncodingParameters.forEach((function(p){delete p.rtx})),transceiver.recvEncodingParameters.length?params.encodings=transceiver.recvEncodingParameters:params.encodings=[{}],params.rtcp={compound:transceiver.rtcpParameters.compound},transceiver.rtcpParameters.cname&&(params.rtcp.cname=transceiver.rtcpParameters.cname),transceiver.sendEncodingParameters.length&&(params.rtcp.ssrc=transceiver.sendEncodingParameters[0].ssrc),transceiver.rtpReceiver.receive(params))},RTCPeerConnection.prototype.setLocalDescription=function(description){var sections,sessionpart,pc=this;if(-1===["offer","answer"].indexOf(description.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+description.type+'"'));if(!isActionAllowedInSignalingState("setLocalDescription",description.type,pc.signalingState)||pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set local "+description.type+" in state "+pc.signalingState));if("offer"===description.type)sections=SDPUtils.splitSections(description.sdp),sessionpart=sections.shift(),sections.forEach((function(mediaSection,sdpMLineIndex){var caps=SDPUtils.parseRtpParameters(mediaSection);pc.transceivers[sdpMLineIndex].localCapabilities=caps})),pc.transceivers.forEach((function(transceiver,sdpMLineIndex){pc._gather(transceiver.mid,sdpMLineIndex)}));else if("answer"===description.type){sections=SDPUtils.splitSections(pc._remoteDescription.sdp),sessionpart=sections.shift();var isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0;sections.forEach((function(mediaSection,sdpMLineIndex){var transceiver=pc.transceivers[sdpMLineIndex],iceGatherer=transceiver.iceGatherer,iceTransport=transceiver.iceTransport,dtlsTransport=transceiver.dtlsTransport,localCapabilities=transceiver.localCapabilities,remoteCapabilities=transceiver.remoteCapabilities;if((!SDPUtils.isRejected(mediaSection)||0!==SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length)&&!transceiver.rejected){var remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart),remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart);isIceLite&&(remoteDtlsParameters.role="server"),pc.usingBundle&&0!==sdpMLineIndex||(pc._gather(transceiver.mid,sdpMLineIndex),"new"===iceTransport.state&&iceTransport.start(iceGatherer,remoteIceParameters,isIceLite?"controlling":"controlled"),"new"===dtlsTransport.state&&dtlsTransport.start(remoteDtlsParameters));var params=getCommonCapabilities(localCapabilities,remoteCapabilities);pc._transceive(transceiver,params.codecs.length>0,!1)}}))}return pc._localDescription={type:description.type,sdp:description.sdp},"offer"===description.type?pc._updateSignalingState("have-local-offer"):pc._updateSignalingState("stable"),Promise.resolve()},RTCPeerConnection.prototype.setRemoteDescription=function(description){var pc=this;if(-1===["offer","answer"].indexOf(description.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+description.type+'"'));if(!isActionAllowedInSignalingState("setRemoteDescription",description.type,pc.signalingState)||pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set remote "+description.type+" in state "+pc.signalingState));var streams={};pc.remoteStreams.forEach((function(stream){streams[stream.id]=stream}));var receiverList=[],sections=SDPUtils.splitSections(description.sdp),sessionpart=sections.shift(),isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0,usingBundle=SDPUtils.matchPrefix(sessionpart,"a=group:BUNDLE ").length>0;pc.usingBundle=usingBundle;var iceOptions=SDPUtils.matchPrefix(sessionpart,"a=ice-options:")[0];return pc.canTrickleIceCandidates=!!iceOptions&&iceOptions.substr(14).split(" ").indexOf("trickle")>=0,sections.forEach((function(mediaSection,sdpMLineIndex){var lines=SDPUtils.splitLines(mediaSection),kind=SDPUtils.getKind(mediaSection),rejected=SDPUtils.isRejected(mediaSection)&&0===SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length,protocol=lines[0].substr(2).split(" ")[2],direction=SDPUtils.getDirection(mediaSection,sessionpart),remoteMsid=SDPUtils.parseMsid(mediaSection),mid=SDPUtils.getMid(mediaSection)||SDPUtils.generateIdentifier();if(rejected||"application"===kind&&("DTLS/SCTP"===protocol||"UDP/DTLS/SCTP"===protocol))pc.transceivers[sdpMLineIndex]={mid:mid,kind:kind,protocol:protocol,rejected:!0};else{var transceiver,iceGatherer,iceTransport,dtlsTransport,rtpReceiver,sendEncodingParameters,recvEncodingParameters,localCapabilities,track;!rejected&&pc.transceivers[sdpMLineIndex]&&pc.transceivers[sdpMLineIndex].rejected&&(pc.transceivers[sdpMLineIndex]=pc._createTransceiver(kind,!0));var remoteIceParameters,remoteDtlsParameters,remoteCapabilities=SDPUtils.parseRtpParameters(mediaSection);rejected||(remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart),(remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart)).role="client"),recvEncodingParameters=SDPUtils.parseRtpEncodingParameters(mediaSection);var rtcpParameters=SDPUtils.parseRtcpParameters(mediaSection),isComplete=SDPUtils.matchPrefix(mediaSection,"a=end-of-candidates",sessionpart).length>0,cands=SDPUtils.matchPrefix(mediaSection,"a=candidate:").map((function(cand){return SDPUtils.parseCandidate(cand)})).filter((function(cand){return 1===cand.component}));if(("offer"===description.type||"answer"===description.type)&&!rejected&&usingBundle&&sdpMLineIndex>0&&pc.transceivers[sdpMLineIndex]&&(pc._disposeIceAndDtlsTransports(sdpMLineIndex),pc.transceivers[sdpMLineIndex].iceGatherer=pc.transceivers[0].iceGatherer,pc.transceivers[sdpMLineIndex].iceTransport=pc.transceivers[0].iceTransport,pc.transceivers[sdpMLineIndex].dtlsTransport=pc.transceivers[0].dtlsTransport,pc.transceivers[sdpMLineIndex].rtpSender&&pc.transceivers[sdpMLineIndex].rtpSender.setTransport(pc.transceivers[0].dtlsTransport),pc.transceivers[sdpMLineIndex].rtpReceiver&&pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(pc.transceivers[0].dtlsTransport)),"offer"!==description.type||rejected)"answer"!==description.type||rejected||(iceGatherer=(transceiver=pc.transceivers[sdpMLineIndex]).iceGatherer,iceTransport=transceiver.iceTransport,dtlsTransport=transceiver.dtlsTransport,rtpReceiver=transceiver.rtpReceiver,sendEncodingParameters=transceiver.sendEncodingParameters,localCapabilities=transceiver.localCapabilities,pc.transceivers[sdpMLineIndex].recvEncodingParameters=recvEncodingParameters,pc.transceivers[sdpMLineIndex].remoteCapabilities=remoteCapabilities,pc.transceivers[sdpMLineIndex].rtcpParameters=rtcpParameters,cands.length&&"new"===iceTransport.state&&(!isIceLite&&!isComplete||usingBundle&&0!==sdpMLineIndex?cands.forEach((function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})):iceTransport.setRemoteCandidates(cands)),usingBundle&&0!==sdpMLineIndex||("new"===iceTransport.state&&iceTransport.start(iceGatherer,remoteIceParameters,"controlling"),"new"===dtlsTransport.state&&dtlsTransport.start(remoteDtlsParameters)),!getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities).codecs.filter((function(c){return"rtx"===c.name.toLowerCase()})).length&&transceiver.sendEncodingParameters[0].rtx&&delete transceiver.sendEncodingParameters[0].rtx,pc._transceive(transceiver,"sendrecv"===direction||"recvonly"===direction,"sendrecv"===direction||"sendonly"===direction),!rtpReceiver||"sendrecv"!==direction&&"sendonly"!==direction?delete transceiver.rtpReceiver:(track=rtpReceiver.track,remoteMsid?(streams[remoteMsid.stream]||(streams[remoteMsid.stream]=new window.MediaStream),addTrackToStreamAndFireEvent(track,streams[remoteMsid.stream]),receiverList.push([track,rtpReceiver,streams[remoteMsid.stream]])):(streams.default||(streams.default=new window.MediaStream),addTrackToStreamAndFireEvent(track,streams.default),receiverList.push([track,rtpReceiver,streams.default]))));else{(transceiver=pc.transceivers[sdpMLineIndex]||pc._createTransceiver(kind)).mid=mid,transceiver.iceGatherer||(transceiver.iceGatherer=pc._createIceGatherer(sdpMLineIndex,usingBundle)),cands.length&&"new"===transceiver.iceTransport.state&&(!isComplete||usingBundle&&0!==sdpMLineIndex?cands.forEach((function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})):transceiver.iceTransport.setRemoteCandidates(cands)),localCapabilities=window.RTCRtpReceiver.getCapabilities(kind),edgeVersion<15019&&(localCapabilities.codecs=localCapabilities.codecs.filter((function(codec){return"rtx"!==codec.name}))),sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:1001*(2*sdpMLineIndex+2)}];var stream,isNewTrack=!1;"sendrecv"===direction||"sendonly"===direction?(isNewTrack=!transceiver.rtpReceiver,rtpReceiver=transceiver.rtpReceiver||new window.RTCRtpReceiver(transceiver.dtlsTransport,kind),isNewTrack&&(track=rtpReceiver.track,remoteMsid&&"-"===remoteMsid.stream||(remoteMsid?(streams[remoteMsid.stream]||(streams[remoteMsid.stream]=new window.MediaStream,Object.defineProperty(streams[remoteMsid.stream],"id",{get:function(){return remoteMsid.stream}})),Object.defineProperty(track,"id",{get:function(){return remoteMsid.track}}),stream=streams[remoteMsid.stream]):(streams.default||(streams.default=new window.MediaStream),stream=streams.default)),stream&&(addTrackToStreamAndFireEvent(track,stream),transceiver.associatedRemoteMediaStreams.push(stream)),receiverList.push([track,rtpReceiver,stream]))):transceiver.rtpReceiver&&transceiver.rtpReceiver.track&&(transceiver.associatedRemoteMediaStreams.forEach((function(s){var nativeTrack=s.getTracks().find((function(t){return t.id===transceiver.rtpReceiver.track.id}));nativeTrack&&function(track,stream){stream.removeTrack(track),stream.dispatchEvent(new window.MediaStreamTrackEvent("removetrack",{track:track}))}(nativeTrack,s)})),transceiver.associatedRemoteMediaStreams=[]),transceiver.localCapabilities=localCapabilities,transceiver.remoteCapabilities=remoteCapabilities,transceiver.rtpReceiver=rtpReceiver,transceiver.rtcpParameters=rtcpParameters,transceiver.sendEncodingParameters=sendEncodingParameters,transceiver.recvEncodingParameters=recvEncodingParameters,pc._transceive(pc.transceivers[sdpMLineIndex],!1,isNewTrack)}}})),void 0===pc._dtlsRole&&(pc._dtlsRole="offer"===description.type?"active":"passive"),pc._remoteDescription={type:description.type,sdp:description.sdp},"offer"===description.type?pc._updateSignalingState("have-remote-offer"):pc._updateSignalingState("stable"),Object.keys(streams).forEach((function(sid){var stream=streams[sid];if(stream.getTracks().length){if(-1===pc.remoteStreams.indexOf(stream)){pc.remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,window.setTimeout((function(){pc._dispatchEvent("addstream",event)}))}receiverList.forEach((function(item){var track=item[0],receiver=item[1];stream.id===item[2].id&&fireAddTrack(pc,track,receiver,[stream])}))}})),receiverList.forEach((function(item){item[2]||fireAddTrack(pc,item[0],item[1],[])})),window.setTimeout((function(){pc&&pc.transceivers&&pc.transceivers.forEach((function(transceiver){transceiver.iceTransport&&"new"===transceiver.iceTransport.state&&transceiver.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),transceiver.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},RTCPeerConnection.prototype.close=function(){this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&transceiver.iceTransport.stop(),transceiver.dtlsTransport&&transceiver.dtlsTransport.stop(),transceiver.rtpSender&&transceiver.rtpSender.stop(),transceiver.rtpReceiver&&transceiver.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},RTCPeerConnection.prototype._updateSignalingState=function(newState){this.signalingState=newState;var event=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",event)},RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var pc=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,window.setTimeout((function(){if(pc.needNegotiation){pc.needNegotiation=!1;var event=new Event("negotiationneeded");pc._dispatchEvent("negotiationneeded",event)}}),0))},RTCPeerConnection.prototype._updateIceConnectionState=function(){var newState,states={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&!transceiver.rejected&&states[transceiver.iceTransport.state]++})),newState="new",states.failed>0?newState="failed":states.checking>0?newState="checking":states.disconnected>0?newState="disconnected":states.new>0?newState="new":states.connected>0?newState="connected":states.completed>0&&(newState="completed"),newState!==this.iceConnectionState){this.iceConnectionState=newState;var event=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",event)}},RTCPeerConnection.prototype._updateConnectionState=function(){var newState,states={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&transceiver.dtlsTransport&&!transceiver.rejected&&(states[transceiver.iceTransport.state]++,states[transceiver.dtlsTransport.state]++)})),states.connected+=states.completed,newState="new",states.failed>0?newState="failed":states.connecting>0?newState="connecting":states.disconnected>0?newState="disconnected":states.new>0?newState="new":states.connected>0&&(newState="connected"),newState!==this.connectionState){this.connectionState=newState;var event=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",event)}},RTCPeerConnection.prototype.createOffer=function(){var pc=this;if(pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createOffer after close"));var numAudioTracks=pc.transceivers.filter((function(t){return"audio"===t.kind})).length,numVideoTracks=pc.transceivers.filter((function(t){return"video"===t.kind})).length,offerOptions=arguments[0];if(offerOptions){if(offerOptions.mandatory||offerOptions.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==offerOptions.offerToReceiveAudio&&(numAudioTracks=!0===offerOptions.offerToReceiveAudio?1:!1===offerOptions.offerToReceiveAudio?0:offerOptions.offerToReceiveAudio),void 0!==offerOptions.offerToReceiveVideo&&(numVideoTracks=!0===offerOptions.offerToReceiveVideo?1:!1===offerOptions.offerToReceiveVideo?0:offerOptions.offerToReceiveVideo)}for(pc.transceivers.forEach((function(transceiver){"audio"===transceiver.kind?--numAudioTracks<0&&(transceiver.wantReceive=!1):"video"===transceiver.kind&&--numVideoTracks<0&&(transceiver.wantReceive=!1)}));numAudioTracks>0||numVideoTracks>0;)numAudioTracks>0&&(pc._createTransceiver("audio"),numAudioTracks--),numVideoTracks>0&&(pc._createTransceiver("video"),numVideoTracks--);var sdp=SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,pc._sdpSessionVersion++);pc.transceivers.forEach((function(transceiver,sdpMLineIndex){var track=transceiver.track,kind=transceiver.kind,mid=transceiver.mid||SDPUtils.generateIdentifier();transceiver.mid=mid,transceiver.iceGatherer||(transceiver.iceGatherer=pc._createIceGatherer(sdpMLineIndex,pc.usingBundle));var localCapabilities=window.RTCRtpSender.getCapabilities(kind);edgeVersion<15019&&(localCapabilities.codecs=localCapabilities.codecs.filter((function(codec){return"rtx"!==codec.name}))),localCapabilities.codecs.forEach((function(codec){"H264"===codec.name&&void 0===codec.parameters["level-asymmetry-allowed"]&&(codec.parameters["level-asymmetry-allowed"]="1"),transceiver.remoteCapabilities&&transceiver.remoteCapabilities.codecs&&transceiver.remoteCapabilities.codecs.forEach((function(remoteCodec){codec.name.toLowerCase()===remoteCodec.name.toLowerCase()&&codec.clockRate===remoteCodec.clockRate&&(codec.preferredPayloadType=remoteCodec.payloadType)}))})),localCapabilities.headerExtensions.forEach((function(hdrExt){(transceiver.remoteCapabilities&&transceiver.remoteCapabilities.headerExtensions||[]).forEach((function(rHdrExt){hdrExt.uri===rHdrExt.uri&&(hdrExt.id=rHdrExt.id)}))}));var sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:1001*(2*sdpMLineIndex+1)}];track&&edgeVersion>=15019&&"video"===kind&&!sendEncodingParameters[0].rtx&&(sendEncodingParameters[0].rtx={ssrc:sendEncodingParameters[0].ssrc+1}),transceiver.wantReceive&&(transceiver.rtpReceiver=new window.RTCRtpReceiver(transceiver.dtlsTransport,kind)),transceiver.localCapabilities=localCapabilities,transceiver.sendEncodingParameters=sendEncodingParameters})),"max-compat"!==pc._config.bundlePolicy&&(sdp+="a=group:BUNDLE "+pc.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n"),sdp+="a=ice-options:trickle\r\n",pc.transceivers.forEach((function(transceiver,sdpMLineIndex){sdp+=writeMediaSection(transceiver,transceiver.localCapabilities,"offer",transceiver.stream,pc._dtlsRole),sdp+="a=rtcp-rsize\r\n",!transceiver.iceGatherer||"new"===pc.iceGatheringState||0!==sdpMLineIndex&&pc.usingBundle||(transceiver.iceGatherer.getLocalCandidates().forEach((function(cand){cand.component=1,sdp+="a="+SDPUtils.writeCandidate(cand)+"\r\n"})),"completed"===transceiver.iceGatherer.state&&(sdp+="a=end-of-candidates\r\n"))}));var desc=new window.RTCSessionDescription({type:"offer",sdp:sdp});return Promise.resolve(desc)},RTCPeerConnection.prototype.createAnswer=function(){var pc=this;if(pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==pc.signalingState&&"have-local-pranswer"!==pc.signalingState)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer in signalingState "+pc.signalingState));var sdp=SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,pc._sdpSessionVersion++);pc.usingBundle&&(sdp+="a=group:BUNDLE "+pc.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n"),sdp+="a=ice-options:trickle\r\n";var mediaSectionsInOffer=SDPUtils.getMediaSections(pc._remoteDescription.sdp).length;pc.transceivers.forEach((function(transceiver,sdpMLineIndex){if(!(sdpMLineIndex+1>mediaSectionsInOffer)){if(transceiver.rejected)return"application"===transceiver.kind?"DTLS/SCTP"===transceiver.protocol?sdp+="m=application 0 DTLS/SCTP 5000\r\n":sdp+="m=application 0 "+transceiver.protocol+" webrtc-datachannel\r\n":"audio"===transceiver.kind?sdp+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===transceiver.kind&&(sdp+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(sdp+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+transceiver.mid+"\r\n");var localTrack;transceiver.stream&&("audio"===transceiver.kind?localTrack=transceiver.stream.getAudioTracks()[0]:"video"===transceiver.kind&&(localTrack=transceiver.stream.getVideoTracks()[0]),localTrack&&edgeVersion>=15019&&"video"===transceiver.kind&&!transceiver.sendEncodingParameters[0].rtx&&(transceiver.sendEncodingParameters[0].rtx={ssrc:transceiver.sendEncodingParameters[0].ssrc+1}));var commonCapabilities=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);!commonCapabilities.codecs.filter((function(c){return"rtx"===c.name.toLowerCase()})).length&&transceiver.sendEncodingParameters[0].rtx&&delete transceiver.sendEncodingParameters[0].rtx,sdp+=writeMediaSection(transceiver,commonCapabilities,"answer",transceiver.stream,pc._dtlsRole),transceiver.rtcpParameters&&transceiver.rtcpParameters.reducedSize&&(sdp+="a=rtcp-rsize\r\n")}}));var desc=new window.RTCSessionDescription({type:"answer",sdp:sdp});return Promise.resolve(desc)},RTCPeerConnection.prototype.addIceCandidate=function(candidate){var sections,pc=this;return candidate&&void 0===candidate.sdpMLineIndex&&!candidate.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(resolve,reject){if(!pc._remoteDescription)return reject(makeError("InvalidStateError","Can not add ICE candidate without a remote description"));if(candidate&&""!==candidate.candidate){var sdpMLineIndex=candidate.sdpMLineIndex;if(candidate.sdpMid)for(var i=0;i<pc.transceivers.length;i++)if(pc.transceivers[i].mid===candidate.sdpMid){sdpMLineIndex=i;break}var transceiver=pc.transceivers[sdpMLineIndex];if(!transceiver)return reject(makeError("OperationError","Can not add ICE candidate"));if(transceiver.rejected)return resolve();var cand=Object.keys(candidate.candidate).length>0?SDPUtils.parseCandidate(candidate.candidate):{};if("tcp"===cand.protocol&&(0===cand.port||9===cand.port))return resolve();if(cand.component&&1!==cand.component)return resolve();if((0===sdpMLineIndex||sdpMLineIndex>0&&transceiver.iceTransport!==pc.transceivers[0].iceTransport)&&!maybeAddCandidate(transceiver.iceTransport,cand))return reject(makeError("OperationError","Can not add ICE candidate"));var candidateString=candidate.candidate.trim();0===candidateString.indexOf("a=")&&(candidateString=candidateString.substr(2)),(sections=SDPUtils.getMediaSections(pc._remoteDescription.sdp))[sdpMLineIndex]+="a="+(cand.type?candidateString:"end-of-candidates")+"\r\n",pc._remoteDescription.sdp=SDPUtils.getDescription(pc._remoteDescription.sdp)+sections.join("")}else for(var j=0;j<pc.transceivers.length&&(pc.transceivers[j].rejected||(pc.transceivers[j].iceTransport.addRemoteCandidate({}),(sections=SDPUtils.getMediaSections(pc._remoteDescription.sdp))[j]+="a=end-of-candidates\r\n",pc._remoteDescription.sdp=SDPUtils.getDescription(pc._remoteDescription.sdp)+sections.join(""),!pc.usingBundle));j++);resolve()}))},RTCPeerConnection.prototype.getStats=function(selector){if(selector&&selector instanceof window.MediaStreamTrack){var senderOrReceiver=null;if(this.transceivers.forEach((function(transceiver){transceiver.rtpSender&&transceiver.rtpSender.track===selector?senderOrReceiver=transceiver.rtpSender:transceiver.rtpReceiver&&transceiver.rtpReceiver.track===selector&&(senderOrReceiver=transceiver.rtpReceiver)})),!senderOrReceiver)throw makeError("InvalidAccessError","Invalid selector.");return senderOrReceiver.getStats()}var promises=[];return this.transceivers.forEach((function(transceiver){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(method){transceiver[method]&&promises.push(transceiver[method].getStats())}))})),Promise.all(promises).then((function(allStats){var results=new Map;return allStats.forEach((function(stats){stats.forEach((function(stat){results.set(stat.id,stat)}))})),results}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(ortcObjectName){var obj=window[ortcObjectName];if(obj&&obj.prototype&&obj.prototype.getStats){var nativeGetstats=obj.prototype.getStats;obj.prototype.getStats=function(){return nativeGetstats.apply(this).then((function(nativeStats){var mapStats=new Map;return Object.keys(nativeStats).forEach((function(id){var stat;nativeStats[id].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(stat=nativeStats[id]).type]||stat.type,mapStats.set(id,nativeStats[id])})),mapStats}))}}}));var methods=["createOffer","createAnswer"];return methods.forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[0]||"function"==typeof args[1]?nativeMethod.apply(this,[arguments[2]]).then((function(description){"function"==typeof args[0]&&args[0].apply(null,[description])}),(function(error){"function"==typeof args[1]&&args[1].apply(null,[error])})):nativeMethod.apply(this,arguments)}})),(methods=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[1]||"function"==typeof args[2]?nativeMethod.apply(this,arguments).then((function(){"function"==typeof args[1]&&args[1].apply(null)}),(function(error){"function"==typeof args[2]&&args[2].apply(null,[error])})):nativeMethod.apply(this,arguments)}})),["getStats"].forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[1]?nativeMethod.apply(this,arguments).then((function(){"function"==typeof args[1]&&args[1].apply(null)})):nativeMethod.apply(this,arguments)}})),RTCPeerConnection}},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),main_service_1=__webpack_require__(26),settings_service_1=__webpack_require__(5),auth_service_1=__webpack_require__(2),event_service_1=__webpack_require__(32),xmpp_service_1=__webpack_require__(4),contact_service_1=__webpack_require__(1),fileStorage_service_1=__webpack_require__(25),invitation_service_1=__webpack_require__(233),profile_service_1=__webpack_require__(6),room_service_1=__webpack_require__(33),sdkConfig_1=__webpack_require__(39),sdkConstant_1=__webpack_require__(28),_botService=new WeakMap,_fileServerService=new WeakMap,_groupService=new WeakMap,_videoService=new WeakMap,_favoriteService=new WeakMap,_webrtcServiceEventHandler=new WeakMap,_telephonyService=new WeakMap,_conferenceService=new WeakMap,_webConferenceService=new WeakMap,_conversationService=new WeakMap,_platformService=new WeakMap,_adminCompanyService=new WeakMap,_companyDirectoryService=new WeakMap,_adminUserService=new WeakMap,_channelService=new WeakMap,_webrtcGatewayService=new WeakMap,_recordsService=new WeakMap,_voiceMessageService=new WeakMap;exports.ConnectionService=function(){function _class5($rootScope,botService,fileServerService,groupService,videoService,favoriteService,webrtcServiceEventHandler,telephonyService,conferenceService,webConferenceService,conversationService,platformService,adminCompanyService,companyDirectoryService,adminUserService,channelService,webrtcGatewayService,recordsService,voiceMessageService){var _this140=this;_classCallCheck(this,_class5),this.logService="ConnectionService | ",this.state="disconnected",this.hostUsed="",this.RAINBOW_ONCONNECTIONSTATECHANGED="rainbowconnectionstatechanged",this.RAINBOW_ONSTARTED="started",this.RAINBOW_ONSIGNED="signed",this.RAINBOW_ONSTOPPED="stopped",this.RAINBOW_CONNECTIONINPROGRESS="inProgress",this.RAINBOW_ONUSERTOKENRENEW="userTokenRenew",this.RAINBOW_ONUSERTOKENRENEWFAILED="userTokenRenewFailed",this.RAINBOW_ONAPPTOKENRENEW="applicationTokenRenew",this.RAINBOW_ONAPPTOKENRENEWFAILED="applicationTokenRenewFailed",this.RAINBOW_CONNECTIONCONNECTED="connected",this.RAINBOW_CONNECTIONDISCONNECTED="disconnected",this.RAINBOW_OFFICIAL_HOST="openrainbow.com",this.RAINBOW_BETA_HOST="openrainbow.net",this.RAINBOW_DEV_HOST="openrainbow.org",this.RAINBOW_SANDBOX_HOST="sandbox.openrainbow.com",this.RAINBOW_CPAASPREPROD_HOST="cpaaspreprod.openrainbow.net",this.RAINBOW_CHINA_HOST="myopenrainbow.com.cn",this.RAINBOW_CHINASANDBOX_HOST="sandbox.myopenrainbow.com.cn",event_service_1.default.configure($rootScope),main_service_1.default.configure(),settings_service_1.default.configure("en"),settings_service_1.default.setSetting("apiMode","sdk"),_botService.set(this,botService),_fileServerService.set(this,fileServerService),_groupService.set(this,groupService),_videoService.set(this,videoService),_favoriteService.set(this,favoriteService),_webrtcServiceEventHandler.set(this,webrtcServiceEventHandler),_telephonyService.set(this,telephonyService),_conferenceService.set(this,conferenceService),_webConferenceService.set(this,webConferenceService),_conversationService.set(this,conversationService),_platformService.set(this,platformService),_adminCompanyService.set(this,adminCompanyService),_companyDirectoryService.set(this,companyDirectoryService),_adminUserService.set(this,adminUserService),_channelService.set(this,channelService),_webrtcGatewayService.set(this,webrtcGatewayService),_recordsService.set(this,recordsService),_voiceMessageService.set(this,voiceMessageService),xmpp_service_1.default.subscribeToConnectionEvents((function(event){var status="connected";"ON_XMPP_CONNECTING"===event.name&&(status="inProgress"),"ON_XMPP_DISCONNECTED"===event.name&&(status="LOGOUT"===event.data.reason?"unlogged":"disconnected"),"ON_XMPP_CONNECTED"===event.name&&(status="connected","RECONNECTION"===event.data.reason&&(EventsService_1.eventsService.dispatchEvent(_this140.RAINBOW_ONCONNECTIONSTATECHANGED,"reconnecting"),_this140.reconnectServices())),_this140.state=status,RainbowLogger_1.rainbowLogger.sdk(_this140.logService+"[onChange] :: Connection state changed to "+status),EventsService_1.eventsService.dispatchEvent(_this140.RAINBOW_ONCONNECTIONSTATECHANGED,status)})),auth_service_1.default.subscribe((function(event){switch(event.name){case"ON_AUTH_TOKEN_RENEW":EventsService_1.eventsService.dispatchEvent(_this140.RAINBOW_ONUSERTOKENRENEW);break;case"ON_AUTH_TOKEN_EXPIRE":EventsService_1.eventsService.dispatchEvent(_this140.RAINBOW_ONUSERTOKENRENEWFAILED);break;case"ON_APP_TOKEN_RENEW":EventsService_1.eventsService.dispatchEvent(_this140.RAINBOW_ONAPPTOKENRENEW);break;case"ON_APP_TOKEN_EXPIRE":EventsService_1.eventsService.dispatchEvent(_this140.RAINBOW_ONAPPTOKENRENEWFAILED)}})),window.addEventListener("beforeunload",(function(){videoService.stop(),contact_service_1.default.stop(),conversationService.stop(),groupService.stop(),telephonyService.stop(),fileServerService.stop(),fileStorage_service_1.default.stop(),xmpp_service_1.default.stop(),profile_service_1.default.stop(),recordsService.stop(),channelService.stop(),webrtcGatewayService.stop()}))}return _createClass(_class5,[{key:"signin",value:function(strLogin,strPassword){return this.hostUsed=this.RAINBOW_SANDBOX_HOST,this.signinToRainbow(strLogin,strPassword,null)}},{key:"signinOnRainbowOfficial",value:function(strLogin,strPassword){return this.hostUsed=this.RAINBOW_OFFICIAL_HOST,window.config.webservices.currentServer=this.RAINBOW_OFFICIAL_HOST,this.signinToRainbow(strLogin,strPassword,null)}},{key:"signinOnRainbowBeta",value:function(strLogin,strPassword){return this.hostUsed=this.RAINBOW_BETA_HOST,this.signinToRainbow(strLogin,strPassword,null)}},{key:"signinOnRainbowCPaasPreProd",value:function(strLogin,strPassword){return this.hostUsed=this.RAINBOW_CPAASPREPROD_HOST,this.signinToRainbow(strLogin,strPassword,null)}},{key:"signinOnRainbowDev",value:function(strLogin,strPassword){return this.hostUsed=this.RAINBOW_DEV_HOST,this.signinToRainbow(strLogin,strPassword,null)}},{key:"signinOnRainbowSandboxChina",value:function(strLogin,strPassword){return this.hostUsed=this.RAINBOW_CHINASANDBOX_HOST,this.signinToRainbow(strLogin,strPassword,null)}},{key:"signinOnRainbowChina",value:function(strLogin,strPassword){return this.hostUsed=this.RAINBOW_CHINA_HOST,this.signinToRainbow(strLogin,strPassword,null)}},{key:"signinOnRainbowHosted",value:function(strLogin,strPassword,strHost){return this.hostUsed=strHost,this.signinToRainbow(strLogin,strPassword,null)}},{key:"signinSandBoxWithToken",value:function(strToken){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee174(){return regenerator_default.a.wrap((function(_context175){for(;;)switch(_context175.prev=_context175.next){case 0:return this.hostUsed=this.RAINBOW_SANDBOX_HOST,_context175.prev=1,_context175.next=4,this.signinToRainbow(null,null,strToken);case 4:return _context175.abrupt("return",_context175.sent);case 7:throw _context175.prev=7,_context175.t0=_context175.catch(1),_context175.t0;case 10:case"end":return _context175.stop()}}),_callee174,this,[[1,7]])})))}},{key:"signinOnRainbowOfficialWithToken",value:function(strToken){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee175(){return regenerator_default.a.wrap((function(_context176){for(;;)switch(_context176.prev=_context176.next){case 0:return _context176.prev=0,this.hostUsed=this.RAINBOW_OFFICIAL_HOST,window.config.webservices.currentServer=this.RAINBOW_OFFICIAL_HOST,_context176.next=4,this.signinToRainbow(null,null,strToken);case 4:return _context176.abrupt("return",_context176.sent);case 7:throw _context176.prev=7,_context176.t0=_context176.catch(0),_context176.t0;case 10:case"end":return _context176.stop()}}),_callee175,this,[[0,7]])})))}},{key:"signinOnRainbowBetaWithToken",value:function(strToken){return this.hostUsed=this.RAINBOW_BETA_HOST,this.signinToRainbow(null,null,strToken)}},{key:"signinOnRainbowDevWithToken",value:function(strToken){return this.hostUsed=this.RAINBOW_DEV_HOST,this.signinToRainbow(null,null,strToken)}},{key:"signinOnRainbowHostedWithToken",value:function(strToken,strHost){return this.hostUsed=strHost,this.signinToRainbow(null,null,strToken)}},{key:"signinOnRainbowWithOICD",value:function(strToken){for(var _this141=this,challenge="",characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",charactersLength=characters.length,i=0;i<30;i++)challenge+=characters.charAt(Math.floor(Math.random()*charactersLength));var url="https://openrainbow.com/api/rainbow/authentication/v1.0/oidc-client/jwt?id_token=".concat(strToken,"&challenge=").concat(challenge);return new Promise((function(resolve,reject){if(!strToken)return RainbowLogger_1.rainbowLogger.sdk(_this141.logService+"[signinOnRainbowWithOICD] :: Argument strToken is null or undefined"),reject("Argument strToken is null or undefined");var headersXrainbowAppAuth=window.btoa(unescape(encodeURIComponent(window.sdk.key.appID+":"+window.SHA256(window.sdk.key.appSecret+challenge))));headersXrainbowAppAuth="Basic "+headersXrainbowAppAuth;var sdkHeaders=new Headers({"Content-Type":"application/x-www-form-urlencoded","X-Rainbow-App-Auth":headersXrainbowAppAuth,Accept:"application/json"});fetch(url,{method:"get",mode:"cors",headers:sdkHeaders}).then((function(response){response.json().then((function(data){_this141.signinOnRainbowBetaWithToken(data.token).then((function(account){return resolve(account)})).catch((function(err){return reject(err)}))}))})).catch((function(err){return reject(err)}))}))}},{key:"styleSignInWithRainbowButton",value:function(color,size){var width,height,backgroundSize,fontSize,backgroundColor,textColor,el=document.querySelector(".SignInWithRainbow");return el?(size||(size="medium"),color||(color="blue"),"blue"===color?(backgroundColor="#1b85e0",textColor="#FFFFFF"):"white"===color&&(backgroundColor="#FFFFFF",textColor="#1b85e0"),"small"===size?(width="200px",height="20px",backgroundSize="18px",fontSize="12px"):"medium"===size?(width="250px",height="30px",backgroundSize="26px",fontSize="16px"):"large"===size&&(width="350px",height="40px",backgroundSize="34px",fontSize="22px"),el.style.backgroundColor=backgroundColor,el.style.color=textColor,el.style.width=width,el.style.height=height,el.style.fontSize=fontSize,el.style.border="0px",el.style.borderRadius="5px",el.innerHTML="Sign in with Rainbow",el.style.backgroundImage="url('https://hub.openrainbow.com/android-chrome-48x48.png')",el.style.backgroundPosition="left",el.style.backgroundRepeat="no-repeat",el.style.verticalAlign="middle",el.style.backgroundSize=backgroundSize,el.style.backgroundOrigin="content-box",el.style.paddingLeft="13px",RainbowLogger_1.rainbowLogger.sdk(this.logService+"[styleSignInWithRainbowButton] :: Styled a corresponding HTML element"),!0):(RainbowLogger_1.rainbowLogger.sdk(this.logService+"[styleSignInWithRainbowButton] :: Could not find a corresponding HTML element"),!1)}},{key:"signout",value:function(){var _this142=this,videoService=_videoService.get(this),favoriteService=_favoriteService.get(this),webrtcServiceEventHandler=_webrtcServiceEventHandler.get(this),botService=_botService.get(this),conversationService=_conversationService.get(this),conferenceService=_conferenceService.get(this),webConferenceService=_webConferenceService.get(this),channelService=_channelService.get(this),telephonyService=_telephonyService.get(this),fileServerService=_fileServerService.get(this),groupService=_groupService.get(this),adminCompanyService=_adminCompanyService.get(this),companyDirectoryService=_companyDirectoryService.get(this),adminUserService=_adminUserService.get(this),webrtcGatewayService=_webrtcGatewayService.get(this),recordsService=_recordsService.get(this),voiceMessageService=_voiceMessageService.get(this),result={code:sdkConstant_1.SDK.OK,label:"OK"};return RainbowLogger_1.rainbowLogger.sdk(this.logService+"[signout] :: Trying to sign out"),new Promise((function(resolve,reject){videoService.stop().then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Video service stopped"),favoriteService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Favorite service stopped"),voiceMessageService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: VoiceMessage service stopped"),webrtcServiceEventHandler.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: WebRTCEventHandler service stopped"),contact_service_1.default.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Contact service stopped"),botService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Bot service stopped"),profile_service_1.default.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Profile service stopped"),conversationService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Conversation service stopped"),conferenceService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Conference service stopped"),webConferenceService.stop()})).then((function(){RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: PTSN Conference service stopped")})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: ChannelService service stopped"),channelService.stop()})).then((function(){return telephonyService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Telephony service stopped"),fileServerService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: FileServer service stopped"),fileStorage_service_1.default.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: FileStorage service stopped"),invitation_service_1.default.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Invitation service stopped"),groupService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Group service stopped"),room_service_1.default.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Room service stopped"),adminCompanyService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Company Directory service stopped"),companyDirectoryService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Admin User service stopped"),adminUserService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Invitation service stopped"),webrtcGatewayService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: webrtcGateway service stopped"),xmpp_service_1.default.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Records service stopped"),recordsService.stop()})).then((function(){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: XMPP service stopped"),RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: Services Successfully unloaded!"),EventsService_1.eventsService.dispatchEvent(_this142.RAINBOW_ONSTOPPED,null),resolve(result)})).catch((function(error){return RainbowLogger_1.rainbowLogger.sdk(_this142.logService+"[signout] :: An error occurred during signout"),reject(error)}))}))}},{key:"updateUserPassword",value:function(oldPassword,newPassword){return contact_service_1.default.updateUserPassword(oldPassword,newPassword,!1)}},{key:"getState",value:function(){return this.state}},{key:"getToken",value:function(){return auth_service_1.default.token}},{key:"refreshToken",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee176(){return regenerator_default.a.wrap((function(_context177){for(;;)switch(_context177.prev=_context177.next){case 0:return _context177.prev=0,_context177.next=3,auth_service_1.default.renewAuthToken(!1);case 3:return _context177.abrupt("return",void _context177.sent);case 6:throw _context177.prev=6,_context177.t0=_context177.catch(0),_context177.t0;case 9:case"end":return _context177.stop()}}),_callee176,null,[[0,6]])})))}},{key:"signinToRainbow",value:function(login,password,token){var _this143=this,videoService=_videoService.get(this),webrtcServiceEventHandler=_webrtcServiceEventHandler.get(this),botService=_botService.get(this),conversationService=_conversationService.get(this),conferenceService=_conferenceService.get(this),webConferenceService=_webConferenceService.get(this),channelService=_channelService.get(this),telephonyService=_telephonyService.get(this),fileServerService=_fileServerService.get(this),groupService=_groupService.get(this),adminCompanyService=_adminCompanyService.get(this),companyDirectoryService=_companyDirectoryService.get(this),adminUserService=_adminUserService.get(this),webrtcGatewayService=_webrtcGatewayService.get(this),recordsService=_recordsService.get(this),platformService=_platformService.get(this),favoriteService=_favoriteService.get(this),voiceMessageService=_voiceMessageService.get(this);RainbowLogger_1.rainbowLogger.time("Auth");var withToken=!1;return new Promise((function(resolve,reject){if(token)withToken=!0,login=null,password=null;else{if(!login)return reject({code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'login' is missing or empty"});if(!password)return reject({code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'password' is missing or empty"})}RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Rainbow host used "+_this143.hostUsed),withToken?RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Trying to sign-in with given token"):RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Trying to sign-in");var result={code:sdkConstant_1.SDK.OK,label:"",account:null},appToken={appID:window.sdk.key.appID,appSecret:window.sdk.key.appSecret};auth_service_1.default.removeCredentials(),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - sdkLogOn"),auth_service_1.default.sdkLogOn(login,password,_this143.hostUsed,appToken,token).then((function(){RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - sdkLogOn"),result.account={},result.label="ok",result.account.userId=auth_service_1.default.userId,result.account.companyId=auth_service_1.default.companyId,result.account.loginEmail=auth_service_1.default.login,result.account.roles=auth_service_1.default.loggedInUser.roles,result.token=auth_service_1.default.token,result.userData=auth_service_1.default.loggedInUser;var stats=[];RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Successfully sign-in with  | "+auth_service_1.default.jidIm),EventsService_1.eventsService.dispatchEvent(_this143.RAINBOW_ONSIGNED,result),auth_service_1.default.startTokenSurvey(),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Start services..."),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - XMPPService"),xmpp_service_1.default.start().then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - companyService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Company service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - adminCompanyService"),adminCompanyService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - adminCompanyService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Admin company service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - companyDirectoryService"),companyDirectoryService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - companyDirectoryService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Company Directory Service company service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - adminUserService"),adminUserService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - adminUserService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Admin user service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - contactService"),contact_service_1.default.start()})).then((function(){if(RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - contactService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Contact service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - profileService"),sdkConfig_1.sdkConfig.features.profileService)return profile_service_1.default.start()})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - profileService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Profile service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - invitationService"),invitation_service_1.default.start()})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - invitationService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Invitation service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - fileServerService"),fileServerService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - fileServerService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: FileServer service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - fileStorageService"),fileStorage_service_1.default.start()})).then((function(){if(RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - fileStorageService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: FileStorage service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - roomService"),sdkConfig_1.sdkConfig.features.roomService)return room_service_1.default.start()})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - roomService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Room service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - groupService"),groupService.start(stats)})).then((function(){if(RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - groupService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Group service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - favoriteService"),sdkConfig_1.sdkConfig.features.favoriteService)return favoriteService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - favoriteService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Favorite service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - voiceMessageService"),voiceMessageService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - voiceMessageService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Voice Message Service service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - webrtcGatewayService"),webrtcGatewayService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - webrtcGatewayService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: WebrtcGateway service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - videoService"),!0===sdkConfig_1.sdkConfig.unifiedPlan&&(RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[videoService] :: Unified plan activated"),videoService.config||(videoService.config={}),videoService.config.unifiedPlan=!0),videoService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - videoService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Video service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - webrtcServiceEventHandler"),webrtcServiceEventHandler.start(stats)})).then((function(){if(RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - webrtcServiceEventHandler"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: WebRTCEventHandler service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - telephonyService"),sdkConfig_1.sdkConfig.features.telephony)return telephonyService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - telephonyService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Telephony service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - webConferenceService"),webConferenceService.start(stats)})).then((function(){if(webConferenceService.setActiveSpeakerValue(!1),RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - webConferenceService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Web Conference service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - conversationService"),sdkConfig_1.sdkConfig.features.conversationService)return conversationService.start(stats)})).then((function(){RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - conversationService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Conversation service ready!"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Send initial presence"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - sendPresenceFromConfiguration"),contact_service_1.default.sendPresenceFromConfiguration()})).then((function(){RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - sendPresenceFromConfiguration"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Initial presence sent !")})).then((function(){return RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - platformService"),platformService.start(stats)})).then((function(){if(RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - platformService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Platform service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - botService"),sdkConfig_1.sdkConfig.features.bots)return botService.start(stats)})).then((function(){if(RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - botService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Bot service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - conferenceService"),sdkConfig_1.sdkConfig.features.conference)return conferenceService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - conferenceService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Conference service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - recordsService"),recordsService.start(stats)})).then((function(){if(RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - recordsService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Records service ready!"),RainbowLogger_1.rainbowLogger.time("RainbowSDK Performance - channelService"),sdkConfig_1.sdkConfig.features.channels)return channelService.start(stats)})).then((function(){return RainbowLogger_1.rainbowLogger.timeEnd("RainbowSDK Performance - channelService"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Channel service ready!"),RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Services Successfully loaded!"),EventsService_1.eventsService.dispatchEvent(_this143.RAINBOW_ONSTARTED,result),RainbowLogger_1.rainbowLogger.timeEnd("Auth"),resolve(result)})).catch((function(){return RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Error during signin"),result.code=sdkConstant_1.SDK.ERRORXMPP,result.label="errorXMPP",result.account=null,reject(result)}))})).catch((function(){return RainbowLogger_1.rainbowLogger.sdk(_this143.logService+"[signin] :: Error during signin"),result.code=sdkConstant_1.SDK.ERRORUNAUTHORIZED,result.label="errorUnauthorized",reject(result)}))}))}},{key:"reconnectServices",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee177(){var videoService,webrtcServiceEventHandler,conversationService,conferenceService,channelService,telephonyService,fileServerService,groupService,favoriteService,voiceMessageService;return regenerator_default.a.wrap((function(_context178){for(;;)switch(_context178.prev=_context178.next){case 0:return videoService=_videoService.get(this),webrtcServiceEventHandler=_webrtcServiceEventHandler.get(this),conversationService=_conversationService.get(this),conferenceService=_conferenceService.get(this),channelService=_channelService.get(this),telephonyService=_telephonyService.get(this),fileServerService=_fileServerService.get(this),groupService=_groupService.get(this),favoriteService=_favoriteService.get(this),voiceMessageService=_voiceMessageService.get(this),_context178.prev=1,videoService.attachHandlers(),webrtcServiceEventHandler.attachHandlers(),conversationService.attachHandlers(),conferenceService.reconnectService(),channelService.reconnect(),telephonyService.reconnect(),fileServerService.attachHandlers(),groupService.attachHandlers(),room_service_1.default.reconnect(),favoriteService.connect(),voiceMessageService.attachHandlers(),contact_service_1.default.updateUserContactFullJid(),invitation_service_1.default.attachHandlers(),profile_service_1.default.restart(),_context178.next=18,fileStorage_service_1.default.reinit(!1);case 18:return _context178.next=20,conversationService.reinit();case 20:return _context178.next=22,contact_service_1.default.sendPresenceFromConfiguration(!0);case 22:return _context178.abrupt("return",void _context178.sent);case 25:_context178.prev=25,_context178.t0=_context178.catch(1),RainbowLogger_1.rainbowLogger.error("[serviceLauncher] reconnectServices failure "+_context178.t0.message);case 28:case"end":return _context178.stop()}}),_callee177,this,[[1,25]])})))}}],[{key:"$inject",get:function(){return["$rootScope","botService","fileServerService","groupService","videoService","favoriteService","webrtcServiceEventHandler","telephonyService","conferenceService","webConferenceService","conversationService","platformService","adminCompanyService","companyDirectoryService","adminUserService","channelService","webrtcGatewayService","recordsService","voiceMessageService"]}}]),_class5}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),contact_service_1=__webpack_require__(1),xmpp_service_1=__webpack_require__(4),sdkConstant_1=__webpack_require__(28),_$rootScope=new WeakMap,PresenceService=function(){function PresenceService($rootScope){var _this144=this;_classCallCheck(this,PresenceService),this.RAINBOW_PRESENCE_ONLINE="online",this.RAINBOW_PRESENCE_AWAY="away",this.RAINBOW_PRESENCE_DONOTDISTURB="dnd",this.RAINBOW_PRESENCE_OFFLINE="xa",this.RAINBOW_PRESENCE_BUSY="busy",this.RAINBOW_PRESENCE_UNKNOW="unknow",this.RAINBOW_ONCONTACTPRESENCECHANGED="rainbowcontactpresencechanged",this.RAINBOW_ONPRESENCECHANGED="rainbowpresencechanged",this.RAINBOW_ONCONTACTRICHPRESENCECHANGED="rainbowcontactrichpresencechanged",this.RAINBOW_ONRICHPRESENCECHANGED="rainbowrichpresencechanged",_$rootScope.set(this,$rootScope),xmpp_service_1.default.subscribeToContactEvents((function(event){"ON_CONTACT_PRESENCE_EVENT"===event.name&&_this144.onPresenceChangedEvent(event.name,event.data)})),$rootScope.$on("$destroy",$rootScope.$on("ON_UPDATE_CONTACT_RICH_STATUS_EVENT",(function(event,contact){return _this144.onRichPresenceChangedEvent(event,contact)})))}return _createClass(PresenceService,[{key:"setPresenceTo",value:function(strPresenceState){if(strPresenceState!==this.RAINBOW_PRESENCE_DONOTDISTURB&&strPresenceState!==this.RAINBOW_PRESENCE_AWAY&&strPresenceState!==this.RAINBOW_PRESENCE_OFFLINE&&strPresenceState!==this.RAINBOW_PRESENCE_ONLINE)throw new Error("Parameter 'strPresenceState' should be 'dnd', 'away', 'xa' (invisible) or 'online'");return RainbowLogger_1.rainbowLogger.sdk(PresenceService.logService+"[setPresenceTo] :: Set presence to "+strPresenceState),contact_service_1.default.changeMyPresence(strPresenceState),{code:sdkConstant_1.SDK.OK,label:"OK"}}},{key:"onPresenceChangedEvent",value:function(__event,json){var message=json.message||"''";json.jid===xmpp_service_1.default.fullJid?(RainbowLogger_1.rainbowLogger.sdk(PresenceService.logService+"[onPresenceChangedEvent] :: Presence changed for me ("+json.jid+") to  "+json.status+" | "+message),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONPRESENCECHANGED,json)):(RainbowLogger_1.rainbowLogger.sdk(PresenceService.logService+"[onPresenceChangedEvent] :: Presence changed for contact ("+json.jid+") to  "+json.status+" | "+message),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTPRESENCECHANGED,json))}},{key:"onRichPresenceChangedEvent",value:function(__event,contact){var message=contact.message||"''",telStatus=contact.telStatus||"''";if(xmpp_service_1.default.fullJid.includes(contact.jid)){RainbowLogger_1.rainbowLogger.sdk(PresenceService.logService+"[onPresenceChangedEvent] :: Rich Presence changed for myself to status "+contact.status+", message "+message+" and telStatus "+telStatus);var sdkEvent=new CustomEvent(this.RAINBOW_ONRICHPRESENCECHANGED,{detail:contact});document.dispatchEvent(sdkEvent)}else{RainbowLogger_1.rainbowLogger.sdk(PresenceService.logService+"[onPresenceChangedEvent] :: Rich Presence changed for contact ("+contact.jid+") to status "+contact.status+", message "+message+" and telStatus "+telStatus);var _sdkEvent=new CustomEvent(this.RAINBOW_ONCONTACTRICHPRESENCECHANGED,{detail:contact});document.dispatchEvent(_sdkEvent)}}}],[{key:"$inject",get:function(){return["$rootScope"]}}]),PresenceService}();PresenceService.logService="PresenceService | ",exports.PresenceService=PresenceService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var auth_service_1=__webpack_require__(2),RainbowLogger_1=__webpack_require__(9),contact_service_1=__webpack_require__(1),profile_service_1=__webpack_require__(6),_$rootScope=new WeakMap,_adminUserService=new WeakMap,UserProfileService=function(){function UserProfileService($rootScope,adminUserService){_classCallCheck(this,UserProfileService),_$rootScope.set(this,$rootScope),_adminUserService.set(this,adminUserService)}return _createClass(UserProfileService,[{key:"getProfile",value:function(){return auth_service_1.default.loggedInUser}},{key:"getProfileOffer",value:function(){return profile_service_1.default.getMyProfileName()}},{key:"updateFirstName",value:function(strFirstname){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee178(){var param,userData;return regenerator_default.a.wrap((function(_context179){for(;;)switch(_context179.prev=_context179.next){case 0:if(strFirstname&&"string"==typeof strFirstname&&!(strFirstname.length<1)){_context179.next=2;break}throw new Error("Parameter 'strFirstname' is missing, empty or null");case 2:return param={firstName:strFirstname},_context179.next=5,profile_service_1.default.setUserData(param);case 5:return userData=_context179.sent,_context179.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updateFirstName] :: First name updated"),userData.data));case 7:case"end":return _context179.stop()}}),_callee178)})))}},{key:"updateLastName",value:function(strLastName){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee179(){var param,userData;return regenerator_default.a.wrap((function(_context180){for(;;)switch(_context180.prev=_context180.next){case 0:if(strLastName&&"string"==typeof strLastName&&!(strLastName.length<1)){_context180.next=2;break}throw new Error("Parameter 'strFirstname' is missing, empty or null");case 2:return param={lastName:strLastName},_context180.next=5,profile_service_1.default.setUserData(param);case 5:return userData=_context180.sent,_context180.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updateFirstName] :: First name updated"),userData.data));case 7:case"end":return _context180.stop()}}),_callee179)})))}},{key:"updatePhoneNumber",value:function(type,deviceType,strPhoneNumber,country){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee180(){var phoneNumber,userData,newNumber,_newNumber,res;return regenerator_default.a.wrap((function(_context181){for(;;)switch(_context181.prev=_context181.next){case 0:if(type&&"string"==typeof type&&!(["home","work","other"].indexOf(type)<0)){_context181.next=2;break}throw new Error("Parameter 'type' is missing or not matching one of the following types: 'home', 'work', 'other'");case 2:if(deviceType&&"string"==typeof deviceType&&!(["landline","mobile","fax","other"].indexOf(deviceType)<0)){_context181.next=4;break}throw new Error("Parameter 'deviceType' is missing or not matching one of the following types 'landline', 'mobile', 'fax', 'other'");case 4:if("string"==typeof strPhoneNumber){_context181.next=6;break}throw new Error("Parameter 'strPhoneNumber' must be of type 'string' ");case 6:return phoneNumber={type:type,deviceType:deviceType,number:strPhoneNumber},country&&"string"==typeof country&&(phoneNumber.country=country),(userData=auth_service_1.default.loggedInUser).phoneNumbers.length?(!1,userData.phoneNumbers.some((function(number){return number.type===type&&number.deviceType===deviceType}))?userData.phoneNumbers.push(phoneNumber):(newNumber={type:type,deviceType:deviceType,number:strPhoneNumber},userData.phoneNumbers.push(newNumber))):(_newNumber={type:type,deviceType:deviceType,number:strPhoneNumber},userData.phoneNumbers.push(_newNumber)),_context181.next=12,profile_service_1.default.setUserData(userData);case 12:return res=_context181.sent,_context181.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updatePhoneNumber] :: Phone number updated"),res.data));case 14:case"end":return _context181.stop()}}),_callee180)})))}},{key:"deletePhoneNumber",value:function(type,deviceType){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee181(){var userData,res,retrievedPhoneNumbers,i;return regenerator_default.a.wrap((function(_context182){for(;;)switch(_context182.prev=_context182.next){case 0:if(type&&"string"==typeof type&&!(["home","work","other"].indexOf(type)<0)){_context182.next=2;break}throw new Error("Parameter 'type' is missing or not matching one of the following types: 'home', 'work', 'other'");case 2:if(deviceType&&"string"==typeof deviceType&&!(["landline","mobile","fax","other"].indexOf(deviceType)<0)){_context182.next=4;break}throw new Error("Parameter 'deviceType' is missing or not matching one of the following types 'landline', 'mobile', 'fax', 'other'");case 4:if((userData=auth_service_1.default.loggedInUser).phoneNumbers.length){_context182.next=7;break}throw new Error("No phone numbers associated with the user profile");case 7:for(retrievedPhoneNumbers=userData.phoneNumbers,i=0;i<retrievedPhoneNumbers.length;i++)retrievedPhoneNumbers[i].type===type&&retrievedPhoneNumbers[i].deviceType===deviceType&&retrievedPhoneNumbers.splice(i,1);return userData.phoneNumbers=retrievedPhoneNumbers,_context182.next=12,profile_service_1.default.setUserData(userData);case 12:return res=_context182.sent,RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[deletePhoneNumber] :: Phone number deleted"),_context182.abrupt("return",res.data);case 15:case"end":return _context182.stop()}}),_callee181)})))}},{key:"updatePhotoFromUrl",value:function(imgUrl){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee182(){return regenerator_default.a.wrap((function(_context183){for(;;)switch(_context183.prev=_context183.next){case 0:if(imgUrl&&"string"==typeof imgUrl&&!(imgUrl.length<1)){_context183.next=2;break}throw new Error("Parameter 'imgUrl' is missing, empty or null");case 2:return _context183.next=4,contact_service_1.default.pushAvatarImage(imgUrl);case 4:RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updatePhotoFromUrl] :: Photo updated");case 5:case"end":return _context183.stop()}}),_callee182)})))}},{key:"updateWorkEmail",value:function(strEmail){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee183(){var userData,emailExists,i,param,res;return regenerator_default.a.wrap((function(_context184){for(;;)switch(_context184.prev=_context184.next){case 0:if(strEmail&&"string"==typeof strEmail&&!(strEmail.length<1)){_context184.next=2;break}throw new Error("Parameter 'strEmail' is missing, empty or null");case 2:if(userData=auth_service_1.default.loggedInUser,emailExists=!1,userData.emails.length){for(i=0;i<userData.emails.length;i++)"work"===userData.emails[i].type&&(userData.emails[i].email=strEmail,emailExists=!0);emailExists||userData.emails.push({email:strEmail,type:"work"})}else userData.emails=[{email:strEmail,type:"work"}];return param={emails:userData.emails},_context184.next=8,profile_service_1.default.setUserData(param);case 8:return res=_context184.sent,_context184.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updateWorkEmail] :: work email updated"),res.data));case 10:case"end":return _context184.stop()}}),_callee183)})))}},{key:"updatePersonalEmail",value:function(strEmail){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee184(){var userData,emailExists,i,param,updatedUserData;return regenerator_default.a.wrap((function(_context185){for(;;)switch(_context185.prev=_context185.next){case 0:if(strEmail&&"string"==typeof strEmail&&!(strEmail.length<1)){_context185.next=2;break}throw new Error("Parameter 'strEmail' is missing, empty or null");case 2:if(userData=auth_service_1.default.loggedInUser,emailExists=!1,userData.emails.length){for(i=0;i<userData.emails.length;i++)"home"===userData.emails[i].type&&(userData.emails[i].email=strEmail,emailExists=!0);emailExists||userData.emails.push({email:strEmail,type:"home"})}else userData.emails=[{email:strEmail,type:"home"}];return param={emails:userData.emails},_context185.next=8,profile_service_1.default.setUserData(param);case 8:return updatedUserData=_context185.sent,_context185.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updatePersonalEmail] :: work email updated"),updatedUserData.data));case 10:case"end":return _context185.stop()}}),_callee184)})))}},{key:"deleteWorkEmail",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee185(){var param,updatedUserData;return regenerator_default.a.wrap((function(_context186){for(;;)switch(_context186.prev=_context186.next){case 0:return param={emails:auth_service_1.default.loggedInUser.emails.filter((function(element){return"work"!==element.type}))},_context186.next=3,profile_service_1.default.setUserData(param);case 3:return updatedUserData=_context186.sent,_context186.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[deleteWorkEmails] :: work emails deleted"),updatedUserData.data));case 5:case"end":return _context186.stop()}}),_callee185)})))}},{key:"deletePersonalEmail",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee186(){var param,updatedUserData;return regenerator_default.a.wrap((function(_context187){for(;;)switch(_context187.prev=_context187.next){case 0:return param={emails:auth_service_1.default.loggedInUser.emails.filter((function(element){return"home"!==element.type}))},_context187.next=3,profile_service_1.default.setUserData(param);case 3:return updatedUserData=_context187.sent,_context187.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[deletePersonalEmails] :: personal emails deleted"),updatedUserData.data));case 5:case"end":return _context187.stop()}}),_callee186)})))}},{key:"updateCountry",value:function(countryStr){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee187(){var param,updatedUserData;return regenerator_default.a.wrap((function(_context188){for(;;)switch(_context188.prev=_context188.next){case 0:return param={country:countryStr},_context188.next=3,profile_service_1.default.setUserData(param);case 3:return updatedUserData=_context188.sent,_context188.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updateCountry] :: Country updated"),updatedUserData.data));case 5:case"end":return _context188.stop()}}),_callee187)})))}},{key:"updateLanguage",value:function(languageStr){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee188(){var param,updatedUserData;return regenerator_default.a.wrap((function(_context189){for(;;)switch(_context189.prev=_context189.next){case 0:return param={language:languageStr},_context189.next=3,profile_service_1.default.setUserData(param);case 3:return updatedUserData=_context189.sent,_context189.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updateLanguage] :: Language updated"),updatedUserData.data));case 5:case"end":return _context189.stop()}}),_callee188)})))}},{key:"updateTitle",value:function(titleStr){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee189(){var param,updatedUserData;return regenerator_default.a.wrap((function(_context190){for(;;)switch(_context190.prev=_context190.next){case 0:return param={title:titleStr},_context190.next=3,profile_service_1.default.setUserData(param);case 3:return updatedUserData=_context190.sent,_context190.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updateTitle] :: title updated"),updatedUserData.data));case 5:case"end":return _context190.stop()}}),_callee189)})))}},{key:"updateNickName",value:function(nickNameStr){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee190(){var param,updatedUserData;return regenerator_default.a.wrap((function(_context191){for(;;)switch(_context191.prev=_context191.next){case 0:return param={nickName:nickNameStr},_context191.next=3,profile_service_1.default.setUserData(param);case 3:return updatedUserData=_context191.sent,_context191.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updateNickName] :: nickname updated"),updatedUserData.data));case 5:case"end":return _context191.stop()}}),_callee190)})))}},{key:"updateJobTitle",value:function(jobTitleStr){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee191(){var param,updatedUserData;return regenerator_default.a.wrap((function(_context192){for(;;)switch(_context192.prev=_context192.next){case 0:return param={jobTitle:jobTitleStr},_context192.next=3,profile_service_1.default.setUserData(param);case 3:return updatedUserData=_context192.sent,_context192.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(UserProfileService.logService+"[updateJobTitle] :: job title updated"),updatedUserData.data));case 5:case"end":return _context192.stop()}}),_callee191)})))}}],[{key:"$inject",get:function(){return["$rootScope","adminUserService"]}}]),UserProfileService}();UserProfileService.logService="UserProfileService | ",exports.UserProfileService=UserProfileService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var sdkConstant_1=__webpack_require__(28),contact_service_1=__webpack_require__(1),invitation_service_1=__webpack_require__(233),office365ad_service_1=__webpack_require__(413),profile_service_1=__webpack_require__(6),EventsService_1=__webpack_require__(22),_$rootScope=new WeakMap,_directoryService=new WeakMap,_companyDirectoryService=new WeakMap,_phonebookService=new WeakMap,ContactsService=function(){function ContactsService($rootScope,directoryService,companyDirectoryService,phonebookService){var _this145=this;_classCallCheck(this,ContactsService),this.RAINBOW_ONCONTACTINFORMATIONCHANGED="rainbowcontactinformationchanged",this.RAINBOW_ONINFORMATIONCHANGED="rainbowinformationchanged",this.RAINBOW_ONCONTACTINVITATIONNUMBERCHANGED="rainbowsubscriptionnumberchanged",this.RAINBOW_ONCONTACTINVITATIONRECEIVED="rainbowinvitationreceived",_$rootScope.set(this,$rootScope),_directoryService.set(this,directoryService),_companyDirectoryService.set(this,companyDirectoryService),_phonebookService.set(this,phonebookService),$rootScope.$on("$destroy",$rootScope.$on("ON_CONTACT_UPDATED_EVENT",(function(event,contact){return _this145.onContactInformationUpdated(event,contact)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_USER_CONTACT_UPDATED_EVENT",(function(event,contact){return _this145.onInformationUpdated(event,contact)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_INVITATIONS_NUMBER_UPDATED",(function(){return _this145.onInvitationNumberChanged()}))),$rootScope.$on("$destroy",$rootScope.$on("ON_INVITATION_CHANGED",(function(event,contact){return _this145.onInvitationReceived(event,contact)})))}return _createClass(ContactsService,[{key:"onContactInformationUpdated",value:function(__event,contact){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINFORMATIONCHANGED,contact)}},{key:"onInformationUpdated",value:function(__event,contact){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONINFORMATIONCHANGED,contact)}},{key:"onInvitationNumberChanged",value:function(){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINVITATIONNUMBERCHANGED,null)}},{key:"onInvitationReceived",value:function(__event,contact){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINVITATIONRECEIVED,contact)}},{key:"getContactByJID",value:function(strJID){return strJID?contact_service_1.default.getContactByJid(strJID):{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'strJID' is missing or empty"}}},{key:"getContactById",value:function(strId){return strId?contact_service_1.default.getContactById(strId):{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'strId' is missing or empty"}}},{key:"getNetworkContacts",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee192(){return regenerator_default.a.wrap((function(_context193){for(;;)switch(_context193.prev=_context193.next){case 0:return _context193.abrupt("return",contact_service_1.default.getContacts().filter((function(contact){return contact.id!==contact_service_1.default.userContact.id&&!contact.isBot&&contact.roster})));case 1:case"end":return _context193.stop()}}),_callee192)})))}},{key:"getAll",value:function(){return contact_service_1.default.getContacts().filter((function(contact){return contact.id!==contact_service_1.default.userContact.id&&!contact.isBot}))}},{key:"getConnectedUser",value:function(){return contact_service_1.default.userContact||null}},{key:"getConnectedUserPhone",value:function(){return contact_service_1.default.userContact?0===contact_service_1.default.userContact.pbxId.length?null:{phoneNumber:contact_service_1.default.userContact.phonePbx,pbxId:contact_service_1.default.userContact.pbxId}:null}},{key:"searchByName",value:function(strName,limit){var addRosters=arguments.length>2&&void 0!==arguments[2]&&arguments[2],companyId=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",excludeCompanyId=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee193(){var directoryService;return regenerator_default.a.wrap((function(_context194){for(;;)switch(_context194.prev=_context194.next){case 0:if(directoryService=_directoryService.get(this),strName){_context194.next=3;break}throw new Error("Parameter 'strName' is missing or empty");case 3:return limit||(limit=20),_context194.next=6,directoryService.search(strName,addRosters,Math.min(limit,1e3),companyId,excludeCompanyId);case 6:return _context194.abrupt("return",_context194.sent);case 7:case"end":return _context194.stop()}}),_callee193,this)})))}},{key:"searchPhonebook",value:function(strPattern){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee194(){var phonebookService,featureEnabled;return regenerator_default.a.wrap((function(_context195){for(;;)switch(_context195.prev=_context195.next){case 0:if(phonebookService=_phonebookService.get(this),featureEnabled=profile_service_1.default.isFeatureEnabled(profile_service_1.default.FeaturesEnum.TELEPHONY_PHONE_BOOK),strPattern){_context195.next=3;break}throw new Error("Parameter 'strPattern' is missing or empty");case 3:if(featureEnabled){_context195.next=5;break}throw new Error("The feature is not enabled for connected user");case 5:return _context195.abrupt("return",phonebookService.search(strPattern));case 6:case"end":return _context195.stop()}}),_callee194,this)})))}},{key:"searchOffice365",value:function(strPattern){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee195(){return regenerator_default.a.wrap((function(_context196){for(;;)switch(_context196.prev=_context196.next){case 0:if(strPattern){_context196.next=2;break}throw new Error("Parameter 'strPattern' is missing or empty");case 2:return _context196.next=4,office365ad_service_1.default.search(strPattern);case 4:return _context196.abrupt("return",_context196.sent);case 5:case"end":return _context196.stop()}}),_callee195)})))}},{key:"searchCompanyDirectory",value:function(strPattern,companyId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee196(){var companyDirectoryService;return regenerator_default.a.wrap((function(_context197){for(;;)switch(_context197.prev=_context197.next){case 0:if(companyDirectoryService=_companyDirectoryService.get(this),strPattern){_context197.next=3;break}throw new Error("Parameter 'strPattern' is missing or empty");case 3:return _context197.next=5,companyDirectoryService.search(strPattern,companyId);case 5:return _context197.abrupt("return",_context197.sent);case 6:case"end":return _context197.stop()}}),_callee196,this)})))}},{key:"searchByLogin",value:function(strLogin){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee197(){var directoryService;return regenerator_default.a.wrap((function(_context198){for(;;)switch(_context198.prev=_context198.next){case 0:if(directoryService=_directoryService.get(this),strLogin){_context198.next=3;break}throw new Error("Parameter 'strLogin' is missing or empty");case 3:return _context198.next=5,directoryService.searchUserByLogin(strLogin);case 5:return _context198.abrupt("return",_context198.sent);case 6:case"end":return _context198.stop()}}),_callee197,this)})))}},{key:"searchByJid",value:function(strJid){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee198(){var directoryService;return regenerator_default.a.wrap((function(_context199){for(;;)switch(_context199.prev=_context199.next){case 0:if(directoryService=_directoryService.get(this),strJid){_context199.next=3;break}throw new Error("Parameter 'strJid' is missing or empty");case 3:return _context199.next=5,directoryService.searchUserByJid(strJid);case 5:return _context199.abrupt("return",_context199.sent);case 6:case"end":return _context199.stop()}}),_callee198,this)})))}},{key:"searchById",value:function(strId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee199(){return regenerator_default.a.wrap((function(_context200){for(;;)switch(_context200.prev=_context200.next){case 0:if(strId){_context200.next=2;break}throw new Error("Parameter 'strId' is missing or empty");case 2:return _context200.next=4,contact_service_1.default.getContactByDBId(strId,!0);case 4:return _context200.abrupt("return",_context200.sent);case 5:case"end":return _context200.stop()}}),_callee199)})))}},{key:"acceptInvitation",value:function(invitation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee200(){return regenerator_default.a.wrap((function(_context201){for(;;)switch(_context201.prev=_context201.next){case 0:if(!invitation){_context201.next=6;break}return _context201.next=3,invitation_service_1.default.acceptInvitation(invitation);case 3:_context201.t0={code:sdkConstant_1.SDK.OK,label:"OK"},_context201.next=7;break;case 6:_context201.t0=new Error("Parameter 'invitation' is missing or null");case 7:return _context201.abrupt("return",_context201.t0);case 8:case"end":return _context201.stop()}}),_callee200)})))}},{key:"declineInvitation",value:function(invitation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee201(){return regenerator_default.a.wrap((function(_context202){for(;;)switch(_context202.prev=_context202.next){case 0:if(invitation){_context202.next=2;break}throw new Error("Parameter 'invitation' is missing or null");case 2:return _context202.next=4,invitation_service_1.default.declineInvitation(invitation);case 4:return _context202.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 5:case"end":return _context202.stop()}}),_callee201)})))}},{key:"addToNetwork",value:function(contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee202(){return regenerator_default.a.wrap((function(_context203){for(;;)switch(_context203.prev=_context203.next){case 0:if(contact){_context203.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:return _context203.next=4,invitation_service_1.default.joinContactInvitation(contact);case 4:return _context203.abrupt("return",_context203.sent);case 5:case"end":return _context203.stop()}}),_callee202)})))}},{key:"sendInvitationByEmail",value:function(email,customMessage){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee203(){return regenerator_default.a.wrap((function(_context204){for(;;)switch(_context204.prev=_context204.next){case 0:if(email){_context204.next=2;break}throw new Error("Parameter 'email' is missing or null");case 2:return _context204.next=4,invitation_service_1.default.sendInvitationByEmail(email,customMessage);case 4:return _context204.abrupt("return",_context204.sent);case 5:case"end":return _context204.stop()}}),_callee203)})))}},{key:"removeFromNetwork",value:function(contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee204(){return regenerator_default.a.wrap((function(_context205){for(;;)switch(_context205.prev=_context205.next){case 0:if(contact){_context205.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:return _context205.next=4,contact_service_1.default.removeContact(contact);case 4:return _context205.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 5:case"end":return _context205.stop()}}),_callee204)})))}},{key:"getInvitationById",value:function(strInvitationId){if(!strInvitationId)throw new Error("Parameter 'strInvitationId' is missing or null");return invitation_service_1.default.getInvitation(strInvitationId)}},{key:"getInvitationsReceived",value:function(){return invitation_service_1.default.getReceivedInvitations()}},{key:"cancelInvitation",value:function(invitation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee205(){return regenerator_default.a.wrap((function(_context206){for(;;)switch(_context206.prev=_context206.next){case 0:if(invitation){_context206.next=2;break}throw new Error("Parameter 'invitation' is missing or null");case 2:return _context206.next=4,invitation_service_1.default.cancelOneSendInvitation(invitation);case 4:case"end":return _context206.stop()}}),_callee205)})))}},{key:"getInvitationsSent",value:function(){return invitation_service_1.default.getSentInvitations()}},{key:"updateUserCustomData",value:function(customData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee206(){return regenerator_default.a.wrap((function(_context207){for(;;)switch(_context207.prev=_context207.next){case 0:if(customData){_context207.next=2;break}throw new Error("Parameter 'customData' is missing or null");case 2:return _context207.next=4,contact_service_1.default.updateUserContact({customData:customData});case 4:case"end":return _context207.stop()}}),_callee206)})))}}],[{key:"$inject",get:function(){return["$rootScope","directoryService","companyDirectoryService","phonebookService"]}}]),ContactsService}();ContactsService.logService="ContactService | ",exports.ContactsService=ContactsService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),contact_service_1=__webpack_require__(1),sdkConstant_1=__webpack_require__(28),_$rootScope=new WeakMap,_videoService=new WeakMap,_telephonyService=new WeakMap,_voiceMessageService=new WeakMap,_webrtcGatewayService=new WeakMap,PbxService=function(){function PbxService($rootScope,videoService,telephonyService,voiceMessageService,webrtcGatewayService){var _this146=this;_classCallCheck(this,PbxService),this.RAINBOW_ONTELEPHONYCALLSTATECHANGED="rainbowontelephonycallstatechanged",this.RAINBOW_ONVOIPCALLSTATECHANGED="rainbowonvoipcallstatechanged",this.RAINBOW_ONTELEPHONYSTARTED="rainbowontelephonystarted",this.RAINBOW_ONTELEPHONYSTOPPED="rainbowontelephonystopped",this.RAINBOW_ONTELEPHONYFORWARDSTATECHANGED="rainbowontelephonyforwardstatechanged",this.RAINBOW_ONCALLNOMADICEVENT="rainbowoncallnomadicevent",this.RAINBOW_ONVOIPSTARTED="rainbowonvoipstarted",this.RAINBOW_ONVOIPSTOPPED="rainbowonvoipstopped",this.RAINBOW_ONVOICEMESSAGEUPDATED="rainbowonvoicemessageupdated",this.RAINBOW_TELEPHONYDIALING="dialing",this.RAINBOW_TELEPHONYRINGINGOUTGOING="ringingOutgoing",this.RAINBOW_TELEPHONYINCOMING="incomingCall",this.RAINBOW_TELEPHONYACTIVE="active",this.RAINBOW_TELEPHONYRELEASING="releasing",this.RAINBOW_TELEPHONYUNKNOW="Unknown",this.RAINBOW_TELEPHONYMUTE="rainbowtelephonymute",_$rootScope.set(this,$rootScope),_videoService.set(this,videoService),_telephonyService.set(this,telephonyService),_voiceMessageService.set(this,voiceMessageService),_webrtcGatewayService.set(this,webrtcGatewayService),$rootScope.$on("$destroy",$rootScope.$on("ON_TELEPHONY_STATUS_CHANGED_EVENT",(function(event,state){return _this146.onTelephonyStateChanged(event,state)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CALL_NOMADIC_EVENT",(function(event,nomadicObject){return _this146.onCallNomadicEvent(event,nomadicObject)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CALL_UPDATED_EVENT",(function(event,call){return _this146.onTelephonyCallChanged(event,call)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CALL_FORWARDED_EVENT",(function(event,forwardStatus){return _this146.onCallForwardChanged(event,forwardStatus)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_WEBRTCGATEWAY_STATE_CHG",(function(event,state){return _this146.onVoIPStateChanged(event,state)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_VOICE_MESSAGE_UPDATE_EVENT",(function(event,counters){return _this146.onVoiceMessageUpdated(event,counters)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",(function(event,counters){return _this146.onCallMuteEvent(event,counters)})))}return _createClass(PbxService,[{key:"onTelephonyStateChanged",value:function(__event,state){RainbowLogger_1.rainbowLogger.sdk(PbxService.logService+"[onTelephonyStateChanged] :: PBX state changed to "+state),"started"===state?EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYSTARTED,null):EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYSTOPPED,null)}},{key:"onCallNomadicEvent",value:function(__event,nomadicObject){RainbowLogger_1.rainbowLogger.sdk(PbxService.logService+"[onCallNomadicEvent] :: Nomadic event received"),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCALLNOMADICEVENT,nomadicObject)}},{key:"onTelephonyCallChanged",value:function(__event,call){var isMediaPillarCallSituation=_webrtcGatewayService.get(this).isMediaPillarCallSituation(call);"Phone"!==call.type.value||isMediaPillarCallSituation?isMediaPillarCallSituation&&(RainbowLogger_1.rainbowLogger.sdk(PbxService.logService+"[onTelephonyCallChanged] :: Telephony state changed to "+call),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONVOIPCALLSTATECHANGED,call)):(RainbowLogger_1.rainbowLogger.sdk(PbxService.logService+"[onTelephonyCallChanged] :: Telephony state changed to "+call),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYCALLSTATECHANGED,call))}},{key:"onCallForwardChanged",value:function(__event,forwardStatus){RainbowLogger_1.rainbowLogger.sdk(PbxService.logService+"[onCallForwardChanged] :: Forward state changed to "+forwardStatus),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYFORWARDSTATECHANGED,forwardStatus)}},{key:"onVoIPStateChanged",value:function(__event,state){RainbowLogger_1.rainbowLogger.sdk(PbxService.logService+"[onVoIPStateChanged] :: VoIP state changed to "+state?"true":"false"),state?EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONVOIPSTARTED,null):EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONVOIPSTOPPED,null)}},{key:"onVoiceMessageUpdated",value:function(__event,counters){RainbowLogger_1.rainbowLogger.sdk(PbxService.logService+"[onVoiceMessageUpdated] :: New Voice Message event received"),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONVOICEMESSAGEUPDATED,counters)}},{key:"onCallMuteEvent",value:function(__event,data){RainbowLogger_1.rainbowLogger.sdk(PbxService.logService+"[onCallMuteEvent] :: New Mute Event received"),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_TELEPHONYMUTE,data)}},{key:"isTelephonyAvailable",value:function(){return _telephonyService.get(this).started}},{key:"isVoiceMailConfigured",value:function(){var telephonyService=_telephonyService.get(this);return Boolean(telephonyService.voiceMailFeatureEnabled&&telephonyService.voicemailNumber)}},{key:"getAgentVersion",value:function(){return _telephonyService.get(this).agentStatus.agentVersion||"unknown"}},{key:"getXMPPAgentStatus",value:function(){return _telephonyService.get(this).agentStatus.xmppAgent||"unknown"}},{key:"getPhoneAPIStatus",value:function(){return _telephonyService.get(this).agentStatus.phoneApi||"unknown"}},{key:"makeCall1PCC",value:function(strPhoneNumber,contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee207(){var webrtcGatewayService;return regenerator_default.a.wrap((function(_context208){for(;;)switch(_context208.prev=_context208.next){case 0:if(webrtcGatewayService=_webrtcGatewayService.get(this),strPhoneNumber){_context208.next=3;break}throw new Error("Parameter 'strPhoneNumber' is missing or empty");case 3:return _context208.abrupt("return",webrtcGatewayService.mediaPillarMakeCall1PCC(strPhoneNumber,contact));case 4:case"end":return _context208.stop()}}),_callee207,this)})))}},{key:"makeCall",value:function(contact,strPhoneNumber,callSubject,correlatorData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee208(){var telephonyService;return regenerator_default.a.wrap((function(_context209){for(;;)switch(_context209.prev=_context209.next){case 0:if(telephonyService=_telephonyService.get(this),strPhoneNumber){_context209.next=3;break}throw new Error("Parameter 'strPhoneNumber' is missing or empty");case 3:if(!contact){_context209.next=8;break}return _context209.next=6,telephonyService.makeCall(contact,strPhoneNumber,callSubject,correlatorData);case 6:_context209.next=10;break;case 8:return _context209.next=10,telephonyService.makeCallByPhoneNumber(strPhoneNumber,callSubject,correlatorData);case 10:return _context209.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 11:case"end":return _context209.stop()}}),_callee208,this)})))}},{key:"callByNumber",value:function(strPhoneNumber){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee209(){var telephonyService;return regenerator_default.a.wrap((function(_context210){for(;;)switch(_context210.prev=_context210.next){case 0:if(telephonyService=_telephonyService.get(this),strPhoneNumber){_context210.next=3;break}throw new Error("Parameter 'strPhoneNumber' is missing or empty");case 3:return _context210.next=5,telephonyService.makeCallByPhoneNumber(strPhoneNumber);case 5:return _context210.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 6:case"end":return _context210.stop()}}),_callee209,this)})))}},{key:"callWithMessage",value:function(contact,phoneNumber,callSubject,correlatorData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee210(){var telephonyService;return regenerator_default.a.wrap((function(_context211){for(;;)switch(_context211.prev=_context211.next){case 0:if(telephonyService=_telephonyService.get(this),contact){_context211.next=3;break}throw new Error("Parameter 'contact' is missing or empty");case 3:if(phoneNumber){_context211.next=5;break}throw new Error("Parameter 'phoneNumber' is missing or empty");case 5:if(callSubject){_context211.next=7;break}throw new Error("Parameter 'callSubject' is missing or empty");case 7:return _context211.next=9,telephonyService.makeCall(contact,phoneNumber,callSubject,correlatorData);case 9:return _context211.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 10:case"end":return _context211.stop()}}),_callee210,this)})))}},{key:"callWithSubject",value:function(contact,phoneNumber,callSubject){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee211(){var telephonyService;return regenerator_default.a.wrap((function(_context212){for(;;)switch(_context212.prev=_context212.next){case 0:if(telephonyService=_telephonyService.get(this),contact){_context212.next=3;break}throw new Error("Parameter 'contact' is missing or empty");case 3:if(phoneNumber){_context212.next=5;break}throw new Error("Parameter 'phoneNumber' is missing or empty");case 5:if(callSubject){_context212.next=7;break}throw new Error("Parameter 'callSubject' is missing or empty");case 7:return _context212.next=9,telephonyService.makeCall(contact,phoneNumber,callSubject);case 9:return _context212.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 10:case"end":return _context212.stop()}}),_callee211,this)})))}},{key:"calls",value:function(){return _telephonyService.get(this).calls}},{key:"getActiveCall",value:function(){return _telephonyService.get(this).getActiveCall()}},{key:"release",value:function(call){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee212(){var telephonyService;return regenerator_default.a.wrap((function(_context213){for(;;)switch(_context213.prev=_context213.next){case 0:if(telephonyService=_telephonyService.get(this),call){_context213.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:return _context213.next=5,telephonyService.releaseCall(call);case 5:return _context213.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 6:case"end":return _context213.stop()}}),_callee212,this)})))}},{key:"deflectToVM",value:function(call){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee213(){var telephonyService;return regenerator_default.a.wrap((function(_context214){for(;;)switch(_context214.prev=_context214.next){case 0:if(telephonyService=_telephonyService.get(this),call){_context214.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:if(call.connectionId){_context214.next=5;break}throw new Error("Property 'connectionId' of the object 'call' is missing or null");case 5:if("Phone"===call.type.value){_context214.next=7;break}throw new Error("Call must be of type 'Phone' (see call.type.value)");case 7:return _context214.next=9,telephonyService.deflectCallToVM(call);case 9:return _context214.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 10:case"end":return _context214.stop()}}),_callee213,this)})))}},{key:"forwardToDevice",value:function(strPhoneNumber){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee214(){var telephonyService;return regenerator_default.a.wrap((function(_context215){for(;;)switch(_context215.prev=_context215.next){case 0:if(telephonyService=_telephonyService.get(this),strPhoneNumber&&"string"==typeof strPhoneNumber&&0!==strPhoneNumber.length){_context215.next=3;break}throw new Error("Parameter 'strPhoneNumber' is missing or empty");case 3:return _context215.abrupt("return",(telephonyService.forwardToDevice(strPhoneNumber),{code:sdkConstant_1.SDK.OK,label:"OK"}));case 4:case"end":return _context215.stop()}}),_callee214,this)})))}},{key:"forwardToVoicemail",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee215(){var telephonyService;return regenerator_default.a.wrap((function(_context216){for(;;)switch(_context216.prev=_context216.next){case 0:return telephonyService=_telephonyService.get(this),_context216.next=3,telephonyService.forwardToVoicemail();case 3:return _context216.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 4:case"end":return _context216.stop()}}),_callee215,this)})))}},{key:"cancelForward",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee216(){var telephonyService;return regenerator_default.a.wrap((function(_context217){for(;;)switch(_context217.prev=_context217.next){case 0:return telephonyService=_telephonyService.get(this),_context217.next=3,telephonyService.cancelForward();case 3:return _context217.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 4:case"end":return _context217.stop()}}),_callee216,this)})))}},{key:"getForwardStatusFromServer",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee217(){var telephonyService;return regenerator_default.a.wrap((function(_context218){for(;;)switch(_context218.prev=_context218.next){case 0:return telephonyService=_telephonyService.get(this),_context218.next=3,telephonyService.getForwardStatus().then((function(){return{code:sdkConstant_1.SDK.OK,label:"OK"}}));case 3:case"end":return _context218.stop()}}),_callee217,this)})))}},{key:"getForwardStatus",value:function(){return _telephonyService.get(this).getForwardObject()}},{key:"answer",value:function(call){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee218(){var telephonyService,webrtcGatewayService;return regenerator_default.a.wrap((function(_context219){for(;;)switch(_context219.prev=_context219.next){case 0:if(telephonyService=_telephonyService.get(this),webrtcGatewayService=_webrtcGatewayService.get(this),call){_context219.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:if(!call.mediaPillarCall){_context219.next=7;break}webrtcGatewayService.answerCall(call),_context219.next=9;break;case 7:return _context219.next=9,telephonyService.answerCall(call);case 9:return _context219.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 10:case"end":return _context219.stop()}}),_callee218,this)})))}},{key:"hold",value:function(call){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee219(){var telephonyService;return regenerator_default.a.wrap((function(_context220){for(;;)switch(_context220.prev=_context220.next){case 0:if(telephonyService=_telephonyService.get(this),call){_context220.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:return _context220.next=5,telephonyService.holdCall(call);case 5:return _context220.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 6:case"end":return _context220.stop()}}),_callee219,this)})))}},{key:"retrieve",value:function(call){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee220(){var telephonyService;return regenerator_default.a.wrap((function(_context221){for(;;)switch(_context221.prev=_context221.next){case 0:if(telephonyService=_telephonyService.get(this),call){_context221.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:return _context221.next=5,telephonyService.retrieveCall(call);case 5:return _context221.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 6:case"end":return _context221.stop()}}),_callee220,this)})))}},{key:"transferCall",value:function(activeCall,heldCall){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee221(){var telephonyService;return regenerator_default.a.wrap((function(_context222){for(;;)switch(_context222.prev=_context222.next){case 0:if(telephonyService=_telephonyService.get(this),activeCall){_context222.next=3;break}throw new Error("Parameter 'activeCall' is missing or null");case 3:if(heldCall){_context222.next=5;break}throw new Error("Parameter 'heldCall' is missing or null");case 5:return _context222.next=7,telephonyService.transfertCall(activeCall,heldCall);case 7:return _context222.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 8:case"end":return _context222.stop()}}),_callee221,this)})))}},{key:"conferenceCall",value:function(activeCall,heldCall){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee222(){var telephonyService;return regenerator_default.a.wrap((function(_context223){for(;;)switch(_context223.prev=_context223.next){case 0:if(telephonyService=_telephonyService.get(this),activeCall){_context223.next=3;break}throw new Error("Parameter 'activeCall' is missing or null");case 3:if(heldCall){_context223.next=5;break}throw new Error("Parameter 'heldCall' is missing or null");case 5:return _context223.next=7,telephonyService.conferenceCall(activeCall,heldCall);case 7:return _context223.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 8:case"end":return _context223.stop()}}),_callee222,this)})))}},{key:"fetchVoiceMailMessagesNumber",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee223(){var voiceMessageService;return regenerator_default.a.wrap((function(_context224){for(;;)switch(_context224.prev=_context224.next){case 0:return voiceMessageService=_voiceMessageService.get(this),_context224.next=3,voiceMessageService.getVoiceMessagesCounters();case 3:return _context224.abrupt("return",_context224.sent);case 4:case"end":return _context224.stop()}}),_callee223,this)})))}},{key:"muteCall",value:function(call,conversation){var webrtcGatewayService=_webrtcGatewayService.get(this);if(!call)throw new Error("Parameter 'call' is missing or null");webrtcGatewayService.muteAudio(call,!0,conversation)}},{key:"unmuteCall",value:function(call,conversation){var webrtcGatewayService=_webrtcGatewayService.get(this);if(!call)throw new Error("Parameter 'call' is missing or null");webrtcGatewayService.muteAudio(call,!1,conversation)}},{key:"nomadicLogin",value:function(phoneNumber,isUnchangeableNumber,notTakeIntoAccount){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee224(){var telephonyService;return regenerator_default.a.wrap((function(_context225){for(;;)switch(_context225.prev=_context225.next){case 0:if(telephonyService=_telephonyService.get(this),phoneNumber){_context225.next=3;break}throw new Error("Parameter 'phoneNumber' is missing or null");case 3:return _context225.next=5,telephonyService.nomadicLogin(phoneNumber,isUnchangeableNumber,notTakeIntoAccount);case 5:case"end":return _context225.stop()}}),_callee224,this)})))}},{key:"nomadicLogout",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee225(){var telephonyService;return regenerator_default.a.wrap((function(_context226){for(;;)switch(_context226.prev=_context226.next){case 0:return telephonyService=_telephonyService.get(this),_context226.next=3,telephonyService.nomadicLogout();case 3:case"end":return _context226.stop()}}),_callee225,this)})))}},{key:"getNomadicState",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee226(){var telephonyService;return regenerator_default.a.wrap((function(_context227){for(;;)switch(_context227.prev=_context227.next){case 0:return telephonyService=_telephonyService.get(this),_context227.next=3,telephonyService.getNomadicStatus();case 3:case"end":return _context227.stop()}}),_callee226,this)})))}},{key:"setExternalNomadicNumber",value:function(phoneNumber){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee227(){var telephonyService;return regenerator_default.a.wrap((function(_context228){for(;;)switch(_context228.prev=_context228.next){case 0:if(telephonyService=_telephonyService.get(this),phoneNumber){_context228.next=3;break}throw new Error("Parameter 'phoneNumber' is missing or null");case 3:if("string"==typeof phoneNumber){_context228.next=5;break}throw new Error("Parameter 'phoneNumber' is not a string");case 5:return _context228.next=7,telephonyService.nomadicLogin(phoneNumber);case 7:case"end":return _context228.stop()}}),_callee227,this)})))}},{key:"setNomadicOfficePhone",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee228(){var telephonyService;return regenerator_default.a.wrap((function(_context229){for(;;)switch(_context229.prev=_context229.next){case 0:return telephonyService=_telephonyService.get(this),_context229.next=3,telephonyService.nomadicLoginOnOfficePhone();case 3:case"end":return _context229.stop()}}),_callee228,this)})))}},{key:"setNomadicVoIP",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee229(){var webrtcGatewayService,telephonyService,mediapillar;return regenerator_default.a.wrap((function(_context230){for(;;)switch(_context230.prev=_context230.next){case 0:return webrtcGatewayService=_webrtcGatewayService.get(this),telephonyService=_telephonyService.get(this),mediapillar=webrtcGatewayService.getMyMediaPillarRemoteExtension(),_context230.next=3,telephonyService.nomadicLogin(mediapillar);case 3:case"end":return _context230.stop()}}),_callee229,this)})))}},{key:"setNomadicWebRTC",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee230(){var webrtcGatewayService,telephonyService,mediapillar;return regenerator_default.a.wrap((function(_context231){for(;;)switch(_context231.prev=_context231.next){case 0:return webrtcGatewayService=_webrtcGatewayService.get(this),telephonyService=_telephonyService.get(this),mediapillar=webrtcGatewayService.getMyMediaPillarRemoteExtension(),_context231.next=3,telephonyService.nomadicLogin(mediapillar);case 3:case"end":return _context231.stop()}}),_callee230,this)})))}},{key:"isDeskPhoneAvailable",value:function(){return!contact_service_1.default.userContact.isVirtualTerm}},{key:"isVoIPAvailable",value:function(){return _webrtcGatewayService.get(this).isMediaPillarAvailable()}},{key:"logonCCD",value:function(endpointTel,agentId,password,groupId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee231(){var telephonyService;return regenerator_default.a.wrap((function(_context232){for(;;)switch(_context232.prev=_context232.next){case 0:if(telephonyService=_telephonyService.get(this),endpointTel){_context232.next=3;break}throw new Error("Parameter 'endpointTel' is missing or empty");case 3:return _context232.next=5,telephonyService.logonCCD(endpointTel,agentId,password,groupId);case 5:return _context232.abrupt("return",_context232.sent);case 6:case"end":return _context232.stop()}}),_callee231,this)})))}},{key:"logoffCCD",value:function(endpointTel,agentId,password,groupId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee232(){var telephonyService;return regenerator_default.a.wrap((function(_context233){for(;;)switch(_context233.prev=_context233.next){case 0:if(telephonyService=_telephonyService.get(this),endpointTel){_context233.next=3;break}throw new Error("Parameter 'endpointTel' is missing or empty");case 3:return _context233.next=5,telephonyService.logoffCCD(endpointTel,agentId,password,groupId);case 5:return _context233.abrupt("return",_context233.sent);case 6:case"end":return _context233.stop()}}),_callee232,this)})))}},{key:"withdrawalCCD",value:function(agentId,groupId,status){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee233(){var telephonyService;return regenerator_default.a.wrap((function(_context234){for(;;)switch(_context234.prev=_context234.next){case 0:return telephonyService=_telephonyService.get(this),_context234.next=3,telephonyService.withdrawalCCD(agentId,groupId,status);case 3:return _context234.abrupt("return",_context234.sent);case 4:case"end":return _context234.stop()}}),_callee233,this)})))}},{key:"wrapupCCD",value:function(agentId,groupId,password,status){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee234(){return regenerator_default.a.wrap((function(_context235){for(;;)switch(_context235.prev=_context235.next){case 0:return _context235.abrupt("return",_telephonyService.get(this).wrapupCCD(agentId,groupId,password,status));case 1:case"end":return _context235.stop()}}),_callee234,this)})))}},{key:"sendDTMF",value:function(dialString,call){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee235(){var videoService,telephonyService;return regenerator_default.a.wrap((function(_context236){for(;;)switch(_context236.prev=_context236.next){case 0:if(videoService=_videoService.get(this),telephonyService=_telephonyService.get(this),dialString){_context236.next=3;break}throw new Error("Parameter 'dialString' is missing or empty");case 3:if(call){_context236.next=5;break}throw new Error("Parameter 'call' is missing or empty");case 5:if("Video"!==call.type.value){_context236.next=7;break}return _context236.abrupt("return",videoService.sendDTMF(dialString,call,!1));case 7:if("Phone"!==call.type.value){_context236.next=9;break}return _context236.abrupt("return",telephonyService.sendDtmf(call,dialString));case 9:if("Video"===call.type.value&&"Phone"===call.type.value){_context236.next=11;break}throw new Error("Parameter 'call' must be of type 'Video' or 'Phone'");case 11:return _context236.abrupt("return",!0);case 12:case"end":return _context236.stop()}}),_callee235,this)})))}}],[{key:"$inject",get:function(){return["$rootScope","videoService","telephonyService","voiceMessageService","webrtcGatewayService"]}}]),PbxService}();PbxService.logService="TelephonyService | ",exports.PbxService=PbxService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),_$rootScope=new WeakMap,_Conversation=new WeakMap,_conversationService=new WeakMap,ConversationsService=function(){function ConversationsService($rootScope,Conversation,conversationService){var _this147=this;_classCallCheck(this,ConversationsService),this.RAINBOW_ONCONVERSATIONSMISSEDCOUNTERCHANGED="rainbowconversationsmissedcounterchanged",this.RAINBOW_ONCONVERSATIONSCHANGED="rainbowconversationschanged",this.RAINBOW_ONCONVERSATIONREMOVED="rainbowconversationremoved",this.RAINBOW_ONCONVERSATIONCHANGED="rainbowconversationchanged",_$rootScope.set(this,$rootScope),_Conversation.set(this,Conversation),_conversationService.set(this,conversationService),$rootScope.$on("$destroy",$rootScope.$on("ON_CONVERSATIONS_UPDATED_EVENT",(function(event,conversation){return _this147.onConversationsChanged(event,conversation)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONVERSATION_REMOVE_EVENT",(function(event,conversation){return _this147.onConversationsRemoved(event,conversation)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONVERSATION_UPDATED_EVENT",(function(event,conversation){return _this147.onConversationChanged(event,conversation)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_MISSED_COUNTER_CHANGED_EVENT",(function(event,json){return _this147.onConversationsCounterChanged(event,json)})))}return _createClass(ConversationsService,[{key:"onConversationsChanged",value:function(__event,conversation){conversation&&EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONSCHANGED,conversation)}},{key:"onConversationsRemoved",value:function(__event,conversation){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONREMOVED,conversation)}},{key:"onConversationChanged",value:function(__event,conversation){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONCHANGED,conversation)}},{key:"onConversationsCounterChanged",value:function(__event,json){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONSMISSEDCOUNTERCHANGED,json)}},{key:"getAllConversations",value:function(){return _conversationService.get(this).getConversations()}},{key:"getCallById",value:function(strCallId){var conversationService=_conversationService.get(this);if(!strCallId)throw new Error("Parameter 'strCallId' is missing or empty");var allConversations=conversationService.getConversations(),call=null;return allConversations.forEach((function(conversation){conversation.videoCall&&conversation.videoCall.id===strCallId?call=conversation.videoCall:conversation.audioCall&&conversation.audioCall.id===strCallId&&(call=conversation.audioCall)})),call}},{key:"getConversationById",value:function(strId){var conversationService=_conversationService.get(this);if(!strId)throw new Error("Parameter 'callId' is missing or empty");return conversationService.getConversationById(strId)}},{key:"getConversationByBubbleId",value:function(strBubbleId){var conversationService=_conversationService.get(this);if(!strBubbleId)throw new Error("Parameter 'strBubbleId' is missing or empty");return conversationService.getConversationByRoomDbId(strBubbleId)}},{key:"openConversationForContact",value:function(contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee236(){var conversationService;return regenerator_default.a.wrap((function(_context237){for(;;)switch(_context237.prev=_context237.next){case 0:if(conversationService=_conversationService.get(this),contact){_context237.next=3;break}throw new Error("Parameter 'contact' is missing or null");case 3:return RainbowLogger_1.rainbowLogger.sdk(ConversationsService.logService+"[openConversationForContact] :: Trying to open a conversation for a contact"),_context237.next=6,conversationService.getOrCreateOneToOneConversation(contact.jid);case 6:return _context237.abrupt("return",_context237.sent);case 7:case"end":return _context237.stop()}}),_callee236,this)})))}},{key:"openConversationForBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee237(){var conversationService;return regenerator_default.a.wrap((function(_context238){for(;;)switch(_context238.prev=_context238.next){case 0:if(conversationService=_conversationService.get(this),bubble){_context238.next=3;break}throw new Error("Prameter 'bubble' is missing or null");case 3:return RainbowLogger_1.rainbowLogger.sdk(ConversationsService.logService+"[openConversationForBubble] :: Try to create or get a conversation for a bubble "),_context238.next=6,conversationService.getRoomConversation(bubble.jid);case 6:return _context238.abrupt("return",_context238.sent);case 7:case"end":return _context238.stop()}}),_callee237,this)})))}},{key:"closeConversation",value:function(conversation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee238(){var conversationService;return regenerator_default.a.wrap((function(_context239){for(;;)switch(_context239.prev=_context239.next){case 0:if(conversationService=_conversationService.get(this),conversation){_context239.next=3;break}throw new Error("Parametr 'conversation' is missing or null");case 3:return _context239.next=5,conversationService.closeConversation(conversation);case 5:case"end":return _context239.stop()}}),_callee238,this)})))}}],[{key:"$inject",get:function(){return["$rootScope","Conversation","conversationService"]}}]),ConversationsService}();ConversationsService.logService="ConversationsService | ",exports.ConversationsService=ConversationsService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var EventsService_1=__webpack_require__(22),RainbowLogger_1=__webpack_require__(9),message_1=__webpack_require__(16),sdkConstant_1=__webpack_require__(28),fileStorage_service_1=__webpack_require__(25),room_service_1=__webpack_require__(33),_$rootScope=new WeakMap,_conversationService=new WeakMap,_Conversation=new WeakMap,ImService=function(){function ImService($rootScope,conversationService,Conversation){var _this148=this;_classCallCheck(this,ImService),this.RAINBOW_ONNEWIMMESSAGERECEIVED="rainbownewimmessagereceived",this.RAINBOW_ONNEWIMRECEIPTRECEIVED="rainbownewimreceiptreceived",this.RAINBOW_ONNEWPARTICIPANTSTATUS="rainbownewparticipantstatus",_$rootScope.set(this,$rootScope),_conversationService.set(this,conversationService),_Conversation.set(this,Conversation),$rootScope.$on("$destroy",$rootScope.$on("ON_CONVERSATION_MESSAGE_RECEIVED",(function(event,message,conversation,cc){return _this148.onNewImMessageReceived(event,message,conversation,cc)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONVERSATION_RECEIPT_RECEIVED",(function(event,message,conversation,evt){return _this148.onNewImReceiptReceived(event,message,conversation,evt)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONVERSATIONS_STATUS_MESSAGE_EVENT",(function(event,conversation,participant,status){return _this148.onNewParticipantStatus(event,conversation,participant,status)})))}return _createClass(ImService,[{key:"onNewImMessageReceived",value:function(__event,message,conversation,cc){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONNEWIMMESSAGERECEIVED,{message:message,conversation:conversation,cc:cc})}},{key:"onNewImReceiptReceived",value:function(__event,message,conversation,evt){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONNEWIMRECEIPTRECEIVED,{message:message,conversation:conversation,evt:evt})}},{key:"onNewParticipantStatus",value:function(__event,participant,conversation,status){status&&status.value&&EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONNEWPARTICIPANTSTATUS,{participant:participant,conversation:conversation,status:status.value})}},{key:"getMessagesFromConversation",value:function(conversation){var intNbMessage=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee239(){var conversationService;return regenerator_default.a.wrap((function(_context240){for(;;)switch(_context240.prev=_context240.next){case 0:if(conversationService=_conversationService.get(this),conversation){_context240.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:return intNbMessage=intNbMessage?Math.min(intNbMessage,100):30,_context240.next=6,conversationService.conversationServiceBulkHistoryHandler.getHistoryPage(conversation,intNbMessage);case 6:return _context240.abrupt("return",_context240.sent);case 7:case"end":return _context240.stop()}}),_callee239,this)})))}},{key:"getMessageFromConversationById",value:function(conversation,strMessageId){if(!conversation)throw new Error("Parameter 'conversation' is missing or null");if(!strMessageId)throw new Error("Parameter 'strMessageId' is missing or empty");var message=conversation.getMessageById(strMessageId);return message&&message.fileId&&(message.shortFileDescriptor=fileStorage_service_1.default.getFileDescriptorById(message.fileId)),message}},{key:"getMessageFromBubbleById",value:function(bubble,strMessageId){var conversationService=_conversationService.get(this),Conversation=_Conversation.get(this);if(!bubble)throw new Error("Parameter 'bubble' is missing or null");if(!strMessageId)throw new Error("Parameter 'strMessageId' is missing or empty");var conversation=conversationService.getConversationByRoomDbId(bubble.dbId);if(!conversation)throw new Error("Parameter 'bubble' don't have a conversation");if(conversation.type!==Conversation.Type.ROOM)throw new Error("Parameter 'conversation' is not a bubble conversation");var message=conversation.getMessageById(strMessageId);return message&&message.fileId&&(message.shortFileDescriptor=fileStorage_service_1.default.getFileDescriptorById(message.fileId)),message}},{key:"sendMessageToConversation",value:function(conversation,strMessage,alternativeContentType,alternativeContentMessage){var urgency=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"std",conversationService=_conversationService.get(this);if(!conversation)throw new Error("Parameter 'conversation' is missing or null");if(!strMessage)throw new Error("Parameter 'strMessage' is missing or empty");if("string"!=typeof strMessage)throw new Error("Parameter 'strMessage' must be a string");if(strMessage.length>1024)throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");var alternativeContent=null;if(alternativeContentMessage){if(alternativeContentMessage.length>1024)throw new Error("Parameter 'alternativeContent.message' should be shorter than 1024 characters");if(!alternativeContentType||"text"!==alternativeContentType&&"markdown"!==alternativeContentType&&"rainbow/json"!==alternativeContentType)throw new Error("Parameter 'alternativeContent.type' should be set to either 'text', 'markdown' or 'rainbow/json'");"rainbow/json"===alternativeContentType&&(alternativeContentMessage=JSON.stringify(alternativeContentMessage)),alternativeContent={type:alternativeContentType,message:alternativeContentMessage}}if("high"!==urgency&&"middle"!==urgency&&"low"!==urgency&&"std"!==urgency)throw new Error("Parameter 'urgency' should be set to either 'high', 'middle', 'low' or 'std'");return conversationService.sendChatMessage(conversation,strMessage,alternativeContent,null,null,urgency)}},{key:"sendCorrectedChatMessage",value:function(conversation,strMessage,messageId){var conversationService=_conversationService.get(this);if(RainbowLogger_1.rainbowLogger.sdk(ImService.logService+"[sendCorrectedChatMessage] :: Trying to send a corrected message"),!conversation)throw new Error("Parameter 'conversation' is missing or null");if(!strMessage)throw new Error("Parameter 'strMessage' is missing or empty");if(strMessage.length>1024)throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");if(!messageId)throw new Error("Parameter 'messageId' is missing or empty");return conversationService.sendCorrectedChatMessage(conversation,strMessage,messageId),conversation.getMessageById(messageId)}},{key:"replyToMessage",value:function(conversation,strMessage,answerMessage){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee240(){var conversationService;return regenerator_default.a.wrap((function(_context241){for(;;)switch(_context241.prev=_context241.next){case 0:if(conversationService=_conversationService.get(this),!conversation){_context241.next=7;break}if(!strMessage){_context241.next=6;break}if(!answerMessage){_context241.next=5;break}return _context241.abrupt("return",(conversationService.sendChatMessage(conversation,strMessage,null,answerMessage),answerMessage));case 5:throw new Error("Parameter 'answerMessage' is missing or null");case 6:throw new Error("Parameter 'strMessage' is missing or null");case 7:throw new Error("Parameter 'conversation' is missing or null");case 8:case"end":return _context241.stop()}}),_callee240,this)})))}},{key:"deleteMessage",value:function(conversation,messageId){var conversationService=_conversationService.get(this);if(!conversation)throw new Error("Parameter 'conversation' is missing or null");if(!messageId)throw new Error("Parameter 'messageId' is missing or empty");return conversationService.sendCorrectedChatMessage(conversation,"",messageId),conversation.getMessageById(messageId)}},{key:"sendIsTypingStateInConversation",value:function(conversation,status){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee241(){var conversationService;return regenerator_default.a.wrap((function(_context242){for(;;)switch(_context242.prev=_context242.next){case 0:if(conversationService=_conversationService.get(this),conversation){_context242.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if("boolean"==typeof status){_context242.next=5;break}throw new Error("Parameter 'status' is missing or null");case 5:if(conversation=conversation.id?conversationService.getConversationById(conversation.id):null){_context242.next=7;break}throw new Error("Parameter 'conversation': this conversation doesn't exist");case 7:conversationService.sendIsTypingState(conversation,status);case 8:case"end":return _context242.stop()}}),_callee241,this)})))}},{key:"sendMessageToBubble",value:function(bubble,strMessage){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee242(){var conversationService,conversation,message;return regenerator_default.a.wrap((function(_context243){for(;;)switch(_context243.prev=_context243.next){case 0:if(conversationService=_conversationService.get(this),bubble){_context243.next=3;break}throw new Error("Parameter 'bubble' is missing or null");case 3:if(strMessage){_context243.next=5;break}throw new Error("Parameter 'strMessage' is missing or empty");case 5:if(!(strMessage.length>1024)){_context243.next=7;break}throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");case 7:return _context243.next=9,conversationService.getRoomConversation(bubble.jid);case 9:if(conversation=_context243.sent){_context243.next=12;break}throw new Error("No 'conversation' found");case 12:if(_context243.t0=bubble.isActive,_context243.t0){_context243.next=16;break}return _context243.next=16,room_service_1.default.sendInitialRoomPresenceSync(bubble);case 16:return message=conversationService.sendChatMessage(conversation,strMessage),_context243.abrupt("return",message);case 18:case"end":return _context243.stop()}}),_callee242,this)})))}},{key:"sendIsTypingStateInBubble",value:function(bubble,status){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee243(){var conversationService,conversation;return regenerator_default.a.wrap((function(_context244){for(;;)switch(_context244.prev=_context244.next){case 0:if(conversationService=_conversationService.get(this),bubble){_context244.next=3;break}throw new Error("Parameter 'bubble' is missing or null");case 3:if("boolean"==typeof status){_context244.next=5;break}throw new Error("Parameter 'status' is missing or null");case 5:if(bubble.jid){_context244.next=7;break}throw new Error("Parameter 'bubble': this bubble is not a valid one");case 7:return _context244.next=9,conversationService.getRoomConversation(bubble.jid);case 9:if(conversation=_context244.sent){_context244.next=12;break}throw new Error("No 'conversation' found for this bubble");case 12:conversationService.sendIsTypingState(conversation,status);case 13:case"end":return _context244.stop()}}),_callee243,this)})))}},{key:"removeAllMessagesFromConversation",value:function(conversation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee244(){var conversationService,Conversation;return regenerator_default.a.wrap((function(_context245){for(;;)switch(_context245.prev=_context245.next){case 0:if(conversationService=_conversationService.get(this),Conversation=_Conversation.get(this),!conversation){_context245.next=7;break}if(conversation.type===Conversation.Type.ONE_TO_ONE||conversation.type===Conversation.Type.BOT){_context245.next=4;break}throw new Error("Parameter 'conversation' is not a one-to-one conversation");case 4:return _context245.next=6,conversationService.removeAllMessages(conversation);case 6:return _context245.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 7:throw new Error("Parameter 'conversation' is missing or null");case 8:case"end":return _context245.stop()}}),_callee244,this)})))}},{key:"markMessageFromConversationAsRead",value:function(conversation,message){var conversationService=_conversationService.get(this);if(!message)throw new Error("Parameter 'message' is missing or empty");if(!conversation)throw new Error("Parameter 'conversation' is missing or null");if(message.receiptStatus===message_1.Message.ReceiptStatus.READ)throw new Error("Parameter 'message' is aldready marked as read");return conversationService.sendAckReadMessage(conversation,message),message.receiptStatus===message_1.Message.ReceiptStatus.READ&&conversationService.decreaseMissedIMCounterForConversation(conversation),{code:sdkConstant_1.SDK.OK,label:"OK"}}}],[{key:"$inject",get:function(){return["$rootScope","conversationService","Conversation"]}}]),ImService}();ImService.logService="IMService | ",exports.ImService=ImService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var sdkConfig_1=__webpack_require__(39),settings_service_1=__webpack_require__(5),xmpp_service_1=__webpack_require__(4),call_model_1=__webpack_require__(0),RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),sdkConstant_1=__webpack_require__(28),_$rootScope=new WeakMap,_videoService=new WeakMap,_platformService=new WeakMap,_extensionSharingService=new WeakMap,_webrtcGatewayService=new WeakMap,_recordsService=new WeakMap,_conversationService=new WeakMap,WebRTCService=function(){function WebRTCService($rootScope,videoService,platformService,extensionSharingService,webrtcGatewayService,recordsService,conversationService){var _this149=this;_classCallCheck(this,WebRTCService),this.DetectRTC=window.DetectRTC,this.RAINBOW_ONWEBRTCCALLSTATECHANGED="rainbowonwebrtccallstatechanged",this.RAINBOW_ONVOIPCALLSTATECHANGED="rainbowonvoipcallstatechanged",this.RAINBOW_ONWEBRTCMEDIADEVICECHANGED="rainbowonwebrtcmediadevicechanged",this.RAINBOW_ONWEBRTCERRORHANDLED="rainbowonwebrtcerrorhandled",this.RAINBOW_ONWEBRTCSTREAMADDED="rainbowonwebrtcstreamadded",this.RAINBOW_ONWEBRTCTRACKCHANGED="rainbowonwebrtctrackchanged",this.RAINBOW_ONCHROMESTOPSCREENSHARINGTRIGGERED="rainbowonchromestopscreensharingtriggered",this.RAINBOW_ONWEBRTCTMEDIAERROROCCURED="rainbowonwebrtcmediaerroroccured",this.RAINBOW_ONWEBRTCTRECORDSTARTED="rainbowonwebrtcrecordstarted",this.RAINBOW_ONWEBRTCTRECORDSTOPPED="rainbowonwebrtcrecordstopped",this.RAINBOW_ONWEBRTCTRECORDPAUSED="rainbowonwebrtcrecordpaused",this.RAINBOW_ONWEBRTCTRECORDREMOTESTARTED="rainbowonwebrtcrecordremotestarted",this.RAINBOW_ONWEBRTCTRECORDREMOTESTOPPED="rainbowonwebrtcrecordremotestopped",this.RAINBOW_ONWEBRTCTRECORDDONE="rainbowonwebrtcrecorddone",this.RAINBOW_ONWEBRTCTRECORDERROR="rainbowonwebrtcrecorderror",_$rootScope.set(this,$rootScope),_videoService.set(this,videoService),_platformService.set(this,platformService),_extensionSharingService.set(this,extensionSharingService),_webrtcGatewayService.set(this,webrtcGatewayService),_recordsService.set(this,recordsService),_conversationService.set(this,conversationService),$rootScope.$on("$destroy",$rootScope.$on("ON_CALL_UPDATED_EVENT",(function(event,call){return _this149.onWebRTCCallChanged(event,call)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_WEBRTC_CALL_ERROR_EVENT",(function(event,error){return _this149.onWebRTCErrorHandled(event,error)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_WEBRTC_REMOTE_STREAM_ADDED",(function(event,streams){return _this149.onWebRTCRemoteStreamAdded(event,streams)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_WEBRTC_CALL_ESCALATION_SUCCESS",(function(event,call){return _this149.onWebRTCEscalation(event,call)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_WEBRTC_CALL_ESCALATION",(function(event,call){return _this149.onWebRTCEscalation(event,call)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED",(function(){return _this149.onChromeStopScreenSharingTrigerred()}))),$rootScope.$on("$destroy",$rootScope.$on("ON_WEBRTC_RECORD_SAVED",(function(event,description,data,source){return _this149.onWebRTCRecordingData(event,description,data,source)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_WEBRTC_RECORD_ERROR",(function(){return _this149.onWebRTCRecordingError()}))),$rootScope.$on("$destroy",$rootScope.$on("ON_RECORDING_START_MSG_RECEIVED",(function(){return _this149.onWebRTCRecordingStartedByRemote()}))),$rootScope.$on("$destroy",$rootScope.$on("ON_RECORDING_STOP_MSG_RECEIVED",(function(){return _this149.onWebRTCRecordingStoppedByRemote()})))}return _createClass(WebRTCService,[{key:"onWebRTCCallChanged",value:function(__event,call){var webrtcGatewayService=_webrtcGatewayService.get(this),videoService=_videoService.get(this);call.type.value!==call_model_1.Call.Type.WEBRTC.value||webrtcGatewayService.isMediaPillarCallSituation(call)||(EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCCALLSTATECHANGED,call),"active"===call.status.value&&call.unifiedPlanActivated&&videoService.attachDistantMediaStreamsUnifiedPlan(call))}},{key:"onWebRTCErrorHandled",value:function(__event,error){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCERRORHANDLED,error)}},{key:"onWebRTCRemoteStreamAdded",value:function(__event,streams){var _this150=this;setTimeout((function(){EventsService_1.eventsService.dispatchEvent(_this150.RAINBOW_ONWEBRTCSTREAMADDED,streams)}),100)}},{key:"onWebRTCEscalation",value:function(__event,call){var _this151=this;setTimeout((function(){EventsService_1.eventsService.dispatchEvent(_this151.RAINBOW_ONWEBRTCTRACKCHANGED,call)}),100)}},{key:"onChromeStopScreenSharingTrigerred",value:function(){var _this152=this;setTimeout((function(){EventsService_1.eventsService.dispatchEvent(_this152.RAINBOW_ONCHROMESTOPSCREENSHARINGTRIGGERED,null)}),100)}},{key:"onWebRTCRecordingData",value:function(__event,description,data,source){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDDONE,[description,data,source])}},{key:"onWebRTCRecordingError",value:function(){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDERROR,null)}},{key:"onWebRTCRecordingStartedByRemote",value:function(){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDREMOTESTARTED,null)}},{key:"onWebRTCRecordingStoppedByRemote",value:function(){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDREMOTESTOPPED,null)}},{key:"setUnifiedPlan",value:function(){var videoService=_videoService.get(this);if(!0===sdkConfig_1.sdkConfig.unifiedPlan){if(!videoService.config)return RainbowLogger_1.rainbowLogger.sdk("WebRTC Service: Unified plan set to true"),videoService.config={},videoService.config.unifiedPlan=!0,!0;RainbowLogger_1.rainbowLogger.sdk("WebRTC Service: Unified plan set to true"),videoService.config.unifiedPlan=!0}return!1}},{key:"canMakeAudioVideoCall",value:function(){return("https:"===location.protocol||"chrome-extension:"===location.protocol)&&this.DetectRTC.isWebRTCSupported&&this.DetectRTC.isGetUserMediaSupported}},{key:"hasAMicrophone",value:function(){return this.DetectRTC.hasMicrophone}},{key:"hasACamera",value:function(){return this.DetectRTC.hasWebcam}},{key:"useMicrophone",value:function(strMicrophoneId){return strMicrophoneId?(settings_service_1.default.setSetting("microphone",strMicrophoneId),settings_service_1.default.setSetting("headsetMicrophone",strMicrophoneId),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'strMicrophoneId' is missing or empty"}}},{key:"useSpeaker",value:function(strSpeakerId){var platformService=_platformService.get(this);return strSpeakerId?(settings_service_1.default.setSetting("speaker",strSpeakerId),settings_service_1.default.setSetting("headsetSpeaker",strSpeakerId),settings_service_1.default.setSetting("ringingSpeaker",strSpeakerId),platformService.setSpeakerForElement(document.getElementById("largevideo"),strSpeakerId),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'strSpeakerId' is missing or empty"}}},{key:"useCamera",value:function(strCameraId){return strCameraId?(settings_service_1.default.setSetting("camera",strCameraId),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'strCameraId' is missing or empty"}}},{key:"callInAudio",value:function(contact,subject){var videoService=_videoService.get(this);return contact?this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),videoService.makeCall(contact,"audio",subject),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'contact' is missing or null"}}},{key:"callInVideo",value:function(contact,subject){var videoService=_videoService.get(this);return contact?this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),videoService.makeCall(contact,"video",subject),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'contact' is missing or null"}}},{key:"callInSharing",value:function(contact,subject){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee245(){var videoService,raw;return regenerator_default.a.wrap((function(_context246){for(;;)switch(_context246.prev=_context246.next){case 0:if(videoService=_videoService.get(this),!contact){_context246.next=15;break}if(!(navigator.userAgent.indexOf("Chrome")>-1)){_context246.next=14;break}if(raw=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),!(parseInt(raw[2],10)>72)){_context246.next=8;break}_context246.t0=(videoService.makeDesktopSharingCall(contact,"sharingOnly",subject),{code:sdkConstant_1.SDK.OK,label:"OK"}),_context246.next=13;break;case 8:return _context246.next=10,this.canMakeDesktopSharingCall();case 10:this.setUnifiedPlan(),videoService.makeDesktopSharingCall(contact,"sharingOnly",subject),_context246.t0={code:sdkConstant_1.SDK.OK,label:"OK"};case 13:return _context246.abrupt("return",_context246.t0);case 14:return _context246.abrupt("return",(this.setUnifiedPlan(),videoService.makeDesktopSharingCall(contact,"sharingOnly",subject),{code:sdkConstant_1.SDK.OK,label:"OK"}));case 15:throw new Error("Parameter 'contact' is missing or null");case 16:case"end":return _context246.stop()}}),_callee245,this)})))}},{key:"callinAudioWithSharing",value:function(contact,subject){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee246(){var videoService,userAgent,raw;return regenerator_default.a.wrap((function(_context247){for(;;)switch(_context247.prev=_context247.next){case 0:if(videoService=_videoService.get(this),userAgent=navigator.userAgent,contact){_context247.next=3;break}return _context247.abrupt("return",{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'contact' is missing or null"});case 3:if(!(userAgent.indexOf("Chrome")>-1)){_context247.next=13;break}if(raw=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),!(parseInt(raw[2],10)>72)){_context247.next=7;break}return _context247.abrupt("return",(videoService.makeDesktopSharingCall(contact,subject),{code:sdkConstant_1.SDK.OK,label:"OK"}));case 7:return _context247.next=9,this.canMakeDesktopSharingCall();case 9:this.setUnifiedPlan(),videoService.makeDesktopSharingCall(contact,subject),_context247.next=14;break;case 13:this.setUnifiedPlan(),videoService.makeDesktopSharingCall(contact,subject);case 14:return _context247.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 15:case"end":return _context247.stop()}}),_callee246,this)})))}},{key:"answerInAudio",value:function(call){var videoService=_videoService.get(this);return call?this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),videoService.answerCall(call,"audio"),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"answerInVideo",value:function(call){var videoService=_videoService.get(this);return call?this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),videoService.answerCall(call,"video"),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"getPeerConnectionForCall",value:function(call){return call?call.id?xmpp_service_1.default.connection.jingle.sessions[call.id].peerconnection:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Can not get the call ID"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"showLocalVideo",value:function(){var videoService=_videoService.get(this);return this.canMakeAudioVideoCall()?(videoService.attachLocalMediaStreams(!0),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}},{key:"hideLocalVideo",value:function(){var videoService=_videoService.get(this);return this.canMakeAudioVideoCall()?(videoService.attachLocalMediaStreams(!1),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}},{key:"showRemoteVideo",value:function(call){var videoService=_videoService.get(this);return call?this.canMakeAudioVideoCall()?(videoService.attachDistantMediaStreams(!0,call),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"hideRemoteVideo",value:function(call){var videoService=_videoService.get(this);return call?this.canMakeAudioVideoCall()?(videoService.attachDistantMediaStreams(!1,call),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"addVideoToCall",value:function(call){var videoService=_videoService.get(this);return this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),videoService.addVideoToCall(call,!1),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}},{key:"addSharingToCall",value:function(call){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee247(){var videoService,userAgent,raw;return regenerator_default.a.wrap((function(_context248){for(;;)switch(_context248.prev=_context248.next){case 0:if(videoService=_videoService.get(this),userAgent=navigator.userAgent,call){_context248.next=3;break}throw new Error("Parameter 'call' is missing or null");case 3:if(userAgent.indexOf("Chrome")>-1){_context248.next=5;break}return _context248.abrupt("return",(this.setUnifiedPlan(),videoService.addSharingToCall(call),{code:sdkConstant_1.SDK.OK,label:"OK"}));case 5:return raw=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),parseInt(raw[2],10)>72&&videoService.addSharingToCall(call),_context248.next=9,this.canMakeDesktopSharingCall();case 9:return this.setUnifiedPlan(),videoService.addSharingToCall(call),_context248.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 12:case"end":return _context248.stop()}}),_callee247,this)})))}},{key:"removeVideoFromCall",value:function(call){var videoService=_videoService.get(this);return this.canMakeAudioVideoCall()?(this.setUnifiedPlan(),videoService.removeVideoFromCall(call),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}},{key:"removeSharingFromCall",value:function(call){var videoService=_videoService.get(this);return this.setUnifiedPlan(),videoService.removeSharingFromCall(call),{code:sdkConstant_1.SDK.OK,label:"OK"}}},{key:"release",value:function(call){var videoService=_videoService.get(this);return call?(this.canMakeAudioVideoCall()||RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"release called but WebRTC is not supported by your browser"),videoService.rejectCall(call),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"}}},{key:"muteAudioCall",value:function(conversation){var videoService=_videoService.get(this);return conversation?this.canMakeAudioVideoCall()?(videoService.muteAudio(conversation,!0),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'conversation' is missing or null"}}},{key:"unmuteAudioCall",value:function(conversation){var videoService=_videoService.get(this);return conversation?this.canMakeAudioVideoCall()?(videoService.muteAudio(conversation,!1),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}:{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'conversation' is missing or null"}}},{key:"getLocalStreamsFromCall",value:function(call){if(!call||!("id"in call))return{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or empty"};if(call.type!==call_model_1.Call.Type.WEBRTC)return{code:sdkConstant_1.SDK.ERRORNOTFOUND,label:"This call is not an audio or audio/video call"};var session=xmpp_service_1.default.connection.jingle.sessions[call.id];return session?session.localStreams:[]}},{key:"getRemoteStreamsFromCall",value:function(call){if(!call||!("id"in call))return{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or empty"};if(call.type!==call_model_1.Call.Type.WEBRTC)return{code:sdkConstant_1.SDK.ERRORNOTFOUND,label:"This call is not an audio or audio/video call"};var session=xmpp_service_1.default.connection.jingle.sessions[call.id];return session?session.remoteStreamsObject:[]}},{key:"setChromeExtensionIdForSharing",value:function(strExtensionId){var extensionSharingService=_extensionSharingService.get(this);return strExtensionId?(extensionSharingService.setExtensionId(strExtensionId),extensionSharingService.start(),{code:sdkConstant_1.SDK.OK,label:"OK"}):{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'strExtensionId' is missing or empty"}}},{key:"canMakeDesktopSharingCall",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee248(){var extensionSharingService,userAgent,raw;return regenerator_default.a.wrap((function(_context249){for(;;)switch(_context249.prev=_context249.next){case 0:if(extensionSharingService=_extensionSharingService.get(this),!((userAgent=navigator.userAgent).indexOf("Firefox")>-1)){_context249.next=3;break}return _context249.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 3:if(userAgent.indexOf("Chrome")>-1){_context249.next=9;break}return _context249.next=6,extensionSharingService.isExtensionInstalled();case 6:if(!_context249.sent){_context249.next=8;break}return _context249.abrupt("return",(WebRTCService.isChromeExtensionInstalled=!0,{code:sdkConstant_1.SDK.OK,label:"OK"}));case 8:throw WebRTCService.isChromeExtensionInstalled=!1,new Error("Not Chrome Extension installed for desktop sharing");case 9:if(raw=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),!(parseInt(raw[2],10)>72)){_context249.next=12;break}return _context249.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 12:case"end":return _context249.stop()}}),_callee248,this)})))}},{key:"startRecording",value:function(call,fileName,recordRemote,toUpload,onlyAudio,mimeType){var _this153=this,recordsService=_recordsService.get(this),conversationService=_conversationService.get(this);if(RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[startRecording] :: Enter"),!call)return{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'call' is missing or null"};if(!fileName)return{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Parameter 'fileName' is missing or null"};if(recordRemote=null==recordRemote||recordRemote,toUpload=null==toUpload||toUpload,onlyAudio=null!=onlyAudio&&onlyAudio,mimeType=null==mimeType?"video/webm;codecs=vp9":mimeType,RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[startRecording] :: Prepare recording..."),recordsService.createRecord(call.id,null,recordRemote?"REMOTE":"LOCAL",toUpload,fileName,onlyAudio,mimeType)){recordsService.setOnPauseCallback((function(){RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[onRTCChange] :: WebRTC recording paused"),EventsService_1.eventsService.dispatchEvent(_this153.RAINBOW_ONWEBRTCTRECORDPAUSED,null)})),RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[startRecording] :: Start recording"),recordsService.startRecording();var conversation=conversationService.getConversationById(call.conversationId);return conversation?(RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[startRecording] :: Notify remote peer"),conversationService.sendRecordingMessage(conversation,"start")):RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[startRecording] :: No conversation found - can't notify remote peer"),RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[startRecording] :: WebRTC recording started"),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDSTARTED,null),{code:sdkConstant_1.SDK.OK,label:"OK"}}return RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[startRecording] :: can't start a webRTC recording"),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDERROR,null),{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"Can't record the conversation"}}},{key:"stopRecording",value:function(call){var recordsService=_recordsService.get(this),conversationService=_conversationService.get(this);RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[stopRecording] :: Stop current WebRTC recording"),recordsService.setOnPauseCallback(null),recordsService.stopRecording();var conversation=conversationService.getConversationById(call.conversationId);return conversation?(RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[stopRecording] :: Notify remote peer"),conversationService.sendRecordingMessage(conversation,"stop")):RainbowLogger_1.rainbowLogger.sdk(WebRTCService.logService+"[stopRecording] :: No conversation found - can't notify remote peer"),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDSTOPPED,null),{code:sdkConstant_1.SDK.OK,label:"OK"}}}],[{key:"$inject",get:function(){return["$rootScope","videoService","platformService","extensionSharingService","webrtcGatewayService","recordsService","conversationService"]}}]),WebRTCService}();WebRTCService.logService="WebRTCService | ",WebRTCService.isChromeExtensionInstalled=!1,exports.WebRTCService=WebRTCService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),room_model_1=__webpack_require__(226),promiseQueue_1=__webpack_require__(49),contact_service_1=__webpack_require__(1),room_service_1=__webpack_require__(33),_videoService=new WeakMap,_conversationService=new WeakMap,_conferenceService=new WeakMap,_webConferenceService=new WeakMap,_$rootScope=new WeakMap,BubblesService=function(){function BubblesService(videoService,conversationService,conferenceService,webConferenceService,$rootScope){var _this154=this;_classCallCheck(this,BubblesService),this.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED="rainbowbubblerequesttojoin",this.RAINBOW_ONBUBBLEUPDATED="rainbowbubbleupdated",this.RAINBOW_ONBUBBLEAVATARUPDATED="rainbowbubbleavatarupdated",this.RAINBOW_ONBUBBLEDEACTIVATED="rainbowonbubbledeactivated",_videoService.set(this,videoService),_conversationService.set(this,conversationService),_conferenceService.set(this,conferenceService),_webConferenceService.set(this,webConferenceService),_$rootScope.set(this,$rootScope),$rootScope.$on("$destroy",$rootScope.$on(room_service_1.default.ROOM_UPDATE_EVENT,(function(event,room){return _this154.onBubbleUpdatedEvent(event,room)}))),$rootScope.$on("$destroy",$rootScope.$on(room_service_1.default.ROOM_AVATAR_UPDATE_EVENT,(function(){return _this154.onAvatarUpdatedEvent()}))),$rootScope.$on("$destroy",$rootScope.$on("ROOM_INVITATION",(function(event,room){return _this154.onRoomInvitationEvent(event,room)})))}return _createClass(BubblesService,[{key:"onBubbleUpdatedEvent",value:function(__event,room){room&&!1===room.isActive?EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEDEACTIVATED,room):EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEUPDATED,room)}},{key:"onAvatarUpdatedEvent",value:function(){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEAVATARUPDATED,null)}},{key:"onRoomInvitationEvent",value:function(__event,room){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED,room)}},{key:"createBubble",value:function(strName,strDescription){var boolWithHistory=arguments.length>2&&void 0!==arguments[2]&&arguments[2],disableNotifications=arguments.length>3&&void 0!==arguments[3]&&arguments[3],urlAvatar=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,autoAcceptInvitation=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee249(){var conversationService,bubble,description,history,notifications,autoAccept,conversation;return regenerator_default.a.wrap((function(_context250){for(;;)switch(_context250.prev=_context250.next){case 0:if(conversationService=_conversationService.get(this),bubble=null,description=strDescription||"",history=Boolean(boolWithHistory),notifications=Boolean(disableNotifications),autoAccept=Boolean(autoAcceptInvitation),strName){_context250.next=5;break}throw new Error("Parameter 'strName' is missing or empty");case 5:return _context250.next=7,room_service_1.default.createRoom(strName,description,history,urlAvatar,notifications,!1,!1,autoAccept);case 7:return bubble=_context250.sent,_context250.next=10,conversationService.getRoomConversation(bubble.jid);case 10:return conversation=_context250.sent,_context250.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(BubblesService.logService+"[createBubble] :: New bubble "+strName+" created successfully"),room_service_1.default.sendInitialRoomPresence(conversation.room),bubble));case 12:case"end":return _context250.stop()}}),_callee249,this)})))}},{key:"deleteBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee250(){var closedBubble;return regenerator_default.a.wrap((function(_context251){for(;;)switch(_context251.prev=_context251.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null){_context251.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return _context251.next=4,this.closeBubble(bubble);case 4:return closedBubble=_context251.sent,_context251.abrupt("return",room_service_1.default.ownerDeleteRoom(closedBubble));case 6:case"end":return _context251.stop()}}),_callee250,this)})))}},{key:"deleteAllBubbles",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee251(){var deleteallBubblePromiseQueue,_this155=this;return regenerator_default.a.wrap((function(_context252){for(;;)switch(_context252.prev=_context252.next){case 0:deleteallBubblePromiseQueue=promiseQueue_1.PromiseQueue.create(),room_service_1.default.getMyRooms().forEach((function(bubble){deleteallBubblePromiseQueue.add((function(){return _this155.deleteBubble(bubble)}))}));case 2:case"end":return _context252.stop()}}),_callee251)})))}},{key:"inviteContactToBubble",value:function(contact,bubble){var boolAsModerator=arguments.length>2&&void 0!==arguments[2]&&arguments[2],boolWithInvitation=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee252(){var privilege,withoutInvitation,isActive,isAway,isInvited,isRejected,isDeleted,_updatedBubble,_updatedBubble2,updatedBubble;return regenerator_default.a.wrap((function(_context253){for(;;)switch(_context253.prev=_context253.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,contact){_context253.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(bubble){_context253.next=4;break}throw new Error("Parameter 'bubble' is missing or null");case 4:if(privilege=room_model_1.Room.Privilege.USER,boolAsModerator&&(privilege=room_model_1.Room.Privilege.MODERATOR),withoutInvitation=!1,"boolean"==typeof boolWithInvitation&&(withoutInvitation=!boolWithInvitation),isActive=!1,isAway=!1,isInvited=!1,isRejected=!1,isDeleted=!1,bubble.users.forEach((function(user){if(user.contact.id===contact.id)switch(user.status){case"invited":isInvited=!0;break;case"accepted":isActive=!0;break;case"unsubscribed":isAway=!0;break;case"rejected":isRejected=!0;break;case"deleted":isDeleted=!0}})),!isActive&&!isInvited){_context253.next=11;break}throw new Error("Contact has been already invited or is already a member of the room");case 11:if(!isAway&&!isRejected){_context253.next=16;break}return _context253.next=14,room_service_1.default.ownerReinviteRejectedUser(bubble,contact,null,privilege,withoutInvitation);case 14:return _updatedBubble=_context253.sent,_context253.abrupt("return",(_updatedBubble.updateAvatarInfo(),_updatedBubble));case 16:if(!isDeleted){_context253.next=21;break}return _context253.next=19,room_service_1.default.ownerReinviteDeletedUser(bubble,contact,null,privilege);case 19:return _updatedBubble2=_context253.sent,_context253.abrupt("return",(_updatedBubble2.updateAvatarInfo(),_updatedBubble2));case 21:return _context253.next=23,room_service_1.default.addRoomUser(bubble,contact,null,privilege,withoutInvitation);case 23:return updatedBubble=_context253.sent,_context253.abrupt("return",(updatedBubble.updateAvatarInfo(),updatedBubble));case 25:case"end":return _context253.stop()}}),_callee252)})))}},{key:"removeContactFromBubble",value:function(contact,bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee253(){var contactStatus,updatedBubble,_updatedBubble3;return regenerator_default.a.wrap((function(_context254){for(;;)switch(_context254.prev=_context254.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,contact){_context254.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(bubble){_context254.next=4;break}throw new Error("Parameter 'bubble' is missing or is null");case 4:contactStatus="",_context254.t0=(bubble.users.forEach((function(user){user.contact.id===contact.id&&(contactStatus=user.status)})),contactStatus),_context254.next=_context254.t0===room_service_1.default.RoomUserStatus.INVITED?8:_context254.t0===room_service_1.default.RoomUserStatus.ACCEPTED?12:16;break;case 8:return _context254.next=10,room_service_1.default.ownerDeletesUserFromRoom(bubble,contact);case 10:return updatedBubble=_context254.sent,_context254.abrupt("return",(updatedBubble.updateAvatarInfo(),updatedBubble));case 12:return _context254.next=14,room_service_1.default.unsubscribeUserFromRoom(bubble,contact);case 14:return _updatedBubble3=_context254.sent,_context254.abrupt("return",(_updatedBubble3.updateAvatarInfo(),_updatedBubble3));case 16:return _context254.abrupt("return",bubble);case 17:case"end":return _context254.stop()}}),_callee253)})))}},{key:"promoteContactToModerator",value:function(contact,bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee254(){var updatedBubble;return regenerator_default.a.wrap((function(_context255){for(;;)switch(_context255.prev=_context255.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,contact){_context255.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(bubble){_context255.next=4;break}throw new Error("Parameter 'bubble' is missing or is null");case 4:return _context255.next=6,room_service_1.default.updateRoomUser(bubble,contact,null,"moderator");case 6:return updatedBubble=_context255.sent,_context255.abrupt("return",(updatedBubble.updateAvatarInfo(),updatedBubble));case 8:case"end":return _context255.stop()}}),_callee254)})))}},{key:"demoteContactFromModerator",value:function(contact,bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee255(){var updatedBubble;return regenerator_default.a.wrap((function(_context256){for(;;)switch(_context256.prev=_context256.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,contact){_context256.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(bubble){_context256.next=4;break}throw new Error("Parameter 'bubble' is missing or is null");case 4:return _context256.next=6,room_service_1.default.updateRoomUser(bubble,contact,null,"user");case 6:return updatedBubble=_context256.sent,_context256.abrupt("return",(updatedBubble.updateAvatarInfo(),updatedBubble));case 8:case"end":return _context256.stop()}}),_callee255)})))}},{key:"changeOwner",value:function(contact,bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee256(){var updatedBubble;return regenerator_default.a.wrap((function(_context257){for(;;)switch(_context257.prev=_context257.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,contact){_context257.next=2;break}throw new Error("Parameter 'contact' is missing or null");case 2:if(bubble){_context257.next=4;break}throw new Error("Parameter 'bubble' is missing or is null");case 4:return _context257.next=6,room_service_1.default.changeRoomOwner(bubble,contact);case 6:return updatedBubble=_context257.sent,_context257.abrupt("return",(updatedBubble.updateAvatarInfo(),updatedBubble));case 8:case"end":return _context257.stop()}}),_callee256)})))}},{key:"acceptInvitationToJoinBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee257(){return regenerator_default.a.wrap((function(_context258){for(;;)switch(_context258.prev=_context258.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null){_context258.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return _context258.next=4,room_service_1.default.acceptRoomInvitation(bubble);case 4:return _context258.abrupt("return",bubble);case 5:case"end":return _context258.stop()}}),_callee257)})))}},{key:"declineInvitationToJoinBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee258(){return regenerator_default.a.wrap((function(_context259){for(;;)switch(_context259.prev=_context259.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null){_context259.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return _context259.next=4,room_service_1.default.declineRoomInvitation(bubble);case 4:return _context259.abrupt("return",_context259.sent);case 5:case"end":return _context259.stop()}}),_callee258)})))}},{key:"leaveBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee259(){var hasOtherModerator;return regenerator_default.a.wrap((function(_context260){for(;;)switch(_context260.prev=_context260.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null){_context260.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:if(hasOtherModerator=!1,bubble.users.forEach((function(user){contact_service_1.default.isUserContact(user)||"moderator"===user.privilege&&"accepted"===user.status&&(hasOtherModerator=!0)})),hasOtherModerator){_context260.next=5;break}throw new Error("Can't leave the bubble. No other moderator");case 5:_context260.t0=bubble.status,_context260.next=_context260.t0===room_service_1.default.RoomUserStatus.UNSUBSCRIBED?8:11;break;case 8:return _context260.next=10,room_service_1.default.participantCloseRoom(bubble);case 10:return _context260.abrupt("return",_context260.sent);case 11:return _context260.next=13,room_service_1.default.unsubscribeMeFromRoom(bubble);case 13:return _context260.abrupt("return",_context260.sent);case 14:case"end":return _context260.stop()}}),_callee259)})))}},{key:"closeBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee260(){return regenerator_default.a.wrap((function(_context261){for(;;)switch(_context261.prev=_context261.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null){_context261.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:if(_context261.t0=this.isBubbleArchived(bubble),_context261.t0){_context261.next=6;break}return _context261.next=6,room_service_1.default.ownerArchiveRoom(bubble);case 6:return _context261.abrupt("return",bubble);case 7:case"end":return _context261.stop()}}),_callee260,this)})))}},{key:"isBubbleArchived",value:function(bubble){var isArchived=!0;return(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null)?bubble.status!==room_service_1.default.RoomUserStatus.UNSUBSCRIBED?isArchived=!1:bubble.users.forEach((function(user){user.status!==room_service_1.default.RoomUserStatus.UNSUBSCRIBED&&user.status!==room_service_1.default.RoomUserStatus.DELETED&&(isArchived=!1)})):isArchived=!1,isArchived}},{key:"getAllBubbles",value:function(){return room_service_1.default.getRooms()}},{key:"getAllOwnedBubbles",value:function(){return room_service_1.default.getMyRooms()}},{key:"getAllPendingBubbles",value:function(){return room_service_1.default.getRooms().filter((function(bubble){return"invited"===bubble.status}))}},{key:"getAllInactiveBubbles",value:function(){return room_service_1.default.getRooms().filter((function(bubble){return!1===bubble.isActive}))}},{key:"getBubbleById",value:function(strBubbleId){if(!strBubbleId)throw new Error("Parameter 'strBubbleId' is missing or empty");return room_service_1.default.getRoomById(strBubbleId)}},{key:"updateNameForBubble",value:function(strName,bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee261(){return regenerator_default.a.wrap((function(_context262){for(;;)switch(_context262.prev=_context262.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,strName){_context262.next=2;break}throw new Error("Parameter 'strName' is missing or empty");case 2:if(bubble){_context262.next=4;break}throw new Error("Parameter 'bubble' is missing or empty");case 4:return bubble.name=strName,_context262.next=7,room_service_1.default.ownerUpdateRoom(bubble);case 7:return _context262.abrupt("return",_context262.sent);case 8:case"end":return _context262.stop()}}),_callee261)})))}},{key:"updateDescriptionForBubble",value:function(strDescription,bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee262(){return regenerator_default.a.wrap((function(_context263){for(;;)switch(_context263.prev=_context263.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,strDescription){_context263.next=2;break}throw new Error("Parameter 'strDescription' is missing or empty");case 2:if(bubble){_context263.next=4;break}throw new Error("Parameter 'bubble' is missing or empty");case 4:return bubble.desc=strDescription,_context263.next=7,room_service_1.default.ownerUpdateRoom(bubble);case 7:return _context263.abrupt("return",_context263.sent);case 8:case"end":return _context263.stop()}}),_callee262)})))}},{key:"updateAvatarForBubble",value:function(urlAvatar,bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee263(){return regenerator_default.a.wrap((function(_context264){for(;;)switch(_context264.prev=_context264.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,urlAvatar){_context264.next=2;break}throw new Error("Parameter 'urlAvatar' is missing or empty");case 2:if(bubble){_context264.next=4;break}throw new Error("Parameter 'bubble' is missing or empty");case 4:return bubble.id=bubble.dbId,_context264.next=7,room_service_1.default.setAvatarRoom(bubble,urlAvatar);case 7:return _context264.abrupt("return",_context264.sent);case 8:case"end":return _context264.stop()}}),_callee263)})))}},{key:"deleteAvatarFromBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee264(){return regenerator_default.a.wrap((function(_context265){for(;;)switch(_context265.prev=_context265.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null){_context265.next=2;break}throw new Error("Parameter 'bubble' is missing or empty");case 2:return _context265.next=4,room_service_1.default.deleteAvatarRoom(bubble.dbId);case 4:case"end":return _context265.stop()}}),_callee264)})))}},{key:"updateCustomDataForBubble",value:function(customData,bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee265(){var updatedCustomData;return regenerator_default.a.wrap((function(_context266){for(;;)switch(_context266.prev=_context266.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null,customData){_context266.next=2;break}throw new Error("Parameter 'customData' is missing or empty");case 2:if(bubble){_context266.next=4;break}throw new Error("Parameter 'bubble' is missing or empty");case 4:return bubble.customData=customData,updatedCustomData=room_service_1.default.ownerUpdateRoomCustomData(bubble),_context266.abrupt("return",(bubble.customData=updatedCustomData,bubble));case 7:case"end":return _context266.stop()}}),_callee265)})))}},{key:"deleteCustomDataForBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee266(){var updatedCustomData;return regenerator_default.a.wrap((function(_context267){for(;;)switch(_context267.prev=_context267.next){case 0:if(bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null){_context267.next=2;break}throw new Error("Parameter 'bubble' is missing or empty");case 2:return bubble.customData={},_context267.next=5,room_service_1.default.ownerUpdateRoomCustomData(bubble);case 5:return updatedCustomData=_context267.sent,_context267.abrupt("return",(bubble.customData=updatedCustomData,bubble));case 7:case"end":return _context267.stop()}}),_callee266)})))}},{key:"getBubbleFromServer",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee267(){return regenerator_default.a.wrap((function(_context268){for(;;)switch(_context268.prev=_context268.next){case 0:if(bubble&&bubble.dbId){_context268.next=2;break}throw new Error("Parameter 'bubble' missing or not correct");case 2:return _context268.next=4,room_service_1.default.getServerRoom(bubble.dbId);case 4:return _context268.abrupt("return",_context268.sent);case 5:case"end":return _context268.stop()}}),_callee267)})))}}],[{key:"$inject",get:function(){return["videoService","conversationService","conferenceService","webConferenceService","$rootScope"]}}]),BubblesService}();BubblesService.logService="BubblesService | ",exports.BubblesService=BubblesService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var sdkConstant_1=__webpack_require__(28),EventsService_1=__webpack_require__(22),contact_service_1=__webpack_require__(1),profile_service_1=__webpack_require__(6),room_service_1=__webpack_require__(33),_videoService=new WeakMap,_conversationService=new WeakMap,_conferenceService=new WeakMap,_webConferenceService=new WeakMap,_$rootScope=new WeakMap;exports.ConferencesService=function(){function _class6(videoService,conversationService,conferenceService,webConferenceService,$rootScope){var _this156=this;_classCallCheck(this,_class6),this.confBubble=null,this.confBubbleType="",this.RAINBOW_ONWEBCONFERENCEUPDATED="rainbowwebconferenceupdated",this.RAINBOW_ONWEBRTCMEDIAERROROCCURED="rainbowwebrtcmediaerroroccured",this.RAINBOW_ONBUBBLESHARINGCONFERENCESTARTED="rainbowbubblesharingconferencestarted",this.RAINBOW_ONBUBBLECONFERENCESTARTED="rainbowbubbleconferencestarted",this.RAINBOW_ONBUBBLECONFERENCETALKERACTIVE="rainbowonwebconferencetalkeractive",this.RAINBOW_ONWEBCONFERENCEDELEGATED="rainbowonwebconferencedelegated",_videoService.set(this,videoService),_conversationService.set(this,conversationService),_conferenceService.set(this,conferenceService),_webConferenceService.set(this,webConferenceService),_$rootScope.set(this,$rootScope),$rootScope.$on("$destroy",$rootScope.$on("ON_CONFERENCE_UPDATED_EVENT",(function(event,conferenceSession){return _this156.onConferenceUpdated(event,conferenceSession)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_WEBRTC_GETUSERMEDIA_ERROR",(function(event,conferenceSession){return _this156.onWebRtcGetUserMediaError(event,conferenceSession)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONFERENCE_PARTICIPANT_EVENT",(function(event,conferenceSession){return _this156.onConferenceParticipantEvent(event,conferenceSession)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONFERENCE_STARTED_INVITATION",(function(event,room){return _this156.onConferenceStartedInvitation(event,room)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONFERENCE_TALKER_EVENT",(function(event,conferenceSession){return _this156.onConferenceTalkerEvent(event,conferenceSession)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CONFERENCE_DELEGATED_EVENT",(function(event,oldConfId,newConfId){return _this156.onWebConferenceDelegated(event,oldConfId,newConfId)})))}return _createClass(_class6,[{key:"onConferenceUpdated",value:function(__event,conferenceSession){conferenceSession&&EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEUPDATED,conferenceSession)}},{key:"onWebRtcGetUserMediaError",value:function(__event,conferenceSession){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCMEDIAERROROCCURED,conferenceSession)}},{key:"onConferenceParticipantEvent",value:function(__event,conferenceSession){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEUPDATED,conferenceSession)}},{key:"onConferenceStartedInvitation",value:function(__event,room){var _this157=this,confEndpoints=room.confEndpoints;confEndpoints&&confEndpoints.forEach((function(confEndpoint){"webrtc"===confEndpoint.mediaType&&EventsService_1.eventsService.dispatchEvent(_this157.RAINBOW_ONBUBBLECONFERENCESTARTED,room),"webrtcSharingOnly"===confEndpoint.mediaType&&EventsService_1.eventsService.dispatchEvent(_this157.RAINBOW_ONBUBBLESHARINGCONFERENCESTARTED,room)}))}},{key:"onConferenceTalkerEvent",value:function(__event,conferenceSession){conferenceSession&&EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLECONFERENCETALKERACTIVE,conferenceSession)}},{key:"onWebConferenceDelegated",value:function(__event,oldConfId,newConfId){var detail={oldConferenceId:oldConfId,newConferenceId:newConfId};EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEDELEGATED,detail)}},{key:"isWebConferenceAllowed",value:function(){return profile_service_1.default.isFeatureEnabled(profile_service_1.default.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED)}},{key:"hasActiveWebConferenceSession",value:function(){return _webConferenceService.get(this).hasActiveConferenceSession()}},{key:"getWebConferenceBubble",value:function(){return _webConferenceService.get(this).getRelatedRoomToActiveConferenceSession()}},{key:"setActiveSpeakerValue",value:function(value){return _webConferenceService.get(this).setActiveSpeakerValue(value),value}},{key:"startOrJoinWebConference",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee268(){var webConferenceService;return regenerator_default.a.wrap((function(_context269){for(;;)switch(_context269.prev=_context269.next){case 0:if(webConferenceService=_webConferenceService.get(this),bubble=bubble&&bubble.dbId?room_service_1.default.getRoomById(bubble.dbId):null){_context269.next=3;break}throw new Error("Parameter 'bubble' is missing or empty");case 3:if(!this.hasActiveWebConferenceSession()){_context269.next=5;break}throw new Error("Already in a conference");case 5:if(_context269.t0=bubble.confEndpoints.length,!_context269.t0){_context269.next=9;break}return _context269.next=9,webConferenceService.makeSnapshotForConfId(bubble.confEndpoints[0].confEndpointId,"webrtc",!0);case 9:return _context269.next=11,webConferenceService.bubbleStartOrJoinWebConference(bubble);case 11:return this.confBubble=bubble,this.confBubbleType="webrtc",_context269.abrupt("return",room_service_1.default.getRoomById(bubble.dbId));case 14:case"end":return _context269.stop()}}),_callee268,this)})))}},{key:"stopWebConference",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee269(){var webConferenceService,conferenceService,id,sharingConfSession,participant;return regenerator_default.a.wrap((function(_context270){for(;;)switch(_context270.prev=_context270.next){case 0:if(webConferenceService=_webConferenceService.get(this),conferenceService=_conferenceService.get(this),this.confBubble=this.confBubble&&this.confBubble.dbId?room_service_1.default.getRoomById(this.confBubble.dbId):null,this.hasActiveWebConferenceSession()&&this.confBubble){_context270.next=3;break}throw new Error("No known conference in a Bubble");case 3:if(id="",id="webrtc"===this.confBubbleType?this.confBubble.getSFUConfEndpointId():this.confBubble.getSFUSharingConfEndpointId(),sharingConfSession=webConferenceService.getConferenceSessionById(id),"moderator"===(participant=sharingConfSession?sharingConfSession.getParticipantByJid(contact_service_1.default.userContact.jid):null).role){_context270.next=11;break}return _context270.next=9,conferenceService.disconnectsParticipant(id,participant.participantId,this.confBubbleType);case 9:return this.confBubble=null,_context270.abrupt("return",void(this.confBubbleType=null));case 11:return _context270.next=13,conferenceService.stopConference(id,"webrtc",this.confBubble.dbId);case 13:this.confBubble=null,this.confBubbleType=null;case 15:case"end":return _context270.stop()}}),_callee269,this)})))}},{key:"muteConferenceAudio",value:function(conferenceSession){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee270(){var conferenceService,participantId;return regenerator_default.a.wrap((function(_context271){for(;;)switch(_context271.prev=_context271.next){case 0:if(conferenceService=_conferenceService.get(this),participantId=conferenceSession.getConnectedParticipantByJid(contact_service_1.default.userContact.jid).participantId,conferenceSession){_context271.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(participantId){_context271.next=5;break}throw new Error("Couldn't retrieve participant ID - make sure the conference is active and you are connected");case 5:return _context271.next=7,conferenceService.updateParticipantState(conferenceSession.id,participantId,"mute","webrtc");case 7:case"end":return _context271.stop()}}),_callee270,this)})))}},{key:"unmuteConferenceAudio",value:function(conferenceSession){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee271(){var conferenceService,participantId;return regenerator_default.a.wrap((function(_context272){for(;;)switch(_context272.prev=_context272.next){case 0:if(conferenceService=_conferenceService.get(this),participantId=conferenceSession.getConnectedParticipantByJid(contact_service_1.default.userContact.jid).participantId,conferenceSession){_context272.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(participantId){_context272.next=5;break}throw new Error("Couldn't retrieve participant ID - make sure the conference is active and you are connected");case 5:return _context272.next=7,conferenceService.updateParticipantState(conferenceSession.id,participantId,"unmute","webrtc");case 7:case"end":return _context272.stop()}}),_callee271,this)})))}},{key:"muteConferenceParticipant",value:function(conferenceSession,participantId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee272(){var conferenceService;return regenerator_default.a.wrap((function(_context273){for(;;)switch(_context273.prev=_context273.next){case 0:if(conferenceService=_conferenceService.get(this),conferenceSession){_context273.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(participantId){_context273.next=5;break}throw new Error("Parameter 'participantId' is missing or empty");case 5:return _context273.next=7,conferenceService.updateParticipantState(conferenceSession.id,participantId,"mute","webrtc");case 7:case"end":return _context273.stop()}}),_callee272,this)})))}},{key:"unmuteConferenceParticipant",value:function(conferenceSession,participantId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee273(){var conferenceService;return regenerator_default.a.wrap((function(_context274){for(;;)switch(_context274.prev=_context274.next){case 0:if(conferenceService=_conferenceService.get(this),conferenceSession){_context274.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(participantId){_context274.next=5;break}throw new Error("Parameter 'participantId' is missing or empty");case 5:return _context274.next=7,conferenceService.updateParticipantState(conferenceSession.id,participantId,"unmute","webrtc");case 7:case"end":return _context274.stop()}}),_callee273,this)})))}},{key:"muteAllConferenceParticipants",value:function(conferenceSession){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee274(){var conferenceService,participants,i;return regenerator_default.a.wrap((function(_context275){for(;;)switch(_context275.prev=_context275.next){case 0:if(conferenceService=_conferenceService.get(this),conferenceSession){_context275.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:participants=conferenceSession.participants,i=0;case 5:if(!(i<participants.length)){_context275.next=13;break}if(_context275.t0="moderator"!==participants[i].role,!_context275.t0){_context275.next=10;break}return _context275.next=10,conferenceService.updateParticipantState(conferenceSession.id,participants[i].participantId,"mute","webrtc");case 10:i++,_context275.next=5;break;case 13:case"end":return _context275.stop()}}),_callee274,this)})))}},{key:"unmuteAllConferenceParticipants",value:function(conferenceSession){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee275(){var conferenceService,participants,i;return regenerator_default.a.wrap((function(_context276){for(;;)switch(_context276.prev=_context276.next){case 0:if(conferenceService=_conferenceService.get(this),conferenceSession){_context276.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:participants=conferenceSession.participants,i=0;case 5:if(!(i<participants.length)){_context276.next=13;break}if(_context276.t0="moderator"!==participants[i].role,!_context276.t0){_context276.next=10;break}return _context276.next=10,conferenceService.updateParticipantState(conferenceSession.id,participants[i].participantId,"unmute","webrtc");case 10:i++,_context276.next=5;break;case 13:case"end":return _context276.stop()}}),_callee275,this)})))}},{key:"addVideoToConference",value:function(conferenceSession){var webConferenceService=_webConferenceService.get(this);if(!conferenceSession)throw new Error("Parameter 'conferenceSession' is missing or empty");return webConferenceService.addMediaToConferenceSession(conferenceSession,"video")}},{key:"addSharingToConference",value:function(conferenceSession){var webConferenceService=_webConferenceService.get(this);if(!conferenceSession)throw new Error("Parameter 'conferenceSession' is missing or empty");return webConferenceService.addMediaToConferenceSession(conferenceSession,"sharing")}},{key:"removeVideoFromConference",value:function(conferenceSession){var webConferenceService=_webConferenceService.get(this);if(!conferenceSession)throw new Error("Parameter 'conferenceSession' is missing or empty");return webConferenceService.removeMediaFromConferenceSession(conferenceSession,"video"),conferenceSession}},{key:"removeSharingFromConference",value:function(conferenceSession){var webConferenceService=_webConferenceService.get(this);if(!conferenceSession)throw new Error("Parameter 'conferenceSession' is missing or empty");return webConferenceService.removeMediaFromConferenceSession(conferenceSession,"sharing"),conferenceSession}},{key:"showLocalVideo",value:function(conferenceSession){var webConferenceService=_webConferenceService.get(this);if(!conferenceSession)throw new Error("Parameter 'conferenceSession' is missing or empty");return webConferenceService.attachLocalMediaStream(!0,conferenceSession),webConferenceService.isActiveSpeakerEnabled(),conferenceSession}},{key:"showRemoteVideo",value:function(conferenceSession){var webConferenceService=_webConferenceService.get(this);if(!conferenceSession)throw new Error("Parameter 'conferenceSession' is missing or empty");return webConferenceService.isActiveSpeakerEnabled()?webConferenceService.attachGalleryMediaStreams(conferenceSession):webConferenceService.attachDistantMediaStream(!0,conferenceSession),conferenceSession}},{key:"getConferenceSessionById",value:function(conferenceId){var webConferenceService=_webConferenceService.get(this);if(!conferenceId)throw new Error("Parameter 'conferenceId' is missing or empty");return webConferenceService.getConferenceSessionById(conferenceId)}},{key:"updateGalleryPublisher",value:function(conferenceSession,galleryElementId,newPublisher){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee276(){var webConferenceService,i;return regenerator_default.a.wrap((function(_context277){for(;;)switch(_context277.prev=_context277.next){case 0:if(webConferenceService=_webConferenceService.get(this),conferenceSession){_context277.next=3;break}throw new Error("Parameter 'conferenceSession' is missing or empty");case 3:if(galleryElementId){_context277.next=5;break}throw new Error("Parameter 'galleryElementId' is missing or empty");case 5:if(newPublisher){_context277.next=7;break}throw new Error("Parameter 'newPublisher' is missing or empty");case 7:if(webConferenceService.getRelatedPublisherToElement(conferenceSession.id,galleryElementId))for(i=0;i<conferenceSession.videoGallery.length;i++)conferenceSession.videoGallery[i].id===galleryElementId&&(conferenceSession.videoGallery[i].sessionId?webConferenceService.dropRemoteVideoSession(conferenceSession,conferenceSession.videoGallery[i].sessionId):webConferenceService.reInitialiseVideoGalleryElementById(conferenceSession,galleryElementId));return _context277.next=10,webConferenceService.subscribeToPublisher(conferenceSession.id,newPublisher,galleryElementId);case 10:case"end":return _context277.stop()}}),_callee276,this)})))}},{key:"removeGalleryPublisher",value:function(conferenceSession,galleryElementId){var webConferenceService=_webConferenceService.get(this);if(!conferenceSession)throw new Error("Parameter 'conferenceSession' is missing or empty");if(!galleryElementId)throw new Error("Parameter 'galleryElementId' is missing or empty");return webConferenceService.dropRemoteVideoSession(conferenceSession,galleryElementId),{code:sdkConstant_1.SDK.OK,label:"Publisher from ".concat(galleryElementId," successfully removed")}}},{key:"setVideoGalleryElementsNumber",value:function(elementsNumber){return _webConferenceService.get(this).setVideoGalleryElementsNumber(elementsNumber),elementsNumber}},{key:"removePipVideo",value:function(){return _videoService.get(this).removeConferencePip()}},{key:"updateMainVideoSession",value:function(conferenceId,sessionId){var webConferenceService=_webConferenceService.get(this);if(conferenceId){if(sessionId){webConferenceService.updateMainScreenSession(conferenceId,sessionId);var conferenceSession=webConferenceService.getConferenceSessionById(conferenceId);return webConferenceService.attachDistantMediaStream(!0,conferenceSession),webConferenceService.getConferenceSessionById(conferenceId)}throw new Error("Parameter 'sessionId' is missing or empty")}throw new Error("Parameter 'conferenceId' is missing or empty")}},{key:"disconnectParticipant",value:function(conferenceId,participantId){var mediaType=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"webrtc";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee277(){var conferenceService;return regenerator_default.a.wrap((function(_context278){for(;;)switch(_context278.prev=_context278.next){case 0:if(conferenceService=_conferenceService.get(this),conferenceId){_context278.next=3;break}throw new Error("Parameter 'conferenceId' is missing or empty");case 3:if(participantId){_context278.next=5;break}throw new Error("Parameter 'participantId' is missing or empty");case 5:return _context278.next=7,conferenceService.disconnectsParticipant(conferenceId,participantId,mediaType);case 7:case"end":return _context278.stop()}}),_callee277,this)})))}},{key:"getListOfAvailableRemoteVideoPublishers",value:function(conferenceSession){var webConferenceService=_webConferenceService.get(this);if(!conferenceSession)throw new Error("Parameter 'conferenceSession' is missing or empty");var publishers={all:[],notActive:[]};return publishers.all=conferenceSession.getListOfRemoteVideoPublishers(),publishers.notActive=webConferenceService.getListOfAvailableRemoteVideoPublishers(conferenceSession.id),publishers}},{key:"delegateConferenceToParticipant",value:function(conferenceId,participantId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee278(){var webConferenceService;return regenerator_default.a.wrap((function(_context279){for(;;)switch(_context279.prev=_context279.next){case 0:if(webConferenceService=_webConferenceService.get(this),conferenceId){_context279.next=3;break}throw new Error("Parameter 'conferenceId' is missing or empty");case 3:if(participantId){_context279.next=5;break}throw new Error("Parameter 'participantId' is missing or empty");case 5:return _context279.next=7,webConferenceService.delegateConferenceToParticipant(conferenceId,participantId);case 7:return _context279.abrupt("return",_context279.sent);case 8:case"end":return _context279.stop()}}),_callee278,this)})))}}],[{key:"$inject",get:function(){return["videoService","conversationService","conferenceService","webConferenceService","$rootScope"]}}]),_class6}()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),group_model_1=__webpack_require__(44),sdkConstant_1=__webpack_require__(28),_$rootScope=new WeakMap,_groupService=new WeakMap,GroupsService=function(){function GroupsService(groupService,$rootScope){var _this158=this;_classCallCheck(this,GroupsService),this.RAINBOW_ONGROUPCREATED="rainbowgroupcreated",this.RAINBOW_ONGROUPUPDATED="rainbowgroupupdated",this.RAINBOW_ONGROUPDELETED="rainbowgroupdeleted",this.RAINBOW_ONGROUPUSERADDED="rainbowgroupuseradded",this.RAINBOW_ONGROUPUSERREMOVED="rainbowgroupuserdeleted",_groupService.set(this,groupService),_$rootScope.set(this,$rootScope),$rootScope.$on("$destroy",$rootScope.$on(groupService.ON_UPDATE_GROUP_EVENT,(function(event,groupId){return _this158.onGroupUpdated(event,groupId)}))),$rootScope.$on("$destroy",$rootScope.$on(groupService.ON_CREATED_GROUP_EVENT,(function(event,groupId){return _this158.onGroupCreated(event,groupId)}))),$rootScope.$on("$destroy",$rootScope.$on(groupService.ON_REMOVED_GROUP_EVENT,(function(event,groupId){return _this158.onGroupDeleted(event,groupId)}))),$rootScope.$on("$destroy",$rootScope.$on(groupService.ON_ADD_GROUP_USER_EVENT,(function(event,groupId,userId){return _this158.onGroupUserAdded(event,groupId,userId)}))),$rootScope.$on("$destroy",$rootScope.$on(groupService.ON_REMOVE_GROUP_USER_EVENT,(function(event,groupId,userId){return _this158.onGroupUserRemoved(event,groupId,userId)})))}return _createClass(GroupsService,[{key:"onGroupUpdated",value:function(__event,groupId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee279(){var groupService,group;return regenerator_default.a.wrap((function(_context280){for(;;)switch(_context280.prev=_context280.next){case 0:return groupService=_groupService.get(this),_context280.next=3,groupService.getGroup(groupId);case 3:group=_context280.sent,EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUPDATED,group);case 5:case"end":return _context280.stop()}}),_callee279,this)})))}},{key:"onGroupCreated",value:function(__event,groupId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee280(){var groupService,group;return regenerator_default.a.wrap((function(_context281){for(;;)switch(_context281.prev=_context281.next){case 0:return groupService=_groupService.get(this),_context281.next=3,groupService.getGroup(groupId);case 3:group=_context281.sent,EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONGROUPCREATED,group);case 5:case"end":return _context281.stop()}}),_callee280,this)})))}},{key:"onGroupDeleted",value:function(__event,groupId){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONGROUPDELETED,groupId)}},{key:"onGroupUserAdded",value:function(__event,groupId,userId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee281(){var groupService,group;return regenerator_default.a.wrap((function(_context282){for(;;)switch(_context282.prev=_context282.next){case 0:return groupService=_groupService.get(this),_context282.next=3,groupService.getGroup(groupId);case 3:group=_context282.sent,EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUSERADDED,{group:group,userId:userId});case 5:case"end":return _context282.stop()}}),_callee281,this)})))}},{key:"onGroupUserRemoved",value:function(__event,groupId,userId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee282(){var groupService,group;return regenerator_default.a.wrap((function(_context283){for(;;)switch(_context283.prev=_context283.next){case 0:return groupService=_groupService.get(this),_context283.next=3,groupService.getGroup(groupId);case 3:group=_context283.sent,EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUSERREMOVED,{group:group,userId:userId});case 5:case"end":return _context283.stop()}}),_callee282,this)})))}},{key:"createGroup",value:function(strName,strDescription,isFavorite){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee283(){var groupService,group,comment,boolFavorite,newGroup;return regenerator_default.a.wrap((function(_context284){for(;;)switch(_context284.prev=_context284.next){case 0:if(groupService=_groupService.get(this),group=null,comment=strDescription||"",boolFavorite=!1,"boolean"==typeof isFavorite&&(boolFavorite=isFavorite),strName){_context284.next=6;break}throw new Error("Parameter 'strName' is missing or empty");case 6:return group=new group_model_1.Group(null,strName,comment,boolFavorite),_context284.next=9,groupService.addGroup(group);case 9:return newGroup=_context284.sent,_context284.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(GroupsService.logService+"[createGroup] :: New group created successfully"),newGroup));case 11:case"end":return _context284.stop()}}),_callee283,this)})))}},{key:"deleteGroup",value:function(group){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee284(){var groupService;return regenerator_default.a.wrap((function(_context285){for(;;)switch(_context285.prev=_context285.next){case 0:if(groupService=_groupService.get(this),group){_context285.next=3;break}throw new Error("Parameter 'group' is missing or empty");case 3:return _context285.next=5,groupService.removeGroup(group.id);case 5:return RainbowLogger_1.rainbowLogger.sdk(GroupsService.logService+"[deleteGroup] :: Group deleted successfully"),_context285.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 7:case"end":return _context285.stop()}}),_callee284,this)})))}},{key:"deleteAllGroups",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee285(){var groupService,PromiseQueue;return regenerator_default.a.wrap((function(_context286){for(;;)switch(_context286.prev=_context286.next){case 0:return groupService=_groupService.get(this),PromiseQueue=[],groupService.getGroupsAsArray().forEach((function(group){PromiseQueue.push(function(group){return groupService.removeGroup(group.id)}(group))})),_context286.next=4,Promise.all(PromiseQueue);case 4:return RainbowLogger_1.rainbowLogger.sdk(GroupsService.logService+"[deleteAllGroups] :: All groups deleted successfully"),_context286.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 6:case"end":return _context286.stop()}}),_callee285,this)})))}},{key:"getAll",value:function(){return _groupService.get(this).getGroupsAsArray()}},{key:"getFavoritesGroups",value:function(){return _groupService.get(this).getGroupsAsArray().filter((function(group){return group.isFavorite}))}},{key:"setGroupAsFavorite",value:function(group){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee286(){var groupService;return regenerator_default.a.wrap((function(_context287){for(;;)switch(_context287.prev=_context287.next){case 0:return groupService=_groupService.get(this),group.isFavorite=!0,_context287.next=4,groupService.updateGroup(group);case 4:return _context287.abrupt("return",group);case 5:case"end":return _context287.stop()}}),_callee286,this)})))}},{key:"unsetGroupAsFavorite",value:function(group){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee287(){var groupService;return regenerator_default.a.wrap((function(_context288){for(;;)switch(_context288.prev=_context288.next){case 0:return groupService=_groupService.get(this),group.isFavorite=!1,_context288.next=4,groupService.updateGroup(group);case 4:return _context288.abrupt("return",group);case 5:case"end":return _context288.stop()}}),_callee287,this)})))}},{key:"getGroupById",value:function(groupId){var groupService=_groupService.get(this),theGroup=null;return groupService.getGroupsAsArray().some((function(group){return groupId===group.id&&(theGroup=group,!0)})),theGroup}},{key:"getDetailedGroupById",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee288(){var groupService;return regenerator_default.a.wrap((function(_context289){for(;;)switch(_context289.prev=_context289.next){case 0:if(groupService=_groupService.get(this),id){_context289.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context289.next=5,groupService.getGroup(id);case 5:return _context289.abrupt("return",_context289.sent);case 6:case"end":return _context289.stop()}}),_callee288,this)})))}},{key:"addContactInGroup",value:function(contact,group){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee289(){var groupService,updatedGroup;return regenerator_default.a.wrap((function(_context290){for(;;)switch(_context290.prev=_context290.next){case 0:if(groupService=_groupService.get(this),contact){_context290.next=3;break}throw new Error("Parameter 'contact' is missing or null");case 3:if(group){_context290.next=5;break}throw new Error("Parameter 'group' is missing or null");case 5:return _context290.next=7,groupService.addGroupUser(group,contact);case 7:return updatedGroup=_context290.sent,_context290.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(GroupsService.logService+"[addContactInGroup] :: Contact added successfully"),updatedGroup));case 9:case"end":return _context290.stop()}}),_callee289,this)})))}},{key:"removeContactFromGroup",value:function(contact,group){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee290(){var groupService;return regenerator_default.a.wrap((function(_context291){for(;;)switch(_context291.prev=_context291.next){case 0:if(groupService=_groupService.get(this),contact){_context291.next=3;break}throw new Error("Parameter 'contact' is missing or null");case 3:if(group){_context291.next=5;break}throw new Error("Parameter 'group' is missing or null");case 5:return _context291.abrupt("return",groupService.removeGroupUser(group.id,contact));case 6:case"end":return _context291.stop()}}),_callee290,this)})))}}],[{key:"$inject",get:function(){return["groupService","$rootScope"]}}]),GroupsService}();GroupsService.logService="GroupService  | ",exports.GroupsService=GroupsService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var EventsService_1=__webpack_require__(22),_$rootScope=new WeakMap,_callLogService=new WeakMap;exports.CallsLogService=function(){function _class7($rootScope,callLogService){var _this159=this;_classCallCheck(this,_class7),this.RAINBOW_ONCALLLOGUPDATED="rainbowcalllogupdated",this.RAINBOW_ONCALLLOGACKUPDATED="rainbowcalllogackupdated",this.initialized=!1,_$rootScope.set(this,$rootScope),_callLogService.set(this,callLogService),$rootScope.$on("$destroy",$rootScope.$on("ON_CALL_LOG_UPDATED",(function(){return _this159.onCallLogUpdated()}))),$rootScope.$on("$destroy",$rootScope.$on("ON_CALL_LOG_ACK_UPDATED",(function(event,data){return _this159.onCallLogAckUpdated(event,data)})))}return _createClass(_class7,[{key:"onCallLogUpdated",value:function(){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCALLLOGUPDATED,null)}},{key:"onCallLogAckUpdated",value:function(__event,data){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCALLLOGACKUPDATED,data)}},{key:"getAll",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee291(){var callLogService,callLogs,i,durationMs,hmmss,parts,j;return regenerator_default.a.wrap((function(_context292){for(;;)switch(_context292.prev=_context292.next){case 0:return callLogService=_callLogService.get(this),_context292.next=3,callLogService.getSimplifiedCallLogs();case 3:for(callLogs=_context292.sent,i=0;i<callLogs.length;i++)if(durationMs=0,(hmmss=callLogs[i].duration)&&"string"==typeof hmmss&&hmmss.match(/^(?:(?:([01]?\d|2[0-3])h )?([0-5]?\d)m )?([0-5]?\ds)$/)){for(hmmss=hmmss.replace(/[hms]/g,""),parts=hmmss.split(" ").reverse(),j=0;j<parts.length;j++)durationMs+=parts[j]*Math.pow(60,j);callLogs[i].duration=1e3*durationMs}return _context292.abrupt("return",callLogs);case 6:case"end":return _context292.stop()}}),_callee291,this)})))}},{key:"getMissedCallLogCounter",value:function(){return _callLogService.get(this).getMissedCallLogCounter()}},{key:"getMissedCallLogNumber",value:function(){return _callLogService.get(this).getNumberMissedCallLogs()}},{key:"deleteOneCallLog",value:function(id){return _callLogService.get(this).deleteOneCallLog(id),!0}},{key:"deleteCallLogsForContact",value:function(jid){return _callLogService.get(this).deleteCallLogsForContact(jid)}},{key:"deleteAllCallLogs",value:function(){return _callLogService.get(this).deleteAllCallLogs()}},{key:"markCallLogAsRead",value:function(id){return _callLogService.get(this).markCallLogAsRead(id)}},{key:"markAllCallsLogsAsRead",value:function(){return _callLogService.get(this).markAllCallsLogsAsRead()}},{key:"isInitialized",value:function(){return this.initialized}}],[{key:"$inject",get:function(){return["$rootScope","callLogService"]}}]),_class7}()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),_favoriteService=new WeakMap,FavoritesService=function(){function FavoritesService(favoriteService){var _this160=this;_classCallCheck(this,FavoritesService),this.RAINBOW_ONFAVORITECREATED="rainbowonfavoritecreated",this.RAINBOW_ONFAVORITEDELETED="rainbowonfavoritedeleted",_favoriteService.set(this,favoriteService),window.addEventListener("ON_FAVORITE_CREATED",(function(event){return _this160.onFavoriteCreated(event)})),window.addEventListener("ON_FAVORITE_DELETED",(function(event){return _this160.onFavoriteDeleted(event)}))}return _createClass(FavoritesService,[{key:"onFavoriteCreated",value:function(event){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONFAVORITECREATED,event.detail)}},{key:"onFavoriteDeleted",value:function(event){EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONFAVORITEDELETED,event.detail)}},{key:"fetchAllFavorites",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee292(){var favoriteService,favorites;return regenerator_default.a.wrap((function(_context293){for(;;)switch(_context293.prev=_context293.next){case 0:return favoriteService=_favoriteService.get(this),_context293.next=3,favoriteService.getServerFavorites();case 3:return favorites=_context293.sent,_context293.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(FavoritesService.logService+"[fetchAllFavorites] :: Successfully fetched the Favorites"),favorites));case 5:case"end":return _context293.stop()}}),_callee292,this)})))}},{key:"createFavorite",value:function(id,favoriteType){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee293(){var favoriteService;return regenerator_default.a.wrap((function(_context294){for(;;)switch(_context294.prev=_context294.next){case 0:if(favoriteService=_favoriteService.get(this),id){_context294.next=3;break}throw RainbowLogger_1.rainbowLogger.sdk(FavoritesService.logService+"[createFavorite] :: Error: parameter 'id' is missing or null"),new Error(FavoritesService.logService+"[createFavorite] :: Error: parameter 'id' is missing or null");case 3:if(favoriteType){_context294.next=5;break}throw RainbowLogger_1.rainbowLogger.sdk(FavoritesService.logService+"[createFavorite] :: Error: parameter 'favoriteType' is missing or null"),new Error(FavoritesService.logService+"[createFavorite] :: Error: parameter 'favoriteType' is missing or null");case 5:if("bubble"===favoriteType||"user"===favoriteType){_context294.next=7;break}throw RainbowLogger_1.rainbowLogger.sdk(FavoritesService.logService+'[createFavorite] :: Error: favoriteType should be set to "user" or "bubble"'),new Error(FavoritesService.logService+'[createFavorite] :: Error: favoriteType should be set to "user" or "bubble"');case 7:return"bubble"===favoriteType&&(favoriteType="room"),_context294.next=10,favoriteService.addServerFavorite(id,favoriteType);case 10:case"end":return _context294.stop()}}),_callee293,this)})))}},{key:"deleteFavorite",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee294(){var favoriteService;return regenerator_default.a.wrap((function(_context295){for(;;)switch(_context295.prev=_context295.next){case 0:if(favoriteService=_favoriteService.get(this),id){_context295.next=3;break}throw RainbowLogger_1.rainbowLogger.sdk(FavoritesService.logService+"[deleteFavorite] :: Error: parameter 'id' is missing or null"),new Error(FavoritesService.logService+"[deleteFavorite] :: Error: parameter 'id' is missing or null");case 3:return _context295.next=5,favoriteService.removeServerFavorite(id);case 5:case"end":return _context295.stop()}}),_callee294,this)})))}}],[{key:"$inject",get:function(){return["favoriteService"]}}]),FavoritesService}();FavoritesService.logService="FavoritesService | ",exports.FavoritesService=FavoritesService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),contact_service_1=__webpack_require__(1),fileStorage_service_1=__webpack_require__(25),_$rootScope=new WeakMap,_Conversation=new WeakMap,_fileServerService=new WeakMap,_conversationService=new WeakMap,FilesStorageService=function(){function FilesStorageService(Conversation,fileServerService,conversationService,$rootScope){var _this161=this;_classCallCheck(this,FilesStorageService),this.RAINBOW_ONFILEUPLOADED_ERROR="rainbowfileuploadederror",this.RAINBOW_ONFILEDOWNLOADED="rainbowonfiledownloaded",this.RAINBOW_ONFILEDOWNLOADED_ERROR="rainbowfiledownloadederror",this.RAINBOW_ONCHUNKLOADMESSAGE="rainbowonchunkloadmessage",this.RAINBOW_ONFILEUPLOADED="rainbowfileuploaded",this.eventsMap={success:{download:this.RAINBOW_ONFILEDOWNLOADED,upload:this.RAINBOW_ONFILEUPLOADED},error:{download:this.RAINBOW_ONFILEDOWNLOADED_ERROR,upload:this.RAINBOW_ONFILEUPLOADED_ERROR}},_Conversation.set(this,Conversation),_fileServerService.set(this,fileServerService),_conversationService.set(this,conversationService),_$rootScope.set(this,$rootScope),$rootScope.$on("$destroy",$rootScope.$on("ON_FILE_TRANSFER_EVENT",(function(event,data){return _this161.onFileTransferChanged(event,data)})))}return _createClass(FilesStorageService,[{key:"onFileTransferChanged",value:function(__event,data){data.result&&data.type?(RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[onFileTransferChanged] ::  File transfered"),EventsService_1.eventsService.dispatchEvent(this.eventsMap[data.result][data.type],data)):"uploading"!==(data=data.fileDesc).state&&"downloading"!==data.state||EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCHUNKLOADMESSAGE,data)}},{key:"addFileToConversation",value:function(conversation,file,data){var conversationService=_conversationService.get(this);return new Promise((function(resolve,reject){if("string"==typeof file){var xhr=new XMLHttpRequest;xhr.open("GET",file,!0),xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE){var blob=xhr.response,_file=new File([blob],file.replace(/^.*[\\/]/,""));if(_file.size>1e8)return reject("The file is too large (limited to 100MB)");conversationService.sendFSMessage(conversation,_file,data).then((function(message){return resolve(message)}))}},xhr.responseType="blob",xhr.send()}else{if(file.size>1e8)return reject("The file is too large (limited to 100MB)");conversationService.sendFSMessage(conversation,file,data).then((function(message){return resolve(message)}))}}))}},{key:"uploadFileToConversation",value:function(conversation,file,message){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee295(){var Conversation;return regenerator_default.a.wrap((function(_context296){for(;;)switch(_context296.prev=_context296.next){case 0:if(Conversation=_Conversation.get(this),conversation){_context296.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if(file){_context296.next=5;break}throw new Error("Parameter 'file' is missing or null");case 5:if(conversation.type===Conversation.Type.ONE_TO_ONE){_context296.next=7;break}throw new Error("Parameter 'conversation' is not a one-to-one conversation");case 7:return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[uploadFileToConversation] ::  Add file to the conversation "+conversation.id),_context296.next=10,this.addFileToConversation(conversation,file,message);case 10:return _context296.abrupt("return",_context296.sent);case 11:case"end":return _context296.stop()}}),_callee295,this)})))}},{key:"uploadFile",value:function(file,message,progressCallback){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee296(){var fileServerService,fileDescriptor;return regenerator_default.a.wrap((function(_context297){for(;;)switch(_context297.prev=_context297.next){case 0:if(fileServerService=_fileServerService.get(this),file){_context297.next=3;break}throw new Error("Parameter 'file' is missing or null");case 3:return _context297.next=5,fileStorage_service_1.default.createFileDescriptor(file.name,file.name.split(".").pop(),file.size,[],!1);case 5:return fileDescriptor=_context297.sent,_context297.next=8,fileServerService.uploadAFileByChunk(fileDescriptor,file,message,progressCallback);case 8:return _context297.abrupt("return",_context297.sent);case 9:case"end":return _context297.stop()}}),_callee296,this)})))}},{key:"uploadExistingFileToConversation",value:function(conversation,fileDescriptor){var message=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee297(){var conversationService;return regenerator_default.a.wrap((function(_context298){for(;;)switch(_context298.prev=_context298.next){case 0:if(conversationService=_conversationService.get(this),conversation){_context298.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if(fileDescriptor){_context298.next=5;break}throw new Error("Parameter 'fileDescriptor' is missing or null");case 5:return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[uploadExistingFileToConversation] ::  Upload existing file to conversation "+conversation.id),_context298.next=8,conversationService.sendEFSMessage(conversation,fileDescriptor,message);case 8:return _context298.abrupt("return",_context298.sent);case 9:case"end":return _context298.stop()}}),_callee297,this)})))}},{key:"uploadFileToBubble",value:function(bubble,file,message){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee298(){var Conversation,conversationService,conversation;return regenerator_default.a.wrap((function(_context299){for(;;)switch(_context299.prev=_context299.next){case 0:if(Conversation=_Conversation.get(this),conversationService=_conversationService.get(this),bubble){_context299.next=3;break}throw new Error("Parameter 'bubble' is missing or null");case 3:if(file){_context299.next=5;break}throw new Error("Parameter 'file' is missing or null");case 5:if(conversation=conversationService.getConversationByRoomDbId(bubble.dbId)){_context299.next=8;break}throw new Error("Parameter 'bubble' don't have a conversation");case 8:if(conversation.type===Conversation.Type.ROOM){_context299.next=10;break}throw new Error("Parameter 'conversation' is not a bubble conversation");case 10:return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[uploadFileToBubble] ::  Trying to add a file to the bubble "+bubble.dbId),_context299.next=13,this.addFileToConversation(conversation,file,message);case 13:return _context299.abrupt("return",_context299.sent);case 14:case"end":return _context299.stop()}}),_callee298,this)})))}},{key:"downloadFile",value:function(fileDescriptor){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee299(){var fileServerService;return regenerator_default.a.wrap((function(_context300){for(;;)switch(_context300.prev=_context300.next){case 0:if(fileServerService=_fileServerService.get(this),fileDescriptor){_context300.next=3;break}throw new Error("Parameter 'fileDescriptor' is missing or null");case 3:return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[downloadFile] ::  Trying to get a file"),_context300.next=6,fileServerService.getBlobFromFileDescriptor(fileDescriptor,!0);case 6:return _context300.abrupt("return",_context300.sent);case 7:case"end":return _context300.stop()}}),_callee299,this)})))}},{key:"removeFile",value:function(fileDescriptor){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee300(){var fileDescriptorId,parts;return regenerator_default.a.wrap((function(_context301){for(;;)switch(_context301.prev=_context301.next){case 0:if(fileDescriptor){_context301.next=2;break}throw new Error("Parameter 'fileDescriptor' is missing or null");case 2:if(!fileDescriptor.id&&!fileDescriptor.url){_context301.next=9;break}return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[removeFile] ::  Trying to remove a file"),(fileDescriptorId=fileDescriptor.id)||(parts=fileDescriptor.url.split("/"),fileDescriptorId=parts.pop()||parts.pop()),_context301.next=8,fileStorage_service_1.default.deleteFileDescriptor(fileDescriptorId);case 8:return _context301.abrupt("return",void RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[removeFile] ::  File removed"));case 9:throw new Error("Parameter 'fileDescriptor' does not contain sufficient information to remove the file - no id or url property");case 10:case"end":return _context301.stop()}}),_callee300)})))}},{key:"getFileDescriptorFromId",value:function(id){return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[getFileDescriptorFromId] ::  Get file descriptor "+id),fileStorage_service_1.default.getFileDescriptorById(id)}},{key:"getFileDescriptorUrl",value:function(fileDescriptor,thumbnail){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee301(){var fileServerService;return regenerator_default.a.wrap((function(_context302){for(;;)switch(_context302.prev=_context302.next){case 0:return fileServerService=_fileServerService.get(this),_context302.next=3,fileServerService.getFileDescriptorUrl(fileDescriptor,thumbnail);case 3:return _context302.abrupt("return",_context302.sent);case 4:case"end":return _context302.stop()}}),_callee301,this)})))}},{key:"getFilesReceivedInConversation",value:function(conversation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee302(){var Conversation,files;return regenerator_default.a.wrap((function(_context303){for(;;)switch(_context303.prev=_context303.next){case 0:if(Conversation=_Conversation.get(this),conversation){_context303.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if(conversation.type===Conversation.Type.ONE_TO_ONE){_context303.next=5;break}throw new Error("Parameter 'conversation' is not a one-to-one conversation");case 5:return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[getFilesReceivedInConversation] ::  Get files received in conversation "+conversation.id+"..."),_context303.next=8,fileStorage_service_1.default.retrieveFilesReceivedFromPeer(contact_service_1.default.userContact.dbId,conversation.contact.dbId);case 8:return files=_context303.sent,_context303.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[getFilesReceivedInConversation] ::  Shared "+files.length),files));case 10:case"end":return _context303.stop()}}),_callee302,this)})))}},{key:"getFilesReceivedInBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee303(){return regenerator_default.a.wrap((function(_context304){for(;;)switch(_context304.prev=_context304.next){case 0:if(bubble){_context304.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[getFilesReceivedInBubble] ::  Get files received in bubble "+bubble.dbId),_context304.next=5,fileStorage_service_1.default.retrieveReceivedFilesForRoom(bubble.dbId);case 5:return _context304.abrupt("return",_context304.sent);case 6:case"end":return _context304.stop()}}),_callee303)})))}},{key:"getFilesSentInConversation",value:function(conversation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee304(){var Conversation;return regenerator_default.a.wrap((function(_context305){for(;;)switch(_context305.prev=_context305.next){case 0:if(Conversation=_Conversation.get(this),conversation){_context305.next=3;break}throw new Error("Parameter 'conversation' is missing or null");case 3:if(conversation.type===Conversation.Type.ONE_TO_ONE){_context305.next=5;break}throw new Error("Parameter 'conversation' is not a one-to-one conversation");case 5:return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[getFilesSentInConversation] :: Get files sent in conversation "+conversation.id),_context305.abrupt("return",fileStorage_service_1.default.retrieveSentFiles(conversation.contact.dbId));case 7:case"end":return _context305.stop()}}),_callee304,this)})))}},{key:"getFilesSentInBubble",value:function(bubble){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee305(){return regenerator_default.a.wrap((function(_context306){for(;;)switch(_context306.prev=_context306.next){case 0:if(bubble){_context306.next=2;break}throw new Error("Parameter 'bubble' is missing or null");case 2:return RainbowLogger_1.rainbowLogger.sdk(FilesStorageService.logService+"[getFilesSentInBubble] :: Get files sent in bubble "+bubble.dbId),_context306.abrupt("return",fileStorage_service_1.default.retrieveSentFiles(bubble.dbId));case 4:case"end":return _context306.stop()}}),_callee305)})))}},{key:"getUserQuotaConsumption",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee306(){return regenerator_default.a.wrap((function(_context307){for(;;)switch(_context307.prev=_context307.next){case 0:return _context307.abrupt("return",fileStorage_service_1.default.retrieveUserConsumption());case 1:case"end":return _context307.stop()}}),_callee306)})))}},{key:"getAllFilesSent",value:function(){return fileStorage_service_1.default.getDocuments("date",!1)}},{key:"getAllFilesReceived",value:function(){return fileStorage_service_1.default.getDocuments("date",!0)}},{key:"cancelCurrentFileTransfer",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee307(){var fileServerService,fileDescriptor;return regenerator_default.a.wrap((function(_context308){for(;;)switch(_context308.prev=_context308.next){case 0:if(fileServerService=_fileServerService.get(this),_context308.prev=1,id){_context308.next=4;break}throw new Error("Parameter 'id' is missing or null");case 4:if(null!==(fileDescriptor=fileStorage_service_1.default.getFileDescriptorById(id))){_context308.next=7;break}throw new Error("Could not find a file with the id "+id);case 7:if("downloading"===fileDescriptor.state||"uploading"===fileDescriptor.state){_context308.next=9;break}throw new Error("File Status is not set to 'downloading' or 'uploading'");case 9:return _context308.abrupt("return",(fileServerService.cancelCurrentFiletransfer(id),"not_uploaded"!==fileDescriptor.state&&"uploading"!==fileDescriptor.state?(fileDescriptor.state="uploaded",fileDescriptor):"not_uploaded"!==fileDescriptor.state&&"uploading"===fileDescriptor.state?(fileDescriptor.state="not_uploaded",fileDescriptor):fileDescriptor));case 12:throw _context308.prev=12,_context308.t0=_context308.catch(1),_context308.t0;case 15:case"end":return _context308.stop()}}),_callee307,this,[[1,12]])})))}}],[{key:"inject",get:function(){return["Conversation","fileServerService","conversationService","$rootScope"]}}]),FilesStorageService}();FilesStorageService.logService="FilesStorageService | ",exports.FilesStorageService=FilesStorageService},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var profile_service_1=__webpack_require__(6);exports.CapabilitiesService=function(){function _class8(){_classCallCheck(this,_class8)}return _createClass(_class8,[{key:"getAll",value:function(){return profile_service_1.default.getMyProfileFeatures()}},{key:"getUserSubscription",value:function(){return profile_service_1.default.getMyProfileName()}},{key:"isFeatureEnabled",value:function(featureString){return profile_service_1.default.isFeatureEnabled(featureString)}},{key:"hasS4BExtensionEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("MS_SKYPE_PLUGIN")}},{key:"hasOutlookExtensionEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("MS_OUTLOOK_PLUGIN")}},{key:"hasCalendarPresenceEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("MSO365_CALENDAR_PRESENCE")}},{key:"hasTelephonyBasicCallEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("TELEPHONY_BASIC_CALL")}},{key:"hasTelephonySecondCallEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("TELEPHONY_SECOND_CALL")}},{key:"hasTelephonyTransferCallEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("TELEPHONY_TRANSFER_CALL")}},{key:"hasTelephonyConferenceCallEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("TELEPHONY_CONFERENCE_CALL")}},{key:"hasTelephonyDeflectCallEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("TELEPHONY_DEFLECT_CALL")}},{key:"hasTelephonyForwardCallEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("TELEPHONY_FORWARD_CALL")}},{key:"hasTelephonyPhoneBookEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("TELEPHONY_PHONE_BOOK")}},{key:"hasTelephonyVoiceMailEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("TELEPHONY_VOICE_MAIL")}},{key:"hasWebRTCAudioMobileEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("WEBRTC_FOR_MOBILE")}},{key:"hasWebRTCVideoMobileEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("WEBRTC_FOR_MOBILE_VIDEO")}},{key:"hasBridgeConferenceEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("CONFERENCE_ALLOWED")}},{key:"hasBridgeConferenceRecordEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("CONFERENCE_RECORDING")}},{key:"hasBridgeConferenceDialOutEnabled",value:function(){return profile_service_1.default.isFeatureEnabled("CONFERENCE_DIAL_OUT")}},{key:"maxParticipantsPerBubbleAllowed",value:function(){return profile_service_1.default.getFeatureLimitMax("BUBBLE_PARTICIPANT_COUNT")}},{key:"maxParticipantsPerBridgeConferenceAllowed",value:function(){return profile_service_1.default.getFeatureLimitMax("CONFERENCE_PARTICIPANT_COUNT")}},{key:"maxFileStorageQuotaAllowed",value:function(){return profile_service_1.default.getFeatureLimitMax("FILE_SHARING_QUOTA_GB")}}]),_class8}()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var _User=new WeakMap,_adminCompanyService=new WeakMap,_adminUserService=new WeakMap,company_model_1=__webpack_require__(19),AdminService=function(){function AdminService(User,adminCompanyService,adminUserService){_classCallCheck(this,AdminService),this.logService="AdminService | ",_User.set(this,User),_adminCompanyService.set(this,adminCompanyService),_adminUserService.set(this,adminUserService)}return _createClass(AdminService,[{key:"createEssentialCompany",value:function(strName,strCountry){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee308(){var adminCompanyService,company;return regenerator_default.a.wrap((function(_context309){for(;;)switch(_context309.prev=_context309.next){case 0:return adminCompanyService=_adminCompanyService.get(this),(company=company_model_1.Company.create(null,"")).name=strName,company.country=strCountry,_context309.next=5,adminCompanyService.createCompanyEndUser(company);case 5:return _context309.abrupt("return",_context309.sent);case 6:case"end":return _context309.stop()}}),_callee308,this)})))}},{key:"createCompany",value:function(strName,strCountry,strState){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee309(){var adminCompanyService,company;return regenerator_default.a.wrap((function(_context310){for(;;)switch(_context310.prev=_context310.next){case 0:return adminCompanyService=_adminCompanyService.get(this),(company=company_model_1.Company.create(null,"")).name=strName,company.country=strCountry,strState&&(company.state=strState),company.economicActivityClassification="",_context310.next=7,adminCompanyService.createCompany(company);case 7:return _context310.abrupt("return",_context310.sent);case 8:case"end":return _context310.stop()}}),_callee309,this)})))}},{key:"removeCompany",value:function(company){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee310(){var adminCompanyService;return regenerator_default.a.wrap((function(_context311){for(;;)switch(_context311.prev=_context311.next){case 0:return adminCompanyService=_adminCompanyService.get(this),_context311.next=3,adminCompanyService.deleteCompany(company.id);case 3:return _context311.abrupt("return",_context311.sent);case 4:case"end":return _context311.stop()}}),_callee310,this)})))}},{key:"createUserForCompany",value:function(strLogin,strFirstName,strLastName,strPassword,company,tags){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee311(){var User,adminUserService,user;return regenerator_default.a.wrap((function(_context312){for(;;)switch(_context312.prev=_context312.next){case 0:return User=_User.get(this),adminUserService=_adminUserService.get(this),(user=User.create()).loginEmail=strLogin,user.firstName=strFirstName,user.lastName=strLastName,user.password=strPassword,user.language="en",user.companyId=company.id,user.adminType="undefined",user.isActive=!0,user.isInitialized=!0,tags&&(user.tags=tags&&Array.isArray(tags)?tags:[tags]),_context312.next=13,adminUserService.createUser(user);case 13:return _context312.abrupt("return",_context312.sent);case 14:case"end":return _context312.stop()}}),_callee311,this)})))}},{key:"removeUserFromCompany",value:function(user){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee312(){var adminUserService;return regenerator_default.a.wrap((function(_context313){for(;;)switch(_context313.prev=_context313.next){case 0:return adminUserService=_adminUserService.get(this),_context313.next=3,adminUserService.deleteUser(user);case 3:return _context313.abrupt("return",_context313.sent);case 4:case"end":return _context313.stop()}}),_callee312,this)})))}},{key:"fetchUsersByTag",value:function(searchPattern){var page=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,pageSize=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee313(){var adminUserService;return regenerator_default.a.wrap((function(_context314){for(;;)switch(_context314.prev=_context314.next){case 0:return adminUserService=_adminUserService.get(this),_context314.next=3,adminUserService.getUsers(null,page,pageSize,searchPattern,!1,null,!1,!0);case 3:return _context314.abrupt("return",_context314.sent);case 4:case"end":return _context314.stop()}}),_callee313,this)})))}},{key:"updateUserTags",value:function(user,tags){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee314(){var adminUserService;return regenerator_default.a.wrap((function(_context315){for(;;)switch(_context315.prev=_context315.next){case 0:if(adminUserService=_adminUserService.get(this),user){_context315.next=3;break}throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'user' is missing or null");case 3:if(user.id){_context315.next=5;break}throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'user.id' is missing or null");case 5:if(tags instanceof Array==1){_context315.next=7;break}throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'tags' must be an array");case 7:if(!(tags instanceof Array&&(tags.length<1||tags.length>5))){_context315.next=9;break}throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'tags' must be an array with at least 1 and maximum 5 elements");case 9:return _context315.next=11,adminUserService.updateUser(user);case 11:return _context315.abrupt("return",_context315.sent);case 12:case"end":return _context315.stop()}}),_callee314,this)})))}},{key:"setVisibilityForCompany",value:function(company,visibleByCompany){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee315(){var adminCompanyService;return regenerator_default.a.wrap((function(_context316){for(;;)switch(_context316.prev=_context316.next){case 0:return adminCompanyService=_adminCompanyService.get(this),_context316.next=3,adminCompanyService.addVisibility(company.id,visibleByCompany.id);case 3:return _context316.abrupt("return",_context316.sent);case 4:case"end":return _context316.stop()}}),_callee315,this)})))}}],[{key:"$inject",get:function(){return["User","adminCompanyService","adminUserService"]}},{key:"getInstance",value:function(){return this.instance||(this.instance=new AdminService("User","adminCompanyService","adminUserService")),this.instance}}]),AdminService}();exports.AdminService=AdminService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),sdkConstant_1=__webpack_require__(28),contact_service_1=__webpack_require__(1),_$rootScope=new WeakMap,_channelService=new WeakMap,ChannelsService=function(){function ChannelsService($rootScope,channelService){var _this162=this;_classCallCheck(this,ChannelsService),this.RAINBOW_ONCHANNELUPDATED="rainbowchannelupdate",this.RAINBOW_ONCHANNELMESSAGERECEIVED="rainbowchannelmessagereceived",this.RAINBOW_ONCHANNELRETRACTMESSAGERECEIVED="rainbowchannelretractmessage",this.RAINBOW_ONCHANNELDELETED="rainbowchanneldeleted",this.RAINBOW_ONCHANNELAVATARUPDATED="rainbowchannelavatarupdate",this.RAINBOW_ONCHANNELUSERSUBSCRIBED="rainbowchannelusersubscribed",this.RAINBOW_ONCHANNELUSERUNSUBSCRIBED="rainbowchanneluserunsubscribed",_$rootScope.set(this,$rootScope),_channelService.set(this,channelService),$rootScope.$on("$destroy",$rootScope.$on("CHANNEL_MESSAGE_RECEIVED",(function(event,messageType,message){return _this162.onMessageReceived(event,messageType,message)}))),$rootScope.$on("$destroy",$rootScope.$on("CHANNEL_UPDATE_EVENT",(function(event,updateType,id){return _this162.onChannelUpdated(event,updateType,id)}))),$rootScope.$on("$destroy",$rootScope.$on("CHANNEL_USERS_UPDATE_EVENT",(function(event,id,users){return _this162.onChannelUsersUpdated(event,id,users)}))),$rootScope.$on("$destroy",$rootScope.$on("ON_UPDATE_CHANNEL_AVATAR",(function(event,id){return _this162.onChannelAvatarUpdated(event,id)}))),$rootScope.$on("$destroy",$rootScope.$on("CHANNEL_USER_SUBSCRIPTION_EVENT",(function(event,userType,channelId,userId){return _this162.onUserSubscriptionChange(event,userType,channelId,userId)})))}return _createClass(ChannelsService,[{key:"onMessageReceived",value:function(__event,messageType,message){var _this163=this,channelId=message.channelId?message.channelId:message;RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[ChannelsService] :: EVENT onMessageReceived"),this.fetchChannel(channelId).then((function(channel){0===messageType?EventsService_1.eventsService.dispatchEvent(_this163.RAINBOW_ONCHANNELMESSAGERECEIVED,message):(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[ChannelsService] :: EVENT onMessageReceived - retracted message"),EventsService_1.eventsService.dispatchEvent(_this163.RAINBOW_ONCHANNELRETRACTMESSAGERECEIVED,{channel:channel,message:message}))}))}},{key:"onChannelUpdated",value:function(__event,updateType,id){var _this164=this;RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[ChannelsService] :: EVENT: onChannelUpdated("+updateType+") id:"+id),3!==updateType?this.fetchChannel(id).then((function(channel){EventsService_1.eventsService.dispatchEvent(_this164.RAINBOW_ONCHANNELUPDATED,{channel:channel,updateType:updateType})})):EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELDELETED,id)}},{key:"onChannelUsersUpdated",value:function(__event,id,users){var _this165=this;RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[ChannelsService] :: EVENT onChannelUsersUpdated:"+id),this.fetchChannel(id).then((function(channel){EventsService_1.eventsService.dispatchEvent(_this165.RAINBOW_ONCHANNELUPDATED,{channel:channel,users:users})}))}},{key:"onChannelAvatarUpdated",value:function(__event,id){var _this166=this;this.fetchChannel(id).then((function(channel){RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[ChannelsService] :: EVENT onChannelAvatarUpdated"+channel.id),EventsService_1.eventsService.dispatchEvent(_this166.RAINBOW_ONCHANNELAVATARUPDATED,channel)}))}},{key:"onUserSubscriptionChange",value:function(__event,userType,channelId,userId){var _this167=this,channel=null;this.fetchChannel(channelId).then((function(channelFound){return channel=channelFound,contact_service_1.default.getContactByDBId(userId,!0)})).then((function(user){user=user||userId,4===userType?(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[ChannelsService] :: EVENT onUserSubscriptionChange: user subscribed to a channel: "+channelId),EventsService_1.eventsService.dispatchEvent(_this167.RAINBOW_ONCHANNELUSERSUBSCRIBED,{channel:channel,user:user})):(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[ChannelsService] :: EVENT onUserSubscriptionChange: user unsubscribed from a channel: "+channelId),EventsService_1.eventsService.dispatchEvent(_this167.RAINBOW_ONCHANNELUSERUNSUBSCRIBED,{channel:channel,user:user}))}))}},{key:"fetchMyChannels",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee316(){var channelService;return regenerator_default.a.wrap((function(_context317){for(;;)switch(_context317.prev=_context317.next){case 0:return channelService=_channelService.get(this),_context317.next=3,channelService.getMyChannels();case 3:return _context317.abrupt("return",_context317.sent);case 4:case"end":return _context317.stop()}}),_callee316,this)})))}},{key:"createPublicChannel",value:function(channelName){var channelTopic=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",category=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee317(){var channelService,channel;return regenerator_default.a.wrap((function(_context318){for(;;)switch(_context318.prev=_context318.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[createPublicChannel] :: Trying to create a new public channel"),channelName){_context318.next=3;break}throw new Error("Parameter 'channelName' is missing or empty");case 3:return _context318.next=5,channelService.createChannel(channelName,"company_public",channelTopic,category,!1);case 5:return channel=_context318.sent,_context318.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[createPublicChannel] :: Public Channel created: "+channel.id),channel));case 7:case"end":return _context318.stop()}}),_callee317,this)})))}},{key:"createClosedChannel",value:function(channelName){var channelTopic=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",category=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee318(){var channelService,channel;return regenerator_default.a.wrap((function(_context319){for(;;)switch(_context319.prev=_context319.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[createClosedChannel] :: Trying to create a new closed channel"),channelName){_context319.next=3;break}throw new Error("Parameter 'channelName' is missing or empty");case 3:return channel=channelService.createChannel(channelName,"company_closed",channelTopic,category,!1),_context319.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[createClosedChannel] :: created: "+channel.id),channel));case 5:case"end":return _context319.stop()}}),_callee318,this)})))}},{key:"deleteChannel",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee319(){var channelService;return regenerator_default.a.wrap((function(_context320){for(;;)switch(_context320.prev=_context320.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteChannel] :: Trying to delete a channel"),id){_context320.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context320.next=5,channelService.deleteChannel(id);case 5:return RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteChannel] :: deleted: "+id),_context320.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 7:case"end":return _context320.stop()}}),_callee319,this)})))}},{key:"fetchChannelsByName",value:function(name){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee320(){var channelService,filter,channels;return regenerator_default.a.wrap((function(_context321){for(;;)switch(_context321.prev=_context321.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchChannelsByName] :: Trying to fetch channels by name"),name){_context321.next=3;break}throw new Error("Parameter 'name' is missing or empty");case 3:return(filter={}).name=name,_context321.next=7,channelService.findChannels(filter);case 7:return channels=_context321.sent,_context321.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchChannelsByName] :: fetched: "+channels.length),channels));case 9:case"end":return _context321.stop()}}),_callee320,this)})))}},{key:"fetchChannelsByTopic",value:function(topic){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee321(){var channelService,filter,channels;return regenerator_default.a.wrap((function(_context322){for(;;)switch(_context322.prev=_context322.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchChannelsByTopic] :: Trying to fetch channels by topic"),topic){_context322.next=3;break}throw new Error("Parameter 'topic' is missing or empty");case 3:return(filter={}).topic=topic,_context322.next=7,channelService.findChannels(filter);case 7:return channels=_context322.sent,_context322.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchChannelsByTopic] :: fetched: "+channels.length),channels));case 9:case"end":return _context322.stop()}}),_callee321,this)})))}},{key:"fetchChannelsByCategory",value:function(category){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee322(){var channelService,filter,channels;return regenerator_default.a.wrap((function(_context323){for(;;)switch(_context323.prev=_context323.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchChannelsByCategory] :: Trying to fetch channels by category"),category){_context323.next=3;break}throw new Error("Parameter 'category' is missing or empty");case 3:return(filter={}).category=category,channels=channelService.findChannels(filter),_context323.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchChannelsByCategory] :: fetched: "+channels.length),channels));case 7:case"end":return _context323.stop()}}),_callee322,this)})))}},{key:"fetchChannel",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee323(){var channelService,channel;return regenerator_default.a.wrap((function(_context324){for(;;)switch(_context324.prev=_context324.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchChannel] :: Trying to fetch a channel..."),id){_context324.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return channel=channelService.getChannel(id),_context324.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchChannel] :: fetched: "+channel.id),channel));case 5:case"end":return _context324.stop()}}),_callee323,this)})))}},{key:"createItem",value:function(channel,message,title,url,itemType){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee324(){var channelService;return regenerator_default.a.wrap((function(_context325){for(;;)switch(_context325.prev=_context325.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[createItem] :: Trying to create item"),channel){_context325.next=3;break}throw new Error("Parmeter 'channel' is missing or empty");case 3:if(message){_context325.next=5;break}throw new Error("Parmeter 'message' is missing or empty");case 5:if(!itemType||-1!==["basic","markdown","html","data"].indexOf(itemType)){_context325.next=7;break}throw new Error("Parameter 'itemType' could be 'asic', 'markdown', 'html' or 'data'");case 7:return title=title||"",url=url||"",itemType=itemType?"urn:xmpp:channels:"+itemType:"urn:xmpp:channels:basic",_context325.next=12,channelService.publishToChannel(channel.id,null,itemType,message,title,url);case 12:return RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[createItem] :: created: "+channel.id),_context325.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 14:case"end":return _context325.stop()}}),_callee324,this)})))}},{key:"subscribeToChannelById",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee325(){var channelService,channel,channelFound;return regenerator_default.a.wrap((function(_context326){for(;;)switch(_context326.prev=_context326.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[subscribeToChannelById] :: Trying to subscribe to a channel..."),id){_context326.next=3;break}throw new Error("Parameter 'id' is missing or null");case 3:if(!(channel=channelService.getChannelFromCache(id))){_context326.next=10;break}return _context326.next=7,channelService.subscribeToChannel(channel);case 7:RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[subscribeToChannelById] :: subscribed: "+id),_context326.next=18;break;case 10:return _context326.next=12,channelService.getChannel(id);case 12:if(channelFound=_context326.sent){_context326.next=15;break}return _context326.abrupt("return",{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"No channel found with id "+id});case 15:return _context326.next=17,channelService.subscribeToChannel(channelFound);case 17:RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[subscribeToChannelById] :: subscribed: "+id);case 18:return _context326.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 19:case"end":return _context326.stop()}}),_callee325,this)})))}},{key:"subscribeToChannel",value:function(channel){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee326(){var channelService;return regenerator_default.a.wrap((function(_context327){for(;;)switch(_context327.prev=_context327.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[subscribeToChannel] :: Trying to subscribe to a channel..."),channel){_context327.next=3;break}throw new Error("Paameter 'channel' is missing or null");case 3:return _context327.next=5,channelService.subscribeToChannel(channel);case 5:case"end":return _context327.stop()}}),_callee326,this)})))}},{key:"unsubscribeFromChannelById",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee327(){var channelService,channel,channelFound;return regenerator_default.a.wrap((function(_context328){for(;;)switch(_context328.prev=_context328.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[unsubscribeFromChannelById] :: Trying to unsubscribe from a channel..."),id){_context328.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:if(!(channel=channelService.getChannelFromCache(id))){_context328.next=10;break}return _context328.next=7,channelService.unsubscribeToChannel(channel);case 7:RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[unsubscribeFromChannelById] :: unsubscribed: "+id),_context328.next=16;break;case 10:if(channelFound=channelService.getChannel(id)){_context328.next=13;break}return _context328.abrupt("return",{code:sdkConstant_1.SDK.ERRORBADREQUEST,label:"No channel found with id "+id});case 13:return _context328.next=15,channelService.unsubscribeToChannel(channelFound);case 15:RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[unsubscribeFromChannelById] :: unsubscribed: "+id);case 16:return _context328.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 17:case"end":return _context328.stop()}}),_callee327,this)})))}},{key:"unsubscribeFromChannel",value:function(channel){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee328(){var channelService;return regenerator_default.a.wrap((function(_context329){for(;;)switch(_context329.prev=_context329.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[unsubscribeFromChannel] :: Trying to unsubscribe from a channel..."),channel){_context329.next=3;break}throw new Error("Parameter 'channel' is missing or null");case 3:return _context329.next=5,channelService.unsubscribeToChannel(channel);case 5:return RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[unsubscribeFromChannel] :: unsubscribed: "+channel.id),_context329.abrupt("return",{code:sdkConstant_1.SDK.OK,label:"OK"});case 7:case"end":return _context329.stop()}}),_callee328,this)})))}},{key:"updateChannel",value:function(id){var channelTopic=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",visibility=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"public",maxItems=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,maxPayloadSize=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4,channelName=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,category=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee329(){var channelService,options,updatedChannel;return regenerator_default.a.wrap((function(_context330){for(;;)switch(_context330.prev=_context330.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannel] :: Trying to update a channel..."),id){_context330.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return options={},null!==channelTopic&&(options.topic=channelTopic),null!==visibility&&(options.mode="company"===visibility?"company_public":"company_closed"),null!==maxItems&&(options.maxItems=maxItems),null!==maxPayloadSize&&(options.maxPayloadSize=maxPayloadSize),null!==channelName&&(options.name=channelName),null!==category&&(options.cateogry=category),_context330.next=7,channelService.updateChannel(id,options);case 7:return updatedChannel=_context330.sent,_context330.abrupt("return",(updatedChannel.visibility=options.visibility,RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannel] :: updated: "+id),updatedChannel));case 9:case"end":return _context330.stop()}}),_callee329,this)})))}},{key:"updateChannelVisibility",value:function(id,visibility){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee330(){var channelService,options,updatedChannel;return regenerator_default.a.wrap((function(_context331){for(;;)switch(_context331.prev=_context331.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelVisibility] :: Trying to update visibility of a channel..."),id){_context331.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:if(visibility){_context331.next=5;break}throw new Error("Parameter 'visibility' is missing or empty");case 5:return options={},null!==visibility&&(options.mode="company"===visibility?"company_public":"company_closed"),_context331.next=9,channelService.updateChannel(id,options);case 9:return updatedChannel=_context331.sent,_context331.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelVisibility] :: updated: "+id),updatedChannel));case 11:case"end":return _context331.stop()}}),_callee330,this)})))}},{key:"updateChannelVisibilityToPublic",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee331(){var channelService,updatedChannel;return regenerator_default.a.wrap((function(_context332){for(;;)switch(_context332.prev=_context332.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelVisibilityToPublic] :: Trying to update visibility to visible for a channel"),id){_context332.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context332.next=5,channelService.updateChannel(id,{mode:"company_public"});case 5:return updatedChannel=_context332.sent,_context332.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelVisibilityToPublic] :: updated: "+id),updatedChannel));case 7:case"end":return _context332.stop()}}),_callee331,this)})))}},{key:"updateChannelVisibilityToClosed",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee332(){var channelService,updatedChannel;return regenerator_default.a.wrap((function(_context333){for(;;)switch(_context333.prev=_context333.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelVisibilityToPublic] :: Trying to update visibility to visible for a channel"),id){_context333.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context333.next=5,channelService.updateChannel(id,{mode:"company_closed"});case 5:return updatedChannel=_context333.sent,_context333.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelVisibilityToPublic] :: updated: "+id),updatedChannel));case 7:case"end":return _context333.stop()}}),_callee332,this)})))}},{key:"updateChannelName",value:function(id,channelName){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee333(){var channelService,options,updatedChannel;return regenerator_default.a.wrap((function(_context334){for(;;)switch(_context334.prev=_context334.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelName] :: Trying to update the name of a channel"),id){_context334.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return options={},null!==channelName&&(options.name=channelName),updatedChannel=channelService.updateChannel(id,options),_context334.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelName] :: updated: "+id),updatedChannel));case 7:case"end":return _context334.stop()}}),_callee333,this)})))}},{key:"updateChannelTopic",value:function(id,channelTopic){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee334(){var channelService,options,updatedChannel;return regenerator_default.a.wrap((function(_context335){for(;;)switch(_context335.prev=_context335.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelTopic] :: Try to update the topic of a channel"),id){_context335.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return options={},null!==channelTopic&&(options.topic=channelTopic),updatedChannel=channelService.updateChannel(id,options),_context335.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelTopic] :: updated: "+id),updatedChannel));case 7:case"end":return _context335.stop()}}),_callee334,this)})))}},{key:"updateChannelCategory",value:function(id,category){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee335(){var channelService,options,updatedChannel;return regenerator_default.a.wrap((function(_context336){for(;;)switch(_context336.prev=_context336.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelCategory] :: Try to update the category of a channel"),id){_context336.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return options={},null!==category&&(options.category=category),updatedChannel=channelService.updateChannel(id,options),_context336.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelCategory] :: updated: "+id),updatedChannel));case 7:case"end":return _context336.stop()}}),_callee335,this)})))}},{key:"updateChannelAvatar",value:function(channel,urlAvatar){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee336(){var channelService;return regenerator_default.a.wrap((function(_context337){for(;;)switch(_context337.prev=_context337.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelAvatar] :: Try to update the avatar of a channel"),channel){_context337.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:if(urlAvatar){_context337.next=5;break}throw new Error("Parameter 'urlAvatar' is missing or empty");case 5:return _context337.abrupt("return",(channelService.uploadChannelAvatar(channel,urlAvatar,512),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelAvatar] :: updated: "+channel.id),{code:sdkConstant_1.SDK.OK,label:"OK"}));case 6:case"end":return _context337.stop()}}),_callee336,this)})))}},{key:"deleteChannelAvatar",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee337(){var channelService;return regenerator_default.a.wrap((function(_context338){for(;;)switch(_context338.prev=_context338.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteChannelAvatar] :: Try to delete the avatar of a channel"),id){_context338.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context338.abrupt("return",(channelService.deleteChannelAvatar(id),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteChannelAvatar] :: updated: "+id),{code:sdkConstant_1.SDK.OK,label:"OK"}));case 4:case"end":return _context338.stop()}}),_callee337,this)})))}},{key:"fetchUsers",value:function(id,options){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee338(){var channelService;return regenerator_default.a.wrap((function(_context339){for(;;)switch(_context339.prev=_context339.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchUsers] :: Trying to fetch users of a channel"),id){_context339.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context339.next=5,channelService.getChannelUsers(id,options);case 5:return _context339.abrupt("return",_context339.sent.data);case 6:case"end":return _context339.stop()}}),_callee338,this)})))}},{key:"deleteAllUsersFromChannel",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee339(){var channelService,updatedChannel;return regenerator_default.a.wrap((function(_context340){for(;;)switch(_context340.prev=_context340.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteAllUsersFromChannel] :: Trying to get delete all users of a channel..."),id){_context340.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context340.next=5,channelService.removeAllUsersFromChannel(id);case 5:return _context340.next=7,channelService.getChannel(id);case 7:return updatedChannel=_context340.sent,_context340.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteAllUsersFromChannel] :: deleted: "+id),updatedChannel));case 9:case"end":return _context340.stop()}}),_callee339,this)})))}},{key:"updateChannelUsers",value:function(id,users){var userType=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"member";return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee340(){var channelService,usersData;return regenerator_default.a.wrap((function(_context341){for(;;)switch(_context341.prev=_context341.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelUsers] :: Trying to update users of a channel"),id){_context341.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context341.next=5,channelService.updateChannelUsers(id,users,userType);case 5:return usersData=_context341.sent,_context341.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[updateChannelUsers] :: updated: "+id),usersData));case 7:case"end":return _context341.stop()}}),_callee340,this)})))}},{key:"addMembersToChannel",value:function(id,users){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee341(){var channelService,usersData;return regenerator_default.a.wrap((function(_context342){for(;;)switch(_context342.prev=_context342.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[addMembersToChannel] :: Trying to add members to a channel"),id){_context342.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context342.next=5,channelService.updateChannelUsers(id,users,"member");case 5:return usersData=_context342.sent,_context342.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[addMembersToChannel] :: added: "+id),usersData));case 7:case"end":return _context342.stop()}}),_callee341,this)})))}},{key:"addPublishersToChannel",value:function(id,users){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee342(){var channelService,usersData;return regenerator_default.a.wrap((function(_context343){for(;;)switch(_context343.prev=_context343.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[addPublishersToChannel] :: Trying to add publishers to a channel"),id){_context343.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context343.next=5,channelService.updateChannelUsers(id,users,"publisher");case 5:return usersData=_context343.sent,_context343.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[addPublishersToChannel] :: added: "+id),usersData));case 7:case"end":return _context343.stop()}}),_callee342,this)})))}},{key:"addOwnersToChannel",value:function(id,users){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee343(){var channelService,usersData;return regenerator_default.a.wrap((function(_context344){for(;;)switch(_context344.prev=_context344.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[addOwnersToChannel] :: Trying to add owners to a channel"),id){_context344.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context344.next=5,channelService.updateChannelUsers(id,users,"owner");case 5:return usersData=_context344.sent,_context344.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[addOwnersToChannel] :: added: "+id),usersData));case 7:case"end":return _context344.stop()}}),_callee343,this)})))}},{key:"deleteUsersFromChannel",value:function(id,users){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee344(){var channelService,usersData;return regenerator_default.a.wrap((function(_context345){for(;;)switch(_context345.prev=_context345.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteUsersFromChannel] :: Trying to delete users from a channel"),id){_context345.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return _context345.next=5,channelService.updateChannelUsers(id,users,"none");case 5:return usersData=_context345.sent,_context345.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteUsersFromChannel] :: deleted: "+id),usersData));case 7:case"end":return _context345.stop()}}),_callee344,this)})))}},{key:"fetchItems",value:function(id){var maxMessages=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,beforeDate=arguments.length>2?arguments[2]:void 0,afterDate=arguments.length>3?arguments[3]:void 0;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee345(){var channelService,messages;return regenerator_default.a.wrap((function(_context346){for(;;)switch(_context346.prev=_context346.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchItems] :: Try to fetch items of a channel"),id){_context346.next=3;break}throw new Error("Parameter 'id' is missing or empty");case 3:return messages=channelService.getChannelItems(id,maxMessages,beforeDate,afterDate),_context346.abrupt("return",(RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[fetchItems] :: fetched: "+id),messages));case 5:case"end":return _context346.stop()}}),_callee345,this)})))}},{key:"deleteItem",value:function(channelId,itemId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee346(){var channelService;return regenerator_default.a.wrap((function(_context347){for(;;)switch(_context347.prev=_context347.next){case 0:if(channelService=_channelService.get(this),RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteItem] :: Trying to delete an item."),channelId){_context347.next=3;break}throw new Error("Parameter 'channelId' is missing or empty");case 3:if(itemId){_context347.next=5;break}throw new Error("Parameter 'itemId' is missing or empty");case 5:return _context347.next=7,channelService.deleteChannelItem(channelId,itemId);case 7:RainbowLogger_1.rainbowLogger.sdk(ChannelsService.logService+"[deleteItem] :: Item deleted: "+itemId);case 8:case"end":return _context347.stop()}}),_callee346,this)})))}}],[{key:"$inject",get:function(){return["$rootScope","channelService"]}}]),ChannelsService}();ChannelsService.logService="ChannelsService | ",exports.ChannelsService=ChannelsService},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var RainbowLogger_1=__webpack_require__(9),EventsService_1=__webpack_require__(22),settings_service_1=__webpack_require__(5),sdkConfig_1=__webpack_require__(39),_connectionService=new WeakMap,_presenceService=new WeakMap,_contactsService=new WeakMap,_conversationsService=new WeakMap,_imService=new WeakMap,_pbxService=new WeakMap,_webRTCService=new WeakMap,_bubblesService=new WeakMap,_conferencesService=new WeakMap,_groupsService=new WeakMap,_callsLogService=new WeakMap,_userProfileService=new WeakMap,_favoritesService=new WeakMap,_filesStorageService=new WeakMap,_capabilitiesService=new WeakMap,_channelsService=new WeakMap,_adminService=new WeakMap;exports.SdkService=function(){function _class9(connectionService,presenceService,contactsService,conversationsService,imService,pbxService,webRTCService,bubblesService,conferencesService,groupsService,callsLogService,userProfileService,favoritesService,filesStorageService,capabilitiesService,channelsService,adminService){_classCallCheck(this,_class9),this.eventHandler=null,this.logService="SDKService | ",this.isReady=!1,this.RAINBOW_ONREADY="ready",this.RAINBOW_ONLOADED="loaded",_connectionService.set(this,connectionService),_presenceService.set(this,presenceService),_contactsService.set(this,contactsService),_conversationsService.set(this,conversationsService),_imService.set(this,imService),_pbxService.set(this,pbxService),_webRTCService.set(this,webRTCService),_bubblesService.set(this,bubblesService),_conferencesService.set(this,conferencesService),_groupsService.set(this,groupsService),_callsLogService.set(this,callsLogService),_userProfileService.set(this,userProfileService),_favoritesService.set(this,favoritesService),_filesStorageService.set(this,filesStorageService),_capabilitiesService.set(this,capabilitiesService),_channelsService.set(this,channelsService),_adminService.set(this,adminService),this.connection=connectionService,this.presence=presenceService,this.contacts=contactsService,this.conversations=conversationsService,this.im=imService,this.telephony=pbxService,this.webRTC=webRTCService,this.bubbles=bubblesService,this.conferences=conferencesService,this.groups=groupsService,this.callsLog=callsLogService,this.userProfile=userProfileService,this.favorites=favoritesService,this.fileStorage=filesStorageService,this.caps=capabilitiesService,this.channels=channelsService,this.admin=adminService,this.detectRTC=this.detectRTC.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.initializeAuto=this.initializeAuto.bind(this),this.start=this.start.bind(this)}return _createClass(_class9,[{key:"version",value:function(){return window.sdkversion}},{key:"mode",value:function(){return settings_service_1.default.getSetting("apiMode")}},{key:"setVerboseLog",value:function(boolHasVerboseLog){return sdkConfig_1.sdkConfig.verboseLog=boolHasVerboseLog,sdkConfig_1.sdkConfig.verboseLog}},{key:"setKeyFromConfig",value:function(strApplicationID,strApplicationSecret){return RainbowLogger_1.rainbowLogger.sdk(this.logService+"[setKeyFromConfig] :: Linked to application ID "+strApplicationID+" from configuration file"),sdkConfig_1.sdkConfig.credentials.appID=strApplicationID,sdkConfig_1.sdkConfig.credentials.appSecret=strApplicationSecret,!0}},{key:"hasBeenLaunchedFromConfig",value:function(boolFromConfig){var fromConfig=boolFromConfig?"YES":"NO";return RainbowLogger_1.rainbowLogger.sdk(this.logService+"[hasBeenLaunchedFromConfig] :: SDK launched from a configuration file "+fromConfig),sdk.hasBeenLaunchedFromConfig=boolFromConfig,sdk.hasBeenLaunchedFromConfig}},{key:"initialize",value:function(strApplicationID,strApplicationSecret){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee347(){return regenerator_default.a.wrap((function(_context348){for(;;)switch(_context348.prev=_context348.next){case 0:return strApplicationID&&strApplicationID.length>0?(sdk.key.appID=strApplicationID,RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize] :: Initialize the SDK for the application "+sdk.key.appID)):RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize] :: Initialize the SDK without an application key"),strApplicationSecret&&strApplicationSecret.length>0&&(sdk.key.appSecret=strApplicationSecret),_context348.next=4,this.detectRTC();case 4:return RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize] :: SDK Initialized successfully!"),_context348.abrupt("return",!0);case 6:case"end":return _context348.stop()}}),_callee347,this)})))}},{key:"detectRTC",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee348(){var DetectRTC;return regenerator_default.a.wrap((function(_context349){for(;;)switch(_context349.prev=_context349.next){case 0:return DetectRTC=window.DetectRTC,_context349.next=3,DetectRTC.load();case 3:this.initializeAuto();case 4:case"end":return _context349.stop()}}),_callee348,this)})))}},{key:"load",value:function(customConfig){customConfig&&(RainbowLogger_1.rainbowLogger.sdk(this.logService+"Loading Rainbow Web SDK with custom config"),Object.assign(sdkConfig_1.sdkConfig,customConfig)),this.start(),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[load] :: Rainbow SDK loaded!"),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONLOADED,null)}},{key:"ready",value:function(){RainbowLogger_1.rainbowLogger.sdk(this.logService+"[ready] :: Rainbow SDK ready!"),EventsService_1.eventsService.dispatchEvent(this.RAINBOW_ONREADY,null)}},{key:"initializeAuto",value:function(){var sdkversion=window.sdkversion,DetectRTC=window.DetectRTC,config=window.config;RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Initializing the Rainbow SDK..."),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: -----------------------------"),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Platform    | "+DetectRTC.osName+" "+DetectRTC.osVersion),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Screen      | "+window.screen.width+"x"+window.screen.height),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Cookie      | "+navigator.cookieEnabled),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Java        | "+navigator.javaEnabled()),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Server      | "+config.webservices.server),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Version WEB | "+version),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Version SDK | "+sdkversion),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Browser     | "+DetectRTC.browser.name+" "+DetectRTC.browser.fullVersion),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Microphone  | "+DetectRTC.hasMicrophone),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Camera      | "+DetectRTC.hasWebcam),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Speakers    | "+DetectRTC.hasSpeakers),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: WebRTC      | "+DetectRTC.isWebRTCSupported),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Mode        | "+this.mode()),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: verboseLog  | "+sdkConfig_1.sdkConfig.verboseLog),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: appID       | "+sdk.key.appID),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: -----------------------------"),RainbowLogger_1.rainbowLogger.sdk(this.logService+"[initialize ] :: Initialized!"),this.ready()}},{key:"start",value:function(){window.config.webservices.currentServer=window.config.webservices.server,this.isReady=!0}}],[{key:"$inject",get:function(){return["connectionService","presenceService","contactsService","conversationsService","imService","pbxService","webRTCService","bubblesService","conferencesService","groupsService","callsLogService","userProfileService","favoritesService","filesStorageService","capabilitiesService","channelsService","adminService"]}}]),_class9}()},function(module,exports){window.version="2.84.0"},function(module,exports){window.sdkversion="1.84.0"},function(module,exports){window.config={xmpp:{protocol:"wss",server:"sandbox.openrainbow.com",port:"443",pingInterval:"60000"},webservices:{protocol:"https",server:"sandbox.openrainbow.com",port:"443"},cpaas:{protocol:"https",server:"",port:"8887"}}},function(module,exports){window.app=angular.module("rainbow",[]),window.rainbowAdmin=angular.module("rainbowAdmin",[]),window.rainbow=angular.module("rainbow",["rainbowAdmin"])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__(352),__webpack_require__(355),__webpack_require__(358),__webpack_require__(361),__webpack_require__(363);var _RainbowLogger__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9);angular.module("rainbow").moduleIds=[],__webpack_require__(258),__webpack_require__(260),__webpack_require__(261),__webpack_require__(54),__webpack_require__(71),__webpack_require__(272),__webpack_require__(273),__webpack_require__(274),__webpack_require__(275),__webpack_require__(276),__webpack_require__(306),__webpack_require__(220),__webpack_require__(307),__webpack_require__(221),__webpack_require__(308),__webpack_require__(43),__webpack_require__(309),__webpack_require__(16),__webpack_require__(0),__webpack_require__(312),__webpack_require__(313),__webpack_require__(314),__webpack_require__(222),__webpack_require__(316),__webpack_require__(317),__webpack_require__(318),__webpack_require__(319),__webpack_require__(320),__webpack_require__(321),__webpack_require__(322),__webpack_require__(323),__webpack_require__(324),__webpack_require__(325),__webpack_require__(326),__webpack_require__(327),__webpack_require__(328),__webpack_require__(329),__webpack_require__(225),__webpack_require__(351),__webpack_require__(366),__webpack_require__(367),__webpack_require__(368),__webpack_require__(369),__webpack_require__(370),__webpack_require__(371),__webpack_require__(372),__webpack_require__(373),__webpack_require__(374),__webpack_require__(375),__webpack_require__(376),__webpack_require__(377),__webpack_require__(378),__webpack_require__(379),__webpack_require__(380),__webpack_require__(381),__webpack_require__(382),__webpack_require__(383),__webpack_require__(384),angular.module("rainbow").factory("rainbowLogger",(function(){return _RainbowLogger__WEBPACK_IMPORTED_MODULE_5__.rainbowLogger})),__webpack_require__(388),__webpack_require__(389),__webpack_require__(390),__webpack_require__(391),__webpack_require__(394),__webpack_require__(395),__webpack_require__(405),__webpack_require__(406),__webpack_require__(407),__webpack_require__(408),__webpack_require__(409)},function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;!function(){function retry(isDone,next){var currentTrial=0,isTimeout=!1,id=window.setInterval((function(){isDone()&&(window.clearInterval(id),next(isTimeout)),currentTrial++>50&&(window.clearInterval(id),next(isTimeout=!0))}),10)}var that,browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if("object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var version=process.versions.node.toString().replace("v","");browserFakeUserAgent="Nodejs/"+version+" (NodeOS) AppleWebKit/"+version+" (KHTML, like Gecko) Nodejs/"+version+" Nodejs/"+version}that=void 0!==global?global:window,"undefined"==typeof window&&("undefined"==typeof window&&void 0!==global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},that.window=global),"undefined"==typeof location&&(that.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(that.screen={width:0,height:0}));var navigator=window.navigator;void 0!==navigator?(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia)):navigator={getUserMedia:function(){},userAgent:browserFakeUserAgent};var ua,match,isMobileDevice=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent||""),isEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob),isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),isChrome=!!window.chrome&&!isOpera,isIE="undefined"!=typeof document&&!!document.documentMode&&!isEdge,isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()},getOsName:function(){var osName="Unknown OS";return isMobile.Android()&&(osName="Android"),isMobile.BlackBerry()&&(osName="BlackBerry"),isMobile.iOS()&&(osName="iOS"),isMobile.Opera()&&(osName="Opera Mini"),isMobile.Windows()&&(osName="Windows"),osName}},osName="Unknown OS",osVersion="Unknown OS Version",osInfo=function(){for(var cs,nVer=navigator.appVersion,nAgt=navigator.userAgent,os="-",clientStrings=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],i=0;cs=clientStrings[i];i++)if(cs.r.test(nAgt)){os=cs.s;break}var osVersion="-";switch(/Windows/.test(os)&&(/Windows (.*)/.test(os)&&(osVersion=/Windows (.*)/.exec(os)[1]),os="Windows"),os){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(nAgt)&&(osVersion=/Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(nAgt)&&(osVersion=/Android ([\.\_\d]+)/.exec(nAgt)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(nAgt)&&(osVersion=(osVersion=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer))[1]+"."+osVersion[2]+"."+(0|osVersion[3]))}return{osName:os,osVersion:osVersion}}();osInfo&&osInfo.osName&&"-"!=osInfo.osName?(osName=osInfo.osName,osVersion=osInfo.osVersion):isMobile.any()&&"Android"==(osName=isMobile.getOsName())&&(osVersion=!!(match=(ua=(ua||navigator.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&match[1]);var isNodejs="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===osName&&isNodejs&&(osName="Nodejs",osVersion=process.versions.node.toString().replace("v",""));var isCanvasSupportsStreamCapturing=!1,isVideoSupportsStreamCapturing=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(item){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!isCanvasSupportsStreamCapturing&&item in document.createElement("canvas")&&(isCanvasSupportsStreamCapturing=!0),!isVideoSupportsStreamCapturing&&item in document.createElement("video")&&(isVideoSupportsStreamCapturing=!0))}));var regexIpv4Local=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,regexIpv4=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,regexIpv6=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,MediaDevices=[],audioInputDevices=[],audioOutputDevices=[],videoInputDevices=[];navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(callback){var enumerateDevices=navigator.mediaDevices.enumerateDevices();enumerateDevices&&enumerateDevices.then?navigator.mediaDevices.enumerateDevices().then(callback).catch((function(){callback([])})):callback([])});var canEnumerate=!1;("undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(canEnumerate=!0);var hasMicrophone=!1,hasSpeakers=!1,hasWebcam=!1,isWebsiteHasMicrophonePermissions=!1,isWebsiteHasWebcamPermissions=!1,DetectRTC=window.DetectRTC||{};DetectRTC.browser=function(){var nameOffset,verOffset,ix,nAgt=(navigator.appVersion,navigator.userAgent),browserName=navigator.appName,fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10);if(isOpera){browserName="Opera";try{majorVersion=(fullVersion=navigator.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){fullVersion="0.0.0.0",majorVersion=0}}else isIE?((verOffset=nAgt.indexOf("rv:"))>0?fullVersion=nAgt.substring(verOffset+3):(verOffset=nAgt.indexOf("MSIE"),fullVersion=nAgt.substring(verOffset+5)),browserName="IE"):isChrome?(verOffset=nAgt.indexOf("Chrome"),browserName="Chrome",fullVersion=nAgt.substring(verOffset+7)):isSafari?-1!==nAgt.indexOf("CriOS")?(verOffset=nAgt.indexOf("CriOS"),browserName="Chrome",fullVersion=nAgt.substring(verOffset+6)):-1!==nAgt.indexOf("FxiOS")?(verOffset=nAgt.indexOf("FxiOS"),browserName="Firefox",fullVersion=nAgt.substring(verOffset+6)):(verOffset=nAgt.indexOf("Safari"),browserName="Safari",fullVersion=nAgt.substring(verOffset+7),-1!==(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8)),-1!==navigator.userAgent.indexOf("Version/")&&(fullVersion=navigator.userAgent.split("Version/")[1].split(" ")[0])):isFirefox?(verOffset=nAgt.indexOf("Firefox"),browserName="Firefox",fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(browserName=nAgt.substring(nameOffset,verOffset),fullVersion=nAgt.substring(verOffset+1),browserName.toLowerCase()===browserName.toUpperCase()&&(browserName=navigator.appName));return isEdge&&(browserName="Edge",fullVersion=navigator.userAgent.split("Edge/")[1]),-1!==(ix=fullVersion.search(/[; \)]/))&&(fullVersion=fullVersion.substring(0,ix)),majorVersion=parseInt(""+fullVersion,10),isNaN(majorVersion)&&(fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10)),{fullVersion:fullVersion,version:majorVersion,name:browserName,isPrivateBrowsing:!1}}(),function(callback){var isPrivate;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,(function(){isPrivate=!1}),(function(e){isPrivate=!0}));else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var db;try{(db=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){isPrivate=!0}void 0===isPrivate&&retry((function(){return"done"===db.readyState}),(function(isTimeout){isTimeout||(isPrivate=!db.result)}))}else if(function(userAgent){var ua=window.navigator.userAgent.toLowerCase();if(0===ua.indexOf("msie")&&0===ua.indexOf("trident"))return!1;var match=/(?:msie|rv:)\s?([\d\.]+)/.exec(ua);return!!(match&&parseInt(match[1],10)>=10)}()){isPrivate=!1;try{window.indexedDB||(isPrivate=!0)}catch(e){isPrivate=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){isPrivate=!0}void 0===isPrivate&&(isPrivate=!1,window.localStorage.removeItem("test"))}}catch(e){isPrivate=!1}retry((function(){return void 0!==isPrivate}),(function(isTimeout){var isPrivateBrowsing;isPrivateBrowsing=isPrivate,DetectRTC.browser.isPrivateBrowsing=!!isPrivateBrowsing}))}(),DetectRTC.browser["is"+DetectRTC.browser.name]=!0,DetectRTC.osName=osName,DetectRTC.osVersion=osVersion;var isWebRTCSupported=("object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"],!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(item){isWebRTCSupported||item in window&&(isWebRTCSupported=!0)})),DetectRTC.isWebRTCSupported=isWebRTCSupported,DetectRTC.isORTCSupported="undefined"!=typeof RTCIceGatherer;var isScreenCapturingSupported=!1;(DetectRTC.browser.isChrome&&DetectRTC.browser.version>=35||DetectRTC.browser.isFirefox&&DetectRTC.browser.version>=34||DetectRTC.browser.isEdge&&DetectRTC.browser.version>=17||"Android"===DetectRTC.osName&&DetectRTC.browser.isChrome)&&(isScreenCapturingSupported=!0),(navigator.getDisplayMedia||navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)&&(isScreenCapturingSupported=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||"")||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(DetectRTC.browser.isChrome||DetectRTC.browser.isEdge||DetectRTC.browser.isOpera)||DetectRTC.browser.isFirefox)&&(isScreenCapturingSupported=!1),DetectRTC.isScreenCapturingSupported=isScreenCapturingSupported;var webAudio={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach((function(item){webAudio.isSupported||item in window&&(webAudio.isSupported=!0,window[item]&&"createMediaStreamSource"in window[item].prototype&&(webAudio.isCreateMediaStreamSourceSupported=!0))})),DetectRTC.isAudioContextSupported=webAudio.isSupported,DetectRTC.isCreateMediaStreamSourceSupported=webAudio.isCreateMediaStreamSourceSupported;var isRtpDataChannelsSupported=!1;DetectRTC.browser.isChrome&&DetectRTC.browser.version>31&&(isRtpDataChannelsSupported=!0),DetectRTC.isRtpDataChannelsSupported=isRtpDataChannelsSupported;var isSCTPSupportd=!1;(DetectRTC.browser.isFirefox&&DetectRTC.browser.version>28||DetectRTC.browser.isChrome&&DetectRTC.browser.version>25||DetectRTC.browser.isOpera&&DetectRTC.browser.version>=11)&&(isSCTPSupportd=!0),DetectRTC.isSctpDataChannelsSupported=isSCTPSupportd,DetectRTC.isMobileDevice=isMobileDevice;var isGetUserMediaSupported=!1;(navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&(isGetUserMediaSupported=!0),DetectRTC.browser.isChrome&&DetectRTC.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(isGetUserMediaSupported="Requires HTTPs"),"Nodejs"===DetectRTC.osName&&(isGetUserMediaSupported=!1),DetectRTC.isGetUserMediaSupported=isGetUserMediaSupported;var w,h,r,displayResolution="";screen.width&&(displayResolution+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")),DetectRTC.displayResolution=displayResolution,DetectRTC.displayAspectRatio=(w=screen.width,h=screen.height,r=function gcd(a,b){return 0==b?a:gcd(b,a%b)}(w,h),w/r/(h/r)).toFixed(2),DetectRTC.isCanvasSupportsStreamCapturing=isCanvasSupportsStreamCapturing,DetectRTC.isVideoSupportsStreamCapturing=isVideoSupportsStreamCapturing,"Chrome"==DetectRTC.browser.name&&DetectRTC.browser.version>=53&&(DetectRTC.isCanvasSupportsStreamCapturing||(DetectRTC.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),DetectRTC.isVideoSupportsStreamCapturing||(DetectRTC.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),DetectRTC.DetectLocalIPAddress=function(callback,stream){if(DetectRTC.isWebRTCSupported){var isPublic=!0,isIpv4=!0;!function(callback,stream){function handleCandidate(candidate){if(candidate){var match=regexIpv4.exec(candidate);if(match){var ipAddress=match[1];candidate.match(regexIpv4Local);void 0===ipDuplicates[ipAddress]&&callback(ipAddress),ipDuplicates[ipAddress]=!0}}else callback()}function afterCreateOffer(){pc.localDescription.sdp.split("\n").forEach((function(line){line&&0===line.indexOf("a=candidate:")&&handleCandidate(line)}))}if("undefined"!=typeof document&&"function"==typeof document.getElementById){var ipDuplicates={},RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!RTCPeerConnection){var iframe=document.getElementById("iframe");if(!iframe)return;var win=iframe.contentWindow;RTCPeerConnection=win.RTCPeerConnection||win.mozRTCPeerConnection||win.webkitRTCPeerConnection}if(RTCPeerConnection){var peerConfig=null;"Chrome"===DetectRTC.browser&&DetectRTC.browser.version<58&&(peerConfig={optional:[{RtpDataChannels:!0}]});var pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConfig);if(stream&&(pc.addStream?pc.addStream(stream):pc.addTrack&&stream.getTracks()[0]&&pc.addTrack(stream.getTracks()[0],stream)),pc.onicecandidate=function(event){event.candidate&&event.candidate.candidate?handleCandidate(event.candidate.candidate):handleCandidate()},!stream)try{pc.createDataChannel("sctp",{})}catch(e){}DetectRTC.isPromisesSupported?pc.createOffer().then((function(result){pc.setLocalDescription(result).then(afterCreateOffer)})):pc.createOffer((function(result){pc.setLocalDescription(result,afterCreateOffer,(function(){}))}),(function(){}))}}}((function(ip){ip?ip.match(regexIpv4Local)?callback("Local: "+ip,isPublic=!1,isIpv4):ip.match(regexIpv6)?callback("Public: "+ip,isPublic,isIpv4=!1):callback("Public: "+ip,isPublic,isIpv4):callback()}),stream)}},DetectRTC.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,DetectRTC.isWebSocketsBlocked=!DetectRTC.isWebSocketsSupported,"Nodejs"===DetectRTC.osName&&(DetectRTC.isWebSocketsSupported=!0,DetectRTC.isWebSocketsBlocked=!1),DetectRTC.checkWebSocketsSupport=function(callback){callback=callback||function(){};try{var starttime,websocket=new WebSocket("wss://echo.websocket.org:443/");websocket.onopen=function(){DetectRTC.isWebSocketsBlocked=!1,starttime=(new Date).getTime(),websocket.send("ping")},websocket.onmessage=function(){DetectRTC.WebsocketLatency=(new Date).getTime()-starttime+"ms",callback(),websocket.close(),websocket=null},websocket.onerror=function(){DetectRTC.isWebSocketsBlocked=!0,callback()}}catch(e){DetectRTC.isWebSocketsBlocked=!0,callback()}},DetectRTC.load=function(callback){!function(callback){if(canEnumerate)if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices){MediaDevices=[],audioInputDevices=[],audioOutputDevices=[],videoInputDevices=[],hasMicrophone=!1,hasSpeakers=!1,hasWebcam=!1,isWebsiteHasMicrophonePermissions=!1,isWebsiteHasWebcamPermissions=!1;var alreadyUsedDevices={};navigator.enumerateDevices((function(devices){MediaDevices=[],audioInputDevices=[],audioOutputDevices=[],videoInputDevices=[],devices.forEach((function(_device){var device={};for(var d in _device)try{"function"!=typeof _device[d]&&(device[d]=_device[d])}catch(e){}alreadyUsedDevices[device.deviceId+device.label+device.kind]||("audio"===device.kind&&(device.kind="audioinput"),"video"===device.kind&&(device.kind="videoinput"),device.deviceId||(device.deviceId=device.id),device.id||(device.id=device.deviceId),device.label?("videoinput"!==device.kind||isWebsiteHasWebcamPermissions||(isWebsiteHasWebcamPermissions=!0),"audioinput"!==device.kind||isWebsiteHasMicrophonePermissions||(isWebsiteHasMicrophonePermissions=!0)):(device.isCustomLabel=!0,"videoinput"===device.kind?device.label="Camera "+(videoInputDevices.length+1):"audioinput"===device.kind?device.label="Microphone "+(audioInputDevices.length+1):"audiooutput"===device.kind?device.label="Speaker "+(audioOutputDevices.length+1):device.label="Please invoke getUserMedia once.",void 0!==DetectRTC&&DetectRTC.browser.isChrome&&DetectRTC.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(device.label="HTTPs is required to get label of this "+device.kind+" device.")),"audioinput"===device.kind&&(hasMicrophone=!0,-1===audioInputDevices.indexOf(device)&&audioInputDevices.push(device)),"audiooutput"===device.kind&&(hasSpeakers=!0,-1===audioOutputDevices.indexOf(device)&&audioOutputDevices.push(device)),"videoinput"===device.kind&&(hasWebcam=!0,-1===videoInputDevices.indexOf(device)&&videoInputDevices.push(device)),MediaDevices.push(device),alreadyUsedDevices[device.deviceId+device.label+device.kind]=device)})),void 0!==DetectRTC&&(DetectRTC.MediaDevices=MediaDevices,DetectRTC.hasMicrophone=hasMicrophone,DetectRTC.hasSpeakers=hasSpeakers,DetectRTC.hasWebcam=hasWebcam,DetectRTC.isWebsiteHasWebcamPermissions=isWebsiteHasWebcamPermissions,DetectRTC.isWebsiteHasMicrophonePermissions=isWebsiteHasMicrophonePermissions,DetectRTC.audioInputDevices=audioInputDevices,DetectRTC.audioOutputDevices=audioOutputDevices,DetectRTC.videoInputDevices=videoInputDevices),callback&&callback()}))}else callback&&callback();else callback&&callback()}(callback=callback||function(){})},DetectRTC.MediaDevices=void 0!==MediaDevices?MediaDevices:[],DetectRTC.hasMicrophone=hasMicrophone,DetectRTC.hasSpeakers=hasSpeakers,DetectRTC.hasWebcam=hasWebcam,DetectRTC.isWebsiteHasWebcamPermissions=isWebsiteHasWebcamPermissions,DetectRTC.isWebsiteHasMicrophonePermissions=isWebsiteHasMicrophonePermissions,DetectRTC.audioInputDevices=audioInputDevices,DetectRTC.audioOutputDevices=audioOutputDevices,DetectRTC.videoInputDevices=videoInputDevices;var isSetSinkIdSupported=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(isSetSinkIdSupported=!0),DetectRTC.isSetSinkIdSupported=isSetSinkIdSupported;var isRTPSenderReplaceTracksSupported=!1;DetectRTC.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(isRTPSenderReplaceTracksSupported=!0):DetectRTC.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(isRTPSenderReplaceTracksSupported=!0),DetectRTC.isRTPSenderReplaceTracksSupported=isRTPSenderReplaceTracksSupported;var isRemoteStreamProcessingSupported=!1;DetectRTC.browser.isFirefox&&DetectRTC.browser.version>38&&(isRemoteStreamProcessingSupported=!0),DetectRTC.isRemoteStreamProcessingSupported=isRemoteStreamProcessingSupported;var isApplyConstraintsSupported=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(isApplyConstraintsSupported=!0),DetectRTC.isApplyConstraintsSupported=isApplyConstraintsSupported;var isMultiMonitorScreenCapturingSupported=!1;DetectRTC.browser.isFirefox&&DetectRTC.browser.version>=43&&(isMultiMonitorScreenCapturingSupported=!0),DetectRTC.isMultiMonitorScreenCapturingSupported=isMultiMonitorScreenCapturingSupported,DetectRTC.isPromisesSupported=!!("Promise"in window),DetectRTC.version="1.4.0",void 0===DetectRTC&&(window.DetectRTC={});var MediaStream=window.MediaStream;void 0===MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),DetectRTC.MediaStream=void 0!==MediaStream&&"function"==typeof MediaStream&&Object.keys(MediaStream.prototype),"undefined"!=typeof MediaStreamTrack?DetectRTC.MediaStreamTrack=Object.keys(MediaStreamTrack.prototype):DetectRTC.MediaStreamTrack=!1;var RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;DetectRTC.RTCPeerConnection=void 0!==RTCPeerConnection&&Object.keys(RTCPeerConnection.prototype),window.DetectRTC=DetectRTC,module.exports=DetectRTC,void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return DetectRTC}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}).call(this,__webpack_require__(259),__webpack_require__(65))},function(module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},function(module,exports){function RBError(message,details,detailsCode,detailsData){this.name="RainbowError",this.message=message,this.details=details,this.detailsCode=detailsCode,this.detailsData=detailsData,this.stack=(new Error).stack}RBError.prototype=Object.create(Error.prototype),RBError.prototype.constructor=RBError,window.RBError=RBError},function(module,exports){angular.module("rainbow").factory("CompanyInvitation",[function(){function CompanyInvitation(id,companyId,companyName,invitedUserId,invitedUserEmail,invitingAdminId,invitingAdminLoginEmail,invitationDate,lastNotificationDate,requestedNotificationLanguage,status,acceptationDate,declinationDate,invitedToBeCompanyAdmin){this.id=id,this.companyId=companyId,this.companyName=companyName,this.invitedUserId=invitedUserId,this.invitedUserEmail=invitedUserEmail,this.invitingAdminId=invitingAdminId,this.invitingAdminLoginEmail=invitingAdminLoginEmail,this.invitationDate=invitationDate,this.lastNotificationDate=lastNotificationDate,this.requestedNotificationLanguage=requestedNotificationLanguage,this.status=status,this.acceptationDate=acceptationDate,this.declinationDate=declinationDate,this.invitedToBeCompanyAdmin=invitedToBeCompanyAdmin}return CompanyInvitation.createFromData=function(data){return new CompanyInvitation(data.id,data.companyId,data.companyName,data.invitedUserId,data.invitedUserEmail,data.invitingAdminId,data.invitingAdminLoginEmail,data.invitationDate,data.lastNotificationDate,data.requestedNotificationLanguage,data.status,data.acceptationDate,data.declinationDate,data.invitedToBeCompanyAdmin)},CompanyInvitation}])},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Subscriber_1=__webpack_require__(56);exports.canReportError=function(observer){for(;observer;){var _a=observer,closed_1=_a.closed,destination=_a.destination,isStopped=_a.isStopped;if(closed_1||isStopped)return!1;observer=destination&&destination instanceof Subscriber_1.Subscriber?destination:null}return!0}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.isArray=Array.isArray||function(x){return x&&"number"==typeof x.length}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.isObject=function(x){return null!==x&&"object"==typeof x}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var UnsubscriptionErrorImpl=function(){function UnsubscriptionErrorImpl(errors){return Error.call(this),this.message=errors?errors.length+" errors occurred during unsubscription:\n"+errors.map((function(err,i){return i+1+") "+err.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=errors,this}return UnsubscriptionErrorImpl.prototype=Object.create(Error.prototype),UnsubscriptionErrorImpl}();exports.UnsubscriptionError=UnsubscriptionErrorImpl},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Subscriber_1=__webpack_require__(56),rxSubscriber_1=__webpack_require__(69),Observer_1=__webpack_require__(79);exports.toSubscriber=function(nextOrObserver,error,complete){if(nextOrObserver){if(nextOrObserver instanceof Subscriber_1.Subscriber)return nextOrObserver;if(nextOrObserver[rxSubscriber_1.rxSubscriber])return nextOrObserver[rxSubscriber_1.rxSubscriber]()}return nextOrObserver||error||complete?new Subscriber_1.Subscriber(nextOrObserver,error,complete):new Subscriber_1.Subscriber(Observer_1.empty)}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var identity_1=__webpack_require__(269);function pipeFromArray(fns){return 0===fns.length?identity_1.identity:1===fns.length?fns[0]:function(input){return fns.reduce((function(prev,fn){return fn(prev)}),input)}}exports.pipe=function(){for(var fns=[],_i=0;_i<arguments.length;_i++)fns[_i]=arguments[_i];return pipeFromArray(fns)},exports.pipeFromArray=pipeFromArray},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.identity=function(x){return x}},function(module,exports){module.exports=function(module){return module.webpackPolyfill||(module.deprecate=function(){},module.paths=[],module.children||(module.children=[]),Object.defineProperty(module,"loaded",{enumerable:!0,get:function(){return module.l}}),Object.defineProperty(module,"id",{enumerable:!0,get:function(){return module.i}}),module.webpackPolyfill=1),module}},function(module,exports,__webpack_require__){var map={"./af":82,"./af.js":82,"./ar":83,"./ar-dz":84,"./ar-dz.js":84,"./ar-kw":85,"./ar-kw.js":85,"./ar-ly":86,"./ar-ly.js":86,"./ar-ma":87,"./ar-ma.js":87,"./ar-sa":88,"./ar-sa.js":88,"./ar-tn":89,"./ar-tn.js":89,"./ar.js":83,"./az":90,"./az.js":90,"./be":91,"./be.js":91,"./bg":92,"./bg.js":92,"./bm":93,"./bm.js":93,"./bn":94,"./bn-bd":95,"./bn-bd.js":95,"./bn.js":94,"./bo":96,"./bo.js":96,"./br":97,"./br.js":97,"./bs":98,"./bs.js":98,"./ca":99,"./ca.js":99,"./cs":100,"./cs.js":100,"./cv":101,"./cv.js":101,"./cy":102,"./cy.js":102,"./da":103,"./da.js":103,"./de":104,"./de-at":105,"./de-at.js":105,"./de-ch":106,"./de-ch.js":106,"./de.js":104,"./dv":107,"./dv.js":107,"./el":108,"./el.js":108,"./en-au":109,"./en-au.js":109,"./en-ca":110,"./en-ca.js":110,"./en-gb":111,"./en-gb.js":111,"./en-ie":112,"./en-ie.js":112,"./en-il":113,"./en-il.js":113,"./en-in":114,"./en-in.js":114,"./en-nz":115,"./en-nz.js":115,"./en-sg":116,"./en-sg.js":116,"./eo":117,"./eo.js":117,"./es":118,"./es-do":119,"./es-do.js":119,"./es-mx":120,"./es-mx.js":120,"./es-us":121,"./es-us.js":121,"./es.js":118,"./et":122,"./et.js":122,"./eu":123,"./eu.js":123,"./fa":124,"./fa.js":124,"./fi":125,"./fi.js":125,"./fil":126,"./fil.js":126,"./fo":127,"./fo.js":127,"./fr":128,"./fr-ca":129,"./fr-ca.js":129,"./fr-ch":130,"./fr-ch.js":130,"./fr.js":128,"./fy":131,"./fy.js":131,"./ga":132,"./ga.js":132,"./gd":133,"./gd.js":133,"./gl":134,"./gl.js":134,"./gom-deva":135,"./gom-deva.js":135,"./gom-latn":136,"./gom-latn.js":136,"./gu":137,"./gu.js":137,"./he":138,"./he.js":138,"./hi":139,"./hi.js":139,"./hr":140,"./hr.js":140,"./hu":141,"./hu.js":141,"./hy-am":142,"./hy-am.js":142,"./id":143,"./id.js":143,"./is":144,"./is.js":144,"./it":145,"./it-ch":146,"./it-ch.js":146,"./it.js":145,"./ja":147,"./ja.js":147,"./jv":148,"./jv.js":148,"./ka":149,"./ka.js":149,"./kk":150,"./kk.js":150,"./km":151,"./km.js":151,"./kn":152,"./kn.js":152,"./ko":153,"./ko.js":153,"./ku":154,"./ku.js":154,"./ky":155,"./ky.js":155,"./lb":156,"./lb.js":156,"./lo":157,"./lo.js":157,"./lt":158,"./lt.js":158,"./lv":159,"./lv.js":159,"./me":160,"./me.js":160,"./mi":161,"./mi.js":161,"./mk":162,"./mk.js":162,"./ml":163,"./ml.js":163,"./mn":164,"./mn.js":164,"./mr":165,"./mr.js":165,"./ms":166,"./ms-my":167,"./ms-my.js":167,"./ms.js":166,"./mt":168,"./mt.js":168,"./my":169,"./my.js":169,"./nb":170,"./nb.js":170,"./ne":171,"./ne.js":171,"./nl":172,"./nl-be":173,"./nl-be.js":173,"./nl.js":172,"./nn":174,"./nn.js":174,"./oc-lnc":175,"./oc-lnc.js":175,"./pa-in":176,"./pa-in.js":176,"./pl":177,"./pl.js":177,"./pt":178,"./pt-br":179,"./pt-br.js":179,"./pt.js":178,"./ro":180,"./ro.js":180,"./ru":181,"./ru.js":181,"./sd":182,"./sd.js":182,"./se":183,"./se.js":183,"./si":184,"./si.js":184,"./sk":185,"./sk.js":185,"./sl":186,"./sl.js":186,"./sq":187,"./sq.js":187,"./sr":188,"./sr-cyrl":189,"./sr-cyrl.js":189,"./sr.js":188,"./ss":190,"./ss.js":190,"./sv":191,"./sv.js":191,"./sw":192,"./sw.js":192,"./ta":193,"./ta.js":193,"./te":194,"./te.js":194,"./tet":195,"./tet.js":195,"./tg":196,"./tg.js":196,"./th":197,"./th.js":197,"./tk":198,"./tk.js":198,"./tl-ph":199,"./tl-ph.js":199,"./tlh":200,"./tlh.js":200,"./tr":201,"./tr.js":201,"./tzl":202,"./tzl.js":202,"./tzm":203,"./tzm-latn":204,"./tzm-latn.js":204,"./tzm.js":203,"./ug-cn":205,"./ug-cn.js":205,"./uk":206,"./uk.js":206,"./ur":207,"./ur.js":207,"./uz":208,"./uz-latn":209,"./uz-latn.js":209,"./uz.js":208,"./vi":210,"./vi.js":210,"./x-pseudo":211,"./x-pseudo.js":211,"./yo":212,"./yo.js":212,"./zh-cn":213,"./zh-cn.js":213,"./zh-hk":214,"./zh-hk.js":214,"./zh-mo":215,"./zh-mo.js":215,"./zh-tw":216,"./zh-tw.js":216};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=271},function(module,exports){angular.module("rainbow").factory("CompanyRequest",[function(){function CompanyRequest(id,requestingUserId,requestingUserLoginEmail,requestedCompanyId,requestedCompanyName,status,requestingDate,requestedNotificationLanguage,lastNotificationDate,requestedToCompanyAdmin,requestedCompanyInvitationId){this.id=id,this.requestingUserId=requestingUserId,this.requestingUserLoginEmail=requestingUserLoginEmail,this.requestedCompanyId=requestedCompanyId,this.requestedCompanyName=requestedCompanyName,this.status=status,this.requestingDate=requestingDate,this.requestedNotificationLanguage=requestedNotificationLanguage,this.lastNotificationDate=lastNotificationDate,this.requestedToCompanyAdmin=requestedToCompanyAdmin,this.requestedCompanyInvitationId=requestedCompanyInvitationId}return CompanyRequest.createFromData=function(data){return new CompanyRequest(data.id,data.requestingUserId,data.requestingUserLoginEmail,data.requestedCompanyId,data.requestedCompanyName,data.status,data.requestingDate,data.requestedNotificationLanguage,data.lastNotificationDate,data.requestedToCompanyAdmin,data.requestedCompanyInvitationId)},CompanyRequest}])},function(module,exports){angular.module("rainbow").factory("CompanyBpLinkInvitation",[function(){function CompanyBpLinkInvitation(id,invitedCompanyId,invitedCompanyName,invitedToBeBpIr,invitingAdminId,invitingAdminLoginEmail,invitingCompanyId,invitingCompanyName,invitationDate,lastNotificationDate,requestedNotificationLanguage,status,acceptationDate,cancelationDate,declinationDate){this.id=id,this.invitedCompanyId=invitedCompanyId,this.invitedCompanyName=invitedCompanyName,this.invitedToBeBpIr=invitedToBeBpIr,this.invitingAdminId=invitingAdminId,this.invitingAdminLoginEmail=invitingAdminLoginEmail,this.invitingCompanyId=invitingCompanyId,this.invitingCompanyName=invitingCompanyName,this.invitationDate=invitationDate,this.lastNotificationDate=lastNotificationDate,this.requestedNotificationLanguage=requestedNotificationLanguage,this.status=status,this.acceptationDate=acceptationDate,this.cancelationDate=cancelationDate,this.declinationDate=declinationDate}return CompanyBpLinkInvitation.createFromData=function(data){return new CompanyBpLinkInvitation(data.id,data.invitedCompanyId,data.invitedCompanyName,data.invitedToBeBpIr,data.invitingAdminId,data.invitingAdminLoginEmail,data.invitingCompanyId,data.invitingCompanyName,data.invitationDate,data.lastNotificationDate,data.requestedNotificationLanguage,data.status,data.acceptationDate,data.cancelationDate,data.declinationDate)},CompanyBpLinkInvitation}])},function(module,exports){angular.module("rainbow").factory("CompanyBpLinkRequest",[function(){function CompanyBpLinkRequest(id,requestingAdminId,requestingAdminLoginEmail,requestingCompanyId,requestingCompanyName,requestedCompanyId,requestedCompanyName,requestedToBeBpIr,requestDate,lastNotificationDate,requestedNotificationLanguage,status,acceptationDate,cancelationDate,declinationDate){this.id=id,this.requestingAdminId=requestingAdminId,this.requestingAdminLoginEmail=requestingAdminLoginEmail,this.requestingCompanyId=requestingCompanyId,this.requestingCompanyName=requestingCompanyName,this.requestedCompanyId=requestedCompanyId,this.requestedCompanyName=requestedCompanyName,this.requestedToBeBpIr=requestedToBeBpIr,this.requestDate=requestDate,this.lastNotificationDate=lastNotificationDate,this.requestedNotificationLanguage=requestedNotificationLanguage,this.status=status,this.acceptationDate=acceptationDate,this.cancelationDate=cancelationDate,this.declinationDate=declinationDate}return CompanyBpLinkRequest.createFromData=function(data){return new CompanyBpLinkRequest(data.id,data.requestingAdminId,data.requestingAdminLoginEmail,data.requestingCompanyId,data.requestingCompanyName,data.requestedCompanyId,data.requestedCompanyName,data.requestedToBeBpIr,data.requestDate,data.lastNotificationDate,data.requestedNotificationLanguage,data.status,data.acceptationDate,data.cancelationDate,data.declinationDate)},CompanyBpLinkRequest}])},function(module,exports){angular.module("rainbow").factory("Conference",[function(){function Conference(companyId,id,mediaType,name,passCodes,scheduled,lastUpdateDate,userId,confDialOutDisabled,playEntryTone,muteUponEntry){this.companyId=companyId,this.id=id,this.mediaType=mediaType,this.name=name,this.passCodes=passCodes||[],this.scheduled=scheduled,this.lastUpdateDate=lastUpdateDate,this.userId=userId,this.confDialOutDisabled=confDialOutDisabled,this.playEntryTone=playEntryTone,this.muteUponEntry=muteUponEntry,this.updateFromData=function(data){this.companyId=data.companyId,this.id=data.id,this.mediaType=data.mediaType,this.name=data.name,this.passCodes=data.passCodes,this.scheduled=data.scheduled,this.lastUpdateDate=data.lastUpdateDate,this.userId=data.userId,this.confDialOutDisabled=data.confDialOutDisabled,this.playEntryTone=data.playEntryTone,this.muteUponEntry=data.muteUponEntry}}return Conference.createFromData=function(data){return new Conference(data.companyId,data.id,data.mediaType,data.name,data.passCodes,data.scheduled,data.lastUpdateDate,data.userId,data.confDialOutDisabled,data.playEntryTone,data.muteUponEntry)},Conference}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0__),rxjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(77);angular.module("rainbow").factory("ConferenceSession",["$log","ConferenceParticipant","$q","$interval",function($log,ConferenceParticipant,$q,$interval){function ConferenceSession(_id,_participants,_active,_type){var that=this;that.id=_id,that.participants=_participants,that.active=_active,that.talkerActive=void 0,that.recordingStarted=void 0,that.talkers=void 0,that.talkerSubject=new rxjs__WEBPACK_IMPORTED_MODULE_1__.a(this.talkers),that.isLeaderAlreadyConnected=!1,that.status=null,that.localStreams=[],that.sessions={},that.publishers=[],that.type=_type,that.callId=null,that.hasLocalVideo=!1,that.jingleJid=null,that.localVideoSessionId=null,that.localSharingSessionId=null,that.haveJoined=!1,that.lock=!1,that.duration=0,that.durationTimer=null,that.conferenceStats=null,that.control={activeControl:!1,hasRemoteControlling:!1,controller:null,controlled:null},that.conferenceView=ConferenceSession.ConferenceView.GalleryView,that.networkQuality=0,that.isMyConference=!1,that.cleanupSessionData=function(){$log.debug("[ConferenceSession] Cleanup for conferenceSession "+that.id),that.participants=[],that.talkerActive=void 0,that.recordingStarted=void 0,that.talkers=void 0,that.isLeaderAlreadyConnected=!1,that.localStreams=[],that.sessions={},that.publishers=[],that.hasLocalVideo=!1,that.metricsState="",that.recordingStarted=!1,that.status="ended",that.hasLocalSharing=!1,that.reversedVideos=!1,that.jingleJid=null,that.localVideoSessionId=null,that.localSharingSessionId=null,that.haveJoined=!1,that.lock=!1,that.duration=0,that.conferenceStats=null,that.durationTimer&&($interval.cancel(that.durationTimer),that.durationTimer=null),that.conferenceView=ConferenceSession.ConferenceView.GalleryView,that.joinedFromOtherDevice=!1},that.updateFromData=function(id,participants,active){that.id=id,that.participants=participants,that.active=active},that.updateActiveState=function(active){that.active=active},that.updateStateFromData=function(active,talkerActive,recordingStarted,lock){that.active=active,that.talkerActive=talkerActive,that.recordingStarted=recordingStarted,that.lock=lock},that.updateParticipants=function(participantsData){return $q((function(resolve){var result=!1;participantsData||resolve(!1),that.participants||(that.participants=[]),0===participantsData.length&&(that.participants=[]),participantsData.forEach((function(participantData){if(participantData.participantId){$log.debug("[conferenceSession] updateParticipants participantId="+participantData.participantId);var existingParticipant=that.getParticipantById(participantData.participantId)?that.getParticipantById(participantData.participantId):participantData.jid_im?that.getParticipantByJid(participantData.jid_im):null;if(existingParticipant)$log.debug("[conferenceSession] updateParticipants update participantId="+participantData.participantId),existingParticipant.updateFromData(participantData);else{$log.debug("[conferenceSession] updateParticipants create participantId="+participantData.participantId);var newParticipant=ConferenceParticipant.createFromData(participantData);that.participants.push(newParticipant),result=newParticipant}}})),resolve(result)}))},that.removeParticipants=function(removedParticipants){removedParticipants&&removedParticipants.forEach((function(removedParticipantId){var removedParticipantIndex=that.getParticipantIndexById(removedParticipantId);-1!==removedParticipantIndex&&($log.debug("[conferenceSession] removeParticipants remove participantId="+removedParticipantId),that.participants.splice(removedParticipantIndex,1))}))},that.removePublisher=function(removedPublisherId){if(removedPublisherId){var removedPublisherIndex=that.getPublisherIndexById(removedPublisherId);-1!==removedPublisherIndex&&($log.debug("[conferenceSession] removePublisher remove participantId="+removedPublisherId),that.publishers.splice(removedPublisherIndex,1))}},that.updateTalkers=function(talkers){$log.debug("[conferenceSession] updateTalkers talkers="+talkers),that.talkers=talkers,that.talkerSubject.next(that.talkers)},that.isActive=function(){return void 0!==that.active&&that.active},that.isTalkerActive=function(){return void 0!==that.talkerActive&&that.talkerActive},that.isRecordingStarted=function(){return void 0!==that.recordingStarted&&that.recordingStarted},that.getParticipants=function(){return that.participants},that.getConnectedParticipants=function(){return that.participants?that.participants.filter((function(participant){return"disconnected"!==participant.state&&"watching"!==participant.state})):void 0},that.getWatchingParticipants=function(){return that.participants?that.participants.filter((function(participant){return"watching"===participant.state})):void 0},that.getConnectedParticipantsExceptLeader=function(){return that.participants?that.participants.filter((function(participant){return"disconnected"!==participant.state&&"watching"!==participant.state&&"moderator"!==participant.role})):void 0},that.getConnectedLeaderParticipantsExcept=function(jid){return that.participants?that.participants.filter((function(participant){return"disconnected"!==participant.state&&"moderator"===participant.role&&participant.jid_im!==jid})):void 0},that.getConnectedParticipantsExcept=function(jid){return that.participants?that.participants.filter((function(participant){return participant.jid_im!==jid&&"disconnected"!==participant.state&&"watching"!==participant.state})):void 0},that.getLeaderParticipant=function(){return that.participants?that.participants.find((function(participant){return"moderator"===participant.role&&"disconnected"!==participant.state&&"watching"!==participant.state})):void 0},that.getLeaderParticipantById=function(jid){return that.participants?that.participants.find((function(participant){return"moderator"===participant.role&&"disconnected"!==participant.state&&"watching"!==participant.state&&participant.jid_im===jid})):void 0},that.getParticipantById=function(participantId){return that.participants?that.participants.find((function(participant){return participant.participantId===participantId})):void 0},that.getParticipantByJid=function(jid){return that.participants?that.participants.find((function(participant){return participant.jid_im===jid})):void 0},that.getNonDisconnectedParticipantByJid=function(jid){return that.participants?that.participants.find((function(participant){return participant.jid_im===jid&&"disconnected"!==participant.state})):void 0},that.getConnectedParticipantByJid=function(jid){return that.participants?that.participants.find((function(participant){return participant.jid_im===jid&&"connected"===participant.state})):void 0},that.getWatchingParticipantByJid=function(jid){return that.participants?that.participants.find((function(participant){return participant.jid_im===jid&&"watching"===participant.state})):void 0},that.getParticipantIndexById=function(participantId){return that.participants?that.participants.findIndex((function(participant){return participant.participantId===participantId})):-1},that.getPublisherIndexById=function(publisherId){return that.publishers?that.publishers.findIndex((function(publisher){return publisher.participantId===publisherId})):-1},that.getPublisherById=function(publisherId){return that.publishers?that.publishers.find((function(publisher){return publisher.participantId===publisherId})):void 0},that.isParticipantConnectedByJid=function(jid){return void 0!==that.participants&&that.participants.some((function(participant){return participant.jid_im===jid&&"connected"===participant.state}))},that.isParticipantWatchingByJid=function(jid){return void 0!==that.participants&&that.participants.some((function(participant){return participant.jid_im===jid&&"watching"===participant.state}))},that.isParticipantRingingByJid=function(jid){return void 0!==that.participants&&that.participants.some((function(participant){return participant.jid_im===jid&&"ringing"===participant.state}))},that.isParticipantConnectedWithThisUAByJid=function(jid){return that.haveJoined&&void 0!==that.participants&&that.participants.some((function(participant){return participant.jid_im===jid&&"connected"===participant.state}))},that.checkIfParticipantHasVideoByPublisherId=function(publisherId){var result=!1;if(that.publishers)for(var i=0;i<that.publishers.length;i++)if("video"===that.publishers[i].mediaType&&that.publishers[i].participantId===publisherId){result=!0;break}return result},that.getCurrentSharingParticipant=function(){var participantId=null;if(that.publishers)for(var i=0;i<that.publishers.length;i++)if("sharing"===that.publishers[i].mediaType){participantId=that.publishers[i].participantId;break}return participantId&&that.participants?that.participants.find((function(participant){return participant.participantId===participantId})):void 0},that.getDelegateParticipantsListExcept=function(jid){var result=[],participants=this.getConnectedParticipantsExcept(jid);if(participants)for(var i=0;i<participants.length;i++)participants[i].delegateCapability&&result.push(participants[i]);return result},that.getTalkers=function(){return that.talkers},that.setCallId=function(callId){that.callId=callId},that.getListOfRemoteVideoPublishers=function(){var result=[];if(that.publishers)for(var i=0;i<that.publishers.length;i++)"video"===that.publishers[i].mediaType&&that.publishers[i].jid_im!==_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0___default.a.userContact.jid&&result.push(that.publishers[i]);return result},that.startDuration=function(){that.durationTimer||(that.durationTimer=$interval((function(){that.duration++}),1e3))},that.stopDuration=function(){that.durationTimer&&($interval.cancel(that.durationTimer),that.durationTimer=null,that.duration=0)},that.isInConferenceWithDesktopApp=function(){var remoteSharing=that.getCurrentSharingParticipant();return!(!remoteSharing||!remoteSharing.contact)&&-1!==remoteSharing.contact.fullJid.indexOf("desk_")}}return ConferenceSession.createFromData=function(id,participants,active,type){return type||(type="pstnAudio"),new ConferenceSession(id,participants,active,type)},ConferenceSession.ConferenceView={GalleryView:"gallery_view",SpeakerView:"speaker_view",GridView:"grid_view"},ConferenceSession}])},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),function(){if("function"==typeof ArrayBuffer){var WordArray=CryptoJS.lib.WordArray,superInit=WordArray.init;(WordArray.init=function(typedArray){if(typedArray instanceof ArrayBuffer&&(typedArray=new Uint8Array(typedArray)),(typedArray instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&typedArray instanceof Uint8ClampedArray||typedArray instanceof Int16Array||typedArray instanceof Uint16Array||typedArray instanceof Int32Array||typedArray instanceof Uint32Array||typedArray instanceof Float32Array||typedArray instanceof Float64Array)&&(typedArray=new Uint8Array(typedArray.buffer,typedArray.byteOffset,typedArray.byteLength)),typedArray instanceof Uint8Array){for(var typedArrayByteLength=typedArray.byteLength,words=[],i=0;i<typedArrayByteLength;i++)words[i>>>2]|=typedArray[i]<<24-i%4*8;superInit.call(this,words,typedArrayByteLength)}else superInit.apply(this,arguments)}).prototype=WordArray}}(),CryptoJS.lib.WordArray)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),function(){var C=CryptoJS,WordArray=C.lib.WordArray,C_enc=C.enc;function swapEndian(word){return word<<8&4278255360|word>>>8&16711935}C_enc.Utf16=C_enc.Utf16BE={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,utf16Chars=[],i=0;i<sigBytes;i+=2){var codePoint=words[i>>>2]>>>16-i%4*8&65535;utf16Chars.push(String.fromCharCode(codePoint))}return utf16Chars.join("")},parse:function(utf16Str){for(var utf16StrLength=utf16Str.length,words=[],i=0;i<utf16StrLength;i++)words[i>>>1]|=utf16Str.charCodeAt(i)<<16-i%2*16;return WordArray.create(words,2*utf16StrLength)}},C_enc.Utf16LE={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,utf16Chars=[],i=0;i<sigBytes;i+=2){var codePoint=swapEndian(words[i>>>2]>>>16-i%4*8&65535);utf16Chars.push(String.fromCharCode(codePoint))}return utf16Chars.join("")},parse:function(utf16Str){for(var utf16StrLength=utf16Str.length,words=[],i=0;i<utf16StrLength;i++)words[i>>>1]|=swapEndian(utf16Str.charCodeAt(i)<<16-i%2*16);return WordArray.create(words,2*utf16StrLength)}}}(),CryptoJS.enc.Utf16)},function(module,exports,__webpack_require__){var C,WordArray,C_algo,SHA256,SHA224,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(217),WordArray=(C=CryptoJS).lib.WordArray,C_algo=C.algo,SHA256=C_algo.SHA256,SHA224=C_algo.SHA224=SHA256.extend({_doReset:function(){this._hash=new WordArray.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var hash=SHA256._doFinalize.call(this);return hash.sigBytes-=4,hash}}),C.SHA224=SHA256._createHelper(SHA224),C.HmacSHA224=SHA256._createHmacHelper(SHA224),CryptoJS.SHA224)},function(module,exports,__webpack_require__){var C,C_x64,X64Word,X64WordArray,C_algo,SHA512,SHA384,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(61),__webpack_require__(218),C_x64=(C=CryptoJS).x64,X64Word=C_x64.Word,X64WordArray=C_x64.WordArray,C_algo=C.algo,SHA512=C_algo.SHA512,SHA384=C_algo.SHA384=SHA512.extend({_doReset:function(){this._hash=new X64WordArray.init([new X64Word.init(3418070365,3238371032),new X64Word.init(1654270250,914150663),new X64Word.init(2438529370,812702999),new X64Word.init(355462360,4144912697),new X64Word.init(1731405415,4290775857),new X64Word.init(2394180231,1750603025),new X64Word.init(3675008525,1694076839),new X64Word.init(1203062813,3204075428)])},_doFinalize:function(){var hash=SHA512._doFinalize.call(this);return hash.sigBytes-=16,hash}}),C.SHA384=SHA512._createHelper(SHA384),C.HmacSHA384=SHA512._createHmacHelper(SHA384),CryptoJS.SHA384)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(61),function(Math){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,X64Word=C.x64.Word,C_algo=C.algo,RHO_OFFSETS=[],PI_INDEXES=[],ROUND_CONSTANTS=[];!function(){for(var x=1,y=0,t=0;t<24;t++){RHO_OFFSETS[x+5*y]=(t+1)*(t+2)/2%64;var newY=(2*x+3*y)%5;x=y%5,y=newY}for(x=0;x<5;x++)for(y=0;y<5;y++)PI_INDEXES[x+5*y]=y+(2*x+3*y)%5*5;for(var LFSR=1,i=0;i<24;i++){for(var roundConstantMsw=0,roundConstantLsw=0,j=0;j<7;j++){if(1&LFSR){var bitPosition=(1<<j)-1;bitPosition<32?roundConstantLsw^=1<<bitPosition:roundConstantMsw^=1<<bitPosition-32}128&LFSR?LFSR=LFSR<<1^113:LFSR<<=1}ROUND_CONSTANTS[i]=X64Word.create(roundConstantMsw,roundConstantLsw)}}();var T=[];!function(){for(var i=0;i<25;i++)T[i]=X64Word.create()}();var SHA3=C_algo.SHA3=Hasher.extend({cfg:Hasher.cfg.extend({outputLength:512}),_doReset:function(){for(var state=this._state=[],i=0;i<25;i++)state[i]=new X64Word.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(M,offset){for(var state=this._state,nBlockSizeLanes=this.blockSize/2,i=0;i<nBlockSizeLanes;i++){var M2i=M[offset+2*i],M2i1=M[offset+2*i+1];M2i=16711935&(M2i<<8|M2i>>>24)|4278255360&(M2i<<24|M2i>>>8),M2i1=16711935&(M2i1<<8|M2i1>>>24)|4278255360&(M2i1<<24|M2i1>>>8),(lane=state[i]).high^=M2i1,lane.low^=M2i}for(var round=0;round<24;round++){for(var x=0;x<5;x++){for(var tMsw=0,tLsw=0,y=0;y<5;y++)tMsw^=(lane=state[x+5*y]).high,tLsw^=lane.low;var Tx=T[x];Tx.high=tMsw,Tx.low=tLsw}for(x=0;x<5;x++){var Tx4=T[(x+4)%5],Tx1=T[(x+1)%5],Tx1Msw=Tx1.high,Tx1Lsw=Tx1.low;for(tMsw=Tx4.high^(Tx1Msw<<1|Tx1Lsw>>>31),tLsw=Tx4.low^(Tx1Lsw<<1|Tx1Msw>>>31),y=0;y<5;y++)(lane=state[x+5*y]).high^=tMsw,lane.low^=tLsw}for(var laneIndex=1;laneIndex<25;laneIndex++){var laneMsw=(lane=state[laneIndex]).high,laneLsw=lane.low,rhoOffset=RHO_OFFSETS[laneIndex];rhoOffset<32?(tMsw=laneMsw<<rhoOffset|laneLsw>>>32-rhoOffset,tLsw=laneLsw<<rhoOffset|laneMsw>>>32-rhoOffset):(tMsw=laneLsw<<rhoOffset-32|laneMsw>>>64-rhoOffset,tLsw=laneMsw<<rhoOffset-32|laneLsw>>>64-rhoOffset);var TPiLane=T[PI_INDEXES[laneIndex]];TPiLane.high=tMsw,TPiLane.low=tLsw}var T0=T[0],state0=state[0];for(T0.high=state0.high,T0.low=state0.low,x=0;x<5;x++)for(y=0;y<5;y++){var lane=state[laneIndex=x+5*y],TLane=T[laneIndex],Tx1Lane=T[(x+1)%5+5*y],Tx2Lane=T[(x+2)%5+5*y];lane.high=TLane.high^~Tx1Lane.high&Tx2Lane.high,lane.low=TLane.low^~Tx1Lane.low&Tx2Lane.low}lane=state[0];var roundConstant=ROUND_CONSTANTS[round];lane.high^=roundConstant.high,lane.low^=roundConstant.low}},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsLeft=(this._nDataBytes,8*data.sigBytes),blockSizeBits=32*this.blockSize;dataWords[nBitsLeft>>>5]|=1<<24-nBitsLeft%32,dataWords[(Math.ceil((nBitsLeft+1)/blockSizeBits)*blockSizeBits>>>5)-1]|=128,data.sigBytes=4*dataWords.length,this._process();for(var state=this._state,outputLengthBytes=this.cfg.outputLength/8,outputLengthLanes=outputLengthBytes/8,hashWords=[],i=0;i<outputLengthLanes;i++){var lane=state[i],laneMsw=lane.high,laneLsw=lane.low;laneMsw=16711935&(laneMsw<<8|laneMsw>>>24)|4278255360&(laneMsw<<24|laneMsw>>>8),laneLsw=16711935&(laneLsw<<8|laneLsw>>>24)|4278255360&(laneLsw<<24|laneLsw>>>8),hashWords.push(laneLsw),hashWords.push(laneMsw)}return new WordArray.init(hashWords,outputLengthBytes)},clone:function(){for(var clone=Hasher.clone.call(this),state=clone._state=this._state.slice(0),i=0;i<25;i++)state[i]=state[i].clone();return clone}});C.SHA3=Hasher._createHelper(SHA3),C.HmacSHA3=Hasher._createHmacHelper(SHA3)}(Math),CryptoJS.SHA3)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),function(Math){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,_zl=WordArray.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),_zr=WordArray.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),_sl=WordArray.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),_sr=WordArray.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),_hl=WordArray.create([0,1518500249,1859775393,2400959708,2840853838]),_hr=WordArray.create([1352829926,1548603684,1836072691,2053994217,0]),RIPEMD160=C_algo.RIPEMD160=Hasher.extend({_doReset:function(){this._hash=WordArray.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,offset){for(var i=0;i<16;i++){var offset_i=offset+i,M_offset_i=M[offset_i];M[offset_i]=16711935&(M_offset_i<<8|M_offset_i>>>24)|4278255360&(M_offset_i<<24|M_offset_i>>>8)}var al,bl,cl,dl,el,ar,br,cr,dr,er,t,H=this._hash.words,hl=_hl.words,hr=_hr.words,zl=_zl.words,zr=_zr.words,sl=_sl.words,sr=_sr.words;for(ar=al=H[0],br=bl=H[1],cr=cl=H[2],dr=dl=H[3],er=el=H[4],i=0;i<80;i+=1)t=al+M[offset+zl[i]]|0,t+=i<16?f1(bl,cl,dl)+hl[0]:i<32?f2(bl,cl,dl)+hl[1]:i<48?f3(bl,cl,dl)+hl[2]:i<64?f4(bl,cl,dl)+hl[3]:f5(bl,cl,dl)+hl[4],t=(t=rotl(t|=0,sl[i]))+el|0,al=el,el=dl,dl=rotl(cl,10),cl=bl,bl=t,t=ar+M[offset+zr[i]]|0,t+=i<16?f5(br,cr,dr)+hr[0]:i<32?f4(br,cr,dr)+hr[1]:i<48?f3(br,cr,dr)+hr[2]:i<64?f2(br,cr,dr)+hr[3]:f1(br,cr,dr)+hr[4],t=(t=rotl(t|=0,sr[i]))+er|0,ar=er,er=dr,dr=rotl(cr,10),cr=br,br=t;t=H[1]+cl+dr|0,H[1]=H[2]+dl+er|0,H[2]=H[3]+el+ar|0,H[3]=H[4]+al+br|0,H[4]=H[0]+bl+cr|0,H[0]=t},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[14+(nBitsLeft+64>>>9<<4)]=16711935&(nBitsTotal<<8|nBitsTotal>>>24)|4278255360&(nBitsTotal<<24|nBitsTotal>>>8),data.sigBytes=4*(dataWords.length+1),this._process();for(var hash=this._hash,H=hash.words,i=0;i<5;i++){var H_i=H[i];H[i]=16711935&(H_i<<8|H_i>>>24)|4278255360&(H_i<<24|H_i>>>8)}return hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});function f1(x,y,z){return x^y^z}function f2(x,y,z){return x&y|~x&z}function f3(x,y,z){return(x|~y)^z}function f4(x,y,z){return x&z|y&~z}function f5(x,y,z){return x^(y|~z)}function rotl(x,n){return x<<n|x>>>32-n}C.RIPEMD160=Hasher._createHelper(RIPEMD160),C.HmacRIPEMD160=Hasher._createHmacHelper(RIPEMD160)}(Math),CryptoJS.RIPEMD160)},function(module,exports,__webpack_require__){var C,C_lib,Base,WordArray,C_algo,SHA1,HMAC,PBKDF2,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(72),__webpack_require__(73),Base=(C_lib=(C=CryptoJS).lib).Base,WordArray=C_lib.WordArray,SHA1=(C_algo=C.algo).SHA1,HMAC=C_algo.HMAC,PBKDF2=C_algo.PBKDF2=Base.extend({cfg:Base.extend({keySize:4,hasher:SHA1,iterations:1}),init:function(cfg){this.cfg=this.cfg.extend(cfg)},compute:function(password,salt){for(var cfg=this.cfg,hmac=HMAC.create(cfg.hasher,password),derivedKey=WordArray.create(),blockIndex=WordArray.create([1]),derivedKeyWords=derivedKey.words,blockIndexWords=blockIndex.words,keySize=cfg.keySize,iterations=cfg.iterations;derivedKeyWords.length<keySize;){var block=hmac.update(salt).finalize(blockIndex);hmac.reset();for(var blockWords=block.words,blockWordsLength=blockWords.length,intermediate=block,i=1;i<iterations;i++){intermediate=hmac.finalize(intermediate),hmac.reset();for(var intermediateWords=intermediate.words,j=0;j<blockWordsLength;j++)blockWords[j]^=intermediateWords[j]}derivedKey.concat(block),blockIndexWords[0]++}return derivedKey.sigBytes=4*keySize,derivedKey}}),C.PBKDF2=function(password,salt,cfg){return PBKDF2.create(cfg).compute(password,salt)},CryptoJS.PBKDF2)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.mode.CFB=function(){var CFB=CryptoJS.lib.BlockCipherMode.extend();function generateKeystreamAndEncrypt(words,offset,blockSize,cipher){var iv=this._iv;if(iv){var keystream=iv.slice(0);this._iv=void 0}else keystream=this._prevBlock;cipher.encryptBlock(keystream,0);for(var i=0;i<blockSize;i++)words[offset+i]^=keystream[i]}return CFB.Encryptor=CFB.extend({processBlock:function(words,offset){var cipher=this._cipher,blockSize=cipher.blockSize;generateKeystreamAndEncrypt.call(this,words,offset,blockSize,cipher),this._prevBlock=words.slice(offset,offset+blockSize)}}),CFB.Decryptor=CFB.extend({processBlock:function(words,offset){var cipher=this._cipher,blockSize=cipher.blockSize,thisBlock=words.slice(offset,offset+blockSize);generateKeystreamAndEncrypt.call(this,words,offset,blockSize,cipher),this._prevBlock=thisBlock}}),CFB}(),CryptoJS.mode.CFB)},function(module,exports,__webpack_require__){var CTR,Encryptor,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.mode.CTR=(Encryptor=(CTR=CryptoJS.lib.BlockCipherMode.extend()).Encryptor=CTR.extend({processBlock:function(words,offset){var cipher=this._cipher,blockSize=cipher.blockSize,iv=this._iv,counter=this._counter;iv&&(counter=this._counter=iv.slice(0),this._iv=void 0);var keystream=counter.slice(0);cipher.encryptBlock(keystream,0),counter[blockSize-1]=counter[blockSize-1]+1|0;for(var i=0;i<blockSize;i++)words[offset+i]^=keystream[i]}}),CTR.Decryptor=Encryptor,CTR),CryptoJS.mode.CTR)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.mode.CTRGladman=function(){var CTRGladman=CryptoJS.lib.BlockCipherMode.extend();function incWord(word){if(255==(word>>24&255)){var b1=word>>16&255,b2=word>>8&255,b3=255&word;255===b1?(b1=0,255===b2?(b2=0,255===b3?b3=0:++b3):++b2):++b1,word=0,word+=b1<<16,word+=b2<<8,word+=b3}else word+=1<<24;return word}var Encryptor=CTRGladman.Encryptor=CTRGladman.extend({processBlock:function(words,offset){var cipher=this._cipher,blockSize=cipher.blockSize,iv=this._iv,counter=this._counter;iv&&(counter=this._counter=iv.slice(0),this._iv=void 0),function(counter){0===(counter[0]=incWord(counter[0]))&&(counter[1]=incWord(counter[1]))}(counter);var keystream=counter.slice(0);cipher.encryptBlock(keystream,0);for(var i=0;i<blockSize;i++)words[offset+i]^=keystream[i]}});return CTRGladman.Decryptor=Encryptor,CTRGladman}(),CryptoJS.mode.CTRGladman)},function(module,exports,__webpack_require__){var OFB,Encryptor,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.mode.OFB=(Encryptor=(OFB=CryptoJS.lib.BlockCipherMode.extend()).Encryptor=OFB.extend({processBlock:function(words,offset){var cipher=this._cipher,blockSize=cipher.blockSize,iv=this._iv,keystream=this._keystream;iv&&(keystream=this._keystream=iv.slice(0),this._iv=void 0),cipher.encryptBlock(keystream,0);for(var i=0;i<blockSize;i++)words[offset+i]^=keystream[i]}}),OFB.Decryptor=Encryptor,OFB),CryptoJS.mode.OFB)},function(module,exports,__webpack_require__){var ECB,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.mode.ECB=((ECB=CryptoJS.lib.BlockCipherMode.extend()).Encryptor=ECB.extend({processBlock:function(words,offset){this._cipher.encryptBlock(words,offset)}}),ECB.Decryptor=ECB.extend({processBlock:function(words,offset){this._cipher.decryptBlock(words,offset)}}),ECB),CryptoJS.mode.ECB)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.pad.AnsiX923={pad:function(data,blockSize){var dataSigBytes=data.sigBytes,blockSizeBytes=4*blockSize,nPaddingBytes=blockSizeBytes-dataSigBytes%blockSizeBytes,lastBytePos=dataSigBytes+nPaddingBytes-1;data.clamp(),data.words[lastBytePos>>>2]|=nPaddingBytes<<24-lastBytePos%4*8,data.sigBytes+=nPaddingBytes},unpad:function(data){var nPaddingBytes=255&data.words[data.sigBytes-1>>>2];data.sigBytes-=nPaddingBytes}},CryptoJS.pad.Ansix923)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.pad.Iso10126={pad:function(data,blockSize){var blockSizeBytes=4*blockSize,nPaddingBytes=blockSizeBytes-data.sigBytes%blockSizeBytes;data.concat(CryptoJS.lib.WordArray.random(nPaddingBytes-1)).concat(CryptoJS.lib.WordArray.create([nPaddingBytes<<24],1))},unpad:function(data){var nPaddingBytes=255&data.words[data.sigBytes-1>>>2];data.sigBytes-=nPaddingBytes}},CryptoJS.pad.Iso10126)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.pad.Iso97971={pad:function(data,blockSize){data.concat(CryptoJS.lib.WordArray.create([2147483648],1)),CryptoJS.pad.ZeroPadding.pad(data,blockSize)},unpad:function(data){CryptoJS.pad.ZeroPadding.unpad(data),data.sigBytes--}},CryptoJS.pad.Iso97971)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.pad.ZeroPadding={pad:function(data,blockSize){var blockSizeBytes=4*blockSize;data.clamp(),data.sigBytes+=blockSizeBytes-(data.sigBytes%blockSizeBytes||blockSizeBytes)},unpad:function(data){for(var dataWords=data.words,i=data.sigBytes-1;!(dataWords[i>>>2]>>>24-i%4*8&255);)i--;data.sigBytes=i+1}},CryptoJS.pad.ZeroPadding)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CryptoJS.pad.NoPadding={pad:function(){},unpad:function(){}},CryptoJS.pad.NoPadding)},function(module,exports,__webpack_require__){var C,CipherParams,Hex,CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(20),CipherParams=(C=CryptoJS).lib.CipherParams,Hex=C.enc.Hex,C.format.Hex={stringify:function(cipherParams){return cipherParams.ciphertext.toString(Hex)},parse:function(input){var ciphertext=Hex.parse(input);return CipherParams.create({ciphertext:ciphertext})}},CryptoJS.format.Hex)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(46),__webpack_require__(47),__webpack_require__(40),__webpack_require__(20),function(){var C=CryptoJS,BlockCipher=C.lib.BlockCipher,C_algo=C.algo,SBOX=[],INV_SBOX=[],SUB_MIX_0=[],SUB_MIX_1=[],SUB_MIX_2=[],SUB_MIX_3=[],INV_SUB_MIX_0=[],INV_SUB_MIX_1=[],INV_SUB_MIX_2=[],INV_SUB_MIX_3=[];!function(){for(var d=[],i=0;i<256;i++)d[i]=i<128?i<<1:i<<1^283;var x=0,xi=0;for(i=0;i<256;i++){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,SBOX[x]=sx,INV_SBOX[sx]=x;var x2=d[x],x4=d[x2],x8=d[x4],t=257*d[sx]^16843008*sx;SUB_MIX_0[x]=t<<24|t>>>8,SUB_MIX_1[x]=t<<16|t>>>16,SUB_MIX_2[x]=t<<8|t>>>24,SUB_MIX_3[x]=t,t=16843009*x8^65537*x4^257*x2^16843008*x,INV_SUB_MIX_0[sx]=t<<24|t>>>8,INV_SUB_MIX_1[sx]=t<<16|t>>>16,INV_SUB_MIX_2[sx]=t<<8|t>>>24,INV_SUB_MIX_3[sx]=t,x?(x=x2^d[d[d[x8^x2]]],xi^=d[d[xi]]):x=xi=1}}();var RCON=[0,1,2,4,8,16,32,64,128,27,54],AES=C_algo.AES=BlockCipher.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var key=this._keyPriorReset=this._key,keyWords=key.words,keySize=key.sigBytes/4,ksRows=4*((this._nRounds=keySize+6)+1),keySchedule=this._keySchedule=[],ksRow=0;ksRow<ksRows;ksRow++)if(ksRow<keySize)keySchedule[ksRow]=keyWords[ksRow];else{var t=keySchedule[ksRow-1];ksRow%keySize?keySize>6&&ksRow%keySize==4&&(t=SBOX[t>>>24]<<24|SBOX[t>>>16&255]<<16|SBOX[t>>>8&255]<<8|SBOX[255&t]):(t=SBOX[(t=t<<8|t>>>24)>>>24]<<24|SBOX[t>>>16&255]<<16|SBOX[t>>>8&255]<<8|SBOX[255&t],t^=RCON[ksRow/keySize|0]<<24),keySchedule[ksRow]=keySchedule[ksRow-keySize]^t}for(var invKeySchedule=this._invKeySchedule=[],invKsRow=0;invKsRow<ksRows;invKsRow++)ksRow=ksRows-invKsRow,t=invKsRow%4?keySchedule[ksRow]:keySchedule[ksRow-4],invKeySchedule[invKsRow]=invKsRow<4||ksRow<=4?t:INV_SUB_MIX_0[SBOX[t>>>24]]^INV_SUB_MIX_1[SBOX[t>>>16&255]]^INV_SUB_MIX_2[SBOX[t>>>8&255]]^INV_SUB_MIX_3[SBOX[255&t]]}},encryptBlock:function(M,offset){this._doCryptBlock(M,offset,this._keySchedule,SUB_MIX_0,SUB_MIX_1,SUB_MIX_2,SUB_MIX_3,SBOX)},decryptBlock:function(M,offset){var t=M[offset+1];M[offset+1]=M[offset+3],M[offset+3]=t,this._doCryptBlock(M,offset,this._invKeySchedule,INV_SUB_MIX_0,INV_SUB_MIX_1,INV_SUB_MIX_2,INV_SUB_MIX_3,INV_SBOX),t=M[offset+1],M[offset+1]=M[offset+3],M[offset+3]=t},_doCryptBlock:function(M,offset,keySchedule,SUB_MIX_0,SUB_MIX_1,SUB_MIX_2,SUB_MIX_3,SBOX){for(var nRounds=this._nRounds,s0=M[offset]^keySchedule[0],s1=M[offset+1]^keySchedule[1],s2=M[offset+2]^keySchedule[2],s3=M[offset+3]^keySchedule[3],ksRow=4,round=1;round<nRounds;round++){var t0=SUB_MIX_0[s0>>>24]^SUB_MIX_1[s1>>>16&255]^SUB_MIX_2[s2>>>8&255]^SUB_MIX_3[255&s3]^keySchedule[ksRow++],t1=SUB_MIX_0[s1>>>24]^SUB_MIX_1[s2>>>16&255]^SUB_MIX_2[s3>>>8&255]^SUB_MIX_3[255&s0]^keySchedule[ksRow++],t2=SUB_MIX_0[s2>>>24]^SUB_MIX_1[s3>>>16&255]^SUB_MIX_2[s0>>>8&255]^SUB_MIX_3[255&s1]^keySchedule[ksRow++],t3=SUB_MIX_0[s3>>>24]^SUB_MIX_1[s0>>>16&255]^SUB_MIX_2[s1>>>8&255]^SUB_MIX_3[255&s2]^keySchedule[ksRow++];s0=t0,s1=t1,s2=t2,s3=t3}t0=(SBOX[s0>>>24]<<24|SBOX[s1>>>16&255]<<16|SBOX[s2>>>8&255]<<8|SBOX[255&s3])^keySchedule[ksRow++],t1=(SBOX[s1>>>24]<<24|SBOX[s2>>>16&255]<<16|SBOX[s3>>>8&255]<<8|SBOX[255&s0])^keySchedule[ksRow++],t2=(SBOX[s2>>>24]<<24|SBOX[s3>>>16&255]<<16|SBOX[s0>>>8&255]<<8|SBOX[255&s1])^keySchedule[ksRow++],t3=(SBOX[s3>>>24]<<24|SBOX[s0>>>16&255]<<16|SBOX[s1>>>8&255]<<8|SBOX[255&s2])^keySchedule[ksRow++],M[offset]=t0,M[offset+1]=t1,M[offset+2]=t2,M[offset+3]=t3},keySize:8});C.AES=BlockCipher._createHelper(AES)}(),CryptoJS.AES)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(46),__webpack_require__(47),__webpack_require__(40),__webpack_require__(20),function(){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,BlockCipher=C_lib.BlockCipher,C_algo=C.algo,PC1=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],PC2=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],BIT_SHIFTS=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],SBOX_P=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],SBOX_MASK=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],DES=C_algo.DES=BlockCipher.extend({_doReset:function(){for(var keyWords=this._key.words,keyBits=[],i=0;i<56;i++){var keyBitPos=PC1[i]-1;keyBits[i]=keyWords[keyBitPos>>>5]>>>31-keyBitPos%32&1}for(var subKeys=this._subKeys=[],nSubKey=0;nSubKey<16;nSubKey++){var subKey=subKeys[nSubKey]=[],bitShift=BIT_SHIFTS[nSubKey];for(i=0;i<24;i++)subKey[i/6|0]|=keyBits[(PC2[i]-1+bitShift)%28]<<31-i%6,subKey[4+(i/6|0)]|=keyBits[28+(PC2[i+24]-1+bitShift)%28]<<31-i%6;for(subKey[0]=subKey[0]<<1|subKey[0]>>>31,i=1;i<7;i++)subKey[i]=subKey[i]>>>4*(i-1)+3;subKey[7]=subKey[7]<<5|subKey[7]>>>27}var invSubKeys=this._invSubKeys=[];for(i=0;i<16;i++)invSubKeys[i]=subKeys[15-i]},encryptBlock:function(M,offset){this._doCryptBlock(M,offset,this._subKeys)},decryptBlock:function(M,offset){this._doCryptBlock(M,offset,this._invSubKeys)},_doCryptBlock:function(M,offset,subKeys){this._lBlock=M[offset],this._rBlock=M[offset+1],exchangeLR.call(this,4,252645135),exchangeLR.call(this,16,65535),exchangeRL.call(this,2,858993459),exchangeRL.call(this,8,16711935),exchangeLR.call(this,1,1431655765);for(var round=0;round<16;round++){for(var subKey=subKeys[round],lBlock=this._lBlock,rBlock=this._rBlock,f=0,i=0;i<8;i++)f|=SBOX_P[i][((rBlock^subKey[i])&SBOX_MASK[i])>>>0];this._lBlock=rBlock,this._rBlock=lBlock^f}var t=this._lBlock;this._lBlock=this._rBlock,this._rBlock=t,exchangeLR.call(this,1,1431655765),exchangeRL.call(this,8,16711935),exchangeRL.call(this,2,858993459),exchangeLR.call(this,16,65535),exchangeLR.call(this,4,252645135),M[offset]=this._lBlock,M[offset+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function exchangeLR(offset,mask){var t=(this._lBlock>>>offset^this._rBlock)&mask;this._rBlock^=t,this._lBlock^=t<<offset}function exchangeRL(offset,mask){var t=(this._rBlock>>>offset^this._lBlock)&mask;this._lBlock^=t,this._rBlock^=t<<offset}C.DES=BlockCipher._createHelper(DES);var TripleDES=C_algo.TripleDES=BlockCipher.extend({_doReset:function(){var keyWords=this._key.words;this._des1=DES.createEncryptor(WordArray.create(keyWords.slice(0,2))),this._des2=DES.createEncryptor(WordArray.create(keyWords.slice(2,4))),this._des3=DES.createEncryptor(WordArray.create(keyWords.slice(4,6)))},encryptBlock:function(M,offset){this._des1.encryptBlock(M,offset),this._des2.decryptBlock(M,offset),this._des3.encryptBlock(M,offset)},decryptBlock:function(M,offset){this._des3.decryptBlock(M,offset),this._des2.encryptBlock(M,offset),this._des1.decryptBlock(M,offset)},keySize:6,ivSize:2,blockSize:2});C.TripleDES=BlockCipher._createHelper(TripleDES)}(),CryptoJS.TripleDES)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(46),__webpack_require__(47),__webpack_require__(40),__webpack_require__(20),function(){var C=CryptoJS,StreamCipher=C.lib.StreamCipher,C_algo=C.algo,RC4=C_algo.RC4=StreamCipher.extend({_doReset:function(){for(var key=this._key,keyWords=key.words,keySigBytes=key.sigBytes,S=this._S=[],i=0;i<256;i++)S[i]=i;i=0;for(var j=0;i<256;i++){var keyByteIndex=i%keySigBytes,keyByte=keyWords[keyByteIndex>>>2]>>>24-keyByteIndex%4*8&255;j=(j+S[i]+keyByte)%256;var t=S[i];S[i]=S[j],S[j]=t}this._i=this._j=0},_doProcessBlock:function(M,offset){M[offset]^=generateKeystreamWord.call(this)},keySize:8,ivSize:0});function generateKeystreamWord(){for(var S=this._S,i=this._i,j=this._j,keystreamWord=0,n=0;n<4;n++){j=(j+S[i=(i+1)%256])%256;var t=S[i];S[i]=S[j],S[j]=t,keystreamWord|=S[(S[i]+S[j])%256]<<24-8*n}return this._i=i,this._j=j,keystreamWord}C.RC4=StreamCipher._createHelper(RC4);var RC4Drop=C_algo.RC4Drop=RC4.extend({cfg:RC4.cfg.extend({drop:192}),_doReset:function(){RC4._doReset.call(this);for(var i=this.cfg.drop;i>0;i--)generateKeystreamWord.call(this)}});C.RC4Drop=StreamCipher._createHelper(RC4Drop)}(),CryptoJS.RC4)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(46),__webpack_require__(47),__webpack_require__(40),__webpack_require__(20),function(){var C=CryptoJS,StreamCipher=C.lib.StreamCipher,C_algo=C.algo,S=[],C_=[],G=[],Rabbit=C_algo.Rabbit=StreamCipher.extend({_doReset:function(){for(var K=this._key.words,iv=this.cfg.iv,i=0;i<4;i++)K[i]=16711935&(K[i]<<8|K[i]>>>24)|4278255360&(K[i]<<24|K[i]>>>8);var X=this._X=[K[0],K[3]<<16|K[2]>>>16,K[1],K[0]<<16|K[3]>>>16,K[2],K[1]<<16|K[0]>>>16,K[3],K[2]<<16|K[1]>>>16],C=this._C=[K[2]<<16|K[2]>>>16,4294901760&K[0]|65535&K[1],K[3]<<16|K[3]>>>16,4294901760&K[1]|65535&K[2],K[0]<<16|K[0]>>>16,4294901760&K[2]|65535&K[3],K[1]<<16|K[1]>>>16,4294901760&K[3]|65535&K[0]];for(this._b=0,i=0;i<4;i++)nextState.call(this);for(i=0;i<8;i++)C[i]^=X[i+4&7];if(iv){var IV=iv.words,IV_0=IV[0],IV_1=IV[1],i0=16711935&(IV_0<<8|IV_0>>>24)|4278255360&(IV_0<<24|IV_0>>>8),i2=16711935&(IV_1<<8|IV_1>>>24)|4278255360&(IV_1<<24|IV_1>>>8),i1=i0>>>16|4294901760&i2,i3=i2<<16|65535&i0;for(C[0]^=i0,C[1]^=i1,C[2]^=i2,C[3]^=i3,C[4]^=i0,C[5]^=i1,C[6]^=i2,C[7]^=i3,i=0;i<4;i++)nextState.call(this)}},_doProcessBlock:function(M,offset){var X=this._X;nextState.call(this),S[0]=X[0]^X[5]>>>16^X[3]<<16,S[1]=X[2]^X[7]>>>16^X[5]<<16,S[2]=X[4]^X[1]>>>16^X[7]<<16,S[3]=X[6]^X[3]>>>16^X[1]<<16;for(var i=0;i<4;i++)S[i]=16711935&(S[i]<<8|S[i]>>>24)|4278255360&(S[i]<<24|S[i]>>>8),M[offset+i]^=S[i]},blockSize:4,ivSize:2});function nextState(){for(var X=this._X,C=this._C,i=0;i<8;i++)C_[i]=C[i];for(C[0]=C[0]+1295307597+this._b|0,C[1]=C[1]+3545052371+(C[0]>>>0<C_[0]>>>0?1:0)|0,C[2]=C[2]+886263092+(C[1]>>>0<C_[1]>>>0?1:0)|0,C[3]=C[3]+1295307597+(C[2]>>>0<C_[2]>>>0?1:0)|0,C[4]=C[4]+3545052371+(C[3]>>>0<C_[3]>>>0?1:0)|0,C[5]=C[5]+886263092+(C[4]>>>0<C_[4]>>>0?1:0)|0,C[6]=C[6]+1295307597+(C[5]>>>0<C_[5]>>>0?1:0)|0,C[7]=C[7]+3545052371+(C[6]>>>0<C_[6]>>>0?1:0)|0,this._b=C[7]>>>0<C_[7]>>>0?1:0,i=0;i<8;i++){var gx=X[i]+C[i],ga=65535&gx,gb=gx>>>16,gh=((ga*ga>>>17)+ga*gb>>>15)+gb*gb,gl=((4294901760&gx)*gx|0)+((65535&gx)*gx|0);G[i]=gh^gl}X[0]=G[0]+(G[7]<<16|G[7]>>>16)+(G[6]<<16|G[6]>>>16)|0,X[1]=G[1]+(G[0]<<8|G[0]>>>24)+G[7]|0,X[2]=G[2]+(G[1]<<16|G[1]>>>16)+(G[0]<<16|G[0]>>>16)|0,X[3]=G[3]+(G[2]<<8|G[2]>>>24)+G[1]|0,X[4]=G[4]+(G[3]<<16|G[3]>>>16)+(G[2]<<16|G[2]>>>16)|0,X[5]=G[5]+(G[4]<<8|G[4]>>>24)+G[3]|0,X[6]=G[6]+(G[5]<<16|G[5]>>>16)+(G[4]<<16|G[4]>>>16)|0,X[7]=G[7]+(G[6]<<8|G[6]>>>24)+G[5]|0}C.Rabbit=StreamCipher._createHelper(Rabbit)}(),CryptoJS.Rabbit)},function(module,exports,__webpack_require__){var CryptoJS;module.exports=(CryptoJS=__webpack_require__(12),__webpack_require__(46),__webpack_require__(47),__webpack_require__(40),__webpack_require__(20),function(){var C=CryptoJS,StreamCipher=C.lib.StreamCipher,C_algo=C.algo,S=[],C_=[],G=[],RabbitLegacy=C_algo.RabbitLegacy=StreamCipher.extend({_doReset:function(){var K=this._key.words,iv=this.cfg.iv,X=this._X=[K[0],K[3]<<16|K[2]>>>16,K[1],K[0]<<16|K[3]>>>16,K[2],K[1]<<16|K[0]>>>16,K[3],K[2]<<16|K[1]>>>16],C=this._C=[K[2]<<16|K[2]>>>16,4294901760&K[0]|65535&K[1],K[3]<<16|K[3]>>>16,4294901760&K[1]|65535&K[2],K[0]<<16|K[0]>>>16,4294901760&K[2]|65535&K[3],K[1]<<16|K[1]>>>16,4294901760&K[3]|65535&K[0]];this._b=0;for(var i=0;i<4;i++)nextState.call(this);for(i=0;i<8;i++)C[i]^=X[i+4&7];if(iv){var IV=iv.words,IV_0=IV[0],IV_1=IV[1],i0=16711935&(IV_0<<8|IV_0>>>24)|4278255360&(IV_0<<24|IV_0>>>8),i2=16711935&(IV_1<<8|IV_1>>>24)|4278255360&(IV_1<<24|IV_1>>>8),i1=i0>>>16|4294901760&i2,i3=i2<<16|65535&i0;for(C[0]^=i0,C[1]^=i1,C[2]^=i2,C[3]^=i3,C[4]^=i0,C[5]^=i1,C[6]^=i2,C[7]^=i3,i=0;i<4;i++)nextState.call(this)}},_doProcessBlock:function(M,offset){var X=this._X;nextState.call(this),S[0]=X[0]^X[5]>>>16^X[3]<<16,S[1]=X[2]^X[7]>>>16^X[5]<<16,S[2]=X[4]^X[1]>>>16^X[7]<<16,S[3]=X[6]^X[3]>>>16^X[1]<<16;for(var i=0;i<4;i++)S[i]=16711935&(S[i]<<8|S[i]>>>24)|4278255360&(S[i]<<24|S[i]>>>8),M[offset+i]^=S[i]},blockSize:4,ivSize:2});function nextState(){for(var X=this._X,C=this._C,i=0;i<8;i++)C_[i]=C[i];for(C[0]=C[0]+1295307597+this._b|0,C[1]=C[1]+3545052371+(C[0]>>>0<C_[0]>>>0?1:0)|0,C[2]=C[2]+886263092+(C[1]>>>0<C_[1]>>>0?1:0)|0,C[3]=C[3]+1295307597+(C[2]>>>0<C_[2]>>>0?1:0)|0,C[4]=C[4]+3545052371+(C[3]>>>0<C_[3]>>>0?1:0)|0,C[5]=C[5]+886263092+(C[4]>>>0<C_[4]>>>0?1:0)|0,C[6]=C[6]+1295307597+(C[5]>>>0<C_[5]>>>0?1:0)|0,C[7]=C[7]+3545052371+(C[6]>>>0<C_[6]>>>0?1:0)|0,this._b=C[7]>>>0<C_[7]>>>0?1:0,i=0;i<8;i++){var gx=X[i]+C[i],ga=65535&gx,gb=gx>>>16,gh=((ga*ga>>>17)+ga*gb>>>15)+gb*gb,gl=((4294901760&gx)*gx|0)+((65535&gx)*gx|0);G[i]=gh^gl}X[0]=G[0]+(G[7]<<16|G[7]>>>16)+(G[6]<<16|G[6]>>>16)|0,X[1]=G[1]+(G[0]<<8|G[0]>>>24)+G[7]|0,X[2]=G[2]+(G[1]<<16|G[1]>>>16)+(G[0]<<16|G[0]>>>16)|0,X[3]=G[3]+(G[2]<<8|G[2]>>>24)+G[1]|0,X[4]=G[4]+(G[3]<<16|G[3]>>>16)+(G[2]<<16|G[2]>>>16)|0,X[5]=G[5]+(G[4]<<8|G[4]>>>24)+G[3]|0,X[6]=G[6]+(G[5]<<16|G[5]>>>16)+(G[4]<<16|G[4]>>>16)|0,X[7]=G[7]+(G[6]<<8|G[6]>>>24)+G[5]|0}C.RabbitLegacy=StreamCipher._createHelper(RabbitLegacy)}(),CryptoJS.RabbitLegacy)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var AuthSettings=function(){function AuthSettings(authURLs){if(_classCallCheck(this,AuthSettings),this.type=null,this.loginUrl=null,this.logoutUrl=null,this.safetyUrl=null,this.userId=null,authURLs.length>0){var authSettings;authSettings=1===authURLs.length?authURLs[0]:authURLs.reduce((function(settings,authUrl){return"RAINBOW"===authUrl.type&&"RAINBOW"!==settings.type?(settings.safetyUrl=authUrl.url||authUrl.loginUrl,settings):(authUrl.safetyUrl=settings.url||settings.loginUrl,authUrl)})),this.type=authSettings.type,this.loginUrl=authSettings.url||authSettings.loginUrl,this.logoutUrl=authSettings.logoutUrl,this.safetyUrl=authSettings.safetyUrl}}return _createClass(AuthSettings,[{key:"setParameter",value:function(name,fn){switch(name){case"uid":this.userId=fn();break;case"x-rainbow-app-auth":if("RAINBOW"!==this.type&&this.loginUrl){var url=new URL(this.loginUrl),appAuth=fn(url.searchParams.get("challenge"));url.searchParams.append(name,appAuth),this.loginUrl=url.href}break;case"token":if("RAINBOW"!==this.type&&this.logoutUrl){var _url=new URL(this.logoutUrl),tkn=fn();_url.searchParams.append(name,tkn),this.logoutUrl=_url.href}break;case"safetyUrl":"RAINBOW"===this.type||this.safetyUrl||(this.safetyUrl=fn())}}}],[{key:"createFromData",value:function(data){return new AuthSettings(data)}}]),AuthSettings}();exports.AuthSettings=AuthSettings},function(module,exports,__webpack_require__){var base64_url_decode=__webpack_require__(302);function InvalidTokenError(message){this.message=message}InvalidTokenError.prototype=new Error,InvalidTokenError.prototype.name="InvalidTokenError",module.exports=function(token,options){if("string"!=typeof token)throw new InvalidTokenError("Invalid token specified");var pos=!0===(options=options||{}).header?0:1;try{return JSON.parse(base64_url_decode(token.split(".")[pos]))}catch(e){throw new InvalidTokenError("Invalid token specified: "+e.message)}},module.exports.InvalidTokenError=InvalidTokenError},function(module,exports,__webpack_require__){var atob=__webpack_require__(303);module.exports=function(str){var output=str.replace(/-/g,"+").replace(/_/g,"/");switch(output.length%4){case 0:break;case 2:output+="==";break;case 3:output+="=";break;default:throw"Illegal base64url string!"}try{return function(str){return decodeURIComponent(atob(str).replace(/(.)/g,(function(m,p){var code=p.charCodeAt(0).toString(16).toUpperCase();return code.length<2&&(code="0"+code),"%"+code})))}(output)}catch(err){return atob(output)}}},function(module,exports){function InvalidCharacterError(message){this.message=message}InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError",module.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(input){var str=String(input).replace(/=+$/,"");if(str.length%4==1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");for(var bs,buffer,bc=0,idx=0,output="";buffer=str.charAt(idx++);~buffer&&(bs=bc%4?64*bs+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0)buffer="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(buffer);return output}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(url,options){var timeout=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;return Promise.race([fetch(url,options),new Promise((function(_,reject){return setTimeout((function(){return reject(new Error("timeout"))}),timeout)}))])}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__,global,factory;global="undefined"!=typeof window?window:this,factory=function(window,noGlobal){var arr=[],getProto=Object.getPrototypeOf,_slice=arr.slice,flat=arr.flat?function(array){return arr.flat.call(array)}:function(array){return arr.concat.apply([],array)},push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,fnToString=hasOwn.toString,ObjectFunctionString=fnToString.call(Object),support={},isFunction=function(obj){return"function"==typeof obj&&"number"!=typeof obj.nodeType},isWindow=function(obj){return null!=obj&&obj===obj.window},document=window.document,preservedScriptAttributes={type:!0,src:!0,nonce:!0,noModule:!0};function DOMEval(code,node,doc){var i,val,script=(doc=doc||document).createElement("script");if(script.text=code,node)for(i in preservedScriptAttributes)(val=node[i]||node.getAttribute&&node.getAttribute(i))&&script.setAttribute(i,val);doc.head.appendChild(script).parentNode.removeChild(script)}function toType(obj){return null==obj?obj+"":"object"==typeof obj||"function"==typeof obj?class2type[toString.call(obj)]||"object":typeof obj}var jQuery=function jQuery(selector,context){return new jQuery.fn.init(selector,context)};function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=toType(obj);return!isFunction(obj)&&!isWindow(obj)&&("array"===type||0===length||"number"==typeof length&&length>0&&length-1 in obj)}jQuery.fn=jQuery.prototype={jquery:"3.5.1",constructor:jQuery,length:0,toArray:function(){return _slice.call(this)},get:function(num){return null==num?_slice.call(this):num<0?this[num+this.length]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,(function(elem,i){return callback.call(elem,i,elem)})))},slice:function(){return this.pushStack(_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(jQuery.grep(this,(function(_elem,i){return(i+1)%2})))},odd:function(){return this.pushStack(jQuery.grep(this,(function(_elem,i){return i%2})))},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[i]||{},i++),"object"==typeof target||isFunction(target)||(target={}),i===length&&(target=this,i--);i<length;i++)if(null!=(options=arguments[i]))for(name in options)copy=options[name],"__proto__"!==name&&target!==copy&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(src=target[name],clone=copyIsArray&&!Array.isArray(src)?[]:copyIsArray||jQuery.isPlainObject(src)?src:{},copyIsArray=!1,target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isPlainObject:function(obj){var proto,Ctor;return!(!obj||"[object Object]"!==toString.call(obj))&&(!(proto=getProto(obj))||"function"==typeof(Ctor=hasOwn.call(proto,"constructor")&&proto.constructor)&&fnToString.call(Ctor)===ObjectFunctionString)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},globalEval:function(code,options,doc){DOMEval(code,{nonce:options&&options.nonce},doc)},each:function(obj,callback){var length,i=0;if(isArrayLike(obj))for(length=obj.length;i<length&&!1!==callback.call(obj[i],i,obj[i]);i++);else for(i in obj)if(!1===callback.call(obj[i],i,obj[i]))break;return obj},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArrayLike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){return null==arr?-1:indexOf.call(arr,elem,i)},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;j<len;j++)first[i++]=second[j];return first.length=i,first},grep:function(elems,callback,invert){for(var matches=[],i=0,length=elems.length,callbackExpect=!invert;i<length;i++)!callback(elems[i],i)!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems))for(length=elems.length;i<length;i++)null!=(value=callback(elems[i],i,arg))&&ret.push(value);else for(i in elems)null!=(value=callback(elems[i],i,arg))&&ret.push(value);return flat(ret)},guid:1,support:support}),"function"==typeof Symbol&&(jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]),jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(_i,name){class2type["[object "+name+"]"]=name.toLowerCase()}));var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),nonnativeSelectorCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,pushNative=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;i<len;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",attributes="\\[[\\x20\\t\\r\\n\\f]*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),rcomma=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),rcombinators=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),rdescend=new RegExp(whitespace+"|>"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},rhtml=/HTML$/i,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,runescape=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),funescape=function(escape,nonHex){var high="0x"+escape.slice(1)-65536;return nonHex||(high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320))},rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,fcssescape=function(ch,asCodePoint){return asCodePoint?"\0"===ch?"\ufffd":ch.slice(0,-1)+"\\"+ch.charCodeAt(ch.length-1).toString(16)+" ":"\\"+ch},unloadHandler=function(){setDocument()},inDisabledFieldset=addCombinator((function(elem){return!0===elem.disabled&&"fieldset"===elem.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){pushNative.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;if(results=results||[],"string"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&(setDocument(context),context=context||document,documentIsHTML)){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m)))return results;if(elem.id===m)return results.push(elem),results}else if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&!nonnativeSelectorCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))&&(1!==nodeType||"object"!==context.nodeName.toLowerCase())){if(newSelector=selector,newContext=context,1===nodeType&&(rdescend.test(selector)||rcombinators.test(selector))){for((newContext=rsibling.test(selector)&&testContext(context.parentNode)||context)===context&&support.scope||((nid=context.getAttribute("id"))?nid=nid.replace(rcssescape,fcssescape):context.setAttribute("id",nid=expando)),i=(groups=tokenize(selector)).length;i--;)groups[i]=(nid?"#"+nid:":scope")+" "+toSelector(groups[i]);newSelector=groups.join(",")}try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){nonnativeSelectorCache(selector,!0)}finally{nid===expando&&context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var el=document.createElement("fieldset");try{return!!fn(el)}catch(e){return!1}finally{el.parentNode&&el.parentNode.removeChild(el),el=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=arr.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createDisabledPseudo(disabled){return function(elem){return"form"in elem?elem.parentNode&&!1===elem.disabled?"label"in elem?"label"in elem.parentNode?elem.parentNode.disabled===disabled:elem.disabled===disabled:elem.isDisabled===disabled||elem.isDisabled!==!disabled&&inDisabledFieldset(elem)===disabled:elem.disabled===disabled:"label"in elem&&elem.disabled===disabled}}function createPositionalPseudo(fn){return markFunction((function(argument){return argument=+argument,markFunction((function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))}))}))}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}for(i in support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var namespace=elem.namespaceURI,docElem=(elem.ownerDocument||elem).documentElement;return!rhtml.test(namespace||docElem&&docElem.nodeName||"HTML")},setDocument=Sizzle.setDocument=function(node){var hasCompare,subWindow,doc=node?node.ownerDocument||node:preferredDoc;return doc!=document&&9===doc.nodeType&&doc.documentElement?(docElem=(document=doc).documentElement,documentIsHTML=!isXML(document),preferredDoc!=document&&(subWindow=document.defaultView)&&subWindow.top!==subWindow&&(subWindow.addEventListener?subWindow.addEventListener("unload",unloadHandler,!1):subWindow.attachEvent&&subWindow.attachEvent("onunload",unloadHandler)),support.scope=assert((function(el){return docElem.appendChild(el).appendChild(document.createElement("div")),void 0!==el.querySelectorAll&&!el.querySelectorAll(":scope fieldset div").length})),support.attributes=assert((function(el){return el.className="i",!el.getAttribute("className")})),support.getElementsByTagName=assert((function(el){return el.appendChild(document.createComment("")),!el.getElementsByTagName("*").length})),support.getElementsByClassName=rnative.test(document.getElementsByClassName),support.getById=assert((function(el){return docElem.appendChild(el).id=expando,!document.getElementsByName||!document.getElementsByName(expando).length})),support.getById?(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var elem=context.getElementById(id);return elem?[elem]:[]}}):(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=void 0!==elem.getAttributeNode&&elem.getAttributeNode("id");return node&&node.value===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var node,i,elems,elem=context.getElementById(id);if(elem){if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem];for(elems=context.getElementsByName(id),i=0;elem=elems[i++];)if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem]}return[]}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return void 0!==context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(void 0!==context.getElementsByClassName&&documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(document.querySelectorAll))&&(assert((function(el){var input;docElem.appendChild(el).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>",el.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),el.querySelectorAll("[selected]").length||rbuggyQSA.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+booleans+")"),el.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),(input=document.createElement("input")).setAttribute("name",""),el.appendChild(input),el.querySelectorAll("[name='']").length||rbuggyQSA.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),el.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),el.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]"),el.querySelectorAll("\\\f"),rbuggyQSA.push("[\\r\\n\\f]")})),assert((function(el){el.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var input=document.createElement("input");input.setAttribute("type","hidden"),el.appendChild(input).setAttribute("name","D"),el.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==el.querySelectorAll(":enabled").length&&rbuggyQSA.push(":enabled",":disabled"),docElem.appendChild(el).disabled=!0,2!==el.querySelectorAll(":disabled").length&&rbuggyQSA.push(":enabled",":disabled"),el.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")}))),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert((function(el){support.disconnectedMatch=matches.call(el,"*"),matches.call(el,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)})),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)==(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a==document||a.ownerDocument==preferredDoc&&contains(preferredDoc,a)?-1:b==document||b.ownerDocument==preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a==document?-1:b==document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]==preferredDoc?-1:bp[i]==preferredDoc?1:0},document):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if(setDocument(elem),support.matchesSelector&&documentIsHTML&&!nonnativeSelectorCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){nonnativeSelectorCache(expr,!0)}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!=document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!=document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.escape=function(sel){return(sel+"").replace(rcssescape,fcssescape)},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+className+"("+whitespace+"|$)"))&&classCache(className,(function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")}))},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,_argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,_context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=!1;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(diff=(nodeIndex=(cache=(uniqueCache=(outerCache=(node=parent)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1])&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(diff=nodeIndex=(cache=(uniqueCache=(outerCache=(node=elem)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1]),!1===diff)for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((uniqueCache=(outerCache=node[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction((function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf(seed,matched[i])]=!(matches[idx]=matched[i])})):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction((function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction((function(seed,matches,_context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))})):function(elem,_context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}})),has:markFunction((function(selector){return function(elem){return Sizzle(selector,elem).length>0}})),contains:markFunction((function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||getText(elem)).indexOf(text)>-1}})),lang:markFunction((function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}})),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:createDisabledPseudo(!1),disabled:createDisabledPseudo(!0),checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo((function(){return[0]})),last:createPositionalPseudo((function(_matchIndexes,length){return[length-1]})),eq:createPositionalPseudo((function(_matchIndexes,length,argument){return[argument<0?argument+length:argument]})),even:createPositionalPseudo((function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),odd:createPositionalPseudo((function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),lt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument>length?length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes})),gt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes}))}}).pseudos.nth=Expr.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,skip=combinator.next,key=skip||dir,checkNonElements=base&&"parentNode"===key,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml);return!1}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)if(uniqueCache=(outerCache=elem[expando]||(elem[expando]={}))[elem.uniqueID]||(outerCache[elem.uniqueID]={}),skip&&skip===elem.nodeName.toLowerCase())elem=elem[dir]||elem;else{if((oldCache=uniqueCache[key])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(uniqueCache[key]=newCache,newCache[2]=matcher(elem,context,xml))return!0}return!1}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction((function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)}))}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator((function(elem){return elem===checkContext}),implicitRelative,!0),matchAnyContext=addCombinator((function(elem){return indexOf(checkContext,elem)>-1}),implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,function(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context==document||context||outermost);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0,context||elem.ownerDocument==document||(setDocument(elem),xml=!documentIsHTML);matcher=elementMatchers[j++];)if(matcher(elem,context||document,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&"ID"===(token=tokens[0]).type&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert((function(el){return 1&el.compareDocumentPosition(document.createElement("fieldset"))})),assert((function(el){return el.innerHTML="<a href='#'></a>","#"===el.firstChild.getAttribute("href")}))||addHandle("type|href|height|width",(function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)})),support.attributes&&assert((function(el){return el.innerHTML="<input/>",el.firstChild.setAttribute("value",""),""===el.firstChild.getAttribute("value")}))||addHandle("value",(function(elem,_name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue})),assert((function(el){return null==el.getAttribute("disabled")}))||addHandle(booleans,(function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null})),Sizzle}(window);jQuery.find=Sizzle,(jQuery.expr=Sizzle.selectors)[":"]=jQuery.expr.pseudos,jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains,jQuery.escapeSelector=Sizzle.escape;var dir=function(elem,_dir,until){for(var matched=[],truncate=void 0!==until;(elem=elem[_dir])&&9!==elem.nodeType;)if(1===elem.nodeType){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},_siblings=function(n,elem){for(var matched=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&matched.push(n);return matched},rneedsContext=jQuery.expr.match.needsContext;function nodeName(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()}var rsingleTag=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function winnow(elements,qualifier,not){return isFunction(qualifier)?jQuery.grep(elements,(function(elem,i){return!!qualifier.call(elem,i,elem)!==not})):qualifier.nodeType?jQuery.grep(elements,(function(elem){return elem===qualifier!==not})):"string"!=typeof qualifier?jQuery.grep(elements,(function(elem){return indexOf.call(qualifier,elem)>-1!==not})):jQuery.filter(qualifier,elements,not)}jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,(function(elem){return 1===elem.nodeType})))},jQuery.fn.extend({find:function(selector){var i,ret,len=this.length,self=this;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter((function(){for(i=0;i<len;i++)if(jQuery.contains(self[i],this))return!0})));for(ret=this.pushStack([]),i=0;i<len;i++)jQuery.find(selector,self[i],ret);return len>1?jQuery.uniqueSort(ret):ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector)return this;if(root=root||rootjQuery,"string"==typeof selector){if(!(match="<"===selector[0]&&">"===selector[selector.length-1]&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector))||!match[1]&&context)return!context||context.jquery?(context||root).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return(elem=document.getElementById(match[2]))&&(this[0]=elem,this.length=1),this}return selector.nodeType?(this[0]=selector,this.length=1,this):isFunction(selector)?void 0!==root.ready?root.ready(selector):selector(jQuery):jQuery.makeArray(selector,this)}).prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};function sibling(cur,dir){for(;(cur=cur[dir])&&1!==cur.nodeType;);return cur}jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter((function(){for(var i=0;i<l;i++)if(jQuery.contains(this,targets[i]))return!0}))},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],targets="string"!=typeof selectors&&jQuery(selectors);if(!rneedsContext.test(selectors))for(;i<l;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(targets?targets.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched)},index:function(elem){return elem?"string"==typeof elem?indexOf.call(jQuery(elem),this[0]):indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,_i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,_i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,_i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return _siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return _siblings(elem.firstChild)},contents:function(elem){return null!=elem.contentDocument&&getProto(elem.contentDocument)?elem.contentDocument:(nodeName(elem,"template")&&(elem=elem.content||elem),jQuery.merge([],elem.childNodes))}},(function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(matched=jQuery.filter(selector,matched)),this.length>1&&(guaranteedUnique[name]||jQuery.uniqueSort(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}}));var rnothtmlwhite=/[^\x20\t\r\n\f]+/g;function Identity(v){return v}function Thrower(ex){throw ex}function adoptValue(value,resolve,reject,noValue){var method;try{value&&isFunction(method=value.promise)?method.call(value).done(resolve).fail(reject):value&&isFunction(method=value.then)?method.call(value,resolve,reject):resolve.apply(void 0,[value].slice(noValue))}catch(value){reject.apply(void 0,[value])}}jQuery.Callbacks=function(options){options="string"==typeof options?function(options){var object={};return jQuery.each(options.match(rnothtmlwhite)||[],(function(_,flag){object[flag]=!0})),object}(options):jQuery.extend({},options);var firing,memory,_fired,_locked,list=[],queue=[],firingIndex=-1,fire=function(){for(_locked=_locked||options.once,_fired=firing=!0;queue.length;firingIndex=-1)for(memory=queue.shift();++firingIndex<list.length;)!1===list[firingIndex].apply(memory[0],memory[1])&&options.stopOnFalse&&(firingIndex=list.length,memory=!1);options.memory||(memory=!1),firing=!1,_locked&&(list=memory?[]:"")},self={add:function(){return list&&(memory&&!firing&&(firingIndex=list.length-1,queue.push(memory)),function add(args){jQuery.each(args,(function(_,arg){isFunction(arg)?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==toType(arg)&&add(arg)}))}(arguments),memory&&!firing&&fire()),this},remove:function(){return jQuery.each(arguments,(function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),index<=firingIndex&&firingIndex--})),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0},empty:function(){return list&&(list=[]),this},disable:function(){return _locked=queue=[],list=memory="",this},disabled:function(){return!list},lock:function(){return _locked=queue=[],memory||firing||(list=memory=""),this},locked:function(){return!!_locked},fireWith:function(context,args){return _locked||(args=[context,(args=args||[]).slice?args.slice():args],queue.push(args),firing||fire()),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!_fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["notify","progress",jQuery.Callbacks("memory"),jQuery.Callbacks("memory"),2],["resolve","done",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),0,"resolved"],["reject","fail",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),1,"rejected"]],_state="pending",_promise={state:function(){return _state},always:function(){return deferred.done(arguments).fail(arguments),this},catch:function(fn){return _promise.then(null,fn)},pipe:function(){var fns=arguments;return jQuery.Deferred((function(newDefer){jQuery.each(tuples,(function(_i,tuple){var fn=isFunction(fns[tuple[4]])&&fns[tuple[4]];deferred[tuple[1]]((function(){var returned=fn&&fn.apply(this,arguments);returned&&isFunction(returned.promise)?returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject):newDefer[tuple[0]+"With"](this,fn?[returned]:arguments)}))})),fns=null})).promise()},then:function(onFulfilled,onRejected,onProgress){var maxDepth=0;function resolve(depth,deferred,handler,special){return function(){var that=this,args=arguments,mightThrow=function(){var returned,then;if(!(depth<maxDepth)){if((returned=handler.apply(that,args))===deferred.promise())throw new TypeError("Thenable self-resolution");then=returned&&("object"==typeof returned||"function"==typeof returned)&&returned.then,isFunction(then)?special?then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special)):(maxDepth++,then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special),resolve(maxDepth,deferred,Identity,deferred.notifyWith))):(handler!==Identity&&(that=void 0,args=[returned]),(special||deferred.resolveWith)(that,args))}},process=special?mightThrow:function(){try{mightThrow()}catch(e){jQuery.Deferred.exceptionHook&&jQuery.Deferred.exceptionHook(e,process.stackTrace),depth+1>=maxDepth&&(handler!==Thrower&&(that=void 0,args=[e]),deferred.rejectWith(that,args))}};depth?process():(jQuery.Deferred.getStackHook&&(process.stackTrace=jQuery.Deferred.getStackHook()),window.setTimeout(process))}}return jQuery.Deferred((function(newDefer){tuples[0][3].add(resolve(0,newDefer,isFunction(onProgress)?onProgress:Identity,newDefer.notifyWith)),tuples[1][3].add(resolve(0,newDefer,isFunction(onFulfilled)?onFulfilled:Identity)),tuples[2][3].add(resolve(0,newDefer,isFunction(onRejected)?onRejected:Thrower))})).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,_promise):_promise}},deferred={};return jQuery.each(tuples,(function(i,tuple){var list=tuple[2],stateString=tuple[5];_promise[tuple[1]]=list.add,stateString&&list.add((function(){_state=stateString}),tuples[3-i][2].disable,tuples[3-i][3].disable,tuples[0][2].lock,tuples[0][3].lock),list.add(tuple[3].fire),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?void 0:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith})),_promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(singleValue){var remaining=arguments.length,i=remaining,resolveContexts=Array(i),resolveValues=_slice.call(arguments),master=jQuery.Deferred(),updateFunc=function(i){return function(value){resolveContexts[i]=this,resolveValues[i]=arguments.length>1?_slice.call(arguments):value,--remaining||master.resolveWith(resolveContexts,resolveValues)}};if(remaining<=1&&(adoptValue(singleValue,master.done(updateFunc(i)).resolve,master.reject,!remaining),"pending"===master.state()||isFunction(resolveValues[i]&&resolveValues[i].then)))return master.then();for(;i--;)adoptValue(resolveValues[i],updateFunc(i),master.reject);return master.promise()}});var rerrorNames=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;jQuery.Deferred.exceptionHook=function(error,stack){window.console&&window.console.warn&&error&&rerrorNames.test(error.name)&&window.console.warn("jQuery.Deferred exception: "+error.message,error.stack,stack)},jQuery.readyException=function(error){window.setTimeout((function(){throw error}))};var readyList=jQuery.Deferred();function completed(){document.removeEventListener("DOMContentLoaded",completed),window.removeEventListener("load",completed),jQuery.ready()}jQuery.fn.ready=function(fn){return readyList.then(fn).catch((function(error){jQuery.readyException(error)})),this},jQuery.extend({isReady:!1,readyWait:1,ready:function(wait){(!0===wait?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0,!0!==wait&&--jQuery.readyWait>0||readyList.resolveWith(document,[jQuery]))}}),jQuery.ready.then=readyList.then,"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?window.setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed),window.addEventListener("load",completed));var access=function access(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=null==key;if("object"===toType(key))for(i in chainable=!0,key)access(elems,fn,i,key[i],!0,emptyGet,raw);else if(void 0!==value&&(chainable=!0,isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,_key,value){return bulk.call(jQuery(elem),value)})),fn))for(;i<len;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet},rmsPrefix=/^-ms-/,rdashAlpha=/-([a-z])/g;function fcamelCase(_all,letter){return letter.toUpperCase()}function camelCase(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)}var acceptData=function(owner){return 1===owner.nodeType||9===owner.nodeType||!+owner.nodeType};function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1,Data.prototype={cache:function(owner){var value=owner[this.expando];return value||(value={},acceptData(owner)&&(owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,configurable:!0}))),value},set:function(owner,data,value){var prop,cache=this.cache(owner);if("string"==typeof data)cache[camelCase(data)]=value;else for(prop in data)cache[camelCase(prop)]=data[prop];return cache},get:function(owner,key){return void 0===key?this.cache(owner):owner[this.expando]&&owner[this.expando][camelCase(key)]},access:function(owner,key,value){return void 0===key||key&&"string"==typeof key&&void 0===value?this.get(owner,key):(this.set(owner,key,value),void 0!==value?value:key)},remove:function(owner,key){var i,cache=owner[this.expando];if(void 0!==cache){if(void 0!==key){i=(key=Array.isArray(key)?key.map(camelCase):(key=camelCase(key))in cache?[key]:key.match(rnothtmlwhite)||[]).length;for(;i--;)delete cache[key[i]]}(void 0===key||jQuery.isEmptyObject(cache))&&(owner.nodeType?owner[this.expando]=void 0:delete owner[this.expando])}},hasData:function(owner){var cache=owner[this.expando];return void 0!==cache&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data,dataUser=new Data,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function dataAttr(elem,key,data){var name;if(void 0===data&&1===elem.nodeType)if(name="data-"+key.replace(rmultiDash,"-$&").toLowerCase(),"string"==typeof(data=elem.getAttribute(name))){try{data=function(data){return"true"===data||"false"!==data&&("null"===data?null:data===+data+""?+data:rbrace.test(data)?JSON.parse(data):data)}(data)}catch(e){}dataUser.set(elem,key,data)}else data=void 0;return data}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,_data){return dataUser.access(elem,name,_data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0===key){if(this.length&&(data=dataUser.get(elem),1===elem.nodeType&&!dataPriv.get(elem,"hasDataAttrs"))){for(i=attrs.length;i--;)attrs[i]&&0===(name=attrs[i].name).indexOf("data-")&&(name=camelCase(name.slice(5)),dataAttr(elem,name,data[name]));dataPriv.set(elem,"hasDataAttrs",!0)}return data}return"object"==typeof key?this.each((function(){dataUser.set(this,key)})):access(this,(function(value){var data;if(elem&&void 0===value)return void 0!==(data=dataUser.get(elem,key))||void 0!==(data=dataAttr(elem,key))?data:void 0;this.each((function(){dataUser.set(this,key,value)}))}),null,value,arguments.length>1,null,!0)},removeData:function(key){return this.each((function(){dataUser.remove(this,key)}))}}),jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||"fx")+"queue",queue=dataPriv.get(elem,type),data&&(!queue||Array.isArray(data)?queue=dataPriv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){var queue=jQuery.queue(elem,type=type||"fx"),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type);"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,(function(){jQuery.dequeue(elem,type)}),hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add((function(){dataPriv.remove(elem,[type+"queue",key])}))})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each((function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)}))},dequeue:function(type){return this.each((function(){jQuery.dequeue(this,type)}))},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=void 0),type=type||"fx";i--;)(tmp=dataPriv.get(elements[i],type+"queueHooks"))&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),cssExpand=["Top","Right","Bottom","Left"],documentElement=document.documentElement,isAttached=function(elem){return jQuery.contains(elem.ownerDocument,elem)},composed={composed:!0};documentElement.getRootNode&&(isAttached=function(elem){return jQuery.contains(elem.ownerDocument,elem)||elem.getRootNode(composed)===elem.ownerDocument});var isHiddenWithinTree=function(elem,el){return"none"===(elem=el||elem).style.display||""===elem.style.display&&isAttached(elem)&&"none"===jQuery.css(elem,"display")};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=elem.nodeType&&(jQuery.cssNumber[prop]||"px"!==unit&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){for(initial/=2,unit=unit||initialInUnit[3],initialInUnit=+initial||1;maxIterations--;)jQuery.style(elem,prop,initialInUnit+unit),(1-scale)*(1-(scale=currentValue()/initial||.5))<=0&&(maxIterations=0),initialInUnit/=scale;jQuery.style(elem,prop,(initialInUnit*=2)+unit),valueParts=valueParts||[]}return valueParts&&(initialInUnit=+initialInUnit||+initial||0,adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2],tween&&(tween.unit=unit,tween.start=initialInUnit,tween.end=adjusted)),adjusted}var defaultDisplayMap={};function getDefaultDisplay(elem){var temp,doc=elem.ownerDocument,nodeName=elem.nodeName,display=defaultDisplayMap[nodeName];return display||(temp=doc.body.appendChild(doc.createElement(nodeName)),display=jQuery.css(temp,"display"),temp.parentNode.removeChild(temp),"none"===display&&(display="block"),defaultDisplayMap[nodeName]=display,display)}function showHide(elements,show){for(var display,elem,values=[],index=0,length=elements.length;index<length;index++)(elem=elements[index]).style&&(display=elem.style.display,show?("none"===display&&(values[index]=dataPriv.get(elem,"display")||null,values[index]||(elem.style.display="")),""===elem.style.display&&isHiddenWithinTree(elem)&&(values[index]=getDefaultDisplay(elem))):"none"!==display&&(values[index]="none",dataPriv.set(elem,"display",display)));for(index=0;index<length;index++)null!=values[index]&&(elements[index].style.display=values[index]);return elements}jQuery.fn.extend({show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each((function(){isHiddenWithinTree(this)?jQuery(this).show():jQuery(this).hide()}))}});var div,input,rcheckableType=/^(?:checkbox|radio)$/i,rtagName=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,rscriptType=/^$|^module$|\/(?:java|ecma)script/i;div=document.createDocumentFragment().appendChild(document.createElement("div")),(input=document.createElement("input")).setAttribute("type","radio"),input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue,div.innerHTML="<option></option>",support.option=!!div.lastChild;var wrapMap={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function getAll(context,tag){var ret;return ret=void 0!==context.getElementsByTagName?context.getElementsByTagName(tag||"*"):void 0!==context.querySelectorAll?context.querySelectorAll(tag||"*"):[],void 0===tag||tag&&nodeName(context,tag)?jQuery.merge([context],ret):ret}function setGlobalEval(elems,refElements){for(var i=0,l=elems.length;i<l;i++)dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"))}wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,support.option||(wrapMap.optgroup=wrapMap.option=[1,"<select multiple='multiple'>","</select>"]);var rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){for(var elem,tmp,tag,wrap,attached,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;i<l;i++)if((elem=elems[i])||0===elem)if("object"===toType(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),(tmp=fragment.firstChild).textContent=""}else nodes.push(context.createTextNode(elem));for(fragment.textContent="",i=0;elem=nodes[i++];)if(selection&&jQuery.inArray(elem,selection)>-1)ignored&&ignored.push(elem);else if(attached=isAttached(elem),tmp=getAll(fragment.appendChild(elem),"script"),attached&&setGlobalEval(tmp),scripts)for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return fragment}var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return!0}function returnFalse(){return!1}function expectSync(elem,type){return elem===function(){try{return document.activeElement}catch(err){}}()==("focus"===type)}function _on(elem,types,selector,data,fn,one){var origFn,type;if("object"==typeof types){for(type in"string"!=typeof selector&&(data=data||selector,selector=void 0),types)_on(elem,type,selector,data,types[type],one);return elem}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&("string"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),!1===fn)fn=returnFalse;else if(!fn)return elem;return 1===one&&(origFn=fn,(fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)}).guid=origFn.guid||(origFn.guid=jQuery.guid++)),elem.each((function(){jQuery.event.add(this,types,fn,data,selector)}))}function leverageNative(el,type,expectSync){expectSync?(dataPriv.set(el,type,!1),jQuery.event.add(el,type,{namespace:!1,handler:function(event){var notAsync,result,saved=dataPriv.get(this,type);if(1&event.isTrigger&&this[type]){if(saved.length)(jQuery.event.special[type]||{}).delegateType&&event.stopPropagation();else if(saved=_slice.call(arguments),dataPriv.set(this,type,saved),notAsync=expectSync(this,type),this[type](),saved!==(result=dataPriv.get(this,type))||notAsync?dataPriv.set(this,type,!1):result={},saved!==result)return event.stopImmediatePropagation(),event.preventDefault(),result.value}else saved.length&&(dataPriv.set(this,type,{value:jQuery.event.trigger(jQuery.extend(saved[0],jQuery.Event.prototype),saved.slice(1),this)}),event.stopImmediatePropagation())}})):void 0===dataPriv.get(el,type)&&jQuery.event.add(el,type,returnTrue)}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(acceptData(elem))for(handler.handler&&(handler=(handleObjIn=handler).handler,selector=handleObjIn.selector),selector&&jQuery.find.matchesSelector(documentElement,selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events=Object.create(null)),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return void 0!==jQuery&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):void 0}),t=(types=(types||"").match(rnothtmlwhite)||[""]).length;t--;)type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||((handlers=events[type]=[]).delegateCount=0,special.setup&&!1!==special.setup.call(elem,data,namespaces,eventHandle)||elem.addEventListener&&elem.addEventListener(type,eventHandle)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0)},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(elemData&&(events=elemData.events)){for(t=(types=(types||"").match(rnothtmlwhite)||[""]).length;t--;)if(type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},handlers=events[type=(selector?special.delegateType:special.bindType)||type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&!1!==special.teardown.call(elem,namespaces,elemData.handle)||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&dataPriv.remove(elem,"handle events")}},dispatch:function(nativeEvent){var i,j,ret,matched,handleObj,handlerQueue,args=new Array(arguments.length),event=jQuery.event.fix(nativeEvent),handlers=(dataPriv.get(this,"events")||Object.create(null))[event.type]||[],special=jQuery.event.special[event.type]||{};for(args[0]=event,i=1;i<arguments.length;i++)args[i]=arguments[i];if(event.delegateTarget=this,!special.preDispatch||!1!==special.preDispatch.call(this,event)){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)event.rnamespace&&!1!==handleObj.namespace&&!event.rnamespace.test(handleObj.namespace)||(event.handleObj=handleObj,event.data=handleObj.data,void 0!==(ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args))&&!1===(event.result=ret)&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,_handlers){var i,handleObj,sel,matchedHandlers,matchedSelectors,handlerQueue=[],delegateCount=_handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&!("click"===event.type&&event.button>=1))for(;cur!==this;cur=cur.parentNode||this)if(1===cur.nodeType&&("click"!==event.type||!0!==cur.disabled)){for(matchedHandlers=[],matchedSelectors={},i=0;i<delegateCount;i++)void 0===matchedSelectors[sel=(handleObj=_handlers[i]).selector+" "]&&(matchedSelectors[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length),matchedSelectors[sel]&&matchedHandlers.push(handleObj);matchedHandlers.length&&handlerQueue.push({elem:cur,handlers:matchedHandlers})}return cur=this,delegateCount<_handlers.length&&handlerQueue.push({elem:cur,handlers:_handlers.slice(delegateCount)}),handlerQueue},addProp:function(name,hook){Object.defineProperty(jQuery.Event.prototype,name,{enumerable:!0,configurable:!0,get:isFunction(hook)?function(){if(this.originalEvent)return hook(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[name]},set:function(value){Object.defineProperty(this,name,{enumerable:!0,configurable:!0,writable:!0,value:value})}})},fix:function(originalEvent){return originalEvent[jQuery.expando]?originalEvent:new jQuery.Event(originalEvent)},special:{load:{noBubble:!0},click:{setup:function(data){var el=this||data;return rcheckableType.test(el.type)&&el.click&&nodeName(el,"input")&&leverageNative(el,"click",returnTrue),!1},trigger:function(data){var el=this||data;return rcheckableType.test(el.type)&&el.click&&nodeName(el,"input")&&leverageNative(el,"click"),!0},_default:function(event){var target=event.target;return rcheckableType.test(target.type)&&target.click&&nodeName(target,"input")&&dataPriv.get(target,"click")||nodeName(target,"a")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle)},(jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&!1===src.returnValue?returnTrue:returnFalse,this.target=src.target&&3===src.target.nodeType?src.target.parentNode:src.target,this.currentTarget=src.currentTarget,this.relatedTarget=src.relatedTarget):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||Date.now(),this[jQuery.expando]=!0}).prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(event){var button=event.button;return null==event.which&&rkeyEvent.test(event.type)?null!=event.charCode?event.charCode:event.keyCode:!event.which&&void 0!==button&&rmouseEvent.test(event.type)?1&button?1:2&button?3:4&button?2:0:event.which}},jQuery.event.addProp),jQuery.each({focus:"focusin",blur:"focusout"},(function(type,delegateType){jQuery.event.special[type]={setup:function(){return leverageNative(this,type,expectSync),!1},trigger:function(){return leverageNative(this,type),!0},delegateType:delegateType}})),jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;return related&&(related===target||jQuery.contains(target,related))||(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}})),jQuery.fn.extend({on:function(types,selector,data,fn){return _on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return _on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}return!1!==selector&&"function"!=typeof selector||(fn=selector,selector=void 0),!1===fn&&(fn=returnFalse),this.each((function(){jQuery.event.remove(this,types,fn,selector)}))}});var rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){return nodeName(elem,"table")&&nodeName(11!==content.nodeType?content:content.firstChild,"tr")&&jQuery(elem).children("tbody")[0]||elem}function disableScript(elem){return elem.type=(null!==elem.getAttribute("type"))+"/"+elem.type,elem}function restoreScript(elem){return"true/"===(elem.type||"").slice(0,5)?elem.type=elem.type.slice(5):elem.removeAttribute("type"),elem}function cloneCopyEvent(src,dest){var i,l,type,udataOld,udataCur,events;if(1===dest.nodeType){if(dataPriv.hasData(src)&&(events=dataPriv.get(src).events))for(type in dataPriv.remove(dest,"handle events"),events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i]);dataUser.hasData(src)&&(udataOld=dataUser.access(src),udataCur=jQuery.extend({},udataOld),dataUser.set(dest,udataCur))}}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();"input"===nodeName&&rcheckableType.test(src.type)?dest.checked=src.checked:"input"!==nodeName&&"textarea"!==nodeName||(dest.defaultValue=src.defaultValue)}function domManip(collection,args,callback,ignored){args=flat(args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],valueIsFunction=isFunction(value);if(valueIsFunction||l>1&&"string"==typeof value&&!support.checkClone&&rchecked.test(value))return collection.each((function(index){var self=collection.eq(index);valueIsFunction&&(args[0]=value.call(this,index,self.html())),domManip(self,args,callback,ignored)}));if(l&&(first=(fragment=buildFragment(args,collection[0].ownerDocument,!1,collection,ignored)).firstChild,1===fragment.childNodes.length&&(fragment=first),first||ignored)){for(hasScripts=(scripts=jQuery.map(getAll(fragment,"script"),disableScript)).length;i<l;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(collection[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;i<hasScripts;i++)node=scripts[i],rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src&&"module"!==(node.type||"").toLowerCase()?jQuery._evalUrl&&!node.noModule&&jQuery._evalUrl(node.src,{nonce:node.nonce||node.getAttribute("nonce")},doc):DOMEval(node.textContent.replace(rcleanScript,""),node,doc))}return collection}function _remove(elem,selector,keepData){for(var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;null!=(node=nodes[i]);i++)keepData||1!==node.nodeType||jQuery.cleanData(getAll(node)),node.parentNode&&(keepData&&isAttached(node)&&setGlobalEval(getAll(node,"script")),node.parentNode.removeChild(node));return elem}jQuery.extend({htmlPrefilter:function(html){return html},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(!0),inPage=isAttached(elem);if(!(support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),i=0,l=(srcElements=getAll(elem)).length;i<l;i++)fixInput(srcElements[i],destElements[i]);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0,l=srcElements.length;i<l;i++)cloneCopyEvent(srcElements[i],destElements[i]);else cloneCopyEvent(elem,clone);return(destElements=getAll(clone,"script")).length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),clone},cleanData:function(elems){for(var data,elem,type,special=jQuery.event.special,i=0;void 0!==(elem=elems[i]);i++)if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);elem[dataPriv.expando]=void 0}elem[dataUser.expando]&&(elem[dataUser.expando]=void 0)}}}),jQuery.fn.extend({detach:function(selector){return _remove(this,selector,!0)},remove:function(selector){return _remove(this,selector)},text:function(value){return access(this,(function(value){return void 0===value?jQuery.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=value)}))}),null,value,arguments.length)},append:function(){return domManip(this,arguments,(function(elem){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||manipulationTarget(this,elem).appendChild(elem)}))},prepend:function(){return domManip(this,arguments,(function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}}))},before:function(){return domManip(this,arguments,(function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)}))},after:function(){return domManip(this,arguments,(function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)}))},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent="");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null!=dataAndEvents&&dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map((function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)}))},html:function(value){return access(this,(function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value&&1===elem.nodeType)return elem.innerHTML;if("string"==typeof value&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++)1===(elem=this[i]||{}).nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)}),null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,(function(elem){var parent=this.parentNode;jQuery.inArray(this,ignored)<0&&(jQuery.cleanData(getAll(this)),parent&&parent.replaceChild(elem,this))}),ignored)}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(name,original){jQuery.fn[name]=function(selector){for(var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;i<=last;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}}));var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),getStyles=function(elem){var view=elem.ownerDocument.defaultView;return view&&view.opener||(view=window),view.getComputedStyle(elem)},swap=function(elem,options,callback){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];for(name in ret=callback.call(elem),options)elem.style[name]=old[name];return ret},rboxStyle=new RegExp(cssExpand.join("|"),"i");function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return(computed=computed||getStyles(elem))&&(""!==(ret=computed.getPropertyValue(name)||computed[name])||isAttached(elem)||(ret=jQuery.style(elem,name)),!support.pixelBoxStyles()&&rnumnonpx.test(ret)&&rboxStyle.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),void 0!==ret?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(!conditionFn())return(this.get=hookFn).apply(this,arguments);delete this.get}}}!function(){function computeStyleTests(){if(div){container.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",div.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",documentElement.appendChild(container).appendChild(div);var divStyle=window.getComputedStyle(div);pixelPositionVal="1%"!==divStyle.top,reliableMarginLeftVal=12===roundPixelMeasures(divStyle.marginLeft),div.style.right="60%",pixelBoxStylesVal=36===roundPixelMeasures(divStyle.right),boxSizingReliableVal=36===roundPixelMeasures(divStyle.width),div.style.position="absolute",scrollboxSizeVal=12===roundPixelMeasures(div.offsetWidth/3),documentElement.removeChild(container),div=null}}function roundPixelMeasures(measure){return Math.round(parseFloat(measure))}var pixelPositionVal,boxSizingReliableVal,scrollboxSizeVal,pixelBoxStylesVal,reliableTrDimensionsVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");div.style&&(div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,jQuery.extend(support,{boxSizingReliable:function(){return computeStyleTests(),boxSizingReliableVal},pixelBoxStyles:function(){return computeStyleTests(),pixelBoxStylesVal},pixelPosition:function(){return computeStyleTests(),pixelPositionVal},reliableMarginLeft:function(){return computeStyleTests(),reliableMarginLeftVal},scrollboxSize:function(){return computeStyleTests(),scrollboxSizeVal},reliableTrDimensions:function(){var table,tr,trChild,trStyle;return null==reliableTrDimensionsVal&&(table=document.createElement("table"),tr=document.createElement("tr"),trChild=document.createElement("div"),table.style.cssText="position:absolute;left:-11111px",tr.style.height="1px",trChild.style.height="9px",documentElement.appendChild(table).appendChild(tr).appendChild(trChild),trStyle=window.getComputedStyle(tr),reliableTrDimensionsVal=parseInt(trStyle.height)>3,documentElement.removeChild(table)),reliableTrDimensionsVal}}))}();var cssPrefixes=["Webkit","Moz","ms"],emptyStyle=document.createElement("div").style,vendorProps={};function finalPropName(name){return jQuery.cssProps[name]||vendorProps[name]||(name in emptyStyle?name:vendorProps[name]=function(name){for(var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;i--;)if((name=cssPrefixes[i]+capName)in emptyStyle)return name}(name)||name)}var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rcustomProp=/^--/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"};function setPositiveNumber(_elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value}function boxModelAdjustment(elem,dimension,box,isBorderBox,styles,computedVal){var i="width"===dimension?1:0,extra=0,delta=0;if(box===(isBorderBox?"border":"content"))return 0;for(;i<4;i+=2)"margin"===box&&(delta+=jQuery.css(elem,box+cssExpand[i],!0,styles)),isBorderBox?("content"===box&&(delta-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==box&&(delta-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(delta+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==box?delta+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles):extra+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles));return!isBorderBox&&computedVal>=0&&(delta+=Math.max(0,Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-computedVal-delta-extra-.5))||0),delta}function getWidthOrHeight(elem,dimension,extra){var styles=getStyles(elem),isBorderBox=(!support.boxSizingReliable()||extra)&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),valueIsBorderBox=isBorderBox,val=curCSS(elem,dimension,styles),offsetProp="offset"+dimension[0].toUpperCase()+dimension.slice(1);if(rnumnonpx.test(val)){if(!extra)return val;val="auto"}return(!support.boxSizingReliable()&&isBorderBox||!support.reliableTrDimensions()&&nodeName(elem,"tr")||"auto"===val||!parseFloat(val)&&"inline"===jQuery.css(elem,"display",!1,styles))&&elem.getClientRects().length&&(isBorderBox="border-box"===jQuery.css(elem,"boxSizing",!1,styles),(valueIsBorderBox=offsetProp in elem)&&(val=elem[offsetProp])),(val=parseFloat(val)||0)+boxModelAdjustment(elem,dimension,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles,val)+"px"}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=camelCase(name),isCustomProp=rcustomProp.test(name),style=elem.style;if(isCustomProp||(name=finalPropName(origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value)return hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name];"string"===(type=typeof value)&&(ret=rcssNum.exec(value))&&ret[1]&&(value=adjustCSS(elem,name,ret),type="number"),null!=value&&value==value&&("number"!==type||isCustomProp||(value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")),support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),hooks&&"set"in hooks&&void 0===(value=hooks.set(elem,value,extra))||(isCustomProp?style.setProperty(name,value):style[name]=value))}},css:function(elem,name,extra,styles){var val,num,hooks,origName=camelCase(name);return rcustomProp.test(name)||(name=finalPropName(origName)),(hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName])&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),!0===extra||isFinite(num)?num||0:val):val}}),jQuery.each(["height","width"],(function(_i,dimension){jQuery.cssHooks[dimension]={get:function(elem,computed,extra){if(computed)return!rdisplayswap.test(jQuery.css(elem,"display"))||elem.getClientRects().length&&elem.getBoundingClientRect().width?getWidthOrHeight(elem,dimension,extra):swap(elem,cssShow,(function(){return getWidthOrHeight(elem,dimension,extra)}))},set:function(elem,value,extra){var matches,styles=getStyles(elem),scrollboxSizeBuggy=!support.scrollboxSize()&&"absolute"===styles.position,isBorderBox=(scrollboxSizeBuggy||extra)&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),subtract=extra?boxModelAdjustment(elem,dimension,extra,isBorderBox,styles):0;return isBorderBox&&scrollboxSizeBuggy&&(subtract-=Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-parseFloat(styles[dimension])-boxModelAdjustment(elem,dimension,"border",!1,styles)-.5)),subtract&&(matches=rcssNum.exec(value))&&"px"!==(matches[3]||"px")&&(elem.style[dimension]=value,value=jQuery.css(elem,dimension)),setPositiveNumber(0,value,subtract)}}})),jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,(function(elem,computed){if(computed)return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},(function(){return elem.getBoundingClientRect().left})))+"px"})),jQuery.each({margin:"",padding:"",border:"Width"},(function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},"margin"!==prefix&&(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)})),jQuery.fn.extend({css:function(name,value){return access(this,(function(elem,name,value){var styles,len,map={},i=0;if(Array.isArray(name)){for(styles=getStyles(elem),len=name.length;i<len;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)}),name,value,arguments.length>1)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||jQuery.easing._default,this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return 1!==tween.elem.nodeType||null!=tween.elem[tween.prop]&&null==tween.elem.style[tween.prop]?tween.elem[tween.prop]:(result=jQuery.css(tween.elem,tween.prop,""))&&"auto"!==result?result:0},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):1!==tween.elem.nodeType||!jQuery.cssHooks[tween.prop]&&null==tween.elem.style[finalPropName(tween.prop)]?tween.elem[tween.prop]=tween.now:jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"},(jQuery.fx=Tween.prototype.init).step={};var fxNow,inProgress,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function schedule(){inProgress&&(!1===document.hidden&&window.requestAnimationFrame?window.requestAnimationFrame(schedule):window.setTimeout(schedule,jQuery.fx.interval),jQuery.fx.tick())}function createFxNow(){return window.setTimeout((function(){fxNow=void 0})),fxNow=Date.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};for(includeWidth=includeWidth?1:0;i<4;i+=2-includeWidth)attrs["margin"+(which=cssExpand[i])]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;index<length;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always((function(){delete tick.elem})),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(length||deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;index<length;index++)animation.tweens[index].run(1);return gotoEnd?(deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation,gotoEnd])):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(function(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(easing=specialEasing[name=camelCase(index)],value=props[index],Array.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),(hooks=jQuery.cssHooks[name])&&"expand"in hooks)for(index in value=hooks.expand(value),delete props[name],value)index in props||(props[index]=value[index],specialEasing[index]=easing);else specialEasing[name]=easing}(props,animation.opts.specialEasing);index<length;index++)if(result=Animation.prefilters[index].call(animation,elem,props,animation.opts))return isFunction(result.stop)&&(jQuery._queueHooks(animation.elem,animation.opts.queue).stop=result.stop.bind(result)),result;return jQuery.map(props,createTween,animation),isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);return adjustCSS(tween.elem,prop,rcssNum.exec(value),tween),tween}]},tweener:function(props,callback){isFunction(props)?(callback=props,props=["*"]):props=props.match(rnothtmlwhite);for(var prop,index=0,length=props.length;index<length;index++)prop=props[index],Animation.tweeners[prop]=Animation.tweeners[prop]||[],Animation.tweeners[prop].unshift(callback)},prefilters:[function(elem,props,opts){var prop,value,toggle,hooks,oldfire,propTween,restoreDisplay,display,isBox="width"in props||"height"in props,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHiddenWithinTree(elem),dataShow=dataPriv.get(elem,"fxshow");for(prop in opts.queue||(null==(hooks=jQuery._queueHooks(elem,"fx")).unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always((function(){anim.always((function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()}))}))),props)if(value=props[prop],rfxtypes.test(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}if((propTween=!jQuery.isEmptyObject(props))||!jQuery.isEmptyObject(orig))for(prop in isBox&&1===elem.nodeType&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],null==(restoreDisplay=dataShow&&dataShow.display)&&(restoreDisplay=dataPriv.get(elem,"display")),"none"===(display=jQuery.css(elem,"display"))&&(restoreDisplay?display=restoreDisplay:(showHide([elem],!0),restoreDisplay=elem.style.display||restoreDisplay,display=jQuery.css(elem,"display"),showHide([elem]))),("inline"===display||"inline-block"===display&&null!=restoreDisplay)&&"none"===jQuery.css(elem,"float")&&(propTween||(anim.done((function(){style.display=restoreDisplay})),null==restoreDisplay&&(display=style.display,restoreDisplay="none"===display?"":display)),style.display="inline-block")),opts.overflow&&(style.overflow="hidden",anim.always((function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}))),propTween=!1,orig)propTween||(dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=dataPriv.access(elem,"fxshow",{display:restoreDisplay}),toggle&&(dataShow.hidden=!hidden),hidden&&showHide([elem],!0),anim.done((function(){for(prop in hidden||showHide([elem]),dataPriv.remove(elem,"fxshow"),orig)jQuery.style(elem,prop,orig[prop])}))),propTween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=propTween.start,hidden&&(propTween.end=propTween.start,propTween.start=0))}],prefilter:function(callback,prepend){prepend?Animation.prefilters.unshift(callback):Animation.prefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!isFunction(easing)&&easing};return jQuery.fx.off?opt.duration=0:"number"!=typeof opt.duration&&(opt.duration in jQuery.fx.speeds?opt.duration=jQuery.fx.speeds[opt.duration]:opt.duration=jQuery.fx.speeds._default),null!=opt.queue&&!0!==opt.queue||(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHiddenWithinTree).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||dataPriv.get(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||!1===optall.queue?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&this.queue(type||"fx",[]),this.each((function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));!dequeue&&gotoEnd||jQuery.dequeue(this,type)}))},finish:function(type){return!1!==type&&(type=type||"fx"),this.each((function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;index<length;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish}))}}),jQuery.each(["toggle","show","hide"],(function(_i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}})),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}})),jQuery.timers=[],jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;for(fxNow=Date.now();i<timers.length;i++)(timer=timers[i])()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){inProgress||(inProgress=!0,schedule())},jQuery.fx.stop=function(){inProgress=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx&&jQuery.fx.speeds[time]||time,type=type||"fx",this.queue(type,(function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}}))},function(){var input=document.createElement("input"),opt=document.createElement("select").appendChild(document.createElement("option"));input.type="checkbox",support.checkOn=""!==input.value,support.optSelected=opt.selected,(input=document.createElement("input")).value="t",input.type="radio",support.radioValue="t"===input.value}();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each((function(){jQuery.removeAttr(this,name)}))}}),jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return void 0===elem.getAttribute?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(hooks=jQuery.attrHooks[name.toLowerCase()]||(jQuery.expr.match.bool.test(name)?boolHook:void 0)),void 0!==value?null===value?void jQuery.removeAttr(elem,name):hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+""),value):hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:null==(ret=jQuery.find.attr(elem,name))?void 0:ret)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&"radio"===value&&nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}},removeAttr:function(elem,value){var name,i=0,attrNames=value&&value.match(rnothtmlwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)elem.removeAttribute(name)}}),boolHook={set:function(elem,value,name){return!1===value?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),(function(_i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle,lowercaseName=name.toLowerCase();return isXML||(handle=attrHandle[lowercaseName],attrHandle[lowercaseName]=ret,ret=null!=getter(elem,name,isXML)?lowercaseName:null,attrHandle[lowercaseName]=handle),ret}}));var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;function stripAndCollapse(value){return(value.match(rnothtmlwhite)||[]).join(" ")}function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||""}function classesToArray(value){return Array.isArray(value)?value:"string"==typeof value&&value.match(rnothtmlwhite)||[]}jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each((function(){delete this[jQuery.propFix[name]||name]}))}}),jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return 1===nType&&jQuery.isXMLDoc(elem)||(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null},set:function(elem){var parent=elem.parentNode;parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex)}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){jQuery.propFix[this.toLowerCase()]=this})),jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value))return this.each((function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))}));if((classes=classesToArray(value)).length)for(;elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&" "+stripAndCollapse(curValue)+" "){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute("class",finalValue)}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value))return this.each((function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))}));if(!arguments.length)return this.attr("class","");if((classes=classesToArray(value)).length)for(;elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&" "+stripAndCollapse(curValue)+" "){for(j=0;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>-1;)cur=cur.replace(" "+clazz+" "," ");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute("class",finalValue)}return this},toggleClass:function(value,stateVal){var type=typeof value,isValidValue="string"===type||Array.isArray(value);return"boolean"==typeof stateVal&&isValidValue?stateVal?this.addClass(value):this.removeClass(value):isFunction(value)?this.each((function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)})):this.each((function(){var className,i,self,classNames;if(isValidValue)for(i=0,self=jQuery(this),classNames=classesToArray(value);className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else void 0!==value&&"boolean"!==type||((className=getClass(this))&&dataPriv.set(this,"__className__",className),this.setAttribute&&this.setAttribute("class",className||!1===value?"":dataPriv.get(this,"__className__")||""))}))},hasClass:function(selector){var className,elem,i=0;for(className=" "+selector+" ";elem=this[i++];)if(1===elem.nodeType&&(" "+stripAndCollapse(getClass(elem))+" ").indexOf(className)>-1)return!0;return!1}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,valueIsFunction,elem=this[0];return arguments.length?(valueIsFunction=isFunction(value),this.each((function(i){var val;1===this.nodeType&&(null==(val=valueIsFunction?value.call(this,i,jQuery(this).val()):value)?val="":"number"==typeof val?val+="":Array.isArray(val)&&(val=jQuery.map(val,(function(value){return null==value?"":value+""}))),(hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()])&&"set"in hooks&&void 0!==hooks.set(this,val,"value")||(this.value=val))}))):elem?(hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()])&&"get"in hooks&&void 0!==(ret=hooks.get(elem,"value"))?ret:"string"==typeof(ret=elem.value)?ret.replace(rreturn,""):null==ret?"":ret:void 0}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:stripAndCollapse(jQuery.text(elem))}},select:{get:function(elem){var value,option,i,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type,values=one?null:[],max=one?index+1:options.length;for(i=index<0?max:one?index:0;i<max;i++)if(((option=options[i]).selected||i===index)&&!option.disabled&&(!option.parentNode.disabled||!nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)((option=options[i]).selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1)&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}}}),jQuery.each(["radio","checkbox"],(function(){jQuery.valHooks[this]={set:function(elem,value){if(Array.isArray(value))return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})})),support.focusin="onfocusin"in window;var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,stopPropagationCallback=function(e){e.stopPropagation()};jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,lastElement,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=lastElement=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(".")>-1&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,(event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event)).isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||!1!==special.trigger.apply(elem,data))){if(!onlyHandlers&&!special.noBubble&&!isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)lastElement=cur,event.type=i>1?bubbleType:special.bindType||type,(handle=(dataPriv.get(cur,"events")||Object.create(null))[event.type]&&dataPriv.get(cur,"handle"))&&handle.apply(cur,data),(handle=ontype&&cur[ontype])&&handle.apply&&acceptData(cur)&&(event.result=handle.apply(cur,data),!1===event.result&&event.preventDefault());return event.type=type,onlyHandlers||event.isDefaultPrevented()||special._default&&!1!==special._default.apply(eventPath.pop(),data)||!acceptData(elem)||ontype&&isFunction(elem[type])&&!isWindow(elem)&&((tmp=elem[ontype])&&(elem[ontype]=null),jQuery.event.triggered=type,event.isPropagationStopped()&&lastElement.addEventListener(type,stopPropagationCallback),elem[type](),event.isPropagationStopped()&&lastElement.removeEventListener(type,stopPropagationCallback),jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)),event.result}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0});jQuery.event.trigger(e,null,elem)}}),jQuery.fn.extend({trigger:function(type,data){return this.each((function(){jQuery.event.trigger(type,data,this)}))},triggerHandler:function(type,data){var elem=this[0];if(elem)return jQuery.event.trigger(type,data,elem,!0)}}),support.focusin||jQuery.each({focus:"focusin",blur:"focusout"},(function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this.document||this,attaches=dataPriv.access(doc,fix);attaches||doc.addEventListener(orig,handler,!0),dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this.document||this,attaches=dataPriv.access(doc,fix)-1;attaches?dataPriv.access(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),dataPriv.remove(doc,fix))}}}));var location=window.location,nonce={guid:Date.now()},rquery=/\?/;jQuery.parseXML=function(data){var xml;if(!data||"string"!=typeof data)return null;try{xml=(new window.DOMParser).parseFromString(data,"text/xml")}catch(e){xml=void 0}return xml&&!xml.getElementsByTagName("parsererror").length||jQuery.error("Invalid XML: "+data),xml};var rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(Array.isArray(obj))jQuery.each(obj,(function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v&&null!=v?i:"")+"]",v,traditional,add)}));else if(traditional||"object"!==toType(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,valueOrFunction){var value=isFunction(valueOrFunction)?valueOrFunction():valueOrFunction;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(null==value?"":value)};if(null==a)return"";if(Array.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,(function(){add(this.name,this.value)}));else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this})).filter((function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))})).map((function(_i,elem){var val=jQuery(this).val();return null==val?null:Array.isArray(val)?jQuery.map(val,(function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}})):{name:elem.name,value:val.replace(rCRLF,"\r\n")}})).get()}});var r20=/%20/g,rhash=/#.*$/,rantiCache=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnothtmlwhite)||[];if(isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType[0]?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],(function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)})),selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}originAnchor.href=location.href,jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(location.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){"object"==typeof url&&(options=url,url=void 0);var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,completed,fireGlobals,i,uncached,s=jQuery.ajaxSetup({},options=options||{}),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),_statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(completed){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()+" "]=(responseHeaders[match[1].toLowerCase()+" "]||[]).concat(match[2]);match=responseHeaders[key.toLowerCase()+" "]}return null==match?null:match.join(", ")},getAllResponseHeaders:function(){return completed?responseHeadersString:null},setRequestHeader:function(name,value){return null==completed&&(name=requestHeadersNames[name.toLowerCase()]=requestHeadersNames[name.toLowerCase()]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return null==completed&&(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(completed)jqXHR.always(map[jqXHR.status]);else for(code in map)_statusCode[code]=[_statusCode[code],map[code]];return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR),s.url=((url||s.url||location.href)+"").replace(rprotocol,location.protocol+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=(s.dataType||"*").toLowerCase().match(rnothtmlwhite)||[""],null==s.crossDomain){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url,urlAnchor.href=urlAnchor.href,s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!=urlAnchor.protocol+"//"+urlAnchor.host}catch(e){s.crossDomain=!0}}if(s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),completed)return jqXHR;for(i in(fireGlobals=jQuery.event&&s.global)&&0==jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url.replace(rhash,""),s.hasContent?s.data&&s.processData&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&(s.data=s.data.replace(r20,"+")):(uncached=s.url.slice(cacheURL.length),s.data&&(s.processData||"string"==typeof s.data)&&(cacheURL+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),!1===s.cache&&(cacheURL=cacheURL.replace(rantiCache,"$1"),uncached=(rquery.test(cacheURL)?"&":"?")+"_="+nonce.guid+++uncached),s.url=cacheURL+uncached),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&!1!==s.contentType||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]),s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(!1===s.beforeSend.call(callbackContext,jqXHR,s)||completed))return jqXHR.abort();if(strAbort="abort",completeDeferred.add(s.complete),jqXHR.done(s.success),jqXHR.fail(s.error),transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){if(jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),completed)return jqXHR;s.async&&s.timeout>0&&(timeoutTimer=window.setTimeout((function(){jqXHR.abort("timeout")}),s.timeout));try{completed=!1,transport.send(requestHeaders,done)}catch(e){if(completed)throw e;done(-1,e)}}else done(-1,"No Transport");function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;completed||(completed=!0,timeoutTimer&&window.clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&status<300||304===status,responses&&(response=function(s,jqXHR,responses){for(var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}(s,jqXHR,responses)),!isSuccess&&jQuery.inArray("script",s.dataTypes)>-1&&(s.converters["text script"]=function(){}),response=function(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(!(conv=converters[prev+" "+current]||converters["* "+current]))for(conv2 in converters)if((tmp=conv2.split(" "))[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){!0===conv?conv=converters[conv2]:!0!==converters[conv2]&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(!0!==conv)if(conv&&s.throws)response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&((modified=jqXHR.getResponseHeader("Last-Modified"))&&(jQuery.lastModified[cacheURL]=modified),(modified=jqXHR.getResponseHeader("etag"))&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,isSuccess=!(error=response.error))):(error=statusText,!status&&statusText||(statusText="error",status<0&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(_statusCode),_statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,"script")}}),jQuery.each(["get","post"],(function(_i,method){jQuery[method]=function(url,data,callback,type){return isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}})),jQuery.ajaxPrefilter((function(s){var i;for(i in s.headers)"content-type"===i.toLowerCase()&&(s.contentType=s.headers[i]||"")})),jQuery._evalUrl=function(url,options,doc){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(response){jQuery.globalEval(response,options,doc)}})},jQuery.fn.extend({wrapAll:function(html){var wrap;return this[0]&&(isFunction(html)&&(html=html.call(this[0])),wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map((function(){for(var elem=this;elem.firstElementChild;)elem=elem.firstElementChild;return elem})).append(this)),this},wrapInner:function(html){return isFunction(html)?this.each((function(i){jQuery(this).wrapInner(html.call(this,i))})):this.each((function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)}))},wrap:function(html){var htmlIsFunction=isFunction(html);return this.each((function(i){jQuery(this).wrapAll(htmlIsFunction?html.call(this,i):html)}))},unwrap:function(selector){return this.parent(selector).not("body").each((function(){jQuery(this).replaceWith(this.childNodes)})),this}}),jQuery.expr.pseudos.hidden=function(elem){return!jQuery.expr.pseudos.visible(elem)},jQuery.expr.pseudos.visible=function(elem){return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)},jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport((function(options){var _callback2,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain)return{send:function(headers,complete){var i,xhr=options.xhr();if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];for(i in options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest"),headers)xhr.setRequestHeader(i,headers[i]);_callback2=function(type){return function(){_callback2&&(_callback2=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.ontimeout=xhr.onreadystatechange=null,"abort"===type?xhr.abort():"error"===type?"number"!=typeof xhr.status?complete(0,"error"):complete(xhr.status,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,"text"!==(xhr.responseType||"text")||"string"!=typeof xhr.responseText?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders()))}},xhr.onload=_callback2(),errorCallback=xhr.onerror=xhr.ontimeout=_callback2("error"),void 0!==xhr.onabort?xhr.onabort=errorCallback:xhr.onreadystatechange=function(){4===xhr.readyState&&window.setTimeout((function(){_callback2&&errorCallback()}))},_callback2=_callback2("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(_callback2)throw e}},abort:function(){_callback2&&_callback2()}}})),jQuery.ajaxPrefilter((function(s){s.crossDomain&&(s.contents.script=!1)})),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",(function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type="GET")})),jQuery.ajaxTransport("script",(function(s){var script,_callback3;if(s.crossDomain||s.scriptAttrs)return{send:function(_,complete){script=jQuery("<script>").attr(s.scriptAttrs||{}).prop({charset:s.scriptCharset,src:s.url}).on("load error",_callback3=function(evt){script.remove(),_callback3=null,evt&&complete("error"===evt.type?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){_callback3&&_callback3()}}}));var body,oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce.guid++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",(function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=!1!==s.jsonp&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||"jsonp"===s.dataTypes[0])return callbackName=s.jsonpCallback=isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):!1!==s.jsonp&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always((function(){void 0===overwritten?jQuery(window).removeProp(callbackName):window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0})),"script"})),support.createHTMLDocument=((body=document.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===body.childNodes.length),jQuery.parseHTML=function(data,context,keepScripts){return"string"!=typeof data?[]:("boolean"==typeof context&&(keepScripts=context,context=!1),context||(support.createHTMLDocument?((base=(context=document.implementation.createHTMLDocument("")).createElement("base")).href=document.location.href,context.head.appendChild(base)):context=document),scripts=!keepScripts&&[],(parsed=rsingleTag.exec(data))?[context.createElement(parsed[1])]:(parsed=buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes)));var base,parsed,scripts},jQuery.fn.load=function(url,params,callback){var selector,type,response,self=this,off=url.indexOf(" ");return off>-1&&(selector=stripAndCollapse(url.slice(off)),url=url.slice(0,off)),isFunction(params)?(callback=params,params=void 0):params&&"object"==typeof params&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done((function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)})).always(callback&&function(jqXHR,status){self.each((function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])}))}),this},jQuery.expr.pseudos.animated=function(elem){return jQuery.grep(jQuery.timers,(function(fn){return elem===fn.elem})).length},jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),("absolute"===position||"fixed"===position)&&(curCSSTop+curCSSLeft).indexOf("auto")>-1?(curTop=(curPosition=curElem.position()).top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),isFunction(options)&&(options=options.call(elem,i,jQuery.extend({},curOffset))),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):("number"==typeof props.top&&(props.top+="px"),"number"==typeof props.left&&(props.left+="px"),curElem.css(props))}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each((function(i){jQuery.offset.setOffset(this,options,i)}));var rect,win,elem=this[0];return elem?elem.getClientRects().length?(rect=elem.getBoundingClientRect(),win=elem.ownerDocument.defaultView,{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var offsetParent,offset,doc,elem=this[0],parentOffset={top:0,left:0};if("fixed"===jQuery.css(elem,"position"))offset=elem.getBoundingClientRect();else{for(offset=this.offset(),doc=elem.ownerDocument,offsetParent=elem.offsetParent||doc.documentElement;offsetParent&&(offsetParent===doc.body||offsetParent===doc.documentElement)&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.parentNode;offsetParent&&offsetParent!==elem&&1===offsetParent.nodeType&&((parentOffset=jQuery(offsetParent).offset()).top+=jQuery.css(offsetParent,"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent,"borderLeftWidth",!0))}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var offsetParent=this.offsetParent;offsetParent&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||documentElement}))}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,(function(elem,method,val){var win;if(isWindow(elem)?win=elem:9===elem.nodeType&&(win=elem.defaultView),void 0===val)return win?win[prop]:elem[method];win?win.scrollTo(top?win.pageXOffset:val,top?val:win.pageYOffset):elem[method]=val}),method,val,arguments.length)}})),jQuery.each(["top","left"],(function(_i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,(function(elem,computed){if(computed)return computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}))})),jQuery.each({Height:"height",Width:"width"},(function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},(function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(!0===margin||!0===value?"margin":"border");return access(this,(function(elem,type,value){var doc;return isWindow(elem)?0===funcName.indexOf("outer")?elem["inner"+name]:elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)}),type,chainable?margin:void 0,chainable)}}))})),jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(_i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}})),jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),jQuery.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(_i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}));var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;jQuery.proxy=function(fn,context){var tmp,args,proxy;if("string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),isFunction(fn))return args=_slice.call(arguments,2),(proxy=function(){return fn.apply(context||this,args.concat(_slice.call(arguments)))}).guid=fn.guid=fn.guid||jQuery.guid++,proxy},jQuery.holdReady=function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},jQuery.isArray=Array.isArray,jQuery.parseJSON=JSON.parse,jQuery.nodeName=nodeName,jQuery.isFunction=isFunction,jQuery.isWindow=isWindow,jQuery.camelCase=camelCase,jQuery.type=toType,jQuery.now=Date.now,jQuery.isNumeric=function(obj){var type=jQuery.type(obj);return("number"===type||"string"===type)&&!isNaN(obj-parseFloat(obj))},jQuery.trim=function(text){return null==text?"":(text+"").replace(rtrim,"")},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return jQuery}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__);var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},void 0===noGlobal&&(window.jQuery=window.$=jQuery),jQuery},"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)},function(module,exports){angular.module("rainbow").factory("ConferenceParticipant",[function(){function ConferenceParticipant(participantId,userId,jid_im,jid_tel,role,mute,held,confStartDate,startDate,phoneNumber,state,delegateCapability){this.participantId=participantId,this.userId=userId,this.jid_im=jid_im,this.jid_tel=jid_tel,this.role=role,this.mute=mute,this.held=held,this.confStartDate=confStartDate,this.startDate=startDate,this.phoneNumber=phoneNumber,this.state=state,this.delegateCapability=delegateCapability,this.updateFromData=function(data){data.participantId&&(this.participantId=data.participantId),data.userId&&(this.userId=data.userId),this.jid_im=data.jid_im,data.jid_tel&&(this.jid_tel=data.jid_tel),this.role=data.participantRole?data.participantRole:this.role,this.confStartDate=data.confStartDate?data.confStartDate:this.confStartDate,this.startDate=data.startDate?data.startDate:this.startDate,this.phoneNumber=data.phoneNumber?data.phoneNumber:this.phoneNumber,this.state=data.participantState?data.participantState:this.state,this.mute=data.mute,this.held=data.held,this.delegateCapability=data.delegateCapability}}return ConferenceParticipant.createFromData=function(data){return new ConferenceParticipant(data.participantId,data.userId,data.jid_im,data.jid_tel,data.participantRole,data.mute,data.held,data.confStartDate,data.startDate,data.phoneNumber,data.participantState,data.delegateCapability)},ConferenceParticipant}])},function(module,exports){var DirectoryContact=function(){function DirectoryContact(companyId,id,firstName,lastName,eMail,jobTitle,department,companyName,street,city,state,postalCode,country,workPhoneNumbers,mobilePhoneNumbers,otherPhoneNumbers,custom1,custom2,tags){_classCallCheck(this,DirectoryContact),companyId&&(this.companyId=companyId),id&&(this.id=id),firstName&&(this.firstName=firstName),lastName&&(this.lastName=lastName),eMail&&(this.eMail=eMail),jobTitle&&(this.jobTitle=jobTitle),department&&(this.department=department),companyName&&(this.companyName=companyName),street&&(this.street=street),city&&(this.city=city),state&&(this.state=state),postalCode&&(this.postalCode=postalCode),country&&(this.country=country),workPhoneNumbers&&(this.workPhoneNumbers=workPhoneNumbers),mobilePhoneNumbers&&(this.mobilePhoneNumbers=mobilePhoneNumbers),otherPhoneNumbers&&(this.otherPhoneNumbers=otherPhoneNumbers),custom1&&(this.custom1=custom1),custom2&&(this.custom2=custom2),tags&&(this.tags=tags)}return _createClass(DirectoryContact,null,[{key:"directoryContactFactory",value:function(){return function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new DirectoryContact(data.companyId,data.id,data.firstName,data.lastName,data.eMail,data.jobTitle,data.department,data.companyName,data.street,data.city,data.state,data.postalCode,data.country,data.workPhoneNumbers,data.mobilePhoneNumbers,data.otherPhoneNumbers,data.custom1,data.custom2,data.tags)}}}]),DirectoryContact}();angular.module("rainbow").factory("directoryContact",DirectoryContact.directoryContactFactory)},function(module,exports){angular.module("rainbowAdmin").factory("Offer",[function(){function Offer(id,name,description,groupName,offerReference,profileId,canBeSold,businessModel,isDefault,isExclusive,isPrepaid,prepaidDuration,autoSubscribe,hasConference,hasVoice,isDemo,isBundle,isChinaOffer){this.id=id,this.name=name||"",isDemo&&(this.name=this.name.replace(new RegExp("\\bDemo\\b"),"Custom")),this.description=description||"Rainbow "+this.name,this.groupName=hasConference?"Conference":groupName||name,this.offerReference=offerReference,this.profileId=profileId,this.canBeSold=canBeSold||!1,this.businessModel=businessModel,this.isDefault=isDefault,this.isExclusive=isExclusive,this.isPrepaid=isPrepaid,this.prepaidDuration=prepaidDuration,this.autoSubscribe=autoSubscribe,this.hasConference=hasConference,this.hasVoice=hasVoice,this.isDemo=void 0===isDemo?!this.isDefault&&!this.canBeSold&&this.name.toLowerCase().includes("custom"):isDemo,this.isBundle=isBundle,this.isChinaOffer=isChinaOffer,this.disallowUnsubscribeWithAllocatedLicences=this.hasVoice||"Room"===this.groupName,this.disallowAllocationToUsers="Room"===this.groupName,this.hasVoice?this.logo="logo-offer-voice.svg":this.hasConference?this.logo="logo-offer-conference.svg":this.logo=Offer.getLogoByName(this.name),this.isEnterprise=function(){return this.groupName.toLowerCase().includes("enterprise")},this.isBusiness=function(){return this.groupName.toLowerCase().includes("business")},this.isEssential=function(){return this.isDefault},this.isTrial=function(){return this.isDemo},this.isUserLicense=function(){return this.isDefault||"nb_users"===this.businessModel||"usage"===this.businessModel},this.isDeviceLicense=function(deviceType){return"TV"===deviceType&&"Room"===this.groupName},this.isFixedLicense=function(){return"flat_fee"===this.businessModel},this.isUserBasedLicense=function(){return"nb_users"===this.businessModel},this.isUsageBasedLicense=function(){return"usage"===this.businessModel}}return Offer.createFromData=function(data){return new Offer(data.id,data.name,data.description,data.groupName,data.offerReference,data.profileId,data.canBeSold,data.businessModel,data.isDefault,data.isExclusive,data.isPrepaid,data.prepaidDuration,data.autoSubscribe,data.hasConference,data.hasVoice,data.isDemo,data.isBundle,data.isChinaOffer)},Offer.createFromSubscriptionData=function(subscription){return new Offer(subscription.offerId,subscription.offerName,subscription.offerDescription,subscription.groupName,subscription.offerReference,subscription.profileId,subscription.canBeSold,subscription.businessModel,subscription.isDefault,subscription.isExclusive,subscription.isPrepaid,subscription.prepaidDuration,subscription.autoSubscribe,subscription.hasConference,subscription.hasVoice,subscription.isDemo,subscription.isBundle,subscription.isChinaOffer)},Offer.createFromSubscriptionCountersData=function(subscriptionCounters){return new Offer(subscriptionCounters.offerId,subscriptionCounters.offerName,void 0,subscriptionCounters.groupName,subscriptionCounters.offerReference,void 0,subscriptionCounters.canBeSold,subscriptionCounters.businessModel,subscriptionCounters.isDefault,subscriptionCounters.isExclusive,subscriptionCounters.isPrepaid,subscriptionCounters.prepaidDuration,void 0,subscriptionCounters.hasConference,subscriptionCounters.hasVoice,subscriptionCounters.isDemo,subscriptionCounters.isBundle)},Offer.createFromProfileData=function(profile){return new Offer(profile.offerId,profile.offerName,void 0,void 0,void 0,profile.profileId,!1,void 0,profile.isDefault,profile.isExclusive,profile.isPrepaid,profile.prepaidDuration,void 0,profile.hasConference,profile.hasVoice,profile.isDemo,profile.isBundle)},Offer.createFromOperationLog=function(operationLog){var data="delete"===operationLog.operationType?operationLog.previousData:operationLog.newData;return new Offer(data.offerId,data.offerName,data.offerDescription,void 0,data.offerReference,data.profileId,data.canBeSold,data.businessModel,data.isDefault,data.isExclusive,data.isPrepaid,data.prepaidDuration,void 0,data.hasConference,data.hasVoice,data.isDemo,data.isBundle)},Offer.getLogoByName=function(offerName){var logo="logo-offer-default.svg";if(offerName){var name=offerName.toLowerCase();-1!==name.indexOf("voice")?name="voice":-1!==name.indexOf("conference")?name="conference":-1!==name.indexOf("enterprise")?name="enterprise":-1!==name.indexOf("business")&&(name="business"),logo="logo-offer-"+name+".svg"}return logo},Offer.offerComparator=function(offer1,offer2){var offerOrder=["Essential","Business","Enterprise","Voice","Room","Conference"];if(offer1.isEssential())return-1;if(offer2.isEssential())return 1;if(offer1.isTrial()&&!offer2.isTrial())return-1;if(!offer1.isTrial()&&offer2.isTrial())return 1;if(offer1.canBeSold&&!offer2.canBeSold)return-1;if(!offer1.canBeSold&&offer2.canBeSold)return 1;if(offer1.hasConference&&!offer2.hasConference)return 1;if(!offer1.hasConference&&offer2.hasConference)return-1;var orderIndex1=offerOrder.findIndex((function(order){return offer1.name.startsWith(order)})),orderIndex2=offerOrder.findIndex((function(order){return offer2.name.startsWith(order)}));return(orderIndex1=-1===orderIndex1?offerOrder.length:orderIndex1)<(orderIndex2=-1===orderIndex2?offerOrder.length:orderIndex2)?-1:orderIndex1>orderIndex2?1:offer1.isTrial()?-1:offer2.isTrial()||offer1.isPrepaid&&!offer2.isPrepaid?1:!offer1.isPrepaid&&offer2.isPrepaid||offer1.name<offer2.name?-1:offer1.name>offer2.name?1:0},Offer.isExclusive=function(offer){return offer.isDefault||offer.isExclusive},Offer.isOptional=function(offer){return!Offer.isExclusive(offer)},Offer.isEssential=function(offer){return offer.isDefault},Offer.isNotEssential=function(offer){return!offer.isDefault},Offer.isModelByNbUsers=function(offer){return"nb_users"===offer.businessModel},Offer.isPrepaid=function(offer){return offer.isPrepaid},Offer.isNotPrepaid=function(offer){return!offer.isPrepaid},Offer.isUserLicense=function(offer){return offer.isUserLicense()},Offer.isUsageBasedLicense=function(offer){return offer.isUsageBasedLicense()},Offer}])},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),message_1=__webpack_require__(16),call_model_1=__webpack_require__(0),uuid4=__webpack_require__(27),contact_service_1=__webpack_require__(1);angular.module("rainbow").factory("Conversation",["$log","$rootScope",function($log,$rootScope){function Conversation(conversationId){var _this168=this;this.id=conversationId,this.dbId=null,this.type=null,this.owner=null,this.contact=null,this.room=null,this.capabilities=null,this.avatar=null,this.presenceStatus=null,this.name=function(){return{}},this.filterName="",this.missedCounter=0,this.missedCalls=0,this.messages=[],this.participantStatuses={},this.draft="",this.status=Conversation.Status.ACTIVE,this.historyIndex=-1,this.historyMessages=[],this.historyDefered=null,this.historyComplete=!1,this.lastModification=void 0,this.creationDate=new Date,this.lastMessageText="",this.lastMessageSender="",this.forwardFrom=null,this.forwardedMessage=null,this.replaceLastMsgId="",this.pip=!0,this.showVideoGallery=!0,this.videoCall={status:call_model_1.Call.Status.UNKNOWN},this.audioCall=null,this.pstnConferenceSession=null,this.webConferenceSession=null,this.isMutedAudio=!1,this.isMutedVideo=!1,this.infoVisible=!1,this.largeInfoVisible=!0,this.muted=!1,this.isFavorite=!1,this.lastEditableMsg=null,this.cacheMessages=[],this.rxSubject=new rxjs_1.Subject,this.innerHtml="",this.mentionedMembersArray=[],this.telephonyContacts=null,this.isFullScreenNoChat=!1,this.getMessageById=function(messId){var searchInCache=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(searchInCache){var foundMsg=_this168.cacheMessages.find((function(item){return item.id===messId}));if(foundMsg)return foundMsg}return _this168.messages.find((function(item){return item.id===messId}))},this.getMessageInCacheById=function(messId){return _this168.cacheMessages.find((function(item){return item.id===messId}))},this.getReplacedMessageById=function(msgId){var message=null;return _this168.messages.forEach((function(msg){message=msg.replaceMsgs.find((function(replaceMsg){return replaceMsg.id===msgId}))})),message},this.reset=function(){_this168.messages=[],_this168.historyIndex=-1,_this168.historyMessages=[],_this168.historyComplete=!1,_this168.currentHistoryId=null,_this168.lastMessageText=null,_this168.rxSubject.next({name:"appendMessage"})},this.subscribe=function(callback){return _this168.rxSubject.subscribe(callback)}}Conversation.ChatstatesNS="http://jabber.org/protocol/chatstates",Conversation.ReceiptNS="urn:xmpp:receipts",Conversation.contentNS="urn:xmpp:content",Conversation.AttentionNS="urn:xmpp:attention:0",Conversation.FORWARDNS="urn:xmpp:forward:0",Conversation.Type={ONE_TO_ONE:0,ROOM:1,BOT:2},Conversation.EventType={NEW:0,IM:1,CAPABILITIES:2,FILE:3},Conversation.Status={ACTIVE:{key:0,value:"active"},INACTIVE:{key:1,value:"inactive"},COMPOSING:{key:2,value:"composing"},PAUSED:{key:3,value:"paused"}},Conversation.createOneToOneConversation=function(participant){$log.info("[Conversation] Create one to one conversation ("+participant.id+")");var conversation=new Conversation(participant.id);return conversation.contact=participant,participant.conversation=conversation,participant.isBot?(conversation.avatar="",conversation.type=Conversation.Type.BOT,conversation.infoVisible=!0):(conversation.avatar=participant.avatar?participant.avatar.src:null,conversation.type=Conversation.Type.ONE_TO_ONE),conversation.name=participant.name,participant.displayName&&(conversation.filterName=participant.displayName.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"")),conversation},Conversation.createRoomConversation=function(room){$log.info("[Conversation] Create room conversation ("+room.jid+")");var conversation=new Conversation(room.jid);return conversation.type=Conversation.Type.ROOM,conversation.room=room,conversation.filterName=room.name.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""),conversation.infoVisible=!0,conversation};var randomBase=uuid4(),messageId=0;return Conversation.getUniqueMessageId=function(){var messageToSendID="web_"+randomBase+messageId;return messageId++,messageToSendID},Conversation.stringToStatus=function(status){switch(status){case"composing":return Conversation.Status.COMPOSING;case"paused":return Conversation.Status.PAUSED;default:return Conversation.Status.ACTIVE}},Conversation.prototype.setMissedCounter=function(missedCounter){this.missedCounter=missedCounter,this.rxSubject.next({name:"missedCounter",value:missedCounter})},Conversation.prototype.shortnameToUnicode=function(data){return emojione?emojione.shortnameToUnicode(data):data},Conversation.prototype.isInCall=function(){return this.pstnConferenceSession?this.pstnConferenceSession.isParticipantConnectedByJid(contact_service_1.default.userContact.jid):this.webConferenceSession?this.webConferenceSession.isParticipantConnectedByJid(contact_service_1.default.userContact.jid)&&this.webConferenceSession.haveJoined:this.videoCall&&this.videoCall.status&&"Unknown"!==this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"Unknown"!==this.audioCall.status.value&&"incommingCall"!==this.audioCall.status.value&&"queued"!==this.audioCall.status.value},Conversation.prototype.isNotInCall=function(){return!(this.videoCall&&this.videoCall.status&&"Unknown"!==this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"Unknown"!==this.audioCall.status.value||"busy"===contact_service_1.default.userContact.status&&""!==contact_service_1.default.userContact.message)},Conversation.prototype.isActive=function(){return this.videoCall&&this.videoCall.status&&"active"===this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"active"===this.audioCall.status.value},Conversation.prototype.isHeld=function(){return this.videoCall&&this.videoCall.status&&"held"===this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"held"===this.audioCall.status.value},Conversation.prototype.getMessageByIdInHistory=function(messId){return this.historyMessages.find((function(item){return item.id===messId}))},Conversation.prototype.addAdminBubbleMessage=function(from,date,type,messageID){if(this.getMessageById(messageID))return $log.info("[Conversation] "+this.id+" add addAdminBubbleMessage message ("+messageID+") already exists."),null;$log.info("[Conversation] "+this.id+" add addAdminBubbleMessage from "+from.jid+" : "+type);var data=type+"MsgRoom",side=message_1.Message.Side.ADMIN,message=message_1.Message.create(messageID,date,from,side,data,!1);return message.setReceiptStatus(message_1.Message.ReceiptStatus.SENT),this.addMessage(message)},Conversation.prototype.addFSMessage=function(fileId,data,status,attachedInfos){var geoLoc=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,urgency=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,attention=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,messageToSendID=Conversation.getUniqueMessageId(),unicodeData=this.shortnameToUnicode(data),date=new Date;$log.info("[Conversation] "+this.id+" add FILE SHARING message from me");var message=message_1.Message.createFileSharingMessage(messageToSendID,date,contact_service_1.default.userContact,"R",unicodeData,status,fileId,null,attachedInfos,geoLoc,attention);return message.urgency=urgency,message.setReceiptStatus(message_1.Message.ReceiptStatus.IN_PROGRESS),this.addMessage(message)},Conversation.prototype.addChatMessage=function(from,date,data,messageID,isSender,isMarkdown,subject,answeredMsgId,answeredMsgDate,additionalContent,alternativeContent,mentions,urgency){if(this.getMessageById(messageID))return $log.info("[Conversation] "+this.id+" add CHAT message ("+messageID+") already exists."),null;$log.info("[Conversation] "+this.id+" add CHAT message ("+messageID+") from "+from.jid);var side=contact_service_1.default.isUserContact(from)?"R":"L",message=message_1.Message.create(messageID,date,from,side,data,!1,isMarkdown,additionalContent,subject,answeredMsgId,answeredMsgDate,alternativeContent,mentions);return message.urgency=urgency,isSender?message.setReceiptStatus(message_1.Message.ReceiptStatus.IN_PROGRESS):message.setReceiptStatus(message_1.Message.ReceiptStatus.SENT),this.addMessage(message)},Conversation.prototype.addForwardChatMessage=function(from,date,messageID,forwardedMessage,origConv){if(this.getMessageById(messageID))return $log.info("[Conversation] "+this.id+" add CHAT message ("+messageID+") already exists."),null;$log.info("[Conversation] "+this.id+" add CHAT message ("+messageID+") from "+from.jid);var side=contact_service_1.default.isUserContact(from)?"R":"L",message=message_1.Message.create(messageID,date,from,side,"",!1,!1);message.setReceiptStatus(message_1.Message.ReceiptStatus.IN_PROGRESS),message.forwardedMsg=forwardedMessage,message.forwardConvType=origConv.type===Conversation.Type.ONE_TO_ONE?"chat":"groupchat",message.isForwarded=!0;var msgFwdOtherConv=message_1.Message.createFromMsg(message.forwardedMsg);return msgFwdOtherConv.id=messageID,msgFwdOtherConv.side=side,msgFwdOtherConv.date=date,msgFwdOtherConv.from=from,msgFwdOtherConv.isForwarded=!0,this.addMessage(msgFwdOtherConv),message},Conversation.prototype.addRecordingMessage=function(from,date,data,messageID){var message=message_1.Message.createRecordingAdminMessage(messageID,date,from,"ADMIN",data);return this.addMessage(message)},Conversation.prototype.addFileMessage=function(from,date,data,messageID){var urgency=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;$log.info("[Conversation] "+this.id+" add FILE message from "+from.jid+" : "+data);var side=contact_service_1.default.isUserContact(from)?"R":"L",message=message_1.Message.createFileMessage(messageID,date,from,side,data,!1);return message.urgency=urgency,this.addMessage(message)},Conversation.prototype.addFileSharingMessage=function(from,date,data,messageID,fileId,fileName,geoloc,urgency,isForwarded){var attention=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;$log.info("[Conversation] "+this.id+" add FILE SHARING message from "+from.jid+" : "+data);var side=contact_service_1.default.isUserContact(from)?"R":"L",message=message_1.Message.createFileSharingMessage(messageID,date,from,side,data,!1,fileId,fileName,null,geoloc,attention);return message.urgency=urgency,message.isForwarded=isForwarded,this.addMessage(message)},Conversation.prototype.addWebRTCMessage=function(from,date,data,messageID){if(this.getMessageById(messageID))return $log.info("[Conversation] "+this.id+" add addWebRTCMessage message ("+messageID+") already exists."),null;$log.info("[Conversation] "+this.id+" add WebRTC message from "+from.jid+" : "+data);var side=contact_service_1.default.isUserContact(from)?message_1.Message.Side.RIGHT:message_1.Message.Side.LEFT,message=message_1.Message.createWebRTCMessage(messageID,date,from,side,data,!1);return this.addMessage(message)},Conversation.prototype.updateMessage=function(message){message.sendUpdateEvent()},Conversation.prototype.addMessage=function(message){if(this.messages.find((function(item){return item.id===message.id})))return $log.info("[Conversation] "+this.id+" try to add an already stored message with id "+message.id),message;if(message.side===message_1.Message.Side.LEFT)message.type===message_1.Message.Type.WEBRTC&&(this.missedCalls+=1),this.setStatusMessage(message.from,Conversation.Status.ACTIVE);else{var oldEditableMsg=this.lastEditableMsg;this.lastEditableMsg=message,oldEditableMsg&&this.updateMessage(oldEditableMsg)}return this.messages.push(message),this.lastModification=new Date,this.lastMessageText=message.data,this.lastMessageSender=message.from.id,this.replaceLastMsgId=null,message.isForwarded?(this.forwardFrom=message.from.jid,this.forwardedMessage=message.data):(this.forwardFrom=null,this.forwardedMessage=null),this.rxSubject.next({name:"appendMessage",message:message}),$rootScope.$broadcast("ON_CONVERSATION_UPDATED_EVENT",this.id),message},Conversation.prototype.addMessageInHistoryMessages=function(message){if(message&&(this.historyMessages.push(message),message.side===message_1.Message.Side.RIGHT&&(!this.lastEditableMsg||message.date.getTime()>this.lastEditableMsg.date.getTime()))){var oldEditableMsg=this.lastEditableMsg;this.lastEditableMsg=message,oldEditableMsg&&this.updateMessage(oldEditableMsg)}},Conversation.prototype.addMessageInCacheMessages=function(message){message&&(this.getMessageInCacheById(message.id)||(this.cacheMessages.push(message),this.rxSubject.next({name:"cachedMessage",message:message})))},Conversation.prototype.removeMessage=function(message){var index=this.messages.lastIndexOf(message);-1!==index&&this.messages.splice(index,1)},Conversation.prototype.setStatusMessage=function(from,status){$log.info("[Conversation] "+this.id+" add status message from "+from.jid+" : "+status.value),this.participantStatuses[from.jid]=status,this.rxSubject.next({name:"status",value:status})},Conversation.prototype.ackReadAllSentMessages=function(){var _this169=this;this.messages.forEach((function(message){"R"!==message.side||message.receiptStatus!==message_1.Message.ReceiptStatus.SENT&&message.receiptStatus!==message_1.Message.ReceiptStatus.UNREAD||(message.setReceiptStatus(message_1.Message.ReceiptStatus.READ),_this169.updateMessage(message))}))},Conversation.prototype.ackReadAllReceivedMessages=function(){var _this170=this,result=!1;return this.messages.forEach((function(message){"R"===message.side||message.receiptStatus!==message_1.Message.ReceiptStatus.SENT&&message.receiptStatus!==message_1.Message.ReceiptStatus.UNREAD||(message.setReceiptStatus(message_1.Message.ReceiptStatus.READ),_this170.updateMessage(message),result=!0)})),result},Conversation.prototype.updateAfterReplaceEvent=function(message){var lastMsg=this.messages[this.messages.length-1];lastMsg&&lastMsg.id===message.id&&(this.lastModification=new Date,this.lastMessageText=message.getLastTextModified(),this.lastMessageSender=message.from.id,this.replaceLastMsgId=lastMsg.id,this.rxSubject.next({name:"replaceMessage",message:message}))},Conversation}])},function(module,exports,__webpack_require__){var _nodeId,_clockseq,rng=__webpack_require__(223),bytesToUuid=__webpack_require__(224),_lastMSecs=0,_lastNSecs=0;module.exports=function(options,buf,offset){var i=buf&&offset||0,b=buf||[],node=(options=options||{}).node||_nodeId,clockseq=void 0!==options.clockseq?options.clockseq:_clockseq;if(null==node||null==clockseq){var seedBytes=rng();null==node&&(node=_nodeId=[1|seedBytes[0],seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]),null==clockseq&&(clockseq=_clockseq=16383&(seedBytes[6]<<8|seedBytes[7]))}var msecs=void 0!==options.msecs?options.msecs:(new Date).getTime(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||msecs>_lastMSecs)&&void 0===options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq;var tl=(1e4*(268435455&(msecs+=122192928e5))+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var n=0;n<6;++n)b[i+n]=node[n];return buf||bytesToUuid(b)}},function(module,exports,__webpack_require__){var rng=__webpack_require__(223),bytesToUuid=__webpack_require__(224);module.exports=function(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"===options?new Array(16):null,options=null);var rnds=(options=options||{}).random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;++ii)buf[i+ii]=rnds[ii];return buf||bytesToUuid(rnds)}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.RBNotification=function(){return function _class10(date){_classCallCheck(this,_class10),this.date=date}}()},function(module,exports){angular.module("rainbow").factory("CallLog",[function(){function CallLog(id,contact,state,duration,type,read,date,direction,callSubject,isLatestCall){this.id=id,this.contact=contact,this.state=state,this.duration=duration,this.direction=direction,this.callSubject=callSubject,this.isLatestCall=isLatestCall,type="unknown"===type||"audio"===type||"webrtc"===type?CallLog.Type.WEBRTC:"telephone"===type?CallLog.Type.TELEPHONE:CallLog.Type.CONFERENCE,this.type=type,this.read=read,this.date=date,this.updateCallLogDisplayInfo=function(){"missed"===this.state&&"incoming"===this.direction?(this.svgId="call_missed",this.svgClass="missed",this.title="missedCall"):"missed"===this.state&&"outgoing"===this.direction?(this.svgId="call_missed-outgoing",this.svgClass="missed",this.title="noAnswer"):"incoming"===this.direction?(this.svgId="call_received",this.svgClass="active",this.title="incommingCall"):"outgoing"===this.direction&&(this.svgId="call_made",this.svgClass="active",this.title="outgoingCall")}}return CallLog.create=function(id,contact,state,duration,type,read,date,direction,callSubject,isLatestCall){return new CallLog(id,contact,state,duration,type,read,date,direction,callSubject,isLatestCall)},CallLog.getNames=function(callLog){var result={firstname:"",lastname:""};return callLog&&callLog.contact&&(result.firstname=callLog.contact.firstname?callLog.contact.firstname.toUpperCase():"",result.lastname=callLog.contact.lastname?callLog.contact.lastname.toUpperCase():"",callLog&&callLog.date&&(result.date=callLog.date.getTime())),result},CallLog.getDate=function(callLog){return callLog&&callLog.date?callLog.date.getTime():0},CallLog.sortByContact=function(callLogA,callLogB){var res=-1;if(callLogA&&callLogA.value.lastname&&callLogB&&callLogB.value.lastname){var str1=callLogA.value.lastname,str2=callLogB.value.lastname;0===(res=str1.localeCompare(str2))&&(str1=callLogA.value.firstname,str2=callLogB.value.firstname,0===(res=str1.localeCompare(str2))&&callLogB.value.date&&callLogA.value.date&&(res=callLogB.value.date-callLogA.value.date))}return res},CallLog.sortByDate=function(callLogA,callLogB){var res=1;return callLogA&&callLogB&&(res=callLogB.value-callLogA.value),res},CallLog.Type={WEBRTC:"webrtc",TELEPHONE:"telephone",CONFERENCE:"conference"},CallLog}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_0__);angular.module("rainbow").factory("VoiceMail",[function(){function VoiceMail(){this.VMFlag=!1,this.VMCounter=0,this.infoMsg="",this.voiceMailFeatureEnabled=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_0___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_0___default.a.FeaturesEnum.TELEPHONY_VOICE_MAIL),this.setVMFlag=function(flag){this.VMFlag=flag},this.getVMFlag=function(){return this.VMFlag},this.setVMCounter=function(ct){ct>0?(this.VMFlag=!0,this.VMCounter=ct):this.VMCounter=0},this.getVMCounter=function(){return this.VMCounter},this.setInfoMsg=function(msg){this.infoMsg=msg},this.getInfoMsg=function(){return this.infoMsg},this.getDisplayState=function(){return this.voiceMailFeatureEnabled}}return VoiceMail.create=function(){return new VoiceMail},VoiceMail}])},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Offer=function(){function Offer(id,name,isDefault,isExclusive,isPrepaid,hasConference,isDemo){_classCallCheck(this,Offer),this.id=null,this.name=null,this.isDefault=!1,this.isExclusive=!1,this.hasConference=!1,this.isPrepaid=!1,this.isDemo=!1,this.id=id,this.name=name||"",this.isDefault=isDefault,this.isExclusive=isExclusive,this.isPrepaid=isPrepaid,this.hasConference=hasConference,this.isDemo=isDemo}return _createClass(Offer,[{key:"isEnterprise",value:function(){return this.name.toLowerCase().startsWith("enterprise")}},{key:"isBusiness",value:function(){return this.name.toLowerCase().startsWith("business")}},{key:"isEssential",value:function(){return this.isDefault}}],[{key:"createFromProfileData",value:function(profile){return new Offer(profile.offerId,profile.offerName,profile.isDefault,profile.isExclusive,profile.isPrepaid,profile.hasConference,profile.isDemo)}},{key:"offerComparator",value:function(offer1,offer2){var offerOrder=["Essential","Business","Enterprise","Voice","Room","Conference"];if(offer1.isEssential())return-1;if(offer2.isEssential())return 1;if(offer1.isDemo&&!offer2.isDemo)return-1;if(!offer1.isDemo&&offer2.isDemo)return 1;if(offer1.hasConference&&!offer2.hasConference)return 1;if(!offer1.hasConference&&offer2.hasConference)return-1;var orderIndex1=offerOrder.findIndex((function(order){return offer1.name.startsWith(order)})),orderIndex2=offerOrder.findIndex((function(order){return offer2.name.startsWith(order)}));return(orderIndex1=-1===orderIndex1?offerOrder.length:orderIndex1)<(orderIndex2=-1===orderIndex2?offerOrder.length:orderIndex2)?-1:orderIndex1>orderIndex2?1:offer1.isDemo?-1:offer2.isDemo||offer1.isPrepaid&&!offer2.isPrepaid?1:!offer1.isPrepaid&&offer2.isPrepaid||offer1.name<offer2.name?-1:offer1.name>offer2.name?1:0}}]),Offer}();exports.Offer=Offer},function(module,exports){angular.module("rainbow").factory("Organisation",[function(){function Organisation(id,name,visibility){this.id=id,this.name=name,this.visibility=visibility,this.companies=[]}return Organisation.createFromData=function(data){return new Organisation(data.id,data.name,data.visibility)},Organisation}])},function(module,exports){angular.module("rainbowAdmin").factory("Bot",[function(){function Bot(jid,name,id,avatarId,lastAvatarUpdateDate,isBotAvatarCustomized){this.jid=jid,this.name=name,this.id=id,this.avatarId=avatarId||id,this.lastAvatarUpdateDate=lastAvatarUpdateDate,this.isAvatarCustomized=isBotAvatarCustomized}return Bot.create=function(data){return new Bot(data.jid,data.name,data.id,data.avatarId,data.lastAvatarUpdateDate,data.isBotAvatarCustomized)},Bot}])},function(module,exports){angular.module("rainbow").factory("Site",[function(){function Site(id,name,status,companyId,settings,isCentrex){this.id=id,this.name=name||"",this.status=status||"",this.companyId=companyId||"",this.settings=settings||"",angular.isDefined(isCentrex)&&(this.isCentrex=isCentrex)}return Site.createFromData=function(data){return new Site(data.id,data.name,data.status,data.companyId,data.settings,data.isCentrex)},Site.create=function(id,name,status,companyId){return new Site(id,name,status,companyId)},Site.StatusValues=["active","alerting","hold","terminated"],Site}])},function(module,exports){angular.module("rainbow").factory("System",[function(){function System(id,pbxId,jid_pbxagent,jid_password,pbxMainBundlePrefix,serverPingTimeout,type,status,version,siteId,country,name,jid_pbxagent_password,jid_pbxagent_password_activating,usePbxMainBundlePrefix,pbxNumberingTranslator,isCentrex,isShared,bpId,cloudpbx,hasMediaPillar,isOxoManaged,oxopbx,pbxNationalPrefix,pbxInternationalPrefix){this.id=id||null,this.type=type||null,this.type!==System.TypeEnum.CLOUD_PBX&&(this.jid_pbxagent=jid_pbxagent||"",this.jid_password=jid_password||"",this.jid_pbxagent_password=jid_pbxagent_password||"",this.jid_pbxagent_password_activating=jid_pbxagent_password_activating||"",this.pbxMainBundlePrefix=pbxMainBundlePrefix||["0"],this.usePbxMainBundlePrefix=!angular.isDefined(usePbxMainBundlePrefix)||usePbxMainBundlePrefix,this.pbxNumberingTranslator=pbxNumberingTranslator||[],this.pbxNationalPrefix=pbxNationalPrefix,this.pbxInternationalPrefix=pbxInternationalPrefix),this.country=country||"FRA",this.name=name||"",siteId&&(this.siteId=siteId),pbxId&&(this.pbxId=pbxId),serverPingTimeout&&(this.serverPingTimeout=serverPingTimeout),status&&(this.status=status),version&&(this.version=version),angular.isDefined(isCentrex)&&(this.isCentrex=isCentrex),angular.isDefined(isShared)&&(this.isShared=isShared),bpId&&(this.bpId=bpId),angular.isDefined(hasMediaPillar)&&(this.hasMediaPillar=hasMediaPillar),angular.isDefined(isOxoManaged)&&(this.isOxoManaged=isOxoManaged),cloudpbx?(cloudpbx.domainName&&(this.domainName=cloudpbx.domainName),cloudpbx.numberingDigits&&(this.numberingDigits=cloudpbx.numberingDigits),cloudpbx.numberingPrefix&&(this.numberingPrefix=cloudpbx.numberingPrefix),cloudpbx.outgoingPrefix&&(this.outgoingPrefix=cloudpbx.outgoingPrefix),cloudpbx.externalTrunkId&&(this.externalTrunkId=cloudpbx.externalTrunkId),cloudpbx.installationNumber&&(this.installationNumber=cloudpbx.installationNumber),cloudpbx.installationNumberId&&(this.installationNumberId=cloudpbx.installationNumberId),cloudpbx.language&&(this.language=cloudpbx.language),cloudpbx.customSipHeader_1&&(this.customSipHeader_1=cloudpbx.customSipHeader_1),cloudpbx.customSipHeader_2&&(this.customSipHeader_2=cloudpbx.customSipHeader_2),cloudpbx.overflowSubscribersToVoicemail&&(angular.isDefined(cloudpbx.overflowSubscribersToVoicemail.activate)&&(this.callOverflowToVMActivate=cloudpbx.overflowSubscribersToVoicemail.activate),cloudpbx.overflowSubscribersToVoicemail.noReplyDelay&&(this.callOverflowToVMNoReplyDelay=cloudpbx.overflowSubscribersToVoicemail.noReplyDelay)),cloudpbx.barringOptions&&(cloudpbx.barringOptions.permissions&&(this.barringOptionsPermission=cloudpbx.barringOptions.permissions),cloudpbx.barringOptions.restrictions&&(this.barringOptionsRestriction=cloudpbx.barringOptions.restrictions)),cloudpbx.cliOptions&&(this.cliOptions=cloudpbx.cliOptions),cloudpbx.emergencyOptions&&(this.emergencyOptions=cloudpbx.emergencyOptions),cloudpbx.callForwardOptions&&(this.callForwardOptions=cloudpbx.callForwardOptions),angular.isDefined(cloudpbx.allowCloudPbxRecording)&&(this.allowCloudPbxRecording=cloudpbx.allowCloudPbxRecording)):isOxoManaged&&oxopbx?(oxopbx.numberingDigits&&(this.numberingDigits=oxopbx.numberingDigits),oxopbx.numberingPrefix&&(this.numberingPrefix=oxopbx.numberingPrefix),oxopbx.outgoingPrefix&&(this.outgoingPrefix=oxopbx.outgoingPrefix),oxopbx.target&&(this.target=oxopbx.target),oxopbx.installationNumber&&(this.installationNumber=oxopbx.installationNumber),oxopbx.installationNumberId&&(this.installationNumberId=oxopbx.installationNumberId)):(this.numberingDigits=3,this.numberingPrefix="1"),this.isCallForwardAuthorized=function(){return this.callForwardOptions&&"authorized"===this.callForwardOptions.externalCallForward}}return System.createFromData=function(data){return new System(data.id,data.pbxId,data.jid_pbxagent,data.jid_password,data.pbxMainBundlePrefix,data.serverPingTimeout,data.type,data.status,data.version,data.siteId,data.country,data.name,data.jid_pbxagent_password,data.jid_pbxagent_password_activating,data.usePbxMainBundlePrefix,data.pbxNumberingTranslator,data.isCentrex,data.isShared,data.bpId,data.cloudpbx,data.hasMediaPillar,data.isOxoManaged,data.oxopbx,data.pbxNationalPrefix,data.pbxInternationalPrefix)},System.create=function(){return new System},System.TypeValues=["oxe","oxo","third_party","cloud_pbx","oxo_managed"],System.TypeEnum={OXE:"oxe",OXO:"oxo",THIRD_PARTY:"third_party",CLOUD_PBX:"cloud_pbx",OXO_MANAGED:"oxo_managed"},System.StatusValues=["created","activating","activated"],System.CliPolicy={USER_DDI_NUMBER:"user_ddi_number",INSTALLATION_DDI_NUMBER:"installation_ddi_number"},System.CliPolicyValues=[System.CliPolicy.USER_DDI_NUMBER,System.CliPolicy.INSTALLATION_DDI_NUMBER],System}]),angular.module("rainbow").filter("serverTypeFilter",[function(){return function(input){return"oxo"===input?"OXO Connect":"oxe"===input?"OmniPCX Enterprise":"third_party"===input?"Third party PBX":"cloud_pbx"===input?"Cloud PBX":"oxo_managed"===input?"Managed OXO Connect":input}}]),angular.module("rainbow").filter("systemStateFilter",[function(){return function(input){return"created"===input||"activating"===input?"pending":"activated"===input?"systemStatusActivated":"connected"===input?"systemStatusConnected":"disconnected"===input?"systemStatusDisonnected":"degraded"===input?"systemStatusDegraded":input}}]),angular.module("rainbow").filter("systemStateColorFilter",[function(){return function(input){return"created"===input||"activating"===input||"activated"===input?"color_blue":"connected"===input?"color_green":"disconnected"===input?"color_error":"degraded"===input?"color_warning":input}}]),angular.module("rainbow").filter("thirdPartySystemStateFilter",[function(){return function(input){return"created"===input||"activating"===input?"pending":"activated"===input?"systemStatusConnected":input}}]),angular.module("rainbow").filter("thirdPartySystemStateColorFilter",[function(){return function(input){return"created"===input||"activating"===input?"color_blue":"activated"===input?"color_green":input}}]),angular.module("rainbow").filter("cloudPbxStateFilter",[function(){return function(input){return"created"===input?"systemStatusConnected":"disconnected"===input?"systemStatusDisonnected":input}}]),angular.module("rainbow").filter("cloudPbxStateColorFilter",[function(){return function(input){return"created"===input?"color_green":"disconnected"===input?"color_error":input}}]),angular.module("rainbow").filter("gatewayStateFilter",[function(){return function(input){return"true"===input?"systemStatusConnected":"false"===input?"systemStatusDisonnected":input}}]),angular.module("rainbow").filter("gatewayStateColorFilter",[function(){return function(input){return"true"===input?"color_green":"false"===input?"color_error":"new_version"===input?"color_warning":input}}]),angular.module("rainbow").filter("cloudPbxBarringOptionPermissionFilter",[function(){return function(input){return"default"===input?"same_than_company":"local"===input?"intraPBXCallsOnly":"nat_local"===input?"nationalAndIntraPBXCalls":"int_nat_local"===input?"internationalNationalAndIntraPBXCalls":input}}]),angular.module("rainbow").filter("cloudPbxBarringOptionRestrictionFilter",[function(){return function(input){return"default"===input?"same_than_company":"no_restriction"===input?"none":"surcharged_numbers"===input?"surchargedNumbers":"custom_numbers"===input?"customizedProhibitedNumbers":input}}]),angular.module("rainbow").filter("cloudPbxCliPolicyFilter",[function(){return function(input){return"user_ddi_number"===input?"userDDINumber":"installation_ddi_number"===input?"companyPhoneNumber":"other_ddi_number"===input?"otherDDINumber":input}}]),angular.module("rainbow").filter("ivrStateFilter",[function(){return function(input){return"active"===input?"systemStatusActive":"unknown"}}]),angular.module("rainbow").filter("ivrStateClassFilter",[function(){return function(input){return"active"===input?"color_green":"color_error"}}])},function(module,exports){angular.module("rainbow").factory("SystemsGroup",[function(){function SystemsGroup(id,name,companies,systems){this.id=id||null,this.name=name,this.companies=companies||[],this.systems=systems,this.containsSystem=function(systemId){return!!this.systems&&this.systems.some((function(system){return system.systemId===systemId}))}}return SystemsGroup.createFromData=function(data){return new SystemsGroup(data.id,data.name,data.companies,data.systems)},SystemsGroup.create=function(id,name,companies,systems){return new SystemsGroup(id,name,companies,systems)},SystemsGroup}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(31),_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_0__);angular.module("rainbow").factory("User",["Subscription",function(Subscription){function User(data,noDefaultValues){var _this=this;User.attributes.forEach((function(attribute){data&&angular.isDefined(data[attribute.name])?_this[attribute.name]=data[attribute.name]:!noDefaultValues&&angular.isDefined(attribute.defaultValue)&&(_this[attribute.name]=attribute.defaultValue)})),this.subscriptions=[],this.updateFromData=function(newData){User.attributes.forEach((function(attribute){angular.isDefined(newData[attribute.name])&&(_this[attribute.name]=newData[attribute.name])}))},this.fillSubscriptionMap=function(){var subscriptionMap={};this.subscriptions.forEach((function(subscription){subscriptionMap[subscription.id]=subscription})),this.subscriptionMap=subscriptionMap},this.fillMainSubscriptionField=function(){var exclusiveSubscriptions=this.subscriptions.filter(Subscription.isExclusive).sort(Subscription.subscriptionComparator);exclusiveSubscriptions.length>0&&(this.mainSubscription=exclusiveSubscriptions[exclusiveSubscriptions.length-1],this.mainSubscriptionName=this.mainSubscription.offerName);var optionalSubscriptions=this.subscriptions.filter(Subscription.isOptional);optionalSubscriptions.length>0&&(this.optionalSubscriptionNames=optionalSubscriptions.map((function(optionalSubscription){return optionalSubscription.offerName})).join(", ")),this.subscriptionNames=this.mainSubscriptionName+(this.optionalSubscriptionNames?", "+this.optionalSubscriptionNames:"")},this.getMainSubscription=function(){return this.mainSubscription||this.fillMainSubscriptionField(),this.mainSubscription},this.getOptionalSubscriptions=function(){return this.subscriptions.filter(Subscription.isOptional)},this.getMainSubscriptionName=function(){return this.mainSubscriptionName||this.fillMainSubscriptionField(),this.mainSubscriptionName},this.getOptionalSubscriptionNames=function(){return this.mainSubscriptionName||this.fillMainSubscriptionField(),this.optionalSubscriptionNames},this.hasUserRoleOnly=function(){return 1===this.roles.length&&-1!==this.roles.indexOf(User.RoleValues.USER)},this.isGuest=function(){return-1!==this.roles.indexOf(User.RoleValues.GUEST)||this.guestMode},this.isAdmin=function(){return-1!==this.roles.indexOf(User.RoleValues.ADMIN)},this.isOrganizationAdmin=function(){return!!this.isAdmin()&&"organization_admin"===this.adminType},this.isSiteAdmin=function(){return!!this.isAdmin()&&"site_admin"===this.adminType},this.isCompanyAdmin=function(){return!!this.isAdmin()&&"company_admin"===this.adminType},this.isBPAdmin=function(){return this.isBPAdminOperations()||this.isBPAdminFinance()},this.isBPAdminOperations=function(){return-1!==this.roles.indexOf(User.RoleValues.BP_ADMIN_OPERATIONS)},this.isBPAdminFinance=function(){return-1!==this.roles.indexOf(User.RoleValues.BP_ADMIN_FINANCE)},this.isSuperadmin=function(){return-1!==this.roles.indexOf(User.RoleValues.SUPERADMIN)},this.isBusinessAdmin=function(){return-1!==this.roles.indexOf(User.RoleValues.BUSINESS_ADMIN)},this.isPublicChannelsAdmin=function(){return-1!==this.roles.indexOf(User.RoleValues.PUBLIC_CHANNELS_ADMIN)},this.isAllCompanyChannelsAdmin=function(){return-1!==this.roles.indexOf(User.RoleValues.ALL_COMPANY_CHANNELS_ADMIN)},this.isClosedChannelsAdmin=function(){return-1!==this.roles.indexOf(User.RoleValues.CLOSED_CHANNELS_ADMIN)},this.isDirectoryAdmin=function(){return-1!==this.roles.indexOf(User.RoleValues.DIRECTORY_ADMIN)},this.isRainbowTv=function(){return this.isTv||-1!==this.roles.indexOf(User.RoleValues.TV)},this.computeDisplayName=function(){var nameInfo=_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_0___default.a.getNameInformation(this.firstName,this.lastName);this.displayName=nameInfo.displayName,this.initials=nameInfo.initials},this.getPhoneNumbers=function(type,deviceType){return this.phoneNumbers?this.phoneNumbers.filter((function(phoneNumber){return phoneNumber.type===type&&phoneNumber.deviceType===deviceType})):[]},this.getSystemPhoneNumber=function(){return this.phoneNumbers?this.phoneNumbers.find((function(phoneNumber){return angular.isDefined(phoneNumber.systemId)&&phoneNumber.isFromSystem})):void 0},this.isRvcpSubscriber=function(){var userSystemPhoneNumber=this.getSystemPhoneNumber();return userSystemPhoneNumber&&"RVCP Subscriber"===userSystemPhoneNumber.deviceName},this.isOxoSubscriber=function(){return this.getSystemPhoneNumber()},this.getActivePhoneNumber=function(type,deviceType){var filteredPhoneNumbers=this.getPhoneNumbers(type,deviceType);if(filteredPhoneNumbers.length>1){var systemPhoneNumber=filteredPhoneNumbers.find((function(phoneNumber){return angular.isDefined(phoneNumber.systemId)}));if(systemPhoneNumber)return systemPhoneNumber}return filteredPhoneNumbers[0]},this.getDdiPhoneNumber=function(type,deviceType){var filteredPhoneNumbers=this.getPhoneNumbers(type,deviceType);if(filteredPhoneNumbers.length>1){var ddiPhoneNumber=filteredPhoneNumbers.find((function(phoneNumber){return phoneNumber.isCloudPbxDDI||phoneNumber.isOxoPbxDDI}));if(ddiPhoneNumber||(ddiPhoneNumber=filteredPhoneNumbers.find((function(phoneNumber){return phoneNumber.isFromSystem}))),ddiPhoneNumber)return ddiPhoneNumber}return filteredPhoneNumbers[0]}}return User.createFromData=function(data,noDefaultValues){data&&data.roles&&data.roles.includes("private_channels_admin")&&data.roles.splice(data.roles.indexOf("private_channels_admin"),1,User.RoleValues.ALL_COMPANY_CHANNELS_ADMIN);var user=new User(data,noDefaultValues);return data.profiles&&(data.profiles.forEach((function(subscriptionData){var subscription=Subscription.createFromData(subscriptionData);subscription.isTerminated()||user.subscriptions.push(subscription)})),user.fillMainSubscriptionField()),user.computeDisplayName(),user},User.create=function(){return new User},User.prune=function(data,userContact){var dataCopy=Object.assign({},data);return"RAINBOW"===dataCopy.authenticationType&&delete dataCopy.authenticationExternalUid,dataCopy},User.VisibilityValues=["same_than_company","public","private"],User.PermissionValues=["same_than_company","enabled","disabled"],User.VmOverflowValues=["default","custom","disabled"],User.CliPolicy={COMPANY_POLICY:"company_policy",USER_DDI_NUMBER:"user_ddi_number",INSTALLATION_DDI_NUMBER:"installation_ddi_number",OTHER_DDI_NUMBER:"other_ddi_number"},User.CliPolicyValues=[User.CliPolicy.COMPANY_POLICY,User.CliPolicy.USER_DDI_NUMBER,User.CliPolicy.INSTALLATION_DDI_NUMBER,User.CliPolicy.OTHER_DDI_NUMBER],User.RoleValues={USER:"user",GUEST:"guest",SUPERADMIN:"superadmin",SUPPORT:"support",BUSINESS_ADMIN:"business_admin",ADMIN:"admin",BP_ADMIN_OPERATIONS:"bp_admin",BP_ADMIN_FINANCE:"bp_finance",DIRECTORY_ADMIN:"directory_admin",PUBLIC_CHANNELS_ADMIN:"public_channels_admin",ALL_COMPANY_CHANNELS_ADMIN:"all_company_channels_admin",CLOSED_CHANNELS_ADMIN:"closed_channels_admin",TV:"tv"},User.LoginPolicies=[{value:"RAINBOW",label:"rainbowLoginCredentials"},{value:"SAML",label:"ssoLoginCredentialsSAML",isSSO:!0},{value:"OIDC",label:"ssoLoginCredentialsOIDC",isSSO:!0},{value:"DEFAULT",label:"defaultLogin"}],User.attributes=[{name:"id",defaultValue:null},{name:"loginEmail",defaultValue:""},{name:"firstName",defaultValue:""},{name:"lastName",defaultValue:""},{name:"displayName",defaultValue:""},{name:"nickName",defaultValue:""},{name:"title",defaultValue:""},{name:"jobTitle",defaultValue:""},{name:"department",defaultValue:""},{name:"companyId",defaultValue:""},{name:"companyName",defaultValue:""},{name:"siteId",defaultValue:""},{name:"systemId",defaultValue:""},{name:"accountType",defaultValue:"free"},{name:"country",defaultValue:"FRA"},{name:"timezone",defaultValue:"Europe/Paris"},{name:"emails",defaultValue:[]},{name:"phoneNumbers",defaultValue:[]},{name:"roles",defaultValue:["user"]},{name:"adminType",defaultValue:"company_admin"},{name:"isActive",defaultValue:!1},{name:"isInitialized",defaultValue:!1},{name:"isTerminated",defaultValue:void 0},{name:"isTv",defaultValue:void 0},{name:"password",defaultValue:void 0},{name:"jid_im",defaultValue:""},{name:"jid_tel",defaultValue:""},{name:"language",defaultValue:"en"},{name:"lastAvatarUpdateDate",defaultValue:null},{name:"visibility",defaultValue:void 0},{name:"authenticationType",defaultValue:void 0},{name:"authenticationExternalUid",defaultValue:void 0},{name:"tags",defaultValue:void 0},{name:"userInfo1",defaultValue:void 0},{name:"userInfo2",defaultValue:void 0},{name:"tryNewUiCustomisation",defaultValue:void 0},{name:"softphoneOnlyCustomisation",defaultValue:void 0},{name:"fileSharingCustomisation",defaultValue:void 0},{name:"userTitleNameCustomisation",defaultValue:void 0},{name:"useRoomCustomisation",defaultValue:void 0},{name:"phoneMeetingCustomisation",defaultValue:void 0},{name:"useChannelCustomisation",defaultValue:void 0},{name:"useWebRTCVideoCustomisation",defaultValue:void 0},{name:"useWebRTCAudioCustomisation",defaultValue:void 0},{name:"instantMessagesCustomisation",defaultValue:void 0},{name:"userProfileCustomisation",defaultValue:void 0},{name:"fileStorageCustomisation",defaultValue:void 0},{name:"overridePresenceCustomisation",defaultValue:void 0},{name:"changeSettingsCustomisation",defaultValue:void 0},{name:"changeTelephonyCustomisation",defaultValue:void 0},{name:"recordingConversationCustomisation",defaultValue:void 0},{name:"useGifCustomisation",defaultValue:void 0},{name:"useDialOutCustomisation",defaultValue:void 0},{name:"selectedAppCustomisationTemplate",defaultValue:void 0},{name:"guestMode",defaultValue:void 0},{name:"lastLoginDate",defaultValue:void 0}],User}]),angular.module("rainbow").filter("genericPermissionLabelFilter",[function(){return function(input){return"same_than_company"===input?"same_than_company":"enabled"===input?"authorized":"disabled"===input?"notAuthorized":input}}]),angular.module("rainbow").filter("phoneVmOverflowLabelFilter",[function(){return function(input){return"default"===input?"same_than_company":"custom"===input?"yes":"disabled"===input?"no":input}}]),angular.module("rainbow").filter("cloudPbxSubscriberCliPolicyFilter",[function(){return function(input){return"company_policy"===input?"same_than_company":"user_ddi_number"===input?"userDDINumber":"installation_ddi_number"===input?"companyPhoneNumber":"other_ddi_number"===input?"otherDDINumber":input}}]),angular.module("rainbow").filter("softphoneOnlyPermissionLabelFilter",[function(){return function(input){return input&&"same_than_company"!==input?"enabled"===input?"softphoneOnly":"disabled"===input?"allServices":input:"same_than_company"}}])},function(module,exports){angular.module("rainbow").factory("Subscription",["Offer",function(Offer){function Subscription(id,offerId,offerName,offerDescription,groupName,offerReference,profileId,profileName,maxNumberUsers,numberAssignedUsers,status,syncOngoing,updatingMaxNumberUsers,nbBPLicences,nbAssignedBPUsers,nbLicencesAssignedToECs,nbLicencesUsed,nbFreeLicences,businessModel,canBeSold,isDefault,isExclusive,isPrepaid,prepaidDuration,expirationDate,autoRenew,renewalTermOption,prepaidRenewalOption,hasConference,hasVoice,isDemo,isChinaOffer){this.id=id,this.name=offerName,this.offerId=offerId,this.offerName=offerName||"",isDemo&&(this.offerName=this.offerName.replace(new RegExp("\\bDemo\\b"),"Custom")),this.offerDescription=offerDescription||"Rainbow "+this.offerName,this.groupName=groupName||offerName,this.offerReference=offerReference,this.profileId=profileId,this.profileName=profileName,this.maxNumberUsers=maxNumberUsers,this.numberAssignedUsers=numberAssignedUsers,this.status=status,this.syncOngoing=syncOngoing||!1,this.updatingMaxNumberUsers=updatingMaxNumberUsers,void 0!==nbBPLicences&&(this.nbBPLicences=nbBPLicences),void 0!==nbAssignedBPUsers&&(this.nbAssignedBPUsers=nbAssignedBPUsers),void 0!==nbLicencesAssignedToECs&&(this.nbLicencesAssignedToECs=nbLicencesAssignedToECs),void 0!==nbLicencesUsed&&(this.nbLicencesUsed=nbLicencesUsed),void 0!==nbFreeLicences&&(this.nbFreeLicences=nbFreeLicences),this.businessModel=businessModel,this.canBeSold=canBeSold,this.isDefault=isDefault,this.isExclusive=isExclusive,this.isPrepaid=isPrepaid,this.prepaidDuration=prepaidDuration,this.expirationDate=expirationDate,this.autoRenew=autoRenew,this.renewalTermOption=renewalTermOption,this.prepaidRenewalOption=prepaidRenewalOption,this.hasConference=hasConference,this.hasVoice=hasVoice,this.isDemo=void 0===isDemo?!this.isDefault&&!this.canBeSold&&this.offerName.toLowerCase().includes("custom"):isDemo,this.isChinaOffer=isChinaOffer,this.isEnterprise=function(){return this.groupName.toLowerCase().includes("enterprise")},this.isBusiness=function(){return this.groupName.toLowerCase().includes("business")},this.isEssential=function(){return this.isDefault},this.isTrial=function(){return this.isDemo},this.isTerminated=function(){return"terminated"===this.status},this.isTerminating=function(){return"terminating"===this.status},this.isUserLicense=function(){return this.isDefault||"nb_users"===this.businessModel||"usage"===this.businessModel}}return Subscription.createFromData=function(data){return new Subscription(data.id?data.id:data.subscriptionId,data.offerId,data.offerName,data.offerDescription,data.groupName,data.offerReference,data.profileId,data.profileName,data.maxNumberUsers,data.numberAssignedUsers,data.status,data.syncOngoing,data.updatingMaxNumberUsers,data.nbBPLicences,data.nbAssignedBPUsers,data.nbLicencesAssignedToECs,data.nbLicencesUsed,data.nbFreeLicences,data.businessModel,data.canBeSold,data.isDefault,data.isExclusive,data.isPrepaid,data.prepaidDuration,data.expirationDate,data.autoRenew,data.renewalTermOption,data.prepaidRenewalOption,data.hasConference,data.hasVoice,data.isDemo,data.isChinaOffer)},Subscription.PrepaidRenewalOptions={RENEW_BILLED:"billed",RENEW_ALLOCATED:"allocated"},Subscription.subscriptionComparator=function(subscription1,subscription2){var offer1=new Offer(subscription1.offerId,subscription1.offerName,subscription1.offerDescription,subscription1.groupName,subscription1.offerReference,subscription1.profileId,subscription1.canBeSold,subscription1.businessModel,subscription1.isDefault,subscription1.isExclusive,subscription1.isPrepaid,subscription1.prepaidDuration,subscription1.autoSubscribe,subscription1.hasConference,subscription1.hasVoice,subscription1.isDemo,subscription1.isBundle,subscription1.isChinaOffer),offer2=new Offer(subscription2.offerId,subscription2.offerName,subscription2.offerDescription,subscription2.groupName,subscription2.offerReference,subscription2.profileId,subscription2.canBeSold,subscription2.businessModel,subscription2.isDefault,subscription2.isExclusive,subscription2.isPrepaid,subscription2.prepaidDuration,subscription2.autoSubscribe,subscription2.hasConference,subscription2.hasVoice,subscription2.isDemo,subscription2.isBundle,subscription2.isChinaOffer);return Offer.offerComparator(offer1,offer2)},Subscription.isUserLicense=function(subscription){return subscription.isDefault||"nb_users"===subscription.businessModel||"usage"===subscription.businessModel},Subscription.isTvLicense=function(subscription){return"Room"===subscription.groupName},Subscription.excludeTvLicense=function(subscription){return!Subscription.isTvLicense(subscription)},Subscription.isExclusive=function(subscription){return subscription.isDefault||subscription.isExclusive},Subscription.isOptional=function(subscription){return!Subscription.isExclusive(subscription)},Subscription.isConference=function(subscription){return Subscription.isOptional(subscription)&&(subscription.hasConference||"usage"===subscription.businessModel)},Subscription.isNotConference=function(subscription){return Subscription.isOptional(subscription)&&!(subscription.hasConference||"usage"===subscription.businessModel)},Subscription.withLicenses=function(subscription){return subscription.isDefault||"usage"===subscription.businessModel||"nb_users"===subscription.businessModel&&subscription.maxNumberUsers>0},Subscription.isPrepaid=function(subscription){return subscription.isPrepaid},Subscription.isMonthly=function(subscription){return!subscription.isPrepaid},Subscription}])},function(module,exports){angular.module("rainbow").factory("IceServer",[function(){function IceServer(id,urls,username,credential){this.id=id,this.urls=urls,this.username=username,this.credential=credential}return IceServer.createFromData=function(data){return new IceServer(data.id,data.urls,data.username,data.credential)},IceServer}])},function(module,exports){angular.module("rainbow").factory("PhoneNumber",[function(){function PhoneNumber(id,shortNumber,number,numberE164,pbxUserId,userId,type,deviceType,pbxId,isFromSystem,isMonitored,systemId,country,voiceMailNumber,deviceName,firstName,lastName,internalNumber,isCloudPbxDDI,isCloudPbxDefault,password,isOxoPbxDDI,isOxoPbxDefault,userDisplayName,overflowToVoicemail,barringOptions,isRecordingActivated){this.id=id,this.shortNumber=shortNumber,this.number=number,this.numberE164=numberE164,this.pbxUserId=pbxUserId,this.userId=userId,this.type=type,this.deviceType=deviceType,this.pbxId=pbxId,this.isFromSystem=isFromSystem,this.isMonitored=isMonitored,this.systemId=systemId,this.country=country,this.voiceMailNumber=voiceMailNumber,this.deviceName=deviceName,this.firstName=firstName,this.lastName=lastName,this.internalNumber=internalNumber,angular.isDefined(isCloudPbxDDI)&&(this.isCloudPbxDDI=isCloudPbxDDI),angular.isDefined(isCloudPbxDefault)&&(this.isCloudPbxDefault=isCloudPbxDefault),password&&(this.password=password),userDisplayName&&(this.userDisplayName=userDisplayName),angular.isDefined(isOxoPbxDDI)&&(this.isOxoPbxDDI=isOxoPbxDDI,this.isCloudPbxDDI=isOxoPbxDDI),angular.isDefined(isOxoPbxDefault)&&(this.isOxoPbxDefault=isOxoPbxDefault,this.isCloudPbxDefault=isOxoPbxDefault),overflowToVoicemail&&(this.overflowToVoicemail=overflowToVoicemail),barringOptions&&(this.barringOptions=barringOptions),angular.isDefined(isRecordingActivated)&&(this.isRecordingActivated=isRecordingActivated)}return PhoneNumber.SelectTypeEnum={EXTENSION:"extension",EXTENSION_CLOUD:"extension-cloud",GROUP_CLOUD:"group-cloud",DDI_CLOUD:"ddi-cloud",FREE_DDI_CLOUD:"free-ddi-cloud",FREE_DDI_GROUP_CLOUD:"free-ddi-group-cloud"},PhoneNumber.createFromData=function(data){return new PhoneNumber(data.id?data.id:data.phoneNumberId,data.shortNumber,data.number,data.numberE164,data.pbxUserId,data.userId,data.type,data.deviceType,data.pbxId,data.isFromSystem,data.isMonitored,data.systemId,data.country,data.voiceMailNumber,data.deviceName,data.firstName,data.lastName,data.internalNumber,data.isCloudPbxDDI,data.isCloudPbxDefault,data.password,data.isOxoPbxDDI,data.isOxoPbxDefault,data.userDisplayName,data.overflowToVoicemail,data.barringOptions,data.isRecordingActivated)},PhoneNumber}])},function(module,exports){angular.module("rainbow").service("helpersService",[function(){this.chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",this.findIndex=function(array,predicate){return array.findIndex(predicate)},this.checkBrowser=function(browser){return-1!==navigator.userAgent.indexOf(browser)},this.randomString=function(length){length=length||10;for(var rnd,string="";length>0;)rnd=Math.floor(Math.random()*this.chars.length),string+=this.chars.charAt(rnd),length--;return string}}])},function(module,exports){angular.module("rainbow").service("errorHelperService",["$filter",function($filter){var service=this;service.ErrorCodeLabels={"-1":"unknownError",0:"errorNoServerResponse",400:"Bad request",4e5:"Bad request",400210:"invalidPhoneNumber",400400:"errorWrongPassword",400500:"invalidFile",400504:"companyNameAlreadyExist",400505:"BPCompanyWithoutPaymentConfigurationData",400506:"NoActiveSubscriptionToOffer",400509:"errorDecreaseSubscriptionForbidden",400511:"ActiveDirectoryDomainAlreadyUsed",400552:"BPCompanyAndECCompanyMustNotBeSame",400601:"outboundAndInternalPrefixesCantBeIdentical",400973:"noCreateUserPermission",400975:"userAlreadyExistsInOtherCompany",400983:"userAlreadyExistsInOtherCompany",400990:"noUserFound",400993:"noUserFound",401:"Authorization failure",401102:"Authorization failure",401202:"errorInvalidToken",401500:"errorUnauthorized",401501:"errorLoginForbidden",401510:"errorUnauthorized",401520:"errorUserNotActive",401521:"errorUserNotActive",403:"Forbidden",403e3:"accessDeniedNotRequiredRole",403001:"accessDeniedNotOwner",403034:"cantDeselectDefaultWebRTCGateway",403035:"cantDeleteDefaultWebRTCGateway",403060:"confLockMsg",403072:"errorIsoMd5Mismatch",403153:"notAllowedToAccessMeeting",403154:"notAllowedToAccessMeeting",403200:"notAllowedToChangeRole",403203:"notAllowedToChangeRole",403204:"notAllowedToMoveExistingUserToThisCompany",403205:"notAllowedToManageUser",403301:"notAllowedToManageCompany",403304:"notAllowedToAddAnotherAdmin",403311:"errorRemoveSyncOngoingSubscriptionForbidden",403315:"errorRemoveSubscriptionForbidden",403316:"errorRemoveAdminAllocatedSubscriptionForbidden",403317:"errorRemoveClientAllocatedSubscriptionForbidden",403400:"notAllowedDeleteAppOwner",403500:"notAllowedBlacklistedEmail",403501:"notAllowedBlacklistedEmail",403503:"NotAllowedSelfRegistrationEmail",403504:"notAllowedLoggedInUserEmail",403507:"notAllowedSupportEmail",403513:"companyNotABpCompany",403516:"companyNotABpCompany",403517:"companySeenAsTerminated",403518:"companyBpTypeIncompatible",403519:"companyAlreadyLinkedToBp",403520:"companyNotVadBp",403526:"isolatedUser",403531:"resetPasswordBlocked",403532:"resetPasswordForbidden",403608:"errorAssignSubscriptionSyncOngoing",403609:"errorAssignSubscriptionSyncOngoing",403610:"maxSubscriptionAllocationReached",403611:"notAllowedToCreateAnEquipment",403615:"maximumNumberConferenceParticipantsReach",403616:"subscriptionCompanyAdminEssentialAlreadyExists",403617:"roleCompanyAdminEssentialAlreadyExists",403620:"MaximumNumberRoomUsersReach",403621:"MaximumNumberConvUsersReach",403624:"notAllowedRemoveService",403625:"errorAllocatedSubscriptionRemoveForbidden",403626:"restrictedConvAccess",403630:"uploadErrorMaxQuotaReached",403655:"userAlreadyCompanyMember",403670:"errorOperationForbiddenOnGuest",403700:"errorDeleteSiteWithSystems",403701:"errorDeleteOrganisationLinkedCompany",403702:"errorDeleteCompanyWithSubscriptions",403703:"errorDeleteCompanyWithSites",403704:"errorDeleteCompanyWithUsers",403705:"errorDeleteCompanyStillTerminated",403706:"errorRemoveBusinessPartnerRole",403719:"externalTrunkChangeForbidden",403721:"numberingPlanCantBeUpdated",403722:"outgoingPrefixChangeForbidden",403723:"cannotRemoveCompanyPublicNumber",403724:"notAllowedDeleteCloudPbxWithPublicNumbers",403725:"notAllowedDeleteCloudPbxWithUsedExtensions",404:"resourceNotFound",404e3:"resourceNotFound",404001:"resourceNotFoundUpdateImpossible",404002:"resourceNotFoundDeleteImpossible",404116:"archivedOrDeletedConversation",404300:"noValidOfferReferenceInACTISFile",404301:"offerNotFound",409e3:"userAlreadyCreated",409005:"inviteUsersError",409008:"emptyVoiceMessage",409011:"noMessagesToExport",409251:"DDIAlreadyAssociatedToCompany",409552:"internalNumberAlreadyUsed",409555:"publicNumberAlreadyExists",409557:"notAllowedDeleteUserAssociatedToCloudPbx",409600:"userAlreadyExist",409601:"invitationReSentConflict",409602:"userAlreadyNetworkMember",409603:"invitationReSentConflict",409620:"offerAlreadySubscribed",409623:"conferenceOfferAlreadySubscribed",409625:"errorUpdateSyncOngoingSubscriptionForbidden",409800:"companyNotIrBp",409801:"companyNotLinkedToBp",409802:"actisCompanyAdminMismatch",409803:"actisCompanyNameMismatch",413e3:"uploadErrorTooLarge",500:"errorInternalServerError",1001:"extensionNotLinkedToEquipment",1002:"extensionHasNoIdentifier",1003:"extensionDoesNotExist",1004:"extensionLookupFailure",1005:"extensionConflict",1006:"nonUniqueEquipmentForExtension",1007:"userAlreadyAssociatedToExtension",1008:"extensionAssociatedToAnotherUser",1009:"failedToAttachExtension",1010:"userHasNoExtension",1011:"userHasTooManyExtensions",1012:"failedToDetachExtension"},service.portalErrorCodeLabels={massprovisioning:{4e5:"invalidValue",400501:"invalidFile",400502:"invalidColumnName",400504:"invalidFile",400506:"invalidValueInActionColumn",400600:"deviceTypeCannotBeUpdated",400601:"duplicateDeviceIds",400602:"duplicateMacAdresses",400603:"invalidDeviceTypes",400604:"missingDeviceTypeInLines",400605:"invalidEquipment",403610:"errorMaxSubscriptionReached",404600:"deviceDoesNotExist",404601:"noCloudPbxInCompany"},rvcpprovisioning:{403e3:"overflowConfigurationChangesStillInProgress",403622:"noVoiceLicenceAllocatedToUser",403694:"forbiddenOperationEquipmentHasGroups",403699:"forbiddenOperationEquipmentHasWelcomeService",403728:"forbiddenOperationEquipmentHasDevices",409556:"companyHasAlreadyACloudPbx",409560:"macAddressAlreadyUsed",409561:"deviceStillUsedByUser",409562:"deviceAlreadyUsed",409563:"deviceAlreadyUsedByAnotherSystem",403739:"forbiddenOperationWelcomeServiceUsed",413e3:"fileTooLarge",415e3:"audioFileTypeNotSupported"},authentication:{401102:"Authorization failure",401103:"Authorization failure",401500:"Authorization failure",401520:"Forbidden",401521:"Forbidden",401522:"Forbidden",401523:"Forbidden",401530:"Authorization failure",401600:"Authorization failure",401700:"Authorization failure",403e3:"Authorization failure",5e5:"errorInternalServerError",503e3:"resourceNotFound"}},service.handleErrorMessage=function(response,context){service.getErrorFullMessage(response,context)},service.handleError=function(response,params){var portal=service.getPortal(response),errorDetailsCode=response.status;response.data&&response.data.errorDetailsCode&&(errorDetailsCode=response.data.errorDetailsCode);var error=new Error(service.getDetailedErrorMessage(response));return error.status=response.status,error.fieldErrors=service.getBadRequestFieldErrors(response),error.errorDetailsCode=errorDetailsCode,error.errorDetailsLabel=service.getErrorCodeLabel(errorDetailsCode,portal),error.translatedMessage=service.getTranslatedErrorMessage(response,params,portal),error.portal=portal,error},service.getPortal=function(response){var url=response.config?response.config.url:void 0,res=url?url.match(/api\/rainbow\/(\w+)\//):void 0;return res?res[1]:void 0},service.getBadRequestFieldErrors=function(response){var fieldErrors={};if(400===response.status){if(response.data&&response.data.errorDetails instanceof Array)response.data.errorDetails.forEach((function(details){fieldErrors[details.param]||(fieldErrors[details.param]={ok:!1,message:details.msg,value:details.value})}));else if(response.data&&response.data.errorDetails&&response.data.errorDetails.param){var details=response.data.errorDetails;fieldErrors[details.param]={ok:!1,message:details.msg,value:details.value}}response.data&&400511===response.data.errorDetailsCode&&(fieldErrors.office365Tenant={ok:!1,message:service.ErrorCodeLabels[400511]}),response.data&&400601===response.data.errorDetailsCode&&(fieldErrors.outgoingPrefix={ok:!1,message:service.ErrorCodeLabels[400601]},fieldErrors.numberingPrefix={ok:!1,message:service.ErrorCodeLabels[400601]})}return fieldErrors},service.getErrorMessage=function(response){var errorMessage=service.getStatusErrorMessage(response);return response.data&&response.data.errorMsg&&(errorMessage="",response.data.errorDetails?response.data.errorDetails instanceof Array?errorMessage+="one or more fields are invalid":response.data.errorDetails.msg?errorMessage+=response.data.errorDetails.msg:errorMessage+=response.data.errorDetails:errorMessage+=response.data.errorMsg),errorMessage},service.getStatusErrorMessage=function(response){return 500===response.status?"Internal server error":-1===response.status?"Service unavailable":415===response.status?"Unsupported Media Type":413===response.status?"Request Entity Too Large":404===response.status?"Resource not found":403===response.status?"Access is forbidden":401===response.status?"Authorization failure":400===response.status?"Bad request":response.statusText?response.statusText:"Unknown error"},service.getDetailedErrorMessage=function(response){var errorMessage=service.getErrorMessage(response);return response.data&&response.data.errorDetailsData&&"string"==typeof response.data.errorDetailsData&&(errorMessage+=" "+response.data.errorDetailsData),response.data&&response.data.errorDetails&&response.data.errorDetails instanceof Array&&response.data.errorDetails.length>0&&(errorMessage+=" : "+response.data.errorDetails[0].msg),errorMessage},service.getTranslatedErrorMessage=function(response,params,portal){if(500===response.status)return service.getLocalizedError("500");var errorDetailsCode=null;response.data&&response.data.errorDetailsCode&&(errorDetailsCode=response.data.errorDetailsCode);var errorDetailsData;return errorDetailsData=response.data&&response.data.errorDetailsData?Object.assign(response.data.errorDetailsData,params):params,service.getTranslatedErrorMessageByDetailsCode(errorDetailsCode,errorDetailsData,service.getErrorMessage(response),portal)},service.getTranslatedErrorMessageByDetailsCode=function(errorDetailsCode,errorDetailsParams,errorInfoMessage,portal){var errorMessage;return errorDetailsCode&&(errorMessage=service.getLocalizedError(errorDetailsCode,errorDetailsParams,portal)),errorMessage||(errorMessage=errorDetailsCode?$filter("translate")("anErrorOccurred",{errorcode:errorDetailsCode}):$filter("translate")("anErrorOccurred"),errorInfoMessage&&(errorMessage+=" ("+$filter("translate")(errorInfoMessage)+")")),errorMessage},service.getLocalizedError=function(errorCode,params,portal){var errorMessage;if(errorCode){var errorLabel=service.getErrorCodeLabel(errorCode,portal);if(errorLabel){var translation=$filter("translate")(errorLabel,params);translation!==errorLabel&&(errorMessage=translation)}}return errorMessage},service.getErrorCodeLabel=function(errorCode,portal){return portal&&service.portalErrorCodeLabels[portal]&&service.portalErrorCodeLabels[portal][errorCode]?service.portalErrorCodeLabels[portal][errorCode]:service.ErrorCodeLabels[errorCode]},service.getErrorFullMessage=function(response,context){var errorMessage=context?context+" failure : ":"";response&&response.data?(errorMessage+=response.data.errorMsg,response.data.errorDetails&&(errorMessage+=" - ",response.data.errorDetails instanceof Array?response.data.errorDetails.forEach((function(details){errorMessage+=details.msg})):response.data.errorDetails.msg?errorMessage+=JSON.stringify(response.data.errorDetails.msg):errorMessage+=response.data.errorDetails)):errorMessage+="Unknow error - Something goes really wrong";var httpId="";return response&&response.headers&&(httpId=response.headers("x-rainbow-request-id"),errorMessage+=" x-rainbow-request-id = "+httpId),errorMessage}}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0__);angular.module("rainbow").service("pushImageHelperService",["$log","$q","$http","errorHelperService",function($log,$q,$http,errorHelperService){var service=this;service.pushImage=function(pushServiceURL,avatarImg,params){return $q((function(resolve,reject){var resizePromise=null;if(params&&params.nosize)resizePromise=function(){var image=new Image;return image.src=avatarImg,$q.when(image)};else{var width=params&&params.width?params.width:512,height=params&&params.height?params.height:512;resizePromise=function(){return service.resizeImage(avatarImg,width,height)}}resizePromise().then((function(resizedImage){var binaryData=service.getBinaryData(resizedImage);$http({method:"POST",url:pushServiceURL,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getPostHeader("image/"+binaryData.type),data:binaryData.data,transformRequest:[]}).then((function(){$log.info("[pushImageHelperService] pushImage : success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[pushImageHelperService] "+errorHelperService.getErrorFullMessage(response,"pushImage"))}))}))}))},service.resizeImage=function(avatarImg,maxWidth,maxHeight){return $q((function(resolve){var image=new Image;image.src=avatarImg,image.onload=function(){var imageWidth=image.width,imageHeight=image.height;imageWidth>imageHeight?imageWidth>maxWidth&&(imageHeight*=maxWidth/imageWidth,imageWidth=maxWidth):imageHeight>maxHeight&&(imageWidth*=maxHeight/imageHeight,imageHeight=maxHeight);var canvas=document.createElement("canvas");canvas.width=imageWidth,canvas.height=imageHeight,image.width=imageWidth,image.height=imageHeight,canvas.getContext("2d").drawImage(this,0,0,imageWidth,imageHeight);var resizedImage=new Image;resizedImage.src=canvas.toDataURL("image/png"),resolve(resizedImage)}}))},service.getBinaryData=function(image){for(var typeIndex=image.src.indexOf("image/")+6,binaryIndex=image.src.indexOf(";base64,"),binaryData=image.src.slice(binaryIndex+8),imageType=image.src.slice(typeIndex,binaryIndex),binary_string=window.atob(binaryData),len=binary_string.length,bytes=new Uint8Array(len),i=0;i<len;i++)bytes[i]=binary_string.charCodeAt(i);return{type:imageType,data:bytes}}}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var crypto_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26),_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3__);angular.module("rainbow").service("botService",["$http","$q","$log","$rootScope","$interval","conversationService",function($http,$q,$log,$rootScope,$interval,conversationService){var service=this;service.listeners=[],service.start=function(stats){$log.info("[botService] === STARTING ===");var startDate=performance.now();return $q((function(resolve,reject){service.init(),service.startListeners(),service.getBots().then((function(bots){$log.info(""),service.findEmily(bots),service.unlockWaitingConversations();var startDuration=Math.round(performance.now()-startDate);stats.push({service:"botService",startDuration:startDuration}),$log.info("[botService] === STARTED ("+startDuration+" ms) ==="),$log.info(""),resolve()})).catch((function(error){$log.info("[botService] === STARTING FAILURE === "+error.message),reject()}))}))},service.stop=function(){$log.info("[botService] === STOPPED ===")},service.init=function(){service.emily=null,this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/"},service.startListeners=function(){service.listeners.push($rootScope.$on("ON_COMPANY_SUPPORT_AVATAR_CHANGE_EVENT",service.onSupportAvatarChange))},service.stopListeners=function(){for(var listener;listener=listeners.pop();)listener()},service.onSupportAvatarChange=function(__event,supportAvatarInfo){$log.info("[botService] Emily avatar has been changed"),supportAvatarInfo.companyId===_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.userContact.company.id&&service.getEmilyBot().then((function(supportBot){service.updateEmily(supportBot)})).catch((function(error){$log.warn("[botService] Impossible to update Emily - "+error.stack||!1)}))},service.getBots=function(format){return $q((function(resolve,reject){var url=service.portalURL+"bots?format="+(format||"full");$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[botService] getBots success"),resolve(response.data.data)})).catch((function(response){var errorMessage="getBots failure "+response.data.errorDetails+" with status "+response.status;$log.error("[botService] "+errorMessage),reject(new Error(errorMessage))}))}))},service.getEmilyBot=function(){return $q((function(resolve,reject){var url=service.portalURL+"bots/rainbow-support";$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[botService] getEmilyBot success"),resolve(response.data.data)})).catch((function(response){var errorMessage="getEmilyBot failure "+response.data.errorDetails+" with status "+response.status;$log.error("[botService] "+errorMessage),reject(new Error(errorMessage))}))}))},service.findEmily=function(bots){bots.forEach((function(bot){"Emily"===bot.name&&($log.info("[botService] Emily is found"),service.updateEmily(bot))}))},service.updateEmily=function(bot){service.emily=service.emily||bot,service.emily.name=bot.name,service.emily.id=bot.id,service.emily.avatarId=bot.avatarId||bot.id,service.emily.lastAvatarUpdateDate=bot.lastAvatarUpdateDate,service.emily.capabilities=bot.capabilities,service.emily.avatarUrl=service.getBotAvatarUrl(service.emily.avatarId,service.emily.lastAvatarUpdateDate),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.createBotContact(service.emily.jid,service.emily.name,service.emily.id,service.emily.avatarUrl,service.emily.capabilities),$log.info("[botService] Emily contact has been updated")},service.getEmily=function(){return service.emily},service.openConversationWithEmily=function(){return $q((function(resolve,reject){$log.info("[botService] openConversationWithEmily");var botContact=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.getContactByJid(service.emily.jid);conversationService.getOrCreateOneToOneConversation(botContact.jid).then((function(conversation){conversationService.setActiveConversation(conversation),resolve(conversation)})).catch((function(){$log.error("[botService] openConversationWithEmily failure"),reject()}))}))},service.unlockWaitingConversations=function(){conversationService.unlockWaitingBotConversations(!0)},service.getBotAvatarImage=function(avatarId,lastAvatarUpdateDate){return $q((function(resolve,reject){$log.info("[botService] getBotAvatarImage");var imgSrc=service.getBotAvatarUrl(avatarId,lastAvatarUpdateDate),image=new Image,nbErrors=0;image.onload=function(){var loadedImage=this;$interval((function(){$log.log("[botService] Load bot avatar "+avatarId+" lastAvatarUpdateDate "+lastAvatarUpdateDate+" success"),resolve(loadedImage)}),1,1)},image.onerror=function(){nbErrors++,$interval((function(){$log.warn("[botService] Load bor avatar "+avatarId+" lastAvatarUpdateDate "+lastAvatarUpdateDate+" failure"),1===nbErrors?($log.warn("[botService] Fallback to default emily avatar"),image.src="/resources/skins/rainbow/images/conversation/icon_headset.png"):reject(new Error("No image found"))}),1,1)},image.src=imgSrc}))},service.getBotAvatarUrl=function(botId,lastAvatarUpdateDate){var serverURL=config.webservices.protocol+"://"+config.webservices.currentServer;_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2___default.a.cdn&&(serverURL=_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2___default.a.cdnServer);var imgSrc=serverURL+"/api/avatar/"+botId+"?size=120";return imgSrc+=lastAvatarUpdateDate?"&update="+Object(crypto_js__WEBPACK_IMPORTED_MODULE_0__.MD5)(crypto_js__WEBPACK_IMPORTED_MODULE_0__.enc.Latin1.parse(lastAvatarUpdateDate)).toString(crypto_js__WEBPACK_IMPORTED_MODULE_0__.enc.Hex):"&update="+Date.now()}}])},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var searchTextConvResults_1=__webpack_require__(221),conversationServiceEventHandler_1=__webpack_require__(225),conversationServiceBulkHistoryHandler_1=__webpack_require__(331),call_model_1=__webpack_require__(0),moment=__webpack_require__(3),rxjs_1=__webpack_require__(10),fileDescriptor_1=__webpack_require__(54),fileViewer_1=__webpack_require__(71),message_1=__webpack_require__(16),event_model_1=__webpack_require__(24),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),profile_service_1=__webpack_require__(6),fileStorage_service_1=__webpack_require__(25),contact_service_1=__webpack_require__(1),logger_service_1=__webpack_require__(15),i18n_service_1=__webpack_require__(38),room_service_1=__webpack_require__(33),pgiConference_service_1=__webpack_require__(58),strophe_js_1=__webpack_require__(76);angular.module("rainbow").service("conversationService",["$q","$rootScope","$http","$interval","Conversation","videoService","telephonyService","ConversationServiceHistoryHandler","SearchTextConvResultsFactory","webConferenceService","webrtcGatewayService","fileServerService",function($q,$rootScope,$http,$interval,Conversation,videoService,telephonyService,ConversationServiceHistoryHandler,SearchTextConvResultsFactory,webConferenceService,webrtcGatewayService,fileServerService){var _this171=this,service=this;this.started=!1,service.start=function(stats){logger_service_1.default.info(""),logger_service_1.default.info("[conversationService] === STARTING ===");var defered=$q.defer(),startDate=performance.now();return _this171.pendingMessages={},_this171.activeConversation=null,_this171.conversations=[],_this171.conversationCreationPromise={},_this171.inCallConversations=[],_this171.idleConversations=[],_this171.involvedContactIds=[],_this171.rxSubject=new rxjs_1.Subject,_this171.pgiServiceSubscription=null,_this171.currentMissedIMCounter=0,_this171.currentMissedCallCounter=0,_this171.searchTextConvResults=SearchTextConvResultsFactory(),_this171.waitingBotConversations=[],_this171.botServiceReady=!1,_this171.isBasicCallAllowed=profile_service_1.default.isFeatureEnabled(profile_service_1.default.FeaturesEnum.TELEPHONY_BASIC_CALL),_this171.isSecondCallAllowed=profile_service_1.default.isFeatureEnabled(profile_service_1.default.FeaturesEnum.TELEPHONY_SECOND_CALL),_this171.attachHandlers(),logger_service_1.default.info("[conversationService] getServerConversations"),defered.resolve(),service.getServerConversations().then((function(){service.started=!0,service.linkAllActiveCallsToConversations(),service.cleanUnwantedConversations(),service.pgiServiceSubscription=pgiConference_service_1.default.conferenceSessionsSubject.subscribe((function(updatedConfSessionEvent){updatedConfSessionEvent.id===pgiConference_service_1.default.getPstnInstantConferenceEndpointId()&&"created"===updatedConfSessionEvent.action&&pgiConference_service_1.default.subscribeToMyConferenceSessions((function(active){_this171.onPGiConferenceStateEvent(active)}))}));var startDuration=Math.round(performance.now()-startDate);stats.push({service:"conversationService",startDuration:startDuration}),logger_service_1.default.info("[conversationService] === STARTED ("+startDuration+" ms) ===")})).catch((function(error){logger_service_1.default.info("[conversationService] === STARTING FAILURE === "+error.message),defered.reject(error)})),_this171.contactUpdateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_CONTACT_UPDATED_EVENT, rehandle it"),_this171.contactUpdateEventHandlerCleaner()),_this171.contactUpdateEventHandlerCleaner=$rootScope.$on("ON_CONTACT_UPDATED_EVENT",_this171.onContactChangedEvent),_this171.roomUpdateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event "+room_service_1.default.ROOM_UPDATE_EVENT+", rehandle it"),_this171.roomUpdateEventHandlerCleaner()),_this171.roomUpdateEventHandlerCleaner=$rootScope.$on(room_service_1.default.ROOM_UPDATE_EVENT,_this171.onRoomChangedEvent),_this171.roomAddConferenceEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event "+room_service_1.default.ROOM_ADD_CONF_ENDPOINT_EVENT+", rehandle it"),_this171.roomAddConferenceEventHandlerCleaner()),_this171.roomAddConferenceEventHandlerCleaner=$rootScope.$on(room_service_1.default.ROOM_ADD_CONF_ENDPOINT_EVENT,_this171.onRoomAddConferenceEvent),_this171.roomHistoryUpdateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event "+room_service_1.default.ROOM_HISTORY_UPDATE_EVENT+", rehandle it"),_this171.roomHistoryUpdateEventHandlerCleaner()),_this171.roomHistoryUpdateEventHandlerCleaner=$rootScope.$on(room_service_1.default.ROOM_HISTORY_UPDATE_EVENT,_this171.onRoomHistoryChangedEvent),_this171.roomAdminMessageEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event "+room_service_1.default.ROOM_ADMIN_MESSAGE_EVENT+", rehandle it"),_this171.roomAdminMessageEventHandlerCleaner()),_this171.roomAdminMessageEventHandlerCleaner=$rootScope.$on(room_service_1.default.ROOM_ADMIN_MESSAGE_EVENT,_this171.onRoomAdminMessageEvent),_this171.callUpdateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_CALL_UPDATED_EVENT, rehandle it"),_this171.callUpdateEventHandlerCleaner()),_this171.callUpdateEventHandlerCleaner=$rootScope.$on("ON_CALL_UPDATED_EVENT",(function(_event,call){_this171.onCallEvent(call)})),_this171.webRtcCallUpdateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_WEBRTC_GW_CALL_UPDATED_EVENT, rehandle it"),_this171.webRtcCallUpdateEventHandlerCleaner()),_this171.webRtcCallUpdateEventHandlerCleaner=$rootScope.$on("ON_WEBRTC_GW_CALL_UPDATED_EVENT",(function(_event,call){_this171.onCallEvent(call,!0)})),_this171.conversationUpdateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_CONVERSATIONS_UPDATED_EVENT, rehandle it"),_this171.conversationUpdateEventHandlerCleaner()),_this171.conversationUpdateEventHandlerCleaner=$rootScope.$on("ON_CONVERSATIONS_UPDATED_EVENT",_this171.onConversationEvent),_this171.capacityUpdateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_UPDATE_MYCONTACT_EVENT, rehandle it"),_this171.capacityUpdateEventHandlerCleaner()),_this171.capacityUpdateEventHandlerCleaner=$rootScope.$on("ON_UPDATE_MYCONTACT_EVENT",_this171.onMyContactChangedEvent),_this171.telephonyStateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_TELEPHONY_STATUS_CHANGED_EVENT, rehandle it"),_this171.telephonyStateEventHandlerCleaner()),_this171.telephonyStateEventHandlerCleaner=$rootScope.$on("ON_TELEPHONY_STATUS_CHANGED_EVENT",_this171.onTelephonyStateChangeEvent),_this171.conferenceStateEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_CONFERENCE_STATE_EVENT, rehandle it"),_this171.conferenceStateEventHandlerCleaner()),_this171.conferenceStateEventHandlerCleaner=$rootScope.$on("ON_CONFERENCE_STATE_EVENT",_this171.onConferenceStateChangeEvent),_this171.conferenceParticipantsEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_CONFERENCE_PARTICIPANT_EVENT, rehandle it"),_this171.conferenceParticipantsEventHandlerCleaner()),_this171.conferenceParticipantsEventHandlerCleaner=$rootScope.$on("ON_CONFERENCE_PARTICIPANT_EVENT",_this171.onConferenceParticipantChangeEvent),_this171.reloadCapabilitiesForMyContactEventHandlerCleaner&&(logger_service_1.default.warn("[conversationService] already subscribed to event ON_RELOAD_CAPABILITIES_FOR_MY_CONYTACT, rehandle it"),_this171.reloadCapabilitiesForMyContactEventHandlerCleaner()),_this171.reloadCapabilitiesForMyContactEventHandlerCleaner=$rootScope.$on("ON_RELOAD_CAPABILITIES_FOR_MY_CONYTACT",_this171.onReloadCapabilitiesForMyContactEvent),defered.promise},this.attachHandlers=function(){var _this172=this;if(this.removeHandlers(),contact_service_1.default.userContact&&!contact_service_1.default.userContact.instantMessagesEnabled)return logger_service_1.default.warn("[conversationService] attachHandlers skipped - instantMessagesEnabled : false"),this.conversationServiceEventHandler=conversationServiceEventHandler_1.ConversationServiceEventHandler.create($rootScope,Conversation,fileServerService,webrtcGatewayService,this),void(this.messageHandlerRef||(this.messageHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return service.conversationServiceEventHandler.onChatMessageReceived(stanza),!0}),"jabber:iq:recordingP2P","message","chat")));logger_service_1.default.info("[conversationService] attachHandlers"),this.conversationHistoryHandler=ConversationServiceHistoryHandler.create(this),this.conversationServiceEventHandler=conversationServiceEventHandler_1.ConversationServiceEventHandler.create($rootScope,Conversation,fileServerService,webrtcGatewayService,this),this.conversationServiceBulkHistoryHandler=new conversationServiceBulkHistoryHandler_1.ConversationServiceBulkHistoryHandler(this,fileServerService),xmpp_service_1.default.addHistoryHandler((function(stanza){return service.conversationHistoryHandler.onHistoryMessageReceived(stanza)})),xmpp_service_1.default.addBulkHistoryHandler((function(stanza){return service.conversationServiceBulkHistoryHandler.onHistoryMessageReceived(stanza)})),xmpp_service_1.default.addSearchTextHandler((function(queryId,stanza){if(service.searchTextConvResults.isCurrentQuery(queryId)){var searchTextItem=service.conversationHistoryHandler.onSearchTextMessageReceived(stanza);searchTextItem&&_this172.storeSearchTextResult(searchTextItem)}})),this.messageHandlerRef||(this.messageHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return service.conversationServiceEventHandler.onChatMessageReceived(stanza),!0}),null,"message","chat")),this.messageMucHandlerRef||(this.messageMucHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return service.conversationServiceEventHandler.onChatMessageReceived(stanza),!0}),null,"message","groupchat")),this.fileMessageHandlerRef||(this.fileMessageHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return service.conversationServiceEventHandler.onFileMessageReceived(stanza),!0}),null,"message","file")),this.webrtcMessageHandlerRef||(this.webrtcMessageHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return service.conversationServiceEventHandler.onWebRTCMessageReceived(stanza),!0}),null,"message","webrtc")),this.convMessageHandlerRef||(this.convMessageHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return service.conversationServiceEventHandler.onManagementMessageReceived(stanza),!0}),null,"message","management")),this.receiptMessageHandlerRef||(this.receiptMessageHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return service.conversationServiceEventHandler.onReceiptMessageReceived(stanza),!0}),null,"message")),this.audioConfMessageHandlerRef||(this.audioConfMessageHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return service.conversationServiceEventHandler.onConferenceMessageReceived(stanza),!0}),"jabber:x:audioconference","message","chat")),this.aksSharingHandlerRef||(this.aksSharingHandlerRef=xmpp_service_1.default.addHandler((function(stanza){return _this172.onAskSharingMessageReceived(stanza),!0}),"http://jabber.org/protocol/commands","iq"))},this.removeHandlers=function(){logger_service_1.default.info("[conversationService] removeHandlers "),this.conversationHistoryHandler&&(this.conversationHistoryHandler=null),this.conversationServiceEventHandler&&(this.conversationServiceEventHandler=null),this.conversationServiceBulkHistoryHandler&&(this.conversationServiceBulkHistoryHandler=null),this.messageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.fileMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.fileMessageHandlerRef),this.fileMessageHandlerRef=null),this.webrtcMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.webrtcMessageHandlerRef),this.webrtcMessageHandlerRef=null),this.convMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.convMessageHandlerRef),this.convMessageHandlerRef=null),this.receiptMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.receiptMessageHandlerRef),this.receiptMessageHandlerRef=null),this.messageMucHandlerRef&&(xmpp_service_1.default.deleteHandler(this.messageMucHandlerRef),this.messageMucHandlerRef=null),this.recordingMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.recordingMessageHandlerRef),this.recordingMessageHandlerRef=null),this.audioConfMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.audioConfMessageHandlerRef),this.audioConfMessageHandlerRef=null),this.aksSharingHandlerRef&&(xmpp_service_1.default.deleteHandler(this.aksSharingHandlerRef),this.aksSharingHandlerRef=null)},service.stop=function(){return logger_service_1.default.info("[conversationService] === STOPPING ==="),this.conversations=null,this.messageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.fileMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.fileMessageHandlerRef),this.fileMessageHandlerRef=null),this.webrtcMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.webrtcMessageHandlerRef),this.webrtcMessageHandlerRef=null),this.recordingMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.recordingMessageHandlerRef),this.recordingMessageHandlerRef=null),this.audioConfMessageHandlerRef&&(xmpp_service_1.default.deleteHandler(this.audioConfMessageHandlerRef),this.audioConfMessageHandlerRef=null),this.aksSharingHandlerRef&&(xmpp_service_1.default.deleteHandler(this.aksSharingHandlerRef),this.aksSharingHandlerRef=null),this.contactUpdateEventHandlerCleaner&&(this.contactUpdateEventHandlerCleaner(),this.contactUpdateEventHandlerCleaner=null),this.roomUpdateEventHandlerCleaner&&(this.roomUpdateEventHandlerCleaner(),this.roomUpdateEventHandlerCleaner=null),this.roomAddConferenceEventHandlerCleaner&&(this.roomAddConferenceEventHandlerCleaner(),this.roomAddConferenceEventHandlerCleaner=null),this.roomAdminMessageEventHandlerCleaner&&(this.roomAdminMessageEventHandlerCleaner(),this.roomAdminMessageEventHandlerCleaner=null),this.callUpdateEventHandlerCleaner&&(this.callUpdateEventHandlerCleaner(),this.callUpdateEventHandlerCleaner=null),this.conversationUpdateEventHandlerCleaner&&(this.conversationUpdateEventHandlerCleaner(),this.conversationUpdateEventHandlerCleaner=null),this.capacityUpdateEventHandlerCleaner&&(this.capacityUpdateEventHandlerCleaner(),this.capacityUpdateEventHandlerCleaner=null),this.telephonyStateEventHandlerCleaner&&(this.telephonyStateEventHandlerCleaner(),this.telephonyStateEventHandlerCleaner=null),this.reloadCapabilitiesForMyContactEventHandlerCleaner&&(this.reloadCapabilitiesForMyContactEventHandlerCleaner(),this.reloadCapabilitiesForMyContactEventHandlerCleaner=null),this.conferenceParticipantsEventHandlerCleaner&&(this.conferenceParticipantsEventHandlerCleaner(),this.conferenceParticipantsEventHandlerCleaner=null),this.conferenceStateEventHandlerCleaner&&(this.conferenceStateEventHandlerCleaner(),this.conferenceStateEventHandlerCleaner=null),this.webRtcCallUpdateEventHandlerCleaner&&(this.webRtcCallUpdateEventHandlerCleaner(),this.webRtcCallUpdateEventHandlerCleaner=null),this.roomHistoryUpdateEventHandlerCleaner&&(this.roomHistoryUpdateEventHandlerCleaner(),this.roomHistoryUpdateEventHandlerCleaner=null),this.pgiServiceSubscription&&this.pgiServiceSubscription.unsubscribe(),this.started=!1,this.isReinit=!1,logger_service_1.default.info("[conversationService] === STOPPED ==="),$q.when()},service.subscribe=function(handler){return _this171.rxSubject.subscribe(handler)},service.publish=function(rbEvent){_this171.rxSubject.next(rbEvent)},this.emojiOneToShort=function(text){return emojione?emojione.toShort(text):text},service.getServerConversations=function(){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee349(){var url,response,conversationsData,maxConversations,conversationPromises,errorMessage;return regenerator_default.a.wrap((function(_context350){for(;;)switch(_context350.prev=_context350.next){case 0:if(contact_service_1.default.userContact&&!contact_service_1.default.userContact.instantMessagesEnabled){_context350.next=23;break}return _context350.prev=1,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(contact_service_1.default.userContact.dbId,"/conversations"),_context350.next=5,fetch(url,{headers:auth_service_1.default.getRequestHeader()});case 5:return response=_context350.sent,_context350.next=8,response.json();case 8:return(conversationsData=_context350.sent.data).forEach((function(conversationData){conversationData.creationDateSort=conversationData.creationDate?new Date(conversationData.creationDate):void 0,conversationData.lastModificationSort=conversationData.lastMessageDate?new Date(conversationData.lastMessageDate):void 0})),conversationsData.sort(service.sortDataFunction),maxConversations=auth_service_1.default.fromSDK?3e3:20,conversationPromises=[],conversationsData.forEach((function(conversationData,index){var missedImCounter=parseInt(conversationData.unreadMessageNumber,10);index>=maxConversations&&0===missedImCounter?service.deleteServerConversation(conversationData.id):(logger_service_1.default.info("getServerConversations -- create conversation "+conversationData.jid_im+" "+conversationData.id),"user"===conversationData.type?conversationPromises.push(service.createOneToOneConversationFromData(conversationData)):conversationPromises.push(service.createRoomConversationFromData(conversationData)))})),_context350.next=14,Promise.all(conversationPromises);case 14:this.orderConversations(),_context350.next=21;break;case 17:throw _context350.prev=17,_context350.t0=_context350.catch(1),errorMessage="getServerConversations -- failure:"+_context350.t0.message,logger_service_1.default.error(errorMessage),new Error(errorMessage);case 21:_context350.next=24;break;case 23:logger_service_1.default.warn("[conversationService] getServerConversations skipped - instantMessagesEnabled : false");case 24:case"end":return _context350.stop()}}),_callee349,this,[[1,17]])})))},this.createServerConversation=function(conversation){return $q((function(resolve,reject){if(conversation.dbId)resolve(conversation);else{var url=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+contact_service_1.default.userContact.dbId+"/conversations",data=null;switch(conversation.type){case Conversation.Type.ONE_TO_ONE:data={peerId:conversation.contact.dbId,type:"user"};break;case Conversation.Type.ROOM:data={peerId:conversation.room.dbId,type:"room"};break;case Conversation.Type.BOT:conversation.type=Conversation.Type.ONE_TO_ONE,data={peerId:conversation.contact.dbId,type:"bot"}}$http({method:"POST",url:url,headers:auth_service_1.default.getRequestHeader(),data:data}).then((function(response){conversation.dbId=response.data.data.id,resolve(conversation)})).catch((function(response){var errorMessage="createServerConversation failure: unknown ... ";response.data&&response.data.errorDetails&&(errorMessage="createServerConversation failure: "+response.data.errorDetails),logger_service_1.default.warn("[conversationService] "+errorMessage),reject(new Error(errorMessage))}))}}))},this.deleteServerConversation=function(conversationId){var defered=$q.defer();return conversationId?($http({method:"DELETE",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+contact_service_1.default.userContact.dbId+"/conversations/"+conversationId,headers:auth_service_1.default.getRequestHeader()}).then((function(){logger_service_1.default.info("[conversationService] deleteServerConversation success: "+conversationId),service.orderConversations(),defered.resolve()}),(function(response){if(404002===response.data.errorDetailsCode)logger_service_1.default.info("[conversationService] deleteServerConversation success: "+conversationId),defered.resolve();else{var errorMessage="deleteServerConversation failure: "+response.data.errorDetails;logger_service_1.default.warn("[conversationService] "+errorMessage),defered.reject(new Error(errorMessage))}})),defered.promise):$q.when()},this.updateServerConversation=function(conversation){var defered=$q.defer();return conversation?($http({method:"PUT",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+contact_service_1.default.userContact.dbId+"/conversations/"+conversation.dbId,headers:auth_service_1.default.getPostHeader(),data:{mute:conversation.muted}}).then((function(){logger_service_1.default.info("[conversationService] updateServerConversation success: "+conversation.dbId),defered.resolve()}),(function(response){var errorMessage="updateServerConversation failure: "+response.data.errorDetails;logger_service_1.default.warn("[conversationService] "+errorMessage),defered.reject(new Error(errorMessage))})),defered.promise):$q.when()},this.ackAllMessages=function(conversationDbId,force){return $q((function(resolve,reject){if(!conversationDbId)return logger_service_1.default.error("[conversationService] ackAllMessages for conversation error -- missing conversation id"),void reject();var conversation=service.getConversationByDbId(conversationDbId);return conversation?conversation.ackReadAllReceivedMessages()||force?(logger_service_1.default.info("[conversationService] ackAllMessages for conversation "+conversationDbId),void $http({method:"PUT",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+contact_service_1.default.userContact.dbId+"/conversations/"+conversationDbId+"/markallread",headers:auth_service_1.default.getPostHeader()}).then((function(){logger_service_1.default.info("[conversationService] ackAllMessages success: "+conversationDbId),resolve()}),(function(response){var errorMessage="ackAllMessages failure: "+response.data.errorDetails;logger_service_1.default.warn("[conversationService] "+errorMessage),reject(new Error(errorMessage))}))):(logger_service_1.default.info("[conversationService] ackAllMessages for conversation "+conversationDbId+" already updated"),void resolve()):(logger_service_1.default.error("[conversationService] ackAllMessages for conversation error -- can not find conversation"),void reject())}))},this.getConversationAsyncById=function(conversationId,type){var dbId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return _this171["room"===type?"getRoomConversation":"getOrCreateOneToOneConversation"](conversationId,dbId)},this.createOneToOneConversationFromData=function(conversationData){var missedImCounter=parseInt(conversationData.unreadMessageNumber,10),muted=!0===conversationData.mute;_this171.getOrCreateOneToOneConversation(conversationData.jid_im,conversationData.id,conversationData.lastMessageDate,conversationData.lastMessageText,missedImCounter,muted,conversationData.creationDate,conversationData.lastMessageSender,conversationData.call,conversationData.replace,conversationData.forwardFrom,conversationData.forwardedMessage)},this.createRoomConversationFromData=function(conversationData){var missedImCounter=parseInt(conversationData.unreadMessageNumber,10),muted=!0===conversationData.mute;return _this171.getRoomConversation(conversationData.jid_im,conversationData.id,conversationData.lastMessageDate,conversationData.lastMessageText,missedImCounter,!0,muted,conversationData.creationDate,conversationData.lastMessageSender,conversationData.topic,conversationData.type,conversationData.forwardFrom,conversationData.forwardedMessage)},this.getOrCreateTelephonyConversation=function(call){logger_service_1.default.info("getOrCreateTelephonyConversation -- "+call.id);var conv=service.getConversationById(call.id);return call.id&&telephonyService.currentPgiObject&&telephonyService.currentPgiObject.callId&&call.id===telephonyService.currentPgiObject.callId&&(conv=service.getConversationById(telephonyService.currentPgiObject.roomJid)),conv||(conv=new Conversation(call.id),call.isConference?conv.telephonyContacts=call.participants:(conv.contact=call.contact,call.contact.conversation=conv),_this171.conversations[call.id]=conv),conv},this.getOrCreateOneToOneConversation=function(conversationId,conversationDbId,lastModification,lastMessageText,missedIMCounter,muted,creationDate,lastMessageSender,lastCallInfo,replace,forwardFrom,forwardedMessage){if(logger_service_1.default.info("[conversationService] getOrCreateOneToOneConversation "+conversationId+" "+conversationDbId+" "+missedIMCounter),!service.conversationCreationPromise[conversationId]){var conv=service.getConversationById(conversationId);if(conv)return conv.preload=!0,$q.resolve(conv);service.conversationCreationPromise[conversationId]=$q((function(resolve,reject){contact_service_1.default.getOrCreateContact(conversationId).then((function(contact){var conversation=Conversation.createOneToOneConversation(contact);return conversation.lastModification=lastModification?new Date(lastModification):void 0,conversation.lastCallInfo=lastCallInfo,conversation.replaceLastMsgId=replace,lastMessageText&&(conversation.lastMessageText=service.emojiOneToShort(lastMessageText)),conversation.lastMessageSender=xmpp_service_1.default.getBareJidFromJid(lastMessageSender),conversation.muted=muted,conversation.creationDate=creationDate?new Date(creationDate):new Date,conversation.preload=!1,service.computeCapabilitiesForContact(contact),conversation.dbId=conversationDbId,conversation.missedCounter=missedIMCounter||0,conversation.forwardFrom=forwardFrom,conversation.forwardedMessage=forwardedMessage,service.createServerConversation(conversation)})).then((function(conversation){service.conversations[conversation.contact.id]=conversation,service.orderConversations(),$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation,Conversation.EventType.NEW),resolve(conversation),delete service.conversationCreationPromise[conversationId]})).catch((function(error){var errorMessage="getOrCreateOneToOneConversation "+conversationId+" failure "+error.message;logger_service_1.default.error("[conversationService] "+errorMessage),reject(new Error(errorMessage)),delete service.conversationCreationPromise[conversationId]}))}))}return service.conversationCreationPromise[conversationId]},this.getRoomConversation=function(roomJid,conversationDbId,lastModification,lastMessageText,missedIMCounter,noError,muted,creationDate,lastMessageSender,topic,type,forwardFrom,forwardedMessage){if(contact_service_1.default.userContact&&!contact_service_1.default.userContact.roomsEnabled)return logger_service_1.default.info("[conversationService] === getRoomConversation skipped - roomsEnabled : "+contact_service_1.default.userContact.roomsEnabled),$q.when();if(logger_service_1.default.info("[conversationService] getRoomConversation "+roomJid),!service.conversationCreationPromise[roomJid]){var conv=service.getConversationById(roomJid);if(conv)return conv.preload=!0,$q.resolve(conv);service.conversationCreationPromise[roomJid]=$q((function(resolve,reject){$interval((function(){var room=room_service_1.default.getRoomByJid(roomJid);if(room||"bot"===type)if(room){var conversation=Conversation.createRoomConversation(room);conversation.dbId=conversationDbId,conversation.lastModification=lastModification?new Date(lastModification):void 0,lastMessageText&&(conversation.lastMessageText=service.emojiOneToShort(lastMessageText)),conversation.muted=muted,conversation.creationDate=creationDate?new Date(creationDate):new Date,conversation.preload=!1,conversation.lastMessageSender=xmpp_service_1.default.getBareJidFromJid(lastMessageSender),conversation.forwardFrom=forwardFrom,conversation.forwardedMessage=forwardedMessage,conversation.room&&topic&&(conversation.room.desc=topic),missedIMCounter&&(conversation.missedCounter=missedIMCounter),conversationDbId?(service.conversations[conversation.id]=conversation,service.getRoomConferences(conversation).then((function(){$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation,Conversation.EventType.NEW),resolve(conversation),delete service.conversationCreationPromise[roomJid]})).catch((function(error){var errorMessage="getRoomConversation "+roomJid+" failure "+error.message;logger_service_1.default.error("[conversationService] "+errorMessage),reject(new Error(errorMessage)),delete service.conversationCreationPromise[roomJid]}))):service.createServerConversation(conversation).then((function(createdConv){var createdRoom=room_service_1.default.getRoomByJid(roomJid);createdConv.room=createdRoom,service.conversations[createdConv.id]=createdConv,service.orderConversations(),createdRoom&&"unsubscribed"!==createdRoom.status&&createdRoom.isActive&&room_service_1.default.sendInitialRoomPresence(createdRoom),$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",createdConv,Conversation.EventType.NEW),resolve(createdConv),delete service.conversationCreationPromise[roomJid]}))}else{var obj={jid:roomJid,conversationDbId:conversationDbId,lastModification:lastModification,lastMessageText:lastMessageText?service.emojiOneToShort(lastMessageText):lastMessageText,lastMessageSender:xmpp_service_1.default.getBareJidFromJid(lastMessageSender),missedIMCounter:missedIMCounter,muted:muted,creationDate:creationDate};delete service.conversationCreationPromise[roomJid],service.waitingBotConversations.push(obj),service.unlockWaitingBotConversations(),resolve()}else logger_service_1.default.error("[conversationService] getRoomConversation ("+roomJid+") failure : no such room -- try to get from server and update"),setTimeout((function(){room_service_1.default.getServerRoomByJid(roomJid).then((function(newRoom){var conversation=Conversation.createRoomConversation(newRoom);conversation.dbId=conversationDbId,conversation.lastModification=lastModification?new Date(lastModification):void 0,lastMessageText&&(conversation.lastMessageText=service.emojiOneToShort(lastMessageText)),conversation.muted=muted,conversation.creationDate=creationDate?new Date(creationDate):new Date,conversation.preload=!1,conversation.lastMessageSender=xmpp_service_1.default.getBareJidFromJid(lastMessageSender),conversation.forwardFrom=forwardFrom,conversation.forwardedMessage=forwardedMessage,conversation.room&&topic&&(conversation.room.desc=topic),missedIMCounter&&(conversation.missedCounter=missedIMCounter),conversationDbId&&(service.conversations[conversation.id]=conversation,$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation,Conversation.EventType.NEW),resolve(conversation),delete service.conversationCreationPromise[roomJid]),newRoom&&newRoom.confEndpoints&&newRoom.confEndpoints[0]&&$rootScope.$broadcast("ON_ADD_HOC_COMPLETED",newRoom)})).catch((function(){logger_service_1.default.error("[conversationService] getRoomConversation ("+roomJid+") failure : no such room at all")}))}),500)}),1,1)}))}return service.conversationCreationPromise[roomJid]},service.getRoomConferences=function(conversation){return $q((function(resolve){var confEndpoints=conversation.room.confEndpoints;confEndpoints&&confEndpoints.forEach((function(confEndpoint){if("pstnAudio"===confEndpoint.mediaType){var conferenceSession=pgiConference_service_1.default.getConferenceSessionById(confEndpoint.confEndpointId);conferenceSession&&(conversation.pstnConferenceSession=conferenceSession)}})),resolve()}))},service.updateRoomConferences=function(){service.getConversations().forEach((function(conversation){if(conversation.room&&conversation.room.confEndpoints){var conferenceSession=pgiConference_service_1.default.getConferenceSessionById(conversation.room.getPstnConfEndpointId());conversation.pstnConferenceSession=conferenceSession||null;var webConfSession=webConferenceService.getConferenceSessionForRoom(conversation.room.confEndpoints);conversation.webConferenceSession=webConfSession||null}else conversation.pstnConferenceSession=null,conversation.webConferenceSession=null}))},this.closeConversation=function(conversation){return $q((function(resolve,reject){logger_service_1.default.info("[conversationService] closeConversation "+conversation.id),service.deleteServerConversation(conversation.dbId).then((function(){service.removeConversation(conversation),resolve()})).catch((function(error){reject(error)}))}))},this.removeConversation=function(conversation){if(logger_service_1.default.info("[conversationService] remove conversation "+conversation.id),conversation.videoCall&&conversation.videoCall.status!==call_model_1.Call.Status.UNKNOWN)logger_service_1.default.info("[conversationService] Ignore conversation deletion message for conversation"+conversation.id);else{delete service.conversations[conversation.id],service.orderConversations();var conversations=service.getOrderedConversations();!service.activeConversation||conversations.idle.indexOf(service.activeConversation)>=0||(conversations.idle.length>0?service.setActiveConversation(conversations.idle.first()):conversations.inCall.length>0?service.setActiveConversation(conversations.inCall.first()):service.setActiveConversation(null)),conversation.contact&&(conversation.contact.conversation=null,conversation.contact=null),$rootScope.$broadcast("ON_CONVERSATION_REMOVE_EVENT",conversation)}},this.getConversationByDbId=function(dbId){if(service.conversations)for(var key in service.conversations)if(service.conversations.hasOwnProperty(key)&&service.conversations[key].dbId===dbId)return service.conversations[key];return null},this.getConversationByRoomDbId=function(roomDbId){if(service.conversations)for(var key in service.conversations)if(service.conversations.hasOwnProperty(key)&&service.conversations[key].room&&service.conversations[key].room.dbId===roomDbId)return service.conversations[key];return null},this.searchConversations=function(criteria){var queries=criteria.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return service.getOrderedConversations().idle.filter((function(conversation){var names=conversation.filterName.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return queries.every((function(query){return names.some((function(name,index){return!(!name.length||-1===name.indexOf(query))&&(names[index]="",!0)}))}))}))},this.cleanFile=function(file){var stripScripts=function(s){var div=document.createElement("div");div.innerHTML=s;for(var scripts=div.getElementsByTagName("script"),i=scripts.length;i--;)scripts[i].parentNode.removeChild(scripts[i]);return div.innerHTML};return new Promise((function(resolve){if("image/svg+xml"===file.type){var reader=new FileReader;reader.addEventListener("loadend",(function(e){var elem=e.srcElement,cleanblob=new Blob([stripScripts(elem.result)],{type:"image/svg+xml"}),cleanFile=new File([cleanblob],file.name,{type:"image/svg+xml",lastModified:Date.now()});resolve(cleanFile)})),reader.readAsText(file)}else resolve(file)}))},this.sendChatMessage=function(conversation,textData){var alternativeContent=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,answeredMsg=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,mentions=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,urgency=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,id=Conversation.getUniqueMessageId(),unicodeData=conversation.shortnameToUnicode(textData),isMarkdown=alternativeContent&&"text/markdown"===alternativeContent.type,answeredMsgId=answeredMsg?answeredMsg.id:null,answeredMsgDate=answeredMsg?answeredMsg.date:null,creationDate=new Date,from=contact_service_1.default.userContact,message=conversation.addChatMessage(from,creationDate,unicodeData,id,!0,isMarkdown,null,answeredMsgId,answeredMsgDate,null,alternativeContent,mentions);if(message)return message.urgency=urgency,_this171.pendingMessages[message.id]={conversation:conversation,message:message},_this171.sendXmppMessage(conversation,message),message},this.sendChatForwardMessage=function(conversation,forwardText,forwardedMessage,origConv){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee350(){var fileDescriptorToSend,newForwardedMsg,id,creationDate,from,message;return regenerator_default.a.wrap((function(_context351){for(;;)switch(_context351.prev=_context351.next){case 0:if(fileDescriptorToSend=null,newForwardedMsg=null,forwardedMessage.fileId&&(fileDescriptorToSend=fileStorage_service_1.default.getFileDescriptorById(forwardedMessage.fileId)),!fileDescriptorToSend){_context351.next=13;break}if(_context351.t0=fileDescriptorToSend.ownerId!==contact_service_1.default.userContact.dbId,!_context351.t0){_context351.next=8;break}return _context351.next=7,fileStorage_service_1.default.copyFileToUserCloudStorage(fileDescriptorToSend.id);case 7:fileDescriptorToSend=_context351.sent;case 8:return _context351.next=10,this.shareFileToViewer(conversation,fileDescriptorToSend);case 10:newForwardedMsg=message_1.Message.createFileSharingMessage(forwardedMessage.id,forwardedMessage.date,forwardedMessage.from,forwardedMessage.side,forwardedMessage.data,forwardedMessage.status,fileDescriptorToSend.id,forwardedMessage.fileName,null,forwardedMessage.geoloc),_context351.next=14;break;case 13:newForwardedMsg=message_1.Message.create(forwardedMessage.id,forwardedMessage.date,forwardedMessage.from,forwardedMessage.side,forwardedMessage.getLastTextModified(),forwardedMessage.status);case 14:origConv.type===Conversation.Type.ONE_TO_ONE?newForwardedMsg.to=origConv.contact.jid!==forwardedMessage.from.jid?origConv.contact:contact_service_1.default.userContact:newForwardedMsg.to=origConv.room,id=Conversation.getUniqueMessageId(),creationDate=new Date,from=contact_service_1.default.userContact,(message=conversation.addForwardChatMessage(from,creationDate,id,newForwardedMsg,origConv))&&(this.pendingMessages[newForwardedMsg.id]={conversation:conversation,newForwardedMsg:newForwardedMsg},this.sendXmppMessage(conversation,message),forwardText&&forwardText.length&&this.sendChatMessage(conversation,forwardText));case 17:case"end":return _context351.stop()}}),_callee350,this)})))},this.shareFileToViewer=function(conversation,fileDescriptor){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee351(){var viewerType,viewerOrRoomId;return regenerator_default.a.wrap((function(_context352){for(;;)switch(_context352.prev=_context352.next){case 0:if(!fileDescriptor){_context352.next=10;break}return _context352.prev=1,viewerType=0===conversation.type?"user":"room",viewerOrRoomId=0===conversation.type?conversation.contact.dbId:conversation.room.dbId,_context352.next=5,fileStorage_service_1.default.addFileViewer(fileDescriptor.id,viewerOrRoomId,viewerType);case 5:_context352.next=10;break;case 7:throw _context352.prev=7,_context352.t0=_context352.catch(1),new Error(_context352.t0);case 10:case"end":return _context352.stop()}}),_callee351,null,[[1,7]])})))},this.sendFSMessage=function(conversation,file,data,voiceMessageData,attachedInfos){var urgency=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee352(){var cleanFile,viewerData,viewers,fileDescriptor,message,msgKey;return regenerator_default.a.wrap((function(_context353){for(;;)switch(_context353.prev=_context353.next){case 0:return _context353.prev=0,cleanFile=file,data&&0!==data.length||(data=cleanFile.name),viewerData=conversation.type===Conversation.Type.ONE_TO_ONE?{viewerId:conversation.contact.dbId,type:"user"}:{viewerId:conversation.room.dbId,type:"room"},viewers=fileViewer_1.FileViewer.createFromData([viewerData]),_context353.next=7,fileStorage_service_1.default.createFileDescriptor(file.name,file.name.split(".").pop(),file.size,viewers,voiceMessageData||!1);case 7:return(fileDescriptor=_context353.sent).fileToSend=file,fileDescriptor.isImage()&&file.preview&&(fileDescriptor.previewBlob=file.preview),(message="object"==typeof data?data:void 0)||(message=conversation.addFSMessage(fileDescriptor.id,data,fileDescriptor_1.FileState.UPLOADING,attachedInfos,null,urgency),attachedInfos&&!attachedInfos.attachedMsgId&&(message.attachedMsgId=message.id)),message.fileId=fileDescriptor.id,message.fileName=fileDescriptor.fileName,message.urgency=urgency,_context353.prev=11,service.pendingMessages[message.id]={conversation:conversation,message:message},fileDescriptor.setState(fileDescriptor_1.FileState.UPLOADING),$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor,cancelable:!0}),_context353.next=17,fileServerService.uploadAFileByChunk(fileDescriptor,file,message,null);case 17:fileDescriptor.setState(fileDescriptor_1.FileState.UPLOADED),fileDescriptor.fileToSend=null,fileDescriptor.chunkPerformed=0,fileDescriptor.chunkTotalNumber=0,$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor}),this.sendXmppMessage(conversation,message,fileDescriptor),_context353.next=28;break;case 25:throw _context353.prev=25,_context353.t0=_context353.catch(11),logger_service_1.default.error("[conversationService] sendFSMessage -- uploadAFile error"),attachedInfos||fileStorage_service_1.default.deleteFileDescriptor(fileDescriptor.id),fileDescriptor.setState("uploadError"),message.receiptStatus=message_1.Message.ReceiptStatus.ERROR,message.fileErrorMsg=_context353.t0.translatedMessage?_context353.t0.translatedMessage:"Unable to share file",message.sendUpdateEvent(),_context353.t0;case 28:return _context353.abrupt("return",message);case 31:throw _context353.prev=31,_context353.t1=_context353.catch(0),msgKey=_context353.t1.translatedMessage?_context353.t1.translatedMessage:"Unable to share file",403153===_context353.t1.errorDetailsCode&&(msgKey=i18n_service_1.default.translate("fileSharingNoMoreAllowedMsg")),$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"fileTransfer",popupBodyTranslated:msgKey,okLabel:"ok"}),new Error(_context353.t1);case 35:case"end":return _context353.stop()}}),_callee352,this,[[0,31],[11,25]])})))},this.resendFSMessage=function(conversation,message){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee353(){var fileDescriptor,msgKey;return regenerator_default.a.wrap((function(_context354){for(;;)switch(_context354.prev=_context354.next){case 0:if(_context354.prev=0,message){_context354.next=3;break}return _context354.abrupt("return");case 3:return fileDescriptor=fileStorage_service_1.default.getFileDescriptorById(message.fileId),_context354.prev=4,service.pendingMessages[message.id]={conversation:conversation,message:message},message.setReceiptStatus(message_1.Message.ReceiptStatus.IN_PROGRESS),fileDescriptor.chunkPerformedPercent=0,fileDescriptor.chunkPerformed=0,fileDescriptor.chunkTotalNumber=0,fileDescriptor.setState(fileDescriptor_1.FileState.UPLOADING),message.sendUpdateEvent(),$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor,cancelable:!0}),_context354.next=15,fileServerService.uploadAFileByChunk(fileDescriptor,fileDescriptor.fileToSend,message,null);case 15:fileDescriptor.setState(fileDescriptor_1.FileState.UPLOADED),fileDescriptor.fileToSend=null,fileDescriptor.chunkPerformed=0,fileDescriptor.chunkTotalNumber=0,$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor}),this.sendXmppMessage(conversation,message,fileDescriptor),_context354.next=26;break;case 23:throw _context354.prev=23,_context354.t0=_context354.catch(4),logger_service_1.default.error("[conversationService] sendFSMessage -- uploadAFile error"),fileDescriptor.setState("uploadError"),message.receiptStatus=message_1.Message.ReceiptStatus.ERROR,message.fileErrorMsg=_context354.t0.translatedMessage?_context354.t0.translatedMessage:"Unable to share file",message.sendUpdateEvent(),_context354.t0;case 26:_context354.next=32;break;case 28:throw _context354.prev=28,_context354.t1=_context354.catch(0),msgKey=_context354.t1.translatedMessage?_context354.t1.translatedMessage:"Unable to share file",403153===_context354.t1.errorDetailsCode&&(msgKey=i18n_service_1.default.translate("fileSharingNoMoreAllowedMsg")),$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"fileTransfer",popupBodyTranslated:msgKey,okLabel:"ok"}),new Error(_context354.t1);case 32:case"end":return _context354.stop()}}),_callee353,this,[[0,28],[4,23]])})))},this.sendEFSMessage=function(conversation,fileDescriptor,data,attachedInfos){var geoLoc=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,urgency=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee354(){var message,viewerType,viewerOrRoomId;return regenerator_default.a.wrap((function(_context355){for(;;)switch(_context355.prev=_context355.next){case 0:return message=null,_context355.prev=1,data&&0!==data.length||(data=fileDescriptor.fileName),(message=conversation.addFSMessage(fileDescriptor.id,data,fileDescriptor.state,attachedInfos,geoLoc,urgency)).fileName=fileDescriptor.fileName,attachedInfos&&!message.attachedMsgId&&(message.attachedMsgId=message.id),viewerType=conversation.type===Conversation.Type.ONE_TO_ONE?"user":"room",viewerOrRoomId=conversation.type===Conversation.Type.ONE_TO_ONE?conversation.contact.dbId:conversation.room.dbId,_context355.next=6,fileStorage_service_1.default.addFileViewer(fileDescriptor.id,viewerOrRoomId,viewerType);case 6:return this.sendXmppMessage(conversation,message,fileDescriptor),this.pendingMessages[message.id]={conversation:conversation,message:message},$rootScope.$broadcast("ON_SEND_EFS_MESSAGE",fileDescriptor),_context355.abrupt("return",message);case 12:_context355.prev=12,_context355.t0=_context355.catch(1),message.receiptStatus=message_1.Message.ReceiptStatus.ERROR,message.sendUpdateEvent();case 15:case"end":return _context355.stop()}}),_callee354,this,[[1,12]])})))},this.sendXmppMessage=function(conversation,message){var fileDescriptor=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!message)return null;var id=message.id,unicodeData=conversation.shortnameToUnicode(message.data),to=conversation.type===Conversation.Type.ONE_TO_ONE?conversation.contact.jid:conversation.room.jid,type=conversation.type===Conversation.Type.ONE_TO_ONE?"chat":"groupchat",xmppMessage=strophe_js_1.$msg({to:to,type:type,id:id,"xml:lang":contact_service_1.default.currentLanguage});return xmppMessage.c("body",{"xml:lang":contact_service_1.default.currentLanguage}).t(unicodeData).up(),xmppMessage.c("store",{xmlns:"urn:xmpp:hints"}).up(),xmppMessage.c("request",{xmlns:Conversation.ReceiptNS}).up(),xmppMessage.c("active",{xmlns:Conversation.ChatstatesNS}).up(),fileDescriptor&&(xmppMessage.c("x",{xmlns:"jabber:x:oob",index:message.attachIndex,count:message.attachNumber}).c("url",{},config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+fileDescriptor.id).c("mime",{},fileDescriptor.typeMIME).c("filename",{},fileDescriptor.fileName).c("size",{},fileDescriptor.size).up(),message.fileId=fileDescriptor.id,fileDescriptor.tags&&"voicemail"===fileDescriptor.tags.purpose&&xmppMessage.c("voicemessage",{xmlns:"http://jabber.org/protocol/voicemessage"}).up()),message.attachedMsgId&&xmppMessage.c("attach-to",{xmlns:"urn:xmpp:message-attaching:1",id:message.attachedMsgId}).up(),message.geoloc&&xmppMessage.c("geoLoc",{xmlns:"http://jabber.org/protocol/geoloc"}).c("lat",message.geoloc.lat).c("lon",message.geoloc.lon),message.alternativeContent&&xmppMessage.c("content",{xmlns:Conversation.contentNS,type:message.alternativeContent.type}).t(message.alternativeContent.message).up(),message.answeredMsgId&&xmppMessage.c("answeredMsg",{stamp:message.answeredMsgDate.getTime()}).t(message.answeredMsgId).up(),message.mentions&&message.mentions.length&&(xmppMessage.c("mention",{xmlns:Conversation.AttentionNS}),message.mentions.forEach((function(mention){xmppMessage.c("jid",{pos:mention.pos,size:mention.size},mention.jid)})),xmppMessage.up()),message.urgency&&"std"!==message.urgency&&xmppMessage.c("headers",{xmlns:"http://jabber.org/protocol/shim"}).c("header",{name:"Urgency"}).t(message.urgency).up().up(),message.forwardedMsg&&_this171.addXmppForwardMessage(conversation,xmppMessage,message),message.serverAckTimer=setTimeout((function(){message.receiptStatus=message_1.Message.ReceiptStatus.ERROR,message.sendUpdateEvent()}),1e4),message.setReceiptStatus(message_1.Message.ReceiptStatus.SENT),message.sendUpdateEvent(),xmpp_service_1.default.send(xmppMessage),conversation.room&&(conversation.room.lastActivityDate=new Date),message},this.addXmppForwardMessage=function(conversation,xmppMessage,message){xmppMessage.c("forwarded",{xmlns:Conversation.FORWARDNS});var unicodeData=conversation.shortnameToUnicode(message.forwardedMsg.data),from=message.forwardedMsg.from.fullJid?message.forwardedMsg.from.fullJid:message.forwardedMsg.from.jid;xmppMessage.c("message",{to:message.forwardedMsg.to.jid,from:from,id:message.forwardedMsg.id,type:message.forwardConvType,xmlns:"jabber:client"}),xmppMessage.c("body",{"xml:lang":contact_service_1.default.currentLanguage}).t(unicodeData).up();var fileDescriptor=fileStorage_service_1.default.getFileDescriptorById(message.forwardedMsg.fileId);fileDescriptor&&(xmppMessage.c("x",{xmlns:"jabber:x:oob",index:message.attachIndex,count:message.attachNumber}).c("url",{},fileDescriptor.state===fileDescriptor_1.FileState.UPLOADED?config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+fileDescriptor.id:"").c("mime",{},fileDescriptor.typeMIME).c("filename",{},fileDescriptor.fileName).c("size",{},fileDescriptor.size).up(),fileDescriptor.tags&&"voicemail"===fileDescriptor.tags.purpose&&xmppMessage.c("voicemessage",{xmlns:"http://jabber.org/protocol/voicemessage"}).up()),message.forwardedMsg.geoloc&&xmppMessage.c("geoLoc",{xmlns:"http://jabber.org/protocol/geoloc"}).c("lat",message.forwardedMsg.geoloc.lat).up().c("lon",message.forwardedMsg.geoloc.lon).up().up(),message.answeredMsgId&&xmppMessage.c("answeredMsg",{stamp:message.forwardedMsg.answeredMsgDate.getTime()}).t(message.forwardedMsg.answeredMsgId).up(),xmppMessage.up(),xmppMessage.up()},this.sendAckReadOrReceivedMessage=function(conversation,id,event){logger_service_1.default.info("[ConversationService] ".concat(conversation.id," send ").concat(event," status for message ").concat(id));var to=conversation.type===Conversation.Type.ONE_TO_ONE?conversation.contact.jid:conversation.room.jid,type=conversation.type===Conversation.Type.ONE_TO_ONE?"chat":"groupchat",from=contact_service_1.default.userContact.jid,receivedAttr={xmlns:Conversation.ReceiptNS,id:id,event:event,entity:"client"};conversation.type!==Conversation.Type.ONE_TO_ONE&&(receivedAttr.type="muc"),xmpp_service_1.default.send(strophe_js_1.$msg({to:to,from:from,type:type}).c("received",receivedAttr))},this.sendAckReceivedMessage=function(conversation,message){message.receiptStatus>=message_1.Message.ReceiptStatus.UNREAD||(_this171.sendAckReadOrReceivedMessage(conversation,message.id,"received"),message.setReceiptStatus(message_1.Message.ReceiptStatus.UNREAD))},this.sendAckReadMessage=function(conversation,message){message.receiptStatus!==message_1.Message.ReceiptStatus.READ&&(_this171.sendAckReadOrReceivedMessage(conversation,message.id,"read"),message.setReceiptStatus(message_1.Message.ReceiptStatus.READ),message.replaceMsgs&&message.replaceMsgs.length&&message.replaceMsgs.forEach((function(msg){_this171.sendAckReadOrReceivedMessage(conversation,msg.id,"read")})))},this.sendAckReadMessages=function(conversation){logger_service_1.default.info("[ConversationService] ".concat(conversation.id," sendAckReadMessages"));var result=!1;return conversation.messages.forEach((function(message){message.receiptStatus!==message_1.Message.ReceiptStatus.SENT&&message.receiptStatus!==message_1.Message.ReceiptStatus.UNREAD||message.side!==message_1.Message.Side.LEFT&&message.side!==message_1.Message.Side.ADMIN||(_this171.sendAckReadMessage(conversation,message),result=!0)})),result},this.sendChatStatus=function(conversation,status){if(conversation.status!==status){logger_service_1.default.info("[ConversationService] ".concat(conversation.id," setStatus ").concat(status.value)),conversation.status=status;var to=conversation.type===Conversation.Type.ONE_TO_ONE?conversation.contact.jid:conversation.room.jid,type=conversation.type===Conversation.Type.ONE_TO_ONE?"chat":"groupchat";xmpp_service_1.default.send(strophe_js_1.$msg({to:to,type:type}).c(status.value,{xmlns:Conversation.ChatstatesNS}))}},this.sendIsTypingState=function(conversation,isTypingState){var id=Conversation.getUniqueMessageId(),state=isTypingState?"composing":"active",to=conversation.type===Conversation.Type.ONE_TO_ONE?conversation.contact.jid:conversation.room.jid,type=conversation.type===Conversation.Type.ONE_TO_ONE?"chat":"groupchat",lang=contact_service_1.default.currentLanguage;xmpp_service_1.default.send(strophe_js_1.$msg({to:to,type:type,id:id,"xml:lang":lang}).c(state,{xmlns:Conversation.ChatstatesNS}).up())},this.sendRecordingMessage=function(conversation,data){var id=Conversation.getUniqueMessageId(),to=conversation.contact.jid,unicodeData=conversation.shortnameToUnicode(data),lang=contact_service_1.default.currentLanguage,message=conversation.addRecordingMessage(contact_service_1.default.userContact,new Date,unicodeData,id);if(!message)return null;var xmppMessage=strophe_js_1.$msg({to:to,type:"chat",id:id,"xml:lang":lang}).c("body",{"xml:lang":lang}).up().c("recording",{xmlns:"jabber:iq:recordingP2P"}).t(unicodeData).up().c("request",{xmlns:Conversation.ReceiptNS}).up().c("active",{xmlns:Conversation.ChatstatesNS}).up();return message.serverAckTimer=setTimeout((function(){message.receiptStatus=message_1.Message.ReceiptStatus.ERROR,message.sendUpdateEvent()}),1e4),xmpp_service_1.default.send(xmppMessage),_this171.pendingMessages[message.id]={conversation:conversation,message:message},message},this.sendCorrectedChatMessage=function(conversation,data,origMsgId,mentionsArray){var originalMessage=conversation.getMessageById(origMsgId);if(!originalMessage)return logger_service_1.default.info("[conversationService] sendCorrectedChatMessage - original message not found"),null;if(originalMessage.from.jid!==contact_service_1.default.userContact.jid)return logger_service_1.default.info("[conversationService] sendCorrectedChatMessage forbidden Action - only sent messages can be modified"),null;if(conversation.lastEditableMsg.id!==originalMessage.id)return logger_service_1.default.info("[conversationService] sendCorrectedChatMessage forbidden Action - only last sent message can be modified"),null;_this171.sendAckReadMessages(conversation);var id=Conversation.getUniqueMessageId(),to=conversation.type===Conversation.Type.ONE_TO_ONE?conversation.contact.jid:conversation.room.jid,type=conversation.type===Conversation.Type.ONE_TO_ONE?"chat":"groupchat",unicodeData=conversation.shortnameToUnicode(data),lang=contact_service_1.default.currentLanguage,xmppMessage=strophe_js_1.$msg({to:to,type:type,id:id,"xml:lang":lang}).c("body",{"xml:lang":contact_service_1.default.currentLanguage}).t(unicodeData).up().c("replace",{id:origMsgId,xmlns:"urn:xmpp:message-correct:0"}).up();return mentionsArray&&mentionsArray.length&&(xmppMessage.c("mention",{xmlns:Conversation.AttentionNS}),mentionsArray.forEach((function(mention){xmppMessage.c("jid",{pos:mention.pos,size:mention.size},mention.jid)}))),xmppMessage.c("store",{xmlns:"urn:xmpp:hints"}).up().c("request",{xmlns:Conversation.ReceiptNS}).up().c("active",{xmlns:Conversation.ChatstatesNS}).up(),originalMessage.serverAckTimer=setTimeout((function(){originalMessage.receiptStatus=message_1.Message.ReceiptStatus.ERROR,originalMessage.sendUpdateEvent()}),1e4),originalMessage.addReplaceMsg(id,data),xmpp_service_1.default.send(xmppMessage),conversation.room&&(conversation.room.lastActivityDate=new Date),conversation.updateAfterReplaceEvent(originalMessage),_this171.pendingMessages[id]={conversation:conversation,message:originalMessage},originalMessage},this.removeAllMessages=function(conversation){logger_service_1.default.info("[conversationService] removeAllMessage "+conversation.id);var defered=$q.defer(),mamRequest={queryid:xmpp_service_1.default.connection.getUniqueId(),with:conversation.id,onComplete:function(){defered.resolve()}},queryId=xmpp_service_1.default.connection.getUniqueId();return xmpp_service_1.default.connection.mam.delete(queryId,mamRequest),defered.promise},this.removeMessagesFromConversation=function(conversation,date,number){logger_service_1.default.info("[conversationService] removeMessagesFromConversation "+conversation.id),logger_service_1.default.info("[conversationService] removing "+number+" messages after "+date);var defered=$q.defer(),mamRequest={queryid:"remove_"+conversation.id,with:conversation.id,start:moment(date).format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),max:number,onComplete:function(){logger_service_1.default.info("[conversationService] MAM Message deleted !!!"),defered.resolve()}};return xmpp_service_1.default.connection.mam.delete(conversation.id,mamRequest),defered.promise},this.sendConversationByEmail=function(conversation){var defered=$q.defer(),userContact=contact_service_1.default.userContact,url=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+userContact.dbId+"/conversations/"+conversation.dbId+"/downloads";return $http({method:"POST",url:url,headers:auth_service_1.default.getRequestHeader(),data:{}}).then((function(){logger_service_1.default.error("[conversationService] sendConversationByEmail - success"),defered.resolve()}),(function(response){var error={message:"Impossible to download conversation",messageKey:null};response&&response.data&&409011===response.data.errorDetailsCode&&(error.message="No messages to export for the last 30 days.",error.messageKey="noMessagesToExport"),logger_service_1.default.error("[adminUserService] sendConversationByEmail - "+error.message),defered.reject(error)})),defered.promise},this.getHistoryPage=function(conversation,size){return service.isReinit?(logger_service_1.default.debug("[conversationService] getHistoryPage --- service is reinitialising !"),$q.reject(new Error("Service is reinitialising !"))):service.conversationServiceBulkHistoryHandler.getHistoryPage(conversation,size)},this.retrieveMsgByDate=function(conversation,msgDate){return logger_service_1.default.debug("[conversationService] >retrieveMsgByDate: "+msgDate),service.conversationHistoryHandler.retrieveMsgByDate(conversation,msgDate+"000")},this.searchTextInRoomsAndConversations=function(searchedText){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee355(){return regenerator_default.a.wrap((function(_context356){for(;;)switch(_context356.prev=_context356.next){case 0:return _context356.prev=0,this.searchTextConvResults.clearAll(),this.searchTextConvResults.isSearching=!0,_context356.next=5,Promise.all([this.searchTextInConversations(searchedText),this.searchTextInRooms(searchedText)]);case 5:this.searchTextConvResults.isSearching=!1,_context356.next=11;break;case 8:_context356.prev=8,_context356.t0=_context356.catch(0),this.searchTextConvResults.isSearching=!1;case 11:case"end":return _context356.stop()}}),_callee355,this,[[0,8]])})))},this.searchTextInConversations=function(searchedText){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee356(){var queryId,_this173=this;return regenerator_default.a.wrap((function(_context357){for(;;)switch(_context357.prev=_context357.next){case 0:return queryId=xmpp_service_1.default.connection.getUniqueId(),this.searchTextConvResults.queryIds.push(queryId),this.searchTextConvResults.searchedText=searchedText,_context357.next=5,service.conversationHistoryHandler.searchTextInConversations(queryId,searchedText);case 5:Object.keys(this.searchTextConvResults.partResults).forEach((function(jid){var result=_this173.searchTextConvResults.partResults[jid];result.room||contact_service_1.default.getOrCreateContact(jid).then((function(contact){result.contact=contact,_this173.sortResults(result),_this173.searchTextConvResults.totalCount+=result.convRes.length,_this173.searchTextConvResults.results.push(result),delete _this173.searchTextConvResults.partResults[jid]}))}));case 6:case"end":return _context357.stop()}}),_callee356,this)})))},this.searchTextInRooms=function(searchedText){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee357(){var promisesArray,_this174=this;return regenerator_default.a.wrap((function(_context358){for(;;)switch(_context358.prev=_context358.next){case 0:return promisesArray=room_service_1.default.getRooms().map((function(room){return room.desc&&room.desc.startsWith("Rainbow_OutlookCreation_InternalUseOnly")?Promise.resolve():_this174.searchTextInConversation(searchedText,!1,room.jid,"room")})),_context358.next=3,Promise.all(promisesArray);case 3:case"end":return _context358.stop()}}),_callee357)})))},this.searchTextInConversation=function(searchedText,clear,conversationId){var type=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee358(){var queryId,searchMethodName,count,result;return regenerator_default.a.wrap((function(_context359){for(;;)switch(_context359.prev=_context359.next){case 0:return clear&&this.searchTextConvResults.clearAll(),queryId=xmpp_service_1.default.connection.getUniqueId(),this.searchTextConvResults.searchedText=searchedText,this.searchTextConvResults.queryIds.push(queryId),searchMethodName="room"===type?"searchTextResultsInRoom":"searchTextResultsInConversation",_context359.next=6,service.conversationHistoryHandler[searchMethodName](queryId,searchedText,conversationId);case 6:count=_context359.sent,(result=this.searchTextConvResults.partResults[conversationId])&&(result.totalCount=count,this.sortResults(result),this.searchTextConvResults.totalCount+=count,this.searchTextConvResults.results.push(result),delete this.searchTextConvResults.partResults[conversationId]);case 9:case"end":return _context359.stop()}}),_callee358,this)})))},this.storeSearchTextResult=function(searchTextMsgResult){var jid=searchTextMsgResult.otherJid;if(!searchTextMsgResult.body.startsWith("/img")){var partialSearchTextResult=_this171.searchTextConvResults.partResults[jid];partialSearchTextResult||(partialSearchTextResult=new searchTextConvResults_1.SearchTextResult(jid),searchTextMsgResult.isRoom&&(partialSearchTextResult.room=room_service_1.default.getRoomByJid(jid)),_this171.searchTextConvResults.partResults[jid]=partialSearchTextResult),partialSearchTextResult.addMsgItem(searchTextMsgResult),partialSearchTextResult.totalCount++}},this.sortResults=function(searchTextResult){searchTextResult.convRes.sort((function(res1,res2){return res1.date?res2.date?res1.date-res2.date:1:-1}))},this.setActiveConversation=function(conversation){return logger_service_1.default.debug("[conversationService] - setActiveConversation: "+(conversation?conversation.id:"null")),this.activeConversation=conversation,this.activeConversation},this.setMostRecentConversationActive=function(){var conversations=service.getConversations().sort(service.sortFunction);return conversations.length>0?this.setActiveConversation(conversations.first()):this.setActiveConversation(null)},this.getActiveConversation=function(){return this.activeConversation},this.getConversationById=function(conversationId){return service.conversations?service.conversations[conversationId]:null},this.getConversations=function(){var conversationArray=[];for(var key in service.conversations)service.conversations.hasOwnProperty(key)&&conversationArray.push(service.conversations[key]);return conversationArray},this.orderConversations=function(){service.inCallConversations=[],service.idleConversations=[],service.involvedContactIds=[],Object.keys(service.conversations).forEach((function(key){var conversation=service.conversations[key];if(conversation.type===Conversation.Type.ROOM&&conversation.room.owner&&conversation.room.isMeetingRoom()){var confSession=pgiConference_service_1.default.getConferenceSessionById(conversation.room.getPstnConfEndpointId());if(confSession&&confSession.active)return void service.inCallConversations.push(conversation)}conversation.isInCall()?service.inCallConversations.push(conversation):service.idleConversations.push(conversation),conversation.type===Conversation.Type.ONE_TO_ONE&&service.involvedContactIds.push(conversation.contact.id)})),service.idleConversations.sort(service.sortFunction),service.publish(event_model_1.RBEvent.create("reorder"))},this.getOrderedConversations=function(){return{inCall:service.inCallConversations,idle:service.idleConversations,contactIds:service.involvedContactIds}},this.sortFunction=function(aa,bb){var aDate=!aa.lastModification&&aa.creationDate?aa.creationDate:aa.lastModification;return(!bb.lastModification&&bb.creationDate?bb.creationDate:bb.lastModification)-aDate},this.sortDataFunction=function(aa,bb){var aDate=!aa.lastModificationSort&&aa.creationDateSort?aa.creationDateSort:aa.lastModificationSort;return(!bb.lastModificationSort&&bb.creationDateSort?bb.creationDateSort:bb.lastModificationSort)-aDate},this.formatDate=function(date){return moment(date).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z"},this.resetConversationMissedCounters=function(conversation){$rootScope.appVisible&&(conversation.missedCounter=0,conversation.missedCalls=0,this.updateMissedCounters())},this.decreaseMissedIMCounterForConversation=function(conversation){conversation.missedCounter>0&&(conversation.missedCounter-=1),this.updateMissedCounters()},this.updateMissedCounters=function(){var missedIMCounter=0,missedIMDetails=[];Object.keys(service.conversations).forEach((function(key){var conversation=service.conversations[key];0!==conversation.missedCounter&&(missedIMCounter+=conversation.missedCounter,missedIMDetails.push(conversation))})),missedIMCounter===this.currentMissedIMCounter&&0===this.currentMissedCallCounter||(this.currentMissedIMCounter=missedIMCounter,this.currentMissedCallCounter=0,$rootScope.$broadcast("ON_MISSED_COUNTER_CHANGED_EVENT",{missedIMCounter:missedIMCounter,missedCallCounter:0,missedIMDetails:missedIMDetails}))},this.dropConversationCall=function(conversation){conversation.audioCall&&telephonyService.releaseCall(conversation.audioCall),conversation.videoCall&&(videoService.attachLocalMediaStream(!1),videoService.attachDistantMediaStream(!1),videoService.releaseCall(conversation.videoCall))},this.holdConversationCall=function(conversation){conversation.audioCall&&(telephonyService.holdCall(conversation.audioCall),conversation.videoCall&&(videoService.attachLocalMediaStream(!1),videoService.attachDistantMediaStream(!1),videoService.releaseCall(conversation.videoCall)))},this.retrieveConversationCall=function(conversation){conversation.audioCall&&telephonyService.retrieveCall(conversation.audioCall),conversation.videoCall&&logger_service_1.default.error("Not implemented for the moment")},this.allowDesktopSharing=function(){return!1},this.allowAdvancedDesktopSharing=function(){return!1},this.updateConversationCall=function(conversation,call){call.type===call_model_1.Call.Type.WEBRTC?conversation.videoCall=call:call.type===call_model_1.Call.Type.PHONE&&(conversation.audioCall=call),call.setConversationId(conversation.id),!call.isConference&&conversation.contact&&_this171.computeCapabilitiesForContact(conversation.contact),_this171.computeCapabilitiesForMyContact()},this.computeCapabilitiesForContact=function(contact,skipUpdateConversation){var telephony=!1,webRTC=!1,sharedDesktop=!1,fileTransfert=!1,addMedia=!1,contactStatus=contact.status,fullJid=contact.fullJid,myContact=contact_service_1.default.userContact;if(contact.jid!==myContact.jid){var isContactInMyCompany=contact.company&&contact_service_1.default.userContact.company&&"Rainbow"!==contact.company.name&&"Default"!==contact.company.name&&contact.company.name===contact_service_1.default.userContact.company.name,conversation=_this171.getConversationById(contact.id);if(videoService.started){var videoCall=conversation?conversation.videoCall:null;videoCall&&videoCall.status!==call_model_1.Call.Status.UNKNOWN||!(("unknown"===contactStatus||"wait"===contactStatus)&&isContactInMyCompany||"online"===contactStatus||"online-mobile"===contactStatus||"away"===contactStatus||"busy"===contactStatus&&"audioPhone"===contact.message)||(contact.webrtcAudioEnabled&&(webRTC=!0),sharedDesktop=!0)}if(telephonyService.started){var phoneNumberAvailable=contact.phonePro||contact.phonePbx&&contact.pbxId||contact.mobilePro||contact.phonePerso||contact.mobilePerso,audioCalls=telephonyService.getActiveCallsForContact(contact);0===audioCalls.length&&phoneNumberAvailable&&(telephony=!0),(0!==audioCalls.length||videoService.getMediaPillarAudioCall())&&fullJid&&(addMedia=!0)}"online"!==contactStatus&&"busy"!==contactStatus&&"away"!==contactStatus&&"dnd"!==contactStatus||(fileTransfert=!0);var capabilities={telephony:telephony,webRTC:webRTC,sharedDesktop:sharedDesktop,fileTransfert:fileTransfert,mediaAvailable:telephony||webRTC,addMedia:addMedia};(contact.isBot||contact.displayName&&-1!==contact.displayName.indexOf("E-HELPER"))&&(capabilities={telephony:!1,webRTC:!1,sharedDesktop:!1,fileTransfert:!1,mediaAvailable:!1,addMedia:!1}),contact.capabilities=capabilities,conversation&&(conversation.capabilities=capabilities,skipUpdateConversation||$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT",conversation,Conversation.EventType.CAPABILITIES))}else _this171.computeCapabilitiesForMyContact()},this.computeCapabilitiesForMyContact=function(){var telephony=!1,webRTC=!1,sharedDesktop=!1,myContact=contact_service_1.default.userContact;if(videoService.started){var isInCallWebRtc=videoService.isUserContactInCall();isInCallWebRtc||"busy"===myContact.status&&("busy"!==myContact.status||"audioPhone"!==myContact.message)||(myContact.webrtcAudioEnabled&&(webRTC=!0),service.allowDesktopSharing()&&(sharedDesktop=!0)),isInCallWebRtc&&videoService.getMediaPillarAudioCall()&&!videoService.getCurrentSharingCall()&&service.allowDesktopSharing()&&(sharedDesktop=!0)}if(telephonyService.started){var calls=telephonyService.getCalls();webrtcGatewayService.isMediaPillarCallSituation()&&Object.keys(videoService.calls).length>=1?telephony=!!(calls.length>=1&&service.isSecondCallAllowed):(0===calls.length&&service.isBasicCallAllowed||1===calls.length&&service.isSecondCallAllowed)&&(telephony=!0)}var capabilities={telephony:telephony,webRTC:webRTC,sharedDesktop:sharedDesktop,mediaAvailable:telephony||webRTC};logger_service_1.default.debug("[ConversationService] computeCapabilitiesForMyContact  capabilities "+JSON.stringify(capabilities)),myContact.capabilities=capabilities},this.onCallEvent=function(call){var fromWebRtcGW=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(call.type){case call_model_1.Call.Type.WEBRTC:_this171.handleWebRtcCallEvent(call);break;case call_model_1.Call.Type.PHONE:_this171.handleTelephonyCallEvent(call,fromWebRtcGW)}},this.handleWebRtcCallEvent=function(call){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee359(){var _this175=this;return regenerator_default.a.wrap((function(_context360){for(;;)switch(_context360.prev=_context360.next){case 0:webrtcGatewayService.isMediaPillarJid(call.fullJid)?($rootScope.$broadcast("ON_MPMEDIA_CONVERSATION_CALL_UPDATED_EVENT",{call:call}),call.status===call_model_1.Call.Status.ACTIVE&&call.mediaPillarCall&&(call.mediaPillarCall.telephonyCallRefs||[]).forEach((function(telCall){if(null!==telCall&&telCall.type.value===call_model_1.Call.Type.PHONE.value){var conversation=_this175.getConversationById(telCall.conversationId);conversation&&conversation.rxSubject.next({name:"callUpdate",value:call})}})),call.status!==call_model_1.Call.Status.RINGING_INCOMMING&&(this.computeCapabilitiesForMyContact(),$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:call}))):service.getOrCreateOneToOneConversation(call.contact.id).then((function(conversation){service.updateConversationCall(conversation,call),service.orderConversations(),conversation.rxSubject.next({name:"callUpdate",value:call}),$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:conversation,call:call})}));case 1:case"end":return _context360.stop()}}),_callee359,this)})))},this.isTempTelephonyConversation=function(call){return!call.contact||call.contact.temp||call.isConference||contact_service_1.default.isUserContact(call.contact)},this.handleTelephonyCallEvent=function(call){var fromWebRtcGW=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee360(){var conv,_conv,phoneCalls,remainingCall,remainingConversation,calls,isTempConversation,conversation,previousConv,_this176=this;return regenerator_default.a.wrap((function(_context361){for(;;)switch(_context361.prev=_context361.next){case 0:if(call.status===call_model_1.Call.Status.UNKNOWN&&(call.conversationId&&(call.conversationId===call.id?((conv=this.getConversationById(call.id))&&this.removeConversation(conv),$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:call})):((_conv=this.getConversationById(call.conversationId))&&(logger_service_1.default.info("[ConversationService] onCallEvent call "+call.id+" conversation "+call.conversationId+" : set inactive"),_conv.audioCall=null),$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:_conv,call:call})),this.orderConversations(),1!==(phoneCalls=telephonyService.getCalls()).length||!phoneCalls[0]||phoneCalls[0].status!==call_model_1.Call.Status.HOLD&&phoneCalls[0].status!==call_model_1.Call.Status.PUT_ON_HOLD&&phoneCalls[0].status!==call_model_1.Call.Status.ACTIVE||(remainingCall=phoneCalls[0],(remainingConversation=!remainingCall.contact||remainingCall.contact.temp||remainingCall.contact.jid===contact_service_1.default.userContact.jid?this.getOrCreateTelephonyConversation(remainingCall):this.getConversationById(remainingCall.contact.id))&&setTimeout((function(){_this176.publish(event_model_1.RBEvent.create("activeConversation",remainingConversation))}),200))),call.contact&&!telephonyService.getConferenceCallForContact(call.contact)&&videoService.endAllCallsForContact(call.contact),call.isConference&&setTimeout((function(){(call.participants||[]).forEach((function(participantContact){participantContact&&0===telephonyService.getActiveCallsForContact(participantContact).length&&videoService.endAllCallsForContact(participantContact)}))}),1e3)),fromWebRtcGW||!webrtcGatewayService.isMediaPillarCallSituation(call)){_context361.next=6;break}if(call.isSecondary){_context361.next=4;break}return _context361.abrupt("return",void $rootScope.$broadcast("ON_UPDATE_TELEPHONY_ICON_EVENT"));case 4:if(call.status!==call_model_1.Call.Status.RINGING_INCOMMING||"MAKECALL"===call.lastCause||"CALLBACK"===call.lastCause){_context361.next=6;break}return _context361.abrupt("return");case 6:if(call.status===call_model_1.Call.Status.UNKNOWN||null===call.connectionId){_context361.next=31;break}if(this.isSecondCallAllowed){_context361.next=11;break}if(!((calls=telephonyService.getNotIdleCalls()).length>1&&calls.findIndex((function(calliter){return calliter.id===call.id}))>0)){_context361.next=11;break}return _context361.abrupt("return");case 11:if(isTempConversation=this.isTempTelephonyConversation(call),logger_service_1.default.info("[ConversationService] onCallEvent -- "+call.connectionId+"  -- relevantEquipmentId : "+call.relevantEquipmentId+" "+(call.status?call.status.value:"null")+" isTempConversation: "+isTempConversation),conversation=isTempConversation?this.getOrCreateTelephonyConversation(call):this.getConversationById(call.contact.id),_context361.t0=conversation,_context361.t0){_context361.next=24;break}if(!isTempConversation){_context361.next=20;break}_context361.t1=this.getOrCreateTelephonyConversation(call),_context361.next=23;break;case 20:return _context361.next=22,this.getOrCreateOneToOneConversation(call.contact.id);case 22:_context361.t1=_context361.sent;case 23:conversation=_context361.t1;case 24:if(isTempConversation&&conversation.contact&&call.contact&&(call.contact.firstname||call.contact.lastname)&&conversation.contact.updateName(call.contact.firstname,call.contact.lastname),isTempConversation&&!call.isConference&&call.conversationId===call.id&&!conversation.contact&&conversation.telephonyContacts&&(logger_service_1.default.info("[ConversationService] onCallEvent -- "+call.connectionId+" : remove prevous conference conversation "+call.id),this.removeConversation(conversation),$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:call}),conversation=this.getOrCreateTelephonyConversation(call)),!call.conversationId||call.conversationId===conversation.id){_context361.next=28;break}call.conversationId===call.id?!isTempConversation&&this.conversations[call.id]&&(logger_service_1.default.info("[ConversationService] onCallEvent -- "+call.connectionId+" : remove prevous temp conversation "+call.id),delete this.conversations[call.id]):(previousConv=this.getConversationById(call.conversationId))&&(logger_service_1.default.info("[ConversationService] onCallEvent -- "+call.connectionId+" : set previous conversation to known rainbow contact inactive "+call.conversationId),previousConv.audioCall=null,$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:previousConv,call:call}));case 28:if(this.updateConversationCall(conversation,call),call.status!==call_model_1.Call.Status.ACTIVE&&call.status!==call_model_1.Call.Status.DIALING&&call.status!==call_model_1.Call.Status.RINGING_OUTGOING||setTimeout((function(){_this176.publish(event_model_1.RBEvent.create("activeConversation",conversation))}),200),this.orderConversations(),$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:conversation,call:call}),conversation.rxSubject.next({name:"callUpdate",value:call}),call.getDeviceIdFromConnectionIdFromCall()===call.relevantEquipmentId||call.status===call_model_1.Call.Status.ACTIVE){_context361.next=31;break}return _context361.abrupt("return",void $rootScope.$broadcast("ON_UPDATE_TELEPHONY_ICON_EVENT"));case 31:call.status!==call_model_1.Call.Status.ERROR||call.connectionId||this.publish(event_model_1.RBEvent.create("callError",call));case 32:case"end":return _context361.stop()}}),_callee360,this)})))},this.onPGiConferenceStateEvent=function(active){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee361(){var currentMeetingRoom;return regenerator_default.a.wrap((function(_context362){for(;;)switch(_context362.prev=_context362.next){case 0:if(!active){_context362.next=12;break}return _context362.prev=1,_context362.next=4,room_service_1.default.retrieveCurrentPersonalAudioRoom();case 4:return currentMeetingRoom=_context362.sent,_context362.next=7,this.getRoomConversation(currentMeetingRoom.jid);case 7:_context362.next=12;break;case 9:_context362.prev=9,_context362.t0=_context362.catch(1),logger_service_1.default.debug("[conversationService] error handling pgi conference event");case 12:service.orderConversations();case 13:case"end":return _context362.stop()}}),_callee361,this,[[1,9]])})))},this.onReloadCapabilitiesForMyContactEvent=function(__event){logger_service_1.default.info("[conversationService] onReloadCapabilitiesForMyContactEvent"),service.computeCapabilitiesForMyContact()},this.onConversationEvent=function(){service.updateMissedCounters()},this.onContactChangedEvent=function(__event,contact){service.computeCapabilitiesForContact(contact),service.computeCapabilitiesForMyContact()},this.onTelephonyStateChangeEvent=function(__event){var conversations=service.getConversations();conversations&&conversations.forEach((function(conversation){conversation.type===Conversation.Type.ONE_TO_ONE&&service.computeCapabilitiesForContact(conversation.contact)})),service.computeCapabilitiesForMyContact()},this.onConferenceStateChangeEvent=function(){service.updateRoomConferences(),service.orderConversations(),$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT")},this.onConferenceParticipantChangeEvent=function(){service.orderConversations(),$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT")},this.onRoomChangedEvent=function(__event,room,action){if(room){var conversation=service.getConversationById(room.jid);conversation&&("remove"===action?service.closeConversation(conversation):conversation.room=room)}},this.onRoomHistoryChangedEvent=function(__event,room){if(room){var conversation=service.getConversationById(room.jid);conversation&&conversation.chatRenderer&&(conversation.reset(),conversation.chatRenderer.loadMore())}},this.onRoomAdminMessageEvent=function(__event,roomJid,userJid,type,msgId){logger_service_1.default.info("[conversationService] onRoomAdminMessageEvent");var conversation=service.getConversationById(roomJid);conversation&&"welcome"===type&&conversation.room&&conversation.room.ownerContact&&(userJid=conversation.room.ownerContact.jid);var contact=contact_service_1.default.getContactByJid(userJid);if(conversation&&contact){if(!conversation.room.owner&&"invitation"===type)return;if(conversation.room&&conversation.room.isMeetingRoom())return;service.conversationServiceEventHandler.onRoomAdminMessageReceived(conversation,contact,type,msgId)}},this.onRoomAddConferenceEvent=function(__event){logger_service_1.default.info("[conversationService] onRoomAddConferenceEvent"),service.updateRoomConferences(),service.orderConversations(),$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT")},this.onMyContactChangedEvent=function(){service.getOrderedConversations().idle.forEach((function(conversation){conversation.type===Conversation.Type.ONE_TO_ONE&&service.computeCapabilitiesForContact(conversation.contact)})),service.computeCapabilitiesForMyContact()},this.reinit=function(){var defered=$q.defer();return logger_service_1.default.info("[conversationService] Re-initialize conversation service"),service.activeConversation&&(service.activeConversation.reset(),service.activeConversation=null),delete service.conversations,service.conversations=[],service.conversationCreationPromise||(service.conversationCreationPromise={}),service.botServiceReady=!0,service.isReinit=!0,logger_service_1.default.info("[conversationService] getServerConversations"),service.getServerConversations().then((function(){service.isReinit=!1,service.linkAllActiveCallsToConversations(),$rootScope.$broadcast("ON_MISSED_COUNTER_CHANGED_EVENT",{missedIMCounter:this.currentMissedIMCounter,missedCallCounter:this.currentMissedCallCounter}),defered.resolve()})).catch((function(){service.isReinit=!1,$interval((function(){logger_service_1.default.info("[conversationService] getServerConversations failure, try again"),service.getServerConversations().then((function(){service.linkAllActiveCallsToConversations()}))}),1e4,1,!0),defered.resolve()})),defered.promise},this.linkAllActiveCallsToConversations=function(){for(var key in telephonyService.calls)if(telephonyService.calls.hasOwnProperty(key)){var _call2=telephonyService.calls[key];$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",_call2)}for(var _key5 in videoService.calls)if(videoService.calls.hasOwnProperty(_key5)){var _call3=videoService.calls[_key5];$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",_call3)}},this.unlockWaitingBotConversations=function(isBotServiceReady){isBotServiceReady&&(service.botServiceReady=!0),service.botServiceReady&&(service.waitingBotConversations.forEach((function(obj,index){var contact=contact_service_1.default.getContactByJid(obj.jid);contact&&(service.getOrCreateOneToOneConversation(contact.jid,obj.conversationDbId,obj.lastModification,obj.lastMessageText,obj.missedIMCounter,obj.muted,obj.creationDate),service.waitingBotConversations.splice(index,1))})),service.waitingBotConversations=[])},this.askForSharing=function(convId,contact){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee362(){var message;return regenerator_default.a.wrap((function(_context363){for(;;)switch(_context363.prev=_context363.next){case 0:return(message=$iq({from:xmpp_service_1.default.jid,to:contact.fullJid,type:"set"})).c("command",{xmlns:"http://jabber.org/protocol/commands",node:"request-transfert-sharing",convId:convId}),_context363.next=4,xmpp_service_1.default.sendIQ(message);case 4:case"end":return _context363.stop()}}),_callee362)})))},this.acceptTransfertSharing=function(convId,contact){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee363(){var message;return regenerator_default.a.wrap((function(_context364){for(;;)switch(_context364.prev=_context364.next){case 0:return(message=$iq({from:xmpp_service_1.default.jid,to:contact.fullJid,type:"set"})).c("command",{xmlns:"http://jabber.org/protocol/commands",node:"accept-transfert-sharing",convId:convId}),_context364.next=4,xmpp_service_1.default.sendIQ(message);case 4:case"end":return _context364.stop()}}),_callee363)})))},this.refuseTransfertSharing=function(convId,contact){return __awaiter(_this171,void 0,void 0,regenerator_default.a.mark((function _callee364(){var message;return regenerator_default.a.wrap((function(_context365){for(;;)switch(_context365.prev=_context365.next){case 0:return(message=$iq({from:xmpp_service_1.default.jid,to:contact.fullJid,type:"set"})).c("command",{xmlns:"http://jabber.org/protocol/commands",node:"refuse-transfert-sharing",convId:convId}),_context365.next=4,xmpp_service_1.default.sendIQ(message);case 4:case"end":return _context365.stop()}}),_callee364)})))},this.onAskSharingMessageReceived=function(stanza){try{var stanzaElem=$(stanza),from=stanzaElem.attr("from"),fromContact=contact_service_1.default.getContactByJid(xmpp_service_1.default.getBareJidFromJid(from)),commandElem=stanzaElem.find("command"),conversationId=commandElem.attr("convId"),conversation=_this171.getConversationById(conversationId);if(commandElem.length>0)switch(commandElem.attr("node")){case"request-transfert-sharing":conversation.rxSubject.next({name:"request-transfert-sharing",fromContact:fromContact});break;case"accept-transfert-sharing":conversation.rxSubject.next({name:"accept-transfert-sharing",fromContact:fromContact});break;case"refuse-transfert-sharing":conversation.rxSubject.next({name:"refuse-transfert-sharing",fromContact:fromContact})}}catch(error){return!0}return!0},this.cleanUnwantedConversations=function(){Object.keys(service.conversations).forEach((function(key){var conversation=service.conversations[key];conversation.type===Conversation.Type.ROOM&&(!contact_service_1.default.userContact.roomsEnabled||conversation.room&&conversation.room.isMeetingRoom()&&!contact_service_1.default.userContact.phoneMeetingsEnabled)&&(logger_service_1.default.info("cleanUnwantedConversations -- close conversation "+conversation.id+" due to customisation limitation"),service.closeConversation(conversation))}))}}])},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),FilePublicDownload=function(){function FilePublicDownload(){var url=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,fileName=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,totalBytes=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,receivedBytes=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,savePath=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;_classCallCheck(this,FilePublicDownload),this.url=url,this.fileName=fileName,this.totalBytes=totalBytes,this.receivedBytes=receivedBytes,this.savePath=savePath,this.isCanceled=!1,this.openFolderOnceDownloadFinished=!1,this.progressSubject=new rxjs_1.Subject}return _createClass(FilePublicDownload,[{key:"isDownloadFinished",value:function(){return this.receivedBytes===this.totalBytes}},{key:"askCancel",value:function(){this.isCanceled=!0,this.progressSubject.next()}}],[{key:"create",value:function(url,fileName,totalBytes,receivedBytes,savePath){return new FilePublicDownload(url,fileName,totalBytes,receivedBytes,savePath)}}]),FilePublicDownload}();exports.FilePublicDownload=FilePublicDownload},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var message_1=__webpack_require__(16),fileDescriptor_1=__webpack_require__(54),strophe_js_1=__webpack_require__(76),moment=__webpack_require__(3);__webpack_require__(227);var contact_service_1=__webpack_require__(1),xmpp_service_1=__webpack_require__(4),i18n_service_1=__webpack_require__(38),logger_service_1=__webpack_require__(15),fileStorage_service_1=__webpack_require__(25);exports.ConversationServiceBulkHistoryHandler=function(){function _class11(conversationService,fileServerService){_classCallCheck(this,_class11),this.conversationService=conversationService,this.fileServerService=fileServerService,this.xmppService=xmpp_service_1.default,this.i18n=i18n_service_1.default,this.logger=logger_service_1.default,this.contactService=contact_service_1.default,this.fileStorageService=fileStorage_service_1.default}return _createClass(_class11,[{key:"getHistoryPage",value:function(conversation,nbMessage){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee365(){return regenerator_default.a.wrap((function(_context366){for(;;)switch(_context366.prev=_context366.next){case 0:return this.logger.info("[ConversationServiceBulkHistoryHandler] getHistoryPage(".concat(conversation.id,")")),_context366.prev=1,_context366.abrupt("return",this.getHistoryPageInternal(conversation,nbMessage));case 5:return _context366.prev=5,_context366.t0=_context366.catch(1),_context366.abrupt("return",(this.logger.info("[ConversationServiceBulkHistoryHandler] "+_context366.t0.message),null));case 8:case"end":return _context366.stop()}}),_callee365,this,[[1,5]])})))}},{key:"getHistoryPageAroundMessage",value:function(conversation,messageHistoryIndex){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee366(){return regenerator_default.a.wrap((function(_context367){for(;;)switch(_context367.prev=_context367.next){case 0:return this.logger.info("[ConversationServiceBulkHistoryHandler] getHistoryPageAroundDate(".concat(conversation.id,", ").concat(messageHistoryIndex,")")),_context367.next=3,this.getHistoryPageInternal(conversation,15,"after",messageHistoryIndex);case 3:return _context367.next=5,this.getHistoryPageInternal(conversation,15,"before",messageHistoryIndex);case 5:case"end":return _context367.stop()}}),_callee366,this)})))}},{key:"getHistoryPageInternal",value:function(conversation,nbMessages){var direction=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"before",messageHistoryIndex=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee367(){var resultPromise,errorMessage,_errorMessage2,queryId,iqId,toAttr,withField,iq,historyRefDate,startRequestDate,requestDuration;return regenerator_default.a.wrap((function(_context368){for(;;)switch(_context368.prev=_context368.next){case 0:if(this.logger.info("[ConversationServiceBulkHistoryHandler] getHistoryPage(".concat(conversation.id,", ").concat(nbMessages,")")),resultPromise=new Promise((function(resolve,reject){conversation.historyDefered={resolve:resolve}})),_context368.t0=conversation.room&&conversation.room.initPresPromise,!_context368.t0){_context368.next=6;break}return _context368.next=6,conversation.room.initPresPromise.promise;case 6:if(!conversation.currentHistoryId||conversation.currentHistoryId!==conversation.historyIndex){_context368.next=9;break}throw errorMessage="getHistoryPage(".concat(conversation.id,", ").concat(nbMessages,", ").concat(conversation.historyIndex,") --- already asked"),this.logger.info("[ConversationServiceBulkHistoryHandler] "+errorMessage),new Error(errorMessage);case 9:if(conversation.currentHistoryId=conversation.historyIndex,!conversation.historyComplete){_context368.next=12;break}throw _errorMessage2="getHistoryPage(".concat(conversation.id,") --- complete"),this.logger.info("[ConversationServiceBulkHistoryHandler] "+_errorMessage2),new Error(_errorMessage2);case 12:return queryId=conversation.id,iqId=this.xmppService.connection.getUniqueId(),toAttr=conversation.room?conversation.room.jid:null,withField=conversation.room?this.contactService.userContact.jid:conversation.id,iq=strophe_js_1.$iq({id:iqId,to:toAttr,type:"set"}).c("query",{queryid:queryId,xmlns:"urn:xmpp:mam:1:bulk"}).c("x",{xmlns:"jabber:x:data",type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"with"}).c("value").t(withField).up().up().up().c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(nbMessages).up(),messageHistoryIndex?(historyRefDate="after"===direction?Number(messageHistoryIndex)-1:messageHistoryIndex,iq.c(direction).t(historyRefDate)):-1===conversation.historyIndex?iq.c(direction).t(""):iq.c(direction).t(conversation.historyIndex),startRequestDate=performance.now(),_context368.next=17,this.xmppService.sendIQ(iq);case 17:return requestDuration=Math.round(performance.now()-startRequestDate),_context368.next=20,resultPromise;case 20:return this.logger.info("[ConversationServiceBulkHistoryHandler] getHistoryPage(".concat(conversation.id,") -- duration ").concat(requestDuration,"ms")),_context368.abrupt("return",conversation);case 22:case"end":return _context368.stop()}}),_callee367,this)})))}},{key:"resetHistory",value:function(conversation){var nbMessages=conversation.messages.length;if(nbMessages>30){this.logger.info("[ConversationServiceBulkHistoryHandler] resetHistory for conversation "+conversation.id);var nbMessageToRemove=nbMessages-30;conversation.messages.splice(0,nbMessageToRemove),conversation.currentHistoryId=null,conversation.historyComplete=!1,conversation.historyIndex=conversation.messages[0].historyIndex}}},{key:"onHistoryMessageReceived",value:function(stanza){var _this177=this;try{this.logger.info("[conversationService] onHistoryMessageReceived");var resultsElem=$(stanza).find("results");if(1===resultsElem.length){var resultElems=resultsElem.find("result");if(resultElems.length>0){var queryId=$(resultElems[0]).attr("queryid");this.logger.info('[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived "results" ('.concat(queryId,")"));var conversation=this.conversationService.getConversationById(queryId);conversation&&resultsElem.find("result").each((function(__index,resultElem){var messageElem=$(resultElem).find("forwarded message"),from=messageElem.attr("from"),forwardedMsg=$(messageElem).find("forwarded[xmlns='urn:xmpp:forward:0']");if(forwardedMsg&&forwardedMsg.length){_this177.logger.info("[ConversationServiceHistoryHandler] ("+conversation.id+") Forwarded Message detected");var origMsgId=messageElem.attr("id");messageElem=$(forwardedMsg).find("forwarded message"),_this177.createMessage(conversation,resultElem,messageElem,from,origMsgId,!0)}else _this177.createMessage(conversation,resultElem,messageElem,from,null,!1)}))}}else{var finElem=$(stanza).find("fin"),_queryId=finElem.attr("queryid");this.logger.info('[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived "fin" ('.concat(_queryId,")"));var _conversation3=this.conversationService.getConversationById(_queryId);if(_conversation3){if(_conversation3.historyComplete="true"===finElem.attr("complete"),_conversation3.historyIndex=$(finElem).find("set first").text(),_conversation3.messages.unshift.apply(_conversation3.messages,_conversation3.historyMessages),_conversation3.historyMessages=[],_conversation3.lastMessageText="",_conversation3.lastMessageSender=null,_conversation3.messages&&_conversation3.messages.length>0){var lastMessage=_conversation3.messages[_conversation3.messages.length-1];_conversation3.lastMessageText=lastMessage.data,_conversation3.lastMessageSender=lastMessage.from.id}_conversation3.historyDefered&&_conversation3.historyDefered.resolve()}}}catch(error){return this.logger.error("[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived -- failure -- "+error),!0}return!0}},{key:"createMessage",value:function(conversation,resultElem,messageElem,from,origMsgId,isForwardedMsg){var messageId=origMsgId||messageElem.attr("id");this.logger.info("[ConversationServiceHistoryHandler] : createMessage - searching for message "+messageId);var message=conversation.getMessageById(messageId);if(message||(message=conversation.historyMessages.find((function(item){return item.id===messageId}))),message||(message=conversation.getReplacedMessageById(messageId)),message)this.logger.info("[ConversationServiceHistoryHandler] ("+conversation.id+") try to add an already stored message with id "+message.id);else{var fromContact=null,type=messageElem.attr("type"),fromJid=from&&0===from.indexOf("room_")?from.split("/")[1]:this.xmppService.getBareJidFromJid(from),roomEvent=null;if(!fromJid){var eventElem=$(resultElem).find("event");if(eventElem.length){if(fromJid=eventElem.attr("jid"),roomEvent=eventElem.attr("name"),conversation.room){if(conversation.room.isMeetingRoom()&&("welcome"===roomEvent||"conferenceAdd"===roomEvent||"conferenceRemove"===roomEvent||"invitation"===roomEvent))return;if("welcome"===roomEvent&&conversation.room.ownerContact&&(fromJid=conversation.room.ownerContact.jid),("conferenceAdd"===roomEvent||"conferenceRemove"===roomEvent)&&conversation.room.ownerContact){var user=conversation.room.getUserByJid(fromJid);fromContact=user&&user.contact?user.contact:conversation.room.ownerContact}}type="admin"}}if(fromJid){if("webrtc"===type){var callerJid=$(resultElem).find("caller").text();fromContact=this.contactService.getContact(callerJid)}fromContact||(fromContact=this.contactService.getContact(fromJid)),fromContact||(fromContact=this.contactService.createEmptyContact(fromJid));var date=new Date($(resultElem).find("forwarded delay").attr("stamp")),body=$(messageElem).find("body").text(),side=this.contactService.isUserContact(fromContact)?message_1.Message.Side.RIGHT:message_1.Message.Side.LEFT,geoloc=$(resultElem).find("geoloc"),geolocData=null;if(geoloc&&geoloc.length){var geolocElem=$(geoloc);geolocData={lon:geolocElem.find("lon").text(),lat:geolocElem.find("lat").text()}}var urgency="std",headersElem=$(messageElem).find("headers[xmlns='http://jabber.org/protocol/shim']");if(headersElem&&headersElem.length){var urgencyElem=$(headersElem).find("header[name='Urgency']");urgencyElem&&urgencyElem.length&&(urgency=urgencyElem.text())}var oob=$(messageElem).find("x[xmlns='jabber:x:oob']");if(oob&&oob.length&&(type="fileSharing"),$(resultElem).find("call_log").length){var state=$(resultElem).find("state").text();if("missed"===state)body="missedCall||"+date;else if("answered"===state){var duration=$(resultElem).find("duration")?parseInt($(resultElem).find("duration").text(),10):0,textDuration=duration>0?"(".concat(moment.duration(duration,"ms").format("h[H] mm[m] ss[s]"),")"):"";body="activeCallMsg||".concat(date,"||").concat(textDuration)}}switch(type){case"webrtc":message=message_1.Message.createWebRTCMessage(messageId,date,fromContact,side,body,!1);break;case"admin":message=message_1.Message.createBubbleAdminMessage(messageId,date,fromContact,roomEvent);break;case"fileSharing":message=this.createFileSharingMessage(oob,messageId,date,fromContact,side,body,geolocData);break;case"recording":break;default:var contents=$(resultElem).find("content[xmlns='urn:xmpp:content']"),isMarkdown=!1,additionalContent=null;contents&&contents.each((function(_ind,content){additionalContent||(additionalContent={});var contentType=$(content).attr("type"),contentMessage=$(content).text();"text/markdown"===contentType&&(isMarkdown=!0,body=contentMessage),additionalContent[contentType]={type:contentType,message:contentMessage}}));var mentions=null,mentionElem=$(resultElem).find("mention[xmlns='urn:xmpp:attention:0']");mentionElem.length&&(mentions=[],mentionElem.find("jid").each((function(_ind,content){var mention={};mention.jid=$(content).text(),mention.pos=parseInt($(content).attr("pos"),10),mention.size=parseInt($(content).attr("size"),10),mention.jid&&mention.size&&mentions.push(mention)})));var replace=$(resultElem).find("replace");if(replace&&replace.length){var replacedMsgId=replace.attr("id"),replacedMessage=conversation.getMessageByIdInHistory(replacedMsgId);if(replacedMessage||(replacedMessage=conversation.getMessageById(replacedMsgId)),replacedMessage||(message=replacedMessage=message_1.Message.create(replacedMsgId,date,fromContact,side,body,!1,isMarkdown,additionalContent,null,null,null,null,mentions)),fromContact.jid!==replacedMessage.from.jid)this.logger.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived : message Replaced by somebody else - Skip"),message=null;else if(replacedMessage){replacedMessage.addReplaceMsg(messageId,body),replacedMessage.mentions=mentions;var logBody=body.length?body.substr(0,1)+"***"+body.substr(body.length-1):"";this.logger.info("Add new history replace message for message "+messageId+" witn body "+logBody)}}else{var answeredMsg=$(resultElem).find("answeredMsg"),answeredMsgId=answeredMsg?answeredMsg.text():null,answeredMsgDate=answeredMsg?answeredMsg.attr("stamp"):null;if((message=message_1.Message.create(messageId,date,fromContact,side,body,!1,isMarkdown,additionalContent,null,answeredMsgId,answeredMsgDate,null,mentions)).urgency=urgency,answeredMsgId){var answeredMessage=conversation.getMessageByIdInHistory(answeredMsgId);answeredMessage?(answeredMessage.urgencyAck=!0,answeredMessage.sendUpdateEvent()):this.logger.error("[ConversationServiceEventHandler] Not possible to handle answeredMsg because replied msg not found")}}}if(message){message.isForwarded=isForwardedMsg,message.urgency=urgency,message.historyIndex=$(resultElem).attr("id");var ack=$(messageElem).find("ack");message.receiptStatus="true"===$(ack).attr("read")?5:"true"===$(ack).attr("recv")?4:3,conversation.addMessageInHistoryMessages(message),this.logger.info("Add new history message : "+message.getInfoForLogs())}}else this.logger.warn("[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived - Receive message without valid fromJid information")}}},{key:"createFileSharingMessage",value:function(oob,messageId,date,from,side,body,geoloc){var _this178=this,attention=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,oobElem=$(oob),url=oobElem.find("url").text(),fileName=oobElem.find("filename").text(),fileId=this.fileStorageService.extractFileIdFromUrl(url),message=message_1.Message.createFileSharingMessage(messageId,date,from,side,body,!1,fileId,fileName,null,geoloc,attention);return this.fileStorageService.retrieveAndStoreOneFileDescriptor(fileId).then((function(fileDescriptor){fileDescriptor&&fileDescriptor.state===fileDescriptor_1.FileState.NOT_UPLOADED&&(message.receiptStatus=1,message.fileErrorMsg=_this178.i18n.translate("file_notuploaded")),_this178.fileServerService.getBlobThumbnailFromFileDescriptor(fileDescriptor).then((function(blob){fileDescriptor.previewBlob=blob,fileDescriptor.previewBlobSubject.next(fileDescriptor.previewBlob)})).catch((function(){_this178.logger.info("[ConversationServiceBulkHistoryHandler] getBlobThumbnailFromFileDescriptor error "),fileDescriptor.previewBlobSubject.next(fileDescriptor.previewBlob)}))})).catch((function(error){_this178.logger.info("[ConversationServiceBulkHistoryHandler] createFileSharingMessage error "+error)})),message}}]),_class11}()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var MEDIATYPE,BehaviorSubject_1=__webpack_require__(66),distinctUntilChanged_1=__webpack_require__(75),conference_endpoint_model_1=__webpack_require__(333),conference_session_model_1=__webpack_require__(334),conference_participant_model_1=__webpack_require__(228),_escape=__webpack_require__(60),event_service_1=__webpack_require__(32),Subject_1=__webpack_require__(67),ReplaySubject_1=__webpack_require__(335),logger_service_1=__webpack_require__(15),contact_service_1=__webpack_require__(1),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),country_service_1=__webpack_require__(64),profile_service_1=__webpack_require__(6),room_service_1=__webpack_require__(33),i18n_service_1=__webpack_require__(38),errorHelper_service_1=__webpack_require__(37);!function(MEDIATYPE){MEDIATYPE.PSTNAUDIO="pstnAudio",MEDIATYPE.WEBRTC="webrtc",MEDIATYPE.WEBRTCSHARINGONLY="webrtcSharingOnly"}(MEDIATYPE=exports.MEDIATYPE||(exports.MEDIATYPE={})),exports.NgPgiConferenceService=function(){function _class12(){_classCallCheck(this,_class12),this.eventService=event_service_1.default,this.logger=logger_service_1.default,this.authService=auth_service_1.default,this.xmppService=xmpp_service_1.default,this.countryService=country_service_1.default,this.profileService=profile_service_1.default,this.contactService=contact_service_1.default,this.roomService=room_service_1.default,this.i18n=i18n_service_1.default,this.conferenceEndpoints={},this.conferenceEnpointsSubject=new Subject_1.Subject,this.conferenceSessions={},this.conferenceSessionsSubject=new ReplaySubject_1.ReplaySubject,this.started=!1,this.isPstnConferenceAvailable=!1,this.isPstnConferenceAvailableSubject=new BehaviorSubject_1.BehaviorSubject(this.isPstnConferenceAvailable),this.pstnConferencePhoneNumbers=null,this.startedSubject=new BehaviorSubject_1.BehaviorSubject(!1)}return _createClass(_class12,[{key:"start",value:function(stats){var _this179=this;this.logger.info("=== STARTING ===");var startDate=performance.now();this.confProvPortalURL=new URL(config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/"),this.confPortalURL=new URL(config.restServerUrl+"/api/rainbow/conference/v1.0/"),this.attachHandlers(),this.computePstnConferencePremission(),this.isPstnConferenceAvailableSubject.pipe(distinctUntilChanged_1.distinctUntilChanged()).subscribe((function(isPstnConferenceAvailable){isPstnConferenceAvailable&&_this179.initializeServiceData()})),this.started=!0;var startDuration=Math.round(performance.now()-startDate);stats.push({service:"PgiConferenceService",startDuration:startDuration}),this.logger.info("=== STARTED (".concat(startDuration," ms) ===")),this.startedSubject.next(!0),this.contactService.userContact.phoneMeetingsEnabledSubject.pipe(distinctUntilChanged_1.distinctUntilChanged()).subscribe((function(phoneMeetingsEnabled){phoneMeetingsEnabled||_this179.stop()}))}},{key:"stop",value:function(){this.logger.info(""),this.logger.info("[PgiConferenceService] === STOPPING ==="),this.isPstnConferenceAvailable=!1,this.started=!1,this.logger.info("[PgiConferenceService] === STOPPED ==="),this.startedSubject.next(!1)}},{key:"reconnectService",value:function(){this.logger.info("reconnectService"),this.attachHandlers(),this.refreshConferenceSessions()}},{key:"attachHandlers",value:function(){var _this180=this;this.xmppManagementHandler&&(this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.xmppManagementHandler=this.xmppService.addHandler((function(stanza){return _this180.onManagementMessage(stanza),!0}),null,"message","management"),this.conferenceHandler&&(this.xmppService.connection.deleteHandler(this.conferenceHandler),this.conferenceHandler=null),this.conferenceHandler=this.xmppService.connection.addHandler((function(stanza){return _this180.onConferenceMessage(stanza),!0}),"jabber:iq:conference","message",null)}},{key:"onManagementMessage",value:function(stanza){var stanzaElem=$(stanza);stanzaElem.find("confuseractivated ").length>0&&this.setPstnConferenceAvailability(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED));var confendpointElem=stanzaElem.find("confendpoint");if(confendpointElem.length&&"update"===confendpointElem.attr("action")){this.logger.info("onManagementMessage - update of conference");var conferenceId=stanzaElem.find("confendpointid").text();this.retrieveConference(conferenceId,!0)}}},{key:"onConferenceMessage",value:function(stanza){var stanzaElem=$(stanza),conferenceId=stanzaElem.find("conference-id").text(),conferenceSession=this.getConferenceSessionById(conferenceId);conferenceSession&&this.updateConferenceSession(stanzaElem,conferenceSession)}},{key:"updateConferenceSession",value:function(stanzaElem,conferenceSession){this.logger.info("updateConferenceSession - "+conferenceSession.id);var conferenceStateElem=stanzaElem.find("conference-state");if(conferenceStateElem.length){var isConferenceActive="true"===conferenceStateElem.find("active").text();this.updateState(conferenceSession,isConferenceActive)}var talkersElem=stanzaElem.find("talkers");if(talkersElem.length){var talkers=[];talkersElem.find("participant-id").each((function(__index,talker){var talkerParticipantId=$(talker).text();talkers.push(talkerParticipantId)})),this.logger.debug("update talkers with: "+talkers),conferenceSession.updateTalkers(talkers)}var participantsElem=stanzaElem.find("participants");if(0===participantsElem.length&&(participantsElem=stanzaElem.find("updated-participants")),participantsElem.length||(participantsElem=stanzaElem.find("added-participants")),participantsElem.length){var participants=[];participantsElem.find("participant").each((function(__index,participant){var participantElem=$(participant),participantId=participantElem.find("participant-id").text(),jid_im=participantElem.find("jid-im").text(),phoneNumber=participantElem.find("phone-number").text(),role=participantElem.find("role").text(),mute=participantElem.find("mute").text(),hold=participantElem.find("hold").text(),cnxState=participantElem.find("cnx-state").text();participants.push({participantId:participantId,jid_im:jid_im,phoneNumber:phoneNumber,participantRole:role,mute:"on"===mute,held:"on"===hold,participantState:cnxState})})),participants.length&&(conferenceSession.participants=participants)}var removedParticipantsElem=stanzaElem.find("removed-participants");if(removedParticipantsElem.length){var removedParticipants=[];removedParticipantsElem.find("participant-id").each((function(__index,removedParticipant){var removedParticipantId=$(removedParticipant).text();removedParticipants.push(removedParticipantId)})),this.logger.debug("remove participants: "+removedParticipants),conferenceSession.removeParticipants(removedParticipants)}this.conferenceSessionsSubject.next({id:conferenceSession.id,action:"updated"})}},{key:"updateState",value:function(conferenceSession,isConferenceActive){var lock=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee368(){var room,displayName,_roomName,message;return regenerator_default.a.wrap((function(_context369){for(;;)switch(_context369.prev=_context369.next){case 0:if(!conferenceSession.active||isConferenceActive){_context369.next=25;break}if(!this.contactService.userContact.guestMode||conferenceSession.type===MEDIATYPE.WEBRTCSHARINGONLY){_context369.next=3;break}return _context369.abrupt("return",(this.eventService.publish("ON_OPEN_POPUP","concludeInvitation"),conferenceSession.cleanupSessionData(),void conferenceSession.updateStateFromData(isConferenceActive,lock)));case 3:if(!(room=this.roomService.findRoomsWithConfId(conferenceSession.id)[0])){_context369.next=24;break}if(!room.owner||conferenceSession.id!==this.getPstnInstantConferenceEndpointId()){_context369.next=23;break}return _context369.prev=6,_context369.next=9,this.roomService.retrieveRoomConsumption();case 9:if(!(_context369.sent>this.profileService.getFeatureLimitMax(this.profileService.FeaturesEnum.BUBBLE_COUNT))){_context369.next=16;break}return this.eventService.publish("ON_OPEN_GLOBAL_POPUP",{popupTitle:"createBubble",popupBody:"maxCollabSpaceReached",okLabel:"ok"}),_context369.next=14,this.roomService.deletePersonalMeetingRoom();case 14:_context369.next=17;break;case 16:room.isMyPersonalMeetingRoom()&&this.eventService.publish("ON_SHOW_POPUP",{component:"renameMeeting",data:room});case 17:_context369.next=21;break;case 19:_context369.prev=19,_context369.t0=_context369.catch(6);case 21:_context369.next=24;break;case 23:!room.owner&&conferenceSession.isParticipantConnectedByJid(this.contactService.userContact.dbId)&&(displayName=_escape(room.ownerContact.displayName),_roomName=_escape(room.name),message=this.i18n.translate("meetingEndBy",{owner:displayName,meeting:_roomName}),this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",message));case 24:conferenceSession.cleanupSessionData();case 25:conferenceSession.updateStateFromData(isConferenceActive,lock);case 26:case"end":return _context369.stop()}}),_callee368,this,[[6,19]])})))}},{key:"initializeServiceData",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee369(){return regenerator_default.a.wrap((function(_context370){for(;;)switch(_context370.prev=_context370.next){case 0:return _context370.prev=0,_context370.next=3,this.retrievePstnConferences();case 3:return _context370.next=5,this.makeSnapshots();case 5:this.logger.info("service data initialized"),_context370.next=11;break;case 8:_context370.prev=8,_context370.t0=_context370.catch(0),this.logger.warn("service data init failed");case 11:case"end":return _context370.stop()}}),_callee369,this,[[0,8]])})))}},{key:"setPstnConferenceAvailability",value:function(conferenceAvailable){this.isPstnConferenceAvailable&&!conferenceAvailable&&this.eventService.publish("ON_OPEN_GLOBAL_POPUP",{popupTitle:"information",popupBody:"pgiRightsRemovedWarning",okLabel:"ok"}),this.isPstnConferenceAvailable=conferenceAvailable,this.isPstnConferenceAvailableSubject.next(this.isPstnConferenceAvailable)}},{key:"computePstnConferencePremission",value:function(){var _this181=this,isConferenceProvisioningOnGoing=!0;this.profileService.getProfilesByName("conference").filter((function(profile){return"active"===profile.status})).forEach((function(profile){profile.provisioningNeeded&&profile.provisioningNeeded.length&&profile.provisioningNeeded.forEach((function(provisioning){-1!==provisioning.providerType.toLowerCase().indexOf("pgi")&&((isConferenceProvisioningOnGoing=provisioning.provisioningOngoing)&&_this181.logger.info("computePstnConferencePremission - pgi provisioning on going"))}))})),this.setPstnConferenceAvailability(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED)&&!isConferenceProvisioningOnGoing)}},{key:"makeSnapshots",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee371(){var conferenceEndpointIds,key,conferenceEndpoint,_this182=this;return regenerator_default.a.wrap((function(_context372){for(;;)switch(_context372.prev=_context372.next){case 0:for(key in _context372.prev=0,this.logger.info("makeSnapshots"),conferenceEndpointIds=[],this.conferenceEndpoints)this.conferenceEndpoints[key]&&(conferenceEndpoint=this.conferenceEndpoints[key])&&(this.logger.info("makeSnapshots -- "+conferenceEndpoint.id),conferenceEndpointIds.push(conferenceEndpoint.id));return _context372.next=6,Promise.all(conferenceEndpointIds.map((function(conferenceEndpointId){return __awaiter(_this182,void 0,void 0,regenerator_default.a.mark((function _callee370(){return regenerator_default.a.wrap((function(_context371){for(;;)switch(_context371.prev=_context371.next){case 0:return _context371.prev=0,_context371.next=3,this.makeSnapshotForConfId(conferenceEndpointId);case 3:_context371.next=7;break;case 5:_context371.prev=5,_context371.t0=_context371.catch(0);case 7:case"end":return _context371.stop()}}),_callee370,this,[[0,5]])})))})));case 6:this.logger.info("makeSnapshots -- SUCCESS"),_context372.next=12;break;case 9:_context372.prev=9,_context372.t0=_context372.catch(0),this.logger.info("makeSnapshots -- ERROR");case 12:case"end":return _context372.stop()}}),_callee371,this,[[0,9]])})))}},{key:"makeSnapshotForConfId",value:function(confId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee372(){var error,confSession,serverUrl,headers,response,snapshotData,errorInfo;return regenerator_default.a.wrap((function(_context373){for(;;)switch(_context373.prev=_context373.next){case 0:if(confId){_context373.next=3;break}throw error=new Error("makeSnapshotForConfId - No confId !!"),this.logger.error(error.message),error;case 3:if(_context373.prev=3,!((confSession=this.conferenceSessions[confId])&&confSession.active&&confSession.haveJoined)){_context373.next=7;break}return _context373.abrupt("return",(this.logger.debug("makeSnapshotForConfId skipped, already joined"),confSession));case 7:return serverUrl=new URL("conferences/".concat(confId,"/snapshot"),this.confPortalURL),headers=this.authService.getRequestHeader(),_context373.next=11,fetch(serverUrl.href,{method:"GET",headers:headers});case 11:if((response=_context373.sent).ok){_context373.next=14;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 14:return _context373.next=16,response.json();case 16:return snapshotData=_context373.sent.data,_context373.abrupt("return",(this.updateOrCreateConferenceSession(confId,snapshotData),snapshotData));case 20:return _context373.prev=20,_context373.t0=_context373.catch(3),this.conferenceSessions[confId]&&(this.logger.debug("makeSnapshotForConfId failed - remove conferenceSession "+confId),this.removeConferenceSession(confId)),_context373.next=25,errorHelper_service_1.default.getErrorInfo(_context373.t0,"makeSnapshotForConfId");case 25:throw errorInfo=_context373.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 27:case"end":return _context373.stop()}}),_callee372,this,[[3,20]])})))}},{key:"removeConferenceSession",value:function(confId){confId&&(this.logger.debug("removeConferenceSession "+confId),delete this.conferenceSessions[confId],this.conferenceSessionsSubject.next({id:confId,action:"deleted"}))}},{key:"updateOrCreateConferenceSession",value:function(confId,snapshotData){if(this.logger.debug("updateOrCreateConferenceSession for "+confId),!confId||!snapshotData)return this.logger.warn("updateOrCreateConferenceSession - Not enough data"),null;var conferenceSession=this.conferenceSessions[confId];return conferenceSession?(snapshotData.active!==conferenceSession.active&&(this.logger.debug("updateOrCreateConferenceSession - state update to "+(snapshotData.active?"active":"inactive")),conferenceSession.active=snapshotData.active,this.conferenceSessionsSubject.next({id:confId,action:"updated"})),snapshotData.participants&&(this.logger.debug("updateOrCreateConferenceSession - update participants for ".concat(confId," with:\n").concat(JSON.stringify(snapshotData.participants))),conferenceSession.participants=snapshotData.participants.map((function(participantData){return conference_participant_model_1.ConferenceParticipant.createFromData(participantData)})),this.conferenceSessionsSubject.next({id:confId,action:"updated"}))):(this.logger.debug("updateOrCreateConferenceSession - create new conferencesession with id ".concat(confId," and data: \n").concat(JSON.stringify(snapshotData))),conferenceSession=conference_session_model_1.ConferenceSession.createFromData(confId,snapshotData.participants,snapshotData.active,MEDIATYPE.PSTNAUDIO),this.conferenceSessions[confId]=conferenceSession,this.conferenceSessionsSubject.next({id:confId,action:"created"})),conferenceSession}},{key:"updateConference",value:function(confEndpointId,confData){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee373(){var serverUrl,headers,response,conferenceData,conference;return regenerator_default.a.wrap((function(_context374){for(;;)switch(_context374.prev=_context374.next){case 0:if(_context374.prev=0,this.logger.info("updateConference"),confEndpointId){_context374.next=4;break}throw"updateConference failure: No confEndpoint",this.logger.error("updateConference failure : No confEndpoint"),new Error("updateConference failure: No confEndpoint");case 4:return serverUrl=new URL("conferences/"+confEndpointId,this.confProvPortalURL),(headers=this.authService.getRequestHeader())["Content-Type"]="application/json",_context374.next=8,fetch(serverUrl.href,{method:"PUT",headers:headers,body:JSON.stringify(confData)});case 8:if((response=_context374.sent).ok){_context374.next=11;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 11:return _context374.next=13,response.json();case 13:return conferenceData=_context374.sent.data,conference=this.updateOrCreatePstnConferenceEndpoint(conferenceData),_context374.abrupt("return",(this.logger.info("updateConference SUCCESS"),conference));case 18:throw _context374.prev=18,_context374.t0=_context374.catch(0),this.logger.error("updateConference ERROR"),_context374.t0;case 21:case"end":return _context374.stop()}}),_callee373,this,[[0,18]])})))}},{key:"getPstnInstantConferenceEndpoint",value:function(){return this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]]}},{key:"getPstnInstantConferenceEndpointId",value:function(){return this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]]?this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]].id:null}},{key:"retrievePstnConferences",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee374(){var serverUrl,headers,response,conferencesProvisionData,_iterator7,_step7,conferenceData,errorInfo;return regenerator_default.a.wrap((function(_context375){for(;;)switch(_context375.prev=_context375.next){case 0:if(_context375.prev=0,this.logger.info("retrievePstnConferences"),this.isPstnConferenceAvailable){_context375.next=3;break}throw this.logger.warn("retrievePstnConferences - user is not allowed"),new Error("notAllowed");case 3:return(serverUrl=new URL("conferences",this.confProvPortalURL)).searchParams.set("format","full"),serverUrl.searchParams.set("userId",this.contactService.userContact.dbId),serverUrl.searchParams.set("scheduled","false"),serverUrl.searchParams.set("mediaType",MEDIATYPE.PSTNAUDIO),headers=this.authService.getRequestHeader(),_context375.next=8,fetch(serverUrl.href,{method:"GET",headers:headers});case 8:if((response=_context375.sent).ok){_context375.next=11;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 11:return _context375.next=13,response.json();case 13:conferencesProvisionData=_context375.sent.data,_iterator7=_createForOfIteratorHelper(conferencesProvisionData);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;)(conferenceData=_step7.value)&&conferenceData.mediaType===MEDIATYPE.PSTNAUDIO&&this.updateOrCreatePstnConferenceEndpoint(conferenceData)}catch(err){_iterator7.e(err)}finally{_iterator7.f()}return _context375.abrupt("return",(this.logger.info("retrievePstnConferences successfully"),conferencesProvisionData));case 19:return _context375.prev=19,_context375.t0=_context375.catch(0),_context375.next=23,errorHelper_service_1.default.getErrorInfo(_context375.t0,"retrievePstnConferences");case 23:throw errorInfo=_context375.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 25:case"end":return _context375.stop()}}),_callee374,this,[[0,19]])})))}},{key:"retrieveConference",value:function(confId){var force=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee375(){var error,serverUrl,headers,response,conferenceData,errorInfo;return regenerator_default.a.wrap((function(_context376){for(;;)switch(_context376.prev=_context376.next){case 0:if(confId){_context376.next=3;break}throw error=new Error("retrieveConference - missing parameter"),this.logger.error(error.message),error;case 3:if(_context376.prev=3,this.logger.info("retrieveConference - "+confId),!this.conferenceEndpoints[confId]||force){_context376.next=6;break}return _context376.abrupt("return",this.conferenceEndpoints[confId]);case 6:return serverUrl=new URL("conferences/"+confId,this.confProvPortalURL),headers=this.authService.getRequestHeader(),_context376.next=10,fetch(serverUrl.href,{method:"GET",headers:headers});case 10:if((response=_context376.sent).ok){_context376.next=13;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 13:return _context376.next=15,response.json();case 15:return conferenceData=_context376.sent.data,_context376.abrupt("return",conferenceData&&Object.prototype.hasOwnProperty.call(conferenceData,"id")?this.updateOrCreatePstnConferenceEndpoint(conferenceData):conferenceData);case 19:return _context376.prev=19,_context376.t0=_context376.catch(3),_context376.next=23,errorHelper_service_1.default.getErrorInfo(_context376.t0,"retrieveConference");case 23:throw errorInfo=_context376.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 25:case"end":return _context376.stop()}}),_callee375,this,[[3,19]])})))}},{key:"updateOrCreatePstnConferenceEndpoint",value:function(conferenceData){if(this.logger.info("updateOrCreatePstnConferenceEndpoint for "+conferenceData.id),!conferenceData)return this.logger.error("updateOrCreatePstnConferenceEndpoint - no conference data !"),null;if(conferenceData.mediaType!==MEDIATYPE.PSTNAUDIO)return this.logger.warn("updateOrCreatePstnConferenceEndpoint - wrong mediaType: "+conferenceData.mediaType),null;if(this.conferenceEndpoints[conferenceData.id])this.conferenceEndpoints[conferenceData.id].updateFromData(conferenceData),this.conferenceEnpointsSubject.next({id:conferenceData.id,action:"updated"});else{var conference=conference_endpoint_model_1.ConferenceEndpoint.createFromData(conferenceData);this.conferenceEndpoints[conferenceData.id]=conference,this.conferenceEnpointsSubject.next({id:conferenceData.id,action:"created"})}return this.conferenceEndpoints[conferenceData.id]}},{key:"getConferenceSessionWithConnId",value:function(connId){for(var key in this.logger.debug("getConferenceSessionWithConnId with connId "+connId),this.conferenceSessions)if(this.conferenceSessions[key]){var conferenceSession=this.conferenceSessions[key];if(conferenceSession&&conferenceSession.callId===connId)return this.logger.debug("getConferenceSessionWithConnId with connId ".concat(connId,": - conferenceSessionId: ").concat(key)),conferenceSession}return null}},{key:"getConferenceSessionById",value:function(confId){return this.conferenceSessions[confId]}},{key:"subscribeToPstnSession",value:function(confId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee376(){var error,serverUrl,headers,data,response,joinStatus,errorInfo;return regenerator_default.a.wrap((function(_context377){for(;;)switch(_context377.prev=_context377.next){case 0:if(this.logger.info("subscribeToPstnSession( confId=".concat(confId,")")),confId){_context377.next=3;break}throw error=new Error("subscribeToPstnSession - missing parameter"),this.logger.error(error.message),error;case 3:return _context377.prev=3,serverUrl=new URL("conferences/".concat(confId,"/join"),this.confPortalURL),(headers=this.authService.getRequestHeader())["Content-Type"]="application/json",data={participantPhoneNumber:"joinWithoutAudio",participant:{role:"member",type:"unmuted"},mediaType:MEDIATYPE.PSTNAUDIO},_context377.next=9,fetch(serverUrl.href,{method:"POST",headers:headers,body:JSON.stringify(data)});case 9:if((response=_context377.sent).ok){_context377.next=12;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 12:return _context377.next=14,response.json();case 14:return joinStatus=_context377.sent.status,_context377.abrupt("return",(this.logger.info("subscribeToPstnSession( confId=".concat(confId,") success : ").concat(joinStatus)),confId));case 18:return _context377.prev=18,_context377.t0=_context377.catch(3),_context377.next=22,errorHelper_service_1.default.getErrorInfo(_context377.t0,"subscribeToPstnSession");case 22:throw errorInfo=_context377.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 24:case"end":return _context377.stop()}}),_callee376,this,[[3,18]])})))}},{key:"unSubscribeParticipantFromPstnSession",value:function(confId,participantId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee377(){var error,serverUrl,headers,data,response,dropStatus,errorInfo;return regenerator_default.a.wrap((function(_context378){for(;;)switch(_context378.prev=_context378.next){case 0:if(this.logger.info("unSubscribeParticipantFromPstnSession( confId=".concat(confId," - participantId=").concat(participantId,")")),confId&&participantId){_context378.next=3;break}throw error=new Error("unSubscribeParticipantFromPstnSession - missing parameter"),this.logger.error(error.message),error;case 3:return _context378.prev=3,(serverUrl=new URL("conferences/".concat(confId,"/participants/").concat(participantId),this.confPortalURL)).searchParams.set("mediaType",MEDIATYPE.PSTNAUDIO),(headers=this.authService.getRequestHeader())["Content-Type"]="application/json",data={participantPhoneNumber:"joinWithoutAudio",participant:{role:"member",type:"unmuted"},mediaType:MEDIATYPE.PSTNAUDIO},_context378.next=11,fetch(serverUrl.href,{method:"DELETE",headers:headers,body:JSON.stringify(data)});case 11:if((response=_context378.sent).ok){_context378.next=14;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 14:return _context378.next=16,response.json();case 16:dropStatus=_context378.sent.status,this.logger.info("unSubscribeParticipantFromPstnSession( confId=".concat(confId," ) success : ").concat(dropStatus)),_context378.next=26;break;case 20:return _context378.prev=20,_context378.t0=_context378.catch(3),_context378.next=24,errorHelper_service_1.default.getErrorInfo(_context378.t0,"unSubscribeParticipantFromPstnSession");case 24:throw errorInfo=_context378.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 26:case"end":return _context378.stop()}}),_callee377,this,[[3,20]])})))}},{key:"startPstnConference",value:function(confId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee378(){var error,serverUrl,headers,response,startStatus,errorInfo;return regenerator_default.a.wrap((function(_context379){for(;;)switch(_context379.prev=_context379.next){case 0:if(this.logger.info("startPstnConference( confId=".concat(confId," )")),confId){_context379.next=3;break}throw error=new Error("startPstnConference - missing parameter"),this.logger.error(error.message),error;case 3:if(!this.conferenceSessions[confId]||!this.conferenceSessions[confId].active){_context379.next=7;break}this.logger.info("startPstnConference : conference already started"),_context379.next=27;break;case 7:return _context379.prev=7,serverUrl=new URL("conferences/".concat(confId,"/start"),this.confPortalURL),headers=this.authService.getRequestHeader(),_context379.next=12,fetch(serverUrl.href,{method:"PUT",headers:headers});case 12:if((response=_context379.sent).ok){_context379.next=15;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 15:return _context379.next=17,response.json();case 17:startStatus=_context379.sent.status,this.logger.info("startPstnConference( confId=".concat(confId," ) success : ").concat(startStatus)),_context379.next=27;break;case 21:return _context379.prev=21,_context379.t0=_context379.catch(7),_context379.next=25,errorHelper_service_1.default.getErrorInfo(_context379.t0,"startPstnConference");case 25:throw errorInfo=_context379.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 27:case"end":return _context379.stop()}}),_callee378,this,[[7,21]])})))}},{key:"stopPstnConference",value:function(confId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee379(){var error,serverUrl,headers,data,response,responseData,session,startStatus,errorInfo;return regenerator_default.a.wrap((function(_context380){for(;;)switch(_context380.prev=_context380.next){case 0:if(this.logger.info("stopPstnConference( confId=".concat(confId," )")),confId){_context380.next=3;break}throw error=new Error("stopPstnConference - missing parameter"),this.logger.error(error.message),error;case 3:if(!this.conferenceSessions[confId]||!this.conferenceSessions[confId].active){_context380.next=29;break}return _context380.prev=4,serverUrl=new URL("conferences/".concat(confId,"/stop"),this.confPortalURL),(headers=this.authService.getRequestHeader())["Content-Type"]="application/json",data={mediaType:MEDIATYPE.PSTNAUDIO},_context380.next=10,fetch(serverUrl.href,{method:"PUT",headers:headers,body:JSON.stringify(data)});case 10:return response=_context380.sent,_context380.next=13,response.json();case 13:if(responseData=_context380.sent,response.ok){_context380.next=17;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),404===response.status&&404e3===responseData.errorDetailsCode&&(session=this.getConferenceSessionById(confId))&&(session.active=!1,session.participants=[],this.removeConferenceSession(confId)),response;case 17:startStatus=responseData.status,this.logger.info("stopPstnConference( confId=".concat(confId," ) success : ").concat(startStatus)),_context380.next=27;break;case 21:return _context380.prev=21,_context380.t0=_context380.catch(4),_context380.next=25,errorHelper_service_1.default.getErrorInfo(_context380.t0,"stopPstnConference");case 25:throw errorInfo=_context380.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 27:_context380.next=30;break;case 29:this.logger.info("stopPstnConference : no conference to stop");case 30:case"end":return _context380.stop()}}),_callee379,this,[[4,21]])})))}},{key:"joinPstnConference",value:function(confId,participantPhoneNumber,participant,country){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee380(){var error,serverUrl,headers,data,response,joinStatus,errorInfo;return regenerator_default.a.wrap((function(_context381){for(;;)switch(_context381.prev=_context381.next){case 0:if(confId&&participantPhoneNumber&&participant){_context381.next=3;break}throw error=new Error("joinPstnConference - missing parameter"),this.logger.error(error.message),error;case 3:return this.logger.info("joinPstnConference( confId=".concat(confId,", PhoneNumber=").concat(participantPhoneNumber,", role=").concat(participant.role,", country=").concat(country," )")),_context381.prev=4,serverUrl=new URL("conferences/".concat(confId,"/join"),this.confPortalURL),(headers=this.authService.getRequestHeader())["Content-Type"]="application/json",data={participantPhoneNumber:participantPhoneNumber,participant:participant,country:country,mediaType:MEDIATYPE.PSTNAUDIO},_context381.next=10,fetch(serverUrl.href,{method:"POST",headers:headers,body:JSON.stringify(data)});case 10:if((response=_context381.sent).ok){_context381.next=13;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 13:return this.conferenceSessions[confId].joinInProgress=!0,_context381.next=16,response.json();case 16:return joinStatus=_context381.sent.status,_context381.abrupt("return",(this.logger.info("joinPstnConference( confId=".concat(confId," ) success - ").concat(joinStatus)),confId));case 20:return _context381.prev=20,_context381.t0=_context381.catch(4),_context381.next=24,errorHelper_service_1.default.getErrorInfo(_context381.t0,"joinPstnConference");case 24:throw errorInfo=_context381.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 26:case"end":return _context381.stop()}}),_callee380,this,[[4,20]])})))}},{key:"disconnectParticipant",value:function(confId,participantId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee381(){var error,serverUrl,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context382){for(;;)switch(_context382.prev=_context382.next){case 0:if(confId&&participantId){_context382.next=3;break}throw error=new Error("disconnectParticipant - missing parameter"),this.logger.error(error.message),error;case 3:return this.logger.info("disconnectParticipant( confId=".concat(confId,", participantId=").concat(participantId," )")),_context382.prev=4,(serverUrl=new URL("conferences/".concat(confId,"/participants/").concat(participantId),this.confPortalURL)).searchParams.set("mediaType",MEDIATYPE.PSTNAUDIO),headers=this.authService.getRequestHeader(),_context382.next=10,fetch(serverUrl.href,{method:"DELETE",headers:headers});case 10:if((response=_context382.sent).ok){_context382.next=13;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 13:this.logger.info("disconnectParticipant success"),_context382.next=22;break;case 16:return _context382.prev=16,_context382.t0=_context382.catch(4),_context382.next=20,errorHelper_service_1.default.getErrorInfo(_context382.t0,"disconnectParticipant");case 20:throw errorInfo=_context382.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 22:case"end":return _context382.stop()}}),_callee381,this,[[4,16]])})))}},{key:"retrievePstnPhoneNumbers",value:function(){var shouldFormatResults=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee382(){var serverUrl,headers,response,responseData,errorInfo;return regenerator_default.a.wrap((function(_context383){for(;;)switch(_context383.prev=_context383.next){case 0:if(this.logger.info("retrievePstnPhoneNumbers : "+shouldFormatResults),!this.pstnConferencePhoneNumbers){_context383.next=2;break}return _context383.abrupt("return",shouldFormatResults?this.formatPstnPhoneNumbers(this.pstnConferencePhoneNumbers):this.pstnConferencePhoneNumbers);case 2:return _context383.prev=2,(serverUrl=new URL("conferences/audio/phonenumbers",this.confProvPortalURL)).searchParams.set("shortList","false"),headers=this.authService.getRequestHeader(),_context383.next=8,fetch(serverUrl.href,{method:"GET",headers:headers});case 8:if((response=_context383.sent).ok){_context383.next=11;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 11:return _context383.next=13,response.json();case 13:return responseData=_context383.sent,_context383.abrupt("return",(this.logger.info("retrievePstnPhoneNumbers success"),this.pstnConferencePhoneNumbers=responseData.data.phoneNumberList,shouldFormatResults?this.formatPstnPhoneNumbers(this.pstnConferencePhoneNumbers):this.pstnConferencePhoneNumbers));case 17:return _context383.prev=17,_context383.t0=_context383.catch(2),_context383.next=21,errorHelper_service_1.default.getErrorInfo(_context383.t0,"retrievePstnPhoneNumbers");case 21:throw errorInfo=_context383.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 23:case"end":return _context383.stop()}}),_callee382,this,[[2,17]])})))}},{key:"resetPersonalMeetingRoom",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee383(){var serverUrl,headers,response,errorInfo;return regenerator_default.a.wrap((function(_context384){for(;;)switch(_context384.prev=_context384.next){case 0:return this.logger.info("resetPersonalMeetingRoom"),_context384.prev=1,serverUrl=new URL("meetings/reset",this.confProvPortalURL),(headers=this.authService.getRequestHeader())["Content-Type"]="application/json",_context384.next=6,fetch(serverUrl.href,{method:"PUT",headers:headers});case 6:if((response=_context384.sent).ok){_context384.next=9;break}throw this.logger.debug("Request ".concat(response.headers.get("x-rainbow-request-id")," failed with status ").concat(response.status)),response;case 9:_context384.next=17;break;case 11:return _context384.prev=11,_context384.t0=_context384.catch(1),_context384.next=15,errorHelper_service_1.default.getErrorInfo(_context384.t0,"resetPersonalMeetingRoom");case 15:throw errorInfo=_context384.sent,this.logger.error("[pgiConferenceService] "+errorInfo.message),errorInfo.error;case 17:case"end":return _context384.stop()}}),_callee383,this,[[1,11]])})))}},{key:"formatPstnPhoneNumbers",value:function(phoneNumbers){var _this183=this,pstnConferencePhoneNumbers={};return phoneNumbers.forEach((function(phoneNumber){if(phoneNumber.locationcode){var propertyName=_this183.countryService.getAlpha2Code(phoneNumber.locationcode.substr(0,3));propertyName&&(pstnConferencePhoneNumbers[propertyName]||(pstnConferencePhoneNumbers[propertyName]={numbersList:[]})),pstnConferencePhoneNumbers[propertyName].numbersList.push({number:phoneNumber.number,locationName:phoneNumber.location,city:phoneNumber.location.split(", ")[1],numberType:phoneNumber.numberType,needLanguageSelection:phoneNumber.needLanguageSelection})}})),pstnConferencePhoneNumbers}},{key:"refreshConferenceSessions",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee384(){var confId;return regenerator_default.a.wrap((function(_context385){for(;;)switch(_context385.prev=_context385.next){case 0:this.logger.info("refreshConferenceSessions"),_context385.prev=1,_context385.t0=regenerator_default.a.keys(this.conferenceSessions);case 3:if((_context385.t1=_context385.t0()).done){_context385.next=11;break}if(confId=_context385.t1.value,_context385.t2=Object.prototype.hasOwnProperty.call(this.conferenceSessions,confId),!_context385.t2){_context385.next=9;break}return _context385.next=9,this.makeSnapshotForConfId(confId);case 9:_context385.next=3;break;case 11:_context385.next=16;break;case 13:_context385.prev=13,_context385.t3=_context385.catch(1),this.logger.error("refreshConferenceSessions -- ERROR");case 16:case"end":return _context385.stop()}}),_callee384,this,[[1,13]])})))}},{key:"subscribeToMyConferenceSessions",value:function(eventHandler){this.conferenceSessions[this.getPstnInstantConferenceEndpointId()]&&this.conferenceSessions[this.getPstnInstantConferenceEndpointId()].activeSubject.pipe(distinctUntilChanged_1.distinctUntilChanged()).subscribe(eventHandler)}}]),_class12}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var ConferenceEndpoint=function(){function ConferenceEndpoint(id,userId,mediaType,scheduled){var confDialOutDisabled=arguments.length>4&&void 0!==arguments[4]&&arguments[4],passCodes=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],playEntryTone=arguments.length>6&&void 0!==arguments[6]&&arguments[6],muteUponEntry=arguments.length>7&&void 0!==arguments[7]&&arguments[7];_classCallCheck(this,ConferenceEndpoint),this.id=id,this.userId=userId,this.mediaType=mediaType,this.scheduled=scheduled,this.confDialOutDisabled=confDialOutDisabled,this.passCodes=passCodes,this.playEntryTone=playEntryTone,this.muteUponEntry=muteUponEntry}return _createClass(ConferenceEndpoint,[{key:"updateFromData",value:function(data){this.id=data.id,this.userId=data.userId,this.mediaType=data.mediaType,this.scheduled=data.scheduled,this.confDialOutDisabled=data.confDialOutDisabled,this.passCodes=data.passCodes,this.playEntryTone=data.playEntryTone,this.muteUponEntry=data.muteUponEntry}}],[{key:"createFromData",value:function(data){return new ConferenceEndpoint(data.id,data.userId,data.mediaType,data.scheduled,data.confDialOutDisabled,data.passCodes,data.playEntryTone,data.muteUponEntry)}}]),ConferenceEndpoint}();exports.ConferenceEndpoint=ConferenceEndpoint},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var conference_participant_model_1=__webpack_require__(228),BehaviorSubject_1=__webpack_require__(66),ConferenceSession=function(){function ConferenceSession(id,participants,active,type){_classCallCheck(this,ConferenceSession),this.conferenceStats=null,this.talkers=[],this.talkerSubject=new BehaviorSubject_1.BehaviorSubject(this.talkers),this._haveJoined=!1,this.haveJoinedSubject=new BehaviorSubject_1.BehaviorSubject(this._haveJoined),this._joinInProgress=!1,this.joinInProgressSubject=new BehaviorSubject_1.BehaviorSubject(this._haveJoined),this._active=!1,this.activeSubject=new BehaviorSubject_1.BehaviorSubject(this._active),this._callId="",this.callIdSubject=new BehaviorSubject_1.BehaviorSubject(this._callId),this._participants=[],this.participantsSubject=new BehaviorSubject_1.BehaviorSubject(this._participants),this._lock=!1,this.lockSubject=new BehaviorSubject_1.BehaviorSubject(this._lock),this.id=id,this.participants=participants,this.active=active,this.type=type}return _createClass(ConferenceSession,[{key:"haveJoined",get:function(){return this._haveJoined},set:function(value){this._haveJoined=value,this.haveJoinedSubject.next(this._haveJoined)}},{key:"joinInProgress",get:function(){return this._joinInProgress},set:function(value){this._joinInProgress=value,this.joinInProgressSubject.next(this._joinInProgress)}},{key:"active",get:function(){return this._active},set:function(value){this._active=value,this.activeSubject.next(this._active)}},{key:"callId",get:function(){return this._callId},set:function(value){this._callId=value,this.callIdSubject.next(this._callId)}},{key:"participants",get:function(){return this._participants},set:function(participantsData){if(participantsData.length){var _step8,_iterator8=_createForOfIteratorHelper(participantsData);try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var participantData=_step8.value;if(!participantData.participantId)return;var existingParticipant=this.getParticipantById(participantData.participantId)?this.getParticipantById(participantData.participantId):this.getParticipantByJid(participantData.jid_im);existingParticipant?existingParticipant.updateFromData(participantData):this._participants.push(conference_participant_model_1.ConferenceParticipant.createFromData(participantData))}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}}else this._participants=[];this.participantsSubject.next(this._participants)}},{key:"lock",get:function(){return this._lock},set:function(value){this._lock=value,this.lockSubject.next(this._lock)}},{key:"cleanupSessionData",value:function(){this.participants=[],this.talkers=[],this.haveJoined=!1}},{key:"updateFromData",value:function(){var participants=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],active=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.participants=participants,this.active=active}},{key:"updateStateFromData",value:function(active,lock){this.active=active,this.lock=lock}},{key:"removeParticipants",value:function(){var _step9,removedParticipantsIds=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],_iterator9=_createForOfIteratorHelper(removedParticipantsIds);try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var removedParticipantId=_step9.value,removedParticipantIndex=this.getParticipantIndexById(removedParticipantId);-1!==removedParticipantIndex&&this._participants.splice(removedParticipantIndex,1)}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}this.participantsSubject.next(this._participants)}},{key:"updateTalkers",value:function(talkers){this.talkers=talkers,this.talkerSubject.next(this.talkers)}},{key:"getParticipants",value:function(){return this.participants}},{key:"getConnectedParticipants",value:function(){return this.participants?this.participants.filter((function(participant){return"disconnected"!==participant.participantState&&"watching"!==participant.participantState})):void 0}},{key:"getWatchingParticipants",value:function(){return this.participants?this.participants.filter((function(participant){return"watching"===participant.participantState})):void 0}},{key:"getConnectedParticipantsExceptLeader",value:function(){return this.participants?this.participants.filter((function(participant){return"disconnected"!==participant.participantState&&"watching"!==participant.participantState&&"moderator"!==participant.participantRole})):void 0}},{key:"getConnectedLeaderParticipantsExcept",value:function(jid){return this.participants?this.participants.filter((function(participant){return"disconnected"!==participant.participantState&&"moderator"===participant.participantRole&&participant.jid_im!==jid})):void 0}},{key:"getConnectedParticipantsExcept",value:function(jid){return this.participants?this.participants.filter((function(participant){return participant.jid_im!==jid&&"disconnected"!==participant.participantState&&"watching"!==participant.participantState})):void 0}},{key:"getLeaderParticipant",value:function(){return this.participants?this.participants.find((function(participant){return"moderator"===participant.participantRole&&"disconnected"!==participant.participantState&&"watching"!==participant.participantState})):void 0}},{key:"getLeaderParticipantById",value:function(jid){return this.participants?this.participants.find((function(participant){return"moderator"===participant.participantRole&&"disconnected"!==participant.participantState&&"watching"!==participant.participantState&&participant.jid_im===jid})):void 0}},{key:"getParticipantById",value:function(participantId){return this.participants?this.participants.find((function(participant){return participant.participantId===participantId})):void 0}},{key:"getParticipantByJid",value:function(jid){return this.participants?this.participants.find((function(participant){return participant.jid_im===jid})):void 0}},{key:"getNonDisconnectedParticipantByJid",value:function(jid){return this.participants?this.participants.find((function(participant){return participant.jid_im===jid&&"disconnected"!==participant.participantState})):void 0}},{key:"getConnectedParticipantByJid",value:function(jid){return this.participants?this.participants.find((function(participant){return participant.jid_im===jid&&"connected"===participant.participantState})):void 0}},{key:"getWatchingParticipantByJid",value:function(jid){return this.participants?this.participants.find((function(participant){return participant.jid_im===jid&&"watching"===participant.participantState})):void 0}},{key:"getParticipantIndexById",value:function(participantId){return this.participants?this.participants.findIndex((function(participant){return participant.participantId===participantId})):-1}},{key:"isParticipantConnectedByJid",value:function(jid){return void 0!==this.participants&&this.participants.some((function(participant){return participant.jid_im===jid&&"connected"===participant.participantState}))}},{key:"isParticipantWatchingByJid",value:function(jid){return void 0!==this.participants&&this.participants.some((function(participant){return participant.jid_im===jid&&"watching"===participant.participantState}))}},{key:"isParticipantRingingByJid",value:function(jid){return void 0!==this.participants&&this.participants.some((function(participant){return participant.jid_im===jid&&"ringing"===participant.participantState}))}},{key:"isParticipantConnectedWithThisUAByJid",value:function(jid){return this.haveJoined&&void 0!==this.participants&&this.participants.some((function(participant){return participant.jid_im===jid&&"connected"===participant.participantState}))}},{key:"getTalkers",value:function(){return this.talkers}},{key:"getParticipantStatus",value:function(jid){if(this.participants&&this.participants.length){var participant=this.participants.find((function(_participant){return _participant.jid_im===jid}));if(participant)return participant.participantState}return"none"}}],[{key:"createFromData",value:function(id,participants,active,type){return new ConferenceSession(id,participants.map((function(participantData){return conference_participant_model_1.ConferenceParticipant.createFromData(participantData)})),active,type)}}]),ConferenceSession}();exports.ConferenceSession=ConferenceSession},function(module,exports,__webpack_require__){var _extendStatics7,__extends=this&&this.__extends||(_extendStatics7=function(d,b){return(_extendStatics7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics7(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Subject_1=__webpack_require__(67),queue_1=__webpack_require__(336),Subscription_1=__webpack_require__(45),observeOn_1=__webpack_require__(343),ObjectUnsubscribedError_1=__webpack_require__(70),SubjectSubscription_1=__webpack_require__(81),ReplaySubject=function(_super){function ReplaySubject(bufferSize,windowTime,scheduler){void 0===bufferSize&&(bufferSize=Number.POSITIVE_INFINITY),void 0===windowTime&&(windowTime=Number.POSITIVE_INFINITY);var _this=_super.call(this)||this;return _this.scheduler=scheduler,_this._events=[],_this._infiniteTimeWindow=!1,_this._bufferSize=bufferSize<1?1:bufferSize,_this._windowTime=windowTime<1?1:windowTime,windowTime===Number.POSITIVE_INFINITY?(_this._infiniteTimeWindow=!0,_this.next=_this.nextInfiniteTimeWindow):_this.next=_this.nextTimeWindow,_this}return __extends(ReplaySubject,_super),ReplaySubject.prototype.nextInfiniteTimeWindow=function(value){if(!this.isStopped){var _events=this._events;_events.push(value),_events.length>this._bufferSize&&_events.shift()}_super.prototype.next.call(this,value)},ReplaySubject.prototype.nextTimeWindow=function(value){this.isStopped||(this._events.push(new ReplayEvent(this._getNow(),value)),this._trimBufferThenGetEvents()),_super.prototype.next.call(this,value)},ReplaySubject.prototype._subscribe=function(subscriber){var subscription,_infiniteTimeWindow=this._infiniteTimeWindow,_events=_infiniteTimeWindow?this._events:this._trimBufferThenGetEvents(),scheduler=this.scheduler,len=_events.length;if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;if(this.isStopped||this.hasError?subscription=Subscription_1.Subscription.EMPTY:(this.observers.push(subscriber),subscription=new SubjectSubscription_1.SubjectSubscription(this,subscriber)),scheduler&&subscriber.add(subscriber=new observeOn_1.ObserveOnSubscriber(subscriber,scheduler)),_infiniteTimeWindow)for(var i=0;i<len&&!subscriber.closed;i++)subscriber.next(_events[i]);else for(i=0;i<len&&!subscriber.closed;i++)subscriber.next(_events[i].value);return this.hasError?subscriber.error(this.thrownError):this.isStopped&&subscriber.complete(),subscription},ReplaySubject.prototype._getNow=function(){return(this.scheduler||queue_1.queue).now()},ReplaySubject.prototype._trimBufferThenGetEvents=function(){for(var now=this._getNow(),_bufferSize=this._bufferSize,_windowTime=this._windowTime,_events=this._events,eventsCount=_events.length,spliceCount=0;spliceCount<eventsCount&&!(now-_events[spliceCount].time<_windowTime);)spliceCount++;return eventsCount>_bufferSize&&(spliceCount=Math.max(spliceCount,eventsCount-_bufferSize)),spliceCount>0&&_events.splice(0,spliceCount),_events},ReplaySubject}(Subject_1.Subject);exports.ReplaySubject=ReplaySubject;var ReplayEvent=function(time,value){this.time=time,this.value=value}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var QueueAction_1=__webpack_require__(337),QueueScheduler_1=__webpack_require__(340);exports.queueScheduler=new QueueScheduler_1.QueueScheduler(QueueAction_1.QueueAction),exports.queue=exports.queueScheduler},function(module,exports,__webpack_require__){var _extendStatics8,__extends=this&&this.__extends||(_extendStatics8=function(d,b){return(_extendStatics8=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics8(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var QueueAction=function(_super){function QueueAction(scheduler,work){var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this}return __extends(QueueAction,_super),QueueAction.prototype.schedule=function(state,delay){return void 0===delay&&(delay=0),delay>0?_super.prototype.schedule.call(this,state,delay):(this.delay=delay,this.state=state,this.scheduler.flush(this),this)},QueueAction.prototype.execute=function(state,delay){return delay>0||this.closed?_super.prototype.execute.call(this,state,delay):this._execute(state,delay)},QueueAction.prototype.requestAsyncId=function(scheduler,id,delay){return void 0===delay&&(delay=0),null!==delay&&delay>0||null===delay&&this.delay>0?_super.prototype.requestAsyncId.call(this,scheduler,id,delay):scheduler.flush(this)},QueueAction}(__webpack_require__(338).AsyncAction);exports.QueueAction=QueueAction},function(module,exports,__webpack_require__){var _extendStatics9,__extends=this&&this.__extends||(_extendStatics9=function(d,b){return(_extendStatics9=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics9(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var AsyncAction=function(_super){function AsyncAction(scheduler,work){var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this.pending=!1,_this}return __extends(AsyncAction,_super),AsyncAction.prototype.schedule=function(state,delay){if(void 0===delay&&(delay=0),this.closed)return this;this.state=state;var id=this.id,scheduler=this.scheduler;return null!=id&&(this.id=this.recycleAsyncId(scheduler,id,delay)),this.pending=!0,this.delay=delay,this.id=this.id||this.requestAsyncId(scheduler,this.id,delay),this},AsyncAction.prototype.requestAsyncId=function(scheduler,id,delay){return void 0===delay&&(delay=0),setInterval(scheduler.flush.bind(scheduler,this),delay)},AsyncAction.prototype.recycleAsyncId=function(scheduler,id,delay){if(void 0===delay&&(delay=0),null!==delay&&this.delay===delay&&!1===this.pending)return id;clearInterval(id)},AsyncAction.prototype.execute=function(state,delay){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var error=this._execute(state,delay);if(error)return error;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},AsyncAction.prototype._execute=function(state,delay){var errored=!1,errorValue=void 0;try{this.work(state)}catch(e){errored=!0,errorValue=!!e&&e||new Error(e)}if(errored)return this.unsubscribe(),errorValue},AsyncAction.prototype._unsubscribe=function(){var id=this.id,scheduler=this.scheduler,actions=scheduler.actions,index=actions.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==index&&actions.splice(index,1),null!=id&&(this.id=this.recycleAsyncId(scheduler,id,null)),this.delay=null},AsyncAction}(__webpack_require__(339).Action);exports.AsyncAction=AsyncAction},function(module,exports,__webpack_require__){var _extendStatics10,__extends=this&&this.__extends||(_extendStatics10=function(d,b){return(_extendStatics10=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics10(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Action=function(_super){function Action(scheduler,work){return _super.call(this)||this}return __extends(Action,_super),Action.prototype.schedule=function(state,delay){return void 0===delay&&(delay=0),this},Action}(__webpack_require__(45).Subscription);exports.Action=Action},function(module,exports,__webpack_require__){var _extendStatics11,__extends=this&&this.__extends||(_extendStatics11=function(d,b){return(_extendStatics11=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics11(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var QueueScheduler=function(_super){function QueueScheduler(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(QueueScheduler,_super),QueueScheduler}(__webpack_require__(341).AsyncScheduler);exports.QueueScheduler=QueueScheduler},function(module,exports,__webpack_require__){var _extendStatics12,__extends=this&&this.__extends||(_extendStatics12=function(d,b){return(_extendStatics12=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics12(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Scheduler_1=__webpack_require__(342),AsyncScheduler=function(_super){function AsyncScheduler(SchedulerAction,now){void 0===now&&(now=Scheduler_1.Scheduler.now);var _this=_super.call(this,SchedulerAction,(function(){return AsyncScheduler.delegate&&AsyncScheduler.delegate!==_this?AsyncScheduler.delegate.now():now()}))||this;return _this.actions=[],_this.active=!1,_this.scheduled=void 0,_this}return __extends(AsyncScheduler,_super),AsyncScheduler.prototype.schedule=function(work,delay,state){return void 0===delay&&(delay=0),AsyncScheduler.delegate&&AsyncScheduler.delegate!==this?AsyncScheduler.delegate.schedule(work,delay,state):_super.prototype.schedule.call(this,work,delay,state)},AsyncScheduler.prototype.flush=function(action){var actions=this.actions;if(this.active)actions.push(action);else{var error;this.active=!0;do{if(error=action.execute(action.state,action.delay))break}while(action=actions.shift());if(this.active=!1,error){for(;action=actions.shift();)action.unsubscribe();throw error}}},AsyncScheduler}(Scheduler_1.Scheduler);exports.AsyncScheduler=AsyncScheduler},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Scheduler=function(){function Scheduler(SchedulerAction,now){void 0===now&&(now=Scheduler.now),this.SchedulerAction=SchedulerAction,this.now=now}return Scheduler.prototype.schedule=function(work,delay,state){return void 0===delay&&(delay=0),new this.SchedulerAction(this,work).schedule(state,delay)},Scheduler.now=function(){return Date.now()},Scheduler}();exports.Scheduler=Scheduler},function(module,exports,__webpack_require__){var _extendStatics13,__extends=this&&this.__extends||(_extendStatics13=function(d,b){return(_extendStatics13=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics13(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Subscriber_1=__webpack_require__(56),Notification_1=__webpack_require__(344);exports.observeOn=function(scheduler,delay){return void 0===delay&&(delay=0),function(source){return source.lift(new ObserveOnOperator(scheduler,delay))}};var ObserveOnOperator=function(){function ObserveOnOperator(scheduler,delay){void 0===delay&&(delay=0),this.scheduler=scheduler,this.delay=delay}return ObserveOnOperator.prototype.call=function(subscriber,source){return source.subscribe(new ObserveOnSubscriber(subscriber,this.scheduler,this.delay))},ObserveOnOperator}();exports.ObserveOnOperator=ObserveOnOperator;var ObserveOnSubscriber=function(_super){function ObserveOnSubscriber(destination,scheduler,delay){void 0===delay&&(delay=0);var _this=_super.call(this,destination)||this;return _this.scheduler=scheduler,_this.delay=delay,_this}return __extends(ObserveOnSubscriber,_super),ObserveOnSubscriber.dispatch=function(arg){var notification=arg.notification,destination=arg.destination;notification.observe(destination),this.unsubscribe()},ObserveOnSubscriber.prototype.scheduleMessage=function(notification){this.destination.add(this.scheduler.schedule(ObserveOnSubscriber.dispatch,this.delay,new ObserveOnMessage(notification,this.destination)))},ObserveOnSubscriber.prototype._next=function(value){this.scheduleMessage(Notification_1.Notification.createNext(value))},ObserveOnSubscriber.prototype._error=function(err){this.scheduleMessage(Notification_1.Notification.createError(err)),this.unsubscribe()},ObserveOnSubscriber.prototype._complete=function(){this.scheduleMessage(Notification_1.Notification.createComplete()),this.unsubscribe()},ObserveOnSubscriber}(Subscriber_1.Subscriber);exports.ObserveOnSubscriber=ObserveOnSubscriber;var ObserveOnMessage=function(notification,destination){this.notification=notification,this.destination=destination};exports.ObserveOnMessage=ObserveOnMessage},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var NotificationKind,empty_1=__webpack_require__(345),of_1=__webpack_require__(346),throwError_1=__webpack_require__(350);(NotificationKind=exports.NotificationKind||(exports.NotificationKind={})).NEXT="N",NotificationKind.ERROR="E",NotificationKind.COMPLETE="C";var Notification=function(){function Notification(kind,value,error){this.kind=kind,this.value=value,this.error=error,this.hasValue="N"===kind}return Notification.prototype.observe=function(observer){switch(this.kind){case"N":return observer.next&&observer.next(this.value);case"E":return observer.error&&observer.error(this.error);case"C":return observer.complete&&observer.complete()}},Notification.prototype.do=function(next,error,complete){switch(this.kind){case"N":return next&&next(this.value);case"E":return error&&error(this.error);case"C":return complete&&complete()}},Notification.prototype.accept=function(nextOrObserver,error,complete){return nextOrObserver&&"function"==typeof nextOrObserver.next?this.observe(nextOrObserver):this.do(nextOrObserver,error,complete)},Notification.prototype.toObservable=function(){switch(this.kind){case"N":return of_1.of(this.value);case"E":return throwError_1.throwError(this.error);case"C":return empty_1.empty()}throw new Error("unexpected notification kind value")},Notification.createNext=function(value){return void 0!==value?new Notification("N",value):Notification.undefinedValueNotification},Notification.createError=function(err){return new Notification("E",void 0,err)},Notification.createComplete=function(){return Notification.completeNotification},Notification.completeNotification=new Notification("C"),Notification.undefinedValueNotification=new Notification("N",void 0),Notification}();exports.Notification=Notification},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Observable_1=__webpack_require__(55);exports.EMPTY=new Observable_1.Observable((function(subscriber){return subscriber.complete()})),exports.empty=function(scheduler){return scheduler?function(scheduler){return new Observable_1.Observable((function(subscriber){return scheduler.schedule((function(){return subscriber.complete()}))}))}(scheduler):exports.EMPTY}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var isScheduler_1=__webpack_require__(347),fromArray_1=__webpack_require__(348),scheduleArray_1=__webpack_require__(229);exports.of=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var scheduler=args[args.length-1];return isScheduler_1.isScheduler(scheduler)?(args.pop(),scheduleArray_1.scheduleArray(args,scheduler)):fromArray_1.fromArray(args)}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.isScheduler=function(value){return value&&"function"==typeof value.schedule}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Observable_1=__webpack_require__(55),subscribeToArray_1=__webpack_require__(349),scheduleArray_1=__webpack_require__(229);exports.fromArray=function(input,scheduler){return scheduler?scheduleArray_1.scheduleArray(input,scheduler):new Observable_1.Observable(subscribeToArray_1.subscribeToArray(input))}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.subscribeToArray=function(array){return function(subscriber){for(var i=0,len=array.length;i<len&&!subscriber.closed;i++)subscriber.next(array[i]);subscriber.complete()}}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var Observable_1=__webpack_require__(55);function dispatch(_a){var error=_a.error;_a.subscriber.error(error)}exports.throwError=function(error,scheduler){return scheduler?new Observable_1.Observable((function(subscriber){return scheduler.schedule(dispatch,0,{error:error,subscriber:subscriber})})):new Observable_1.Observable((function(subscriber){return subscriber.error(error)}))}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _models_appli_message__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(16),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2__),_src_services_files_fileStorage_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(25),_src_services_files_fileStorage_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_files_fileStorage_service__WEBPACK_IMPORTED_MODULE_3__);angular.module("rainbow").factory("ConversationServiceHistoryHandler",["$log","$q","$filter","$rootScope","fileServerService","SearchTextMsgResultFactory",function($log,$q,$filter,$rootScope,fileServerService,SearchTextMsgResultFactory){function ConversationServiceHistoryHandler(conversationService){this.conversationService=conversationService}return ConversationServiceHistoryHandler.create=function(conversationService){return new ConversationServiceHistoryHandler(conversationService)},ConversationServiceHistoryHandler.prototype.getHistoryPage=function(conversation,nbMessages){var that=this,room=conversation.room;return room&&room.initPresPromise?room.initPresPromise.promise.then((function(){return that.getHistoryPageInternal(conversation,nbMessages)})):this.getHistoryPageInternal(conversation,nbMessages)},ConversationServiceHistoryHandler.prototype.getHistoryPageInternal=function(conversation,size){if(conversation.currentHistoryId&&conversation.currentHistoryId===conversation.historyIndex)return $log.info("[ConversationServiceHistoryHandler] getHistoryPage("+conversation.id+", "+size+", "+conversation.historyIndex+") already asked"),$q.reject();conversation.currentHistoryId=conversation.historyIndex,$log.info("[ConversationServiceHistoryHandler] getHistoryPage("+conversation.id+", "+size+", "+conversation.historyIndex+")");var defered=conversation.historyDefered=$q.defer();if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.isUserContact(conversation.contact))return defered.reject(),defered.promise;if(conversation.historyComplete)return $log.info("[ConversationServiceHistoryHandler] getHistoryPage("+conversation.id+") : already complete"),defered.reject(),defered.promise;var mamRequest={queryid:conversation.id,with:conversation.id,max:size,before:""};return-1!==conversation.historyIndex&&(mamRequest.before=conversation.historyIndex),conversation.room?(mamRequest={queryid:conversation.id,with:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.userContact.jid,max:size,before:""},-1!==conversation.historyIndex&&(mamRequest.before=conversation.historyIndex),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.mam.querymuc(conversation.id,conversation.room.jid,mamRequest)):_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.mam.query(conversation.id,mamRequest),defered.promise},ConversationServiceHistoryHandler.prototype.retrieveMsgByDate=function(conversation,msgDate){var defered=conversation.historyDefered=$q.defer();if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.isUserContact(conversation.contact))return defered.reject(),defered.promise;var queryId="cache_"+conversation.id;return ConversationServiceHistoryHandler.prototype.getCommonHistoryPageAroundMsg(queryId,conversation,1,msgDate,"after",(function(){$log.info("[ConversationServiceHistoryHandler] retrieveMsgByDate finished")})),ConversationServiceHistoryHandler.prototype.getCommonHistoryPageAroundMsg(queryId,conversation,1,msgDate,"before",(function(){$log.info("[ConversationServiceHistoryHandler] retrieveMsgByDate finished")})),defered.promise},ConversationServiceHistoryHandler.prototype.getCommonHistoryPageAroundMsg=function(queryId,conversation,size,centeredMsgDate,order,finishMethod){if($log.info("[ConversationServiceHistoryHandler] getCommonHistoryPageAroundMsg("+queryId+", "+size+", "+conversation.historyIndex+")"),conversation.room){var mamRequest={queryid:queryId,with:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.userContact.jid,max:size,onComplete:finishMethod};mamRequest[order]=centeredMsgDate,_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.mam.querymuc(queryId,conversation.room.jid,mamRequest)}else{var _mamRequest={queryid:queryId,with:conversation.id,max:size,onComplete:finishMethod};_mamRequest[order]=centeredMsgDate,_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.mam.query(queryId,_mamRequest)}},ConversationServiceHistoryHandler.prototype.searchTextInConversations=function(queryId,text){$log.info("[ConversationServiceHistoryHandler] searchTextInConversations("+text+")");var defered=$q.defer(),iqId=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.getUniqueId(),iq=$iq({id:iqId,type:"get"}).c("query",{queryid:queryId,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(100).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(text).up().up();return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.sendIQ(iq).then((function(data){$log.info("[ConversationServiceHistoryHandler] sendIq Success: "+text);var count=$(data).find("query").find("set").find("count").text();$log.info("[ConversationServiceHistoryHandler] >searchTextInConversations: count= "+count),defered.resolve(parseInt(count,10))})).catch((function(error){$log.info("[ConversationServiceHistoryHandler] sendIq Failure: "+error.message),defered.reject(error)})),defered.promise},ConversationServiceHistoryHandler.prototype.getConversationTextCount=function(queryId,text,contactJid){$log.info("[ConversationServiceHistoryHandler] getConversationTextCount("+text+")");var defered=$q.defer(),iqId=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.getUniqueId(),iq=$iq({id:iqId,type:"get"}).c("query",{queryid:queryId,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t("0").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(text).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(contactJid).up().up();return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.sendIQ(iq).then((function(data){$log.info("[ConversationServiceHistoryHandler] sendIq Success: "+text);var count=$(data).find("query").find("set").find("count").text();$log.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+count),defered.resolve(parseInt(count,10))})).catch((function(error){$log.info("[ConversationServiceHistoryHandler] sendIq Failure: "+error.message),defered.reject(error)})),defered.promise},ConversationServiceHistoryHandler.prototype.searchTextResultsInConversation=function(queryId,text,contactJid){$log.info("[ConversationServiceHistoryHandler] searchTextResultsInConversation("+text+")");var defered=$q.defer(),iqId=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.getUniqueId(),iq=$iq({id:iqId,type:"get"}).c("query",{queryid:queryId,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(100).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(text).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(contactJid).up().up();return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.sendIQ(iq).then((function(data){$log.info("[ConversationServiceHistoryHandler] sendIq Success: "+text);var count=$(data).find("query").find("set").find("count").text();$log.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+count),defered.resolve(parseInt(count,10))})).catch((function(error){$log.info("[ConversationServiceHistoryHandler] sendIq Failure: "+error.message),defered.reject(error)})),defered.promise},ConversationServiceHistoryHandler.prototype.searchTextMoreResultsInConversation=function(queryId,text,contactJid,messageDate){$log.info("[ConversationServiceHistoryHandler] searchTextMoreResultsInConversation("+text+")");var defered=$q.defer(),iqId=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.getUniqueId(),iq=$iq({id:iqId,type:"get"}).c("query",{queryid:queryId,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(100).up().c("before").t(messageDate).up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(text).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(contactJid).up().up();return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.sendIQ(iq).then((function(data){$log.info("[ConversationServiceHistoryHandler] sendIq Success: "+text);var count=$(data).find("query").find("set").find("count").text();$log.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+count),defered.resolve(parseInt(count,10))})).catch((function(error){$log.info("[ConversationServiceHistoryHandler] sendIq Failure: "+error.message),defered.reject(error)})),defered.promise},ConversationServiceHistoryHandler.prototype.searchTextResultsInRoom=function(queryId,text,roomJid){$log.info("[ConversationServiceHistoryHandler] searchTextInRoom("+text+")");var defered=$q.defer(),userJid=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.userContact.jid,iqId=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.getUniqueId(),iq=$iq({to:roomJid,id:iqId,type:"get"}).c("query",{queryid:queryId,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(100).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"with",type:"text-single"}).c("value").t(userJid).up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(text).up().up();return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.sendIQ(iq).then((function(data){$log.info("[ConversationServiceHistoryHandler] sendIq Success: "+text);var count=$(data).find("query").find("set").find("count").text();$log.info("[ConversationServiceHistoryHandler] >searchTextInRoom: count= "+count),defered.resolve(parseInt(count,10))})).catch((function(error){$log.info("[ConversationServiceHistoryHandler] >searchTextInRoom: Failure: "+error.message),defered.reject(error)})),defered.promise},ConversationServiceHistoryHandler.prototype.searchTextMoreResultsInRoom=function(queryId,text,contactJid,roomJid,messageDate,limitSize){$log.info("[ConversationServiceHistoryHandler] searchTextMoreResultsInConversation("+text+")");var defered=$q.defer(),iqId=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.getUniqueId(),iq=$iq({to:roomJid,id:iqId,type:"get"}).c("query",{queryid:queryId,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(limitSize).up().c("before").t(messageDate).up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(text).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(contactJid).up().up();return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.sendIQ(iq).then((function(data){$log.info("[ConversationServiceHistoryHandler] sendIq Success: "+text);var count=$(data).find("query").find("set").find("count").text();$log.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+count),defered.resolve(count)})).catch((function(error){$log.info("[ConversationServiceHistoryHandler] sendIq Failure: "+error.message),defered.reject(error)})),defered.promise},ConversationServiceHistoryHandler.prototype.onHistoryMessageReceived=function(stanza){$log.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived: "+stanza);try{var conversation=null,stanzaElem=$(stanza),queryId=stanzaElem.find("result").attr("queryid");if(queryId){if(conversation=this.conversationService.getConversationById(queryId)){if(stanzaElem.find("call_log").length)return this.onWebrtcHistoryMessageReceived(stanza,conversation);var fromJid,brutJid=stanzaElem.find("forwarded message").attr("from"),roomEvent=!1;if(!(fromJid=brutJid&&0===brutJid.indexOf("room_")?brutJid.split("/")[1]:_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.getBareJidFromJid(stanzaElem.find("forwarded message").attr("from")))&&stanzaElem.find("event").length&&(roomEvent=stanzaElem.find("event").attr("name"),fromJid=stanzaElem.find("event").attr("jid"),"welcome"===roomEvent&&conversation.room&&conversation.room.ownerContact&&(fromJid=conversation.room.ownerContact.jid)),!fromJid)return $log.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived - Receive message without valid fromJid information"),!0;var from=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.getContactByJid(fromJid),type=stanzaElem.find("forwarded message").attr("type"),messageId=stanzaElem.find("forwarded message").attr("id"),date=new Date(stanzaElem.find("forwarded delay").attr("stamp")),body=stanzaElem.find("forwarded message body").text(),ack=stanzaElem.find("forwarded message ack"),oob=stanzaElem.find("forwarded message x[xmlns='jabber:x:oob']"),conference=stanzaElem.find("forwarded message x[xmlns='jabber:x:bubble:conference:pstn']"),contents=stanzaElem.find("content[xmlns='urn:xmpp:content']"),replace=stanzaElem.find("replace"),answeredMsg=stanzaElem.find("answeredMsg"),alternativeContentStanza=stanzaElem.find("content"),side=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.isUserContact(from)?_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.Side.RIGHT:_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.Side.LEFT,voiceMessage=stanzaElem.find("voicemessage"),voiceMessageData=!1;if(voiceMessage&&voiceMessage.length&&(voiceMessageData=!0),from||($log.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived missing contact for jid : "+fromJid+", ignore message"),from=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.createEmptyContact(fromJid)),roomEvent){if($log.info("[ConversationServiceHistoryHandler] ("+conversation.id+") add Room admin event message "+roomEvent),type="admin",conversation.room&&conversation.room.isMeetingRoom()&&("welcome"===roomEvent||"conferenceAdd"===roomEvent||"conferenceRemove"===roomEvent||"invitation"===roomEvent))return!0;if(("conferenceAdd"===roomEvent||"conferenceRemove"===roomEvent)&&conversation.room&&conversation.room.ownerContact){var userJid=stanzaElem.find("event").attr("jid"),user=conversation.room.getUserByJid(userJid);from=user&&user.contact?user.contact:conversation.room.ownerContact}}var message=conversation.getMessageById(messageId);if(message||(message=conversation.historyMessages.find((function(item){return item.id===messageId}))),message)$log.info("[ConversationServiceHistoryHandler] ("+conversation.id+") try to add an already stored message with id "+message.id);else{switch(type){case"file":message=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.createFileMessage(messageId,date,from,side,body,!1);break;case"webrtc":message=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.createWebRTCMessage(messageId,date,from,side,body,!1);break;case"admin":message=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.createBubbleAdminMessage(messageId,date,from,roomEvent);break;case"recording":message=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.createRecordingAdminMessage(messageId,date,from,"Admin");break;default:if(oob&&oob.length){var oobElem=$(oob),url=oobElem.find("url").text(),fileName=oobElem.find("filename").text(),fileId=_src_services_files_fileStorage_service__WEBPACK_IMPORTED_MODULE_3___default.a.extractFileIdFromUrl(url);message=voiceMessageData?_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.createVoiceMessage(messageId,date,from,side,body,!1,fileId,fileName,voiceMessageData):_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.createFileSharingMessage(messageId,date,from,side,body,!1,fileId,fileName,null,geolocData),_src_services_files_fileStorage_service__WEBPACK_IMPORTED_MODULE_3___default.a.retrieveAndStoreOneFileDescriptor(fileId).then((function(fileDescriptor){fileDescriptor&&"not_uploaded"===fileDescriptor.state&&(message.receiptStatus=1,message.fileErrorMsg=$filter("translate")("file_notuploaded")),fileServerService.getBlobThumbnailFromFileDescriptor(fileDescriptor).then((function(blob){fileDescriptor.previewBlob=blob,fileDescriptor.previewBlobSubject.next(fileDescriptor.previewBlob),$rootScope.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:fileDescriptor.id})})),$rootScope.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:fileDescriptor.id})})).catch((function(error){$log.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived error "+error)}))}else if(conference&&conference.length){var conferenceElem=$(conference),subject=conferenceElem.attr("subject"),confendpointid=conferenceElem.attr("confendpointid"),jid=conference.attr("jid");if("reminder"===conference.attr("type"))return!0;var conferenceDescriptor={subject:subject,confendpointid:confendpointid,roomjid:jid};message=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.createConferenceMessage(messageId,date,from,side,!1,conferenceDescriptor)}else{var isMarkdown=!1,additionalContent={};if(contents&&contents.each((function(){var contentType=$(this).attr("type"),content=$(this).text();"text/markdown"===contentType&&(_readOnlyError("isMarkdown"),isMarkdown=!0,_readOnlyError("body"),body=content),additionalContent[contentType]={type:contentType,message:content}})),replace&&replace.length){var replacedMsgId=replace.attr("id"),replacedMessage=conversation.getMessageByIdInHistory(replacedMsgId);replacedMessage||(replacedMessage=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.create(replacedMsgId,date,from,side,body,!1,isMarkdown,null,null,null,null),message=replacedMessage),from.jid!==replacedMessage.from.jid?($log.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived : message Replaced by somebody else - Skip"),message=null):replacedMessage&&replacedMessage.addReplaceMsg(messageId,body)}else{var answeredMsgId=answeredMsg?answeredMsg.text():null,answeredMsgDate=answeredMsg?answeredMsg.attr("stamp"):null,alternativeContent=alternativeContentStanza?{type:alternativeContentStanza.attr("type"),message:alternativeContentStanza.text()}:null;message=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.create(messageId,date,from,side,body,!1,isMarkdown,null,answeredMsgId,answeredMsgDate,additionalContent,alternativeContent)}}}message&&(message.receiptStatus="true"===angular.element(ack).attr("read")?5:"true"===angular.element(ack).attr("recv")?4:3,$log.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived : pushing msg inside historyMessages"),conversation.addMessageInHistoryMessages(message))}}else if(queryId.startsWith("cache_")){$log.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived : Query Id for Cached Message");var conversationId=queryId.substr(6);if(conversation=this.conversationService.getConversationById(conversationId)){var _fromJid2;$log.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived : Conversation Found");var _brutJid=stanzaElem.find("forwarded message").attr("from");if(!(_fromJid2=_brutJid&&0===_brutJid.indexOf("room_")?_brutJid.split("/")[1]:_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.getBareJidFromJid(stanzaElem.find("forwarded message").attr("from")))&&stanzaElem.find("event").length){var _roomEvent=stanzaElem.find("event").attr("name");_fromJid2=stanzaElem.find("event").attr("jid"),"welcome"===_roomEvent&&conversation.room&&conversation.room.ownerContact&&(_fromJid2=conversation.room.ownerContact.jid)}if(!_fromJid2)return $log.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived - Receive message without valid fromJid information"),!0;var _from=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.getContactByJid(_fromJid2),_messageId=stanzaElem.find("forwarded message").attr("id"),_date=new Date(stanzaElem.find("forwarded delay").attr("stamp")),_body=stanzaElem.find("forwarded message body").text(),_side=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.isUserContact(_from)?_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.Side.RIGHT:_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.Side.LEFT;_from||($log.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived missing contact for jid : "+_fromJid2+", ignore message"),_from=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.createEmptyContact(_fromJid2));var _message2=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.create(_messageId,_date,_from,_side,_body,!1,!1);_message2&&conversation.addMessageInCacheMessages(_message2),conversation.historyDefered&&conversation.historyDefered.resolve(_message2)}}}else if(queryId=angular.element(stanza).find("fin").attr("queryid"),conversation=this.conversationService.getConversationById(queryId)){conversation.historyComplete="true"===angular.element(stanza).find("fin").attr("complete");var historyIndex=angular.element(stanza).find("fin set first").text();-1===conversation.historyIndex?(conversation.messages.unshift.apply(conversation.messages,conversation.historyMessages),conversation.chatRenderer&&conversation.chatRenderer.prependMessages(conversation.messages,conversation.room)):(conversation.messages.unshift.apply(conversation.messages,conversation.historyMessages),conversation.chatRenderer&&conversation.chatRenderer.prependMessages(conversation.historyMessages,conversation.room)),conversation.historyIndex=historyIndex,conversation.historyMessages=[],angular.isDefined(conversation.messages)&&conversation.messages.length>0?conversation.lastMessageText=conversation.messages[conversation.messages.length-1].data:conversation.lastMessageText="",conversation.historyDefered&&conversation.historyDefered.resolve(conversation)}return!0}catch(error){return $log.error("[ConversationServiceHistoryHandler] onHistoryMessageReceived error : "+error),!0}},ConversationServiceHistoryHandler.prototype.onSearchTextMessageReceived=function(stanza){$log.info("[ConversationServiceHistoryHandler] onSearchTextMessageReceived");try{var otherJid,stanzaElem=$(stanza),fromJid=stanzaElem.find("forwarded message").attr("from"),toJid=stanzaElem.find("forwarded message").attr("to"),isSent=!1,isRoom=!1;if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.isUserContactJid(fromJid)?($log.info("[ConversationServiceHistoryHandler] sent message"),isSent=!0,otherJid=toJid):($log.info("[ConversationServiceHistoryHandler] received message"),isSent=!1,otherJid=fromJid),otherJid&&0===otherJid.indexOf("room_")?(otherJid=otherJid.split("/")[0],isRoom=!0):otherJid=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.getBareJidFromJid(otherJid),!otherJid)return void $log.warn("[ConversationServiceHistoryHandler] onSearchTextMessageReceived - Receive message without valid otherJid information");var messageId=stanzaElem.find("forwarded message").attr("id"),date=new Date(stanzaElem.find("forwarded delay").attr("stamp")),body=stanzaElem.find("forwarded message body").text(),historyIndex=stanzaElem.find("result").attr("id"),searchMsgResult=SearchTextMsgResultFactory();return searchMsgResult.body=body,searchMsgResult.date=date,searchMsgResult.isRoom=isRoom,searchMsgResult.isSent=isSent,searchMsgResult.messageId=messageId,searchMsgResult.otherJid=otherJid,searchMsgResult.historyIndex=historyIndex,searchMsgResult}catch(error){return $log.error("[ConversationServiceHistoryHandler] onSearchTextMessageReceived error : "+error),!0}},ConversationServiceHistoryHandler.prototype.onWebrtcHistoryMessageReceived=function(stanza,conversation){try{var stanzaElem=$(stanza),messageId=stanzaElem.find("forwarded message").attr("id"),callerJid=stanzaElem.find("caller").text(),state=stanzaElem.find("state").text(),duration=0;stanzaElem.find("duration")&&(duration=stanzaElem.find("duration").text(),duration=parseInt(duration,10)),duration=duration>0?"("+moment.duration(duration,"ms").format("h[H] mm[m] ss[s]")+")":0;var date=stanzaElem.find("date").text();date=date?new Date(date):new Date(stanzaElem.find("forwarded delay").attr("stamp"));var body="";"missed"===state?body="missedCall||"+date:"answered"===state&&(body="activeCallMsg||"+date+"||"+duration);var message=conversation.getMessageById(messageId);if(message||(message=conversation.historyMessages.find((function(item){return item.id===messageId}))),message)$log.info("[ConversationServiceHistoryHandler] ("+conversation.id+") try to add an already stored message with id "+message.id);else{var from=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.getContactByJid(callerJid);from||($log.warn("[ConversationServiceHistoryHandler] onWebrtcHistoryMessageReceived missing contact for jid : "+callerJid+", ignore message"),from=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.createEmptyContact(callerJid));var side=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.isUserContact(from)?_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.Side.RIGHT:_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.Side.LEFT;message=_models_appli_message__WEBPACK_IMPORTED_MODULE_0__.Message.createWebRTCMessage(messageId,date,from,side,body,!1);var ack=stanzaElem.find("forwarded message ack");ack&&(message.receiptStatus="true"===angular.element(ack).attr("read")?5:"true"===angular.element(ack).attr("received")?4:3),conversation.historyMessages.push(message)}return!0}catch(error){return!0}},ConversationServiceHistoryHandler}])},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var ChannelService=function(_channel_service_1$Ch){_inherits(ChannelService,_channel_service_1$Ch);var _super4=_createSuper(ChannelService);function ChannelService($rootScope,$http){return _classCallCheck(this,ChannelService),_super4.call(this,$rootScope,$http)}return ChannelService}(__webpack_require__(353).ChannelServiceAgnostic);ChannelService.$inject=["$rootScope","$http"],exports.ChannelService=ChannelService,angular.module("rainbow").service("channelService",ChannelService)},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),channel_1=__webpack_require__(220),channelMessage_model_1=__webpack_require__(354),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),profile_service_1=__webpack_require__(6),event_service_1=__webpack_require__(32),logger_service_1=__webpack_require__(15),i18n_service_1=__webpack_require__(38),contact_service_1=__webpack_require__(1),event_model_1=__webpack_require__(24),_escape=__webpack_require__(60),imageUtils_service_1=__webpack_require__(74),FeedChannel=function FeedChannel(){_classCallCheck(this,FeedChannel),this.messages=[],this.complete=!1,this.pageIndex=0,this.isLoading=!1,this.type="AGGREGATE"},ChannelServiceAgnostic=function(){function ChannelServiceAgnostic($rootScope,$http){_classCallCheck(this,ChannelServiceAgnostic),this.$rootScope=$rootScope,this.$http=$http,this.eventService=event_service_1.default,this.logger=logger_service_1.default,this.authService=auth_service_1.default,this.xmppService=xmpp_service_1.default,this.profileService=profile_service_1.default,this.i18n=i18n_service_1.default,this.contactService=contact_service_1.default,this.listeners=[],this.isStarted=!1,this.channels={},this.channelsList=[],this.serviceStatusSubject=new rxjs_1.Subject,this.rxSubject=new rxjs_1.Subject,this.LIST_EVENT_TYPE={ADD:0,UPDATE:1,REMOVE:2,DELETE:3,SUBSCRIBE:4,UNSUBSCRIBE:5,CREATE:6},this.USER_ROLE={NONE:"none",OWNER:"owner",PUBLISHER:"publisher",MEMBER:"member"},this.MESSAGE_ACTION={ADD:0,RETRACT:1},this.xmppMessageHandler=null,this.xmppManagementHandler=null,this.notificationCounter=0,this.messageCounter=0,this.invitationCounter=0,this.CHANNEL_UPDATE_EVENT="CHANNEL_UPDATE_EVENT",this.CHANNEL_MESSAGE_RECEIVED="CHANNEL_MESSAGE_RECEIVED",this.CHANNEL_USERS_UPDATE_EVENT="CHANNEL_USERS_UPDATE_EVENT",this.CHANNEL_NOTIFICATION_NUMBER_UPDATED="CHANNEL_NOTIFICATION_NUMBER_UPDATED",this.CHANNEL_USER_SUBSCRIPTION_EVENT="CHANNEL_USER_SUBSCRIPTION_EVENT"}return _createClass(ChannelServiceAgnostic,[{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee385(){return regenerator_default.a.wrap((function(_context386){for(;;)switch(_context386.prev=_context386.next){case 0:if(_context386.prev=0,this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CHANNEL_ACTIVATED)){_context386.next=3;break}return _context386.abrupt("return");case 3:if(!this.contactService.userContact.isCPaaSGuest()){_context386.next=5;break}return _context386.abrupt("return");case 5:if(this.contactService.userContact.channelsEnabled){_context386.next=7;break}return _context386.abrupt("return");case 7:this.logger.info("=== STARTING ==="),this.feedChannel=new FeedChannel,this.portalURL=config.restServerUrl+"/api/rainbow/channels/v1.0/channels",this.getMyChannels(),_context386.next=13;break;case 10:_context386.prev=10,_context386.t0=_context386.catch(0),this.logger.info("=== STARTING FAILURE === "+_context386.t0.message);case 13:case"end":return _context386.stop()}}),_callee385,this,[[0,10]])})))}},{key:"getMyChannels",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee386(){var url,headers,responseData,_this184=this;return regenerator_default.a.wrap((function(_context387){for(;;)switch(_context387.prev=_context387.next){case 0:return _context387.prev=0,url=this.portalURL+"?format=full",headers=this.authService.getRequestHeader(),_context387.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((responseData=_context387.sent).ok){_context387.next=8;break}throw this.logger.debug("Request ".concat(responseData.headers.get("x-rainbow-request-id")," failed with status ").concat(responseData.status)),new Error(responseData.statusText);case 8:return _context387.next=10,responseData.json();case 10:return _context387.sent.data.forEach((function(channelData){var channel=channel_1.Channel.create(channelData);_this184.updateDisplayInfo(channel),channel.invited&&_this184.incrementInvitationCounter(),(channel.subscribed||channel.invited)&&(_this184.channels[channel.id]=channel)})),this.updateChannelsList(),this.attachHandlers(),this.attachListeners(),this.isStarted=!0,this.$rootScope.$broadcast("ON_CHANNEL_SERVICE_STARTED"),this.serviceStatusSubject.next("CHANNEL_SERVICE_STARTED"),_context387.abrupt("return",this.channelsList);case 20:throw _context387.prev=20,_context387.t0=_context387.catch(0),this.channelErrorHandler("getMyChannels",_context387.t0);case 23:case"end":return _context387.stop()}}),_callee386,this,[[0,20]])})))}},{key:"attachHandlers",value:function(){var _this185=this;this.xmppMessageHandler&&(this.xmppService.connection.deleteHandler(this.xmppMessageHandler),this.xmppMessageHandler=null),this.xmppManagementHandler&&(this.xmppService.connection.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.xmppMessageHandler=this.xmppService.connection.addHandler((function(stanza){return _this185.onChannelMessageReceived(stanza)}),null,"message","headline"),this.xmppManagementHandler=this.xmppService.connection.addHandler((function(stanza){return _this185.onChannelManagementReceived(stanza)}),null,"message","management")}},{key:"attachListeners",value:function(){var _this186=this;this.listeners.push(this.eventService.subscribe(this.CHANNEL_USERS_UPDATE_EVENT,(function(_event,channelId,users){return _this186.usersUpdateHandler(_event,channelId,users)})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee387(){return regenerator_default.a.wrap((function(_context388){for(;;)switch(_context388.prev=_context388.next){case 0:this.logger.info("=== STOPPING ==="),this.listeners.forEach((function(destroyFunction){destroyFunction()})),this.channels={},this.channelsList=[],this.feedChannel=null,this.notificationCounter=0,this.logger.info("=== STOPPED ===");case 1:case"end":return _context388.stop()}}),_callee387,this)})))}},{key:"subscribe",value:function(handler){return this.rxSubject.subscribe(handler)}},{key:"reconnect",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee388(){return regenerator_default.a.wrap((function(_context389){for(;;)switch(_context389.prev=_context389.next){case 0:return _context389.prev=0,this.logger.info("reconnect"),_context389.next=4,this.stop();case 4:return _context389.next=6,this.start();case 6:_context389.next=11;break;case 8:_context389.prev=8,_context389.t0=_context389.catch(0),this.logger.error("reconnect -- failure -- "+_context389.t0.message);case 11:case"end":return _context389.stop()}}),_callee388,this,[[0,8]])})))}},{key:"removeChannelFromCache",value:function(channelId){var _this187=this;return new Promise((function(resolve,reject){var channelToRemove=_this187.getChannelFromCache(channelId);if(channelToRemove){var channelName=channelToRemove.name;channelToRemove.invited&&_this187.decrementInvitationCounter(),delete _this187.channels[channelId],_this187.updateChannelsList(),_this187.feedChannel.messages=[],_this187.retrieveLatests().then((function(){resolve(channelName)})).catch((function(err){reject(err)}))}}))}},{key:"onChannelMessageReceived",value:function(stanza){try{var eventNode=$(stanza).find("event");if(eventNode&&"http://jabber.org/protocol/pubsub#event"===eventNode.attr("xmlns")){var items=eventNode.find("items"),item=items.find("item"),retract=items.find("retract"),update=eventNode.find("update");if(1===update.length)this.updateMessage(update);else if(1===item.length)this.onNewMessage(item);else if(1===retract.length){var messageId=retract.attr("id"),channelId=items.attr("node").split(":")[0];this.onRetractMessage(channelId,messageId)}}return!0}catch(err){return this.logger.error("onChannelMessageReceived -- failure -- "+err.message),!0}}},{key:"onNewMessage",value:function(item){var entry=item.find("entry"),messageId=item.attr("id"),channelId=entry.attr("channelId"),channel=this.getChannelFromCache(channelId),channelMessageIndex=channel.messages.findIndex((function(mess){return mess.id===messageId})),feedMessageIndex=this.feedChannel.messages.findIndex((function(mess){return mess.id===messageId})),action=entry.attr("creation")?"modify":"new";-1===channelMessageIndex&&-1===feedMessageIndex||(action="modify"),this.logger.info("[channelService] onChannelMessageReceived -- "+action+" message "+messageId+" on channel "+channelId);var message={id:messageId,channelId:channelId,from:entry.attr("from"),fromDetails:null,new:!1,entry:{type:entry.find("type").length?entry.find("type")[0].textContent:"",message:entry.find("message").length?entry.find("message")[0].textContent:"",title:entry.find("title").length?entry.find("title")[0].textContent:"",url:entry.find("url").length?entry.find("url")[0].textContent:"",images:[],attachments:[],video:null},modified:"modify"===action,timestamp:new Date(entry.attr("timestamp"))},imagesElem=item.find("images");0!==imagesElem.length&&imagesElem.find("id").each((function(__index,image){message.entry.images.push({id:image.textContent})}));var attachmentsElem=item.find("attachments");0!==attachmentsElem.length&&attachmentsElem.find("id").each((function(__index,attachment){message.entry.attachments.push({id:attachment.textContent})}));var videoElem=item.find("video");if(0!==videoElem.length&&(message.entry.video={provider:videoElem.find("provider")[0].textContent,id:videoElem.find("id")[0].textContent}),"new"===action){var channelMessage=channelMessage_model_1.ChannelMessage.createFromData(channel,message);channel.loaded&&channel.messages.unshift(channelMessage),this.feedChannel.messages.unshift(channelMessage),this.contactService.userContact.jid!==message.from&&(channelMessage.isNew=!0,this.incrementMessagesCounter()),this.$rootScope.$broadcast(this.CHANNEL_MESSAGE_RECEIVED,this.MESSAGE_ACTION.ADD,message),this.rxSubject.next(event_model_1.RBEvent.create(this.CHANNEL_MESSAGE_RECEIVED,{action:this.MESSAGE_ACTION.ADD,message:message}))}else{var _channelMessage=channelMessage_model_1.ChannelMessage.createFromData(channel,message);-1!==channelMessageIndex&&channel.messages.splice(channelMessageIndex,1,_channelMessage),-1!==feedMessageIndex&&this.feedChannel.messages.splice(feedMessageIndex,1,_channelMessage)}}},{key:"updateMessage",value:function(update){var messageId=update.attr("id"),channelId=update.attr("channel_id"),channelMessage=this.getChannelMessage(channelId,messageId);if(channelMessage){var myLikeElem=update.find("my_appreciation");channelMessage.myLike=1===myLikeElem.length?myLikeElem.attr("appreciation"):"none";var likesElem=update.find("appreciations");1===likesElem.length&&(channelMessage.likeCounters=["like","happy","applause","fantastic","doubt"].reduce((function(result,key){return result[key]=parseInt(likesElem.attr(key)||0,10),result}),{})),channelMessage.publishUpdate()}}},{key:"getChannelMessage",value:function(channelId,messageId){var channel=this.getChannelFromCache(channelId);if(channel){var channelMessageIndex=channel.messages.findIndex((function(mess){return mess.id===messageId})),feedMessageIndex=this.feedChannel.messages.findIndex((function(mess){return mess.id===messageId})),channelMessage=-1!==channelMessageIndex?channel.messages.find((function(mess){return mess.id===messageId})):null;return channelMessage||-1===feedMessageIndex||(channelMessage=this.feedChannel.messages.find((function(mess){return mess.id===messageId}))),channelMessage}return null}},{key:"onRetractMessage",value:function(channelId,messageId){this.logger.info("[channelService] onRetractMessage -- retract message "+messageId+" on channel "+channelId);var channel=this.getChannelFromCache(channelId),messageIndex=channel.messages.findIndex((function(message){return message.id===messageId}));-1!==messageIndex&&(channel.messages[messageIndex].new&&this.decrementMessagesCounter(),channel.messages.splice(messageIndex,1));var messageListIndex=this.feedChannel.messages.findIndex((function(message){return message.id===messageId}));-1!==messageListIndex&&this.feedChannel.messages.splice(messageListIndex,1),this.$rootScope.$broadcast(this.CHANNEL_MESSAGE_RECEIVED,this.MESSAGE_ACTION.RETRACT)}},{key:"onChannelManagementReceived",value:function(stanza){try{var channelMuteElem=angular.element(stanza).find("mute");if(channelMuteElem&&channelMuteElem.length>0&&"channel"===channelMuteElem.attr("type")){var channelId=channelMuteElem.attr("peer_id"),channel=this.getChannelFromCache(channelId);this.muteChannel(channel)}var channelUnmuteElem=angular.element(stanza).find("unmute");if(channelUnmuteElem&&channelUnmuteElem.length>0&&"channel"===channelUnmuteElem.attr("type")){var _channelId=channelUnmuteElem.attr("peer_id"),_channel=this.getChannelFromCache(_channelId);this.unmuteChannel(_channel)}var channelElem=angular.element(stanza).find("channel");if(channelElem&&channelElem.length>0){var _channelId2=channelElem.attr("channelid"),_channel2=this.getChannelFromCache(_channelId2);if(_channel2){var avatarElem=channelElem.find("avatar"),nameElem=channelElem.find("name"),topicElem=channelElem.find("topic"),categoryElem=channelElem.find("category");avatarElem&&avatarElem.length>0&&this.onAvatarChange(_channelId2,avatarElem),nameElem&&nameElem.length>0&&(_channel2.name=nameElem.text()),topicElem&&topicElem.length>0&&(_channel2.topic=topicElem.text()),categoryElem&&categoryElem.length>0&&(_channel2.category=categoryElem.text()),this.updateDisplayInfo(_channel2)}var action=channelElem.attr("action");switch(this.logger.info("[channelService] onChannelManagementReceived -- "+action+" event received on channel "+_channelId2),action){case"add":this.onAddToChannel(_channelId2);break;case"update":this.onUpdateToChannel(_channelId2);break;case"remove":this.onRemovedFromChannel(_channelId2);break;case"subscribe":this.onSubscribeToChannel(_channelId2,channelElem.attr("subscribers"));break;case"unsubscribe":this.onUnsubscribeToChannel(_channelId2,channelElem.attr("subscribers"));break;case"delete":this.onDeleteChannel(_channelId2)}}var channelSubscriptionElem=angular.element(stanza).find("channel-subscription");if(channelSubscriptionElem&&channelSubscriptionElem.length>0){var _channelId3=channelSubscriptionElem.attr("channelid"),_action=channelSubscriptionElem.attr("action"),userId=channelSubscriptionElem.attr("id"),subscribers=channelSubscriptionElem.attr("subscribers");switch(this.getChannelFromCache(_channelId3).subscribers_count=Number.parseInt(subscribers,10),this.logger.info("[channelService] onChannelManagementReceived -- subscription-"+_action+" event received on channel "+_channelId3),_action){case"subscribe":this.onUserSubscribeEvent(_channelId3,userId);break;case"unsubscribe":this.onUserUnsubscribeEvent(_channelId3,userId)}}return!0}catch(err){return this.logger.error("[channels] onChannelManagementReceived -- failure -- "+err.message),!0}}},{key:"onAvatarChange",value:function(channelId,avatar){var action=avatar.attr("action"),updateDate=avatar.attr("lastAvatarUpdateDate")?new Date(avatar.attr("lastAvatarUpdateDate")):null;if(this.logger.info("[channelService] onChannelManagementReceived -- "+action+" avatar for "+channelId),"delete"===action||"update"===action){var channel=this.getChannelFromCache(channelId);channel.lastAvatarUpdateDate=updateDate,null!==updateDate&&(channel.avatar=config.restServerUrl+"/api/channel-avatar/"+channelId+"?size=256&ts="+new Date(updateDate).getTime())}}},{key:"onUpdateToChannel",value:function(channelId){var _this188=this;this.getChannel(channelId).then((function(newChannel){newChannel.invited&&(_this188.addChannelToCache(newChannel),_this188.$rootScope.$broadcast(_this188.CHANNEL_UPDATE_EVENT,_this188.LIST_EVENT_TYPE.ADD,newChannel.id))}))}},{key:"onAddToChannel",value:function(channelId){var _this189=this,channel=this.getChannelFromCache(channelId);this.getChannel(channelId).then((function(newChannel){channel||newChannel.invited?!channel&&newChannel.invited?(_this189.addChannelToCache(newChannel),_this189.incrementInvitationCounter(),_this189.$rootScope.$broadcast(_this189.CHANNEL_UPDATE_EVENT,_this189.LIST_EVENT_TYPE.SUBSCRIBE,newChannel.id),_this189.rxSubject.next(event_model_1.RBEvent.create(_this189.CHANNEL_UPDATE_EVENT,{action:_this189.LIST_EVENT_TYPE.SUBSCRIBE,channelId:newChannel.id}))):channel&&newChannel.userRole!==_this189.USER_ROLE.NONE&&(channel.userRole=newChannel.userRole,_this189.feedChannel.messages=[],_this189.retrieveLatests().then((function(){_this189.$rootScope.$broadcast(_this189.CHANNEL_UPDATE_EVENT,_this189.LIST_EVENT_TYPE.SUBSCRIBE,channelId)}))):(_this189.addChannelToCache(newChannel),_this189.$rootScope.$broadcast(_this189.CHANNEL_UPDATE_EVENT,_this189.LIST_EVENT_TYPE.ADD,newChannel.id))}))}},{key:"onRemovedFromChannel",value:function(channelId){var _this190=this;this.removeChannelFromCache(channelId).then((function(){_this190.$rootScope.$broadcast(_this190.CHANNEL_UPDATE_EVENT,_this190.LIST_EVENT_TYPE.DELETE,channelId)}))}},{key:"onSubscribeToChannel",value:function(channelId,subscribersInfo){var _this191=this,channel=this.getChannelFromCache(channelId),subscribers=Number.parseInt(subscribersInfo,10);channel?(channel.invited=!1,channel.subscribed=!0,channel.subscribers_count=subscribers,this.feedChannel.messages=[],this.retrieveLatests().then((function(){_this191.$rootScope.$broadcast(_this191.CHANNEL_UPDATE_EVENT,_this191.LIST_EVENT_TYPE.SUBSCRIBE,channelId)}))):this.getChannel(channelId).then((function(newChannel){return _this191.addChannelToCache(newChannel),_this191.feedChannel.messages=[],_this191.retrieveLatests()})).then((function(){_this191.$rootScope.$broadcast(_this191.CHANNEL_UPDATE_EVENT,_this191.LIST_EVENT_TYPE.SUBSCRIBE,channelId)}))}},{key:"onUnsubscribeToChannel",value:function(channelId,subscribersInfo){var _this192=this,subscribers=Number.parseInt(subscribersInfo,10),channel=this.getChannelFromCache(channelId);channel.subscribers_count=subscribers,channel.subscribed=!1,this.feedChannel.messages=[],this.retrieveLatests().then((function(){_this192.$rootScope.$broadcast(_this192.CHANNEL_UPDATE_EVENT,_this192.LIST_EVENT_TYPE.UNSUBSCRIBE,channelId)}))}},{key:"onDeleteChannel",value:function(channelId){var _this193=this;this.removeChannelFromCache(channelId).then((function(){_this193.$rootScope.$broadcast(_this193.CHANNEL_UPDATE_EVENT,_this193.LIST_EVENT_TYPE.DELETE,channelId)}))}},{key:"onUserSubscribeEvent",value:function(channelId,userId){this.$rootScope.$broadcast(this.CHANNEL_USER_SUBSCRIPTION_EVENT,this.LIST_EVENT_TYPE.SUBSCRIBE,channelId,userId)}},{key:"onUserUnsubscribeEvent",value:function(channelId,userId){this.$rootScope.$broadcast(this.CHANNEL_USER_SUBSCRIPTION_EVENT,this.LIST_EVENT_TYPE.UNSUBSCRIBE,channelId,userId)}},{key:"getChannelNextPage",value:function(channel){var reset=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee389(){var logChannelName,askedMessagesNumber,messages,lastMessageDate,nbMessages;return regenerator_default.a.wrap((function(_context390){for(;;)switch(_context390.prev=_context390.next){case 0:if(logChannelName="AGGREGATE"===channel.type?"feedChannel":channel.id,_context390.prev=1,!channel.isLoading){_context390.next=4;break}return _context390.abrupt("return",void this.logger.info("-- getChannelNextPage("+logChannelName+", "+channel.pageIndex+") -- ignored (isLoading)"));case 4:if(channel.isLoading=!0,reset&&(channel.pageIndex=0),!((askedMessagesNumber=(channel.pageIndex+1)*ChannelServiceAgnostic.PAGE_SIZE)<=channel.messages.length)){_context390.next=8;break}return _context390.abrupt("return",(this.logger.info("-- getChannelNextPage("+logChannelName+", "+channel.pageIndex+") -- success from cache"),channel.pageIndex+=1,channel.isLoading=!1,{messages:channel.messages,nbMessages:askedMessagesNumber}));case 8:if(!channel.complete){_context390.next=10;break}return _context390.abrupt("return",(this.logger.info("-- getChannelNextPage("+logChannelName+", "+channel.pageIndex+") -- success from cache (complete)"),channel.isLoading=!1,{messages:channel.messages,nbMessages:channel.messages.length}));case 10:return messages=channel.messages,lastMessageDate=messages.length?messages[messages.length-1].timestamp:null,_context390.next=14,this.getChannelMessages(channel,lastMessageDate);case 14:return nbMessages=_context390.sent,_context390.abrupt("return",(nbMessages<ChannelServiceAgnostic.PAGE_SIZE&&(channel.complete=!0),this.logger.info("-- getChannelNextPage("+logChannelName+", "+channel.pageIndex+") -- success from server "+(channel.complete?"(complete)":"")+" -- retreive "+nbMessages+" message(s)"),channel.pageIndex+=1,channel.loaded=!0,channel.isLoading=!1,{messages:channel.messages,nbMessages:channel.messages.length}));case 18:throw _context390.prev=18,_context390.t0=_context390.catch(1),channel.isLoading=!1,this.channelErrorHandler("getChannelNextPage("+logChannelName+", "+channel.pageIndex+")",_context390.t0);case 21:case"end":return _context390.stop()}}),_callee389,this,[[1,18]])})))}},{key:"getChannelPublishers",value:function(channel){var _this194=this;return new Promise((function(resolve,reject){if(channel.publishersRetreived)return resolve();_this194.getChannelUsers(channel.id,{format:"full",types:"owner publisher"}).then((function(usersData){usersData.data.forEach((function(userData){var contact=_this194.contactService.getContactByJid(userData.jid_im);contact||((contact=_this194.contactService.createContact()).updateFromUserData(userData),_this194.contactService.updateContactRichStatus(contact),_this194.contactService.contacts[contact.id]=contact,_this194.contactService.dbContacts[contact.dbId]=contact,_this194.contactService.jtelContacts[contact.jidtel]=contact),channel.users.push(contact)})),channel.publishersRetreived=!0,_this194.logger.info("[channelService] getChannelPublishers ("+channel.id+") -- success -- find "+usersData.length+" publisher(s)"),resolve()})).catch((function(err){reject(_this194.channelErrorHandler("getChannelPublishers ("+channel.id+")",err))}))}))}},{key:"getChannelMessages",value:function(channel,beforeDate){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee390(){var provider,messages,_this195=this;return regenerator_default.a.wrap((function(_context391){for(;;)switch(_context391.prev=_context391.next){case 0:return _context391.prev=0,null,provider="AGGREGATE"===channel.type?this.getLatestMessages(10,beforeDate):this.getChannelItems(channel.id,ChannelServiceAgnostic.PAGE_SIZE,beforeDate),_context391.next=5,provider;case 5:return messages=_context391.sent.map((function(messageData){return channelMessage_model_1.ChannelMessage.createFromData(_this195.getChannelFromCache(messageData.channelId),messageData)})),_context391.abrupt("return",(channel.messages.push.apply(channel.messages,messages),messages.length));case 9:throw _context391.prev=9,_context391.t0=_context391.catch(0),this.channelErrorHandler("getChannelMessages ("+channel.id+")",_context391.t0);case 12:case"end":return _context391.stop()}}),_callee390,this,[[0,9]])})))}},{key:"getChannelInvitations",value:function(){return this.channelsList.filter((function(channel){return!channel.deleted&&channel.invited}))}},{key:"muteChannel",value:function(channel){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee391(){var url,responseData;return regenerator_default.a.wrap((function(_context392){for(;;)switch(_context392.prev=_context392.next){case 0:return _context392.prev=0,url="".concat(this.portalURL,"/").concat(channel.id,"/mute"),_context392.next=4,fetch(url,{method:"POST",headers:this.authService.getPostHeader()});case 4:if((responseData=_context392.sent).ok){_context392.next=7;break}throw new Error(responseData.statusText);case 7:channel.muted=!0,channel.updateSubject.next(),_context392.next=13;break;case 10:throw _context392.prev=10,_context392.t0=_context392.catch(0),this.channelErrorHandler("muteChannel",_context392.t0);case 13:case"end":return _context392.stop()}}),_callee391,this,[[0,10]])})))}},{key:"unmuteChannel",value:function(channel){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee392(){var url,responseData;return regenerator_default.a.wrap((function(_context393){for(;;)switch(_context393.prev=_context393.next){case 0:return _context393.prev=0,url="".concat(this.portalURL,"/").concat(channel.id,"/mute"),_context393.next=4,fetch(url,{method:"DELETE",headers:this.authService.getPostHeader()});case 4:if((responseData=_context393.sent).ok){_context393.next=7;break}throw new Error(responseData.statusText);case 7:channel.muted=!1,channel.updateSubject.next(),_context393.next=13;break;case 10:throw _context393.prev=10,_context393.t0=_context393.catch(0),this.channelErrorHandler("unmuteChannel",_context393.t0);case 13:case"end":return _context393.stop()}}),_callee392,this,[[0,10]])})))}},{key:"createChannel",value:function(name,mode){var _this196=this,topic=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",category=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"globalnews",autoProvisionning=arguments.length>4&&void 0!==arguments[4]&&arguments[4],max_items=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100;return new Promise((function(resolve,reject){var url=_this196.portalURL+(autoProvisionning?"?auto_provisioning=true":""),data={name:name,mode:mode,topic:topic,category:category,max_items:max_items};_this196.$http({method:"POST",url:url,headers:_this196.authService.getPostHeader(),data:data}).then((function(response){_this196.logger.info("[channelService] createChannel -- "+name+" -- "+mode+" -- success");var channel=channel_1.Channel.create(response.data.data);_this196.updateDisplayInfo(channel),resolve(channel)})).catch((function(err){reject(_this196.channelErrorHandler("createChannel -- "+name+" -- "+mode,err))}))}))}},{key:"deleteChannel",value:function(channelId){var _this197=this;return new Promise((function(resolve,reject){_this197.$http({method:"DELETE",url:_this197.portalURL+"/"+channelId,headers:_this197.authService.getPostHeader()}).then((function(response){_this197.logger.info("[channelService] deleteChannel -- "+channelId+" -- success"),resolve(response)})).catch((function(err){reject(_this197.channelErrorHandler("deleteChannel ("+channelId+")",err))}))}))}},{key:"findChannels",value:function(filter){var _this198=this;return new Promise((function(resolve,reject){var query="?sortOrder="+(filter.sortOrder&&1===filter.sortOrder?"1":"-1");void 0!==filter.subscribed&&(query+="&subscribed="+filter.subscribed),filter.name&&(query+="&name="+filter.name),filter.topic&&(query+="&topic="+filter.topic),filter.limit&&(query+="&limit="+filter.limit),filter.offset&&(query+="&offset="+filter.offset),filter.sortField&&(query+="&sortField="+filter.sortField),filter.category&&(query+="&category="+filter.category),_this198.$http({method:"GET",url:_this198.portalURL+"/search"+query,headers:_this198.authService.getRequestHeader()}).then((function(response){var channels=[];response.data.data.forEach((function(channelData){var channel=channel_1.Channel.create(channelData);_this198.updateDisplayInfo(channel),channels.push(channel)})),resolve(channels)})).catch((function(err){reject(_this198.channelErrorHandler("findChannels ("+query+")",err))}))}))}},{key:"browseChannels",value:function(filter){var _this199=this;return new Promise((function(resolve,reject){var query="?sortOrder="+(filter.sortOrder&&1===filter.sortOrder?"1":"-1");filter.category&&(query+="&category="+filter.category),filter.excluded_category&&(query+="&excluded_category="+filter.excluded_category),void 0!==filter.subscribed&&(query+="&subscribed="+filter.subscribed),filter.limit&&(query+="&limit="+filter.limit),filter.offset&&(query+="&offset="+filter.offset),filter.sortField&&(query+="&sortField="+filter.sortField),_this199.$http({method:"GET",url:_this199.portalURL+"/browse"+query,headers:_this199.authService.getRequestHeader()}).then((function(response){var channels=[];response.data.data.forEach((function(channelData){var channel=channel_1.Channel.create(channelData);_this199.updateDisplayInfo(channel),channels.push(channel)})),resolve(channels)})).catch((function(err){reject(_this199.channelErrorHandler("browseChannels ("+query+")",err))}))}))}},{key:"getChannel",value:function(channelId){var _this200=this;return new Promise((function(resolve,reject){_this200.$http({method:"GET",url:_this200.portalURL+"/"+channelId,headers:_this200.authService.getRequestHeader()}).then((function(response){_this200.logger.info("[channelService] getChannel -- "+channelId+" -- success");var channel=channel_1.Channel.create(response.data.data);_this200.updateDisplayInfo(channel),resolve(channel)})).catch((function(err){reject(_this200.channelErrorHandler("getChannel ("+channelId+")",err))}))}))}},{key:"getChannelFromCache",value:function(channelId){var channel=this.channels[channelId];return void 0!==channel?channel:null}},{key:"publishToChannel",value:function(channelId,itemId,type,message,title,url,images,video,attachments){var _this201=this;return new Promise((function(resolve,reject){var data={type:type,title:title||"",message:message||"",images:images||[],attachments:attachments||[]},queryParam=itemId?"?itemId="+itemId:"";video&&(data.video=video),_this201.$http({method:"POST",url:_this201.portalURL+"/"+channelId+"/publish"+queryParam,headers:_this201.authService.getRequestHeader(),data:data}).then((function(response){_this201.logger.info("[channelService] publishToChannel -- "+channelId+" -- "+type+" -- success"),resolve(response)})).catch((function(err){reject(_this201.channelErrorHandler("publishToChannel ("+channelId+")",err))}))}))}},{key:"subscribeToChannel",value:function(channel){var _this202=this;return new Promise((function(resolve,reject){_this202.$http({method:"POST",url:_this202.portalURL+"/"+channel.id+"/subscribe",headers:_this202.authService.getRequestHeader()}).then((function(response){_this202.logger.info("[channelService] subscribeToChannel -- "+channel.id+" -- success"),channel.subscribed=!0,channel.users_count+=1,resolve(response)})).catch((function(err){reject(_this202.channelErrorHandler("subscribeToChannel ("+channel.id+")",err))}))}))}},{key:"unsubscribeToChannel",value:function(channel){var _this203=this;return new Promise((function(resolve,reject){_this203.$http({method:"DELETE",url:_this203.portalURL+"/"+channel.id+"/subscribe",headers:_this203.authService.getRequestHeader()}).then((function(response){_this203.logger.info("[channelService] unsubscribeToChannel -- success"),channel.subscribed=!1,channel.users_count-=1,channel.userRole=_this203.USER_ROLE.NONE,resolve(response)})).catch((function(err){reject(_this203.channelErrorHandler("unsubscribeToChannel",err))}))}))}},{key:"updateChannel",value:function(channelId,options){var _this204=this;return new Promise((function(resolve,reject){_this204.$http({method:"PUT",url:_this204.portalURL+"/"+channelId,headers:_this204.authService.getPostHeader(),data:options}).then((function(response){var channel=_this204.getChannelFromCache(channelId);channel.name=response.data.data.name,channel.topic=response.data.data.topic,channel.category=response.data.data.category,_this204.updateDisplayInfo(channel),_this204.logger.info("[channelService] updateChannel ( "+channelId+") -- success"),_this204.$rootScope.$broadcast(_this204.CHANNEL_UPDATE_EVENT,_this204.LIST_EVENT_TYPE.UPDATE,channel.id),channel.updateSubject.next(),resolve(channel)})).catch((function(err){reject(_this204.channelErrorHandler("updateChannel ("+channelId+")",err))}))}))}},{key:"getChannelItems",value:function(channelId,maxMessages){var _this205=this,beforeDate=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,afterDate=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise((function(resolve,reject){_this205.$http({method:"GET",url:_this205.portalURL+"/"+channelId+"/items",headers:_this205.authService.getRequestHeader(),params:{max:maxMessages,before:beforeDate,after:afterDate}}).then((function(response){_this205.logger.info("[channelService] getChannelItems -- success"),_this205.getChannelFromCache(channelId).messagesCount=response.data.data.status.count,_this205.chewReceivedItems(response.data.data.items),resolve(response.data.data.items)})).catch((function(err){reject(_this205.channelErrorHandler("getChannelItems",err))}))}))}},{key:"deleteChannelItem",value:function(channelId,itemId){var _this206=this;return new Promise((function(resolve,reject){_this206.$http({method:"DELETE",url:_this206.portalURL+"/"+channelId+"/items/"+itemId,headers:_this206.authService.getRequestHeader()}).then((function(response){_this206.logger.info("[channelService] deleteChannelItem ("+channelId+") -- success"),resolve()})).catch((function(err){reject(_this206.channelErrorHandler("deleteChannelItem ("+channelId+")",err))}))}))}},{key:"getChannelUsers",value:function(channelId,options){var _this207=this;return new Promise((function(resolve,reject){var data={};options&&(options.format&&"string"==typeof options.format&&options.format.length&&(data.format=options.format),options.limit&&"number"==typeof options.limit&&options.limit>0&&(data.limit=options.limit),options.offset&&"number"==typeof options.offset&&options.offset>0&&(data.offset=options.offset),options.sortField&&"string"==typeof options.sortField&&options.sortField.length&&(data.sortField=options.sortField),!options.sortOrder||"-1"!==options.sortOrder&&"1"!==options.sortOrder||(data.sortOrder=options.sortOrder));var url=_this207.portalURL+"/"+channelId+"/users";options&&(options.types&&"string"==typeof options.types&&options.types.length?url+="?types="+options.types:options.invited&&"boolean"==typeof options.invited&&(url+="?invited="+options.invited)),_this207.$http({method:"GET",url:url,headers:_this207.authService.getRequestHeader(),params:data}).then((function(response){_this207.logger.info("[channelService] getChannelUsers ("+channelId+") -- success"),resolve(response.data)})).catch((function(err){reject(_this207.channelErrorHandler("getChannelUsers ("+channelId+")",err))}))}))}},{key:"searchUsersByName",value:function(channelId,displayName,options){var _this208=this;return options.displayName=displayName,new Promise((function(resolve,reject){_this208.$http({method:"GET",url:_this208.portalURL+"/"+channelId+"/users/search",headers:_this208.authService.getRequestHeader(),params:options}).then((function(response){_this208.logger.info("[channelService] searchUsersByName ("+channelId+" -- success"),resolve(response.data.data)})).catch((function(err){reject(_this208.channelErrorHandler("searchUsersByName ("+channelId+")",err))}))}))}},{key:"deleteChannelAvatar",value:function(channel){var _this209=this;return new Promise((function(resolve,reject){_this209.$http({method:"DELETE",url:_this209.portalURL+"/"+channel.id+"/avatar",headers:_this209.authService.getRequestHeader()}).then((function(response){_this209.logger.info("[channelService] deleteChannelAvatar "+channel.id+" -- success"),resolve(response),channel.avatar=null,channel.lastAvatarUpdateDate=null,channel.updateSubject.next()})).catch((function(err){reject(_this209.channelErrorHandler("deleteChannelAvatar "+channel.id,err))}))}))}},{key:"uploadChannelAvatar",value:function(channel,avatar,avatarSize){var _this210=this;return new Promise((function(resolve,reject){imageUtils_service_1.resizeImage(avatar,avatarSize,avatarSize).then((function(resizedImage){var binaryData=imageUtils_service_1.getBinaryData(resizedImage);_this210.$http({method:"POST",url:_this210.portalURL+"/"+channel.id+"/avatar",headers:_this210.authService.getPostHeader("image/"+binaryData.type),data:binaryData.data,transformRequest:[]}).then((function(response){_this210.logger.info("[channelService] uploadChannelAvatar "+channel.id+" -- success"),channel.avatar=resizedImage.src,channel.lastAvatarUpdateDate=new Date,channel.updateSubject.next(),resolve(response)})).catch((function(err){reject(_this210.channelErrorHandler("uploadChannelAvatar",err))}))}))}))}},{key:"updateChannelUsers",value:function(channelId,users,userType){var _this211=this;return new Promise((function(resolve,reject){var members=users.map((function(user){return{id:user.dbId,type:userType}}));_this211.$http({method:"PUT",url:_this211.portalURL+"/"+channelId+"/users",headers:_this211.authService.getRequestHeader(),data:{data:members}}).then((function(response){_this211.logger.info("[channelService] updateChannelUsers -- success");var usersLists=response.data.data;_this211.$rootScope.$broadcast(_this211.CHANNEL_USERS_UPDATE_EVENT,channelId,usersLists),resolve(usersLists)})).catch((function(err){reject(_this211.channelErrorHandler("updateChannelUsers",err))}))}))}},{key:"usersUpdateHandler",value:function(_event,channelId,users){var channel=this.getChannelFromCache(channelId);if(null!==users){if(channel.users_count+=users.added.length-users.removed.length,channel.users.length){for(var i=0;i<users.added.length;i++)this.contactService.getContactByDBId(users.added[i]).then((function(contact){channel.users.push(contact)}));for(var _i7=0;_i7<users.removed.length;_i7++)for(var j=channel.users.length-1;j>=0;j--)if(channel.users[j].dbId===users.removed[_i7]){channel.users.splice(j,1);break}}if(users.invalidUsers&&users.invalidUsers.length&&"409005"===users.invalidUsers[0].errorDetailsCode){var message=this.i18n.translate("inviteUsersError");this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",message)}}}},{key:"retrieveUsers",value:function(channel){var _this212=this;if(this.logger.info("Retrieving users"),0===channel.users.length&&channel.userRole===this.USER_ROLE.OWNER){var publishers,owner=this.contactService.userContact;return owner.type="owner",this.getChannelUsers(channel.id,{format:"full",types:"publisher",limit:19}).then((function(pubs){return(publishers=pubs.data.length?pubs.data:[]).length<19?_this212.getChannelUsers(channel.id,{format:"full",types:"member",limit:19-publishers.length}):[]})).then((function(members){publishers.push.apply(publishers,members.data);var users=publishers;return channel.users=_this212.usersToContacts(users),channel.users.unshift(owner),channel.users}))}return Promise.resolve(null)}},{key:"usersToContacts",value:function(users){var _this213=this;if(null!==users)return users.map((function(user){var contact=_this213.contactService.createContact(user.jid_im,user.firstName,user.lastName,user.company,user.loginEmail);contact.dbId=user.id,contact.lastAvatarUpdateDate=user.lastAvatarUpdateDate,contact.type=user.type||user.affiliation,contact.getAvatar()}))}},{key:"retrieveLatests",value:function(){var _this214=this,beforeDate=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.getLatestMessages(10,beforeDate,null).then((function(messagesData){var channelMessages=messagesData.map((function(messageData){return channelMessage_model_1.ChannelMessage.createFromData(_this214.getChannelFromCache(messageData.channelId),messageData)}));return _this214.feedChannel.messages.push.apply(_this214.feedChannel.messages,channelMessages),channelMessages.length}))}},{key:"incrementMessagesCounter",value:function(){this.messageCounter+=1,this.updateNotificationCounter()}},{key:"decrementMessagesCounter",value:function(){this.messageCounter-=1,this.updateNotificationCounter()}},{key:"incrementInvitationCounter",value:function(){this.invitationCounter+=1,this.updateNotificationCounter()}},{key:"decrementInvitationCounter",value:function(){this.invitationCounter-=1,this.updateNotificationCounter()}},{key:"ackMessages",value:function(){this.messageCounter=0,this.updateNotificationCounter(),this.feedChannel.messages.forEach((function(message){message.new=!1}))}},{key:"ackMessage",value:function(messageId){this.feedChannel.messages.forEach((function(message){message.id===messageId&&(message.new=!1)})),this.decrementMessagesCounter()}},{key:"updateNotificationCounter",value:function(){this.notificationCounter=this.messageCounter+this.invitationCounter,this.notificationCounter<0&&(this.notificationCounter=0),this.$rootScope.$broadcast(this.CHANNEL_NOTIFICATION_NUMBER_UPDATED,this.notificationCounter)}},{key:"removeAllUsersFromChannel",value:function(channelId){var _this215=this;return new Promise((function(resolve,reject){_this215.$http({method:"DELETE",url:_this215.portalURL+"/"+channelId+"/users",headers:_this215.authService.getRequestHeader()}).then((function(response){_this215.logger.info("[channelService] Removed all users from channel -- success"),_this215.$rootScope.$broadcast(_this215.CHANNEL_USERS_UPDATE_EVENT,channelId,null),resolve(response)})).catch((function(err){reject(_this215.channelErrorHandler("removeAllUsersFromChannel",err))}))}))}},{key:"getPortalInfos",value:function(){var _this216=this;return new Promise((function(resolve,reject){_this216.$http({method:"GET",url:config.restServerUrl+"/api/rainbow/channels/v1.0/about",headers:_this216.authService.getRequestHeader()}).then((function(response){_this216.logger.info("[channelService] successfully retrieved portal infos -- success"),resolve(response.data)})).catch((function(err){reject(_this216.channelErrorHandler("getPortalInfos",err))}))}))}},{key:"getLatestMessages",value:function(maxMessages){var _this217=this,beforeDate=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,afterDate=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(resolve,reject){_this217.$http({method:"GET",url:_this217.portalURL+"/latest-items",headers:_this217.authService.getRequestHeader(),params:{max:maxMessages,before:beforeDate,after:afterDate}}).then((function(response){_this217.chewReceivedItems(response.data.data.items),resolve(response.data.data.items)})).catch((function(err){reject(_this217.channelErrorHandler("getLatestMessages",err))}))}))}},{key:"acceptInvitation",value:function(channelId){var _this218=this;return new Promise((function(resolve,reject){_this218.$http({method:"PUT",url:_this218.portalURL+"/"+channelId+"/accept",headers:_this218.authService.getRequestHeader()}).then((function(response){_this218.logger.info("[channelService] acceptInvitation ("+channelId+") -- success"),_this218.decrementInvitationCounter(),resolve(response)})).catch((function(err){reject(_this218.channelErrorHandler("acceptInvitation",err))}))}))}},{key:"declineInvitation",value:function(channelId){var _this219=this;return new Promise((function(resolve,reject){_this219.$http({method:"PUT",url:_this219.portalURL+"/"+channelId+"/decline",headers:_this219.authService.getRequestHeader()}).then((function(response){_this219.logger.info("[channelService] declineInvitation ("+channelId+") -- success"),_this219.decrementInvitationCounter(),resolve(response)})).catch((function(err){reject(_this219.channelErrorHandler("declineInvitation",err))}))}))}},{key:"chewReceivedItems",value:function(items){items.forEach((function(item){"urn:xmpp:channels:simple"===item.type&&(item.entry={message:item.message},delete item.message),item.modified=void 0!==item.creation}))}},{key:"updateChannelsList",value:function(){var _this220=this;this.channelsList=Object.keys(this.channels).map((function(key){return _this220.channels[key]}))}},{key:"addChannelToCache",value:function(channel){this.channels[channel.id]=channel,this.updateChannelsList()}},{key:"channelErrorHandler",value:function(methodName,err){var error=null;return err.data?(this.logger.error("[channelService] "+methodName+" -- failure -- "+err.data.errorDetails),error=new RBError(err.data.errorMsg,err.data.errorDetails,err.data.errorDetailsCode)):(this.logger.error("[channelService] "+methodName+" -- failure -- Server failure"),error=new RBError("Server failure")),error}},{key:"likeChannelItem",value:function(channel,message,appreciation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee393(){var url,body,responseData,errorMessage;return regenerator_default.a.wrap((function(_context394){for(;;)switch(_context394.prev=_context394.next){case 0:return _context394.prev=0,url="".concat(this.portalURL,"/").concat(channel.id,"/items/").concat(message.id,"/like"),body=JSON.stringify({appreciation:appreciation}),_context394.next=5,fetch(url,{method:"POST",headers:this.authService.getPostHeader(),body:body});case 5:if((responseData=_context394.sent).ok){_context394.next=8;break}throw new Error(responseData.statusText);case 8:return _context394.next=10,responseData.json();case 10:return _context394.abrupt("return",_context394.sent.data);case 13:throw _context394.prev=13,_context394.t0=_context394.catch(0),errorMessage="getChannelItemReactions -- FAILURE -- "+_context394.t0.message,this.logger.error(errorMessage),new Error(errorMessage);case 17:case"end":return _context394.stop()}}),_callee393,this,[[0,13]])})))}},{key:"getChannelMessageReactions",value:function(channelMessage,reaction){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee394(){var url,headers,responseData,errorMessage,_this221=this;return regenerator_default.a.wrap((function(_context395){for(;;)switch(_context395.prev=_context395.next){case 0:return _context395.prev=0,url="".concat(this.portalURL,"/").concat(channelMessage.channel.id,"/items/").concat(channelMessage.id,"/likes?limit=400"),reaction&&(url+="&appreciation="+reaction),headers=this.authService.getRequestHeader(),_context395.next=6,fetch(url,{method:"GET",headers:headers});case 6:if((responseData=_context395.sent).ok){_context395.next=9;break}throw new Error(responseData.statusText);case 9:return _context395.next=11,responseData.json();case 11:return _context395.abrupt("return",_context395.sent.data.items.map((function(data){var contact=_this221.contactService.getContactById(data.id);contact||(contact=_this221.contactService.createContact(data.id,data.firstName,data.lastName)).createTextAvatarImage();var info=data.companyName;return contact.jobTitle&&(info=contact.jobTitle+" - "+info),{reaction:data.appreciation,contact:contact,info:info}})));case 14:throw _context395.prev=14,_context395.t0=_context395.catch(0),errorMessage="getChannelItemReactions -- FAILURE -- "+_context395.t0.message,this.logger.error(errorMessage),new Error(errorMessage);case 18:case"end":return _context395.stop()}}),_callee394,this,[[0,14]])})))}},{key:"updateDisplayInfo",value:function(channel){channel.displayName=_escape(channel.name),channel.displayTopic=_escape(channel.topic)}}]),ChannelServiceAgnostic}();ChannelServiceAgnostic.PAGE_SIZE=10,exports.ChannelServiceAgnostic=ChannelServiceAgnostic},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24),ChannelMessage=function(){function ChannelMessage(){_classCallCheck(this,ChannelMessage),this.id=null,this.type=null,this.message=null,this.from=null,this.images=null,this.attachments=null,this.contact=null,this.video=null,this.isNew=!0,this.isModified=!1,this.rxSubject=new rxjs_1.Subject}return _createClass(ChannelMessage,[{key:"publishUpdate",value:function(){this.rxSubject.next(event_model_1.RBEvent.create("updateLikes"))}},{key:"subscribe",value:function(handler){return this.rxSubject.subscribe(handler)}}],[{key:"createFromData",value:function(channel,data){var message=new ChannelMessage;return message.isNew=data.new,message.isModified=data.modified,message.id=data.id,message.type=data.type,message.from=data.from,message.timestamp=data.timestamp,message.channel=channel,message.video=data.video,data.entry.message&&(message.message=data.entry.message.replace(/<a/gi,"<a target='_blank' rel='noopener noreferrer' ")),data.entry.video&&(message.video=data.entry.video),data.entry.images&&"null"!==data.entry.images&&void 0!==data.entry.images&&(data.entry.images instanceof Array?data.entry.images.length>0&&(message.images=data.entry.images):message.images=[data.entry.images]),data.entry.attachments&&"null"!==data.entry.attachments&&void 0!==data.entry.attachments&&(data.entry.attachments instanceof Array?data.entry.attachments.length>0&&(message.attachments=data.entry.attachments):message.attachments=[data.entry.attachments]),message.myLike=data.my_appreciation?data.my_appreciation:"none",message.likeCounters=data.appreciations?data.appreciations:{like:0,fantastic:0,applause:0,doubt:0,happy:0},message}}]),ChannelMessage}();exports.ChannelMessage=ChannelMessage},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var FavoriteService=function(_favorite_service_1$A){_inherits(FavoriteService,_favorite_service_1$A);var _super5=_createSuper(FavoriteService);function FavoriteService(conversationService){return _classCallCheck(this,FavoriteService),_super5.call(this,conversationService)}return FavoriteService}(__webpack_require__(356).AgnosticFavoriteService);FavoriteService.$inject=["conversationService"],exports.FavoriteService=FavoriteService,angular.module("rainbow").service("favoriteService",FavoriteService)},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var favorite_model_1=__webpack_require__(357),rxjs_1=__webpack_require__(10),contact_service_1=__webpack_require__(1),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),logger_service_1=__webpack_require__(15),room_service_1=__webpack_require__(33);exports.AgnosticFavoriteService=function(){function _class13(conversationService){_classCallCheck(this,_class13),this.conversationService=conversationService,this.favorites=[],this.eventNames=[],this.authService=auth_service_1.default,this.xmppService=xmpp_service_1.default,this.contactService=contact_service_1.default,this.logger=logger_service_1.default,this.roomService=room_service_1.default}return _createClass(_class13,[{key:"start",value:function(stats){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee395(){var startDate,startDuration;return regenerator_default.a.wrap((function(_context396){for(;;)switch(_context396.prev=_context396.next){case 0:this.logger.info("=== STARTING ==="),startDate=performance.now(),this.rxSubject=new rxjs_1.Subject,this.connect(),startDuration=Math.round(performance.now()-startDate),stats.push({service:"favoriteService",startDuration:startDuration}),this.eventNames=["ON_FAVORITE_CREATED","ON_FAVORITE_DELETED","ON_FAVORITE_UPDATED"],this.logger.info("=== STARTED (".concat(startDuration," ms) ==="));case 5:case"end":return _context396.stop()}}),_callee395,this)})))}},{key:"connect",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee396(){return regenerator_default.a.wrap((function(_context397){for(;;)switch(_context397.prev=_context397.next){case 0:return _context397.prev=0,_context397.next=3,this.getServerFavorites();case 3:this.conversationService.favoriteService=this,this.attachHandlers(),this.rxSubject.next({name:"update"}),_context397.next=11;break;case 8:_context397.prev=8,_context397.t0=_context397.catch(0),this.logger.error("connect -- Failure -- "+_context397.t0.message);case 11:case"end":return _context397.stop()}}),_callee396,this,[[0,8]])})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee397(){return regenerator_default.a.wrap((function(_context398){for(;;)switch(_context398.prev=_context398.next){case 0:this.logger.info("=== STOPPING ==="),this.xmppManagementHandler&&(this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.logger.info("=== STOPPED ===");case 1:case"end":return _context398.stop()}}),_callee397,this)})))}},{key:"subscribe",value:function(observer){return this.rxSubject.subscribe(observer)}},{key:"getServerFavorites",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee399(){var url,headers,responseData,promises,favorites,errorMessage,_this222=this;return regenerator_default.a.wrap((function(_context400){for(;;)switch(_context400.prev=_context400.next){case 0:return _context400.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/favorites"),headers=this.authService.getRequestHeader(),_context400.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((responseData=_context400.sent).ok){_context400.next=8;break}throw this.logger.debug("Request ".concat(responseData.headers.get("x-rainbow-request-id")," failed with status ").concat(responseData.status)),new Error(responseData.statusText);case 8:return _context400.next=10,responseData.json();case 10:return promises=_context400.sent.data.map((function(data){return __awaiter(_this222,void 0,void 0,regenerator_default.a.mark((function _callee398(){return regenerator_default.a.wrap((function(_context399){for(;;)switch(_context399.prev=_context399.next){case 0:return _context399.abrupt("return",this.createFavorite(data.id,data.peerId,data.type));case 1:case"end":return _context399.stop()}}),_callee398,this)})))})),_context400.next=13,Promise.all(promises);case 13:return favorites=_context400.sent,_context400.abrupt("return",(this.favorites=favorites.filter((function(favorite){return null!==favorite})),this.logger.info("getServerFavorites -- SUCCESS -- found ".concat(this.favorites.length," favorites")),this.favorites));case 17:throw _context400.prev=17,_context400.t0=_context400.catch(0),errorMessage="getServerFavorites -- FAILURE -- "+_context400.t0.message,this.logger.error(errorMessage),new Error(errorMessage);case 21:case"end":return _context400.stop()}}),_callee399,this,[[0,17]])})))}},{key:"addServerFavorite",value:function(peerId,type){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee400(){var url,headers,body,response,responseData,errorMessage;return regenerator_default.a.wrap((function(_context401){for(;;)switch(_context401.prev=_context401.next){case 0:return _context401.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/favorites"),headers=this.authService.getPostHeader(),body={peerId:peerId,type:type},_context401.next=6,fetch(url,{method:"POST",headers:headers,body:JSON.stringify(body)});case 6:return response=_context401.sent,_context401.next=9,response.json();case 9:if(!(responseData=_context401.sent).errorDetails||"FAVORITE_CONVERSATIONS_COUNT"!==responseData.errorDetails.feature){_context401.next=12;break}throw new Error("Reach FAVORITE_CONVERSATIONS_COUNT");case 12:this.logger.info("addServerFavorite(".concat(peerId,", ").concat(type,") -- SUCCESS")),_context401.next=19;break;case 15:throw _context401.prev=15,_context401.t0=_context401.catch(0),errorMessage="addServerFavorite(".concat(peerId,", ").concat(type,") -- FAILURE -- ").concat(_context401.t0.message),this.logger.error(errorMessage),new Error(errorMessage);case 19:case"end":return _context401.stop()}}),_callee400,this,[[0,15]])})))}},{key:"removeServerFavorite",value:function(favoriteId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee401(){var url,headers,errorMessage;return regenerator_default.a.wrap((function(_context402){for(;;)switch(_context402.prev=_context402.next){case 0:return _context402.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/favorites/").concat(favoriteId),headers=this.authService.getRequestHeader(),_context402.next=4,fetch(url,{method:"DELETE",headers:headers});case 4:this.logger.info("removeServerFavorite(".concat(favoriteId,") -- SUCCESS")),_context402.next=11;break;case 7:throw _context402.prev=7,_context402.t0=_context402.catch(0),errorMessage="removeServerFavorite(".concat(favoriteId,") -- FAILURE -- ").concat(_context402.t0.statusText),this.logger.error(errorMessage),new Error(errorMessage);case 11:case"end":return _context402.stop()}}),_callee401,this,[[0,7]])})))}},{key:"toggleFavorite",value:function(conversation){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee402(){var peerId,type,favorite;return regenerator_default.a.wrap((function(_context403){for(;;)switch(_context403.prev=_context403.next){case 0:if(_context403.prev=0,peerId=conversation.contact?conversation.contact.dbId:conversation.room.dbId,type=conversation.contact?conversation.contact.isBot?"bot":"user":"room",!(favorite=this.favorites.find((function(favoriteConv){return favoriteConv.peerId===peerId})))){_context403.next=7;break}return _context403.next=5,this.removeServerFavorite(favorite.id);case 5:_context403.next=9;break;case 7:return _context403.next=9,this.addServerFavorite(peerId,type);case 9:_context403.next=14;break;case 11:throw _context403.prev=11,_context403.t0=_context403.catch(0),new Error(_context403.t0.message);case 14:case"end":return _context403.stop()}}),_callee402,this,[[0,11]])})))}},{key:"getFavoriteConversation",value:function(peerId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee403(){var favorite,convGetter;return regenerator_default.a.wrap((function(_context404){for(;;)switch(_context404.prev=_context404.next){case 0:return favorite=this.favorites.find((function(favoriteConv){return favoriteConv.peerId===peerId})),convGetter=favorite.contact?this.conversationService.getOrCreateOneToOneConversation(favorite.contact.jid):this.conversationService.getRoomConversation(favorite.room.jid),_context404.next=3,convGetter;case 3:return _context404.abrupt("return",_context404.sent);case 4:case"end":return _context404.stop()}}),_callee403,this)})))}},{key:"isFavoriteConversation",value:function(peerId){return this.favorites.find((function(favoriteConv){return favoriteConv.peerId===peerId}))}},{key:"moveFavoritePosition",value:function(favoriteId,position){try{var url="".concat(config.restServerUrl,"/api/rainbow/enduser/v1.0/users/").concat(this.contactService.userContact.dbId,"/favorites/").concat(favoriteId,"?position=").concat(position),headers=this.authService.getRequestHeader();fetch(url,{method:"PUT",headers:headers}),this.logger.info("moveFavoritePosition(".concat(favoriteId,", ").concat(position,") -- SUCCESS"))}catch(error){var errorMessage="moveFavoritePosition(".concat(favoriteId,", ").concat(position,") -- FAILURE -- ").concat(error.statusText);throw this.logger.error(errorMessage),new Error(errorMessage)}}},{key:"createFavorite",value:function(id,peerId,type){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee404(){var favorite,convId,conv;return regenerator_default.a.wrap((function(_context405){for(;;)switch(_context405.prev=_context405.next){case 0:if(_context405.prev=0,favorite=new favorite_model_1.Favorite(id,peerId,type),"room"!==type){_context405.next=6;break}favorite.room=this.roomService.getRoomById(peerId),_context405.next=9;break;case 6:return _context405.next=8,this.contactService.getContactByDBId(peerId);case 8:favorite.contact=_context405.sent;case 9:if(favorite.room||favorite.contact){_context405.next=11;break}return _context405.abrupt("return",(this.removeServerFavorite(id),null));case 11:return convId=favorite.room?favorite.room.jid:favorite.contact.jid,conv=this.conversationService.getConversationById(convId),_context405.abrupt("return",(conv&&(conv.isFavorite=!0,favorite.conv=conv),favorite));case 15:return _context405.prev=15,_context405.t0=_context405.catch(0),_context405.abrupt("return",(this.logger.warn("createFavorite(".concat(id,", ").concat(peerId,", ").concat(type,") -- FAILURE -- ").concat(_context405.t0.message)),null));case 18:case"end":return _context405.stop()}}),_callee404,this,[[0,15]])})))}},{key:"updateFavoriteConversations",value:function(conversation){var peerId=conversation.contact?conversation.contact.dbId:conversation.room.dbId,favorite=this.favorites.find((function(favoriteConv){return favoriteConv.peerId===peerId}));favorite&&(conversation.isFavorite=!0,favorite.conv=conversation)}},{key:"onXmppEvent",value:function(stanza){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee405(){var favoriteElem,id,type,peerId,action,favorite,_index3,_favorite,targetIndex,sourceIndex;return regenerator_default.a.wrap((function(_context406){for(;;)switch(_context406.prev=_context406.next){case 0:if(_context406.prev=0,!(favoriteElem=$(stanza).find("favorite"))){_context406.next=16;break}if(id=favoriteElem.attr("id"),type=favoriteElem.attr("type"),peerId=favoriteElem.attr("peer_id"),"create"!==(action=favoriteElem.attr("action"))){_context406.next=15;break}if(favorite=this.favorites.find((function(favoriteConv){return favoriteConv.peerId===peerId})),_context406.t0=favorite,_context406.t0){_context406.next=13;break}return _context406.next=10,this.createFavorite(id,peerId,type);case 10:favorite=_context406.sent,this.favorites.push(favorite),this.sendEvent("ON_FAVORITE_CREATED",{favorite:favorite});case 13:_context406.next=16;break;case 15:"delete"===action?-1!==(_index3=this.favorites.findIndex((function(fav){return fav.peerId===peerId})))&&((_favorite=this.favorites[_index3]).conv&&(_favorite.conv.isFavorite=!1),this.favorites.splice(_index3,1),this.sendEvent("ON_FAVORITE_DELETED",{favoriteId:_favorite.id})):"update"===action&&(targetIndex=parseInt(favoriteElem.attr("position"),10),-1!==(sourceIndex=this.favorites.findIndex((function(fav){return fav.id===id})))&&(this.favorites.splice(targetIndex,0,this.favorites.splice(sourceIndex,1)[0]),this.sendEvent("ON_FAVORITE_UPDATED",{favoriteId:id,position:targetIndex})));case 16:return _context406.abrupt("return",!0);case 19:return _context406.prev=19,_context406.t1=_context406.catch(0),_context406.abrupt("return",!0);case 22:case"end":return _context406.stop()}}),_callee405,this,[[0,19]])})))}},{key:"sendEvent",value:function(eventName,detail){var event=new CustomEvent(eventName,{detail:detail});window.dispatchEvent(event)}},{key:"attachHandlers",value:function(){var _this223=this;this.xmppManagementHandler&&this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=this.xmppService.addHandler((function(stanza){return _this223.onXmppEvent(stanza),!0}),null,"message","management")}}]),_class13}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Favorite=function(){return function _class14(id,peerId,type){_classCallCheck(this,_class14),this.id=id,this.peerId=peerId,this.type=type}}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var VoiceMessageService=function(_voiceMessage_service){_inherits(VoiceMessageService,_voiceMessage_service);var _super6=_createSuper(VoiceMessageService);function VoiceMessageService($rootScope,$http,$injector,telephonyService,fileServerService){return _classCallCheck(this,VoiceMessageService),_super6.call(this,$rootScope,$http,$injector,telephonyService,fileServerService)}return VoiceMessageService}(__webpack_require__(359).AgnosticVoiceMessageService);VoiceMessageService.$inject=["$rootScope","$http","$injector","telephonyService","fileServerService"],exports.VoiceMessageService=VoiceMessageService,angular.module("rainbow").service("voiceMessageService",VoiceMessageService)},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10),voiceMessage_model_1=__webpack_require__(360),logger_service_1=__webpack_require__(15),contact_service_1=__webpack_require__(1),settings_service_1=__webpack_require__(5),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),profile_service_1=__webpack_require__(6),fileStorage_service_1=__webpack_require__(25);exports.AgnosticVoiceMessageService=function(){function _class15($rootScope,$http,$injector,telephonyService,fileServerService){_classCallCheck(this,_class15),this.$rootScope=$rootScope,this.$http=$http,this.$injector=$injector,this.telephonyService=telephonyService,this.fileServerService=fileServerService,this.portalURL="",this.sipWisePortalURL="",this.listeners=[],this.voiceMessageMngtRef=null,this.messageHandlerRef=null,this.voiceMessages=[],this.xmpp_message_handler=null,this.voiceMessagesCounters={total:0,unread:0},this.unreadVoiceMessageCounter=0,this.voiceMessagePromises={},this.rxSubject=new rxjs_1.Subject,this.CALLSERVICE_NS="urn:xmpp:pbxagent:callservice:1",this.CALLSERVICE_NS_SIPWISE="urn:xmpp:pbxagent:telephony:1",this.settingsService=settings_service_1.default,this.logger=logger_service_1.default,this.authService=auth_service_1.default,this.xmppService=xmpp_service_1.default,this.profileService=profile_service_1.default,this.fileStorageService=fileStorage_service_1.default,this.contactService=contact_service_1.default}return _createClass(_class15,[{key:"start",value:function(stats){var _this224=this;return this.portalURL=config.restServerUrl+"/api/rainbow/telephony/v1.0/",this.sipWisePortalURL=config.restServerUrl+"/api/rainbow/voice/v1.0/",this.telephonyService.isSipWiseRoot()&&(this.logger.info("[voiceMessageService] starting in sipWise mode "),this.CALLSERVICE_NS=this.CALLSERVICE_NS_SIPWISE),this.voiceMessagesCounters={total:0,unread:0},new Promise((function(resolve){if(!_this224.profileService.isFeatureEnabled(_this224.profileService.FeaturesEnum.TELEPHONY_VOICE_MAIL))return resolve();if(_this224.contactService.userContact.isCPaaSGuest())return resolve();_this224.logger.info("[voiceMessageService] === STARTING ===");var startDate=performance.now();_this224.attachHandlers(),_this224.telephonyService.isSipWiseRoot()&&_this224.getVoiceMessagesCounters().then((function(){_this224.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:_this224.voiceMessagesCounters}),_this224.$rootScope.$broadcast("ON_VOICE_MESSAGE_UPDATE_EVENT",_this224.voiceMessagesCounters)}));var startDuration=Math.round(performance.now()-startDate);_this224.logger.info("[voiceMessageService] === STARTED ("+startDuration+" ms) ==="),stats.push({service:"voiceMessageService",startDuration:startDuration}),resolve()}))}},{key:"attachHandlers",value:function(){var _this225=this;this.logger.info("[voiceMessageService] attachHandlers"),this.voiceMessageMngtRef&&(this.xmppService.connection.deleteHandler(this.voiceMessageMngtRef),this.voiceMessageMngtRef=null),this.voiceMessageMngtRef=this.xmppService.connection.addHandler((function(stanza){return _this225.onVoiceMessageManagement(stanza)}),null,"message","management"),this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.messageHandlerRef=this.xmppService.addHandler((function(stanza){return _this225.vmCounterHandler(stanza)}),this.CALLSERVICE_NS,"message",null)}},{key:"stop",value:function(){var _this226=this;return new Promise((function(resolve){_this226.logger.info("[voiceMessageService] === STOPPING ==="),_this226.listeners.forEach((function(destroyFunction){destroyFunction()})),_this226.voiceMessagesCounters={total:0,unread:0},_this226.logger.info("[voiceMessageService] === STOPPED ==="),resolve()}))}},{key:"subscribe",value:function(handler){return this.rxSubject.subscribe(handler)}},{key:"vmCounterHandler",value:function(stanza){try{if(this.telephonyService.isSipWiseRoot()){var mwiElem=$(stanza).find("telephony").find("mwi");if(mwiElem&&0!==mwiElem.length){var mwiMessage=mwiElem.find("message"),mwiMsgType=mwiMessage.attr("type"),mwiMsgNew=mwiMessage.attr("new"),mwiMsgOld=mwiMessage.attr("old");mwiMsgType&&"voice"===mwiMsgType&&mwiMsgNew&&mwiMsgOld?(this.voiceMessagesCounters.unread=Number(mwiMsgNew),this.voiceMessagesCounters.total=Number(mwiMsgNew)+Number(mwiMsgOld),this.logger.info("[voiceMessageService] vmCounterHandler SipWise -- Messages total : "+this.voiceMessagesCounters.total+" - Messages Unread : "+this.voiceMessagesCounters.unread),this.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:this.voiceMessagesCounters}),this.$rootScope.$broadcast("ON_VOICE_MESSAGE_UPDATE_EVENT",this.voiceMessagesCounters)):this.logger.info("[voiceMessageService] vmCounterHandler SipWise -- anomaly msg attr ")}}else{var vmCounters=$(stanza).find("voiceMessages").find("voiceMessagesCounters");if(vmCounters&&0!==vmCounters.length){var totalVoiceMessageAttr=vmCounters.attr("totalVoiceMessages"),unreadVoiceMessageAttr=vmCounters.attr("unreadVoiceMessages");this.voiceMessagesCounters={total:totalVoiceMessageAttr?parseInt(totalVoiceMessageAttr,10):0,unread:unreadVoiceMessageAttr?parseInt(unreadVoiceMessageAttr,10):0},this.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:this.voiceMessagesCounters}),this.$rootScope.$broadcast("ON_VOICE_MESSAGE_UPDATE_EVENT",this.voiceMessagesCounters)}}return!0}catch(error){return!0}}},{key:"onVoiceMessageManagement",value:function(stanza){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee406(){var voiceMessageEndpointElem,voiceMessageId,errorEndPointElem,_voiceMessageId,fileId;return regenerator_default.a.wrap((function(_context407){for(;;)switch(_context407.prev=_context407.next){case 0:if(_context407.prev=0,!(voiceMessageEndpointElem=$(stanza).find("visualvoicemail")).length||"abort"!==voiceMessageEndpointElem.attr("action")){_context407.next=7;break}voiceMessageId=voiceMessageEndpointElem.attr("msgid"),errorEndPointElem=voiceMessageEndpointElem.find("error"),this.voiceMessagePromises[voiceMessageId].reject(new Error(errorEndPointElem.attr("errordetailscode"))),delete this.voiceMessagePromises[voiceMessageId],this.logger.info("[voiceMessageService] onVoiceMessageManagement - "+voiceMessageId+" - abort - "+errorEndPointElem.attr("errormsg")),_context407.next=18;break;case 7:if(!voiceMessageEndpointElem.length||"create"!==voiceMessageEndpointElem.attr("action")){_context407.next=18;break}if(_voiceMessageId=voiceMessageEndpointElem.attr("msgid"),voiceMessageEndpointElem.find("url").text(),fileId=voiceMessageEndpointElem.find("fileid").text(),this.logger.info("[voiceMessageService] onVoiceMessageManagement - "+_voiceMessageId+" - create FileId - "+fileId),_context407.t0=this.getVoiceMessageById(_voiceMessageId),!_context407.t0){_context407.next=18;break}return _context407.next=16,this.fileStorageService.retrieveVoiceMessageFileDescriptorsListPerOwner();case 16:this.voiceMessagePromises[_voiceMessageId].resolve(_voiceMessageId),delete this.voiceMessagePromises[_voiceMessageId];case 18:return _context407.abrupt("return",!0);case 21:return _context407.prev=21,_context407.t1=_context407.catch(0),_context407.abrupt("return",!0);case 24:case"end":return _context407.stop()}}),_callee406,this,[[0,21]])})))}},{key:"getVoiceMessageById",value:function(msgId){return this.voiceMessages.find((function(currentVoiceMsg){return msgId===currentVoiceMsg.id}))}},{key:"getVoiceMessagesList",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee408(){var response,voiceMessagesData,errorMessage,_this227=this;return regenerator_default.a.wrap((function(_context409){for(;;)switch(_context409.prev=_context409.next){case 0:if("VVM"===this.telephonyService.agentStatus.features){_context409.next=2;break}return _context409.abrupt("return",[]);case 2:return _context409.prev=2,_context409.next=5,this.$http({method:"GET",url:this.portalURL+"voicemessages",headers:this.authService.getRequestHeader()});case 5:return response=_context409.sent,this.voiceMessages=[],voiceMessagesData=response.data.data.voicemessages.voiceMessageList,_context409.next=10,Promise.all(voiceMessagesData.map((function(voiceMessageData){return __awaiter(_this227,void 0,void 0,regenerator_default.a.mark((function _callee407(){return regenerator_default.a.wrap((function(_context408){for(;;)switch(_context408.prev=_context408.next){case 0:return _context408.next=2,this.createVoiceMessageFromData(voiceMessageData).catch((function(){}));case 2:return _context408.abrupt("return",_context408.sent);case 3:case"end":return _context408.stop()}}),_callee407,this)})))})));case 10:return this.voiceMessages=_context409.sent,this.logger.info("[voiceMessageService] getVoiceMessagesList success - Messages number : "+this.voiceMessages.length),this.voiceMessages.sort((function(a,b){return new Date(b.date).getTime()-new Date(a.date).getTime()})),_context409.abrupt("return",this.voiceMessages);case 16:throw _context409.prev=16,_context409.t0=_context409.catch(2),errorMessage="getVoiceMessagesList failure -- ",errorMessage+=_context409.t0.status?_context409.t0.status:_context409.t0.message,this.logger.error("[voiceMessageService] "+errorMessage),new Error(errorMessage);case 20:case"end":return _context409.stop()}}),_callee408,this,[[2,16]])})))}},{key:"getVoiceMessagesCounters",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee409(){var voiceMessageCountersData,counterInbox,counterOld,_voiceMessageCountersData;return regenerator_default.a.wrap((function(_context410){for(;;)switch(_context410.prev=_context410.next){case 0:if(_context410.prev=0,!this.telephonyService.isSipWiseRoot()){_context410.next=8;break}return _context410.next=4,this.$http({method:"GET",url:this.sipWisePortalURL+"messages",headers:this.authService.getRequestHeader()});case 4:return voiceMessageCountersData=_context410.sent.data,counterInbox=Number(voiceMessageCountersData.inbox),counterOld=Number(voiceMessageCountersData.old),_context410.abrupt("return",(this.voiceMessagesCounters.unread=counterInbox,this.voiceMessagesCounters.total=counterInbox+counterOld,this.logger.info("[voiceMessageService] getVoiceMessagesCounters success - total : "+this.voiceMessagesCounters.total+" - unread : "+this.voiceMessagesCounters.unread),this.voiceMessagesCounters));case 8:return _context410.next=10,this.$http({method:"GET",url:this.portalURL+"voicemessages/counters",headers:this.authService.getRequestHeader()});case 10:return _voiceMessageCountersData=_context410.sent.data.data.voicemessages.counters,_context410.abrupt("return",(this.voiceMessagesCounters.total=parseInt(_voiceMessageCountersData.total,10),this.voiceMessagesCounters.unread=parseInt(_voiceMessageCountersData.unread,10),this.logger.info("[voiceMessageService] getVoiceMessagesCounters success - total : "+this.voiceMessagesCounters.total+" - unread : "+this.voiceMessagesCounters.unread),this.voiceMessagesCounters));case 14:throw _context410.prev=14,_context410.t0=_context410.catch(0),this.voiceMessageHandleError("getVoiceMessagesCounters",_context410.t0);case 17:case"end":return _context410.stop()}}),_callee409,this,[[0,14]])})))}},{key:"getVoiceMessagesUnreadCounter",value:function(){return this.voiceMessagesCounters.unread}},{key:"getVoiceMessagesTotalCounter",value:function(){return this.voiceMessagesCounters.total}},{key:"getVoiceMessageAudioFileURL",value:function(voiceMessage){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee410(){var vmFileDesc,vmBlob,voiceMessageId,_vmBlob,_this228=this;return regenerator_default.a.wrap((function(_context411){for(;;)switch(_context411.prev=_context411.next){case 0:if(!(vmFileDesc=this.fileStorageService.getVoiceMessageFileDescriptorByMsgId(voiceMessage.id))||"deleted"===vmFileDesc.state){_context411.next=6;break}return _context411.next=4,this.fileServerService.getBlobFromFileDescriptor(vmFileDesc);case 4:return vmBlob=_context411.sent,_context411.abrupt("return",URL.createObjectURL(vmBlob));case 6:return _context411.next=8,new Promise((function(resolve,reject){_this228.voiceMessagePromises[voiceMessage.id]={resolve:resolve,reject:reject},_this228.getVoiceMessageFromPBX(voiceMessage)}));case 8:if(voiceMessageId=_context411.sent,!(vmFileDesc=this.fileStorageService.getVoiceMessageFileDescriptorByMsgId(voiceMessageId))){_context411.next=14;break}return _context411.next=12,this.fileServerService.getBlobFromFileDescriptor(vmFileDesc);case 12:return _vmBlob=_context411.sent,_context411.abrupt("return",URL.createObjectURL(_vmBlob));case 14:case"end":return _context411.stop()}}),_callee410,this)})))}},{key:"getVoiceMessageFromPBX",value:function(voiceMessage){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee411(){var url;return regenerator_default.a.wrap((function(_context412){for(;;)switch(_context412.prev=_context412.next){case 0:return _context412.prev=0,url=this.portalURL+"voicemessages/"+encodeURIComponent(voiceMessage.id)+"?messageDate="+encodeURIComponent(voiceMessage.dateString)+"&messageFrom="+encodeURIComponent(voiceMessage.from),_context412.next=4,this.$http({method:"GET",url:url,headers:this.authService.getRequestHeader()});case 4:this.logger.info("[voiceMessageService] getVoiceMessageFromPBX success"),_context412.next=10;break;case 7:throw _context412.prev=7,_context412.t0=_context412.catch(0),this.voiceMessageHandleError("getVoiceMessageFromPBX",_context412.t0);case 10:case"end":return _context412.stop()}}),_callee411,this,[[0,7]])})))}},{key:"deleteVoiceMessage",value:function(voiceMessageId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee412(){return regenerator_default.a.wrap((function(_context413){for(;;)switch(_context413.prev=_context413.next){case 0:return _context413.prev=0,_context413.next=3,this.$http({method:"DELETE",url:this.portalURL+"voicemessages/"+voiceMessageId,headers:this.authService.getRequestHeader()});case 3:this.logger.info("[voiceMessageService] deleteVoiceMessage success"),_context413.next=9;break;case 6:throw _context413.prev=6,_context413.t0=_context413.catch(0),this.voiceMessageHandleError("deleteVoiceMessage",_context413.t0);case 9:case"end":return _context413.stop()}}),_callee412,this,[[0,6]])})))}},{key:"deleteAllVoiceMessages",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee413(){return regenerator_default.a.wrap((function(_context414){for(;;)switch(_context414.prev=_context414.next){case 0:return _context414.prev=0,_context414.next=3,this.$http({method:"DELETE",url:this.portalURL+"voicemessages/all",headers:this.authService.getRequestHeader()});case 3:this.logger.info("[voiceMessageService] deleteAllVoiceMessages success"),_context414.next=9;break;case 6:throw _context414.prev=6,_context414.t0=_context414.catch(0),this.voiceMessageHandleError("deleteAllVoiceMessages",_context414.t0);case 9:case"end":return _context414.stop()}}),_callee413,this,[[0,6]])})))}},{key:"createVoiceMessageFromData",value:function(data){var _this229=this;return new Promise((function(resolve,reject){if(data){var foundidentity=data.foundidentity,identityFirstName="",identityLastName="",otherParticipantJid=data.jid,otherParticipantNumber=data.from;otherParticipantJid||otherParticipantNumber?_this229.contactService.getOrCreateContact(otherParticipantJid,otherParticipantNumber).then((function(contact){if(_this229.logger.info("[voiceMessageService] createVoiceMessageFromData otherParticipant jid:"+otherParticipantJid+"  Number:"+otherParticipantNumber+" => contact retrieved (temp:"+contact.temp+")"),!otherParticipantJid&&contact.temp){if(foundidentity&&foundidentity.length){var foundFirstName=foundidentity.attr("firstName"),foundLastName=foundidentity.attr("lastName"),foundDisplayName=foundidentity.attr("displayName");identityFirstName=foundFirstName||"",""===(identityLastName=foundLastName||"")&&""===identityFirstName&&foundDisplayName&&0!==foundDisplayName.length&&foundDisplayName!==otherParticipantNumber&&(identityLastName=foundDisplayName),(identityFirstName.length||identityLastName.length)&&(_this229.logger.debug("[voiceMessageService] createVoiceMessageFromData  xNames updated from directories for contact "+contact.id),contact.updateName(identityFirstName,identityLastName))}else try{var centralizedService=_this229.$injector.get("centralizedService");centralizedService.outlook.updateContactFromOutlookInfos(contact,otherParticipantNumber,!0).then((function(updateStatus){updateStatus?_this229.logger.debug("[telephonyService] createVoiceMessageFromData  xNames updated from outlook for contact "+contact.id):_this229.logger.debug("[telephonyService] createVoiceMessageFromData no update from outlook for contact :"+contact.id)})).catch((function(err){_this229.logger.debug("[voiceMessageService] createVoiceMessageFromData  no Outlook search available")}))}catch(error){}var displayNameisAPhoneNumber=!1;_this229.telephonyService.started&&(displayNameisAPhoneNumber=contact.displayName.match(/^[0-9A-D #\-\+\*\(\)\./]{1,32}$/)&&_this229.telephonyService.startAsPhoneNumber(contact.displayName)),displayNameisAPhoneNumber&&contact.phoneProCan&&""!==contact.phoneProCan&&(contact.displayName=contact.phoneProCan)}var duration=Number.parseInt(data.length,10);resolve(new voiceMessage_model_1.VoiceMessage(data.id,contact,"true"===data.unread,duration,data.date,data.from,data.jid))})).catch((function(err){_this229.voiceMessageErrorHandler("getVoiceMessagesList",reject,err),reject("reject")})):reject("neither otherParticipantJid nor otherParticipantNumber")}else reject("no data")}))}},{key:"voiceMessageHandleError",value:function(methodName,err){var errorMessage=methodName+" -- failure -- ";return errorMessage+=err.data?err.data.errorDetails:"Server failure",this.logger.error("[voiceMessageService] "+errorMessage),new Error(errorMessage)}},{key:"voiceMessageErrorHandler",value:function(methodName,reject,err){err.data?this.logger.error("[voiceMessageService] "+methodName+" -- failure -- "+err.data.errorDetails):this.logger.error("[voiceMessageService] "+methodName+" -- failure -- Server failure"),reject(err)}}]),_class15}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=__webpack_require__(10);exports.VoiceMessage=function(){return function _class16(id,contact,unread,duration,date,from,jid){_classCallCheck(this,_class16),this.id=id,this.contact=contact,this.unread=unread,this.duration=duration,this.date=new Date(date),this.dateString=date,this.from=from,this.jid=jid,this.rxSubject=new rxjs_1.Subject}}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var PhonebookService=function(_phonebook_service_1$){_inherits(PhonebookService,_phonebook_service_1$);var _super7=_createSuper(PhonebookService);function PhonebookService(logger){return _classCallCheck(this,PhonebookService),_super7.call(this,logger)}return PhonebookService}(__webpack_require__(362).AgnosticPhonebookService);PhonebookService.$inject=["rainbowLogger"],exports.PhonebookService=PhonebookService,angular.module("rainbow").service("phonebookService",PhonebookService)},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var contact_service_1=__webpack_require__(1),auth_service_1=__webpack_require__(2),profile_service_1=__webpack_require__(6);exports.AgnosticPhonebookService=function(){function _class17(logger){_classCallCheck(this,_class17),this.logger=logger,this.authService=auth_service_1.default,this.contactService=contact_service_1.default,this.profileService=profile_service_1.default,this.isPhonebookSearchAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK)}return _createClass(_class17,[{key:"search",value:function(searchPattern){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee414(){var url,headers,responseData,phonebooksData,_this230=this;return regenerator_default.a.wrap((function(_context415){for(;;)switch(_context415.prev=_context415.next){case 0:if(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK)){_context415.next=2;break}return _context415.abrupt("return",[]);case 2:return this.logger.info("search PBXContact from phonebook with pattern "+searchPattern),_context415.prev=3,url="".concat(config.restServerUrl,"/api/rainbow/search/v1.0/phonebooks?limit=20&name=").concat(encodeURIComponent(searchPattern)),headers=this.authService.getRequestHeader(),_context415.next=8,fetch(url,{method:"GET",mode:"cors",headers:headers});case 8:return responseData=_context415.sent,_context415.next=11,responseData.json();case 11:return phonebooksData=_context415.sent.phoneBooks,_context415.abrupt("return",phonebooksData.map((function(phonebook){var contact=_this230.contactService.createBasicContact(null,phonebook.number);return contact.updateName(phonebook.firstName,phonebook.lastName),contact.getAvatar(),contact})));case 15:return _context415.prev=15,_context415.t0=_context415.catch(3),_context415.abrupt("return",(this.logger.info("search PBXContact from phonebook with pattern ".concat(searchPattern," --- FAILURE --- ").concat(_context415.t0.message)),[]));case 18:case"end":return _context415.stop()}}),_callee414,this,[[3,15]])})))}}]),_class17}()},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var CallLogService=function(_callLog_service_1$Ag){_inherits(CallLogService,_callLog_service_1$Ag);var _super8=_createSuper(CallLogService);function CallLogService(webrtcGatewayService,telephonyService,$injector,$rootScope){return _classCallCheck(this,CallLogService),_super8.call(this,webrtcGatewayService,telephonyService,$injector,$rootScope)}return CallLogService}(__webpack_require__(364).AgnosticCallLogService);CallLogService.$inject=["webrtcGatewayService","telephonyService","$injector","$rootScope"],exports.CallLogService=CallLogService,angular.module("rainbow").service("callLogService",CallLogService)},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var callLog_model_1=__webpack_require__(365),rxjs_1=__webpack_require__(10),moment=__webpack_require__(3);__webpack_require__(227);var contact_service_1=__webpack_require__(1),xmpp_service_1=__webpack_require__(4),profile_service_1=__webpack_require__(6),logger_service_1=__webpack_require__(15),AgnosticCallLogService=function(){function AgnosticCallLogService(webrtcGatewayService,telephonyService,$injector,$rootScope){var _this231=this;_classCallCheck(this,AgnosticCallLogService),this.webrtcGatewayService=webrtcGatewayService,this.telephonyService=telephonyService,this.$injector=$injector,this.$rootScope=$rootScope,this.started=!1,this.rxSubject=new rxjs_1.Subject,this.callLogHandlerRef=null,this.callLogMessageAckRef=null,this.callLogNotificationRef=null,this.usePhonebookDirectory=!1,this.callLogPromises=[],this.numberMissedCallLogs=0,this.callLogs=[],this.aggregatedCallLogs=[],this.xmppService=xmpp_service_1.default,this.profileService=profile_service_1.default,this.logger=logger_service_1.default,this.contactService=contact_service_1.default,this.ackAllCallLogsInDBDone=!1,this.onHistoryCallLogMessageReceived=function(stanza){return __awaiter(_this231,void 0,void 0,regenerator_default.a.mark((function _callee415(){var stanzaElem,that;return regenerator_default.a.wrap((function(_context416){for(;;)switch(_context416.prev=_context416.next){case 0:if(!((stanzaElem=$(stanza)).find("call_log").length>0)){_context416.next=6;break}that=this,stanzaElem.find("call_log").each((function(__index,call_log){var call_logElem=$(call_log);call_logElem.attr("xmlns")===AgnosticCallLogService.CALL_LOG_NOTIF_NAMESPACE&&call_logElem.length>0&&that.callLogPromises.push(that.createCallLogFromStanza(stanzaElem,call_logElem))})),_context416.next=15;break;case 6:if(_context416.t0=stanzaElem.find("count").length>0&&stanzaElem.find("query").length>0&&($(stanza).find("last").length>0||"0"===stanzaElem.find("count").text()),!_context416.t0){_context416.next=15;break}return $(stanza).find("last").length&&(this.lastTimestamp=$(stanza).find("last").text()),this.logger.info("createCallLogFromStanza --- all calllogs received"),_context416.next=12,Promise.all(this.callLogPromises).catch((function(){}));case 12:this.callLogPromises=[],this.orderCallLogs(),this.startPromise&&(this.started=!0,this.startPromiseResolve(),this.startPromiseResolve=null,this.startPromise=null);case 15:return _context416.abrupt("return",!0);case 16:case"end":return _context416.stop()}}),_callee415,this)})))},this.onCallLogAckReceived=function(stanza){try{if($(stanza).find("read").length>0){var msgId=$(stanza).find("read").attr("call_id");_this231.callLogs.forEach((function(callLog){callLog.id!==msgId||(callLog.read=!0)}));var numberMissedCallLogs=_this231.getMissedCallLogCounter();numberMissedCallLogs!==_this231.numberMissedCallLogs&&(_this231.numberMissedCallLogs=numberMissedCallLogs,_this231.rxSubject.next({type:"ON_CALL_LOG_ACK_UPDATED",value:_this231.numberMissedCallLogs}))}}catch(error){return _this231.logger.error("onCallLogAckReceived -- failure --"+error),!0}return!0},this.onCallLogNotificationReceived=function(stanza){return __awaiter(_this231,void 0,void 0,regenerator_default.a.mark((function _callee416(){var stanzaElem,peer;return regenerator_default.a.wrap((function(_context417){for(;;)switch(_context417.prev=_context417.next){case 0:if(stanzaElem=$(stanza),_context417.prev=1,!(stanzaElem.find("deleted_call_log").length>0)){_context417.next=14;break}if(!(peer=stanzaElem.find("deleted_call_log").attr("peer"))){_context417.next=8;break}this.removeCallLogsForUser(peer),_context417.next=12;break;case 8:return this.callLogs=[],_context417.next=11,this.getCallLogHistoryPage();case 11:this.orderCallLogs();case 12:_context417.next=19;break;case 14:if(_context417.t0=stanzaElem.find("updated_call_log").length>0,!_context417.t0){_context417.next=19;break}return _context417.next=18,this.createCallLogFromStanza(stanzaElem,null).catch((function(){}));case 18:this.orderCallLogs();case 19:_context417.next=24;break;case 21:return _context417.prev=21,_context417.t1=_context417.catch(1),_context417.abrupt("return",(this.logger.error("callLogNotificationReceived -- failure --"+_context417.t1),!0));case 24:return _context417.abrupt("return",!0);case 25:case"end":return _context417.stop()}}),_callee416,this,[[1,21]])})))},this.xmppService.connected&&this.attachXMPPListeners(),this.xmppService.subscribeToConnectionEvents((function(event){"ON_XMPP_CONNECTED"===event.name&&(_this231.attachXMPPListeners(),"RECONNECTION"===event.data.reason&&_this231.getCallLogHistoryPage(_this231.lastTimestamp)),"ON_XMPP_DISCONNECTED"===event.name&&"LOGOUT"===event.data.reason&&(_this231.numberMissedCallLogs=0,_this231.callLogs=[],_this231.aggregatedCallLogs=[],_this231.started=!1,_this231.ackAllCallLogsInDBDone=!1)}))}return _createClass(AgnosticCallLogService,[{key:"subscribe",value:function(observer){return this.rxSubject.subscribe(observer)}},{key:"start",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee417(){var _this232=this;return regenerator_default.a.wrap((function(_context418){for(;;)switch(_context418.prev=_context418.next){case 0:return _context418.abrupt("return",this.started?Promise.resolve():(this.startPromise=new Promise((function(resolve){_this232.startPromiseResolve=resolve,_this232.usePhonebookDirectory=_this232.profileService.isFeatureEnabled(_this232.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK)||config.permitSearchFromPhoneBook,_this232.getCallLogHistoryPage(),_this232.numberMissedCallLogs>14&&!_this232.ackAllCallLogsInDBDone&&(_this232.ackAllCallLogsInDBDone=!0,_this232.ackAllCallLogsInDB())})),this.startPromise));case 1:case"end":return _context418.stop()}}),_callee417,this)})))}},{key:"attachXMPPListeners",value:function(){var _this233=this;this.getMissedCallLogNumber(),this.callLogHandlerRef&&(this.xmppService.connection.deleteHandler(this.callLogHandlerRef),this.callLogHandlerRef=null),this.callLogHandlerRef=this.xmppService.connection.addHandler((function(stanza){return _this233.onHistoryCallLogMessageReceived(stanza)}),AgnosticCallLogService.CALL_LOG_NAMESPACE,null,null),this.callLogNotificationRef&&(this.xmppService.connection.deleteHandler(this.callLogNotificationRef),this.callLogNotificationRef=null),this.callLogNotificationRef=this.xmppService.connection.addHandler((function(stanza){return _this233.onCallLogNotificationReceived(stanza)}),AgnosticCallLogService.CALL_LOG_NOTIF_NAMESPACE,null,null),this.callLogMessageAckRef&&(this.xmppService.connection.deleteHandler(this.callLogMessageAckRef),this.callLogMessageAckRef=null),this.callLogMessageAckRef=this.xmppService.connection.addHandler((function(stanza){return _this233.onCallLogAckReceived(stanza)}),AgnosticCallLogService.CALL_LOG_ACK_NAMESPACE,null,null)}},{key:"getCalllogs",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee418(){return regenerator_default.a.wrap((function(_context419){for(;;)switch(_context419.prev=_context419.next){case 0:return _context419.next=2,this.start();case 2:return _context419.abrupt("return",this.callLogs);case 3:case"end":return _context419.stop()}}),_callee418,this)})))}},{key:"getAggregatedCalllogs",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee419(){return regenerator_default.a.wrap((function(_context420){for(;;)switch(_context420.prev=_context420.next){case 0:return _context420.next=2,this.start();case 2:return _context420.abrupt("return",this.aggregatedCallLogs);case 3:case"end":return _context420.stop()}}),_callee419,this)})))}},{key:"getSimplifiedCallLogs",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee420(){return regenerator_default.a.wrap((function(_context421){for(;;)switch(_context421.prev=_context421.next){case 0:return _context421.next=2,this.start();case 2:return _context421.abrupt("return",this.callLogs.map((function(callLog){return{contact:callLog.contact.id,contactDisplayName:callLog.contact.displayName,read:callLog.read,contactInitials:callLog.contact.initials,id:callLog.id,state:callLog.state,date:callLog.date,duration:callLog.duration,direction:callLog.direction,type:callLog.type}})));case 3:case"end":return _context421.stop()}}),_callee420,this)})))}},{key:"getNumberMissedCallLogs",value:function(){return this.numberMissedCallLogs}},{key:"markCallLogAsRead",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee421(){var message;return regenerator_default.a.wrap((function(_context422){for(;;)switch(_context422.prev=_context422.next){case 0:return message=$msg({from:this.xmppService.jid,to:this.xmppService.jid}),_context422.abrupt("return",(message.c("read",{xmlns:AgnosticCallLogService.CALL_LOG_ACK_NAMESPACE,call_id:id}),this.xmppService.sendIQ(message)));case 2:case"end":return _context422.stop()}}),_callee421,this)})))}},{key:"markAllCallsLogsAsRead",value:function(){var _this234=this;this.callLogs.forEach((function(callLog){if(!callLog.read){var message=$msg({from:_this234.xmppService.jid,to:_this234.xmppService.jid});message.c("read",{xmlns:AgnosticCallLogService.CALL_LOG_ACK_NAMESPACE,call_id:callLog.id}),_this234.xmppService.sendIQ(message)}}))}},{key:"deleteCallLogsForContact",value:function(jid){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee422(){var message;return regenerator_default.a.wrap((function(_context423){for(;;)switch(_context423.prev=_context423.next){case 0:return message=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"}),_context423.abrupt("return",(message.c("delete",{xmlns:AgnosticCallLogService.CALL_LOG_NAMESPACE,peer:jid}),this.xmppService.sendIQ(message)));case 2:case"end":return _context423.stop()}}),_callee422,this)})))}},{key:"deleteOneCallLog",value:function(id){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee423(){var msg;return regenerator_default.a.wrap((function(_context424){for(;;)switch(_context424.prev=_context424.next){case 0:return msg=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"}).c("delete",{xmlns:AgnosticCallLogService.CALL_LOG_NAMESPACE,call_id:id}),_context424.abrupt("return",this.xmppService.sendIQ(msg));case 2:case"end":return _context424.stop()}}),_callee423,this)})))}},{key:"deleteAllCallLogs",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee424(){var message;return regenerator_default.a.wrap((function(_context425){for(;;)switch(_context425.prev=_context425.next){case 0:return message=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"}),_context425.abrupt("return",(message.c("delete",{xmlns:AgnosticCallLogService.CALL_LOG_NAMESPACE}),this.xmppService.sendIQ(message)));case 2:case"end":return _context425.stop()}}),_callee424,this)})))}},{key:"getMissedCallLogNumber",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee425(){var message,stanza;return regenerator_default.a.wrap((function(_context426){for(;;)switch(_context426.prev=_context426.next){case 0:return(message=$iq({from:this.xmppService.jid,type:"set"})).c("query",{xmlns:AgnosticCallLogService.CALL_LOG_NAMESPACE}),message.c("set",{xmlns:"http://jabber.org/protocol/rsm"}),message.c("max").t(0).up().up(),message.c("x",{xmlns:"jabber:x:data",type:"submit"}),message.c("field",{var:"read"}).c("value").t("false").up().up(),_context426.next=4,this.xmppService.sendIQ(message);case 4:return stanza=_context426.sent,_context426.abrupt("return",(this.numberMissedCallLogs=parseInt($(stanza).find("count").text(),10),this.rxSubject.next({type:"ON_CALL_LOG_NUMBER_UPDATED",value:this.numberMissedCallLogs}),this.numberMissedCallLogs));case 6:case"end":return _context426.stop()}}),_callee425,this)})))}},{key:"getCallLogHistoryPage",value:function(){var useAfter=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee426(){var message;return regenerator_default.a.wrap((function(_context427){for(;;)switch(_context427.prev=_context427.next){case 0:return(message=$iq({from:this.xmppService.jid,type:"set"})).c("query",{xmlns:AgnosticCallLogService.CALL_LOG_NAMESPACE}),message.c("set",{xmlns:"http://jabber.org/protocol/rsm"}),message.c("max").t(AgnosticCallLogService.CALL_LOG_MAX).up(),useAfter?message.c("after").t(useAfter).up():message.c("before").t("").up(),_context427.next=7,this.xmppService.sendIQ(message);case 7:case"end":return _context427.stop()}}),_callee426,this)})))}},{key:"ackAllCallLogsInDB",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee427(){var message,stanza;return regenerator_default.a.wrap((function(_context428){for(;;)switch(_context428.prev=_context428.next){case 0:return _context428.prev=0,this.logger.warn("ackAllCallLogsInDB --- used for "+this.numberMissedCallLogs+" call-logs"),(message=$iq({from:this.xmppService.jid,type:"set"})).c("markallread",{xmlns:AgnosticCallLogService.CALL_LOG_NAMESPACE}),_context428.next=6,this.xmppService.sendIQ(message);case 6:if(stanza=_context428.sent,!$(stanza).find("error").length){_context428.next=9;break}return _context428.abrupt("return",void this.logger.warn("ackAllCallLogsInDB --- error ..."));case 9:return _context428.next=11,this.getMissedCallLogNumber();case 11:_context428.next=16;break;case 13:return _context428.prev=13,_context428.t0=_context428.catch(0),_context428.abrupt("return",void this.logger.warn("ackAllCallLogsInDB --- error ..."));case 16:case"end":return _context428.stop()}}),_callee427,this,[[0,13]])})))}},{key:"orderCallLogs",value:function(){this.callLogs.sort((function(a,b){return callLog_model_1.CallLog.getDate(b)-callLog_model_1.CallLog.getDate(a)})),this.aggregateCalllogs(),this.$rootScope.$broadcast("ON_CALL_LOG_UPDATED"),this.rxSubject.next({type:"ON_CALL_LOG_UPDATED"});var missedCallLog=this.getMissedCallLogCounter();missedCallLog!==this.numberMissedCallLogs&&(this.numberMissedCallLogs=missedCallLog,this.$rootScope.$broadcast("ON_CALL_LOG_ACK_UPDATED",this.numberMissedCallLogs),this.rxSubject.next({type:"ON_CALL_LOG_ACK_UPDATED",value:this.numberMissedCallLogs}))}},{key:"aggregateCalllogs",value:function(){var _this235=this,current=0;this.aggregatedCallLogs=[];var passed={};this.callLogs.forEach((function(callLog,ind){var jid=callLog.contact.id;if("conference"===callLog.type)0!==ind&&current++,_this235.aggregatedCallLogs[current]=callLog,_this235.aggregatedCallLogs[current].count=1,_this235.aggregatedCallLogs[current].editable=!1;else if(0===ind)passed[jid]=1,_this235.aggregatedCallLogs[current]=callLog,_this235.aggregatedCallLogs[current].count=1,_this235.aggregatedCallLogs[current].editable=!0,"missed"===callLog.state&&"incoming"===callLog.direction?_this235.aggregatedCallLogs[current].isMissed=!0:"missed"===callLog.state&&"outgoing"===callLog.direction&&(_this235.aggregatedCallLogs[current].isNotAnswered=!0);else if(passed[jid]){var index=passed[jid],element=_this235.aggregatedCallLogs[index-1];element.editable&&(element.isMissed&&"missed"===callLog.state&&"incoming"===callLog.direction||element.isNotAnswered&&"missed"===callLog.state&&"outgoing"===callLog.direction?element.count++:element.editable=!1)}else current++,passed[jid]=current+1,_this235.aggregatedCallLogs[current]=callLog,_this235.aggregatedCallLogs[current].count=1,_this235.aggregatedCallLogs[current].editable=!0,"missed"===callLog.state&&"incoming"===callLog.direction?_this235.aggregatedCallLogs[current].isMissed=!0:"missed"===callLog.state&&"outgoing"===callLog.direction&&(_this235.aggregatedCallLogs[current].isNotAnswered=!0)}))}},{key:"createCallLogFromStanza",value:function(stanzaElem,call_logElem){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee428(){var trueCall_logElem,id,state,callerJid,calleeJid,type,otherParticipantJid,otherParticipantNumber,isUserContact,direction,conference,typeCall,contact,foundIdentity,foundFirstName,foundLastName,foundDisplayName,identityFirstName,identityLastName,centralizedService,displayNameisAPhoneNumber,read,duration,date,callSubject,callLog;return regenerator_default.a.wrap((function(_context429){for(;;)switch(_context429.prev=_context429.next){case 0:if(trueCall_logElem=!1,call_logElem?trueCall_logElem=!0:call_logElem=stanzaElem,id=call_logElem.find("call_id").text(),state=call_logElem.find("state").text(),!this.callLogs.some((function(callLog){return callLog.id===id||"failed"===state||"ongoing"===state}))){_context429.next=5;break}return _context429.abrupt("return",(this.logger.debug("createCallLogFromStanza --- ignore existing of wrong call-log"),null));case 5:if(callerJid=call_logElem.find("caller").text(),calleeJid=call_logElem.find("callee").text(),!(callerJid&&-1!==callerJid.indexOf("janusgateway")||calleeJid&&-1!==calleeJid.indexOf("janusgateway"))){_context429.next=8;break}return _context429.abrupt("return",(this.logger.debug("createCallLogFromStanza --- ignore janusgateway call-log"),null));case 8:if(!(callerJid&&this.webrtcGatewayService.isMediaPillarJid(callerJid)||calleeJid&&this.webrtcGatewayService.isMediaPillarJid(calleeJid))){_context429.next=10;break}return _context429.abrupt("return",(this.logger.debug("createCallLogFromStanza --- ignore mediapillar call-log"),null));case 10:if(type="webrtc",otherParticipantJid=null,otherParticipantNumber=null,isUserContact=this.xmppService.isConnectedJid(callerJid),direction=isUserContact?"outgoing":"incoming",conference=!1,(conference=trueCall_logElem?"conference"===call_logElem.attr("service"):"conference"===stanzaElem.find("call_log").attr("service"))?(type="conference",-1===(otherParticipantJid=callerJid).indexOf("@")&&(otherParticipantNumber=otherParticipantJid,otherParticipantJid=null)):((typeCall=trueCall_logElem?call_logElem.attr("type"):stanzaElem.find("call_log").attr("type"))||(typeCall=stanzaElem.find("type").text()),"phone"===typeCall&&(type="telephone"),-1===(otherParticipantJid=isUserContact?calleeJid:callerJid).indexOf("@")&&(otherParticipantNumber=otherParticipantJid,otherParticipantJid=null,type="telephone")),!otherParticipantJid&&!otherParticipantNumber){_context429.next=50;break}return _context429.prev=13,_context429.next=16,this.contactService.getOrCreateContact(otherParticipantJid,otherParticipantNumber);case 16:if(contact=_context429.sent,conference||otherParticipantJid||!contact.temp){_context429.next=39;break}if(!(foundIdentity=this.usePhonebookDirectory?call_logElem.find("identity"):null)||!foundIdentity.length){_context429.next=24;break}foundFirstName=foundIdentity.attr("firstName"),foundLastName=foundIdentity.attr("lastName"),foundDisplayName=foundIdentity.attr("displayName"),identityFirstName=foundFirstName||"",""===(identityLastName=foundLastName||"")&&""===identityFirstName&&foundDisplayName&&0!==foundDisplayName.length&&foundDisplayName!==otherParticipantNumber&&(identityLastName=foundDisplayName),(identityFirstName.length||identityLastName.length)&&(this.logger.debug("createCallLogFromStanza xNames updated from phonebook for contact "+contact.id),contact.updateName(identityFirstName,identityLastName)),_context429.next=36;break;case 24:return _context429.prev=24,centralizedService=this.$injector.get("centralizedService"),_context429.next=28,centralizedService.outlook.updateContactFromOutlookInfos(contact,otherParticipantNumber,!0);case 28:if(_context429.t0=_context429.sent,!_context429.t0){_context429.next=31;break}this.logger.debug("createCallLogFromStanza xNames updated from outlook for contact "+contact.id);case 31:_context429.next=36;break;case 33:_context429.prev=33,_context429.t1=_context429.catch(24),this.logger.debug("createCallLogFromMessage no outlook service :"+contact.id);case 36:displayNameisAPhoneNumber=!1,this.telephonyService.started&&(displayNameisAPhoneNumber=contact.displayName.match(/^[0-9A-D #\-\+\*\(\)\./]{1,32}$/)&&this.telephonyService.startAsPhoneNumber(contact.displayName)),displayNameisAPhoneNumber&&contact.phoneProCan&&""!==contact.phoneProCan&&(contact.displayName=contact.phoneProCan);case 39:read="true"===call_logElem.find("ack").attr("read"),duration=(duration=parseInt(call_logElem.find("duration").text(),10))>0?moment.duration(duration,"ms").format("h[H] mm[m] ss[s]"):0,(date=stanzaElem.find("delay").attr("stamp"))&&(date=new Date(date)),callSubject=stanzaElem.find("subject").text(),callLog=callLog_model_1.CallLog.create(id,contact,state,duration,type,read,date,direction,callSubject,!1),this.callLogs.push(callLog),"answered"!==state||read||this.markCallLogAsRead(id),_context429.next=50;break;case 47:_context429.prev=47,_context429.t2=_context429.catch(13),this.logger.error("createCallLogFromStanza -- failure --- "+_context429.t2);case 50:case"end":return _context429.stop()}}),_callee428,this,[[13,47],[24,33]])})))}},{key:"getMissedCallLogCounter",value:function(){var num=0;return this.callLogs.forEach((function(callLog){callLog.read||"missed"!==callLog.state||"incoming"!==callLog.direction||num++})),num}},{key:"removeCallLogsForUser",value:function(jid){jid.endsWith("@_")&&(jid=jid.substring(0,jid.length-2));for(var newLogs=[],i=0;i<this.callLogs.length;i++)(!this.callLogs[i].contact||this.callLogs[i].contact.jid!==jid&&this.callLogs[i].contact.id!==jid)&&newLogs.push(this.callLogs[i]);this.callLogs=newLogs,this.orderCallLogs()}}]),AgnosticCallLogService}();AgnosticCallLogService.CALL_LOG_NAMESPACE="jabber:iq:telephony:call_log",AgnosticCallLogService.CALL_LOG_ACK_NAMESPACE="urn:xmpp:telephony:call_log:receipts",AgnosticCallLogService.CALL_LOG_NOTIF_NAMESPACE="jabber:iq:notification:telephony:call_log",AgnosticCallLogService.CALL_LOG_MAX=75,exports.AgnosticCallLogService=AgnosticCallLogService},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var CallLog=function(){function CallLog(id,contact,state,duration,type,read,date,direction,callSubject,isLatestCall){_classCallCheck(this,CallLog),this.count=0,this.editable=!1,this.isMissed=!1,this.isNotAnswered=!1,this.id=id,this.contact=contact,this.state=state,this.duration=duration,this.type=type,this.read=read,this.date=date,this.direction=direction,this.callSubject=callSubject,this.isLatestCall=isLatestCall,this.type="unknown"===type||"audio"===type||"webrtc"===type?CallLog.Type.WEBRTC:"telephone"===type?CallLog.Type.TELEPHONE:CallLog.Type.CONFERENCE}return _createClass(CallLog,[{key:"updateCallLogDisplayInfo",value:function(){var grouped=arguments.length>0&&void 0!==arguments[0]&&arguments[0];"incoming"===this.direction?(this.svgClass="missed"===this.state?"missed":"active",this.svgId="call_made","forwarded"===this.state?(this.svgId="call_missed",this.title="incomingCallForwarded"):this.title="incommingCall","missed"===this.state&&(this.title=grouped&&this.count>1?"missedCalls":"missedCall")):(this.svgId="call_received",this.title="outgoingCall",this.svgClass="active","missed"===this.state&&(this.svgClass="",this.title=grouped&&this.count>1?"noAnswers":"noAnswer"))}}],[{key:"create",value:function(id,contact,state,duration,type,read,date,direction,callSubject,isLatestCall){return new CallLog(id,contact,state,duration,type,read,date,direction,callSubject,isLatestCall)}},{key:"getNames",value:function(callLog){var firstname="",lastname="",date=null;return callLog&&callLog.contact&&(firstname=callLog.contact.firstname.toUpperCase(),lastname=callLog.contact.lastname.toUpperCase(),date=callLog.date?callLog.date.getTime():null),{firstname:firstname,lastname:lastname,date:date}}},{key:"getDate",value:function(callLog){return callLog&&callLog.date?callLog.date.getTime():0}},{key:"sortByContact",value:function(callLogA,callLogB){var res=-1;if(callLogA&&callLogA.value.lastname&&callLogB&&callLogB.value.lastname){var str1=callLogA.value.lastname,str2=callLogB.value.lastname;0===(res=str1.localeCompare(str2))&&(str1=callLogA.value.firstname,str2=callLogB.value.firstname,0===(res=str1.localeCompare(str2))&&callLogB.value.date&&callLogA.value.date&&(res=callLogB.value.date-callLogA.value.date))}return res}},{key:"sortByDate",value:function(callLogA,callLogB){var res=1;return callLogA&&callLogB&&(res=callLogB.value-callLogA.value),res}}]),CallLog}();CallLog.Type={WEBRTC:"webrtc",TELEPHONE:"telephone",CONFERENCE:"conference"},exports.CallLog=CallLog},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2__);angular.module("rainbow").service("ringingService",["$q","$log","$rootScope","$interval","platformService",function($q,$log,$rootScope,$interval,platformService){var service=this,listeners=[],subscriptions=[];service.start=function(stats){var startDate=performance.now();$log.info("[ringingService] STARTING"),service.notifs=["noSound","ding","harp","hello","complete","duck","appointed","chime","stairs","wet","wilhelm","important"],service.alarms=["noRingtone","lightBounce","discovery","lounge","uptown","morningLights","miami","farEast","highSpeed","rainDrops","deepSpace","steamTrain","happy","decrescendo","strident","peacefulness","classic1","classic2","classic3","cosy1","cosy2","cosy3","dynamic1","dynamic2","dynamic3","quiet1","quiet2","quiet3","relax1","relax2","relax3"];var audio=new Audio;$rootScope.canPlayOgg=Boolean(audio.canPlayType)&&Boolean(audio.canPlayType('audio/ogg; codecs="vorbis"')),service.audioFileType=$rootScope.canPlayOgg?".ogg":".mp3",audio=null,service.ringbackTone={audio:new Audio,starting:!1,id:"ringbackTone"},service.recordTone=new Audio("/resources/sounds/beep-01a"+service.audioFileType),service.SecondCallTone=new Audio("/resources/sounds/start"+service.audioFileType),service.joinWebConfTone=new Audio("/resources/sounds/join_meeting"+service.audioFileType),service.holdTone={audio:new Audio("/resources/sounds/hold-tone"+service.audioFileType),starting:!1},service.pushToTalkActivateTone=new Audio("/resources/sounds/ptt_activate"+service.audioFileType),service.pushToTalkDeactivateTone=new Audio("/resources/sounds/ptt_deactivate"+service.audioFileType),service.ringbackTone.audio.onloadeddata=function(){$log.info("[ringingService] === ringbackTone -- loaded")},service.ringbackTone.audio.oncanplay=function(){$log.info("[ringingService] === ringbackTone -- oncanplay ")},service.ringbackTone.audio.onerror=function(){$log.error("[ringingService] === ringbackTone -- onerror ")},service.ringbackTone.audio.src="/resources/sounds/outgoing-rings"+service.audioFileType,service.holdTone.audio.loop=!0,service.alarmNotifOnce=null,service.informationImSound=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.informationImSound,service.informationImSound||(service.informationImSound=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("informationImSound")),service.importantImSound=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.importantImSound,service.importantImSound||(service.importantImSound=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("importantImSound")),service.manageEmergencyNotifs(),service.setActive(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.settings.activeNotif,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.settings.activeAlarm,service.informationImSound,service.importantImSound);var startDuration=Math.round(performance.now()-startDate);return stats.push({service:"ringingService",startDuration:startDuration}),$log.info("[ringingService] === STARTED ("+startDuration+" ms) ==="),listeners.push($rootScope.$on("ON_WEB_CONFENRECE_PARTICIPANT_JOINED_EVENT",service.playWebConferenceJoinNotif)),listeners.push($rootScope.$on("ON_PRESS_PUSH_TO_TALK_EVENT",service.playActivatePtT)),listeners.push($rootScope.$on("ON_RELEASE_PUSH_TO_TALK_EVENT",service.playDeactivatePtT)),subscriptions.push(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.subscribe((function(){service.manageEmergencyNotifs()}))),$q.when()},service.setActive=function(notif,alarm,informationImSound,importantImSound){service.activeNotif=notif,service.activeAlarm=alarm,"noSound"!==notif?(service.pingAudio=new Audio("/resources/sounds/notifs/"+service.activeNotif+service.audioFileType),service.pingAudioSecondary=new Audio("/resources/sounds/notifs/"+service.activeNotif+service.audioFileType)):(service.pingAudio=null,service.pingAudioSecondary=null,$log.info("Notif sound set to null")),"noRingtone"!==alarm?(service.incomingRingingTone={audio:new Audio,starting:!1,id:"incomingRingingTone"},service.incomingRingingSecondaryTone={audio:new Audio("/resources/sounds/alarms/"+service.activeAlarm+service.audioFileType),starting:!1,id:"incomingRingingSecondaryTone"},service.incomingRingingTone.audio.onloadeddata=function(){$log.info("[ringingService] === incomingRingingTone -- loaded")},service.incomingRingingTone.audio.oncanplay=function(){$log.info("[ringingService] === incomingRingingTone -- oncanplay ")},service.incomingRingingTone.audio.onerror=function(error){$log.error("[ringingService] === incomingRingingTone -- onerror "),error&&error.target&&error.target.error&&$log.error("[ringingService] === incomingRingingTone -- onerror msg "+error.target.error.message)},service.incomingRingingTone.audio.src="/resources/sounds/alarms/"+service.activeAlarm+service.audioFileType):(service.incomingRingingTone=null,service.incomingRingingSecondaryTone=null,$log.info("Ringtone sound set to null")),"noSound"!==informationImSound?(service.informationImSoundAudio=new Audio("/resources/sounds/notifs/"+service.informationImSound+service.audioFileType),service.informationImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+service.informationImSound+service.audioFileType)):(service.informationImSoundAudio=null,service.informationImSoundAudioSecondary=null,$log.info("Information notif sound set to null")),"noSound"!==importantImSound?(service.importantImSoundAudio=new Audio("/resources/sounds/notifs/"+service.importantImSound+service.audioFileType),service.importantImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+service.importantImSound+service.audioFileType)):(service.importantImSoundAudio=null,service.importantImSoundAudioSecondary=null,$log.info("Important notif sound set to null"))},service.manageEmergencyNotifs=function(){service.emergencyAlarms=["noSound","pager1"],_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)&&(service.emergencyAlarms=["noSound","emergency"]),service.emergencyImSound=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.emergencyImSound,service.emergencyImSound||(service.emergencyImSound=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("emergencyImSound")),service.setEmergencyAlarm()},service.setEmergencyAlarm=function(){var update=!1;(!_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)||"noSound"!==service.emergencyImSound&&-1!==service.emergencyAlarms.indexOf(service.emergencyImSound))&&(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)||-1!==service.emergencyAlarms.indexOf(service.emergencyImSound))||(update=!0),update&&(service.emergencyImSound=service.emergencyAlarms[1],_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.emergencyImSound=service.emergencyImSound,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.updateUserContact({customData:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData})),"noSound"!==service.emergencyImSound?(service.emergencyImSoundAudio=new Audio("/resources/sounds/notifs/"+service.emergencyImSound+service.audioFileType),service.emergencyImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+service.emergencyImSound+service.audioFileType)):(service.emergencyImSoundAudio=null,service.emergencyImSoundAudioSecondary=null,$log.info("Emergency notif sound set to null"))},service.stop=function(){var listener;for($log.info("[ringingService] STOPPING"),$log.info("[ringingService] STOPPED");listener=listeners.pop();)listener();return subscriptions.forEach((function(subscription){subscription.unsubscribe()})),service.ringbackTone&&(service.ringbackTone.starting=!1),service.incomingRingingTone&&(service.incomingRingingTone.starting=!1),service.incomingRingingSecondaryTone&&(service.incomingRingingSecondaryTone.starting=!1),service.ringbackTone=null,service.recordTone=null,service.SecondCallTone=null,service.joinWebConfTone=null,service.holdTone=null,service.alarmNotifOnce=null,service.informationImSound=null,service.importantImSound=null,service.emergencyImSoundAudio=null,service.emergencyImSoundAudioSecondary=null,service.informationImSoundAudio=null,service.informationImSoundAudioSecondary=null,service.importantImSoundAudio=null,service.importantImSoundAudioSecondary=null,service.pingAudio=null,service.pingAudioSecondary=null,service.incomingRingingTone=null,service.incomingRingingSecondaryTone=null,service.pushToTalkActivateTone=null,service.pushToTalkDeactivateTone=null,$q.when()},service.stopIncomingWebrtcSounds=function(){service.stopWebrtcSounds=!0},service.onMyProfileFeaturesChanged=function(){},service.setActiveAlarm=function(alarm){$log.info("[ringingService] setActiveAlarm to "+alarm),service.activeAlarm=alarm,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.setUserSettings({activeAlarm:service.activeAlarm}),"noRingtone"!==alarm?(service.incomingRingingTone={audio:new Audio,starting:!1,id:"incomingRingingTone"},service.incomingRingingSecondaryTone={audio:new Audio("/resources/sounds/alarms/"+service.activeAlarm+service.audioFileType),starting:!1,id:"incomingRingingSecondaryTone"},service.incomingRingingTone.audio.onloadeddata=function(){$log.info("[ringingService] === incomingRingingTone -- loaded")},service.incomingRingingTone.audio.oncanplay=function(){$log.info("[ringingService] === incomingRingingTone -- oncanplay ")},service.incomingRingingTone.audio.onerror=function(error){$log.error("[ringingService] === incomingRingingTone -- onerror "),error&&error.target&&error.target.error&&$log.error("[ringingService] === incomingRingingTone -- onerror msg "+error.target.error.message)},service.incomingRingingTone.audio.src="/resources/sounds/alarms/"+service.activeAlarm+service.audioFileType):(service.incomingRingingTone=null,service.incomingRingingSecondaryTone=null,$log.info("Ringtone sound set to null"))},service.playAlarmOnce=function(alarm){$log.info("[ringingService] playAlarmOnce "+alarm.name),null!==service.alarmNotifOnce&&service.alarmNotifOnce.pause(),service.alarmNotifOnce=new Audio("/resources/sounds/alarms/"+alarm.name+service.audioFileType),service.alarmNotifOnce.currentTime=0,service.alarmNotifOnce.play(),service.addEvents(service.alarmNotifOnce,alarm)},service.alarmCurPlay=function(){return service.alarmNotifOnce instanceof Audio},service.addEvents=function(audioObject,alarm){audioObject.onended=function(){service.alarmNotifOnce=null,alarm.iconPlayer="play"}},service.stopAlarmOnce=function(){$log.info("[ringingService] stopAlarmOnce"),service.alarmNotifOnce&&(service.alarmNotifOnce.pause(),service.alarmNotifOnce=null)},service.playNotifOnce=function(notif){$log.info("[ringingService] playNotifOnce "+notif.name),service.audioNotifOnce=new Audio("/resources/sounds/notifs/"+notif.name+service.audioFileType),service.audioNotifOnce.currentTime=0,service.audioNotifOnce.play(),service.addEvents(service.audioNotifOnce,notif)},service.notifCurPlay=function(){return service.audioNotifOnce instanceof Audio},service.stopNotifOnce=function(){$log.info("[ringingService] stopNotifOnce"),service.audioNotifOnce.pause(),service.audioNotifOnce=null},service.setActiveNotif=function(notif){$log.info("[ringingService] setActiveNotif to "+notif),service.activeNotif=notif,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.setUserSettings({activeNotif:service.activeNotif}),"noSound"!==notif?(service.pingAudio=new Audio("/resources/sounds/notifs/"+service.activeNotif+service.audioFileType),service.pingAudioSecondary=new Audio("/resources/sounds/notifs/"+service.activeNotif+service.audioFileType)):(service.pingAudio=null,service.pingAudioSecondary=null,$log.info("Notif sound set to null"))},service.setInformationImSound=function(notif){$log.info("[ringingService] setInformationImSound to "+notif),service.informationImSound=notif,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("informationImSound",notif),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.informationImSound=notif,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.updateUserContact({customData:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData}),"noSound"!==notif?(service.informationImSoundAudio=new Audio("/resources/sounds/notifs/"+service.informationImSound+service.audioFileType),service.informationImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+service.informationImSound+service.audioFileType)):(service.informationImSoundAudio=null,service.informationImSoundAudioSecondary=null)},service.setImportantImSound=function(notif){$log.info("[ringingService] setImportantImSound to "+notif),service.importantImSound=notif,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("importantImSound",notif),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.importantImSound=notif,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.updateUserContact({customData:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData}),"noSound"!==notif?(service.importantImSoundAudio=new Audio("/resources/sounds/notifs/"+service.importantImSound+service.audioFileType),service.importantImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+service.importantImSound+service.audioFileType)):(service.importantImSoundAudio=null,service.importantImSoundAudioSecondary=null)},service.setEmergencyImSound=function(notif){$log.info("[ringingService] setEmergencyImSound to "+notif),service.emergencyImSound=notif,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("emergencyImSound",notif),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.emergencyImSound=notif,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.updateUserContact({customData:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData}),"noSound"!==notif?(service.emergencyImSoundAudio=new Audio("/resources/sounds/notifs/"+service.emergencyImSound+service.audioFileType),service.emergencyImSoundAudioSecondary=new Audio("/resources/sounds/notifs/"+service.emergencyImSound+service.audioFileType)):(service.emergencyImSoundAudio=null,service.emergencyImSoundAudioSecondary=null)},service.stopUrgencyNotif=function(){$log.info("[ringingService] stopUrgencyNotif"),service.emergencyImSoundAudio&&(service.emergencyImSoundAudio.pause(),service.emergencyImSoundAudio=null),service.emergencyImSoundAudioSecondary&&(service.emergencyImSoundAudioSecondary.pause(),service.emergencyImSoundAudioSecondary=null)},service.playCustomNotif=function(typeNotif){var imSoundAudio,imSoundAudioSecondary;if(service.stopWebrtcSounds)$log.info("[ringingService] playImNotif is blocked ...");else if("std"===typeNotif||"high"===typeNotif&&!_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.alertNotificationEnabledForMyCompany)service.playImNotif();else{switch(typeNotif){case"low":imSoundAudio=service.informationImSoundAudio,imSoundAudioSecondary=service.informationImSoundAudioSecondary;break;case"middle":imSoundAudio=service.importantImSoundAudio,imSoundAudioSecondary=service.importantImSoundAudioSecondary;break;case"high":service.emergencyImSoundAudio&&service.emergencyImSoundAudio.pause(),service.emergencyImSoundAudio=new Audio("/resources/sounds/notifs/"+service.emergencyImSound+service.audioFileType),service.emergencyImSoundAudio.currentTime=0,_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)&&(service.emergencyImSoundAudio.loop=!0),imSoundAudio=service.emergencyImSoundAudio,imSoundAudioSecondary=service.emergencyImSoundAudioSecondary;break;default:return void service.playImNotif()}platformService.allowDevicesManagement()?("true"===platformService.getSecondRingerStatusFromSettings()&&platformService.getRingingSpeaker().then((function(speaker){speaker&&platformService.setSpeakerForElement(imSoundAudioSecondary,speaker.id).then((function(){imSoundAudioSecondary.play()}))})),platformService.getCurrentSpeaker().then((function(speakerCurr){speakerCurr?platformService.setSpeakerForElement(imSoundAudio,speakerCurr.id).then((function(){imSoundAudio.play()})):imSoundAudio.play()}))):imSoundAudio.play()}},service.play=function(tone){var count=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(tone&&tone.audio){if(count||(count=0),4!==tone.audio.readyState){if(count<3)return $log.warn("[ringingService] play tone for id "+tone.id+" is not ready -- retry in 1 sec"),void $interval((function(tone1,count1){count1+=1,service.play(tone1,count1)}),1e3,1,!0,tone,count);if("incomingRingingTone"===tone.id){$log.warn("[ringingService] play tone for id "+tone.id+" does not load.. try another type");var type=".ogg"===service.audioFileType?".mp3":".ogg";return service.incomingRingingTone={audio:new Audio("/resources/sounds/alarms/"+service.activeAlarm+type),starting:!1,id:"incomingRingingTone"},void service.play(service.incomingRingingTone)}if("incomingRingingSecondaryTone"===tone.id){$log.warn("[ringingService] play tone for id "+tone.id+" does not load.. try another type");var _type2=".ogg"===service.audioFileType?".mp3":".ogg";return service.incomingRingingSecondaryTone={audio:new Audio("/resources/sounds/alarms/"+service.activeAlarm+_type2),starting:!1,id:"incomingRingingSecondaryTone"},void service.play(service.incomingRingingSecondaryTone)}$log.warn("[ringingService] play tone for id "+tone.id+" is not ready -- try to play it anyway")}var result=tone.audio.play();result&&"function"==typeof result.finally?result.then((function(){$log.info("[ringingService] play for id "+tone.id+" ok")})).catch((function(error){$log.error("[ringingService] play for id "+tone.id+" error: "+error)})).finally((function(){tone.starting=!1})):($log.info("[ringingService] (no promise) play for id "+tone.id+" ok"),tone.starting=!1)}else $log.warn("[ringingService] play tone is missing -- return")},service.startRingBackTone=function(isWebrtcCall){isWebrtcCall&&service.stopWebrtcSounds?$log.info("[ringingService] startRingBackTone is blocked for webrtc calls ..."):($log.info("[ringingService] startRingBackTone ..."),service.ringbackTone&&service.ringbackTone.stopDefered&&($log.info("[ringingService] startRingBackTone: cancel defered stop operation"),$interval.cancel(service.ringbackTone.stopDefered),service.ringbackTone.stopDefered=void 0),service.ringbackTone&&service.ringbackTone.audio&&service.ringbackTone.audio.paused&&!service.ringbackTone.starting?($log.info("[ringingService] startRingBackTone currently paused"),service.ringbackTone.starting=!0,service.ringbackTone.audio.currentTime=0,platformService.allowDevicesManagement()?platformService.getCurrentSpeaker().then((function(speaker){speaker?platformService.setSpeakerForElement(service.ringbackTone.audio,speaker.id).catch((function(){$log.error("[ringingService] startRingBackTone setSpeakerForElement -- error. Play on default device")})).finally((function(){$log.info("[ringingService] startRingBackTone play"),service.play(service.ringbackTone)})):($log.info("[ringingService] startRingBackTone play (no speaker)"),service.play(service.ringbackTone))})).catch((function(){$log.webrtc("[ringingService] startRingBackTone getCurrentSpeaker error"),service.ringbackTone.starting=!1})):($log.info("[ringingService] startRingBackTone play (no devices management)"),service.play(service.ringbackTone))):$log.info("[ringingService] startRingBackTone -- nothing to do (already starting or playing)"))},service.stopRingBackTone=function(count){if($log.debug("[ringingService] stopRingBackTone ..."),service.ringbackTone){if(service.ringbackTone.starting)return void(service.ringbackTone.stopDefered?$log.debug("[ringingService] stopRingBackTone: nothing to do : stop already defered"):(count||(count=1),$log.debug("[ringingService] stopRingBackTone: tone still starting: defer stop 1s later"),service.ringbackTone.stopDefered=$interval(service.stopRingBackToneDefered,1e3,1,!0,count)));service.ringbackTone.stopDefered=void 0,service.ringbackTone.audio&&!service.ringbackTone.audio.paused?($log.info("[ringingService] stopRingBackTone: tone is playing: stop it"),service.ringbackTone.audio.pause(),service.ringbackTone.audio.currentTime=0):$log.debug("[ringingService] stopRingBackTone: nothing to do : tone is already stopped")}},service.stopRingBackToneDefered=function(count){service.ringbackTone.stopDefered=void 0,(count+=1)>=3?service.ringbackTone.audio&&($log.info("[ringingService] stopRingBackToneDefered: tone is blocked on starting, stop it"),service.ringbackTone.audio.pause(),service.ringbackTone.audio.currentTime=0,service.ringbackTone.audio.src="",service.ringbackTone.audio.src="/resources/sounds/outgoing-rings"+service.audioFileType):service.stopRingBackTone(count)},service.startIncomingRinging=function(isWebrtcCall){isWebrtcCall&&service.stopWebrtcSounds?$log.info("[ringingService] startIncomingRinging is blocked for webrtc calls ..."):($log.info("[ringingService] startIncomingRinging ..."),service.incomingRingingTone&&service.incomingRingingTone.stopDefered&&($log.info("[ringingService] startIncomingRinging: cancel defered stop operation"),$interval.cancel(service.incomingRingingTone.stopDefered),service.incomingRingingTone.stopDefered=void 0),service.incomingRingingTone&&service.incomingRingingTone.audio&&service.incomingRingingTone.audio.paused&&!service.incomingRingingTone.starting?($log.info("[ringingService] startIncomingRinging currently paused"),service.incomingRingingTone.starting=!0,service.incomingRingingTone.audio.loop=!0,service.incomingRingingTone.audio.currentTime=0,platformService.allowDevicesManagement()?("true"===platformService.getSecondRingerStatusFromSettings()&&(service.incomingRingingSecondaryTone.starting=!0,service.incomingRingingSecondaryTone.audio.loop=!0,service.incomingRingingSecondaryTone.audio.currentTime=0,platformService.getRingingSpeaker().then((function(speaker){speaker&&platformService.setSpeakerForElement(service.incomingRingingSecondaryTone.audio,speaker.id).then((function(){$log.info("[ringingService] startIncomingRinging secondary device -- play"),service.play(service.incomingRingingSecondaryTone)}))})).catch((function(){$log.webrtc("[ringingService] startIncomingRinging secondary getRingingSpeaker error"),service.incomingRingingSecondaryTone.starting=!1}))),platformService.getCurrentSpeaker().then((function(speakerCurr){speakerCurr?platformService.setSpeakerForElement(service.incomingRingingTone.audio,speakerCurr.id).catch((function(){$log.error("[ringingService] startIncomingRinging setSpeakerForElement -- error. Play on default device")})).finally((function(){$log.info("[ringingService] startIncomingRinging -- play"),service.play(service.incomingRingingTone)})):($log.info("[ringingService] startIncomingRinging -- play (no speaker)"),service.play(service.incomingRingingTone))})).catch((function(){$log.webrtc("[ringingService] startIncomingRinging getCurrentSpeaker error"),service.incomingRingingTone.starting=!1}))):($log.info("[ringingService] startIncomingRinging -- play (no devices management)"),service.play(service.incomingRingingTone))):$log.info("[ringingService] startIncomingRinging -- nothing to do (already starting or playing)"))},service.stopIncomingRinging=function(count){if($log.debug("[ringingService] stopIncomingRinging ..."),service.incomingRingingTone){if(service.incomingRingingTone.starting)return void(service.incomingRingingTone.stopDefered?$log.debug("[ringingService] stopIncomingRinging: nothing to do : stop already defered"):(count||(count=1),$log.debug("[ringingService] stopIncomingRinging: tone still starting: defer stop 1s later"),service.incomingRingingTone.stopDefered=$interval(service.stopIncomingRingingDefered,1e3,1,!0,count)));service.incomingRingingTone.stopDefered=void 0,service.incomingRingingTone.audio&&!service.incomingRingingTone.audio.paused?($log.info("[ringingService] stopIncomingRinging: tone is playing: stop it"),service.incomingRingingTone.audio.pause(),service.incomingRingingTone.audio.currentTime=0):$log.debug("[ringingService] stopIncomingRinging: nothing to do : tone is already stopped")}service.incomingRingingSecondaryTone&&service.incomingRingingSecondaryTone.audio&&!service.incomingRingingSecondaryTone.audio.paused&&($log.info("[ringingService] stopIncomingRinging: secondary tone is playing: stop it"),service.incomingRingingSecondaryTone.audio.pause(),service.incomingRingingSecondaryTone.audio.currentTime=0)},service.stopIncomingRingingDefered=function(count){service.incomingRingingTone.stopDefered=void 0,(count+=1)>=3?service.incomingRingingTone.audio&&($log.info("[ringingService] stopIncomingRingingDefered: tone is blocked on starting, stop it"),service.incomingRingingTone.audio.pause(),service.incomingRingingTone.audio.currentTime=0,service.incomingRingingTone.audio.src="",service.incomingRingingTone.audio.src="/resources/sounds/alarms/"+service.activeAlarm+service.audioFileType):service.stopIncomingRinging(count)},service.playImNotif=function(){service.stopWebrtcSounds?$log.info("[ringingService] playImNotif is blocked ..."):"busy"!==_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.status||"audio"!==_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.message&&"video"!==_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.message&&"sharing"!==_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.message&&"presentation"!==_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.message?_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("imSound")&&service.pingAudio&&($log.info("[ringingService] playImNotif"),service.pingAudio.currentTime=0,service.pingAudioSecondary.currentTime=0,platformService.allowDevicesManagement()?("true"===platformService.getSecondRingerStatusFromSettings()&&platformService.getRingingSpeaker().then((function(speaker){speaker&&platformService.setSpeakerForElement(service.pingAudioSecondary,speaker.id).then((function(){service.pingAudioSecondary.play()}))})),platformService.getCurrentSpeaker().then((function(speakerCurr){speakerCurr?platformService.setSpeakerForElement(service.pingAudio,speakerCurr.id).then((function(){service.pingAudio.play()})):service.pingAudio.play()}))):service.pingAudio.play()):$log.info("[ringingService] playImNotif aborted due to communication Activity")},service.playRecordTone=function(){$log.info("[ringingService] playRecordTone"),service.recordTone.currentTime=0,platformService.allowDevicesManagement()?platformService.getCurrentSpeaker().then((function(speaker){speaker?platformService.setSpeakerForElement(service.recordTone,speaker.id).then((function(){service.recordTone.play()})):service.recordTone.play()})):service.recordTone.play()},service.playSecondCallTone=function(){$log.info("[ringingService] playSecondCallTone"),service.SecondCallTone.currentTime=0,platformService.allowDevicesManagement()?platformService.getCurrentSpeaker().then((function(speaker){speaker?platformService.setSpeakerForElement(service.SecondCallTone,speaker.id).then((function(){service.SecondCallTone.play()})):service.SecondCallTone.play()})):service.SecondCallTone.play()},service.playWebConferenceJoinNotif=function(){$log.info("[ringingService] playWebConferenceJoinNotif"),service.joinWebConfTone&&"true"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("joinSfuSound")&&(service.joinWebConfTone.currentTime=0,platformService.allowDevicesManagement()?platformService.getCurrentSpeaker().then((function(speakerCurr){speakerCurr?platformService.setSpeakerForElement(service.joinWebConfTone,speakerCurr.id).then((function(){service.joinWebConfTone.play()})):service.joinWebConfTone.play()})):service.joinWebConfTone.play())},service.playHoldTone=function(){$log.info("[ringingService] playHoldTone..."),service.holdTone&&service.holdTone.stopDefered&&($log.info("[ringingService] playHoldTone: cancel defered stop operation"),$interval.cancel(service.holdTone.stopDefered),service.holdTone.stopDefered=void 0),service.holdTone&&service.holdTone.audio&&service.holdTone.audio.paused&&!service.holdTone.starting?(service.holdTone.starting=!0,service.holdTone.audio.currentTime=0,platformService.allowDevicesManagement()?platformService.getCurrentSpeaker().then((function(speakerCurr){speakerCurr?platformService.setSpeakerForElement(service.holdTone.audio,speakerCurr.id).catch((function(){$log.error("[ringingService] playHoldTone setSpeakerForElement -- error. Play on default device")})).finally((function(){$log.info("[ringingService] playHoldTone play"),service.play(service.holdTone)})):($log.info("[ringingService] playHoldTone play (no speaker)"),service.play(service.holdTone))})).catch((function(){$log.webrtc("[ringingService] playHoldTone getCurrentSpeaker error"),service.holdTone.starting=!1})):($log.info("[ringingService] playHoldTone play (no devices management)"),service.play(service.holdTone))):$log.info("[ringingService] playHoldTone -- nothing to do (already starting or playing)")},service.stopHoldTone=function(){if($log.debug("[ringingService] stopHoldTone ..."),service.holdTone){if(service.holdTone.starting)return void(service.holdTone.stopDefered?$log.debug("[ringingService] stopHoldTone: nothing to do : stop already defered"):($log.debug("[ringingService] stopHoldTone: tone still starting: defer stop 1s later"),service.holdTone.stopDefered=$interval(service.stopHoldToneDefered,1e3,1)));service.holdTone.stopDefered=void 0,service.holdTone.audio&&!service.holdTone.audio.paused?($log.info("[ringingService] stopHoldTone: tone is playing: stop it"),service.holdTone.audio.pause(),service.holdTone.audio.currentTime=0):$log.debug("[ringingService] stopHoldTone: nothing to do : tone is already stopped")}},service.stopHoldToneDefered=function(){service.holdTone.stopDefered=void 0,service.stopHoldTone()},service.playActivatePtT=function(){service.pushToTalkActivateTone&&_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.enablePushToTalkTone&&(service.pushToTalkActivateTone.currentTime=0,platformService.allowDevicesManagement()?platformService.getCurrentSpeaker().then((function(speakerCurr){speakerCurr?platformService.setSpeakerForElement(service.pushToTalkActivateTone,speakerCurr.id).then((function(){service.pushToTalkActivateTone.play()})):service.pushToTalkActivateTone.play()})):service.pushToTalkActivateTone.play())},service.playDeactivatePtT=function(){service.pushToTalkDeactivateTone&&_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_1___default.a.userContact.customData.enablePushToTalkTone&&(service.pushToTalkDeactivateTone.currentTime=0,platformService.allowDevicesManagement()?platformService.getCurrentSpeaker().then((function(speakerCurr){speakerCurr?platformService.setSpeakerForElement(service.pushToTalkDeactivateTone,speakerCurr.id).then((function(){service.pushToTalkDeactivateTone.play()})):service.pushToTalkDeactivateTone.play()})):service.pushToTalkDeactivateTone.play())}}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_models_call_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__),_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(14),_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_2__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3__);angular.module("rainbow").service("telephonyServiceSipWise",["$q","$interval","$http","$rootScope","$log","errorHelperService","$injector",function($q,$interval,$http,$rootScope,$log,errorHelperService,$injector){var service=this;service.portalURL=config.restServerUrl+"/api/rainbow/voice/v1.0/",service.portalAdminURL=config.restServerUrl+"/api/rainbow/rvcpprovisioning/v1.0/",service.sipWiseRoutingObject={sipWiseDevicesList:[],ringingDestinations:[],alsoOfficePhoneRingEnabled:!0},service.resetSipWiseRoutingObject=function(){service.sipWiseRoutingObject={sipWiseDevicesList:[],ringingDestinations:[],alsoOfficePhoneRingEnabled:!0}},service.getPortalURLSipWise=function(){return service.portalURL},service.resetDevicesListSipWise=function(){service.sipWiseDevicesList=[]},service.getDevicesListSipWise=function(){return service.sipWiseRoutingObject.sipWiseDevicesList.length<1&&$log.info("[telephonyServiceSipWise] getDevicesListSipWise : Anomaly API getUserDevices not yet performed"),service.sipWiseRoutingObject.sipWiseDevicesList},service.getDevicesIdFromListSipWiseWithType=function(devicetype){if(service.sipWiseRoutingObject.sipWiseDevicesList.length<1)return $log.info("[telephonyServiceSipWise] getDevicesIdFromListSipWiseWithType : Anomaly API getUserDevices not yet performed"),null;if("sip"!==devicetype&&"webrtc"!==devicetype)return $log.info("[telephonyServiceSipWise] getDevicesIdFromListSipWiseWithType : Anomaly wrong device type"),null;var foundIndex=service.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(elt){return elt.type===devicetype}));return-1!==foundIndex?service.sipWiseRoutingObject.sipWiseDevicesList[foundIndex].deviceId:($log.info("[telephonyServiceSipWise] getDevicesIdFromListSipWiseWithType : device type "+devicetype+" not found"),null)},service.getCurrentFromDevicesListSipWise=function(){if(service.sipWiseRoutingObject.sipWiseDevicesList.length<1)return $log.info("[telephonyServiceSipWise] getCurrentFromDevicesListSipWise : Anomaly API getUserDevices not yet performed"),null;var foundIndex=service.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(elt){return elt.main}));return-1!==foundIndex&&"outOfService"!==service.sipWiseRoutingObject.sipWiseDevicesList[foundIndex].state?service.sipWiseRoutingObject.sipWiseDevicesList[foundIndex]:($log.info("[telephonyServiceSipWise] getCurrentFromDevicesListSipWise anomaly - no current/main device"),null)},service.setCurrentDevicesListSipWise=function(currentId){var deviceIndex=service.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(elt){return elt.deviceId===currentId}));return-1!==deviceIndex&&deviceIndex<service.sipWiseRoutingObject.sipWiseDevicesList.length?($log.info("[telephonyServiceSipWise] setCurrentDevicesListSipWise for device: "+service.sipWiseRoutingObject.sipWiseDevicesList[deviceIndex].deviceId+" / type : "+service.sipWiseRoutingObject.sipWiseDevicesList[deviceIndex].type),"outOfService"===service.sipWiseRoutingObject.sipWiseDevicesList[deviceIndex].state&&(new Error("Anomaly setCurrentDevicesListSipWise - current device outOfService"),$log.error("[telephonyServiceSipWise] setCurrentDevicesListSipWise anomaly - current device outOfService")),service.sipWiseRoutingObject.sipWiseDevicesList.forEach((function(elt){return elt.main=!1})),service.sipWiseRoutingObject.sipWiseDevicesList[deviceIndex].main=!0,!0):(new Error("Anomaly setCurrentDevicesListSipWise - current device not found"),$log.error("[telephonyServiceSipWise] setCurrentDevicesListSipWise anomaly - current device not found / for device "+current),!1)},service.setRingingDeviceSipWise=function(telService,addOfficePhone){var destinations=[],currentDevice=service.getCurrentFromDevicesListSipWise();if(!currentDevice)return $log.info("[telephonyServiceSipWise] setRingingDeviceSipWise : Anomaly no current device"),!1;if("webrtc"!==currentDevice.type)return $log.info("[telephonyServiceSipWise] setRingingDeviceSipWise : Anomaly not in computer mode"),!1;if(destinations.push(currentDevice.deviceId),addOfficePhone){var officePhoneDeviceId=service.getDevicesIdFromListSipWiseWithType("sip");if(!officePhoneDeviceId)return $log.info("[telephonyServiceSipWise] setRingingDeviceSipWise : Anomaly no officePhone"),!1;destinations.push(officePhoneDeviceId)}return service.putUserRoutingInfo(telService,null,destinations),!0},service.putUserRoutingInfo=function(telService,currentId,destinations){return $q((function(resolve,reject){if($log.info("[telephonyServiceSipWise] putUserRoutingInfo : currentId = "+currentId+" destinations = "+destinations),!currentId&&!destinations){var _error=new Error("set routing failure - missing para");return $log.error("[telephonyServiceSipWise] putUserRoutingInfo anomaly: missing para"),void reject(_error)}var reqData={};if(currentId){var foundIndex=service.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(elt){return elt.deviceId===currentId}));if(-1!==foundIndex){if($log.info("[telephonyServiceSipWise] putUserRoutingInfo found device with state : "+service.sipWiseRoutingObject.sipWiseDevicesList[foundIndex].state),"inService"!==service.sipWiseRoutingObject.sipWiseDevicesList[foundIndex].state){var error=new Error("Anomaly putUserRoutingInfo - current device outOfService");$log.error("[telephonyServiceSipWise] putUserRoutingInfo anomaly - current device outOfService"),reject(error)}reqData.currentDeviceId=currentId}else error=new Error("Anomaly putUserRoutingInfo - current device not found"),$log.error("[telephonyServiceSipWise] putUserRoutingInfo anomaly - current device not found"),reject(error)}destinations&&destinations.length>=1&&(reqData.destinations=destinations);var reqUrl=service.portalURL+"routing";$log.info("[telephonyServiceSipWise] putUserRoutingInfo PUT "+reqUrl),$log.info("[telephonyServiceSipWise] putUserRoutingInfo data: "+JSON.stringify(reqData)),$http({method:"PUT",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] putUserRoutingInfo success : "),currentId&&service.setCurrentDevicesListSipWise(currentId),service.patchNomadicData(telService),$rootScope.$broadcast("ON_SIPWISE_ROUTING_EVENT",service.getCurrentFromDevicesListSipWise().type,service.sipWiseRoutingObject),resolve()}),(function(response){var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"putUserRoutingInfo")),reject(error)}))}))},service.getUserRoutingInfo=function(telService){return $q((function(resolve,reject){if($log.info("[telephonyServiceSipWise] getUserRoutingInfo"),service.sipWiseRoutingObject.sipWiseDevicesList.length<1)return $log.info("[telephonyServiceSipWise] getUserRoutingInfo : sipWise devices not yet avalaible"),reject();var reqUrl=service.portalURL+"routing";$log.info("[telephonyServiceSipWise] routing GET "+reqUrl),$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var respData=response.data.data;$log.info("[telephonyServiceSipWise] getUserRoutingInfo success / status : "+response.statusText);var current=respData.currentDeviceId,destinations=respData.destinations;if(current){var foundIndex=service.sipWiseRoutingObject.sipWiseDevicesList.findIndex((function(elt){return elt.deviceId===current}));if(-1!==foundIndex)if("outOfService"===service.sipWiseRoutingObject.sipWiseDevicesList[foundIndex].state){var error=new Error("Anomaly getUserRoutingInfo - current device outOfService");$log.error("[telephonyServiceSipWise] getUserRoutingInfo anomaly - current device outOfService"),reject(error)}else $log.info("[telephonyServiceSipWise] getUserRoutingInfo current : "+current+" type = "+service.sipWiseRoutingObject.sipWiseDevicesList[foundIndex].type),service.setCurrentDevicesListSipWise(current)||reject(error);else error=new Error("Anomaly getUserRoutingInfo - current device not found"),$log.error("[telephonyServiceSipWise] getUserRoutingInfo anomaly - current not found"),reject(error)}else error=new Error("Anomaly getUserRoutingInfo - no current device"),$log.error("[telephonyServiceSipWise] getUserRoutingInfo anomaly - no current device"),reject(error);destinations?(service.sipWiseRoutingObject.ringingDestinations=destinations,$log.info("[telephonyServiceSipWise] getUserRoutingInfo  / ringing destinations nb  = "+destinations.length),service.sipWiseRoutingObject.alsoOfficePhoneRingEnabled=-1!==service.sipWiseRoutingObject.ringingDestinations.findIndex((function(elt){return"sip"===elt.type}))):(error=new Error("Anomaly getUserRoutingInfo - no destination"),$log.error("[telephonyServiceSipWise] getUserRoutingInfo anomaly - no destination "),reject(error)),service.patchNomadicData(telService),$rootScope.$broadcast("ON_SIPWISE_ROUTING_EVENT",service.getCurrentFromDevicesListSipWise().type,service.sipWiseRoutingObject),resolve()}),(function(response){var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"routing")),reject(error)}))}))},service.patchNomadicData=function(telService){var current=service.getCurrentFromDevicesListSipWise();if($log.info("[telephonyServiceSipWise] patchNomadicData current type =  "+current.type),current&&"webrtc"===current.type){var webrtcGatewayService=$injector.get("webrtcGatewayService");telService.nomadicObject.destination=webrtcGatewayService.getMyMediaPillarRemoteExtension(),webrtcGatewayService.isMediaPillarAvailable()?(telService.nomadicObject.featureActivated=!0,telService.nomadicObject.modeActivated=!0,telService.nomadicObject.makeCallInitiatorIsMain=!1):(telService.nomadicObject.featureActivated=!0,telService.nomadicObject.modeActivated=!1,telService.nomadicObject.makeCallInitiatorIsMain=!1)}else telService.nomadicObject={},telService.nomadicObject.destination="",telService.nomadicObject.featureActivated=!0,telService.nomadicObject.modeActivated=!1,telService.nomadicObject.makeCallInitiatorIsMain=!0;$log.info("[telephonyServiceSipWise] patchNomadicData nomadicObject (desti/modeAct/CallIsMain) = "+telService.nomadicObject.destination+"/"+telService.nomadicObject.modeActivated+"/"+telService.nomadicObject.makeCallInitiatorIsMain),$rootScope.$broadcast("ON_CALL_NOMADIC_EVENT",telService.nomadicObject)},service.getUserDevices=function(telService){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] getUserDevices");var reqUrl=service.portalURL+"devices";$log.info("[telephonyServiceSipWise] devices GET "+reqUrl),$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var respData=response.data;if($log.info("[telephonyServiceSipWise] getUserDevices success / status : "+response.statusText),respData.forEach((function(device){var sipDevice={type:device.type,id:device.id,deviceId:device.deviceId,jid_wrg:"",extension:"",state:"",main:!1};"webrtc"===device.type?(sipDevice.main=!1,sipDevice.jid_wrg=device.jid_wrg,service.sipWiseRoutingObject.sipWiseDevicesList.unshift(sipDevice)):service.sipWiseRoutingObject.sipWiseDevicesList.push(sipDevice),$log.info("[telephonyServiceSipWise] getUserDevices : deviceId = "+device.deviceId+" type = "+device.type)})),service.sipWiseRoutingObject.sipWiseDevicesList.length>=1)$log.info("[telephonyServiceSipWise] getUserDevices  : "+service.sipWiseRoutingObject.sipWiseDevicesList.length+" device(s)"),"webrtc"!==service.sipWiseRoutingObject.sipWiseDevicesList[0].type&&$log.error("[telephonyServiceSipWise] getUserDevices anomaly - no webrtc device"),resolve();else{var error=new Error("Anomaly getUserDevices - no device");$log.error("[telephonyServiceSipWise] getUserDevices anomaly - no device"),reject(error)}}),(function(response){var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"devices")),reject(error)}))}))},service.getUserGroups=function(telService){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] getUserGroups");var reqUrl=service.portalURL+"groups";$log.info("[telephonyServiceSipWise] groups GET "+reqUrl),$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var respData=response.data;$log.info("[telephonyServiceSipWise] getUserGroups success / status : "+response.statusText),telService.sipWiseUserGroupsDataClear(),respData.data.length>0&&respData.data.forEach((function(group){if(telService.sipWiseUserGroupsData.sipWiseUserGroupsList.push(group),"hunting_group"===group.type&&telService.sipWiseUserGroupsData.huntingGroupNb++,"manager_assistant"===group.type)if(telService.sipWiseUserGroupsData.managerAssistantNb++,1===telService.sipWiseUserGroupsData.managerAssistantNb){var onlyManager=group.members.find((function(elt){return"manager"===elt.roles[0]}));onlyManager?(telService.sipWiseUserGroupsData.managerAssistGrId=group.id,telService.sipWiseUserGroupsData.managerId=onlyManager.memberId,telService.sipWiseUserGroupsData.managerName=onlyManager.displayName,telService.sipWiseUserGroupsData.managerStatus=onlyManager.status):$log.info("[telephonyServiceSipWise] getUserGroups for groupId : "+group.id+" Anomaly not 1 only manager");var onlyAssistant=group.members.find((function(elt){return"assistant"===elt.roles[0]}));onlyAssistant?(telService.sipWiseUserGroupsData.assistantId=onlyAssistant.memberId,telService.sipWiseUserGroupsData.assistantName=onlyAssistant.displayName,telService.sipWiseUserGroupsData.assistantStatus=onlyAssistant.status):$log.info("[telephonyServiceSipWise] getUserGroups for groupId : "+group.id+" Anomaly not 1 only assistant")}else $log.info("[telephonyServiceSipWise] getUserGroups : Anomaly not a 1:1 mng/ass situation")})),telService.sipWiseUserGroupsData.sipWiseUserGroupsList.length>=1?$log.info("[telephonyServiceSipWise] getUserGroups  : "+telService.sipWiseUserGroupsData.sipWiseUserGroupsList.length+" user's group(s)"):$log.info("[telephonyServiceSipWise] getUserGroups  : no group"),resolve()}),(function(response){var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"groups")),reject(error)}))}))},service.setUserGroupsForwards=function(telService,groupId,callForwardType,forwardData){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] setUserGroupsForwards for groupId : "+groupId);var wrongParaMsg="";if(groupId?0===telService.sipWiseUserGroupsData.sipWiseUserGroupsList.length&&(wrongParaMsg="invalid groupId"):wrongParaMsg="missing groupId",""!==wrongParaMsg){var error=new Error("set group forward failure - "+wrongParaMsg);return $log.error("[telephonyServiceSipWise] set group forward anomaly:"+wrongParaMsg),void reject(error)}var reqUrl=service.portalURL+"groups/"+encodeURIComponent(groupId)+"/forwards/"+encodeURIComponent(callForwardType),reqData=forwardData;$log.info("[telephonyServiceSipWise] setUserGroupsForwards PUT "+reqUrl),$log.info("[telephonyServiceSipWise] setUserGroupsForwards data: "+JSON.stringify(reqData)),$http({method:"PUT",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] setUserGroupsForwards success / status : "+response.statusText),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"setUserGroupsForwards"))}))}))},service.getUserGroupsForwards=function(telService,groupId){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] getUserGroupsForwards for groupId : "+groupId);var wrongParaMsg="";if(groupId?0===telService.sipWiseUserGroupsData.sipWiseUserGroupsList.length&&(wrongParaMsg="invalid groupId"):wrongParaMsg="missing groupId",""!==wrongParaMsg){var error=new Error("get group forward failure - "+wrongParaMsg);return $log.error("[telephonyServiceSipWise] get group forward anomaly:"+wrongParaMsg),void reject(error)}var reqUrl=service.portalURL+"groups/"+encodeURIComponent(groupId)+"/forwards";$log.info("[telephonyServiceSipWise] getUserGroupsForwards GET "+reqUrl),$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var respData=response.data.data,group=telService.sipWiseUserGroupsData.sipWiseUserGroupsList.find((function(elt){return elt.id===groupId}));if(group.name!==respData.name){$log.info("[telephonyServiceSipWise] getUserGroupsForwards Anomaly group name : "+group.name+" VS "+respData.name);var error=errorHelperService.handleError(response);return reject(error),void $log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"getUserGroupsForwards"))}if(group.forwardData=respData,groupId===telService.sipWiseUserGroupsData.managerAssistGrId)if(telService.sipWiseUserGroupsData.managerAssistantNb>1)$log.info("[telephonyServiceSipWise] getUserGroupsForwards : Anomaly not a 1:1 mng/ass situation");else{var fwdActivate="unknow",mng=respData.members.find((function(elt){return elt.memberId===telService.sipWiseUserGroupsData.managerId}));if(mng&&mng.displayName===telService.sipWiseUserGroupsData.managerName){var fwd=mng.forwards.find((function(elt){return"immediate"===elt.type}));fwdActivate=fwd&&fwd.activate&&"managersecretary"===fwd.destinationType?"activated":"unactivated"}else $log.info("[telephonyServiceSipWise] getUserGroupsForwards : Anomaly manager forward status");telService.sipWiseUserGroupsData.managerForward=fwdActivate}$log.info("[telephonyServiceSipWise] getUserGroupsForwards success / status : "+response.statusText),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"getUserGroupsForwards"))}))}))},service.getAllUserGroupsForwards=function(telService){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] getAllUserGroupsForwards");var getGroupPromises=[];return 0===telService.sipWiseUserGroupsData.sipWiseUserGroupsList.length?($log.info("[telephonyServiceSipWise] getAllUserGroupsForwards / no group"),resolve()):(telService.sipWiseUserGroupsData.sipWiseUserGroupsList.forEach((function(group){"manager_assistant"===group.type&&getGroupPromises.push(service.getUserGroupsForwards(telService,group.id))})),0===getGroupPromises.length?($log.info("[telephonyServiceSipWise] getAllUserGroupsForwards / no manager assistant group"),resolve()):$q.all(getGroupPromises).then((function(){$log.info("[telephonyServiceSipWise] getAllUserGroupsForwards -- group forward completed -- "+getGroupPromises.length+" group(s) forward updated"),resolve()})).catch((function(error){$log.error("[telephonyServiceSipWise] getAllUserGroupsForwards -- group forward failure -- "+error.message),reject(error)})))}))},service.getSnapshot=function(call,deviceId,seqNum){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] getSnapshot");var tabQueryParam=[];call&&($log.info("[telephonyServiceSipWise] snapshot with callId "+call.id),tabQueryParam.push("callId="+call.id)),deviceId&&($log.info("[telephonyServiceSipWise] snapshot with deviceId "+deviceId),tabQueryParam.push("deviceId="+deviceId)),seqNum&&($log.info("[telephonyServiceSipWise] snapshot with seqNum "+seqNum),tabQueryParam.push("seqNum="+seqNum));var queryParam="";tabQueryParam.length>=1&&(queryParam="?"+tabQueryParam.join("&"));var reqUrl=service.portalURL+"snapshot"+queryParam;$log.info("[telephonyServiceSipWise] snapshot GET "+reqUrl),$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var respData=response.data.data;$log.info("[telephonyServiceSipWise] getSnapshot success / status : "+response.statusText),resolve(respData)}),(function(response){var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"snapshot")),reject(error)}))}))},service.processSnapshot=function(telService){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] processSnapshot");var nbRingingIn=0;service.getSnapshot().then((function(respData){try{respData&&respData.devices?respData.devices.forEach((function(snapDevice){service.sipWiseRoutingObject.sipWiseDevicesList.find((function(device){return device.deviceId===snapDevice.deviceId})).state=snapDevice.state,$log.info("[telephonyServiceSipWise] processSnapshot / devicesId="+snapDevice.deviceId+"; state="+snapDevice.state),service.sipWiseRoutingObject.sipWiseDevicesList.find((function(device){return device.deviceId===snapDevice.deviceId})).state="inService"})):$log.error("[telephonyServiceSipWise] processSnapshot / anomaly no device ");var getCallPromises=[];return respData&&respData.calls?respData.calls.length>5?($log.error("[telephonyServiceSipWise] processSnapshot / anomaly to much calls : "+respData.calls.length),resolve()):(respData.calls.forEach((function(snapCall){"ringingIn"===snapCall.legs[0].state&&++nbRingingIn>=4&&$log.info("[telephonyServiceSipWise] processSnapshot / anomaly to much ringingIn calls : "+nbRingingIn),nbRingingIn<4&&getCallPromises.push(service.createCallFromSnapShotCallsElt(telService,snapCall))})),0===getCallPromises.length?($log.info("[telephonyServiceSipWise] processSnapshot / anomaly no call created"),resolve()):$q.all(getCallPromises).then((function(){$log.info("[telephonyServiceSipWise] processSnapshot -- calls creation completed -- "+getCallPromises.length+" calls created"),resolve()})).catch((function(error){$log.error("[telephonyServiceSipWise] processSnapshot -- calls creation failure -- "+error.message),reject(error)}))):($log.info("[telephonyServiceSipWise] processSnapshot / no call elt"),resolve())}catch(error){var errorMessage=" processSnapshot -- "+error.message;reject(new Error(errorMessage))}}),(function(error){$log.info("[telephonyServiceSipWise] processSnapshot / getSnapshot error : "+error),reject(error)}))}))},service.createCallFromSnapShotCallsElt=function(telService,snapShotCallsElt){return $q((function(resolve,reject){var call=null;$log.info("[telephonyServiceSipWise] createCallFromSnapShotCallsElt - callId = "+snapShotCallsElt.callId);var legId,deviceId,state,endPoint,phoneNumber,jid,leg=null,displayName=null;if(!snapShotCallsElt.legs)return errorMessage="createCallFromSnapShotCallsElt -- Anomaly no leg",$log.error("[telephonyServiceSipWise] "+errorMessage),$q.when();var myMainDevice=service.getCurrentFromDevicesListSipWise();if(null===myMainDevice){var errorMessage="createCallFromSnapShotCallsElt -- Anomaly no current device";$log.error("[telephonyServiceSipWise] "+errorMessage),leg=snapShotCallsElt.legs[0]}else(leg=snapShotCallsElt.legs.find((function(elt){return elt.deviceId===myMainDevice.id})))||(leg=snapShotCallsElt.legs[0]);return legId=leg.legId?leg.legId:null,deviceId=leg.deviceId?leg.deviceId:null,state=telService.telephonyEventHandler.convLegStateToCallStatus(leg.state),$log.info("[telephonyServiceSipWise] createCallFromSnapShotCallsElt - legId = "+legId+" deviceId = "+deviceId+" leg_state = "+leg.state),snapShotCallsElt.endpoints?((endPoint=snapShotCallsElt.endpoints[0]).endpointId,phoneNumber=endPoint.phoneNumber,jid=endPoint.jid,displayName=endPoint.displayName,jid||phoneNumber?void _src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.getOrCreateContact(jid,phoneNumber).then((function(contact){jid||contact.displayName||(contact.displayName=displayName,contact.initials=displayName.charAt(0),contact.getAvatar()),(call=telService.getOrCreateCallSipWise(state,snapShotCallsElt.callId,legId,deviceId,contact)).relevantEquipmentId=deviceId,call.isSecondary=!1,$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve(call)})):(errorMessage="createCallFromSnapShotCallsElt -- Anomaly no jid no phoneNumber",$log.error("[telephonyServiceSipWise] "+errorMessage),$q.when())):($log.info("[telephonyServiceSipWise] createCallFromSnapShotCallsElt -- No endPoint provided !"),void resolve())}))},service.makeSimpleCallSipWise=function(telService,contact,phoneNumber){return $q((function(resolve,reject){if($log.info("[telephonyServiceSipWise] makeSimpleCall to "+(contact?contact.nameForLogs:_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_2___default()(phoneNumber))),!telService.isBasicCallAllowed){var profileError=new Error("makeSimpleCallSipWise failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyServiceSipWise] "+profileError.message),telService.makingCall=!1,void reject(profileError)}var phoneInfo=telService.getPhoneInfo(contact,phoneNumber),currentDeviceId=service.getCurrentFromDevicesListSipWise();if(currentDeviceId)var deviceId=currentDeviceId.deviceId;else deviceId="";if((telService.sipWiseEmergencyCallData.WGEmergencyCallForbidden&&currentDeviceId&&"webrtc"===currentDeviceId.type||"testemergency"===telService.sipWiseMode())&&service.checkEmergencyNumberSipWise(telService,phoneNumber))return $log.info("[telephonyServiceSipWise] makeVOIPSipemergencyCall - Not Allowed for num : "+phoneNumber),telService.rxSubject.next({name:"ON_EMERGENCYCALL_VOIPSIP_NOTALLOWED_EVENT",data:phoneNumber}),telService.makingCall=!1,void reject();if(telService.getActiveCall()&&currentDeviceId&&"webrtc"===currentDeviceId.type&&"demo"!==telService.sipWiseMode())return $log.info("[telephonyServiceSipWise] makeSecondVOIPSipCall - Not Allowed"),telService.makingCall=!1,$rootScope.$broadcast("ON_CALL_NOTALLOWED_EVENT","webCallAlreadyProgress"),void reject("webCallAlreadyProgress");var reqUrl=service.portalURL+"calls",reqData={deviceId:deviceId,calleeExtNumber:phoneInfo.longNumber,calleeShortNumber:phoneInfo.shortNumber,calleePbxId:phoneInfo.pbxId,callerAutoAnswer:!0};$log.info("[telephonyServiceSipWise] makeSimpleCall POST "+reqUrl),$log.info("[telephonyServiceSipWise] makeSimpleCall data: "+JSON.stringify(reqData)),$http({method:"POST",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){var respCallId=response.data.data.callId;if($log.info("[telephonyServiceSipWise] makeSimpleCall success : callee "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_2___default()(phoneNumber)+" / callId = "+respCallId),!respCallId||""===respCallId){var call;(call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.create(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ERROR,null,_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Type.PHONE,contact)).errorMessage="unexpectedError",telService.calls[call.contact.id]=call,call.autoClear=$interval((function(){telService.clearCall(call)}),5e3,1),telService.makingCall=!1,$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call);var error=errorHelperService.handleError(response);return $log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"makeCall")),void reject(error)}(call=telService.getOrCreateCallSipWise(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.DIALING,respCallId,null,null,contact)).setRelevantEquipmentId(call.getDeviceIdSipWise()),call.isOwner=!0,$log.info("[telephonyServiceSipWise] makeSimpleCall Call created ("+call+")"),telService.makingCall=!1,call.setIsVm(phoneNumber===telService.voicemailNumber),call.autoClear=$interval((function(){$log.info("[telephonyServiceSipWise] keepAlive CallReset ("+call+")"),telService.clearCall(call)}),1e4,1),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve(call.id)}),(function(response){var call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.create(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ERROR,null,_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Type.PHONE,contact);call.errorMessage=response&&"403"===response.errorDetailsCode?"notAllowed":"invalidPhoneNumber",telService.calls[call.contact.id]=call,call.autoClear=$interval((function(){telService.clearCall(call)}),5e3,1),telService.makingCall=!1,call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call);var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"makeCall")),reject(error)}))}))},service.getPhoneInfoSipWise=function(contact,phoneNumber){var longNumber=phoneNumber,shortNumber="",internalNumber="";return contact&&(phoneNumber===contact.phonePro||phoneNumber===contact.phoneProCan?(longNumber=contact.phoneProCan?contact.phoneProCan:"",shortNumber=contact.phonePbx,internalNumber=contact.phoneInternalNumber):phoneNumber===contact.phonePbx&&(longNumber="",shortNumber=contact.phonePbx,internalNumber=contact.phoneInternalNumber)),{number:""!==longNumber?longNumber:shortNumber||internalNumber}},service.getErrorMessage=function(data,actionLabel){return null},service.releaseCallSipWise=function(telService,call){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] releaseCallSipWise "+call.id);var reqUrl=service.portalURL+"calls/"+encodeURIComponent(call.id),reqData={legId:call.connectionId?call.connectionId:""};$log.info("[telephonyServiceSipWise] releaseCall DELETE "+reqUrl),$log.info("[telephonyServiceSipWise] releaseCall data: "+JSON.stringify(reqData)),$http({method:"DELETE",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(){call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN),call.startDate=null,call.vm=!1,$log.info("[telephonyServiceSipWise] releaseCall "+call.id+" - success"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),delete telService.calls[call.id],resolve(call)}),(function(response){var error=errorHelperService.handleError(response);service.deleteCallIfInvalid(error,call,telService),reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"releaseCall"))}))}))},service.deleteCallIfInvalid=function(error,call,telService){error&&"voice"===error.portal&&404201===error.errorDetailsCode&&"Specified leg not found"===error.message&&call&&($log.warn("[telephonyServiceSipWise] deleteCallIfInvalid: delete client call non existing on server: "+call.id),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),telService.calls[call.id]&&delete telService.calls[call.id])},service.answerCallSipWise=function(telService,call){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] answerCall : "+call.id);var reqUrl=service.portalURL+"calls/"+encodeURIComponent(call.id)+"/answer",reqData={legId:call.connectionId};$log.info("[telephonyServiceSipWise] answerCallSipWise POST "+reqUrl),$log.info("[telephonyServiceSipWise] answerCallSipWise data: "+JSON.stringify(reqData)),$http({method:"POST",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),$log.info("[telephonyServiceSipWise] answerCall success : "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_2___default()(call.contact.phone)+" Call ("+call+")"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve(call)}),(function(response){$log.info("[telephonyServiceSipWise] answerCall fail : error = "+response.data.errorCode+" msg = "+response.data.errorMsg+" details = "+response.data.errorDetails),response.data&&"Device is not able to answer a call"===response.data.errorDetails&&$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{autoClose:!1,okLabel:"close",popupTitle:"warning",popupBody:"deviceDoesntAllowAnswer"}),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN);var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"answerCall")),reject(error)}))}))},service.holdCallSipWise=function(telService,call){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] holdCallSipWise : "+call.id);var reqUrl=service.portalURL+"calls/"+encodeURIComponent(call.id)+"/hold",reqData={legId:call.connectionId};$log.info("[telephonyServiceSipWise] holdCallSipWise POST "+reqUrl),$log.info("[telephonyServiceSipWise] holdCallSipWise data: "+JSON.stringify(reqData)),$http({method:"POST",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] holdCall success : "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_2___default()(call.contact.phone)+" Call ("+call+")"),resolve(call)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"holdCall"))}))}))},service.retrieveCallSipWise=function(telService,call){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] retrieveCallSipWise : "+call.id);var reqUrl=service.portalURL+"calls/"+encodeURIComponent(call.id)+"/retrieve",reqData={legId:call.connectionId};$log.info("[telephonyServiceSipWise] retrieveCallSipWise POST "+reqUrl),$log.info("[telephonyServiceSipWise] retrieveCallSipWise data: "+JSON.stringify(reqData)),$http({method:"POST",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] retrieveCall success : "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_2___default()(call.contact.phone)+" Call ("+call+")"),resolve(call)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"retrieveCall"))}))}))},service.deflectCallSipWise=function(telService,call,destination){return $q((function(resolve,reject){if($log.info("[telephonyServiceSipWise] deflectCallSipWise : "+call.id+" to destination : "+destination),!destination){var error=new Error("deflect failure - no destination");return $log.error("[telephonyServiceSipWise] deflect anomaly: no destination"),void reject(error)}var reqUrl=service.portalURL+"calls/"+encodeURIComponent(call.id)+"/deflect",reqData={destination:destination};$log.info("[telephonyServiceSipWise] deflectCallSipWise POST "+reqUrl),$log.info("[telephonyServiceSipWise] deflectCallSipWise data: "+JSON.stringify(reqData)),$http({method:"POST",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] deflectCallSipWise success :  Call ("+call+")"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"deflectCall"))}))}))},service.transfertCallSipWise=function(telService,activeCall,heldCall){return $q((function(resolve,reject){if($log.info("[telephonyServiceSipWise] transfertCallSipWise : activeCall : "+activeCall.id+" heldCall : "+heldCall.id),!activeCall||!heldCall){var error=new Error("transfer failure - missing activeCall or heldCall");return $log.error("[telephonyServiceSipWise] transfer anomaly: missing calls ref"),void reject(error)}var reqUrl=service.portalURL+"calls/"+encodeURIComponent(activeCall.id)+"/transfer",reqData={heldCallId:heldCall.id};$log.info("[telephonyServiceSipWise] transfertCallSipWise POST "+reqUrl),$log.info("[telephonyServiceSipWise] transfertCallSipWise data: "+JSON.stringify(reqData)),$http({method:"POST",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] transfertCallSipWise success : "+activeCall.id+"->"+heldCall.id),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"transfer"))}))}))},service.blindTransfertCallSipWise=function(telService,activeCall,calleeNumber){return $q((function(resolve,reject){if($log.info("[telephonyServiceSipWise] blindTransfertCallSipWise : activeCall : "+activeCall.id),!activeCall||!calleeNumber){var error=new Error("blind transfer failure - missing activeCall or callee number");return $log.error("[telephonyServiceSipWise] blind transfer anomaly: missing calls ref or callee number"),void reject(error)}var reqUrl=service.portalURL+"calls/"+encodeURIComponent(activeCall.id)+"/blind-transfer",reqData={destination:calleeNumber};$log.info("[telephonyServiceSipWise] blindTransfertCallSipWise POST "+reqUrl),$log.info("[telephonyServiceSipWise] blindTransfertCallSipWise data: "+JSON.stringify(reqData)),$http({method:"POST",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] blind transfertCallSipWise success :  Call ("+call+")"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"blind-transfer"))}))}))},service.forwardToDeviceSipWise=function(telService,phoneNumber,destType,forwardType){return $q((function(resolve,reject){if($log.info("[telephonyServiceSipWise] forwardToDeviceSipWise : phoneNumber = "+phoneNumber+" / destType = "+destType+" / fwtype = "+forwardType),!phoneNumber){var error=new Error("forward failure - missing phoneNumber");return $log.error("[telephonyServiceSipWise] forward anomaly: missing phoneNumber"),void reject(error)}var reqUrl=service.portalURL+"forwards/"+encodeURIComponent(forwardType),reqData={number:phoneNumber,destinationType:destType,activate:!0};$log.info("[telephonyServiceSipWise] forwardToDeviceSipWise PUT "+reqUrl),$log.info("[telephonyServiceSipWise] forwardToDeviceSipWise data: "+JSON.stringify(reqData)),$http({method:"PUT",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] forwardToDeviceSipWise success : "),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"forwardToDeviceSipWise"))}))}))},service.cancelForwardSipWise=function(telService,forwardType){return $q((function(resolve,reject){if($log.info("[telephonyServiceSipWise] cancelForwardSipWise :  fwtype = "+forwardType),!forwardType||"immediate"!==forwardType&&"busy"!==forwardType&&"noreply"!==forwardType){var error=new Error("cancel forward failure - wrong forwardType");return $log.error("[telephonyServiceSipWise] cancel forward anomaly: wrong forwardType"),void reject(error)}var reqUrl=service.portalURL+"forwards/"+encodeURIComponent(forwardType),reqData={activate:!1};$log.info("[telephonyServiceSipWise] cancelForwardSipWise PUT "+reqUrl),$log.info("[telephonyServiceSipWise] cancelForwardSipWise data: "+JSON.stringify(reqData)),$http({method:"PUT",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] forwardToDeviceSipWise success : "),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"forwardToDeviceSipWise"))}))}))},service.getForwardStatusSipWise=function(telService){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] getForwardStatusSipWise");var reqUrl=service.portalURL+"forwards";$log.info("[telephonyServiceSipWise] getForwardStatusSipWise GET "+reqUrl),$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){if(response.data&&"Call Forwards successfully found"===response.data.status&&response.data.data){$log.info("[telephonyServiceSipWise] getForwardStatusSipWise success");var dataResponse=response.data.data,forwardObjectAdapter=service.convForwardObject(dataResponse);return $log.info("[telephonyServiceSipWise] getForwardStatusSipWise immediat fwdtype = "+forwardObjectAdapter.immediate.forwardType+" immediat forwardTo = "+forwardObjectAdapter.immediate.forwardTo),forwardObjectAdapter.busy&&$log.info("[telephonyServiceSipWise] getForwardStatusSipWise busy activate = "+forwardObjectAdapter.busy.activate),forwardObjectAdapter.noreply&&$log.info("[telephonyServiceSipWise] getForwardStatusSipWise noreply activate = "+forwardObjectAdapter.noreply.activate),$rootScope.$broadcast("ON_CALL_FORWARDED_EVENT",{forwardType:forwardObjectAdapter.immediate.forwardType,forwardTo:forwardObjectAdapter.immediate.forwardTo}),telService.forwardObject.forwardType=forwardObjectAdapter.immediate.forwardType,telService.forwardObject.forwardTo=forwardObjectAdapter.immediate.forwardTo,(forwardObjectAdapter.busy||forwardObjectAdapter.noreply)&&($rootScope.$broadcast("ON_CALL_FORWARDED_CONDI_EVENT",{busy:forwardObjectAdapter.busy,noreply:forwardObjectAdapter.noreply}),telService.forwardObject.busy=forwardObjectAdapter.busy,telService.forwardObject.noreply=forwardObjectAdapter.noreply),void resolve()}var error=new Error("getForwardStatus failure - invalide response");return $log.error("[telephonyServiceSipWise] getForwardStatus anomaly: invalide response"),void reject(error)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"getForwardStatusSipWise"))}))}))},service.convForwardObject=function(sipWiseForwardData){var forwardAdapter={immediate:{forwardType:"Desactivation",forwardTo:""},busy:{},noreply:{},manAssist:{}};return sipWiseForwardData.forEach((function(forward){"immediate"===forward.type?(forward.activate&&("voicemail"===forward.destinationType?(forwardAdapter.immediate.forwardType="Activation",forwardAdapter.immediate.forwardTo="VOICEMAILBOX"):""!==forward.number&&(forwardAdapter.immediate.forwardType="Activation",forwardAdapter.immediate.forwardTo=forward.number)),"managersecretary"===forward.destinationType&&(forwardAdapter.immediate.forwardType=forward.activate,forwardAdapter.immediate.forwardTo="MANAGERASSISTANT",forwardAdapter.manAssist=forward)):"busy"===forward.type?forwardAdapter.busy=forward:"noreply"===forward.type&&(forwardAdapter.noreply=forward)})),forwardAdapter},service.getOverFlowStatusSipWise=function(systemId,phoneNumberId){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] getOverFlowStatusSipWise : systemId = "+systemId+" / phoneNumberId = "+phoneNumberId);var reqUrl=service.portalAdminURL+"cloudpbxs/"+encodeURIComponent(systemId)+"/subscribers/"+encodeURIComponent(phoneNumberId)+"/overflow/status";$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var respData=response.data.data;$log.info("[telephonyServiceSipWise] getOverFlowStatusSipWise activated: "+respData.activate),resolve(respData)}),(function(response){var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"getOverFlowStatus")),reject(error)}))}))},service.sendDtmfSipWise=function(telService,call,dtmf){return $q((function(resolve,reject){$log.info("[telephonyServiceSipWise] sendDtmfSipWise for callId : "+call.id+" dtmf : "+dtmf);var reqUrl=service.portalURL+"calls/"+encodeURIComponent(call.id)+"/sendDtmf",reqData={legId:call.connectionId,digits:dtmf};$log.info("[telephonyServiceSipWise] sendDtmfSipWise POST "+reqUrl),$log.info("[telephonyServiceSipWise] sendDtmfSipWise data: "+JSON.stringify(reqData)),$http({method:"POST",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyServiceSipWise] sendDtmfSipWise success :  Call ("+call+")"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"sendDtmf"))}))}))},service.checkEmergencyNumberSipWise=function(telService,phoneNumber){var result=!1,emergencyData=telService.sipWiseEmergencyCallData;return emergencyData.emergencyNuList.length>0&&emergencyData.emergencyNuList.find((function(elt){return elt===phoneNumber}))&&(result=!0),result},service.getEmergencyCallDataSipWise=function(telService){return $q((function(resolve,reject){var reqUrl=service.portalURL+"emergency-numbers";$log.info("[telephonyServiceSipWise] getEmergencyCallDataSipWise GET "+reqUrl),$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var respData=response.data.data;$log.info("[telephonyServiceSipWise] getEmergencyCallDataSipWise success / status : "+response.statusText),$log.info("[telephonyServiceSipWise] getEmergencyCallDataSipWise success / callAuthorizationWithSoftPhone  : "+respData.emergencyOptions.callAuthorizationWithSoftPhone),$log.info("[telephonyServiceSipWise] getEmergencyCallDataSipWise success / nb of emergency Nu : "+respData.emergencyNumbers.length),telService.sipWiseEmergencyCallDataClear(),telService.sipWiseEmergencyCallData.WGEmergencyCallForbidden=!respData.emergencyOptions.callAuthorizationWithSoftPhone,telService.sipWiseEmergencyCallData.serverData=respData.emergencyNumbers,respData.emergencyNumbers&&respData.emergencyNumbers.length>0&&respData.emergencyNumbers.forEach((function(emergNumbers){telService.sipWiseEmergencyCallData.emergencyNuList.push(emergNumbers.number)})),"testemergency"===telService.sipWiseMode()&&(telService.sipWiseEmergencyCallData.WGEmergencyCallForbidden=!0,telService.sipWiseEmergencyCallData.emergencyNuList.push("3669")),resolve()}),(function(response){var error=errorHelperService.handleError(response);$log.error("[telephonyServiceSipWise] "+errorHelperService.getErrorFullMessage(response,"getEmergencyCallDataSipWise")),reject(error)}))}))}}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_models_call_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_src_utils_promiseQueue__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(49),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2__);angular.module("rainbow").factory("TelephonyServiceEventHandlerSipWise",["$log","$q","$rootScope","$interval",function($log,$q,$rootScope,$interval){function TelephonyServiceEventHandlerSipWise(telephonyService){this.telephonyService=telephonyService,this.promiseQueue=_src_utils_promiseQueue__WEBPACK_IMPORTED_MODULE_1__.PromiseQueue.create()}return TelephonyServiceEventHandlerSipWise.create=function(telephonyService){return new TelephonyServiceEventHandlerSipWise(telephonyService)},TelephonyServiceEventHandlerSipWise.CallFailureLabels={invalidNumberFormat:"invalidPhoneNumber",destOutOfOrder:"outOfService",destNotObtainable:"outOfService",doNotDisturb:"dnd",busy:"busy",incompatibleDestination:"invalidPhoneNumber"},TelephonyServiceEventHandlerSipWise.prototype.onCallserviceMessageReceived=function(stanza){try{var that=this,actionElem=$(stanza).find("telephony"),forwardUpdatedElem=actionElem.find("forwardUpdated");if(forwardUpdatedElem&&0!==forwardUpdatedElem.length)return that.onforwardUpdatedMsg(forwardUpdatedElem);var eventElem=actionElem.find("event"),seqNum=eventElem.attr("seqNum");if(!seqNum)return $log.info("[TelephonyServiceEventHandlerSipWise] onCallserviceMessageReceived -- no telephony event received then msg ignored"),!0;var ts=eventElem.attr("ts"),cause=eventElem.attr("cause");return $log.info("[TelephonyServiceEventHandlerSipWise] onCallserviceMessageReceived -- telephony event received and queued: seqNum = "+seqNum+" cause = "+cause+" ts = "+ts),this.promiseQueue.add((function(){return that.onTelephonyEvent(eventElem,seqNum)})),!0}catch(error){return $log.error("[TelephonyServiceEventHandlerSipWise] onCallserviceMessageReceived -- failure -- "+error.message),!0}},TelephonyServiceEventHandlerSipWise.prototype.onOverflowUpdateMessageReceived=function(stanza){try{var overflowUpdated=$(stanza).find("overflowOnSubscriberUpdated").find("overflowUpdated");return!overflowUpdated||0===overflowUpdated.length||this.overflowUpdatedMsg(overflowUpdated)}catch(error){return $log.error("[TelephonyServiceEventHandlerSipWise] onOverflowUpdateMessageReceived -- failure -- "+error.message),!0}},TelephonyServiceEventHandlerSipWise.prototype.onUserConfigurationMessageReceived=function(stanza){try{var routingElt=$(stanza).find("routing");return!routingElt||0===routingElt.length||this.onRoutingUpdatedMsg(routingElt)}catch(error){return $log.error("[TelephonyServiceEventHandlerSipWise] onUserConfigurationMessageReceived -- failure -- "+error.message),!0}},TelephonyServiceEventHandlerSipWise.prototype.onforwardUpdatedMsg=function(forwardUpdatedElem){$log.info("[TelephonyServiceEventHandlerSipWise] onforwardUpdatedMsg : msg forwardUpdated received");var forwardItem=forwardUpdatedElem.attr("forwardItem");if("user"===forwardItem&&this.telephonyService.getForwardStatus(),"group"===forwardItem){var groupId=forwardUpdatedElem.attr("forwardItemId");groupId?(this.telephonyService.getSipWiseUserGroupsForwards(groupId),"manager"===this.telephonyService.sipWiseManAssistGetMyRole()&&this.telephonyService.getForwardStatus()):this.telephonyService.getSipWiseUserGroups()}return!0},TelephonyServiceEventHandlerSipWise.prototype.onRoutingUpdatedMsg=function(routingElem){$log.info("[TelephonyServiceEventHandlerSipWise] onRoutingUpdatedMsg : msg routing update received");var routingUpdatedElt=routingElem.find("routingUpdated"),currentDeviceId=routingUpdatedElt.find("currentDeviceId").text(),destinationElem=routingUpdatedElt.find("destinations"),destinations=[],ringObj=this.telephonyService.telephonyServiceSipWise.sipWiseRoutingObject;return currentDeviceId&&destinationElem?(ringObj.alsoOfficePhoneRingEnabled=!1,destinationElem.find("destination").each((function(){var destinationElemIter=angular.element(this),type=destinationElemIter.attr("type"),deviceId=destinationElemIter.attr("deviceId");$log.info("[TelephonyServiceEventHandlerSipWise] onRoutingUpdatedMsg ITER desti / type = "+type+" deviceId = "+deviceId),destinations.push({deviceId:deviceId,type:type}),"sip"===type&&(ringObj.alsoOfficePhoneRingEnabled=!0)})),currentDeviceId&&this.telephonyService.telephonyServiceSipWise.setCurrentDevicesListSipWise(currentDeviceId),destinations&&($log.info("[telephonyServiceSipWise] onRoutingUpdatedMsg  / ringing destinations nb  = "+destinations.length),ringObj.ringingDestinations=destinations,$rootScope.$broadcast("ON_SIPWISE_ROUTING_EVENT",this.telephonyService.telephonyServiceSipWise.getCurrentFromDevicesListSipWise().type,ringObj)),!0):($log.info("[TelephonyServiceEventHandlerSipWise] onRoutingUpdatedMsg Anomaly: no current/destination elts"),!1)},TelephonyServiceEventHandlerSipWise.prototype.overflowUpdatedMsg=function(overflowUpdated){return $log.info("[TelephonyServiceEventHandlerSipWise] overflowUpdatedMsg received"),this.telephonyService.getForwardStatus(),!0},TelephonyServiceEventHandlerSipWise.prototype.onTelephonyEvent=function(eventElem,seqNum){$log.info("[TelephonyServiceEventHandlerSipWise] onTelephonyEvent for seqNum = "+seqNum);var that=this,callsToUpdate=[];return $q((function(resolve,reject){that.manageAllCalls(eventElem,seqNum,callsToUpdate).then((function(){return that.manageAllLegs(eventElem,seqNum,callsToUpdate)})).then((function(){return that.manageAllEndPoints(eventElem,seqNum,callsToUpdate)})).catch((function(error){$log.info("[TelephonyServiceEventHandlerSipWise] onTelephonyEvent CATCH / seqNum = "+seqNum);var errorMessage="onTelephonyEvent -- "+error.message;$log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage)})).finally((function(){$log.info("[TelephonyServiceEventHandlerSipWise] onTelephonyEvent FINALLY / seqNum = "+seqNum),that.CallsUpdate(callsToUpdate),resolve()}))}))},TelephonyServiceEventHandlerSipWise.prototype.manageAllCalls=function(eventElem,seqNum,callsToUpdate){var that=this,callPromises=[],liveCalls=0;return eventElem.find("call").each((function(){var callElemIter=angular.element(this),callId=callElemIter.attr("callId"),op=callElemIter.attr("op");$log.info("[TelephonyServiceEventHandlerSipWise] manageAllCalls ITER callId = "+callId+" op = "+op+" / seqNum = "+seqNum),"ended"!==op&&liveCalls++,callPromises.push($q((function(resolve,reject){that.manageCallElem(callElemIter,eventElem,seqNum,callsToUpdate).then((function(){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllCalls done for callId = "+callId+" / seqNum = "+seqNum)})).catch((function(error){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllCalls CATCH / seqNum = "+seqNum);var errorMessage="manageAllCalls -- "+error.message;$log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage)})).finally((function(){resolve()}))})))})),$q.all(callPromises).finally((function(){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllCalls : nb living calls = "+liveCalls+" / seqNum = "+seqNum)}))},TelephonyServiceEventHandlerSipWise.prototype.manageCallElem=function(callElem,eventElem,seqNum,callsToUpdate){var that=this;return callElem.length?$q((function(resolve,reject){try{var callId=callElem.attr("callId"),oldCallId=callElem.attr("oldCallId"),op=(callElem.attr("newCallId"),callElem.attr("op"));if(!callId){var errorMessage="manageCallElem -- Anomaly callId missing / seqNum = "+seqNum;$log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage),reject(errorMessage)}switch(op||(errorMessage="manageCallElem -- Anomaly op missing / seqNum = "+seqNum,$log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage),reject(errorMessage)),$log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem callId = "+callId+" op = "+op+" / seqNum = "+seqNum),oldCallId&&((call=that.telephonyService.calls[oldCallId])?($log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : oldcallId = "+oldCallId+" ended  / seqNum = "+seqNum),that.telephonyService.clearCall(call,!0),callsToUpdate[callId]={trigger:!0,info:"callended"}):$log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : oldCallId "+oldCallId+" ended, no call found")),op){case"created":if($log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / call creation / seqNum = "+seqNum),call=that.telephonyService.createCallSipWise(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN,callId)){var cause=eventElem.attr("cause");cause&&call.setInitCauseSipWiseData(cause);var direction=callElem.find("direction").text();direction&&call.setDirectionSipWiseData(direction);var calledElem=callElem.find("called");(called={}).phoneNumber=calledElem.find("phoneNumber").text(),called.displayName=calledElem.find("displayName").text(),call.setCalledSipWiseData(called)}callsToUpdate[callId]={trigger:!1,info:"call"+op},resolve();break;case"updated":var called;$log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / call update / seqNum = "+seqNum),calledElem=callElem.find("called"),(called={}).phoneNumber=calledElem.find("phoneNumber").text(),called.displayName=calledElem.find("displayName").text();var call=that.getCallFromCallId(callId);_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call&&call.setCalledSipWiseData(called),that.checkCallRelevancy(callId)?callsToUpdate[callId]={trigger:!0,info:"call"+op}:$log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : on callId "+callId+" updated, not relevant"),resolve();break;case"ended":$log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / call end / seqNum = "+seqNum),call=that.telephonyService.calls[callId],that.checkCallRelevancy(callId)?($log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : callId = "+callId+" ended  / seqNum = "+seqNum),that.telephonyService.clearCall(that.getCallFromCallId(callId),!0),callsToUpdate[callId]={trigger:!0,info:"call"+op}):$log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem : on callId "+callId+" ended, not relevant"),resolve();break;default:$log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / invalid op -> "+op+" / seqNum = "+seqNum),reject()}}catch(error){errorMessage="manageCallElem -- "+error.message,reject(new Error(errorMessage))}})):($log.info("[TelephonyServiceEventHandlerSipWise] manageCallElem / no CallElem"),$q.resolve())},TelephonyServiceEventHandlerSipWise.prototype.manageAllLegs=function(eventElem,seqNum,callsToUpdate){var that=this,legPromises=[],liveLegs=0;return eventElem.find("leg").each((function(){var legElemIter=angular.element(this),legId=legElemIter.attr("legId"),op=legElemIter.attr("op");$log.info("[TelephonyServiceEventHandlerSipWise] manageAllLegs ITER legId = "+legId+" op = "+op+" / seqNum = "+seqNum),legElemIter.length&&("ended"!==op&&liveLegs++,legPromises.push($q((function(resolve,reject){that.manageLegElem(legElemIter,eventElem,seqNum,callsToUpdate).then((function(){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllLegs done for legId = "+legId+" / seqNum = "+seqNum)})).catch((function(error){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllLegs CATCH / seqNum = "+seqNum);var errorMessage="manageAllLegs -- "+error.message;$log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage)})).finally((function(){resolve()}))}))))})),$q.all(legPromises).finally((function(){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllLegs : nb living legs = "+liveLegs+" / seqNum = "+seqNum)}))},TelephonyServiceEventHandlerSipWise.prototype.manageLegElem=function(legElem,eventElem,seqNum,callsToUpdate){var that=this;return $q((function(resolve,reject){var legId=legElem.attr("legId"),callId=legElem.attr("callId"),deviceId=legElem.attr("deviceId"),state=legElem.attr("state"),op=legElem.attr("op");switch(legId||reject("manageLegElem -- Anomaly legId missing / seqNum = "+seqNum),callId||reject("manageLegElem -- Anomaly callId missing / seqNum = "+seqNum),op||reject("manageLegElem -- Anomaly op missing / seqNum = "+seqNum),$log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem legId = "+legId+" callId = "+callId+" deviceId = "+deviceId+" state = "+state+" op = "+op+" / seqNum = "+seqNum),op){case"created":$log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / leg creation / seqNum = "+seqNum),that.computeCallRelevancy(deviceId)?($log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / create legId/callId = "+legId+"/"+callId+" relevant"),that.legElemCreate(eventElem).then((function(){that.getCallFromCallId(callId).setConnectionIdSipWise(legId),callsToUpdate[callId]={trigger:!0,info:"leg"+op},resolve()})).catch((function(error){reject(error)}))):($log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / create legId/callId = "+legId+"/"+callId+" not relevant"),resolve());break;case"updated":$log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / leg update / seqNum = "+seqNum),that.computeCallRelevancy(deviceId)?($log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / update legId/callId = "+legId+"/"+callId+" relevant"),that.legElemUpdate(eventElem).then((function(){that.getCallFromCallId(callId).setConnectionIdSipWise(legId),callsToUpdate[callId]={trigger:!0,info:"leg"+op},resolve()})).catch((function(error){reject(error)}))):($log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / update legId/callId = "+legId+"/"+callId+" not relevant"),resolve());break;case"ended":$log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / leg end / seqNum = "+seqNum),that.computeCallRelevancy(deviceId)?that.getCallFromCallId(callId)?(that.telephonyService.clearCall(that.getCallFromCallId(callId),!0),callsToUpdate[callId]={trigger:!0,info:"leg"+op}):$log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem : leg ended / call already removed"):$log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem : leg ended but not relevant"),resolve();break;default:$log.info("[TelephonyServiceEventHandlerSipWise] manageLegElem / invalid op -> "+op+" / seqNum = "+seqNum),reject()}}))},TelephonyServiceEventHandlerSipWise.prototype.manageAllEndPoints=function(eventElem,seqNum,callsToUpdate){var that=this,endPointPromises=[],liveEndPoints=0;return eventElem.find("endpoint").each((function(){var endPointElemIter=angular.element(this),endPointId=endPointElemIter.attr("endpointId"),op=endPointElemIter.attr("op");$log.info("[TelephonyServiceEventHandlerSipWise] manageAllEndPoints ITER endPointId = "+endPointId+" op = "+op+" / seqNum = "+seqNum),endPointElemIter.length&&("ended"!==op&&liveEndPoints++,endPointPromises.push($q((function(resolve,reject){that.manageEndPointElem(endPointElemIter,eventElem,seqNum,callsToUpdate).then((function(){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllEndPoints done for endPointId = "+endPointId+" / seqNum = "+seqNum)})).catch((function(error){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllEndPoints CATCH / seqNum = "+seqNum);var errorMessage="manageAllEndPoints -- "+error.message;$log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage)})).finally((function(){resolve()}))}))))})),$q.all(endPointPromises).finally((function(){$log.info("[TelephonyServiceEventHandlerSipWise] manageAllEndPoints : nb living endPoint = "+liveEndPoints+" / seqNum = "+seqNum)}))},TelephonyServiceEventHandlerSipWise.prototype.manageEndPointElem=function(endPointElem,eventElem,seqNum,callsToUpdate){var that=this;return $q((function(resolve,reject){var endPointId=endPointElem.attr("endpointId"),callId=endPointElem.attr("callId"),state=endPointElem.attr("state"),op=endPointElem.attr("op");switch(endPointElem.attr("anonymous"),endPointId||reject("manageEndPointElem -- Anomaly endPointId missing / seqNum = "+seqNum),callId||reject("manageEndPointElem -- Anomaly callId missing / seqNum = "+seqNum),op||reject("manageEndPointElem -- Anomaly op missing / seqNum = "+seqNum),$log.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem endPointId = "+endPointId+" callId = "+callId+" state = "+state+" op = "+op+" / seqNum = "+seqNum),op){case"created":$log.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem: create endPointId/callId = "+endPointId+"/"+callId),that.endPointElemCreate(eventElem).then((function(){that.checkCallRelevancy(callId)?callsToUpdate[callId]={trigger:!0,info:"endpoint"+op}:$log.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem: create endPointId/callId = "+endPointId+"/"+callId+" not yet relevant"),resolve()})).catch((function(error){reject(error)}));break;case"updated":$log.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem / updated"),that.endPointElemUpdate(eventElem).then((function(){that.checkCallRelevancy(callId)?callsToUpdate[callId]={trigger:!0,info:"endpoint"+op}:$log.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem: update endPointId/callId = "+endPointId+"/"+callId+" not relevant"),resolve()})).catch((function(error){reject(error)}));break;case"ended":$log.info("[TelephonyServiceEventHandlerSipWise] manageEndPointElem / ended"),resolve();break;default:reject("manageEndPointElem / Anomaly unmanaged op : "+op)}}))},TelephonyServiceEventHandlerSipWise.prototype.legElemCreate=function(eventElem){var that=this,legElem=eventElem.find("leg");return this.getCall(legElem).then((function(call){try{var legState=legElem.attr("state"),deviceId=legElem.attr("deviceId");if(!deviceId){var errorMessage="legElemCreate -- Anomaly deviceId missing";return $log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage),$q.reject(new Error(errorMessage))}return $log.info("[TelephonyServiceEventHandlerSipWise] legElemCreate / leg state : "+legState+" / deviceId : "+deviceId),call.setDeviceIdSipWise(deviceId),call.setRelevantEquipmentId(deviceId),that.callsetStatusFromLegState(call,legState,eventElem),call.startDate=null,call.vm=!1,$q.when()}catch(error){return $log.info("[TelephonyServiceEventHandlerSipWise] legElemCreate catch"),errorMessage="legElemCreate -- "+error.message,$log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandlerSipWise.prototype.legElemUpdate=function(eventElem){$log.info("[TelephonyServiceEventHandlerSipWise] legElemUpdate");var that=this,legElem=eventElem.find("leg");return this.getCall(legElem).then((function(call){try{$log.info("[TelephonyServiceEventHandlerSipWise] legElemUpdate try");var legState=legElem.attr("state");return that.callsetStatusFromLegState(call,legState,eventElem),$q.when()}catch(error){$log.info("[TelephonyServiceEventHandlerSipWise] legElemUpdate catch");var errorMessage="legElemUpdate -- "+error.message;return $log.error("[TelephonyServiceEventHandlerSipWise] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandlerSipWise.prototype.endPointElemCreate=function(eventElem){$log.info("[TelephonyServiceEventHandlerSipWise] endPointElemCreate");var that=this,endPointElem=eventElem.find("endpoint"),callId=endPointElem.attr("callId"),phoneNumber=endPointElem.find("phoneNumber").text(),jid=endPointElem.find("jid").text(),firstName=endPointElem.find("firstName").text(),lastName=endPointElem.find("lastName").text();return endPointElem.find("displayName").text(),jid||phoneNumber?$q((function(resolve){_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.getOrCreateContact(jid,phoneNumber).then((function(contact){jid||firstName&&lastName&&contact.updateName(firstName,lastName);var call=that.getCallFromCallId(callId);callId&&call?(call.setContact(contact),$log.info("[TelephonyServiceEventHandlerSipWise] endPointElemCreate setContact DONE : displayName = "+call.contact.nameForLog)):$log.info("[TelephonyServiceEventHandlerSipWise] endPointElemCreate NOT DONE / no associated call"),resolve()}))})):($log.error("[TelephonyServiceEventHandlerSipWise] endPointElemCreate -- Anomaly no jid no phoneNumber"),$q.when())},TelephonyServiceEventHandlerSipWise.prototype.endPointElemUpdate=function(eventElem){$log.info("[TelephonyServiceEventHandlerSipWise] endPointElemUpdate");var that=this,endPointElem=eventElem.find("endpoint"),callId=endPointElem.attr("callId"),phoneNumber=endPointElem.find("phoneNumber").text(),jid=endPointElem.find("jid").text(),firstName=endPointElem.find("firstName").text(),lastName=endPointElem.find("lastName").text();return endPointElem.find("displayName").text(),jid||phoneNumber?$q((function(resolve){_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.getOrCreateContact(jid,phoneNumber).then((function(contact){jid||firstName&&lastName&&contact.updateName(firstName,lastName);var call=that.getCallFromCallId(callId);callId&&call?(call.setContact(contact),$log.info("[TelephonyServiceEventHandlerSipWise] endPointElemUpdate setContact DONE : displayName = "+call.contact.nameForLog)):$log.info("[TelephonyServiceEventHandlerSipWise] endPointElemUpdate setContact NOT DONE / no associated call"),resolve()}))})):($log.error("[TelephonyServiceEventHandlerSipWise] endPointElemUpdate -- Anomaly no jid no phoneNumber"),$q.when())},TelephonyServiceEventHandlerSipWise.prototype.onFailCallEvent=function(call,failedElem){var cause=failedElem.find("failedReason").text();$log.info("[TelephonyServiceEventHandlerSipWise] onFailCallEvent for callId : "+call.id+" / call status ERROR / cause : "+cause),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ERROR),call.errorMessage=TelephonyServiceEventHandlerSipWise.CallFailureLabels[cause],call.errorMessage||(call.errorMessage=cause)},TelephonyServiceEventHandlerSipWise.prototype.convLegStateToCallStatus=function(legState){var status=null;if(!legState)return $log.info("[TelephonyServiceEventHandlerSipWise] convLegStateToCallStatus Anomaly no legState"),status;switch(legState){case"initiated":case"dialing":status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.DIALING;break;case"ringingIn":status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_INCOMMING;break;case"ringingOut":status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_OUTGOING;break;case"queued":status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.QUEUED_INCOMMING;break;case"active":status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE;break;case"hold":status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.HOLD;break;case"holdVictim":status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.PUT_ON_HOLD;break;case"failed":status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ERROR;break;default:$log.info("[TelephonyServiceEventHandlerSipWise] convLegStateToCallStatus Anomaly legState = "+legState)}return status},TelephonyServiceEventHandlerSipWise.prototype.callsetStatusFromLegState=function(call,legState,eventElem){if(call&&legState){var status=this.convLegStateToCallStatus(legState);status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ERROR?this.onFailCallEvent(call,eventElem):call.setStatus(status),$log.info("[TelephonyServiceEventHandlerSipWise] callsetStatusFromLegState legstate = "+legState+" Call.status = "+call.status.value)}else $log.info("[TelephonyServiceEventHandlerSipWise] callsetStatusFromLegState Anomaly Call = "+call+" legState"+legState)},TelephonyServiceEventHandlerSipWise.prototype.getCallFromCallId=function(callId){if(!callId)return $log.debug("[TelephonyServiceEventHandlerSipWise] getCallFromCallId - Anomaly no callId"),null;var call=this.telephonyService.calls[callId];return call?($log.debug("[TelephonyServiceEventHandlerSipWise] getCallFromCallId = "+callId+" -  call: "+call),call):null},TelephonyServiceEventHandlerSipWise.prototype.getCall=function(elem){var that=this;return $q((function(resolve){var callId=elem.attr("callId"),legId=elem.attr("legId");that.getOrCreateCall(callId,legId).then((function(call){resolve(call)}))}))},TelephonyServiceEventHandlerSipWise.prototype.getOrCreateCall=function(callId,legId){var that=this;if(!callId)return $q.reject("no callId");var call=this.telephonyService.calls[callId];return call&&call.getConnectionIdSipWise()?($log.debug("[TelephonyServiceEventHandlerSipWise] getOrCreateCall - "+callId+" -  => found completed call: "+call),$q.when(call)):($log.debug("[TelephonyServiceEventHandlerSipWise] getOrCreateCall - "+callId+" -  => not completed : manage it"),legId?$q((function(resolve){resolve(that.telephonyService.getOrCreateCallSipWise(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN,callId,legId))})):$q.reject("no legId"))},TelephonyServiceEventHandlerSipWise.prototype.sendCallUpdateEvent=function(call,elem){if(call){call.autoClear&&($interval.cancel(call.autoClear),call.autoClear=null),$log.info("[TelephonyServiceEventHandlerSipWise] sendCallUpdateEvent for call "+call);var infoEvt=this.extractInfoEvent(elem);$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call,infoEvt)}},TelephonyServiceEventHandlerSipWise.prototype.extractInfoEvent=function(elem){return elem&&null!==elem?elem:null},TelephonyServiceEventHandlerSipWise.prototype.CallsUpdate=function(callsToUpdate){var that=this;$log.info("[TelephonyServiceEventHandlerSipWise] CallsUpdate"),Object.keys(callsToUpdate||[]).forEach((function(callId){callsToUpdate[callId]&&callsToUpdate[callId].trigger?($log.info("[TelephonyServiceEventHandlerSipWise] CallsUpdate for callId "+callId+" triggered"),that.sendCallUpdateEvent(that.getCallFromCallId(callId),callsToUpdate[callId].info)):$log.info("[TelephonyServiceEventHandlerSipWise] CallsUpdate for callId "+callId+" no triggered")}))},TelephonyServiceEventHandlerSipWise.prototype.computeCallRelevancy=function(deviceId){var result=!1,currentUsedDevice=this.telephonyService.telephonyServiceSipWise.getCurrentFromDevicesListSipWise();return deviceId&&currentUsedDevice&&(result=deviceId===currentUsedDevice.deviceId),$log.info("[TelephonyServiceEventHandlerSipWise] computeCallRelevancy for deviceId : "+deviceId+" / relevant = "+result),result},TelephonyServiceEventHandlerSipWise.prototype.checkCallRelevancy=function(callId){var result=!1,currentUsedDevice=this.telephonyService.telephonyServiceSipWise.getCurrentFromDevicesListSipWise(),call=this.getCallFromCallId(callId);return call&&currentUsedDevice&&($log.debug("[TelephonyServiceEventHandlerSipWise] checkCallRelevancy call.deviceID = "+call.getDeviceIdSipWise()),result=call.getDeviceIdSipWise()==currentUsedDevice.deviceId),$log.info("[TelephonyServiceEventHandlerSipWise] checkCallRelevancy for callId : "+callId+" / relevant = "+result),result},TelephonyServiceEventHandlerSipWise}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_2__),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3__),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4__),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5__),_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(14),_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7__);angular.module("rainbow").service("telephonyService",["$q","$interval","$http","$rootScope","$log","TelephonyServiceEventHandler","errorHelperService","VoiceMail","videoService","$injector",function($q,$interval,$http,$rootScope,$log,TelephonyServiceEventHandler,errorHelperService,VoiceMail,videoService,$injector){var service=this,listeners=[],subscriptions=[],CALLSERVICE_NS="urn:xmpp:pbxagent:callservice:1",sipWise=!1;service.rxSubject=new rxjs__WEBPACK_IMPORTED_MODULE_0__.a,service.start=function(stats){if($log.info("[telephonyService] === STARTING ==="),service.setSipWise(service.isSipWiseRoot()),service.isSipWise()){$log.info("[telephonyService] starting in sipWise mode"),CALLSERVICE_NS="urn:xmpp:pbxagent:telephony:1";try{service.telephonyServiceEventHandlerSipWise=$injector.get("TelephonyServiceEventHandlerSipWise")}catch(error){var errorMessage=error&&error.message?error.message:"Unknown error",errorStack=error&&error.stack?error.stack:"Unknown stack";$log.error("[telephonyService] injection TelephonyServiceEventHandlerSipWise  exception  -- "+errorMessage+" : "+errorStack)}try{service.telephonyServiceSipWise=$injector.get("telephonyServiceSipWise")}catch(error){errorMessage=error&&error.message?error.message:"Unknown error",errorStack=error&&error.stack?error.stack:"Unknown stack",$log.error("[telephonyService] injection TelephonyServiceSipWise  exception  -- "+errorMessage+" : "+errorStack)}}service.startDate=performance.now(),service.stats=stats,service.calls=[],service.pendingMakeCalls=[],service.starting=service.started=!1,service.agentStatus={phoneApi:"disconnected",xmppAgent:"stopped",agentVersion:"unknown"},service.voicemailNumber=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.voicemailNumber,service.pbxId=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.pbxId,service.makingCall=!1,service.voiceMail=VoiceMail.create(),service.forwardObject={},service.nomadicObject={},service.nomadicAnswerNotTakedIntoAccount=!1,service.sipWiseUserGroupsData={huntingGroupNb:0,managerAssistantNb:0,managerAssistGrId:0,managerId:0,managerName:"",managerStatus:"",managerForward:"unknow",assistantId:0,assistantName:"",assistantStatus:"",sipWiseUserGroupsList:[]},service.sipWiseEmergencyCallData={WGEmergencyCallForbidden:!1,emergencyNuList:[],serverData:null},service.isBasicCallAllowed=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_BASIC_CALL),service.isSecondCallAllowed=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_SECOND_CALL),service.isTransferAllowed=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_TRANSFER_CALL),service.isConferenceAllowed=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_CONFERENCE_CALL),service.isVMDeflectCallAllowed=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_DEFLECT_CALL),service.voiceMailFeatureEnabled=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_VOICE_MAIL),service.isForwardEnabled=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_CALL_FORWARD),service.isNomadicEnabled=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_NOMADIC),service.userJidTel=_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.jidTel,service.portalURL=config.restServerUrl+"/api/rainbow/telephony/v1.0/",subscriptions.push(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.subscribeToContactEvents((function(event){"ON_CONTACT_PRESENCE_EVENT"===event.name&&service.onTelPresenceChange(event.data)}))),service.isSipWise()?service.telephonyEventHandler=service.telephonyServiceEventHandlerSipWise.create(service):service.telephonyEventHandler=TelephonyServiceEventHandler.create(service),$log.info("[telephonyService] starting on user jidTel: "+service.userJidTel),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact&&($log.info("[telephonyService] starting user name: "+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.nameForLogs+", full jid: "+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.fullJid),$log.info("[telephonyService] starting phonePbx: "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePbx)+", phonePro: "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePro)+", voicemailNumber: "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.voicemailNumber)+", pbxId: "+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.pbxId)),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact&&(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.telStatus?($log.info("[telephonyService] start with my existing telephony presence "+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.telStatus+" of user contact ("+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.jidtel+") "),service.onTelPresenceChange({jid:service.userJidTel+"/phone",status:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.telStatus})):($log.info("[telephonyService] Subscribe and wait for my telephony presence ("+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.jidtel+")"),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.sendSubscribeInvitation(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.jidtel)))},service.onTelPresenceChange=function(attr){if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.isTelJid(attr.jid)){var ressourceFromJid=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getResourceFromJid(attr.jid);if("phone"!==ressourceFromJid&&"pcg2"!==ressourceFromJid)return!0;var jid_im=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getImJid(attr.jid);if(!jid_im)return!0;var _status4=attr.status;_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.isUserContactJid(jid_im)&&("unavailable"===_status4||"offline"===_status4?($log.info("[telephonyService] received my telephony presence -- "+_status4),service.starting=service.started=!1,service.telephonyOfflineCallManagement(),$rootScope.$broadcast("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped"),$log.info("[telephonyService] === STOPPED ===")):service.started||service.starting||($log.info("[telephonyService] received my telephony presence -- "+_status4),service.starting=!0,service.getAgentStatus().then((function(){return service.attachHandlers(),service.isSipWise()?(service.sipWiseUserGroupsDataClear(),service.sipWiseEmergencyCallDataClear(),service.telephonyServiceSipWise.resetSipWiseRoutingObject(),service.getTelephonyState(!1)):service.isNomadicEnabled?service.getNomadicStatus().then((function(){var snapshotSecondary=service.nomadicObject.featureActivated&&service.nomadicObject.modeActivated&&!service.nomadicObject.makeCallInitiatorIsMain;return service.getTelephonyState(snapshotSecondary)})):service.getTelephonyState(!1)})).then((function(){service.isForwardEnabled&&service.getForwardStatus()})).then((function(){var startDuration=Math.round(performance.now()-service.startDate);service.stats.push({service:"telephonyService",startDuration:startDuration}),$log.info("[telephonyService] === STARTED ("+startDuration+" ms) ==="),service.started=!0,service.starting=!1,$rootScope.$broadcast("ON_TELEPHONY_STATUS_CHANGED_EVENT","started")})).catch((function(error){service.starting=!1,$log.error("[telephonyService] receive telephony presence but error in initialization - "+(error?error.message:"unknown error"))}))))}return!0},service.launchTelephonyInitilization=function(){_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact&&_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.telStatus?($log.info("[telephonyService] launchTelephonyInitilization telStatus: "+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.telStatus+" => start"),service.onTelPresenceChange({jid:service.userJidTel+"/phone",status:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.telStatus})):$log.info("[telephonyService] launchTelephonyInitilization no tel presence => do nothing")},service.reconnect=function(){$log.info("[telephonyService] reconnect (xmpp reconnection)"),service.starting=service.started=!1,service.telephonyOfflineCallManagement(),$rootScope.$broadcast("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped"),service.attachHandlers()},service.telephonyOfflineCallManagement=function(){$log.info("[telephonyService] telephony Offline Call Management");try{var webrtcGatewayService=$injector.get("webrtcGatewayService");Object.keys(service.calls||[]).forEach((function(key){var call=service.calls[key];call&&(call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.RINGING_INCOMMING&&call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.QUEUED_INCOMMING||(call.mediaPillarCall&&call.mediaPillarCall.webrtcCallRef&&($log.info("[telephonyService] Offline Call Management: release MP webrtc call for phone call "+call.id+" in state "+call.status.value),videoService.releaseCall(call.mediaPillarCall.webrtcCallRef)),$log.info("[telephonyService] Offline Call Management: stop popup and ringing tone for phone call "+call.id+" in state "+call.status.value),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN),call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)),(call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.RINGING_OUTGOING||call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.QUEUED_OUTGOING)&&webrtcGatewayService.isMediaPillarCallSituation(call)&&call.mediaPillarCall&&call.mediaPillarCall.webrtcCallRef&&($log.info("[telephonyService] Offline Call Management: release MP webrtc call for phone call "+call.id+" in state "+call.status.value),videoService.releaseCall(call.mediaPillarCall.webrtcCallRef)),webrtcGatewayService.isMediaPillarCallSituation(call)&&call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE?($log.info("[telephonyService] Offline Call Management: keep MP call for phone call "+call.id+" in state "+call.status.value),call.pbxConnectionDown=!0):(delete service.calls[call.id],$log.info("[telephonyService] Offline Call Management: phone call deleted: "+call.id+" in state "+call.status.value)))})),$log.info("[telephonyService] Offline Call Management: clear "+service.pendingMakeCalls.length+" pending makecalls"),service.pendingMakeCalls=[]}catch(error){var errorMessage=error&&error.message?error.message:"Unknown error",errorStack=error&&error.stack?error.stack:"Unknown stack";$log.error("[telephonyService] telephonyOfflineCallManagement  exception  -- "+errorMessage+" : "+errorStack)}},service.getTelephonyState=function(secondary){if(service.isSipWise())return $q((function(resolve,reject){$log.info("[telephonyService] getTelephonyState -- sipWise get Devices then routingInfo then snapshot"),service.telephonyServiceSipWise.getUserDevices(service).then((function(){return service.telephonyServiceSipWise.getUserRoutingInfo(service)})).then((function(){return service.telephonyServiceSipWise.processSnapshot(service)})).then((function(){service.getSipWiseUserGroups()})).then((function(){service.fetchSipWiseEmergencyCallData()})).then((function(){resolve()})).catch((function(error){$log.info("[telephonyService] sipwise getTelephonyState CATCH");var errorMessage="sipwise getTelephonyState -- "+error.message;$log.error("[telephonyService] "+errorMessage),reject(error)}))}));var iq,defered=$q.defer();return iq=secondary?$iq({type:"get",to:service.userJidTel+"/phone"}).c("callservice",{xmlns:CALLSERVICE_NS}).c("connections",{deviceType:"SECONDARY"}):$iq({type:"get",to:service.userJidTel+"/phone"}).c("callservice",{xmlns:CALLSERVICE_NS}).c("connections"),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.sendIQ(iq,6e4).then((function(data){var errorMessage=service.getErrorMessage(data,"getTelephonyState");if(errorMessage)return $log.info("[telephonyService] getTelephonyState -- failure -- "+errorMessage),defered.reject(new Error(errorMessage)),defered.promise;var existingCalls=angular.element(data).find("connection");if($log.info("[telephonyService] getTelephonyState ("+(secondary?"SECONDARY":"MAIN")+") -- success -- "+existingCalls.length+" existing call(s)"),0===existingCalls.length)return defered.resolve(),defered.promise;var getCallPromises=[];return existingCalls.each((function(){getCallPromises.push(service.createCallFromConnectionElem(this,secondary))})),$q.all(getCallPromises).then((function(){$log.info("[telephonyService] getTelephonyState ("+(secondary?"SECONDARY":"MAIN")+") -- calls creation completed -- "+existingCalls.length+" calls created"),defered.resolve()})).catch((function(error){$log.error("[telephonyService] getTelephonyState -- calls creation failure -- "+error.message),defered.reject(error)})),defered.promise})).catch((function(error){$log.error("[telephonyService] getTelephonyState -- failure -- "+error.message),defered.reject(error)})),defered.promise},service.snapshotDevice=function(secondary){return $q((function(resolve,reject){if(service.isSipWise())resolve();else{var reqUrl=service.portalURL+"snapshotdevice";secondary&&(reqUrl+="?deviceType=SECONDARY"),$http({method:"GET",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(response){$log.info("[telephonyService] snapshotdevice success "),resolve(response.data.data)}),(function(response){$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"snapshotdevice"));var error=errorHelperService.handleError(response);reject(error)}))}}))},service.getAgentStatus=function(){var defered=$q.defer(),toPCG="/phone";service.isSipWise()&&($log.info("[telephonyService] getAgentStatus --- sipWise version"),toPCG="/pcg2");var getAgentIq=$iq({type:"get",to:service.userJidTel+toPCG}).c("pbxagentstatus",{xmlns:"urn:xmpp:pbxagent:monitoring:1"});return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.sendIQ(getAgentIq,6e4).then((function(data){var phoneApi=angular.element(data).find("phoneapi").text(),xmppAgent=angular.element(data).find("xmppagent").text(),agentVersion=angular.element(data).find("version").text(),features=angular.element(data).find("features").text(),type=angular.element(data).find("type").text();if(agentVersion&&(service.agentStatus={phoneApi:phoneApi,xmppAgent:xmppAgent,agentVersion:agentVersion,features:features},type?(service.isOxe=type.toLowerCase().includes("oxe"),service.isOxo=type.toLowerCase().includes("oxo")):(service.isOxe=agentVersion.toLowerCase().includes("oxe"),service.isOxo=agentVersion.toLowerCase().includes("oxo"))),service.isSipWise()&&"RVCP"!==type){service.setSipWise(!1);var errorMessage="getAgentStatus -- sipWise failure : wrong PCG type";$log.error("[telephonyService] "+errorMessage),defered.reject(new Error(errorMessage))}$log.info("[telephonyService] getAgentStatus -- success -- version "+agentVersion+" isOxe:"+service.isOxe+" isOxo:"+service.isOxo+" isSipWise:"+service.isSipWise()),$rootScope.$broadcast("ON_AGENT_STATUS_RECEIVED_EVENT"),defered.resolve()})).catch((function(error){var errorMessage="getAgentStatus -- failure : "+error.message;$log.error("[telephonyService] "+errorMessage),defered.reject(new Error(errorMessage))})),defered.promise},service.getSnapshotCall=function(callId){return $log.info("[telephonyService] getSnapshotCall"),$q((function(resolve,reject){var iq=$iq({type:"get",to:service.userJidTel+"/phone"}).c("callservice",{xmlns:CALLSERVICE_NS}).c("snapshotCall",{callId:callId});_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.sendIQ(iq).then((function(data){console.error(data),resolve()})).catch((function(error){var errorMessage="getSnapshotCall failure : "+error.message;$log.error("[telephonyService] "+errorMessage),reject(new Error(errorMessage))}))}))},service.createCallFromConnectionElem=function(connectionElemObj,secondary){return $q((function(resolve,reject){var connectionElem=angular.element(connectionElemObj),jid=connectionElem.attr("endpointIm"),phoneNumber=connectionElem.attr("endpointTel"),connectionId=connectionElem.attr("callId"),endpointLci=connectionElem.attr("endpointLci"),lci=connectionElem.attr("lci"),participantsElem=connectionElem.find("participant"),identityFirstName=connectionElem.find("identity").attr("firstName"),identityLastName=connectionElem.find("identity").attr("lastName"),firstName="",lastName="";jid||phoneNumber||(phoneNumber="****"),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.TELEPHONY_PHONE_BOOK)&&0===participantsElem.length&&identityLastName&&identityLastName.length&&(lastName=identityLastName,identityFirstName&&identityFirstName.length&&(firstName=identityFirstName),$log.info("[telephonyService] createCallFromConnectionElem - name resolution for: "+connectionId+" for phoneNumber:"+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(phoneNumber)+" with firstname : "+firstName.slice(0,1)+"***")),"LCI_INITIATED"!==lci||secondary&&$injector.get("webrtcGatewayService").IsMediaPillarUserSelected()?(0===participantsElem.length?_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getOrCreateContact(jid,phoneNumber):service.getParticipantsFromParticipantsElem(participantsElem)).then((function(response){var callStatus=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE;"LCI_INITIATED"===lci&&(callStatus=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.DIALING),"LCI_HELD"===lci&&"LCI_CONNECTED"===endpointLci&&(callStatus=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.HOLD),"LCI_CONNECTED"===lci&&"LCI_HELD"===endpointLci&&(callStatus=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.PUT_ON_HOLD),"LCI_CONNECTED"===lci&&"LCI_QUEUED"===endpointLci&&(callStatus=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.QUEUED_OUTGOING),"LCI_QUEUED"===lci&&"LCI_CONNECTED"===endpointLci&&(callStatus=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.QUEUED_INCOMMING),"LCI_ALERTING"===lci&&(callStatus=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.RINGING_INCOMMING);var call=null;0===participantsElem.length?(response&&response.temp&&""!==lastName&&response.updateName(firstName,lastName),call=service.getOrCreateCall(callStatus,connectionId,response),$log.info("[telephonyService] createCallFromConnectionElem - create call for user: "+response.id+" with callId: "+connectionId+" "+lci)):((call=service.getOrCreateCall(callStatus,connectionId)).setParticipants(response),call.isConference=!0,$log.info("[telephonyService] createCallFromConnectionElem - create conference call with callId: "+connectionId+" "+lci)),call.relevantEquipmentId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.getDeviceIdFromConnectionId(connectionId),call.isSecondary=secondary,call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve(call)})).catch((function(error){$log.error("[TelephonyService] createCallFromConnectionElem - failure - "+error.message),reject(error)})):resolve()}))},service.getParticipantsFromParticipantsElem=function(participants){return $q((function(resolve,reject){var confParticipants=[],participantPromises=[];participants.each((function(){var participantElem=angular.element(this),endpointTel=participantElem.find("endpointTel").text(),endpointIm=participantElem.find("endpointIm").text();endpointIm&&_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.isUserContactJid(endpointIm)||participantPromises.push($q((function(resolvePromise,rejectPromise){endpointIm||endpointTel||(endpointTel="****"),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getOrCreateContact(endpointIm,endpointTel).then((function(contact){confParticipants.push(contact),resolvePromise()})).catch((function(error){rejectPromise(error)}))})))})),$q.all(participantPromises).then((function(){resolve(confParticipants)}),(function(error){reject(error)}))}))},service.getOrCreateCall=function(status,connectionId,contact){var call=service.calls[_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.getIdFromConnectionId(connectionId)];return call?(call.setConnectionId(connectionId),call.startDate=new Date):((call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.create(status,null,_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Type.PHONE,contact)).setConnectionId(connectionId),service.calls[call.id]=call),call},service.createCallSipWise=function(status,callId){var call=null;return callId&&(call=service.calls[callId]),call?call.startDate=new Date:(call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.create(status,callId,_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Type.PHONE),service.calls[call.id]=call),call},service.getOrCreateCallSipWise=function(status,callId,legId,deviceId,contact){var call=null;return callId&&(call=service.calls[callId]),call?(call.setConnectionIdSipWise(legId),contact&&call.setContact(contact),deviceId&&call.setDeviceIdSipWise(deviceId),call.startDate=new Date):((call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.create(status,callId,_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Type.PHONE,contact)).setConnectionIdSipWise(legId),call.setDeviceIdSipWise(deviceId),service.calls[call.id]=call),call},service.attachHandlers=function(){if($log.info("[telephonyService] attachHandlers"),0===Object.keys(service.calls||[]).length&&($rootScope.telephonyAreaClass=""),service.messageHandlerRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.deleteHandler(service.messageHandlerRef),service.messageHandlerRef=null),service.messageHandlerRef=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.addHandler((function(stanza){return service.telephonyEventHandler.onCallserviceMessageReceived(stanza),!0}),CALLSERVICE_NS,"message",null),service.isSipWiseRoot()){service.overflowUpdatRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.deleteHandler(service.overflowUpdatRef),service.overflowUpdatRef=null),service.overflowUpdatRef=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.addHandler((function(stanza){return service.telephonyEventHandler.onOverflowUpdateMessageReceived(stanza),!0}),"urn:xmpp:pbxagent:overflowOnSubscriberUpdated:1","message",null);service.userConfigurationRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.deleteHandler(service.userConfigurationRef),service.userConfigurationRef=null),service.userConfigurationRef=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.addHandler((function(stanza){return service.telephonyEventHandler.onUserConfigurationMessageReceived(stanza),!0}),"urn:xmpp:rvcp:userConfiguration:1","message",null)}},service.stop=function(){var listener;for($log.info(""),$log.info("[telephonyService] === STOPPING ==="),service.starting=service.started=!1,service.userJidTel=null,service.calls=null,service.messageHandlerRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.deleteHandler(service.messageHandlerRef),service.messageHandlerRef=null),service.overflowUpdatRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.deleteHandler(service.overflowUpdatRef),service.overflowUpdatRef=null),service.userConfigurationRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.deleteHandler(service.userConfigurationRef),service.userConfigurationRef=null);listener=listeners.pop();)listener();return service.currentPgiObject={},subscriptions&&subscriptions.forEach((function(subscription){subscription.unsubscribe()})),$log.info("[telephonyService] === STOPPED ==="),$rootScope.$broadcast("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped"),$q.when()},service.getCallToHangOut=function(){var calls=service.getCalls();if(!calls||0===calls.length)return null;var callStatus=calls[0].status;return 1===calls.length||callStatus===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.DIALING||callStatus===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE||callStatus===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.PUT_ON_HOLD?calls[0]:calls[1]},service.getActiveCall=function(){var activeCall=null;return Object.keys(service.calls||[]).forEach((function(key){var call=service.calls[key];call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE&&(activeCall=call)})),activeCall},service.getCalls=function(){var calls=[];return Object.keys(service.calls||[]).forEach((function(key){var status=service.calls[key].status;status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.DIALING&&status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.RINGING_OUTGOING&&status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.QUEUED_OUTGOING&&status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE&&status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.HOLD&&status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.PUT_ON_HOLD&&status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ERROR||calls.push(service.calls[key])})),calls},service.getNotIdleCalls=function(){var calls=[];return Object.keys(service.calls||[]).forEach((function(key){var call=service.calls[key];call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN&&calls.push(call)})),calls},service.getActiveCallsForContact=function(contact){var calls=[];return contact&&contact.jid&&Object.keys(service.calls||[]).forEach((function(key){!service.calls[key].contact||service.calls[key].contact.jid!==contact.jid||service.calls[key].status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.DIALING&&service.calls[key].status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.RINGING_OUTGOING&&service.calls[key].status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.QUEUED_OUTGOING&&service.calls[key].status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE&&service.calls[key].status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.HOLD&&service.calls[key].status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.PUT_ON_HOLD||calls.push(service.calls[key])})),calls},service.getConferenceCallForContact=function(contact){var conferenceCall=null;return contact&&contact.jid&&Object.keys(service.calls||[]).forEach((function(key){service.calls[key].status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE&&service.calls[key].isConference&&(service.calls[key].participants||[]).some((function(participantContact){return participantContact&&participantContact.jid===contact.jid}))&&(conferenceCall=service.calls[key])})),conferenceCall},service.logMakecallReqData=function(reqData,contact){var reqDataForLogs={};Object.keys(reqData).forEach((function(reqDataProperty){switch(reqDataProperty){case"calleeExtNumber":case"calleeIntNumber":case"calleeShortNumber":reqDataForLogs[reqDataProperty]=_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(reqData[reqDataProperty]);break;case"calleeDisplayName":contact&&(reqDataForLogs[reqDataProperty]=contact&&contact.nameForLogs?contact.nameForLogs:"");break;default:reqDataForLogs[reqDataProperty]=reqData[reqDataProperty]}})),$log.info("[telephonyService] makeCall data: "+JSON.stringify(reqDataForLogs))},service.makeCall=function(contact,phoneNumber,callSubject,correlatorData){$log.info("TELAPI [telephonyService] makeCall to "+(contact&&contact.nameForLogs?contact.nameForLogs:_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(phoneNumber)));var activeCall=service.getActiveCall();return service.makingCall?($log.warn("[telephonyService] makeCall failure - makeCall already making a call"),$q.reject()):(service.makingCall=!0,activeCall?service.isSipWise()?service.telephonyServiceSipWise.makeSimpleCallSipWise(service,contact,phoneNumber):service.makeConsultationCall(contact,phoneNumber,activeCall.connectionId,correlatorData):service.isSipWise()?service.telephonyServiceSipWise.makeSimpleCallSipWise(service,contact,phoneNumber):service.makeSimpleCall(contact,phoneNumber,callSubject,correlatorData))},service.makeSimpleCall=function(contact,phoneNumber,callSubject,correlatorData){if($log.info("[telephonyService] makeSimpleCall to "+(contact&&contact.nameForLogs?contact.nameForLogs:_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(phoneNumber))),!service.isBasicCallAllowed){var profileError=new Error("makeSimpleCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),service.makingCall=!1,$q.reject(profileError)}if($injector.get("webrtcGatewayService").isMediaPillarCallSituation()&&videoService.getWebrtcAudioCall())return $log.info("[telephonyService] makeCall failure - webrtcgateway call not possible when webrtc call already engaged"),service.makingCall=!1,$rootScope.$broadcast("ON_CALL_NOTALLOWED_EVENT","webCallAlreadyProgress"),$q.reject("webCallAlreadyProgress");var phoneInfo=service.getPhoneInfo(contact,phoneNumber),reqUrl=service.portalURL+"calls",reqData={calleeExtNumber:phoneInfo.longNumber,calleeIntNumber:phoneInfo.internalNumber,calleeShortNumber:phoneInfo.shortNumber,calleePbxId:phoneInfo.pbxId,calleeDisplayName:contact.displayName,callSubject:callSubject,correlatorData:correlatorData,secondaryDeviceMakeCall:angular.isDefined(service.nomadicObject.makeCallInitiatorIsMain)&&!0===service.nomadicObject.featureActivated&&service.isNomadicEnabled?service.nomadicObject.makeCallInitiatorIsMain?"false":"true":void 0};return $log.info("[telephonyService] makeSimpleCall POST "+reqUrl),service.logMakecallReqData(reqData,contact),service.doRequestMakecall(contact,phoneNumber,"POST",reqUrl,reqData)},service.makeConsultationCall=function(contact,phoneNumber,callId,correlatorData){if($log.info("[telephonyService] makeConsultationCall to "+(contact&&contact.nameForLogs?contact.nameForLogs:_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(phoneNumber))),!service.isSecondCallAllowed){var profileError=new Error("makeConsultationCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),service.makingCall=!1,$q.reject(profileError)}var phoneInfo=service.getPhoneInfo(contact,phoneNumber,correlatorData),reqUrl=service.portalURL+"calls/"+encodeURIComponent(callId)+"/consultation",reqData={calleeExtNumber:phoneInfo.longNumber,calleeIntNumber:phoneInfo.internalNumber,calleeShortNumber:phoneInfo.shortNumber,calleePbxId:phoneInfo.pbxId,calleeDisplayName:contact.displayName,correlatorData:phoneInfo.correlatorData};return $log.info("[telephonyService] makeConsultationCall POST "+reqUrl),service.logMakecallReqData(reqData,contact),service.doRequestMakecall(contact,phoneNumber,"POST",reqUrl,reqData).catch((function(error){throw service.deleteCallIfInvalid(error,service.calls[_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.getIdFromConnectionId(callId)]),error}))},service.doRequestMakecall=function(contact,phoneNumber,reqMethod,reqUrl,reqData){return $q((function(resolve,reject){$log.info("[telephonyService] doRequestMakecall to "+(contact&&contact.nameForLogs?contact.nameForLogs:_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(phoneNumber)));var call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.create(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN,null,_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Type.PHONE,contact);call.isSecondary=service.nomadicObject&&!service.nomadicObject.makeCallInitiatorIsMain,call.isOwner=!0,call.setIsVm(phoneNumber===service.voicemailNumber),service.pendingMakeCalls.push(call),$log.info("[telephonyService] doRequestMakecall Call created ("+call+")"),$http({method:reqMethod,url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyService] doRequestMakecall success : callee "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(phoneNumber)+" callId: "+response.data.data.callId),service.pendingMakeCalls.includes(call)?(call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.DIALING),call.setConnectionId(response.data.data.callId),call.setRelevantEquipmentId(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.getDeviceIdFromConnectionId(call.connectionId)),service.calls[call.id]=call,service.pendingMakeCalls.splice(service.pendingMakeCalls.indexOf(call),1),$log.info("[telephonyService] doRequestMakecall Call confirmed by makecall acknowlegement ("+call+")"),call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve(call.id)):resolve(call.id?call.id:response.data.data.callId),service.makingCall=!1}),(function(response){$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"makeCall")),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ERROR),call.errorMessage=response&&"403"===response.errorDetailsCode?"notAllowed":"invalidPhoneNumber",service.calls[call.contact.id]=call,service.pendingMakeCalls.splice(service.pendingMakeCalls.indexOf(call),1),call.autoClear=$interval((function(){service.clearCall(call)}),5e3,1),service.makingCall=!1,call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call);var error=errorHelperService.handleError(response);reject(error)}))}))},service.makeCallByPhoneNumber=function(phoneNumber,callSubject,correlatorData){return $q((function(resolve,reject){if($log.info("[telephonyService] makeCallByPhoneNumber : "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(phoneNumber)),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePro===phoneNumber||_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phoneProCan===phoneNumber||_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePbx===phoneNumber){var errorMessage="makeCallByPhoneNumber failure: impossible to call its own phone number";return $log.error("[telephonyService] "+errorMessage),void reject(new Error(errorMessage))}_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getOrCreateContact(null,phoneNumber).then((function(contact){return contact,service.makeCall(contact,phoneNumber,callSubject,correlatorData)})).then((function(){resolve()})).catch((function(error){var _errorMessage="makeCallByPhoneNumber failure "+(error?error.message:"");$log.error("[telephonyService] - callService - "+_errorMessage),reject(new Error(_errorMessage))}))}))},service.getPhoneInfo=function(contact,phoneNumber,correlatorData){var longNumber=phoneNumber,shortNumber="",internalNumber="",pbxId="";return contact&&(phoneNumber===contact.phonePro||phoneNumber===contact.phoneProCan?(longNumber=contact.phoneProCan?contact.phoneProCan:"",shortNumber=contact.phonePbx,pbxId=contact.pbxId,internalNumber=contact.phoneInternalNumber):phoneNumber===contact.phonePbx&&(longNumber="",shortNumber=contact.phonePbx,pbxId=contact.pbxId,internalNumber=contact.phoneInternalNumber)),{longNumber:longNumber,shortNumber:shortNumber,pbxId:pbxId,internalNumber:internalNumber,correlatorData:correlatorData}},service.getErrorMessage=function(data,actionLabel){var errorMessage=actionLabel+" failure : ";if("error"===angular.element(data).attr("type")){var error=angular.element(data).find("error");if(error){var errorType=error.attr("type"),errorCode=error.attr("code");errorType&&(errorMessage+=errorType+" : ","modify"===errorType&&(errorMessage+=error.find("text").text())),errorCode&&"503"===errorCode&&(errorMessage+="Agent error : service unavailable"),$log.error("[telephonyService] "+errorMessage)}else errorMessage+="Unknown error";return errorMessage}return null},service.releaseCall=function(call){return $q((function(resolve,reject){if($log.info("TELAPI [telephonyService] releaseCall "+call.id),!service.isBasicCallAllowed){var profileError=new Error("releaseCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(call.pbxConnectionDown)return call.mediaPillarCall&&call.mediaPillarCall.webrtcCallRef&&call.mediaPillarCall.webrtcCallRef.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN?($log.info("[telephonyService] releaseCall "+call.id+" with pbx connection down : we release the mediapillar web call: "+call.mediaPillarCall.webrtcCallRef),videoService.releaseCall(call.mediaPillarCall.webrtcCallRef)):$log.info("[telephonyService] releaseCall "+call.id+" with pbx connection down : "+(call.mediaPillarCall?call.mediaPillarCall.webrtcCallRef?"no need to release webrtc call with status "+call.mediaPillarCall.webrtcCallRef:"no MP webrtc call to release":"no MP context!")),$log.info("[telephonyService] releaseCall "+call.id+" with pbx connection down : we remove the phone call"),service.clearCall(call),void resolve(call);if(service.isSipWise())service.telephonyServiceSipWise.releaseCallSipWise(service,call).then((function(theCall){resolve(theCall)}));else{var reqUrl=service.portalURL+"calls/"+encodeURIComponent(call.connectionId);$log.info("[telephonyService] releaseCall DELETE "+reqUrl),$http({method:"DELETE",url:reqUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(){call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN),call.startDate=null,call.vm=!1,$log.info("[telephonyService] releaseCall "+call.id+" - success"),call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),delete service.calls[call.id],resolve(call)}),(function(response){var error=errorHelperService.handleError(response);service.deleteCallIfInvalid(error,call),reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"releaseCall"))}))}}))},service.releaseCallAndNotify=function(call){return $q((function(resolve,reject){service.releaseCall(call).then((function(){resolve()})).catch((function(){call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),reject()}))}))},service.deleteCallIfInvalid=function(error,call){error&&"telephony"===error.portal&&404100===error.errorDetailsCode&&error.message&&(error.message.toLowerCase().includes("invalid connection identifier")||error.message.toLowerCase().includes("failed to send releasecall"))&&call&&($log.warn("[telephonyService] deleteCallIfInvalid: delete client call non existing on server: "+call.id),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN),call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),service.calls[call.id]&&delete service.calls[call.id])},service.answerCall=function(call){return $q((function(resolve,reject){$log.info("[telephonyService] answerCall : "+call.id);var activeCall=service.getActiveCall();if(!service.isBasicCallAllowed){var profileError=new Error("answerCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(call.isMediaPillarCall()&&$injector.get("webrtcGatewayService").isMediaPillarCallSituation(call)&&$rootScope.isDesktopApp){var MP_context=call.getMediaPillarCall();if(MP_context&&MP_context.webrtcCallRef)return videoService.answerCall(MP_context.webrtcCallRef,"audio"),$log.info("[telephonyService] answer webrtcgateway sending webrtc proceed"),void resolve(call);$log.info("[telephonyService] answer webrtcgateway | Anomaly media Pillar : answer but no webrtcCallref")}service.isSipWise()?service.telephonyServiceSipWise.answerCallSipWise(service,call).then((function(theCall){resolve(theCall)}),(function(error){reject(error)})):call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.QUEUED_INCOMMING&&activeCall&&service.isOxe?service.holdCall(activeCall).catch((function(error){$log.warn("[telephonyService] holdCall (before answerCall) failed on callId:"+activeCall.connectionId+" "+error)})).then((function(){return service.answerCall(call)})).then((function(thecall){resolve(thecall)})).catch((function(error){var errorMessage="answerCall failure : "+error.message;$log.error("[telephonyService] - callService -  "+errorMessage),reject(new Error(errorMessage))})):$http({method:"PUT",url:service.portalURL+"calls/"+encodeURIComponent(call.connectionId)+"/answer",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(response){call.setConnectionId(response.data.data.callId),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE),$log.info("[telephonyService] answerCall success : "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(call.contact.phone)+" Call ("+call+")"),call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve(call)}),(function(response){response.data&&"Device is not able to answer a call"===response.data.errorDetails&&$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{autoClose:!1,okLabel:"close",popupTitle:"warning",popupBody:"deviceDoesntAllowAnswer"}),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN);var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"answerCall"))}))}))},service.answerCallAndNotify=function(call){return $q((function(resolve,reject){service.answerCall(call).then((function(){resolve()})).catch((function(){call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),reject()}))}))},service.holdCall=function(call){return $q((function(resolve,reject){if($log.info("[telephonyService] holdCall : callId: "+call.id+" "+call.contact.nameForLog),call&&call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.HOLD){if(!service.isSecondCallAllowed){var profileError=new Error("holdCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}service.isSipWise()?service.telephonyServiceSipWise.holdCallSipWise(service,call).then((function(theCall){resolve(theCall)}),(function(error){reject(error)})):$http({method:"PUT",url:service.portalURL+"calls/"+encodeURIComponent(call.connectionId)+"/hold",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(response){$log.info("[telephonyService] holdCall success : "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(call.contact.phone)+" Call ("+call+")"),call.setConnectionId(response.data.data.callId),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.HOLD),call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve(call)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"holdCall"))}))}else resolve(call)}))},service.retrieveCall=function(call){return $q((function(resolve,reject){if($log.info("[telephonyService] retrieveCall callId: "+call.id+" "+call.contact.nameForLog),!service.isSecondCallAllowed){var profileError=new Error("retrieveCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}var activeCall=service.getActiveCall();if(activeCall)service.holdCall(activeCall).then((function(){return service.retrieveCall(call)})).then((function(thecall){resolve(thecall)})).catch((function(error){var errorMessage="retrieveCall failure : "+error.message;$log.error("[telephonyService] - callService -  "+errorMessage),reject(new Error(errorMessage))}));else{if(service.isSipWise())return void service.telephonyServiceSipWise.retrieveCallSipWise(service,call).then((function(theCall){resolve(theCall)}),(function(error){reject(error)}));$http({method:"PUT",url:service.portalURL+"calls/"+encodeURIComponent(call.connectionId)+"/retrieve",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(response){$log.info("[telephonyService] retrieveCall success : "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(call.contact.phone)+" Call ("+call+")"),call.setConnectionId(response.data.data.callId),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.ACTIVE),call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve()}),(function(response){var error=errorHelperService.handleError(response);service.deleteCallIfInvalid(error,call),reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"retrieveCall"))}))}}))},service.deflectCallToVM=function(call){return $q((function(resolve,reject){if(call){if(!service.isVMDeflectCallAllowed){var profileError=new Error("deflectCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}$log.info("[telephonyService] deflectCallToVM "+call.contact.nameForLogs),service.isSipWise()?service.telephonyServiceSipWise.deflectCallSipWise(service,call,service.voicemailNumber).then((function(){resolve()}),(function(error){reject(error)})):$http({method:"PUT",url:service.portalURL+"calls/"+encodeURIComponent(call.connectionId)+"/deflect",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:{calleeExtNumber:"",calleeIntNumber:service.voicemailNumber,calleeShortNumber:service.voicemailNumber,calleePbxId:service.pbxId}}).then((function(){$log.info("[telephonyService] deflectCall success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"deflectCallToVM"))}))}else resolve(call)}))},service.deflectCallToNumber=function(call,number){return $q((function(resolve,reject){if(call&&number){var profileError;if(!service.isVMDeflectCallAllowed)return(profileError=new Error("deflectCall failure - Not Allowed")).status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError);$log.info("[telephonyService] deflectCallToNumber "+call.contact.nameForLog),service.isSipWise()?service.telephonyServiceSipWise.deflectCallSipWise(service,call,number).then((function(){resolve()}),(function(error){reject(error)})):((profileError=new Error("deflectCall failure - Not Allowed")).status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),reject(profileError))}else resolve(call)}))},service.transfertCall=function(activeCall,heldCall){return $q((function(resolve,reject){if(activeCall&&heldCall){if(!service.isTransferAllowed){var profileError=new Error("transferCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if($log.info("[telephonyService] transfertCall held("+heldCall.contact.displayName+") to active("+activeCall.contact.displayName+")"),service.isSipWise())return service.telephonyServiceSipWise.transfertCallSipWise(service,activeCall,heldCall);$http({method:"PUT",url:service.portalURL+"calls/"+encodeURIComponent(activeCall.connectionId)+"/transfer/"+encodeURIComponent(heldCall.connectionId),headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(){$log.info("[telephonyService] transferCall success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"transfertCall"))}))}else resolve()}))},service.blindTransfertCall=function(activeCall,calleNumber){return $q((function(resolve,reject){if(activeCall&&calleNumber){var profileError;if(!service.isTransferAllowed||!service.isSipWise())return(profileError=new Error("blind transfertCall failure - Not Allowed")).status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError);if("demo"===service.sipWiseMode())return service.telephonyServiceSipWise.blindTransfertCallSipWise(service,activeCall,calleNumber);$log.info("[telephonyService]  blind Transfert sipWise not implemented"),(profileError=new Error("blind transferCall failure - Not Allowed")).status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),reject(profileError)}else resolve()}))},service.conferenceCall=function(activeCall,heldCall){return $q((function(resolve,reject){if(activeCall&&heldCall){if(!service.isConferenceAllowed){var profileError=new Error("conferenceCall failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if($log.info("TELAPI [telephonyService] conferenceCall "+activeCall.connectionId+" ("+activeCall.contact.displayName+") and "+heldCall.connectionId+" ("+heldCall.contact.displayName+")"),service.isSipWise())return service.telephonyServiceSipWise.conferenceCallSipWise(service,activeCall,heldCall);$http({method:"PUT",url:service.portalURL+"calls/"+encodeURIComponent(activeCall.connectionId)+"/conference/"+encodeURIComponent(heldCall.connectionId),headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(){$log.info("[telephonyService] conferenceCall success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"conferenceCall"))}))}else resolve()}))},service.sipWiseForwardToDevice=function(phoneNumber,destType,forwardType){return $q((function(resolve,reject){if($log.info("[telephonyService] sipWiseforwardToDevice : "+phoneNumber+" / destType = "+destType+" / fwType = "+forwardType),!service.isForwardEnabled){var profileError=new Error("sipWiseforwardToDevice failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePro===phoneNumber||_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phoneProCan===phoneNumber||_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePbx===phoneNumber){var errorMessage="sipWiseforwardToDevice failure: impossible to forward its own phone number";return $log.error("[telephonyService] "+errorMessage),void reject(new Error(errorMessage))}return phoneNumber&&forwardType&&""!==forwardType&&destType&&""!==destType?service.isSipWise()?void service.telephonyServiceSipWise.forwardToDeviceSipWise(service,phoneNumber,destType,forwardType).then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"forwardToDevice"))})):(errorMessage="sipWiseforwardToDevice not implemented if not sipWise case",$log.error("[telephonyService] "+errorMessage),void reject(new Error(errorMessage))):(errorMessage="sipWiseforwardToDevice failure: bad parameters",$log.error("[telephonyService] "+errorMessage),void reject(new Error(errorMessage)))}))},service.sipWiseCancelForward=function(forwardType){return $q((function(resolve,reject){if($log.info("[telephonyService] sipWiseCancelForward :  fwType = "+forwardType),!service.isForwardEnabled){var profileError=new Error("cancelForward failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(!service.isSipWise()){var errorMessage="sipWiseCancelForward not implemented if not sipWise case";return $log.error("[telephonyService] "+errorMessage),void reject(new Error(errorMessage))}service.telephonyServiceSipWise.cancelForwardSipWise(service,forwardType).then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"sipWiseCancelForward"))}))}))},service.forwardToDevice=function(phoneNumber){return $q((function(resolve,reject){if($log.info("[telephonyService] forwardToDevice : "+phoneNumber),!service.isForwardEnabled){var profileError=new Error("forwardToDevice failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePro===phoneNumber||_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phoneProCan===phoneNumber||_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePbx===phoneNumber){var errorMessage="forwardToDevice failure: impossible to forward its own phone number";return $log.error("[telephonyService] "+errorMessage),void reject(new Error(errorMessage))}service.isSipWise()?_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getOrCreateContact(null,phoneNumber).then((function(contact){var phoneInfo=service.getPhoneInfo(contact,phoneNumber),destType="externalNumber";""!==phoneInfo.longNumber?(destType="externalNumber",phoneNumber=phoneInfo.longNumber):(destType="internalNumber",phoneNumber=phoneInfo.shortNumber),service.telephonyServiceSipWise.forwardToDeviceSipWise(service,phoneNumber,destType,"immediate").then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"forwardToDevice"))}))})):_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getOrCreateContact(null,phoneNumber).then((function(contact){var phoneInfo=service.getPhoneInfo(contact,phoneNumber);$http({method:"PUT",url:service.portalURL+"forward",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:{calleeExtNumber:phoneInfo.longNumber,calleeIntNumber:phoneInfo.internalNumber,calleeShortNumber:phoneInfo.shortNumber,calleePbxId:phoneInfo.pbxId,calleeDisplayName:contact.displayName}}).then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"forwardToDevice"))}))}))}))},service.forwardToVoicemail=function(callForwardType){return $q((function(resolve,reject){if($log.info("[telephonyService] forwardToVoicemail"),!service.voiceMailFeatureEnabled||!service.isForwardEnabled){var profileError=new Error("forwardToVoicemail failure - voicemail/forward feature not enabled");return profileError.status=profileError.errorDetailsCode="404",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(service.isSipWise()){var forwardType=callForwardType||"immediate";service.telephonyServiceSipWise.forwardToDeviceSipWise(service,service.voicemailNumber,"voicemail",forwardType).then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"forwardToVoicemail"))}))}else $http({method:"PUT",url:service.portalURL+"forward",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:{calleeExtNumber:"",calleeIntNumber:service.voicemailNumber,calleePbxId:service.pbxId}}).then((function(){$log.info("[telephonyService] forwardToVoicemail success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"forwardToVoicemail"))}))}))},service.cancelForward=function(){return $q((function(resolve,reject){if($log.info("[telephonyService] cancelForward"),!service.isForwardEnabled){var profileError=new Error("cancelForward failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(service.isSipWise()){service.telephonyServiceSipWise.cancelForwardSipWise(service,"immediate").then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"cancelForward"))}))}else _src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePbx?$http({method:"PUT",url:service.portalURL+"forward",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:{calleeExtNumber:"",calleeIntNumber:"CANCELFORWARD",calleePbxId:service.pbxId}}).then((function(){$log.info("[telephonyService] cancelForward success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"cancelForward"))})):reject()}))},service.getForwardStatus=function(){return $q((function(resolve,reject){if(!service.isForwardEnabled){var profileError=new Error("getForwardStatus failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(service.starting||service.started){if(service.isSipWise())return void service.telephonyServiceSipWise.getForwardStatusSipWise(service).then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"getForwardStatus"))}));$http({method:"GET",url:service.portalURL+"forward",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(){$log.info("[telephonyService] getForwardStatus success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"getForwardStatus"))}))}else reject(new Error("getForwardStatus failure - Telephony not started"))}))},service.getForwardObject=function(){return service.forwardObject},service.isOverFlowStatusActivated=function(){return $q((function(resolve,reject){service.isSipWise()?service.telephonyServiceSipWise.getOverFlowStatusSipWise(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.systemId,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phoneNumberId).then((function(response){resolve(response.activate)}),(function(error){reject(error)})):resolve(!1)}))},service.nomadicLogin=function(phoneNumber,isUnchangeableNumber,NotTakeIntoAccount){return $q((function(resolve,reject){if(!service.isNomadicEnabled||!service.nomadicObject.featureActivated){var profileError=new Error("nomadicLogin failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePro===phoneNumber||_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phoneProCan===phoneNumber||_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.phonePbx===phoneNumber){var errorMessage="nomadicLogin failure: impossible to use its own phone number like nomadic phone";return $log.error("[telephonyService] "+errorMessage),void reject(new Error(errorMessage))}$log.info("[telephonyService] nomadicLogin : "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(phoneNumber)),NotTakeIntoAccount=NotTakeIntoAccount||!1,isUnchangeableNumber=isUnchangeableNumber||!1,service.nomadicAnswerNotTakedIntoAccount=NotTakeIntoAccount,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getOrCreateContact(null,phoneNumber).then((function(contact){var phoneInfo=service.getPhoneInfo(contact,phoneNumber);$http({method:"PUT",url:service.portalURL+"nomadic/login",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:{destinationExtNumber:phoneInfo.longNumber,destinationIntNumber:phoneInfo.internalNumber,destinationShortNumber:phoneInfo.shortNumber,destinationRainbowNumber:isUnchangeableNumber?phoneNumber:"",destinationPbxId:phoneInfo.pbxId,destinationDisplayName:contact.displayName,destinationCountry:contact.country}}).then((function(){$log.info("[telephonyService] nomadicLogin success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"nomadicLogin"))}))}))}))},service.nomadicLoginOnOfficePhone=function(){return $q((function(resolve,reject){if(!service.isNomadicEnabled||!service.nomadicObject.featureActivated){var profileError=new Error("nomadicLoginOnOfficePhone failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}$log.info("[telephonyService] nomadicLoginOnOfficePhone"),$http({method:"PUT",url:service.portalURL+"nomadic/login",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(){$log.info("[telephonyService] nomadicLoginOnOfficePhone success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"nomadicLoginOnOfficePhone"))}))}))},service.nomadicLogout=function(){return $q((function(resolve,reject){if(!service.isNomadicEnabled||!service.nomadicObject.featureActivated){var profileError=new Error("nomadicLogout failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}$log.info("[telephonyService] nomadicLogout"),$http({method:"PUT",url:service.portalURL+"nomadic/logout",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(){$log.info("[telephonyService] nomadicLogout success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"nomadicLogout"))}))}))},service.getNomadicStatus=function(){return $q((function(resolve,reject){if(service.isSipWise()){$log.info("[telephonyService] getNomadicStatus -- SipWise bypass Nomadic");resolve()}else{if(!service.isNomadicEnabled){var profileError=new Error("getNomadicStatus failure - Not Allowed");return profileError.status=profileError.errorDetailsCode="403",$log.error("[telephonyService] "+profileError.message),void reject(profileError)}service.starting||service.started?$http({method:"GET",url:service.portalURL+"nomadic",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader()}).then((function(response){$log.info("[telephonyService] getNomadicStatus success"),service.updateNomadicData(response.data.data),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"getNomadicStatus"))})):reject(new Error("getNomadicStatus failure - Telephony not started"))}}))},service.setNomadicState=function(){return $q((function(resolve,reject){$log.info("[telephonyService] setNomadicState"),$http({method:"PUT",url:service.portalURL+"nomadic/state",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:{makeCallInitiatorIsMain:"true"}}).then((function(){$log.info("[telephonyService] setNomadicState success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"setNomadicState"))}))}))},service.updateNomadicData=function(response){var destination=response.destination?_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_6___default()(response.destination):"";$log.info("[telephonyService] updateNomadicData destination: "+destination+" featureActivated: "+response.featureActivated+" makeCallInitiatorIsMain: "+response.makeCallInitiatorIsMain+" modeActivated: "+response.modeActivated+" monodevice: "+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.isVirtualTerm+" NomadicInitialized: "+response.nomadicModeInitialized);var nomadicObjectOrg=JSON.parse(JSON.stringify(service.nomadicObject));service.nomadicObject.featureActivated="true"===response.featureActivated,service.nomadicObject.modeActivated="true"===response.modeActivated,service.nomadicObject.destination=response.destination,service.nomadicObject.makeCallInitiatorIsMain="true"===response.makeCallInitiatorIsMain,void 0===response.nomadicModeInitialized?service.nomadicObject.nomadicModeInitialized=!0:service.nomadicObject.nomadicModeInitialized="true"===response.nomadicModeInitialized;var makeCallInitiatorIsMainChanged=nomadicObjectOrg.makeCallInitiatorIsMain!==service.nomadicObject.makeCallInitiatorIsMain;service.nomadicAnswerNotTakedIntoAccount||$rootScope.$broadcast("ON_CALL_NOMADIC_EVENT",service.nomadicObject),service.nomadicAnswerNotTakedIntoAccount=!1;var webrtcGatewayService=$injector.get("webrtcGatewayService");if(!service.nomadicObject.featureActivated||service.nomadicObject.nomadicModeInitialized||""!==service.nomadicObject.destination&&void 0!==service.nomadicObject.destination||!webrtcGatewayService.isMediaPillarConfigured())if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.isVirtualTerm||!service.nomadicObject.featureActivated||service.nomadicObject.nomadicModeInitialized||""!==service.nomadicObject.destination&&void 0!==service.nomadicObject.destination||!_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobileProCan&&!_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobilePerso)!_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.isVirtualTerm||!service.nomadicObject.featureActivated||service.nomadicObject.nomadicModeInitialized||""!==service.nomadicObject.destination&&void 0!==service.nomadicObject.destination||!_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobileProCan&&!_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobilePerso?_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.isVirtualTerm&&service.nomadicObject.featureActivated&&!service.nomadicObject.makeCallInitiatorIsMain&&!service.nomadicObject.modeActivated&&webrtcGatewayService.isMediaPillarConfigured()&&(defaultNumber=webrtcGatewayService.getMyMediaPillarRemoteExtension(),service.nomadicLogin(defaultNumber)):(defaultNumber=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobileProCan?_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobileProCan:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobilePerso,service.nomadicLogin(defaultNumber));else{var defaultNumber=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobileProCan?_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobileProCan:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.mobilePerso;service.nomadicLogin(defaultNumber,!1,!0).then((function(){service.nomadicLoginOnOfficePhone()}))}else{defaultNumber=webrtcGatewayService.getMyMediaPillarRemoteExtension();service.nomadicLogin(defaultNumber)}return makeCallInitiatorIsMainChanged},service.getNomadicObject=function(){return service.nomadicObject},service.getNomadicDestination=function(){return service.nomadicObject.destination},service.sendDtmf=function(call,dtmf){return $q((function(resolve,reject){if(call&&dtmf){if($log.info("[telephonyService] sendDtmf for call "+call.id),service.isSipWise())return void service.telephonyServiceSipWise.sendDtmfSipWise(service,call,dtmf).then((function(){resolve()}),(function(error){reject(error)}));$http({method:"PUT",url:service.portalURL+"calls/"+encodeURIComponent(call.connectionId)+"/dtmf",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:{dtmf:dtmf}}).then((function(){$log.info("[telephonyService] sendDtmf success"),$rootScope.$broadcast("ON_DTMF_SENT",dtmf),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[telephonyService] "+errorHelperService.getErrorFullMessage(response,"sendDtmf"))}))}else reject()}))},service.clearCall=function(call,nobroadcast){if(call)$log.info("[telephonyService] clearCall for call id: "+call.id),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_1__.Call.Status.UNKNOWN),nobroadcast||(call.publish("ON_CALL_UPDATED_EVENT"),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)),call.contact&&delete service.calls[call.contact.id],call.getCurrentCalled()&&call.setCurrentCalled(null);else{$log.error("[telephonyService]clearCall failure : call null")}},service.startAsPhoneNumber=function(phoneNumber){var cleanPhoneNumber=phoneNumber.trim().split(".").join("");if(cleanPhoneNumber.length<2)return!1;var match=cleanPhoneNumber.match(/^(\+|\d|#|\*|\(|\)|\.|-|\u2013|\u2014|\s|\/)*$/);return!!match&&match[0]===cleanPhoneNumber},service.updateContactFromOutlookInfos=function(__contact,__phoneNumber,__reload,__mode){return $log.info("[telephonyService] default updateContactFromOutlookInfos"),$q.reject()},service.isSipWiseRoot=function(){return"RVCP Subscriber"===_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.systDeviceName},service.setSipWise=function(condition){sipWise=condition},service.isSipWise=function(){return sipWise},service.getSipWiseDevicesList=function(){return service.isSipWise()?service.telephonyServiceSipWise.getDevicesListSipWise():($log.info("[telephonyService] Anomaly not a sipWise situation"),NULL)},service.getSipWiseDevicesListCurrent=function(){$log.info("[telephonyService] getSipWiseDevicesListCurrent"),service.isSipWise()?service.telephonyServiceSipWise.getUserRoutingInfo(service):$log.info("[telephonyService] getSipWiseDevicesListCurrent Anomaly not a sipWise situation")},service.setSipWiseDevicesCurrent=function(currentDeviceId){service.isSipWise()?service.telephonyServiceSipWise.putUserRoutingInfo(service,currentDeviceId,null):$log.info("[telephonyService] setSipWiseDevicesMain Anomaly not a sipWise situation")},service.setSipWiseRingingOfficePhone=function(addOfficePhone){service.isSipWise()?service.telephonyServiceSipWise.setRingingDeviceSipWise(service,addOfficePhone):$log.info("[telephonyService] setSipWiseRingingOfficePhone Anomaly not a sipWise situation")},service.sipWiseUserGroupsDataClear=function(){service.sipWiseUserGroupsData.huntingGroupNb=0,service.sipWiseUserGroupsData.managerAssistantNb=0,service.sipWiseUserGroupsData.managerAssistGrId=0,service.sipWiseUserGroupsData.managerId=0,service.sipWiseUserGroupsData.managerName="",service.sipWiseUserGroupsData.managerStatus="",service.sipWiseUserGroupsData.managerForward="unknow",service.sipWiseUserGroupsData.assistantId=0,service.sipWiseUserGroupsData.assistantName="",service.sipWiseUserGroupsData.assistantStatus="",service.sipWiseUserGroupsData.sipWiseUserGroupsList=[]},service.sipWiseUserGroupsDataIsManagerAssistant=function(){return!!(service.isSipWise()&&service.sipWiseUserGroupsData.managerAssistantNb>0)&&(1===service.sipWiseUserGroupsData.managerAssistantNb||($log.info("[telephonyService] sipWiseUserGroupsDataIsManagerAssistant Anomaly not 1:1 Manager/Assistant"),!1))},service.sipWiseManAssistGetMyRole=function(){var myRole="";if(service.isSipWise()&&service.sipWiseUserGroupsData.managerAssistantNb>0){var foundGr=service.sipWiseUserGroupsData.sipWiseUserGroupsList.find((function(elt){return"manager_assistant"===elt.type}));if(foundGr){var me=foundGr.members.find((function(elt){return elt.displayName===_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.displayName}));me&&(myRole=me.roles[0])}}return myRole},service.sipWiseManAssistIamManagerForwarded=function(){var managerForward="unknown",result=!1;return service.isSipWise()&&1===service.sipWiseUserGroupsData.managerAssistantNb&&"manager"===service.sipWiseManAssistGetMyRole()&&(managerForward=service.sipWiseUserGroupsData.managerForward),"activated"===managerForward&&(result=!0),result},service.getSipWiseUserGroupsData=function(){return service.sipWiseUserGroupsData},service.getSipWiseUserGroups=function(){return $q((function(resolve,reject){if($log.info("[telephonyService] getSipWiseUserGroups"),!service.isSipWise()){return $log.error("[telephonyService] sipwise getUserGroups -- not a sipWise situation"),void reject()}service.telephonyServiceSipWise.getUserGroups(service).then((function(){return service.telephonyServiceSipWise.getAllUserGroupsForwards(service)})).then((function(){$rootScope.$broadcast("ON_TEL_USER_GROUPS_EVENT",service.sipWiseUserGroupsData),resolve()})).catch((function(error){$log.info("[telephonyService] sipwise getSipWiseUserGroups CATCH");var errorMessage="sipwise getUserGroups -- "+error.message;$log.error("[telephonyService] "+errorMessage),reject(error)}))}))},service.getSipWiseUserGroupsForwards=function(groupId){return $q((function(resolve,reject){if($log.info("[telephonyService] getSipWiseUserGroupsForwards"),!service.isSipWise()){return $log.error("[telephonyService] sipwise getUserGroupsForward -- not a sipWise situation"),void reject()}service.telephonyServiceSipWise.getUserGroupsForwards(service,groupId).then((function(){$rootScope.$broadcast("ON_TEL_USER_GROUPS_EVENT",service.sipWiseUserGroupsData),resolve()})).catch((function(error){$log.info("[telephonyService] sipwise getSipWiseUserGroupsForwards CATCH");var errorMessage="sipwise getUserGroupsForwards -- "+error.message;$log.error("[telephonyService] "+errorMessage),reject(error)}))}))},service.setSipWiseUserGroupsForwards=function(groupId,callForwardType,forwardData){return $q((function(resolve,reject){if($log.info("[telephonyService] setSipWiseUserGroupsForwards"),!service.isSipWise()){return $log.error("[telephonyService] sipwise setSipWiseUserGroupsForwards -- not a sipWise situation"),void reject()}service.telephonyServiceSipWise.setUserGroupsForwards(service,groupId,callForwardType,forwardData).then((function(){resolve()})).catch((function(error){$log.info("[telephonyService] setSipWiseUserGroupsForwards CATCH");var errorMessage="sipwise setSipWiseUserGroupsForwards -- "+error.message;$log.error("[telephonyService] "+errorMessage),reject(error)}))}))},service.sipWiseManAssistActivat=function(Activ,groupName){var groupNotFound=!0,groupId=0;if($log.info("[telephonyService] sipWiseManAssistActivat  Activ : "+Activ+" groupName : "+groupName),0!==service.sipWiseUserGroupsData.managerAssistantNb){if(groupName||(groupName=""),service.sipWiseUserGroupsData.sipWiseUserGroupsList.forEach((function(group){groupNotFound&&"manager_assistant"===group.type&&(groupName!==group.name&&""!==groupName||(groupId=group.id,groupNotFound=!1))})),!groupNotFound){var forwardData={destinationType:"managersecretary"};forwardData.activate=Activ,service.setSipWiseUserGroupsForwards(groupId,"immediate",forwardData)}}else{$log.error("[telephonyService] sipwise sipWiseManAssistActivat -- no Manager Assistant group available")}},service.sipWiseEmergencyCallDataClear=function(){if(!service.isSipWiseRoot()){return $log.error("[telephonyService] sipWiseEmergencyCallDataClear -- not a sipWise situation"),null}service.sipWiseEmergencyCallData.WGEmergencyCallForbidden=!1,service.sipWiseEmergencyCallData.emergencyNuList=[],service.sipWiseEmergencyCallData.serverData=null},service.getSipWiseEmergencyCallData=function(){if(!service.isSipWiseRoot()){return $log.error("[telephonyService] getSipWiseEmergencyCallData -- not a sipWise situation"),null}return service.sipWiseEmergencyCallData},service.fetchSipWiseEmergencyCallData=function(){return $q((function(resolve,reject){if($log.info("[telephonyService] fetchSipWiseEmergencyCallData"),!service.isSipWise()){return $log.error("[telephonyService] fetchSipWiseEmergencyCallData -- not a sipWise situation"),void reject()}service.telephonyServiceSipWise.getEmergencyCallDataSipWise(service).then((function(){resolve()})).catch((function(error){$log.info("[telephonyService] fetchSipWiseEmergencyCallData CATCH");var errorMessage="fetchSipWiseEmergencyCallData -- "+error.message;$log.error("[telephonyService] "+errorMessage),reject(error)}))}))},service.sipWiseMode=function(){var mode=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_2___default.a.getSetting("sipWiseMode");return sipWise||(mode=!1),mode},service.resetAllSipWiseCall=function(){if(service.isSipWise()){var iq=$iq({type:"set",to:service.userJidTel+"/pcg2"}).c("telephony",{xmlns:"urn:xmpp:pbxagent:telephony:1"}).c("service").c("deleteCalls",{forced:"true"});_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_4___default.a.sendIQ(iq,6e4).then((function(data){$log.info("[telephonyService] resetAllSipWiseCall : try to reset all ghost calls !"),console.error(data)})).catch((function(error){var errorMessage="resetAllSipWiseCall failure : "+error.message;$log.error("[telephonyService]"+errorMessage)}))}},service.oxopbxsUpdateIndividualPassword=function(newPassword){var url=config.restServerUrl+"/api/rainbow/oxopbxprovisioning/v1.0/oxopbxs/"+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.systemId+"/subscribers/"+_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.dbId+"/password";return new Promise((function(resolve,reject){var reqData={password:newPassword};$http({method:"PUT",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_3___default.a.getRequestHeader(),data:reqData}).then((function(response){$log.info("[telephonyService] oxopbxsUpdateIndividualPassword : success"),resolve(response)}),(function(response){var error=errorHelperService.handleError(response);return $log.error("[telephonyService] oxopbxsUpdateIndividualPassword : error : "+response.data.errorDetails),reject(error)}))}))},service.setPgiCallObject=function(numberCalled,dtmfToSend,roomJid,callId){service.currentPgiObject={numberCalled:numberCalled,dtmfToSend:dtmfToSend,roomJid:roomJid,callId:callId}}}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_models_call_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_src_utils_promiseQueue__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(49),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2__),_src_models_contact_model__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(43),_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14),_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5__),_src_services_pgiConference_pgiConference_service__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(58),_src_services_pgiConference_pgiConference_service__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_src_services_pgiConference_pgiConference_service__WEBPACK_IMPORTED_MODULE_6__);angular.module("rainbow").factory("TelephonyServiceEventHandler",["$log","$q","$rootScope","$interval","$injector",function($log,$q,$rootScope,$interval,$injector){function TelephonyServiceEventHandler(telephonyService){this.telephonyService=telephonyService,this.promiseQueue=_src_utils_promiseQueue__WEBPACK_IMPORTED_MODULE_1__.PromiseQueue.create()}return TelephonyServiceEventHandler.create=function(telephonyService){return new TelephonyServiceEventHandler(telephonyService)},TelephonyServiceEventHandler.CallFailureLabels={DESTNOTOBTAINABLE:"outOfService",DONOTDISTURB:"dnd",TRUNKSBUSY:"trunksbusy",BUSY:"busy"},TelephonyServiceEventHandler.prototype.existingCall=function(callId){var exist=this.telephonyService.calls[callId];return $log.debug("[TelephonyServiceEventHandler] existingCall -- "+callId+" => "+exist),exist},TelephonyServiceEventHandler.prototype.onCallserviceMessageReceived=function(stanza){try{var stanzaElem=$(stanza),that=this;if("Offline Storage"===stanzaElem.find("delay").text())return!0;var actionElem=stanzaElem.find("callservice").children(),tagNames=actionElem.prop("tagName").split(":"),actionElemName=tagNames[tagNames.length-1].toLowerCase(),callId=actionElem.attr("callId"),callIdForLogs=callId?" -- "+callId:"",evtDeviceType=actionElem.attr("deviceType"),displayDeviceType=evtDeviceType?" -- "+evtDeviceType:"",oldCallId=actionElem.attr("oldCallId");oldCallId=oldCallId?" -- old "+oldCallId:"",actionElem.attr("correlatorData");var globalCallId=actionElem.attr("globalCallId");globalCallId&&(globalCallId=globalCallId),evtDeviceType||(evtDeviceType="MAIN");var cfgNomadic=this.telephonyService.getNomadicObject(),cfgOfficePhone=!cfgNomadic||cfgNomadic.makeCallInitiatorIsMain||!cfgNomadic.modeActivated;if(!["messaging","voicemessages","forwarded","nomadicstatus","opendesktop"].includes(actionElemName)&&("MAIN"===evtDeviceType&&!cfgOfficePhone||"SECONDARY"===evtDeviceType&&cfgOfficePhone)&&!that.existingCall(callId))return $log.info("[TelephonyServiceEventHandler] onCallserviceMessageReceived -- "+actionElemName.toUpperCase()+callIdForLogs+oldCallId+displayDeviceType+" => IGNORED"),!0;switch($log.info("[TelephonyServiceEventHandler] onCallserviceMessageReceived -- "+actionElemName.toUpperCase()+callIdForLogs+oldCallId+displayDeviceType),actionElemName){case"initiated":this.promiseQueue.add((function(){return that.onInitiatedEvent(actionElem)}));break;case"originated":this.promiseQueue.add((function(){return that.onOriginatedEvent(actionElem)}));break;case"delivered":this.promiseQueue.add((function(){return that.onDeliveredEvent(actionElem)}));break;case"established":this.promiseQueue.add((function(){return that.onEstablishedEvent(actionElem)}));break;case"retrievecall":this.promiseQueue.add((function(){return that.onRetrieveCallEvent(actionElem)}));break;case"queued":this.promiseQueue.add((function(){return that.onQueuedEvent(actionElem)}));break;case"holdcall":case"held":this.promiseQueue.add((function(){return that.onHeldEvent(actionElem)}));break;case"diverted":this.promiseQueue.add((function(){return that.onDivertedEvent(actionElem)}));break;case"transfercall":case"transferred":this.promiseQueue.add((function(){return that.onTransferEvent(actionElem)}));break;case"conferenced":this.promiseQueue.add((function(){return that.onConferenceEvent(actionElem)}));break;case"connectioncleared":this.promiseQueue.add((function(){return that.onClearCallEvent(actionElem)}));break;case"failed":this.promiseQueue.add((function(){return that.onFailCallEvent(actionElem)}));break;case"updatecall":this.promiseQueue.add((function(){return that.onUpDateCallEvent(actionElem)}));break;case"forwarded":this.promiseQueue.add((function(){return that.onCallForwardedEvent(actionElem)}));break;case"callsubject":this.promiseQueue.add((function(){return that.onCallSubjectEvent(actionElem)}));break;case"nomadicstatus":this.promiseQueue.add((function(){return that.onCallNomadicEvent(actionElem)}));break;case"opendesktop":$log.info("[TelephonyServiceEventHandler] openDesktop detected ")}return!0}catch(error){return $log.error("[TelephonyServiceEventHandler] onCallserviceMessageReceived -- failure -- "+error.message),!0}},TelephonyServiceEventHandler.prototype.onInitiatedEvent=function(initiatedElem){$log.info("[TelephonyServiceEventHandler] onInitiatedEvent");var that=this;return this.getCall(initiatedElem,!1,!0).then((function(call){try{var deviceState=initiatedElem.attr("deviceState"),newConnectionId=initiatedElem.attr("newCallId"),cause=initiatedElem.attr("cause");return void 0!==newConnectionId?that.getOrCreateCall(newConnectionId).then((function(newCall){$log.info("[TelephonyServiceEventHandler] onInitiatedEvent : changed call id from "+call.id+" to "+newConnectionId),that.computeCallRelevancy(initiatedElem,newCall),"LCI_CONNECTED"===deviceState?newCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE):newCall.setStatus(call.status),newCall.setContact(call.contact),newCall.isOwner=call.isOwner;var confSession=_src_services_pgiConference_pgiConference_service__WEBPACK_IMPORTED_MODULE_6___default.a.getConferenceSessionWithConnId(call.connectionId);confSession&&(confSession.callId=newConnectionId),call.isMediaPillarCall()&&$injector.get("webrtcGatewayService").replaceCallRefs(newCall,call),that.telephonyService.clearCall(call),that.sendCallUpdateEvent(call),that.sendCallUpdateEvent(newCall),delete that.telephonyService.calls[call.id]})):(that.computeCallRelevancy(initiatedElem,call),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.FeaturesEnum.TELEPHONY_MAKE_CALL_CTI_APP)&&call.isSecondary&&!call.isOwner&&"MAKECALL"===cause||"CALLBACK"===cause?($log.info("[TelephonyServiceEventHandler] TELEPHONY_MAKE_CALL_CTI_APP - 3pcc activated"),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact("","000").then((function(contact){call.setContact(contact),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_INCOMMING),call.startDate=null,call.vm=!1,call.lastCause=cause||"",that.sendCallUpdateEvent(call,initiatedElem)}))):that.sendCallUpdateEvent(call)),$q.when()}catch(error){var errorMessage="onInitiatedEvent -- "+error.message;return $log.error("[TelephonyServiceEventHandler] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandler.prototype.onOriginatedEvent=function(originatedElem){$log.info("[TelephonyServiceEventHandler] onOriginatedEvent");var that=this;return this.getCall(originatedElem,!1,!0).then((function(call){try{var jid=originatedElem.attr("endpointIm"),phoneNumber=originatedElem.attr("endpointTel"),newConnectionId=originatedElem.attr("newCallId"),currentCalled={contactPhoneNumber:"",contact:call.contact,participantsPhoneNumbers:null,participants:null};return jid||phoneNumber?currentCalled.contactPhoneNumber=phoneNumber||"":call.contact&&call.contact.temp&&(currentCalled.contactPhoneNumber=call.contact.id),call.setCurrentCalled(currentCalled),void 0!==newConnectionId?that.getOrCreateCall(newConnectionId,jid,phoneNumber).then((function(newCall){$log.info("[TelephonyServiceEventHandler] onOriginatedEvent : changed call id from "+call.id+" to "+newConnectionId),that.computeCallRelevancy(originatedElem,newCall),newCall.setStatus(call.status),newCall.setContact(call.contact),newCall.setCurrentCalled(currentCalled),newCall.isOwner=call.isOwner;var confSession=_src_services_pgiConference_pgiConference_service__WEBPACK_IMPORTED_MODULE_6___default.a.getConferenceSessionWithConnId(call.connectionId);confSession&&(confSession.callId=newConnectionId),call.isMediaPillarCall()&&$injector.get("webrtcGatewayService").replaceCallRefs(newCall,call),that.telephonyService.clearCall(call),that.sendCallUpdateEvent(call),that.sendCallUpdateEvent(newCall),delete that.telephonyService.calls[call.id]})):that.sendCallUpdateEvent(call),$q.when()}catch(error){var errorMessage="onOriginatedEvent -- "+error.message;return $log.error("[TelephonyServiceEventHandler] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandler.prototype.onDeliveredEvent=function(deliveredElem){$log.info("[TelephonyServiceEventHandler] onDeliveredEvent");var that=this;return this.getCall(deliveredElem).then((function(call){try{if(that.computeCallRelevancy(deliveredElem,call),call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.QUEUED_INCOMMING)return $q.resolve();var type=deliveredElem.attr("type"),jid=deliveredElem.attr("endpointIm"),phoneNumber=deliveredElem.attr("endpointTel"),cause=deliveredElem.attr("cause"),correlatorData=deliveredElem.attr("correlatorData")?deliveredElem.attr("correlatorData"):"",globalCallId=deliveredElem.attr("globalCallId")?deliveredElem.attr("globalCallId"):"";return call.setStatus("outgoing"===type?_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_OUTGOING:_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_INCOMMING),call.startDate=null,call.vm=!1,call.lastCause=cause||"",call.correlatorData=correlatorData,call.globalCallId=globalCallId,that.updateCallContact(jid,phoneNumber,deliveredElem,call)}catch(error){var errorMessage="onDeliveredEvent -- "+error.message;return $log.error("[TelephonyServiceEventHandler] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandler.prototype.onEstablishedEvent=function(establishedElem){$log.info("[TelephonyServiceEventHandler] onEstablishedEvent");var that=this;return this.getCall(establishedElem).then((function(call){try{that.computeCallRelevancy(establishedElem,call);var jid=establishedElem.attr("endpointIm"),phoneNumber=establishedElem.attr("endpointTel"),connectionId=establishedElem.attr("callId");if(call.contact&&call.contact.id)return call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),call.setConnectionId(connectionId),that.sendCallUpdateEvent(call,establishedElem),that.updateCallContact(jid,phoneNumber,establishedElem,call);if(!(call.participants&&call.participants.length>0))return $log.info("[TelephonyServiceEventHandler] onEstablishedEvent, no call contact / no participants"),jid||phoneNumber||(phoneNumber="****"),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact(jid,phoneNumber).then((function(contact){return call.setContact(contact),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),currentCalled={contactPhoneNumber:phoneNumber,contact:contact},call.setCurrentCalled(currentCalled),that.sendCallUpdateEvent(call,establishedElem),$q.when()}));for(var contactRecovered=null,i=0;i<call.participants.length&&!contactRecovered;i++)(call.participants[i].id===jid||call.currentCalled.participantsPhoneNumbers&&call.currentCalled.participantsPhoneNumbers.length>0&&call.currentCalled.participantsPhoneNumbers[i]===phoneNumber)&&(contactRecovered=call.participants[i]);call.participants=[],call.isConference=!1;var currentCalled=call.getCurrentCalled();return contactRecovered?(call.setContact(contactRecovered),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),currentCalled={contactPhoneNumber:phoneNumber,contact:contactRecovered},call.setCurrentCalled(currentCalled),that.sendCallUpdateEvent(call,establishedElem),$q.when()):(jid||phoneNumber||(phoneNumber="****"),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact(jid,phoneNumber).then((function(contact){return call.setContact(contact),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),currentCalled={contactPhoneNumber:phoneNumber,contact:contact},call.setCurrentCalled(currentCalled),that.sendCallUpdateEvent(call,establishedElem),$q.when()})))}catch(error){var errorMessage="onEstablishedEvent -- "+error.message;return $log.error("[TelephonyServiceEventHandler] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandler.prototype.onRetrieveCallEvent=function(retrieveElem){$log.info("[TelephonyServiceEventHandler] onRetrieveCallEvent");var that=this;return this.getCall(retrieveElem,!0).then((function(call){call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),that.sendCallUpdateEvent(call,retrieveElem)}))},TelephonyServiceEventHandler.prototype.onClearCallEvent=function(clearElem){var that=this,connectionId=clearElem.attr("callId"),callId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getIdFromConnectionId(connectionId);return $log.info("[TelephonyServiceEventHandler] onClearCallEvent, connectionId: "+connectionId),this.telephonyService.calls[callId]?this.getCall(clearElem).then((function(call){that.computeCallRelevancy(clearElem,call),that.telephonyService.clearCall(call,!0),that.sendCallUpdateEvent(call,clearElem)})):($log.info("[TelephonyServiceEventHandler] onClearCallEvent, no call for connectionId: "+connectionId),$q.resolve())},TelephonyServiceEventHandler.prototype.onHeldEvent=function(heldElem){$log.info("[TelephonyServiceEventHandler] onHeldEvent");var that=this;return this.getCall(heldElem,!0).then((function(call){try{var connectionId=heldElem.attr("callId");return _src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getDeviceIdFromConnectionId(call.connectionId)===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getDeviceIdFromConnectionId(connectionId)?call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.HOLD):call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.PUT_ON_HOLD),that.sendCallUpdateEvent(call,heldElem),$q.when()}catch(error){var errorMessage="onHeldEvent -- "+error.message;return $log.error("[TelephonyServiceEventHandler] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandler.prototype.onQueuedEvent=function(queuedElem){$log.info("[TelephonyServiceEventHandler] onQueuedEvent");var that=this,cause=queuedElem.attr("cause");return"PARK"===cause?($log.warn("[TelephonyServiceEventHandler] onQueuedEvent - ignore PARK cause"),$q.when()):"NEWCALL"===cause?($log.warn("[TelephonyServiceEventHandler] onQueuedEvent - ignore NEWCALL cause"),$q.when()):"CAMPON"!==cause&&this.telephonyService.isOxe?($log.warn("[TelephonyServiceEventHandler] onQueuedEvent - ignore cause not CAMPON  (for oxe attendant res monoLine)"),$q.when()):this.getCall(queuedElem).then((function(call){try{that.computeCallRelevancy(queuedElem,call);var type=queuedElem.attr("type"),jid=queuedElem.attr("endpointIm"),phoneNumber=queuedElem.attr("endpointTel"),status="outgoing"===type?_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.QUEUED_OUTGOING:_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.QUEUED_INCOMMING;return call.setStatus(status),call.startDate=null,call.vm=!1,call.relevantEquipmentId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getDeviceIdFromConnectionId(call.connectionId),that.updateCallContact(jid,phoneNumber,queuedElem,call)}catch(error){var errorMessage="onQueuedEvent -- "+error.message;return $log.error("[TelephonyServiceEventHandler] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandler.prototype.onDivertedEvent=function(divertedElem){$log.info("[TelephonyServiceEventHandler] onDivertedEvent");var oldConnectionId=divertedElem.attr("oldCallId"),oldCallId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getIdFromConnectionId(oldConnectionId),call=this.telephonyService.calls[oldCallId];return call?(this.computeCallRelevancy(divertedElem,call),$injector.get("webrtcGatewayService").isMediaPillarCallCase()?call.isSecondary?this.telephonyService.clearCall(call):this.telephonyService.clearCall(call,!0):this.telephonyService.clearCall(call),this.sendCallUpdateEvent(call,divertedElem),$q.when()):($log.warn("[TelephonyServiceEventHandler] onDivertedEvent - receive divertedEvent on unknown call --- ignored"),$q.when())},TelephonyServiceEventHandler.prototype.onTransferEvent=function(transferElem){$log.info("[TelephonyServiceEventHandler] onTransferEvent");var that=this,activeConnectionId=transferElem.attr("activeCallId"),heldConnectionId=transferElem.attr("heldCallId"),newConnectionId=transferElem.attr("newCallId"),activeCallId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getIdFromConnectionId(activeConnectionId),activeCall=this.telephonyService.calls[activeCallId];if(heldConnectionId){var heldCallId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getIdFromConnectionId(heldConnectionId),heldCall=this.telephonyService.calls[heldCallId];heldCall&&heldCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN),activeCall&&activeCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN),heldCall&&that.sendCallUpdateEvent(heldCall),activeCall&&that.sendCallUpdateEvent(activeCall)}if(newConnectionId){var jid=transferElem.attr("newEndpointIm"),phoneNumber=transferElem.attr("newEndpointTel"),deviceState=transferElem.attr("deviceState");deviceState||(deviceState=transferElem.attr("deviceStatus"));var deviceType=transferElem.attr("deviceType");return deviceType||(deviceType="MAIN"),activeCall&&(activeCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN),that.sendCallUpdateEvent(activeCall)),jid||phoneNumber||(phoneNumber="****"),this.getOrCreateCall(newConnectionId,jid,phoneNumber).then((function(newCall){return deviceState&&"LCI_ALERTING"===deviceState?newCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_INCOMMING):newCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),newCall.relevantEquipmentId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getDeviceIdFromConnectionId(newConnectionId),newCall.isSecondary=deviceType&&"SECONDARY"===deviceType,that.updateCallContact(jid,phoneNumber,transferElem,newCall)}))}return $q.resolve()},TelephonyServiceEventHandler.prototype.onConferenceEvent=function(conferencedElem){$log.info("[TelephonyServiceEventHandler] onConferenceEvent");var that=this,primaryOldConnectionId=conferencedElem.find("primaryOldCallId").text(),secondaryOldConnectionId=conferencedElem.find("secondaryOldCallId").text(),newConnectionId=conferencedElem.find("newCallId").text(),primaryOldCallId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getIdFromConnectionId(primaryOldConnectionId),secondaryOldCallId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getIdFromConnectionId(secondaryOldConnectionId),primaryOldCall=this.telephonyService.calls[primaryOldCallId],secondaryOldCall=this.telephonyService.calls[secondaryOldCallId],confParticipants=[],participantPromises=[],confParticipantsPhoneNumbers=[];return conferencedElem.find("participant").each((function(){var participantElem=angular.element(this),endpointTel=participantElem.find("endpointTel").text(),endpointIm=participantElem.find("endpointIm").text();endpointIm&&_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.isUserContactJid(endpointIm)||participantPromises.push($q((function(resolve,reject){endpointIm||endpointTel||(endpointTel="****"),!endpointIm&&primaryOldCall&&primaryOldCall.contact&&primaryOldCall.currentCalled.contactPhoneNumber===endpointTel?(confParticipants.push(primaryOldCall.contact),confParticipantsPhoneNumbers.push(endpointTel),resolve()):!endpointIm&&secondaryOldCall&&secondaryOldCall.contact&&secondaryOldCall.currentCalled.contactPhoneNumber===endpointTel?(confParticipants.push(secondaryOldCall.contact),confParticipantsPhoneNumbers.push(endpointTel),resolve()):_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact(endpointIm,endpointTel).then((function(contact){confParticipants.push(contact),confParticipantsPhoneNumbers.push(endpointTel),that.telephonyService.updateContactFromOutlookInfos(contact,endpointTel).then((function(updateStatus){updateStatus?$log.debug("[TelephonyServiceEventHandler] on conferenced, update from outlook for contact :"+contact.nameForLog):$log.debug("[TelephonyServiceEventHandler] on conferenced, no update from outlook for contact :"+contact.nameForLog)}),(function(){$log.debug("[TelephonyServiceEventHandler] on conferenced, no Outlook search available")})).finally((function(){resolve()}))})).catch((function(error){$log.error("[TelephonyServiceEventHandler] onConferenceEvent - Impossible to get contact - "+error.message),resolve()}))})))})),$q.all(participantPromises).finally((function(){var isSecondaryDevice=!1;primaryOldCall&&(isSecondaryDevice=isSecondaryDevice||primaryOldCall.isSecondary),secondaryOldCall&&(isSecondaryDevice=isSecondaryDevice||secondaryOldCall.isSecondary);var newConferenceCall=that.createConferenceCall(newConnectionId,confParticipants),currentCalled=newConferenceCall.getCurrentCalled();currentCalled.participants=confParticipants,currentCalled.participantsPhoneNumbers=confParticipantsPhoneNumbers,newConferenceCall.setCurrentCalled(currentCalled),newConferenceCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),newConferenceCall.relevantEquipmentId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getDeviceIdFromConnectionId(newConnectionId),newConferenceCall.isSecondary=isSecondaryDevice,$log.debug("[TelephonyServiceEventHandler] on conferenced, create new call: "+newConferenceCall),that.sendCallUpdateEvent(newConferenceCall),primaryOldCall&&(primaryOldCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN),$log.debug("[TelephonyServiceEventHandler] on conferenced, updated primaryOldCall: "+primaryOldCall),that.sendCallUpdateEvent(primaryOldCall)),secondaryOldCall&&(secondaryOldCall.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN),$log.debug("[TelephonyServiceEventHandler] on conferenced, updated secondaryOldCall: "+secondaryOldCall),that.sendCallUpdateEvent(secondaryOldCall))}))},TelephonyServiceEventHandler.prototype.onUpDateCallEvent=function(updatecallElem){$log.info("[TelephonyServiceEventHandler] onUpDateCallEvent");var that=this;return this.getCall(updatecallElem).then((function(call){var jid=updatecallElem.attr("endpointIm"),phoneNumber=updatecallElem.attr("endpointTel"),firstName="",lastName="",identityFirstName=updatecallElem.find("identity").attr("firstName"),identityLastName=updatecallElem.find("identity").attr("lastName"),identityDisplayName=updatecallElem.find("identity").attr("displayName"),contactUpdateDone=!1;if(!config.permitSearchFromPhoneBook&&!_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_2___default.a.FeaturesEnum.TELEPHONY_PHONE_BOOK))return $log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent xnames not allowed for the user profile => IGNORED event"),$q.when();if(identityLastName&&identityLastName.length)lastName=identityLastName,identityFirstName&&identityFirstName.length&&(firstName=identityFirstName),$log.info("[TelephonyServiceEventHandler] onUpDateCallEvent received for call "+call.id+" for phoneNumber:"+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4___default()(phoneNumber)+" with name : "+firstName.slice(0,1)+"***");else{if(!identityDisplayName||!identityDisplayName.length||identityDisplayName===phoneNumber)return $log.info("[TelephonyServiceEventHandler] onUpDateCallEvent xnames not available => IGNORED event"),$q.when();lastName=identityDisplayName,$log.info("[TelephonyServiceEventHandler] onUpDateCallEvent only displayName available")}return _src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact(jid,phoneNumber).then((function(contact){if(contact.temp){if(contact.updateName(firstName,lastName),call.contact&&call.contact.id){var currentCalled={contactPhoneNumber:phoneNumber,contact:contact};call.contact.id===contact.id&&call.contact.displayName!==phoneNumber&&call.contact.nameUpdatePrio!==_src_models_contact_model__WEBPACK_IMPORTED_MODULE_3__.Contact.NameUpdatePrio.OUTLOOK_UPDATE_PRIO||(contact.nameUpdatePrio=_src_models_contact_model__WEBPACK_IMPORTED_MODULE_3__.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO,call.setContact(contact),call.setCurrentCalled(currentCalled),contactUpdateDone=!0,$log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent xnames updated for "+phoneNumber+" with contact : "+contact.nameForLog))}else if(call.participants&&call.participants.length>0){currentCalled=call.getCurrentCalled();for(var i=0;i<call.participants.length;i++)call.participants[i].temp?call.participants[i].phoneProCan&&call.participants[i].phoneProCan===phoneNumber&&($log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent temp participant "+call.participants[i].nameForLog+" updated with : "+contact.nameForLog),call.participants[i]=contact,call.participants[i].nameUpdatePrio=_src_models_contact_model__WEBPACK_IMPORTED_MODULE_3__.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO,currentCalled.participantsPhoneNumbers[i]=phoneNumber,currentCalled.participants[i]=contact,contactUpdateDone=!0):$log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent STRANGE former participant was a rainbow: "+call.participants[i].nameForLog);call.setCurrentCalled(currentCalled)}}else if(call.contact&&call.contact.id)currentCalled={contactPhoneNumber:phoneNumber,contact:contact},call.contact.id!==contact.id&&(call.contact.temp&&(call.contact.updateName(firstName,lastName),call.contact.nameUpdatePrio=_src_models_contact_model__WEBPACK_IMPORTED_MODULE_3__.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO),call.setContact(contact),call.setCurrentCalled(currentCalled),contactUpdateDone=!0,$log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent call update with rainbow contact : "+contact.nameForLog));else if(call.participants&&call.participants.length>0){for(currentCalled=call.getCurrentCalled(),i=0;i<call.participants.length;i++)call.participants[i].temp?call.participants[i].phoneProCan&&call.participants[i].phoneProCan===phoneNumber&&($log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent temp participant "+call.participants[i].nameForLog+" updated with : "+contact.nameForLog),call.participants[i]=contact,call.setParticipants(call.participants),currentCalled.participantsPhoneNumbers[i]=phoneNumber,currentCalled.participants[i]=contact,contactUpdateDone=!0):call.participants[i].jid===jid?(currentCalled.participantsPhoneNumbers[i]=phoneNumber,currentCalled.participants[i]=call.participants[i],contactUpdateDone=!0,$log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent rainbow participant "+call.participants[i].nameForLog+" updated with the same : "+contact.nameForLog)):$log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent other participant not updated : "+call.participants[i].nameForLog+" vs "+contact.nameForLog);call.setCurrentCalled(currentCalled)}contactUpdateDone?$interval((function(){that.sendCallUpdateEvent(call,updatecallElem)}),300,1):$log.debug("[TelephonyServiceEventHandler] onUpDateCallEvent, no update needed for call : "+call.id)}))}))},TelephonyServiceEventHandler.prototype.onFailCallEvent=function(failedElem){$log.info("[TelephonyServiceEventHandler] onFailCallEvent");var cause=failedElem.attr("cause"),that=this;return this.getCall(failedElem).then((function(call){call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ERROR),call.errorMessage=TelephonyServiceEventHandler.CallFailureLabels[cause],call.errorMessage||(call.errorMessage=cause),that.sendCallUpdateEvent(call,failedElem)}))},TelephonyServiceEventHandler.prototype.onCallNomadicEvent=function(nomadicElem){if($log.info("[TelephonyServiceEventHandler] onCallNomadicEvent"),!this.telephonyService.started&&!this.telephonyService.starting)return $log.info("[TelephonyServiceEventHandler] onCallNomadicEvent on uninitialized telephony => relaunch telephony initialization"),this.telephonyService.launchTelephonyInitilization(),$q.when();var response={destination:nomadicElem.attr("destination"),featureActivated:nomadicElem.attr("featureActivated"),makeCallInitiatorIsMain:nomadicElem.attr("makeCallInitiatorIsMain"),modeActivated:nomadicElem.attr("modeActivated"),nomadicModeInitialized:nomadicElem.attr("nomadicModeInitialized")};if(this.telephonyService.updateNomadicData(response)){var snapshotSecondary=this.telephonyService.nomadicObject.featureActivated&&this.telephonyService.nomadicObject.modeActivated&&!this.telephonyService.nomadicObject.makeCallInitiatorIsMain;this.telephonyService.getTelephonyState(snapshotSecondary)}return $q.when()},TelephonyServiceEventHandler.prototype.onCallForwardedEvent=function(forwardElem){var forwardType=forwardElem.attr("forwardType"),forwardTo=forwardElem.attr("forwardTo");return $log.info("[TelephonyServiceEventHandler] onCallForwardedEvent forwardType: "+forwardType+" forwardTo: "+forwardTo),$rootScope.$broadcast("ON_CALL_FORWARDED_EVENT",{forwardType:forwardType,forwardTo:forwardTo}),this.telephonyService.forwardObject.forwardType=forwardType,this.telephonyService.forwardObject.forwardTo=forwardTo,$q.when()},TelephonyServiceEventHandler.prototype.onCallSubjectEvent=function(callElem){$log.info("[TelephonyServiceEventHandler] onCallSubjectEvent");var that=this;return this.getCall(callElem).then((function(call){try{call.subject=callElem.find("subject").text(),call.subject&&($log.info("[TelephonyServiceEventHandler] subject display"+call.subject),that.sendCallUpdateEvent(call))}catch(error){var errorMessage="onCallSubjectEvent -- "+error.message;$log.error("[TelephonyServiceEventHandler] "+errorMessage),$q.reject(new Error(errorMessage))}}))},TelephonyServiceEventHandler.prototype.computeCallRelevancy=function(elem,call){var connectionId=elem.attr("newCallId")||elem.attr("callId"),deviceType=elem.attr("deviceType"),equipmentId=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getDeviceIdFromConnectionId(connectionId),nomadicInfo=this.telephonyService.getNomadicObject(),makeCallInitiatorIsMain=nomadicInfo.makeCallInitiatorIsMain;deviceType||(deviceType="MAIN"),nomadicInfo.modeActivated||(makeCallInitiatorIsMain=!0),"MAIN"===deviceType&&makeCallInitiatorIsMain&&(call.relevantEquipmentId=equipmentId,call.connectionId=connectionId),"SECONDARY"!==deviceType||makeCallInitiatorIsMain||(call.relevantEquipmentId=equipmentId,call.connectionId=connectionId),call.isSecondary=deviceType&&"SECONDARY"===deviceType&&!makeCallInitiatorIsMain,$log.info("[TelephonyServiceEventHandler] computeCallRelevancy -- relevantEquipmentId: "+call.relevantEquipmentId+" connectionId: "+call.connectionId+" isSecondary: "+call.isSecondary)},TelephonyServiceEventHandler.prototype.getCall=function(elem,doNotUseEqtIdFromElem,searchPendingMakeCall){var that=this;return $q((function(resolve){var jid=elem.attr("endpointIm"),phoneNumber=elem.attr("endpointTel"),connectionId=elem.attr("callId");that.getOrCreateCall(connectionId,jid,phoneNumber,doNotUseEqtIdFromElem,searchPendingMakeCall).then((function(call){resolve(call)}))}))},TelephonyServiceEventHandler.prototype.getOrCreateCall=function(connectionId,jid,phoneNumber,doNotUseEqtIdFromElem,searchPendingMakeCall){var that=this;if(doNotUseEqtIdFromElem){var orgConnectionId=connectionId;connectionId=Object.keys(this.telephonyService.calls||[]).find((function(callConnectionId){return _src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getCallIdFromConnectionId(callConnectionId)===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getCallIdFromConnectionId(connectionId)})),$log.debug("[TelephonyServiceEventHandler] getOrCreateCall - HOLD/RETRIEVE search call with callId: "+_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getCallIdFromConnectionId(orgConnectionId)+" from connection id: "+orgConnectionId+" => found connectionId: "+connectionId)}if(!connectionId)return $q.reject("no connection id");if(searchPendingMakeCall){var _call4=this.telephonyService.pendingMakeCalls.pop();if(_call4)return _call4.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.DIALING),_call4.setConnectionId(connectionId),_call4.setRelevantEquipmentId(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.getDeviceIdFromConnectionId(_call4.connectionId)),$log.info("[TelephonyServiceEventHandler] getOrCreateCall - "+connectionId+" - "+jid+" => found pendingMakeCall: Call confirmed by csta event "+_call4),this.telephonyService.calls[_call4.id]=_call4,$q.when(_call4)}var call=this.telephonyService.calls[connectionId];return call?($log.info("[TelephonyServiceEventHandler] getOrCreateCall - "+connectionId+" - "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4___default()(phoneNumber)+" - "+jid+" => found call: "+call),$q.when(call)):($log.info("[TelephonyServiceEventHandler] getOrCreateCall - "+connectionId+" - "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4___default()(phoneNumber)+" - "+jid+" => not found : create call..."),$q((function(resolve){jid||phoneNumber?_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact(jid,phoneNumber).then((function(contact){resolve(that.telephonyService.getOrCreateCall(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN,connectionId,contact))})):resolve(that.telephonyService.getOrCreateCall(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN,connectionId))})))},TelephonyServiceEventHandler.prototype.createConferenceCall=function(connectionId,participants){var conferenceCall=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.create(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN,null,_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Type.PHONE);return conferenceCall.setConnectionId(connectionId),conferenceCall.isConference=!0,conferenceCall.setParticipants(participants),this.telephonyService.calls[conferenceCall.id]=conferenceCall,conferenceCall},TelephonyServiceEventHandler.prototype.sendCallUpdateEvent=function(call,elem){var infoEvt=this.extractInfoEvent(elem);$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call,infoEvt)},TelephonyServiceEventHandler.prototype.extractInfoEvent=function(elem){var infoEvent={actionElemName:"",cause:""};if(elem&&null!==elem){var tagNames=elem.prop("tagName").split(":");infoEvent.actionElemName=tagNames[tagNames.length-1].toLowerCase(),infoEvent.cause=elem.attr("cause"),infoEvent.cause=infoEvent.cause?infoEvent.cause:""}else infoEvent=null;return infoEvent},TelephonyServiceEventHandler.prototype.analyzeContactChange=function(jid,phoneNumber,call){var updateContact=!1,searchOutlook=!1;return jid||phoneNumber?call.isConference?void 0:call.contact?(""!==jid?call.contact.id!==jid&&(updateContact=!0,searchOutlook=!1):call.contact.temp?call.contact.id!==phoneNumber?(updateContact=!0,searchOutlook=!0):call.contact.displayName===phoneNumber&&(updateContact=!1,searchOutlook=!0):""!==call.getCurrentCalled().contactPhoneNumber&&""!==phoneNumber&&call.getCurrentCalled().contactPhoneNumber!==phoneNumber&&(updateContact=!0,searchOutlook=!0),updateContact||searchOutlook?{updateContactToBeDone:updateContact,searchOutlookToBeDone:searchOutlook}:null):{updateContactToBeDone:!0,searchOutlookToBeDone:!0}:null},TelephonyServiceEventHandler.prototype.updateCallContact=function(jid,phoneNumber,actionElem,call){var that=this,tagNames=actionElem.prop("tagName").split(":"),actionElemName=tagNames[tagNames.length-1].toLowerCase();try{var updateAnalyse=that.analyzeContactChange(jid,phoneNumber,call);return call.isConference||""===phoneNumber||call.setCurrentCalledContactNumber(phoneNumber),updateAnalyse?_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact(jid,phoneNumber).then((function(contact){return updateAnalyse.searchOutlookToBeDone?that.telephonyService.updateContactFromOutlookInfos(contact,phoneNumber).then((function(updateStatus){updateStatus?($log.debug("[TelephonyServiceEventHandler] on "+actionElemName+", update from outlook for contact :"+contact.nameForLog),that.makeUpdateContact(call,contact,phoneNumber,actionElemName)):($log.debug("[TelephonyServiceEventHandler] on "+actionElemName+", no update from outlook for contact :"+contact.nameForLog),updateAnalyse.updateContactToBeDone?($log.debug("[TelephonyServiceEventHandler] on "+actionElemName+", update contact :"+contact.nameForLog),that.makeUpdateContact(call,contact,phoneNumber,actionElemName)):that.sendCallUpdateEvent(call,actionElem))}),(function(){$log.debug("[TelephonyServiceEventHandler] on "+actionElemName+", no Outlook search available"),updateAnalyse.updateContactToBeDone?($log.debug("[TelephonyServiceEventHandler] on "+actionElemName+", update contact :"+contact.nameForLog),that.makeUpdateContact(call,contact,phoneNumber,actionElemName)):that.sendCallUpdateEvent(call,actionElem)})):($log.debug("[TelephonyServiceEventHandler] on "+actionElemName+", update contact :"+contact.nameForLog),that.makeUpdateContact(call,contact,phoneNumber,actionElemName),$q.when())})).catch((function(error){if(error){var errorMessage="updateCallContact -- "+error.message;$log.error("[TelephonyServiceEventHandler] "+errorMessage)}return $log.debug("[TelephonyServiceEventHandler] on "+actionElemName+", no Outlook search available"),that.sendCallUpdateEvent(call,actionElem),$q.when()})):(that.sendCallUpdateEvent(call,actionElem),$q.when())}catch(error){var errorMessage="updateCallContact -- "+error.message;return $log.error("[TelephonyServiceEventHandler] "+errorMessage),$q.reject(new Error(errorMessage))}},TelephonyServiceEventHandler.prototype.makeUpdateContact=function(call,contact,phoneNumber,actionElemName){var that=this;call.setContact(contact);var currentCalled={contactPhoneNumber:phoneNumber,contact:contact};call.setCurrentCalled(currentCalled),"delivered"===actionElemName&&call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_INCOMMING?$interval((function(){that.sendCallUpdateEvent(call)}),300,1):that.sendCallUpdateEvent(call)},TelephonyServiceEventHandler}])},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var contact_service_1=__webpack_require__(1),auth_service_1=__webpack_require__(2),profile_service_1=__webpack_require__(6),anonymizer_1=__webpack_require__(14),DirectoryService=function(){function DirectoryService($rootScope,$log,$http,$injector,orderByFilter,conversationService,errorHelperService){_classCallCheck(this,DirectoryService),this.$rootScope=$rootScope,this.$log=$log,this.$http=$http,this.$injector=$injector,this.orderByFilter=orderByFilter,this.conversationService=conversationService,this.errorHelperService=errorHelperService,this.centralizedService=null,this.companyContactsNumber=0,this.otherCompanyContactsNumber=0,this.authService=auth_service_1.default,this.profileService=profile_service_1.default,this.contactService=contact_service_1.default}return _createClass(DirectoryService,[{key:"start",value:function(stats){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee429(){var startDate,startDuration;return regenerator_default.a.wrap((function(_context430){for(;;)switch(_context430.prev=_context430.next){case 0:this.$log.info("[DirectoryService] === STARTING ==="),startDate=performance.now();try{this.centralizedService=this.$injector.get("centralizedService")}catch(error){}startDuration=Math.round(performance.now()-startDate),stats.push({service:"directoryService",startDuration:startDuration}),this.$log.info("[DirectoryService] === STARTED ("+startDuration+" ms) ===");case 5:case"end":return _context430.stop()}}),_callee429,this)})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee430(){return regenerator_default.a.wrap((function(_context431){for(;;)switch(_context431.prev=_context431.next){case 0:this.$log.info("[DirectoryService] Stopping"),this.$log.info("[DirectoryService] Stopped");case 1:case"end":return _context431.stop()}}),_callee430,this)})))}},{key:"search",value:function(searchText){var addRosters=arguments.length>1&&void 0!==arguments[1]&&arguments[1],limit=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,companyId=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",excludeCompanyId=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee431(){var searchType,serverUrl,contactsData,contacts,rosterContacts,e,_this236=this;return regenerator_default.a.wrap((function(_context432){for(;;)switch(_context432.prev=_context432.next){case 0:return this.$log.info("[DirectoryService] searchContact with text "+anonymizer_1.default(searchText)),searchType=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.SEARCH_BY_TAGS)?"search=":"displayName=",serverUrl=config.restServerUrl+"/api/rainbow/search/v1.0/users?limit="+limit+"&"+searchType+encodeURIComponent(searchText),companyId&&(serverUrl+="&companyId="+encodeURIComponent(companyId)),excludeCompanyId&&(serverUrl+="&excludeCompanyId="+encodeURIComponent(excludeCompanyId)),_context432.prev=3,_context432.next=6,this.$http({method:"GET",url:serverUrl,headers:this.authService.getRequestHeader()});case 6:return contactsData=_context432.sent.data.data,this.$log.info("[DirectoryService] search find "+contactsData.length+" contact(s)"),excludeCompanyId?this.otherCompanyContactsNumber=contactsData.length:this.companyContactsNumber=contactsData.length,contacts=[],contactsData.forEach((function(contactData){if(_this236.contactService.isUserContactJid(contactData.jid_im))_this236.$log.info("[DirectoryService] search contact "+contactData.jid_im+" ignored");else{var contact=_this236.contactService.getContact(contactData.jid_im);contact||((contact=_this236.contactService.createBasicContact(contactData.jid_im)).updateFromUserData(contactData),contact.getAvatar(),_this236.contactService.dbContacts[contactData.id]=contact,_this236.contactService.jtelContacts[contact.jidtel]=contact),contact.tags=contactData.tags,contact.dbId=contactData.id,_this236.contactService.updateContactRichStatus(contact),_this236.conversationService.computeCapabilitiesForContact(contact,!1),contacts.push(contact)}})),addRosters&&(rosterContacts=this.contactService.searchContacts(searchText),contacts=contacts.concat(rosterContacts.filter((function(item){return item.roster&&contacts.indexOf(item)<0})))),_context432.abrupt("return",contacts=this.orderByFilter(contacts,"_displayName",!1));case 13:throw _context432.prev=13,_context432.t0=_context432.catch(3),e=_context432.t0,_context432.t0&&_context432.t0.data&&(e=this.errorHelperService.handleError(_context432.t0),this.$log.error("[DirectoryService] search - "+e.message),401===_context432.t0.data.errorCode&&this.$rootScope.$broadcast("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),e;case 17:case"end":return _context432.stop()}}),_callee431,this,[[3,13]])})))}},{key:"getCompanyContactsNumber",value:function(){return this.companyContactsNumber}},{key:"getOtherCompanyContactsNumber",value:function(){return this.otherCompanyContactsNumber}},{key:"searchUserByLogin",value:function(loginEmail){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee432(){var serverUrl,userArray,contact,e;return regenerator_default.a.wrap((function(_context433){for(;;)switch(_context433.prev=_context433.next){case 0:return this.$log.info('[DirectoryService] searchUserByLogin with "'+loginEmail+'"'),serverUrl=config.webservices.protocol+"://"+config.webservices.currentServer+":"+config.webservices.port+"/api/rainbow/enduser/v1.0/",_context433.prev=2,_context433.next=5,this.$http({method:"POST",url:serverUrl+"users/loginEmails",headers:this.authService.getPostHeader(),data:{loginEmail:[loginEmail]}});case 5:if(1!==(userArray=_context433.sent.data.data).length){_context433.next=11;break}return _context433.next=9,this.contactService.getOrCreateContact(userArray[0].jid_im);case 9:return contact=_context433.sent,_context433.abrupt("return",(contact.loginEmail=loginEmail,contact));case 11:_context433.next=17;break;case 13:throw _context433.prev=13,_context433.t0=_context433.catch(2),e=_context433.t0,_context433.t0&&_context433.t0.data&&(e=this.errorHelperService.handleError(_context433.t0),this.$log.error("[DirectoryService] searchUserByLogin - "+e.message),401===_context433.t0.data.errorCode&&this.$rootScope.$broadcast("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),e;case 17:case"end":return _context433.stop()}}),_callee432,this,[[2,13]])})))}},{key:"searchUserByJid",value:function(jid){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee433(){var serverUrl,user,contact,e;return regenerator_default.a.wrap((function(_context434){for(;;)switch(_context434.prev=_context434.next){case 0:return this.$log.info('[DirectoryService] searchUserByJid with "'+jid+'"'),serverUrl=config.webservices.protocol+"://"+config.webservices.currentServer+":"+config.webservices.port+"/api/rainbow/enduser/v1.0/users/jids/",_context434.prev=2,_context434.next=5,this.$http({method:"GET",url:serverUrl+encodeURIComponent(jid),headers:this.authService.getRequestHeader()});case 5:if(!(user=_context434.sent.data)){_context434.next=11;break}return _context434.next=9,this.contactService.getOrCreateContact(jid);case 9:return contact=_context434.sent,_context434.abrupt("return",(contact.updateFromUserData(user.data),contact));case 11:_context434.next=17;break;case 13:throw _context434.prev=13,_context434.t0=_context434.catch(2),e=_context434.t0,_context434.t0&&_context434.t0.data&&(e=this.errorHelperService.handleError(_context434.t0),this.$log.error("[DirectoryService] searchUserByJid - "+e.message),401===_context434.t0.data.errorCode&&this.$rootScope.$broadcast("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),e;case 17:case"end":return _context434.stop()}}),_callee433,this,[[2,13]])})))}},{key:"searchUserByPhoneNumber",value:function(phoneNumber){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee434(){var serverUrl,user,e;return regenerator_default.a.wrap((function(_context435){for(;;)switch(_context435.prev=_context435.next){case 0:return this.$log.info('[DirectoryService] searchUserByPhoneNumber with "'+phoneNumber+'"'),serverUrl=config.webservices.protocol+"://"+config.webservices.currentServer+":"+config.webservices.port+"/api/rainbow/search/v1.0/phone-numbers/"+phoneNumber+"/users",_context435.prev=2,_context435.next=5,this.$http({method:"GET",url:serverUrl,headers:this.authService.getRequestHeader()});case 5:if(!(user=_context435.sent.data.data)){_context435.next=10;break}return _context435.next=9,this.contactService.getOrCreateContact(user.jid_im);case 9:return _context435.abrupt("return",_context435.sent);case 10:_context435.next=16;break;case 12:return _context435.prev=12,_context435.t0=_context435.catch(2),e=_context435.t0,_context435.abrupt("return",(_context435.t0&&_context435.t0.data&&(e=this.errorHelperService.handleError(_context435.t0),this.$log.error("[DirectoryService] searchUserByPhoneNumber - "+e.message),401===_context435.t0.data.errorCode&&this.$rootScope.$broadcast("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),null));case 16:case"end":return _context435.stop()}}),_callee434,this,[[2,12]])})))}},{key:"searchAllContacts",value:function(searchText){var limit=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,companyId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",addRosters=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],addOutlook=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],excludeCompanyId=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee435(){var contacts,rainbowContacts,_yield$Promise$all,_yield$Promise$all2,outlookContactsByEmail,outlookContactsByName,outlookResults;return regenerator_default.a.wrap((function(_context436){for(;;)switch(_context436.prev=_context436.next){case 0:return this.$log.info("[DirectoryService] searchAllContacts with text "+searchText),_context436.prev=1,contacts=[],addRosters&&(contacts=this.contactService.searchContacts(searchText)),_context436.next=6,this.search(searchText,!1,limit,companyId,excludeCompanyId);case 6:if(rainbowContacts=_context436.sent,contacts=contacts.concat(rainbowContacts.filter((function(item){return!item.roster||contacts.indexOf(item)<0}))),this.$log.info("[DirectoryService] searchAllContacts with text "+searchText+" found contacts "+contacts.length),!addOutlook||!this.centralizedService){_context436.next=16;break}return _context436.next=10,Promise.all([this.searchOutlookUsersByEmail(searchText),this.searchOutlookUsersByName(searchText)]);case 10:_yield$Promise$all=_context436.sent,_yield$Promise$all2=Object(slicedToArray.a)(_yield$Promise$all,2),outlookContactsByEmail=_yield$Promise$all2[0],outlookContactsByName=_yield$Promise$all2[1],outlookResults=this.centralizedService.outlook.mergeOutlookContact(outlookContactsByEmail,outlookContactsByName),outlookResults=this.adaptOutlookContacts(outlookResults),contacts=contacts.concat(outlookResults),this.$log.info("[DirectoryService] searchAllContacts with text "+searchText+" with outlook contacts "+contacts.length);case 16:return _context436.abrupt("return",contacts);case 19:throw _context436.prev=19,_context436.t0=_context436.catch(1),this.$log.error("[DirectoryService] searchAllContacts - Unable to search all contacts"),_context436.t0;case 22:case"end":return _context436.stop()}}),_callee435,this,[[1,19]])})))}},{key:"adaptOutlookContacts",value:function(outlookResults){return outlookResults&&outlookResults.length&&outlookResults.forEach((function(contact){contact.photo&&contact.photo.src?contact.avatar=contact.photo:contact.photo&&(contact.avatar=new Image,contact.avatar.src=contact.photo),contact.businessPhones=[],contact.businessPhone&&contact.businessPhones.push(contact.businessPhone),contact.mobilePhone&&(contact.mobilePhones=[],contact.mobilePhones.push(contact.mobilePhone)),contact.homePhone&&(contact.otherPhoneNumbers=contact.homePhone),contact.emailAddress&&(contact.email=contact.emailAddress),contact.outlookFlag=!0})),outlookResults}},{key:"searchOutlookUsersByName",value:function(searchPattern){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee436(){return regenerator_default.a.wrap((function(_context437){for(;;)switch(_context437.prev=_context437.next){case 0:if(!this.centralizedService){_context437.next=10;break}return _context437.prev=1,_context437.next=4,this.centralizedService.outlook.searchByNameWithAvatar(searchPattern,2);case 4:return _context437.abrupt("return",_context437.sent);case 7:return _context437.prev=7,_context437.t0=_context437.catch(1),_context437.abrupt("return",(this.$log.warn("[DirectoryService] searchOutlookUsersByName - Outlook service unavailable"),[]));case 10:case"end":return _context437.stop()}}),_callee436,this,[[1,7]])})))}},{key:"searchOutlookUsersByEmail",value:function(searchPattern){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee437(){return regenerator_default.a.wrap((function(_context438){for(;;)switch(_context438.prev=_context438.next){case 0:if(!this.centralizedService||!this.centralizedService.outlook){_context438.next=10;break}return _context438.prev=1,_context438.next=4,this.centralizedService.outlook.searchByEmailWithAvatar(searchPattern,2);case 4:return _context438.abrupt("return",_context438.sent);case 7:return _context438.prev=7,_context438.t0=_context438.catch(1),_context438.abrupt("return",(this.$log.warn("[DirectoryService] searchOutlookUsersByEmail - Outlook service unavailable"),[]));case 10:case"end":return _context438.stop()}}),_callee437,this,[[1,7]])})))}}]),DirectoryService}();DirectoryService.$inject=["$rootScope","$log","$http","$injector","orderByFilter","conversationService","errorHelperService"],exports.DirectoryService=DirectoryService,angular.module("rainbow").service("directoryService",DirectoryService)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_models_group_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(44),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3__);angular.module("rainbow").service("groupService",["$q","$rootScope","$log","$http","usersService",function($q,$rootScope,$log,$http,usersService){var service=this;this.started=!1,service.ON_REMOVE_GROUP_USER_EVENT="ON_REMOVE_GROUP_USER_EVENT",service.ON_ADD_GROUP_USER_EVENT="ON_ADD_GROUP_USER_EVENT",service.ON_GROUP_USERS_UPDATE_EVENT="ON_GROUP_USERS_UPDATE_EVENT",service.ON_CREATED_GROUP_EVENT="ON_CREATED_GROUP_EVENT",service.ON_UPDATE_GROUP_EVENT="ON_UPDATE_GROUP_EVENT",service.ON_REMOVED_GROUP_EVENT="ON_REMOVED_GROUP_EVENT",this.start=function(){$log.info(""),$log.info("[groupService] === STARTING ==="),service.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.userId+"/";var defered=$q.defer();return service.$q=$q,service.groups=null,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.userContact.isCPaaSGuest()?defered.resolve():(this.attachHandlers(),this.getGroups(),service.started=!0,$log.info("[groupService] === STARTED ==="),defered.resolve(),defered.promise)},this.stop=function(){return $log.info("[groupService] === STOPPING ==="),service.conversations=null,service.groups=null,this.groupMessageHandlerRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.deleteHandler(this.groupMessageHandlerRef),this.groupMessageHandlerRef=null),this.started=!1,$log.info("[groupService] === STOPPED ==="),$q.when()},this.getGroups=function(){return service.groups?$q.when(service.groups):service.getRemoteGroups()},this.getGroupById=function(groupId){return service.group[groupId]},service.getGroupsAsArray=function(){var groupsArray=[];for(var key in service.groups)service.groups.hasOwnProperty(key)&&groupsArray.push(service.groups[key]);return groupsArray},this.getRemoteGroups=function(){$log.info("[groupService] getGroups");var defered=$q.defer();return $http({method:"GET",url:service.portalURL+"groups?format=full",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var data=response.data.data;$log.info("[groupService] getGroups success (find "+response.data.total+" group(s))"),service.groups=[];var usersPromises=[];return data.forEach((function(groupData){var group=_src_models_group_model__WEBPACK_IMPORTED_MODULE_0__.Group.createFromData(groupData);service.groups.push(group),angular.forEach(groupData.users,(function(user_id){usersPromises=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.getContactByDBId(user_id).then((function(contact){contact&&group.users.push(contact)}))})),service.logGroupUsers(group),service.sortUsersInGroup(group)})),$q.all(usersPromises)}),(function(response){var errorMessage="getGroups"+service.handleErrorMessage(response);defered.reject(new Error(errorMessage)),$log.error("[groupService] "+errorMessage)})).then((function(){defered.resolve(service.groups)})),defered.promise};var addGroupUserAct=function(group_id,user_id){return $q((function(resolve){service.groups.some((function(group){return group.id===group_id&&(group.users.some((function(user){return user_id===user.dbId}))?(resolve(group),$rootScope.$broadcast(service.ON_ADD_GROUP_USER_EVENT,group_id,user_id),!0):(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.getContactByDBId(user_id).then((function(contact){group.users.push(contact),service.sortUsersInGroup(group);var Wgroups=[group];contact.getGroups()?contact.getGroups().push(group):contact.setGroups(Wgroups),$rootScope.$broadcast(service.ON_ADD_GROUP_USER_EVENT,group_id,user_id),resolve(group)})),!0))}))||($rootScope.$broadcast(service.ON_ADD_GROUP_USER_EVENT,group_id,user_id),resolve())}))};this.getGroup=function(group_id){$log.info("[groupService] getGroup  for "+group_id);var defered=$q.defer(),group=null;return $http({method:"GET",url:service.portalURL+"groups/"+group_id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var groupData=response.data.data,usersPromises=[];return group=_src_models_group_model__WEBPACK_IMPORTED_MODULE_0__.Group.createFromData(groupData),$log.info("[groupService] getGroup success for "+group.name+" : "+group.id),service.groups.some((function(item,index){return item.id===groupData.id&&(service.groups[index]=group,angular.forEach(groupData.users,(function(user){usersPromises=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.getContactByDBId(user.id).then((function(contact){contact&&(service.groups[index].users.push(contact),service.sortUsersInGroup(service.groups[index]))}))})),!0)}))||(service.groups.push(group),angular.forEach(groupData.users,(function(user){usersPromises=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.getContactByDBId(user.id).then((function(contact){if(contact){group.users.push(contact),service.sortUsersInGroup(group);var Wgroups=[group];contact.getGroups()?contact.getGroups().push(group):contact.setGroups(Wgroups)}}))}))),$q.all(usersPromises)}),(function(response){var errorMessage="getGroup"+service.handleErrorMessage(response);defered.reject(new Error(errorMessage)),$log.error("[groupService] "+errorMessage)})).then((function(){defered.resolve(group)})),defered.promise},this.addGroup=function(group){$log.info("[groupService] addGroup : "+group.name);var defered=$q.defer();return $http({method:"POST",url:service.portalURL+"groups",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getPostHeader(),data:{name:group.name,comment:group.comment,isFavorite:group.isFavorite}}).then((function(response){$log.info("[groupService] addGroup success for : "+group.name);var groupData=response.data.data,new_group=_src_models_group_model__WEBPACK_IMPORTED_MODULE_0__.Group.createFromData(groupData);defered.resolve(new_group)}),(function(response){var errorMessage="addGroup"+service.handleErrorMessage(response),error=new Error(errorMessage);error.details=409===response.status?"conflict":"unknown",defered.reject(error),$log.error("[groupService] "+errorMessage)})),defered.promise};var removeGroupAct=function(group_id){angular.forEach(service.groups,(function(group,index){group.id===group_id&&service.groups.splice(index,1)}))};this.removeGroup=function(group_id){$log.info("[groupService] removeGroup : "+group_id);var defered=$q.defer();return $http({method:"DELETE",url:service.portalURL+"groups/"+group_id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[groupService] removeGroup success for : "+group_id),removeGroupAct(group_id),defered.resolve()}),(function(response){var errorMessage="removeGroup"+service.handleErrorMessage(response);defered.reject(new Error(errorMessage)),$log.error("[groupService] "+errorMessage)})),defered.promise},this.updateGroup=function(group){$log.info("[groupService] updateGroup for : "+group.name);var defered=$q.defer();return $http({method:"PUT",url:service.portalURL+"groups/"+group.id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:{name:group.name,comment:group.comment,isFavorite:group.isFavorite}}).then((function(){$log.info("[groupService] updateGroup success for : "+group.name),defered.resolve()}),(function(response){var error=service.handleErrorMessage(response,"updateGroup");defered.reject(error),$log.error("[groupService] "+error.message)})),defered.promise},this.getGroupUsers=function(group_id){$log.info("[groupService] getGroupUsers : "+group_id);var defered=$q.defer();return $http({method:"GET",url:service.portalURL+"groups/"+group_id+"/users",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var data=response.data.data;$log.info("[groupService] getGroupUsers success for "+group_id+" (find "+response.data.total+" users(s))"),defered.resolve(data.users)}),(function(response){var errorMessage="getGroupUsers"+service.handleErrorMessage(response);defered.reject(new Error(errorMessage)),$log.error("[groupService] "+errorMessage)})),defered.promise},this.addGroupUser=function(group,user){$log.info("[groupService] addGroupUser");var defered=service.$q.defer();return group.users.some((function(item){return user.dbId===item.dbId}))?($log.info("[groupService] addGroupUser - user: "+user.id+" already exist in group: "+group.name+" - no remote action"),void defered.resolve()):($http({method:"POST",url:service.portalURL+"groups/"+group.id+"/users/"+user.dbId,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getPostHeader()}).then((function(response){$log.info("[groupService] addGroupUser success: "+user.id+"/"+group.name),addGroupUserAct(group.id,user.dbId).then((function(updatedGroup){if(updatedGroup)defered.resolve(updatedGroup);else{var groupData=response.data.data,newGroup=_src_models_group_model__WEBPACK_IMPORTED_MODULE_0__.Group.createFromData(groupData);defered.resolve(newGroup)}})),$rootScope.$broadcast(service.ON_GROUP_USERS_UPDATE_EVENT)}),(function(response){var errorMessage="addGroupUser"+service.handleErrorMessage(response);defered.reject(new Error(errorMessage)),$log.error("[groupService] "+errorMessage)})),defered.promise)};var removeGroupUserAct=function(group_id,user_id){angular.forEach(service.groups,(function(group){group.id===group_id&&(angular.forEach(group.users,(function(user_item,index){user_item.dbId===user_id&&(group.users.splice(index,1),user_item.getGroups()&&angular.forEach(user_item.getGroups(),(function(user_group_item,g_index){user_group_item.id===group_id&&user_item.getGroups().splice(g_index,1)})))})),service.sortUsersInGroup(group))}))};this.getGroupById=function(group_id){var result=null;return angular.forEach(service.groups,(function(group){group.id===group_id&&(result=group)})),result},this.removeGroupUser=function(group_id,user){$log.info("[groupService] removeGroupUser : "+group_id+"/"+user.id);var defered=$q.defer();return $http({method:"DELETE",url:service.portalURL+"groups/"+group_id+"/users/"+user.dbId,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[groupService] removeGroupUser success : "+group_id+"/"+user.id),removeGroupUserAct(group_id,user.dbId);var group=service.getGroupById(group_id);$rootScope.$broadcast(service.ON_GROUP_USERS_UPDATE_EVENT),defered.resolve(group)}),(function(response){var errorMessage="removeGroupUser"+service.handleErrorMessage(response);defered.reject(new Error(errorMessage)),$log.error("[groupService] "+errorMessage)})),defered.promise},this.getUserGroups=function(user){if(!user)return $log.info("[groupService] getUserGroups for unknown user !"),$q.when();$log.info("[groupService] getUserGroups for user : "+user.id);var defered=$q.defer(),userGroups=user.getGroups();return userGroups?$q.when(userGroups):($http({method:"GET",url:service.portalURL+"groups?userId="+user.dbId,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var data=response.data.data;$log.info("[groupService] getUserGroups success (find "+response.data.total+" group(s))");var groups=[];data.forEach((function(groupData){var group=_src_models_group_model__WEBPACK_IMPORTED_MODULE_0__.Group.createFromData(groupData);groups.push(group)})),user.setGroups(groups),service.logUserGroups(user.nameForLog,groups),defered.resolve(groups)}),(function(response){var errorMessage="getUserGroups"+service.handleErrorMessage(response);defered.reject(new Error(errorMessage)),$log.error("[groupService] "+errorMessage)})),defered.promise)},this.getGroupFromName=function(group_name){$log.info("[groupService] getGroupFromName : "+group_name);var defered=$q.defer();return this.getGroups().then((function(groups){var group=null;groups.forEach((function(item){item.name===group_name&&(group=item)})),defered.resolve(group)})),defered.promise},this.sortUsersInGroup=function(group){group&&(group.sortedUserList=usersService.getFilterAndOrderUsersGroupedByOrderLabelAndUpdateActivity(group.users,$rootScope.orderType,$rootScope.filterType,!0))},this.searchLocalGroup=function(searchText){var groupNamesMatches=[];return $log.info("[groupService] searchLocalGroup with text "+searchText),searchText&&service.groups.forEach((function(gr){gr.name.toLowerCase().indexOf(searchText.toLowerCase().toString())>=0&&groupNamesMatches.push(gr)})),groupNamesMatches},this.extractStanzaData=function(stanza){var defered=$q.defer(),stanzaData={outgoingMessage:!1};return stanzaData.body=angular.element(stanza)[0].firstChild,stanzaData.messageId=angular.element(stanza).attr("id"),defered.resolve(stanzaData),defered.promise},this.onGroupMessageReceived=function(stanza){try{return this.extractStanzaData(stanza).then((function(stanzaData){if(stanzaData.body&&"group"===stanzaData.body.tagName){var action=stanzaData.body.getAttribute("action"),scope=stanzaData.body.getAttribute("scope"),group_id=stanzaData.body.getAttribute("id");switch(scope){case"group":switch(action){case"create":service.getGroup(group_id).then((function(){$rootScope.$broadcast(service.ON_CREATED_GROUP_EVENT,group_id)}));break;case"update":var name=stanzaData.body.getAttribute("name"),comment=stanzaData.body.getAttribute("comment"),isFavorite="true"===stanzaData.body.getAttribute("isFavorite");$rootScope.$broadcast(service.ON_UPDATE_GROUP_EVENT,group_id,name,comment,isFavorite);break;case"delete":removeGroupAct(group_id),$rootScope.$broadcast(service.ON_REMOVED_GROUP_EVENT,group_id)}break;case"user":var user_id=stanzaData.body.getAttribute("userId");switch(action){case"create":addGroupUserAct(group_id,user_id);break;case"delete":removeGroupUserAct(group_id,user_id),$rootScope.$broadcast(service.ON_REMOVE_GROUP_USER_EVENT,group_id,user_id)}}}})),!0}catch(error){return!0}},this.attachHandlers=function(){service.removeHandlers(),service.groupMessageHandlerRef||(service.groupMessageHandlerRef=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.addHandler((function(stanza){return service.onGroupMessageReceived(stanza)}),null,"message","management"))},this.removeHandlers=function(){service.groupMessageHandlerRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.deleteHandler(service.groupMessageHandlerRef),service.groupMessageHandlerRef=null)},this.handleBadRequest=function(message,response){if(400===response.status&&response.data.errorDetails&&response.data.errorDetails.length>0){var fieldErrors={};response.data.errorDetails.forEach((function(details){fieldErrors[details.param]=details.msg}));var error=new Error(message+" failure: BadRequest");return error.fieldErrors=fieldErrors,error}return null},this.handleErrorMessage=function(response){var errorMessage=" failure: ";return 500===response.status&&(errorMessage+="Internal server error"),403===response.status?errorMessage+="Access is forbidden for the current user":404===response.status?errorMessage+=response.data.errorMsg:response.data&&response.data.errorDetails&&(errorMessage+=response.data.errorDetails),errorMessage},this.logUserGroups=function(ownername,groups){var groupsNameContent="";groups&&0!==groups.length&&(groups.forEach((function(gr){gr.name&&(groupsNameContent+=" "+gr.name)})),$log.info("[groupService] logUserGroups for "+ownername+":"+groupsNameContent))},this.logGroupUsers=function(group){var UserNameContent;group&&group.users&&0!==group.users.length&&(UserNameContent=group.users.map((function(user){return user.nameForLog})).join(" / "),$log.info("[groupService] logGroupUsers for "+group.name+": "+UserNameContent))}}])},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var MPCallState,call_model_1=__webpack_require__(0),uuid4=__webpack_require__(27),moment=__webpack_require__(3),contact_service_1=__webpack_require__(1),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),profile_service_1=__webpack_require__(6);!function(MPCallState){MPCallState[MPCallState.Unknow=0]="Unknow",MPCallState[MPCallState.Free=1]="Free",MPCallState[MPCallState.WaitWebrtc=2]="WaitWebrtc",MPCallState[MPCallState.WaitTelephony=3]="WaitTelephony",MPCallState[MPCallState.CallOffer=4]="CallOffer",MPCallState[MPCallState.CallOnGoing=5]="CallOnGoing",MPCallState[MPCallState.CallActive=6]="CallActive",MPCallState[MPCallState.CallActiveNoWebMedia=7]="CallActiveNoWebMedia",MPCallState[MPCallState.TelCallReleasing=8]="TelCallReleasing",MPCallState[MPCallState.WebCallReleasing=9]="WebCallReleasing",MPCallState[MPCallState.RemoteControled=10]="RemoteControled",MPCallState[MPCallState.AnomalyCCS=11]="AnomalyCCS"}(MPCallState=exports.MPCallState||(exports.MPCallState={}));var WebrtcGatewayService=function(){function WebrtcGatewayService($q,$rootScope,$log,$http,$interval,videoService,errorHelperService,telephonyService){_classCallCheck(this,WebrtcGatewayService),this.$q=$q,this.$rootScope=$rootScope,this.$log=$log,this.$http=$http,this.$interval=$interval,this.videoService=videoService,this.errorHelperService=errorHelperService,this.telephonyService=telephonyService,this.started=!1,this.listeners=[],this.myContact=null,this.mediaPillarContact=null,this.mediaPillarConfigured=!1,this.mediaPillarAlive=!1,this.mediaPillarJid="",this.authService=auth_service_1.default,this.evtQueue=[],this.SEM=0,this.fakeMediaPillarJid="00a241586a984a869c73719007b27921@demo-all-in-one-dev-1.opentouch.cloud",this.xmppService=xmpp_service_1.default,this.profileService=profile_service_1.default,this.contactService=contact_service_1.default,this.TO_transition=15e3,this.TO_transition_long=3e4,this.TO_NoWebMedia=6e4,this.TO_NoWebMediaNotel=5e3,this.TO_PILLAR_POLLING=3e5,this.TO_waitTelephony=600,this.mediaPillarKeepAliveSuspend=!1}return _createClass(WebrtcGatewayService,[{key:"start",value:function(stats){var _this237=this,startDate=performance.now();return this.mediaPillarConfigured=!1,this.mediaPillarAlive=!1,this.portalURL=config.restServerUrl+"/api/rainbow/mediapillar/v1.0/mediapillars",this.myContact=this.contactService.userContact,this.mediaPillarContact=null,this.mediaPillarCallContext={callState:MPCallState.Free,keepAlive_TO:null,callState_TO:null,waitTelephony_TO:null,isOutgoingCall3PCC:!1,telephonyCallRefs:[],webrtcCallRef:null,mediaPillarJid:"",rainbowPhoneNumber:"",remoteExtension:"",previousCallConnectionId:null,previousCallStatus:null,updateContactFlag:!1,isIncomingCallPopupWithWebRtcCall:!1},this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_WEBRTC_PSTN_CALLING)?(this.$log.info("[WebrtcGatewayService] === STARTING ==="),this.started=!0,this.SEM=0,this.resetEvtAutomaton(),this.getMediaPillarData().then((function(mediaPillarJid){_this237.mediaPillarContact=_this237.createMediaPillarContact(mediaPillarJid),_this237.mediaPillarCallContext.mediaPillarJid=mediaPillarJid,_this237.$log.info("[WebrtcGatewayService] Pillar remoteExtension used : "+_this237.mediaPillarCallContext.remoteExtension),""!==_this237.mediaPillarCallContext.remoteExtension?_this237.mediaPillarConfigured=!0:(_this237.$log.warn("[WebrtcGatewayService] no remoteExtention available "),_this237.mediaPillarConfigured=!1),_this237.mediaPillarConfigured&&_this237.dummyRegisterMediaPillarCall().then((function(){_this237.mediaPillarAlive=!0,_this237.$log.info("[WebrtcGatewayService] Pseudo media pillar register OK with extension "+_this237.mediaPillarCallContext.remoteExtension),_this237.$rootScope.$broadcast("ON_WEBRTCGATEWAY_STATE_CHG",_this237.mediaPillarAlive)})).catch((function(error){_this237.mediaPillarAlive=!1,_this237.$log.info("[WebrtcGatewayService] Pseudo media pillar register KO"),_this237.$log.info("[WebrtcGatewayService] Initial polling activated on starting issue"),_this237.mediaPillarKeepAlivePolling("START",3e5),_this237.$rootScope.$broadcast("ON_WEBRTCGATEWAY_STATE_CHG",_this237.mediaPillarAlive)})),_this237.xmppConnectionSubscription=_this237.xmppService.subscribeToConnectionEvents((function(event){"ON_XMPP_DISCONNECTED"===event.name?(_this237.$log.info("[WebrtcGatewayService] onConnectionStateChangeEvent : disconnected then MP keepalive suspended"),_this237.mediaPillarKeepAliveSuspend=!0):"ON_XMPP_CONNECTED"===event.name&&(_this237.$log.info("[WebrtcGatewayService] onConnectionStateChangeEvent : connected then keepalive as necessary"),_this237.mediaPillarKeepAliveSuspend=!1,_this237.TO_PILLAR_POLLING=3e5)})),_this237.listeners.push(_this237.$rootScope.$on("ON_CALL_UPDATED_EVENT",(function(event,call,infoEvt){_this237.onCallEvent(event,call,infoEvt)}))),_this237.listeners.push(_this237.$rootScope.$on("ON_MEDIAPILLAR_CALL_REMOTE_CTRL_EVENT",(function(event,call){_this237.onRemoteCtrlCall(event,call)})));var startDuration=Math.round(performance.now()-startDate);stats.push({service:"WebrtcGatewayService",startDuration:startDuration}),_this237.$log.info("[WebrtcGatewayService] === STARTED ("+startDuration+" ms) ===")})).catch((function(error){_this237.mediaPillarCallContext.mediaPillarJid="",_this237.mediaPillarCallContext.rainbowPhoneNumber="",_this237.mediaPillarCallContext.remoteExtension="",_this237.mediaPillarConfigured=!1,_this237.mediaPillarAlive=!1,_this237.$log.info("[WebrtcGatewayService] === STARTING FAILURE === "+error.message)}))):this.$log.info("[WebrtcGatewayService] === NO WEBRTCGATEWAY ENVOLVED === "),this.$q.when()}},{key:"stop",value:function(){return this.$log.info("[WebrtcGatewayService] === STOPPING ==="),this.started=!1,this.mediaPillarConfigured=!1,this.mediaPillarAlive=!1,this.mediaPillarKeepAlivePolling("STOP",0),this.mediaPillarCallContext&&(this.releaseMediaPillarCallContext(),this.mediaPillarCallContext.callState=MPCallState.Unknow,this.mediaPillarCallContext.mediaPillarJid="",this.mediaPillarCallContext.rainbowPhoneNumber="",this.mediaPillarCallContext.remoteExtension=""),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.listeners&&this.listeners.forEach((function(unregisterListener){unregisterListener()})),this.$log.info("[WebrtcGatewayService] === STOPPED ==="),this.$q.resolve()}},{key:"onCallEvent",value:function(__event,call,infoEvt){if(this.isMediaPillarCallCase()){if(this.SEM++,this.$log.info("[WebrtcGatewayService] onCallEvent IN("+this.SEM+") state = "+this.mediaPillarCallContext.callState),this.$log.info("[WebrtcGatewayService] onCallEvent "+this.mediaPillarCallContext.callState+" --- "+call.type.value+"("+call.id+","+call.status.value+")"),infoEvt&&null!==infoEvt&&(this.$log.info("[WebrtcGatewayService] onCallEvent tel infoEvt = "+infoEvt),this.$log.info("[WebrtcGatewayService] onCallEvent tel infoEvt : Evt = "+infoEvt.actionElemName+" / cause = "+infoEvt.cause),"updatecall"===infoEvt.actionElemName&&(this.mediaPillarCallContext.updateContactFlag=!0,this.$log.info("[WebrtcGatewayService] updateContactFlag = true"))),call.connectionId===this.mediaPillarCallContext.previousCallConnectionId&&call.status===this.mediaPillarCallContext.previousCallStatus&&!this.mediaPillarCallContext.updateContactFlag)return this.mediaPillarCallContext.previousCallConnectionId=call.connectionId,this.mediaPillarCallContext.previousCallStatus=call.status,this.$log.info("[WebrtcGatewayService] onCallEvent | DEBOUNCE EVT"),this.SEM--,void this.$log.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+")");if(call.type.value===call_model_1.Call.Type.PHONE.value&&null===call.id)return this.mediaPillarCallContext.previousCallConnectionId=call.connectionId,this.mediaPillarCallContext.previousCallStatus=call.status,this.$log.info("[WebrtcGatewayService] onCallEvent | FILTER EVT null/error"),this.SEM--,void this.$log.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+")");if(this.mediaPillarCallContext.previousCallConnectionId=call.connectionId,this.mediaPillarCallContext.previousCallStatus=call.status,this.evtQueue.push(call),this.evtQueue.length>1)return this.SEM--,void this.$log.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+") evt pushed = "+call.status.value);for(;this.evtQueue.length;){try{this.processEvt(this.evtQueue[0])}catch(error){this.$log.error("[WebrtcGatewayService] onCallEvent queue processing | call : "+this.evtQueue[0].status.value+" Error : "+error)}this.evtQueue.splice(0,1)}this.SEM--,this.$log.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+") state = "+this.mediaPillarCallContext.callState),0!==this.SEM&&(this.$log.error("[WebrtcGatewayService] onCallEvent OUT | Unmanaged Eventing Reentrancy Situation"),this.resetEvtAutomaton(),this.SEM=0)}}},{key:"processEvt",value:function(call){var _this238=this;if(this.$log.info("[WebrtcGatewayService] processEvt | process "+call.type.value+"("+call.id+","+call.status.value+") in MPcontextCallstate = "+this.mediaPillarCallContext.callState),call.type.value===call_model_1.Call.Type.PHONE.value){var telCallsNumber=this.telephonyService.getCalls().length;if(function(){var ignoreEvt=!1;return(call.status===call_model_1.Call.Status.DIALING||_this238.telephonyService.isSipWise())&&(call.isSecondary=!0),call.isSecondary?call.status===call_model_1.Call.Status.UNKNOWN||call.status===call_model_1.Call.Status.RINGING_INCOMMING||call.status===call_model_1.Call.Status.QUEUED_INCOMMING||call.status===call_model_1.Call.Status.ACTIVE?(_this238.addTelCallRefs(call),ignoreEvt=!1):_this238.mediaPillarCallContext.callState===MPCallState.RemoteControled?(_this238.$log.info("[WebrtcGatewayService] processEvt |  RemoteControled state for call : "+call.id+" then ignore"),ignoreEvt=!0):(_this238.addTelCallRefs(call),_this238.mediaPillarCallContext.telephonyCallRefs.length>1?(_this238.$log.info("[WebrtcGatewayService] processEvt |  nthCall : "+_this238.mediaPillarCallContext.telephonyCallRefs.length+" then ignore"),ignoreEvt=!0):ignoreEvt):(_this238.$log.info("[WebrtcGatewayService] processEvt | NOT SECONDARY then ignore"),ignoreEvt=!0)}())this.$log.info("[WebrtcGatewayService] processEvt |  call("+call.id+" / SEC "+call.isSecondary+", "+call.status.value+") -> EVT IGNORED"),this.$log.info("[WebrtcGatewayService] processEvt |  telephonyCallRefs.length = "+this.mediaPillarCallContext.telephonyCallRefs.length),this.$log.info("[WebrtcGatewayService] processEvt |  calls.length = "+telCallsNumber);else switch(this.$log.info("[WebrtcGatewayService] processEvt |  call("+call.id+" / SEC "+call.isSecondary+", "+call.status.value+") -> EVT PROCESSED"),this.$log.info("[WebrtcGatewayService] processEvt |  telephonyCallRefs.length = "+this.mediaPillarCallContext.telephonyCallRefs.length),this.$log.info("[WebrtcGatewayService] processEvt |  calls.length = "+telCallsNumber),call.status){case call_model_1.Call.Status.RINGING_INCOMMING:this.onTelCallIncomming(call);break;case call_model_1.Call.Status.DIALING:this.onTelCallDialling(call);break;case call_model_1.Call.Status.RINGING_OUTGOING:this.onTelCallOutgoing(call);break;case call_model_1.Call.Status.ACTIVE:this.onTelCallActive(call);break;case call_model_1.Call.Status.UNKNOWN:this.onTelCallReleasing(call)}}else if(this.isMediaPillarJid(this.xmppService.getBareJidFromJid(call.fullJid)))switch(call.status){case call_model_1.Call.Status.RINGING_INCOMMING:this.onWebrtcCallIncomming(call);break;case call_model_1.Call.Status.CONNECTING:this.onWebrtcCallConnecting(call);break;case call_model_1.Call.Status.ACTIVE:this.onWebrtcCallActive(call);break;case call_model_1.Call.Status.ANSWERING:this.onWebrtcCallAnswering(call);break;case call_model_1.Call.Status.UNKNOWN:this.onWebrtcCallReleasing(call)}else this.$log.info("[WebrtcGatewayService] processEvt | process call("+call.id+","+call.status.value+") -> Not a webrtcgateway case")}},{key:"releaseMediaPillarCallContext",value:function(){this.mediaPillarCallContext.callState=MPCallState.Free,this.stopCallStateTimeOut(),this.stopWaitTelephonyTimeOut(),this.mediaPillarCallContext.isOutgoingCall3PCC=!1,this.mediaPillarCallContext.updateContactFlag=!1,this.mediaPillarCallContext.telephonyCallRefs.length>0&&this.$log.warn("[WebrtcGatewayService] releaseMediaPillarCallContext | reset context but telephonyCallRefs not empty !"),null!==this.mediaPillarCallContext.webrtcCallRef&&this.$log.warn("[WebrtcGatewayService] releaseMediaPillarCallContext | reset context but webrtcCallRef not null !"),this.mediaPillarCallContext.telephonyCallRefs=[],this.mediaPillarCallContext.webrtcCallRef=null,this.mediaPillarCallContext.previousCallConnectionId=null,this.mediaPillarCallContext.previousCallStatus="",this.mediaPillarCallContext.isIncomingCallPopupWithWebRtcCall=!1,this.$log.log("[WebrtcGatewayService] releaseMediaPillarCallContext | =====  mediaPillarCallContext RELEASED  ===== ")}},{key:"resetEvtAutomaton",value:function(){this.evtQueue=[]}},{key:"stopCallStateTimeOut",value:function(){this.mediaPillarCallContext.callState_TO&&this.$interval.cancel(this.mediaPillarCallContext.callState_TO),this.mediaPillarCallContext.callState_TO=null}},{key:"stopWaitTelephonyTimeOut",value:function(){this.mediaPillarCallContext.waitTelephony_TO&&this.$interval.cancel(this.mediaPillarCallContext.waitTelephony_TO),this.mediaPillarCallContext.waitTelephony_TO=null}},{key:"onRemoteCtrlCall",value:function(__event,call){this.$log.info("[WebrtcGatewayService] onRemoteCtrlCall for call "+call.id+" in previous state: "+this.mediaPillarCallContext.callState+": => Becomes REMOTECONTROLED"),this.mediaPillarCallContext.callState=MPCallState.RemoteControled,this.stopCallStateTimeOut()}},{key:"addTelCallRefs",value:function(callRef){if(null!=callRef){for(var alreadyIn=!1,i=0;i<this.mediaPillarCallContext.telephonyCallRefs.length;i++)this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[i].id===callRef.id&&(alreadyIn=!0);alreadyIn||this.mediaPillarCallContext.telephonyCallRefs.push(callRef)}else this.$log.warn("[WebrtcGatewayService] addTelCallRefs | ANOMALY callRef not valid")}},{key:"removeTelCallRefs",value:function(callRef){if(null!=callRef)for(var i=0;i<this.mediaPillarCallContext.telephonyCallRefs.length;)this.mediaPillarCallContext.telephonyCallRefs[i].id===callRef.id?(this.mediaPillarCallContext.telephonyCallRefs.splice(i,1),0===i&&this.mediaPillarCallContext.telephonyCallRefs.length&&(this.mediaPillarCallContext.telephonyCallRefs[0].setMediaPillarCall(this.getMediaPillarCallContext()),this.$log.log("[WebrtcGatewayService] removeTelCallRefs | master MP call becomes : "+this.mediaPillarCallContext.telephonyCallRefs[0].id))):i++;else this.$log.warn("[WebrtcGatewayService] removeTelCallRefs | ANOMALY callRef not valid")}},{key:"putAsMasterTelCallRefs",value:function(callRef){if(null!=callRef){for(var i=-1,j=0;j<this.mediaPillarCallContext.telephonyCallRefs.length;j++)this.mediaPillarCallContext.telephonyCallRefs[j].id===callRef.id&&(i=j);if(this.$log.log("[WebrtcGatewayService] putAsMasterTelCallRefs | master MP call is : "+callRef.id),0!==i)if(-1!==i){var replace=this.mediaPillarCallContext.telephonyCallRefs[0];this.mediaPillarCallContext.telephonyCallRefs[0]=callRef,this.mediaPillarCallContext.telephonyCallRefs[i]=replace,callRef.setMediaPillarCall(this.getMediaPillarCallContext())}else this.$log.warn("[WebrtcGatewayService] putAsMasterTelCallRefs | Anomaly call not in telephonyCallRefs")}else this.$log.warn("[WebrtcGatewayService] putAsMasterTelCallRefs | ANOMALY callRef not valid")}},{key:"isMasterTelCallRefs",value:function(callRef){return null==callRef?(this.$log.warn("[WebrtcGatewayService] isMasterTelCallRefs | ANOMALY callRef not valid"),!1):0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[0].id===callRef.id}},{key:"isInTelCallRefs",value:function(callRef){if(null!=callRef){for(var i=-1,j=0;j<this.mediaPillarCallContext.telephonyCallRefs.length;j++)this.mediaPillarCallContext.telephonyCallRefs[j].id===callRef.id&&(i=j);return-1!==i}this.$log.warn("[WebrtcGatewayService] isInTelCallRefs | ANOMALY callRef not valid")}},{key:"replaceCallRefs",value:function(newCallRef,oldCallRef){if(null!=newCallRef&&null!=oldCallRef){var flagNewAlreadyExist=!1,flagNewLinked=newCallRef.isMediaPillarCall(),flagOldLinked=oldCallRef.isMediaPillarCall();this.isInTelCallRefs(newCallRef)&&(flagNewAlreadyExist=!0,this.$log.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY newcallRef already existing"),this.removeTelCallRefs(newCallRef));for(var i=-1,j=0;j<this.mediaPillarCallContext.telephonyCallRefs.length;j++)this.mediaPillarCallContext.telephonyCallRefs[j].id===oldCallRef.id&&(i=j);-1!==i?(this.mediaPillarCallContext.telephonyCallRefs[i]=newCallRef,flagOldLinked&&newCallRef.setMediaPillarCall(this.getMediaPillarCallContext()),oldCallRef.setMediaPillarCall(null),0===i&&this.$log.log("[WebrtcGatewayService] replaceCallRefs | master MP call becomes : "+this.mediaPillarCallContext.telephonyCallRefs[0].id)):(this.$log.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY oldCallRef not found"),flagNewAlreadyExist&&(this.addTelCallRefs(newCallRef),flagNewLinked&&newCallRef.setMediaPillarCall(this.getMediaPillarCallContext())))}else this.$log.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY callRef not valid")}},{key:"automatonDefenseTimout",value:function(call){var _this239=this,actionLevel=0;if(null!=call)if(call.type.value===call_model_1.Call.Type.PHONE.value)switch(this.$log.log("[WebrtcGatewayService] automatonDefenseTimout | transition telcall call="+call.id+" evt="+call.status.value+" then timout"),call.status){case call_model_1.Call.Status.RINGING_OUTGOING:case call_model_1.Call.Status.RINGING_INCOMMING:break;default:this.mediaPillarCallContext.callState!==MPCallState.CallActive&&this.mediaPillarCallContext.callState!==MPCallState.CallActiveNoWebMedia&&this.mediaPillarCallContext.callState!==MPCallState.CallOffer&&this.mediaPillarCallContext.callState!==MPCallState.CallOnGoing&&(actionLevel=2)}else if(this.isMediaPillarJid(this.xmppService.getBareJidFromJid(call.fullJid)))switch(this.$log.log("[WebrtcGatewayService] automatonDefenseTimout | transition webrtc "+call.status.value+" then timout"),call.status){case call_model_1.Call.Status.ACTIVE:break;default:this.mediaPillarCallContext.callState!==MPCallState.CallActive&&this.mediaPillarCallContext.callState!==MPCallState.CallActiveNoWebMedia&&this.mediaPillarCallContext.callState!==MPCallState.CallOffer&&this.mediaPillarCallContext.callState!==MPCallState.CallOnGoing&&(actionLevel=3)}else this.$log.warn("[WebrtcGatewayService] automatonDefenseTimout | anomaly transition webrtc call but Not a webrtcgateway case"),actionLevel=2;else this.mediaPillarCallContext.callState!==MPCallState.CallActive&&this.mediaPillarCallContext.callState!==MPCallState.CallActiveNoWebMedia&&this.mediaPillarCallContext.callState!==MPCallState.RemoteControled&&this.mediaPillarCallContext.callState!==MPCallState.CallOffer&&this.mediaPillarCallContext.callState!==MPCallState.CallOnGoing&&(this.$log.log("[WebrtcGatewayService] automatonDefenseTimout | anomaly timout in unexpected state"),actionLevel=2);switch(0!==actionLevel&&this.$log.warn("[WebrtcGatewayService] automatonDefenseTimout | actionlevel "+actionLevel),actionLevel){case 0:break;case 1:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING);break;case 2:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.releaseMediaPillarCallContext();break;case 3:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.MediaPillarReleaseWebrtcCall(),this.releaseMediaPillarCallContext();break;default:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.MediaPillarCallTerminator()}this.mediaPillarCallContext.callState!==MPCallState.Free&&(this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this239.automatonDefenseTimout(null)}),this.TO_transition,1))}},{key:"onTelCallIncomming",value:function(call){var _this240=this;if(this.mediaPillarCallContext.telephonyCallRefs.length>1&&this.mediaPillarCallContext.callState!==MPCallState.Free&&this.mediaPillarCallContext.callState!==MPCallState.WaitTelephony&&this.mediaPillarCallContext.callState!==MPCallState.WaitWebrtc)return this.$log.info("[WebrtcGatewayService] onTelCallIncomming | nth calls BUT trig the GUI & link the call"),call.setMediaPillarCall(this.getMediaPillarCallContext()),this.$log.info("[WebrtcGatewayService] onTelCallIncomming | ON_WEBRTC_GW_CALL_UPDATED_EVENT for call = "+call.id),this.mediaPillarCallContext.updateContactFlag=!0,void this.$rootScope.$broadcast("ON_WEBRTC_GW_CALL_UPDATED_EVENT",call);switch(this.$log.info("[WebrtcGatewayService] onTelCallIncomming | mediapilaryse as necessary for call "+call.id+" date "+moment().format("HH:mm:ss:SSS")),this.mediaPillaryseTheCall(call,null)){case"Ok":if(this.stopWaitTelephonyTimeOut(),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this240.automatonDefenseTimout(call)}),this.TO_transition,1),!this.isMediaPillarOutgoingCall()&&this.mediaPillarCallContext.callState===MPCallState.CallOffer&&this.mediaPillarCallContext.webrtcCallRef){var isPopupWithWebrtcCall=this.mediaPillarCallContext.isIncomingCallPopupWithWebRtcCall;isPopupWithWebrtcCall&&(this.$log.warn("[WebrtcGatewayService] onTelCallIncomming | Incoming tel phone while Popup displayed with Webrtc Call should happen in rare cases when csta event is very slow: use phone call info anyway for call "+call.id),this.mediaPillarCallContext.webrtcCallRef.contact=Object.assign(this.mediaPillarCallContext.webrtcCallRef.contact,call.contact),this.$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:this.mediaPillarCallContext.webrtcCallRef}));for(var i=0;i<this.mediaPillarCallContext.telephonyCallRefs.length;i++)(!isPopupWithWebrtcCall&&(this.mediaPillarCallContext.telephonyCallRefs[i].status===call_model_1.Call.Status.RINGING_INCOMMING||this.mediaPillarCallContext.telephonyCallRefs[i].status===call_model_1.Call.Status.QUEUED_INCOMMING)||isPopupWithWebrtcCall&&this.mediaPillarCallContext.telephonyCallRefs[i].status===call_model_1.Call.Status.QUEUED_INCOMMING)&&(this.$log.info("[WebrtcGatewayService] onTelCallIncomming | ON_WEBRTC_GW_CALL_UPDATED_EVENT for call = "+call.id),this.mediaPillarCallContext.updateContactFlag=!0,this.$rootScope.$broadcast("ON_WEBRTC_GW_CALL_UPDATED_EVENT",this.mediaPillarCallContext.telephonyCallRefs[i]))}break;case"Update":this.stopCallStateTimeOut(),this.isMediaPillarOutgoingCall()||!this.mediaPillarCallContext.webrtcCallRef||call.status!==call_model_1.Call.Status.RINGING_INCOMMING&&call.status!==call_model_1.Call.Status.QUEUED_INCOMMING?this.$log.info("[WebrtcGatewayService] onTelCallIncomming | ignore update call"):(this.$rootScope.$broadcast("ON_WEBRTC_GW_CALL_UPDATED_EVENT",call),this.$log.info("[WebrtcGatewayService] onTelCallIncomming | update call"));break;case"Ignore":this.$log.info("[WebrtcGatewayService] onTelCallIncomming | ignore evt");break;default:this.$log.error("[WebrtcGatewayService] onTelCallIncomming | media Pillar call anomaly "+status)}}},{key:"onTelCallDialling",value:function(call){var _this241=this;if(this.mediaPillarCallContext.isOutgoingCall3PCC=!0===call.isOwner,this.mediaPillarCallContext.isOutgoingCall3PCC)if(this.mediaPillarCallContext.callState===MPCallState.Free||this.mediaPillarCallContext.callState===MPCallState.WaitTelephony)switch(this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this241.automatonDefenseTimout(call)}),this.TO_transition,1),this.mediaPillaryseTheCall(call,null)){case"Ok":this.mediaPillarCallContext.webrtcCallRef&&this.mediaPillarCallContext.callState===MPCallState.CallOffer&&(this.videoService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.$log.info("[WebrtcGatewayService] onTelCallDialling | outgoing3PCC then send webrtc proceed")),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this241.automatonDefenseTimout(call)}),this.TO_transition,1);break;case"Ignore":case"Update":this.$log.info("[WebrtcGatewayService] onTelCallDialling | ignore evt");break;default:this.$log.error("[WebrtcGatewayService] onTelCallDialling | media Pillar call anomaly "+status),this.MediaPillarCallTerminator()}else this.mediaPillarCallContext.callState===MPCallState.CallOffer||this.mediaPillarCallContext.callState===MPCallState.CallOnGoing?(this.$log.warn("[WebrtcGatewayService] onTelCallDialling | media Pillar call anomaly, on state : "+this.mediaPillarCallContext.callState),this.$log.info("[WebrtcGatewayService] onTelCallDialling | ignored , on state : "+this.mediaPillarCallContext.callState)):(this.$log.warn("[WebrtcGatewayService] onTelCallDialling | media Pillar call anomaly, MP context not compatible"),this.MediaPillarCallTerminator());else this.stopCallStateTimeOut(),this.$log.info("[WebrtcGatewayService] onTelCallDialling but not call owner (=>other client) | ignore evt on state : "+this.mediaPillarCallContext.callState)}},{key:"onTelCallOutgoing",value:function(call){var _this242=this;this.isMediaPillarOutgoingCall()?(this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this242.automatonDefenseTimout(call)}),this.TO_transition_long,1)):(this.$log.warn("[WebrtcGatewayService] onTelCallOutgoing | media Pillar, not a 1st 3PCC outgoing call then ignore & release MP CallContext"),this.releaseMediaPillarCallContext())}},{key:"onTelCallActive",value:function(call){switch(this.mediaPillarCallContext.callState){case MPCallState.CallOnGoing:this.stopCallStateTimeOut(),call.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=MPCallState.CallActive;break;case MPCallState.TelCallReleasing:this.$log.warn("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state = "+this.mediaPillarCallContext.callState),this.$log.info("[WebrtcGatewayService] onTelCallActive | media Pillar , RE-ACTIVATION"),this.stopCallStateTimeOut(),call.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=MPCallState.CallActive;break;case MPCallState.CallActive:this.$log.info("[WebrtcGatewayService] onTelCallActive | media Pillar , ignore tel active on state CallActive ");break;case MPCallState.WebCallReleasing:this.$log.info("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state WebCallReleasing then releaseMediaPillarCallContext"),this.releaseMediaPillarCallContext();break;case MPCallState.Free:this.$log.info("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state = 1 ; probably call taken on deskphone ; ignore active & release call context "),this.releaseMediaPillarCallContext();break;default:this.$log.info("[WebrtcGatewayService] onTelCallActive | Anomaly media Pillar recv tel active on state = "+this.mediaPillarCallContext.callState)}}},{key:"onTelCallReleasing",value:function(call){var _this243=this;if(this.telephonyService.getCalls().length,this.mediaPillarCallContext.telephonyCallRefs.length>1)return call.setMediaPillarCall(null),this.removeTelCallRefs(call),void this.$log.info("[WebrtcGatewayService] onTelCallReleasing -- "+call.id+" -- postpone mediaPillarCallContext release ;  remaining calls = "+this.mediaPillarCallContext.telephonyCallRefs.length);this.isMediaPillarReleasableCall()?(call.setMediaPillarCall(null),this.removeTelCallRefs(call),this.mediaPillarCallContext.webrtcCallRef&&this.mediaPillarCallContext.callState!==MPCallState.WebCallReleasing&&this.mediaPillarCallContext.callState!==MPCallState.RemoteControled?this.mediaPillarCallContext.callState!==MPCallState.TelCallReleasing?(this.mediaPillarCallContext.callState=MPCallState.TelCallReleasing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this243.automatonDefenseTimout(call)}),this.TO_transition,1),this.$log.info("[WebrtcGatewayService] onTelCallReleasing -- "+call.id+" -- wait web release: state = "+this.mediaPillarCallContext.callState)):this.$log.info("[WebrtcGatewayService] onTelCallReleasing -- "+call.id+" -- ignore telrelease on state = "+this.mediaPillarCallContext.callState):this.mediaPillarCallContext.callState!==MPCallState.Free&&(this.releaseMediaPillarCallContext(),this.$log.info("[WebrtcGatewayService] onTelCallReleasing -- "+call.id+" -- release MP context"))):(this.$log.warn("[WebrtcGatewayService] onTelCallReleasing | media Pillar call release anomaly on state = "+this.mediaPillarCallContext.callState),this.MediaPillarCallTerminator())}},{key:"onWebrtcCallIncomming",value:function(call){var _this244=this;if(this.mediaPillarCallContext.webrtcCallRef)this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming -- "+call.id+" --- ignored other incomming");else{if(this.mediaPillarCallContext.callState===MPCallState.WebCallReleasing&&0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[0].status!==call_model_1.Call.Status.UNKNOWN)return this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming -- "+call.id+" --- re propose during established tel call"),this.mediaPillarCallContext.webrtcCallRef=call,this.videoService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this244.automatonDefenseTimout(call)}),this.TO_transition,1),void(this.mediaPillarCallContext.callState=MPCallState.CallOnGoing);switch(this.mediaPillaryseTheCall(null,call)){case"Ok":if(this.stopCallStateTimeOut(),(this.isMediaPillarOutgoingCall()||this.mediaPillarCallContext.callState!==MPCallState.WaitTelephony)&&(this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this244.automatonDefenseTimout(call)}),this.TO_transition,1)),this.isMediaPillarOutgoingCall())this.videoService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming | outgoing3PCC then send webrtc proceed");else if(this.mediaPillarCallContext.callState===MPCallState.WaitTelephony)this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming | incoming webrtc WaitTelephony : "+moment().format("HH:mm:ss:SSS")+" : arm waitTelephony_TO "),this.stopWaitTelephonyTimeOut(),this.mediaPillarCallContext.waitTelephony_TO=this.$interval((function(){_this244.waitTelephonyTimeout(call)}),this.TO_waitTelephony,1);else if(this.mediaPillarCallContext.callState===MPCallState.CallOffer){this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming | incoming webrtc + telephony");for(var i=0;i<this.mediaPillarCallContext.telephonyCallRefs.length;i++)this.mediaPillarCallContext.telephonyCallRefs[i].status!==call_model_1.Call.Status.RINGING_INCOMMING&&this.mediaPillarCallContext.telephonyCallRefs[i].status!==call_model_1.Call.Status.QUEUED_INCOMMING||(this.$log.info("[WebrtcGatewayService] onWebrtcCallIncomming | ON_CONVERSATION_CALL_UPDATED_EVENT for call = "+this.mediaPillarCallContext.telephonyCallRefs[i].id),this.$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:this.mediaPillarCallContext.telephonyCallRefs[i]}))}break;case"Ignore":break;default:this.$log.error("[WebrtcGatewayService] onWebrtcCallIncomming | media Pillar call anomaly "+status)}}}},{key:"onWebrtcCallConnecting",value:function(call){var _this245=this;return this.mediaPillarCallContext.callState===MPCallState.CallActive?(this.$log.info("[WebrtcGatewayService] onWebrtcCallConnecting -- media Pillar call reconnecting attempts"),this.mediaPillarCallContext.callState=MPCallState.CallActiveNoWebMedia,this.stopCallStateTimeOut(),void(this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this245.timeOutCallActiveNoWebMedia()}),this.TO_NoWebMedia,1))):this.mediaPillarCallContext.callState===MPCallState.TelCallReleasing?(this.$log.info("[WebrtcGatewayService] onWebrtcCallConnecting -- media Pillar webrtc call reconnecting while TelCallReleasing"),this.mediaPillarCallContext.callState=MPCallState.CallActiveNoWebMedia,this.stopCallStateTimeOut(),void(this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this245.timeOutCallActiveNoWebMedia()}),this.TO_NoWebMediaNotel,1))):void 0}},{key:"onWebrtcCallActive",value:function(call){this.mediaPillarCallContext.callState===MPCallState.CallActiveNoWebMedia&&(this.$log.info("[WebrtcGatewayService] onWebrtcCallConnecting -- media Pillar call reconnected"),this.mediaPillarCallContext.callState=MPCallState.CallActive,this.stopCallStateTimeOut())}},{key:"onWebrtcCallAnswering",value:function(call){var _this246=this;this.mediaPillarCallContext.callState=MPCallState.CallOnGoing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this246.automatonDefenseTimout(call)}),this.TO_transition,1)}},{key:"onWebrtcCallReleasing",value:function(call){var _this247=this;this.isMediaPillarReleasableCall()?(call.setMediaPillarCall(null),this.mediaPillarCallContext.webrtcCallRef=null,0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.callState!==MPCallState.TelCallReleasing&&this.mediaPillarCallContext.callState!==MPCallState.RemoteControled?this.mediaPillarCallContext.callState!==MPCallState.WebCallReleasing?(this.mediaPillarCallContext.callState=MPCallState.WebCallReleasing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=this.$interval((function(){_this247.automatonDefenseTimout(call)}),this.TO_transition,1),this.releasePbxCallIfPbxConnectionDown(),this.$log.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+call.id+" -- wait tel release: state = "+this.mediaPillarCallContext.callState)):this.$log.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+call.id+" -- ignore webrelease on state = "+this.mediaPillarCallContext.callState):(this.releaseMediaPillarCallContext(),this.$log.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+call.id+" -- release MP context"))):(this.$log.warn("[WebrtcGatewayService] onWebrtcCallReleasing | media Pillar call release anomaly on state = "+this.mediaPillarCallContext.callState),this.MediaPillarCallTerminator())}},{key:"waitTelephonyTimeout",value:function(call){var _this248=this;this.mediaPillarCallContext.callState===MPCallState.WaitTelephony?(this.$log.info("[WebrtcGatewayService] waitTelephonyTimeout date "+moment().format("HH:mm:ss:SSS")+" -- "+call.id+" -- state = "+this.mediaPillarCallContext.callState+" : perform snpashot on secondary device to check remote extension's csta state"),this.telephonyService.snapshotDevice(!0).then((function(result){var connections=result.connections;_this248.mediaPillarCallContext.callState!==MPCallState.WaitTelephony||connections&&0!==connections.length?(_this248.$log.info("[WebrtcGatewayService] waitTelephonyTimeout date "+moment().format("HH:mm:ss:SSS")+" -- "+call.id+" -- state = "+_this248.mediaPillarCallContext.callState+" => no more waiting for phone call or existing csta call: don't display any incoming call popup"),_this248.stopCallStateTimeOut(),_this248.mediaPillarCallContext.callState_TO=_this248.$interval((function(){_this248.automatonDefenseTimout(call)}),_this248.TO_transition,1)):(_this248.$log.info("[WebrtcGatewayService] waitTelephonyTimeout date "+moment().format("HH:mm:ss:SSS")+" -- "+call.id+" -- state = "+_this248.mediaPillarCallContext.callState+" => still waiting for phone call and no csta call: send event to open incoming call popup with webrtc call"),_this248.mediaPillarCallContext.isIncomingCallPopupWithWebRtcCall=!0,_this248.$rootScope.$broadcast("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:call}))})).catch((function(error){_this248.$log.error("[WebrtcGatewayService] waitTelephonyTimeout date "+moment().format("HH:mm:ss:SSS")+" -- "+call.id+" -- state = "+_this248.mediaPillarCallContext.callState+" => snpashotdevice error "+error)}))):this.$log.info("[WebrtcGatewayService] waitTelephonyTimeout date "+moment().format("HH:mm:ss:SSS")+" -- "+call.id+" -- state = "+this.mediaPillarCallContext.callState+" => IGNORED"),this.mediaPillarCallContext.waitTelephony_TO=null}},{key:"releasePbxCallIfPbxConnectionDown",value:function(){var activePbxCall=this.getActivePbxCall();activePbxCall&&activePbxCall.pbxConnectionDown&&(this.$log.info("[WebrtcGatewayService] releasePbxCallIfPbxConnectionDown | release call"+activePbxCall),this.telephonyService.releaseCall(activePbxCall),activePbxCall.mediaPillarCall=null)}},{key:"mediaPillarMakeCall1PCC",value:function(phoneNumber,contact){this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall1PCC");var mediaPillarJid=this.getMyMediaPillarJid();if(!this.mediaPillarConfigured||!this.mediaPillarAlive)return this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall1PCC ANOMALY webrtcgateway not available"),null;if(this.videoService.makingCall=!0,""!==mediaPillarJid){var id="web_"+uuid4();if(!contact||null===contact){var _call6=call_model_1.Call.create(call_model_1.Call.Status.DIALING,id,call_model_1.Call.Type.WEBRTC,this.mediaPillarContact);return _call6.fullJid=mediaPillarJid,this.mediaPillarStartCall(_call6,phoneNumber,mediaPillarJid),_call6}var _call5=call_model_1.Call.create(call_model_1.Call.Status.DIALING,id,call_model_1.Call.Type.WEBRTC,contact);return _call5.fullJid=mediaPillarJid,this.mediaPillarStartCall(_call5,phoneNumber,mediaPillarJid),_call5}return this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY no mediaPillarJid"),null}},{key:"mediaPillarReleaseCall1PCC",value:function(call){if(this.$log.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC"),this.mediaPillarConfigured){var foundCall=this.videoService.calls[call.id];foundCall&&foundCall.type===call_model_1.Call.Type.WEBRTC?this.videoService.rejectCall(foundCall):this.$log.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC ANOMALY invalid call")}else this.$log.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC ANOMALY webrtcgateway not available")}},{key:"mediaPillarMakeCall",value:function(phoneNumber,contact){this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall");var mediaPillarJid=this.getMyMediaPillarJid();if(phoneNumber.length>6&&contact&&(phoneNumber=contact.phonePbx),this.videoService.makingCall=!0,""!==mediaPillarJid){var call,id="web_"+uuid4();contact&&null!==contact?((call=call_model_1.Call.create(call_model_1.Call.Status.DIALING,id,call_model_1.Call.Type.WEBRTC,contact)).fullJid=mediaPillarJid,this.mediaPillarStartCall(call,phoneNumber,mediaPillarJid)):((call=call_model_1.Call.create(call_model_1.Call.Status.DIALING,id,call_model_1.Call.Type.WEBRTC,this.mediaPillarContact)).fullJid=mediaPillarJid,this.mediaPillarStartCall(call,phoneNumber,mediaPillarJid))}else this.$log.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY no mediaPillarJid")}},{key:"mediaPillarStartCall",value:function(call,phoneNumber,mediaPillarJid){var _this249=this;this.$log.info("[WebrtcGatewayService] mediaPillarStartCall for phone number "+phoneNumber),this.initiateMediaPillarCall(call).then((function(){_this249.dummyRegisterMediaPillarCall().then((function(){_this249.$log.info("[WebrtcGatewayService] mediaPillarMakeCall for number "+phoneNumber),_this249.videoService.makeJingleCall(call,mediaPillarJid,phoneNumber)})).catch((function(error){_this249.$log.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY dummyRegisterMediaPillarCall then abort call"),_this249.abortCall(call)}))})).catch((function(error){_this249.$log.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY initiateMediaPillarCall then abort call"),_this249.abortCall(call)}))}},{key:"abortCall",value:function(call){this.videoService.makingCall=!1,call&&this.videoService.removeCallObject(call),this.videoService.resetToSafeState()}},{key:"initiateMediaPillarCall",value:function(call){var _this250=this;return this.$q((function(resolve,reject){_this250.$log.info("[WebrtcGatewayService] initiateMediaPillarCall");var mediaToGet=["audio"];_this250.videoService.getBrowserMedia(mediaToGet).then((function(stream){call.isInitiator=!0,_this250.videoService.localStreams.push(stream),_this250.videoService.calls[call.id]=call,call.localMedia=call.localMedia|call_model_1.Call.Media.AUDIO,_this250.contactService.setBusyState("dnd",_this250.videoService.calculatePresenceMessage(call)),_this250.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),resolve()})).catch((function(error){_this250.$log.info("[WebrtcGatewayService]   | initate call failure : "+JSON.stringify({error:error.message})),mediaToGet.indexOf("sharing")>=0||-1===error.toString().indexOf("getUserMedia")||_this250.videoService.openErrorPopup(),reject(error)}))}))}},{key:"dummyRegisterMediaPillarCall",value:function(){var _this251=this;return this.$q((function(resolve,reject){var xmppIq=$iq({from:_this251.myContact.fullJid,to:_this251.mediaPillarCallContext.mediaPillarJid,type:"set"}).c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("register").c("jidIm").t(_this251.contactService.userContact.jid).up().c("jidTel").t(_this251.contactService.userContact.jidtel).up().c("number").t(_this251.mediaPillarCallContext.rainbowPhoneNumber).up().c("displayName").t(_this251.myContact.displayName).up().c("secret").t(_this251.mediaPillarCallContext.rainbowPhoneNumber).up();_this251.xmppService.sendIQ(xmppIq).then((function(data){resolve()})).catch((function(error){_this251.IsMediaPillarUserSelected()&&_this251.$log.warn("[WebrtcGatewayService] dummyRegisterMediaPillarCall -- register failure -- "+error.message),reject(error)}))}))}},{key:"getMediaPillarData",value:function(){var _this252=this;return this.telephonyService.isSipWise()?this.$q((function(resolve,reject){var reqUrl=_this252.telephonyService.telephonyServiceSipWise.getPortalURLSipWise()+"devices";_this252.$log.info("[WebrtcGatewayService] getMediaPillarData sipwise device GET "+reqUrl),_this252.$http({method:"GET",url:reqUrl,headers:_this252.authService.getRequestHeader()}).then((function(response){var that=_this252;_this252.$log.log("[WebrtcGatewayService] getMediaPillarData sipwise success/ status : "+response.statusText);var respData=response.data,jid="";respData?(respData.forEach((function(device){"webrtc"===device.type&&(that.mediaPillarCallContext.rainbowPhoneNumber=device.deviceId,that.mediaPillarCallContext.remoteExtension=device.deviceId,(jid=device.jid_wrg)&&-1===jid.indexOf("/")&&(jid+="/mediapillar"))})),""!==jid?resolve(jid):(that.$log.error("[WebrtcGatewayService] getMediaPillarData sipwise success -- missing jid_wrg"),reject(new Error("[WebrtcGatewayService] getMediaPillarData sipwise -- missing jid_wrg in response")))):(that.$log.error("[WebrtcGatewayService] getMediaPillarData sipwise success -- missing data"),reject(new Error("[WebrtcGatewayService] getMediaPillarData sipwise -- missing data in response")))})).catch((function(errorResponse){var error=_this252.errorHelperService.handleError(errorResponse);_this252.$log.info("[WebrtcGatewayService] getMediaPillarData sipwise error -- "+error.message),reject(error)}))})):this.$q((function(resolve,reject){_this252.$http({method:"GET",url:_this252.portalURL+"/data",headers:_this252.authService.getRequestHeader()}).then((function(response){if(_this252.$log.log("[WebrtcGatewayService] getMediaPillarData success"),response.data&&response.data.data){var prefix=response.data.data.prefix,rainbowPhoneNumber=response.data.data.rainbowPhoneNumber;prefix&&rainbowPhoneNumber&&(_this252.mediaPillarCallContext.rainbowPhoneNumber=rainbowPhoneNumber,_this252.mediaPillarCallContext.remoteExtension=prefix+rainbowPhoneNumber);var jid=response.data.data.jid_im;jid&&-1===jid.indexOf("/")&&(jid+="/mediapillar"),resolve(jid)}else _this252.$log.error("[WebrtcGatewayService] getMediaPillarData success -- missing data"),reject(new Error("[WebrtcGatewayService] getMediaPillarData -- missing data in response"))})).catch((function(errorResponse){var error=_this252.errorHelperService.handleError(errorResponse);_this252.$log.info("[WebrtcGatewayService] getMediaPillarData error -- "+error.message),reject(error)}))}))}},{key:"mediaPillarKeepAlivePolling",value:function(cmd,timer){var _this253=this;if(this.started)switch(cmd){case"START":this.mediaPillarCallContext&&this.mediaPillarCallContext.keepAlive_TO&&(this.$interval.cancel(this.mediaPillarCallContext.keepAlive_TO),this.mediaPillarCallContext.keepAlive_TO=null),this.mediaPillarCallContext.keepAlive_TO=this.$interval((function(){_this253.mediaPillarKeepAlive()}),timer,1);break;case"STOP":this.mediaPillarCallContext&&this.mediaPillarCallContext.keepAlive_TO&&this.$interval.cancel(this.mediaPillarCallContext.keepAlive_TO),this.mediaPillarCallContext.keepAlive_TO=null;break;default:this.$log.error("[WebrtcGatewayService] mediaPillarKeepAlivePolling cmd error : "+cmd)}}},{key:"mediaPillarUserSelectAndPolling",value:function(selected){this.started&&(this.$log.log("[WebrtcGatewayService] mediaPillarUserSelectAndPolling : "+selected),selected?(this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.mediaPillarKeepAlive()):this.mediaPillarAlive&&this.mediaPillarKeepAlivePolling("STOP",0))}},{key:"mediaPillarKeepAlive",value:function(){var _this254=this;if(this.$log.info("[WebrtcGatewayService] mediaPillarKeepAlive"),this.mediaPillarKeepAliveSuspend)this.$log.info("[WebrtcGatewayService] KeepAlive suspended");else{var newSampleMediaPillarState=!1;this.dummyRegisterMediaPillarCall().then((function(){newSampleMediaPillarState=!0,_this254.$log.info("[WebrtcGatewayService] mediaPillarKeepAlive webrtcgateway is UP")})).catch((function(error){newSampleMediaPillarState=!1,_this254.$log.info("[WebrtcGatewayService] mediaPillarKeepAlive webrtcgateway is DOWN")})).finally((function(){_this254.mediaPillarAlive!==newSampleMediaPillarState&&(_this254.mediaPillarAlive=newSampleMediaPillarState,_this254.$rootScope.$broadcast("ON_WEBRTCGATEWAY_STATE_CHG",_this254.mediaPillarAlive),_this254.$log.info("[WebrtcGatewayService] mediaPillarKeepAlive ON_WEBRTCGATEWAY_STATE_CHG")),_this254.mediaPillarAlive?_this254.TO_PILLAR_POLLING<9e5?_this254.TO_PILLAR_POLLING+=1800:_this254.TO_PILLAR_POLLING=9e5:(_this254.TO_PILLAR_POLLING=3e5,_this254.mediaPillarKeepAlivePolling("START",_this254.TO_PILLAR_POLLING)),_this254.IsMediaPillarUserSelected()&&_this254.mediaPillarAlive&&_this254.mediaPillarKeepAlivePolling("START",_this254.TO_PILLAR_POLLING)}))}}},{key:"forceMPpooling",value:function(){this.started&&(this.$log.log("[WebrtcGatewayService] forceMPpooling "),this.TO_PILLAR_POLLING=3e5,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.$rootScope.$broadcast("ON_WEBRTCGATEWAY_STATE_CHG",this.mediaPillarAlive))}},{key:"getMyMediaPillarJid",value:function(){return this.$log.info("[WebrtcGatewayService] getMyMediaPillarJid : "+this.mediaPillarCallContext.mediaPillarJid),this.mediaPillarCallContext.mediaPillarJid}},{key:"getMyMediaPillarRemoteExtension",value:function(){return this.telephonyService.isSipWise()?this.telephonyService.telephonyServiceSipWise.getDevicesIdFromListSipWiseWithType("webrtc")||"":this.mediaPillarCallContext.remoteExtension}},{key:"shouldUseMediaPillar",value:function(){return this.isMediaPillarAvailable()&&this.IsMediaPillarUserSelected(),void 0!==config.devMediaPillarEnabled&&config.devMediaPillarEnabled,!1}},{key:"isMediaPillarConfigured",value:function(){return this.mediaPillarConfigured&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_WEBRTC_PSTN_CALLING)}},{key:"isMediaPillarAvailable",value:function(){var available=this.isMediaPillarConfigured();return available&&this.mediaPillarAlive}},{key:"IsMediaPillarUserSelected",value:function(){var selected;if(this.telephonyService.isSipWise()){var current=this.telephonyService.telephonyServiceSipWise.getCurrentFromDevicesListSipWise();selected=current&&"webrtc"===current.type}else selected=!this.telephonyService.nomadicObject.makeCallInitiatorIsMain&&this.telephonyService.getNomadicDestination()===this.getMyMediaPillarRemoteExtension();return selected}},{key:"isMediaPillarJid",value:function(fromJid){return!!fromJid&&0===fromJid.search("mp_")}},{key:"isMediaPillarCallCase",value:function(){return this.isMediaPillarAvailable()&&this.IsMediaPillarUserSelected()}},{key:"isMediaPillarCallSituation",value:function(){var call=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,MP_situation=this.isMediaPillarCallCase();if(call)if(call.type===call_model_1.Call.Type.WEBRTC)MP_situation=MP_situation&&this.isMediaPillarJid(call.fullJid);else if(this.telephonyService.getCalls().length<=1&&this.mediaPillarCallContext.telephonyCallRefs.length<=1)switch(call.status){case call_model_1.Call.Status.RINGING_INCOMMING:case call_model_1.Call.Status.RINGING_OUTGOING:case call_model_1.Call.Status.QUEUED_INCOMMING:case call_model_1.Call.Status.DIALING:case call_model_1.Call.Status.RELEASING:break;default:MP_situation=!!call.mediaPillarCall&&MP_situation&&this.isInTelCallRefs(call)}else switch(call.status){case call_model_1.Call.Status.RINGING_INCOMMING:case call_model_1.Call.Status.RINGING_OUTGOING:case call_model_1.Call.Status.QUEUED_INCOMMING:case call_model_1.Call.Status.DIALING:case call_model_1.Call.Status.RELEASING:break;default:MP_situation=!!call.mediaPillarCall&&(MP_situation=MP_situation&&call.mediaPillarCall.telephonyCallRefs.length>=1)&&this.isInTelCallRefs(call)}return MP_situation}},{key:"mediaPillaryseTheCall",value:function(telephonyCall,webrtcCall){if(this.mediaPillarCallContext.callState!==MPCallState.Free){if(telephonyCall&&this.mediaPillarCallContext.updateContactFlag)return this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall | only Update"),telephonyCall.setMediaPillarCall(this.getMediaPillarCallContext()),"Update";if(telephonyCall&&this.mediaPillarCallContext.callState===MPCallState.TelCallReleasing&&telephonyCall.status===call_model_1.Call.Status.RINGING_INCOMMING)return this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall |  transfer managed as Update"),telephonyCall.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=MPCallState.CallOffer,"Update";if(webrtcCall&&this.mediaPillarCallContext.callState!==MPCallState.WaitWebrtc)return this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall | only Ignore"),"Ignore"}var status="";if(!telephonyCall&&!webrtcCall)return"NoCallRef";if(telephonyCall&&webrtcCall)return"toManyCallRef";if(telephonyCall){switch(this.mediaPillarCallContext.callState){case MPCallState.Free:this.mediaPillarCallContext.callState=MPCallState.WaitWebrtc,status="Ok";break;case MPCallState.WaitTelephony:this.mediaPillarCallContext.callState=MPCallState.CallOffer,status="Ok";break;case MPCallState.WaitWebrtc:this.mediaPillarCallContext.telephonyCallRefs.length>1?(this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall but 2nd incomming in WaitWebrtc| only Ignore"),telephonyCall.setMediaPillarCall(this.getMediaPillarCallContext()),status="Ignore"):this.telephonyService.isSipWise()?this.$log.info("[WebrtcGatewayService] multiple mediaPillaryseTheCall but sipwise case | only Ignore"):(this.mediaPillarCallContext.callState=MPCallState.AnomalyCCS,status="Ano_inTel_contextCallState_"+this.mediaPillarCallContext.callState,this.$log.info("[WebrtcGatewayService] mediaPillaryseTheCall again in WaitWebrtc"));break;default:this.mediaPillarCallContext.callState=MPCallState.AnomalyCCS,status="Ano_inTel_contextCallState_"+this.mediaPillarCallContext.callState}"Ok"===status&&(this.putAsMasterTelCallRefs(telephonyCall),telephonyCall.setMediaPillarCall(this.getMediaPillarCallContext()))}else if(webrtcCall){switch(this.mediaPillarCallContext.webrtcCallRef=webrtcCall,this.mediaPillarCallContext.callState){case MPCallState.Free:this.mediaPillarCallContext.callState=MPCallState.WaitTelephony,status="Ok";break;case MPCallState.WaitWebrtc:this.mediaPillarCallContext.callState=MPCallState.CallOffer,status="Ok";break;default:this.mediaPillarCallContext.callState=MPCallState.AnomalyCCS,status="Ano_inWrtc_contextCallState_"+this.mediaPillarCallContext.callState}"Ok"===status&&webrtcCall.setMediaPillarCall(this.getMediaPillarCallContext())}return status}},{key:"getMediaPillarCallContext",value:function(){return this.mediaPillarCallContext}},{key:"isMediaPillarOutgoingCall",value:function(){var compatibleCallState;switch(this.mediaPillarCallContext.callState){case MPCallState.WaitWebrtc:case MPCallState.WaitTelephony:case MPCallState.CallOffer:case MPCallState.CallOnGoing:case MPCallState.CallActive:case MPCallState.CallActiveNoWebMedia:case MPCallState.TelCallReleasing:case MPCallState.WebCallReleasing:compatibleCallState=!0;break;default:compatibleCallState=!1}return compatibleCallState&&this.mediaPillarCallContext.isOutgoingCall3PCC}},{key:"isMediaPillarReleasableCall",value:function(){var compatibleCallState;switch(this.mediaPillarCallContext.callState){case MPCallState.AnomalyCCS:case MPCallState.Unknow:compatibleCallState=!1;break;default:compatibleCallState=!0}return compatibleCallState}},{key:"MediaPillarReleaseWebrtcCall",value:function(){this.mediaPillarCallContext.webrtcCallRef&&(this.mediaPillarCallContext.webrtcCallRef.mediaPillarCall=null,this.videoService.releaseCall(this.mediaPillarCallContext.webrtcCallRef))}},{key:"timeOutCallActiveNoWebMedia",value:function(){this.$log.info("[WebrtcGatewayService] timeOutCallActiveNoWebMedia"),this.mediaPillarCallContext.callState===MPCallState.CallActiveNoWebMedia&&(this.MediaPillarCallTerminator(),this.mediaPillarKeepAlive(),this.$log.info("[WebrtcGatewayService] timeOutCallActiveNoWebMedia noWebMedia then release calls if existing & force keepalive"))}},{key:"MediaPillarCallTerminator",value:function(){var _this255=this;0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs.forEach((function(callRef){null!==callRef&&callRef.type.value===call_model_1.Call.Type.PHONE.value&&(callRef.mediaPillarCall=null,_this255.telephonyService.releaseCall(callRef),_this255.$log.info("[WebrtcGatewayService] MediaPillarCallTerminator | release call"+callRef))})),this.MediaPillarReleaseWebrtcCall(),this.releaseMediaPillarCallContext(),this.resetEvtAutomaton(),this.TO_PILLAR_POLLING+=3e5,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.$log.warn("[WebrtcGatewayService] MediaPillarCallTerminator | Full cleaning")}},{key:"createMediaPillarContact",value:function(jid){this.$log.info("[webrtcGatewayService] createMediaPillarContact -- "+jid);var contact=this.contactService.createBasicContact(jid);return contact.displayName="mediaPillar",contact.avatar=new Image,contact.avatar.src="/resources/skins/rainbow/images/conversations/unknownUser.jpeg",this.xmppService.getResourceFromJid(jid)&&this.contactService.createBasicContact(this.xmppService.getBareJidFromJid(jid)),contact}},{key:"muteAudio",value:function(pbxCall,muted,conversation){if(pbxCall){if(this.isMediaPillarCallCase()){var webrtcCall=this.mediaPillarCallContext.webrtcCallRef;if(webrtcCall){var session=this.xmppService.connection.jingle.sessions[webrtcCall.id];if(session){session.muteAudio(muted),webrtcCall.isMuted=muted,conversation&&(conversation.isMutedAudio=muted,conversation.rxSubject.next({name:"callUpdate",value:pbxCall})),pbxCall.isMuted=muted,this.$log.info("[webrtcGatewayService] muteAudio conversation: "+(conversation?conversation.id:"undefined")+" / pbxcall: "+pbxCall.id+"-- "+(muted?"mute":"unumute"));var eventData={call:pbxCall};conversation&&(eventData.conversation=conversation),this.$rootScope.$broadcast("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",eventData),this.$rootScope.$broadcast("ON_MPMEDIA_CONVERSATION_CALL_UPDATED_EVENT",{call:webrtcCall})}else this.$log.error("[webrtcGatewayService] muteAudio "+pbxCall.id+" -- failure: no session")}}}else this.$log.error("[webrtcGatewayService] muteAudio - trying to mute a non existing call !")}},{key:"getActivePbxCall",value:function(){return this.isMediaPillarCallCase()&&this.mediaPillarCallContext?this.mediaPillarCallContext.telephonyCallRefs.find((function(pxbCall){return pxbCall.status===call_model_1.Call.Status.ACTIVE})):null}},{key:"answerCall",value:function(call){var mediaPillarCall=call.getMediaPillarCall();if(mediaPillarCall&&mediaPillarCall.webrtcCallRef)this.videoService.answerCall(mediaPillarCall.webrtcCallRef,"audio"),this.$log.info("[WebrtcGatewayService] -- answerCall -- send webrtc proceed for call : "+call.id);else if(call.status===call_model_1.Call.Status.QUEUED_INCOMMING){var that=this;this.telephonyService.answerCall(call).catch((function(){that.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)})),this.$log.info("[WebrtcGatewayService] -- answerCall -- "+call.id)}else this.$log.info("[WebrtcGatewayService] -- answerCall -- Anomaly media Pillar : answerAudioAction but no webrtcCallref & no 2nd call")}},{key:"releaseCall",value:function(call){var mediaPillarCall=call.getMediaPillarCall();if(mediaPillarCall&&mediaPillarCall.webrtcCallRef)if(call.type===call_model_1.Call.Type.PHONE){this.$log.info("[WebrtcGatewayService] -- releaseCall MP PHONE -- "+call.id),this.isMasterTelCallRefs(call)&&(this.$log.info("[WebrtcGatewayService] -- rejectCall MP webrtc call -- "+mediaPillarCall.webrtcCallRef),this.videoService.rejectCall(mediaPillarCall.webrtcCallRef));var that=this;this.telephonyService.releaseCall(call).catch((function(){call.setStatus(call_model_1.Call.Status.UNKNOWN),that.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)}))}else this.$log.info("[WebrtcGatewayService] -- releaseCall MP WEBRTC -- "+call.id),this.videoService.rejectCall(mediaPillarCall.webrtcCallRef);else{this.$log.info("[WebrtcGatewayService] releaseCall | Anomaly media Pillar : declineAction but no webrtcCallref for call = "+call.id);var _that=this;this.telephonyService.releaseCall(call).catch((function(){call.setStatus(call_model_1.Call.Status.UNKNOWN),_that.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)}))}}},{key:"deflectCallToVm",value:function(call){var that=this;this.telephonyService.deflectCallToVM(call).finally((function(){if(call.type===call_model_1.Call.Type.PHONE){var mediaPillarCall=call.getMediaPillarCall();mediaPillarCall&&mediaPillarCall.webrtcCallRef&&that.videoService.rejectCall(mediaPillarCall.webrtcCallRef),call.setStatus(call_model_1.Call.Status.UNKNOWN),that.$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)}}))}}]),WebrtcGatewayService}();WebrtcGatewayService.$inject=["$q","$rootScope","$log","$http","$interval","videoService","errorHelperService","telephonyService"],exports.WebrtcGatewayService=WebrtcGatewayService,angular.module("rainbow").service("webrtcGatewayService",WebrtcGatewayService)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_src_models_event_model__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24),_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(0),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3__),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_4__),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5__),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(6),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_6__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7__);angular.module("rainbow").service("videoService",["$q","$rootScope","$window","$log","$http","$interval","browserService","gRTCStatsService","fRTCStatsService","platformService","gaService","VideoServiceEventHandler","extensionSharingService",function($q,$rootScope,$window,$log,$http,$interval,browserService,gRTCStatsService,fRTCStatsService,platformService,gaService,VideoServiceEventHandler,extensionSharingService){var that=this;this.started=!1,this.connected=!1,this.RTC=null,this.videoEventHandler=null,this.config=null,this.companyConfig=null,this.calls={},this.localStream=null,this.autoreleaseTimeout=null,this.callsStats={},this.localStreams=[],this.makingCall=!1,this.reconnectCall=!1,this.statsInterval=null,this.audioProfileChanging=!1,this.reverseAudioCallInitiated=!1,this.alreadyAttaching=!1,this.ttl=0,this.ttlTimeout=null,this.xmppConnectionSubscription=null;var listeners=[];this.rxSubject=new rxjs__WEBPACK_IMPORTED_MODULE_0__.a,this.callsStatsSimplified={},this.allowDesktopSharing=function(){return!1},this.allowAdvancedDesktopSharing=function(){return!1},this.getDesktopSharingSource=function(){return null},this.askToAddSharing=function(__conversation_id){return!1},this.askToStartSharing=function(__contact_id,__media){return!1},this.isNativeApplication=function(){return!1},this.subscribe=function(handler){return this.rxSubject.subscribe(handler)},this.sendEvent=function(name){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next(_src_models_event_model__WEBPACK_IMPORTED_MODULE_1__.RBEvent.create(name,data))},this.start=function(stats){$log.webrtc("[videoService] SERVICE | === STARTING ===");var startDate=performance.now();if(this.RTC=that.getBrowserMethodHandler(),this.RTC){that.started=!0,that.connected=!0,that.setWebrtcConfiguration();var startDuration=Math.round(performance.now()-startDate);stats.push({service:"videoService",startDuration:startDuration}),$log.info("[videoService] SERVICE | === STARTED ("+startDuration+" ms) ===")}else $log.error("[videoService] SERVICE | === STARTING FAILURE ===  webRTC capable browser is really required !");return this.xmppConnectionSubscription=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.subscribeToConnectionEvents((function(event){that.onConnectionStateChangeEvent(event)})),listeners.push($rootScope.$on("ON_INPUT_DEVICE_CHANGED_EVENT",that.onAudioProfileChangeEvent)),listeners.push($rootScope.$on("ON_VIDEO_INPUT_DEVICE_CHANGED_EVENT",that.onVideoInputChangeEvent)),this.attachHandlers(),$q.when()},this.stop=function(){try{if(this.started){var listener;for($log.webrtc("[videoService] SERVICE | === STOPPING ==="),this.started=!1,this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe();listener=listeners.pop();)listener();for(var key in that.removeHandlers(),that.config=null,that.calls)if(that.calls.hasOwnProperty(key)){var _call7=that.calls[key];that.removeCallObject(_call7)}_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.terminate(),that.connected=!1,that.reconnectCall=!1,that.makingCall=!1,that.statsInterval&&window.clearInterval(that.statsInterval),that.ttlTimeout&&$interval.cancel(that.ttlTimeout),$log.webrtc("SERVICE | === STOPPED ===")}return $q.when()}catch(error){return $log.webrtc("[videoService] SERVICE | === STOPPING ERROR : "+error),$q.when()}},this.attachHandlers=function(){this.removeHandlers(),$log.info("[videoService] attachHandlers"),this.videoEventHandler=VideoServiceEventHandler.create(this)},this.removeHandlers=function(){$log.info("[videoService] removeHandlers"),this.videoEventHandler&&(this.videoEventHandler=null)},this.setIceConfig=function(){return $log.webrtc("[videoService] setIceConfig"),$q((function(resolve,reject){if(that.config&&0!==that.ttl)return $log.webrtc("[videoService] setIceConfig from stored variable"),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.ice_config=that.config,resolve();that.getIceConfig().then((function(config){that.config=config,"true"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3___default.a.getSetting("enableDSCP")&&($log.webrtc("[videoService] setWebrtcConfiguration - DSCP is enabled"),that.config.enableDSCP=!0),"true"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3___default.a.getSetting("dtx")&&($log.webrtc("[videoService] setWebrtcConfiguration - DTX is enabled"),that.config.dtx=!0);var simulcast="true"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3___default.a.getSetting("simulcast");(simulcast=simulcast||_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_6___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_6___default.a.FeaturesEnum.WEBRTC_CONFERENCE_SIMULCAST))&&($log.webrtc("[videoService] setWebrtcConfiguration - Simulcasting is enabled"),that.config.simulcast=!0),"true"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3___default.a.getSetting("unifiedPlan")&&($log.webrtc("[videoService] setWebrtcConfiguration - unifiedPlan is enabled"),that.config.unifiedPlan=!0),"true"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3___default.a.getSetting("debugWebRTC")&&($log.webrtc("[videoService] setWebrtcConfiguration - unifiedPlan is enabled"),that.config.debugWeRTC=!0),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.ice_config=that.config,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3___default.a.setIceConfig(that.config),$log.webrtc("[videoService] setIceConfig from server success !"),resolve()})).catch((function(error){$log.error("[videoService] setIceConfig from server ERROR : "+error),-1!==error.status&&that.openErrorPopup("IceConfigurationFailed"),reject()}))}))},this.setCompanyWebrtcConfig=function(){return $log.webrtc("[videoService] setCompanyWebrtcConfig"),$q((function(resolve,reject){if(that.companyConfig)return $log.webrtc("[videoService] setCompanyWebrtcConfig from stored variable"),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.company_config=that.companyConfig,that.setVideoQualityConfigurationForCompany(),resolve();that.getCompanyWebrtcConfig().then((function(config){that.companyConfig=config,_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.company_config=that.companyConfig,that.setVideoQualityConfigurationForCompany(),$log.webrtc("[videoService] setCompanyWebrtcConfig from server success !"),resolve()})).catch((function(error){$log.error("[videoService] setCompanyWebrtcConfig from server ERROR : "+error),reject()}))}))},this.setWebrtcConfiguration=function(){return $q((function(resolve){var promises=[];promises.push(that.setIceConfig()),promises.push(that.setCompanyWebrtcConfig()),$q.all(promises).then((function(){$log.webrtc("[videoService] setWebrtcConfiguration -- done"),resolve()}))}))},this.onConnectionStateChangeEvent=function(event){try{if("ON_XMPP_DISCONNECTED"===event.name){for(var key in $log.info("MEDIA   | onConnectionStateChangeEvent : disconnected"),that.connected=!1,that.config=null,that.ttlTimeout&&$interval.cancel(that.ttlTimeout),that.calls)if(that.calls.hasOwnProperty(key)){var call=that.calls[key];that.reconnectCall=!0,call&&call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN&&($log.webrtc("INFO    | onConnectionStateChangeEvent : disconnected -> call goes to connecting state"),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.CONNECTING),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)),that.statsInterval&&window.clearInterval(that.statsInterval)}}else if("ON_XMPP_CONNECTED"===event.name){for(var key in $log.info("MEDIA   | onConnectionStateChangeEvent : connected"),that.attachHandlers(),that.setWebrtcConfiguration(),that.connected=!0,that.statsInterval&&(window.clearInterval(that.statsInterval),that.statsinterval=null),that.calls)if(that.calls.hasOwnProperty(key)){call=that.calls[key];var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];that.reconnectCall&&session&&session.peerconnection&&($log.info("MEDIA   | onConnectionStateChangeEvent : connected - start reconnection on session "+call.id),session.me=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.userContact.fullJid,session.isInitiator&&(session.initiator=session.me),session.connection=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.setBusyState("dnd",that.calculatePresenceMessage(call)),session.reconnectSession())}that.reconnectCall=!1}}catch(error){$log.info("MEDIA   | onConnectionStateChangeEvent : disconnected error : "+error)}},that.isUserContactInCall=function(){for(var key in that.calls)if(that.calls.hasOwnProperty(key)&&that.calls[key].status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN)return!0;return!1},this.getCurrentActiveCall=function(){for(var key in that.calls)if(that.calls.hasOwnProperty(key)){var _call8=that.calls[key];if(_call8.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN)return _call8}return null},this.getCurrentActiveSession=function(){for(var key in that.calls)if(that.calls.hasOwnProperty(key)){var _call9=that.calls[key];if(_call9.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN)return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[_call9.id]}return null},that.getMediaPillarAudioCall=function(){for(var key in that.calls)if(that.calls.hasOwnProperty(key)){var _call10=that.calls[key];if(_call10.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN&&_call10.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO&&_call10.isMediaPillarCall())return _call10}return null},that.getWebrtcAudioCall=function(){for(var key in that.calls)if(that.calls.hasOwnProperty(key)){var _call11=that.calls[key];if(_call11.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN&&_call11.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO&&!_call11.isMediaPillarCall())return _call11}return null},that.getMediaPillarSession=function(){var mediaPillarAudioCall=that.getMediaPillarAudioCall();return mediaPillarAudioCall?_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[mediaPillarAudioCall.id]:null},that.getCurrentSharingCall=function(){for(var key in that.calls)if(that.calls.hasOwnProperty(key)){var _call12=that.calls[key];if(_call12.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN&&(_call12.localMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING||_call12.remoteMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING))return _call12}return null},that.endAllCallsForContact=function(contact){if(contact)for(var key in $log.webrtc("[videoService] endAllCallsForContact "+contact.jid),that.calls)if(that.calls.hasOwnProperty(key)){var _call13=that.calls[key];_call13.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN&&_call13.contact&&_call13.contact.jid===contact.jid&&!_call13.isMediaPillarCall()&&that.releaseCall(_call13)}},that.onVideoInputChangeEvent=function(){for(var key in $log.webrtc("MEDIA   | onVideoInputChangeEvent"),that.calls)if(that.calls.hasOwnProperty(key)){var _call14=that.calls[key];_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[_call14.id]&&_call14.localMedia&&_call14.localMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO+_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO&&($log.webrtc("MEDIA   | audio + video call, renegotiate the profile"),that.escalateToVideoCall(_call14,!0))}},that.onAudioProfileChangeEvent=function(){if($log.webrtc("MEDIA   | onAudioProfileChangeEvent"),that.audioProfileChanging)$log.webrtc("MEDIA   | onAudioProfileChangeEvent -- already changing");else for(var key in that.calls)if(that.calls.hasOwnProperty(key)){var _call15=that.calls[key];_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[_call15.id]&&_call15.localMedia&&(that.audioProfileChanging=!0,$interval((function(currentCall){that.audioProfileChanging=!1,that.renegotiateCurrentCall(currentCall)}),500,1,!0,_call15))}},this.renegotiateCurrentCall=function(call){call.localMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO||call.localMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO+_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING?($log.webrtc("MEDIA   | renegotiate the audio profile"),that.addAudioToCall(call,!0)):call.localMedia!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO+_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO&&call.localMedia!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO+_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING+_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO||($log.webrtc("MEDIA   | audio + video call, renegotiate the profile"),that.addVideoToCall(call,!0))},this.getCallByJid=function(contactJid,fullJid){var result=null;if(!contactJid&&!fullJid)return result;for(var key in $log.webrtc("[videoService] getCallByJid "+contactJid),that.calls)if(that.calls.hasOwnProperty(key)&&(call=that.calls[key]).contact&&call.contact.jid===contactJid){result=call;break}if(!result)for(var key in $log.webrtc("[videoService] getCallByJid fallback "+fullJid),that.calls){var call;if(that.calls.hasOwnProperty(key)&&(call=that.calls[key])&&call.fullJid===fullJid){result=call;break}}return result},this.resetAudioOutputElement=function(){platformService.allowDevicesManagement()&&!this.audioProfileChanging&&($("#globalAudioTag").length?($log.webrtc("[videoService] resetAudioOutputElement"),this.audioProfileChanging=!0,platformService.getCurrentSpeaker().then((function(device){var sinkId="default";device&&device.id&&(sinkId=device.id);var anotherSink="default";"default"!==sinkId&&DetectRTC.audioOutputDevices.forEach((function(output){"default"!==output.deviceId&&"communications"!==output.deviceId&&output.deviceId!==sinkId&&(anotherSink=output.deviceId)})),$("#globalAudioTag")[0].setSinkId(anotherSink).then((function(){$log.webrtc("[videoService] resetAudioOutputElement sinkId is "+$("#globalAudioTag")[0].sinkId),"default"!==sinkId?$("#globalAudioTag")[0].setSinkId(sinkId).then((function(){$log.webrtc("[videoService] resetAudioOutputElement sinkId is "+$("#globalAudioTag")[0].sinkId),that.audioProfileChanging=!1,$("#globalAudioTag")[0].load&&$("#globalAudioTag")[0].load()})).catch((function(){that.audioProfileChanging=!1})):that.audioProfileChanging=!1})).catch((function(error){$log.warn("[videoService] resetAudioOutputElement globalAudioTag error "+error),that.audioProfileChanging=!1})),$interval((function(){$("#largevideo")[0]&&$("#largevideo")[0].setSinkId(anotherSink).then((function(){$log.webrtc("[videoService] resetAudioOutputElement largevideo "+$("#largevideo")[0].sinkId),"default"!==sinkId&&$("#largevideo")[0].setSinkId(sinkId).then((function(){$log.webrtc("[videoService] resetAudioOutputElement largevideo "+$("#largevideo")[0].sinkId)})).catch((function(error){$log.warn("[videoService] resetAudioOutputElement largevideo error "+error)}))})).catch((function(error){$log.warn("[videoService] resetAudioOutputElement largevideo error "+error)})),$("#p2pSecondVideo")[0]&&$("#p2pSecondVideo")[0].setSinkId(anotherSink).then((function(){"default"!==sinkId&&$("#p2pSecondVideo")[0].setSinkId(sinkId).then((function(){$log.webrtc("[videoService] resetAudioOutputElement p2pSecondVideo "+$("#p2pSecondVideo")[0].sinkId)})).catch((function(error){$log.warn("[videoService] resetAudioOutputElement p2pSecondVideo error "+error)}))})).catch((function(error){$log.warn("[videoService] resetAudioOutputElement p2pSecondVideo error "+error)}))}),3e3,1)})).catch((function(){$log.webrtc("[videoService] resetAudioOutputElement getCurrentSpeaker error"),that.audioProfileChanging=!1}))):$log.warn("[videoService] resetAudioOutputElement -- missing global audio tag !"))},this.disableStreams=function(streams){if(streams&&streams.length)for(streams.forEach((function(stream){stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),stream=null}));streams.length>0;){streams.pop();null}},this.disableAudioVideoMedia=function(session,sessionId){if(session?$log.webrtc("MEDIA   | disableAudioVideoMedia for session "+JSON.stringify({sid:session.sid})):sessionId?$log.webrtc("MEDIA   | disableAudioVideoMedia no session, sessionId: "+sessionId):$log.webrtc("MEDIA   | disableAudioVideoMedia no session, no session Id"),!session&&!sessionId){var localStreamsLength=that.localStreams.length;if(that.localStreams.length>0)for(that.localStreams.forEach((function(stream){stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),stream=null}));that.localStreams.length>0;)that.localStreams.pop();$log.webrtc("MEDIA   | disableAudioVideoMedia : All local streams stopped and removed: "+localStreamsLength)}if(session){if(session.localStreams.length>0){var sessionStreamsLength=session.localStreams.length;for(session.localStreams.forEach((function(stream){stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),stream=null})),that.localStreams=that.localStreams.filter((function(localStream){return!session.localStreams.includes(localStream)}));session.localStreams.length>0;)session.localStreams.pop();$log.webrtc("MEDIA   | disableAudioVideoMedia : Session streams stopped and removed: "+sessionStreamsLength+". Remaining local streams: "+that.localStreams.length)}}else if(sessionId){var streams=that.localStreams.filter((function(localStream){return localStream.callId===sessionId}));streams&&(sessionStreamsLength=streams.length,streams.forEach((function(stream){stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),that.localStreams.splice(that.localStreams.indexOf(stream),1),stream=null})),$log.webrtc("MEDIA   | disableAudioVideoMedia : Locals streams for sessionId "+sessionId+" stopped and removed: "+sessionStreamsLength+". Remaining local streams: "+that.localStreams.length))}that.statsInterval&&(window.clearInterval(that.statsInterval),that.statsinterval=null)},this.clearSrcObjectsFromElements=function(){this.RTC.clearMediaStream(angular.element("#largevideo"),null),this.RTC.clearMediaStream(angular.element("#globalVideoTag"),null),this.RTC.clearMediaStream(angular.element("#globalAudioTag"),null)},this.attachDistantMediaStreamsUnifiedPlan=function(call){var sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];sess?(sess.remoteStreamsObject[0]&&($log.webrtc("attachDistantMediaStreamsUnifiedPlan audio track for element globalAudioTag "+sess.remoteStreamsObject[0].id),this.RTC.attachMediaStream(angular.element("#globalAudioTag"),sess.remoteStreamsObject[0])),sess.remoteStreamsObject[1]&&sess.remoteStreamsObject[2]?(this.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),sess.remoteStreamsObject[2],sess.remoteStreamsObject[2].id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0),this.RTC.attachMediaStreamIfNeeded(angular.element("#p2pSecondVideo"),sess.remoteStreamsObject[1],sess.remoteStreamsObject[1].id),angular.element("#p2pSecondVideo")[0]&&(angular.element("#p2pSecondVideo")[0].muted=!0,angular.element("#p2pSecondVideo")[0].volume=0)):sess.remoteStreamsObject[1]?(this.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),sess.remoteStreamsObject[1],sess.remoteStreamsObject[1].id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0)):sess.remoteStreamsObject[2]&&(this.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),sess.remoteStreamsObject[2],sess.remoteStreamsObject[2].id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0))):$log.warn("[videoService] attachDistantMediaStreamsUnifiedPlan -- missing session "+call.id)},this.attachDistantMediaStreams=function(attach,call){if(attach){if(that.alreadyAttaching)return;if(that.alreadyAttaching=!0,call.unifiedPlanActivated)return that.attachDistantMediaStreamsUnifiedPlan(call),void(that.alreadyAttaching=!1);var sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];if(null==sess)return void(that.alreadyAttaching=!1);if(sess.remoteStreams){var mainRemoteTrack,secondRemoteTrack;if(sess.remoteStreams.length>1)sess.remoteStreams[0].getAudioTracks().length?(secondRemoteTrack=sess.remoteStreams[0],mainRemoteTrack=sess.remoteStreams[1]):(mainRemoteTrack=sess.remoteStreams[0],secondRemoteTrack=sess.remoteStreams[1]),mainRemoteTrack.getVideoTracks().length>0&&($log.webrtc("attachDistantMediaStreams video track for element largevideo "+mainRemoteTrack.id),that.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),mainRemoteTrack,mainRemoteTrack.id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0)),mainRemoteTrack.getAudioTracks().length>0&&($log.webrtc("attachDistantMediaStreams audio track for element globalAudioTag "+mainRemoteTrack.id),that.RTC.attachMediaStream(angular.element("#globalAudioTag"),mainRemoteTrack)),secondRemoteTrack.getVideoTracks().length>0&&($log.webrtc("attachDistantMediaStreams video track for element p2pSecondVideo "+secondRemoteTrack.id),that.RTC.attachMediaStreamIfNeeded(angular.element("#p2pSecondVideo"),secondRemoteTrack,secondRemoteTrack.id),angular.element("#p2pSecondVideo")[0]&&(angular.element("#p2pSecondVideo")[0].muted=!0,angular.element("#p2pSecondVideo")[0].volume=0)),secondRemoteTrack.getAudioTracks().length>0&&($log.webrtc("attachDistantMediaStreams audio track for element globalAudioTag "+secondRemoteTrack.id),that.RTC.attachMediaStream(angular.element("#globalAudioTag"),secondRemoteTrack));else sess.remoteStreams.forEach((function(track){track.getVideoTracks().length>0&&($log.webrtc("attachDistantMediaStreams video track"),that.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),track,track.id),angular.element("#largevideo")[0]&&(angular.element("#largevideo")[0].muted=!0,angular.element("#largevideo")[0].volume=0),that.RTC.attachMediaStreamIfNeeded(angular.element("#p2pSecondVideo"),track,track.id),angular.element("#p2pSecondVideo")[0]&&(angular.element("#p2pSecondVideo")[0].muted=!0,angular.element("#p2pSecondVideo")[0].volume=0)),track.getAudioTracks().length>0&&($log.webrtc("attachDistantMediaStreams audio track"),that.RTC.attachMediaStream(angular.element("#globalAudioTag"),track))}));that.alreadyAttaching=!1}}else that.isUserContactInCall()||(this.RTC.clearMediaStream(angular.element("#largevideo"),null),this.RTC.clearMediaStream(angular.element("#globalVideoTag"),null),this.RTC.clearMediaStream(angular.element("#globalAudioTag"),null))},this.attachLocalVideoOnlyStreamToElement=function(attach,element){$log.webrtc("attachLocalVideoOnlyStreamToElement "+attach),attach?(this.localStreams&&this.localStreams.length&&this.localStreams.forEach((function(track){track.getVideoTracks().length&&track.getAudioTracks().length||track.getVideoTracks().length&&that.RTC.attachMediaStreamIfNeeded(element,track,track.id)})),element[0]&&(element[0].volume=0)):this.RTC.clearMediaStream(element,null)},this.attachLocalAudioVideoStreamToElement=function(attach,element){$log.webrtc("attachLocalAudioVideoStreamToElement "+attach),attach?(this.localStreams&&this.localStreams.length&&this.localStreams.forEach((function(track){track.getVideoTracks().length&&track.getAudioTracks().length&&that.RTC.attachMediaStreamIfNeeded(element,track,track.id)})),element[0]&&(element[0].volume=0)):this.RTC.clearMediaStream(element,null)},this.attachLocalMediaStreams=function(attach){if($log.webrtc("attachLocalMediaStreams "+attach),attach){if(this.localStreams&&this.localStreams.length){var firstVideoStream=!1;this.localStreams.forEach((function(track){track.getVideoTracks().length&&track.getAudioTracks().length?(firstVideoStream?that.RTC.attachMediaStreamIfNeeded($("#minivideo2"),track,track.id):(firstVideoStream=!0,that.RTC.attachMediaStreamIfNeeded($("#minivideo"),track,track.id)),that.RTC.attachMediaStreamIfNeeded($("#callVideoPip"),track,track.id)):track.getVideoTracks().length&&(firstVideoStream?that.RTC.attachMediaStreamIfNeeded($("#minivideo2"),track,track.id):(firstVideoStream=!0,that.RTC.attachMediaStreamIfNeeded($("#minivideo"),track,track.id)),that.RTC.attachMediaStreamIfNeeded($("#callSharingPip"),track,track.id))}))}$("#callVideoPip")[0]&&($("#callVideoPip")[0].volume=0),$("#minivideo")[0]&&($("#minivideo")[0].volume=0),$("#minivideo2")[0]&&($("#minivideo2")[0].volume=0),$("#callSharingPip")[0]&&($("#callSharingPip")[0].volume=0)}else this.RTC.clearMediaStream($("#minivideo"),null),this.RTC.clearMediaStream($("#minivideo2"),null),this.RTC.clearMediaStream($("#callVideoPip"),null),this.RTC.clearMediaStream($("#callSharingPip"),null)},this.removeConferencePip=function(){return this.RTC.clearMediaStream($("#conferenceSharingPip"),null),this.RTC.clearMediaStream($("#conferenceVideoPip"),null),!0},this.pushInLocalStreams=function(stream,callId){stream.callId=callId,that.localStreams.push(stream)},this.openErrorPopup=function(msg){msg||(msg="cameraNotAvailable"),$rootScope.$broadcast("ON_WEBRTC_CALL_ERROR_EVENT",msg)},this.openCalendarBusyPopup=function(id){$rootScope.$broadcast("ON_WEBRTC_CALENDAR_BUSY_EVENT",id)},this.makeVideoCall=function(contact){that.makeCall(contact,"videoOnly")},this.makeCall=function(contact,theMedia,message){$log.webrtc("MEDIA   | makeCall to "+JSON.stringify({displayName:contact.nameForLog,resources:contact.resources})),that.makingCall?$log.info("MEDIA   | makeCall already making a call !"):(that.makingCall=!0,this.videoEventHandler.sendProposition(contact,theMedia,message))},this.makeJingleCall=function(call,mediaPillarJid,phoneNumber){$log.webrtc("MEDIA   | makeJingleCall"),that.setWebrtcConfiguration().then((function(){var localType="";call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO&&(localType="audio"),call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO&&(localType=localType?"audio+video":"video"),mediaPillarJid&&""!==mediaPillarJid&&$log.webrtc("MEDIA   | makeJingleCall in mediaPillar case for number : "+phoneNumber),mediaPillarJid&&""!==mediaPillarJid&&phoneNumber&&""!==phoneNumber?(localType="sip",_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.initiate(mediaPillarJid,_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jid,localType,that.localStreams,call.id,null,phoneNumber)):_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.initiate(call.fullJid,_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jid,localType,that.localStreams,call.id,null,null,call.unifiedPlanActivated),call.status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.CONNECTING,$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)})).catch((function(error){$log.webrtc("MEDIA   | makeCall failure : "+JSON.stringify({error:error.message})),that.makingCall=!1,call&&that.removeCallObject(call),that.resetToSafeState()}))},this.makeJingleSharingCall=function(call){$log.webrtc("MEDIA   | makeJingleSharingCall - make desktop sharing call");var type="sharing";call.localMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING&&(type="sharing-only"),that.setWebrtcConfiguration().then((function(){$log.webrtc("SHARING | getUserMedia success");var mediaPillarSession=that.getMediaPillarSession(),callStreams=mediaPillarSession?that.localStreams.filter((function(localStream){return!(mediaPillarSession.localStreams&&mediaPillarSession.localStreams.includes(localStream))})):that.localStreams;_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.initiate(call.fullJid,_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jid,type,callStreams,call.id,null,null,call.unifiedPlanActivated),call.status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.CONNECTING,$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)})).catch((function(error){that.makingCall=!1,call&&that.removeCallObject(call),that.resetToSafeState(),$log.webrtc("MEDIA   | makeJingleSharingCall failure : "+JSON.stringify({error:error.message}))}))},this.startDesktopSharing=function(contact,media){that.makingCall?$log.info("MEDIA   | startDesktopSharing already making a call !"):(that.makingCall=!0,!that.askToStartSharing(contact.jid,media)&&that.makeDesktopSharingCall(contact,media))},this.startSharingCancelled=function(){that.makingCall=!1},this.makeDesktopSharingCall=function(contact,media){media||(media="sharing"),that.makingCall=!0,$log.webrtc("MEDIA   | makeDesktopSharingCall - trying to start a desktop sharing call with media "+media),this.videoEventHandler.sendProposition(contact,media),this.sendEvent("startHighlighting")},this.answerJingleCall=function(call){$log.webrtc("MEDIA   | answerJingleCall "+call.id);var mediaToGet=[],localType="audio";call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO&&mediaToGet.push("audio"),call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO&&(mediaToGet.push("video"),localType="audio+video"),call.localMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO&&(localType="video");var mediaConstraints={};call.isInConversationWithMobile()&&(mediaConstraints=that.getMobileMediaConstraints("video")),that.setWebrtcConfiguration().then((function(){that.getBrowserMedia(mediaToGet,mediaConstraints.fixedVideoWidth,mediaConstraints.fixedVideoHeight,mediaConstraints.fixedFrameRate).then((function(stream){var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];stream?(that.pushInLocalStreams(stream,call.id),session.addStream(that.localStreams[0]),session.localStreams.push(that.localStreams[0])):localType=null,session.localType=localType,session.sendAnswer(),session.accept(),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)})).catch((function(error){$log.webrtc("MEDIA   | answerJingleCall failure for : "+call+" failure : "+error.message),-1!==error.toString().indexOf("getUserMedia")&&(that.releaseCall(call),that.openErrorPopup()),that.resetToSafeState()}))}))},this.answerCall=function(call,type){this.videoEventHandler.acceptProposition(call,type)},this.rejectCall=function(call,__reason){call?(that.makingCall=!1,that.autoreleaseTimeout&&$interval.cancel(that.autoreleaseTimeout),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id]?that.releaseCall(call):call.isInitiator?this.videoEventHandler.retractProposition(call):this.videoEventHandler.rejectProposition(call,__reason)):$log.webrtc("MEDIA   | rejectCall - trying to rejectCall a non existing call !")},this.onCallTransferredToConference=function(call){var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];this.disableAudioVideoMedia(session),this.autoreleaseTimeout&&$interval.cancel(this.autoreleaseTimeout),this.createOrUpdateStatisticsForCall(call.id),this.callsStats[call.id]&&delete this.callsStats[call.id],this.callsStatsSimplified[call.id]&&delete this.callsStatsSimplified[call.id],this.removeCallObject(call),this.displayWebRTCStats(call.id)},this.releaseCall=function(call,reason,text){call?(that.makingCall=!1,this.execute("releaseCall",(function(){$log.webrtc("MEDIA   | releaseCall : "+call);try{var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];that.disableAudioVideoMedia(session),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.resetBusyState(),that.autoreleaseTimeout&&$interval.cancel(that.autoreleaseTimeout),that.createOrUpdateStatisticsForCall(call.id),that.callsStats[call.id]&&delete that.callsStats[call.id],that.callsStatsSimplified[call.id]&&delete that.callsStatsSimplified[call.id],that.removeCallObject(call,reason,text),that.displayWebRTCStats(call.id),that.isUserContactInCall()||that.clearSrcObjectsFromElements()}catch(error){$log.webrtc("MEDIA   | releaseCall ERROR"),$log.error(error),that.createOrUpdateStatisticsForCall(call.id),that.callsStats[call.id]&&delete that.callsStats[call.id],that.callsStatsSimplified[call.id]&&delete that.callsStatsSimplified[call.id],that.resetToSafeState(),that.displayWebRTCStats(call.id),that.removeCallObject(call)}}))):$log.webrtc("MEDIA   | releaseCall - trying to release a non existing call !")},this.askToAddDesktopSharing=function(conversation){$log.webrtc("MEDIA   | askToAddDesktopSharing - Desktop sharing escalation"),!that.askToAddSharing(conversation.id)&&that.addSharingToCall(conversation.videoCall)},this.addAudioToCall=function(call,mediaModify){$log.webrtc("MEDIA   | addAudioToCall");var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];session.isRenegotiating=!0,this.getBrowserMedia(["audio"]).then((function(stream){that.stopActiveAudioVideoStreams(session),that.pushInLocalStreams(stream,call.id);for(var i=0;i<that.localStreams.length;i++)session.removeStream(that.localStreams[i]);var type=mediaModify?"contentModify":"contentAdd";that.updateCurrentCall(call,session,"audio",type)})).catch((function(error){$log.webrtc("MEDIA   | addAudioToCall failure : "+error),that.releaseCall(call),that.resetToSafeState()}))},this.addSharingToCall=function(call){$log.webrtc("MEDIA   | addSharingToCall - Desktop sharing escalation");var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];session.isRenegotiating=!0;var mediaConstraints={};call.isInConversationWithMobile()&&(mediaConstraints=that.getMobileMediaConstraints("sharing")),this.getBrowserMedia(["sharing"],null,null,mediaConstraints.fixedFrameRate,call).then((function(stream){for(var i=0;i<that.localStreams.length;i++)session.removeStream(that.localStreams[i]),session.localStreams[i]=null;for(session.localStreams=[],that.pushInLocalStreams(stream,call.id),i=0;i<that.localStreams.length;i++)session.removeStream(that.localStreams[i]);that.updateCurrentCall(call,session,"sharing","contentAdd"),that.sendEvent("startHighlighting")})).catch((function(error){$log.webrtc("MEDIA   | addSharingToCall failure : "+error),session.isRenegotiating=!1,-1!==error.toString().indexOf("getUserMedia")&&that.openErrorPopup()}))},this.addVideoToCall=function(call,mediaModify){$log.webrtc("MEDIA   | addVideoToCall");var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];session.isRenegotiating=!0;var mediaConstraints={};call.isInConversationWithMobile()&&(mediaConstraints=that.getMobileMediaConstraints("video")),that.getBrowserMedia(["audio","video"],mediaConstraints.fixedVideoWidth,mediaConstraints.fixedVideoHeight,mediaConstraints.fixedFrameRate).then((function(stream){that.stopActiveAudioVideoStreams(session),that.pushInLocalStreams(stream,call.id);for(var i=0;i<that.localStreams.length;i++)session.removeStream(that.localStreams[i]);var type=mediaModify?"contentModify":"contentAdd";that.updateCurrentCall(call,session,"video",type),session.muteAudio(call.isMuted)})).catch((function(error){$log.webrtc("MEDIA   | addVideoToCall failure for : "+call+" failure : "+error.message),-1!==error.toString().indexOf("getUserMedia")?($log.info("addVideoToCall impossible, no webcam plugged"),that.openErrorPopup()):(that.releaseCall(call),that.resetToSafeState())}))},this.removeSharingFromCall=function(call){$log.webrtc("MEDIA   | removeSharingFromCall");var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];this.stopActiveSharingStream(session),session.isRenegotiating=!0,that.updateCurrentCall(call,session,"sharing","contentRemove"),that.sendEvent("stopHighlighting")},this.removeVideoFromCall=function(call){$log.webrtc("MEDIA   | removeVideoFromCall"),this.reverseAudioCallInitiated=!0;var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];this.stopActiveAudioVideoStreams(session),this.localStreams.forEach((function(stream){session.removeStream(stream)})),session.isRenegotiating=!0,that.getBrowserMedia(["audio"]).then((function(stream){that.pushInLocalStreams(stream,call.id),that.updateCurrentCall(call,session,"video","contentRemove"),session.muteAudio(call.isMuted)})).catch((function(error){$log.webrtc("MEDIA   | removeVideoFromCall failure for : "+call+" failure : "+error),-1!==error.toString().indexOf("getUserMedia")&&that.openErrorPopup(),that.releaseCall(call),that.resetToSafeState()}))},this.calculatePresenceMessage=function(call){var message="audio";return call&&call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO&&(message="video"),call&&call.remoteMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO&&(message="video"),call&&call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING&&(message="sharing"),message},this.calculateAudioState=function(data){var audioState=0;return data.availableIncomingAudioBandwidth&&(audioState=data.availableIncomingAudioBandwidth<15&&data.availableIncomingAudioBandwidth>0?1:data.availableIncomingAudioBandwidth>=15&&data.availableIncomingAudioBandwidth<30?2:3),audioState},this.calculateVideoState=function(data){var videoState=0;return data.availableIncomingVideoBandwidth&&(videoState=data.availableIncomingVideoBandwidth<300?1:data.availableIncomingVideoBandwidth>=300&&data.availableIncomingVideoBandwidth<500?2:3),videoState},this.execute=function(action,actionHandler,parameter){this.started||"releaseCall"===action?actionHandler(parameter):$log.webrtc("MEDIA   | "+action+" failure : videoService is not started")},this.getOrCreateCallByCallId=function(callId){var call=that.calls[callId];if(!call){var sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[callId],peerJid=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.getBareJidFromJid(sess.peerjid),contact=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.getContactByJid(peerJid);call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.create(_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN,callId,_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Type.WEBRTC,contact),that.calls[call.id]=call}return call},this.getCallByContact=function(contact){for(var key in this.calls)if(this.calls.hasOwnProperty(key)){var _call16=that.calls[key];if(_call16.contact&&contact.jid===_call16.contact.jid)return _call16}return null},this.removeCallObject=function(call,reason,text){try{if(call){$log.debug("removeCallObject Call id: "+call.id),call.status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.UNKNOWN,call.stopDuration();var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions?_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id]:null;that.disableAudioVideoMedia(session,call.id),delete that.calls[call.id],$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),session&&_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.terminate(call.id,reason,text),that.sendEvent("stopHighlighting")}}catch(error){$log.error("removeCallObject error "+error)}},this.updateRemoteTypeMedia=function(remoteType,call){switch(remoteType){case"audio":call.remoteMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO;break;case"video":call.remoteMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO;break;case"audio+video":call.remoteMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO|_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO;break;case"sharing":call.remoteMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING|_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO;break;case"sharing-only":call.remoteMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING;break;default:call.remoteMedia=null}$log.debug("REMOTE TYPE || REMOTE MEDIA  "+call.remoteMedia)},this.checkStreamAndStatus=function(stream,contact){return stream&&(0===stream.getAudioTracks().length&&0===stream.getVideoTracks().length||!1===stream.active)?(that.openErrorPopup(),!1):!(contact.capabilities&&!contact.capabilities.webRTC)||($log.webrtc("MEDIA   | initSharedDesktop failure : remote contact is no more available"),stream.stop&&stream.stop(),that.openErrorPopup("remoteUserNoMoreAvailable"),!1)},this.displayWebRTCStats=function(callId){try{var streams=null,i=0;if(gRTCStatsService.hasStatsForCall(callId)){if($log.webrtc("STATS   | Bundle policy used: "+gRTCStatsService.getBundlePolicyForCall(callId)),0===(streams=gRTCStatsService.getStreamsDetailsFromCall(callId)).length)$log.webrtc("STATS   | No channel information available for call "+callId);else for(i=0;i<streams.length;i++)$log.webrtc("STATS   | "+streams[i].id+": "+JSON.stringify(streams[i].streams));var codecs=gRTCStatsService.getCodecDetailsFromCall(callId);$log.webrtc("STATS   | codecs used: "+JSON.stringify(codecs)),gaService.trackCodecsUsed(codecs.codec.audio,codecs.codec.video)}else if(fRTCStatsService.hasStatsForCall(callId))if($log.webrtc("STATS   | Bundle policy used: "+fRTCStatsService.getBundlePolicyForCall(callId)),0===(streams=fRTCStatsService.getStreamsDetailsFromCall(callId)).length)$log.webrtc("STATS   | No channel information available for call "+callId);else for(i=0;i<streams.length;i++)$log.webrtc("STATS   | "+streams[i].id+": "+JSON.stringify(streams[i].streams))}catch(error){$log.error("[videoService] displayWebRTCStats error : "+error)}},this.muteAudio=function(conversation,state){var call=conversation.videoCall;if(call){$log.webrtc("MEDIA   | mute audio: "+call+" | state: "+state),conversation.isMutedAudio=state,call.isMuted=state;var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];session?(session.muteAudio(state),$rootScope.$broadcast("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",{conversation:conversation,call:call})):$log.webrtc("MEDIA   | muteAudio - trying to mute a non existing session !")}else $log.webrtc("MEDIA   | muteAudio - trying to mute a non existing call !")},this.referTo=function(session,confEndpointId,referTo){session?session.sendRefer(confEndpointId,referTo):$log.webrtc("MEDIA   | referTo - trying to transfer a non existing session !")},this.sendReferStatus=function(callId,status){var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[callId];session?($log.webrtc("MEDIA   | sendReferStatus - "+status),session.sendReferStatus(status)):$log.webrtc("MEDIA   | sendReferStatus - trying to transfer a non existing session !")},this.muteVideo=function(conversation,state){var call=conversation.videoCall;if(call){$log.webrtc("MEDIA   | muteVideo: "+call);var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];session&&(session.muteVideo(state),session.sendMute(state)),$rootScope.$broadcast("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",{conversation:conversation,call:call})}else $log.webrtc("MEDIA   | muteVideo - trying to mute a non existing call !")},this.stopActiveSharingStream=function(session){if(that.localStreams.length>0){that.localStreams.forEach((function(stream){stream.getVideoTracks().length&&!stream.getAudioTracks().length&&(stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),stream=null)}));for(var i=0;i<that.localStreams.length;i++)if(that.localStreams[i]&&!that.localStreams[i].getAudioTracks().length&&that.localStreams[i].getVideoTracks().length){that.localStreams.splice(i,1);null}}session&&session.localStreams&&(session.localStreams.forEach((function(stream){stream.getVideoTracks().length&&!stream.getAudioTracks().length&&(stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop()),session.removeStream(stream)})),session.localStreams=[]),session&&_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.localStream&&session.removeStream(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.localStream)},this.stopAllActiveStreams=function(session){this.stopActiveAudioVideoStreams(session,!0)},this.stopActiveAudioVideoStreams=function(session,stopAll){if(that.localStreams.length>0)if(that.localStreams.forEach((function(stream){(stream.getAudioTracks().length||stopAll)&&(stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),stream=null)})),stopAll)for(;that.localStreams.length;)that.localStreams.pop();else for(var i=0;i<that.localStreams.length;i++)that.localStreams[i]&&that.localStreams[i].getAudioTracks().length&&that.localStreams.splice(i,1);if(session&&session.localStreams){if(session.localStreams.forEach((function(stream){(stream.getAudioTracks().length||stopAll)&&(stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),session.removeStream(stream))})),stopAll)for(;session.localStreams.length;)session.localStreams.pop();session.localStreams=[]}session&&_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.localStream&&session.removeStream(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.localStream)},this.resetToSafeState=function(){$log.webrtc("MEDIA   | resetToSafeState"),that.autoreleaseTimeout&&$interval.cancel(that.autoreleaseTimeout),(that.localStream||that.localStreams.length)&&that.disableAudioVideoMedia(),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.resetBusyState()},this.vidRes={1080:[1920,1080],720:[1280,720],360:[640,360],180:[320,180],960:[960,720],640:[640,480],320:[320,240]},this.getMobileMediaConstraints=function(type){return this.mobileVideoQualityConfiguration[type]},this.setVideoQualityConfigurationForCompany=function(){this.companyConfig&&this.companyConfig.video&&(this.videoQualityConfiguration.video.fixedVideoHeight=this.companyConfig.video.height?this.companyConfig.video.height.ideal:this.videoQualityConfiguration.video.fixedVideoHeight,this.videoQualityConfiguration.video.fixedVideoWidth=this.companyConfig.video.width?this.companyConfig.video.width:this.videoQualityConfiguration.video.fixedVideoWidth,this.videoQualityConfiguration.video.fixedFrameRate=this.companyConfig.video.frameRate?this.companyConfig.video.frameRate:this.videoQualityConfiguration.video.fixedFrameRate)},this.videoQualityConfiguration={video:{fixedFrameRate:30,fixedVideoWidth:1280,fixedVideoHeight:720},sharing:{fixedFrameRate:10,fixedVideoWidth:1280,fixedVideoHeight:720}},this.mobileVideoQualityConfiguration={video:{fixedFrameRate:20,fixedVideoWidth:640,fixedVideoHeight:480},sharing:{fixedFrameRate:10,fixedVideoWidth:640,fixedVideoHeight:480}},this.minFirefoxWebRTCVersion=45,this.minChromeWebRTCVersion=42,this.minEdgeWebRTCVersion=25,this.firefoxPreferedSharing="screen",this.getBrowserMedia=function(userMedia,fixedVideoWidth,fixedVideoHeight,fixedFrameRate,call){return userMedia&&0!==userMedia.length?new Promise((function(resolve,reject){var deferred=$q.defer(),shouldGetDisplayMedia=!1,constraints={audio:!1,video:!1},width=fixedVideoWidth||that.videoQualityConfiguration.video.fixedVideoWidth,height=fixedVideoHeight||that.videoQualityConfiguration.video.fixedVideoHeight,promises=[];if(platformService.allowDevicesManagement()){if(userMedia.indexOf("audio")>=0){var microphoneDeferred=$q.defer();platformService.getCurrentMicrophone().then((function(microphone){constraints.audio=!microphone||{optional:[{sourceId:microphone.id},{googEchoCancellation:!0},{autoGainControl:!0},{noiseSuppression:!0},{googHighpassFilter:!0},{googAudioMirroring:!0}]},microphoneDeferred.resolve(constraints);var mic="default";microphone&&(mic="id - "+microphone.id+" and label "+microphone.label),$log.info("[VideoService] GetUserMedia for microphone "+mic)})),promises.push(microphoneDeferred.promise)}if(userMedia.indexOf("video")>=0){var frameRate=fixedFrameRate||that.videoQualityConfiguration.video.fixedFrameRate,cameraDeferred=$q.defer();platformService.getCurrentCamera().then((function(camera){camera&&"default"!==camera.id?constraints.video={width:width,height:height,frameRate:frameRate,deviceId:{exact:camera.id}}:constraints.video={width:width,height:height,frameRate:frameRate},cameraDeferred.resolve(constraints);var cam="default";camera&&(cam="id - "+camera.id+" and label "+camera.label),$log.info("[VideoService] GetUserMedia for camera "+cam)})),promises.push(cameraDeferred.promise)}}else userMedia.indexOf("audio")>=0&&(constraints.audio={optional:[{googEchoCancellation:!0},{autoGainControl:!0},{noiseSuppression:!0},{googHighpassFilter:!0},{googAudioMirroring:!0}]}),userMedia.indexOf("video")>=0&&(constraints.video={width:width,height:height});if(userMedia.indexOf("sharing")>=0){frameRate=fixedFrameRate||that.videoQualityConfiguration.sharing.fixedFrameRate,width=fixedVideoWidth||that.videoQualityConfiguration.sharing.fixedVideoWidth,height=fixedVideoHeight||that.videoQualityConfiguration.sharing.fixedVideoHeight;var isSharingScreen=!0;if(extensionSharingService.extensionFound)constraints.video={mandatory:{chromeMediaSource:"desktop",maxFrameRate:frameRate}},promises.push(extensionSharingService.getStreamToShareFromExtension(constraints));else if(that.isNativeApplication()||"chrome"!==adapter.default.browserDetails.browser)if("firefox"===adapter.default.browserDetails.browser)constraints.video={mediaSource:that.firefoxPreferedSharing};else{var sharingSources=that.getDesktopSharingSource(),chromeMediaSource=sharingSources&&sharingSources.chromeMediaSource?sharingSources.chromeMediaSource:"desktop",chromeMediaSourceId=sharingSources&&sharingSources.chromeMediaSourceId?sharingSources.chromeMediaSourceId:null;chromeMediaSourceId&&(isSharingScreen=-1!==chromeMediaSourceId.indexOf("screen")),constraints.video={mandatory:{chromeMediaSource:chromeMediaSource,maxFrameRate:frameRate}},chromeMediaSourceId&&(constraints.video.mandatory.chromeMediaSourceId=chromeMediaSourceId)}else shouldGetDisplayMedia=!0,constraints={},constraints={video:{chromeMediaSource:"desktop",frameRate:frameRate}}}call&&(call.isSharingScreen=isSharingScreen),$q.all(promises).then((function(){deferred.resolve(constraints)})).catch((function(){deferred.resolve()})),deferred.promise.then((function(constraint){if($log.info("[VideoService] GetUserMedia with constraint "+JSON.stringify(constraint)),constraint)try{shouldGetDisplayMedia?navigator.mediaDevices.getDisplayMedia(constraint).then((function(stream){$log.webrtc("MEDIA   | getDisplayMedia success"),stream.getVideoTracks().length&&$log.info("[videoService] getDisplayMedia video stream kind "+stream.getVideoTracks()[0].kind+", id "+stream.getVideoTracks()[0].id+", label "+stream.getVideoTracks()[0].label+", readyState "+stream.getVideoTracks()[0].readyState+", enabled "+stream.getVideoTracks()[0].enabled),stream&&(0===stream.getAudioTracks().length&&0===stream.getVideoTracks().length||!1===stream.active)&&($log.webrtc("Stream has no active audio or video tracks"),gaService.trackGetUserMediaErrorNoTrack(),reject(new Error("getDisplayMedia failure : Stream has no active audio or video tracks"))),stream.getVideoTracks()[0].onended=function(){$log.info("Stop screensharing in chrome has been triggered"),$rootScope.$broadcast("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED")},resolve(stream),gaService.trackGetUserMediaSuccess()})).catch((function(error){$log.webrtc("MEDIA   | getDisplayMedia failure: "+error),gaService.trackGetUserMediaError(),$rootScope.$broadcast("ON_WEBRTC_GETUSERMEDIA_ERROR",error),reject(new Error("getDisplayMedia failure "+error))})):navigator.mediaDevices.getUserMedia(constraint).then((function(stream){$log.webrtc("MEDIA   | getUserMedia success"),stream.getAudioTracks().length&&$log.info("[videoService] getUserMedia audio stream kind "+stream.getAudioTracks()[0].kind+", id "+stream.getAudioTracks()[0].id+", label "+stream.getAudioTracks()[0].label+", readyState "+stream.getAudioTracks()[0].readyState+", enabled "+stream.getAudioTracks()[0].enabled),stream.getVideoTracks().length&&$log.info("[videoService] getUserMedia video stream kind "+stream.getVideoTracks()[0].kind+", id "+stream.getVideoTracks()[0].id+", label "+stream.getVideoTracks()[0].label+", readyState "+stream.getVideoTracks()[0].readyState+", enabled "+stream.getVideoTracks()[0].enabled),stream&&(0===stream.getAudioTracks().length&&0===stream.getVideoTracks().length||!1===stream.active)&&($log.webrtc("Stream has no active audio or video tracks"),gaService.trackGetUserMediaErrorNoTrack(),reject(new Error("getUserMedia failure : Stream has no active audio or video tracks"))),extensionSharingService.extensionFound&&userMedia.indexOf("sharing")>=0&&(stream.getVideoTracks()[0].onended=function(){$log.info("Stop screensharing in chrome has been triggered"),$rootScope.$broadcast("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED")}),stream&&stream.getAudioTracks().length&&(stream.getAudioTracks()[0].onended=function(event){$log.error("[videoService] getUserMedia -- audio stream track ended"),console.log(this),console.log(event)}),resolve(stream),gaService.trackGetUserMediaSuccess()})).catch((function(error){$log.webrtc("MEDIA   | getUserMedia failure: "+error),gaService.trackGetUserMediaError(),$rootScope.$broadcast("ON_WEBRTC_GETUSERMEDIA_ERROR",error),reject(new Error("getUserMedia failure "+error))}))}catch(err){$log.webrtc("MEDIA   | getUserMedia failure: "+err),gaService.trackGetUserMediaError(),reject(new Error("getUserMedia failure "+err))}else reject({message:"getUserMedia cancelled"})}))})):$q.when()},this.getBrowserMethodHandler=function(){var version="",returnValue=null;if(navigator.mozGetUserMedia&&$window.mozRTCPeerConnection){if(version=browserService.extractBrowserVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),$log.webrtc("BROWSER | Detect Firefox navigator (version "+version+")"),version<this.minFirefoxWebRTCVersion)return $log.webrtc("BROWSER | Firefox navigator is not WebRTC capable before version "+this.minFirefoxWebRTCVersion),returnValue;returnValue={browser:"firefox",attachMediaStream:function(element,stream){element&&element[0]&&(element[0].mozSrcObject=stream,element[0].srcObject=stream,element[0].play())},pc_constraints:{},clearMediaStream:function(element){try{angular.isDefined(element[0])&&(element[0].pause(),element[0].mozSrcObject=null,element[0].srcObject=null,element[0].uniqueId=null)}catch(err){$log.webrtc("BROWSER | clearMediaStream failure "+err)}},attachMediaStreamIfNeeded:function(element,stream,uniqueId){$log.webrtc("BROWSER | attachMediaStreamIfNeeded for ID "+uniqueId),element&&element[0]&&(element[0].uniqueId!==uniqueId||!element[0].mozSrcObject&&!element[0].srcObject)&&(element[0].uniqueId=uniqueId,that.RTC.attachMediaStream(element,stream))}}}else if(navigator.webkitGetUserMedia&&$window.webkitRTCPeerConnection){if(version=browserService.extractBrowserVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),$log.webrtc("BROWSER | Detect Chrome navigator (version "+version+")"),version<this.minChromeWebRTCVersion)return $log.webrtc("BROWSER | Chrome navigator is not WebRTC capable before version "+this.minChromeWebRTCVersion),returnValue;returnValue={browser:"chrome",attachMediaStream:function(element,stream){$log.webrtc("BROWSER | attachMediaStream to element"),element&&element[0]&&(element[0].srcObject=stream)},pc_constraints:{},clearMediaStream:function(element){angular.isDefined(element[0])&&(element[0].pause(),element[0].srcObject=null,element[0].uniqueId=null)},attachMediaStreamIfNeeded:function(element,stream,uniqueId){$log.webrtc("BROWSER | attachMediaStreamIfNeeded for ID "+uniqueId),!element||!element[0]||element[0].uniqueId===uniqueId&&element[0].srcObject||(element[0].uniqueId=uniqueId,that.RTC.attachMediaStream(element,stream))}}}else window.RTCPeerConnection&&navigator.userAgent.match(/AppleWebKit\/(\d+)\./)&&(returnValue={browser:"safari",attachMediaStream:function(element,stream){element&&element[0]&&(element[0].setAttribute("playsinline",!0),element[0].srcObject=stream,element[0].play())},pc_constraints:{},clearMediaStream:function(element){try{angular.isDefined(element[0])&&(element[0].pause(),element[0].srcObject=null,element[0].uniqueId=null)}catch(err){$log.webrtc("BROWSER | clearMediaStream failure "+err)}},attachMediaStreamIfNeeded:function(element,stream,uniqueId){$log.webrtc("BROWSER | attachMediaStreamIfNeeded for ID "+uniqueId),!element||!element[0]||element[0].uniqueId===uniqueId&&element[0].srcObject||(element[0].uniqueId=uniqueId,that.RTC.attachMediaStream(element,stream))}});return returnValue},this.getIceConfig=function(){return $q((function(resolve,reject){var geoip=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_3___default.a.getSetting("geoip"),geoipUrl="";geoip&&(geoipUrl="&geoip="+geoip);var portalURL=config.restServerUrl+"/api/rainbow/geolocation/v1.0/";$http({method:"GET",url:portalURL+"settings/iceservers?nbServers=2"+geoipUrl,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_4___default.a.getRequestHeader()}).then((function(result){$log.info("[videoService] getIceConfig success"),that.ttl=result.data.ttl,that.ttl&&(that.ttlTimeout=$interval((function(){that.ttl=0,that.setWebrtcConfiguration()}),1e3*result.data.ttl,1));var iceServers=result.data.data,dc=[];iceServers.forEach((function(element){element.dc&&!dc.includes(element.dc)&&dc.push(element.dc),delete element.dc,delete element.id}),this),resolve({iceServers:iceServers,dc:dc})})).catch((function(error){$log.error("[videoService] getIceConfig failure -- "+error.message),reject(error)}))}))},this.getCompanyWebrtcConfig=function(){return $q((function(resolve,reject){var apiURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/settings/webrtc";$http({method:"GET",url:apiURL,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_4___default.a.getRequestHeader()}).then((function(result){$log.info("[videoService] getCompanyWebrtcConfig success");var config=result.data.data;resolve(config)})).catch((function(error){var msg=error&&error.data?error.data.errorDetails:"Unknown error";if(error&&error.data&&400100==error.data.errorDetailsCode)return $log.info("[videoService] getCompanyWebrtcConfig -- "+msg),resolve({});$log.error("[videoService] getCompanyWebrtcConfig failure -- "+msg),reject(error)}))}))},this.calculateNewCallType=function(call,session,type,action){var result=session.localType;return"contentAdd"===action&&("video"===type?(result=call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING?"sharing+video":"video",call.localMedia=call.localMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO):"sharing"===type?(result=call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO?"sharing+video":"sharing",call.localMedia=call.localMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING):"audio"===type&&(call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING?(result="sharing",call.localMedia=call.localMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO):(result="audio",call.localMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO))),"contentRemove"===action&&("video"===type?call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING?(result="sharing",call.localMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO|_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING):(result="audio",call.localMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO):"sharing"===type&&(call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO?(result="video",call.localMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO|_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO):(result="audio",call.localMedia=_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.AUDIO))),"contentModify"===action&&call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.VIDEO&&!(call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Media.SHARING)&&(result="video"),$log.info("[videoService] calculateNewCallType for type "+type+" and action "+action+" with result "+result),result},this.updateCurrentCall=function(call,session,type,action){$log.info("[videoService] updateCurrentCall for type "+type+" and action "+action);for(var newType=this.calculateNewCallType(call,session,type,action),i=0;i<that.localStreams.length;i++)"chrome"===adapter.default.browserDetails.browser?session.addStream(that.localStreams[i]):session.replaceStream(that.localStreams[i]),session.localStreams.push(that.localStreams[i]);switch(action){case"contentAdd":session.contentAdd(newType);break;case"contentRemove":session.contentRemove(newType);break;case"contentModify":session.contentModify(newType)}_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_7___default.a.setBusyState("dnd",that.calculatePresenceMessage(call)),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),$rootScope.$broadcast("ON_WEBRTC_CALL_ESCALATION",call)},this.createOrUpdateStatisticsForCall=function(callId){var call=this.calls[callId];if(call){var metrics=[];if(this.callsStats[callId])return this.callsStats[callId].RainMetrics&&this.callsStats[callId].push(this.callsStats[callId].RainMetrics),metrics.push({connectionId:callId,stats:this.callsStats[callId]}),void this.updateStatisticsForCall(this.callsStats[callId].id,callId,call.contact.dbId,"ended",metrics);$log.info("[videoService] createOrUpdateStatisticsForCall "+callId),this.callsStats[callId]={},metrics.push({connectionId:callId,stats:this.callsStats[callId]}),this.createStatisticsForSession(callId,call.contact.dbId,"pending",metrics).then((function(id){that.callsStats[callId].id=id,$log.info("[videoService] createOrUpdateStatisticsForCall success for session "+callId+" with id "+id)})).catch((function(error){$log.error("[videoService] createOrUpdateStatisticsForCall "+error.message)}))}else $log.warn("[videoService] createOrUpdateStatisticsForCall -- missing call "+callId)},this.createStatisticsForSession=function(callId,peerId,callState,metrics){return $q((function(resolve,reject){$log.info("[videoService] createStatisticsForSession "+callId);var portalURL=config.restServerUrl+"/api/rainbow/metrics/v1.0/";$http({method:"POST",url:portalURL+"webrtcmetrics",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_4___default.a.getRequestHeader(),data:{callId:callId,peerId:peerId,callState:callState}}).then((function(response){$log.info("[videoService] createStatisticsForSession success"),response&&response.data&&response.data.data&&response.data.data.id&&(that.callsStats[callId]||(that.callsStats[callId]={}),resolve(response.data.data.id))}),(function(response){$log.error("[videoService] createStatisticsForSession failure "+response.errorMsg),reject(new Error(response.errorMsg))}))}))},this.updateStatisticsForCall=function(id,callId,peerId,callState,metrics){if($log.info("[videoService] updateStatisticsForCall "+callId),id){var portalURL=config.restServerUrl+"/api/rainbow/metrics/v1.0/";$http({method:"POST",url:portalURL+"webrtcmetrics/"+id+"/metrics",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_4___default.a.getRequestHeader(),data:{metrics:metrics}}).then((function(){$log.info("[videoService] updateStatisticsForCall success"),"ended"===callState&&($log.info("[videoService] updateStatisticsForCall -- update call state with "+callState),$http({method:"PUT",url:portalURL+"webrtcmetrics/"+id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_4___default.a.getRequestHeader(),data:{callState:callState}}).then((function(){$log.info("[videoService] updateStatisticsForCall -- update call state success")}),(function(response){$log.error("[videoService] updateStatisticsForCall failure "+response.errorMsg)})))}),(function(response){$log.error("[videoService] updateStatisticsForCall failure "+response.errorMsg)}))}else $log.warn("[videoService] updateStatisticsForCall -- missing id for callId "+callId)},this.sendDTMF=function(dialString,call,skipHandle){var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[call.id];if(session&&session.peerconnection){var audioDtmfSender=session.peerconnection.getSenders().find((function(sender){return sender.dtmf&&sender.track&&sender.track.enabled&&"audio"===sender.track.kind})),dtmfSender=audioDtmfSender?audioDtmfSender.dtmf:null;dtmfSender?($log.debug("[videoService] sendDTMF: dtmf sender found on webrtc session for call id "+call.id+" dialstring: "+dialString),dtmfSender.ontonechange=skipHandle?this.silentToneChangeEventHandle:this.handleToneChangeEvent,dtmfSender.insertDTMF(dialString)):$log.error("[videoService] sendDTMF: no dtmf sender found on webrtc session for call id "+call.id)}else $log.error("[videoService] sendDTMF: no webrtc session found for call id "+call.id)},this.handleToneChangeEvent=function(event){""!==event.tone&&($log.debug("[videoService] Dtmf Tone played: "+event.tone),$rootScope.$broadcast("ON_DTMF_SENT",event.tone))},this.silentToneChangeEventHandle=function(event){$log.debug("[videoService] Dtmf Tone played: "+event.tone)},angular.element(document).bind("transportreplace.jingle",(function(__event,callId){$log.webrtc("JINGLE  | transportreplace.jingle "+callId);var sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[callId];sess?sess.sendAnswer(void 0,"transport-accept"):$log.warn("JINGLE  | transportreplace.jingle no such session !")})),angular.element(document).bind("callactive.jingle",(function(__event,callId){$log.webrtc("JINGLE  | callactive "+callId)})),angular.element(document).bind("remotestreamadded.jingle",(function(__event,sid,hasAudioTracks){$log.webrtc("JINGLE  | remoteStreamadded "+sid);var sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[sid];if(sess&&sess.remoteStreams&&!sess.confId){var _call17=that.calls[sid];_call17&&that.attachDistantMediaStreams(!0,_call17),$rootScope.$broadcast("ON_WEBRTC_REMOTE_STREAM_ADDED",sess.remoteStreams)}hasAudioTracks&&that.resetAudioOutputElement()})),angular.element(document).bind("remotestreamremoved.jingle",(function(__event,sid){$log.webrtc("JINGLE  | remotestreamremoved "+sid);var call=that.calls[sid],sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[sid];call&&sess&&that.attachDistantMediaStreams(!0,call)})),angular.element(document).bind("callaccepted.jingle",(function(__event,sid){$log.webrtc("JINGLE  | callaccepted "+sid);var call=that.calls[sid],sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[sid];call&&sess&&(that.statsInterval&&($log.webrtc("JINGLE  | remove getStats interval"),window.clearInterval(that.statsInterval),that.statsinterval=null),that.createOrUpdateStatisticsForCall(call.id),$log.webrtc("JINGLE  | start getStats interval"),that.statsInterval=sess.getStats(3e3)),call&&call.status.key!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_2__.Call.Status.ACTIVE.key&&($log.webrtc("INFO    | call has been accepted. Set current call to ACTIVE state"),angular.element(document).trigger("callactive.jingle",[sid]))})),angular.element(document).bind("nostuncandidates.jingle",(function(__event,sid){$log.webrtc("JINGLE  | nostuncandidates "+sid),gaService.trackICENoSTUNCandidate()})),angular.element(document).bind("ringing.jingle",(function(__event,sid){$log.webrtc("JINGLE  | callremoteringing "+sid)})),angular.element(document).bind("mediafailure.jingle",(function(){$log.webrtc("JINGLE  | callmediafailure")})),angular.element(document).bind("mute.jingle",(function(__event,sid){$log.webrtc("JINGLE  | mute "+sid);var call=that.calls[sid];call.isRemoteVideoMuted=!0,$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)})),angular.element(document).bind("unmute.jingle",(function(__event,sid){$log.webrtc("JINGLE  | unmute "+sid);var call=that.calls[sid];call.isRemoteVideoMuted=!1,$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)})),angular.element(document).bind("hold.jingle",(function(__event,sid){$log.webrtc("JINGLE  | hold "+sid);var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[sid];session?(session.muteAudio(!0),$rootScope.$broadcast("ON_HOLD_TONE_EVENT","hold")):$log.webrtc("MEDIA   | hold - received on a non existing session !")})),angular.element(document).bind("unhold.jingle",(function(__event,sid){$log.webrtc("JINGLE  | unhold "+sid);var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_5___default.a.connection.jingle.sessions[sid];session?(session.muteAudio(!1),$rootScope.$broadcast("ON_HOLD_TONE_EVENT","unhold")):$log.webrtc("MEDIA   | unhold - received on a non existing session !")})),angular.element(document).bind("remoteIceFailed.jingle",(function(sid){$log.webrtc("JINGLE  | remoteIceFailed "+sid),that.openErrorPopup("IceConnectionFailed")})),angular.element(document).bind("mediamodified.jingle",(function(__event,sid,mediaType){$log.webrtc("JINGLE  | mediamodified "+sid),that.videoEventHandler.mediaModified(sid,mediaType)})),angular.element(document).bind("statsChrome.jingle",(function(__event,sid,items){for(var i=0;i<items.length;++i)switch(items[i].type){case"googComponent":gRTCStatsService.addStreamToCall(sid,items[i]);break;case"ssrc":gRTCStatsService.addSSRCToStream(sid,items[i])}})),angular.element(document).bind("statsFirefox.jingle",(function(__event,sid,items){for(var i=0;i<items.length;++i)switch(items[i].type){case"inboundrtp":case"outboundrtp":fRTCStatsService.addStreamToCall(sid,items[i]);break;case"candidatepair":fRTCStatsService.addCandidatePairToCall(sid,items[i])}})),angular.element(document).bind("webrtcFirefoxStats.jingle",(function(__event,sid,data){if(that.callsStats.sid||(that.callsStats.sid={}),that.callsStats[sid]||(that.callsStats[sid]={}),that.calls[sid]){var currentStats=that.callsStats[sid];currentStats&&(data.videoReceived?currentStats.video=data:currentStats.audio=data,that.callsStats[sid]=currentStats)}})),angular.element(document).bind("webrtcConnectionType.jingle",(function(__event,sid,connectionType){var activeCall=that.calls[sid];connectionType&&($log.webrtc("STATS   | Local candidate ("+connectionType.localAddress+") type is "+connectionType.localCandidateType),$log.webrtc("STATS   | Remote candidate  ("+connectionType.remoteAddress+") type is "+connectionType.remoteCandidateType),activeCall&&activeCall.isInitiator&&gaService.trackICEUsed(connectionType.localCandidateTypee,connectionType.remoteCandidateType),connectionType.networkType&&($log.webrtc("STATS   | Network type is "+connectionType.networkType),activeCall&&activeCall.isInitiator&&gaService.trackICETopology(connectionType.networkType)))})),angular.element(document).bind("webrtcSessionStats.jingle",(function(__event,sid,data){that.callsStats.sid||(that.callsStats.sid={}),that.callsStats[sid]||(that.callsStats[sid]={});var id=that.callsStats[sid].id;that.callsStats[sid]=data,that.callsStats[sid].id=id}))}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_models_call_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),uuid__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2__),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3__),_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14),_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5__);angular.module("rainbow").factory("VideoServiceEventHandler",["$q","$log","$rootScope","$interval","gaService",function($q,$log,$rootScope,$interval,gaService){function VideoServiceEventHandler(videoService){this.videoService=videoService,this.nameSpace="urn:xmpp:jingle-message:0"}return VideoServiceEventHandler.create=function(videoService){return new VideoServiceEventHandler(videoService)},VideoServiceEventHandler.prototype.setRemoteTypeMedia=function(remoteType,call){call.remoteMedia=0;for(var i=0;i<remoteType.length;i++)switch(remoteType[i]){case"audio":call.remoteMedia=call.remoteMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO;break;case"video":call.remoteMedia=call.remoteMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.VIDEO;break;case"sharing":call.remoteMedia=call.remoteMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.SHARING;break;default:call.remoteMedia=null}$log.debug("REMOTE TYPE || REMOTE MEDIA  "+call.remoteMedia)},VideoServiceEventHandler.prototype.setLocalTypeMedia=function(localType,call){call.localMedia=0;for(var i=0;i<localType.length;i++)switch(localType[i]){case"audio":call.localMedia=call.localMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO;break;case"video":call.localMedia=call.localMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.VIDEO;break;case"sharing":call.localMedia=call.localMedia|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.SHARING;break;default:call.localMedia=null}$log.debug("LOCAL TYPE || LOCAL MEDIA  "+call.localMedia)},VideoServiceEventHandler.prototype.sendProposition=function(contact,media,message){$log.info("[VideoServiceEventHandler]   | sendProposition to "+JSON.stringify({displayName:contact.nameForLog,resources:contact.resources}));var that=this,mediaToGet=["audio"],secondMediaToGet=[];"video"===media?mediaToGet.push("video"):"videoOnly"===media?mediaToGet=["video"]:"sharing"===media?(mediaToGet=["sharing"],secondMediaToGet=["audio"]):"sharingOnly"===media&&(mediaToGet=["sharing"]);var id="web_"+uuid__WEBPACK_IMPORTED_MODULE_1__(),call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.create(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.DIALING,id,_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Type.WEBRTC,contact);this.videoService.getBrowserMedia(mediaToGet,void 0,void 0,void 0,call).then((function(stream){that.videoService.getBrowserMedia(secondMediaToGet).then((function(extraStream){if(that.videoService.makingCall&&that.videoService.started){call.isInitiator=!0,stream.callId=id,that.videoService.localStreams.push(stream),extraStream&&(extraStream.callId=id,that.videoService.localStreams.push(extraStream),mediaToGet.push(secondMediaToGet.pop())),that.videoService.calls[call.id]=call,that.setLocalTypeMedia(mediaToGet,call);var idPropose="web_"+uuid__WEBPACK_IMPORTED_MODULE_1__(),xmppMessage=$msg({from:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.fullJid,to:contact.jid,id:idPropose});xmppMessage.c("propose",{xmlns:that.nameSpace,id:id}),message&&xmppMessage.c("subject",{xmlns:"urn:xmpp:jingle-subject:0"}).t(message).up(),xmppMessage.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:mediaToGet[0]}).up(),mediaToGet[1]&&(xmppMessage=xmppMessage.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:mediaToGet[1]}).up()),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3___default.a.FeaturesEnum.WEBRTC_UNIFIED_PLAN)&&(xmppMessage=xmppMessage.c("unifiedplan",{xmlns:"urn:xmpp:jingle:apps:jsep:1"}).up()),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.send(xmppMessage),that.videoService.makingCall=!1,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.setBusyState("dnd",that.videoService.calculatePresenceMessage(call)),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),that.videoService.autoreleaseTimeout&&$interval.cancel(that.videoService.autoreleaseTimeout),that.videoService.autoreleaseTimeout=$interval((function(_call){$log.webrtc("MEDIA   | send proposition : no response after 30 seconds : release the call"),call&&that.videoService.rejectCall(_call)}),3e4,1,!0,call)}else $log.warn("[VideoServiceEventHandler]   | sendProposition -- call should no longer be made !"),that.videoService.makingCall=!1,stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),stream=null,extraStream&&(extraStream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),extraStream.stop&&extraStream.stop(),extraStream=null)})).catch((function(error){$log.info("[VideoServiceEventHandler]   | sendProposition failure : "+JSON.stringify({error:error.message})),that.videoService.makingCall=!1,-1!==error.toString().indexOf("getUserMedia")&&that.videoService.openErrorPopup(),that.videoService.removeCallObject(call),that.videoService.isUserContactInCall()||that.videoService.resetToSafeState(),that.videoService.autoreleaseTimeout&&$interval.cancel(that.videoService.autoreleaseTimeout)}))})).catch((function(error){$log.info("[VideoServiceEventHandler]   | sendProposition failure : "+JSON.stringify({error:error.message})),that.videoService.makingCall=!1,mediaToGet.indexOf("sharing")>=0||-1===error.toString().indexOf("getUserMedia")||that.videoService.openErrorPopup(),that.videoService.removeCallObject(call),that.videoService.isUserContactInCall()||that.videoService.resetToSafeState()}))},VideoServiceEventHandler.prototype.retractProposition=function(call){$log.info("[VideoServiceEventHandler]   | retractProposition for call "+call.id);var idRetract="web_"+uuid__WEBPACK_IMPORTED_MODULE_1__(),xmppMessage=$msg({from:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.fullJid,to:call.contact.jid,id:idRetract}).c("retract",{xmlns:this.nameSpace,id:call.id});_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.send(xmppMessage),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState(),this.videoService.removeCallObject(call)},VideoServiceEventHandler.prototype.acceptProposition=function(call,type){if(call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ANSWERING){$log.info("[VideoServiceEventHandler]   | acceptProposition for call "+call.id),call.status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ANSWERING;var idAccept="web_"+uuid__WEBPACK_IMPORTED_MODULE_1__(),xmppMessage=$msg({from:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.fullJid,to:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.jid,id:idAccept}).c("accept",{xmlns:this.nameSpace,id:call.id});_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.send(xmppMessage);var idProceed="web_"+uuid__WEBPACK_IMPORTED_MODULE_1__();xmppMessage=$msg({from:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.fullJid,to:call.fullJid,id:idProceed}).c("proceed",{xmlns:this.nameSpace,id:call.id}),call.unifiedPlanActivated&&(xmppMessage=xmppMessage.c("unifiedplan",{xmlns:"urn:xmpp:jingle:apps:jsep:1"}).up(),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.connection.jingle.jid2session[call.fullJid]={unifiedPlan:!0}),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.send(xmppMessage);var mediaToGet=["audio"];type&&"video"===type&&mediaToGet.push("video"),call.remoteMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.VIDEO&&(mediaToGet=["video"]),call.remoteMedia===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.SHARING&&(mediaToGet=[]),this.setLocalTypeMedia(mediaToGet,call),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.setBusyState("dnd",this.videoService.calculatePresenceMessage(call)),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call);var that=this;that.videoService.autoreleaseTimeout&&$interval.cancel(that.videoService.autoreleaseTimeout),that.videoService.autoreleaseTimeout=$interval((function(_call){_call&&(null!==call.getMediaPillarCall()?$log.warn("[webrtcgateway/VideoServiceEventHandler] | acceptProposition autoreleaseTimeout after 45 s : remove the call :"+_call.id):$log.webrtc("[VideoServiceEventHandler] | acceptProposition autoreleaseTimeout after 45 s : remove the call "+_call.id),that.videoService.removeCallObject(_call),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState())}),45e3,1,!0,call)}else $log.warn("[VideoServiceEventHandler]   | acceptProposition for call "+call.id+" -- ignored! Already answering")},VideoServiceEventHandler.prototype.rejectProposition=function(call,__reason){$log.info("[VideoServiceEventHandler]   | rejectProposition for call "+call.id);var idRejectToMe="web_"+uuid__WEBPACK_IMPORTED_MODULE_1__(),xmppMessage=$msg({from:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.fullJid,to:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.jid,id:idRejectToMe}).c("reject",{xmlns:this.nameSpace,id:call.id});_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.send(xmppMessage);var mediaPillarContext=call.getMediaPillarCall(),otherJid=mediaPillarContext&&mediaPillarContext.mediaPillarJid?mediaPillarContext.mediaPillarJid:call.contact.jid,idRejectToDistant="web_"+uuid__WEBPACK_IMPORTED_MODULE_1__();otherJid?(xmppMessage=$msg({from:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.fullJid,to:otherJid,id:idRejectToDistant}).c("reject",{xmlns:this.nameSpace,id:call.id,reason:__reason}),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.send(xmppMessage)):$log.error("[VideoServiceEventHandler] | rejectProposition -- missing other JID !"),call&&(call.status=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN,delete this.videoService.calls[call.id],$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)),this.videoService.setWebrtcConfiguration(),this.videoService.autoreleaseTimeout&&$interval.cancel(this.videoService.autoreleaseTimeout)},VideoServiceEventHandler.prototype.onMessageReceived=function(stanza){var that=this;try{$rootScope.$apply((function(){$log.info("[VideoServiceEventHandler]   | onMessageReceived");var temp=$(stanza);temp.find("error").length>0||temp.find("delay").length>0||$(stanza).find("service-unavailable").length>0?that.onMessageReceivedError():temp.find("propose").length>0?that.onPropositionReceived(stanza):temp.find("retract").length>0?that.onRetractReceived(stanza):temp.find("reject").length>0?that.onRejectReceived(stanza):temp.find("accept").length>0?that.onAcceptReceived(stanza):temp.find("proceed").length>0&&that.onProceedReceived(stanza)}))}catch(error){return $log.error("[VideoServiceEventHandler]   | onMessageReceived error "+error),!0}return!0},VideoServiceEventHandler.prototype.onMessageReceivedError=function(stanza){$log.info("[VideoServiceEventHandler]   | onMessageReceivedError");var id=$(stanza).find("propose").attr("id"),call=this.videoService.calls[id];call&&$log.error("[VideoServiceEventHandler]   | onMessageReceivedError call is in "+call.status.value+" state")},VideoServiceEventHandler.prototype.getOrCreateContact=function(jid,stanza){if(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.isMediaPillarJid(jid)){$log.info("[VideoServiceEventHandler]   | getOrCreateContact for mediapillar jid "+jid);var mediapillarNode=$(stanza).find("mediapillar");if(mediapillarNode){var contact,callernumberNode=mediapillarNode.find("callernumber"),callernumber=callernumberNode?callernumberNode.text():void 0,displaynameNode=mediapillarNode.find("displayname"),displayname=displaynameNode?displaynameNode.text():void 0;$log.info("[VideoServiceEventHandler]   | getOrCreateContact MP for jid "+jid+" callernumber: "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4___default()(callernumber)+" displayname: "+_src_utils_anonymizer__WEBPACK_IMPORTED_MODULE_4___default()(displayname));var foundContactByNumber=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getContactByPhoneNumber(callernumber);return foundContactByNumber?contact=foundContactByNumber:(contact=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.createBasicContact(null,callernumber),displayname&&(contact.displayName=displayname)),$q.resolve(contact)}return _src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact(jid)}return $log.info("[VideoServiceEventHandler]   | getOrCreateContact for jid "+jid),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getOrCreateContact(jid)},VideoServiceEventHandler.prototype.onPropositionReceived=function(stanza){var id=$(stanza).find("propose").attr("id");$log.info("[VideoServiceEventHandler]   | onPropositionReceived for ID "+id);var call=this.videoService.calls[id],that=this;if(call){if($(stanza).find("subject").length>0){var subject=$(stanza).find("subject")[0];$log.debug("[VideoServiceEventHandler]   | onPropositionReceived subject Detected: "+subject.textContent),call.setSubject(subject.textContent)}call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_INCOMMING),that.videoService.config&&that.videoService.config.unifiedPlan&&(call.unifiedPlanActivated=!0),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3___default.a.FeaturesEnum.WEBRTC_UNIFIED_PLAN)&&$(stanza).find("unifiedplan").length&&(call.unifiedPlanActivated=!0),remoteMedia=[];for(var length=$(stanza).find("description").length,i=0;i<length;i++){var description=$(stanza).find("description")[i];remoteMedia.push($(description).attr("media"))}this.setRemoteTypeMedia(remoteMedia,call),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),that.videoService.autoreleaseTimeout&&$interval.cancel(that.videoService.autoreleaseTimeout),that.videoService.autoreleaseTimeout=$interval((function(_call){_call&&($log.webrtc("[VideoServiceEventHandler]   | onPropositionReceived autoreleaseTimeout after 2 min : remove the call "+_call.id),that.videoService.removeCallObject(_call))}),12e4,1,!0,call)}else{var jid=$(stanza).attr("from"),remoteMedia=[],peerJid=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.getBareJidFromJid(jid);(call=_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.create(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN,id,_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Type.WEBRTC)).fullJid=jid,that.videoService.calls[call.id]=call,that.videoService.config&&that.videoService.config.unifiedPlan&&(call.unifiedPlanActivated=!0),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_3___default.a.FeaturesEnum.WEBRTC_UNIFIED_PLAN)&&$(stanza).find("unifiedplan").length&&(call.unifiedPlanActivated=!0),that.getOrCreateContact(peerJid,stanza).then((function(contact){for(var length=$(stanza).find("description").length,i=0;i<length;i++){var description=$(stanza).find("description")[i];remoteMedia.push($(description).attr("media"))}if(that.videoService.calls[call.id]){if(call.contact=contact,$(stanza).find("subject").length>0){var subject=$(stanza).find("subject")[0];$log.debug("[VideoServiceEventHandler]   | onPropositionReceived subject Detected: "+subject.textContent),call.setSubject(subject.textContent)}call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_INCOMMING),that.setRemoteTypeMedia(remoteMedia,call),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),that.videoService.autoreleaseTimeout&&$interval.cancel(that.videoService.autoreleaseTimeout),that.videoService.autoreleaseTimeout=$interval((function(_call){_call&&($log.webrtc("[VideoServiceEventHandler]   | onPropositionReceived autoreleaseTimeout after 2 min : remove the call "+_call.id),that.videoService.removeCallObject(_call))}),12e4,1,!0,call)}})).catch((function(error){$log.error("[VideoServiceEventHandler]   | onPropositionReceived error "+error),that.videoService.removeCallObject(call)}))}},VideoServiceEventHandler.prototype.onRetractReceived=function(stanza){$log.info("[VideoServiceEventHandler]   | onRetractReceveid");var id=$(stanza).find("retract").attr("id"),call=this.videoService.calls[id];call&&(call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ANSWERING&&_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState(),this.videoService.removeCallObject(call)),this.videoService.autoreleaseTimeout&&$interval.cancel(this.videoService.autoreleaseTimeout)},VideoServiceEventHandler.prototype.onRejectReceived=function(stanza){$log.info("[VideoServiceEventHandler]   | onRejectReceived");var id=$(stanza).find("reject").attr("id"),call=this.videoService.calls[id],fullJid=$(stanza).attr("from"),calendarBusy="calendarBusy"===$(stanza).find("reject").attr("reason");this.videoService.autoreleaseTimeout&&$interval.cancel(this.videoService.autoreleaseTimeout),call&&(call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RINGING_INCOMMING&&(null!==call.getMediaPillarCall()&&$rootScope.$broadcast("ON_MEDIAPILLAR_CALL_REMOTE_CTRL_EVENT",call),this.videoService.removeCallObject(call)),call.status===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.DIALING&&(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState(),this.videoService.removeCallObject(call)),call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE&&call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.CONNECTING||call.fullJid&&call.fullJid===fullJid&&(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState(),this.videoService.removeCallObject(call))),calendarBusy&&this.videoService.openCalendarBusyPopup(call.contact.id)},VideoServiceEventHandler.prototype.onAcceptReceived=function(stanza){$log.info("[VideoServiceEventHandler]   | onAcceptReceived");var id=$(stanza).find("accept").attr("id"),call=this.videoService.calls[id],fullJid=$(stanza).attr("from");call&&fullJid!==_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.fullJid&&(null!==call.getMediaPillarCall()&&$rootScope.$broadcast("ON_MEDIAPILLAR_CALL_REMOTE_CTRL_EVENT",call),this.videoService.removeCallObject(call)),fullJid!==_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.userContact.fullJid&&this.videoService.autoreleaseTimeout&&$interval.cancel(this.videoService.autoreleaseTimeout)},VideoServiceEventHandler.prototype.onProceedReceived=function(stanza){$log.info("[VideoServiceEventHandler]   | onProceedReceived"),this.videoService.autoreleaseTimeout&&$interval.cancel(this.videoService.autoreleaseTimeout);var id=$(stanza).find("proceed").attr("id"),call=this.videoService.calls[id],fullJid=$(stanza).attr("from");if(call.fullJid=fullJid,this.videoService.config&&this.videoService.config.unifiedPlan&&(call.unifiedPlanActivated=!0),$(stanza).find("unifiedplan").length&&(call.unifiedPlanActivated=!0),call.isInConversationWithMobile()&&call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.VIDEO){var that=this,mediaToGet=[],mediaConstraints=that.videoService.getMobileMediaConstraints("video");mediaToGet=["audio","video"],call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO||(mediaToGet=["video"]),that.videoService.getBrowserMedia(mediaToGet,mediaConstraints.fixedVideoWidth,mediaConstraints.fixedVideoHeight,mediaConstraints.fixedFrameRate).then((function(stream){$log.info("[VideoServiceEventHandler]   | onProceedReceived --\x3e renegociate video quality"),call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.VIDEO&&that.videoService.stopActiveAudioVideoStreams(null,!0),that.videoService.localStreams.push(stream),that.videoService.makeJingleCall(call)})).catch((function(error){$log.info("[VideoServiceEventHandler]   | onProceedReceived "+call+" failure : "+error.message),-1!==error.toString().indexOf("getUserMedia")?($log.info("onProceedReceived impossible, no webcam plugged"),that.videoService.openErrorPopup()):(that.videoService.releaseCall(call),that.videoService.resetToSafeState())}))}else call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.SHARING?this.videoService.makeJingleSharingCall(call):this.videoService.makeJingleCall(call)},VideoServiceEventHandler.prototype.incomingCall=function(callId){$log.info("[VideoServiceEventHandler] incomingCall "+callId);var that=this,call=null,sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.connection.jingle.sessions[callId];if(sess&&sess.peerjid){var peerJid=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.getBareJidFromJid(sess.peerjid),contact=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.getContactByJid(peerJid);(call=this.videoService.calls[callId])||(call=this.videoService.getCallByJid(contact.jid,sess.peerjid))}call?(sess.sendRinging(),$interval((function(_call){that.videoService.answerJingleCall(_call)}),350,1,!0,call),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),this.videoService.autoreleaseTimeout&&$interval.cancel(this.videoService.autoreleaseTimeout),this.videoService.statsInterval&&($log.info("[VideoServiceEventHandler] remove getStats interval"),window.clearInterval(this.videoService.statsInterval),this.videoService.statsinterval=null),that.videoService.createOrUpdateStatisticsForCall(call.id),$log.info("[VideoServiceEventHandler] start getStats interval"),this.videoService.statsInterval=sess.getStats(3e3)):($log.warn("[VideoServiceEventHandler] incomingCall no such call ! Terminate the session "),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState(),sess&&sess.terminate())},VideoServiceEventHandler.prototype.activeCall=function(callId){$log.info("[VideoServiceEventHandler] activeCall "+callId);var sess=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.connection.jingle.sessions[callId];this.videoService.autoreleaseTimeout&&$interval.cancel(this.videoService.autoreleaseTimeout);var call=this.videoService.calls[callId];this.videoService.updateRemoteTypeMedia(sess.remoteType,call),call&&call.status.key!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.RELEASING.key&&call.status.key!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN.key&&(call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),call.startDuration(),this.videoService.attachDistantMediaStreams(!0,call)),call.isInitiator&&gaService.trackCallSuccessNumber(sess.localType)},VideoServiceEventHandler.prototype.terminatedCall=function(callId,callReason,doNotUpdatePresence){0===Object.keys(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.connection.jingle.sessions).length&&$log.webrtc("INFO    | all calls terminated");var call=this.videoService.calls[callId];call||0===this.videoService.calls.length?("busy"===callReason&&this.videoService.openErrorPopup("remoteUserNoMoreAvailable"),this.videoService.autoreleaseTimeout&&$interval.cancel(this.videoService.autoreleaseTimeout),this.videoService.disableAudioVideoMedia(null,callId),this.videoService.createOrUpdateStatisticsForCall(callId),this.videoService.callsStats[callId]&&delete this.videoService.callsStats[callId],call&&("cancel"!==callReason&&gaService.trackCallDuration((new Date).getTime()-call.startDate.getTime()),this.videoService.removeCallObject(call)),doNotUpdatePresence||$interval((function(){_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState()}),1e3,1,!0),this.videoService.statsInterval&&(window.clearInterval(this.videoService.statsInterval),this.videoService.statsinterval=null),this.videoService.displayWebRTCStats(callId),this.videoService.isUserContactInCall()||this.videoService.clearSrcObjectsFromElements()):$log.webrtc("INFO    | terminatedCall : no call with "+callId+" exists.")},VideoServiceEventHandler.prototype.onJingleError=function(sid){sid&&this.videoService.calls[sid]&&this.videoService.calls[sid].status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE&&(this.videoService.removeCallObject(this.calls[sid]),this.videoService.resetToSafeState(),this.videoService.openErrorPopup("IceConnectionFailed"))},VideoServiceEventHandler.prototype.iceConnectionStateChange=function(sid,sess){$log.info("[VideoServiceEventHandler] iceConnectionStateChange for "+sid);var that=this,activeCall=null,call=that.videoService.calls[sess.sid];try{if(sess.peerconnection&&"stable"===sess.peerconnection.signalingState&&"connected"===sess.peerconnection.iceConnectionState){$log.webrtc("INFO    | ICE Connection established successfully"),angular.element("#globalAudioTag")[0]&&$log.info("[VideoServiceEventHandler] sinkId for globalAudioTag is "+angular.element("#globalAudioTag")[0].sinkId),that.videoService.reconnectCall=!1,(activeCall=that.videoService.calls[sid])&&activeCall.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE&&($log.webrtc("INFO    | ICE Connection : call is active now !"),this.activeCall(sid)),sess.isRenegotiating&&($log.webrtc("INFO    | Renegotiating done"),sess.isRenegotiating=!1,$rootScope.$broadcast("ON_WEBRTC_CALL_ESCALATION",activeCall),$rootScope.$broadcast("ON_WEBRTC_CALL_ESCALATION_SUCCESS",activeCall)),sess.autoReconnectTimer&&($interval.cancel(sess.autoReconnectTimer),sess.autoReconnectTimer=null),gaService.endNegotiationTime();var negotiationTime=gaService.negotiationTime();negotiationTime&&($log.webrtc("INFO    | negotiation time: "+negotiationTime+"ms"),gaService.trackNegotiationTime()),activeCall&&activeCall.isInitiator&&gaService.trackICESuccess(sid)}sess.peerconnection&&"stable"===sess.peerconnection.signalingState&&"completed"===sess.peerconnection.iceConnectionState&&($log.webrtc("INFO    | ICE Connection completed successfully"),that.videoService.reconnectCall=!1,(activeCall=that.videoService.calls[sid])&&activeCall.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE&&($log.webrtc("INFO    | ICE Connection : call is active now !"),this.activeCall(sid)),sess.isRenegotiating&&($log.webrtc("INFO    | Renegotiating done"),sess.isRenegotiating=!1,$rootScope.$broadcast("ON_WEBRTC_CALL_ESCALATION",activeCall),$rootScope.$broadcast("ON_WEBRTC_CALL_ESCALATION_SUCCESS",activeCall))),sess.peerconnection&&"stable"===sess.peerconnection.signalingState&&"disconnected"===sess.peerconnection.iceConnectionState&&($log.webrtc("INFO    | signalingState disconnected"),call&&call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN&&($log.webrtc("INFO    | iceConnectionStateChange go to connecting state"),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.CONNECTING),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call)),that.videoService.connected||(that.videoService.reconnectCall=!0),sess.autoReconnectTimer||(console.error("arm autoReconnectTimer"),sess.autoReconnectTimer=$interval((function(session){console.error("autoReconnectTimer -- execute"),that.videoService.connected&&(console.error("autoReconnectTimer -- network OK, proceed with reconnect"),session.reconnectSession())}),1e3,1,!0,sess))),sess.peerconnection&&"stable"===sess.peerconnection.signalingState&&"failed"===sess.peerconnection.iceConnectionState&&($log.webrtc("INFO    | signalingState FAILED"),call&&call.status!==_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.UNKNOWN&&($log.webrtc("INFO    | iceConnectionStateChange go to connecting state"),call.setStatus(_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.CONNECTING),$rootScope.$broadcast("ON_CALL_UPDATED_EVENT",call),$rootScope.$broadcast("ON_RECORDING_CNXLOST_EVENT")),that.videoService.connected||(that.videoService.reconnectCall=!0),that.videoService.connected&&(console.error("[videoServiceEventHandler] signalingState FAILED -- network OK, proceed with reconnect"),sess.reconnectSession()))}catch(error){try{$log.error("JINGLE  | iceconnectionstatechange error "+error),call?that.videoService.removeCallObject(call,"unsupported-applications"):_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.connection.jingle.terminate(null,"unsupported-applications"),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState()}catch(err){$log.error("JINGLE  | iceconnectionstatechange error "+err),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.resetBusyState()}}},VideoServiceEventHandler.prototype.mediaModified=function(sid,mediaType){$log.info("[VideoServiceEventHandler] mediaModified "+sid);var call=this.videoService.calls[sid];_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.connection.jingle.sessions[sid].isRenegotiating=!0,call.remoteMedia="sharing"===mediaType?_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.SHARING:"video"===mediaType?_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.VIDEO:"sharing+video"===mediaType?_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.VIDEO|_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.SHARING:_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_5___default.a.setBusyState("dnd",this.videoService.calculatePresenceMessage(call)),$rootScope.$broadcast("ON_WEBRTC_CALL_ESCALATION",call)},VideoServiceEventHandler}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_models_call_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2__),uuid__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(27);angular.module("rainbow").service("webrtcServiceEventHandler",["$log","$q","$rootScope","videoService","webConferenceService",function($log,$q,$rootScope,videoService,webConferenceService){var service=this;this.nameSpace="urn:xmpp:jingle-message:0",this.messageHandlerRef=null,this.started=!1,this.start=function(){return this.started=!0,this.attachHandlers(),$q.when()},this.stop=function(){return this.started=!1,service.removeHandlers(),$q.when()},this.attachHandlers=function(){this.removeHandlers(),$log.info("[webrtcServiceEventHandler] attachHandlers"),this.messageHandlerRef||(this.messageHandlerRef=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.addHandler((function(stanza){try{return service.onMessageReceived(stanza),!0}catch(err){return $log.error("[webrtcServiceEventHandler] caught error "+err),!0}}),service.nameSpace,"message"))},this.removeHandlers=function(){$log.info("[webrtcServiceEventHandler] removeHandlers"),this.messageHandlerRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null)},this.onMessageReceived=function(stanza){var fromJid=$(stanza).attr("from"),bareJid=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.getBareJidFromJid(fromJid),conferenceSessionId=$(stanza).find("propose").find("conference").attr("id");if(webConferenceService.getConferenceSessionById(conferenceSessionId))try{if($log.info("[webrtcServiceEventHandler]   | onMessageReceived"),$(stanza).find("propose").length>0){var id=$(stanza).find("propose").attr("id"),xmppMessage=$msg({from:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.userContact.fullJid,to:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.userContact.jid}).c("accept",{xmlns:this.nameSpace,id:id});return _src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.send(xmppMessage),xmppMessage=$msg({from:_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.userContact.fullJid,to:bareJid}).c("proceed",{xmlns:this.nameSpace,id:id}),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.send(xmppMessage),!0}}catch(error){return videoService.videoEventHandler.onMessageReceived(stanza)}return videoService.videoEventHandler.onMessageReceived(stanza)},this.checkSessionAudioSentHealthStatus=function(sid){$log.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- 0 audio packets sent !");var call=videoService.calls[sid];if(call&&!call.isInCallWithMediaPillar()){if(call.status.key===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE.key&&call.localMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO&&!call.isMuted){if(videoService.callsStatsSimplified[sid].numberOfErrorAudioSent+=1,videoService.callsStatsSimplified[sid].numberOfErrorAudioSent%2)return void $log.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- ingore");var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.jingle.sessions[call.id];session&&!session.isRenegotiating&&($log.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- renego P2P call"),videoService.renegotiateCurrentCall(call)),$rootScope.$broadcast("ON_WEBRTC_CALL_AUDIO_ISSUE",!0)}}else{var confSession=webConferenceService.getActiveConferenceSession();if(confSession&&confSession.id&&confSession.active&&"connected"===confSession.status){var audioSession=webConferenceService.getRemoteAudioSession(confSession.id);if(audioSession&&audioSession.sid===sid){if(videoService.callsStatsSimplified[sid].numberOfErrorAudioSent+=1,videoService.callsStatsSimplified[sid].numberOfErrorAudioSent%2)return void $log.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- ingore");$log.info("[webrtcServiceEventHandler]   | checkSessionAudioSentHealthStatus --- renego SFU conference"),webConferenceService.onAudioProfileChangeEvent()}}}},this.checkSessionAudioReceivedHealthStatus=function(sid){$log.info("[webrtcServiceEventHandler]   | checkSessionAudioReceivedHealthStatus --- user hears nothing !");var call=videoService.calls[sid];if(call&&!call.isInCallWithMediaPillar())call.status.key===_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Status.ACTIVE.key&&call.remoteMedia&_src_models_call_model__WEBPACK_IMPORTED_MODULE_0__.Call.Media.AUDIO&&(videoService.callsStatsSimplified[sid].errorAudioReceived=1,$log.info("[webrtcServiceEventHandler]   | checkSessionAudioReceivedHealthStatus --- reset output device"),videoService.resetAudioOutputElement());else{var confSession=webConferenceService.getActiveConferenceSession();if(confSession&&confSession.id&&confSession.active&&"connected"===confSession.status){var audioSession=webConferenceService.getRemoteAudioSession(confSession.id);audioSession&&audioSession.sid===sid&&(videoService.callsStatsSimplified[sid].errorAudioReceived=1,$log.info("[webrtcServiceEventHandler]   | checkSessionAudioReceivedHealthStatus --- renego SFU conference"),videoService.resetAudioOutputElement())}}},angular.element(document).bind("callincoming.jingle",(function(__event,sessId){$log.webrtc("webrtcServiceEventHandler  | callincoming.jingle "+sessId);var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.jingle.sessions[sessId];session&&session.confId?webConferenceService.onIncomingCall(sessId):videoService.videoEventHandler.incomingCall(sessId)})),angular.element(document).bind("callterminated.jingle",(function(__event,sessId,reason){$rootScope.$apply((function(){var callReason=reason||"";if($log.webrtc("webrtcServiceEventHandler  | callterminated "+sessId+" reason: "+callReason),"multi-device"===reason)webConferenceService.onConferenceCallSwitched(sessId);else if(videoService.calls[sessId]){var hasActiveConference=webConferenceService.hasActiveConferenceSession();videoService.videoEventHandler.terminatedCall(sessId,callReason,hasActiveConference)}else webConferenceService.onTerminatedCall(sessId)}))})),angular.element(document).bind("iceconnectionstatechange.jingle",(function(__event,sid,sess){sess.peerconnection?($log.webrtc("JINGLE  | iceconnectionstatechange "+sid+" "+sess.peerconnection.iceConnectionState+"|"+sess.peerconnection.signalingState),videoService.calls[sid]?videoService.videoEventHandler.iceConnectionStateChange(sid,sess):webConferenceService.onIceConnectionStateChange(sid,sess)):$log.webrtc("JINGLE  | iceconnectionstatechange - peerConnection does not exist anymore !!!")})),angular.element(document).bind("error.jingle",(function(__event,obj){$log.error("JINGLE  | callerror"),obj&&obj.error&&$log.error(JSON.stringify(obj.error));var sid=obj.sid;sid&&(videoService.calls[sid]?videoService.videoEventHandler.onJingleError(sid):webConferenceService.onJingleError(sid))})),angular.element(document).bind("webrtcSessionBitRate.jingle",(function(__event,sid,data){videoService.config&&videoService.config.debugWeRTC&&$rootScope.$broadcast("ON_WEBRTC_CALL_BITRATE",sid,data)})),angular.element(document).bind("webrtcSessionStatsSimplyfied.jingle",(function(__event,sid,data){if(videoService.callsStatsSimplified[sid]||(videoService.callsStatsSimplified[sid]={},videoService.callsStatsSimplified[sid].errorAudioReceived=0),data.errorAudioReceived=videoService.callsStatsSimplified[sid].errorAudioReceived,data.networkQualityIteration=videoService.callsStatsSimplified[sid].networkQualityIteration,data.conferenceId){if(data.publisherId&&data.conferenceId)if(videoService.callsStatsSimplified[sid].publisherJidIm)data.publisherJidIm=videoService.callsStatsSimplified[sid].publisherJidIm;else{var confSession=webConferenceService.conferenceSessions[data.conferenceId];if(confSession){var publisher=confSession.getPublisherById(data.publisherId);data.publisherJidIm=publisher?publisher.jid_im:"",videoService.callsStatsSimplified[sid].publisherJidIm=data.publisherJidIm}}$log.info("[videoService] on webrtcSessionStatsSimplyfied for session "+sid+" related to conferenceID "+data.conferenceId+" : "+JSON.stringify(data))}else $log.info("[videoService] on webrtcSessionStatsSimplyfied for session "+sid+" : "+JSON.stringify(data));videoService.callsStatsSimplified[sid]=data,data.packetsAudioReceived&&0===data.audioOutputLevel&&0===data.errorAudioReceived&&service.checkSessionAudioReceivedHealthStatus(sid);var call=videoService.calls[sid];call?(videoService.callsStatsSimplified[sid].networkQualityFlag===call.networkQuality?(videoService.callsStatsSimplified[sid].networkQualityIteration=videoService.callsStatsSimplified[sid].networkQualityIteration?videoService.callsStatsSimplified[sid].networkQualityIteration+1:1,0===call.networkQuality&&videoService.callsStatsSimplified[sid].networkQualityIteration>=3&&call.publish("badNetworkQuality",call.networkQuality)):videoService.callsStatsSimplified[sid].networkQualityIteration=1,call.networkQuality=data.networkQualityFlag,call.publish("networkQuality",call.networkQuality)):webConferenceService.onNetworkQualityChange(sid)})),angular.element(document).bind("refer.jingle",(function(__event,sid,status,confEndpointId,referTo){$log.webrtc("JINGLE  | refer: "+sid+" - status: "+status+" - confEndpointId: "+confEndpointId+" - referTo: "+referTo);var session=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_1___default.a.connection.jingle.sessions[sid];if("complete"===status){var _call18=videoService.calls[sid];videoService.onCallTransferredToConference(_call18)}else session?webConferenceService.transferCall(session,referTo,confEndpointId,"web_"+uuid__WEBPACK_IMPORTED_MODULE_3__(),webConferenceService.MEDIATYPE.WEBRTC).then((function(confSession){videoService.sendReferStatus(sid,"complete")})):$log.error("JINGLE  | refer.jingle -- no session ")}))}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var crypto_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26),_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2__),_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(31),_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_3__),_src_services_core_country_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(64),_src_services_core_country_service__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_src_services_core_country_service__WEBPACK_IMPORTED_MODULE_4__),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_6__),_src_models_company_model__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(19);angular.module("rainbow").service("companyDirectoryService",["$rootScope","$q","$log","$http","errorHelperService","centralizedService","directoryContact",function($rootScope,$q,$log,$http,errorHelperService,centralizedService,directoryContact){var service=this,listeners=[];service.companies=[],service.start=function(stats){$log.info(""),$log.info("[companyDirectoryService] === STARTING ===");var startDate=performance.now();service.portalURL=config.restServerUrl+"/api/rainbow/directory/v1.0/";var startDuration=Math.round(performance.now()-startDate);return stats.push({service:"companyDirectoryService",startDuration:startDuration}),$log.info("[companyDirectoryService] === STARTED ("+startDuration+" ms) ==="),$q.when()},service.stop=function(){var listener;for($log.info(""),$log.info("[companyDirectoryService] === STOPPING ===");listener=listeners.pop();)listener();return $log.info("[companyDirectoryService] === STOPPED ==="),$q.when()},service.getDirectoryContacts=function(companyId,page,pageSize,searchPattern,searchBy,format){return $q((function(resolve,reject){var url=service.portalURL+"entries?format="+(format||"full");if(url+="&companyId="+companyId,url+="&limit="+pageSize,page&&(url+="&offset="+pageSize*(page-1)),searchPattern)switch(searchBy){case"phoneNumbers":case"tags":url+="&"+searchBy+"="+encodeURIComponent(searchPattern);break;case"name":default:url+="&name="+encodeURIComponent(searchPattern)}$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[companyDirectoryService] getDirectoryContacts success (found "+response.data.total+" contact(s))");var data=response.data.data,contacts=[];data.forEach((function(contactData){var contact=directoryContact(contactData);contacts.push(contact)})),resolve({contacts:contacts,limit:response.data.limit,offset:response.data.offset,total:response.data.total})}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"getDirectoryContacts"))}))}))},service.createDirectoryContact=function(entry){return $q((function(resolve,reject){$http({method:"POST",url:service.portalURL+"entries",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:entry}).then((function(response){var contact=directoryContact(response.data.data);$log.info("[companyDirectoryService] createDirectoryContact success"),$rootScope.$broadcast("ADMIN_DIRECTORY_CHANGE",contact),resolve(contact)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"createDirectoryContact"))}))}))},service.getDirectoryContact=function(id,format){return $q((function(resolve,reject){var url=service.portalURL+"entries/"+id+"?format="+(format||"full");$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[companyDirectoryService] getDirectoryContact success");var contact=directoryContact(response.data.data);resolve(contact)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"getDirectoryContact"))}))}))},service.updateDirectoryContact=function(entry){return $q((function(resolve,reject){$http({method:"PUT",url:service.portalURL+"entries/"+entry.id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:entry}).then((function(response){var contact=directoryContact(response.data.data);$log.info("[companyDirectoryService] updateDirectoryContact success"),$rootScope.$broadcast("ADMIN_DIRECTORY_CHANGE",contact),resolve(contact)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"updateDirectoryContact"))}))}))},service.deleteDirectoryContact=function(id){return $q((function(resolve,reject){$http({method:"DELETE",url:service.portalURL+"entries/"+id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[companyDirectoryService] deleteDirectoryContact success"),$rootScope.$broadcast("ADMIN_DIRECTORY_CHANGE"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"deleteDirectoryContact"))}))}))},service.getTags=function(companyId){return $q((function(resolve,reject){var url=service.portalURL+"entries/tags";companyId&&(url+="?companyId="+companyId),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[companyDirectoryService] getTags success"),resolve(response.data.data)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"getTags"))}))}))},service.getTagsStats=function(companyId){return $q((function(resolve,reject){var url=service.portalURL+"entries/tags/stats";companyId&&(url+="?companyId="+companyId),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var tagsStats=response.data.data.stats||[];$log.info("[companyDirectoryService] getTagsStats success (find "+tagsStats.length+"tags(s))"),resolve(tagsStats)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"getTagsStats"))}))}))},service.renameTag=function(tag,newTagName,companyId){return $q((function(resolve,reject){var url=service.portalURL+"entries/tags?tag="+encodeURIComponent(tag);companyId&&(url+="&companyId="+companyId),$http({method:"PUT",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:{newTagName:newTagName}}).then((function(response){$log.info("[companyDirectoryService] renameTag success => old tag: "+tag+" => new tag: "+newTagName+": found "+response.data.data.found+" occurence(s)"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"renameTag"))}))}))},service.deleteTag=function(tag,companyId){return $q((function(resolve,reject){var url=service.portalURL+"entries/tags?tag="+encodeURIComponent(tag);companyId&&(url+="&companyId="+companyId),$http({method:"DELETE",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[companyDirectoryService] deleteTag success (tag "+tag+": found "+response.data.data.found+" occurence(s)"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"deleteTag"))}))}))},service.search=function(searchPattern,companyId){return $q((function(resolve){var searchType=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_5___default.a.FeaturesEnum.SEARCH_BY_TAGS)?"search=":"name=",url=service.portalURL+"entries?format=full&"+searchType+encodeURIComponent(searchPattern);companyId&&(url+="&companyId="+companyId),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var companyContacts=response.data.data.map((function(contactData){return service.createAndUpdateContact(contactData)}));$log.info("[companyDirectoryService] search success "+companyContacts.length),resolve(companyContacts)}),(function(response){resolve([]),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"search"))}))}))},service.searchCompanies=function(searchPattern,companyId){return $q((function(resolve){var url=service.portalURL+"entries?format=full&companyName="+encodeURIComponent(searchPattern);companyId&&(url+="&companyId="+companyId),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[companyDirectoryService] searchCompanies success");var companies=response.data.data.map((function(directoryCompanyData){var company=_src_models_company_model__WEBPACK_IMPORTED_MODULE_7__.Company.create(directoryCompanyData.id,directoryCompanyData.companyName);return company.country=directoryCompanyData.country,service.getCompanyLogo(company),service.getCompanyBanner(company),service.companies[company.id]=company,company}));resolve(companies)}),(function(response){resolve([]),$log.error("[companyDirectoryService] "+errorHelperService.getErrorFullMessage(response,"searchCompanies"))}))}))},service.getCompanyLogo=function(company){return $q((function(resolve){var companyColor=_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_3___default.a.computeUserColor(company.name),companyInitials=company.name.substr(0,1);company.logo=_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_3___default.a.getAvatarImage(company.id,companyInitials,companyColor.color,130,company.lastAvatarUpdateDate),$rootScope.$broadcast("ON_COMPANY_LOGO_UPDATED",company.id),$log.info("[companyService] getCompanyLogo - "+company.getNameForLogs()+" - success"),company.sendChangeEvent("logo"),resolve(company)}))},service.getCompanyBanner=function(company){return $q((function(resolve){var image=new Image;image.onload=function(){company.banner=image,$rootScope.$broadcast("ON_COMPANY_BANNER_UPDATED",company.id),$log.info("[getCompanyBanner] - "+company.getNameForLogs()+" - success"),resolve(company)},image.onerror=function(){$log.error("[companyService] Load banner for "+company.getNameForLogs()+" failure"),resolve(company)};var imgSrc=window.rainbowSDK?null:"/cacheV2/images/company-banner-01.svg";if(company.lastBannerUpdateDate){var serverURL=config.webservices.protocol+"://"+config.webservices.currentServer;_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2___default.a.cdn&&(serverURL=_src_services_core_main_service__WEBPACK_IMPORTED_MODULE_2___default.a.cdnServer),imgSrc=serverURL+"/api/banner/"+company.id+"?size=831",imgSrc+="&update="+Object(crypto_js__WEBPACK_IMPORTED_MODULE_0__.MD5)(crypto_js__WEBPACK_IMPORTED_MODULE_0__.enc.Latin1.parse(company.lastBannerUpdateDate)).toString(crypto_js__WEBPACK_IMPORTED_MODULE_0__.enc.Hex)}image.src=imgSrc}))},service.getCompanyById=function(companyId){if(!companyId)throw new Error("missing companyId");var company=service.companies[companyId];return $log.info("[companyDirectoryService] getCompanyById (cache) "+companyId+" - success"),company},service.createAndUpdateContact=function(contactData){var contact=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_6___default.a.createBasicContact(contactData.id,null,!1);return contact.mobilePhones=contactData.mobilePhoneNumbers,contact.businessPhones=contactData.workPhoneNumbers,contact.email=contactData.eMail,contact.updateName(contactData.firstName,contactData.lastName),contact.getAvatar(),contact.companyDirectoryFlag=!0,contact.businessCompanyId=contactData.companyId,contact.companyName=contactData.companyName,contact.note1=contactData.custom1,contact.note2=contactData.custom2,contact.department=contactData.department,contact.jobTitle=contactData.jobTitle,contact.otherPhoneNumbers=contactData.otherPhoneNumbers,contact.tags=contactData.tags?contactData.tags:void 0,contact.city=contactData.city,contact.postalCode=contactData.postalCode,contact.street=contactData.street,contact.state=_src_services_core_country_service__WEBPACK_IMPORTED_MODULE_4___default.a.getStateName(contactData.country,contactData.state),contact.country=_src_services_core_country_service__WEBPACK_IMPORTED_MODULE_4___default.a.getCountryName(contactData.country),contact},service.getAllDirectoryContacts=function(companyId){return $q((function(resolve,reject){var result;service.getDirectoryContacts(companyId,1,1e3).then((function(response){if(result=response,response.total>response.limit){var totalPages=Math.ceil(response.total/1e3),pages=Array.apply(null,Array(totalPages-1));pages=pages.map((function(__unused,index){return index+2}));for(var chunks=[];pages.length>0;)chunks.push(pages.splice(0,5));return chunks.reduce((function(promiseChain,requests){return promiseChain.then((function(){var promisesArray=requests.map((function(page){return service.getDirectoryContacts(companyId,page,1e3).then((function(data){result.contacts=result.contacts.concat(data.contacts),result.limit+=data.limit}))}));return $q.all(promisesArray)}))}),$q.resolve())}})).then((function(){resolve(result)})).catch((function(error){reject(error)}))}))},service.buildDirectoryCsvBlob=function(companyId){return $q((function(resolve,reject){$log.info("[companyDirectoryService] === buildDirectoryCsvBlob ==="),service.getAllDirectoryContacts(companyId).then((function(result){var maxWorkPhoneNumbers=Math.max(1,result.contacts.reduce((function(max,contact){return Math.max(max,contact.workPhoneNumbers?contact.workPhoneNumbers.length:0)}),0)),maxMobilePhoneNumbers=Math.max(1,result.contacts.reduce((function(max,contact){return Math.max(max,contact.mobilePhoneNumbers?contact.mobilePhoneNumbers.length:0)}),0)),maxOtherPhoneNumbers=Math.max(1,result.contacts.reduce((function(max,contact){return Math.max(max,contact.otherPhoneNumbers?contact.otherPhoneNumbers.length:0)}),0)),csvWorkPhonesColumns=Array.apply(null,new Array(maxWorkPhoneNumbers)).map((function(val,i){return"workPhoneNumber"+i})),csvWorkPhonesExtraSeparators=Array.apply(null,new Array(maxWorkPhoneNumbers)).map((function(){return";"})),csvMobilePhonesColumns=Array.apply(null,new Array(maxMobilePhoneNumbers)).map((function(val,i){return"mobilePhoneNumber"+i})),csvMobilePhonesExtraSeparators=Array.apply(null,new Array(maxMobilePhoneNumbers)).map((function(){return";"})),csvOtherPhonesColumns=Array.apply(null,new Array(maxOtherPhoneNumbers)).map((function(val,i){return"otherPhoneNumber"+i})),csvOtherPhonesExtraSeparators=Array.apply(null,new Array(maxOtherPhoneNumbers)).map((function(){return";"})),csvDirectoryLines=[];csvDirectoryLines.push("firstName;lastName;companyName;department;street;city;postalCode;state;country;"+csvWorkPhonesColumns.join(";")+";"+csvMobilePhonesColumns.join(";")+";"+csvOtherPhonesColumns.join(";")+";jobTitle;eMail;custom1;custom2"),result.contacts.forEach((function(contact){var phoneNumbers,contactLine="";contactLine+=contact.firstName?contact.firstName:"",contactLine+=";",contactLine+=contact.lastName?contact.lastName:"",contactLine+=";",contactLine+=contact.companyName?contact.companyName:"",contactLine+=";",contactLine+=contact.department?contact.department:"",contactLine+=";",contactLine+=contact.street?contact.street:"",contactLine+=";",contactLine+=contact.city?contact.city:"",contactLine+=";",contactLine+=contact.postalCode?contact.postalCode:"",contactLine+=";",contactLine+=contact.state?contact.state:"",contactLine+=";",contactLine+=contact.country?contact.country:"",contactLine+=";",contactLine+=(phoneNumbers=contact.workPhoneNumbers&&contact.workPhoneNumbers.length>0?contact.workPhoneNumbers:[""]).map((function(number){return number})).join(";"),contactLine+=csvWorkPhonesExtraSeparators.slice(phoneNumbers.length).join(""),contactLine+=";",contactLine+=(phoneNumbers=contact.mobilePhoneNumbers&&contact.mobilePhoneNumbers.length>0?contact.mobilePhoneNumbers:[""]).map((function(number){return number})).join(";"),contactLine+=csvMobilePhonesExtraSeparators.slice(phoneNumbers.length).join(""),contactLine+=";",contactLine+=(phoneNumbers=contact.otherPhoneNumbers&&contact.otherPhoneNumbers.length>0?contact.otherPhoneNumbers:[""]).map((function(number){return number})).join(";"),contactLine+=csvOtherPhonesExtraSeparators.slice(phoneNumbers.length).join(""),contactLine+=";",contactLine+=contact.jobTitle?contact.jobTitle:"",contactLine+=";",contactLine+=contact.eMail?contact.eMail:"",contactLine+=";",contactLine+=contact.custom1?contact.custom1:"",contactLine+=";",contactLine+=contact.custom2?contact.custom2:"",csvDirectoryLines.push(contactLine)}));var directoryBlob=new Blob([csvDirectoryLines.join("\r\n")],{type:"text/csv; charset=utf-8"});resolve(directoryBlob)})).catch((function(error){reject(error)}))}))},service.exportDirectoryCsvFile=function(companyId){return $q((function(resolve,reject){$log.info("[companyDirectoryService] === exportDirectoryCsvFile ===");var fileBlob,csvFilename="directory_"+moment().format("YYYY-MM-DD_HH-mm")+".csv";service.buildDirectoryCsvBlob(companyId).then((function(blob){return fileBlob=blob,centralizedService.fileSaver.promptFolderPathAndSavePromise(csvFilename)})).then((function(){centralizedService.fileSaver.fileDownload(fileBlob,null,null,csvFilename,!0),resolve()})).catch((function(error){reject(error)}))}))}}])},function(module,exports){angular.module("rainbow").service("browserService",[function(){this.extractBrowserVersion=function(uastring,expr,pos){var match=uastring.match(expr);return match&&match.length>=pos&&parseInt(match[pos],10)}}])},function(module,exports){angular.module("rainbow").service("gRTCStatsService",[function(){var calls={};this.resetStatsForAllCalls=function(){calls={}},this.resetStatsForCall=function(callid){callid in calls&&delete calls[callid]},this.getCalls=function(){return calls},this.nbCalls=function(){return Object.keys(calls).length},this.hasStatsForCall=function(callid){return callid in calls},this.addStreamToCall=function(callid,stream){callid in calls||(calls[callid]={});var call=calls[callid];call[stream.id]={},call[stream.id].stream=stream},this.nbStreamsInACall=function(callid){return callid in calls?Object.keys(calls[callid]).length:0},this.getBundlePolicyForCall=function(callid){if(!(callid in calls))return"unknown";var call=calls[callid],nbActiveStream=0,nbTotalStreams=this.nbStreamsInACall(callid);for(var componentID in call)"selectedCandidatePairId"in call[componentID].stream&&nbActiveStream++;if(4===nbTotalStreams)switch(nbActiveStream){case 0:return"failed";case 1:return"max-bundle";case 2:return"balanced";case 4:return"max-compat";default:return"unknown"}else{if(2!==nbTotalStreams)return"unknown";switch(nbActiveStream){case 0:return"failed";case 1:return"max-bundle";case 2:return"max-compat";default:return"unknown"}}},this.addSSRCToStream=function(callid,ssrc){var call,stream=null;"ssrc"===ssrc.type&&callid in calls&&(call=calls[callid],ssrc.transportId in call&&((stream=call[ssrc.transportId]).ssrc||(stream.ssrc={}),stream.ssrc[ssrc.ssrc]=ssrc))},this.hasSSRCInStream=function(callid,streamid,ssrcid){var call,stream;return callid in calls&&streamid in(call=calls[callid])&&!!(stream=call[streamid]).ssrc&&ssrcid in stream.ssrc},this.getSSRCMediaType=function(callid,streamid,ssrcid){var call,stream;return callid in calls&&streamid in(call=calls[callid])&&(stream=call[streamid]).ssrc&&ssrcid in stream.ssrc?stream.ssrc[ssrcid].mediaType:"unknown"},this.getSSRCDirection=function(callid,streamid,ssrcid){var call,stream,ssrc;return callid in calls&&streamid in(call=calls[callid])&&(stream=call[streamid]).ssrc&&ssrcid in stream.ssrc?(ssrc=stream.ssrc[ssrcid],getDirection(ssrc.id)):"unknown"},this.getSSRCAudioCodecName=function(callid,streamid,ssrcid){var call,stream;return callid in calls&&streamid in(call=calls[callid])&&(stream=call[streamid]).ssrc&&ssrcid in stream.ssrc?stream.ssrc[ssrcid].googCodecName:"unknown"},this.isSSRCFlowing=function(callid,streamid,ssrcid){var call,stream,ssrc;return callid in calls&&(streamid in(call=calls[callid])&&(!!(stream=call[streamid]).ssrc&&(ssrcid in stream.ssrc&&(ssrc=stream.ssrc[ssrcid],("IN"===getDirection(ssrc.id)?parseInt(ssrc.bytesReceived,10):parseInt(ssrc.bytesSent,10))>0))))},this.getStreamsDetailsFromCall=function(callid){var call=null,stream=null;if(!(callid in calls))return[];call=calls[callid];var streams=[];for(var streamid in call)if(call.hasOwnProperty(streamid)){stream=call[streamid];var audioResult="no",videoResult="no",hasAudioIN=!1,hasVideoIN=!1,hasAudioOUT=!1,hasVideoOUT=!1;for(var ssrcid in stream.ssrc)if(stream.ssrc&&stream.ssrc.hasOwnProperty&&stream.ssrc.hasOwnProperty(ssrcid)){var type=this.getSSRCMediaType(callid,streamid,ssrcid),direction=this.getSSRCDirection(callid,streamid,ssrcid),isFlowing=this.isSSRCFlowing(callid,streamid,ssrcid);"audio"===type&&"IN"===direction&&isFlowing?hasAudioIN=!0:"audio"===type&&"OUT"===direction&&isFlowing?hasAudioOUT=!0:"video"===type&&"IN"===direction&&isFlowing?hasVideoIN=!0:"video"===type&&"OUT"===direction&&isFlowing&&(hasVideoOUT=!0)}hasAudioIN&&hasAudioOUT?audioResult="IN|OUT":hasAudioIN?audioResult="IN":hasAudioOUT&&(audioResult="OUT"),hasVideoIN&&hasVideoOUT?videoResult="IN|OUT":hasVideoIN?videoResult="IN":hasVideoOUT&&(videoResult="OUT"),hasAudioIN||hasAudioOUT||hasVideoIN||hasVideoOUT?streams.push({id:streamid,streams:{audio:audioResult,video:videoResult}}):streams.push({id:streamid,streams:{}})}return streams},this.getCodecDetailsFromCall=function(callid){var call=null,stream=null,audioCodec="-",videoCodec="-",codecs={codec:{audio:audioCodec,video:videoCodec}};if(!(callid in calls))return codecs;for(var streamid in call=calls[callid])if(call.hasOwnProperty(streamid))for(var ssrcid in(stream=call[streamid]).ssrc)"audio"===stream.ssrc[ssrcid].mediaType&&(audioCodec=this.getSSRCAudioCodecName(callid,streamid,ssrcid)),"video"===stream.ssrc[ssrcid].mediaType&&(videoCodec=this.getSSRCAudioCodecName(callid,streamid,ssrcid));return codecs.codec.audio=audioCodec,codecs.codec.video=videoCodec,codecs};var getDirection=function(id){return id.indexOf("recv")>-1?"IN":"OUT"}}])},function(module,exports){angular.module("rainbow").service("fRTCStatsService",[function(){var calls={};this.getCalls=function(){return calls},this.nbCalls=function(){return Object.keys(calls).length},this.addStreamToCall=function(callid,stream){if(!stream.isRemote){callid in calls||(calls[callid]={});var call=calls[callid];call.streams||(call.streams={}),call.streams[stream.id]={},call.streams[stream.id]=stream}},this.nbStreamsInACall=function(callid){return callid in calls?Object.keys(calls[callid].streams).length:0},this.resetStatsForAllCalls=function(){calls={}},this.resetStatsForCall=function(callid){callid in calls&&delete calls[callid]},this.hasStatsForCall=function(callid){return callid in calls},this.hasSSRCInStream=function(callid,streamid,ssrcid){var call;return callid in calls&&!!(call=calls[callid]).streams&&streamid in call.streams&&call.streams[streamid].ssrc===ssrcid},this.hasStreamInCall=function(callid,streamid){return callid in calls&&streamid in calls[callid].streams},this.getSSRCMediaType=function(callid,streamid){var call;return callid in calls&&streamid in(call=calls[callid]).streams?call.streams[streamid].mediaType:"unknown"},this.getStreamsDetailsFromCall=function(callid){var call=null;if(!(callid in calls))return[];call=calls[callid];var streams=[];for(var streamid in call.streams)if(call.streams.hasOwnProperty(streamid)){var type=this.getSSRCMediaType(callid,streamid),direction=getDirection(streamid);"audio"===type?streams.push({id:streamid,streams:{audio:direction}}):"video"===type&&streams.push({id:streamid,streams:{video:direction}})}return streams},this.addCandidatePairToCall=function(callid,candidatePair){var call=null,hasAlreadyThisCandidatePair=!1;if(callid in calls){(call=calls[callid]).candidatesPairs||(call.candidatesPairs=[]);for(var i=0;i<call.candidatesPairs.length;i++)if(call.candidatesPairs[i].id===candidatePair.id){hasAlreadyThisCandidatePair=!0;break}!hasAlreadyThisCandidatePair&&"succeeded"===candidatePair.state&&candidatePair.selected&&call.candidatesPairs.push(candidatePair)}},this.getNbCandidatePairs=function(callid){var call,nbCandidatePairs=0;return callid in calls?((call=calls[callid]).candidatesPairs&&(nbCandidatePairs=call.candidatesPairs.length),nbCandidatePairs):nbCandidatePairs},this.getBundlePolicyForCall=function(callid){var policy="unknown";if(!(callid in calls))return policy;switch(this.getNbCandidatePairs(callid)){case 0:policy="failed";break;case 1:policy="max-bundle";break;case 2:policy=this.nbStreamsInACall(callid)>2?"balanced":"max-compat";break;default:policy="max-compat"}return policy};var getDirection=function(id){return id.indexOf("inbound")>-1?"IN":"OUT"}}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0__),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2__);angular.module("rainbow").service("platformService",["$log","$rootScope","$window","$interval","$q","$filter","$http","errorHelperService",function($log,$rootScope,$window,$interval,$q,$filter,$http,errorHelperService){var service=this,listeners=[],xmppConnectionSubscription=null;service.$q=$q,this.isWin=navigator.platform.toUpperCase().indexOf("WIN")>=0,service.start=function(stats){return $q((function(resolve,__reject){var startDate=performance.now();$log.info(""),$log.info("[platformService] === STARTING ==="),service.languages=["en","fr","es","de"],listeners.push($rootScope.$on("$translateChangeSuccess",(function(){service.fixDeviceLabels()}))),listeners.push($rootScope.$on("ON_INPUT_DEVICE_CHANGED_EVENT",onAudioInputChange)),listeners.push($rootScope.$on("ON_OUTPUT_DEVICE_CHANGED_EVENT",updateOutputDevice)),xmppConnectionSubscription=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_2___default.a.subscribeToConnectionEvents((function(event){service.onAuthenticationStatusChangedEvent(event)})),service.isAskingMedia=!1,service.hasAudioPermission=!1,service.hasVideoPermission=!1,service.stopWatcher(),$interval(service.startWatcher,2e3,1);var startDuration=Math.round(performance.now()-startDate);stats.push({service:"platformService",startDuration:startDuration}),$log.info("[platformService] === STARTED ("+startDuration+" ms) ==="),resolve()}))},service.stop=function(){return $log.info("[platformService] === STOPPING ==="),listeners.forEach((function(listener){listener()})),xmppConnectionSubscription&&xmppConnectionSubscription.unsubscribe(),service.stopWatcher(),this.mediaDevicesLength=0,this.mediaDevices=[],$log.info("[platformService] === STOPPED ==="),$q.when()},service.onAuthenticationStatusChangedEvent=function(event){"ON_XMPP_CONNECTED"===event.name&&(!service.allowDevicesManagement()||!$("#globalAudioTag")[0]||$("#globalAudioTag")[0].sinkId&&"default"!==$("#globalAudioTag")[0].sinkId||($log.info("[platformService] onAuthenticationStatusChangedEvent -- update global audio tag"),service.getCurrentSpeaker().then((function(device){device&&device.id&&updateCurrentOutputDevice(device.id)}))),service.testGetUserMedia())},this.audioDevices=0,this.videoDevices=0,this.detectRTCLoaded=function(){service.hasAudioPermission=DetectRTC.isWebsiteHasMicrophonePermissions,service.hasVideoPermission=DetectRTC.isWebsiteHasWebcamPermissions,service.fixDeviceLabels();var shouldAskAudio=!1,shouldAskVideo=!1,shouldAskMedia=service.shouldAskGetUserMedia();(DetectRTC.audioInputDevices&&DetectRTC.audioInputDevices.length||DetectRTC.audioOutputDevices&&DetectRTC.audioOutputDevices.length)&&(!service.hasAudioPermission||shouldAskMedia.audio?shouldAskAudio=!0:_isWebsiteHasMicrophonePermissions=!0),DetectRTC.videoInputDevices&&DetectRTC.videoInputDevices.length&&(!service.hasVideoPermission||shouldAskMedia.video?shouldAskVideo=!0:_isWebsiteHasWebcamPermissions=!0),shouldAskAudio||shouldAskVideo?service.isAskingMedia||(service.isAskingMedia=!0,service.getUserMedia(shouldAskAudio,shouldAskVideo)):(service.fixDeviceLabels(),updateHeadsetDevices().then((function(){service.updateNewDesktopDevicesIds(),updateAvailability(),service.audioDevices!==DetectRTC.audioInputDevices.length+DetectRTC.audioOutputDevices.length&&(service.audioDevices=DetectRTC.audioInputDevices.length+DetectRTC.audioOutputDevices.length,service.audioMediaDeviceUpdated()),service.videoDevices!==DetectRTC.videoInputDevices.length&&(service.videoDevices=DetectRTC.videoInputDevices.length,service.videoMediaDeviceUpdated()),angular.forEach(DetectRTC.MediaDevices,(function(mediaDevice){mediaDevice&&$log.info("[PlatformService] DetectRTC.MediaDevices device "+mediaDevice.id+" with kind "+mediaDevice.kind+" with label "+mediaDevice.label)})),service.getCurrentSpeaker().then((function(device){device&&device.id&&updateCurrentOutputDevice(device.id)})),service.newDevice&&service.checkAndUpdateHandFreeProfile(),service.startWatcher()})))},this.testGetUserMedia=function(){if(service.hasAudioPermission){var startDate=performance.now();service.getCurrentMicrophone().then((function(microphone){var constraints={},mic="default";microphone?(constraints.audio={optional:[{sourceId:microphone.id}]},mic="id - "+microphone.id+" and label "+microphone.label):constraints.audio=!0,$log.info("[PlatformService] testGetUserMedia -- getUserMedia for Mic "+mic),navigator.mediaDevices.getUserMedia(constraints).then((function(stream){var completeStartDuration=Math.round(performance.now()-startDate);$log.info("[PlatformService] testGetUserMedia -- getUserMedia success for time : "+completeStartDuration+" ms"),angular.forEach(stream.getTracks(),(function(mediaStreamTrack){$log.info("[PlatformService] testGetUserMedia mediaStreamTrack -- "+mediaStreamTrack.label),mediaStreamTrack.stop()})),_isWebsiteHasMicrophonePermissions=!0,service.isAskingMedia=!1})).catch((function(error){$log.info("[PlatformService] testGetUserMedia -- getUserMedia error "+error),service.isAskingMedia=!1}))}))}else $log.info("[PlatformService] testGetUserMedia -- no audio permission given")},this.shouldAskGetUserMedia=function(){var result={audio:!1,video:!1};return angular.forEach(DetectRTC.MediaDevices,(function(mediaDevice){mediaDevice&&mediaDevice.label&&-1!==mediaDevice.label.indexOf("invoke getUserMedia")&&("audioinput"===mediaDevice.kind||"audiooutput"===mediaDevice.kind?result.audio=!0:result.video=!0)})),$log.info("[platformService] shouldAskGetUserMedia : audio "+result.audio+" and video "+result.video),result},this.updateNewDesktopDevicesIds=function(){var handFreeInputDeviceName=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("handFreeInputDeviceName"),handFreeOutputDeviceName=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("handFreeOutputDeviceName"),headsetDeviceName=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("headsetDeviceName"),customMicrophoneName=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("customMicrophoneName"),customSpeakerName=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("customSpeakerName"),cameraUsed=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("cameraUsed"),secondRinging=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("ringingSpeakerName");(handFreeInputDeviceName||handFreeOutputDeviceName||headsetDeviceName||customMicrophoneName||customSpeakerName)&&angular.forEach(DetectRTC.MediaDevices,(function(mediaDevice){"audioinput"===mediaDevice.kind?(mediaDevice.normalizedLabel===headsetDeviceName&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("headsetMicrophone",mediaDevice.id),mediaDevice.normalizedLabel===handFreeInputDeviceName&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("microphone",mediaDevice.id),mediaDevice.normalizedLabel===customMicrophoneName&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("customMicrophone",mediaDevice.id)):"audiooutput"===mediaDevice.kind&&(mediaDevice.normalizedLabel===headsetDeviceName&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("headsetSpeaker",mediaDevice.id),mediaDevice.normalizedLabel===handFreeOutputDeviceName&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("speaker",mediaDevice.id),mediaDevice.normalizedLabel===customSpeakerName&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("customSpeaker",mediaDevice.id))})),cameraUsed&&angular.forEach(DetectRTC.MediaDevices,(function(mediaDevice){"videoinput"===mediaDevice.kind&&mediaDevice.label===cameraUsed&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("camera",mediaDevice.id)})),secondRinging&&angular.forEach(DetectRTC.MediaDevices,(function(mediaDevice){"audiooutput"===mediaDevice.kind&&mediaDevice.normalizedLabel===secondRinging&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("ringingSpeaker",mediaDevice.id)}))},this.mediaDevicesLength=0,this.mediaDevices=[],this.newDevice=null,this.devicesWatcher=function(){navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then((function(devices){(service.mediaDevicesLength!==devices.length||service.checkForIdChange(devices))&&($log.debug("[platformService] MediaDevices count changed ! from "+service.mediaDevicesLength+" to "+devices.length),$log.debug("[platformService] MediaDevices brut devices list "+JSON.stringify(devices)),devices.length-service.mediaDevicesLength==1?service.newDevice=service.getNewDevice(service.mediaDevices,devices):service.newDevice=null,service.mediaDevicesLength=devices.length,service.mediaDevices=devices,service.stopWatcher(),DetectRTC.load(service.detectRTCLoaded))}))},service.checkAndUpdateHandFreeProfile=function(){$log.info("[platformService] checkAndUpdateHandFreeProfile");var activeProfile=service.getActiveAudioProfile();1===activeProfile.key&&!0===activeProfile.available&&service.getCurrentSpeaker().then((function(speaker){speaker&&speaker.groupId===service.newDevice.groupId&&($log.info("[platformService] checkAndUpdateHandFreeProfile -- should update the Jack Mic"),$rootScope.$broadcast("ON_HANDFREE_JACK_MICROPHONE_EVENT",service.newDevice))}))},service.checkForIdChange=function(devices){var changed=!1;return service.mediaDevices.length&&angular.forEach(service.mediaDevices,(function(device){if("default"!==device.deviceId&&"communications"!==device.deviceId){for(var found=!1,i=0;i<devices.length;i++)device.deviceId===devices[i].deviceId&&(found=!0);found||(changed=!0)}})),changed&&$log.info("[platformService] checkForIdChange "+changed),changed},service.getNewDevice=function(oldDevices,newDevices){var newDevice=null;return newDevices.length&&angular.forEach(newDevices,(function(device){if("default"!==device.deviceId&&"communications"!==device.deviceId){for(var found=!1,i=0;i<oldDevices.length;i++)device.deviceId===oldDevices[i].deviceId&&(found=!0);found||"audioinput"!==device.kind||(newDevice=device)}})),newDevice},service.tryToGetUserMediaForEachDevice=function(){$log.info("[platformService] tryToGetUserMediaForEachDevice"),DetectRTC.audioInputDevices&&DetectRTC.audioInputDevices.length?function(){for(var chain=$q.when(),i=0;i<DetectRTC.audioInputDevices.length;i++)!function(index){var device=DetectRTC.audioInputDevices[index];chain=chain.then((function(){return service.getUserMediaForAudioDevice(device.id)}))}(i);chain=chain.finally((function(){if($log.info("[platformService] tryToGetUserMediaForEachDevice finally -- has audio permission "+service.hasAudioPermission),service.hasAudioPermission)service.loadDetectRTC();else{_isWebsiteHasMicrophonePermissions=!1,_isWebsiteHasWebcamPermissions=!1,service.isAskingMedia=!1;$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"information",popupBody:"devicePermission",okLabel:"ok"}),service.startWatcher()}}))}():($log.warn("[platformService] tryToGetUserMediaForEachDevice -- no audio devices found, restart the watcher"),service.isAskingMedia=!1,service.startWatcher())},service.getUserMediaForAudioDevice=function(id){return $q((function(resolve){if(service.hasAudioPermission)return $log.info("[platformService] getUserMediaForAudioDevice for id: "+id+" no longer needed !"),void resolve();if(!id)return $log.info("[platformService] getUserMediaForAudioDevice missing id !"),void resolve();$log.info("[platformService] getUserMediaForAudioDevice for id: "+id);var constraints={};constraints.audio={optional:[{sourceId:id}]},navigator.mediaDevices.getUserMedia(constraints).then((function(stream){$log.info("[platformService] getUserMediaForAudioDevice for id: "+id+" success"),angular.forEach(stream.getAudioTracks(),(function(mediaStreamTrack){mediaStreamTrack.stop()})),service.hasAudioPermission=!0,_isWebsiteHasMicrophonePermissions=!0,service.hasVideoPermission=!0,_isWebsiteHasWebcamPermissions=!0,resolve()})).catch((function(error){$log.info("[platformService] getUserMediaForAudioDevice for id: "+id+" failed with error "+error),resolve()}))}))},service.getUserMedia=function(audio,video){$log.info("[platformService] getUserMedia audio: "+audio+" and video: "+video),navigator.mediaDevices.getUserMedia({audio:audio,video:video}).then((function(stream){$log.info("[platformService] getUserMedia audio: "+audio+" and video: "+video+" -- success!"),angular.forEach(stream.getAudioTracks(),(function(mediaStreamTrack){mediaStreamTrack.stop()})),angular.forEach(stream.getVideoTracks(),(function(mediaStreamTrack){mediaStreamTrack.stop()})),audio&&(service.hasAudioPermission=!0,_isWebsiteHasMicrophonePermissions=!0),video&&(service.hasVideoPermission=!0,_isWebsiteHasWebcamPermissions=!0),stream=null,service.loadDetectRTC()})).catch((function(error){$log.error("[platformService] getUserMedia -- error -- "+error),service.tryToGetUserMediaForEachDevice()}))},service.loadDetectRTC=function(){DetectRTC.load((function(){service.fixDeviceLabels(),updateHeadsetDevices().then((function(){service.updateNewDesktopDevicesIds(),updateAvailability(),service.isAskingMedia=!1,service.audioDevices!==DetectRTC.audioInputDevices.length+DetectRTC.audioOutputDevices.length&&(service.audioDevices=DetectRTC.audioInputDevices.length+DetectRTC.audioOutputDevices.length,service.audioMediaDeviceUpdated()),service.videoDevices!==DetectRTC.videoInputDevices.length&&(service.videoDevices=DetectRTC.videoInputDevices.length,service.videoMediaDeviceUpdated()),angular.forEach(DetectRTC.MediaDevices,(function(mediaDevice){mediaDevice&&$log.info("[PlatformService] DetectRTC.MediaDevices device "+mediaDevice.id+" with kind "+mediaDevice.kind+" with label "+mediaDevice.label)})),service.getCurrentSpeaker().then((function(device){device&&device.id&&updateCurrentOutputDevice(device.id)})),service.startWatcher()}))}))},service.getWhatsNewVersions=function(limit){return $q((function(resolve){var url=config.restServerUrl+"/api/rainbow/applications/v1.0/release-notes?format=full";limit&&(url+="&limit="+limit);var headers=_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader();fetch(url,{method:"GET",headers:headers}).then((function(response){if(!response.ok)throw response;response.json().then((function(responseData){$log.info("[adminPlatformService] getWhatsNewVersions -- success"),resolve(responseData.data)}))}))}))},service.getWhatsNew=function(){return $q((function(resolve){var url=config.restServerUrl+"/api/rainbow/enduser/v1.0/settings/changelogs";$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminPlatformService] getWhatsNew -- success");var data=response.data.data.changeLog.split("\xa7%\xa7"),whatsNew={};data.forEach((function(markdown,index){whatsNew[service.languages[index]]=markdown})),Object.keys(whatsNew).forEach((function(key){0===whatsNew[key].length&&(whatsNew[key]=whatsNew.en)})),whatsNew.en||(whatsNew={en:"",fr:"",es:"",de:""}),resolve(whatsNew)}),(function(response){resolve({en:"",fr:"",es:"",de:""}),$log.error("[adminPlatformService] "+errorHelperService.getErrorFullMessage(response,"getWhatsNew"))}))}))},service.getAvailableLanguage=function(lang){var mainLang=lang.split("-")[0];return service.languages.find((function(language){return language===mainLang}))||"en"},this.isDesktop=function(){return navigator.userAgent.indexOf(" Rainbow/")>=0},this.allowDevicesManagement=function(){return $window.chrome||this.isDesktop()};var _isWebsiteHasWebcamPermissions=!1;this.isWebsiteHasWebcamPermissions=function(){return!!service.allowDevicesManagement()&&_isWebsiteHasWebcamPermissions};var _isWebsiteHasMicrophonePermissions=!1;this.isWebsiteHasMicrophonePermissions=function(){return!!service.allowDevicesManagement()&&_isWebsiteHasMicrophonePermissions};var audioProfile={HANDFREE:{key:1,value:"handfree",available:!1},HEADSET:{key:2,value:"headset",available:!1},SPEAKERPHONE:{key:3,value:"speakerphone",available:!1},CUSTOM:{key:4,value:"custom",available:!1}};this.audioProfileEnum=audioProfile,this.getAudioProfiles=function(){return audioProfile},this.currentAudioProfile=audioProfile.HANDFREE,this.getCurrentAudioProfile=function(){var profile=null;switch(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("audioProfile")){case audioProfile.HEADSET.value:profile=audioProfile.HEADSET;break;case audioProfile.HANDFREE.value:profile=audioProfile.HANDFREE;break;case audioProfile.SPEAKERPHONE.value:profile=audioProfile.SPEAKERPHONE;break;case audioProfile.CUSTOM.value:profile=audioProfile.CUSTOM;break;default:profile=audioProfile.HANDFREE,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("audioProfile",profile.value)}return profile},this.getActiveAudioProfile=function(){var profile=this.getCurrentAudioProfile();return profile.key===audioProfile.HANDFREE.key||profile.available?profile:audioProfile.HANDFREE},this.setCurrentAudioProfile=function(profile){profile&&(service.currentAudioProfile=profile)},this.isHandfreeAvailable=function(){return service.isHandfreeMicrophoneAvailable()&&service.isHandfreeSpeakerAvailable()},this.isHeadsetAvailable=function(){return service.isHeadsetMicrophoneAvailable()&&service.isHeadsetSpeakerAvailable()},this.isSpeakerphoneAvailable=function(){return service.isSpeakerphoneMicrophoneAvailable()&&service.isSpeakerphoneSpeakerAvailable()},this.isCustomAvailable=function(){return service.isCustomMicrophoneAvailable()&&service.isCustomSpeakerAvailable()},this.getCurrentMicrophone=function(){if("sdk"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("apiMode")){var microphone=service.getMicrophoneForSDK();if(microphone)return microphone}switch(service.getActiveAudioProfile()){case audioProfile.SPEAKERPHONE:return service.getSpeakerphoneMicrophone();case audioProfile.CUSTOM:return service.getCustomMicrophone();case audioProfile.HEADSET:return service.getHeadsetMicrophone();default:return service.getHandfreeMicrophone()}},this.getMicrophoneForSDK=function(){var deferred=$q.defer();return service.getMicrophones().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("microphone")))})),deferred.promise},this.getSecondRingerStatusFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("hasSecondRinger")},this.setSecondRingerStatusFromSettings=function(val){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("hasSecondRinger",val)},this.getHandfreeMicrophoneFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("microphone")},this.getHandfreeMicrophone=function(){var deferred=$q.defer();return service.getMicrophones().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getHandfreeMicrophoneFromSettings()))})),deferred.promise},this.getHeadsetMicrophoneFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("headsetMicrophone")},this.getHeadsetMicrophone=function(){var deferred=$q.defer();return service.getMicrophones().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getHeadsetMicrophoneFromSettings()))})),deferred.promise},this.getHeadsetDeviceName=function(){var deferred=$q.defer();return deferred.resolve(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("headsetDeviceName")),deferred.promise},this.getSpeakerphoneMicrophoneFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("speakerphoneMicrophone")},this.getSpeakerphoneMicrophone=function(){var deferred=$q.defer();return service.getMicrophones().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getSpeakerphoneMicrophoneFromSettings()))})),deferred.promise},this.getSpeakerphoneDeviceName=function(){var deferred=$q.defer();return deferred.resolve(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("speakerphoneDeviceName")),deferred.promise},this.getCustomMicrophoneFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("customMicrophone")},this.getCustomMicrophone=function(){var deferred=$q.defer();return service.getMicrophones().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getCustomMicrophoneFromSettings()))})),deferred.promise},this.getMicrophones=function(){var deferred=$q.defer();return this.allowDevicesManagement()||deferred.resolve([]),service.getAudioInputDevices().then((function(devices){deferred.resolve(devices&&devices.constructor===Array&&_isWebsiteHasMicrophonePermissions?devices:[])})).catch((function(error){return $log.info("[PlatformService] === SERVICES FAILURE === : "+error.message),deferred.reject(error),deferred.promise})),deferred.promise},this.isHandfreeMicrophoneAvailable=function(){return service.isDeviceAvailable(service.mediaDevices,service.getHandfreeMicrophoneFromSettings(),"audioinput")},this.isHeadsetMicrophoneAvailable=function(){return service.isDeviceAvailable(service.mediaDevices,service.getHeadsetMicrophoneFromSettings(),"audioinput")},this.isSpeakerphoneMicrophoneAvailable=function(){return service.isDeviceAvailable(service.mediaDevices,service.getSpeakerphoneMicrophoneFromSettings(),"audioinput")},this.isCustomMicrophoneAvailable=function(){return service.isDeviceAvailable(service.mediaDevices,service.getCustomMicrophoneFromSettings(),"audioinput")},this.getCurrentSpeaker=function(){if("sdk"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("apiMode")){var speaker=service.getSpeakerForSDK();if(speaker)return speaker}switch(service.getActiveAudioProfile()){case audioProfile.SPEAKERPHONE:return service.getSpeakerphoneSpeaker();case audioProfile.CUSTOM:return service.getCustomSpeaker();case audioProfile.HEADSET:return service.getHeadsetSpeaker();default:return service.getHandfreeSpeaker()}},this.getSpeakerForSDK=function(){var deferred=$q.defer();return service.getSpeakers().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("speaker")))})),deferred.promise},this.getHandfreeSpeakerFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("speaker")},this.getHandfreeSpeaker=function(){var deferred=$q.defer();return service.getSpeakers().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getHandfreeSpeakerFromSettings(),!0))})),deferred.promise},this.getHeadsetSpeakerFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("headsetSpeaker")},this.getHeadsetSpeaker=function(){var deferred=$q.defer();return service.getSpeakers().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getHeadsetSpeakerFromSettings()))})),deferred.promise},this.getSpeakerphoneSpeakerFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("speakerphoneSpeaker")},this.getSpeakerphoneSpeaker=function(){var deferred=$q.defer();return service.getSpeakers().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getSpeakerphoneSpeakerFromSettings()))})),deferred.promise},this.getCustomSpeakerFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("customSpeaker")},this.getCustomSpeaker=function(){var deferred=$q.defer();return service.getSpeakers().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getCustomSpeakerFromSettings()))})),deferred.promise},this.getRingingSpeakerFromSettings=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("ringingSpeaker")},this.getRingingSpeaker=function(){var deferred=$q.defer();return service.getSpeakers().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,service.getRingingSpeakerFromSettings()))})),deferred.promise},this.setSpeakerForElement=function(element,sinkId){var defered=$q.defer();if(!element||!element.setSinkId)return $log.warn("[platformService] setSpeakerForElement -- missing element"),$q.when();if(this.allowDevicesManagement()){if(sinkId===element.sinkId)return $q.when();element.id&&$log.log("[platformService] setSpeakerForElement "+element.id+" with "+sinkId),element.setSinkId(sinkId).then((function(){$log.log("[platformService] Success, audio output device attached: "+sinkId),angular.element("#globalAudioTag")[0]&&$log.log("[platformService] sinkId for globalAudioTag is "+angular.element("#globalAudioTag")[0].sinkId),defered.resolve()})).catch((function(error){var errorMessage=error;"SecurityError"===error.name&&(errorMessage="[platformService] You need to use HTTPS for selecting audio output device: "+error),$log.error("[platformService] "+errorMessage),defered.resolve()}))}else $log.warn("[platformService] Browser does not support output device selection."),defered.resolve();return defered.promise},this.getSpeakers=function(){var deferred=$q.defer();return service.allowDevicesManagement()||deferred.resolve([]),service.getAudioOutputDevices().then((function(devices){deferred.resolve(devices&&devices.constructor===Array&&_isWebsiteHasMicrophonePermissions?devices:[])})).catch((function(error){return $log.info("[PlatformService] === SERVICES FAILURE === : "+error.message),deferred.reject(error),deferred.promise})),deferred.promise},this.isHandfreeSpeakerAvailable=function(){return service.isDeviceAvailable(service.mediaDevices,service.getHandfreeSpeakerFromSettings(),"audiooutput")};var _handfreeAvailibilityStatus=!1;this.isHeadsetSpeakerAvailable=function(){return service.isDeviceAvailable(service.mediaDevices,service.getHeadsetSpeakerFromSettings(),"audiooutput")};var _headsetAvailibilityStatus=null;this.isSpeakerphoneSpeakerAvailable=function(){return service.isDeviceAvailable(service.mediaDevices,service.getSpeakerphoneSpeakerFromSettings(),"audiooutput")};var _speakerphoneAvailibilityStatus=!1;this.isCustomSpeakerAvailable=function(){return service.isDeviceAvailable(service.mediaDevices,service.getCustomSpeakerFromSettings(),"audiooutput")};var _customAvailibilityStatus=!1;function onAudioInputChange(){updateAvailability(),service.isAskingMedia?$log.info("[PlatformService] onAudioInputChange -- already asking media -- ignore"):(service.isAskingMedia=!0,$interval(service.testGetUserMedia,2e3,1))}function updateAvailability(){var isAvailable;isAvailable=service.isHandfreeAvailable(),_handfreeAvailibilityStatus!==isAvailable&&($log.info("[PlatformService] Handfree is now "+(isAvailable?"available":"unavailable")),_handfreeAvailibilityStatus=isAvailable,audioProfile.HANDFREE.available=isAvailable,$rootScope.$broadcast("ON_AUDIO_PROFILE_CHANGED_EVENT",isAvailable),$rootScope.$broadcast("ON_INPUT_DEVICE_CHANGED_EVENT"),isAvailable||service.getCurrentSpeaker().then((function(device){device&&device.id&&updateCurrentOutputDevice(device.id)}))),function(isAvailable){_headsetAvailibilityStatus!==isAvailable&&($log.info("[PlatformService] Headset is now "+(isAvailable?"available":"unavailable")),_headsetAvailibilityStatus=isAvailable,audioProfile.HEADSET.available=isAvailable,isAvailable?_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("audioProfile")===audioProfile.HANDFREE.value&&(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("audioProfile",audioProfile.HEADSET.value),service.getCurrentSpeaker().then((function(device){device&&device.id&&updateCurrentOutputDevice(device.id)}))):(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("audioProfile")===audioProfile.HEADSET.value&&_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("audioProfile",audioProfile.HANDFREE.value),service.getCurrentSpeaker().then((function(device){device&&device.id&&updateCurrentOutputDevice(device.id)}))),$rootScope.$broadcast("ON_AUDIO_PROFILE_CHANGED_EVENT",isAvailable),$rootScope.$broadcast("ON_INPUT_DEVICE_CHANGED_EVENT"))}(service.isHeadsetAvailable()),function(isAvailable){_speakerphoneAvailibilityStatus!==isAvailable&&($log.info("[PlatformService] Speakerphone is now "+(isAvailable?"available":"unavailable")),_speakerphoneAvailibilityStatus=isAvailable,audioProfile.SPEAKERPHONE.available=isAvailable,$rootScope.$broadcast("ON_AUDIO_PROFILE_CHANGED_EVENT",isAvailable),$rootScope.$broadcast("ON_INPUT_DEVICE_CHANGED_EVENT"),isAvailable||service.getCurrentSpeaker().then((function(device){device&&device.id&&updateCurrentOutputDevice(device.id)})))}(service.isSpeakerphoneAvailable()),function(isAvailable){_customAvailibilityStatus!==isAvailable&&($log.info("[PlatformService] Custom is now "+(isAvailable?"available":"unavailable")),_customAvailibilityStatus=isAvailable,audioProfile.CUSTOM.available=isAvailable,$rootScope.$broadcast("ON_AUDIO_PROFILE_CHANGED_EVENT",isAvailable),$rootScope.$broadcast("ON_INPUT_DEVICE_CHANGED_EVENT"),isAvailable||service.getCurrentSpeaker().then((function(device){device&&device.id&&updateCurrentOutputDevice(device.id)})))}(service.isCustomAvailable())}function updateOutputDevice(__event,deviceId){updateAvailability(),$log.info("[PlatformService] updateOutputDevice "+deviceId),service.allowDevicesManagement()&&deviceId&&updateCurrentOutputDevice(deviceId)}var currentUpdatingDeviceId="";function updateCurrentOutputDevice(deviceId){$log.info("[PlatformService] updateCurrentOutputDevice "+deviceId),angular.element("#globalAudioTag")[0]&&angular.element("#globalAudioTag")[0].sinkId!==deviceId&&currentUpdatingDeviceId!==deviceId?(currentUpdatingDeviceId=deviceId,$log.info("[PlatformService] updateCurrentOutputDevice current ID "+angular.element("#globalAudioTag")[0].sinkId+" new id "+deviceId),service.setSpeakerForElement(angular.element("#globalAudioTag")[0],"default").then((function(){service.setSpeakerForElement(angular.element("#globalAudioTag")[0],deviceId),currentUpdatingDeviceId=""})).catch((function(){currentUpdatingDeviceId=""}))):$log.info("[PlatformService] updateCurrentOutputDevice -- ignored ")}var microphones=[],speakers=[],allDevices=[],headsetDevices=[],speakerphoneDevices=[],firstDeviceUpdateHeadset=!0,handfreeSupportedDevices=["realtek","soundmax","high definition audio","nomachine"];service.arrayContains=function(array,textSearched){return array.some((function(element){return textSearched.indexOf(element)>-1}))},service.getDeviceType=function(deviceLabel){return deviceLabel=deviceLabel.toLowerCase(),service.arrayContains(handfreeSupportedDevices,deviceLabel)?audioProfile.HANDFREE:audioProfile.HEADSET},this.normalizeAnyLabel=function(anyDevice){return anyDevice?("default"===anyDevice.id||"communications"===anyDevice.id||anyDevice.normalizedLabel||(service.isWin?-1!==anyDevice.label.indexOf("Realtek Audio")||-1!==anyDevice.label.indexOf("Realtek(R) Audio")?anyDevice.normalizedLabel=anyDevice.label:anyDevice.normalizedLabel=anyDevice.label.substring(anyDevice.label.indexOf("(")+1,anyDevice.label.indexOf(")")):anyDevice.normalizedLabel=anyDevice.label),anyDevice):null};var watcher,updateHeadsetDevices=function(){var deferred=$q.defer();return service.getMicrophones().then((function(devices){return microphones=devices,service.getSpeakers()})).then((function(devices){speakers=devices;var _headsetDevices=[];angular.forEach(microphones,(function(microphone){"default"!==microphone.id&&"communications"!==microphone.id&&(microphone=service.normalizeAnyLabel(microphone),_headsetDevices.some((function(device){return device.microphone.normalizedLabel===microphone.normalizedLabel}))||angular.forEach(speakers,(function(speaker){if(speaker=service.normalizeAnyLabel(speaker),microphone.normalizedLabel===speaker.normalizedLabel&&service.getDeviceType(microphone.normalizedLabel)===audioProfile.HEADSET){var _device={label:microphone.normalizedLabel,microphone:microphone,speaker:speaker};_headsetDevices.push(_device),firstDeviceUpdateHeadset&&allDevices.push(_device)}})))}));var headSetName=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("headsetDeviceName");headSetName&&"null"!==headSetName||!_headsetDevices.length||(headSetName=_headsetDevices[0].label,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("headsetDeviceName",_headsetDevices[0].label),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("headsetMicrophone",_headsetDevices[0].microphone.id),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("headsetSpeaker",_headsetDevices[0].speaker.id));var ringingSpeakerName=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("ringingSpeakerName");if((!ringingSpeakerName||"null"===ringingSpeakerName)&&speakers.length)for(var i=0;i<speakers.length;i++)if("default"!==speakers[i].id&&"communications"!==speakers[i].id){_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("ringingSpeakerName",speakers[i].normalizedLabel),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("ringingSpeaker",speakers[i].id);break}var newHeadsetDevices=[];firstDeviceUpdateHeadset||(angular.forEach(_headsetDevices,(function(newDevice){headsetDevices.some((function(oldDevice){return oldDevice.label===newDevice.label}))||(newHeadsetDevices.push(newDevice),allDevices.push(newDevice))})),newHeadsetDevices.length>0&&($log.info("[PlatformService] hotplugged headset(s): "+(newHeadsetDevices.length>1?newHeadsetDevices.reduce((function(deviceA,deviceB){return{label:deviceA.Label+", "+deviceB.Label}})).label:newHeadsetDevices[0].label)),$rootScope.$broadcast("ON_AUDIO_HOTPLUG_DEVICES_CHANGED_EVENT",{devices:newHeadsetDevices,action:"add"})));var disconnectedDevices=[];!firstDeviceUpdateHeadset&&headsetDevices.length>_headsetDevices.length&&(angular.forEach(headsetDevices,(function(newDevice){if(!_headsetDevices.some((function(oldDevice){return oldDevice.label===newDevice.label}))){disconnectedDevices.push(newDevice);var _index4=allDevices.map((function(dev){return dev.label})).indexOf(newDevice.label);allDevices.splice(_index4,1)}})),disconnectedDevices.length>0&&($log.info("[PlatformService] unplugged headset(s): "+(disconnectedDevices.length>1?disconnectedDevices.reduce((function(deviceA,deviceB){return{label:deviceA.Label+", "+deviceB.Label}})).label:disconnectedDevices[0].label)),$rootScope.$broadcast("ON_AUDIO_HOTPLUG_DEVICES_CHANGED_EVENT",{devices:disconnectedDevices,action:"remove"}))),firstDeviceUpdateHeadset=!1,headsetDevices=_headsetDevices,deferred.resolve(_headsetDevices)})),deferred.promise};this.getHeadsetDevices=function(){return headsetDevices},this.getSpeakerphoneDevices=function(){return speakerphoneDevices},this.getAllDevices=function(){return allDevices},this.getHandFreeDevice=function(){var deferred=$q.defer();return service.getHandfreeMicrophone().then((function(microphone){var curMic=microphone;service.getHandfreeSpeaker().then((function(speaker){var curSpeak=speaker;(!service.handFreeDevice||service.handFreeDevice.microphone&&service.handFreeDevice.microphone.id!==curMic.id||service.handFreeDevice.speaker&&service.handFreeDevice.speaker.id!==curSpeak.id)&&(service.handFreeDevice={label:"",microphone:curMic,speaker:curSpeak,profile:audioProfile.HANDFREE}),deferred.resolve(service.handFreeDevice)}))})),deferred.promise},this.getCustomDevice=function(){var deferred=$q.defer();return service.getCustomMicrophone().then((function(microphone){var curMic=microphone;service.getCustomSpeaker().then((function(speaker){var curSpeak=speaker;(!service.customDevice||service.customDevice.microphone&&service.customDevice.microphone.id!==curMic.id||service.customDevice.speaker&&service.customDevice.speaker.id!==curSpeak.id)&&(service.customDevice={label:"",microphone:curMic,speaker:curSpeak,profile:audioProfile.CUSTOM}),deferred.resolve(service.customDevice)}))})),deferred.promise},this.getAvailableDevices=function(){var deferred=$q.defer(),res=[];return service.getHandFreeDevice().then((function(device){res.push(device),headsetDevices.forEach((function(elem){elem.profile=audioProfile.HEADSET,res.push(elem)})),speakerphoneDevices.forEach((function(elem){elem.profile=audioProfile.SPEAKERPHONE,res.push(elem)})),service.getCustomDevice().then((function(customDevice){res.push(customDevice),deferred.resolve(res)}))})),deferred.promise},this.getStoredDeviceList=function(){return _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("deviceList")},this.saveDeviceList=function(devices){for(var deviceLabelList=[],i=0;i<devices.length;i++)deviceLabelList[i]=devices[i].label;_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.setSetting("deviceList",angular.toJson(deviceLabelList))},this.getCurrentCamera=function(){var deferred=$q.defer();return service.getCameras().then((function(devices){deferred.resolve(service.getDeviceWithId(devices,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("camera")))})),deferred.promise},this.getCameraForSDK=function(){return{id:_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getSetting("camera")}},this.getCameras=function(){var deferred=$q.defer();return this.allowDevicesManagement()||deferred.resolve([]),service.getVideoInputDevices().then((function(devices){deferred.resolve(devices&&devices.constructor===Array&&_isWebsiteHasWebcamPermissions?devices:[])})).catch((function(error){return $log.info("[PlatformService] === SERVICES FAILURE === : "+error.message),deferred.reject(error),deferred.promise})),deferred.promise},this.isDeviceAvailable=function(devices,id,kind){var currentDevice=devices.find((function(device){return device.kind===kind&&device.deviceId===id}));return angular.isDefined(currentDevice)},this.getDeviceWithId=function(devices,id,isSpeaker){if(devices.constructor!==Array)return null;var currentDevice=null;if("default"===id||"communications"===id)if(isSpeaker){var defaultDevice=service.mediaDevices.find((function(device){return device.deviceId===id&&"audioinput"===device.kind}));defaultDevice&&(currentDevice=devices.find((function(device){return"default"!==device.id&&"communications"!==device.id&&defaultDevice.groupId===device.groupId})))}else{var _defaultDevice=devices.find((function(device){return device.id===id}));_defaultDevice&&(currentDevice=devices.find((function(device){return"default"!==device.id&&"communications"!==device.id&&_defaultDevice.groupId===device.groupId})))}if(currentDevice)return currentDevice;if(!(currentDevice=devices.find((function(device){return device.id===id})))){if(isSpeaker){var _defaultDevice2=service.mediaDevices.find((function(device){return"default"===device.deviceId&&"audioinput"===device.kind}));_defaultDevice2&&(currentDevice=devices.find((function(device){return"default"!==device.id&&"communications"!==device.id&&_defaultDevice2.groupId===device.groupId})))}if(!currentDevice){var _defaultDevice3=devices.find((function(device){return"default"===device.id}));_defaultDevice3&&(currentDevice=devices.find((function(device){return"default"!==device.id&&"communications"!==device.id&&_defaultDevice3.groupId===device.groupId})))}}return currentDevice||(devices.length>0?devices[0]:null)},this.startWatcher=function(){if(service.allowDevicesManagement()){if(angular.isDefined(watcher))return;watcher=$interval(service.devicesWatcher,1e3)}},this.stopWatcher=function(){angular.isDefined(watcher)&&($interval.cancel(watcher),watcher=void 0)},this.capitalizeFirstLetter=function(string){return string.charAt(0).toUpperCase()+string.slice(1)},this.fixDeviceLabels=function(){angular.forEach(DetectRTC.MediaDevices,(function(mediaDevice){mediaDevice&&mediaDevice.id&&("default"!==mediaDevice.id||mediaDevice.label&&"Default"!==mediaDevice.label?mediaDevice.id.length<64&&"Please invoke getUserMedia once."===mediaDevice.label&&(mediaDevice.label=service.capitalizeFirstLetter(mediaDevice.id)):mediaDevice.label=service.findAndUpdateDefaultDeviceLabel(mediaDevice.kind,mediaDevice.groupId),$log.info("[PlatformService] fixDeviceLabels || update device "+mediaDevice.id+" with kind "+mediaDevice.kind+" with label "+mediaDevice.label))}))},this.findAndUpdateDefaultDeviceLabel=function(kind,groupId){for(var label="audioinput"===kind?$filter("translate")("yourComputerMicrophoneDevice"):$filter("translate")("yourComputerSpeakerDevice"),i=0;i<DetectRTC.MediaDevices.length;i++)if("default"!==DetectRTC.MediaDevices[i].id&&DetectRTC.MediaDevices[i].kind===kind&&DetectRTC.MediaDevices[i].groupId===groupId){label=label+" - "+DetectRTC.MediaDevices[i].label;break}return label},this.updatePermissions=function(){var result=!1;return angular.forEach(DetectRTC.MediaDevices,(function(mediaDevice){mediaDevice&&mediaDevice.id&&mediaDevice.id.length>=64&&("Please invoke getUserMedia once."===mediaDevice.label?result=!0:("videoinput"!==mediaDevice.kind||_isWebsiteHasWebcamPermissions||(_isWebsiteHasWebcamPermissions=!0),"audioinput"!==mediaDevice.kind||_isWebsiteHasMicrophonePermissions||(_isWebsiteHasMicrophonePermissions=!0)))})),result},this.isGetUserMediaRequested=function(){return(!_isWebsiteHasWebcamPermissions||!_isWebsiteHasMicrophonePermissions)&&service.updatePermissions(DetectRTC.MediaDevices)},this.audioMediaDeviceUpdated=function(){service.fixDeviceLabels(),$rootScope.$broadcast("ON_USER_AUDIO_MEDIA_CHANGED_EVENT")},this.videoMediaDeviceUpdated=function(){service.fixDeviceLabels(),$rootScope.$broadcast("ON_USER_VIDEO_MEDIA_CHANGED_EVENT")};var removeDuplicates=function(devices){var result=[];return angular.forEach(devices,(function(device){result.some((function(item){return item.id===device.id}))||result.push(device)})),result};this.getAudioInputDevices=function(){return $q.when(removeDuplicates(DetectRTC.audioInputDevices))},this.getAudioOutputDevices=function(){var deferred=$q.defer();return deferred.resolve(removeDuplicates(DetectRTC.audioOutputDevices)),deferred.promise},this.getVideoInputDevices=function(){var deferred=$q.defer();return deferred.resolve(removeDuplicates(DetectRTC.videoInputDevices)),deferred.promise}}])},function(module,exports){angular.module("rainbow").service("gaService",[function(){var analytics_ICEFailed_category="webrtc",analytics_ICEFailed_action="CallsSuccessRate",analytics_ICEFailed_label="error_failed",analytics_ICESuccess_category="webrtc",analytics_ICESuccess_action="CallsSuccessRate",analytics_ICESuccess_label="success",analytics_ICENoSTUNCandidate_category="webrtc",analytics_ICENoSTUNCandidate_action="CallsSuccessRate",analytics_ICENoSTUNCandidate_label="error_no_stun_candidate",analytics_ICEUsed_category="webrtc",analytics_ICEUsed_action="ICEDistribution",analytics_ICETopology_category="webrtc",analytics_ICETopology_action="ICETopology",analytics_NegotiationTime_category="webrtc",analytics_NegotiationTime_action="ICENegotiation",analytics_NegotiationTime_label="DurationMs",analytics_GetUserMedia_category="webrtc",analytics_GetUserMedia_action="GetUserMediaRate",analytics_GetUserMedia_label="success",analytics_GetUserMediaErrorNoTrack_category="webrtc",analytics_GetUserMediaErrorNoTrack_action="GetUserMediaRate",analytics_GetUserMediaErrorNoTrack_label="error_no_Track",analytics_GetUserMediaError_category="webrtc",analytics_GetUserMediaError_action="GetUserMediaRate",analytics_GetUserMediaError_label="error",analytics_CodecsUsed_category="webrtc",analytics_CodecsUsed_action="CodecsDistribution",analytics_NbSuccessCall_category="webrtc",analytics_NbSuccessCall_action="CallsDistribution",analytics_CallsDuration_category="webrtc",analytics_CallsDuration_action="CallsDurationRange",analytics_DragAndDrop_category="ux",analytics_DragAndDrop_action="dragAndDrop",analytics_InviteFromProvider_category="invitations",analytics_InviteFromProvider_action="inviteFromProvider",_startNegotiationTime=null,_endNegotiationTime=null,_pendingComputation=!1,_lastICESuccessTracked=null,_lastICEFailedTracked=null,_ga=null;this.provideGA=function(ga){_ga=ga},this.hasGA=function(){return null!==_ga},this.trackICEUsed=function(local,remote){if(_ga){var localICEUsed="",remoteICEUsed="";switch(local){case"local":localICEUsed="host";break;case"peerreflexive":case"prflx":case"serverreflexive":localICEUsed="stun";break;case"relayed":localICEUsed="relay";break;default:localICEUsed=local}switch(remote){case"local":remoteICEUsed="host";break;case"peerreflexive":case"prflx":case"serverreflexive":remoteICEUsed="stun";break;case"relayed":remoteICEUsed="relay";break;default:remoteICEUsed=remote}_ga.send("event",analytics_ICEUsed_category,analytics_ICEUsed_action,localICEUsed+"|"+remoteICEUsed)}},this.trackICEFailed=function(sid){_ga&&sid&&_lastICEFailedTracked!==sid&&(_ga.send("event",analytics_ICEFailed_category,analytics_ICEFailed_action,analytics_ICEFailed_label),_lastICEFailedTracked=sid)},this.trackICESuccess=function(sid){_ga&&sid&&_lastICESuccessTracked!==sid&&(_ga.send("event",analytics_ICESuccess_category,analytics_ICESuccess_action,analytics_ICESuccess_label),_lastICESuccessTracked=sid)},this.trackICENoSTUNCandidate=function(){_ga&&_ga.send("event",analytics_ICENoSTUNCandidate_category,analytics_ICENoSTUNCandidate_action,analytics_ICENoSTUNCandidate_label)},this.trackICETopology=function(topology){_ga&&_ga.send("event",analytics_ICETopology_category,analytics_ICETopology_action,topology)},this.trackGetUserMediaSuccess=function(){_ga&&_ga.send("event",analytics_GetUserMedia_category,analytics_GetUserMedia_action,analytics_GetUserMedia_label)},this.trackGetUserMediaErrorNoTrack=function(){_ga&&_ga.send("event",analytics_GetUserMediaErrorNoTrack_category,analytics_GetUserMediaErrorNoTrack_action,analytics_GetUserMediaErrorNoTrack_label)},this.trackGetUserMediaError=function(){_ga&&_ga.send("event",analytics_GetUserMediaError_category,analytics_GetUserMediaError_action,analytics_GetUserMediaError_label)},this.trackCodecsUsed=function(audioCodec,videoCodec){_ga&&_ga.send("event",analytics_CodecsUsed_category,analytics_CodecsUsed_action,audioCodec+"|"+videoCodec)},this.negotiationTime=function(){return _endNegotiationTime&&_startNegotiationTime?_endNegotiationTime<_startNegotiationTime?null:_endNegotiationTime-_startNegotiationTime:null},this.startNegotiationTime=function(time){_startNegotiationTime=time||(new Date).getTime(),_pendingComputation=!0},this.endNegotiationTime=function(time){_pendingComputation&&(_endNegotiationTime=time||(new Date).getTime(),_pendingComputation=!1)},this.trackNegotiationTime=function(){if(_ga){var duration=this.negotiationTime();duration&&_ga.send("event",analytics_NegotiationTime_category,analytics_NegotiationTime_action,analytics_NegotiationTime_label,duration),_endNegotiationTime=null,_startNegotiationTime=null}},this.resetProvider=function(){_ga=null},this.trackCallSuccessNumber=function(type){type&&type.length>0&&_ga&&_ga.send("event",analytics_NbSuccessCall_category,analytics_NbSuccessCall_action,type)},this.trackCallDuration=function(durationMs){if(_ga&&angular.isDefined(durationMs)&&durationMs>=0){var durationCategoryLabel,durationInSeconds=Math.round(durationMs/1e3);durationCategoryLabel=durationInSeconds<15?"very_short_less_15s":durationInSeconds<30?"very_short_less_30s":durationInSeconds<60?"short_less_60s":durationInSeconds<120?"short_less_120s":durationInSeconds<300?"short_less_300s":durationInSeconds<600?"normal_less_600s":durationInSeconds<1200?"normal_less_1200s":durationInSeconds<1800?"normal_less_1800s":durationInSeconds<3600?"long_less_3600s":"long_more_3600s",_ga.send("event",analytics_CallsDuration_category,analytics_CallsDuration_action,durationCategoryLabel)}},this.trackDragAndDrop=function(type){_ga&&_ga.send("event",analytics_DragAndDrop_category,analytics_DragAndDrop_action,type)},this.inviteContactsFromProvider=function(provider,number){_ga&&_ga.send("event",analytics_InviteFromProvider_category,analytics_InviteFromProvider_action,provider,number)}}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0__);angular.module("rainbow").service("usersService",["$q","$log",function($q,$log){var that=this;this.started=!1,this.start=function(stats){$log.info("[usersService] === STARTING ==="),that.started=!0;var startDate=performance.now();$log.info("[usersService] start"),that.contactsInRoster=that.getAllRosterContacts(),that.lastNameList=that.orderContacts("lastname"),that.firstNameList=that.orderContacts("firstname"),that.companyNameList=that.orderContacts("company"),that.contactServiceSubscription=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0___default.a.subscribe((function(event){"ON_CONTACT_ROSTER_UPDATE_EVENT"===event.name&&that.onContactUpdatedEvent()}));var startDuration=Math.round(performance.now()-startDate);return stats.push({service:"usersService",startDuration:startDuration}),$log.info("[usersService] === STARTED ("+startDuration+" ms) ==="),$q.when()},this.stop=function(){return $log.info("[usersService] === STOPPING ==="),that.started&&(that.started=!1),that.contactServiceSubscription&&that.contactServiceSubscription.unsubscribe(),$log.info("[usersService] === STOPPED ==="),$q.when()},this.onContactUpdatedEvent=function(){$log.info("[usersService] onContactUpdatedEvent");var newRosterList=that.getAllRosterContacts();newRosterList.length-that.contactsInRoster.length!=0&&($log.info("[usersService] onContactUpdatedEvent - update all user lists"),that.contactsInRoster=newRosterList,that.lastNameList=that.orderContacts("lastname"),that.firstNameList=that.orderContacts("firstname"),that.companyNameList=that.orderContacts("company"))},this.getLastNameList=function(){return that.lastNameList},this.getFirstNameList=function(){return that.firstNameList},this.getCompanyNameList=function(){return that.companyNameList},this.getAllRosterContacts=function(){return _src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0___default.a.getContacts().filter((function(contact){return contact.displayName&&contact.roster}))},this.addSeparators=function(users,sortByMember){var result=[],label="",index=0,paramExtractor=null;return paramExtractor="company"!==sortByMember?function(user){return user[sortByMember].charAt(0)}:function(user){return user.company.name},users.forEach((function(user){var sortString=paramExtractor(user).toUpperCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"");label!==sortString&&(label=sortString,result.push({value:label,type:"separator",id:label,index:index++})),user.index=index++,result.push(user)})),result},this.orderContacts=function(criteria){var orderedUsers=that.getOrderedUsers(that.contactsInRoster,criteria);return that.addSeparators(orderedUsers,criteria)},this.getFilterAndOrderUsersGroupedByOrderLabel=function(users,orderType,filterType,isGroup){isGroup=Boolean(!0&isGroup);var listOrderUsers=that.getFilterAndOrderUsers(users,orderType,filterType,isGroup);return"firstname"===orderType?that.addSeparators(listOrderUsers,"firstname"):"company"===orderType?that.addSeparators(listOrderUsers,"company"):that.addSeparators(listOrderUsers,"lastname")},this.getFilterAndOrderUsersGroupedByOrderLabelAndUpdateActivity=function(users,orderType,filterType,isGroup){isGroup=Boolean(!0&isGroup);var listOrderUsers=that.getFilterAndOrderUsers(users,orderType,filterType,isGroup);return"firstname"===orderType?that.addSeparators(listOrderUsers,"firstname"):"company"===orderType?that.addSeparators(listOrderUsers,"company"):that.addSeparators(listOrderUsers,"lastname")},this.getFilterAndOrderUsers=function(users,orderType,filterType,isGroup){var listFilteredUsers=that.getFilteredUsers(users,filterType,isGroup);return that.getOrderedUsers(listFilteredUsers,orderType)},this.getFilteredUsers=function(contactList,filter,isGroup){var contacts;return contacts=(contacts=contactList.filter((function(contact){if("separator"===contact.type)return!0;var isExistingContact=contact.displayName&&contact.roster||isGroup,isContactOnline="offline"!==contact.status&&"wait"!==contact.status&&"xa"!==contact.status&&"unknown"!==contact.status,isContactPending="wait"===contact.status,isContactTerminated=contact.isTerminated;return"online"===filter?isExistingContact&&isContactOnline:"offline"===filter?isExistingContact&&!isContactOnline&&!isContactTerminated:"pending"===filter?isExistingContact&&isContactPending:"all"===filter?isExistingContact&&!isContactTerminated:isExistingContact}))).filter((function(contact,index){return!!("separator"!==contact.type||contacts[index+1]&&"separator"!==contacts[index+1].type)}))},this.getOrderedUsers=function(contactList,orderType){return contactList.sort((function(aa,bb){var sortName;if("lastname"===orderType)return 0===(sortName=aa.lastname.localeCompare(bb.lastname))?aa.firstname.localeCompare(bb.firstname):sortName;if("firstname"===orderType)return 0===(sortName=aa.firstname.localeCompare(bb.firstname))?aa.lastname.localeCompare(bb.lastname):sortName;if("company"===orderType){var sortCompany=aa.company.name.localeCompare(bb.company.name);return 0===sortCompany?aa.lastname.localeCompare(bb.lastname):sortCompany}return 0}))}}])},function(module,exports,__webpack_require__){(function(Buffer){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var crypto_js_1=__webpack_require__(18),crypto_js_2=__webpack_require__(18),fileDescriptor_1=__webpack_require__(54),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),logger_service_1=__webpack_require__(15),fileStorage_service_1=__webpack_require__(25),moment=__webpack_require__(3),LocalImage=function(){function LocalImage(fd,blob){_classCallCheck(this,LocalImage),blob&&(this.url=URL.createObjectURL(blob)),this.fd=fd}return _createClass(LocalImage,[{key:"release",value:function(){URL.revokeObjectURL(this.url)}}]),LocalImage}();exports.LocalImage=LocalImage;var FileServerService=function(){function FileServerService($q,$http,$injector,TransfertPromiseQueue,FileDescriptorEventHandler,errorHelperService,$rootScope){_classCallCheck(this,FileServerService),this.$q=$q,this.$http=$http,this.$injector=$injector,this.TransfertPromiseQueue=TransfertPromiseQueue,this.FileDescriptorEventHandler=FileDescriptorEventHandler,this.errorHelperService=errorHelperService,this.$rootScope=$rootScope,this.ONE_KILOBYTE=1024,this.ONE_MEGABYTE=1048576,this.ONE_GIGABYTE=1073741824,this.started=!1,this.thumbnailPromises=[],this.thumbnailPreviewPromises=[],this.authService=auth_service_1.default,this.xmppService=xmpp_service_1.default,this.logger=logger_service_1.default,this.fileStorageService=fileStorage_service_1.default,this.centralizedService=null}return _createClass(FileServerService,[{key:"start",value:function(stats){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee438(){var startDate,startDuration;return regenerator_default.a.wrap((function(_context439){for(;;)switch(_context439.prev=_context439.next){case 0:if(_context439.prev=0,this.logger.info("[FileServerService] === STARTING ==="),_context439.t0="caches"in self,!_context439.t0){_context439.next=7;break}return _context439.next=6,caches.open("RainbowImageCache");case 6:this.cache=_context439.sent;case 7:return startDate=performance.now(),this.started=!1,this.portalURL=config.restServerUrl+"/api/rainbow/fileserver/v1.0/files",_context439.next=12,this.getServercapabilities();case 12:try{this.centralizedService=this.$injector.get("centralizedService")}catch(error){}this.attachHandlers(),this.transfertPromiseQueue=this.TransfertPromiseQueue.create(),startDuration=Math.round(performance.now()-startDate),stats.push({service:"FileServerService",startDuration:startDuration}),this.logger.info("[FileServerService] === STARTED ("+startDuration+" ms) ==="),_context439.next=21;break;case 18:_context439.prev=18,_context439.t1=_context439.catch(0),this.logger.error("[FileServerService] === STARTING FAILURE === "+_context439.t1.message);case 21:case"end":return _context439.stop()}}),_callee438,this,[[0,18]])})))}},{key:"stop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee439(){return regenerator_default.a.wrap((function(_context440){for(;;)switch(_context440.prev=_context440.next){case 0:this.logger.info("[FileServerService] === STOPPING ==="),this.started&&(this.started=!1),this.logger.info("[FileServerService] === STOPPED ===");case 1:case"end":return _context440.stop()}}),_callee439,this)})))}},{key:"attachHandlers",value:function(){var _this256=this;this.removeHandlers(),this.fileDescriptorEventHandler=this.FileDescriptorEventHandler.create(this),this.fileMessageHandlerRef||(this.fileMessageHandlerRef=this.xmppService.addHandler((function(stanza){return setTimeout((function(){_this256.fileDescriptorEventHandler.onManagementMessageReceived(stanza)}),250),!0}),null,"message","management"))}},{key:"removeHandlers",value:function(){this.fileDescriptorEventHandler=void 0,this.fileMessageHandlerRef=void 0}},{key:"getFileRange",value:function(){return 4*this.ONE_MEGABYTE}},{key:"getFileDescriptorPublicUrl",value:function(fileDescriptor){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee440(){var nowDate,duration,serverUrl,headers,response,responseData,mdate;return regenerator_default.a.wrap((function(_context441){for(;;)switch(_context441.prev=_context441.next){case 0:if(fileDescriptor){_context441.next=2;break}return _context441.abrupt("return",null);case 2:if(this.centralizedService.isDesktopApp()||!fileDescriptor.publicUrl){_context441.next=7;break}if(this.logger.info(">getFileDescriptorPublicUrl: publicUrlExpirationDate="+moment(fileDescriptor.publicUrlExpirationDate).format("DD-MM-YYYY_H_mm_ss")),this.logger.info(">getFileDescriptorPublicUrl: isDateExpired="+fileDescriptor.isPublicUrlExpired()),nowDate=moment(),duration=moment.duration(moment(fileDescriptor.publicUrlExpirationDate).diff(nowDate)).asSeconds(),this.logger.info(">getFileDescriptorPublicUrl: date expiration="+duration),!(duration>1800)){_context441.next=7;break}return _context441.abrupt("return",fileDescriptor.publicUrl);case 7:return _context441.prev=7,serverUrl=new URL(this.portalURL+"/"+fileDescriptor.id+"/temporary-url"),(headers=this.authService.getRequestHeader())["Content-Type"]="application/json",_context441.next=12,fetch(serverUrl.href,{method:"GET",headers:headers});case 12:if(!(response=_context441.sent).ok){_context441.next=20;break}return _context441.next=16,response.json();case 16:return responseData=_context441.sent,fileDescriptor.publicUrl=responseData.data.url,mdate=moment(responseData.data.expirationDate),_context441.abrupt("return",(mdate.isValid()&&(fileDescriptor.publicUrlExpirationDate=mdate.toDate(),this.logger.info(">getFileDescriptorPublicUrl: Get PublicUrl Success, publicUrlExpirationDate="+moment(fileDescriptor.publicUrlExpirationDate).format("DD-MM-YYYY_H_mm_ss"))),this.logger.info("Get PublicUrl Success"),fileDescriptor.publicUrl));case 20:return _context441.abrupt("return",null);case 23:throw _context441.prev=23,_context441.t0=_context441.catch(7),this.logger.error("stopPstnConference - ERROR"),this.errorHelperService.handleError(_context441.t0);case 27:case"end":return _context441.stop()}}),_callee440,this,[[7,23]])})))}},{key:"getFileDescriptorUrl",value:function(fileDescriptor){var thumbnail=arguments.length>1&&void 0!==arguments[1]&&arguments[1],cacheEnabled=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee441(){var blob,cacheRequest,cacheResponse;return regenerator_default.a.wrap((function(_context442){for(;;)switch(_context442.prev=_context442.next){case 0:if(_context442.prev=0,blob=null,cacheRequest=new Request("/rainbowImages/".concat(thumbnail?"thumbnail/":"").concat(fileDescriptor.id)),!cacheEnabled||!this.cache){_context442.next=12;break}return _context442.next=6,this.cache.match(cacheRequest);case 6:if(cacheResponse=_context442.sent,_context442.t0=cacheResponse,!_context442.t0){_context442.next=12;break}return _context442.next=11,cacheResponse.blob();case 11:blob=_context442.sent;case 12:if(_context442.t1=blob,_context442.t1){_context442.next=33;break}if(!thumbnail){_context442.next=25;break}if(!fileDescriptor.previewBlob){_context442.next=19;break}_context442.t2=fileDescriptor.previewBlob,_context442.next=22;break;case 19:return _context442.next=21,this.getBlobThumbnailFromFileDescriptor(fileDescriptor);case 21:_context442.t2=_context442.sent;case 22:blob=_context442.t2,_context442.next=32;break;case 25:return _context442.next=27,this.getBlobFromFileDescriptor(fileDescriptor,!1,null);case 27:if(blob=_context442.sent,_context442.t3=!fileDescriptor.orientation&&fileDescriptor.isImage(),!_context442.t3){_context442.next=32;break}return _context442.next=32,this.setImageOrientationForFileDescriptor(fileDescriptor,blob).catch((function(){}));case 32:cacheEnabled&&this.cache&&this.cache.put(cacheRequest,new Response(blob));case 33:return _context442.abrupt("return",URL.createObjectURL(blob));case 36:throw _context442.prev=36,_context442.t4=_context442.catch(0),new Error("getFileDescriptorUrl(".concat(fileDescriptor.id,", ").concat(thumbnail,") -- failure -- ").concat(_context442.t4));case 39:case"end":return _context442.stop()}}),_callee441,this,[[0,36]])})))}},{key:"removeFileDescriptorFromCache",value:function(fileDescriptor){this.cache&&(this.cache.delete("/rainbowImages/thumbnail/"+fileDescriptor.id),this.cache.delete("/rainbowImages/"+fileDescriptor.id))}},{key:"clearCache",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee442(){return regenerator_default.a.wrap((function(_context443){for(;;)switch(_context443.prev=_context443.next){case 0:if(_context443.t0=this.cache,!_context443.t0){_context443.next=7;break}return _context443.next=4,caches.delete("RainbowImageCache");case 4:return _context443.next=6,caches.open("RainbowImageCache");case 6:this.cache=_context443.sent;case 7:case"end":return _context443.stop()}}),_callee442,this)})))}},{key:"getLocalImage",value:function(fileDescriptorId,thumbnail){var forced=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee443(){var fileDescriptor,blob;return regenerator_default.a.wrap((function(_context444){for(;;)switch(_context444.prev=_context444.next){case 0:if(_context444.prev=0,fileDescriptor=this.fileStorageService.getFileDescriptorById(fileDescriptorId),_context444.t0=fileDescriptor,_context444.t0){_context444.next=7;break}return _context444.next=6,this.fileStorageService.retrieveAndStoreOneFileDescriptor(fileDescriptorId);case 6:fileDescriptor=_context444.sent;case 7:if(fileDescriptor.fileName.includes("__rboriginal__")&&(thumbnail=!1),blob=null,!thumbnail||!fileDescriptor.previewBlob||forced){_context444.next=13;break}_context444.t1=fileDescriptor.previewBlob,_context444.next=23;break;case 13:if(!thumbnail){_context444.next=19;break}return _context444.next=16,this.getLargeBlobThumbnail(fileDescriptor);case 16:_context444.t2=_context444.sent,_context444.next=22;break;case 19:return _context444.next=21,this.getBlobFromFileDescriptor(fileDescriptor,!1,null);case 21:_context444.t2=_context444.sent;case 22:_context444.t1=_context444.t2;case 23:return blob=_context444.t1,_context444.abrupt("return",new LocalImage(fileDescriptor,blob));case 27:throw _context444.prev=27,_context444.t3=_context444.catch(0),this.logger.warn("[fileServerService] getFileLocalURL -- no file descriptor found with ".concat(fileDescriptorId,' + " id.')),_context444.t3;case 30:case"end":return _context444.stop()}}),_callee443,this,[[0,27]])})))}},{key:"getLargeBlobThumbnail",value:function(fileDescriptor){var url=fileDescriptor.url+"?thumbnail500=true";return this.getBlobFileDescriptorFromUrl(url,fileDescriptor)}},{key:"getPartialDataFromServer",value:function(fileDescriptor,url,minRange,maxRange,index,cancelable,currentLoadingRef){var _this257=this;return this.$q((function(resolve,reject){_this257.$http({method:"GET",url:url,headers:_this257.authService.getRequestHeaderWithRange("bytes="+minRange+"-"+maxRange),responseType:"arraybuffer",timeout:fileDescriptor.cancelTransfertDefer.promise,eventHandlers:{progress:function(event){if(fileDescriptor.loadingRef===currentLoadingRef){var percentChunk=Math.floor(100*event.loaded/event.total);fileDescriptor&&(fileDescriptor.chunkPercentArray[index]=percentChunk,_this257.logger.info("[FileServerService] getPartialDataFromServer ProgressChunk: "+percentChunk),fileDescriptor.updateProgressInfo())}else _this257.logger.info("[FileServerService] This load has been canceled - NTIA")}}}).then((function(response){resolve({data:response.data,index:index})}),(function(errorResponse){var error=_this257.errorHelperService.handleError(errorResponse),errorDataObj=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(errorResponse.data))),translatedErrorMessage=_this257.errorHelperService.getLocalizedError(errorDataObj.errorDetailsCode);_this257.logger.error(translatedErrorMessage),reject(error)}))}))}},{key:"getFileStorageService",value:function(){return this.fileStorageService}},{key:"getBlobThumbnailFromFileDescriptor",value:function(fileDescriptor){var _this258=this;if(fileDescriptor.thumbnail.isThumbnailAvailable()||fileDescriptor.isImage()){var defered=this.$q.defer(),fullImage=!1,url=fileDescriptor.url;if(fileDescriptor.thumbnail.isThumbnailAvailable()){if(this.thumbnailPreviewPromises[fileDescriptor.id])return this.logger.info("[FileServerService] getBlobThumbnailFromFileDescriptor preview for "+fileDescriptor.id+" already lauched"),this.thumbnailPreviewPromises[fileDescriptor.id].promise;this.thumbnailPreviewPromises[fileDescriptor.id]=defered,url+="?thumbnail500=true"}else{if(this.thumbnailPromises[fileDescriptor.id])return this.logger.info("[FileServerService] getBlobThumbnailFromFileDescriptor full image update for "+fileDescriptor.id+" already lauched"),this.thumbnailPromises[fileDescriptor.id].promise;this.thumbnailPromises[fileDescriptor.id]=defered,fileDescriptor.uploadedDate&&(url+="?update="+crypto_js_1.MD5(crypto_js_2.enc.Latin1.parse(fileDescriptor.uploadedDate)).toString(crypto_js_2.enc.Hex)),fullImage=!0}return this.getBlobFileDescriptorFromUrl(url,fileDescriptor).then((function(blob){return __awaiter(_this258,void 0,void 0,regenerator_default.a.mark((function _callee444(){var promiseArray;return regenerator_default.a.wrap((function(_context445){for(;;)switch(_context445.prev=_context445.next){case 0:if((fileDescriptor=this.fileStorageService.getFileDescriptorById(fileDescriptor.id)).previewBlob?fileDescriptor.previewBlob&&!fullImage&&(fileDescriptor.previewBlob=blob):fileDescriptor.previewBlob=blob,fullImage||(fileDescriptor.previewDownloaded=!0),_context445.t0=!fileDescriptor.orientation&&fileDescriptor.isImage()&&fullImage,!_context445.t0){_context445.next=6;break}return _context445.next=6,this.setImageOrientationForFileDescriptor(fileDescriptor,blob).catch((function(){}));case 6:fileDescriptor.previewBlobSubject.next(fileDescriptor.previewBlob),this.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"success",type:"download",fileDesc:fileDescriptor}),(promiseArray=fullImage?this.thumbnailPromises:this.thumbnailPreviewPromises)[fileDescriptor.id]&&promiseArray[fileDescriptor.id].resolve(fileDescriptor.previewBlob),delete promiseArray[fileDescriptor.id],defered.resolve(blob);case 10:case"end":return _context445.stop()}}),_callee444,this)})))})).catch((function(error){_this258.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"download",message:error.message,fileDesc:fileDescriptor}),delete(fullImage?_this258.thumbnailPromises:_this258.thumbnailPreviewPromises)[fileDescriptor.id],defered.reject(error)})),defered.promise}return this.$q.reject("No available thumbnail")}},{key:"getBlobFromFileDescriptor",value:function(fileDescriptor){var _this259=this,cancelable=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],actionOnPartialResponse=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!fileDescriptor)return this.logger.warn("[FileServerService] getBlobFromFileDescriptor : missing file descriptor"),this.$q.reject();if(this.logger.info("[FileServerService] getBlobFromFileDescriptor: "+fileDescriptor.id),fileDescriptor.state!==fileDescriptor_1.FileState.UPLOADED)return this.logger.warn("[FileServerService] getBlobFromFileDescriptor : file is not in uploaded state="+fileDescriptor.state),this.$q.reject();var url=fileDescriptor.url;fileDescriptor.uploadedDate&&(url+="?update="+crypto_js_1.MD5(crypto_js_2.enc.Latin1.parse(fileDescriptor.uploadedDate)).toString(crypto_js_2.enc.Hex));var range=this.getFileRange();if(this.capabilities.maxChunkSizeDownload&&0!==fileDescriptor.size&&fileDescriptor.size>range){var _ret=function(){fileDescriptor.size>=100*range&&(range=fileDescriptor.size/100+_this259.ONE_KILOBYTE,_this259.logger.debug("[FileServerService] changing chunk size: "+range));var defered=_this259.$q.defer(),blobArray=new Array,promiseArray=[];fileDescriptor.state=fileDescriptor_1.FileState.DOWNLOADING,fileDescriptor.chunkTotalNumber=Math.ceil(fileDescriptor.size/range),fileDescriptor.chunkPerformedPercent=0,fileDescriptor.chunkWrittenInDisk=-1,fileDescriptor.chunkPercentArray=new Array(fileDescriptor.chunkTotalNumber),fileDescriptor.chunkPercentArray.fill(0);var currentLoadingRef=++fileDescriptor.loadingRef;fileDescriptor.cancelTransfertDefer=_this259.$q.defer(),fileDescriptor.updateProgressInfo(),_this259.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:fileDescriptor,cancelable:cancelable}),_this259.logger.info("[FileServerService] getBlobFromFileDescriptor: need to download "+fileDescriptor.chunkTotalNumber+" chunks");for(var _loop2=function(i,minRange,_maxRange,repetition){_maxRange=_maxRange<fileDescriptor.size?_maxRange:fileDescriptor.size,promiseArray.push((function(){var promiseArrayDeferred=_this259.$q.defer();return maxRange=_maxRange,_this259.getPartialDataFromServer(fileDescriptor,url,minRange,_maxRange,i,cancelable,currentLoadingRef).then((function(response){if(fileDescriptor.loadingRef===currentLoadingRef)return maxRange=_maxRange,fileDescriptor.updateProgressInfo(),_this259.logger.info("[FileServerService] getBlobFromFileDescriptor : chunk"+i+" downloaded"),_this259.logger.debug("[FileServerService] refreshFilePercent: chunkPerformedPercent="+fileDescriptor.chunkPerformedPercent),blobArray[response.index]=response.data,_this259.writeAvailableChunksInDisk(fileDescriptor,blobArray),_this259.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:fileDescriptor,cancelable:cancelable}),actionOnPartialResponse?actionOnPartialResponse(response,fileDescriptor.id).then((function(){return promiseArrayDeferred.resolve(response.data)})):promiseArrayDeferred.resolve(response);_this259.logger.info("[FileServerService] This load has been canceled - NTIA")})).catch((function(error){_this259.logger.info("[FileServerService] error on chunk download="+error),promiseArrayDeferred.reject(error)})),promiseArrayDeferred.promise})),maxRange=_maxRange},i=0,minRange=0,maxRange=range-1,repetition=Math.ceil(fileDescriptor.size/range);repetition>0;i++,repetition--,minRange+=range,maxRange+=range)_loop2(i,minRange,maxRange);return{v:(_this259.transfertPromiseQueue.addPromiseArray(fileDescriptor.id,promiseArray,(function(){if(fileDescriptor.loadingRef===currentLoadingRef){_this259.logger.info("[FileServerService] getBlobFromFileDescriptor: promisesCompletion");var blob=new Blob(blobArray,{type:fileDescriptor.typeMIME});_this259.logger.info("[FileServerService] getBlobFromFileDescriptor success"),fileDescriptor.setState(fileDescriptor_1.FileState.UPLOADED),fileDescriptor.chunkTotalNumber=0,fileDescriptor.chunkPerformedPercent=0,fileDescriptor.updateProgressInfo(),_this259.writeAvailableChunksInDisk(fileDescriptor,blobArray),fileDescriptor.writeStream&&(_this259.logger.info("[FileServerService] Close WriteStream"),fileDescriptor.writeStream.end()),_this259.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:fileDescriptor}),defered.resolve(blob)}else _this259.logger.info("[FileServerService] This load has been canceled - NTIA")}),(function(errorResponse){if(fileDescriptor.loadingRef===currentLoadingRef){var error=_this259.errorHelperService.handleError(errorResponse);fileDescriptor.setState(fileDescriptor_1.FileState.UPLOADED),fileDescriptor.chunkTotalNumber=0,fileDescriptor.chunkPerformedPercent=0;var errorDataObj=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(errorResponse.data))),translatedErrorMessage=_this259.errorHelperService.getLocalizedError(errorDataObj.errorDetailsCode);_this259.logger.error(translatedErrorMessage),_this259.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"download",message:translatedErrorMessage||error.message,fileDesc:fileDescriptor}),defered.reject(error)}else _this259.logger.info("[FileServerService] This load has been canceled - NTIA")})),defered.promise)}}();if("object"===typeof _ret)return _ret.v}return fileDescriptor.state=fileDescriptor_1.FileState.DOWNLOADING,this.getBlobFileDescriptorFromUrl(url,fileDescriptor).then((function(blob){return _this259.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor}),_this259.$q.resolve(blob)})).catch((function(error){return fileDescriptor.state=fileDescriptor_1.FileState.UPLOADED,_this259.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor}),_this259.logger.info("[FileServerService] arrayPromise : error "+error.message),_this259.$q.reject(error)}))}},{key:"writeAvailableChunksInDisk",value:function(fd,blobArray){if(this.logger.debug("[FileServerService] >writeAvailableChunksInDisk"),fd.writeStream){var start=fd.chunkWrittenInDisk+1;this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : We start at "+start);for(var _index5=start;_index5<blobArray.length;_index5++){if(!blobArray[_index5]){this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : Blob "+_index5+" NOT available");break}this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : Blob "+_index5+" available"),fd.chunkWrittenInDisk=_index5,fd.writeStream.write(new Buffer(blobArray[_index5])),blobArray[_index5]=null}}}},{key:"getBlobFileDescriptorFromUrl",value:function(url,fileDescriptor){var _this260=this;return this.$q((function(resolve,reject){_this260.logger.debug("[FileServerService] >getBlobFileDescriptorFromUrl: "+url),fileDescriptor.chunkTotalNumber=1,fileDescriptor.chunkPerformedPercent=0,fileDescriptor.chunkPercentArray=new Array(fileDescriptor.chunkTotalNumber),fileDescriptor.chunkPercentArray.fill(0);var currentLoadingRef=++fileDescriptor.loadingRef;fileDescriptor.cancelTransfertDefer=_this260.$q.defer(),fileDescriptor.updateProgressInfo(),_this260.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor,cancelable:!1}),_this260.$http({method:"GET",url:url,headers:_this260.authService.getRequestHeader(),responseType:"arraybuffer",timeout:fileDescriptor.cancelTransfertDefer.promise,eventHandlers:{progress:function(event){fileDescriptor.loadingRef===currentLoadingRef?(fileDescriptor.chunkPercentArray[0]=Math.floor(100*event.loaded/event.total),fileDescriptor.updateProgressInfo()):_this260.logger.info("[FileServerService] This load has been canceled - NTIA")}}}).then((function(response){if(fileDescriptor.loadingRef===currentLoadingRef){var blob=new Blob([response.data],{type:fileDescriptor.typeMIME});fileDescriptor.state=fileDescriptor_1.FileState.UPLOADED,fileDescriptor.chunkPerformedPercent=0,fileDescriptor.updateProgressInfo(),_this260.logger.debug("[FileServerService] getBlobFileDescriptorFromUrl success"),resolve(blob)}else _this260.logger.info("[FileServerService] This load has been canceled - NTIA")}),(function(errorResponse){if(fileDescriptor.loadingRef===currentLoadingRef){fileDescriptor.state=fileDescriptor_1.FileState.UPLOADED;var error=_this260.errorHelperService.handleError(errorResponse);_this260.logger.error("[FileServerService] "+error.translatedMessage),reject(error)}else _this260.logger.info("[FileServerService] This load has been canceled - NTIA")}))}))}},{key:"getBlobUrlAndOrientationByFileDescriptorId",value:function(id){var _this261=this;return this.$q((function(resolve,reject){var fileDescriptor=_this261.fileStorageService.getFileDescriptorById(id);fileDescriptor?_this261.getBlobFromFileDescriptor(fileDescriptor,!1,null).then((function(blob){var result={id:id,blob:blob,blobUrl:URL.createObjectURL(blob)};if(fileDescriptor.orientation)return result.orientation=fileDescriptor.orientation,fileDescriptor.blobOrientationSubject.next(result),void resolve(result);_this261.setImageOrientationForFileDescriptor(fileDescriptor,blob).then((function(orientation){result.orientation=orientation,fileDescriptor.blobOrientationSubject.next(result),resolve(result)})).catch((function(){fileDescriptor.blobOrientationSubject.next(result),resolve(result)}))})).catch((function(error){reject(error)})):(_this261.logger.error("[FileServerService] getBlobUrlAndOrientationById no file descriptor found for ID "+id),reject(new Error("[FileServerService] getBlobUrlAndOrientationById no file descriptor found")))}))}},{key:"setImageOrientationForFileDescriptor",value:function(fileDescriptor,blob){return new Promise((function(resolve,reject){if(fileDescriptor&&fileDescriptor.isImage()){var reader=new FileReader;reader.onload=function(e){fileDescriptor.orientation=1;var arrayBuffer=e.target.result,view=new DataView(arrayBuffer);if(65496===view.getUint16(0,!1)){for(var length=view.byteLength,offset=2;offset<length;){if(view.getUint16(offset+2,!1)<=8)return void reject();var marker=view.getUint16(offset,!1);if(offset+=2,65505===marker){if(1165519206!==view.getUint32(offset+=2,!1))return void reject();var little=18761===view.getUint16(offset+=6,!1);offset+=view.getUint32(offset+4,little);var tags=view.getUint16(offset,little);offset+=2;for(var i=0;i<tags;i++)if(274===view.getUint16(offset+12*i,little)){var orientation=view.getUint16(offset+12*i+8,little);return fileDescriptor.orientation=orientation,void resolve(orientation)}}else{if(65280!=(65280&marker))break;offset+=view.getUint16(offset,!1)}}reject()}else reject()},reader.readAsArrayBuffer(blob)}else reject()}))}},{key:"uploadAFile",value:function(fileId,file,mime){var _this262=this;return this.$q((function(resolve,reject){var fileDescriptor=_this262.fileStorageService.getFileDescriptorById(fileId);fileDescriptor&&fileDescriptor.setState(fileDescriptor_1.FileState.UPLOADING),fileDescriptor.chunkPercentArray=new Array(fileDescriptor.chunkTotalNumber),fileDescriptor.chunkPercentArray.fill(0),fileDescriptor.cancelTransfertDefer=_this262.$q.defer(),_this262.$http({method:"PUT",url:_this262.portalURL+"/"+fileId,headers:_this262.authService.getPostHeader("application/octet-stream"),data:file,timeout:fileDescriptor.cancelTransfertDefer.promise,eventHandlers:{progress:function(event){var percentChunk=Math.floor(100*event.loaded/event.total);fileDescriptor&&(fileDescriptor.chunkPercentArray[0]=percentChunk,fileDescriptor.updateProgressInfo())}}}).then((function(response){var newFileDescriptor=_this262.fileStorageService.getFileDescriptorById(fileId);newFileDescriptor&&(newFileDescriptor.setState(fileDescriptor_1.FileState.UPLOADED),fileDescriptor.updateProgressInfo()),_this262.logger.info("[FileServerService] uploadAFile success"),_this262.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"success",type:"upload",fileDesc:newFileDescriptor}),_this262.fileStorageService.orderDocuments(),resolve(newFileDescriptor)}),(function(errorResponse){var error=_this262.errorHelperService.handleError(errorResponse);_this262.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:fileDescriptor}),reject(error),_this262.logger.error("[FileServerService] "+error.message)}))}))}},{key:"sendPartialDataToServer",value:function(fileDescriptor,filePart,minRange,maxRange,index,message,progressCallback){var _this263=this;return this.$q((function(resolve,reject){_this263.$http({method:"PUT",url:_this263.portalURL+"/"+fileDescriptor.id+"/parts/"+index,headers:_this263.authService.getPostHeaderWithRange("bytes "+minRange+"-"+maxRange+"/"+fileDescriptor.size,"application/octet-stream"),data:filePart,timeout:fileDescriptor.cancelTransfertDefer.promise,uploadEventHandlers:{progress:function(event){var percentChunk=Math.floor(100*event.loaded/event.total);fileDescriptor&&(fileDescriptor.chunkPercentArray[index]=percentChunk,fileDescriptor.updateProgressInfo(),_this263.logger.info("[FileServerService] sendPartialDataToServer chunk"+index+" percent="+percentChunk),_this263.logger.info("[FileServerService] sendPartialDataToServer total percent="+fileDescriptor.chunkPerformedPercent))}}}).then((function(response){var chunkResponse=response.data.data;_this263.logger.info("[FileServerService] sendPartialDataToServer success"),_this263.calculateMd5(filePart,(function(blobChecksum){_this263.logger.info("[FileServerService] sendPartialDataToServer calculated checksum="+blobChecksum),_this263.logger.info("[FileServerService] sendPartialDataToServer md5sum="+chunkResponse.md5sum),chunkResponse.md5sum.localeCompare(blobChecksum)?(_this263.logger.error("[FileServerService] Wrong Checksum for chunk detected: "+chunkResponse.md5sum+"/"+blobChecksum),reject({errorDetailsCode:500,message:"Wrong Checksum for chunk"})):(fileDescriptor.updateProgressInfo(),progressCallback&&progressCallback(message,fileDescriptor),_this263.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor,cancelable:!0}),resolve(chunkResponse))}))}),(function(errorResponse){var error=_this263.errorHelperService.handleError(errorResponse);reject(error),_this263.logger.error("[FileServerService] "+error.message)}))}))}},{key:"calculateMd5",value:function(blob,callback){var reader=new FileReader;reader.readAsBinaryString(blob),reader.onloadend=function(){callback(crypto_js_1.MD5(crypto_js_2.enc.Latin1.parse(reader.result)).toString(crypto_js_2.enc.Hex))}}},{key:"uploadAFileByChunk",value:function(fileDescriptor,file,message,progressCallback){var _this264=this;this.logger.info("[FileServerService] >uploadAFileByChunk");var range=this.getFileRange();if(range<file.size){file.size>=100*range&&(range=Math.round(file.size/100+this.ONE_KILOBYTE),this.logger.debug("[FileServerService] changing chunk size: "+range));var defered=this.$q.defer();fileDescriptor.chunkTotalNumber=Math.ceil(file.size/range),fileDescriptor.chunkPerformedPercent=0,fileDescriptor.chunkPercentArray=new Array(fileDescriptor.chunkTotalNumber),fileDescriptor.chunkPercentArray.fill(0),fileDescriptor.state=fileDescriptor_1.FileState.UPLOADING,fileDescriptor.cancelTransfertDefer=this.$q.defer(),this.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{fileDesc:fileDescriptor,cancelable:!0});for(var promiseArray=[],_loop3=function(minRange,repetition,_index6,_maxRange2){var max=_maxRange2<file.size?_maxRange2:file.size,blob=file.slice(minRange,max+1);promiseArray.push((function(){return _this264.sendPartialDataToServer(fileDescriptor,blob,minRange,max,_index6,message,progressCallback)}))},_index6=0,minRange=0,_maxRange2=range-1,repetition=Math.ceil(file.size/range);repetition>0;_index6++,repetition--,minRange+=range,_maxRange2+=range)_loop3(minRange,0,_index6,_maxRange2);return this.transfertPromiseQueue.addPromiseArray(fileDescriptor.id,promiseArray,(function(){_this264.$http({method:"PUT",url:_this264.portalURL+"/"+fileDescriptor.id+"/parts/end",headers:_this264.authService.getPostHeader("application/octet-stream")}).then((function(response){_this264.logger.info("[FileServerService] uploadAFileByChunk success"),fileDescriptor.setState(fileDescriptor_1.FileState.UPLOADED),fileDescriptor.chunkPerformed=0,fileDescriptor.chunkTotalNumber=0,fileDescriptor.chunkPerformedPercent=0,fileDescriptor.fileToSend=null,progressCallback&&progressCallback(message,fileDescriptor),_this264.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"success",type:"upload",fileDesc:fileDescriptor}),_this264.fileStorageService.orderDocuments(),_this264.fileStorageService.retrieveUserConsumption(),defered.resolve(fileDescriptor)}),(function(errorResponse){var error=_this264.errorHelperService.handleError(errorResponse);_this264.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:fileDescriptor}),defered.reject(error)}))}),(function(errorResponse){var error=_this264.errorHelperService.handleError(errorResponse);_this264.$rootScope.$broadcast("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:fileDescriptor}),defered.reject(error)})),defered.promise}return progressCallback&&progressCallback(message,fileDescriptor),this.uploadAFile(fileDescriptor.id,file,fileDescriptor.typeMIME).then((function(fileDescResponse){return _this264.logger.info("[FileServerService] uploadAFile success"),progressCallback&&progressCallback(message,fileDescriptor),fileDescResponse.fileToSend=null,_this264.fileStorageService.retrieveUserConsumption(),_this264.$q.resolve(fileDescriptor)}))}},{key:"isTransferInProgress",value:function(){return this.transfertPromiseQueue&&this.transfertPromiseQueue.isTransferInProgress()}},{key:"cancelAllTransfers",value:function(){this.transfertPromiseQueue&&this.transfertPromiseQueue.cancelAllTransfers()}},{key:"cancelCurrentFiletransfer",value:function(id){var fileDesc=this.fileStorageService.getFileDescriptorById(id);fileDesc&&(fileDesc.cancelTransfertDefer&&fileDesc.cancelTransfertDefer.resolve(),fileDesc.state===fileDescriptor_1.FileState.UPLOADING?fileDesc.state=fileDescriptor_1.FileState.UPLOAD_CANCELED:fileDesc.state===fileDescriptor_1.FileState.DOWNLOADING&&(fileDesc.state=fileDescriptor_1.FileState.UPLOADED),fileDesc.progressSubject.next({})),this.transfertPromiseQueue&&this.transfertPromiseQueue.cancelCurrentFiletransfer(id)}},{key:"getServercapabilities",value:function(){var _this265=this;return this.$q((function(resolve,reject){_this265.$http({method:"GET",url:config.restServerUrl+"/api/rainbow/fileserver/v1.0/capabilities",headers:_this265.authService.getRequestHeader()}).then((function(response){_this265.logger.info("[FileServerService] getServercapabilities -- success"),_this265.capabilities=response.data.data,resolve(_this265.capabilities)}),(function(errorResponse){var error=_this265.errorHelperService.handleError(errorResponse);_this265.logger.error("[FileServerService] getServercapabilities "+error.message),reject(error)}))}))}}]),FileServerService}();FileServerService.$inject=["$q","$http","$injector","TransfertPromiseQueue","FileDescriptorEventHandler","errorHelperService","$rootScope"],exports.FileServerService=FileServerService,angular.module("rainbow").service("fileServerService",FileServerService)}).call(this,__webpack_require__(57).Buffer)},function(module,exports,__webpack_require__){exports.byteLength=function(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(function(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;return 2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp),1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp),arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));return 1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")),parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},function(module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},function(module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0__);angular.module("rainbow").factory("FileDescriptorEventHandler",["$log","$rootScope",function($log,$rootScope){function FileDescriptorEventHandler(fileServerService){var that=this;this.fileServerService=fileServerService,this.fileStorageService=fileServerService.getFileStorageService(),that.onManagementMessageReceived=function(stanza){try{var stanzaElem=$(stanza);return stanzaElem.find("file").length>0?this.manageFileStanzaData(stanzaElem.find("file")):stanzaElem.find("thumbnail").length>0?this.manageThumbnailStanzaData(stanzaElem.find("thumbnail")):$log.info("[FileDescriptorEventHandler] onManagementMessageReceived  -- ignore the message"),!0}catch(error){return $log.error("[FileDescriptorEventHandler] onManagementMessageReceived ERROR "+error),!0}},that.manageFileStanzaData=function(stanza){for(var action=$(stanza).attr("action"),filesId=$(stanza).find("fileid"),updateConsumption=!1,i=0;i<filesId.length;i++){var fileId=$(filesId[i]).text(),fileDescriptor=this.fileStorageService.getFileDescriptorById(fileId);switch($log.info("[FileDescriptorEventHandler] manageFileStanzaData -- "+action+" fileDescriptor "+fileId),action){case"create":$log.debug("[FileDescriptorEventHandler] fileDescriptor "+fileId+" created on server -- do nothing");break;case"delete":fileDescriptor&&(fileDescriptor.ownerId===_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0___default.a.userContact.dbId&&"deleted"!==fileDescriptor.state&&(updateConsumption=!0),this.fileStorageService.deleteFileDescriptorFromCache(fileId),this.fileStorageService.deleteVoiceMessageFileDescriptor(fileId),$rootScope.$broadcast("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:fileId}));break;case"update":that.fileStorageService.retrieveAndStoreOneFileDescriptor(fileId,!0).then((function(fileDesc){$log.info("[FileDescriptorEventHandler] fileDescriptor retrieved"),!fileDesc.ownerId===_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_0___default.a.userContact.dbId&&this.fileStorageService.retrieveUserConsumption(),!fileDesc.previewBlob&&fileDesc.isThumbnailPossible()&&that.fileServerService.getBlobThumbnailFromFileDescriptor(fileDesc).then((function(blob){fileDesc.previewBlob=blob,fileDesc.previewBlobSubject.next(fileDesc.previewBlob),$rootScope.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:fileDesc.id})})).catch((function(error){$log.error("[FileDescriptorEventHandler] fileDescriptor retrieve error : ",error)}))})),that.fileStorageService.retrieveAndStoreOneVoiceMessageFileDescriptor(fileId)}}updateConsumption&&this.fileStorageService.retrieveUserConsumption()},that.manageThumbnailStanzaData=function(stanza){var action=$(stanza).attr("action"),fileId=$(stanza).find("fileid").text(),fileUrl=$(stanza).find("url").text(),fileMime=$(stanza).find("mime").text(),fileSize=$(stanza).find("size").text(),md5sum=$(stanza).find("md5sum").text(),originalWidth=$(stanza).find("originalWidth").text(),originalHeight=$(stanza).find("originalHeight").text();$log.info("[FileDescriptorEventHandler] manageThumbnailStanzaData -- "+action+" fileDescriptor "+fileId),$log.debug("[FileDescriptorEventHandler]   fileUrl="+fileUrl),$log.debug("[FileDescriptorEventHandler]   fileMime="+fileMime),$log.debug("[FileDescriptorEventHandler]   fileSize="+fileSize),$log.debug("[FileDescriptorEventHandler]   md5sum="+md5sum),$log.debug("[FileDescriptorEventHandler]   fileId="+fileId),"create"!==action&&"update"!==action||this.fileStorageService.retrieveAndStoreOneFileDescriptor(fileId).then((function(){var fileDescriptor=that.fileStorageService.getFileDescriptorById(fileId);fileDescriptor?($log.debug("[FileDescriptorEventHandler] updating Thumbnail of found FileDescriptor "+fileId),fileDescriptor.previewBlob&&!fileDescriptor.previewDownloaded||!fileDescriptor.previewBlob?($rootScope.$broadcast("ON_FILE_DESCRIPTOR_THUMBNAIL_READY",fileDescriptor.id),fileDescriptor.thumbnail.availableThumbnail=!0,fileDescriptor.thumbnail.md5sum=md5sum,fileDescriptor.thumbnail.size=fileSize,originalWidth&&originalHeight&&fileDescriptor.setOriginalImageDimensions(originalWidth,originalHeight),$log.info("[FileDescriptorEventHandler] preview not already downloaded for "+fileId+" -- download it"),that.fileServerService.getBlobThumbnailFromFileDescriptor(fileDescriptor).then((function(){$rootScope.$broadcast("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:fileDescriptor.id})}))):($rootScope.$broadcast("ON_FILE_DESCRIPTOR_THUMBNAIL_READY",fileDescriptor.id),$log.info("[FileDescriptorEventHandler] preview already downloaded for "+fileId+" -- do nothing"))):$log.error("[FileDescriptorEventHandler] FileDescriptor not found and we do nothing and its not OK")})).catch((function(){$log.error("[FileDescriptorEventHandler] FileDescriptor was not found on server...")}))}}return FileDescriptorEventHandler.create=function(fileServerService){return new FileDescriptorEventHandler(fileServerService)},FileDescriptorEventHandler}])},function(module,exports){angular.module("rainbow").service("extensionSharingService",["$q","$log","$rootScope",function($q,$log,$rootScope){var that=this;this.extensionFound=!1,this.minVersion="1.5.1",this.port=null,this.currentStreamId="screen",this.start=function(){this.extensionId=this.extensionId||this.getExtensionId(config.webservices.server);var defered=$q.defer();return $log.info("[extensionService] === STARTING ==="),window.chrome&&window.chrome.runtime?($log.info("[extensionService] Chrome extension - try to ping...",this.extensionId),chrome.runtime.sendMessage(this.extensionId,{type:"ping",data:null},null,(function(extensionMessageResponse){extensionMessageResponse&&"pong"===extensionMessageResponse.type?($log.info("[extensionService] Chrome extension - pong received"),$log.info("[extensionService] Chrome extension - extension installed and detected"),$log.info("[extensionService] Chrome extension - try to connect..."),that.port=chrome.runtime.connect(that.extensionId),that.port?($log.info("[extensionService] Chrome extension - port created"),that.port.onDisconnect.addListener((function(){$log.info("Extension DISCONNECTED"),that.extensionFound=!1,that.port=null})),that.port.onMessage.addListener((function(msg){switch($log.info("[extensionService] Chrome extension - connected"),msg.type){case"loginResponse":that.extensionFound=!0,$log.info("[extensionService] Chrome extension - ready!"),$log.info("[extensionService] === STARTED ==="),$rootScope.$broadcast("ON_EXTENSION_SHARING_READY"),defered.resolve();break;case"getVersionResponse":0===msg.code&&msg.version?($rootScope.$broadcast("ON_EXTENSION_VERSION_UPDATED",msg.version),$log.info("[extensionService] Chrome extension - Detected version "+msg.version)):($rootScope.$broadcast("ON_EXTENSION_VERSION_UPDATED",null),$log.error("[extensionService] Chrome extension - No version received"));break;case"startsharingResponse":0===msg.code&&msg.streamID?($log.info("[extensionService] Chrome extension - stream ID received "+msg.streamID),$rootScope.$broadcast("ON_EXTENSION_SHARING_STREAM_FOUND",msg.streamID)):($log.info("[extensionService] Chrome extension - No stream ID received"),$rootScope.$broadcast("ON_EXTENSION_SHARING_STREAM_FOUND",null));break;case"endsharingResponse":$log.info("[extensionService] Chrome extension - end sharing session received")}})),that.port.postMessage({type:"login",data:null})):($log.info("[extensionService] Chrome extension - can't create port to contact the extension!!!"),$log.info("[extensionService] === STARTED ==="),defered.resolve())):($log.info("[extensionService] Chrome extension - not found"),chrome.runtime.lastError&&$log.info("[extensionService] Chrome extension - error "+chrome.runtime.lastError),defered.resolve())}))):($log.info("[extensionService] Not in chrome"),$log.info("[extensionService] === STARTED ==="),defered.resolve()),defered.promise},this.stop=function(){return $log.info("[extensionService] === STOPPING ==="),$log.info("[extensionService] === STOPPED ==="),$q.when()},this.getExtensionId=function(domain){return $log.info("Detected domain : "+domain),-1!==domain.indexOf("openrainbow.net")?"koefhabbjedbiecnldkolbijjfjinogj":-1!==domain.indexOf("openrainbow.org")?"ehamhlkmecdnidihfedapmplddlbidee":(-1!==domain.indexOf("openrainbow.com")||$log.error("Unkown domain, extension may not be available"),"mgneongoclkopahpapenfhbbeckhdmnj")},this.setExtensionId=function(extensionId){$log.info("set extensionId to : "+extensionId),this.extensionId=extensionId},this.getStreamToShareFromExtension=function(constraints){var defered=$q.defer(),callback=$rootScope.$on("ON_EXTENSION_SHARING_STREAM_FOUND",(function(__event,streamid){that.currentStreamId=streamid,callback(),streamid?(constraints.video.mandatory.chromeMediaSourceId=streamid,defered.resolve()):defered.reject()}));return this.port.postMessage({type:"startsharing",data:null}),defered.promise},this.getStreamId=function(){return this.currentStreamId},this.isExtensionInstalled=function(){var defered=$q.defer();return this.extensionFound?defered.resolve(!0):this.start().then((function(){defered.resolve(that.extensionFound)})),defered.promise},this.getExtensionVersion=function(){var defered=$q.defer(),callback=$rootScope.$on("ON_EXTENSION_VERSION_UPDATED",(function(__event,version){callback(),version?defered.resolve(version):defered.reject()}));return this.port.postMessage({type:"getVersion",data:null}),defered.promise},this.checkExtensionStatus=function(){var defered=$q.defer();return"chrome"!==adapter.default.browserDetails.browser?defered.resolve("notNeeded"):this.isExtensionInstalled().then((function(isInstalled){isInstalled?that.checkVersion().then((function(isUpToDate){isUpToDate?defered.resolve("good"):defered.resolve("needUpdate")})):defered.resolve("notInstalled")})),defered.promise},this.checkVersion=function(){var defered=$q.defer();return this.getExtensionVersion().then((function(version){defered.resolve(that.cmpVersions(version,that.minVersion)>=0)})),defered.promise},this.cmpVersions=function(curVersion,minVersion){var i,diff,regExStrip0=/(\.0+)+$/,segmentsA=curVersion.replace(regExStrip0,"").split("."),segmentsB=minVersion.replace(regExStrip0,"").split("."),length=Math.min(segmentsA.length,segmentsB.length);for(i=0;i<length;i++)if(diff=parseInt(segmentsA[i],10)-parseInt(segmentsB[i],10))return diff;return segmentsA.length-segmentsB.length}}])},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var uuid4=__webpack_require__(27),contact_service_1=__webpack_require__(1),settings_service_1=__webpack_require__(5),auth_service_1=__webpack_require__(2),rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24),xmpp_service_1=__webpack_require__(4),profile_service_1=__webpack_require__(6),room_service_1=__webpack_require__(33),WebConferenceService=function(){function WebConferenceService($q,$rootScope,$log,$http,$interval,videoService,errorHelperService,ConferenceSession,platformService,Conference,$translate){var _this266=this;_classCallCheck(this,WebConferenceService),this.$q=$q,this.$rootScope=$rootScope,this.$log=$log,this.$http=$http,this.$interval=$interval,this.videoService=videoService,this.errorHelperService=errorHelperService,this.ConferenceSession=ConferenceSession,this.platformService=platformService,this.Conference=Conference,this.$translate=$translate,this.MEDIATYPE={WEBRTC:"webrtc",WEBRTCSHARINGONLY:"webrtcSharingOnly",PSTNAUDIO:"pstnAudio"},this.xmppConnectionSubscription=null,this.started=!1,this.webConferenceRoom=null,this.webrtcConferenceId=null,this.webrtcSharingOnlyRoom=null,this.webrtcSharingOnlyConferenceId=null,this.jingleJid=null,this.makingCall=!1,this.mozaicViewModeValue=!0,this.connected=!1,this.disconnecting=!1,this.reconnecting={},this.audioProfileChanging=!1,this.activeSpeaker=!1,this.addingMedia=!1,this.settingsService=settings_service_1.default,this.authService=auth_service_1.default,this.xmppService=xmpp_service_1.default,this.profileService=profile_service_1.default,this.contactService=contact_service_1.default,this.roomService=room_service_1.default,this.conferenceEndpoints={},this.conferenceSessions={},this.rxSubject=new rxjs_1.Subject,this.attachLocalMediaStream=function(attach,conferenceSession){if(attach){var hasRemoteSessions=!1;if((conferenceSession.hasLocalVideo||conferenceSession.hasLocalSharing)&&(hasRemoteSessions=_this266.hasRemoteVideoOrSharingSession(conferenceSession.id)),conferenceSession.hasLocalVideo){var session=conferenceSession.sessions[conferenceSession.localVideoSessionId];if(session){var stream=conferenceSession.localStreams[session.localStreamId];hasRemoteSessions||conferenceSession.hasLocalSharing||_this266.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),stream,session.sid),_this266.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#conferenceVideoPip"),stream,session.sid)}}if(conferenceSession.hasLocalSharing){var _session=conferenceSession.sessions[conferenceSession.localSharingSessionId];if(_session){var _stream=conferenceSession.localStreams[_session.localStreamId];hasRemoteSessions?_this266.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#conferenceSharingPip"),_stream,_session.sid):_this266.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),_stream,_session.sid)}}}else _this266.videoService.RTC.clearMediaStream(angular.element("#minivideo"),null)}}return _createClass(WebConferenceService,[{key:"start",value:function(stats){var _this267=this;return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.$log.info("[WebConferenceService] === start skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((function(resolve){var startDate=performance.now();_this267.$log.info("[WebConferenceService] === STARTING ==="),_this267.confProvPortalURL=config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/",_this267.confPortalURL=config.restServerUrl+"/api/rainbow/conference/v1.0/conferences/",_this267.conferenceEndpoints={},_this267.conferenceSessions={},_this267.listeners=[],_this267.statsIntervals=[],_this267.connected=!0,_this267.disconnecting=!1,_this267.webConferenceRoom=null,_this267.webrtcConferenceId=null,_this267.webrtcSharingOnlyRoom=null,_this267.webrtcSharingOnlyConferenceId=null,_this267.jingleJid=null,_this267.makingCall=!1,_this267.videoGalleryElements=[],_this267.activeSpeaker=_this267.profileService.isFeatureEnabled(_this267.profileService.FeaturesEnum.BUBBLE_ACTIVE_SPEAKER),_this267.attachHandlers(),_this267.videoGalleryElementsNumber=5,_this267.started=!0;var startDuration=Math.round(performance.now()-startDate);stats.push({service:"WebConferenceService",startDuration:startDuration}),_this267.$log.info("[WebConferenceService] === STARTED ("+startDuration+" ms) ==="),resolve()}))}},{key:"stop",value:function(){return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.$log.info("[WebConferenceService] === stop skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):(this.$log.info("[WebConferenceService] === STOPPING ==="),this.started=!1,this.makingCall=!1,this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.listeners&&this.listeners.forEach((function(listenerDestroy){listenerDestroy()})),this.$log.info("[WebConferenceService] === STOPPED ==="),this.$q.when())}},{key:"attachHandlers",value:function(){var _this268=this;this.listeners.push(this.$rootScope.$on("ON_INPUT_DEVICE_CHANGED_EVENT",(function(){_this268.onAudioProfileChangeEvent()}))),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((function(event){_this268.$log.info("[WebConferenceService] onConnectionStateChangeEvent : "+event.name);try{"ON_XMPP_DISCONNECTED"===event.name?(_this268.$log.info("[WebConferenceService] onConnectionStateChangeEvent : disconnected"),_this268.connected=!1):"ON_XMPP_CONNECTED"===event.name&&(_this268.$log.info("[WebConferenceService] onConnectionStateChangeEvent : connected"),_this268.connected=!0,Object.keys(_this268.conferenceSessions).forEach((function(conferenceSessionId){var conferenceSession=_this268.conferenceSessions[conferenceSessionId];if("reconnecting"===conferenceSession.status)for(var sessId in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(sessId)){var session=conferenceSession.sessions[sessId];("audio"===session.localType||conferenceSession.localVideoSessionId===sessId||conferenceSession.localSharingSessionId===sessId)&&_this268.sendTransportReplaceForSession(session,5e3)}_this268.$interval((function(confSession){if(_this268.connected&&confSession.isActive()&&confSession.haveJoined){if(confSession.videoGallery||(_this268.createVideoGalleryElements(confSession.conferenceView),confSession.videoGallery=_this268.videoGalleryElements),!_this268.isAlreadySubscribedToDynamicFeed(confSession.id)){var _step10,publisher=null,_iterator10=_createForOfIteratorHelper(confSession.publishers);try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var pub=_step10.value;if("video"===pub.mediaType){publisher=pub;break}}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}_this268.subscribeToDynamicFeed(confSession.id,publisher,confSession.videoGallery[0].id,"2",!0)}_this268.subscribeToPublishers(confSession)}}),5e3,1,!0,conferenceSession)})))}catch(error){_this268.$log.info("[WebConferenceService] onConnectionStateChangeEvent error : "+error)}}))}},{key:"subscribe",value:function(handler){return this.rxSubject.subscribe(handler)}},{key:"sendEvent",value:function(name){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rxSubject.next(event_model_1.RBEvent.create(name,data))}},{key:"retrieveWebConferences",value:function(){var _this269=this,mediaType=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.MEDIATYPE.WEBRTC;return this.$log.info("[WebConferenceService] retrieveWebConferences with mediaType="+mediaType),this.$q((function(resolve,reject){if(!_this269.profileService.isFeatureEnabled(_this269.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED)&&mediaType!==_this269.MEDIATYPE.WEBRTCSHARINGONLY)return _this269.$log.warn("[WebConferenceService] retrieveWebConferences - user is not allowed"),void reject(new Error("notAllowed"));var urlQueryParameters="?scheduled=false&format=full&userId="+_this269.contactService.userContact.dbId;_this269.$http({method:"GET",url:_this269.confProvPortalURL+"conferences"+urlQueryParameters,headers:_this269.authService.getRequestHeader()}).then((function(response){var conferencesProvisionData=response.data.data;_this269.$log.info("[WebConferenceService] retrieveWebConferences successfully");var _step11,_iterator11=_createForOfIteratorHelper(conferencesProvisionData);try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var conferenceData=_step11.value;switch(conferenceData.mediaType){case _this269.MEDIATYPE.WEBRTC:case _this269.MEDIATYPE.WEBRTCSHARINGONLY:_this269.updateOrCreateWebConferenceEndpoint(conferenceData);break;case _this269.MEDIATYPE.PSTNAUDIO:}}}catch(err){_iterator11.e(err)}finally{_iterator11.f()}resolve(conferencesProvisionData)}),(function(response){var errorMessage="retrieveWebConferences failure: "+(response.data?response.data.errorDetails:response.data);_this269.$log.error("[WebConferenceService] "+errorMessage),reject(new Error(errorMessage))}))}))}},{key:"updateSubstreamLevelForPublisher",value:function(confId,participantId,subStreamLevel,galleryElement){var _this270=this;return confId&&participantId&&subStreamLevel&&galleryElement&&galleryElement.publisherId?(this.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher(confId="+confId+" participantId="+participantId+" publisherId="+galleryElement.publisherId+" level="+subStreamLevel+")"),galleryElement.simulcast&&galleryElement.subStreamLevel!==subStreamLevel?this.$q((function(resolve,reject){if(!_this270.conferenceSessions[confId])return _this270.$log.error("[WebConferenceService] updateSubstreamLevelForPublisher - no corresponding conference session to update"),void reject();var data={option:"update",mediaType:"webrtc",publisherId:galleryElement.publisherId,subStreamLevel:subStreamLevel};_this270.$http({method:"PUT",url:_this270.confPortalURL+confId+"/participants/"+participantId,headers:_this270.authService.getRequestHeader(),data:data}).then((function(response){var status=response.data;galleryElement.subStreamLevel=subStreamLevel,_this270.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher( confId="+confId+" participantId="+participantId+" publisherId="+galleryElement.publisherId+" level="+subStreamLevel+") successfully"),resolve(status)}),(function(response){var msg=response.data?response.data.errorDetails:response.data,errorMessage="updateSubstreamLevelForPublisher( confId="+confId+" participantId="+participantId+") failure: "+msg;_this270.$log.error("[WebConferenceService] "+errorMessage),reject(new Error(errorMessage))}))})):(this.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher - already at same level (or no simulcast proposed)"),this.$q.resolve())):(this.$log.error("[WebConferenceService] updateSubstreamLevelForPublisher - missing a parameter"),this.$q.reject())}},{key:"updateConference",value:function(confEndpointId,confData){var _this271=this;return this.$log.info("[WebConferenceService] updateConference"),this.$q((function(resolve,reject){if(confEndpointId)_this271.$http({method:"PUT",url:_this271.confProvPortalURL+"conferences/"+confEndpointId,headers:_this271.authService.getRequestHeader(),data:confData}).then((function(response){var conferenceData=response.data.data,conference=_this271.Conference.createFromData(conferenceData);conferenceData.hasOwnProperty("id")&&(_this271.conferenceEndpoints[conferenceData.id]&&delete _this271.conferenceEndpoints[conferenceData.id],_this271.conferenceEndpoints[conferenceData.id]=conference),_this271.$log.info("[WebConferenceService] updateConference successfully"),resolve(conference)}),(function(response){var errorMessage="updateConference failure: "+(response.data?response.data.errorDetails:response.data);_this271.$log.error("[WebConferenceService] "+errorMessage),reject(new Error(errorMessage))}));else{_this271.$log.error("[WebConferenceService] updateConference failure : No confEndpoint"),reject(new Error("updateConference failure: No confEndpoint"))}}))}},{key:"createVideoGalleryElements",value:function(){var conferenceView=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gallery_view";this.videoGalleryElements=[];var index=0;if(index=conferenceView===this.ConferenceSession.ConferenceView.SpeakerView?0:conferenceView===this.ConferenceSession.ConferenceView.GalleryView?this.videoGalleryElementsNumber:12,this.activeSpeaker){var obj={state:"free",sessionId:"",id:"videoGallery_0",publisherId:"",subStreamLevel:null,activeSpeaker:!0,hold:!1};this.videoGalleryElements.push(obj)}for(var i=1;i<=index;i++){var item={state:"free",sessionId:"",id:"videoGallery_"+i,publisherId:"",publisherJid:"",subStreamLevel:null,hold:!1};this.videoGalleryElements.push(item)}if(this.activeSpeaker&&this.mozaicViewModeValue)for(var _i8=index+1;_i8<=12;_i8++){var _item={state:"busy",sessionId:"",id:"videoGallery_"+_i8,publisherId:"",publisherJid:"",subStreamLevel:null,hold:!1};this.videoGalleryElements.push(_item)}}},{key:"updateVideoGalleryElementsState",value:function(conferenceSession,videoGalleryElements,conferenceView){if(!this.activeSpeaker)return videoGalleryElements;if("true"===this.settingsService.getSetting("sfuDisableHold"))return videoGalleryElements;var startIndex=0,endIndex=0;conferenceView===this.ConferenceSession.ConferenceView.SpeakerView?(startIndex=0,endIndex=0):conferenceView===this.ConferenceSession.ConferenceView.GalleryView?(startIndex=0,endIndex=this.videoGalleryElementsNumber):(startIndex=1,endIndex=12);for(var i=0;i<startIndex;i++)if("free"===videoGalleryElements[i].state)videoGalleryElements[i].state="busy";else if("busy"===videoGalleryElements[i].state&&videoGalleryElements[i].sessionId&&!videoGalleryElements[i].hold){var session=conferenceSession.sessions[videoGalleryElements[i].sessionId];session&&session.sendHold(!0),videoGalleryElements[i].hold=!0}for(var _i9=startIndex;_i9<=endIndex;_i9++)if("busy"!==videoGalleryElements[_i9].state||videoGalleryElements[_i9].sessionId||videoGalleryElements[_i9].publisherId){if("busy"===videoGalleryElements[_i9].state&&videoGalleryElements[_i9].sessionId&&videoGalleryElements[_i9].hold){videoGalleryElements[_i9].hold=!1;var _session2=conferenceSession.sessions[videoGalleryElements[_i9].sessionId];_session2&&_session2.sendHold(!1)}}else videoGalleryElements[_i9].state="free";for(var _i10=endIndex+1;_i10<=12;_i10++)if("free"===videoGalleryElements[_i10].state)videoGalleryElements[_i10].state="busy";else if("busy"===videoGalleryElements[_i10].state&&videoGalleryElements[_i10].sessionId&&!videoGalleryElements[_i10].hold){videoGalleryElements[_i10].hold=!0;var _session3=conferenceSession.sessions[videoGalleryElements[_i10].sessionId];_session3&&_session3.sendHold(!0)}return videoGalleryElements}},{key:"holdOrUnholdHiddenSessions",value:function(conferenceSession,videoGalleryElements,hold){if(!this.activeSpeaker)return videoGalleryElements;for(var endIndex=this.videoGalleryElementsNumber,i=1;i<=endIndex;i++)if("busy"!==videoGalleryElements[i].state||videoGalleryElements[i].sessionId||videoGalleryElements[i].publisherId||(videoGalleryElements[i].state="free"),hold&&"busy"===videoGalleryElements[i].state&&videoGalleryElements[i].sessionId&&!videoGalleryElements[i].hold&&!videoGalleryElements[i].pinned){videoGalleryElements[i].hold=!0;var session=conferenceSession.sessions[videoGalleryElements[i].sessionId];session&&session.sendHold(!0)}else if(!hold&&"busy"===videoGalleryElements[i].state&&videoGalleryElements[i].sessionId&&videoGalleryElements[i].hold){videoGalleryElements[i].hold=!1;var _session4=conferenceSession.sessions[videoGalleryElements[i].sessionId];_session4&&_session4.sendHold(!1)}return videoGalleryElements}},{key:"setVideoGalleryElementsNumber",value:function(number){this.videoGalleryElementsNumber=number}},{key:"setActiveSpeakerValue",value:function(value){this.activeSpeaker=value}},{key:"setMozaicViewModeValue",value:function(value){this.mozaicViewModeValue=value}},{key:"isActiveSpeakerEnabled",value:function(){return this.activeSpeaker}},{key:"getConferenceSessions",value:function(){return this.conferenceSessions}},{key:"getConferenceEndpoints",value:function(){return this.conferenceEndpoints}},{key:"addConferenceEndpoint",value:function(conferenceEndpointId,conferenceEndpoint){conferenceEndpointId?this.conferenceEndpoints[conferenceEndpointId]=conferenceEndpoint:this.$log.warn("[WebConferenceService] addConferenceEndpoint - missing conferenceEndpointId")}},{key:"getConferenceIdToUse",value:function(room){var mediaType=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.MEDIATYPE.WEBRTC,webPontConferenceId=this.getPontConfIdForRoom(room,mediaType);if(webPontConferenceId)return webPontConferenceId;switch(mediaType){case this.MEDIATYPE.WEBRTC:if(room.isUserModerator(this.contactService.userContact)&&this.webrtcConferenceId)return this.webrtcConferenceId;break;case this.MEDIATYPE.WEBRTCSHARINGONLY:if(room.owner&&this.webrtcSharingOnlyConferenceId)return this.webrtcSharingOnlyConferenceId}return""}},{key:"isMyConference",value:function(conferenceId){return conferenceId&&(this.webrtcConferenceId&&conferenceId===this.webrtcConferenceId||this.webrtcSharingOnlyConferenceId&&conferenceId===this.webrtcSharingOnlyConferenceId)}},{key:"bubbleDeclineInvitationForWebConference",value:function(room){var _this272=this;return this.$q((function(resolve,reject){if(!room){var error=new Error("[webConferenceService] bubbleDeclineInvitationForWebConference error - missing parameters for room");return _this272.$log.error(error.message),void reject(error)}var webPontConferenceId=_this272.getConferenceIdToUse(room,_this272.MEDIATYPE.WEBRTC);if(!webPontConferenceId){var _error2=new Error("[webConferenceService] bubbleDeclineInvitationForWebConference error - no available pont conference");return _this272.$log.error(_error2.message),void reject(_error2)}_this272.$http({method:"PUT",url:_this272.confPortalURL+webPontConferenceId+"/reject",headers:_this272.authService.getRequestHeader(),data:{mediaType:_this272.MEDIATYPE.WEBRTC,roomId:room.dbId}}).then((function(){_this272.$log.debug("[webConferenceService] bubbleDeclineInvitationForWebConference - success -- "),resolve()}),(function(errorResponse){_this272.makingCall=!1,_this272.$log.error("[webConferenceService] bubbleDeclineInvitationForWebConference - error on server"),reject(_this272.errorHelperService.handleError(errorResponse))}))}))}},{key:"bubbleStartOrJoinWebConference",value:function(room){var _this273=this;return this.$q((function(resolve,reject){if(!room){var error=new Error("[webConferenceService] bubbleStartOrJoinWebConference error - missing parameters for room");return _this273.$log.error(error.message),void reject(error)}var webPontConferenceId=_this273.getConferenceIdToUse(room,_this273.MEDIATYPE.WEBRTC);_this273.isMyConference(webPontConferenceId)?_this273.bubbleStartWebConference(room).then((function(){resolve()})).catch((function(){reject()})):_this273.bubbleJoinWebConference(room).then((function(){resolve()})).catch((function(err){reject(err)}))}))}},{key:"bubbleStartWebConference",value:function(room){var _this274=this;return this.$q((function(resolve,reject){if(!room){var error=new Error("[webConferenceService] bubbleStartWebConference error - missing parameters for room");return _this274.$log.error(error.message),void reject(error)}var webPontConferenceId=_this274.getConferenceIdToUse(room,_this274.MEDIATYPE.WEBRTC);if(!webPontConferenceId){var _error3=new Error("[webConferenceService] bubbleStartWebConference error - no available pont conference");return _this274.$log.error(_error3.message),void reject(_error3)}if(_this274.makingCall)return _this274.$log.warn("[webConferenceService] already starting a conference"),_this274.$q.resolve();_this274.$log.info("[WebConferenceService] bubbleStartWebConference "+webPontConferenceId),_this274.makingCall=!0;var confSession=_this274.conferenceSessions[webPontConferenceId];if(confSession&&confSession.active)return _this274.$log.info("[webConferenceService] bubbleStartWebConference - No need to start an already active conference"),void resolve(_this274.joinWebConference(webPontConferenceId,"moderator",!1));var conferenceSession=_this274.ConferenceSession.createFromData(webPontConferenceId,[],!1,"webrtc");conferenceSession.status="ringing",conferenceSession.roomId=room.dbId,conferenceSession.isMyConference=!0,_this274.conferenceSessions[webPontConferenceId]=conferenceSession,_this274.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",_this274.conferenceSessions[webPontConferenceId]),_this274.$http({method:"PUT",url:_this274.confPortalURL+webPontConferenceId+"/start",headers:_this274.authService.getRequestHeader(),data:{mediaType:_this274.MEDIATYPE.WEBRTC,roomId:room.dbId}}).then((function(){return _this274.$log.info("[webConferenceService] startWebConference - success -- now joining the conference"),resolve(_this274.joinWebConference(webPontConferenceId,"moderator",!1))}),(function(errorResponse){_this274.makingCall=!1;var errorMsg="[webConferenceService] startWebConference - error on server, can't start conference -- ",msg="startMeetingFailure";errorResponse&&((403620===errorResponse.errorDetailsCode||errorResponse.data&&403620===errorResponse.data.errorDetailsCode)&&(msg="startMeetingConflict"),errorResponse.errorDetailsLabel?errorMsg+=errorResponse.errorDetailsLabel:errorResponse.data&&(errorMsg+=errorResponse.data.errorDetailsCode+" "+errorResponse.data.errorMsg)),_this274.$log.error(errorMsg),_this274.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"startConference",popupBody:msg,okLabel:"ok"}),_this274.leaveWebConference(webPontConferenceId),_this274.removeConferenceSession(webPontConferenceId),reject(_this274.errorHelperService.handleError(errorResponse)),_this274.$log.error("[webConferenceService] startWebConference "+_this274.errorHelperService.getErrorFullMessage(errorResponse))}))}))}},{key:"bubbleJoinWebConference",value:function(room){var _this275=this;return this.$q((function(resolve,reject){if(!room){var error=new Error("[webConferenceService] bubbleJoinWebConference error - missing parameters for room");return _this275.$log.error(error.message),void reject(error)}var webPontConferenceId=_this275.getConferenceIdToUse(room,_this275.MEDIATYPE.WEBRTC);if(!webPontConferenceId){var _error4=new Error("[webConferenceService] bubbleJoinWebConference error - no available pont conference");return _this275.$log.error(_error4.message),void reject(_error4)}if(_this275.makingCall)return _this275.$log.warn("[webConferenceService] already joining a conference"),_this275.$q.resolve();_this275.$log.info("[WebConferenceService] bubbleJoinWebConference "+webPontConferenceId),_this275.makingCall=!0,_this275.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",room);var confSession=_this275.conferenceSessions[webPontConferenceId];confSession||(confSession=_this275.ConferenceSession.createFromData(webPontConferenceId,[],!1,"webrtc")),confSession.status="ringing",confSession.roomId=room.dbId,_this275.conferenceSessions[webPontConferenceId]=confSession,_this275.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",_this275.conferenceSessions[webPontConferenceId]);var role=_this275.isMyConference(webPontConferenceId)?"moderator":"member";_this275.joinWebConference(webPontConferenceId,role).then((function(){resolve()})).catch((function(){reject()}))}))}},{key:"startOrJoinWebConference",value:function(room){var _this276=this;return this.$q((function(resolve,reject){if(!room){var error=new Error("[webConferenceService] startOrJoinWebConference error - missing parameters for room");return _this276.$log.error(error.message),void reject(error)}var webPontConferenceId=_this276.getConferenceIdToUse(room,_this276.MEDIATYPE.WEBRTC);if(!webPontConferenceId){var _error5=new Error("[webConferenceService] startOrJoinWebConference error - no available pont conference");return _this276.$log.error(_error5.message),void reject(_error5)}if(_this276.$log.info("[WebConferenceService] startOrJoinWebConference -- "+webPontConferenceId),_this276.makingCall)return _this276.$log.warn("[webConferenceService] already starting a conference"),_this276.$q.resolve();_this276.makingCall=!0,_this276.makeSnapshotForConfId(webPontConferenceId,_this276.MEDIATYPE.WEBRTC).then((function(){var conferenceSession=_this276.conferenceSessions[webPontConferenceId];if(!(_this276.isMyConference(webPontConferenceId)||conferenceSession&&conferenceSession.active)){var _error6=new Error("[webConferenceService] startOrJoinWebConference error - no active conference to join");return _this276.$log.error(_error6.message),reject(_error6),void(_this276.makingCall=!1)}var role=_this276.isMyConference(webPontConferenceId)?"moderator":"member";conferenceSession&&conferenceSession.active?(_this276.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",room),resolve(_this276.joinWebConference(webPontConferenceId,role))):resolve(_this276.startWebConference(room,webPontConferenceId))}),(function(){_this276.makingCall=!1;var error=new Error("[webConferenceService] startOrJoinWebConference error on snapshot");_this276.$log.error(error.message),reject(error)}))}))}},{key:"startWebConference",value:function(room,webPontConferenceId){var _this277=this,shouldSnapshotBeforeStart=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return webPontConferenceId&&room?(this.makingCall=!0,this.$log.info("[webConferenceService] startWebConference wtih ID "+webPontConferenceId),this.$q((function(resolve){shouldSnapshotBeforeStart?(_this277.$log.debug("[webConferenceService] startWebConference - trigger snapshot for "+webPontConferenceId),resolve(_this277.makeSnapshotForConfId(webPontConferenceId,_this277.MEDIATYPE.WEBRTC))):resolve()})).then((function(){return _this277.conferenceSessions[webPontConferenceId].active?(_this277.$log.info("[webConferenceService] startWebConference - No need to start an already active conference"),_this277.joinWebConference(webPontConferenceId,"moderator",!1)):(_this277.conferenceSessions[webPontConferenceId].status="ringing",_this277.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",_this277.conferenceSessions[webPontConferenceId]),_this277.$http({method:"PUT",url:_this277.confPortalURL+webPontConferenceId+"/start",headers:_this277.authService.getRequestHeader(),data:{mediaType:_this277.MEDIATYPE.WEBRTC,roomId:room.dbId}}).then((function(){return _this277.$log.info("[webConferenceService] startWebConference - success -- now joining the conference"),_this277.joinWebConference(webPontConferenceId,"moderator",!1)}),(function(errorResponse){throw _this277.makingCall=!1,_this277.$log.error("[webConferenceService] startWebConference wtih ID "+webPontConferenceId+" failure ... -- "+_this277.errorHelperService.getErrorFullMessage(errorResponse)),_this277.leaveWebConference(webPontConferenceId),_this277.removeConferenceSession(webPontConferenceId),_this277.errorHelperService.handleError(errorResponse)})))})).catch((function(err){_this277.makingCall=!1;var errorMsg="[webConferenceService] startWebConference - error on server, can't start conference -- ",msg="startMeetingFailure";return err&&(403620===err.errorDetailsCode&&(msg="startMeetingConflict"),err.errorDetailsLabel&&(errorMsg+=err.errorDetailsLabel)),_this277.$log.error(errorMsg),_this277.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"startConference",popupBody:msg,okLabel:"ok"}),_this277.$q.reject(err)}))):(this.$log.error("[startWebConference] No webPontConferenceId or Room!"),this.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"startConference",popupBody:"startMeetingFailure",okLabel:"ok"}),this.$q.reject())}},{key:"joinWebConference",value:function(webPontConferenceId,role){var _this278=this,shouldSnapshotBeforeJoin=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.$log.info("[webConferenceService] joinWebConference with ID "+webPontConferenceId+" and role "+role),webPontConferenceId?this.$q((function(resolve){shouldSnapshotBeforeJoin?(_this278.$log.debug("[webConferenceService] joinWebConference - trigger snapshot for "+webPontConferenceId),resolve(_this278.makeSnapshotForConfId(webPontConferenceId,_this278.MEDIATYPE.WEBRTC))):resolve()})).then((function(){return _this278.$q((function(resolve,reject){_this278.makingCall=!0,_this278.createVideoGalleryElements(_this278.conferenceSessions[webPontConferenceId].conferenceView),_this278.conferenceSessions[webPontConferenceId].videoGallery=_this278.videoGalleryElements,"ringing"!==_this278.conferenceSessions[webPontConferenceId].status&&(_this278.conferenceSessions[webPontConferenceId].status="ringing",_this278.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",_this278.conferenceSessions[webPontConferenceId]));var id="web_"+uuid4(),delegateCapability=_this278.profileService.isFeatureEnabled(_this278.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED),url=_this278.confPortalURL+webPontConferenceId+"/join",params={participant:{role:role,type:"unmuted"},mediaType:_this278.MEDIATYPE.WEBRTC,delegateCapability:delegateCapability};_this278.videoService.config&&_this278.videoService.config.dc&&(params.dc=_this278.videoService.config.dc),_this278.getUserMediaForSession(webPontConferenceId).then((function(sessId){_this278.$http({method:"POST",url:url,headers:_this278.authService.getRequestHeader(),data:params}).then((function(response){var data=response.data.data;_this278.jingleJid=data.jingleJid;var forceTurn=data.transportTurn;_this278.initCall(_this278.jingleJid,webPontConferenceId,id,_this278.MEDIATYPE.WEBRTC,forceTurn),_this278.conferenceSessions[webPontConferenceId].haveJoined=!0,_this278.makingCall=!1,resolve()}),(function(errorResponse){if(errorResponse){var msg=errorResponse.data?errorResponse.data.errorDetails:errorResponse.data,errorMessage="joinWebConference( confId="+webPontConferenceId+") failure: "+msg;_this278.$log.error("[webConferenceService] "+errorMessage)}_this278.makingCall=!1;var data={popupTitle:"warning",popupBody:"joinMeetingFailure",okLabel:"ok"};errorResponse&&errorResponse.data&&403615===errorResponse.data.errorDetailsCode&&(data.popupBody="maximumNumberConferenceParticipantsReach"),errorResponse&&errorResponse.data&&403060===errorResponse.data.errorDetailsCode&&(data.popupBody="lockedConferenceError"),_this278.leaveWebConference(webPontConferenceId),delete _this278.conferenceSessions[webPontConferenceId],_this278.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",data),reject(_this278.errorHelperService.handleError(errorResponse))}))})).catch((function(reason){_this278.$log.error("[webConferenceService] joinWebConference - getUserMediaForSession reject -- "+reason),_this278.makingCall=!1,"ignore"!==reason&&_this278.leaveWebConference(webPontConferenceId),reject()}))}))})).catch((function(){return _this278.makingCall=!1,_this278.$log.error("[webConferenceService] joinWebConference - error on server, can't join conference"),_this278.$q.reject()})):(this.$log.error("[webConferenceService] joinWebConference - No webPontConferenceId !"),this.$q.reject())}},{key:"joinSharingOnlyConference",value:function(webPontConferenceId,role){var _this279=this,shouldSnapshotBeforeJoin=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.$log.info("[webConferenceService] joinSharingOnlyConference with ID "+webPontConferenceId+" and role "+role),webPontConferenceId?this.$q((function(resolve){shouldSnapshotBeforeJoin?(_this279.$log.debug("[webConferenceService] joinSharingOnlyConference - trigger snapshot for "+webPontConferenceId),resolve(_this279.makeSnapshotForConfId(webPontConferenceId,_this279.MEDIATYPE.WEBRTCSHARINGONLY))):resolve()})).then((function(){return _this279.$q((function(resolve,reject){_this279.makingCall=!0,_this279.createVideoGalleryElements(),_this279.conferenceSessions[webPontConferenceId].videoGallery=_this279.videoGalleryElements,"ringing"!==_this279.conferenceSessions[webPontConferenceId].status&&(_this279.conferenceSessions[webPontConferenceId].status="ringing",_this279.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",_this279.conferenceSessions[webPontConferenceId])),uuid4();var url=_this279.confPortalURL+webPontConferenceId+"/join",params={participant:{role:role,type:"muted"},mediaType:_this279.MEDIATYPE.WEBRTCSHARINGONLY};_this279.$http({method:"POST",url:url,headers:_this279.authService.getRequestHeader(),data:params}).then((function(response){var data=response.data.data;_this279.jingleJid=data.jingleJid,_this279.$log.info("[webConferenceService] joinSharingOnlyConference with ID success - jingleJid: "+_this279.jingleJid),_this279.conferenceSessions[webPontConferenceId].jingleJid=_this279.jingleJid,_this279.conferenceSessions[webPontConferenceId].haveJoined=!0,_this279.makingCall=!1,resolve()}),(function(errorResponse){if(errorResponse){var msg=errorResponse.data?errorResponse.data.errorDetails:errorResponse.data,errorMessage="joinSharingOnlyConference( confId="+webPontConferenceId+") failure: "+msg;_this279.$log.error("[conferenceService] "+errorMessage)}_this279.makingCall=!1;errorResponse&&errorResponse.data&&errorResponse.data.errorDetailsCode,_this279.leaveWebConference(webPontConferenceId),delete _this279.conferenceSessions[webPontConferenceId],reject(_this279.errorHelperService.handleError(errorResponse))}))}))})).catch((function(){return _this279.makingCall=!1,_this279.$log.error("[webConferenceService] joinSharingOnlyConference - error on server, can't join conference"),_this279.$q.reject()})):(this.$log.error("[webConferenceService] joinSharingOnlyConference - No webPontConferenceId !"),this.$q.reject())}},{key:"getFreeVideoGalleryElement",value:function(confId){this.$log.info("[webConferenceService] getFreeVideoGalleryElement "+confId);var confSession=this.conferenceSessions[confId],result=null;if(confSession){confSession.videoGallery||(this.createVideoGalleryElements(confSession.conferenceView),confSession.videoGallery=this.videoGalleryElements);for(var i=0;i<confSession.videoGallery.length;i++)if("free"===confSession.videoGallery[i].state){result=confSession.videoGallery[i];break}}return result}},{key:"askToAddSharingToConferenceSession",value:function(conversation,conferenceSession){!this.videoService.askToAddSharing(conversation.id,"sharing")&&this.addMediaToConferenceSession(conferenceSession,"sharing")}},{key:"addMediaToConferenceSession",value:function(conferenceSession,mediaType){var _this280=this,existingStream=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(conferenceSession&&!this.addingMedia)if("true"!==this.settingsService.getSetting("sfuJoinBundle")||"video"!==mediaType){this.addingMedia=!0;var mediaToGet=[mediaType],simulcast=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_SIMULCAST),frameRate=17,videoWidth=simulcast?1280:640,videoHeight=simulcast?720:480;"video"!==mediaType&&(frameRate=10,videoWidth=1280,videoHeight=720),"sharing"===mediaType&&this.contactService.setBusyState("dnd","sharing");var callBackFunction=existingStream?this.$q.when(existingStream):this.videoService.getBrowserMedia(mediaToGet,videoWidth,videoHeight,frameRate);this.$log.info("[webConferenceService] addMediaToConferenceSession to session "+conferenceSession.id+" with media "+mediaType),callBackFunction.then((function(stream){_this280.addingMedia=!1;var streams=[stream],unifiedPlan=_this280.videoService.config.unifiedPlan,session=_this280.xmppService.connection.jingle.initiate(conferenceSession.jingleJid,_this280.xmppService.connection.jid,mediaType,streams,null,conferenceSession.id,null,unifiedPlan);conferenceSession.sessions[session.sid]=session,conferenceSession.localStreams.push(stream),session.localStreamId=conferenceSession.localStreams.length-1,"video"===mediaType?(conferenceSession.hasLocalVideo=!0,conferenceSession.localVideoSessionId=session.sid):(conferenceSession.hasLocalSharing=!0,conferenceSession.localSharingSessionId=session.sid,_this280.sendEvent("startHighlighting")),_this280.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession),_this280.videoService.callsStats[session.sid]={},_this280.updateStatisticsForSession(conferenceSession.id,session.sid),_this280.statsIntervals.push(session.getStats(5e3))})).catch((function(){_this280.addingMedia=!1}))}else this.addBundleMediaToConferenceSession(conferenceSession)}},{key:"removeMediaFromConferenceSession",value:function(conferenceSession,mediaType){if(conferenceSession){"sharing"===mediaType&&this.contactService.setBusyState("dnd","audio"),"webrtcSharingOnly"===conferenceSession.type&&this.contactService.resetBusyState(),this.$log.info("[webConferenceService] removeMediaFromConferenceSession from session "+conferenceSession.id);var sessionId="video"===mediaType?conferenceSession.localVideoSessionId:conferenceSession.localSharingSessionId;if(conferenceSession.sessions[sessionId]){var session=conferenceSession.sessions[sessionId];this.updateStatisticsForSession(conferenceSession.id,sessionId),this.videoService.disableAudioVideoMedia(session),this.xmppService.connection.jingle.terminate(session.sid),delete conferenceSession.sessions[sessionId],delete conferenceSession.localStreams[session.localStreamId],delete this.videoService.callsStats[sessionId],"video"===mediaType?(conferenceSession.hasLocalVideo=!1,conferenceSession.localVideoSessionId=null):(conferenceSession.hasLocalSharing=!1,conferenceSession.localSharingSessionId=null,this.sendEvent("stopHighlighting"))}this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession)}}},{key:"dropRemoteVideoSession",value:function(conferenceSession,sessionId){if(conferenceSession){if(this.$log.info("[webConferenceService] dropRemoteVideoSession fom conference "+conferenceSession.id+" and session "+sessionId),conferenceSession.sessions[sessionId]){var session=conferenceSession.sessions[sessionId];this.updateStatisticsForSession(conferenceSession.id,sessionId),this.xmppService.connection.jingle.terminate(session.sid),delete conferenceSession.sessions[sessionId],delete this.videoService.callsStats[sessionId]}this.removeSessionFromVideoGallery(conferenceSession,sessionId),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession)}}},{key:"getUserMediaForSession",value:function(webPontConferenceId){var _this281=this;return this.$q((function(resolve,reject){var conference=_this281.conferenceSessions[webPontConferenceId];conference?("ringing"!==conference.status&&(_this281.conferenceSessions[webPontConferenceId].status="ringing",_this281.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conference)),conference.haveJoined=!0,_this281.videoService.getBrowserMedia(["audio"]).then((function(stream){_this281.$log.info("[webConferenceService] getUserMediaForSession -- sucess");var conf=_this281.conferenceSessions[webPontConferenceId];if(!conf||"ended"===conf.status)return _this281.$log.info("[webConferenceService] getUserMediaForSession -- missing conference"),_this281.disableMediaStream(stream),void reject("conference does not exist anymore");if(!_this281.makingCall)return _this281.$log.info("[webConferenceService] getUserMediaForSession -- already in the conference -- ignore"),_this281.disableMediaStream(stream),void reject("ignore");var streams=[stream];conf.localStreams=streams,resolve()})).catch((function(){_this281.$log.error("[webConferenceService] getUserMediaForSession error -- getUserMedia failed"),_this281.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"warning",popupBody:"devicePermission",okLabel:"ok"}),reject("failed to get user media")}))):reject()}))}},{key:"disableMediaStream",value:function(stream){stream&&(stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),stream=null)}},{key:"initCall",value:function(jid,webPontConferenceId,callId,type){var _this282=this,forceTurn=arguments.length>4&&void 0!==arguments[4]&&arguments[4],conference=this.conferenceSessions[webPontConferenceId];return this.$q((function(resolve){conference||(_this282.$log.warn("[webConferenceService] initCall - no conferenceSession as though we are trying to init call"),resolve(_this282.makeSnapshotForConfId(webPontConferenceId,type))),resolve()})).then((function(){return __awaiter(_this282,void 0,void 0,regenerator_default.a.mark((function _callee445(){var unifiedPlan,media,session,_this283=this;return regenerator_default.a.wrap((function(_context446){for(;;)switch(_context446.prev=_context446.next){case 0:return _context446.next=2,this.videoService.setWebrtcConfiguration().catch((function(){_this283.$log.error("[webConferenceService] initCall - setWebrtcConfiguration failed")}));case 2:return unifiedPlan=!!this.videoService.config&&this.videoService.config.unifiedPlan,media="audio","true"===this.settingsService.getSetting("sfuJoinBundle")&&(media="audio+video"),session=this.xmppService.connection.jingle.initiate(jid,this.xmppService.connection.jid,media,conference.localStreams,callId,webPontConferenceId,null,unifiedPlan,forceTurn),_context446.abrupt("return",(conference.jingleJid=jid,conference.sessions[session.sid]=session,conference.status="ringing",this.createStatisticsForSession(webPontConferenceId,session.sid),this.statsIntervals.push(session.getStats(3e3)),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conference),conference));case 7:case"end":return _context446.stop()}}),_callee445,this)})))}))}},{key:"transferCall",value:function(oldSession,jid,webPontConferenceId,callId,type){var myConference=arguments.length>5&&void 0!==arguments[5]&&arguments[5],roomDbId=arguments.length>6?arguments[6]:void 0,shouldMute=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee446(){var unifiedPlan,conference,media,session,rooms,_index7,sharingStream,_this284=this;return regenerator_default.a.wrap((function(_context447){for(;;)switch(_context447.prev=_context447.next){case 0:return _context447.prev=0,this.makingCall=!0,this.$log.info("[webConferenceService] transferCall to "+webPontConferenceId),_context447.next=5,this.makeSnapshotForConfId(webPontConferenceId,type,!0);case 5:return _context447.next=7,this.videoService.setWebrtcConfiguration().catch((function(){_this284.$log.error("[webConferenceService] transferCall - setWebrtcConfiguration failed")}));case 7:return unifiedPlan=!!this.videoService.config&&this.videoService.config.unifiedPlan,_context447.next=10,this.getUserMediaForSession(webPontConferenceId);case 10:return(conference=this.conferenceSessions[webPontConferenceId]).participants&&conference.participants.forEach((function(participant){myConference&&participant.jid_im!==_this284.contactService.userContact.jid?participant.role="member":myConference||participant.jid_im!==_this284.contactService.userContact.jid||(participant.role="member")})),media="audio","true"===this.settingsService.getSetting("sfuJoinBundle")&&(media="audio+video"),session=this.xmppService.connection.jingle.initiate(jid,this.xmppService.connection.jid,media,conference.localStreams,callId,webPontConferenceId,null,unifiedPlan,!1),conference.jingleJid=jid,conference.haveJoined=!0,conference.sessions[session.sid]=session,conference.status="ringing",conference.roomId=roomDbId,conference.isMyConference=myConference,this.createVideoGalleryElements(conference.conferenceView),conference.videoGallery=this.videoGalleryElements,roomDbId||(rooms=this.roomService.findRoomsWithConfId(webPontConferenceId))&&rooms[0]&&(conference.roomId=rooms[0].dbId),this.conferenceSessions[webPontConferenceId]=conference,this.makingCall=!1,this.createStatisticsForSession(webPontConferenceId,session.sid),this.statsIntervals.push(session.getStats(3e3)),_context447.prev=17,oldSession&&-1!==oldSession.localType.indexOf("sharing")&&(_index7=oldSession.localStreams.length-1,oldSession.localStreams[oldSession.localStreams.length-1].getAudioTracks().length&&(_index7=0),sharingStream=oldSession.localStreams[_index7].clone(),this.$interval((function(){_this284.addMediaToConferenceSession(_this284.conferenceSessions[webPontConferenceId],"sharing",sharingStream)}),1500,1,!0,webPontConferenceId)),_context447.abrupt("return",(oldSession&&-1!==oldSession.localType.indexOf("video")&&this.$interval((function(){_this284.addMediaToConferenceSession(_this284.conferenceSessions[webPontConferenceId],"video")}),1500,1,!0,webPontConferenceId),shouldMute&&this.$interval((function(){var webConferenceParticipant=_this284.conferenceSessions[webPontConferenceId].getConnectedParticipantByJid(_this284.contactService.userContact.jid);webConferenceParticipant&&_this284.muteParticipant(webPontConferenceId,webConferenceParticipant.participantId,"mute")}),1e3,1,!0,webPontConferenceId),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conference),conference));case 22:return _context447.prev=22,_context447.t0=_context447.catch(17),_context447.abrupt("return",(this.$log.error("[webConferenceService] transferCall error on duplicate stream -- "+_context447.t0),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conference),conference));case 25:_context447.next=30;break;case 27:_context447.prev=27,_context447.t1=_context447.catch(0),this.makingCall=!1,this.$log.error("[webConferenceService] transferCall error -- "+_context447.t1);case 30:case"end":return _context447.stop()}}),_callee446,this,[[0,27],[17,22]])})))}},{key:"muteParticipant",value:function(confId,participantId,option){var _this285=this;return this.$log.info("[ConferenceService] muteParticipant( confId="+confId+"participantId="+participantId+" option="+option+")"),confId&&participantId&&option?this.$q((function(resolve,reject){if(!_this285.conferenceSessions[confId])return _this285.$log.error("[ConferenceService] muteParticipant - no corresponding conference session to update"),void reject();var data={option:option,mediaType:"webrtc"};_this285.$http({method:"PUT",url:_this285.confPortalURL+confId+"/participants/"+participantId,headers:_this285.authService.getRequestHeader(),data:data}).then((function(response){var status=response.data;_this285.$log.info("[ConferenceService] muteParticipant( confId="+confId+"participantId="+participantId+") successfully"),resolve(status)}),(function(response){var msg=response.data?response.data.errorDetails:response.data,errorMessage="muteParticipant( confId="+confId+"participantId="+participantId+") failure: "+msg;_this285.$log.error("[ConferenceService] "+errorMessage),reject(new Error(errorMessage))}))})):(this.$log.error("[ConferenceService] muteParticipant - missing a parameter"),this.$q.reject())}},{key:"createStatisticsForSession",value:function(webConfId,sessionId){var _this286=this;if(this.$log.info("[webConferenceService] createStatisticsForSession for conf "+webConfId+" and session "+sessionId),webConfId&&sessionId){this.videoService.callsStats[sessionId]={};var metrics=[];metrics.push({connectionId:sessionId,stats:this.videoService.callsStats[sessionId]}),this.videoService.createStatisticsForSession(webConfId,webConfId,"pending",metrics).then((function(id){_this286.$log.info("[webConferenceService] createStatisticsForSession success "+id),_this286.videoService.callsStats[sessionId].id=id,_this286.conferenceSessions[webConfId].metricsId=id,_this286.conferenceSessions[webConfId].metricsState="pending"})).catch((function(error){_this286.$log.error("[webConferenceService] createStatisticsForSession error for conf "+webConfId)}))}else this.$log.warn("[webConferenceService] createStatisticsForSession -- missing parameters")}},{key:"updateStatisticsForSession",value:function(webConfId,sessionId){if(this.$log.info("[webConferenceService] updateStatisticsForSession for conf "+webConfId+" and session "+sessionId),webConfId&&sessionId){var webConference=this.conferenceSessions[webConfId];if(webConference&&webConference.metricsId){webConference.metricsState||(webConference.metricsState="pending");var metrics=[];this.videoService.callsStats[sessionId]&&Object.keys(this.videoService.callsStats[sessionId]).length&&(this.videoService.callsStats[sessionId].RainMetrics&&this.videoService.callsStats[sessionId].push(this.videoService.callsStats[sessionId].RainMetrics),metrics.push({connectionId:sessionId,stats:this.videoService.callsStats[sessionId]}),this.videoService.updateStatisticsForCall(webConference.metricsId,webConfId,webConfId,webConference.metricsState,metrics))}else this.$log.warn("[webConferenceService] updateStatisticsForSession -- missing webConference or no metricsId")}else this.$log.warn("[webConferenceService] updateStatisticsForSession -- missing parameters")}},{key:"leaveWebConference",value:function(confId){if(this.$log.info("[WebConferenceService] leaveWebConference - "+confId),this.contactService.resetBusyState(),confId){var webConference=this.conferenceSessions[confId];if(this.sendEvent("stopHighlighting"),webConference){for(var property in webConference.metricsState="ended",webConference.sessions)if(webConference.sessions.hasOwnProperty(property)){var session=webConference.sessions[property];this.updateStatisticsForSession(webConference.id,session.sid),this.videoService.disableAudioVideoMedia(session),this.xmppService.connection.jingle.terminate(session.sid),delete this.videoService.callsStats[session.sid]}var statsInterval;for(this.videoService.disableStreams(webConference.localStreams),webConference.cleanupSessionData(),this.createVideoGalleryElements(webConference.conferenceView),webConference.videoGallery=this.videoGalleryElements,webConference.sessions={};this.statsIntervals.length;)(statsInterval=this.statsIntervals.pop())&&(window.clearInterval(statsInterval),statsInterval=null);this.makingCall=!1,this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",webConference),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",webConference),this.videoService.clearSrcObjectsFromElements(),this.contactService.userContact.guestMode&&this.$rootScope.$broadcast("ON_OPEN_POPUP","concludeInvitation")}else this.$log.warn("[WebConferenceService] leaveWebConference - webConference does not exist")}}},{key:"attachDistantMediaStream",value:function(attach,conferenceSession){var _this287=this;if(attach){var _ret2=function(){var bundleSession=_this287.getRemoteAudioVideoBundleSession(conferenceSession.id);if(bundleSession)return{v:void _this287.attachDistantBundleSession(bundleSession)};var sessions=_this287.getRemoteVideoSessions(conferenceSession.id),remoteSharingSession=_this287.getRemoteSharingSession(conferenceSession.id),updatedMainSession=!1;if(remoteSharingSession&&!remoteSharingSession.showOnSecondPip||(updatedMainSession=_this287.updateMainSessionIfNeeded(conferenceSession,sessions)),_this287.$log.info("[WebConferenceService] attachDistantMediaStream for session "+conferenceSession.id),remoteSharingSession&&!remoteSharingSession.showOnSecondPip&&(remoteSharingSession.remoteStreams.forEach((function(track){track.getVideoTracks().length>0&&_this287.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),track,remoteSharingSession.sid)})),remoteSharingSession.remoteStreamsObject[0]&&_this287.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),remoteSharingSession.remoteStreamsObject[0],remoteSharingSession.sid)),sessions.length){var _loop4=function(sessionId){if(sessions.hasOwnProperty(sessionId)&&(sessions[sessionId].remoteStreams&&sessions[sessionId].remoteStreams.forEach((function(track){if(track.getVideoTracks().length>0){remoteSharingSession&&!remoteSharingSession.showOnSecondPip||!sessions[sessionId].mainSession||_this287.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),track,sessions[sessionId].sid);for(var i=0;i<conferenceSession.videoGallery.length;i++)if(conferenceSession.videoGallery[i].sessionId===sessions[sessionId].sid){_this287.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#"+conferenceSession.videoGallery[i].id),track,conferenceSession.videoGallery[i].sessionId);break}}})),sessions[sessionId].remoteStreamsObject[0])){remoteSharingSession&&!remoteSharingSession.showOnSecondPip||!sessions[sessionId].mainSession||_this287.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),sessions[sessionId].remoteStreamsObject[0],sessions[sessionId].sid);for(var i=0;i<conferenceSession.videoGallery.length;i++)if(conferenceSession.videoGallery[i].sessionId===sessions[sessionId].sid){_this287.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#"+conferenceSession.videoGallery[i].id),sessions[sessionId].remoteStreamsObject[0],conferenceSession.videoGallery[i].sessionId);break}}};for(var sessionId in sessions)_loop4(sessionId)}var audioSession=_this287.getRemoteAudioSession(conferenceSession.id);audioSession&&audioSession.remoteStreams&&audioSession.remoteStreams.forEach((function(track){track.getAudioTracks().length>0&&_this287.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),track,audioSession.sid)})),audioSession&&audioSession.remoteStreamsObject[0]&&_this287.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),audioSession.remoteStreamsObject[0],audioSession.sid),updatedMainSession&&_this287.updateSubStreamLevelsForConferenceSession(conferenceSession.id)}();if("object"===typeof _ret2)return _ret2.v}}},{key:"attachGalleryMediaStreams",value:function(conferenceSession){var _this288=this,sessions=this.getRemoteVideoSessions(conferenceSession.id);sessions.length&&sessions.forEach((function(session){for(var i=0;i<conferenceSession.videoGallery.length;i++)if(conferenceSession.videoGallery[i].sessionId===session.sid){_this288.attachSessionVideoToHtmlElement(session,conferenceSession.videoGallery[i].id);break}}))}},{key:"attachMozaicVideos",value:function(conferenceSession,mozaicElements){var _this289=this,sessions=this.getRemoteVideoSessions(conferenceSession.id);sessions.length&&sessions.forEach((function(session){mozaicElements.forEach((function(element,index){element.videoSessionId===session.sid&&_this289.attachSessionVideoToHtmlElement(session,"mozaic_videoGallery_"+index)}))}));var sharingSession=this.getRemoteSharingSession(conferenceSession.id);sharingSession&&this.attachSessionVideoToHtmlElement(sharingSession,"mozaicSharingVideo")}},{key:"attachLocalPipVideo",value:function(conferenceSession){if(conferenceSession.hasLocalVideo){var session=conferenceSession.sessions[conferenceSession.localVideoSessionId];session&&this.attachSessionVideoToHtmlElement(session,"conferenceVideoPip")}}},{key:"attachActiveTalkerLocalAndRemoteMediaStreams",value:function(conferenceSession){var _this290=this;this.attachRemoteAudioStream(conferenceSession);var bundleSession=this.getRemoteAudioVideoBundleSession(conferenceSession.id);if(bundleSession)this.attachDistantBundleSession(bundleSession);else{var sessions=this.getRemoteVideoSessions(conferenceSession.id),remoteSharingSession=this.getRemoteSharingSession(conferenceSession.id);this.updateMainSessionIfNeededToDynamicFeed(conferenceSession,sessions),this.$log.info("[WebConferenceService] attachLocalAndRemoteMediaStreams for session "+conferenceSession.id);var mainScreenBusy=!1,hasSharingSession=!1;if(remoteSharingSession&&!remoteSharingSession.showOnSecondPip?(hasSharingSession=!0,this.attachSessionVideoToHtmlElement(remoteSharingSession,"largevideo"),mainScreenBusy=!0):remoteSharingSession&&remoteSharingSession.showOnSecondPip&&(hasSharingSession=!0,this.attachSessionVideoToHtmlElement(remoteSharingSession,"sfuActiveSpeakerSecondVideo")),conferenceSession.hasLocalSharing){var session=conferenceSession.sessions[conferenceSession.localSharingSessionId];session&&(hasSharingSession=!0,session.showOnSecondPip?this.attachSessionVideoToHtmlElement(session,"sfuActiveSpeakerSecondVideo"):(this.attachSessionVideoToHtmlElement(session,"largevideo"),mainScreenBusy=!0))}if(sessions.length&&sessions.forEach((function(session){session.mainSession&&!mainScreenBusy?(mainScreenBusy=!0,_this290.attachSessionVideoToHtmlElement(session,"largevideo")):(session.mainSession&&mainScreenBusy||!session.mainSession&&session.activeSpeaker&&!hasSharingSession)&&_this290.attachSessionVideoToHtmlElement(session,"sfuActiveSpeakerSecondVideo")})),conferenceSession.hasLocalVideo){var _session5=conferenceSession.sessions[conferenceSession.localVideoSessionId];_session5&&this.attachSessionVideoToHtmlElement(_session5,"conferenceVideoPip")}}}},{key:"attachRemoteAudioStream",value:function(conferenceSession){var _this291=this,audioSession=this.getRemoteAudioSession(conferenceSession.id);audioSession&&audioSession.remoteStreams&&audioSession.remoteStreams.forEach((function(track){track.getAudioTracks().length>0&&_this291.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),track,audioSession.sid)})),audioSession&&audioSession.remoteStreamsObject[0]&&this.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),audioSession.remoteStreamsObject[0],audioSession.sid)}},{key:"attachMainMediaStream",value:function(session){var _this292=this;session&&(this.$log.info("[webConferenceService] attachMainMediaStream"),session.remoteStreams.forEach((function(track){track.getVideoTracks().length>0&&_this292.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),track,session.sid)})),session&&session.remoteStreamsObject[0]&&this.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),session.remoteStreamsObject[0],session.sid))}},{key:"attachDistantBundleSession",value:function(session){var _this293=this;session&&(this.$log.info("[webConferenceService] attachDistantBundleSession"),session.remoteStreams.forEach((function(track){track.getVideoTracks().length>0&&_this293.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),track,session.sid),track.getAudioTracks().length>0&&_this293.videoService.RTC.attachMediaStream(angular.element("#globalAudioTag"),track)})),session&&session.remoteStreamsObject[0]&&this.videoService.RTC.attachMediaStream(angular.element("#globalAudioTag"),session.remoteStreamsObject[0]),session&&session.remoteStreamsObject[1]&&this.videoService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),session.remoteStreamsObject[1],session.sid))}},{key:"attachSessionVideoToHtmlElement",value:function(session,elementId){var _this294=this,tag="#"+elementId;session&&elementId?(this.$log.info("[webConferenceService] attachSessionVideoToHtmlElement"),session.remoteStreams.forEach((function(track){track.getVideoTracks().length>0&&_this294.videoService.RTC.attachMediaStreamIfNeeded(angular.element(tag),track,session.sid)})),session&&session.remoteStreamsObject[0]&&this.videoService.RTC.attachMediaStreamIfNeeded(angular.element(tag),session.remoteStreamsObject[0],session.sid),session.localStreams.forEach((function(track){track.getVideoTracks().length>0&&_this294.videoService.RTC.attachMediaStreamIfNeeded(angular.element(tag),track,session.sid)}))):!session&&elementId&&this.videoService.RTC.clearMediaStream(angular.element(tag),null)}},{key:"updateMainSessionIfNeededToDynamicFeed",value:function(conferenceSession,sessions){this.$log.info("[webConferenceService] updateMainSessionIfNeededToDynamicFeed");var shouldUpdateMainScreen=!0;if(sessions&&sessions.length){var dynamicFeedSession=null,firstSession=null;Object.keys(sessions).forEach((function(key){var session=sessions[key];session&&(firstSession||(firstSession=session),!dynamicFeedSession&&session.activeSpeaker&&(dynamicFeedSession=session),session.mainSession&&(session.pinned||session.activeSpeaker)&&(shouldUpdateMainScreen=!1))})),shouldUpdateMainScreen&&(dynamicFeedSession?(dynamicFeedSession.mainSession=!0,dynamicFeedSession.pinned=!1,conferenceSession.videoGallery.forEach((function(element){element.pinned=!1,element.mainSession=!1}))):firstSession&&(firstSession.mainSession=!0,firstSession.pinned=!1,conferenceSession.videoGallery.forEach((function(element){element.pinned=!1,element.sessionId===firstSession.sid?element.mainSession=!0:element.mainSession=!1}))))}return shouldUpdateMainScreen}},{key:"updateMainSessionIfNeeded",value:function(conferenceSession,sessions){this.$log.info("[webConferenceService] updateMainSessionIfNeeded");var shouldUpdateMainScreen=!0;if(sessions&&sessions.length){var firstSession=null;for(var property in sessions)sessions.hasOwnProperty(property)&&(firstSession||(firstSession=sessions[property]),sessions[property].mainSession&&(shouldUpdateMainScreen=!1));shouldUpdateMainScreen&&(firstSession.mainSession=!0,firstSession.pinned=!1,conferenceSession.videoGallery.forEach((function(element){element.pinned=!1,element.sessionId===firstSession.sid?element.mainSession=!0:element.mainSession=!1})))}return shouldUpdateMainScreen}},{key:"getRelatedRoomToActiveConferenceSession",value:function(){return this.webConferenceRoom}},{key:"getRelatedRoomToActiveSharingOnlyConferenceSession",value:function(){return this.webrtcSharingOnlyRoom}},{key:"getConferenceBySessionId",value:function(sessionId){var result=null;for(var webConference in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(webConference)&&this.conferenceSessions[webConference].sessions)for(var session in this.conferenceSessions[webConference].sessions)if(this.conferenceSessions[webConference].sessions.hasOwnProperty(session)&&this.conferenceSessions[webConference].sessions[session].sid===sessionId)return result=this.conferenceSessions[webConference];return result}},{key:"getPontConfIdForRoom",value:function(room){var mediaType=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.MEDIATYPE.WEBRTC;if(room.confEndpoints&&room.confEndpoints.length)for(var i=0;i<room.confEndpoints.length;i++)if(room.confEndpoints[i].mediaType===mediaType)return room.confEndpoints[i].confEndpointId;return""}},{key:"getConferenceSessionById",value:function(confId){return this.conferenceSessions[confId]}},{key:"getSfuConferenceSessionForRoom",value:function(room){var confSession=null;return room&&(confSession=this.conferenceSessions[room.getSFUConfEndpointId()]),confSession}},{key:"updateWebConferenceInfos",value:function(endpoints){var _this295=this;this.$log.info("[WebConferenceService] updateWebConferenceInfos"),Object.assign(this.conferenceEndpoints,endpoints),this.webrtcConferenceId=this.getWebRtcConfEndpointId(),this.webrtcConferenceId&&this.roomService.getRoomByConferenceEndpointId(this.webrtcConferenceId).then((function(conferenceRoom){var name="nothing";conferenceRoom&&(name=conferenceRoom.name),_this295.webConferenceRoom=conferenceRoom,_this295.$log.info("[WebConferenceService] === updateWebConferenceInfos : webrtcConferenceId is currently attached to "+name)}),(function(){_this295.$log.info("[WebConferenceService] === updateWebConferenceInfos FAILURE ===")}))}},{key:"updateWebSharingOnlyConferenceInfos",value:function(endpoints){var _this296=this;this.$log.info("[WebConferenceService] updateWebSharingOnlyConferenceInfos"),Object.assign(this.conferenceEndpoints,endpoints),this.webrtcSharingOnlyConferenceId=this.getWebRtcSharingOnlyConfEndpointId(),this.webrtcSharingOnlyConferenceId&&this.roomService.getRoomByConferenceEndpointId(this.webrtcSharingOnlyConferenceId).then((function(conferenceRoom){var name=conferenceRoom&&conferenceRoom.name?conferenceRoom.name:"nothing";_this296.webrtcSharingOnlyRoom=conferenceRoom,_this296.$log.info("[WebConferenceService] === updateWebSharingOnlyConferenceInfos : webrtcSharingOnlyConferenceId is currently attached to "+name)}),(function(){_this296.$log.info("[WebConferenceService] === updateWebSharingOnlyConferenceInfos FAILURE ===")}))}},{key:"updateWebConferenceRoom",value:function(){var _this297=this;return this.webrtcConferenceId=this.getWebRtcConfEndpointId(),this.$q((function(resolve,reject){_this297.roomService.getRoomByConferenceEndpointId(_this297.webrtcConferenceId).then((function(conferenceRoom){var name="nothing";conferenceRoom&&(name=conferenceRoom.name),_this297.webConferenceRoom=conferenceRoom,_this297.$log.info("[WebConferenceService] === updateWebConferenceRoom : room is currently attached to "+name),resolve()}),(function(){_this297.$log.info("[WebConferenceService] === updateWebConferenceRoom FAILURE==="),reject()}))}))}},{key:"getWebRtcConfEndpointId",value:function(){for(var property in this.conferenceEndpoints)if(this.conferenceEndpoints.hasOwnProperty(property)&&this.conferenceEndpoints[property].mediaType===this.MEDIATYPE.WEBRTC)return this.conferenceEndpoints[property].id;return null}},{key:"getWebRtcSharingOnlyConfEndpointId",value:function(){for(var property in this.conferenceEndpoints)if(this.conferenceEndpoints.hasOwnProperty(property)&&this.conferenceEndpoints[property].mediaType===this.MEDIATYPE.WEBRTCSHARINGONLY)return this.conferenceEndpoints[property].id;return null}},{key:"isJoinWebConferenceAllowed",value:function(){return!0}},{key:"getWebConference",value:function(confId){if(confId)return this.conferenceSessions[confId]}},{key:"removeConferenceSession",value:function(confId){if(confId){var statsInterval;for(this.removeAllJingleSessionsForConferenceSession(confId),delete this.conferenceSessions[confId];this.statsIntervals.length;)(statsInterval=this.statsIntervals.pop())&&(window.clearInterval(statsInterval),statsInterval=null);this.makingCall=!1}}},{key:"removeAllJingleSessionsForConferenceSession",value:function(confId){if(confId){var conferenceSession=this.conferenceSessions[confId];if(conferenceSession){for(var property in conferenceSession.metricsState="ended",conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];this.updateStatisticsForSession(conferenceSession.id,session.sid),delete this.videoService.callsStats[session.sid],this.videoService.disableAudioVideoMedia(session),this.xmppService.connection.jingle.terminate(session.sid)}conferenceSession.sessions=[]}}}},{key:"hasActiveConferenceSession",value:function(){for(var property in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(property)&&this.conferenceSessions[property].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[property].isActive()&&this.conferenceSessions[property].haveJoined)return!0;return!1}},{key:"hasActiveConferenceSessionWithAnyDevice",value:function(){for(var property in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(property)&&this.conferenceSessions[property].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[property].isActive()&&(this.conferenceSessions[property].haveJoined||this.conferenceSessions[property].joinedFromOtherDevice))return!0;return!1}},{key:"getActiveConferenceSession",value:function(){var result=null;for(var property in this.conferenceSessions)this.conferenceSessions.hasOwnProperty(property)&&this.conferenceSessions[property].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[property].isActive()&&this.conferenceSessions[property].haveJoined&&(result=this.conferenceSessions[property]);return result}},{key:"hasActiveSharingOnlyConferenceSession",value:function(){for(var property in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(property)&&this.conferenceSessions[property].type===this.MEDIATYPE.WEBRTCSHARINGONLY&&this.conferenceSessions[property].isActive())return!0;return!1}},{key:"getActiveSharingOnlyConferenceSession",value:function(){var result=null;for(var property in this.conferenceSessions)this.conferenceSessions.hasOwnProperty(property)&&this.conferenceSessions[property].type===this.MEDIATYPE.WEBRTCSHARINGONLY&&this.conferenceSessions[property].isActive()&&(result=this.conferenceSessions[property]);return result}},{key:"hasIncomingVideoStream",value:function(confId){if(confId){var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];if(!session.isInitiator&&("video"===session.remoteType||"sharing"===session.remoteType))return!0}return!1}}},{key:"getRemoteSessionsWithVideoOrSharingStreams",value:function(confId){var result=[];if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];session.isInitiator||"video"!==session.remoteType&&"sharing"!==session.remoteType&&"audio+video"!==session.remoteType||result.push(session)}return result}},{key:"getRemoteSharingSession",value:function(confId){var result=null;if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];if(!session.isInitiator&&"sharing"===session.remoteType){result=session;break}}return result}},{key:"getSharingSession",value:function(confId){var result=null;if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];if("sharing"===session.remoteType||"sharing"===session.localType){result=session;break}}return result}},{key:"hasRemoteVideoOrSharingSession",value:function(confId){var result=!1;if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];if(!session.isInitiator&&("video"===session.remoteType||"sharing"===session.remoteType||"audio+video"===session.remoteType)){result=!0;break}}return result}},{key:"getRemoteVideoSessions",value:function(confId){var result=[];if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];session.isInitiator||"video"!==session.remoteType||result.push(session)}return result}},{key:"getRemoteAudioVideoBundleSession",value:function(confId){var result;if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];if(!session.isInitiator&&"audio+video"===session.remoteType){result=session;break}}return result}},{key:"getRemoteAudioSession",value:function(confId){var result;if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];if("audio"===session.localType){result=session;break}}return result}},{key:"getRemoteMainVideoSession",value:function(confId){var sess;if(!confId)return sess;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];if(!session.isInitiator&&"video"===session.remoteType&&session.mainSession){sess=session;break}}return sess}},{key:"isAlreadySubscribedToDynamicFeed",value:function(confId){if(!confId)return!1;var result=!1,conferenceSession=this.conferenceSessions[confId];return conferenceSession&&conferenceSession.videoGallery&&"videoGallery_0"===conferenceSession.videoGallery[0].id&&"busy"===conferenceSession.videoGallery[0].state&&(result=!0),result}},{key:"isAlreadySubscribedToPublisher",value:function(confId,publisherId){if(!confId||!publisherId)return!1;var result=!1,conferenceSession=this.conferenceSessions[confId];if(conferenceSession&&conferenceSession.videoGallery)for(var i=0;i<conferenceSession.videoGallery.length;i++)if(!conferenceSession.videoGallery[i].activeSpeaker&&conferenceSession.videoGallery[i].publisherId===publisherId){result=!0;break}return result}},{key:"getSessionIdForParticipantByPublisherId",value:function(confId,publisherId){var result="";if(!confId||!publisherId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession&&conferenceSession.videoGallery)for(var i=0;i<conferenceSession.videoGallery.length;i++)if(conferenceSession.videoGallery[i].publisherId===publisherId){result=conferenceSession.videoGallery[i].sessionId;break}return result}},{key:"relatePublisherToElement",value:function(confId,publisher,elementId,subStreamLevel){var activeSpeaker=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!confId||!publisher||!elementId)return!1;this.$log.info("[WebConferenceService] relatePublisherToElement");var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)if(activeSpeaker)conferenceSession.videoGallery[0].state="busy",conferenceSession.videoGallery[0].publisherId="",conferenceSession.videoGallery[0].simulcast=publisher.simulcast,conferenceSession.videoGallery[0].subStreamLevel=subStreamLevel;else for(var i=0;i<conferenceSession.videoGallery.length;i++)if(conferenceSession.videoGallery[i].id===elementId){conferenceSession.videoGallery[i].state="busy",conferenceSession.videoGallery[i].publisherId=publisher.participantId,conferenceSession.videoGallery[i].publisherJidIm=publisher.jid_im,conferenceSession.videoGallery[i].displayName=publisher.participantId,conferenceSession.videoGallery[i].simulcast=publisher.simulcast,conferenceSession.videoGallery[i].subStreamLevel=subStreamLevel;var contact=this.contactService.getContact(publisher.jid_im);contact&&(conferenceSession.videoGallery[i].displayName=contact.displayName);break}this.updateSubStreamLevelsForConferenceSession(confId)}},{key:"getRelatedPublisherToElement",value:function(confId,elementId){if(!confId||!elementId)return null;this.$log.info("[WebConferenceService] getRelatedPublisherToElement");var result=null,conferenceSession=this.conferenceSessions[confId];if(conferenceSession&&conferenceSession.videoGallery)for(var i=0;i<conferenceSession.videoGallery.length;i++)if(elementId===conferenceSession.videoGallery[i].id&&conferenceSession.videoGallery[i].publisherId){result=conferenceSession.videoGallery[i];break}return result}},{key:"getRelatedElementToPublisher",value:function(confId,publisherId){if(!confId||!publisherId)return null;this.$log.info("[WebConferenceService] getRelatedPublisherToElement");var element=null,conferenceSession=this.conferenceSessions[confId];if(conferenceSession&&conferenceSession.videoGallery)for(var i=0;i<conferenceSession.videoGallery.length;i++)if(conferenceSession.videoGallery[i].publisherId===publisherId){element=conferenceSession.videoGallery[i];break}return element}},{key:"relateSessionToPublisher",value:function(confId,publisherId,sessionId){if(!confId||!publisherId||!sessionId)return!1;this.$log.info("[WebConferenceService] relateSessionToPublisher pubId "+publisherId+" sessionId "+sessionId);var result=!1,conferenceSession=this.conferenceSessions[confId];if(conferenceSession){for(var i=0;i<conferenceSession.videoGallery.length;i++)if(publisherId===conferenceSession.videoGallery[i].publisherId&&!conferenceSession.videoGallery[i].sessionId){conferenceSession.videoGallery[i].sessionId=sessionId,result=!0,"videoGallery_0"===conferenceSession.videoGallery[i].id&&(conferenceSession.sessions[sessionId].activeSpeaker=!0,conferenceSession.videoGallery[i].publisherId="");break}this.$log.info(conferenceSession.videoGallery)}return result}},{key:"removeSessionFromVideoGallery",value:function(conferenceSession,sessionId){if(conferenceSession&&sessionId){conferenceSession.videoGallery||(this.createVideoGalleryElements(conferenceSession.conferenceView),conferenceSession.videoGallery=this.videoGalleryElements),this.$log.info("[WebConferenceService] removeSessionFromVideoGallery for conference "+conferenceSession.id+" sessionId "+sessionId);for(var i=0;i<conferenceSession.videoGallery.length;i++)conferenceSession.videoGallery[i].sessionId===sessionId&&(conferenceSession.videoGallery[i].sessionId="",conferenceSession.videoGallery[i].state="free",conferenceSession.videoGallery[i].publisherId="",conferenceSession.videoGallery[i].publisherJidIm="",conferenceSession.videoGallery[i].displayName="",conferenceSession.videoGallery[i].simulcast=null,conferenceSession.videoGallery[i].subStreamLevel=null,conferenceSession.videoGallery[i].mainSession=!1,conferenceSession.videoGallery[i].pinned=!1,conferenceSession.videoGallery[i].hold=!1);conferenceSession.videoGallery=this.updateVideoGalleryElementsState(conferenceSession,conferenceSession.videoGallery,conferenceSession.conferenceView)}}},{key:"reInitialiseVideoGalleryElementById",value:function(conferenceSession,elementId){if(conferenceSession&&elementId){conferenceSession.videoGallery||(this.createVideoGalleryElements(conferenceSession.conferenceView),conferenceSession.videoGallery=this.videoGalleryElements),this.$log.info("[WebConferenceService] reInitialiseVideoGalleryElementById for conference "+conferenceSession.id+" elementId "+elementId);for(var i=0;i<conferenceSession.videoGallery.length;i++)conferenceSession.videoGallery[i].id===elementId&&(conferenceSession.videoGallery[i].sessionId&&this.dropRemoteVideoSession(conferenceSession,conferenceSession.videoGallery[i].sessionId),conferenceSession.videoGallery[i].sessionId="",conferenceSession.videoGallery[i].state="free",conferenceSession.videoGallery[i].publisherId="",conferenceSession.videoGallery[i].publisherJidIm="",conferenceSession.videoGallery[i].displayName="",conferenceSession.videoGallery[i].subStreamLevel=null,conferenceSession.videoGallery[i].simulcast=null,conferenceSession.videoGallery[i].hold=!1,conferenceSession.videoGallery[i].reconnecting=!1);conferenceSession.videoGallery=this.updateVideoGalleryElementsState(conferenceSession,conferenceSession.videoGallery,conferenceSession.conferenceView)}}},{key:"updateMainScreenSession",value:function(confId){var element=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(confId){this.$log.info("[WebConferenceService] updateMainScreenSession");var conferenceSession=this.conferenceSessions[confId];if(conferenceSession){for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var sess=conferenceSession.sessions[property];element&&element.sessionId===sess.sid?(sess.mainSession=!0,sess.pinned=!0):(sess.mainSession=!1,sess.pinned=!1)}return conferenceSession.videoGallery.forEach((function(galleryElement){element&&galleryElement.id===element.id?(galleryElement.mainSession=!0,galleryElement.pinned=!0):(galleryElement.mainSession=!1,galleryElement.pinned=!1)})),conferenceSession}}}},{key:"updateSubStreamLevelsForConferenceSession",value:function(confId){var _this298=this;this.$log.info("[WebConferenceService] updateSubStreamLevelsForConferenceSession");var conferenceSession=this.conferenceSessions[confId],webConferenceParticipant=conferenceSession.getConnectedParticipantByJid(this.contactService.userContact.jid),remoteSharingSession=this.getRemoteSharingSession(conferenceSession.id);remoteSharingSession&&!remoteSharingSession.showOnSecondPip?conferenceSession.videoGallery.forEach((function(element){element.simulcast&&"videoGallery_0"!==element.id&&_this298.updateSubstreamLevelForPublisher(conferenceSession.id,webConferenceParticipant.participantId,"0",element)})):conferenceSession.videoGallery.forEach((function(element){if(element.simulcast&&"videoGallery_0"!==element.id){var session=conferenceSession.sessions[element.sessionId];if(session){var level=session.mainSession?"2":"0";_this298.updateSubstreamLevelForPublisher(conferenceSession.id,webConferenceParticipant.participantId,level,element)}}}))}},{key:"getListOfAvailableRemoteVideoPublishers",value:function(confId){if(confId){this.$log.info("[WebConferenceService] getListOfAvailableRemoteVideoPublishers");var conferenceSession=this.conferenceSessions[confId],publishers=[];return conferenceSession&&(conferenceSession.videoGallery||(this.createVideoGalleryElements(conferenceSession.conferenceView),conferenceSession.videoGallery=this.videoGalleryElements),publishers=(publishers=conferenceSession.getListOfRemoteVideoPublishers()).filter((function(publisher){for(var i=0;i<conferenceSession.videoGallery.length;i++)if(conferenceSession.videoGallery[i].publisherId===publisher.participantId)return!1;return!0}))),publishers}}},{key:"getListOfPublishersForElementsOnHold",value:function(confId){if(confId){this.$log.info("[WebConferenceService] getListOfPublishersForElementsOnHold");var conferenceSession=this.conferenceSessions[confId],publishers=[];if(conferenceSession){conferenceSession.videoGallery||(this.createVideoGalleryElements(conferenceSession.conferenceView),conferenceSession.videoGallery=this.videoGalleryElements);for(var remotePublishers=conferenceSession.getListOfRemoteVideoPublishers(),_loop5=function(i){conferenceSession.videoGallery[i].publisherId&&conferenceSession.videoGallery[i].hold&&remotePublishers.forEach((function(pub){pub.participantId===conferenceSession.videoGallery[i].publisherId&&publishers.push(pub)}))},i=0;i<conferenceSession.videoGallery.length;i++)_loop5(i)}return publishers}}},{key:"sendTransportReplaceForSession",value:function(sess,timeout){var _this299=this;sess?this.reconnecting[sess.sid]?this.$log.warn("[WebConferenceService] sendTransportReplaceForSession already reconnecting for session "+sess.id):(this.reconnecting[sess.sid]=!0,timeout||(timeout=1e3),this.$interval((function(session){if(_this299.reconnecting[session.sid]=!1,delete _this299.reconnecting[session.sid],_this299.connected&&session&&session.peerconnection&&"stable"===session.peerconnection.signalingState&&("failed"===session.peerconnection.iceConnectionState||"disconnected"===session.peerconnection.iceConnectionState)&&(_this299.$log.info("[WebConferenceService] sendTransportReplaceForSession for session "+session.sid),session.connection=_this299.xmppService.connection,session.reconnectSession(),session.type!==_this299.MEDIATYPE.WEBRTCSHARINGONLY)){var state=session.hasLocalSharing?"sharing":"audio";_this299.contactService.setBusyState("dnd",state)}}),timeout,1,!0,sess)):this.$log.warn("[WebConferenceService] sendTransportReplaceForSession missing session !")}},{key:"onAudioProfileChangeEvent",value:function(){var _this300=this;if(this.$log.info("[WebConferenceService] onAudioProfileChangeEvent"),this.audioProfileChanging)this.$log.info("[WebConferenceService] onAudioProfileChangeEvent -- already changing");else for(var key in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(key)){var conferenceSession=this.conferenceSessions[key];for(var sessId in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(sessId)){var session=conferenceSession.sessions[sessId];"audio"===session.localType&&(this.audioProfileChanging=!0,this.$interval((function(sess){_this300.audioProfileChanging=!1,_this300.videoService.getBrowserMedia(["audio"]).then((function(stream){sess.removeStream(sess.localStreams[0]),_this300.videoService.stopActiveAudioVideoStreams(sess),sess.localStreams.push(stream),sess.addStream(sess.localStreams[0]),sess.sendTransportReplace()}))}),500,1,!0,session))}}}},{key:"onJingleError",value:function(sessionId){this.$log.info("[WebConferenceService] onJingleError -- "+sessionId);var webConference=this.getConferenceBySessionId(sessionId);webConference&&webConference.sessions&&("audio"===webConference.sessions[sessionId].localType?this.leaveWebConference(webConference.id):(this.updateStatisticsForSession(webConference.id,sessionId),webConference.localVideoSessionId===sessionId?this.removeMediaFromConferenceSession(webConference,"video"):webConference.localSharingSessionId===sessionId?this.removeMediaFromConferenceSession(webConference,"sharing"):(this.removeSessionFromVideoGallery(webConference,sessionId),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",webConference))))}},{key:"onIceConnectionDisconnectedForSession",value:function(conferenceSession,sessionId){if(this.$log.info("[WebConferenceService] onIceConnectionDisconnectedForSession -- "+sessionId),conferenceSession&&conferenceSession.sessions){var session=conferenceSession.sessions[sessionId];"audio"===session.localType?(conferenceSession.status="reconnecting",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession),this.connected&&this.sendTransportReplaceForSession(session,1e3)):conferenceSession.localVideoSessionId!==sessionId&&conferenceSession.localSharingSessionId!==sessionId||this.connected&&this.sendTransportReplaceForSession(session,1e3)}}},{key:"onIceConnectionFailedForSession",value:function(conferenceSession,sessionId){if(this.$log.info("[WebConferenceService] onIceConnectionFailedForSession -- "+sessionId),conferenceSession&&conferenceSession.sessions){var session=conferenceSession.sessions[sessionId];if(!session)return void this.$log.info("[WebConferenceService] onIceConnectionFailedForSession -- session is missing");"audio"===session.localType?(conferenceSession.status="reconnecting",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession),this.connected&&this.sendTransportReplaceForSession(session,500)):conferenceSession.localVideoSessionId===sessionId||conferenceSession.localSharingSessionId===sessionId?this.connected&&this.sendTransportReplaceForSession(session,500):"video"===session.remoteType?(this.xmppService.connection.jingle.terminate(sessionId),this.updateStatisticsForSession(conferenceSession.id,sessionId),delete this.videoService.callsStats[sessionId],conferenceSession.videoGallery.forEach((function(element){element.sessionId===sessionId&&(element.sessionId="")})),delete conferenceSession.sessions[sessionId],this.connected&&this.resubscribeToSessions(conferenceSession)):(this.xmppService.connection.jingle.terminate(sessionId,"icefailed"),this.updateStatisticsForSession(conferenceSession.id,sessionId),delete this.videoService.callsStats[sessionId],this.removeSessionFromVideoGallery(conferenceSession,sessionId),delete conferenceSession.sessions[sessionId],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession))}}},{key:"onIncomingCall",value:function(sessionId){this.$log.info("[WebConferenceService] onIncomingCall -- "+sessionId);var session=this.xmppService.connection.jingle.sessions[sessionId],pontConfId=session.confId,conferenceSession=this.conferenceSessions[pontConfId];if(conferenceSession){if(conferenceSession.sessions[sessionId]=session,session.localType=session.remoteType,session.sendAnswer(),session.accept(),"video"===session.remoteType)if(!this.activeSpeaker||session.publisherId&&conferenceSession.videoGallery[0].sessionId!==session.sid){if(!this.relateSessionToPublisher(pontConfId,session.publisherId,session.sid)){this.$log.info("[WebConferenceService] no gallery element related to session, attach to first available");var element=this.getFreeVideoGalleryElement(pontConfId);element&&!this.isAlreadySubscribedToPublisher(conferenceSession.id,session.publisherId)&&(element.state="busy",element.publisherId=session.publisherId,element.sessionId=session.sid)}}else conferenceSession.videoGallery[0].publisherId="",session.activeSpeaker=!0;"sharing"===session.remoteType&&(this.updateSubStreamLevelsForConferenceSession(pontConfId),this.updateConferenceViewIfNeeded(pontConfId)),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession),this.videoService.callsStats[session.sid]={},this.updateStatisticsForSession(conferenceSession.id,session.sid),this.statsIntervals.push(session.getStats(5e3))}else this.$log.error("[WebConferenceService] onIncomingCall no such conferenceSession "+pontConfId)}},{key:"onTerminatedCall",value:function(sessionId){this.$log.info("[WebConferenceService] onTerminatedCall -- "+sessionId);var session=this.xmppService.connection.jingle.sessions[sessionId];if(session){var pontConfId=session.confId,conferenceSession=this.conferenceSessions[pontConfId];conferenceSession?(this.updateStatisticsForSession(conferenceSession.id,sessionId),session&&"audio"===session.localType&&this.leaveWebConference(conferenceSession.id),conferenceSession.localVideoSessionId===sessionId?this.removeMediaFromConferenceSession(conferenceSession,"video"):conferenceSession.localSharingSessionId===sessionId?this.removeMediaFromConferenceSession(conferenceSession,"sharing"):(this.removeSessionFromVideoGallery(conferenceSession,sessionId),this.videoService.disableAudioVideoMedia(session),this.xmppService.connection.jingle.terminate(session.sid),delete conferenceSession.sessions[session.sid],delete this.videoService.callsStats[sessionId],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession))):this.$log.error("[WebConferenceService] onTerminatedCall no such conferenceSession "+pontConfId)}else{var _conferenceSession=this.getActiveConferenceSession()?this.getActiveConferenceSession():this.getActiveSharingOnlyConferenceSession();if(_conferenceSession&&_conferenceSession.sessions){var sess=_conferenceSession.sessions[sessionId];sess&&(_conferenceSession.metricsState="ended"),sess&&"audio"===sess.localType?this.leaveWebConference(_conferenceSession.id):_conferenceSession.localVideoSessionId===sessionId?this.removeMediaFromConferenceSession(_conferenceSession,"video"):_conferenceSession.localSharingSessionId===sessionId?this.removeMediaFromConferenceSession(_conferenceSession,"sharing"):(this.removeSessionFromVideoGallery(_conferenceSession,sessionId),this.videoService.disableAudioVideoMedia(_conferenceSession.sessions[sessionId]),delete _conferenceSession.sessions[sessionId],delete this.videoService.callsStats[sessionId],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",_conferenceSession),this.updateSubStreamLevelsForConferenceSession(_conferenceSession.id))}}}},{key:"onConferenceCallSwitched",value:function(sessionId){this.$log.info("[WebConferenceService] onConferenceCallSwitched -- "+sessionId);var conferenceSession=this.getActiveConferenceSession();conferenceSession&&this.leaveWebConference(conferenceSession.id)}},{key:"onIceConnectionStateChange",value:function(sessionId,session){var _this301=this;this.$log.info("[WebConferenceService] onIceConnectionStateChange for session "+sessionId);var webConference=this.getConferenceBySessionId(sessionId);try{if(webConference&&session.peerconnection){if("stable"===session.peerconnection.signalingState&&"connected"===session.peerconnection.iceConnectionState){this.$log.info("[WebConferenceService] ICE Connection established successfully");var webConferenceParticipant=webConference.getConnectedParticipantByJid(this.contactService.userContact.jid);"connected"!==webConference.status&&webConferenceParticipant&&webConferenceParticipant.mute&&this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",this.$translate.instant("youMuted")),webConference.status="connected",webConference.startDuration(),session.remoteStreams&&session.remoteStreams.forEach((function(track){track.getAudioTracks().length>0&&(_this301.videoService.RTC.attachMediaStream(angular.element("#globalAudioTag"),track),_this301.videoService.resetAudioOutputElement(!0))})),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",webConference),this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",webConference)}"stable"===session.peerconnection.signalingState&&"completed"===session.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection completed successfully"),"connected"!==webConference.status&&(webConference.status="connected",webConference.startDuration(),session.remoteStreams&&session.remoteStreams.forEach((function(track){track.getAudioTracks().length>0&&(_this301.videoService.RTC.attachMediaStream(angular.element("#globalAudioTag"),track),_this301.videoService.resetAudioOutputElement(!0))})),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",webConference),this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",webConference))),"stable"===session.peerconnection.signalingState&&"disconnected"===session.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection State disconnected"),this.onIceConnectionDisconnectedForSession(webConference,sessionId)),"stable"===session.peerconnection.signalingState&&"failed"===session.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection State failed"),this.onIceConnectionFailedForSession(webConference,sessionId))}}catch(error){this.$log.error("[WebConferenceService] onIceConnectionStateChange error "+error)}}},{key:"updateOrCreateConferenceSession",value:function(confId,snapshotData){var _this302=this,type=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"webrtc";if(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession for "+confId),!confId||!snapshotData||!snapshotData.data)return this.$log.error("[webConferenceService] updateOrCreateConferenceSession - Not enough data"),null;var conferenceSession=this.conferenceSessions[confId];return conferenceSession?snapshotData.data.active!==conferenceSession.active&&(this.$log.debug("active"),conferenceSession.updateActiveState(snapshotData.data.active),snapshotData.data.active?this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",conferenceSession):this.leaveWebConference(confId)):(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession - create new conferencesession with id "+confId+"and data: \n"+JSON.stringify(snapshotData.data)),conferenceSession=this.ConferenceSession.createFromData(confId,[],snapshotData.data.active,type),this.conferenceSessions[confId]=conferenceSession,this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",conferenceSession)),snapshotData.data.participants&&(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession - (is active : "+conferenceSession.active+") update participants for "+confId+" with:\n"+JSON.stringify(snapshotData.data.participants)),conferenceSession.updateParticipants(snapshotData.data.participants).then((function(){_this302.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",conferenceSession)}))),conferenceSession}},{key:"updateOrCreateWebConferenceEndpoint",value:function(conferenceData){if(this.$log.info("[WebConferenceService] updateOrCreateWebConferenceEndpoint for "+conferenceData.id),!conferenceData)return this.$log.error("[WebConferenceService] updateOrCreateWebConferenceEndpoint - no conference data !"),null;if(conferenceData.mediaType!==this.MEDIATYPE.WEBRTC&&conferenceData.mediaType!==this.MEDIATYPE.WEBRTCSHARINGONLY)return this.$log.error("[WebConferenceService] updateOrCreateWebConferenceEndpoint - wrong mediaType:"+conferenceData.mediaType),null;var conference=this.Conference.createFromData(conferenceData);return this.conferenceEndpoints[conferenceData.id]=conference,conference.mediaType===this.MEDIATYPE.WEBRTC?this.updateWebConferenceInfos([conference]):this.updateWebSharingOnlyConferenceInfos([conference]),this.conferenceEndpoints[conferenceData.id]}},{key:"makeSnapshotForConfId",value:function(){var _this303=this,confId=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,mediaType=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"webrtc",force=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!confId){var errorMsg="[webConferenceService] makeSnapshotForConfId - No confId !!";return this.$log.error(errorMsg),this.$q.reject(errorMsg)}var confSession=this.conferenceSessions[confId];return!force&&confSession&&confSession.active&&confSession.haveJoined?(this.$log.debug("[WebConferenceService] makeSnapshotForConfId skipped, already joined"),this.$q.resolve(confSession)):!force&&confSession&&this.makingCall?(this.$log.debug("[WebConferenceService] makeSnapshotForConfId skipped, we're currently joining the conference"),this.$q.resolve(confSession)):this.$q((function(resolve,reject){_this303.$http({method:"GET",url:_this303.confPortalURL+confId+"/snapshot?mediaType=webrtc",headers:_this303.authService.getRequestHeader()}).then((function(response){_this303.$log.info("[webConferenceService] makeSnapshotForConfId success for confId "+confId);var snapshotData=response.data;_this303.updateOrCreateConferenceSession(confId,snapshotData,mediaType),resolve(snapshotData.data)})).catch((function(errorResponse){_this303.$log.info("[webConferenceService] makeSnapshotForConfId failure for confID "+confId),404===errorResponse.status?_this303.$log.error("[webConferenceService] makeSnapshotForConfId - confId "+confId+" not found on server"):_this303.$log.error("[webConferenceService] makeSnapshotForConfId - inconsistent object on server"),_this303.conferenceSessions[confId]&&_this303.removeConferenceSession(confId),reject()}))}))}},{key:"refreshConferenceSessions",value:function(){var _this304=this;return this.$log.info("[webConferenceService] refreshConferenceSessions"),this.$q((function(resolve,reject){var promiseArray=[];for(var key in _this304.conferenceSessions)if(_this304.conferenceSessions.hasOwnProperty(key)){var conferenceSession=_this304.conferenceSessions[key];promiseArray.push(_this304.makeSnapshotForConfId(conferenceSession.id,conferenceSession.type))}_this304.$q.all(promiseArray).then((function(){_this304.$log.info("[webConferenceService] refreshConferenceSessions -- success"),resolve()})).catch((function(){_this304.$log.error("[webConferenceService] refreshConferenceSessions -- error -- some session are corrupted and deleted"),reject()}))}))}},{key:"removeAllConferenceSessions",value:function(){for(var key in this.$log.info("[webConferenceService] removeAllConferenceSessions"),this.conferenceSessions)this.conferenceSessions.hasOwnProperty(key)&&this.removeConferenceSession(key)}},{key:"getConferenceSessionForRoom",value:function(roomConfEndpoints){var sfuSession=null;if(roomConfEndpoints&&roomConfEndpoints.length)for(var i=0;i<roomConfEndpoints.length;i++)roomConfEndpoints[i].mediaType!==this.MEDIATYPE.WEBRTC&&roomConfEndpoints[i].mediaType!==this.MEDIATYPE.WEBRTCSHARINGONLY||(sfuSession=this.conferenceSessions[roomConfEndpoints[i].confEndpointId]);return sfuSession}},{key:"removeVideoGalleryVideos",value:function(conferenceSession){var _this305=this;conferenceSession&&conferenceSession.videoGallery&&conferenceSession.videoGallery.forEach((function(element){var session=conferenceSession.sessions[element.sessionId];session&&(_this305.updateStatisticsForSession(conferenceSession.id,session.sid),_this305.videoService.disableAudioVideoMedia(session),delete conferenceSession.sessions[session.sid],delete conferenceSession.localStreams[session.localStreamId],delete _this305.videoService.callsStats[session.sid],_this305.xmppService.connection.jingle.terminate(session.sid))}))}},{key:"relateSessionToActiveSpeakerElement",value:function(confId,sessionId){if(confId){var conferenceSession=this.conferenceSessions[confId];conferenceSession&&conferenceSession.videoGallery&&(conferenceSession.videoGallery[0].sessionId=sessionId,conferenceSession.videoGallery[0].publisherId="")}}},{key:"resubscribeToSessions",value:function(conferenceSession){var _this306=this;conferenceSession&&conferenceSession.publishers.length&&conferenceSession.videoGallery.forEach((function(element){if("videoGallery_0"!==element.id||"busy"!==element.state||element.reconnecting||element.sessionId){if("busy"===element.state&&!element.reconnecting&&!element.sessionId&&element.publisherId){element.reconnecting=!0;var publisher=conferenceSession.getPublisherById(element.publisherId);_this306.subscribeToPublisher(conferenceSession.id,publisher,element.id,element.subStreamLevel).then((function(){_this306.$log.info("[ConferenceService] resubscribeToSession for element "+element.id+" and publisher id "+element.publisherId+" -- success"),element.reconnecting=!1})).catch((function(){_this306.$log.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+element.id),_this306.reInitialiseVideoGalleryElementById(conferenceSession,element.id)}))}}else element.reconnecting=!0,_this306.subscribeToPublisher(conferenceSession.id,conferenceSession.publishers[0],element.id,"2",!0).then((function(){_this306.$log.info("[ConferenceService] resubscribeToSession dynamic feed for element "+element.id+" -- success"),element.reconnecting=!1})).catch((function(){_this306.$log.error("[ConferenceService] subscribe to publisher dynamic feed failed, reset the video gallery element with id "+element.id),_this306.reInitialiseVideoGalleryElementById(conferenceSession,element.id)}))}))}},{key:"subscribeToPublishers",value:function(conferenceSession){var _this307=this;conferenceSession&&conferenceSession.publishers.length&&conferenceSession.publishers.forEach((function(publisher){if("video"===publisher.mediaType&&!_this307.isAlreadySubscribedToPublisher(conferenceSession.id,publisher.participantId)){var element=_this307.getFreeVideoGalleryElement(conferenceSession.id);if(element){element.state="busy",element.publisherId=publisher.participantId;var subStreamLevel=publisher.simulcast?"0":null;_this307.subscribeToPublisher(conferenceSession.id,publisher,element.id,subStreamLevel).catch((function(){_this307.$log.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+element.id),_this307.reInitialiseVideoGalleryElementById(conferenceSession,element.id)}))}}}))}},{key:"updateConferenceViewIfNeeded",value:function(confId){if(confId){var conferenceSession=this.conferenceSessions[confId];conferenceSession&&conferenceSession.conferenceView===this.ConferenceSession.ConferenceView.GridView&&this.modifyConferenceView(confId,this.ConferenceSession.ConferenceView.GalleryView)}}},{key:"modifyConferenceView",value:function(confId,conferenceView){if(confId){var conferenceSession=this.conferenceSessions[confId];if(conferenceSession&&conferenceSession.conferenceView!==conferenceView){if(conferenceSession.conferenceView=conferenceView,conferenceView===this.ConferenceSession.ConferenceView.GalleryView){if(conferenceSession.videoGallery=this.updateVideoGalleryElementsState(conferenceSession,conferenceSession.videoGallery,conferenceView),!this.isAlreadySubscribedToDynamicFeed(conferenceSession.id)){var _step12,publisher=null,_iterator12=_createForOfIteratorHelper(conferenceSession.publishers);try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var pub=_step12.value;if("video"===pub.mediaType){publisher=pub;break}}}catch(err){_iterator12.e(err)}finally{_iterator12.f()}this.subscribeToDynamicFeed(conferenceSession.id,publisher,conferenceSession.videoGallery[0].id,"2",!0)}this.subscribeToPublishers(conferenceSession)}else if(conferenceView===this.ConferenceSession.ConferenceView.SpeakerView){if(conferenceSession.videoGallery=this.updateVideoGalleryElementsState(conferenceSession,conferenceSession.videoGallery,conferenceView),!this.isAlreadySubscribedToDynamicFeed(conferenceSession.id)){var _step13,_publisher=null,_iterator13=_createForOfIteratorHelper(conferenceSession.publishers);try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var _pub=_step13.value;if("video"===_pub.mediaType){_publisher=_pub;break}}}catch(err){_iterator13.e(err)}finally{_iterator13.f()}this.subscribeToDynamicFeed(conferenceSession.id,_publisher,conferenceSession.videoGallery[0].id,"2",!0)}}else conferenceView===this.ConferenceSession.ConferenceView.GridView&&(conferenceSession.videoGallery=this.updateVideoGalleryElementsState(conferenceSession,conferenceSession.videoGallery,conferenceView),this.subscribeToPublishers(conferenceSession));console.error(conferenceSession.videoGallery),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession)}}}},{key:"getActiveSpeakerSession",value:function(confId){var result=null;if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];if(conferenceSession)for(var sessId in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(sessId)){var session=conferenceSession.sessions[sessId];if(session.activeSpeaker){result=session;break}}return result}},{key:"getPinnedGalleryElement",value:function(confId){var result=null;if(!confId)return result;var conferenceSession=this.conferenceSessions[confId];return conferenceSession&&conferenceSession.videoGallery&&conferenceSession.videoGallery.forEach((function(element){element.pinned&&(result=element)})),result}},{key:"subscribeToDynamicFeed",value:function(){var _this308=this,confId=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",publisher=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,elementId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",subStreamLevel=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,activeSpeaker=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.$q((function(resolve,reject){if(!confId||!publisher)return _this308.$log.warn("[WebConferenceService] subscribeToDynamicFeed missing parameters !! Ignore !"),void resolve();if(!_this308.activeSpeaker)return _this308.$log.warn("[WebConferenceService] subscribeToDynamicFeed -- feature not activated"),void resolve();if(_this308.conferenceSessions[confId].videoGallery[0].state="busy",_this308.conferenceSessions[confId].conferenceView===_this308.ConferenceSession.ConferenceView.GalleryView&&!_this308.isAlreadySubscribedToPublisher(confId,publisher.participantId)){var element=_this308.getFreeVideoGalleryElement(confId);element&&(element.state="busy",element.publisherId=publisher.participantId,_this308.$interval((function(confId,newPublisher,elemToSubscribe){_this308.subscribeToPublisher(confId,newPublisher,elemToSubscribe,"0")}),2500,1,!0,confId,publisher,element.id))}return _this308.subscribeToPublisher(confId,publisher,elementId,subStreamLevel,activeSpeaker)}))}},{key:"subscribeToPublisher",value:function(){var _this309=this,confId=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",publisher=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,elementId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",subStreamLevel=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,activeSpeaker=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.$q((function(resolve,reject){if(!confId||!publisher)return _this309.$log.warn("[WebConferenceService] subscribeToPublisher missing parameters !! Ignore !"),void resolve();_this309.$log.info("[WebConferenceService] subscribeToPublisher for confId "+confId+" and publisher "+publisher.participantId),elementId&&_this309.relatePublisherToElement(confId,publisher,elementId,subStreamLevel,activeSpeaker);var params=subStreamLevel?{subStreamLevel:subStreamLevel}:{};activeSpeaker&&(params.dynamicFeed=!0,"true"===_this309.settingsService.getSetting("dynamicFeedMediumStream")&&(params.subStreamLevel="1")),_this309.$http({method:"POST",url:_this309.confPortalURL+confId+"/participants/"+publisher.participantId+"/subscribe",headers:_this309.authService.getRequestHeader(),data:params}).then((function(response){_this309.$log.info("[WebConferenceService] subscribeToPublisher successfully"),activeSpeaker&&_this309.relateSessionToActiveSpeakerElement(confId,response.data.data.sid),resolve(response.data)}),(function(response){var errorMessage="subscribeToPublisher failure: "+(response.data?response.data.errorDetails:response.data);_this309.$log.error("[WebConferenceService] "+errorMessage),reject(new Error(errorMessage))}))}))}},{key:"onNetworkQualityChange",value:function(sessionId){var webConference=this.getConferenceBySessionId(sessionId);if(webConference&&webConference.sessions){var session=webConference.sessions[sessionId];session&&"audio"===session.localType&&(this.videoService.callsStatsSimplified[sessionId].networkQualityFlag===webConference.networkQuality?(this.videoService.callsStatsSimplified[sessionId].networkQualityIteration=this.videoService.callsStatsSimplified[sessionId].networkQualityIteration?this.videoService.callsStatsSimplified[sessionId].networkQualityIteration+1:1,0===webConference.networkQuality&&this.videoService.callsStatsSimplified[sessionId].networkQualityIteration>=3&&this.$rootScope.$broadcast("ON_CONFERENCE_NETWORK_UPDATE_EVENT",webConference,"badNetworkQuality",webConference.networkQuality)):this.videoService.callsStatsSimplified[sessionId].networkQualityIteration=1,webConference.networkQuality=this.videoService.callsStatsSimplified[sessionId].networkQualityFlag,this.$rootScope.$broadcast("ON_CONFERENCE_NETWORK_UPDATE_EVENT",webConference,"networkQuality",webConference.networkQuality))}}},{key:"delegateConferenceToParticipant",value:function(confId,participantId){var _this310=this;return this.$q((function(resolve,reject){_this310.$http({method:"PUT",url:_this310.confPortalURL+confId+"/participants/"+participantId+"/delegate",headers:_this310.authService.getRequestHeader()}).then((function(response){_this310.$log.info("[WebConferenceService] delegateConferenceToParticipant successfully"),resolve(response.data)}),(function(response){var errorMessage="delegateConferenceToParticipant failure: "+(response.data?response.data.errorDetails:response.data);_this310.$log.error("[WebConferenceService] "+errorMessage),reject(new Error(errorMessage))}))}))}},{key:"onConferenceDelegated",value:function(oldConfId,newConfId){var _this311=this;this.$log.info("[WebConferenceService] onConferenceDelegated from "+oldConfId+" to "+newConfId),this.conferenceSessions[newConfId]=this.conferenceSessions[oldConfId],this.conferenceSessions[newConfId].id=newConfId,this.isMyConference(newConfId)&&(this.conferenceSessions[newConfId].isMyConference=!0,this.conferenceSessions[newConfId].participants&&this.conferenceSessions[newConfId].participants.length&&this.conferenceSessions[newConfId].participants.forEach((function(participant){participant.jid_im!==_this311.contactService.userContact.jid?participant.role="member":participant.jid_im===_this311.contactService.userContact.jid&&(participant.role="moderator")}))),this.isMyConference(oldConfId)&&(this.conferenceSessions[newConfId].isMyConference=!1,this.conferenceSessions[newConfId].participants&&this.conferenceSessions[newConfId].participants.length&&this.conferenceSessions[newConfId].participants.forEach((function(participant){participant.jid_im===_this311.contactService.userContact.jid&&(participant.role="member")}))),delete this.conferenceSessions[oldConfId],this.roomService.updateRoomConfEndpoint(oldConfId,newConfId),this.$rootScope.$broadcast("ON_CONFERENCE_DELEGATED_EVENT",oldConfId,newConfId),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[newConfId]),!this.isMyConference(newConfId)&&this.conferenceSessions[newConfId].haveJoined&&this.$interval((function(confId){return __awaiter(_this311,void 0,void 0,regenerator_default.a.mark((function _callee447(){var confInfos,user;return regenerator_default.a.wrap((function(_context448){for(;;)switch(_context448.prev=_context448.next){case 0:return _context448.next=2,this.getConferenceEndpointInfos(confId);case 2:(confInfos=_context448.sent)&&confInfos.data&&confInfos.data.userId&&((user=this.contactService.getContactById(confInfos.data.userId))&&this.conferenceSessions[newConfId].participants&&this.conferenceSessions[newConfId].participants.length&&this.conferenceSessions[newConfId].participants.forEach((function(participant){participant.jid_im===user.jid&&(participant.role="moderator")})),this.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",this.conferenceSessions[newConfId]));case 4:case"end":return _context448.stop()}}),_callee447,this)})))}),100,1,!0,newConfId)}},{key:"getConferenceEndpointInfos",value:function(confEndpointId){var _this312=this,format=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";return this.$q((function(resolve,reject){if(!confEndpointId)return _this312.$log.error("[WebConferenceService] getConferenceEndpointInfos -- missing endpointId "),void reject("[WebConferenceService] getConferenceEndpointInfos -- missing endpointId ");_this312.$http({method:"GET",url:_this312.confProvPortalURL+"conferences/"+confEndpointId+"?format="+format,headers:_this312.authService.getRequestHeader()}).then((function(response){_this312.$log.info("[WebConferenceService] getConferenceEndpointInfos successfully"),resolve(response.data)}),(function(response){var errorMessage="getConferenceEndpointInfos failure: "+(response.data?response.data.errorDetails:response.data);_this312.$log.error("[WebConferenceService] "+errorMessage),reject(new Error(errorMessage))}))}))}},{key:"addBundleMediaToConferenceSession",value:function(conferenceSession){var audioSession,_this313=this;if(this.$log.info("[WebConferenceService] addBundleMediaToConferenceSession"),conferenceSession)for(var property in conferenceSession.sessions)if(conferenceSession.sessions.hasOwnProperty(property)){var session=conferenceSession.sessions[property];if("audio"===session.localType||"audio+video"===session.localType){audioSession=session;break}}if(audioSession){this.addingMedia=!0;var simulcast=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_SIMULCAST),videoWidth=simulcast?1280:640,videoHeight=simulcast?720:480;this.videoService.getBrowserMedia(["audio","video"],videoWidth,videoHeight,17).then((function(stream){_this313.addingMedia=!1,_this313.videoService.stopActiveAudioVideoStreams(audioSession),audioSession.removeStream(conferenceSession.localStreams[0]),audioSession.localStreams=[],conferenceSession.localStreams[0]=stream,audioSession.localStreams.push(stream),audioSession.addStream(conferenceSession.localStreams[0],!0),audioSession.contentAdd("video",!0),conferenceSession.hasLocalVideo=!0,conferenceSession.localVideoSessionId=audioSession.sid,audioSession.localStreamId=0,_this313.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession)})).catch((function(){_this313.addingMedia=!1}))}}}]),WebConferenceService}();WebConferenceService.$inject=["$q","$rootScope","$log","$http","$interval","videoService","errorHelperService","ConferenceSession","platformService","Conference","$translate"],angular.module("rainbow").service("webConferenceService",WebConferenceService)},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var conference_stats_model_1=__webpack_require__(392),rxjs_1=__webpack_require__(10),event_model_1=__webpack_require__(24),utilities_service_1=__webpack_require__(393),contact_service_1=__webpack_require__(1),auth_service_1=__webpack_require__(2),xmpp_service_1=__webpack_require__(4),profile_service_1=__webpack_require__(6),pgiConference_service_1=__webpack_require__(58),room_service_1=__webpack_require__(33),logger_service_1=__webpack_require__(15),errorHelper_service_1=__webpack_require__(37),ConferenceService=function(){function ConferenceService($q,$rootScope,$interval,$translate,$http,webConferenceService){_classCallCheck(this,ConferenceService),this.$q=$q,this.$rootScope=$rootScope,this.$interval=$interval,this.$translate=$translate,this.$http=$http,this.webConferenceService=webConferenceService,this.MEDIATYPE={PSTNAUDIO:"pstnAudio",WEBRTC:"webrtc",WEBRTCSHARINGONLY:"webrtcSharingOnly"},this.started=!1,this.rxUpdateSubject=new rxjs_1.Subject,this.hasConferenceRights=!1,this.maxNumberOfUsersSFU=0,this.authService=auth_service_1.default,this.xmppService=xmpp_service_1.default,this.profileService=profile_service_1.default,this.contactService=contact_service_1.default,this.roomService=room_service_1.default,this.pgiConferenceService=pgiConference_service_1.default,this.utilitiesService=utilities_service_1.default,this.logger=logger_service_1.default,this.errorHelperService=errorHelper_service_1.default,this.listeners=[],this.conferenceRef=null}return _createClass(ConferenceService,[{key:"start",value:function(stats){var _this314=this;return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] === start skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((function(resolve){var startDate=performance.now();return _this314.logger.info("[ConferenceService] === STARTING ==="),_this314.hasConferenceRights=_this314.profileService.isFeatureEnabled(_this314.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED),_this314.maxNumberOfUsersSFU=_this314.profileService.getFeatureLimitMax(_this314.profileService.FeaturesEnum.WEBRTC_CONFERENCE_PARTICIPANT_COUNT),_this314.maxNumberOfUsersSFU||(_this314.maxNumberOfUsersSFU=20),_this314.confProvPortalURL=config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/",_this314.confPortalURL=config.restServerUrl+"/api/rainbow/conference/v1.0/conferences/",_this314.attachHandlers(),_this314.webConferenceService.retrieveWebConferences(_this314.MEDIATYPE.WEBRTC).then((function(){return _this314.webConferenceService.retrieveWebConferences(_this314.MEDIATYPE.WEBRTCSHARINGONLY)})).then((function(){return _this314.makeSnapshots()})).then((function(){_this314.started=!0;var startDuration=Math.round(performance.now()-startDate);stats.push({service:"conferenceService",startDuration:startDuration}),_this314.logger.info("[ConferenceService] === STARTED ("+startDuration+" ms) ==="),resolve()})).catch((function(error){_this314.logger.info("[ConferenceService] === STARTING FAILURE === "+error.message),resolve()}))}))}},{key:"stop",value:function(){var _this315=this;return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] === stop skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((function(resolve){_this315.logger.info(""),_this315.logger.info("[ConferenceService] === STOPPING ==="),_this315.listeners&&_this315.listeners.forEach((function(listener){listener()})),_this315.started=!1,_this315.logger.info("[ConferenceService] === STOPPED ==="),resolve()}))}},{key:"attachHandlers",value:function(){var _this316=this;this.logger.info("[ConferenceService] attachHandlers"),this.conferenceRef&&(this.xmppService.connection.deleteHandler(this.conferenceRef),this.conferenceRef=null),this.conferenceRef=this.xmppService.connection.addHandler((function(stanza){return _this316.onConferenceUpdate(stanza)}),"jabber:iq:conference","message",null)}},{key:"reconnectService",value:function(){!this.contactService.userContact||this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] reconnectService"),this.attachHandlers(),this.refreshConferenceSessions()):this.logger.info("[ConferenceService] === reconnectService skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled)}},{key:"subscribe",value:function(eventType,callback){return"update"===eventType?this.rxUpdateSubject.subscribe(callback):null}},{key:"getWebConferenceEndpoints",value:function(){return this.webConferenceService.conferenceEndpoints}},{key:"makeSnapshotsForList",value:function(confEndpointsList){var _this317=this;return this.$q((function(resolve){if(_this317.logger.info("[ConferenceService] makeSnapshotsForList"),confEndpointsList&&confEndpointsList.length){for(var promiseArray=[],i=0;i<confEndpointsList.length;i++)confEndpointsList[i].mediaType===_this317.MEDIATYPE.PSTNAUDIO?promiseArray.push(_this317.pgiConferenceService.makeSnapshotForConfId(confEndpointsList[i].confEndpointId)):promiseArray.push(_this317.webConferenceService.makeSnapshotForConfId(confEndpointsList[i].confEndpointId,confEndpointsList[i].mediaType));_this317.$q.all(promiseArray).finally((function(){resolve(_this317.getConferenceSessionForRoom(confEndpointsList))}))}else resolve()}))}},{key:"getConferenceSessionForRoom",value:function(roomConfEndpoints){var pstnSession=null,sfuSession=null;if(roomConfEndpoints&&roomConfEndpoints.length)for(var i=0;i<roomConfEndpoints.length;i++)roomConfEndpoints[i].mediaType===this.MEDIATYPE.PSTNAUDIO?pstnSession=this.pgiConferenceService.getConferenceSessionById(roomConfEndpoints[i].confEndpointId):sfuSession=this.webConferenceService.conferenceSessions[roomConfEndpoints[i].confEndpointId];return pstnSession||sfuSession}},{key:"getMatchingConferenceSession",value:function(roomConfEndpoints,id){var confSession=null;if(roomConfEndpoints&&roomConfEndpoints.length)for(var i=0;i<roomConfEndpoints.length;i++)roomConfEndpoints[i].confEndpointId===id&&(confSession=roomConfEndpoints[i].mediaType===this.MEDIATYPE.PSTNAUDIO?this.pgiConferenceService.getConferenceSessionById(id):this.webConferenceService.conferenceSessions[id]);return confSession}},{key:"makeSnapshots",value:function(){var _this318=this;return this.logger.info("[ConferenceService] makeSnapshots"),this.$q((function(resolve){var snapshotPromiseList=[];for(var property in _this318.webConferenceService.conferenceEndpoints)if(_this318.webConferenceService.conferenceEndpoints.hasOwnProperty(property)){var pontConf=_this318.webConferenceService.conferenceEndpoints[property];snapshotPromiseList.push(_this318.webConferenceService.makeSnapshotForConfId(pontConf.id,pontConf.mediaType))}_this318.$q.all(snapshotPromiseList).finally((function(){_this318.logger.info("[ConferenceService] makeSnapshots done"),resolve()}))}))}},{key:"onConferenceUpdate",value:function(stanza){var conferenceId=$(stanza).find("conference-id").text(),action=$(stanza).find("conference-info").length?$(stanza).find("conference-info").attr("action"):"",conferenceSession=this.webConferenceService.conferenceSessions[conferenceId];if("reject"===action){var rooms=this.roomService.findRoomsWithConfId(conferenceId);return rooms&&rooms.length&&this.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",rooms[0]),!0}if("delegate"===action){var newConfId=$(stanza).find("new-conference-id").text();return this.webConferenceService.onConferenceDelegated(conferenceId,newConfId),!0}return conferenceSession?conferenceSession.haveJoined?this.updateConferenceSession(stanza,conferenceSession):(this.updateConferenceSessionActiveState(stanza,conferenceSession),this.checkIfUserHasJoinedConferenceFromOtherDevice(stanza,conferenceId,conferenceSession)):this.checkIfUserHasJoinedConferenceFromOtherDevice(stanza,conferenceId),!0}},{key:"checkIfUserHasJoinedConferenceFromOtherDevice",value:function(stanza,conferenceId){var _this319=this,conferenceSession=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var participants=$(stanza).find("participants");conferenceSession&&(conferenceSession.joinedFromOtherDevice=!1),participants&&participants.length&&participants.find("participant").each((function(__index,participant){if($(participant).find("jid-im").text()===_this319.contactService.userContact.jid){var rooms=_this319.roomService.findRoomsWithConfId(conferenceId);rooms&&rooms.length&&_this319.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",rooms[0]),conferenceSession&&(conferenceSession.joinedFromOtherDevice=!0)}}))}catch(__error){return}}},{key:"updateConferenceSession",value:function(stanza,conferenceSession){var _this320=this;this.logger.info("[ConferenceService] updateConferenceSession");var currentTalker,stanzaElem=$(stanza),conferenceStateElem=stanzaElem.find("conference-state");if(conferenceStateElem.length){var isConferenceActive="true"===conferenceStateElem.find("active").text(),isTalkerActive="true"===conferenceStateElem.find("talker-active").text(),isRecordingStarted="true"===conferenceStateElem.find("recording-started").text(),isLock="true"===conferenceStateElem.find("lock").text(),lockedBy=conferenceStateElem.find("locked-by").text();lockedBy||(lockedBy=conferenceStateElem.find("unlocked-by").text());var reason="";!isConferenceActive&&conferenceStateElem.find("reason")&&(reason=conferenceStateElem.find("reason").text()),this.updateState(conferenceSession,isConferenceActive,isTalkerActive,isRecordingStarted,isLock,lockedBy,reason)}var talkersElem=stanzaElem.find("talkers");if(talkersElem.length){var talkers=[];talkersElem.find("participant-id").each((function(__index,talker){var talkerParticipantId=$(talker).text();talkers.push(talkerParticipantId)})),stanzaElem.find("conference-id").text(),this.updateTalkers(conferenceSession,talkers)}var participantsElem=stanzaElem.find("participants");if(0===participantsElem.length&&(participantsElem=stanzaElem.find("updated-participants")),participantsElem.length||(participantsElem=stanzaElem.find("added-participants")),participantsElem.length){var participants=[];participantsElem.find("participant").each((function(__index,participant){var participantElem=$(participant),participantId=participantElem.find("participant-id").text(),jid_im=participantElem.find("jid-im").text(),phoneNumber=participantElem.find("phone-number").text(),role=participantElem.find("role").text(),mute=participantElem.find("mute").text(),hold=participantElem.find("hold").text(),cnxState=participantElem.find("cnx-state").text(),delegateCapability=participantElem.find("delegate-capability").text(),talking="true"===participantElem.find("talking").text();participants.push({participantId:participantId,jid_im:jid_im,phoneNumber:phoneNumber,participantRole:role,mute:"on"===mute,held:"on"===hold,participantState:cnxState,delegateCapability:"true"===delegateCapability}),talking&&(currentTalker=participantId)})),participants.length>0&&(conferenceSession.conferenceStats&&(conferenceSession.conferenceStats.isUpdate=!1),this.createOrUpdateParticipants(conferenceSession,participants))}var removedParticipantsElem=stanzaElem.find("removed-participants");if(removedParticipantsElem.length){var removedParticipants=[];removedParticipantsElem.find("participant-id").each((function(__index,removedParticipant){var removedParticipantId=$(removedParticipant).text();removedParticipants.push(removedParticipantId)})),this.removeParticipants(conferenceSession,removedParticipants),conferenceSession.participants.length<=1&&(stanzaElem.find("conference-id").text(),this.updateTalkers(conferenceSession,[])),conferenceSession.conferenceStats&&(conferenceSession.conferenceStats.isUpdate=!1)}var updatedPublishers=stanzaElem.find("added-publishers");updatedPublishers.length&&(updatedPublishers.find("publisher").each((function(__index,publisher){var publisherElem=$(publisher),publisherId=publisherElem.find("publisher-id").text(),mediaType=publisherElem.find("media-type").text(),jid_im=publisherElem.find("jid-im").text(),simulcast="true"===publisherElem.find("simulcast").text();_this320.addPublisher(conferenceSession,publisherId,mediaType,jid_im,simulcast)})),this.$rootScope.$broadcast("ON_CONFERENCE_PUBLISHER_UPDATED",conferenceSession));var removedPublishers=stanzaElem.find("removed-publishers");removedPublishers.length&&(removedPublishers.find("publisher").each((function(__index,publisher){for(var publisherElem=$(publisher),publisherId=publisherElem.find("participant-id").text(),mediaType=publisherElem.find("media-type").text(),i=0;i<conferenceSession.publishers.length;i++){var pub=conferenceSession.publishers[i];if(pub.participantId===publisherId&&pub.mediaType===mediaType){conferenceSession.publishers.splice(i,1);break}}if("video"===mediaType&&_this320.webConferenceService.isAlreadySubscribedToPublisher(conferenceSession.id,publisherId)){_this320.logger.info("[ConferenceService] removed-publishers : subscribed to this publisher, so re-init the element");var element=_this320.webConferenceService.getRelatedElementToPublisher(conferenceSession.id,publisherId);element&&_this320.webConferenceService.reInitialiseVideoGalleryElementById(conferenceSession,element.id)}})),this.$rootScope.$broadcast("ON_CONFERENCE_PUBLISHER_UPDATED",conferenceSession));var publishers=stanzaElem.find("publishers");return publishers.length&&(publishers.find("publisher").each((function(__index,publisher){var publisherElem=$(publisher),publisherId=publisherElem.find("publisher-id").text(),mediaType=publisherElem.find("media-type").text(),jidIm=publisherElem.find("jid-im").text(),simulcast="true"===publisherElem.find("simulcast").text();_this320.addPublisher(conferenceSession,publisherId,mediaType,jidIm,simulcast)})),this.$rootScope.$broadcast("ON_CONFERENCE_PUBLISHER_UPDATED",conferenceSession)),currentTalker&&this.updateTalkers(conferenceSession,[currentTalker]),!0}},{key:"updateConferenceSessionActiveState",value:function(stanza,conferenceSession){var conferenceStateElem=$(stanza).find("conference-state");if(conferenceStateElem.length){this.logger.info("[ConferenceService] updateConferenceSessionActiveState");var isConferenceActive="true"===conferenceStateElem.find("active").text(),isTalkerActive="true"===conferenceStateElem.find("talker-active").text(),isRecordingStarted="true"===conferenceStateElem.find("recording-started").text(),reason="";!isConferenceActive&&conferenceStateElem.find("reason")&&(reason=conferenceStateElem.find("reason").text()),this.updateState(conferenceSession,isConferenceActive,isTalkerActive,isRecordingStarted,null,null,reason)}}},{key:"updateState",value:function(conferenceSession,isConferenceActive,isTalkerActive,isRecordingStarted){var lock=arguments.length>4&&void 0!==arguments[4]&&arguments[4],lockedBy=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",reason=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";if(isConferenceActive||this.contactService.resetBusyState(),conferenceSession.active&&!isConferenceActive){if(this.contactService.userContact.guestMode&&conferenceSession.type!==this.MEDIATYPE.WEBRTCSHARINGONLY)this.$rootScope.$broadcast("ON_OPEN_POPUP","concludeInvitation");else{var rooms=this.roomService.findRoomsWithConfId(conferenceSession.id);if(rooms&&rooms.length&&!rooms[0].owner)switch(conferenceSession.type){case this.MEDIATYPE.WEBRTCSHARINGONLY:break;case this.MEDIATYPE.PSTNAUDIO:case this.MEDIATYPE.WEBRTC:default:if(conferenceSession.isParticipantConnectedByJid(this.contactService.userContact.dbId)){var displayName=_escape(rooms[0].ownerContact.displayName),_roomName2=_escape(rooms[0].name),message=this.$translate.instant("meetingEndBy",{owner:displayName,meeting:_roomName2});this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",message)}}}conferenceSession.participants=[],conferenceSession.status="ended",reason&&"noOwnerFound"===reason&&this.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"conference",popupBody:"autoDelegationNotPossible",okLabel:"ok"})}conferenceSession.updateStateFromData(isConferenceActive,isTalkerActive,isRecordingStarted,lock),this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",conferenceSession),lockedBy&&this.$rootScope.$broadcast("ON_CONFERENCE_LOCKED_EVENT",lock,lockedBy),isConferenceActive||this.$rootScope.$broadcast("ON_CONVERSATIONS_UPDATED_EVENT")}},{key:"updateTalkers",value:function(conferenceSession,talkers){conferenceSession.updateTalkers(talkers),this.$rootScope.$broadcast("ON_CONFERENCE_TALKER_EVENT",conferenceSession)}},{key:"getServerConferenceStats",value:function(sessionId){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee449(){var url,headers,response,responseData,stats,maxPartTalkDuration,errorInfo,_this321=this;return regenerator_default.a.wrap((function(_context450){for(;;)switch(_context450.prev=_context450.next){case 0:return _context450.prev=0,url="".concat(config.restServerUrl,"/api/rainbow/conference/v1.0/conferences/").concat(sessionId,"/talkingtime"),headers=this.authService.getRequestHeader(),_context450.next=5,fetch(url,{method:"GET",headers:headers});case 5:if((response=_context450.sent).ok){_context450.next=8;break}throw response;case 8:return _context450.next=10,response.json();case 10:if(0!==(responseData=_context450.sent).data.participants.length){_context450.next=13;break}return _context450.abrupt("return",null);case 13:return stats=new conference_stats_model_1.ConferenceStats,_context450.next=16,this.utilitiesService.asyncForEach(responseData.data.participants,(function(participant){return __awaiter(_this321,void 0,void 0,regenerator_default.a.mark((function _callee448(){var statsParticipant;return regenerator_default.a.wrap((function(_context449){for(;;)switch(_context449.prev=_context449.next){case 0:if(!(participant.talkingTime>0)){_context449.next=8;break}return statsParticipant=new conference_stats_model_1.ConferenceStatsParticipant(participant.userId),_context449.next=4,this.contactService.getContactByDBId(participant.userId);case 4:statsParticipant.contact=_context449.sent,statsParticipant.talkDuration=1e3*participant.talkingTime,stats.participants.push(statsParticipant),stats.talkDuration+=statsParticipant.talkDuration;case 8:case"end":return _context449.stop()}}),_callee448,this)})))}));case 16:if(stats.participants=stats.participants.sort((function(p1,p2){return p2.talkDuration-p1.talkDuration})),!(stats.participants.length>0)){_context450.next=20;break}maxPartTalkDuration=stats.participants[0].talkDuration,stats.participants.forEach((function(participant){participant.talkDisplay=Math.trunc(100*participant.talkDuration/maxPartTalkDuration)}));case 20:return _context450.abrupt("return",stats);case 23:return _context450.prev=23,_context450.t0=_context450.catch(0),_context450.next=27,this.errorHelperService.getErrorInfo(_context450.t0,"getServerConferenceStats");case 27:throw errorInfo=_context450.sent,this.logger.error("[ConferenceService] "+errorInfo.message),errorInfo.error;case 29:case"end":return _context450.stop()}}),_callee449,this,[[0,23]])})))}},{key:"createOrUpdateParticipants",value:function(conferenceSession,participants){var _this322=this;conferenceSession.updateParticipants(participants).then((function(newParticipant){if(conferenceSession.participants.find((function(participant){return participant.jid_im===_this322.contactService.userContact.id&&"disconnected"!==participant.state}))&&conferenceSession.type===_this322.MEDIATYPE.WEBRTC){var state=conferenceSession.hasLocalSharing?"sharing":"audio";_this322.contactService.setBusyState("dnd",state)}_this322.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",conferenceSession),"webrtc"===conferenceSession.type&&newParticipant&&_this322.$rootScope.$broadcast("ON_WEB_CONFENRECE_PARTICIPANT_JOINED_EVENT",conferenceSession,newParticipant)}))}},{key:"removeParticipants",value:function(conferenceSession,removedParticipants){var _this323=this;if(conferenceSession.removeParticipants(removedParticipants),!conferenceSession.participants.find((function(participant){return participant.jid_im===_this323.contactService.userContact.id})))switch(this.contactService.resetBusyState(),conferenceSession.type){case this.MEDIATYPE.WEBRTC:if(this.webConferenceService.removeAllJingleSessionsForConferenceSession(conferenceSession.id),conferenceSession.active){var room=this.roomService.findRoomsWithConfId(conferenceSession.id);if(room.length&&!this.webConferenceService.isMyConference(conferenceSession.id)){var name=_escape(room[0].name),message=this.$translate.instant("meetingDisconnect",{meeting:name});this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",message)}}conferenceSession.cleanupSessionData(),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",conferenceSession);break;case this.MEDIATYPE.WEBRTCSHARINGONLY:this.webConferenceService.removeAllJingleSessionsForConferenceSession(conferenceSession.id),conferenceSession.cleanupSessionData()}this.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",conferenceSession)}},{key:"addPublisher",value:function(conferenceSession,publisherId,mediaType,jid){for(var _this324=this,simulcast=arguments.length>4&&void 0!==arguments[4]&&arguments[4],toAdd=!0,i=0;i<conferenceSession.publishers.length;i++){var pub=conferenceSession.publishers[i];if(pub.participantId===publisherId&&pub.mediaType===mediaType){toAdd=!1;break}}var publisher={participantId:publisherId,mediaType:mediaType,jid_im:jid,simulcast:simulcast};if(toAdd&&conferenceSession.publishers.push(publisher),toAdd&&"video"===mediaType){var element=this.webConferenceService.getFreeVideoGalleryElement(conferenceSession.id),firstVideo=!1;this.webConferenceService.isActiveSpeakerEnabled()&&element&&"videoGallery_0"===element.id&&(firstVideo=!0),element&&!this.webConferenceService.isAlreadySubscribedToPublisher(conferenceSession.id,publisher.participantId)&&(this.logger.info("[ConferenceService] will subscribe to publisher "+conferenceSession.id+" for id "+publisherId+"and element id "+element.id+" in few moments"),element.state="busy",element.publisherId=publisher.participantId,this.$interval((function(confSession,newPublisher,elemToSubscribe,isFirstVideo){if("busy"===elemToSubscribe.state&&elemToSubscribe.publisherId===newPublisher.participantId){_this324.logger.info("[ConferenceService] subscribe to publisher "+confSession.id+" for id "+newPublisher.participantId+"and element id "+elemToSubscribe.id);var subStreamLevel=null;newPublisher.simulcast&&(isFirstVideo?(subStreamLevel="2",elemToSubscribe.publisherId=""):subStreamLevel="0"),isFirstVideo?_this324.webConferenceService.subscribeToDynamicFeed(confSession.id,newPublisher,elemToSubscribe.id,subStreamLevel,isFirstVideo).catch((function(){_this324.logger.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+elemToSubscribe.id),_this324.webConferenceService.reInitialiseVideoGalleryElementById(confSession,elemToSubscribe.id)})):_this324.webConferenceService.subscribeToPublisher(confSession.id,newPublisher,elemToSubscribe.id,subStreamLevel,isFirstVideo).catch((function(){_this324.logger.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+elemToSubscribe.id),_this324.webConferenceService.reInitialiseVideoGalleryElementById(confSession,elemToSubscribe.id)}))}}),1500,1,!0,conferenceSession,publisher,element,firstVideo))}}},{key:"stopConference",value:function(){var _this325=this,confId=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.MEDIATYPE.WEBRTC,roomId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.logger.info("[ConferenceService] stopConference( confId="+confId+", type="+type+")"),!confId||!roomId&&type!==this.MEDIATYPE.PSTNAUDIO)return this.logger.warn("[ConferenceService] stopConference missing conf ID or roomID"),this.$q.reject();var conferenceSession=this.webConferenceService.conferenceSessions[confId];return conferenceSession&&conferenceSession.isActive()?this.$q((function(resolve,reject){_this325.$http({method:"PUT",url:_this325.confPortalURL+confId+"/stop",headers:_this325.authService.getPostHeader(),data:{mediaType:type,roomId:roomId}}).then((function(){_this325.contactService.resetBusyState();var session=_this325.webConferenceService.conferenceSessions[confId];session&&(_this325.updateState(session,!1,!1,!1),session.cleanupSessionData(),_this325.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",session)),_this325.logger.info("[ConferenceService] stopConference( confId="+confId+") successfully"),resolve()}),(function(response){var msg=response.data?response.data.errorDetails:response.data,errorMessage="stopConference( confId="+confId+") failure: "+msg;if(_this325.logger.error("[ConferenceService] "+errorMessage),404e3!==response.data.errorDetailsCode)_this325.$rootScope.$broadcast("ON_OPEN_GLOBAL_POPUP",{popupTitle:"warning",popupBody:"stopMeetingFailure",okLabel:"ok"});else{var session=_this325.webConferenceService.conferenceSessions[confId];session&&(session.active=!1,session.participants=[],_this325.removeConferenceSession(session),_this325.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",session))}reject(new Error(errorMessage))}))})):(this.logger.warn("[ConferenceService] stopConference - no active conference session to stop"),this.$q.reject())}},{key:"removeConferenceSession",value:function(){var conferenceSession=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;conferenceSession&&(conferenceSession.type===this.MEDIATYPE.WEBRTC||conferenceSession.type===this.MEDIATYPE.WEBRTCSHARINGONLY?(this.webConferenceService.leaveWebConference(conferenceSession.id),this.webConferenceService.removeConferenceSession(conferenceSession.id)):this.pgiConferenceService.removeConferenceSession(conferenceSession.id))}},{key:"disconnectsParticipant",value:function(confId,participantId){var _this326=this,mediaType=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.MEDIATYPE.PSTNAUDIO;return confId&&participantId?this.$q((function(resolve,reject){_this326.logger.info("[ConferenceService] disconnectsParticipant( confId="+confId+"participantId="+participantId+")"),_this326.$http({method:"DELETE",url:_this326.confPortalURL+confId+"/participants/"+participantId+"?mediaType="+mediaType,headers:_this326.authService.getRequestHeader()}).then((function(){_this326.logger.info("[ConferenceService] disconnectsParticipant( confId="+confId+"participantId="+participantId+") successfully"),resolve()}),(function(response){var msg=response.data?response.data.errorDetails:response.data,errorMessage="disconnectsParticipant( confId="+confId+"participantId="+participantId+") failure: "+msg;_this326.logger.error("[ConferenceService] "+errorMessage),reject(new Error(errorMessage))}))})):(this.logger.warn("[ConferenceService] disconnectsParticipant missing conf ID or participantId"),this.$q.reject())}},{key:"updateConference",value:function(confEndpointId,confData){var mediaType=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.MEDIATYPE.PSTNAUDIO;return mediaType===this.MEDIATYPE.PSTNAUDIO?this.pgiConferenceService.updateConference(confEndpointId,confData):this.webConferenceService.updateConference(confEndpointId,confData)}},{key:"updateConferenceState",value:function(confId,option){var _this327=this,mediaType=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.MEDIATYPE.PSTNAUDIO;return this.logger.info("[ConferenceService] updateConferenceState( confId="+confId+", option="+option+" mediaType="+mediaType+")"),confId&&option?this.$q((function(resolve,reject){var conferenceSession;if(!(conferenceSession=mediaType===_this327.MEDIATYPE.PSTNAUDIO?_this327.pgiConferenceService.getConferenceSessionById(confId):_this327.webConferenceService.conferenceSessions[confId]))return _this327.logger.error("[ConferenceService] updateConferenceState - no corresponding conference session to update"),void reject();_this327.$http({method:"PUT",url:_this327.confPortalURL+confId+"/update",headers:_this327.authService.getRequestHeader(),data:{option:option,mediaType:conferenceSession.type}}).then((function(response){var conferenceData=response.data.data;_this327.logger.info("[ConferenceService] updateConferenceState( confId="+confId+") successfully"),resolve(conferenceData)}),(function(response){var msg=response.data?response.data.errorDetails:response.data,errorMessage="updatsConferenceState( confId="+confId+") failure: "+msg;_this327.logger.error("[ConferenceService] "+errorMessage),reject(new Error(errorMessage))}))})):(this.logger.error("[ConferenceService] updateConferenceState - missing a parameter"),this.$q.reject())}},{key:"updateParticipantState",value:function(confId,participantId,option){var _this328=this,mediaType=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.MEDIATYPE.PSTNAUDIO,media=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,bitRate=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,subStreamLevel=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,publisherId=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return this.logger.info("[ConferenceService] updateParticipantState( confId="+confId+"participantId="+participantId+" option="+option+" mediaType="+mediaType+")"),confId&&participantId&&option?this.$q((function(resolve,reject){var conferenceSession;if(!(conferenceSession=mediaType===_this328.MEDIATYPE.PSTNAUDIO?_this328.pgiConferenceService.getConferenceSessionById(confId):_this328.webConferenceService.conferenceSessions[confId]))return _this328.logger.error("[ConferenceService] updateParticipantState - no corresponding conference session to update"),void reject();var data={option:option,mediaType:conferenceSession.type};media&&(data.media=media),bitRate&&(data.bitRate=bitRate),publisherId&&(data.publisherId=publisherId),subStreamLevel&&(data.subStreamLevel=subStreamLevel),_this328.$http({method:"PUT",url:_this328.confPortalURL+confId+"/participants/"+participantId,headers:_this328.authService.getRequestHeader(),data:data}).then((function(response){var status=response.data;_this328.logger.info("[ConferenceService] updateParticipantState( confId="+confId+"participantId="+participantId+") successfully"),resolve(status)}),(function(response){var msg=response.data?response.data.errorDetails:response.data,errorMessage="updateParticipantState( confId="+confId+"participantId="+participantId+") failure: "+msg;_this328.logger.error("[ConferenceService] "+errorMessage),reject(new Error(errorMessage))}))})):(this.logger.error("[ConferenceService] updateParticipantState - missing a parameter"),this.$q.reject())}},{key:"isUserContactInCall",value:function(){for(var property in this.webConferenceService.conferenceSessions)if(this.webConferenceService.conferenceSessions.hasOwnProperty(property)&&this.webConferenceService.conferenceSessions[property].isParticipantConnectedByJid(this.contactService.userContact.jid))return!0;return!1}},{key:"refreshConferenceSessions",value:function(){var promoseArray=[];return promoseArray.push(this.webConferenceService.refreshConferenceSessions()),this.$q.all(promoseArray)}},{key:"computeJoinStartForSFUConference",value:function(conversation){var confSession=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,result={showStartButton:!1,showJoinButton:!1,isActionDisabled:!1,startOrJoinTooltip:""},me=conversation.room.getUserByJid(this.contactService.userContact.jid);if(me&&"unsubscribed"===me.status)return this.rxUpdateSubject.next(new event_model_1.RBEvent("CONFERENCE_BUTTON_STATUS",result)),result;if(!conversation.room.isMeetingRoom()&&!this.contactService.userContact.webrtcAudioEnabled)return result.showStartButton=!1,result.showJoinButton=!1,result;var conferenceSession=confSession||this.webConferenceService.getConferenceSessionForRoom(conversation.room.confEndpoints);if(conferenceSession&&conferenceSession.status&&"ended"!==conferenceSession.status)result.showStartButton=!1,result.showJoinButton=!1;else if(conferenceSession&&conferenceSession.isActive()&&!conferenceSession.haveJoined)result.showStartButton=!1,result.showJoinButton=!0;else if(conversation.room.isUserModerator(this.contactService.userContact)){if(result.showStartButton=!0,!this.hasConferenceRights)return result.isActionDisabled=!0,result.startOrJoinTooltip="startConferenceNoRights",this.rxUpdateSubject.next(new event_model_1.RBEvent("CONFERENCE_BUTTON_STATUS",result)),result;var filteredUsers=conversation.room.users.filter((function(user){return user.contact&&user.contact.initialized&&!user.contact.isAnonymousGuest()&&!user.contact.isBadGuest()&&!user.contact.isTerminated&&("invited"===user.status||"accepted"===user.status)})),guestsUsersLength=0;return conversation.room.guestEmails&&(guestsUsersLength=conversation.room.guestEmails.length),filteredUsers.length+guestsUsersLength>this.maxNumberOfUsersSFU?(result.isActionDisabled=!0,result.startOrJoinTooltip=this.$translate.instant("disabledStartConference",{number:this.maxNumberOfUsersSFU}),this.rxUpdateSubject.next(new event_model_1.RBEvent("CONFERENCE_BUTTON_STATUS",result)),result):(result.isActionDisabled=!1,result.startOrJoinTooltip="startConference",this.rxUpdateSubject.next(new event_model_1.RBEvent("CONFERENCE_BUTTON_STATUS",result)),result)}return this.rxUpdateSubject.next(new event_model_1.RBEvent("CONFERENCE_BUTTON_STATUS",result)),result}}]),ConferenceService}();ConferenceService.$inject=["$q","$rootScope","$interval","$translate","$http","webConferenceService"],exports.ConferenceService=ConferenceService,angular.module("rainbow").service("conferenceService",ConferenceService)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ConferenceStats=function(){return function _class18(){_classCallCheck(this,_class18),this.participants=[],this.talkDuration=0}}(),exports.ConferenceStatsParticipant=function(){return function _class19(talkerId){_classCallCheck(this,_class19),this.talkerId=null,this.contact=null,this.talkDuration=0,this.activeSince=null,this.talkDisplay=0,this.talkerId=talkerId}}()},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var UtilitiesService=function(){function UtilitiesService(){_classCallCheck(this,UtilitiesService),this.rtlDirCheck=new RegExp("^[^\u0591-\u07ff\u200f\u202b\u202e\ufb1d-\ufdfd\ufe70-\ufefc]*?[\u0591-\u07ff\u200f\u202b\u202e\ufb1d-\ufdfd\ufe70-\ufefc]")}return _createClass(UtilitiesService,[{key:"emojiShortnameToImage",value:function(text){var link=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],raw=text,html="";if(link)for(var LINKY_URL_REGEXP=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,MEET_URL_FORMAT=(config.webservices.protocol+"://meet."+config.webservices.server).replace(".red",".com")+"/",MAILTO_REGEXP=/^mailto:/,match=null;match=raw.match(LINKY_URL_REGEXP);){var url=match[0];match[2]===match[3]&&(url="mailto:"+url);var nolinkText=emojione.shortnameToImage(raw.substr(0,match.index));url.match(MEET_URL_FORMAT)?html+="".concat(nolinkText,'<span class="publiclink" >').concat(match[0].replace(MAILTO_REGEXP,""),"</span>"):html+="".concat(nolinkText,'<a target="_blank" href="').concat(url,'">').concat(match[0].replace(MAILTO_REGEXP,""),"</a>"),raw=raw.substring(match.index+match[0].length)}return html+=emojione.shortnameToImage(raw)}},{key:"asyncForEach",value:function(array,callback){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee450(){var i;return regenerator_default.a.wrap((function(_context451){for(;;)switch(_context451.prev=_context451.next){case 0:i=0;case 1:if(!(i<array.length)){_context451.next=7;break}return _context451.next=4,callback(array[i],i,array);case 4:i++,_context451.next=1;break;case 7:case"end":return _context451.stop()}}),_callee450)})))}},{key:"isRTL",value:function(str){return this.rtlDirCheck.test(str.charAt(0))}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.utilitiesService||(win.rainbow.utilitiesService=new UtilitiesService),win.rainbow.utilitiesService}}]),UtilitiesService}();exports.UtilitiesService=UtilitiesService,exports.default=UtilitiesService.getInstance()},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_2__),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4),_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_3__),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6),_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_4__);angular.module("rainbow").service("calendarService",["$q","$rootScope","$log","$http","$interval","contactService","errorHelperService","conversationService",function($q,$rootScope,$log,$http,$interval,contactService,errorHelperService,conversationService){var that=this;this.intervalID=null,this.subscriptions=[],this.start=function(stats){$log.info(""),$log.info("[calendarService] === STARTING ===");var startDate=performance.now();that.eventSubject=new rxjs__WEBPACK_IMPORTED_MODULE_0__.a,that.serviceActivated=!1,that.serviceState=null,that.calendarState=null,that.autorizationLink="",that.calendaRejectIfBusyActivated=!1,$log.info("[calendarService] listen 'out of office' status for roster contacts"),$interval(that.getAutoReplyForEachContact,15e3,1),that.intervalID=$interval(that.updateAutoReplyForEachContact,9e5),that.officeCalendarPresenceEnabled=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_4___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_4___default.a.FeaturesEnum.MSO365_CALENDAR_PRESENCE),that.googleCalendarPresenceEnabled=_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_4___default.a.isFeatureEnabled(_src_services_core_profile_service__WEBPACK_IMPORTED_MODULE_4___default.a.FeaturesEnum.GOOGLE_CALENDAR_PRESENCE),that.calendarPresenceEnabled=that.officeCalendarPresenceEnabled||that.googleCalendarPresenceEnabled,$log.info("[calendarService] calendar presence status from profileService : "+that.calendarPresenceEnabled),that.disableCalendarPresencePrompt="true"===_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_1___default.a.getSetting("disableCalendarPresence"),$log.info("[calendarService] calendar presence prompt status from userSettings : "+!that.disableCalendarPresencePrompt);var startDuration=Math.round(performance.now()-startDate);return stats.push({service:"calendarService",startDuration:startDuration}),$log.info("[calendarService] === STARTED ("+startDuration+" ms) ==="),that.calendarPresenceEnabled&&!contactService.userContact.guestMode&&(that.attachHandlers(),that.xmppConnectionSubscription=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_3___default.a.subscribeToConnectionEvents((function(event){that.onConnectionStateChange(event)})),that.subscriptions.push(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_3___default.a.subscribeToContactEvents((function(event){"ON_CONTACT_PRESENCE_EVENT"===event.name&&that.onCalendarPresenceChange(event.data)}))),that.getCalendarState().then((function(){"enabled"===that.serviceState&&that.handleEnableState()})).catch((function(error){that.serviceActivated=!1,that.serviceState="failed",$log.error("[calendarService] === STARTING FAILURE === "+error.message)}))),$q.when()},this.attachHandlers=function(){$log.info("[calendarService] attachHandlers"),that.messageHandlerRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_3___default.a.deleteHandler(that.messageHandlerRef),that.messageHandlerRef=null),that.messageHandlerRef=_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_3___default.a.addHandler((function(stanza){return that.onUpdateMessageReceived(stanza),!0}),"jabber:iq:configuration","message",null)},this.stop=function(){return $log.info("[calendarService] === STOPPING ==="),that.serviceActivated=!1,that.subscriptions&&that.subscriptions.forEach((function(subscription){subscription.unsubscribe()})),that.xmppConnectionSubscription&&that.xmppConnectionSubscription.unsubscribe(),that.messageHandlerRef&&(_src_services_core_xmpp_service__WEBPACK_IMPORTED_MODULE_3___default.a.deleteHandler(that.messageHandlerRef),that.messageHandlerRef=null),that.intervalID&&$interval.cancel(that.intervalID),$log.info("[calendarService] === STOPPED ==="),$q.when()},this.onConnectionStateChange=function(event){"ON_XMPP_CONNECTED"===event.name&&($log.info("[calendarService] onConnectionStateChange state:"+event.name),that.getCalendarState().then((function(){"enabled"===that.serviceState&&that.handleEnableState(),"consent_required"===that.serviceState&&that.handleConsentRequiredState()})).catch((function(error){that.serviceActivated=!1,that.serviceState="failed",$log.error("[calendarService] === FAILURE === "+error.message)})))},this.handleEnableState=function(){var date=this.calendarState.until?new Date(this.calendarState.until):null,status=this.calendarState.busy?"dnd":"online",message=this.calendarState.busy?"busy":"";that.updateCalendarPresenceForUser(contactService.userContact.jid,status,date,message)},this.handleConsentRequiredState=_asyncToGenerator(regenerator_default.a.mark((function _callee451(){var registrationParams;return regenerator_default.a.wrap((function(_context452){for(;;)switch(_context452.prev=_context452.next){case 0:return _context452.next=2,that.getRegistrationParams(!1);case 2:registrationParams=_context452.sent,$rootScope.$broadcast("ON_OPEN_CALENDARSELECTION_POPUP",registrationParams);case 4:case"end":return _context452.stop()}}),_callee451)}))),this.onUpdateMessageReceived=function(stanza){var info=$(stanza).find("calendar");return info.length&&(that.serviceState=info.attr("status"),that.serviceActivated="enabled"===that.serviceState,that.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:that.serviceActivated}),$log.info("[calendarService] onUpdateMessageReceived with state : "+that.serviceState),"consent_required"===that.serviceState&&that.handleConsentRequiredState()),!0},this.onCalendarPresenceChange=function(attr){if(contactService.isTelJid(attr.jid)&&"calendar"===contactService.getResourceFromJid(attr.jid)){var jid_im=contactService.getImJid(attr.jid);jid_im&&($log.info("[calendarService] onCalendarPresenceChange -- status: "+attr.status+" -- until: "+attr.until+" -- message: "+attr.message+" -- auto dnd: "+attr.applyCalendarPresence),that.updateCalendarPresenceForUser(jid_im,attr.status,attr.until,attr.message,attr.applyCalendarPresence))}},this.updateAutoReplyForEachContact=function(){that.getAutoReplyInfoForContact(contactService.userContact),that.getAutoReplyForEachContact()},this.getAutoReplyForEachContact=function(){$log.info("[calendarService] getAutoReplyForEachContact"),conversationService.getConversations().forEach((function(conversation){null!==conversation.contact&&that.getAutoReplyInfoForContact(conversation.contact)}))},this.getAutoReplyInfoForContact=function(contact){return $q((function(resolve,reject){if(!contact.calendarState.status)return $log.info("[calendarService] getAutoReplyInfoForContact user has no calendar state"),void resolve();if(contact.calendarState.lastUpdate){var duration=moment.duration(contact.calendarState.lastUpdate.diff(moment()));if(Math.abs(Math.floor(duration.asMinutes()))<15)return $log.info("[calendarService] getAutoReplyInfoForContact state has been updated in the last 15min"),void resolve()}contact.calendarState.lastUpdate=moment(),$http({method:"GET",url:config.restServerUrl+"/api/rainbow/calendar/v1.0/automatic_reply?userid="+contact.dbId,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_2___default.a.getRequestHeader()}).then((function(response){that.treatOutOfOfficeState(response.data,contact),$log.info("[calendarService] getAutoReplyInfoForContact success for contact "+contact.dbId),resolve()}),(function(response){var err=errorHelperService.handleError(response);$log.error("[calendarService] "+errorHelperService.getErrorFullMessage(response,"getAutoReplyInfoForContact")),reject(err)}))}))},this.getCalendarState=function(){return $q((function(resolve,reject){$http({method:"GET",url:config.restServerUrl+"/api/rainbow/calendar/v1.0",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_2___default.a.getRequestHeader()}).then((function(response){var successMessage="[calendarService] getCalendarState success -- ",calendarInfo=response.data;"busy"===calendarInfo.status||"free"===calendarInfo.status||"out_of_office"===calendarInfo.status?(that.serviceState="enabled",that.calendarState=calendarInfo,successMessage+=that.serviceState+" "+that.calendarState.status):(that.serviceState=calendarInfo.status,that.calendarState=null,successMessage+=that.serviceState),$log.info(successMessage),resolve(response.data)}),(function(){$log.error("[calendarService] getCalendarState failure -- CalendarService portal not responding"),reject()}))}))},this.getRegistrationParams=function(fromSettings){return $q((function(resolve){$log.info("[calendarService] getRegistrationParams");var promiseArray=[];that.officeCalendarPresenceEnabled&&promiseArray.push(that.getCalendarRegistrationInfo("office365")),that.googleCalendarPresenceEnabled&&promiseArray.push(that.getCalendarRegistrationInfo("googleCalendar")),$q.all(promiseArray).finally((function(){that.autorizationGoogleLink||that.autorizationMicrosoftLink?($log.info("[calendarService] getRegistrationParams -- show registration popup or tooltip"),resolve({authentMicrosoftUrl:that.autorizationMicrosoftLink,authentGoogleUrl:that.autorizationGoogleLink,fromSettings:fromSettings})):($log.error("[calendarService] getRegistrationParams -- no calendar provider response"),resolve())}))}))},this.getCalendarRegistrationInfo=function(type){var calendarRedirect="o365",calendarType="office365";return"googleCalendar"===type&&(calendarRedirect="gcal",calendarType="google"),$q((function(resolve,reject){var lang=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_1___default.a.getAppliLanguage().code;$http({method:"POST",url:config.restServerUrl+"/api/rainbow/calendar/v1.0/register",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_2___default.a.getRequestHeader(),data:{type:calendarType,callback:window.location.origin+"/redirectO365.html?provider="+calendarRedirect+"&lang="+lang}}).then((function(response){$log.info("[calendarService] getCalendarRegistrationInfo for "+type+" -- success"),that.autorizationLink=response.data.url,"googleCalendar"===type?that.autorizationGoogleLink=that.autorizationLink:that.autorizationMicrosoftLink=that.autorizationLink,resolve(that.autorizationLink)}),(function(response){$log.error("[calendarService] getCalendarRegistrationInfo failure"),$log.error(response),reject()}))}))},this.deactivateCalendar=function(){return $log.info("[calendarService] deactivateCalendar"),$q((function(resolve,reject){$http({method:"DELETE",url:config.restServerUrl+"/api/rainbow/calendar/v1.0",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_2___default.a.getRequestHeader()}).then((function(){$log.info("[calendarService] deactivateCalendar success"),that.serviceActivated=!1,that.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:that.serviceActivated}),resolve()}),(function(response){$log.error("[calendarService] deactivateCalendar failure"),$log.error(response),reject()}))}))},this.updateCalendarPresenceForUser=function(jid,status,date,message,applyCalendarPresence){contactService.getOrCreateContact(jid).then((function(contact){contact.calendarState.status=status,contact.calendarState.message=message,contact.calendarState.applyCalendarPresence=applyCalendarPresence,contact.calendarState.applyCalendarPresence=!1;var mdate=null;"online"===status||date||(date=new Date),date&&(mdate=moment(date)),contact.calendarState.mdate=mdate,mdate?mdate.isSame(moment(),"d")?(contact.calendarState.until=mdate.format("LT"),contact.calendarState.untilDate=!1):(contact.calendarState.until=mdate.format("ll"),contact.calendarState.untilDate=!0):(date||(date=new Date),contact.calendarState.until=date,contact.calendarState.untilDate=!1),contactService.isUserContact(contact)?($log.info("[calendarService] updateCalendarPresenceForUser for my user : "+status+" until "+date+" auto dnd "+applyCalendarPresence),that.serviceActivated||"offline"===status||(that.serviceActivated=!0,that.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:that.serviceActivated})),that.getAutoReplyInfoForContact(contactService.userContact)):$log.info("[calendarService] updateCalendarPresenceForUser for user : "+jid+" with : "+status+" until "+date+" auto dnd "+applyCalendarPresence),$rootScope.$broadcast("ON_CONTACT_CALENDAR_STATUS_CHANGE",contact)})).catch((function(error){$log.error("[calendarService] updateCalendarPresenceForUser failure for user "+jid+" with error : "+error)}))},this.treatOutOfOfficeState=function(data,contact){if($log.info("[calendarService] treatOutOfOfficeState for user : "+contact.jid+" with data enabled "+data.enabled+" and date end "+data.end),data.enabled){if(contact.calendarState.autoReplyOn=!0,contact.calendarState.autoReplyInfos={},data.message_text&&(contact.calendarState.autoReplyInfos.message=data.message_text),data.end){var mdate=moment(data.end);contact.calendarState.autoReplyInfos.mdate=mdate,mdate?mdate.isSame(moment(),"d")?(contact.calendarState.autoReplyInfos.until=mdate.format("LT"),contact.calendarState.autoReplyInfos.untilDate=!1):(contact.calendarState.autoReplyInfos.until=mdate.format("ll"),contact.calendarState.autoReplyInfos.untilDate=!0):(contact.calendarState.autoReplyInfos.until=data.end,contact.calendarState.autoReplyInfos.untilDate=!0)}}else contact.calendarState.autoReplyOn=!1,contact.calendarState.autoReplyInfos={};$rootScope.$broadcast("ON_CONTACT_CALENDAR_STATUS_CHANGE",contact),that.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:that.serviceActivated})},this.calendarCancelCallback=function(){that.serviceActivated=!1,_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_1___default.a.setSetting("disableCalendarPresence",!0),contactService.setUserSettings({promptForCalendarPresence:!1}),that.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:that.serviceActivated})},this.calendarLaterCallback=function(){that.serviceActivated=!1,that.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:!1})},this.setCalendarRejectIfBusy=function(state){that.calendaRejectIfBusyActivated=!1},this.getCalendarRejectIfBusy=function(){return that.calendaRejectIfBusyActivated}}])},function(module,exports,__webpack_require__){(function(Buffer){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var ts_ebml_1=__webpack_require__(396),call_model_1=__webpack_require__(0),moment=__webpack_require__(3),rxjs_1=__webpack_require__(10),xmpp_service_1=__webpack_require__(4),fileStorage_service_1=__webpack_require__(25),CallAreaRecordContext=function(){function CallAreaRecordContext(callType,recordingFeature){_classCallCheck(this,CallAreaRecordContext),this.callType="",this.recordingFeature=!1,this.conversation=null,this.webrtcCallRef=null,this.isRecorded=!1,this.displayRecordTime=null,this.pauseRecord=null,this.recorder=null,this.updateTimer=null,this.actualRecordTime=0,this.durationTimer=null,this.callType=callType,this.recordingFeature=recordingFeature}return _createClass(CallAreaRecordContext,[{key:"getWebrtcCallRef",value:function(){return this.webrtcCallRef}},{key:"setWebrtcCallRef",value:function(webrtcCallRef){this.webrtcCallRef=webrtcCallRef}},{key:"getConversation",value:function(){return this.conversation}},{key:"setConversation",value:function(conversation){this.conversation=conversation}}],[{key:"create",value:function(callType,recordingFeature){return new CallAreaRecordContext(callType,recordingFeature)}}]),CallAreaRecordContext}();exports.CallAreaRecordContext=CallAreaRecordContext;var RecordsService=function(){function RecordsService($q,$rootScope,$log,fileServerService,centralizedService,ringingService,conversationService,$interval,$translate,$window){_classCallCheck(this,RecordsService),this.$q=$q,this.$rootScope=$rootScope,this.$log=$log,this.fileServerService=fileServerService,this.centralizedService=centralizedService,this.ringingService=ringingService,this.conversationService=conversationService,this.$interval=$interval,this.$translate=$translate,this.$window=$window,this.started=!1,this.recording=!1,this.upload=!1,this.filename="",this.recordStopOrigin="LOCAL",this.xmppService=xmpp_service_1.default,this.fileStorageService=fileStorage_service_1.default,this.durationTimer=null,this.metadataBuf=new ArrayBuffer(0),this.last_duration=0,this.clusterPtrs=[],this.recordedStartedEvent=null,this.conversationEndedEvent=null,this.tempUploadedFileDescriptor=null}return _createClass(RecordsService,[{key:"start",value:function(){var _this329=this;return this.started=!1,this.recording=!1,this.recorder=null,this.chunk=null,this.writeStream=null,this.data=new Blob([],{type:"video/webm"}),this.audioContext=null,this.recordFile=null,this.decoder=new ts_ebml_1.Decoder,this.initConversationRecordContext(),this.recordedStartedEvent&&this.recordedStartedEvent(),this.conversationEndedEvent&&this.conversationEndedEvent(),this.recordedStartedEvent=this.$rootScope.$on("ON_RECORDING_START_MSG_RECEIVED",(function(){_this329.ringingService.playRecordTone()})),this.conversationEndedEvent=this.$rootScope.$on("ON_CONVERSATION_CALL_UPDATED_EVENT",(function(evt,conversationCallEvent){_this329.conversationRecordContext&&conversationCallEvent.conversation&&_this329.conversationRecordContext.conversationId===conversationCallEvent.conversation.id&&conversationCallEvent.conversation.videoCall&&"Unknown"===conversationCallEvent.conversation.videoCall.status.value&&(_this329.setRecordStopOrigin("LOCAL"),_this329.stopRecording(),_this329.conversationService.sendRecordingMessage(conversationCallEvent.conversation,"stop"))})),this.$log.info("[RecordsService] start"),this.$q.when()}},{key:"stop",value:function(){return this.$log.info("[RecordsService stop"),this.started&&(this.started=!1),this.recordedStartedEvent&&this.recordedStartedEvent(),this.conversationEndedEvent&&this.conversationEndedEvent(),this.$q.when()}},{key:"onDataAvailable",value:function(event){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee452(){var chunkArrayBuffer,chunkBuffer,result,_this330=this;return regenerator_default.a.wrap((function(_context453){for(;;)switch(_context453.prev=_context453.next){case 0:if(this.$log.info("[RecordsService] >onDataAvailable: size = "+event.data.size),!(event.data.size>0)){_context453.next=10;break}if(this.chunk=event.data,!this.writeStream){_context453.next=9;break}return this.writeStream.on("finish",(function(){_this330.$log.info("[RecordsService] WriteStream finish event")})),_context453.next=5,this.chunk.arrayBuffer();case 5:chunkArrayBuffer=_context453.sent,chunkBuffer=Buffer.from(chunkArrayBuffer),result=this.writeStream.write(chunkBuffer),this.writeStream.end(),this.$log.info("[RecordsService] write result = "+result);case 9:this.data=new Blob([this.data,this.chunk],{type:this.chunk.type}),this.chunk=null;case 10:case"end":return _context453.stop()}}),_callee452,this)})))}},{key:"canRecord",value:function(){try{return!!MediaRecorder}catch(e){return!1}}},{key:"onStop",value:function(){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee455(){var _this331=this;return regenerator_default.a.wrap((function(_context456){for(;;)switch(_context456.prev=_context456.next){case 0:this.durationTimer=rxjs_1.interval(1e3).subscribe((function(){return __awaiter(_this331,void 0,void 0,regenerator_default.a.mark((function _callee454(){var message,_this332=this;return regenerator_default.a.wrap((function(_context455){for(;;)switch(_context455.prev=_context455.next){case 0:if(this.$log.info("[RecordsService] On stop recording"),this.durationTimer.unsubscribe(),this.durationTimer=null,this.data&&this.data.size>1e7&&(message=this.$translate.instant("recordingInProgress"),this.$rootScope.$broadcast("GLOBAL_NOTIFY_MESSAGE_EVENT",message)),!this.writeStream){_context455.next=5;break}this.durationTimer=rxjs_1.interval(3e3).subscribe((function(){return __awaiter(_this332,void 0,void 0,regenerator_default.a.mark((function _callee453(){return regenerator_default.a.wrap((function(_context454){for(;;)switch(_context454.prev=_context454.next){case 0:return this.$log.info("[RecordsService] Destroy WriteStream"),this.writeStream.destroy(),this.writeStream=null,this.durationTimer.unsubscribe(),this.durationTimer=null,_context454.next=7,this.injectMetadata(this.data);case 7:this.updatedBlob=_context454.sent,this.onStopCreateFileFromBlob(this.updatedBlob);case 9:case"end":return _context454.stop()}}),_callee453,this)})))})),_context455.next=28;break;case 5:if(!navigator.mediaDevices.getUserMedia||!this.$window.mozRTCPeerConnection){_context455.next=9;break}this.onStopCreateFileFromBlob(this.data),_context455.next=28;break;case 9:if(!navigator.mediaDevices.getUserMedia||!this.$window.webkitRTCPeerConnection){_context455.next=28;break}return this.$log.info("[RecordsService] On stop recording for Chrome with size "+this.data.size),this.recordFile={name:this.filename,extension:"mp4",size:this.data.size},_context455.prev=11,_context455.next=14,this.createBackupFile();case 14:return this.tempUploadedFileDescriptor=_context455.sent,this.$log.info("[RecordsService] backup created"),_context455.next=18,this.injectMetadata(this.data);case 18:this.updatedBlob=_context455.sent,this.onStopCreateFileFromBlob(this.updatedBlob),_context455.next=28;break;case 22:return _context455.prev=22,_context455.t0=_context455.catch(11),_context455.next=26,this.injectMetadata(this.data);case 26:this.updatedBlob=_context455.sent,this.onStopCreateFileFromBlob(this.updatedBlob);case 28:case"end":return _context455.stop()}}),_callee454,this,[[11,22]])})))}));case 1:case"end":return _context456.stop()}}),_callee455,this)})))}},{key:"onCreateFileFromBlobForSafari",value:function(blob){this.updatedBlob=blob,this.$log.info("[RecordsService] Size of updatedBlob : "+blob.size),this.filename=this.filename.replace("mp4","wav"),this.recordFile={name:this.filename,extension:"wav",size:blob.size},this.recording=!1,this.recorder=null,this.chunk=null,this.$rootScope.$broadcast("ON_OPEN_RECORDINGFILESTORAGE_POPUP",this.recordFile,this.recordStopOrigin),this.$rootScope.$broadcast("ON_WEBRTC_RECORD_SAVED",this.recordFile,blob,this.recordStopOrigin),this.recordStopOrigin="LOCAL"}},{key:"onStopCreateFileFromBlob",value:function(blob){this.$log.info("[RecordsService] Size of updatedBlob : "+blob.size),this.recordFile={name:this.filename,extension:"mp4",size:blob.size},this.centralizedService.fileSystem&&this.centralizedService.fileSystem.unlink&&this.centralizedService.fileSystem.unlink(this.fullFileName+".temp"),this.tempUploadedFileDescriptor&&(this.fileStorageService.deleteFileDescriptor(this.tempUploadedFileDescriptor.id),this.tempUploadedFileDescriptor=null),this.recording=!1,this.recorder=null,this.chunk=null,this.$rootScope.$broadcast("ON_OPEN_RECORDINGFILESTORAGE_POPUP",this.recordFile,this.recordStopOrigin),this.$rootScope.$broadcast("ON_WEBRTC_RECORD_SAVED",this.recordFile,blob,this.recordStopOrigin),this.recordStopOrigin="LOCAL"}},{key:"readAsArrayBuffer",value:function(blob){return new Promise((function(resolve,reject){var reader=new FileReader;reader.readAsArrayBuffer(blob),reader.onloadend=function(){resolve(reader.result)},reader.onerror=function(){reject()}}))}},{key:"injectMetadata",value:function(blob){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee456(){var type,buffer;return regenerator_default.a.wrap((function(_context457){for(;;)switch(_context457.prev=_context457.next){case 0:return this.$log.info("[RecordsService] injectMetadata"),type=blob.type,_context457.next=4,this.readAsArrayBuffer(blob);case 4:return buffer=_context457.sent,_context457.abrupt("return",(blob=null,this.data=null,this.injectMetadataFromArrayBuffer(buffer,type)));case 6:case"end":return _context457.stop()}}),_callee456,this)})))}},{key:"injectMetadataFromArrayBuffer",value:function(arrayBuf,type){this.$log.info("[RecordsService] injectMetadataFromArrayBuffer");var decoder=new ts_ebml_1.Decoder,reader=new ts_ebml_1.Reader;reader.logging=!1,reader.drop_default_duration=!1,decoder.decode(arrayBuf).forEach((function(elm){reader.read(elm)})),reader.stop();var refinedMetadataBuf=ts_ebml_1.tools.makeMetadataSeekable(reader.metadatas,reader.duration,reader.cues),body=arrayBuf.slice(reader.metadataSize);return new Blob([refinedMetadataBuf,body],{type:type})}},{key:"closeAudioContext",value:function(){this.audioContext&&(this.audioContext.destination&&this.audioContext.destination.disconnect(),"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null))}},{key:"cleanRecord",value:function(){!1!==this.recording?this.$log.error("[RecordsService] Unexpected record cleaning while recording not stopped"):(this.updatedBlob=null,this.recordFile=null,this.data=null)}},{key:"onError",value:function(event){this.$log.error("[RecordsService] error : "+event.message||!1),this.recording=!1,this.stopConvTimer(),this.$rootScope.$broadcast("ON_WEBRTC_RECORD_ERROR")}},{key:"createRecord",value:function(callID,callID2){var _this333=this,sourceStream=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"REMOTE",upload=arguments.length>3&&void 0!==arguments[3]&&arguments[3],filename=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",onlyAudio=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mimeType=arguments.length>6?arguments[6]:void 0,options=null,localStreams=null,remoteStreams=null,stream=null,videoStream=null,audioStream=null,tracks=[];this.recorder=null,this.upload=upload,this.filename=filename;var streamsAvailable=!1,localIndexSharing=null,remoteIndexSharing=null,remoteIndexAudioVideo=null,isSafari="safari"===adapter.default.browserDetails.browser,isFirefox="firefox"===adapter.default.browserDetails.browser;if(this.decoder=new ts_ebml_1.Decoder,this.data=new Blob([],{type:"video/webm"}),isSafari&&(mimeType="audio/wave"),mimeType&&MediaRecorder.isTypeSupported(mimeType)?options={mimeType:mimeType}:onlyAudio?MediaRecorder.isTypeSupported("audio/webm")&&(options={mimeType:"audio/webm"}):MediaRecorder.isTypeSupported("video/webm;codecs=vp8")?options={mimeType:"video/webm; codecs=vp8"}:MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?options={mimeType:"video/webm; codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm;codecs=h264")?options={mimeType:"video/webm; codecs=h264"}:MediaRecorder.isTypeSupported("video/mpeg")&&(options={mimeType:"video/mpeg"}),isFirefox&&(options={}),null===options)return this.$log.error("[RecordsService] Codecs : "+mimeType+" are not available for the navigator"),!1;this.$log.info("[RecordsService] createRecord -- mimeType used "+options.mimeType);var sess=null;if(callID){if((sess=this.xmppService.connection.jingle.sessions[callID])&&(localStreams=this.xmppService.connection.jingle.sessions[callID].localStreams,sess.remoteStreams&&sess.remoteStreams.length?remoteStreams=sess.remoteStreams:sess.remoteStreams&&sess.remoteStreams.length||!sess.remoteStreamsObject||(remoteStreams=Object.values(sess.remoteStreamsObject))),callID2){var sess2=this.xmppService.connection.jingle.sessions[callID2];localStreams=localStreams?localStreams.concat(this.xmppService.connection.jingle.sessions[callID2].localStreams):this.xmppService.connection.jingle.sessions[callID2].localStreams,sess2.remoteStream&&sess2.remoteStreams.length?remoteStreams=remoteStreams?remoteStreams.concat(sess2.remoteStreams):sess2.remoteStreams:sess2.remoteStreams&&sess2.remoteStreams.length||!sess2.remoteStreamsObject||(remoteStreams=remoteStreams?remoteStreams.concat(Object.values(sess2.remoteStreamsObject)):Object.values(sess2.remoteStreamsObject))}}else{if(!callID2)return this.$log.error("[RecordsService] no callId"),!1;sess=this.xmppService.connection.jingle.sessions[callID2],localStreams=this.xmppService.connection.jingle.sessions[callID2].localStreams,sess.remoteStream&&sess.remoteStreams.length?remoteStreams=sess.remoteStreams:sess.remoteStreams&&sess.remoteStreams.length||!sess.remoteStreamsObject||(remoteStreams=Object.values(sess.remoteStreamsObject))}return streamsAvailable=localStreams&&localStreams.length&&null!==localStreams[0]||remoteStreams&&remoteStreams.length&&null!==remoteStreams[0],null===this.recorder&&streamsAvailable?(function(){var i,tmpIndexSharing=null;for(i=0;i<remoteStreams.length;i++)remoteStreams[i]&&null!==remoteStreams[i]&&(tmpIndexSharing=i,remoteStreams[i].getAudioTracks().forEach((function(element){tracks.push(element),remoteIndexAudioVideo=i,tmpIndexSharing=null})),null!==tmpIndexSharing&&(remoteIndexSharing=tmpIndexSharing));for(tmpIndexSharing=null,i=0;i<localStreams.length;i++)localStreams[i]&&null!==localStreams[i]&&(tmpIndexSharing=i,localStreams[i].getAudioTracks().forEach((function(element){tracks.push(element),i,tmpIndexSharing=null})),null!==tmpIndexSharing&&(localIndexSharing=tmpIndexSharing));if(_this333.audioContext&&(_this333.$log.error("[RecordsService] anomaly audio Context not previously released"),_this333.closeAudioContext()),tracks.length)if(isSafari)audioStream=new MediaStream,tracks.forEach((function(track){audioStream.addTrack(track)}));else{_this333.audioContext=new AudioContext;var sources=tracks.map((function(t){return _this333.audioContext.createMediaStreamSource(new MediaStream([t]))})),dest=_this333.audioContext.createMediaStreamDestination();sources.forEach((function(source){return source.connect(dest)})),audioStream=dest.stream}onlyAudio||isSafari||(videoStream=new MediaStream,"LOCAL"===sourceStream&&null!==localIndexSharing?localStreams[localIndexSharing].getVideoTracks().forEach((function(element){videoStream.addTrack(element)})):null!==remoteIndexSharing?remoteStreams[remoteIndexSharing].getVideoTracks().forEach((function(element){videoStream.addTrack(element)})):remoteStreams[remoteIndexAudioVideo].getVideoTracks().forEach((function(element){videoStream.addTrack(element)}))),stream=audioStream&&videoStream?new MediaStream([].concat(Object(toConsumableArray.a)(audioStream.getTracks()),Object(toConsumableArray.a)(videoStream.getTracks()))):audioStream&&!videoStream?audioStream:videoStream,_this333.centralizedService.fileSystem&&_this333.centralizedService.fileSystem.createWriteStream&&_this333.centralizedService.fileSystem.unlink&&(_this333.fullFileName=_this333.centralizedService.fileSaver.getFolderPath()+"/"+filename,_this333.centralizedService.fileSystem.createWriteStream(_this333.fullFileName+".temp").then((function(writeStream){_this333.writeStream=writeStream,_this333.writeStream.on("error",(function(){_this333.$log.info("[RecordsService] WriteStream error event")})),_this333.writeStream.on("drain",(function(){_this333.$log.info("[RecordsService] WriteStream drain event")}))}))),isSafari?(_this333.recorder=new MediaRecorder(stream),_this333.recorder.addEventListener("dataavailable",function(error){this.onCreateFileFromBlobForSafari(error.data)}.bind(_this333)),_this333.recorder.onstop=_this333.onStop.bind(_this333),_this333.recorder.onerror=_this333.onError.bind(_this333)):(_this333.recorder=new MediaRecorder(stream,options),_this333.recorder.ondataavailable=_this333.onDataAvailable.bind(_this333),_this333.recorder.onstop=_this333.onStop.bind(_this333),_this333.recorder.onerror=_this333.onError.bind(_this333))}(),!0):(this.$log.error("[RecordsService] Cannot get Stream"),!1)}},{key:"createBackupFile",value:function(){var _this334=this;return this.$q((function(resolve,reject){var buffer=_this334.data,file=_this334.recordFile;return!1!==_this334.recording?(_this334.$log.error("[RecordsService] createBackupFile Unexpected uploading file when recording not stopped"),void reject("recording not stopped pb")):0===file.size?(_this334.$log.error("[RecordsService] createBackupFile error uploading empty file"),void reject("empty file pb")):void _this334.fileStorageService.createFileDescriptor(file.name,file.extension,file.size).then((function(fileDescriptor){_this334.fileServerService.uploadAFileByChunk(fileDescriptor,buffer,(function(){})).then((function(){return _this334.$log.info("[RecordsService] createBackupFile success"),resolve(fileDescriptor)})).catch((function(errorUpload){return _this334.$log.error("[RecordsService] createBackupFile Unexpected error while uploading file",errorUpload),reject("server pb")}))})).catch((function(error){_this334.$log.error("[RecordsService] createBackupFile Unexpected error while creating file descriptor!",error),reject("file descriptor pb")}))}))}},{key:"uploadFile",value:function(){var _this335=this;return this.$q((function(resolve,reject){var buffer=_this335.updatedBlob?_this335.updatedBlob:_this335.data,file=_this335.recordFile;return!1!==_this335.recording?(_this335.$log.error("[RecordsService] Unexpected uploading file when recording not stopped"),void reject("recording not stopped pb")):0===file.size?(_this335.$log.error("[RecordsService] error uploading empty file"),void reject("empty file pb")):void _this335.fileStorageService.createFileDescriptor(file.name,file.extension,file.size).then((function(fileDescriptor){_this335.fileServerService.uploadAFileByChunk(fileDescriptor,buffer,void 0,(function(){})).then((function(){_this335.$log.info("[RecordsService] uploadFile success"),_this335.cleanRecord(),resolve()})).catch((function(errorUpload){_this335.$log.error("[RecordsService] Unexpected error while uploading file",errorUpload),reject("server pb")}))})).catch((function(error){_this335.$log.error("[RecordsService] Unexpected error while creating file descriptor!",error),reject("file descriptor pb")}))}))}},{key:"setRecordStopOrigin",value:function(recordStopSource){recordStopSource&&""!==recordStopSource&&(this.recordStopOrigin=recordStopSource)}},{key:"localSaveFile",value:function(){var buffer=this.updatedBlob?this.updatedBlob:this.data,file=this.recordFile;!1===this.recording?(this.downloadFile(buffer,null,null,file.name,!0),this.cleanRecord()):this.$log.error("[RecordsService] Unexpected file local storage when recording not stopped")}},{key:"downloadFile",value:function(blob,conversationId,messageId,filename,browse){this.$log.info("[RecordsService] downloadFile -- default function"),this.centralizedService.fileSaver&&this.centralizedService.fileSaver.fileDownload(blob,conversationId,messageId,filename,browse)}},{key:"startRecording",value:function(timeslice){null!==this.recorder&&(timeslice?this.recorder.start(timeslice):this.recorder.start(),this.recording=!0,this.startConvTimer())}},{key:"stopRecording",value:function(){null!==this.recorder&&(this.recorder.stop(),this.recording=!1,this.closeAudioContext()),this.stopConvTimer(),this.initConversationRecordContext()}},{key:"pauseResumeRecording",value:function(){null!==this.recorder&&("recording"===this.recorder.state?(this.recorder.pause(),this.conversationRecordContext.pause=!0,this.stopConvTimer()):(this.recorder.resume(),this.conversationRecordContext.pause=!1,this.startConvTimer()))}},{key:"setOnDataAvailableCallback",value:function(callback){null!==this.recorder&&(this.recorder.ondataavailable=callback)}},{key:"setOnErrorCallback",value:function(callback){null!==this.recorder&&(this.recorder.onerror=callback)}},{key:"setOnPauseCallback",value:function(callback){null!==this.recorder&&(this.recorder.onpause=callback)}},{key:"setOnResumeCallback",value:function(callback){null!==this.recorder&&(this.recorder.onresume=callback)}},{key:"setOnStartCallback",value:function(callback){null!==this.recorder&&(this.recorder.onstart=callback)}},{key:"setOnStopCallback",value:function(callback){null!==this.recorder&&(this.recorder.onstop=callback)}},{key:"initConversationRecordContext",value:function(){this.conversationRecordContext={conversationId:"",recorder:!1,pause:!1,actualRecordTime:0,updateTimer:null,recordStopSource:"LOCAL"}}},{key:"getConversationRecordContext",value:function(conversationId){return conversationId===this.conversationRecordContext.conversationId?this.conversationRecordContext:null}},{key:"setConversationRecordContext",value:function(conversationId,recorder,pause,actualRecordTime,recordStopSource){conversationId&&""!==conversationId&&(this.conversationRecordContext.conversationId=conversationId,this.conversationRecordContext.recorder=recorder&&this.recording,this.conversationRecordContext.pause=pause,this.conversationRecordContext.actualRecordTime=actualRecordTime,this.conversationRecordContext.recordStopSource=recordStopSource)}},{key:"startConvTimer",value:function(){var _this336=this;this.conversationRecordContext.updateTimer=this.$interval((function(){_this336.conversationRecordContext.actualRecordTime++}),1e3)}},{key:"stopConvTimer",value:function(){null!==this.conversationRecordContext.updateTimer&&(this.$interval.cancel(this.conversationRecordContext.updateTimer),this.conversationRecordContext.updateTimer=null)}},{key:"getDurationTime",value:function(durationTime){if(!durationTime)return"";var tempTime=durationTime,tempDisplay={};return tempDisplay.hour=Math.trunc(tempTime/3600),tempTime-=3600*tempDisplay.hour,tempDisplay.minute=Math.trunc(tempTime/60),tempTime-=60*tempDisplay.minute,tempDisplay.seconde=tempTime,0===tempDisplay.hour?moment(tempDisplay.minute+":"+tempDisplay.seconde,"mm:ss").format("mm:ss"):moment(tempDisplay.hour+":"+tempDisplay.minute+":"+tempDisplay.seconde,"HH:mm:ss").format("HH:mm:ss")}},{key:"initRecordTimer",value:function(callAreaRecordContext){var _this337=this;callAreaRecordContext.updateTimer=this.$interval((function(){callAreaRecordContext.actualRecordTime++,callAreaRecordContext.displayRecordTime=_this337.getDurationTime(callAreaRecordContext.actualRecordTime)}),1e3)}},{key:"stopRecordTimer",value:function(callAreaRecordContext){null!==callAreaRecordContext.updateTimer&&(this.$interval.cancel(callAreaRecordContext.updateTimer),callAreaRecordContext.updateTimer=null)}},{key:"handleRecordPauseResume",value:function(callAreaRecordContext){var recordContext=this.getConversationRecordContext(callAreaRecordContext.conversation.id);callAreaRecordContext.recorder&&recordContext&&(callAreaRecordContext.pauseRecord=recordContext.pause,callAreaRecordContext.pauseRecord?(this.$interval.cancel(callAreaRecordContext.updateTimer),callAreaRecordContext.updateTimer=null):callAreaRecordContext.updateTimer||this.initRecordTimer(callAreaRecordContext))}},{key:"pauseOrResumeRecording",value:function(callAreaRecordContext){callAreaRecordContext.recorder&&this.pauseResumeRecording()}},{key:"startRecord",value:function(callAreaRecordContext,buttons){if(!callAreaRecordContext.recorder){callAreaRecordContext.recorder=!0;var filename,conv=callAreaRecordContext.conversation,videoCallId=null,MPCallId=null;if("PHONE_MP"===callAreaRecordContext.callType){var contactTel=callAreaRecordContext.getConversation().contact;filename="conv_"+contactTel.firstname.substr(0,1)+"_"+contactTel.lastname+"_"+moment().format("DD-MM-YYYY_H_mm_ss")+".mp4"}else filename="conv_"+conv.contact.firstname.substr(0,1)+"_"+conv.contact.lastname+"_"+moment().format("DD-MM-YYYY_H_mm_ss")+".mp4";var sourceStream=conv.videoCall.localMedia&call_model_1.Call.Media.SHARING?"LOCAL":"REMOTE";if(conv.videoCall&&conv.videoCall.id&&(videoCallId=conv.videoCall.id),callAreaRecordContext.webrtcCallRef&&callAreaRecordContext.webrtcCallRef.id&&(MPCallId=callAreaRecordContext.webrtcCallRef.id),!videoCallId&&!MPCallId)return void(callAreaRecordContext.recorder=!1);this.createRecord(videoCallId,MPCallId,sourceStream,!0,filename)?(this.startRecording(),this.setConversationRecordContext(conv.id,callAreaRecordContext.recorder,!1,0,"LOCAL"),this.manageRecordButtons(callAreaRecordContext,buttons),this.conversationService.sendRecordingMessage(conv,"start")):callAreaRecordContext.recorder=!1}}},{key:"stopRecord",value:function(callAreaRecordContext,buttons){var origin=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LOCAL";callAreaRecordContext.recorder&&(this.setRecordStopOrigin(origin),this.stopRecording(),callAreaRecordContext.recorder=!1,this.manageRecordButtons(callAreaRecordContext,buttons),callAreaRecordContext.displayRecordTime=null,callAreaRecordContext.updateTimer&&(this.stopRecordTimer(callAreaRecordContext),callAreaRecordContext.updateTimer=null),this.conversationService.sendRecordingMessage(callAreaRecordContext.conversation,"stop"))}},{key:"manageActiveRecorder",value:function(callAreaRecordContext){var _this338=this;if(!callAreaRecordContext.updateTimer){this.setOnPauseCallback((function(){_this338.handleRecordPauseResume(callAreaRecordContext)})),this.setOnResumeCallback((function(){_this338.handleRecordPauseResume(callAreaRecordContext)}));var recordContext=this.getConversationRecordContext(callAreaRecordContext.conversation.id);recordContext&&recordContext.recorder&&(callAreaRecordContext.pauseRecord=recordContext.pause,callAreaRecordContext.actualRecordTime=recordContext.actualRecordTime,callAreaRecordContext.updateTimer=null,callAreaRecordContext.pauseRecord||this.initRecordTimer(callAreaRecordContext),callAreaRecordContext.displayRecordTime=this.getDurationTime(callAreaRecordContext.actualRecordTime))}}},{key:"manageRecordButtons",value:function(callAreaRecordContext,buttons){if(callAreaRecordContext.recordingFeature&&callAreaRecordContext.conversation&&("WEBRTC"===callAreaRecordContext.callType&&callAreaRecordContext.conversation.videoCall&&(callAreaRecordContext.isRecorded=callAreaRecordContext.conversation.videoCall.isRecorded),"PHONE_MP"===callAreaRecordContext.callType)){var recordContext=this.getConversationRecordContext(callAreaRecordContext.conversation.id);recordContext&&recordContext.recorder?(callAreaRecordContext.recorder=recordContext.recorder,buttons.stopRecord=!0,buttons.startRecord=!1,this.manageActiveRecorder(callAreaRecordContext)):(buttons.stopRecord=!1,buttons.startRecord=!0)}}}]),RecordsService}();RecordsService.$inject=["$q","$rootScope","$log","fileServerService","centralizedService","ringingService","conversationService","$interval","$translate","$window"],angular.module("rainbow").service("recordsService",RecordsService)}).call(this,__webpack_require__(57).Buffer)},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var EBMLDecoder_1=__webpack_require__(397);exports.Decoder=EBMLDecoder_1.default;var EBMLEncoder_1=__webpack_require__(231);exports.Encoder=EBMLEncoder_1.default;var EBMLReader_1=__webpack_require__(402);exports.Reader=EBMLReader_1.default;var tools=__webpack_require__(48);exports.tools=tools;var version=__webpack_require__(404).version;exports.version=version},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var State,tools_1=__webpack_require__(48),int64_buffer_1=__webpack_require__(230),tools=__webpack_require__(48),byEbmlID=__webpack_require__(232).byEbmlID;!function(State){State[State.STATE_TAG=1]="STATE_TAG",State[State.STATE_SIZE=2]="STATE_SIZE",State[State.STATE_CONTENT=3]="STATE_CONTENT"}(State||(State={}));var EBMLDecoder=function(){function EBMLDecoder(){this._buffer=new tools_1.Buffer(0),this._tag_stack=[],this._state=State.STATE_TAG,this._cursor=0,this._total=0,this._schema=byEbmlID,this._result=[]}return EBMLDecoder.prototype.decode=function(chunk){this.readChunk(chunk);var diff=this._result;return this._result=[],diff},EBMLDecoder.prototype.readChunk=function(chunk){for(this._buffer=tools.concat([this._buffer,new tools_1.Buffer(chunk)]);this._cursor<this._buffer.length&&(this._state!==State.STATE_TAG||this.readTag())&&(this._state!==State.STATE_SIZE||this.readSize())&&(this._state!==State.STATE_CONTENT||this.readContent()););},EBMLDecoder.prototype.getSchemaInfo=function(tagNum){return this._schema[tagNum]||{name:"unknown",level:-1,type:"unknown",description:"unknown"}},EBMLDecoder.prototype.readTag=function(){if(this._cursor>=this._buffer.length)return!1;var tag=tools_1.readVint(this._buffer,this._cursor);if(null==tag)return!1;var tagNum=this._buffer.slice(this._cursor,this._cursor+tag.length).reduce((function(o,v,i,arr){return o+v*Math.pow(16,2*(arr.length-1-i))}),0),schema=this.getSchemaInfo(tagNum),tagObj={EBML_ID:tagNum.toString(16),schema:schema,type:schema.type,name:schema.name,level:schema.level,tagStart:this._total,tagEnd:this._total+tag.length,sizeStart:this._total+tag.length,sizeEnd:null,dataStart:null,dataEnd:null,dataSize:null,data:null};return this._tag_stack.push(tagObj),this._cursor+=tag.length,this._total+=tag.length,this._state=State.STATE_SIZE,!0},EBMLDecoder.prototype.readSize=function(){if(this._cursor>=this._buffer.length)return!1;var size=tools_1.readVint(this._buffer,this._cursor);if(null==size)return!1;var tagObj=this._tag_stack[this._tag_stack.length-1];return tagObj.sizeEnd=tagObj.sizeStart+size.length,tagObj.dataStart=tagObj.sizeEnd,tagObj.dataSize=size.value,-1===size.value?(tagObj.dataEnd=-1,"m"===tagObj.type&&(tagObj.unknownSize=!0)):tagObj.dataEnd=tagObj.sizeEnd+size.value,this._cursor+=size.length,this._total+=size.length,this._state=State.STATE_CONTENT,!0},EBMLDecoder.prototype.readContent=function(){var tagObj=this._tag_stack[this._tag_stack.length-1];if("m"===tagObj.type){if(tagObj.isEnd=!1,this._result.push(tagObj),this._state=State.STATE_TAG,0===tagObj.dataSize){var elm=Object.assign({},tagObj,{isEnd:!0});this._result.push(elm),this._tag_stack.pop()}return!0}if(this._buffer.length<this._cursor+tagObj.dataSize)return!1;var data=this._buffer.slice(this._cursor,this._cursor+tagObj.dataSize);switch(this._buffer=this._buffer.slice(this._cursor+tagObj.dataSize),tagObj.data=data,tagObj.type){case"u":tagObj.value=data.readUIntBE(0,data.length);break;case"i":tagObj.value=data.readIntBE(0,data.length);break;case"f":tagObj.value=4===tagObj.dataSize?data.readFloatBE(0):8===tagObj.dataSize?data.readDoubleBE(0):(console.warn("cannot read "+tagObj.dataSize+" octets float. failback to 0"),0);break;case"s":tagObj.value=data.toString("ascii");break;case"8":tagObj.value=data.toString("utf8");break;case"b":tagObj.value=data;break;case"d":tagObj.value=tools_1.convertEBMLDateToJSDate(new int64_buffer_1.Int64BE(data).toNumber())}if(null===tagObj.value)throw new Error("unknown tag type:"+tagObj.type);for(this._result.push(tagObj),this._total+=tagObj.dataSize,this._state=State.STATE_TAG,this._cursor=0,this._tag_stack.pop();this._tag_stack.length>0;){var topEle=this._tag_stack[this._tag_stack.length-1];if(topEle.dataEnd<0)return this._tag_stack.pop(),!0;if(this._total<topEle.dataEnd)break;if("m"!==topEle.type)throw new Error("parent element is not master element");elm=Object.assign({},topEle,{isEnd:!0}),this._result.push(elm),this._tag_stack.pop()}return!0},EBMLDecoder}();exports.default=EBMLDecoder},function(module,exports,__webpack_require__){(function(Buffer){var tools={readVint:function(buffer,start){start=start||0;for(var length=1;length<=8&&!(buffer[start]>=Math.pow(2,8-length));length++);if(length>8)throw new Error("Unrepresentable length: "+length+" "+buffer.toString("hex",start,start+length));if(start+length>buffer.length)return null;for(var value=buffer[start]&(1<<8-length)-1,i=1;i<length;i++){if(7===i&&value>=Math.pow(2,45)&&buffer[start+7]>0)return{length:length,value:-1};value*=Math.pow(2,8),value+=buffer[start+i]}return{length:length,value:value}},writeVint:function(value){if(value<0||value>Math.pow(2,53))throw new Error("Unrepresentable value: "+value);for(var length=1;length<=8&&!(value<Math.pow(2,7*length)-1);length++);for(var buffer=new Buffer(length),i=1;i<=length;i++){var b=255&value;buffer[length-i]=b,value-=b,value/=Math.pow(2,8)}return buffer[0]=buffer[0]|1<<8-length,buffer}};module.exports=tools}).call(this,__webpack_require__(57).Buffer)},function(module,exports,__webpack_require__){var BufferReader=__webpack_require__(400);module.exports=function(buffer){var block={},reader=new BufferReader(buffer);block.trackNumber=reader.nextUIntV(),block.timecode=reader.nextInt16BE();var flags=reader.nextUInt8();block.invisible=!!(8&flags),block.keyframe=!!(128&flags),block.discardable=!!(1&flags);var lacing=(6&flags)>>1;return block.frames=function(reader,lacing){if(!lacing)return[reader.nextBuffer()];var i,frameSize,frames=[],framesNum=reader.nextUInt8()+1;if(2===lacing){if(reader.length%framesNum!=0)throw new Error("Fixed-Size Lacing Error");for(frameSize=reader.length/framesNum,i=0;i<framesNum;i++)frames.push(reader.nextBuffer(frameSize));return frames}var frameSizes=[];if(1===lacing)for(i=0;i<framesNum-1;i++){var val;frameSize=0;do{frameSize+=val=reader.nextUInt8()}while(255===val);frameSizes.push(frameSize)}else if(3===lacing)for(frameSize=reader.nextUIntV(),frameSizes.push(frameSize),i=1;i<framesNum-1;i++)frameSize+=reader.nextIntV(),frameSizes.push(frameSize);for(i=0;i<framesNum-1;i++)frames.push(reader.nextBuffer(frameSizes[i]));return frames.push(reader.nextBuffer()),frames}(reader,lacing),block}},function(module,exports,__webpack_require__){var vint=__webpack_require__(401);function BufferReader(buffer){this.buffer=buffer,this.offset=0}BufferReader.prototype.nextInt16BE=function(){var value=this.buffer.readInt16BE(this.offset);return this.offset+=2,value},BufferReader.prototype.nextUInt8=function(){var value=this.buffer.readUInt8(this.offset);return this.offset+=1,value},BufferReader.prototype.nextUIntV=function(){var v=vint(this.buffer,this.offset);return this.offset+=v.length,v.value},BufferReader.prototype.nextIntV=function(){var v=vint(this.buffer,this.offset,!0);return this.offset+=v.length,v.value},BufferReader.prototype.nextBuffer=function(length){var buffer=length?this.buffer.slice(this.offset,this.offset+length):this.buffer.slice(this.offset);return this.offset+=length||this.length,buffer},Object.defineProperty(BufferReader.prototype,"length",{get:function(){return this.buffer.length-this.offset}}),module.exports=BufferReader},function(module,exports){module.exports=function(buffer,start,signed){start=start||0;for(var length=1;length<=8&&!(buffer[start]>=Math.pow(2,8-length));length++);if(length>8)throw new Error("Unrepresentable length: "+length+" "+buffer.toString("hex",start,start+length));if(start+length>buffer.length)return null;var i,value=buffer[start]&(1<<8-length)-1;for(i=1;i<length;i++){if(7===i&&value>=Math.pow(2,45)&&buffer[start+7]>0)return{length:length,value:-1};value*=Math.pow(2,8),value+=buffer[start+i]}return signed&&(value-=Math.pow(2,7*length-1)-1),{length:length,value:value}}},function(module,exports,__webpack_require__){var extendStatics,__extends=this&&this.__extends||(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var events_1=__webpack_require__(403),tools=__webpack_require__(48),EBMLReader=function(_super){function EBMLReader(){var _this=_super.call(this)||this;return _this.logGroup="",_this.hasLoggingStarted=!1,_this.metadataloaded=!1,_this.chunks=[],_this.stack=[],_this.segmentOffset=0,_this.last2SimpleBlockVideoTrackTimecode=[0,0],_this.last2SimpleBlockAudioTrackTimecode=[0,0],_this.lastClusterTimecode=0,_this.lastClusterPosition=0,_this.timecodeScale=1e6,_this.metadataSize=0,_this.metadatas=[],_this.cues=[],_this.firstVideoBlockRead=!1,_this.firstAudioBlockRead=!1,_this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null},_this.trackTypes=[],_this.trackDefaultDuration=[],_this.trackCodecDelay=[],_this.trackInfo={type:"nothing"},_this.ended=!1,_this.logging=!1,_this.use_duration_every_simpleblock=!1,_this.use_webp=!1,_this.use_segment_info=!0,_this.drop_default_duration=!0,_this}return __extends(EBMLReader,_super),EBMLReader.prototype.stop=function(){for(this.ended=!0,this.emit_segment_info();this.stack.length;)this.stack.pop(),this.logging&&console.groupEnd();this.logging&&this.hasLoggingStarted&&this.logGroup&&console.groupEnd()},EBMLReader.prototype.emit_segment_info=function(){var data=this.chunks;if(this.chunks=[],this.metadataloaded){if(!this.use_segment_info)return;var timecode=this.lastClusterTimecode,duration=this.duration,timecodeScale=this.timecodeScale;this.emit("cluster",{timecode:timecode,data:data}),this.emit("duration",{timecodeScale:timecodeScale,duration:duration})}else{this.metadataloaded=!0,this.metadatas=data;var videoTrackNum=this.trackTypes.indexOf(1),audioTrackNum=this.trackTypes.indexOf(2);if(this.trackInfo=videoTrackNum>=0&&audioTrackNum>=0?{type:"both",trackNumber:videoTrackNum}:videoTrackNum>=0?{type:"video",trackNumber:videoTrackNum}:audioTrackNum>=0?{type:"audio",trackNumber:audioTrackNum}:{type:"nothing"},!this.use_segment_info)return;this.emit("metadata",{data:data,metadataSize:this.metadataSize})}},EBMLReader.prototype.read=function(elm){var _this=this,drop=!1;if(!this.ended){if("m"===elm.type)if(elm.isEnd)this.stack.pop();else{var parent_1=this.stack[this.stack.length-1];if(null!=parent_1&&parent_1.level>=elm.level){this.stack.pop(),this.logging&&console.groupEnd(),parent_1.dataEnd=elm.dataEnd,parent_1.dataSize=elm.dataEnd-parent_1.dataStart,parent_1.unknownSize=!1;var o=Object.assign({},parent_1,{name:parent_1.name,type:parent_1.type,isEnd:!0});this.chunks.push(o)}this.stack.push(elm)}if("m"===elm.type&&"Segment"==elm.name)0!=this.segmentOffset&&console.warn("Multiple segments detected!"),this.segmentOffset=elm.dataStart,this.emit("segment_offset",this.segmentOffset);else if("b"===elm.type&&"SimpleBlock"===elm.name){var _a=tools.ebmlBlock(elm.data),timecode=_a.timecode,trackNumber=_a.trackNumber,frames_1=_a.frames;if(1===this.trackTypes[trackNumber]){if(!this.firstVideoBlockRead&&(this.firstVideoBlockRead=!0,"both"===this.trackInfo.type||"video"===this.trackInfo.type)){var CueTime=this.lastClusterTimecode+timecode;this.cues.push({CueTrack:trackNumber,CueClusterPosition:this.lastClusterPosition,CueTime:CueTime}),this.emit("cue_info",{CueTrack:trackNumber,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:trackNumber,CueClusterPosition:this.lastClusterPosition,CueTime:CueTime})}this.last2SimpleBlockVideoTrackTimecode=[this.last2SimpleBlockVideoTrackTimecode[1],timecode]}else 2===this.trackTypes[trackNumber]&&(this.firstAudioBlockRead||(this.firstAudioBlockRead=!0,"audio"!==this.trackInfo.type)||(CueTime=this.lastClusterTimecode+timecode,this.cues.push({CueTrack:trackNumber,CueClusterPosition:this.lastClusterPosition,CueTime:CueTime}),this.emit("cue_info",{CueTrack:trackNumber,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:trackNumber,CueClusterPosition:this.lastClusterPosition,CueTime:CueTime})),this.last2SimpleBlockAudioTrackTimecode=[this.last2SimpleBlockAudioTrackTimecode[1],timecode]);this.use_duration_every_simpleblock&&this.emit("duration",{timecodeScale:this.timecodeScale,duration:this.duration}),this.use_webp&&frames_1.forEach((function(frame){if("9d012a"===frame.slice(3,6).toString("hex")){var webpBuf=tools.VP8BitStreamToRiffWebPBuffer(frame),webp=new Blob([webpBuf],{type:"image/webp"}),currentTime=_this.duration;_this.emit("webp",{currentTime:currentTime,webp:webp})}}))}else"m"===elm.type&&"Cluster"===elm.name&&!1===elm.isEnd?(this.firstVideoBlockRead=!1,this.firstAudioBlockRead=!1,this.emit_segment_info(),this.emit("cluster_ptr",elm.tagStart),this.lastClusterPosition=elm.tagStart):"u"===elm.type&&"Timecode"===elm.name?this.lastClusterTimecode=elm.value:"u"===elm.type&&"TimecodeScale"===elm.name?this.timecodeScale=elm.value:"m"===elm.type&&"TrackEntry"===elm.name?elm.isEnd?(this.trackTypes[this.currentTrack.TrackNumber]=this.currentTrack.TrackType,this.trackDefaultDuration[this.currentTrack.TrackNumber]=this.currentTrack.DefaultDuration,this.trackCodecDelay[this.currentTrack.TrackNumber]=this.currentTrack.CodecDelay):this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null}:"u"===elm.type&&"TrackType"===elm.name?this.currentTrack.TrackType=elm.value:"u"===elm.type&&"TrackNumber"===elm.name?this.currentTrack.TrackNumber=elm.value:"u"===elm.type&&"CodecDelay"===elm.name?this.currentTrack.CodecDelay=elm.value:"u"===elm.type&&"DefaultDuration"===elm.name?this.drop_default_duration?(console.warn("DefaultDuration detected!, remove it"),drop=!0):this.currentTrack.DefaultDuration=elm.value:"unknown"===elm.name&&console.warn(elm);!this.metadataloaded&&elm.dataEnd>0&&(this.metadataSize=elm.dataEnd),drop||this.chunks.push(elm),this.logging&&this.put(elm)}},Object.defineProperty(EBMLReader.prototype,"duration",{get:function(){if("nothing"===this.trackInfo.type)return console.warn("no video, no audio track"),0;var defaultDuration=0,codecDelay=0,lastTimecode=0,_defaultDuration=this.trackDefaultDuration[this.trackInfo.trackNumber];if("number"==typeof _defaultDuration)defaultDuration=_defaultDuration;else if("both"===this.trackInfo.type)this.last2SimpleBlockAudioTrackTimecode[1]>this.last2SimpleBlockVideoTrackTimecode[1]?(defaultDuration=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale,"number"==typeof(delay=this.trackCodecDelay[this.trackTypes.indexOf(2)])&&(codecDelay=delay),lastTimecode=this.last2SimpleBlockAudioTrackTimecode[1]):(defaultDuration=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale,"number"==typeof(delay=this.trackCodecDelay[this.trackTypes.indexOf(1)])&&(codecDelay=delay),lastTimecode=this.last2SimpleBlockVideoTrackTimecode[1]);else if("video"===this.trackInfo.type)defaultDuration=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale,"number"==typeof(delay=this.trackCodecDelay[this.trackInfo.trackNumber])&&(codecDelay=delay),lastTimecode=this.last2SimpleBlockVideoTrackTimecode[1];else if("audio"===this.trackInfo.type){var delay;defaultDuration=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale,"number"==typeof(delay=this.trackCodecDelay[this.trackInfo.trackNumber])&&(codecDelay=delay),lastTimecode=this.last2SimpleBlockAudioTrackTimecode[1]}var duration=((this.lastClusterTimecode+lastTimecode)*this.timecodeScale+defaultDuration-codecDelay)/this.timecodeScale;return Math.floor(duration)},enumerable:!0,configurable:!0}),EBMLReader.prototype.addListener=function(event,listener){return _super.prototype.addListener.call(this,event,listener)},EBMLReader.prototype.put=function(elm){this.hasLoggingStarted||(this.hasLoggingStarted=!0,this.logging&&this.logGroup&&console.groupCollapsed(this.logGroup)),"m"===elm.type?elm.isEnd?console.groupEnd():console.group(elm.name+":"+elm.tagStart):"b"===elm.type?console.log(elm.name,elm.type):console.log(elm.name,elm.tagStart,elm.type,elm.value)},EBMLReader}(events_1.EventEmitter);exports.default=EBMLReader},function(module,exports,__webpack_require__){var ReflectOwnKeys,R="object"==typeof Reflect?Reflect:null,ReflectApply=R&&"function"==typeof R.apply?R.apply:function(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};ReflectOwnKeys=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}:function(target){return Object.getOwnPropertyNames(target)};var NumberIsNaN=Number.isNaN||function(value){return value!=value};function EventEmitter(){EventEmitter.init.call(this)}module.exports=EventEmitter,module.exports.once=function(emitter,name){return new Promise((function(resolve,reject){function eventListener(){void 0!==errorListener&&emitter.removeListener("error",errorListener),resolve([].slice.call(arguments))}var errorListener;"error"!==name&&(errorListener=function(err){emitter.removeListener(name,eventListener),reject(err)},emitter.once("error",errorListener)),emitter.once(name,eventListener)}))},EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(listener){if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener)}function _getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing,warning;if(checkListener(listener),void 0===(events=target._events)?(events=target._events=Object.create(null),target._eventsCount=0):(void 0!==events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]),void 0===existing)existing=events[type]=listener,++target._eventsCount;else if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),(m=_getMaxListeners(target))>0&&existing.length>m&&!existing.warned){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,warning=w,console&&console.warn&&console.warn(warning)}return target}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},wrapped=onceWrapper.bind(state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(void 0===events)return[];var evlistener=events[type];return void 0===evlistener?[]:"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?function(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}(evlistener):arrayClone(evlistener,evlistener.length)}function listenerCount(type){var events=this._events;if(void 0!==events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(void 0!==evlistener)return evlistener.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||NumberIsNaN(arg))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".");defaultMaxListeners=arg}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||NumberIsNaN(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function(type){for(var args=[],i=1;i<arguments.length;i++)args.push(arguments[i]);var doError="error"===type,events=this._events;if(void 0!==events)doError=doError&&void 0===events.error;else if(!doError)return!1;if(doError){var er;if(args.length>0&&(er=args[0]),er instanceof Error)throw er;var err=new Error("Unhandled error."+(er?" ("+er.message+")":""));throw err.context=er,err}var handler=events[type];if(void 0===handler)return!1;if("function"==typeof handler)ReflectApply(handler,this,args);else{var len=handler.length,listeners=arrayClone(handler,len);for(i=0;i<len;++i)ReflectApply(listeners[i],this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){return checkListener(listener),this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){return checkListener(listener),this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if(checkListener(listener),void 0===(events=this._events))return this;if(void 0===(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=Object.create(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function(list,index){for(;index+1<list.length;index++)list[index]=list[index+1];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),void 0!==events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function(type){var listeners,events,i;if(void 0===(events=this._events))return this;if(void 0===events.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==events[type]&&(0==--this._eventsCount?this._events=Object.create(null):delete events[type]),this;if(0===arguments.length){var key,keys=Object.keys(events);for(i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(void 0!==listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]}},function(module){module.exports=JSON.parse('{"name":"ts-ebml","version":"2.0.2","description":"ebml decoder and encoder","scripts":{"setup":"npm install -g http-server;","init":"npm run update; npm run mkdir; npm run build","update":"npm run reset; npm update","reset":"rm -rf node_modules","mkdir":"mkdir lib dist 2>/dev/null","clean":"rm -rf lib/* dist/* test/*.js; mkdir -p dist","build":"npm run clean   && tsc    -p .; npm run browserify","start":"http-server . -s & tsc -w -p .& watchify lib/example_seekable.js -o test/example_seekable.js","stop":"killall -- node */tsc -w -p","browserify":"browserify lib/index.js --standalone EBML -o dist/EBML.js","watchify":"watchify lib/index.js --standalone EBML -o dist/EBMl.js -v","test":"tsc; espower lib/test.js > lib/test.tmp; mv -f lib/test.tmp lib/test.js; browserify lib/test.js -o test/test.js","example":"tsc; browserify lib/example_seekable.js -o test/example_seekable.js","examples":"tsc; for file in `find lib -name \'example_*.js\' -type f -printf \'%f\\\\n\'`; do browserify lib/$file -o test/$file; done","examples_bsd":"tsc; for file in `find lib -name \'example_*.js\' -type f -print`; do browserify lib/$(basename $file) -o test/$(basename $file); done","check":"tsc -w --noEmit -p ./","lint":"tslint -c ./tslint.json --project ./tsconfig.json --type-check","doc":"typedoc --mode modules --out doc --disableOutputCheck"},"repository":{"type":"git","url":"git+https://github.com/legokichi/ts-ebml.git"},"keywords":["ebml","webm","mkv","matrosika","webp"],"author":"legokichi duckscallion","license":"MIT","bugs":{"url":"https://github.com/legokichi/ts-ebml/issues"},"homepage":"https://github.com/legokichi/ts-ebml#readme","dependencies":{"buffer":"^5.0.7","commander":"^2.11.0","ebml":"^2.2.1","ebml-block":"^1.1.0","events":"^1.1.1","int64-buffer":"^0.1.9","matroska":"^2.2.3"},"devDependencies":{"@types/commander":"^2.9.1","@types/qunit":"^2.0.31","browserify":"^13.1.0","empower":"^1.2.3","espower-cli":"^1.1.0","power-assert":"^1.4.4","power-assert-formatter":"^1.4.1","qunit-tap":"^1.5.1","qunitjs":"^2.4.0","tslint":"^3.15.1","typedoc":"^0.5.3","typescript":"^2.4.2","watchify":"^3.7.0"},"bin":"./lib/cli.js","main":"./lib/index.js","typings":"./lib/index.d.ts"}')},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0__),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_company_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(59),_src_services_core_company_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_company_service__WEBPACK_IMPORTED_MODULE_2__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3__),_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(19);angular.module("rainbow").service("adminCompanyService",["$q","$log","$http","$rootScope","errorHelperService","Site","CompanyInvitation","pushImageHelperService","CompanyRequest","Bot",function($q,$log,$http,$rootScope,errorHelperService,Site,CompanyInvitation,pushImageHelperService,CompanyRequest,Bot){var service=this;service.start=function(){return $log.info("[adminCompanyService] === STARTING ==="),service.portalURL=config.restServerUrl+"/api/rainbow/admin/v1.0/",$log.info("[adminCompanyService] === STARTED ==="),$q.when()},service.stop=function(){return $log.info("[adminCompanyService] === STOPPING ==="),$log.info("[adminCompanyService] === STOPPED ==="),$q.when()},service.getCompanies=function(organisationId,page,pageSize,searchName,format,bpId,status,isBP,bpType,offerCanBeSold,searchReference,noLogo){var defered=$q.defer(),adminContact=_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.userContact;if(!(adminContact.isSuperadmin()||adminContact.isBusinessAdmin()||adminContact.isBPAdmin()||adminContact.isOrganizationAdmin()))return service.getCompany(adminContact.company.id).then((function(company){return{companies:[company]}}));var url=service.portalURL+"companies?format="+(format||"full");return organisationId&&(url+="&organisationId="+organisationId),page&&pageSize&&(url+="&offset="+pageSize*(page-1)),pageSize&&(url+="&limit="+pageSize),searchName&&(url+="&name="+encodeURIComponent(searchName)),bpId&&(url+="&bpId="+bpId),status&&(Array.isArray(status)?status.forEach((function(value){url+="&status="+value})):url+="&status="+status),null!=isBP&&(url+="&isBP="+isBP),bpType&&(url+="&bpType="+bpType),offerCanBeSold&&(url+="&offerCanBeSold="+offerCanBeSold),searchReference&&(url+="&externalReference="+encodeURIComponent(searchReference)),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var data=response.data.data;$log.info("[adminCompanyService] getCompanies success");var companies=[];data.forEach((function(orgData){var company=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.createFromData(orgData);!angular.isUndefined(noLogo)&&noLogo||_src_services_core_company_service__WEBPACK_IMPORTED_MODULE_2___default.a.getCompanyLogo(company),companies.push(company)})),defered.resolve({companies:companies,limit:response.data.limit,offset:response.data.offset,total:response.data.total})}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanies"))})),defered.promise},service.getAllCompaniesSmall=function(organisationId,bpId,status,isBP,bpType){return service.getAllCompanies(organisationId,bpId,status,isBP,bpType,"small")},service.getAllCompanies=function(organisationId,bpId,status,isBP,bpType,format){return $q((function(resolve,reject){var result;service.getCompanies(organisationId,1,1e3,null,format,bpId,status,isBP,bpType).then((function(response){if(result=response,response.total>response.limit){var totalPages=Math.ceil(response.total/1e3),pages=Array.apply(void 0,Object(toConsumableArray.a)(Array(totalPages-1)));pages=pages.map((function(__unused,index){return index+2}));for(var chunks=[];pages.length>0;)chunks.push(pages.splice(0,5));return chunks.reduce((function(promiseChain,requests){return promiseChain.then((function(){var promisesArray=requests.map((function(page){return service.getCompanies(organisationId,page,1e3,null,format,bpId,status,isBP,bpType).then((function(next){response.companies=response.companies.concat(next.companies),response.limit+=next.limit}))}));return $q.all(promisesArray)}))}),$q.resolve())}return $q.resolve()})).then((function(){resolve(result)})).catch((function(error){reject(error)}))}))},service.getCompany=function(companyId,format){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/"+companyId+"?format="+(format||"full"),headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getCompany success");var data=response.data.data,company=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.createFromData(data);_src_services_core_company_service__WEBPACK_IMPORTED_MODULE_2___default.a.getCompanyLogo(company),_src_services_core_company_service__WEBPACK_IMPORTED_MODULE_2___default.a.getCompanyBanner(company),resolve(company)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompany"))}))}))},service.getDefaultCompany=function(){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/default",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getDefaultCompany success");var data=response.data.data,company=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.createFromData(data);resolve(company)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getDefaultCompany"))}))}))},service.searchCompanies=function(searchValue){var defered=$q.defer(),searchValueLC=searchValue.toLowerCase();return service.getCompanies().then((function(result){var filteredCompanies=result.companies.filter((function(company){return company.name.toLowerCase().indexOf(searchValueLC)>-1}));defered.resolve(filteredCompanies)})),defered.promise},service.createCompany=function(company){var companyData=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.prune(company,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.userContact),defered=$q.defer();return $http({method:"POST",url:service.portalURL+"companies",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:companyData}).then((function(response){$log.info("[adminCompanyService] createCompany success");var newcompany=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.createFromData(response.data.data);$rootScope.$broadcast("ADMIN_COMPANIES_CHANGE"),defered.resolve(newcompany)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"createCompany"))})),defered.promise},service.createCompanyEndUser=function(company){var companyData=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.prune(company,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.userContact),defered=$q.defer();return $http({method:"POST",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/companies",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:companyData}).then((function(response){$log.info("[adminCompanyService] createCompany success");var data=response.data.data,newcompany=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.createFromData(data);defered.resolve(newcompany)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"createCompanyEndUser"))})),defered.promise},service.updateCompany=function(company){var companyData=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.prune(company,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_3___default.a.userContact),defered=$q.defer();return $http({method:"PUT",url:service.portalURL+"companies/"+company.id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:companyData}).then((function(response){$log.info("[adminCompanyService] updateCompany success");var data=response.data.data,updatedCompany=_src_models_company_model__WEBPACK_IMPORTED_MODULE_4__.Company.createFromData(data);defered.resolve(updatedCompany),$rootScope.$broadcast("ON_COMPANY_CHANGE_EVENT",company.id)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"updateCompany"))})),defered.promise},service.setDefaultLicenseGroup=function(companyId,licenseGroupName){var companyData={id:companyId,defaultLicenseGroup:licenseGroupName||null};return service.updateCompany(companyData)},service.addVisibility=function(companyId,visibleByCompany){var defered=$q.defer();return $http({method:"POST",url:service.portalURL+"companies/"+companyId+"/visible-by/"+visibleByCompany,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[adminCompanyService] addVisibility success"),defered.resolve()}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"addVisibility"))})),defered.promise},service.removeVisibility=function(companyId,visibleByCompany){var defered=$q.defer();return $http({method:"DELETE",url:service.portalURL+"companies/"+companyId+"/visible-by/"+visibleByCompany,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[adminCompanyService] removeVisibility success"),defered.resolve()}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"removeVisibility"))})),defered.promise},service.getAllSiteCompany=function(companyId){var defered=$q.defer();return $http({method:"GET",url:service.portalURL+"companies/"+companyId+"/sites",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getAllSiteCompany success");var data=response.data.data,sites=[];data.forEach((function(element){var site=Site.createFromData(element);sites.push(site)})),defered.resolve(sites)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getAllSiteCompany"))})),defered.promise},service.getCompanyAdministrators=function(companyId){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/"+companyId+"/administrators",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getCompanyAdministrators success");var data=response.data.data,adminUsers=[];data.forEach((function(adminUserData){var adminUser={id:adminUserData.id};adminUsers.push(adminUser)})),resolve(adminUsers)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanyAdministrators"))}))}))},service.deleteCompany=function(companyId){var defered=$q.defer();return $http({method:"DELETE",url:service.portalURL+"companies/"+companyId,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[adminCompanyService] deleteCompany success"),defered.resolve()}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"deleteCompany"))})),defered.promise},service.pushLogo=function(companyId,logoImg,shape){return $q((function(resolve,reject){var pushServiceURL=service.portalURL+"companies/"+companyId+"/avatar";(angular.isDefined(logoImg)&&null!==logoImg?pushImageHelperService.pushImage(pushServiceURL,logoImg):$q.resolve()).then((function(){return service.getCompany(companyId)})).then((function(company){return company.avatarShape=shape,service.updateCompany(company)})).then((function(){$rootScope.$broadcast("ON_COMPANY_CHANGE_EVENT",companyId),$log.info("[adminCompanyService] pushLogo success"),resolve()})).catch((function(error){reject(error)}))}))},service.deleteLogo=function(companyId){return $q((function(resolve,reject){$http({method:"DELETE",url:service.portalURL+"companies/"+companyId+"/avatar",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$rootScope.$broadcast("ON_COMPANY_CHANGE_EVENT",companyId),service.getCompany(companyId).then((function(company){return company.avatarShape="circle",service.updateCompany(company)})).then((function(){$log.info("[adminCompanyService] deleteLogo success"),resolve()})).catch((function(error){reject(error)}))}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"deleteLogo"))}))}))},service.pushBanner=function(companyId,bannerImg,params){return $q((function(resolve,reject){var pushServiceURL=service.portalURL+"companies/"+companyId+"/banner";return pushImageHelperService.pushImage(pushServiceURL,bannerImg,params).then((function(){$rootScope.$broadcast("ON_COMPANY_CHANGE_EVENT",companyId),resolve()})).catch((function(error){reject(error)}))}))},service.deleteBanner=function(companyId){return $q((function(resolve,reject){$http({method:"DELETE",url:service.portalURL+"companies/"+companyId+"/banner",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$rootScope.$broadcast("ON_COMPANY_CHANGE_EVENT",companyId),$log.info("[adminCompanyService] deleteBanner success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"deleteBanner"))}))}))},service.getCompanySupportBot=function(companyId){return $q((function(resolve,reject){var url=service.portalURL+"bots/rainbow-support";companyId&&(url+="?companyId="+companyId),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[companyService] getCompanySupportBot success");var supportBot=Bot.create(response.data.data);resolve(supportBot)})).catch((function(response){var errorMessage="getCompanySupportBot failure "+response.data.errorDetails+" with status "+response.status;$log.error("[companyService] "+errorMessage),reject(new Error(errorMessage))}))}))},service.pushCompanyBotAvatar=function(botId,companyId,avatarImg){return $q((function(resolve,reject){var pushServiceURL=service.portalURL+"bots/"+botId+"/companies/"+companyId+"/avatar";(angular.isDefined(avatarImg)&&null!==avatarImg?pushImageHelperService.pushImage(pushServiceURL,avatarImg):$q.resolve()).then((function(){$log.info("[adminCompanyService] pushCompanyBotAvatar success"),resolve()})).catch((function(error){reject(error)}))}))},service.deleteCompanyBotAvatar=function(botId,companyId){return $q((function(resolve,reject){$http({method:"DELETE",url:service.portalURL+"bots/"+botId+"/companies/"+companyId+"/avatar",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[adminCompanyService] deleteCompanyBotAvatar success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[botService] "+errorHelperService.getErrorFullMessage(response,"deleteCompanyBotAvatar"))}))}))},service.getCompanyInvitations=function(companyId,page,pageSize){return $q((function(resolve,reject){var url=service.portalURL+"companies/"+companyId+"/join-companies/invitations?format=medium&status=pending declined&limit="+pageSize;page&&(url+="&offset="+pageSize*(page-1)),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var invitations=[];response.data.data.forEach((function(invitationData){var invitation=CompanyInvitation.createFromData(invitationData);invitations.push(invitation)})),$log.info("[adminCompanyService] getCompanyInvitations success (found "+invitations.length+" invitation(s))"),resolve({invitations:invitations,total:response.data.total})}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanyInvitations"))}))}))},service.joinCompanyInvitation=function(companyId,email,invitedUserId,customMessage,invitedToBeCompanyAdmin,invitedToBeBpAdmin){var defered=$q.defer(),data={lang:_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getAppliLanguageCodeForServer()};return customMessage&&(data.customMessage=customMessage),invitedUserId?data.invitedUserId=invitedUserId:email&&(data.email=email),invitedToBeCompanyAdmin&&(data.invitedToBeCompanyAdmin=invitedToBeCompanyAdmin),invitedToBeBpAdmin&&(data.invitedToBeBpAdmin=invitedToBeBpAdmin),$http({method:"POST",url:service.portalURL+"companies/"+companyId+"/join-companies/invitations",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:data}).then((function(){$log.info("[adminCompanyService] joinCompanyInvitation success"),defered.resolve()}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"joinCompanyInvitation"))})),defered.promise},service.cancelJoinCompanyInvitation=function(companyId,invitationId){var defered=$q.defer();return $http({method:"POST",url:service.portalURL+"companies/"+companyId+"/join-companies/invitations/"+invitationId+"/cancel",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var invitation=CompanyInvitation.createFromData(response.data.data);$log.info("[adminCompanyService] cancelJoinCompanyInvitation success"),defered.resolve(invitation)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"cancelJoinCompanyInvitation"))})),defered.promise},service.resendJoinCompanyInvitation=function(companyId,invitationId){var defered=$q.defer();return $http({method:"POST",url:service.portalURL+"companies/"+companyId+"/join-companies/invitations/"+invitationId+"/re-send",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var invitation=CompanyInvitation.createFromData(response.data.data);$log.info("[adminCompanyService] resendJoinCompanyInvitation success"),defered.resolve(invitation)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"resendJoinCompanyInvitation"))})),defered.promise},service.getCompanyJoinRequests=function(companyId){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/"+companyId+"/join-companies/requests?format=medium&status=pending",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var companyRequests=[];response.data.data.forEach((function(companyRequestData){var companyRequest=CompanyRequest.createFromData(companyRequestData);companyRequests.push(companyRequest)})),$log.info("[adminCompanyService] getCompanyJoinRequests success (found "+response.data.total+" invitation(s))"),resolve({companyRequests:companyRequests,total:response.data.total})}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanyJoinRequests"))}))}))},service.getJoinCompanyRequest=function(companyId,joinCompanyRequestId){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/"+companyId+"/join-companies/requests/"+joinCompanyRequestId+"?status=pending",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var joinCompanyRequest=CompanyRequest.createFromData(response.data.data);$log.info("[adminCompanyService] getJoinCompanyRequest success"),resolve(joinCompanyRequest)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getJoinCompanyRequest"))}))}))},service.acceptCompanyJoinRequests=function(companyId,joinCompanyRequestId){return $q((function(resolve,reject){$http({method:"POST",url:service.portalURL+"companies/"+companyId+"/join-companies/requests/"+joinCompanyRequestId+"/accept",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var joinCompanyRequest=CompanyRequest.createFromData(response.data.data);$log.info("[adminCompanyService] acceptCompanyJoinRequests success"),resolve(joinCompanyRequest)}),(function(response){var error=errorHelperService.handleError(response);$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"acceptCompanyJoinRequests")),reject(error)}))}))},service.declineCompanyJoinRequests=function(companyId,joinCompanyRequestId){return $q((function(resolve,reject){$http({method:"POST",url:service.portalURL+"companies/"+companyId+"/join-companies/requests/"+joinCompanyRequestId+"/decline",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var joinCompanyRequest=CompanyRequest.createFromData(response.data.data);$log.info("[adminCompanyService] declineCompanyJoinRequests success"),resolve(joinCompanyRequest)}),(function(response){var error=errorHelperService.handleError(response);$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"declineCompanyJoinRequests")),reject(error)}))}))},service.getOAuthConsentUrl=function(){var lang=_src_services_core_settings_service__WEBPACK_IMPORTED_MODULE_0___default.a.getAppliLanguage().code;return $q((function(resolve,reject){$http({method:"GET",url:config.restServerUrl+"/api/rainbow/office365/v1.0/consent?callback="+window.location.origin+"/redirectO365.html?provider=o365AD&lang="+lang,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){var consentUrl=response.data.url;$log.info("[adminCompanyService] getOAuthConsentUrl success: "+consentUrl),resolve(consentUrl)}),(function(response){var error=errorHelperService.handleError(response);$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getOAuthConsentUrl")),reject(error)}))}))},service.getCompanyConferenceSettings=function(companyId){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/"+companyId+"/settings/conferences",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getCompanyConferenceSettings success");var data=response.data.data;resolve(data)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanyConferenceSettings"))}))}))},service.setCompanyConferenceSettings=function(companyId,confDialOutEnabled){return $q((function(resolve,reject){var conferenceSettingData={confDialOutDisabled:!confDialOutEnabled};$http({method:"PUT",url:service.portalURL+"companies/"+companyId+"/settings/conferences",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:conferenceSettingData}).then((function(response){$log.info("[adminCompanyService] setCompanyConferenceSettings success");var data=response.data.data;resolve(data)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"setCompanyConferenceSettings"))}))}))},service.getCompanySAMLConfigurationFile=function(companyId){return $q((function(resolve,reject){_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getCompanySAMLConfiguration(companyId).then((function(data){var blob=new Blob([data],{type:"application/xml"});resolve(blob)})).catch((function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanySAMLConfigurationFile"))}))}))},service.createCompanySingleSignOnServerConfig=function(companyId,singleSignOnType,config){return $q((function(resolve,reject){config.type=singleSignOnType,$http({method:"POST",url:service.portalURL+"companies/"+companyId+"/settings/sso",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:config}).then((function(response){$log.info("[adminCompanyService] createCompanySingleSignOnServerConfig success");var updatedConfig=response.data.data;resolve(updatedConfig)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"createCompanySingleSignOnServerConfig"))}))}))},service.deleteCompanySingleSignOnServerConfig=function(companyId,singleSignOnType){return $q((function(resolve,reject){$http({method:"DELETE",url:service.portalURL+"companies/"+companyId+"/settings/sso/"+singleSignOnType,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[adminCompanyService] deleteCompanySingleSignOnServerConfig success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"deleteCompanySingleSignOnServerConfig"))}))}))},service.getCompanySingleSignOnServerConfig=function(companyId){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/"+companyId+"/settings/sso",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getCompanySingleSignOnServerConfig success");var configArray=response.data.data?response.data.data:response.data;resolve(configArray)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanySingleSignOnServerConfig"))}))}))},service.updateCompanySingleSignOnServerConfig=function(companyId,singleSignOnType,config){return $q((function(resolve,reject){$http({method:"PUT",url:service.portalURL+"companies/"+companyId+"/settings/sso/"+singleSignOnType,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:config}).then((function(response){$log.info("[adminCompanyService] updateCompanySingleSignOnConfig success");var updatedConfig=response.data.data;resolve(updatedConfig)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"updateCompanySingleSignOnConfig"))}))}))},service.getCompanySingleSignOnSAMLOptions=function(companyId){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/"+companyId+"/settings/sso/SAML/shared-options",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getCompanySingleSignOnSAMLOptions success"),resolve(response.data.data)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanySingleSignOnSAMLOptions"))}))}))},service.updateCompanySingleSignOnSAMLOptions=function(companyId,options){return $q((function(resolve,reject){$http({method:"PUT",url:service.portalURL+"companies/"+companyId+"/settings/sso/SAML/shared-options",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:options}).then((function(response){$log.info("[adminCompanyService] updateCompanySingleSignOnSAMLOptions success"),resolve(response.data.data)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"updateCompanySingleSignOnSAMLOptions"))}))}))},service.deleteCompanySingleSignOnSAMLOptions=function(companyId){return $q((function(resolve,reject){$http({method:"DELETE",url:service.portalURL+"companies/"+companyId+"/settings/sso/SAML/shared-options",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(){$log.info("[adminCompanyService] deleteCompanySingleSignOnSAMLOptions success"),resolve()}),(function(response){var error=errorHelperService.handleError(response);404===error.status?(resolve(),$log.info("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"deleteCompanySingleSignOnSAMLOptions"))):(reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"deleteCompanySingleSignOnSAMLOptions")))}))}))},service.getCompanyBpBusinessTypes=function(){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/bpbusinesstypes",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getCompanyBpBusinessTypes success");var config=response.data.data;resolve(config)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getCompanyBpBusinessTypes"))}))}))},service.getVoIPSettingsForCompany=function(companyId){return $q((function(resolve,reject){$http({method:"GET",url:service.portalURL+"companies/"+companyId+"/settings/webrtcs",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader()}).then((function(response){$log.info("[adminCompanyService] getVoIPSettingsForCompany success");var settings=response.data.data;resolve(settings)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"getVoIPSettingsForCompany"))}))}))},service.createVoIPSettingsForCompany=function(companyId,settings){return $q((function(resolve,reject){$http({method:"POST",url:service.portalURL+"companies/"+companyId+"/settings/webrtcs",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:settings}).then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"createVoIPSettingsForCompany")),reject(error)}))}))},service.updateVoIPSettingsForCompany=function(companyId,settingsId,settings){return $q((function(resolve,reject){$http({method:"PUT",url:service.portalURL+"companies/"+companyId+"/settings/webrtcs/"+settingsId,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_1___default.a.getRequestHeader(),data:settings}).then((function(){resolve()}),(function(response){var error=errorHelperService.handleError(response);$log.error("[adminCompanyService] "+errorHelperService.getErrorFullMessage(response,"createVoIPSettingsForCompany")),reject(error)}))}))}}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0__),_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(31),_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_1__),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2__),_src_models_company_model__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(19);angular.module("rainbow").service("adminUserService",["$q","$log","$http","errorHelperService","User","Site","Organisation","PhoneNumber",function($q,$log,$http,errorHelperService,User,Site,Organisation,PhoneNumber){var service=this;service.start=function(){return $log.info("[adminUserService] === STARTING ==="),service.portalURL=config.restServerUrl+"/api/rainbow/admin/v1.0/",$log.info("[adminUserService] === STARTED ==="),$q.when()},service.stop=function(){return $log.info("[adminUserService] === STOPPING ==="),$log.info("[adminUserService] === STOPPED ==="),$q.when()},service.getUsersByEmail=function(source,email){return $q((function(resolve,reject){var url=service.portalURL+"users?format=full";source&&source instanceof Organisation&&(url+="&organisationId="+source.id),source&&source instanceof _src_models_company_model__WEBPACK_IMPORTED_MODULE_3__.Company&&(url+="&companyId="+source.id),source&&source instanceof Site&&(url+="&siteId="+source.id),email&&(url+="&email="+encodeURIComponent(email)),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){var data=response.data.data;$log.info("[adminUserService] getUsersByEmail success (find "+response.data.total+" user(s))");var users=[];data.forEach((function(userData){var user=User.createFromData(userData);users.push(user)})),resolve({users:users,total:response.data.total})}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"getUsersByEmail"))}))}))},service.getUsers=function(source,page,pageSize,searchPattern,isTerminated,isAdministrator,noDefaultValues,filterByTag,isActivated,filterByProfile){return $q((function(resolve,reject){var url=service.portalURL+"users?format=full&limit="+pageSize;"string"==typeof source&&(url+="&companyId="+source),source&&source instanceof _src_models_company_model__WEBPACK_IMPORTED_MODULE_3__.Company&&(url+="&companyId="+source.id),source&&source instanceof Organisation&&(url+="&organisationId="+source.id),source&&source instanceof Site&&(url+="&siteId="+source.id),page&&(url+="&offset="+pageSize*(page-1)),searchPattern&&(url+="&displayName="+encodeURIComponent(searchPattern)+"&useEmails=true"),filterByTag&&(url+="&tags="+encodeURIComponent(filterByTag)),filterByProfile&&(url+="&selectedAppCustomisationTemplate="+encodeURIComponent(filterByProfile)),null!=isTerminated&&(url+="&isTerminated="+isTerminated),url+=isAdministrator?"&roles=admin&roles=bp_admin&roles=bp_finance&roles=superadmin&roles=business_admin":"&excludeRoles=tv",angular.isDefined(isActivated)&&(url+="&isActivated="+isActivated),$http({method:"GET",url:url+="&sortField=reverseDisplayName",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){var data=response.data.data;$log.info("[adminUserService] getUsers success (find "+response.data.total+" user(s))");var users=[];data.forEach((function(userData){var user=User.createFromData(userData,noDefaultValues);users.push(user)})),resolve({users:users,limit:response.data.limit,offset:response.data.offset,total:response.data.total})}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"getUsers"))}))}))},service.searchUsers=function(source,page,pageSize,searchPattern){return $q((function(resolve,reject){var url=config.restServerUrl+"/api/rainbow/search/v1.0/users?limit="+pageSize;source&&(url+="&companyId="+source.id),page&&(url+="&offset="+pageSize*(page-1)),searchPattern&&(url+="&displayName="+encodeURIComponent(searchPattern)),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){var data=response.data.data;$log.info("[adminUserService] searchUsers success (find "+response.data.total+" user(s))");var users=[];data.forEach((function(userData){var user=User.createFromData(userData);users.push(user)})),resolve({users:users,total:response.data.total})}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"searchUsers"))}))}))},service.getUser=function(userId){var defered=$q.defer();return $http({method:"GET",url:service.portalURL+"users/"+userId,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){$log.info("[adminUserService] getUser success");var data=response.data.data,user=User.createFromData(data);defered.resolve(user)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"getUser"))})),defered.promise},service.createUser=function(user,options){var userData=User.prune(user,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.userContact),url=service.portalURL+"users";options&&null!=options.sendInvitationEmail&&(url+="?sendInvitationEmail="+options.sendInvitationEmail);var defered=$q.defer();return $http({method:"POST",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader(),data:userData}).then((function(response){var newuser=User.createFromData(response.data.data);$log.info("[adminUserService] createUser success"),defered.resolve(newuser)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"createUser"))})),defered.promise},service.deleteUser=function(user){var defered=$q.defer();return $http({method:"DELETE",url:service.portalURL+"users/"+user.id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(){$log.info("[adminUserService] deleteUser success"),defered.resolve()}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"deleteUser"))})),defered.promise},service.updateUser=function(user){var userData=User.prune(user,_src_services_core_contact_service__WEBPACK_IMPORTED_MODULE_2___default.a.userContact),defered=$q.defer();return $http({method:"PUT",url:service.portalURL+"users/"+user.id,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader(),data:userData}).then((function(response){$log.info("[adminUserService] updateUser success");var updateduser=User.createFromData(response.data.data);defered.resolve(updateduser)}),(function(response){var error=errorHelperService.handleError(response);defered.reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"updateUser"))})),defered.promise},service.getUserAvatar=function(user){var color=_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_1___default.a.computeUserColor(user.firstName+" "+user.lastName).color;user.image=_src_services_core_userInfo_service__WEBPACK_IMPORTED_MODULE_1___default.a.getAvatarImage(user.id,user.initials,color,50,user.lastAvatarUpdateDate)},service.expandTelephonyInfo=function(user){var result={};if(user.phoneNumbers){var phoneProNumbers=[];user.phoneNumbers.forEach((function(phoneNumber){var number=phoneNumber.number,numberCan=phoneNumber.numberE164,deviceType=phoneNumber.deviceType;switch(phoneNumber.type){case"work":if("landline"===deviceType){var phoneProNumber=PhoneNumber.createFromData(phoneNumber);phoneProNumbers.push(phoneProNumber),phoneNumber.isCloudPbxDDI||phoneNumber.isOxoPbxDDI?(result.phonePro=phoneNumber.number,result.phoneProCan=phoneNumber.numberE164,result.phoneProDdiNumber=phoneProNumber):result.phoneProNumber&&result.phoneProNumber.systemId||(result.phoneProDdiNumber||(result.phonePro=number,result.phoneProCan=numberCan),result.phoneProExt=phoneNumber.shortNumber,result.phoneProIsMonitored=phoneNumber.isMonitored,result.phoneProNumber=phoneProNumber)}"mobile"===deviceType&&(result.mobilePro=number,result.mobileProCan=numberCan);break;case"home":"landline"===deviceType&&(result.phonePerso=number,result.phonePersoCan=numberCan),"mobile"===deviceType&&(result.mobilePerso=number,result.mobilePersoCan=numberCan);break;case"rainbow":result.rainbowPhoneNumber=number}})),result.alternativePhoneProNumbers=phoneProNumbers.filter((function(phoneProNumber){return!phoneProNumber.systemId&&!phoneProNumber.isFromSystem&&phoneProNumber.id!==result.phoneProNumber.id}))}return result},service.getAllUsers=function(source,noDefaultValues){return $q((function(resolve,reject){var result;service.getUsers(source,1,1e3,void 0,void 0,void 0,noDefaultValues).then((function(response){if(result=response,response.total>response.limit){var totalPages=Math.ceil(response.total/1e3),pages=Array.apply(null,Array(totalPages-1));pages=pages.map((function(__unused,index){return index+2}));for(var chunks=[];pages.length>0;)chunks.push(pages.splice(0,5));return chunks.reduce((function(promiseChain,requests){return promiseChain.then((function(){var promisesArray=requests.map((function(page){return service.getUsers(source,page,1e3,void 0,void 0,void 0,noDefaultValues).then((function(data){result.users=result.users.concat(data.users),result.limit+=data.limit}))}));return $q.all(promisesArray)}))}),$q.resolve())}})).then((function(){resolve(result)})).catch((function(error){reject(error)}))}))},service.getUserTags=function(companyId){return $q((function(resolve,reject){var url=service.portalURL+"users/tags";companyId&&(url+="?companyId="+companyId),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){var tags=response.data.data.tags||[];$log.info("[adminUserService] getUserTags success (find "+tags.length+"tags(s))"),resolve(tags)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"getUserTags"))}))}))},service.getTagsStats=function(companyId){return $q((function(resolve,reject){var url=service.portalURL+"users/tags/stats";companyId&&(url+="?companyId="+companyId),$http({method:"GET",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){var tagsStats=response.data.data.stats||[];$log.info("[adminUserService] getTagsStats success (find "+tagsStats.length+"tags(s))"),resolve(tagsStats)}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"getTagsStats"))}))}))},service.renameTag=function(tag,newTagName,companyId){return $q((function(resolve,reject){var url=service.portalURL+"users/tags?tag="+encodeURIComponent(tag);companyId&&(url+="&companyId="+companyId),$http({method:"PUT",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader(),data:{newTagName:newTagName}}).then((function(response){$log.info("[adminUserService] renameTag success => old tag: "+tag+" => new tag: "+newTagName+": found "+response.data.data.found+" occurence(s)"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"renameTag"))}))}))},service.deleteTag=function(tag,companyId){return $q((function(resolve,reject){var url=service.portalURL+"users/tags?tag="+encodeURIComponent(tag);companyId&&(url+="&companyId="+companyId),$http({method:"DELETE",url:url,headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){$log.info("[adminUserService] deleteTag success (tag "+tag+": found "+response.data.data.found+" occurence(s)"),resolve()}),(function(response){var error=errorHelperService.handleError(response);reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"deleteTag"))}))}))},service.getUserProfilesFeatures=function(userId){return $q((function(resolve,reject){$http({method:"GET",url:config.restServerUrl+"/api/rainbow/admin/v1.0/users/"+userId+"/profiles/features",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){var features={};response.data.data.forEach((function(featureData){$log.debug("[adminUserService] getUserProfilesFeatures === response ==="+JSON.stringify(featureData)),featureData.hasOwnProperty("featureUniqueRef")&&(features[featureData.featureUniqueRef]=featureData)})),resolve(features)}),(function(response){if(404===response.status)$log.debug("[adminUserService] getUserProfilesFeatures : features found for user: "+userId),resolve();else{var error=errorHelperService.handleError(response);reject(error),$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"getUserProfilesFeatures"))}}))}))},service.getUserPresenceInformation=function(userId){return $q((function(resolve,reject){$http({method:"GET",url:config.restServerUrl+"/api/rainbow/admin/v1.0/users/"+userId+"/presences",headers:_src_services_core_auth_service__WEBPACK_IMPORTED_MODULE_0___default.a.getRequestHeader()}).then((function(response){$log.debug("[adminUserService] getUserPresenceInformation for user Id "+userId+" === response === "+JSON.stringify(response.data.data));var resources={};response.data.data.jid_im.forEach((function(presence){resources[presence.resource]={},resources[presence.resource].show=presence.show?presence.show:"online",resources[presence.resource].status=presence.status?presence.status:"",resources[presence.resource].stamp=presence.date,resources[presence.resource].type="jid_im"})),response.data.data.jid_tel.forEach((function(presence){"calendar"!==presence.resource&&(resources[presence.resource]={},resources[presence.resource].show=presence.show?presence.show:"online",resources[presence.resource].stamp=presence.date,resources[presence.resource].type="phone")}));var result=service.calculatePresenceFromUserResources(resources);resolve(result)}),(function(response){var error=errorHelperService.handleError(response);$log.error("[adminUserService] "+errorHelperService.getErrorFullMessage(response,"getUserPresenceInformation")),reject(error)}))}))},service.calculatePresenceFromUserResources=function(resources){var on_the_phone=!1,manual_invisible=!1,manual_dnd=!1,manual_away=!1,in_presentation_mode=!1,in_webrtc_mode=!1,webrtc_reason="",is_online=!1,is_online_mobile=!1,auto_away=!1,presence="offline",status="";for(var key in resources)if(resources.hasOwnProperty(key)){var resource=resources[key];"phone"!==resource.type?"xa"===resource.show&&""===resource.status?manual_invisible=!0:"dnd"===resource.show&&""===resource.status?manual_dnd=!0:"xa"===resource.show&&"away"===resource.status?manual_away=!0:"dnd"===resource.show&&"presentation"===resource.status?in_presentation_mode=!0:"dnd"===resource.show&&resource.status?(in_webrtc_mode=!0,webrtc_reason=resource.status):""!==resource.show&&"online"!==resource.show||""!==resource.status&&"mode=auto"!==resource.status?"away"===resource.show&&""===resource.status&&(auto_away=!0):-1!==key.indexOf("mobile_")?is_online_mobile=!0:is_online=!0:on_the_phone="EVT_SERVICE_INITIATED"===resource.status||"EVT_ESTABLISHED"===resource.status}return on_the_phone?(presence="busy",status="phone"):manual_invisible?(presence="xa",status=""):manual_dnd?(presence="dnd",status=""):manual_away?(presence="away",status=""):in_presentation_mode?(presence="dnd",status="presentation"):in_webrtc_mode?(presence="busy",status=webrtc_reason):is_online?(presence="online",status=""):is_online_mobile?(presence="online-mobile",status=""):auto_away&&(presence="away",status=""),{presence:presence,status:status}}}])},function(module,exports){angular.module("rainbow").filter("emojione",(function(){return function(input){return input}})),angular.module("rainbow").filter("emojiUnicodeToShort",(function(){return function(input){return input}})),angular.module("rainbow").filter("emojiShortToUnicode",(function(){return function(input){return input}}))},function(module,exports){angular.module("rainbow").service("centralizedService",(function(){})),angular.module("rainbow").service("translateService",(function(){}))},function(module,exports){angular.module("rainbow").factory("TransfertPromiseQueue",["$log","$q",function($log,$q){function TransfertPromiseQueue(){var that=this;that.fileQueue=[],that.clearContext=function(){that.currentId=null,that.currentQueue=[],that.promiseCompletion=void 0,that.promiseReject=void 0,that.initialQueueSize=0,that.promisesDone=0,that.chunkErrorCounter=0,that.currentPromise=void 0},that.clearContext(),that.addPromiseArray=function(id,promiseArray,promiseCompletion,promiseReject){$log.debug("[TransfertPromiseQueue] adding promiseArray");var promiseInfos={};return promiseInfos.id=id,promiseInfos.promiseArray=promiseArray,promiseInfos.promiseCompletion=promiseCompletion,promiseInfos.promiseReject=promiseReject,0!==that.fileQueue.length||that.currentPromise?(that.fileQueue.push(promiseInfos),$log.debug("[TransfertPromiseQueue] adding PromiseArray in FileQueue: "+that.fileQueue.length)):($log.debug("[TransfertPromiseQueue] configuring file to transfert: "+promiseInfos.promiseArray.length),that.fileQueue.push(promiseInfos),that.popFileQueue()),$log.debug("[TransfertPromiseQueue] adding promise on FileQueue: "+that.fileQueue.length),$q},that.popFileQueue=function(){if(that.fileQueue.length>0){$log.debug("[TransfertPromiseQueue] go to next file");var promiseInfos=that.fileQueue.shift();that.currentId=promiseInfos.id,that.currentQueue=promiseInfos.promiseArray,that.promiseCompletion=promiseInfos.promiseCompletion,that.promiseReject=promiseInfos.promiseReject,that.initialQueueSize=that.currentQueue.length,that.promisesDone=0,that.chunkErrorCounter=0,that.currentPromise=[];for(var counter=0;counter<10&&that.currentQueue.length>0;counter++)that.currentPromise.push(that.currentQueue.shift()());that.execute()}else $log.debug("[TransfertPromiseQueue] no more file to transfert"),that.clearContext()},that.execute=function(){$log.debug("[TransfertPromiseQueue] execute"),that.currentPromise?$q.all(that.currentPromise).then((function(){if($log.debug("[TransfertPromiseQueue] promise success go to next one"),that.chunkErrorCounter=0,0===that.currentQueue.length)that.promiseCompletion&&that.promiseCompletion(),that.popFileQueue();else{that.currentPromise=[];for(var counter=0;counter<10&&that.currentQueue.length>0;counter++)that.currentPromise.push(that.currentQueue.shift()());that.execute()}})).catch((function(error){var errorMessage=error&&error.message?error.message:"Unknown error";if($log.error("[TransfertPromiseQueue] failure executing promise -- "+errorMessage),that.chunkErrorCounter++,error&&error.errorDetailsCode>=500&&that.chunkErrorCounter<=3&&that.currentPromise){var oldPromises=that.currentPromise;that.currentPromise=[],oldPromises.forEach((function(promise){that.currentPromise.push(promise())})),that.execute()}else $log.error("[TransfertPromiseQueue] 3 chunk failed - ABORT File Upload"),that.promiseReject(error),that.popFileQueue()})):($log.debug("[TransfertPromiseQueue] no promise to perform"),that.currentPromise=void 0)},that.isTransferInProgress=function(){return $log.debug("[TransfertPromiseQueue] >isTransferInProgress: "+that.fileQueue.length+"/"+that.currentQueue.length),that.fileQueue.length>0||that.currentQueue.length>0||that.currentPromise},that.cancelAllTransfers=function(){$log.debug("[TransfertPromiseQueue] cancelAllTransfers"),that.fileQueue=[],that.currentQueue=[]},that.cancelCurrentFiletransfer=function(id){if($log.debug("[TransfertPromiseQueue] cancelCurrentFiletransfer"),that.currentId===id)$log.debug("[TransfertPromiseQueue] cancelling current promise"),that.popFileQueue();else{var promiseFound=that.fileQueue.find((function(currentPromiseInfos){return currentPromiseInfos.id===id}));if(promiseFound){var promisePos=that.fileQueue.indexOf(promiseFound);$log.debug("[TransfertPromiseQueue] promise to remove at position="+promisePos),that.fileQueue.splice(promisePos,1)}}}}return TransfertPromiseQueue.create=function(){return $log.debug("[TransfertPromiseQueue] >create"),new TransfertPromiseQueue},TransfertPromiseQueue}])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),window.sdk=angular.module("sdk",["pascalprecht.translate","ngSanitize","ngFileSaver","rainbow","rainbowAdmin"],(function(){})),__webpack_exports__.default={sdk:sdk}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _sdkConfig__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(39);sdk.remoteConsole={debug:!1,log:!1,info:!1,warn:!1,error:!1},sdk.hasVerboseLog=!1,sdk.hasBeenLaunchedFromConfig=!1,sdk.key={appID:"",appSecret:"",host:"openrainbow.com"},sdk.config(["consoleLogsProvider","$provide","$httpProvider","$translateProvider",function(consoleLogsProvider,$provide,$httpProvider,$translateProvider){var utc=function(now){return now.toDateString()+" "+("0"+now.getHours()).slice(-2)+":"+("0"+now.getMinutes()).slice(-2)+":"+("0"+now.getSeconds()).slice(-2)};$provide.decorator("$log",["$delegate",function($delegate){var origDebug=$delegate.debug;$delegate.debug=function(){var args=[].slice.call(arguments);sdk.remoteConsole.debug&&console.re.debug(args[0]),_sdkConfig__WEBPACK_IMPORTED_MODULE_0__.sdkConfig.verboseLog&&origDebug.apply(null,args),consoleLogsProvider.setLogs(["["+utc(new Date)+"]"]+"debug : "+args+"\n")};var origLog=$delegate.log;$delegate.log=function(){var args=[].slice.call(arguments);sdk.remoteConsole.log&&console.re.log(args[0]),_sdkConfig__WEBPACK_IMPORTED_MODULE_0__.sdkConfig.verboseLog&&origLog.apply(null,args),consoleLogsProvider.setLogs(["["+utc(new Date)+"]"]+"log : "+args+"\n")};var origInfo=$delegate.info;$delegate.info=function(){var args=[].slice.call(arguments);sdk.remoteConsole.info&&console.re.info(args[0]),_sdkConfig__WEBPACK_IMPORTED_MODULE_0__.sdkConfig.verboseLog&&origInfo.apply(null,args),consoleLogsProvider.setLogs(["["+utc(new Date)+"]"]+"info : "+args+"\n")};var origWarn=$delegate.warn;$delegate.warn=function(){var args=[].slice.call(arguments);sdk.remoteConsole.warn&&console.re.warn(args[0]),origWarn.apply(null,args),consoleLogsProvider.setLogs(["["+utc(new Date)+"]"]+"warn : "+args+"\n")};var origError=$delegate.error;return $delegate.error=function(){var args=[].slice.call(arguments);sdk.remoteConsole.error&&console.re.error(args[0]),origError.apply(null,args),consoleLogsProvider.setLogs(["["+utc(new Date)+"]"]+"error : "+args+"\n")},$delegate.webrtc=function(){var args=[].slice.call(arguments),logs="rtcweb : "+args[0];args[0]="%c "+utc(new Date)+" | RTCWEB | "+args[0],args[args.length]="color:green",sdk.remoteConsole.log&&console.re.log(args[0]),origDebug.apply(null,args),consoleLogsProvider.setLogs(["["+utc(new Date)+"]"]+logs+"\n")},$delegate.sdk=function(){var args=[].slice.call(arguments),logs="RBW-SDK : "+args[0];args[0]="%c "+utc(new Date)+" | RBW-SDK | "+args[0],args[args.length]="color:green",sdk.remoteConsole.log&&console.re.log(args[0]),origDebug.apply(null,args),consoleLogsProvider.setLogs(["["+utc(new Date)+"]"]+logs+"\n")},$delegate}]),$httpProvider.defaults.useXDomain=!0,$translateProvider.useSanitizeValueStrategy(null)}]),sdk.run([function(){}]),sdk.provider("consoleLogs",[function(){this.logsBuffer=[],this.logsMaxLength=2e6,this.$get=function(){var logsBuffer=this.logsBuffer;return{getLogs:function(){return logsBuffer}}},this.cleanBuffer=function(){this.logsBuffer.length>this.logsMaxLength&&(this.logsBuffer=this.logsBuffer.slice(-this.logsMaxLength))},this.setLogs=function(logs){1e3===this.logsBuffer&&this.logsBuffer.shift(),this.logsBuffer.push(logs)}}])},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0});var userInfo_service_1=__webpack_require__(31),Invitation=function(){function Invitation(id,invitedUserId,invitedUserEmail,invitingUserId,invitingUserEmail,requestNotificationLanguage,invitingDate,lastNotificationDate,status,type,inviteToJoinMeeting){var invitedPhoneNumber=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null;_classCallCheck(this,Invitation),this.id=id,this.invitedUserId=invitedUserId,this.invitedUserEmail=invitedUserEmail,this.invitedPhoneNumber=invitedPhoneNumber,this.invitingUserId=invitingUserId,this.invitingUserEmail=invitingUserEmail,this.requestNotificationLanguage=requestNotificationLanguage,this.invitingDate=invitingDate,this.lastNotificationDate=lastNotificationDate,this.status=status,this.type=type,this.defaultAvatar=null,this.inviteToJoinMeeting=inviteToJoinMeeting}return _createClass(Invitation,[{key:"createDefaultAvatar",value:function(){if(!this.defaultAvatar&&this.invitedUserEmail){var color=userInfo_service_1.default.computeUserColor(this.invitedUserEmail),initials=this.invitedUserEmail.substring(0,2).toUpperCase();this.defaultAvatar=userInfo_service_1.default.createDefaultAvatarImage(initials,color)}}}],[{key:"create",value:function(id,invitedUserId,invitedUserEmail,invitingUserId,invitingUserEmail,requestNotificationLanguage,invitingDate,lastNotificationDate,status,type,inviteToJoinMeeting){return new Invitation(id,invitedUserId,invitedUserEmail,invitingUserId,invitingUserEmail,requestNotificationLanguage,invitingDate,lastNotificationDate,status,type,inviteToJoinMeeting)}},{key:"createFromData",value:function(invitationData){var invitation=new Invitation(invitationData.id,invitationData.invitedUserId,invitationData.invitedUserEmail,invitationData.invitingUserId,invitationData.invitingUserEmail,invitationData.requestNotificationLanguage,invitationData.invitingDate,invitationData.lastNotificationDate,invitationData.status,invitationData.type,invitationData.inviteToJoinMeeting,invitationData.invitedPhoneNumber);return invitation.createDefaultAvatar(),invitation}}]),Invitation}();exports.Invitation=Invitation},function(module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});var logger_service_1=__webpack_require__(15),event_service_1=__webpack_require__(32),company_model_1=__webpack_require__(19),crypto_js_1=__webpack_require__(18),auth_service_1=__webpack_require__(2),main_service_1=__webpack_require__(26),userInfo_service_1=__webpack_require__(31),profile_service_1=__webpack_require__(6),contact_service_1=__webpack_require__(1),Office365AdService=function(){function Office365AdService(){_classCallCheck(this,Office365AdService),this.isOffice365AdSearchAllowed=!1,this.isOffice365ContactSearchAllowed=!1,this.url=config.restServerUrl+"/api/rainbow/office365/v1.0/users",this.companies={},this.eventService=event_service_1.default,this.logger=logger_service_1.default,this.authService=auth_service_1.default,this.mainService=main_service_1.default,this.userInfoService=userInfo_service_1.default,this.profileService=profile_service_1.default,this.contactService=contact_service_1.default,this.isOffice365AdSearchAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_DIRECTORY_SEARCH),this.isOffice365ContactSearchAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_CONTACT_SEARCH)}return _createClass(Office365AdService,[{key:"search",value:function(searchPattern){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee457(){var headers,responseData,office365ContactsData,_this339=this;return regenerator_default.a.wrap((function(_context458){for(;;)switch(_context458.prev=_context458.next){case 0:if(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_CONTACT_SEARCH)){_context458.next=2;break}return _context458.abrupt("return",[]);case 2:if(this.logger.info("search office365 Contact from Ad with pattern "+searchPattern),_context458.prev=3,headers=this.authService.getPostHeader(),!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.SEARCH_BY_TAGS)){_context458.next=11;break}return _context458.next=8,fetch(this.url+"/search",{method:"POST",mode:"cors",headers:headers,body:JSON.stringify({search:searchPattern,includeContacts:this.isOffice365ContactSearchAllowed})});case 8:_context458.t0=_context458.sent,_context458.next=14;break;case 11:return _context458.next=13,fetch(this.url+"/search",{method:"POST",mode:"cors",headers:headers,body:JSON.stringify({name:searchPattern,includeContacts:this.isOffice365ContactSearchAllowed})});case 13:_context458.t0=_context458.sent;case 14:return responseData=_context458.t0,_context458.next=17,responseData.json();case 17:return office365ContactsData=_context458.sent.data,_context458.abrupt("return",office365ContactsData.map((function(office365ContactData){var contact=_this339.contactService.createBasicContact(office365ContactData.oid,null,!1);return _this339.updateContactWithData(contact,office365ContactData),contact})));case 21:return _context458.prev=21,_context458.t1=_context458.catch(3),_context458.abrupt("return",(this.logger.error("search office365 Contact from Ad with pattern ".concat(searchPattern," --- FAILURE --- ").concat(_context458.t1.message)),[]));case 24:case"end":return _context458.stop()}}),_callee457,this,[[3,21]])})))}},{key:"searchCompanies",value:function(searchPattern){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee458(){var headers,responseData,office365CompaniesData,_this340=this;return regenerator_default.a.wrap((function(_context459){for(;;)switch(_context459.prev=_context459.next){case 0:if(this.isOffice365AdSearchAllowed){_context459.next=2;break}return _context459.abrupt("return",[]);case 2:return this.logger.info("search office365 Company from Ad with pattern "+searchPattern),_context459.prev=3,headers=this.authService.getPostHeader(),_context459.next=7,fetch(this.url+"/search",{method:"POST",mode:"cors",headers:headers,body:JSON.stringify({companyName:searchPattern,includeContacts:!1})});case 7:return responseData=_context459.sent,_context459.next=10,responseData.json();case 10:return office365CompaniesData=_context459.sent.data,_context459.abrupt("return",office365CompaniesData.map((function(office365CompanyData){var company=company_model_1.Company.create(office365CompanyData.oid,office365CompanyData.companyName);return _this340.getCompanyLogo(company),_this340.getCompanyBanner(company),_this340.companies[company.id]=company,company})));case 14:return _context459.prev=14,_context459.t0=_context459.catch(3),_context459.abrupt("return",(this.logger.error("search office365 Company from Ad with pattern ".concat(searchPattern," --- FAILURE --- ").concat(_context459.t0.message)),[]));case 17:case"end":return _context459.stop()}}),_callee458,this,[[3,14]])})))}},{key:"getCompanyLogo",value:function(company){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee459(){var companyColor,companyInitials;return regenerator_default.a.wrap((function(_context460){for(;;)switch(_context460.prev=_context460.next){case 0:return _context460.prev=0,companyColor=this.userInfoService.computeUserColor(company.name),companyInitials=company.name.substr(0,1),_context460.abrupt("return",(company.logo=this.userInfoService.getAvatarImage(company.id,companyInitials,companyColor.color,130,company.lastAvatarUpdateDate),this.eventService.publish("ON_COMPANY_LOGO_UPDATED",company.id),this.logger.info("[getCompanyLogo] - "+company.getNameForLogs()+" - success"),company.sendChangeEvent("logo"),company));case 5:throw _context460.prev=5,_context460.t0=_context460.catch(0),new Error("getCompanyLogo -- FAILURE -- "+_context460.t0.message);case 8:case"end":return _context460.stop()}}),_callee459,this,[[0,5]])})))}},{key:"getCompanyBanner",value:function(company){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee460(){var _this341=this;return regenerator_default.a.wrap((function(_context461){for(;;)switch(_context461.prev=_context461.next){case 0:return _context461.abrupt("return",new Promise((function(resolve){var image=new Image;image.onload=function(){company.banner=image,_this341.eventService.publish("ON_COMPANY_BANNER_UPDATED",company.id),_this341.logger.info("[getCompanyBanner] - "+company.getNameForLogs()+" - success"),resolve(company)},image.onerror=function(){_this341.logger.error("[companyService] Load banner for "+company.getNameForLogs()+" failure"),resolve(company)};var imgSrc="/cacheV2/images/company-banner-01.svg";if(company.lastBannerUpdateDate){var serverURL=config.webservices.protocol+"://"+config.webservices.currentServer;_this341.mainService.cdn&&(serverURL=_this341.mainService.cdnServer),imgSrc=serverURL+"/api/banner/"+company.id+"?size=831",imgSrc+="&update="+crypto_js_1.MD5(crypto_js_1.CryptoJSEnc.Latin1.parse(company.lastBannerUpdateDate)).toString(crypto_js_1.CryptoJSEnc.Hex)}image.src=imgSrc})));case 1:case"end":return _context461.stop()}}),_callee460)})))}},{key:"getCompanyById",value:function(companyId){if(!companyId)throw new Error("missing companyId");var company=this.companies[companyId];return this.logger.info("[office365adService] getCompanyById (cache) "+companyId+" - success"),company}},{key:"getUserDetails",value:function(contact){return __awaiter(this,void 0,void 0,regenerator_default.a.mark((function _callee461(){var headers,url,responseData,office365ContactData;return regenerator_default.a.wrap((function(_context462){for(;;)switch(_context462.prev=_context462.next){case 0:if(!this.isOffice365AdSearchAllowed||!contact.o365Flag){_context462.next=19;break}return this.logger.info("getUserDetails for "+contact.oid),_context462.prev=2,headers=this.authService.getRequestHeader(),url="".concat(this.url,"/details/").concat(encodeURIComponent(contact.id)),_context462.next=7,fetch(url,{method:"GET",mode:"cors",headers:headers});case 7:if((responseData=_context462.sent).ok){_context462.next=10;break}throw this.logger.debug("Request ".concat(responseData.headers.get("x-rainbow-request-id")," failed with status ").concat(responseData.status)),new Error(responseData.statusText);case 10:return _context462.next=12,responseData.json();case 12:office365ContactData=_context462.sent,this.updateContactWithOffice365Data(contact,office365ContactData),_context462.next=19;break;case 16:_context462.prev=16,_context462.t0=_context462.catch(2),this.logger.error("getUserDetails -- FAILURE -- "+_context462.t0.message);case 19:case"end":return _context462.stop()}}),_callee461,this,[[2,16]])})))}},{key:"updateContactWithData",value:function(contact,data){contact.o365Flag=!0,contact.updateName(data.firstName,data.lastName),contact.companyName=this.contactService.userContact.company.name,contact.jobTitle=data.jobTitle,contact.department=data.department,contact.webAddress=data.mySite,contact.mobilePhones=data.mobilePhonesE164,contact.businessPhones=data.businessPhonesE164,contact.email=data.mail,contact.isContact=data.isContact}},{key:"updateContactWithOffice365Data",value:function(contact,data){contact.o365Flag=!0,contact.updateName(data.givenName,data.surname),contact.companyName=this.contactService.userContact.company.name,contact.jobTitle=data.jobTitle,contact.department=data.department,contact.webAddress=data.mySite,contact.email=data.mail,contact.isContact?(contact.street=data.addresses[0]&&data.addresses[0].street?data.addresses[0].street:"",contact.city=data.addresses[0]&&data.addresses[0].city?data.addresses[0].city:"",contact.country=data.addresses[0]&&data.addresses[0].countryOrRegion?data.addresses[0].countryOrRegion:"",contact.postCode=data.addresses[0]&&data.addresses[0].postalCode?data.addresses[0].postalCode:"",contact.state=data.addresses[0]&&data.addresses[0].state?data.addresses[0].state:""):(contact.street=data.streetAddress,contact.city=data.city,contact.country=data.country,contact.postCode=data.postalCode,contact.state=data.state)}}],[{key:"getInstance",value:function(){var win=window;return win.rainbow||(win.rainbow={}),win.rainbow.office365AdService||(win.rainbow.office365AdService=new Office365AdService),win.rainbow.office365AdService}}]),Office365AdService}();exports.Office365AdService=Office365AdService,exports.default=Office365AdService.getInstance()},function(module,exports){Strophe.addNamespace("RSM","http://jabber.org/protocol/rsm"),Strophe.RSM=function(options){if(this.attribs=["max","first","last","after","before","index","count"],void 0!==options.xml)this.fromXMLElement(options.xml);else for(var ii=0;ii<this.attribs.length;ii++){var attrib=this.attribs[ii];this[attrib]=options[attrib]}},Strophe.RSM.prototype={toXML:function(){for(var xml=$build("set",{xmlns:Strophe.NS.RSM}),ii=0;ii<this.attribs.length;ii++){var attrib=this.attribs[ii];void 0!==this[attrib]&&(xml=xml.c(attrib).t(this[attrib].toString()).up())}return xml.tree()},next:function(max){return new Strophe.RSM({max:max,after:this.last})},previous:function(max){return new Strophe.RSM({max:max,before:this.first})},fromXMLElement:function(xmlElement){for(var ii=0;ii<this.attribs.length;ii++){var attrib=this.attribs[ii],elem=xmlElement.getElementsByTagName(attrib)[0];null!=elem&&(this[attrib]=Strophe.getText(elem),"first"==attrib&&(this.index=elem.getAttribute("index")))}}}},function(module,exports){Strophe.addConnectionPlugin("ping",{_c:null,init:function(conn){this._c=conn,Strophe.addNamespace("PING","urn:xmpp:ping")},ping:function(jid,success,error,timeout){var id=this._c.getUniqueId("ping"),iq=$iq({type:"get",to:jid,id:id}).c("ping",{xmlns:Strophe.NS.PING});this._c.sendIQ(iq,success,error,timeout)},pong:function(ping){var from=ping.getAttribute("from"),id=ping.getAttribute("id"),iq=$iq({type:"result",to:from,id:id});this._c.sendIQ(iq)},addPingHandler:function(handler){return this._c.addHandler(handler,Strophe.NS.PING,"iq","get")}})},function(module,exports){Strophe.addConnectionPlugin("lastactivity",{_c:null,_n:0,init:function(conn){this._c=conn,Strophe.addNamespace("LAST_ACTIVITY","jabber:iq:last")},query:function(jid,options){var attr={type:"get",id:"lastActivityId"+this._n++,from:this._c.jid,to:jid},lastActivityAttr={xmlns:Strophe.NS.LAST_ACTIVITY},iq=$iq(attr).c("query",lastActivityAttr),onResponse=options.onResponse;return delete options.onResponse,this._c.addHandler(null,Strophe.NS.LAST_ACTIVITY,"message",null),this._c.sendIQ(iq,onResponse)}})},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _RainbowLogger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9);Strophe.addConnectionPlugin("jingle",{connection:null,sessions:{},jid2session:{},ice_config:{iceServers:[]},company_config:{},pc_constraints:{rtcpMuxPolicy:"require",bundlePolicy:"max-bundle"},media_constraints:{},localStream:null,connectionRef:null,jingleIqTimeout:15e3,init:function(conn){for(var key in this.connection=conn,this.connection.disco&&(this.connection.disco.addFeature("urn:xmpp:jingle:1"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.connection.disco.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:video"),this.connection.disco.addFeature("urn:ietf:rfc:5761")),this.connectionRef&&(this.connection.deleteHandler(this.connectionRef),this.connectionRef=null),config&&config.jingleIqTimeout?this.jingleIqTimeout=config.jingleIqTimeout:this.jingleIqTimeout=15e3,this.connectionRef=this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null),this.sessions)if(this.sessions.hasOwnProperty(key)){var session=this.sessions[key];session.connection=this.connection,null!==session.statsinterval&&(window.clearInterval(session.statsinterval),session.statsinterval=null)}},attachHandlers:function(){this.connectionRef&&(this.connection.deleteHandler(this.connectionRef),this.connectionRef=null),this.connectionRef=this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null)},onJingle:function(iq){_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe.jingle] onJingle");try{var sid=$(iq).find("jingle").attr("sid"),action=$(iq).find("jingle").attr("action"),ack=$iq({type:"result",to:iq.getAttribute("from"),id:iq.getAttribute("id")}),sess=this.sessions[sid];if("session-initiate"!=action){if(null==sess)return ack.type="error",ack.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(ack),$(document).trigger("callterminated.jingle",[sid]),!0;if(Strophe.getBareJidFromJid(iq.getAttribute("from"))!=Strophe.getBareJidFromJid(sess.peerjid))return console.warn("[Strophe.jingle] jid mismatch for session id",sid,iq.getAttribute("from"),sess.peerjid),ack.type="error",ack.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(ack),!0}else if(void 0!==sess)return ack.type="error",ack.c("error",{type:"cancel"}).c("service-unavailable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up(),console.warn("[Strophe.jingle] duplicate session id",sid),this.connection.send(ack),!0;switch("transport-replace"!==action&&this.connection.send(ack),action){case"session-initiate":var remoteType=$(iq).find("jingle").attr("localType");_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || "+remoteType),(sess=new JingleSession($(iq).attr("to"),$(iq).find("jingle").attr("sid"),this.connection,this.jingleIqTimeout)).media_constraints=this.media_constraints,sess.pc_constraints=this.pc_constraints,sess.ice_config=this.ice_config,sess.company_config=this.company_config,this.jid2session[$(iq).attr("from")]&&this.jid2session[$(iq).attr("from")].unifiedPlan&&(sess.unifiedPlanActivated=!0),sess.initiate($(iq).attr("from"),!1),sess.remoteType=remoteType,sess.confId=$(iq).find("jingle").attr("confId"),sess.publisherId=$(iq).find("conference").attr("publisherId");var conference_id=$(iq).find("conference").attr("id");conference_id&&(sess.conference_id=conference_id),sess.setRemoteDescription($(iq).find(">jingle"),"offer"),this.sessions[sess.sid]=sess,this.jid2session[sess.peerjid]=sess,$(document).trigger("callincoming.jingle",[sess.sid]);break;case"transport-replace":sess.isReconnecting=!0,_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[strophe jingle] Transport replace"),remoteType=$(iq).find("jingle").attr("localType"),_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || "+remoteType),sess.media_constraints=this.media_constraints,sess.pc_constraints=this.pc_constraints,sess.ice_config=this.ice_config,sess.company_config=this.company_config,sess.remoteType=remoteType,this.sessions[sess.sid]=sess,this.jid2session[sess.peerjid]=sess,sess.hasSentTransportReplace?(_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[strophe jingle] Transport replace -- put on hold"),sess.saveIncomingTransportReplace($(iq).find(">jingle"),"offer",ack)):(_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[strophe jingle] Transport replace is accepted"),this.connection.send(ack),sess.setRemoteDescription($(iq).find(">jingle"),"offer"),$(document).trigger("transportreplace.jingle",[sess.sid]));break;case"session-accept":sess.setRemoteDescription($(iq).find(">jingle"),"answer"),remoteType=$(iq).find(">jingle").attr("localType"),sess.remoteType=remoteType,_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || session-accept remoteType "+sess.remoteType),_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || session-accept localType "+sess.localType),sess.accept(),$(document).trigger("callaccepted.jingle",[sess.sid]);break;case"transport-accept":sess.setRemoteDescription($(iq).find(">jingle"),"answer"),sess.isReconnecting=!1,remoteType=$(iq).find(">jingle").attr("localType"),sess.remoteType=remoteType,_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || transport-accept remoteType "+sess.remoteType),_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || transport-accept localType "+sess.localType),$(document).trigger("callaccepted.jingle",[sess.sid]);break;case"session-terminate":sess.terminate(),this.terminate(sess.sid),$(iq).find(">jingle>conference").length&&$(iq).find(">jingle>conference").attr("reason")?$(document).trigger("callterminated.jingle",[sess.sid,"multi-device"]):$(iq).find(">jingle>reason").length?$(document).trigger("callterminated.jingle",[sess.sid,$(iq).find(">jingle>reason>:first")[0].tagName,$(iq).find(">jingle>reason>text").text()]):$(document).trigger("callterminated.jingle",[sess.sid]);break;case"transport-info":_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[JINGLE] transport-info"),sess.addIceCandidate($(iq).find(">jingle>content"));break;case"session-info":var affected;$(iq).find('>jingle>ringing[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?$(document).trigger("ringing.jingle",[sess.sid]):$(iq).find('>jingle>mute[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?(affected=$(iq).find('>jingle>mute[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("name"),$(document).trigger("mute.jingle",[sess.sid,affected])):$(iq).find('>jingle>unmute[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?(affected=$(iq).find('>jingle>unmute[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("name"),$(document).trigger("unmute.jingle",[sess.sid,affected])):$(iq).find('>jingle>iceFailed[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?$(document).trigger("remoteIceFailed.jingle",[sess.sid]):$(iq).find('>jingle>hold[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length?$(document).trigger("hold.jingle",[sess.sid]):$(iq).find('>jingle>unhold[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length&&$(document).trigger("unhold.jingle",[sess.sid]);break;case"content-add":_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe Jingle] Content-add");var mediaType=$(iq).find(">jingle").attr("mediaType");sess.remoteType=mediaType,_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || content-add remoteType "+sess.remoteType),_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || content-add localType "+sess.localType),sess.setRemoteDescription($(iq).find(">jingle"),"offer"),sess.mediaModified(),$(document).trigger("mediamodified.jingle",[sess.sid,mediaType]);break;case"content-modify":_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe Jingle] Content-modify"),mediaType=$(iq).find(">jingle").attr("mediaType"),sess.remoteType=mediaType,_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || content-modify remoteType "+sess.remoteType),_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("REMOTE TYPE || content-modify localType "+sess.localType),sess.setRemoteDescription($(iq).find(">jingle"),"offer"),sess.mediaModified(),$(document).trigger("mediamodified.jingle",[sess.sid,mediaType]);break;case"content-remove":_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe Jingle] Content-remove"),mediaType=$(iq).find(">jingle").attr("mediaType"),sess.remoteType=mediaType,sess.setRemoteDescription($(iq).find(">jingle"),"offer"),sess.mediaModified(!0),$(document).trigger("mediamodified.jingle",[sess.sid,mediaType]);break;case"content-accept":_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe Jingle] Content-accept"),sess.setRemoteDescription($(iq).find(">jingle"),"answer");break;case"addsource":sess.addSource($(iq).find(">jingle>content"));break;case"removesource":sess.removeSource($(iq).find(">jingle>content"));break;default:console.warn("[Strophe.jingle] jingle action not implemented",action)}}catch(error){return console.error("[Strophe.jingle] On Jingle error catch: "+error),!0}return!0},initiate:function(peerjid,myjid,localType,streams,sid,confid,phoneNumber,unifiedPlanActivated){var id=sid||Math.random().toString(36).substr(2,12),sess=new JingleSession(myjid||this.connection.jid,id,this.connection,this.jingleIqTimeout);if(streams&&streams.length)for(var i=0;i<streams.length;i++)sess.localStreams.push(streams[i]);return sess.media_constraints=this.media_constraints,sess.ice_config=this.ice_config,sess.company_config=this.company_config,localType&&(sess.localType=localType),void 0!==confid&&(sess.conference_id=confid),sess.calledNumber=phoneNumber&&""!==phoneNumber?phoneNumber:null,unifiedPlanActivated&&(sess.unifiedPlanActivated=!0),sess.initiate(peerjid,!0),this.sessions[sess.sid]=sess,this.jid2session[sess.peerjid]=sess,sess.sendOffer(!0),sess},terminate:function(sid,reason,text){if(null==sid)for(sid in this.sessions)"ended"!=this.sessions[sid].state&&(this.sessions[sid].sendTerminate(reason||(this.sessions[sid].active()?null:"cancel"),text),this.sessions[sid].terminate()),delete this.jid2session[this.sessions[sid].peerjid],delete this.sessions[sid];else this.sessions.hasOwnProperty(sid)&&("ended"!=this.sessions[sid].state&&(this.sessions[sid].sendTerminate(reason||(this.sessions[sid].active()?null:"cancel"),text),this.sessions[sid].terminate()),delete this.jid2session[this.sessions[sid].peerjid],delete this.sessions[sid])},terminateByJid:function(jid){if(this.jid2session.hasOwnProperty(jid)){var sess=this.jid2session[jid];sess&&(sess.terminate(),delete this.sessions[sess.sid],delete this.jid2session[jid],$(document).trigger("callterminated.jingle",[sess.sid,"gone"]))}}})},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _RainbowLogger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9);window.SDP=function(sdp){this.media=sdp.split("\r\nm=");for(var i=1;i<this.media.length;i++)this.media[i]="m="+this.media[i],i!=this.media.length-1&&(this.media[i]+="\r\n");this.session=this.media.shift()+"\r\n",this.raw=this.session+this.media.join("")},SDP.prototype.mangle=function(){var i,j,mline,lines,rtpmap,newdesc;for(i=0;i<this.media.length;i++)if((lines=this.media[i].split("\r\n")).pop(),"audio"==(mline=SDPUtil.parse_mline(lines.shift())).media){for(newdesc="",mline.fmt.length=0,j=0;j<lines.length;j++)if("a=rtpmap:"==lines[j].substr(0,9)){if("CN"==(rtpmap=SDPUtil.parse_rtpmap(lines[j])).name||"ISAC"==rtpmap.name)continue;mline.fmt.push(rtpmap.id),newdesc+=lines[j]+"\r\n"}else newdesc+=lines[j]+"\r\n";this.media[i]=SDPUtil.build_mline(mline)+"\r\n",this.media[i]+=newdesc}this.raw=this.session+this.media.join("")},SDP.prototype.removeSessionLines=function(prefix){var self=this,lines=SDPUtil.find_lines(this.session,prefix);return lines.forEach((function(line){self.session=self.session.replace(line+"\r\n","")})),this.raw=this.session+this.media.join(""),lines},SDP.prototype.removeMediaLines=function(mediaindex,prefix){var self=this,lines=SDPUtil.find_lines(this.media[mediaindex],prefix);return lines.forEach((function(line){self.media[mediaindex]=self.media[mediaindex].replace(line+"\r\n","")})),this.raw=this.session+this.media.join(""),lines},SDP.prototype.toJingle=function(elem,thecreator,confId){var i,j,k,mline,ssrc,rtpmap,tmp,lines,simulcast;if(SDPUtil.find_line(this.session,"a=group:"))for(lines=SDPUtil.find_lines(this.session,"a=group:"),i=0;i<lines.length;i++){var semantics=(tmp=lines[i].split(" ")).shift().substr(8);for(elem.c("group",{xmlns:"urn:xmpp:jingle:apps:grouping:0",semantics:semantics}),j=0;j<tmp.length;j++)elem.c("content",{name:tmp[j]}).up();elem.up()}for(SDPUtil.find_line(this.session,"a=group:BUNDLE")&&SDPUtil.find_line(this.session,"a=group:BUNDLE ").split(" ").shift(),i=0;i<this.media.length;i++)if("audio"==(mline=SDPUtil.parse_mline(this.media[i].split("\r\n")[0])).media||"video"==mline.media){if(ssrc=!!SDPUtil.find_line(this.media[i],"a=ssrc:")&&SDPUtil.find_line(this.media[i],"a=ssrc:").substring(7).split(" ")[0],simulcast=!!SDPUtil.find_line(this.media[i],"a=simulcast:")&&SDPUtil.find_line(this.media[i],"a=simulcast:").substring(12).trim(),elem.c("content",{creator:thecreator,name:mline.media}),SDPUtil.find_line(this.media[i],"a=mid:")){var mid=SDPUtil.parse_mid(SDPUtil.find_line(this.media[i],"a=mid:"));elem.attrs({name:mid})}if(SDPUtil.find_line(this.media[i],"a=rtpmap:").length){for(elem.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:mline.media}),ssrc&&elem.attrs({ssrc:ssrc}),j=0;j<mline.fmt.length;j++){if(rtpmap=SDPUtil.find_line(this.media[i],"a=rtpmap:"+mline.fmt[j]),elem.c("payload-type",SDPUtil.parse_rtpmap(rtpmap)),SDPUtil.find_line(this.media[i],"a=fmtp:"+mline.fmt[j]))for(tmp=SDPUtil.parse_fmtp(SDPUtil.find_line(this.media[i],"a=fmtp:"+mline.fmt[j])),k=0;k<tmp.length;k++)elem.c("parameter",tmp[k]).up();this.RtcpFbToJingle(i,elem,mline.fmt[j]),elem.up()}if(SDPUtil.find_line(this.media[i],"a=crypto:",this.session)&&(elem.c("encryption",{required:1}),SDPUtil.find_lines(this.media[i],"a=crypto:",this.session).forEach((function(line){elem.c("crypto",SDPUtil.parse_crypto(line)).up()})),elem.up()),ssrc&&(elem.c("source",{ssrc:ssrc,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),SDPUtil.find_lines(this.media[i],"a=ssrc:").forEach((function(line){idx=line.indexOf(" ");var linessrc=line.substr(0,idx).substr(7);linessrc!=ssrc&&(elem.up(),ssrc=linessrc,elem.c("source",{ssrc:ssrc,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}));var kv=line.substr(idx+1);elem.c("parameter"),-1==kv.indexOf(":")?elem.attrs({name:kv}):(elem.attrs({name:kv.split(":",2)[0]}),elem.attrs({value:kv.split(":",2)[1]})),elem.up()})),elem.up()),simulcast&&(elem.c("simulcast",{rids:simulcast,xmlns:"urn:xmpp:jingle:apps:rtp:sim:0"}),SDPUtil.find_lines(this.media[i],"a=rid:").forEach((function(line){var idx=line.indexOf(" "),ridName=line.substr(0,idx).substr(6);elem.c("rid",{xmlns:"urn:xmpp:jingle:apps:rtp:rid:0",name:ridName}),elem.up()})),elem.up()),SDPUtil.find_lines(this.media[i],"a=ssrc-group").forEach((function(line){var idx=line.indexOf(" "),semantics=line.substr(0,idx).substr(13);elem.c("ssrc-group",{xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0",semantics:semantics});for(var kv=line.substr(idx+1);kv.length>0;){var ssrc_gr;(idx=kv.indexOf(" "))>0?(ssrc_gr=kv.substr(0,idx),kv=kv.substr(idx+1)):(ssrc_gr=kv.substr(0,kv.length),kv=""),elem.c("source",{ssrc:ssrc_gr}).up()}elem.up()})),SDPUtil.find_line(this.media[i],"a=rtcp-mux")&&elem.c("rtcp-mux").up(),this.RtcpFbToJingle(i,elem,"*"),SDPUtil.find_line(this.media[i],"a=extmap:"))for(lines=SDPUtil.find_lines(this.media[i],"a=extmap:"),j=0;j<lines.length;j++){if(tmp=SDPUtil.parse_extmap(lines[j]),elem.c("rtp-hdrext",{xmlns:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",uri:tmp.uri,id:tmp.value}),tmp.hasOwnProperty("direction"))switch(tmp.direction){case"sendonly":elem.attrs({senders:"responder"});break;case"recvonly":elem.attrs({senders:"initiator"});break;case"sendrecv":elem.attrs({senders:"both"});break;case"inactive":elem.attrs({senders:"none"})}elem.up()}elem.up()}this.TransportToJingle(i,elem),SDPUtil.find_line(this.media[i],"a=sendrecv",this.session)?elem.attrs({senders:"both"}):SDPUtil.find_line(this.media[i],"a=sendonly",this.session)?elem.attrs({senders:"initiator"}):SDPUtil.find_line(this.media[i],"a=recvonly",this.session)?elem.attrs({senders:"responder"}):SDPUtil.find_line(this.media[i],"a=inactive",this.session)&&elem.attrs({senders:"none"}),"0"!=mline.port||SDPUtil.find_line(this.media[i],"a=bundle-only",this.session)||elem.attrs({senders:"rejected"}),elem.up()}return confId&&-1!==confId&&(elem.c("conference",{xmlns:"urn:xmpp:janus:1",id:confId}),elem.up()),elem.up(),elem},SDP.prototype.TransportToJingle=function(mediaindex,elem){var tmp,self=this;elem.c("transport"),SDPUtil.find_lines(this.media[mediaindex],"a=fingerprint:",this.session).forEach((function(line){(tmp=SDPUtil.parse_fingerprint(line)).xmlns="urn:xmpp:jingle:apps:dtls:0",elem.c("fingerprint").t(tmp.fingerprint),delete tmp.fingerprint,(line=SDPUtil.find_line(self.media[mediaindex],"a=setup:",self.session))&&(tmp.setup=line.substr(8)),elem.attrs(tmp),elem.up()})),(tmp=SDPUtil.iceparams(this.media[mediaindex],this.session))&&(tmp.xmlns="urn:xmpp:jingle:transports:ice-udp:1",elem.attrs(tmp),SDPUtil.find_line(this.media[mediaindex],"a=candidate:",this.session))&&SDPUtil.find_lines(this.media[mediaindex],"a=candidate:",this.session).forEach((function(line){elem.c("candidate",SDPUtil.candidateToJingle(line)).up()})),elem.up()},SDP.prototype.RtcpFbToJingle=function(mediaindex,elem,payloadtype){SDPUtil.find_lines(this.media[mediaindex],"a=rtcp-fb:"+payloadtype).forEach((function(line){var tmp=SDPUtil.parse_rtcpfb(line);"trr-int"==tmp.type?(elem.c("rtcp-fb-trr-int",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",value:tmp.params[0]}),elem.up()):(elem.c("rtcp-fb",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",type:tmp.type}),tmp.params.length>0&&elem.attrs({subtype:tmp.params[0]}),elem.up())}))},SDP.prototype.RtcpFbFromJingle=function(elem,payloadtype){var media="",tmp=elem.find('>rtcp-fb-trr-int[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]');return tmp.length&&(media+="a=rtcp-fb:* trr-int ",tmp.attr("value")?media+=tmp.attr("value"):media+="0",media+="\r\n"),(tmp=elem.find('>rtcp-fb[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]')).each((function(){media+="a=rtcp-fb:"+payloadtype+" "+$(this).attr("type"),$(this).attr("subtype")&&(media+=" "+$(this).attr("subtype")),media+="\r\n"})),media},SDP.prototype.fromJingle=function(jingle){var self=this;if(this.raw="v=0\r\no=- 1923518516 2 IN IP4 0.0.0.0\r\ns=-\r\nt=0 0\r\n",$(jingle).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]').length)$(jingle).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]').each((function(idx,group){var contents=$(group).find(">content").map((function(idx,content){return content.getAttribute("name")})).get();contents.length>0&&(self.raw+="a=group:"+(group.getAttribute("semantics")||group.getAttribute("type"))+" "+contents.join(" ")+"\r\n")}));else if($(jingle).find('>group[xmlns="urn:ietf:rfc:5888"]').length)$(jingle).find('>group[xmlns="urn:ietf:rfc:5888"]').each((function(idx,group){var contents=$(group).find(">content").map((function(idx,content){return content.getAttribute("name")})).get();null!==group.getAttribute("type")&&contents.length>0&&(self.raw+="a=group:"+group.getAttribute("type")+" "+contents.join(" ")+"\r\n")}));else{var bundle=$(jingle).find(">content").filter((function(idx,content){return $(content).find(">bundle").length>0})).map((function(idx,content){return content.getAttribute("name")})).get();bundle.length&&(this.raw+="a=group:BUNDLE "+bundle.join(" ")+"\r\n")}this.raw+="a=ice-options:trickle\r\n",this.session=this.raw,jingle.find(">content").each((function(){var m=self.jingle2media($(this));self.media.push(m)}));var msid=SDPUtil.parse_ssrc(this.raw);msid.hasOwnProperty("mslabel")&&msid.mslabel&&(this.session+="a=msid-semantic: WMS "+msid.mslabel+"\r\n"),this.raw=this.session+this.media.join("")},SDP.prototype.jingle2media=function(content){var tmp,media="",desc=content.find("description"),self=(desc.attr("ssrc"),this);if((tmp={media:desc.attr("media")}).port="1","rejected"==content.attr("senders")&&(tmp.port="0"),content.find(">transport>fingerprint").length||desc.find("encryption").length?tmp.proto="RTP/SAVPF":tmp.proto="RTP/AVPF",tmp.fmt=desc.find("payload-type").map((function(){return this.getAttribute("id")})).get(),media+=SDPUtil.build_mline(tmp)+"\r\n",media+="c=IN IP4 0.0.0.0\r\n",media+="a=rtcp:1 IN IP4 0.0.0.0\r\n",(tmp=content.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]')).length&&(tmp.attr("ufrag")&&(media+=SDPUtil.build_iceufrag(tmp.attr("ufrag"))+"\r\n"),tmp.attr("pwd")&&(media+=SDPUtil.build_icepwd(tmp.attr("pwd"))+"\r\n"),tmp.find(">fingerprint").each((function(){media+="a=fingerprint:"+this.getAttribute("hash"),media+=" "+$(this).text(),media+="\r\n",this.getAttribute("setup")&&(media+="a=setup:"+this.getAttribute("setup")+"\r\n")}))),(tmp=content.find('description>simulcast[xmlns="urn:xmpp:jingle:apps:rtp:sim:0"]')).length){var rids=tmp.attr("rids");rids&&(media+="a=simulcast: "+rids+"\r\n"),tmp.find(">rid").each((function(){media+="a=rid:"+this.getAttribute("name")+" recv",media+="\r\n"}))}switch(content.attr("senders")){case"initiator":media+="a=sendonly\r\n";break;case"responder":media+="a=recvonly\r\n";break;case"none":media+="a=inactive\r\n";break;case"both":media+="a=sendrecv\r\n"}return media+="a=mid:"+content.attr("name")+"\r\n",desc.find("rtcp-mux").length&&(media+="a=rtcp-mux\r\n"),desc.find("encryption").length&&desc.find("encryption>crypto").each((function(){media+="a=crypto:"+this.getAttribute("tag"),media+=" "+this.getAttribute("crypto-suite"),media+=" "+this.getAttribute("key-params"),this.getAttribute("session-params")&&(media+=" "+this.getAttribute("session-params")),media+="\r\n"})),desc.find("payload-type").each((function(){media+=SDPUtil.build_rtpmap(this)+"\r\n",$(this).find(">parameter").length&&(media+="a=fmtp:"+this.getAttribute("id")+" ",media+=$(this).find("parameter").map((function(){return(this.getAttribute("name")?this.getAttribute("name")+"=":"")+this.getAttribute("value")})).get().join(";"),media+="\r\n"),media+=self.RtcpFbFromJingle($(this),this.getAttribute("id"))})),media+=self.RtcpFbFromJingle(desc,"*"),(tmp=desc.find('>rtp-hdrext[xmlns="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0"]')).each((function(){media+="a=extmap:"+this.getAttribute("id")+" "+this.getAttribute("uri")+"\r\n"})),content.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]>candidate').each((function(){media+=SDPUtil.candidateFromJingle(this)})),(tmp=content.find('description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]')).each((function(){var ssrc=this.getAttribute("ssrc");$(this).find(">parameter").each((function(){this.getAttribute("name")&&this.getAttribute("name").length&&this.getAttribute("value")&&this.getAttribute("value").length&&(media+="a=ssrc:"+ssrc+" "+this.getAttribute("name")+":"+this.getAttribute("value")),media+="\r\n"}))})),(tmp=content.find('description>ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]')).each((function(){var semantics=this.getAttribute("semantics");media+="a=ssrc-group:"+semantics,$(this).find(">source").each((function(){media+=" "+this.getAttribute("ssrc")})),media+="\r\n"})),media},window.SDPUtil={iceparams:function(mediadesc,sessiondesc){var data=null;return SDPUtil.find_line(mediadesc,"a=ice-ufrag:",sessiondesc)&&SDPUtil.find_line(mediadesc,"a=ice-pwd:",sessiondesc)&&(data={ufrag:SDPUtil.parse_iceufrag(SDPUtil.find_line(mediadesc,"a=ice-ufrag:",sessiondesc)),pwd:SDPUtil.parse_icepwd(SDPUtil.find_line(mediadesc,"a=ice-pwd:",sessiondesc))}),data},parse_iceufrag:function(line){return line.substring(12)},build_iceufrag:function(frag){return"a=ice-ufrag:"+frag},parse_icepwd:function(line){return line.substring(10)},build_icepwd:function(pwd){return"a=ice-pwd:"+pwd},parse_mid:function(line){return line.substring(6)},parse_mline:function(line){var parts=line.substring(2).split(" "),data={};return data.media=parts.shift(),data.port=parts.shift(),data.proto=parts.shift(),""===parts[parts.length-1]&&parts.pop(),data.fmt=parts,data},build_mline:function(mline){return"m="+mline.media+" "+mline.port+" "+mline.proto+" "+mline.fmt.join(" ")},parse_rtpmap:function(line){var parts=line.substring(9).split(" "),data={};return data.id=parts.shift(),parts=parts[0].split("/"),data.name=parts.shift(),data.clockrate=parts.shift(),data.channels=parts.length?parts.shift():"1",data},build_rtpmap:function(el){var line="a=rtpmap:"+el.getAttribute("id")+" "+el.getAttribute("name")+"/"+el.getAttribute("clockrate");return el.getAttribute("channels")&&"1"!=el.getAttribute("channels")&&(line+="/"+el.getAttribute("channels")),line},parse_simulcast:function(line){var parts=line.substr(13).split(" "),data={};return data.direction=parts.shift(),data.rid=parts.shift().substr(4),data},parse_crypto:function(line){var parts=line.substring(9).split(" "),data={};return data.tag=parts.shift(),data["crypto-suite"]=parts.shift(),data["key-params"]=parts.shift(),parts.length&&(data["session-params"]=parts.join(" ")),data},parse_fingerprint:function(line){var parts=line.substring(14).split(" "),data={};return data.hash=parts.shift(),data.fingerprint=parts.shift(),data},parse_fmtp:function(line){var i,key,value,parts=line.split(" "),data=[];for(parts.shift(),parts=parts.join(" ").split(";"),i=0;i<parts.length;i++){for(key=parts[i].split("=")[0];key.length&&" "==key[0];)key=key.substring(1);value=parts[i].split("=")[1],key&&value?data.push({name:key,value:value}):key&&data.push({name:"",value:key})}return data},parse_icecandidate:function(line){_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe.jingle] jingle.sdp.parse_icecandidate "+line);var candidate={},elems=line.split(" ");candidate.foundation=elems[0].substring(12),candidate.component=elems[1],candidate.protocol=elems[2].toLowerCase(),candidate.priority=elems[3],candidate.ip=elems[4],candidate.port=elems[5],candidate.type=elems[7],candidate.generation=0;for(var i=8;i<elems.length;i+=2)switch(elems[i]){case"raddr":candidate["rel-addr"]=elems[i+1];break;case"rport":candidate["rel-port"]=elems[i+1];break;case"generation":candidate.generation=elems[i+1];break;case"tcptype":candidate.tcptype=elems[i+1];break;default:_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk('[Strophe.jingle] parse_icecandidate not translating "'+elems[i]+'" = "'+elems[i+1]+'"')}return candidate.network="1",candidate.id=Math.random().toString(36).substr(2,10),candidate},build_icecandidate:function(cand){var line=["a=candidate:"+cand.foundation,cand.component,cand.protocol,cand.priority,cand.ip,cand.port,"typ",cand.type].join(" ");switch(line+=" ",cand.type){case"srflx":case"prflx":case"relay":cand.hasOwnAttribute("rel-addr")&&cand.hasOwnAttribute("rel-port")&&(line+="raddr",line+=" ",line+=cand["rel-addr"],line+=" ",line+="rport",line+=" ",line+=cand["rel-port"],line+=" ")}return cand.hasOwnAttribute("tcptype")&&(line+="tcptype",line+=" ",line+=cand.tcptype,line+=" "),line+="generation",line+=" ",line+=cand.hasOwnAttribute("generation")?cand.generation:"0",_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe.jingle] jingle.sdp.build_icecandidate "+line),line},parse_ssrc:function(desc){for(var lines=desc.split("\r\n"),data={},i=0;i<lines.length;i++)if("a=ssrc:"==lines[i].substring(0,7)){var _idx=lines[i].indexOf(" ");data[lines[i].substr(_idx+1).split(":",2)[0]]=lines[i].substr(_idx+1).split(":",2)[1]}return data},parse_rtcpfb:function(line){var parts=line.substr(10).split(" "),data={};return data.pt=parts.shift(),data.type=parts.shift(),data.params=parts,data},parse_extmap:function(line){var parts=line.substr(9).split(" "),data={};return data.value=parts.shift(),-1!=data.value.indexOf("/")?(data.direction=data.value.substr(data.value.indexOf("/")+1),data.value=data.value.substr(0,data.value.indexOf("/"))):data.direction="both",data.uri=parts.shift(),data.params=parts,data},find_line:function(haystack,needle,sessionpart){for(var lines=haystack.split("\r\n"),i=0;i<lines.length;i++)if(lines[i].substring(0,needle.length)==needle)return lines[i];if(!sessionpart)return!1;lines=sessionpart.split("\r\n");for(var j=0;j<lines.length;j++)if(lines[j].substring(0,needle.length)==needle)return lines[j];return!1},find_lines:function(haystack,needle,sessionpart){for(var lines=haystack.split("\r\n"),needles=[],i=0;i<lines.length;i++)lines[i].substring(0,needle.length)==needle&&needles.push(lines[i]);if(needles.length||!sessionpart)return needles;lines=sessionpart.split("\r\n");for(var j=0;j<lines.length;j++)lines[j].substring(0,needle.length)==needle&&needles.push(lines[j]);return needles},candidateToJingle:function(line){if(_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe.jingle] !!! jingle.sdp.candidateToJingle "+line),0===line.indexOf("candidate:"))line="a="+line;else if("a=candidate:"!=line.substring(0,12))return _RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe.jingle] parseCandidate called with a line that is not a candidate line"),_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe.jingle] "+line),null;"\r\n"==line.substring(line.length-2)&&(line=line.substring(0,line.length-2));var i,candidate={},elems=line.split(" ");if("typ"!=elems[6])return _RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe.jingle] did not find typ in the right place"),_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk("[Strophe.jingle] "+line),null;for(candidate.foundation=elems[0].substring(12),candidate.component=elems[1],candidate.protocol=elems[2].toLowerCase(),candidate.priority=elems[3],candidate.ip=elems[4],candidate.port=elems[5],candidate.type=elems[7],candidate.generation="0",i=8;i<elems.length;i+=2)switch(elems[i]){case"raddr":candidate["rel-addr"]=elems[i+1];break;case"rport":candidate["rel-port"]=elems[i+1];break;case"generation":candidate.generation=elems[i+1];break;case"tcptype":candidate.tcptype=elems[i+1];break;case"network-cost":candidate.cost=elems[i+1];break;case"network-id":candidate.network=elems[i+1];break;default:_RainbowLogger__WEBPACK_IMPORTED_MODULE_0__.rainbowLogger.sdk('[Strophe.jingle] not translating "'+elems[i]+'" = "'+elems[i+1]+'"')}return candidate.id=Math.random().toString(36).substr(2,10),candidate},candidateFromJingle:function(cand,ufrag,pwd){var parts=["a=candidate:"+cand.getAttribute("foundation"),cand.getAttribute("component"),cand.getAttribute("protocol"),cand.getAttribute("priority"),cand.getAttribute("ip"),cand.getAttribute("port"),"typ",cand.getAttribute("type")];switch(cand.getAttribute("type")){case"srflx":case"prflx":case"relay":cand.getAttribute("rel-addr")&&cand.getAttribute("rel-port")&&(parts.push("raddr"),parts.push(cand.getAttribute("rel-addr")),parts.push("rport"),parts.push(cand.getAttribute("rel-port")))}return parts.push("generation"),parts.push(cand.getAttribute("generation")||"0"),cand.getAttribute("network")&&(parts.push("network-id"),parts.push(cand.getAttribute("network"))),cand.getAttribute("cost")&&(parts.push("network-cost"),parts.push(cand.getAttribute("cost"))),ufrag&&(parts.push("ufrag"),parts.push(ufrag)),pwd&&(parts.push("pwd"),parts.push(pwd)),parts.join(" ")+"\r\n"}}},function(module,exports){window.idx=-1,window.JingleSession=function(me,sid,connection,jingleIqTimeout){this.me=me,this.sid=sid,this.connection=connection,this.initiator=null,this.responder=null,this.isInitiator=null,this.peerjid=null,this.state=null,this.peerconnection=null,this.remoteStream=null,this.localSDP=null,this.remoteSDP=null,this.localStreams=[],this.localTransceivers=[],this.remoteStreams=[],this.remoteStreamsObject={},this.startTime=null,this.stopTime=null,this.media_constraints=null,this.pc_constraints=null,this.ice_config={},this.company_config={},this.hadstuncandidate=!1,this.hadturncandidate=!1,this.statsinterval=null,this.reason=null,this.addssrc=[],this.removessrc=[],this.pendingop=null,this.wait=!0,this.isRenegotiating=!1,this.remoteType=null,this.localType=null,this.videoSender=null,this.jingleIqTimeout=15e3,jingleIqTimeout&&(this.jingleIqTimeout=jingleIqTimeout),this.conference_id=-1,this.calledNumber=null,this.DTX=!1,this.unifiedPlanActivated=!1,this.hasSentTransportReplace=!1,this.iceFilterList=[]},JingleSession.prototype.initiate=function(peerjid,isInitiator){Strophe.log("","[Strophe.jingle] initiate");var self=this;if(null===this.state){this.isInitiator=isInitiator,this.initiator=isInitiator?this.me:peerjid,this.responder=isInitiator?peerjid:this.me,this.peerjid=peerjid;var constraints={};if(this.ice_config.sdpSemantics="plan-b",adapter&&adapter.default&&"chrome"===adapter.default.browserDetails.browser&&adapter.default.browserDetails.version>=70){var sdkVersion=function(peerjid){var version=null;if(peerjid){var _index8=peerjid.indexOf("web_sdk");-1!==_index8&&(version=peerjid.substr(_index8+10,2),version=parseInt(version,10))}return version}(peerjid);sdkVersion&&sdkVersion<53&&(Strophe.log("","[Strophe.jingle] Unified plan activated"),this.ice_config.sdpSemantics="unified-plan")}this.unifiedPlanActivated&&(this.ice_config.sdpSemantics="unified-plan"),Strophe.log("","[Strophe.jingle] SDP activated: "+this.ice_config.sdpSemantics),this.ice_config.unifiedPlan&&(this.unifiedPlanActivated=!0,Strophe.log("","[Strophe.jingle] FORCED Unified plan activated"),this.ice_config.sdpSemantics="unified-plan"),this.ice_config.enableDSCP&&(Strophe.log("","[Strophe.jingle] googDscp activated"),constraints={optional:[{googDscp:!0}]}),this.ice_config.dtx&&(Strophe.log("","[Strophe.jingle] Discontinuous Transmission (DTX) activated"),this.DTX=!0),this.company_config&&this.company_config.negotiation&&this.company_config.negotiation.iceFiltering&&(this.iceFilterList=this.company_config.negotiation.iceFiltering.length?this.company_config.negotiation.iceFiltering:[]);try{this.peerconnection=new window.RTCPeerConnection(this.ice_config,constraints)}catch(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] Failed to create PeerConnection, exception: ",e.message),Strophe.log(Strophe.LogLevel.ERROR,e);try{this.peerconnection=new window.RTCPeerConnection,this.peerconnection.setConfiguration&&this.peerconnection.setConfiguration(this.ice_config)}catch(error){return Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] Failed to create PeerConnection, exception: ",e.message),void Strophe.log(Strophe.LogLevel.ERROR,error)}}this.peerconnection.onicecandidate=function(event){window.isRenegotiating?Strophe.log("","[Strophe.jingle] onicecandidate not added due to renegotiation"):self.sendIceCandidate(event.candidate)},this.peerconnection.onaddstream=function(event){if(!self.unifiedPlanActivated){Strophe.log("","[Strophe.jingle] onAddStream");var stream=event.stream;if(self.remoteStream=stream,"audio"===self.remoteType||"video"===self.remoteType)for(;self.remoteStreams.length>0;)self.remoteStreams.pop();else for(var i=0;i<self.remoteStreams.length&&self.remoteStreams[i];i++)self.remoteStreams[i].active?stream.getAudioTracks().length?self.remoteStreams[i].getAudioTracks().length&&self.remoteStreams.splice(i,1):!self.remoteStreams[i].getAudioTracks().length&&self.remoteStreams[i].getVideoTracks().length&&self.remoteStreams.splice(i,1):self.remoteStreams.splice(i,1);for(self.remoteStreams.push(stream),Strophe.log("",self.remoteStreams),Strophe.log("","[Strophe.jingle] peer.onaddstream",stream.id,stream),stream.hasOwnProperty("active")&&Strophe.log("","[Strophe.jingle] stream active ? ",stream.active),Strophe.log("","[Strophe.jingle] audio Tracks: "+stream.getAudioTracks().length+" | Video Tracks: "+stream.getVideoTracks().length),i=0;i<stream.getAudioTracks().length;i++){var track=stream.getAudioTracks()[i];Strophe.log("","[Strophe.jingle] audio Track: "+track.id+" | "+track.kind+" | "+track.enabled+" | "+track.readyState,track)}for(i=0;i<stream.getVideoTracks().length;i++)track=stream.getVideoTracks()[i],Strophe.log("","[Strophe.jingle] video Track: "+track.id+" | "+track.kind+" | "+track.enabled+" | "+track.readyState,track);stream.onactive=function(){Strophe.log("","[Strophe.jingle] stream.onactive",stream)},stream.onaddtrack=function(evt){Strophe.log("","[Strophe.jingle] stream.onaddtrack: "+evt.track.id+" | "+evt.track.kind+" | "+evt.track.enabled+" | "+evt.track.readyState,evt.track)},stream.onremovetrack=function(evt){Strophe.log("","[Strophe.jingle] stream.onremovetrack: "+evt.track.id+" | "+evt.track.kind+" | "+evt.track.enabled+" | "+evt.track.readyState,evt.track)},stream.oninactive=function(){Strophe.log("","[Strophe.jingle] stream.oninactive",stream)},$(document).trigger("remotestreamadded.jingle",[self.sid,stream.getAudioTracks().length])}},this.peerconnection.ontrack=function(trackEvent){self.unifiedPlanActivated&&(window.conference_id&&-1!==window.conference_id?self.createRemoteStreamForConference(trackEvent.transceiver):self.createOrUpdateRemoteStreams(trackEvent.transceiver))},this.peerconnection.onremovetrack=function(trackEvent){self.unifiedPlanActivated},this.peerconnection.onremovestream=function(event){Strophe.log("","[Strophe.jingle] peer.onremovestream"),$(document).trigger("remotestreamremoved.jingle",[event,self.sid])},this.peerconnection.onsignalingstatechange=function(event){self&&self.peerconnection&&$(document).trigger("iceconnectionstatechange.jingle",[self.sid,self])},this.peerconnection.oniceconnectionstatechange=function(event){if(self&&self.peerconnection){switch(self.peerconnection.iceConnectionState){case"connected":this.startTime=new Date,Strophe.log("","[Strophe.jingle] iceConnectionState is connected, try to update the RTP Sender ");break;case"closed":case"disconnected":this.stopTime=new Date}$(document).trigger("iceconnectionstatechange.jingle",[self.sid,self])}},this.localStreams.forEach((function(stream){self.unifiedPlanActivated?self.addStream(stream):self.peerconnection.addStream(stream)}))}else Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] attempt to initiate on session "+this.sid+"in state "+this.state)},JingleSession.prototype.createRemoteStreamForConference=function(transceiver){var stream=new MediaStream;stream.addTrack(transceiver.receiver.track),this.remoteStreamsObject[0]=stream},JingleSession.prototype.createOrUpdateRemoteStreams=function(transceiver){var mid=parseInt(transceiver.mid),stream=new MediaStream;this.remoteStreamsObject[mid]?(this.remoteStreamsObject[mid].removeTrack(this.remoteStreamsObject[mid].getTracks()[0]),this.remoteStreamsObject[mid].addTrack(transceiver.receiver.track)):(stream.addTrack(transceiver.receiver.track),this.remoteStreamsObject[mid]=stream)},JingleSession.prototype.updateRemoteStreams=function(){var self=this;this.localTransceivers.forEach((function(transceiver){transceiver.currentDirection&&"sendonly"!==transceiver.currentDirection&&"inactive"!==transceiver.currentDirection||(self.remoteStreamsObject[transceiver.mid]=null)}))},JingleSession.prototype.addStream=function(stream){if(this.unifiedPlanActivated){if(this.conference_id&&-1!==this.conference_id){var type=stream.getAudioTracks().length?"audio":"video";return this.localTransceivers[0]||(this.localTransceivers[0]=this.peerconnection.addTransceiver(type)),this.localTransceivers[0].sender.replaceTrack("audio"===type?stream.getAudioTracks()[0]:stream.getVideoTracks()[0]),void(this.localTransceivers[0].direction="sendrecv")}return stream.getAudioTracks().length>0&&(this.localTransceivers[0]||(this.localTransceivers[0]=this.peerconnection.addTransceiver("audio")),this.localTransceivers[0].sender.replaceTrack(stream.getAudioTracks()[0]),this.localTransceivers[0].direction="sendrecv"),stream.getVideoTracks().length>0&&stream.getAudioTracks().length>0&&(this.localTransceivers[0]||(this.localTransceivers[0]=this.peerconnection.addTransceiver("audio",{direction:"recvonly"})),this.localTransceivers[1]||(this.localTransceivers[1]=this.peerconnection.addTransceiver("video")),this.localTransceivers[1].sender.replaceTrack(stream.getVideoTracks()[0]),this.localTransceivers[1].direction="sendrecv"),void(stream.getVideoTracks().length>0&&!stream.getAudioTracks().length&&(this.localTransceivers[0]||(this.localTransceivers[0]=this.peerconnection.addTransceiver("audio",{direction:"recvonly"})),this.localTransceivers[1]||this.localTransceivers.push(this.peerconnection.addTransceiver("video",{direction:"recvonly"})),"videoOnly"===this.localType?(this.localTransceivers[1].sender.replaceTrack(stream.getVideoTracks()[0]),this.localTransceivers[1].direction="sendrecv"):(this.localTransceivers[2]||this.localTransceivers.push(this.peerconnection.addTransceiver("video")),this.localTransceivers[2].sender.replaceTrack(stream.getVideoTracks()[0]),this.localTransceivers[2].direction="sendrecv")))}switch(adapter.default.browserDetails.browser){case"chrome":case"edge":this.peerconnection.addStream(stream);break;case"firefox":case"safari":stream.getAudioTracks().length>0&&this.peerconnection.addTrack(stream.getAudioTracks()[0],stream),stream.getVideoTracks().length>0&&this.peerconnection.addTrack(stream.getVideoTracks()[0],stream)}},JingleSession.prototype.removeStream=function(stream,RTC){if(Strophe.log("","[Strophe.jingle] detected WebRTC browser is "+adapter.default.browserDetails.browser),this.unifiedPlanActivated)return this.peerconnection.getTransceivers().forEach((function(transceiver){transceiver.sender.replaceTrack(null),transceiver.direction="recvonly"})),void(this.localTransceivers=this.peerconnection.getTransceivers());switch(adapter.default.browserDetails.browser){case"chrome":case"edge":this.peerconnection.removeStream(stream)}},JingleSession.prototype.addTrack=function(stream){stream.getAudioTracks().length>0&&this.peerconnection.addTrack(stream.getAudioTracks()[0],stream),stream.getVideoTracks().length>0&&this.peerconnection.addTrack(stream.getVideoTracks()[0],stream)},JingleSession.prototype.replaceStream=function(stream){switch(Strophe.log("","[Strophe.jingle] detected WebRTC browser is "+adapter.default.browserDetails.browser),adapter.default.browserDetails.browser){case"chrome":break;case"firefox":case"safari":if(this.unifiedPlanActivated)return void this.addStream(stream);var yourAudioTrack=stream.getAudioTracks()[0],yourVideoTrack=stream.getVideoTracks()[0];Strophe.log(Strophe.LogLevel.ERROR,yourAudioTrack),Strophe.log(Strophe.LogLevel.ERROR,yourVideoTrack);var videoAlreadyReplaced=!1,audioAlreadyReplaced=!1;if(this.peerconnection.getSenders().forEach((function(rtpSender){yourVideoTrack&&rtpSender.track&&"video"===rtpSender.track.kind&&(rtpSender.replaceTrack(yourVideoTrack),Strophe.log("","[Strophe.jingle] replaceTrack video "+rtpSender),videoAlreadyReplaced=!0),yourAudioTrack&&rtpSender.track&&"audio"===rtpSender.track.kind&&(Strophe.log("","[Strophe.jingle] replaceTrack audio "+rtpSender),rtpSender.replaceTrack(yourAudioTrack),audioAlreadyReplaced=!0)})),yourVideoTrack&&!videoAlreadyReplaced)Strophe.log("","[Strophe.jingle] addTrack yourVideoTrack"),this.videoSender=this.peerconnection.addTrack(yourVideoTrack,stream);else if(this.videoSender){Strophe.log("","[Strophe.jingle] removeTrack yourVideoTrack");try{this.peerconnection.removeTrack(this.videoSender),this.videoSender=null}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] removeTrack error "+error)}}yourAudioTrack&&!audioAlreadyReplaced&&(Strophe.log("","[Strophe.jingle] add new audio track"),this.peerconnection.addTrack(yourAudioTrack,stream))}},JingleSession.prototype.addConferenceInfo=function(stanza){-1!==this.conference_id&&(stanza.c("conference",{xmlns:"urn:xmpp:janus:1",id:this.conference_id}),stanza.up())},JingleSession.prototype.accept=function(){try{var _self=this;this.state="active";var pranswer=this.peerconnection.localDescription;if(!pranswer||"pranswer"!=pranswer.type)return;for(Strophe.log("","[Strophe.jingle] going from pranswer to answer");SDPUtil.find_line(pranswer.sdp,"a=inactive");)pranswer.sdp=pranswer.sdp.replace("a=inactive","a=sendrecv");pranswer=this.hackMsLabelSDP(pranswer);var prsdp=new SDP(pranswer.sdp),accept=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-accept",initiator:this.initiator,responder:this.responder,sid:this.sid,localType:this.localType});prsdp.toJingle(accept,this.initiator==this.me?"initiator":"responder",this.conference_id,this.calledNumber),this.connection.sendIQ(accept,(function(){$(document).trigger("ack.jingle",[_self.sid,{source:"answer"}])}),(function(stanza){var error=$(stanza).find("error").length?{code:$(stanza).find("error").attr("code"),reason:$(stanza).find("error :first")[0].tagName}:{};error.source="answer",$(document).trigger("error.jingle",{sid:_self.sid,error:error})}),this.jingleIqTimeout);for(var sdp=this.peerconnection.localDescription.sdp;SDPUtil.find_line(sdp,"a=inactive");)sdp=sdp.replace("a=inactive","a=sendrecv");this.peerconnection.setLocalDescription(new window.RTCSessionDescription({type:"answer",sdp:sdp}),(function(){$(document).trigger("setLocalDescription.jingle",[_self.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success, try to update the RTP Sender "),_self.ice_config.enableDSCP&&_self.peerconnection.getSenders().forEach((function(rtpSender){if(rtpSender.getParameters&&rtpSender.setParameters){var params=rtpSender.getParameters();params.encodings.forEach((function(encoding){encoding.priority="high",encoding.networkPriority="high"})),rtpSender.setParameters(params),Strophe.log("","[Strophe.jingle] RTP Sender parameters are updated "+rtpSender.getParameters())}}))}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.accept failed: "+error)}},JingleSession.prototype.terminate=function(reason){this.state="ended",this.reason=reason,this.peerconnection&&"closed"!==this.peerconnection.signalingState&&this.peerconnection.close(),Strophe.log("","[Strophe.jingle] Clear peerconnection"),this.peerconnection=null,null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),this.localStreams&&this.localStreams.length&&this.localStreams.forEach((function(stream){stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),track=null})),stream.stop&&stream.stop(),stream=null}))},JingleSession.prototype.active=function(){return"active"==this.state},JingleSession.prototype.sendIceCandidate=function(candidate){if(candidate&&this.iceFilterList&&this.iceFilterList.length&&-1!==this.iceFilterList.indexOf(candidate.type))Strophe.log("","[Strophe.jingle] ICE candidate "+candidate.type+" is filtered");else if(candidate){Strophe.log("","[Strophe.jingle] sendIceCandidate "+candidate);var ice=SDPUtil.iceparams(this.localSDP.media[candidate.sdpMLineIndex],this.localSDP.session),jcand=SDPUtil.candidateToJingle(candidate.candidate);if(!ice||!jcand)return void Strophe.log("","[Strophe.jingle] failed to get ice && jcand");ice.xmlns="urn:xmpp:jingle:transports:ice-udp:1",Strophe.log("","[Strophe.jingle] sending single candidate"),this.isRenegotiating?Strophe.log("","[Strophe.jingle] NOT sending candidate due to Renegotiation"):this.sendIceCandidates([candidate])}},JingleSession.prototype.sendIceCandidates=function(candidates){try{Strophe.log("","[Strophe.jingle] sendIceCandidates",candidates);for(var cand=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-info",initiator:this.initiator,sid:this.sid,localType:this.localType}),mid=0;mid<this.localSDP.media.length;mid++){var cands=candidates.filter((function(el){return el.sdpMLineIndex==mid})),mline=SDPUtil.parse_mline(this.localSDP.media[mid].split("\r\n")[0]);if(cands.length>0){var ice=SDPUtil.iceparams(this.localSDP.media[mid],this.localSDP.session);ice.xmlns="urn:xmpp:jingle:transports:ice-udp:1",cand.c("content",{creator:this.initiator==this.me?"initiator":"responder",name:cands[0].sdpMid?cands[0].sdpMid:mline.media}).c("transport",ice);for(var i=0;i<cands.length;i++)cand.c("candidate",SDPUtil.candidateToJingle(cands[i].candidate)).up();if(SDPUtil.find_line(this.localSDP.media[mid],"a=fingerprint:",this.localSDP.session)){var _tmp=SDPUtil.parse_fingerprint(SDPUtil.find_line(this.localSDP.media[mid],"a=fingerprint:",this.localSDP.session));_tmp.required=!0,cand.c("fingerprint").t(_tmp.fingerprint),delete _tmp.fingerprint,cand.attrs(_tmp),cand.up()}cand.up(),cand.up()}}if(config.turnOn&&!(cand.node.innerHTML.indexOf('type="relay')>-1))return void Strophe.log("","[Strophe.jingle] Debug flag turnOn : Ignore candidate");Strophe.log("","[Strophe.jingle] try to send ack(transportinfo)..."),this.connection.sendIQ(cand,(function(){Strophe.log("","Sent session initiate (ACK, transportinfo)..."),$(document).trigger("ack.jingle",[window.sid,{source:"transportinfo"}])}),(function(stanza){var error=$(stanza).find("error").length?{code:$(stanza).find("error").attr("code"),reason:$(stanza).find("error :first")[0].tagName}:{};error.source="transportinfo",$(document).trigger("error.jingle",{sid:this.sid,error:error})}),this.jingleIqTimeout)}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendIceCandidates failed: "+error)}},JingleSession.prototype.hackOfferSDP=function(offer){return"firefox"!==adapter.default.browserDetails.browser&&(offer.sdp=offer.sdp.replace(/a=sendonly/g,"a=sendrecv")),-1!==this.conference_id&&"video"===this.localType&&(offer.sdp=offer.sdp.replace(/a=sendrecv/g,"a=sendonly")),navigator.platform.toUpperCase().indexOf("MAC")>=0&&(offer.sdp=this.forceCodecTo(offer.sdp,"H264/90000","video")),this.ice_config.simulcast&&-1!==this.conference_id&&"video"===this.localType&&adapter&&adapter.default&&"chrome"===adapter.default.browserDetails.browser&&adapter.default.browserDetails.version>=70&&(Strophe.log("","[Strophe.jingle] Enabling Simulcasting for Chrome (sdp munging)"),offer.sdp=this.mungeSdpForSimulcasting(offer.sdp)),offer},JingleSession.prototype.hackMsLabelSDP=function(offer){for(var res=offer.sdp.split("\r\n"),i=0;i<res.length;i++)if("a=ssrc:"==res[i].substring(0,7)){var _idx2=res[i].indexOf(" ");!res[i].substr(_idx2+1).split(":",2)[0]||void 0!==res[i].substr(_idx2+1).split(":",2)[1]&&""!==res[i].substr(_idx2+1).split(":",2)[1]||res.splice(i,1)}return offer.sdp=res.join("\r\n"),offer},JingleSession.prototype.sendTransportReplace=function(){Strophe.log("","[Strophe.jingle] sendTransportReplace");var self=this;self.isReconnecting?Strophe.log("","[Strophe.jingle] sendTransportReplace ignored because we're already connecting"):(self.isReconnecting=!0,this.peerconnection.createOffer((function(sdp){self.createdOffer(sdp,"transport-replace")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createOffer failed",e)}),{iceRestart:!0}))},JingleSession.prototype.reconnectSession=function(){Strophe.log("","[Strophe.jingle] reconnectSession");var self=this;self.isReconnecting?Strophe.log("","[Strophe.jingle] reconnectSession ignored because we're already connecting"):(self.isReconnecting=!0,self.hasSentTransportReplace=!0,this.peerconnection.createOffer((function(sdp){self.sendCreatedOfferWithAckWait(sdp,"transport-replace")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createOffer failed",e)}),{iceRestart:!0}))},JingleSession.prototype.saveIncomingTransportReplace=function(elem,desctype,ack){Strophe.log("","[Strophe.jingle] saveIncomingTransportReplace"),this.savedIncomingTransportReplace={elem:elem,desctype:desctype,ack:ack}},JingleSession.prototype.acceptSavedIncomingTransportReplace=function(){Strophe.log("","[Strophe.jingle] acceptSavedIncomingTransportReplace"),this.connection.send(this.savedIncomingTransportReplace.ack),this.setRemoteDescription(this.savedIncomingTransportReplace.elem,this.savedIncomingTransportReplace.desctype),$(document).trigger("transportreplace.jingle",[this.sid]),this.savedIncomingTransportReplace=null},JingleSession.prototype.rejectSavedIncomingTransportReplace=function(){if(Strophe.log("","[Strophe.jingle] rejectSavedIncomingTransportReplace"),this.savedIncomingTransportReplace&&this.savedIncomingTransportReplace.ack){var ack=this.savedIncomingTransportReplace.ack;ack.type="error",ack.c("error",{type:"reject"}),this.connection.send(ack)}this.savedIncomingTransportReplace=null},JingleSession.prototype.sendCreatedOfferWithAckWait=function(offer,actionName){try{offer=this.hackOfferSDP(offer),offer=this.hackMsLabelSDP(offer);var _self2=this;this.localSDP=new SDP(offer.sdp);var action=actionName||"session-initiate";Strophe.log("","[Strophe.jingle] sendCreatedOfferWithAckWait with SDP : "+offer.sdp+" and action : "+action);var init=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:action,initiator:this.initiator,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&((init=init.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),init.up()),this.localSDP.toJingle(init,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(init,(function(stanza){if(stanza&&$(stanza).find("error").length)return Strophe.log("","[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ ACK with error"),_self2.hasSentTransportReplace=!1,void(_self2.savedIncomingTransportReplace&&_self2.acceptSavedIncomingTransportReplace());if(Strophe.log("","[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ ACK received, set local description"),_self2.hasSentTransportReplace=!1,_self2.savedIncomingTransportReplace){if(!_self2.isInitiator)return void _self2.acceptSavedIncomingTransportReplace();_self2.rejectSavedIncomingTransportReplace()}offer.sdp=_self2.localSDP.raw,_self2.peerconnection.setLocalDescription(offer,(function(){$(document).trigger("setLocalDescription.jingle",[_self2.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}),(function(){Strophe.log("","[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ rejected"),_self2.hasSentTransportReplace=!1,_self2.savedIncomingTransportReplace?_self2.acceptSavedIncomingTransportReplace():_self2.isReconnecting=!1}),this.jingleIqTimeout)}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.createdOffer failed: "+error)}},JingleSession.prototype.sendOffer=function(restart){Strophe.log("","[Strophe.jingle] sendOffer");var self=this;if(restart){Strophe.log("","ice restart");var options={};if((-1===this.conference_id&&!this.calledNumber||"video"!==this.localType)&&(options.iceRestart=!0),this.ice_config.simulcast&&-1!==this.conference_id&&"video"===this.localType&&adapter&&adapter.default&&"firefox"===adapter.default.browserDetails.browser){Strophe.log("","[Strophe.jingle] Enabling Simulcasting for Firefox (RID)");var sender=this.peerconnection.getSenders().find((function(s){return"video"==s.track.kind}));if(sender){var parameters=sender.getParameters();parameters||(parameters={}),parameters.encodings=[{rid:"h",active:!0,maxBitrate:9e5},{rid:"m",active:!0,maxBitrate:3e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:1e5,scaleResolutionDownBy:4}],sender.setParameters(parameters)}}this.peerconnection.createOffer((function(offer){self.createdOffer(offer)}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createOffer failed",e)}),options)}else this.peerconnection.createOffer((function(offer){self.createdOffer(offer)}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createOffer failed",e)}),this.media_constraints)},JingleSession.prototype.createdOffer=function(offer,actionName){try{offer=this.hackOfferSDP(offer),offer=this.hackMsLabelSDP(offer);var _self3=this;this.localSDP=new SDP(offer.sdp);var action=actionName||"session-initiate";Strophe.log("","[Strophe.jingle] createdOffer with SDP : "+offer.sdp+" and action : "+action);var init=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:action,initiator:this.initiator,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&((init=init.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),init.up()),this.localSDP.toJingle(init,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(init,(function(){$(document).trigger("ack.jingle",[_self3.sid,{source:"offer"}])}),(function(stanza){_self3.state="error",_self3.peerconnection&&"closed"!==_self3.peerconnection.signalingState&&(Strophe.log("","[Strophe.jingle] Clear peerconnection"),_self3.peerconnection.close(),_self3.peerconnection=null);var error=$(stanza).find("error").length?{code:$(stanza).find("error").attr("code"),reason:$(stanza).find("error :first")[0].tagName}:{};error.source="offer",$(document).trigger("error.jingle",{sid:_self3.sid,error:error})}),this.jingleIqTimeout),offer.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(offer,(function(){$(document).trigger("setLocalDescription.jingle",[_self3.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.createdOffer failed: "+error)}},JingleSession.prototype.contentRemove=function(streamType){Strophe.log("","[Strophe.jingle] contentRemove");var self=this;this.peerconnection.createOffer((function(sdp){self.contentUpdateOffer(sdp,streamType,"remove")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] contentRemove failed",e)}),this.media_constraints)},JingleSession.prototype.contentAdd=function(streamType){Strophe.log("","[Strophe.jingle] contentAdd");var self=this;this.peerconnection.createOffer((function(sdp){self.contentUpdateOffer(sdp,streamType,"add")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] contentAdd failed",e)}),this.media_constraints)},JingleSession.prototype.contentModify=function(streamType){Strophe.log("","[Strophe.jingle] contentModify");var self=this;this.peerconnection.createOffer((function(sdp){self.contentUpdateOffer(sdp,streamType,"modify")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] contentModify failed",e)}),this.media_constraints)},JingleSession.prototype.contentUpdateOffer=function(sdp,streamType,actionType){try{Strophe.log("","[Strophe.jingle] contentUpdateOffer",sdp.sdp);var _self4=this;sdp=this.hackMsLabelSDP(sdp),this.localSDP=new SDP(sdp.sdp),"audio"===streamType?_self4.localType="audio":"video"===streamType?_self4.localType="audio+video":"sharing"===streamType?_self4.localType="sharing":"sharing+video"===streamType&&(_self4.localType="sharing+video");var init=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-"+actionType,initiator:this.initiator,sid:this.sid,mediaType:streamType});this.calledNumber&&""!==this.calledNumber&&((init=init.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),init.up()),this.localSDP.toJingle(init,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(init,(function(){$(document).trigger("ack.jingle",[_self4.sid,{source:"offer"}])}),(function(stanza){_self4.state="error",_self4.peerconnection&&(Strophe.log("","[Strophe.jingle] Clear peerconnection"),_self4.peerconnection.close(),_self4.peerconnection=null);var error=$(stanza).find("error").length?{code:$(stanza).find("error").attr("code"),reason:$(stanza).find("error :first")[0].tagName}:{};error.source="offer",$(document).trigger("error.jingle",{sid:_self4.sid,error:error})}),this.jingleIqTimeout),sdp.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(sdp,(function(){$(document).trigger("setLocalDescription.jingle",[_self4.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success")}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.contentUpdateOffer failed: "+error)}},JingleSession.prototype.contentChangeAnswer=function(sdp,updateStreams){try{Strophe.log("","[Strophe.jingle] contentChangeAnswer",sdp.sdp);var _self5=this;sdp=this.hackMsLabelSDP(sdp),this.localSDP=new SDP(sdp.sdp);var init=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-accept",initiator:this.initiator,sid:this.sid});this.calledNumber&&""!==this.calledNumber&&((init=init.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),init.up()),this.localSDP.toJingle(init,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(init,(function(){$(document).trigger("ack.jingle",[_self5.sid,{source:"offer"}])}),(function(stanza){_self5.state="error",_self5.peerconnection&&(Strophe.log("","[Strophe.jingle] Clear peerconnection"),_self5.peerconnection.close(),_self5.peerconnection=null);var error=$(stanza).find("error").length?{code:$(stanza).find("error").attr("code"),reason:$(stanza).find("error :first")[0].tagName}:{};error.source="offer",$(document).trigger("error.jingle",{sid:_self5.sid,error:error})}),this.jingleIqTimeout),sdp.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(sdp,(function(){$(document).trigger("setLocalDescription.jingle",[_self5.sid]),Strophe.log("","[Strophe.jingle] setLocalDescription success"),_self5.unifiedPlanActivated&&updateStreams&&_self5.updateRemoteStreams()}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}))}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.contentChangeAnswer failed: "+error)}},JingleSession.prototype.updateBandwidthRestriction=function(sdp,isConference,isMobile){var bandwidth=isConference||isMobile?500:1200;if("audio"===this.localType||isConference)return Strophe.log("","[Strophe.jingle] do not updateBandwidthRestriction"),sdp;"sharing"!==this.localType&&"sharing"!==this.remoteType||(bandwidth=isConference||isMobile?800:1500),"sharing+video"===this.localType&&(bandwidth=isMobile?1300:2700);var modifier="AS";if("firefox"===adapter.default.browserDetails.browser&&(bandwidth=1e3*(bandwidth>>>0),modifier="TIAS"),bandwidth>0)if(-1===sdp.indexOf("b="+modifier+":")){var indexOfVideo=sdp.indexOf("m=video");if(indexOfVideo>0){var videoDesc=sdp.substring(indexOfVideo);videoDesc=videoDesc.replace(/c=IN (.*)\r\n/,"c=IN $1\r\nb="+modifier+":"+bandwidth+"\r\n"),sdp=sdp.substring(0,indexOfVideo)+videoDesc}}else sdp=sdp.replace(new RegExp("b="+modifier+":.*\r\n"),"b="+modifier+":"+bandwidth+"\r\n");else sdp.replace(new RegExp("b="+modifier+":.*\r\n"),"");return Strophe.log("","[Strophe.jingle] updateBandwidthRestriction to ",bandwidth),sdp},JingleSession.prototype.setRemoteDescription=function(elem,desctype){Strophe.log("","[Strophe.jingle] setRemoteDescription ",desctype);var self=this;if(this.remoteSDP=new SDP(""),this.remoteSDP.fromJingle(elem),this.isInitiator?this.remoteSDP.raw=this.remoteSDP.raw.replace(/a=setup:passive/g,"a=setup:active"):this.remoteSDP.raw=this.remoteSDP.raw.replace(/a=setup:active/g,"a=setup:passive"),navigator.platform.toUpperCase().indexOf("MAC")>=0&&(this.remoteSDP.raw=this.forceCodecTo(this.remoteSDP.raw,"H264/90000","video")),-1!==this.conference_id||this.confId||this.publisherId)this.remoteSDP.raw=this.updateBandwidthRestriction(this.remoteSDP.raw,!0);else{var isMobile=!1;this.peerjid&&(isMobile=-1!==this.peerjid.indexOf("mobile_android")||-1!==this.peerjid.indexOf("mobile_ios")||-1!==this.peerjid.indexOf("deskphone")),this.remoteSDP.raw=this.updateBandwidthRestriction(this.remoteSDP.raw,!1,isMobile)}this.DTX&&(Strophe.log("","[Strophe.jingle] activate Discontinuous Transmission (DTX)"),this.remoteSDP.raw=this.remoteSDP.raw.replace("useinbandfec=1","useinbandfec=1;usedtx=1")),Strophe.log("","[Strophe.jingle] setRemoteDescription after parsing "+this.remoteSDP.raw);var remotedesc=new window.RTCSessionDescription({type:desctype,sdp:this.remoteSDP.raw});Strophe.log("","[Strophe.jingle] setRemoteDescription object ",remotedesc),this.peerconnection.setRemoteDescription(remotedesc,(function(){Strophe.log("","[Strophe.jingle] setRemoteDescription success"),self.unifiedPlanActivated&&(self.localTransceivers=self.peerconnection.getTransceivers())}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setRemoteDescription error "+e)})),Strophe.log("","[Strophe.jingle] setRemoteDescription is setting, try to update the RTP Sender "),this.ice_config.enableDSCP&&this.peerconnection.getSenders().forEach((function(rtpSender){if(console.error(rtpSender),rtpSender.getParameters&&rtpSender.setParameters){var params=rtpSender.getParameters();console.error(params),params.encodings.forEach((function(encoding){encoding.priority="high",encoding.networkPriority="high"})),rtpSender.setParameters(params),console.error(rtpSender.getParameters())}}))},JingleSession.prototype.addIceCandidate=function(elem){Strophe.log("","[Strophe.jingle] addIceCandidate");var self=this;elem.each((function(){var i,idx=-1;for(i=0;i<self.remoteSDP.media.length;i++)if(SDPUtil.find_line(self.remoteSDP.media[i],"a=mid:"+$(this).attr("name"))||0===self.remoteSDP.media[i].indexOf("m="+$(this).attr("name"))){idx=i;break}if(-1==idx)for(i=0;i<self.localSDP.media.length;i++)if(SDPUtil.find_line(self.localSDP.media[i],"a=mid:"+$(this).attr("name"))||0===self.localSDP.media[i].indexOf("m="+$(this).attr("name"))){idx=i;break}var ufrag,pwd,name=$(this).attr("name");$(this).find("content>transport").each((function(){ufrag=this.getAttribute("ufrag"),pwd=this.getAttribute("pwd")})),$(this).find("transport>candidate").each((function(){var line,candidate;line=SDPUtil.candidateFromJingle(this,ufrag,pwd),candidate=new window.RTCIceCandidate({sdpMLineIndex:idx,sdpMid:name,candidate:line});try{if(candidate&&self.iceFilterList&&self.iceFilterList.length&&-1!==self.iceFilterList.indexOf(candidate.type))return void Strophe.log("","[Strophe.jingle] Received ICE candidate "+candidate.type+" is filtered");self.peerconnection.addIceCandidate(candidate)}catch(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] addIceCandidate failed",e.toString(),line)}}))}))},JingleSession.prototype.sendAnswer=function(provisional,type){Strophe.log("","[Strophe.jingle] sendAnswer",provisional);var self=this;this.peerconnection.createAnswer((function(sdp){self.createdAnswer(sdp,provisional,type)}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] createAnswer failed",e)}),this.media_constraints)},JingleSession.prototype.createdAnswer=function(sdp,provisional,type){try{Strophe.log("","[Strophe.jingle] createdAnswer");var _self6=this;sdp=this.hackMsLabelSDP(sdp),this.localSDP=new SDP(sdp.sdp),this.usepranswer=!0===provisional;var action=type||"session-accept";type&&(_self6.isReconnecting=!1),Strophe.log("","sdp is "+sdp.sdp);var accept=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:action,initiator:this.initiator,responder:this.responder,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&((accept=accept.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),accept.up()),this.localSDP.toJingle(accept,this.initiator==this.me?"initiator":"responder",this.conference_id),this.connection.sendIQ(accept,(function(){$(document).trigger("ack.jingle",[_self6.sid,{source:"answer"}])}),(function(stanza){var error=$(stanza).find("error").length?{code:$(stanza).find("error").attr("code"),reason:$(stanza).find("error :first")[0].tagName}:{};error.source="answer",$(document).trigger("error.jingle",{sid:_self6.sid,error:error})}),this.jingleIqTimeout),sdp.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(sdp,(function(){$(document).trigger("setLocalDescription.jingle",[_self6.sid]),Strophe.log("","[Strophe.jingle] createdAnswer -- setLocalDescription success, try to update the RTP Sender "),_self6.ice_config.enableDSCP&&_self6.peerconnection.getSenders().forEach((function(rtpSender){if(rtpSender.getParameters&&rtpSender.setParameters){var params=rtpSender.getParameters();params.encodings.forEach((function(encoding){encoding.priority="high",encoding.networkPriority="high"})),rtpSender.setParameters(params),Strophe.log("","[Strophe.jingle] RTP Sender parameters are updated "+rtpSender.getParameters())}}))}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] setLocalDescription failed",e)}));for(var cands=SDPUtil.find_lines(this.localSDP.raw,"a=candidate:"),j=0;j<cands.length;j++){var cand=SDPUtil.parse_icecandidate(cands[j]);"srflx"==cand.type?this.hadstuncandidate=!0:"relay"==cand.type&&(this.hadturncandidate=!0)}}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.createdAnswer failed: "+error)}},JingleSession.prototype.sendTerminate=function(reason,text){try{var _self7=this,term=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-terminate",initiator:this.initiator,sid:this.sid}).c("reason").c(reason||"success");text&&term.up().c("text").t(text),this.connection.sendIQ(term,(function(){!_self7.peerconnection||"closed"===_self7.peerconnection.signalingState&&"undefined"!=_self7.peerconnection.signalingState||(_self7.peerconnection.close(),_self7.terminate()),Strophe.log("","[Strophe.jingle] Clear peerconnection"),_self7.peerconnection=null;$(document).trigger("ack.jingle",[_self7.sid,{source:"terminate"}])}),(function(stanza){var error=$(stanza).find("error").length?{code:$(stanza).find("error").attr("code"),reason:$(stanza).find("error :first")[0].tagName}:{};$(document).trigger("ack.jingle",[_self7.sid,error])}),this.jingleIqTimeout),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null)}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendTerminate failed: "+error)}},JingleSession.prototype.mediaModified=function(updateStreams){var self=this;this.peerconnection.createAnswer((function(sdp){self.contentChangeAnswer(sdp,updateStreams)}),(function(e){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] contentChange failed",e)}),this.media_constraints)},JingleSession.prototype.addSource=function(elem){Strophe.log("","[Strophe.jingle] addssrc",(new Date).getTime()),Strophe.log("","[Strophe.jingle] ice",this.peerconnection.iceConnectionState);var sdp=new SDP(this.peerconnection.remoteDescription.sdp),self=this;$(elem).each((function(idx,content){var name=$(content).attr("name"),lines="";tmp=$(content).find('>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),tmp.each((function(){var ssrc=$(this).attr("ssrc");$(this).find(">parameter").each((function(){lines+="a=ssrc:"+ssrc+" "+$(this).attr("name"),$(this).attr("value")&&$(this).attr("value").length&&(lines+=":"+$(this).attr("value")),lines+="\r\n"}))})),sdp.media.forEach((function(media,idx){SDPUtil.find_line(media,"a=mid:"+name)&&(sdp.media[idx]+=lines,self.addssrc[idx]||(self.addssrc[idx]=""),self.addssrc[idx]+=lines)})),sdp.raw=sdp.session+sdp.media.join("")})),this.modifySources()},JingleSession.prototype.removeSource=function(elem){Strophe.log("","[Strophe.jingle] removessrc",(new Date).getTime()),Strophe.log("","[Strophe.jingle] ice",this.peerconnection.iceConnectionState);var sdp=new SDP(this.peerconnection.remoteDescription.sdp),self=this;$(elem).each((function(idx,content){var name=$(content).attr("name"),lines="";tmp=$(content).find('>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),tmp.each((function(){var ssrc=$(this).attr("ssrc");$(this).find(">parameter").each((function(){lines+="a=ssrc:"+ssrc+" "+$(this).attr("name"),$(this).attr("value")&&$(this).attr("value").length&&(lines+=":"+$(this).attr("value")),lines+="\r\n"}))})),sdp.media.forEach((function(media,idx){SDPUtil.find_line(media,"a=mid:"+name)&&(sdp.media[idx]+=lines,self.addssrc[idx]||(self.removessrc[idx]=""),self.removessrc[idx]+=lines)})),sdp.raw=sdp.session+sdp.media.join("")})),this.modifySources()},JingleSession.prototype.modifySources=function(){var self=this;if(this.peerconnection&&"closed"!=this.peerconnection.signalingState&&(this.addssrc.length||this.removessrc.length||null!==this.pendingop)){if(!this.wait&&("stable"!=this.peerconnection.signalingState||"connected"!=this.peerconnection.iceConnectionState&&"completed"!=this.peerconnection.iceConnectionState))return console.warn("[Strophe.jingle] modifySources not yet",this.peerconnection.signalingState,this.peerconnection.iceConnectionState),this.wait=!0,void window.setTimeout((function(){self.modifySources()}),1500);if(this.wait)return window.setTimeout((function(){self.modifySources()}),2500),void(this.wait=!1);var sdp=new SDP(this.peerconnection.remoteDescription.sdp);this.addssrc.forEach((function(lines,idx){sdp.media[idx]+=lines})),this.addssrc=[],this.removessrc.forEach((function(lines,idx){(lines=lines.split("\r\n")).pop(),lines.forEach((function(line){sdp.media[idx]=sdp.media[idx].replace(line+"\r\n","")}))})),this.removessrc=[],sdp.raw=sdp.session+sdp.media.join(""),this.peerconnection.setRemoteDescription(new window.RTCSessionDescription({type:"offer",sdp:sdp.raw}),(function(){self.peerconnection.createAnswer((function(modifiedAnswer){if(null!==self.pendingop){var _sdp=new SDP(modifiedAnswer.sdp);if(_sdp.media.length>1){switch(self.pendingop){case"mute":_sdp.media[1]=_sdp.media[1].replace("a=sendrecv","a=recvonly");break;case"unmute":_sdp.media[1]=_sdp.media[1].replace("a=recvonly","a=sendrecv")}_sdp.raw=_sdp.session+_sdp.media.join(""),modifiedAnswer.sdp=_sdp.raw}self.pendingop=null}self.peerconnection.setLocalDescription(modifiedAnswer,(function(){$(document).trigger("setLocalDescription.jingle",[self.sid])}),(function(error){Strophe.log("","[Strophe.jingle] modified setLocalDescription failed")}))}),(function(error){Strophe.log("","[Strophe.jingle] modified answer failed")}))}),(function(error){Strophe.log("","[Strophe.jingle] modify failed")}))}},JingleSession.prototype.hardMuteVideo=function(muted){this.connection.jingle.localStream&&(this.pendingop=muted?"mute":"unmute",this.modifySources(),this.connection.jingle.localStream.getVideoTracks().forEach((function(track){track.enabled=!muted})))},JingleSession.prototype.mute=function(muted){this.connection.jingle.localStream&&(this.pendingop=muted?"mute":"unmute",this.modifySources(),this.connection.jingle.localStream.getVideoTracks().forEach((function(track){track.enabled=!muted})),this.connection.jingle.localStream.getAudioTracks().forEach((function(track){track.enabled=!muted})))},JingleSession.prototype.muteVideo=function(muted){this.connection.jingle.localStream&&(this.pendingop=muted?"mute":"unmute",this.modifySources(),this.connection.jingle.localStream.getVideoTracks().forEach((function(track){track.enabled=!muted})))},JingleSession.prototype.muteAudio=function(muted){this.connection.jingle.localStream&&this.connection.jingle.localStream.getAudioTracks().forEach((function(track){track.enabled=!muted})),this.localStreams.length>=1&&this.localStreams.forEach((function(stream){stream.getAudioTracks().forEach((function(track){track.enabled=!muted}))}))},JingleSession.prototype.sendMute=function(muted,content){try{var info=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});info.c(muted?"mute":"unmute",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),info.attrs({creator:this.me==this.initiator?"creator":"responder"}),content&&info.attrs({name:content}),this.connection.sendIQ(info)}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendMute failed: "+error)}},JingleSession.prototype.sendHold=function(hold){try{var info=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});info.c(hold?"hold":"unhold",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(info)}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendMute failed: "+error)}},JingleSession.prototype.sendIceFailed=function(){try{var info=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});info.c("iceFailed",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(info)}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendIceFailed failed: "+error)}},JingleSession.prototype.sendRinging=function(){try{var info=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});info.c("ringing",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(info)}catch(error){Strophe.log(Strophe.LogLevel.ERROR,"[Strophe.jingle] JingleSession.prototype.sendRinging failed: "+error)}},JingleSession.prototype.forceCodecTo=function(sdp,codecToForce,media){for(var from,to,codecName,indexFound,j,splittedSDP=sdp.split("\r\n"),indexVideo=-1,indexPos=-1,codec=[],list=[],i=0,l=splittedSDP.length;i<l;i++){var line=splittedSDP[i];if(line.indexOf("m="+media)>-1&&(indexVideo=i,indexPos=line.indexOf("RTP/SAVPF")+10,list=line.substring(indexPos).split(" ")),line.indexOf(codecToForce)>-1){for(from=line.indexOf(":"),to=line.indexOf(" "),codecName=line.substring(from+1,to),indexFound=-1,codec.push(codecName),j=0;j<list.length;j++)if(list[j]===codecName){indexFound=j;break}indexFound>-1&&list.splice(indexFound,1)}if("PCMU/8000"===codecToForce&&line.indexOf("PCMA/8000")>-1){for(from=line.indexOf(":"),to=line.indexOf(" "),codecName=line.substring(from+1,to),indexFound=-1,codec.push(codecName),j=0;j<list.length;j++)if(list[j]===codecName){indexFound=j;break}indexFound>-1&&list.splice(indexFound,1)}}if(-1!==indexVideo){splittedSDP[indexVideo]=splittedSDP[indexVideo].substr(0,indexPos-1);for(var k=0;k<codec.length;k++)splittedSDP[indexVideo]+=" "+codec[k];list.length>0&&(splittedSDP[indexVideo]+=" "+list.join(" ")),sdp=splittedSDP.join("\r\n")}return sdp},JingleSession.prototype.mungeSdpForSimulcasting=function(sdp){for(var lines=sdp.split("\r\n"),video=!1,ssrc=[-1],ssrc_fid=[-1],cname=null,msid=null,mslabel=null,label=null,insertAt=-1,i=0;i<lines.length;i++)if(mline=lines[i].match(/m=(\w+) */)){if("video"===mline[1]){if(!(ssrc[0]<0)){insertAt=i;break}video=!0}else if(ssrc[0]>-1){insertAt=i;break}}else if(video){var fid=lines[i].match(/a=ssrc-group:FID (\d+) (\d+)/);if(fid)ssrc[0]=fid[1],ssrc_fid[0]=fid[2],lines.splice(i,1),i--;else{if(ssrc[0]){if((match=lines[i].match("a=ssrc:"+ssrc[0]+" cname:(.+)"))&&(cname=match[1]),(match=lines[i].match("a=ssrc:"+ssrc[0]+" msid:(.+)"))&&(msid=match[1]),(match=lines[i].match("a=ssrc:"+ssrc[0]+" mslabel:(.+)"))&&(mslabel=match[1]),(match=lines[i].match("a=ssrc:"+ssrc[0]+" label:(.+)"))&&(label=match[1]),0===lines[i].indexOf("a=ssrc:"+ssrc_fid[0])){lines.splice(i,1),i--;continue}if(0===lines[i].indexOf("a=ssrc:"+ssrc[0])){lines.splice(i,1),i--;continue}}0!=lines[i].length||(lines.splice(i,1),i--)}}if(ssrc[0]<0)for(insertAt=-1,video=!1,i=0;i<lines.length;i++){var mline;if(mline=lines[i].match(/m=(\w+) */)){if("video"===mline[1]){if(!(ssrc[0]<0)){insertAt=i;break}video=!0}else if(ssrc[0]>-1){insertAt=i;break}}else if(video){if(ssrc[0]<0){var value=lines[i].match(/a=ssrc:(\d+)/);if(value){ssrc[0]=value[1],lines.splice(i,1),i--;continue}}else{var match;if((match=lines[i].match("a=ssrc:"+ssrc[0]+" cname:(.+)"))&&(cname=match[1]),(match=lines[i].match("a=ssrc:"+ssrc[0]+" msid:(.+)"))&&(msid=match[1]),(match=lines[i].match("a=ssrc:"+ssrc[0]+" mslabel:(.+)"))&&(mslabel=match[1]),(match=lines[i].match("a=ssrc:"+ssrc[0]+" label:(.+)"))&&(label=match[1]),0===lines[i].indexOf("a=ssrc:"+ssrc_fid[0])){lines.splice(i,1),i--;continue}if(0===lines[i].indexOf("a=ssrc:"+ssrc[0])){lines.splice(i,1),i--;continue}}0!=lines[i].length||(lines.splice(i,1),i--)}}if(ssrc[0]<0)return Janus.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),sdp;for(insertAt<0&&(insertAt=lines.length),ssrc[1]=Math.floor(4294967295*Math.random()),ssrc[2]=Math.floor(4294967295*Math.random()),ssrc_fid[1]=Math.floor(4294967295*Math.random()),ssrc_fid[2]=Math.floor(4294967295*Math.random()),i=0;i<ssrc.length;i++)cname&&(lines.splice(insertAt,0,"a=ssrc:"+ssrc[i]+" cname:"+cname),insertAt++),msid&&(lines.splice(insertAt,0,"a=ssrc:"+ssrc[i]+" msid:"+msid),insertAt++),mslabel&&(lines.splice(insertAt,0,"a=ssrc:"+ssrc[i]+" mslabel:"+mslabel),insertAt++),label&&(lines.splice(insertAt,0,"a=ssrc:"+ssrc[i]+" label:"+label),insertAt++),cname&&(lines.splice(insertAt,0,"a=ssrc:"+ssrc_fid[i]+" cname:"+cname),insertAt++),msid&&(lines.splice(insertAt,0,"a=ssrc:"+ssrc_fid[i]+" msid:"+msid),insertAt++),mslabel&&(lines.splice(insertAt,0,"a=ssrc:"+ssrc_fid[i]+" mslabel:"+mslabel),insertAt++),label&&(lines.splice(insertAt,0,"a=ssrc:"+ssrc_fid[i]+" label:"+label),insertAt++);return lines.splice(insertAt,0,"a=ssrc-group:FID "+ssrc[2]+" "+ssrc_fid[2]),lines.splice(insertAt,0,"a=ssrc-group:FID "+ssrc[1]+" "+ssrc_fid[1]),lines.splice(insertAt,0,"a=ssrc-group:FID "+ssrc[0]+" "+ssrc_fid[0]),lines.splice(insertAt,0,"a=ssrc-group:SIM "+ssrc[0]+" "+ssrc[1]+" "+ssrc[2]),(sdp=lines.join("\r\n")).endsWith("\r\n")||(sdp+="\r\n"),sdp},JingleSession.prototype.getStats=function(interval){var self=this,recv={audio:0,video:0},lost={audio:0,video:0},lastrecv={audio:0,video:0},lastlost={audio:0,video:0},bytesSent={audio:0,video:0},bytesReceived={audio:0,video:0},sec=interval/1e3,isFirstTime=!0,lastNumberPacketsLostAudio=0,lastNumberPacketsReceivedAudio=0,iteration=0,globalMOS=0,globalRTT=0,globalJitter=0,globalJitterDepth=0,maxRTT=0,maxJitter=0,maxJitterDepth=0,candidatePair="",newStat={bitrate:{}},networkType="",localCandidateIp="";return this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),this.ice_config.debugWebRTC&&(interval=1e3),this.statsinterval=window.setInterval((function(){self&&self.peerconnection?navigator.mozGetUserMedia?self.peerconnection.getStats().then((function(res){var items=[];res.forEach((function(result){items.push(result)})),function(items){$(document).trigger("statsFirefox.jingle",[self.sid,items]);for(var localCandidateId,remoteCandidateId,data=new Object,audioKBReceived=0,videoKBReceived=0,stats=[],i=0;i<items.length;++i){if("audio"==items[i].mediaType&&items[i].bytesReceived){bytesReceived.audio||(bytesReceived.audio=items[i].bytesReceived);var bytes=items[i].bytesReceived-bytesReceived.audio;bytesReceived.audio=items[i].bytesReceived,audioKBReceived=8*bytes/(1024*sec),data.audioReceived={bytesReceived:bytesReceived.audio,packetsLost:items[i].packetsLost,packetsReceived:items[i].packetsReceived}}else"audio"==items[i].mediaType&&items[i].bytesSent?data.audioSent={bytesSent:items[i].bytesSent,packetsSent:items[i].packetsSent}:"video"==items[i].mediaType&&items[i].bytesReceived?(bytesReceived.video||(bytesReceived.video=items[i].bytesReceived),bytes=items[i].bytesReceived-bytesReceived.video,bytesReceived.video=items[i].bytesReceived,videoKBReceived=bytes?8*bytes/(1024*sec):0,data.videoReceived={bytesReceived:bytesReceived.video,packetsLost:items[i].packetsLost,packetsReceived:items[i].packetsReceived}):"video"==items[i].mediaType&&items[i].bytesSent&&(data.videoSent={bytesSent:items[i].bytesSent,packetsSent:items[i].packetsSent});"candidate-pair"===items[i].type&&"succeeded"===items[i].state&&!0===items[i].selected&&(localCandidateId=items[i].localCandidateId,remoteCandidateId=items[i].remoteCandidateId),isFirstTime&&"localcandidate"===items[i].type&&items[i].id===localCandidateId&&(data.connectionType||(data.connectionType={}),data.connectionType.local={candidateType:items[i].candidateType,ipAddress:items[i].ipAddress+":"+items[i].portNumber,transport:items[i].transport}),isFirstTime&&"remotecandidate"===items[i].type&&items[i].id===remoteCandidateId&&(data.connectionType||(data.connectionType={}),data.connectionType.remote={candidateType:items[i].candidateType,ipAddress:items[i].ipAddress+":"+items[i].portNumber}),("candidate-pair"!==items[i].type||items[i].selected)&&("local-candidate"===items[i].type&&items[i].id!==localCandidateId||"remote-candidate"===items[i].type&&items[i].id!==remoteCandidateId||stats.push(items[i]));var _res=items[i],inStats=!1;if(("video"===_res.mediaType||_res.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===_res.type&&_res.id.indexOf("rtcp")<0?inStats=!0:"ssrc"!=_res.type||!_res.bytesReceived||"VP8"!==_res.googCodecName&&""!==_res.googCodecName||(inStats=!0),inStats)if(newStat.bitrate.bsnow=_res.bytesReceived,newStat.bitrate.tsnow=_res.timestamp,void 0===newStat.bitrate.bsbefore||void 0===newStat.bitrate.tsbefore)newStat.bitrate.bsbefore=newStat.bitrate.bsnow,newStat.bitrate.tsbefore=newStat.bitrate.tsnow;else{var timePassed=newStat.bitrate.tsnow-newStat.bitrate.tsbefore;"safari"==adapter.default.browserDetails.browser&&(timePassed/=1e3);var bitRate=Math.round(8*(newStat.bitrate.bsnow-newStat.bitrate.bsbefore)/timePassed);"safari"===adapter.default.browserDetails.browser&&(bitRate=parseInt(bitRate/1e3)),newStat.bitrate.value=bitRate+" kbits/sec",newStat.bitrate.bsbefore=newStat.bitrate.bsnow,newStat.bitrate.tsbefore=newStat.bitrate.tsnow,$(document).trigger("webrtcSessionBitRate.jingle",[self.sid,newStat.bitrate])}}data.availableIncomingAudioBandwidth=audioKBReceived,data.availableIncomingVideoBandwidth=videoKBReceived,data.connectionType&&(isFirstTime=!1,$(document).trigger("webrtcConnectionType.jingle",[self.sid,data.connectionType])),$(document).trigger("webrtcFirefoxStats.jingle",[self.sid,data])}(items)})):self.peerconnection.getStats?self.peerconnection.getStats((function(res){var items=[];res.result().forEach((function(result){var item={};result.names().forEach((function(name){item[name]=result.stat(name)})),item.id=result.id,item.type=result.type,item.timestamp=result.timestamp,items.push(item)})),function(items){$(document).trigger("statsChrome.jingle",[self.sid,items]);for(var d,R,MOS,packetsAudioSent=0,packetsVideoSent=0,packetsAudioReceived=0,packetsVideoReceived=0,packetsAudioReveicedLost=0,packetsVideoReveicedLost=0,data=new Object,stats=[],audioInputLevel=0,audioOutputLevel=0,googRTTAudio=0,googJitterBufferMsAudio=0,googJitterReceived=0,mosPacketsReceivedAudio=0,mosPacketsLostAudio=0,Rx=0,Ry=0,currentDelay=0,E_Ipl=0,flagSendAudio=!1,flagSendVideo=!1,flagRecvAudio=!1,flagRecvVideo=!1,i=items.length-1;i>=0;i--){if("ssrc"==items[i].type)if(-1!==items[i].id.indexOf("send"))if("opus"!==items[i].googCodecName&&"PCMA"!==items[i].googCodecName&&"PCMU"!==items[i].googCodecName||flagSendAudio)"VP8"!=items[i].googCodecName||flagSendVideo||(flagSendVideo=!0,packetsVideoSent=items[i].packetsSent,items[i].packetsLost,items[i].googFrameRateSent&&items[i].googFrameRateSent,bytesSent.video||(bytesSent.video=items[i].bytesSent),items[i].googRtt&&!googRTTAudio&&(googRTTAudio=parseInt(items[i].googRtt,10)),bytes=items[i].bytesSent-bytesSent.video,bytesSent.video=items[i].bytesSent,8*bytes/(1024*sec));else{flagSendAudio=!0,packetsAudioSent=items[i].packetsSent,items[i].packetsLost,audioInputLevel=items[i].audioInputLevel,items[i].googRtt&&!googRTTAudio&&(googRTTAudio=parseInt(items[i].googRtt,10)),bytesSent.audio||(bytesSent.audio=items[i].bytesSent);var bytes=items[i].bytesSent-bytesSent.audio;bytesSent.audio=items[i].bytesSent,8*bytes/(1024*sec)}else if("opus"!==items[i].googCodecName&&"PCMA"!==items[i].googCodecName||flagRecvAudio)"VP8"!=items[i].googCodecName||flagRecvVideo||(flagRecvVideo=!0,packetsVideoReceived=items[i].packetsReceived,packetsVideoReveicedLost+=items[i].packetsLost,items[i].googFrameRateReceived&&items[i].googFrameRateReceived,lastlost.video=lost.video,lastrecv.video=recv.video,recv.video=parseInt(packetsVideoReceived,10),lost.video=parseInt(packetsVideoReveicedLost,10),bytesReceived.video||(bytesReceived.video=items[i].bytesReceived),bytes=items[i].bytesReceived-bytesReceived.video,bytesReceived.video=items[i].bytesReceived,8*bytes/(1024*sec));else{flagRecvAudio=!0,packetsAudioReceived=items[i].packetsReceived,packetsAudioReveicedLost+=items[i].packetsLost,audioOutputLevel=items[i].audioOutputLevel,lastlost.audio=lost.audio,lastrecv.audio=recv.audio,recv.audio=parseInt(packetsAudioReceived,10),lost.audio=parseInt(packetsAudioReveicedLost,10),googJitterBufferMsAudio=parseInt(items[i].googJitterBufferMs,10),googJitterReceived=parseInt(items[i].googJitterReceived,10),mosPacketsReceivedAudio=parseInt(items[i].packetsReceived,10)-lastNumberPacketsReceivedAudio,lastNumberPacketsReceivedAudio=parseInt(items[i].packetsReceived,10),mosPacketsReceivedAudio<0&&(mosPacketsReceivedAudio=0),mosPacketsLostAudio=parseInt(items[i].packetsLost,10)-lastNumberPacketsLostAudio,lastNumberPacketsLostAudio=parseInt(items[i].packetsLost,10),mosPacketsLostAudio<0&&(mosPacketsLostAudio=0),E_Ipl=mosPacketsLostAudio/(50*sec)*100,currentDelay=items[i].googCurrentDelayMs,bytesReceived.audio||(bytesReceived.audio=items[i].bytesReceived);bytes=items[i].bytesReceived-bytesReceived.audio;bytesReceived.audio=items[i].bytesReceived,8*bytes/(1024*sec)}"googCandidatePair"==items[i].type&&"true"===items[i].googWritable&&isFirstTime&&(data.localCandidateType=items[i].googLocalCandidateType,data.localAddress=items[i].googLocalAddress,data.localTransportType=items[i].googTransportType,data.remoteCandidateType=items[i].googRemoteCandidateType,data.remoteAddress=items[i].googRemoteAddress,localCandidateIp=items[i].googLocalAddress.split(":")[0],items[i].googRemoteAddress.split(":")[0],candidatePair=data.localAddress+" [ "+data.localCandidateType+" ] <-> "+data.remoteAddress+" [ "+data.remoteCandidateType+" ] || "+data.localTransportType),"localcandidate"===items[i].type&&items[i].ipAddress===localCandidateIp&&(data.networkType=items[i].networkType,networkType=data.networkType),"googCandidatePair"===items[i].type&&"0"===items[i].requestsReceived||"remotecandidate"===items[i].type||"localcandidate"===items[i].type||"googCertificate"===items[i].type||"googComponent"===items[i].type||"googTrack"===items[i].type||"googLibjingleSession"===items[i].type||"VideoBwe"===items[i].type||stats.push(items[i]);var _res2=items[i],inStats=!1;if(("video"===_res2.mediaType||_res2.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===_res2.type&&_res2.id.indexOf("rtcp")<0?inStats=!0:"ssrc"!=_res2.type||!_res2.bytesReceived||"VP8"!==_res2.googCodecName&&""!==_res2.googCodecName||(inStats=!0),inStats)if(newStat.bitrate.bsnow=_res2.bytesReceived,newStat.bitrate.tsnow=_res2.timestamp,void 0===newStat.bitrate.bsbefore||void 0===newStat.bitrate.tsbefore)newStat.bitrate.bsbefore=newStat.bitrate.bsnow,newStat.bitrate.tsbefore=newStat.bitrate.tsnow;else{var timePassed=newStat.bitrate.tsnow-newStat.bitrate.tsbefore;"safari"==adapter.default.browserDetails.browser&&(timePassed/=1e3);var bitRate=Math.round(8*(newStat.bitrate.bsnow-newStat.bitrate.bsbefore)/timePassed);"safari"===adapter.default.browserDetails.browser&&(bitRate=parseInt(bitRate/1e3)),newStat.bitrate.value=bitRate+" kbits/sec",newStat.bitrate.bsbefore=newStat.bitrate.bsnow,newStat.bitrate.tsbefore=newStat.bitrate.tsnow,$(document).trigger("webrtcSessionBitRate.jingle",[self.sid,newStat.bitrate])}}mosPacketsReceivedAudio&&(Ry=.18*(Rx=93.2-E_Ipl)*Rx-27.9*Rx+1126.62),MOS=(R=Ry-(.024*(d=currentDelay)+.11*(d-177.3)*(d-177.3<0?0:1)))<0?1:R>100?4.5:1+.035*R+R*(R-60)*(100-R)*7*1e-6;var currentFlag=0;R>=80?currentFlag=2:R<80&&R>=60&&(currentFlag=1),data.googRTTAudio=googRTTAudio,data.googJitterBufferMsAudio=googJitterBufferMsAudio,data.googJitterReceived=googJitterReceived,data.mosPacketsReceivedAudio=mosPacketsReceivedAudio,data.mosPacketsLostAudio=mosPacketsLostAudio,data.MOS=MOS,data.candidatePair=candidatePair,MOS&&(iteration+=1,globalMOS+=MOS,globalRTT+=googRTTAudio,globalJitter+=googJitterReceived,globalJitterDepth+=googJitterBufferMsAudio,data.iteration=iteration,data.currentDelay=d,data.MOS=MOS,data.networkQualityFlag=currentFlag,data.meanMOS=globalMOS/iteration,maxRTT=maxRTT<googRTTAudio?googRTTAudio:maxRTT,maxJitter=maxJitter<googJitterReceived?googJitterReceived:maxJitter,maxJitterDepth=maxJitterDepth<googJitterBufferMsAudio?googJitterBufferMsAudio:maxJitterDepth),data.packetsAudioSent=parseInt(packetsAudioSent,10),data.packetsAudioReceived=parseInt(packetsAudioReceived,10),data.audioInputLevel=parseInt(audioInputLevel,10),data.audioOutputLevel=parseInt(audioOutputLevel,10),data.packetsVideoSent=parseInt(packetsVideoSent,10),data.packetsVideoReceived=parseInt(packetsVideoReceived,10),data.bytesSent=bytesSent,data.bytesReceived=bytesReceived,data.localCandidateType&&(isFirstTime=!1,$(document).trigger("webrtcConnectionType.jingle",[self.sid,data])),stats.RainMetrics={type:"mscore",meanRTT:globalRTT/iteration,maxRTT:maxRTT,meanJitter:globalJitter/iteration,maxJitter:maxJitter,meanJitterDepth:globalJitterDepth/iteration,maxJitterDepth:maxJitterDepth,candidatePair:data.candidatePair,networkType:networkType,meanMOS:data.meanMOS},$(document).trigger("webrtcSessionStats.jingle",[self.sid,stats]),$(document).trigger("webrtcSessionStatsSimplyfied.jingle",[self.sid,data]),data&&Strophe.log("","[Strophe.jingle] webrtcChromeStats audio packets received : "+data.packetsAudioReceived+" / audio packets sent : "+data.packetsAudioSent+" / for session "+self.sid)}(items)})):Strophe.log("","[Strophe.jingle] getStats does not exist..."):Strophe.log("","[Strophe.jingle] getStats no peerconnection")}),interval||1e3),this.statsinterval}},function(module,exports){Strophe.addConnectionPlugin("mam",{_c:null,_p:["with","start","end"],init:function(conn){this._c=conn,Strophe.addNamespace("MAM","urn:xmpp:mam:1")},query:function(jid,options){var _p=this._p,attr={type:"set",id:jid},mamAttr={xmlns:Strophe.NS.MAM};options.queryid&&(mamAttr.queryid=options.queryid,delete options.queryid);var i,iq=$iq(attr).c("query",mamAttr).c("x",{xmlns:"jabber:x:data",type:"submit"});for(iq.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up(),i=0;i<this._p.length;i++){var pn=_p[i],p=options[pn];delete options[pn],p&&iq.c("field",{var:pn}).c("value").t(p).up().up()}iq.up(),delete options.onMessage;var onComplete=options.onComplete;return delete options.onComplete,iq.cnode(new Strophe.RSM(options).toXML()),this._c.sendIQ(iq,onComplete)},querymuc:function(jid,to,options){var _p=this._p,attr={to:to,type:"set",id:jid},mamAttr={xmlns:Strophe.NS.MAM};options.queryid&&(mamAttr.queryid=options.queryid,delete options.queryid);var i,iq=$iq(attr).c("query",mamAttr).c("x",{xmlns:"jabber:x:data",type:"submit"});for(iq.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up(),i=0;i<this._p.length;i++){var pn=_p[i],p=options[pn];delete options[pn],p&&iq.c("field",{var:pn}).c("value").t(p).up().up()}iq.up();var onComplete=options.onComplete;return delete options.onComplete,iq.cnode(new Strophe.RSM(options).toXML()),this._c.sendIQ(iq,onComplete)},delete:function(queryId,options){var _p=this._p,attr={type:"set",id:queryId},mamAttr={xmlns:Strophe.NS.MAM};options.queryid&&(mamAttr.queryid=options.queryid,delete options.queryid);var i,iq=$iq(attr).c("delete",mamAttr).c("x",{xmlns:"jabber:x:data",type:"submit"});for(iq.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up(),i=0;i<this._p.length;i++){var attribKey=_p[i],attribValue=options[attribKey];attribValue&&iq.c("field",{var:attribKey}).c("value").t(attribValue).up().up()}iq.up(),delete options.onMessage;var onComplete=options.onComplete;return delete options.onComplete,iq.cnode(new Strophe.RSM(options).toXML()),this._c.sendIQ(iq,onComplete)}})},function(module,exports){Strophe.addConnectionPlugin("calllog",{_c:null,_p:["with"],init:function(conn){this._c=conn,Strophe.addNamespace("CALLLOG","jabber:iq:telephony:call:log")},query:function(jid,options){var i,_p=this._p,attr={type:"set",id:130,from:jid},mamAttr={xmlns:Strophe.NS.CALLLOG},iq=$iq(attr).c("query",mamAttr).c("x",{xmlns:"jabber:x:data",type:"submit"});for(iq.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("jabber:iq:telephony:call:log").up().up(),i=0;i<this._p.length;i++){var pn=_p[i],p=options[pn];delete options[pn],p&&iq.c("field",{var:pn}).c("value").t(p).up().up()}iq.up(),options.onMessage,delete options.onMessage;var onComplete=options.onComplete;return delete options.onComplete,iq.cnode(new Strophe.RSM(options).toXML()),this._c.sendIQ(iq,onComplete)}})},function(module,exports){!function(){function noop(){}function inVals(stanza,ns){var ok=!1;return $('si feature x field[var="stream-method"] value',stanza).each((function(i,m){$(m).text()===ns&&(ok=!0)})),ok}Strophe.addConnectionPlugin("si_filetransfer",{_c:null,_cb:null,init:function(c){this._c=c,Strophe.addNamespace("SI","http://jabber.org/protocol/si"),Strophe.addNamespace("SI_FILE_TRANSFER",Strophe.NS.SI+"/profile/file-transfer"),Strophe.addNamespace("FEATURE_NEG","http://jabber.org/protocol/feature-neg"),c.addHandler(this._receive.bind(this),Strophe.NS.SI,"iq","set")},_receive:function(m){var $m=$(m),from=$m.attr("from"),id=$m.attr("id"),sid=$("si",$m).attr("id");if(Object.hasOwnProperty.call(this._c,"ibb")&&inVals(m,Strophe.NS.IBB))var $file=$("file",$m);var filename=$file.attr("name"),size=$file.attr("size"),mime=$("si",$m).attr("mime-type"),desc=$("desc",$m).text();return"function"==typeof this._cb&&this._cb(from,sid,filename,size,mime,id,desc),!0},_success:function(cb,stanza){var err;inVals(stanza,Strophe.NS.IBB)||(err=new Error("In-Band Bytestream not supported")),cb(err)},_fail:function(cb,stanza){var err="timed out";stanza&&(err=stanza),cb(new Error(err))},_send:function(iq,success,fail){this._c.sendIQ(iq,success,fail,18e4)},send:function(to,sid,filename,size,mime,description,cb){if(Object.hasOwnProperty.call(this._c,"ibb")){var iq=$iq({type:"set",to:to,id:this._c.getUniqueId("si-filetransfer")}).c("si",{xmlns:Strophe.NS.SI,id:sid,profile:Strophe.NS.SI_FILE_TRANSFER,"mime-type":mime}).c("file",{xmlns:Strophe.NS.SI_FILE_TRANSFER,name:filename,size:size}).c("desc").t(description).up().c("feature",{xmlns:Strophe.NS.FEATURE_NEG}).c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"stream-method",type:"list-single"}).c("option").c("value").t(Strophe.NS.IBB);this._send(iq,this._success.bind(this,cb),this._fail.bind(this,cb))}else Strophe.warn("The In-Band Bytestream plugin is required.")},responseOk:function(to,sid,id){var iq=$iq({type:"result",to:to,id:id}).c("si",{xmlns:Strophe.NS.SI,id:sid}).c("file",{xmlns:Strophe.NS.SI_FILE_TRANSFER}).up().c("feature",{xmlns:Strophe.NS.FEATURE_NEG}).c("x",{xmlns:"jabber:x:data",type:"submit"}).c("field",{var:"stream-method"});iq.c("value").t(Strophe.NS.IBB),this._send(iq,noop,noop)},responseError:function(to,sid,id,errorCode){var iq=$iq({type:"error",to:to,id:id}).c("error",{code:errorCode,type:"cancel"}).c("forbidden",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});iq.c("value").t(Strophe.NS.IBB),this._send(iq,noop,noop)},addFileHandler:function(fn){this._cb=fn}})}()},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var chrome_shim_namespaceObject={};__webpack_require__.r(chrome_shim_namespaceObject),__webpack_require__.d(chrome_shim_namespaceObject,"shimGetUserMedia",(function(){return shimGetUserMedia})),__webpack_require__.d(chrome_shim_namespaceObject,"shimGetDisplayMedia",(function(){return shimGetDisplayMedia})),__webpack_require__.d(chrome_shim_namespaceObject,"shimMediaStream",(function(){return shimMediaStream})),__webpack_require__.d(chrome_shim_namespaceObject,"shimOnTrack",(function(){return shimOnTrack})),__webpack_require__.d(chrome_shim_namespaceObject,"shimGetSendersWithDtmf",(function(){return shimGetSendersWithDtmf})),__webpack_require__.d(chrome_shim_namespaceObject,"shimGetStats",(function(){return shimGetStats})),__webpack_require__.d(chrome_shim_namespaceObject,"shimSenderReceiverGetStats",(function(){return shimSenderReceiverGetStats})),__webpack_require__.d(chrome_shim_namespaceObject,"shimAddTrackRemoveTrackWithNative",(function(){return shimAddTrackRemoveTrackWithNative})),__webpack_require__.d(chrome_shim_namespaceObject,"shimAddTrackRemoveTrack",(function(){return shimAddTrackRemoveTrack})),__webpack_require__.d(chrome_shim_namespaceObject,"shimPeerConnection",(function(){return shimPeerConnection})),__webpack_require__.d(chrome_shim_namespaceObject,"fixNegotiationNeeded",(function(){return fixNegotiationNeeded}));var edge_shim_namespaceObject={};__webpack_require__.r(edge_shim_namespaceObject),__webpack_require__.d(edge_shim_namespaceObject,"shimGetUserMedia",(function(){return getusermedia_shimGetUserMedia})),__webpack_require__.d(edge_shim_namespaceObject,"shimGetDisplayMedia",(function(){return getdisplaymedia_shimGetDisplayMedia})),__webpack_require__.d(edge_shim_namespaceObject,"shimPeerConnection",(function(){return edge_shim_shimPeerConnection})),__webpack_require__.d(edge_shim_namespaceObject,"shimReplaceTrack",(function(){return shimReplaceTrack}));var firefox_shim_namespaceObject={};__webpack_require__.r(firefox_shim_namespaceObject),__webpack_require__.d(firefox_shim_namespaceObject,"shimGetUserMedia",(function(){return firefox_getusermedia_shimGetUserMedia})),__webpack_require__.d(firefox_shim_namespaceObject,"shimGetDisplayMedia",(function(){return firefox_getdisplaymedia_shimGetDisplayMedia})),__webpack_require__.d(firefox_shim_namespaceObject,"shimOnTrack",(function(){return firefox_shim_shimOnTrack})),__webpack_require__.d(firefox_shim_namespaceObject,"shimPeerConnection",(function(){return firefox_shim_shimPeerConnection})),__webpack_require__.d(firefox_shim_namespaceObject,"shimSenderGetStats",(function(){return shimSenderGetStats})),__webpack_require__.d(firefox_shim_namespaceObject,"shimReceiverGetStats",(function(){return shimReceiverGetStats})),__webpack_require__.d(firefox_shim_namespaceObject,"shimRemoveStream",(function(){return shimRemoveStream})),__webpack_require__.d(firefox_shim_namespaceObject,"shimRTCDataChannel",(function(){return shimRTCDataChannel})),__webpack_require__.d(firefox_shim_namespaceObject,"shimAddTransceiver",(function(){return shimAddTransceiver})),__webpack_require__.d(firefox_shim_namespaceObject,"shimCreateOffer",(function(){return shimCreateOffer})),__webpack_require__.d(firefox_shim_namespaceObject,"shimCreateAnswer",(function(){return shimCreateAnswer}));var safari_shim_namespaceObject={};__webpack_require__.r(safari_shim_namespaceObject),__webpack_require__.d(safari_shim_namespaceObject,"shimLocalStreamsAPI",(function(){return shimLocalStreamsAPI})),__webpack_require__.d(safari_shim_namespaceObject,"shimRemoteStreamsAPI",(function(){return shimRemoteStreamsAPI})),__webpack_require__.d(safari_shim_namespaceObject,"shimCallbacksAPI",(function(){return shimCallbacksAPI})),__webpack_require__.d(safari_shim_namespaceObject,"shimGetUserMedia",(function(){return safari_shim_shimGetUserMedia})),__webpack_require__.d(safari_shim_namespaceObject,"shimConstraints",(function(){return shimConstraints})),__webpack_require__.d(safari_shim_namespaceObject,"shimRTCIceServerUrls",(function(){return shimRTCIceServerUrls})),__webpack_require__.d(safari_shim_namespaceObject,"shimTrackEventTransceiver",(function(){return shimTrackEventTransceiver})),__webpack_require__.d(safari_shim_namespaceObject,"shimCreateOfferLegacy",(function(){return shimCreateOfferLegacy}));var common_shim_namespaceObject={};__webpack_require__.r(common_shim_namespaceObject),__webpack_require__.d(common_shim_namespaceObject,"shimRTCIceCandidate",(function(){return shimRTCIceCandidate})),__webpack_require__.d(common_shim_namespaceObject,"shimMaxMessageSize",(function(){return shimMaxMessageSize})),__webpack_require__.d(common_shim_namespaceObject,"shimSendThrowTypeError",(function(){return shimSendThrowTypeError})),__webpack_require__.d(common_shim_namespaceObject,"shimConnectionState",(function(){return shimConnectionState})),__webpack_require__.d(common_shim_namespaceObject,"removeAllowExtmapMixed",(function(){return removeAllowExtmapMixed}));var adapter_core_namespaceObject={};__webpack_require__.r(adapter_core_namespaceObject),__webpack_require__.d(adapter_core_namespaceObject,"default",(function(){return adapter_core}));var logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(uastring,expr,pos){var match=uastring.match(expr);return match&&match.length>=pos&&parseInt(match[pos],10)}function wrapPeerConnectionEvent(window,eventNameToWrap,wrapper){if(window.RTCPeerConnection){var proto=window.RTCPeerConnection.prototype,nativeAddEventListener=proto.addEventListener;proto.addEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap)return nativeAddEventListener.apply(this,arguments);var wrappedCallback=function(e){var modifiedEvent=wrapper(e);modifiedEvent&&cb(modifiedEvent)};return this._eventMap=this._eventMap||{},this._eventMap[cb]=wrappedCallback,nativeAddEventListener.apply(this,[nativeEventName,wrappedCallback])};var nativeRemoveEventListener=proto.removeEventListener;proto.removeEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap||!this._eventMap||!this._eventMap[cb])return nativeRemoveEventListener.apply(this,arguments);var unwrappedCb=this._eventMap[cb];return delete this._eventMap[cb],nativeRemoveEventListener.apply(this,[nativeEventName,unwrappedCb])},Object.defineProperty(proto,"on"+eventNameToWrap,{get:function(){return this["_on"+eventNameToWrap]},set:function(cb){this["_on"+eventNameToWrap]&&(this.removeEventListener(eventNameToWrap,this["_on"+eventNameToWrap]),delete this["_on"+eventNameToWrap]),cb&&this.addEventListener(eventNameToWrap,this["_on"+eventNameToWrap]=cb)},enumerable:!0,configurable:!0})}}function disableLog(bool){return"boolean"!=typeof bool?new Error("Argument type: "+typeof bool+". Please use a boolean."):(logDisabled_=bool,bool?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(bool){return"boolean"!=typeof bool?new Error("Argument type: "+typeof bool+". Please use a boolean."):(deprecationWarnings_=!bool,"adapter.js deprecation warnings "+(bool?"disabled":"enabled"))}function log(){if("object"==typeof window){if(logDisabled_)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function deprecated(oldMethod,newMethod){deprecationWarnings_&&console.warn(oldMethod+" is deprecated, please use "+newMethod+" instead.")}function detectBrowser(window){var navigator=window.navigator,result={browser:null,version:null};if(void 0===window||!window.navigator)return result.browser="Not a browser.",result;if(navigator.mozGetUserMedia)result.browser="firefox",result.version=extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)result.browser="chrome",result.version=extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))result.browser="edge",result.version=extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return result.browser="Not a supported browser.",result;result.browser="safari",result.version=extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1),result.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return result}function isObject(val){return"[object Object]"===Object.prototype.toString.call(val)}function compactObject(data){return isObject(data)?Object.keys(data).reduce((function(accumulator,key){var isObj=isObject(data[key]),value=isObj?compactObject(data[key]):data[key],isEmptyObject=isObj&&!Object.keys(value).length;return void 0===value||isEmptyObject?accumulator:Object.assign(accumulator,Object(defineProperty.a)({},key,value))}),{}):data}function filterStats(result,track,outbound){var streamStatsType=outbound?"outbound-rtp":"inbound-rtp",filteredResult=new Map;if(null===track)return filteredResult;var trackStats=[];return result.forEach((function(value){"track"===value.type&&value.trackIdentifier===track.id&&trackStats.push(value)})),trackStats.forEach((function(trackStat){result.forEach((function(stats){stats.type===streamStatsType&&stats.trackId===trackStat.id&&function walkStats(stats,base,resultSet){base&&!resultSet.has(base.id)&&(resultSet.set(base.id,base),Object.keys(base).forEach((function(name){name.endsWith("Id")?walkStats(stats,stats.get(base[name]),resultSet):name.endsWith("Ids")&&base[name].forEach((function(id){walkStats(stats,stats.get(id),resultSet)}))})))}(result,stats,filteredResult)}))})),filteredResult}var getusermedia_logging=log;function shimGetUserMedia(window){var navigator=window&&window.navigator;if(navigator.mediaDevices){var browserDetails=detectBrowser(window),constraintsToChrome_=function(c){if("object"!=typeof c||c.mandatory||c.optional)return c;var cc={};return Object.keys(c).forEach((function(key){if("require"!==key&&"advanced"!==key&&"mediaSource"!==key){var r="object"==typeof c[key]?c[key]:{ideal:c[key]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var oldname_=function(prefix,name){return prefix?prefix+name.charAt(0).toUpperCase()+name.slice(1):"deviceId"===name?"sourceId":name};if(void 0!==r.ideal){cc.optional=cc.optional||[];var oc={};"number"==typeof r.ideal?(oc[oldname_("min",key)]=r.ideal,cc.optional.push(oc),(oc={})[oldname_("max",key)]=r.ideal,cc.optional.push(oc)):(oc[oldname_("",key)]=r.ideal,cc.optional.push(oc))}void 0!==r.exact&&"number"!=typeof r.exact?(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_("",key)]=r.exact):["min","max"].forEach((function(mix){void 0!==r[mix]&&(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_(mix,key)]=r[mix])}))}})),c.advanced&&(cc.optional=(cc.optional||[]).concat(c.advanced)),cc},shimConstraints_=function(constraints,func){if(browserDetails.version>=61)return func(constraints);if((constraints=JSON.parse(JSON.stringify(constraints)))&&"object"==typeof constraints.audio){var remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])};remap((constraints=JSON.parse(JSON.stringify(constraints))).audio,"autoGainControl","googAutoGainControl"),remap(constraints.audio,"noiseSuppression","googNoiseSuppression"),constraints.audio=constraintsToChrome_(constraints.audio)}if(constraints&&"object"==typeof constraints.video){var face=constraints.video.facingMode;face=face&&("object"==typeof face?face:{ideal:face});var matches,getSupportedFacingModeLies=browserDetails.version<66;if(face&&("user"===face.exact||"environment"===face.exact||"user"===face.ideal||"environment"===face.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||getSupportedFacingModeLies))if(delete constraints.video.facingMode,"environment"===face.exact||"environment"===face.ideal?matches=["back","rear"]:"user"!==face.exact&&"user"!==face.ideal||(matches=["front"]),matches)return navigator.mediaDevices.enumerateDevices().then((function(devices){var dev=(devices=devices.filter((function(d){return"videoinput"===d.kind}))).find((function(d){return matches.some((function(match){return d.label.toLowerCase().includes(match)}))}));return!dev&&devices.length&&matches.includes("back")&&(dev=devices[devices.length-1]),dev&&(constraints.video.deviceId=face.exact?{exact:dev.deviceId}:{ideal:dev.deviceId}),constraints.video=constraintsToChrome_(constraints.video),getusermedia_logging("chrome: "+JSON.stringify(constraints)),func(constraints)}));constraints.video=constraintsToChrome_(constraints.video)}return getusermedia_logging("chrome: "+JSON.stringify(constraints)),func(constraints)},shimError_=function(e){return browserDetails.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(navigator.getUserMedia=function(constraints,onSuccess,onError){shimConstraints_(constraints,(function(c){navigator.webkitGetUserMedia(c,onSuccess,(function(e){onError&&onError(shimError_(e))}))}))}.bind(navigator),navigator.mediaDevices.getUserMedia){var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(cs){return shimConstraints_(cs,(function(c){return origGetUserMedia(c).then((function(stream){if(c.audio&&!stream.getAudioTracks().length||c.video&&!stream.getVideoTracks().length)throw stream.getTracks().forEach((function(track){track.stop()})),new DOMException("","NotFoundError");return stream}),(function(e){return Promise.reject(shimError_(e))}))}))}}}}function shimGetDisplayMedia(window,getSourceId){window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices||window.navigator.mediaDevices&&("function"==typeof getSourceId?window.navigator.mediaDevices.getDisplayMedia=function(constraints){return getSourceId(constraints).then((function(sourceId){var widthSpecified=constraints.video&&constraints.video.width,heightSpecified=constraints.video&&constraints.video.height,frameRateSpecified=constraints.video&&constraints.video.frameRate;return constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:sourceId,maxFrameRate:frameRateSpecified||3}},widthSpecified&&(constraints.video.mandatory.maxWidth=widthSpecified),heightSpecified&&(constraints.video.mandatory.maxHeight=heightSpecified),window.navigator.mediaDevices.getUserMedia(constraints)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function shimMediaStream(window){window.MediaStream=window.MediaStream||window.webkitMediaStream}function shimOnTrack(window){if("object"==typeof window&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(f){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=f)},enumerable:!0,configurable:!0});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var _this342=this;return this._ontrackpoly||(this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",(function(te){var receiver;receiver=window.RTCPeerConnection.prototype.getReceivers?_this342.getReceivers().find((function(r){return r.track&&r.track.id===te.track.id})):{track:te.track};var event=new Event("track");event.track=te.track,event.receiver=receiver,event.transceiver={receiver:receiver},event.streams=[e.stream],_this342.dispatchEvent(event)})),e.stream.getTracks().forEach((function(track){var receiver;receiver=window.RTCPeerConnection.prototype.getReceivers?_this342.getReceivers().find((function(r){return r.track&&r.track.id===track.id})):{track:track};var event=new Event("track");event.track=track,event.receiver=receiver,event.transceiver={receiver:receiver},event.streams=[e.stream],_this342.dispatchEvent(event)}))},this.addEventListener("addstream",this._ontrackpoly)),origSetRemoteDescription.apply(this,arguments)}}else wrapPeerConnectionEvent(window,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function shimGetSendersWithDtmf(window){if("object"==typeof window&&window.RTCPeerConnection&&!("getSenders"in window.RTCPeerConnection.prototype)&&"createDTMFSender"in window.RTCPeerConnection.prototype){var shimSenderWithDtmf=function(pc,track){return{track:track,get dtmf(){return void 0===this._dtmf&&("audio"===track.kind?this._dtmf=pc.createDTMFSender(track):this._dtmf=null),this._dtmf},_pc:pc}};if(!window.RTCPeerConnection.prototype.getSenders){window.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){var sender=origAddTrack.apply(this,arguments);return sender||(sender=shimSenderWithDtmf(this,track),this._senders.push(sender)),sender};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){origRemoveTrack.apply(this,arguments);var idx=this._senders.indexOf(sender);-1!==idx&&this._senders.splice(idx,1)}}var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this343=this;this._senders=this._senders||[],origAddStream.apply(this,[stream]),stream.getTracks().forEach((function(track){_this343._senders.push(shimSenderWithDtmf(_this343,track))}))};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){var _this344=this;this._senders=this._senders||[],origRemoveStream.apply(this,[stream]),stream.getTracks().forEach((function(track){var sender=_this344._senders.find((function(s){return s.track===track}));sender&&_this344._senders.splice(_this344._senders.indexOf(sender),1)}))}}else if("object"==typeof window&&window.RTCPeerConnection&&"getSenders"in window.RTCPeerConnection.prototype&&"createDTMFSender"in window.RTCPeerConnection.prototype&&window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;window.RTCPeerConnection.prototype.getSenders=function(){var _this345=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this345})),senders},Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimGetStats(window){if(window.RTCPeerConnection){var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){var _this346=this,_arguments2=Array.prototype.slice.call(arguments),selector=_arguments2[0],onSucc=_arguments2[1],onErr=_arguments2[2];if(arguments.length>0&&"function"==typeof selector)return origGetStats.apply(this,arguments);if(0===origGetStats.length&&(0===arguments.length||"function"!=typeof selector))return origGetStats.apply(this,[]);var fixChromeStats_=function(response){var standardReport={};return response.result().forEach((function(report){var standardStats={id:report.id,timestamp:report.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[report.type]||report.type};report.names().forEach((function(name){standardStats[name]=report.stat(name)})),standardReport[standardStats.id]=standardStats})),standardReport},makeMapStats=function(stats){return new Map(Object.keys(stats).map((function(key){return[key,stats[key]]})))};if(arguments.length>=2){var successCallbackWrapper_=function(response){onSucc(makeMapStats(fixChromeStats_(response)))};return origGetStats.apply(this,[successCallbackWrapper_,selector])}return new Promise((function(resolve,reject){origGetStats.apply(_this346,[function(response){resolve(makeMapStats(fixChromeStats_(response)))},reject])})).then(onSucc,onErr)}}}function shimSenderReceiverGetStats(window){if("object"==typeof window&&window.RTCPeerConnection&&window.RTCRtpSender&&window.RTCRtpReceiver){if(!("getStats"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function(){var _this347=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this347})),senders});var origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender}),window.RTCRtpSender.prototype.getStats=function(){var sender=this;return this._pc.getStats().then((function(result){return filterStats(result,sender.track,!0)}))}}if(!("getStats"in window.RTCRtpReceiver.prototype)){var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function(){var _this348=this,receivers=origGetReceivers.apply(this,[]);return receivers.forEach((function(receiver){return receiver._pc=_this348})),receivers}),wrapPeerConnectionEvent(window,"track",(function(e){return e.receiver._pc=e.srcElement,e})),window.RTCRtpReceiver.prototype.getStats=function(){var receiver=this;return this._pc.getStats().then((function(result){return filterStats(result,receiver.track,!1)}))}}if("getStats"in window.RTCRtpSender.prototype&&"getStats"in window.RTCRtpReceiver.prototype){var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof window.MediaStreamTrack){var sender,receiver,err,track=arguments[0];return this.getSenders().forEach((function(s){s.track===track&&(sender?err=!0:sender=s)})),this.getReceivers().forEach((function(r){return r.track===track&&(receiver?err=!0:receiver=r),r.track===track})),err||sender&&receiver?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):sender?sender.getStats():receiver?receiver.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return origGetStats.apply(this,arguments)}}}}function shimAddTrackRemoveTrackWithNative(window){window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this349=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(streamId){return _this349._shimmedLocalStreams[streamId][0]}))};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){if(!stream)return origAddTrack.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var sender=origAddTrack.apply(this,arguments);return this._shimmedLocalStreams[stream.id]?-1===this._shimmedLocalStreams[stream.id].indexOf(sender)&&this._shimmedLocalStreams[stream.id].push(sender):this._shimmedLocalStreams[stream.id]=[stream,sender],sender};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this350=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},stream.getTracks().forEach((function(track){if(_this350.getSenders().find((function(s){return s.track===track})))throw new DOMException("Track already exists.","InvalidAccessError")}));var existingSenders=this.getSenders();origAddStream.apply(this,arguments);var newSenders=this.getSenders().filter((function(newSender){return-1===existingSenders.indexOf(newSender)}));this._shimmedLocalStreams[stream.id]=[stream].concat(newSenders)};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[stream.id],origRemoveStream.apply(this,arguments)};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this351=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},sender&&Object.keys(this._shimmedLocalStreams).forEach((function(streamId){var idx=_this351._shimmedLocalStreams[streamId].indexOf(sender);-1!==idx&&_this351._shimmedLocalStreams[streamId].splice(idx,1),1===_this351._shimmedLocalStreams[streamId].length&&delete _this351._shimmedLocalStreams[streamId]})),origRemoveTrack.apply(this,arguments)}}function shimAddTrackRemoveTrack(window){if(window.RTCPeerConnection){var browserDetails=detectBrowser(window);if(window.RTCPeerConnection.prototype.addTrack&&browserDetails.version>=65)return shimAddTrackRemoveTrackWithNative(window);var origGetLocalStreams=window.RTCPeerConnection.prototype.getLocalStreams;window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this352=this,nativeStreams=origGetLocalStreams.apply(this);return this._reverseStreams=this._reverseStreams||{},nativeStreams.map((function(stream){return _this352._reverseStreams[stream.id]}))};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this353=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},stream.getTracks().forEach((function(track){if(_this353.getSenders().find((function(s){return s.track===track})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[stream.id]){var newStream=new window.MediaStream(stream.getTracks());this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,stream=newStream}origAddStream.apply(this,[stream])};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},origRemoveStream.apply(this,[this._streams[stream.id]||stream]),delete this._reverseStreams[this._streams[stream.id]?this._streams[stream.id].id:stream.id],delete this._streams[stream.id]},window.RTCPeerConnection.prototype.addTrack=function(track,stream){var _this354=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var streams=[].slice.call(arguments,1);if(1!==streams.length||!streams[0].getTracks().find((function(t){return t===track})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var alreadyExists=this.getSenders().find((function(s){return s.track===track}));if(alreadyExists)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var oldStream=this._streams[stream.id];if(oldStream)oldStream.addTrack(track),Promise.resolve().then((function(){_this354.dispatchEvent(new Event("negotiationneeded"))}));else{var newStream=new window.MediaStream([track]);this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,this.addStream(newStream)}return this.getSenders().find((function(s){return s.track===track}))},["createOffer","createAnswer"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=Object(defineProperty.a)({},method,(function(){var _this355=this,args=arguments;return arguments.length&&"function"==typeof arguments[0]?nativeMethod.apply(this,[function(description){var desc=replaceInternalStreamId(_this355,description);args[0].apply(null,[desc])},function(err){args[1]&&args[1].apply(null,err)},arguments[2]]):nativeMethod.apply(this,arguments).then((function(description){return replaceInternalStreamId(_this355,description)}))}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));var origSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;window.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=replaceExternalStreamId(this,arguments[0]),origSetLocalDescription.apply(this,arguments)):origSetLocalDescription.apply(this,arguments)};var origLocalDescription=Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(window.RTCPeerConnection.prototype,"localDescription",{get:function(){var description=origLocalDescription.get.apply(this);return""===description.type?description:replaceInternalStreamId(this,description)}}),window.RTCPeerConnection.prototype.removeTrack=function(sender){var stream,_this356=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!sender._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(sender._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(streamid){_this356._streams[streamid].getTracks().find((function(track){return sender.track===track}))&&(stream=_this356._streams[streamid])})),stream&&(1===stream.getTracks().length?this.removeStream(this._reverseStreams[stream.id]):stream.removeTrack(sender.track),this.dispatchEvent(new Event("negotiationneeded")))}}function replaceInternalStreamId(pc,description){var sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((function(internalId){var externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(internalStream.id,"g"),externalStream.id)})),new RTCSessionDescription({type:description.type,sdp:sdp})}function replaceExternalStreamId(pc,description){var sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((function(internalId){var externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(externalStream.id,"g"),internalStream.id)})),new RTCSessionDescription({type:description.type,sdp:sdp})}}function shimPeerConnection(window){var browserDetails=detectBrowser(window);if(!window.RTCPeerConnection&&window.webkitRTCPeerConnection&&(window.RTCPeerConnection=window.webkitRTCPeerConnection),window.RTCPeerConnection){var addIceCandidateNullSupported=0===window.RTCPeerConnection.prototype.addIceCandidate.length;browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=Object(defineProperty.a)({},method,(function(){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){return addIceCandidateNullSupported||arguments[0]?browserDetails.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():nativeAddIceCandidate.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}function fixNegotiationNeeded(window){wrapPeerConnectionEvent(window,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))}var rtcpeerconnection=__webpack_require__(234),rtcpeerconnection_default=__webpack_require__.n(rtcpeerconnection);function getusermedia_shimGetUserMedia(window){var navigator=window&&window.navigator,origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return origGetUserMedia(c).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}function getdisplaymedia_shimGetDisplayMedia(window){"getDisplayMedia"in window.navigator&&window.navigator.mediaDevices&&(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices||(window.navigator.mediaDevices.getDisplayMedia=window.navigator.getDisplayMedia.bind(window.navigator)))}function edge_shim_shimPeerConnection(window){var browserDetails=detectBrowser(window);if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(args){return args}),window.RTCSessionDescription||(window.RTCSessionDescription=function(args){return args}),browserDetails.version<15025)){var origMSTEnabled=Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype,"enabled");Object.defineProperty(window.MediaStreamTrack.prototype,"enabled",{set:function(value){origMSTEnabled.set.call(this,value);var ev=new Event("enabled");ev.enabled=value,this.dispatchEvent(ev)}})}window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)&&Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new window.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),window.RTCDtmfSender&&!window.RTCDTMFSender&&(window.RTCDTMFSender=window.RTCDtmfSender);var RTCPeerConnectionShim=rtcpeerconnection_default()(window,browserDetails.version);window.RTCPeerConnection=function(config){return config&&config.iceServers&&(config.iceServers=function(iceServers,edgeVersion){var hasTurn=!1;return(iceServers=JSON.parse(JSON.stringify(iceServers))).filter((function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;server.url&&!server.urls&&deprecated("RTCIceServer.url","RTCIceServer.urls");var isString="string"==typeof urls;return isString&&(urls=[urls]),urls=urls.filter((function(url){if(0===url.indexOf("stun:"))return!1;var validTurn=url.startsWith("turn")&&!url.startsWith("turn:[")&&url.includes("transport=udp");return validTurn&&!hasTurn?(hasTurn=!0,!0):validTurn&&!hasTurn})),delete server.url,server.urls=isString?urls[0]:urls,!!urls.length}}))}(config.iceServers,browserDetails.version),log("ICE servers after filtering:",config.iceServers)),new RTCPeerConnectionShim(config)},window.RTCPeerConnection.prototype=RTCPeerConnectionShim.prototype}function shimReplaceTrack(window){window.RTCRtpSender&&!("replaceTrack"in window.RTCRtpSender.prototype)&&(window.RTCRtpSender.prototype.replaceTrack=window.RTCRtpSender.prototype.setTrack)}function firefox_getusermedia_shimGetUserMedia(window){var browserDetails=detectBrowser(window),navigator=window&&window.navigator,MediaStreamTrack=window&&window.MediaStreamTrack;if(navigator.getUserMedia=function(constraints,onSuccess,onError){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(constraints).then(onSuccess,onError)},!(browserDetails.version>55&&"autoGainControl"in navigator.mediaDevices.getSupportedConstraints())){var remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])},nativeGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);if(navigator.mediaDevices.getUserMedia=function(c){return"object"==typeof c&&"object"==typeof c.audio&&(c=JSON.parse(JSON.stringify(c)),remap(c.audio,"autoGainControl","mozAutoGainControl"),remap(c.audio,"noiseSuppression","mozNoiseSuppression")),nativeGetUserMedia(c)},MediaStreamTrack&&MediaStreamTrack.prototype.getSettings){var nativeGetSettings=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){var obj=nativeGetSettings.apply(this,arguments);return remap(obj,"mozAutoGainControl","autoGainControl"),remap(obj,"mozNoiseSuppression","noiseSuppression"),obj}}if(MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints){var nativeApplyConstraints=MediaStreamTrack.prototype.applyConstraints;MediaStreamTrack.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"==typeof c&&(c=JSON.parse(JSON.stringify(c)),remap(c,"autoGainControl","mozAutoGainControl"),remap(c,"noiseSuppression","mozNoiseSuppression")),nativeApplyConstraints.apply(this,[c])}}}}function firefox_getdisplaymedia_shimGetDisplayMedia(window,preferredMediaSource){window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices||window.navigator.mediaDevices&&(window.navigator.mediaDevices.getDisplayMedia=function(constraints){if(!constraints||!constraints.video){var err=new DOMException("getDisplayMedia without video constraints is undefined");return err.name="NotFoundError",err.code=8,Promise.reject(err)}return!0===constraints.video?constraints.video={mediaSource:preferredMediaSource}:constraints.video.mediaSource=preferredMediaSource,window.navigator.mediaDevices.getUserMedia(constraints)})}function firefox_shim_shimOnTrack(window){"object"==typeof window&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function firefox_shim_shimPeerConnection(window){var browserDetails=detectBrowser(window);if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){if(!window.RTCPeerConnection&&window.mozRTCPeerConnection&&(window.RTCPeerConnection=window.mozRTCPeerConnection),browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=Object(defineProperty.a)({},method,(function(){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}));window.RTCPeerConnection.prototype[method]=methodObj[method]})),browserDetails.version<68){var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():nativeAddIceCandidate.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var modernStatsTypes={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},nativeGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){var _arguments3=Array.prototype.slice.call(arguments),selector=_arguments3[0],onSucc=_arguments3[1],onErr=_arguments3[2];return nativeGetStats.apply(this,[selector||null]).then((function(stats){if(browserDetails.version<53&&!onSucc)try{stats.forEach((function(stat){stat.type=modernStatsTypes[stat.type]||stat.type}))}catch(e){if("TypeError"!==e.name)throw e;stats.forEach((function(stat,i){stats.set(i,Object.assign({},stat,{type:modernStatsTypes[stat.type]||stat.type}))}))}return stats})).then(onSucc,onErr)}}}function shimSenderGetStats(window){if("object"==typeof window&&window.RTCPeerConnection&&window.RTCRtpSender&&(!window.RTCRtpSender||!("getStats"in window.RTCRtpSender.prototype))){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function(){var _this357=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this357})),senders});var origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender}),window.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function shimReceiverGetStats(window){if("object"==typeof window&&window.RTCPeerConnection&&window.RTCRtpSender&&(!window.RTCRtpSender||!("getStats"in window.RTCRtpReceiver.prototype))){var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function(){var _this358=this,receivers=origGetReceivers.apply(this,[]);return receivers.forEach((function(receiver){return receiver._pc=_this358})),receivers}),wrapPeerConnectionEvent(window,"track",(function(e){return e.receiver._pc=e.srcElement,e})),window.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function shimRemoveStream(window){window.RTCPeerConnection&&!("removeStream"in window.RTCPeerConnection.prototype)&&(window.RTCPeerConnection.prototype.removeStream=function(stream){var _this359=this;deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(sender){sender.track&&stream.getTracks().includes(sender.track)&&_this359.removeTrack(sender)}))})}function shimRTCDataChannel(window){window.DataChannel&&!window.RTCDataChannel&&(window.RTCDataChannel=window.DataChannel)}function shimAddTransceiver(window){if("object"==typeof window&&window.RTCPeerConnection){var origAddTransceiver=window.RTCPeerConnection.prototype.addTransceiver;origAddTransceiver&&(window.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var initParameters=arguments[1],shouldPerformCheck=initParameters&&"sendEncodings"in initParameters;shouldPerformCheck&&initParameters.sendEncodings.forEach((function(encodingParam){if("rid"in encodingParam&&!/^[a-z0-9]{0,16}$/i.test(encodingParam.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in encodingParam&&!(parseFloat(encodingParam.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in encodingParam&&!(parseFloat(encodingParam.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var transceiver=origAddTransceiver.apply(this,arguments);if(shouldPerformCheck){var sender=transceiver.sender,params=sender.getParameters();"encodings"in params||(params.encodings=initParameters.sendEncodings,this.setParametersPromises.push(sender.setParameters(params).catch((function(){}))))}return transceiver})}}function shimCreateOffer(window){if("object"==typeof window&&window.RTCPeerConnection){var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(){var _arguments4=arguments,_this360=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return origCreateOffer.apply(_this360,_arguments4)})).finally((function(){_this360.setParametersPromises=[]})):origCreateOffer.apply(this,arguments)}}}function shimCreateAnswer(window){if("object"==typeof window&&window.RTCPeerConnection){var origCreateAnswer=window.RTCPeerConnection.prototype.createAnswer;window.RTCPeerConnection.prototype.createAnswer=function(){var _arguments5=arguments,_this361=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return origCreateAnswer.apply(_this361,_arguments5)})).finally((function(){_this361.setParametersPromises=[]})):origCreateAnswer.apply(this,arguments)}}}function shimLocalStreamsAPI(window){if("object"==typeof window&&window.RTCPeerConnection){if("getLocalStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in window.RTCPeerConnection.prototype)){var _addTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addStream=function(stream){var _this362=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(stream)||this._localStreams.push(stream),stream.getAudioTracks().forEach((function(track){return _addTrack.call(_this362,track,stream)})),stream.getVideoTracks().forEach((function(track){return _addTrack.call(_this362,track,stream)}))},window.RTCPeerConnection.prototype.addTrack=function(track){for(var _this363=this,_len3=arguments.length,streams=new Array(_len3>1?_len3-1:0),_key6=1;_key6<_len3;_key6++)streams[_key6-1]=arguments[_key6];return streams&&streams.forEach((function(stream){_this363._localStreams?_this363._localStreams.includes(stream)||_this363._localStreams.push(stream):_this363._localStreams=[stream]})),_addTrack.apply(this,arguments)}}"removeStream"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.removeStream=function(stream){var _this364=this;this._localStreams||(this._localStreams=[]);var index=this._localStreams.indexOf(stream);if(-1!==index){this._localStreams.splice(index,1);var tracks=stream.getTracks();this.getSenders().forEach((function(sender){tracks.includes(sender.track)&&_this364.removeTrack(sender)}))}})}}function shimRemoteStreamsAPI(window){if("object"==typeof window&&window.RTCPeerConnection&&("getRemoteStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in window.RTCPeerConnection.prototype))){Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(f){var _this365=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=f),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(stream){if(_this365._remoteStreams||(_this365._remoteStreams=[]),!_this365._remoteStreams.includes(stream)){_this365._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,_this365.dispatchEvent(event)}}))})}});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var pc=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(stream){if(pc._remoteStreams||(pc._remoteStreams=[]),!(pc._remoteStreams.indexOf(stream)>=0)){pc._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,pc.dispatchEvent(event)}}))}),origSetRemoteDescription.apply(pc,arguments)}}}function shimCallbacksAPI(window){if("object"==typeof window&&window.RTCPeerConnection){var prototype=window.RTCPeerConnection.prototype,origCreateOffer=prototype.createOffer,origCreateAnswer=prototype.createAnswer,setLocalDescription=prototype.setLocalDescription,setRemoteDescription=prototype.setRemoteDescription,addIceCandidate=prototype.addIceCandidate;prototype.createOffer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateOffer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.createAnswer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateAnswer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};var withCallback=function(description,successCallback,failureCallback){var promise=setLocalDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};prototype.setLocalDescription=withCallback,withCallback=function(description,successCallback,failureCallback){var promise=setRemoteDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.setRemoteDescription=withCallback,withCallback=function(candidate,successCallback,failureCallback){var promise=addIceCandidate.apply(this,[candidate]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.addIceCandidate=withCallback}}function safari_shim_shimGetUserMedia(window){var navigator=window&&window.navigator;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var mediaDevices=navigator.mediaDevices,_getUserMedia=mediaDevices.getUserMedia.bind(mediaDevices);navigator.mediaDevices.getUserMedia=function(constraints){return _getUserMedia(shimConstraints(constraints))}}!navigator.getUserMedia&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(constraints,cb,errcb){navigator.mediaDevices.getUserMedia(constraints).then(cb,errcb)}.bind(navigator))}function shimConstraints(constraints){return constraints&&void 0!==constraints.video?Object.assign({},constraints,{video:compactObject(constraints.video)}):constraints}function shimRTCIceServerUrls(window){var OrigPeerConnection=window.RTCPeerConnection;window.RTCPeerConnection=function(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){for(var newIceServers=[],i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];!server.hasOwnProperty("urls")&&server.hasOwnProperty("url")?(deprecated("RTCIceServer.url","RTCIceServer.urls"),(server=JSON.parse(JSON.stringify(server))).urls=server.url,delete server.url,newIceServers.push(server)):newIceServers.push(pcConfig.iceServers[i])}pcConfig.iceServers=newIceServers}return new OrigPeerConnection(pcConfig,pcConstraints)},window.RTCPeerConnection.prototype=OrigPeerConnection.prototype,"generateCertificate"in window.RTCPeerConnection&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return OrigPeerConnection.generateCertificate}})}function shimTrackEventTransceiver(window){"object"==typeof window&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(window){var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(offerOptions){if(offerOptions){void 0!==offerOptions.offerToReceiveAudio&&(offerOptions.offerToReceiveAudio=!!offerOptions.offerToReceiveAudio);var audioTransceiver=this.getTransceivers().find((function(transceiver){return"audio"===transceiver.receiver.track.kind}));!1===offerOptions.offerToReceiveAudio&&audioTransceiver?"sendrecv"===audioTransceiver.direction?audioTransceiver.setDirection?audioTransceiver.setDirection("sendonly"):audioTransceiver.direction="sendonly":"recvonly"===audioTransceiver.direction&&(audioTransceiver.setDirection?audioTransceiver.setDirection("inactive"):audioTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveAudio||audioTransceiver||this.addTransceiver("audio"),void 0!==offerOptions.offerToReceiveVideo&&(offerOptions.offerToReceiveVideo=!!offerOptions.offerToReceiveVideo);var videoTransceiver=this.getTransceivers().find((function(transceiver){return"video"===transceiver.receiver.track.kind}));!1===offerOptions.offerToReceiveVideo&&videoTransceiver?"sendrecv"===videoTransceiver.direction?videoTransceiver.setDirection?videoTransceiver.setDirection("sendonly"):videoTransceiver.direction="sendonly":"recvonly"===videoTransceiver.direction&&(videoTransceiver.setDirection?videoTransceiver.setDirection("inactive"):videoTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveVideo||videoTransceiver||this.addTransceiver("video")}return origCreateOffer.apply(this,arguments)}}var sdp=__webpack_require__(52),sdp_default=__webpack_require__.n(sdp);function shimRTCIceCandidate(window){if(!(!window.RTCIceCandidate||window.RTCIceCandidate&&"foundation"in window.RTCIceCandidate.prototype)){var NativeRTCIceCandidate=window.RTCIceCandidate;window.RTCIceCandidate=function(args){if("object"==typeof args&&args.candidate&&0===args.candidate.indexOf("a=")&&((args=JSON.parse(JSON.stringify(args))).candidate=args.candidate.substr(2)),args.candidate&&args.candidate.length){var nativeCandidate=new NativeRTCIceCandidate(args),parsedCandidate=sdp_default.a.parseCandidate(args.candidate),augmentedCandidate=Object.assign(nativeCandidate,parsedCandidate);return augmentedCandidate.toJSON=function(){return{candidate:augmentedCandidate.candidate,sdpMid:augmentedCandidate.sdpMid,sdpMLineIndex:augmentedCandidate.sdpMLineIndex,usernameFragment:augmentedCandidate.usernameFragment}},augmentedCandidate}return new NativeRTCIceCandidate(args)},window.RTCIceCandidate.prototype=NativeRTCIceCandidate.prototype,wrapPeerConnectionEvent(window,"icecandidate",(function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new window.RTCIceCandidate(e.candidate),writable:"false"}),e}))}}function shimMaxMessageSize(window){if(window.RTCPeerConnection){var browserDetails=detectBrowser(window);"sctp"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var sctpInDescription=function(description){if(!description||!description.sdp)return!1;var sections=sdp_default.a.splitSections(description.sdp);return sections.shift(),sections.some((function(mediaSection){var mLine=sdp_default.a.parseMLine(mediaSection);return mLine&&"application"===mLine.kind&&-1!==mLine.protocol.indexOf("SCTP")}))},getRemoteFirefoxVersion=function(description){var match=description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===match||match.length<2)return-1;var version=parseInt(match[1],10);return version!=version?-1:version},getCanSendMaxMessageSize=function(remoteIsFirefox){var canSendMaxMessageSize=65536;return"firefox"===browserDetails.browser&&(canSendMaxMessageSize=browserDetails.version<57?-1===remoteIsFirefox?16384:2147483637:browserDetails.version<60?57===browserDetails.version?65535:65536:2147483637),canSendMaxMessageSize},getMaxMessageSize=function(description,remoteIsFirefox){var maxMessageSize=65536;"firefox"===browserDetails.browser&&57===browserDetails.version&&(maxMessageSize=65535);var match=sdp_default.a.matchPrefix(description.sdp,"a=max-message-size:");return match.length>0?maxMessageSize=parseInt(match[0].substr(19),10):"firefox"===browserDetails.browser&&-1!==remoteIsFirefox&&(maxMessageSize=2147483637),maxMessageSize},origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===browserDetails.browser&&browserDetails.version>=76){var _this$getConfiguratio=this.getConfiguration(),sdpSemantics=_this$getConfiguratio.sdpSemantics;"plan-b"===sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(sctpInDescription(arguments[0])){var maxMessageSize,isFirefox=getRemoteFirefoxVersion(arguments[0]),canSendMMS=getCanSendMaxMessageSize(isFirefox),remoteMMS=getMaxMessageSize(arguments[0],isFirefox);maxMessageSize=0===canSendMMS&&0===remoteMMS?Number.POSITIVE_INFINITY:0===canSendMMS||0===remoteMMS?Math.max(canSendMMS,remoteMMS):Math.min(canSendMMS,remoteMMS);var sctp={};Object.defineProperty(sctp,"maxMessageSize",{get:function(){return maxMessageSize}}),this._sctp=sctp}return origSetRemoteDescription.apply(this,arguments)}}}function shimSendThrowTypeError(window){if(window.RTCPeerConnection&&"createDataChannel"in window.RTCPeerConnection.prototype){var origCreateDataChannel=window.RTCPeerConnection.prototype.createDataChannel;window.RTCPeerConnection.prototype.createDataChannel=function(){var dataChannel=origCreateDataChannel.apply(this,arguments);return wrapDcSend(dataChannel,this),dataChannel},wrapPeerConnectionEvent(window,"datachannel",(function(e){return wrapDcSend(e.channel,e.target),e}))}function wrapDcSend(dc,pc){var origDataChannelSend=dc.send;dc.send=function(){var data=arguments[0],length=data.length||data.size||data.byteLength;if("open"===dc.readyState&&pc.sctp&&length>pc.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+pc.sctp.maxMessageSize+" bytes)");return origDataChannelSend.apply(dc,arguments)}}}function shimConnectionState(window){if(window.RTCPeerConnection&&!("connectionState"in window.RTCPeerConnection.prototype)){var proto=window.RTCPeerConnection.prototype;Object.defineProperty(proto,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(proto,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(cb){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),cb&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=cb)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(method){var origMethod=proto[method];proto[method]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var pc=e.target;if(pc._lastConnectionState!==pc.connectionState){pc._lastConnectionState=pc.connectionState;var newEvent=new Event("connectionstatechange",e);pc.dispatchEvent(newEvent)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),origMethod.apply(this,arguments)}}))}}function removeAllowExtmapMixed(window){if(window.RTCPeerConnection){var browserDetails=detectBrowser(window);if(!("chrome"===browserDetails.browser&&browserDetails.version>=71)){var nativeSRD=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(desc){return desc&&desc.sdp&&-1!==desc.sdp.indexOf("\na=extmap-allow-mixed")&&(desc.sdp=desc.sdp.split("\n").filter((function(line){return"a=extmap-allow-mixed"!==line.trim()})).join("\n")),nativeSRD.apply(this,arguments)}}}}var adapter_core=function(){var _ref2=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},window=_ref2.window,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},logging=log,browserDetails=detectBrowser(window),adapter={browserDetails:browserDetails,commonShim:common_shim_namespaceObject,extractVersion:extractVersion,disableLog:disableLog,disableWarnings:disableWarnings};switch(browserDetails.browser){case"chrome":if(!chrome_shim_namespaceObject||!shimPeerConnection||!options.shimChrome)return logging("Chrome shim is not included in this adapter release."),adapter;logging("adapter.js shimming chrome."),adapter.browserShim=chrome_shim_namespaceObject,shimGetUserMedia(window),shimMediaStream(window),shimPeerConnection(window),shimOnTrack(window),shimAddTrackRemoveTrack(window),shimGetSendersWithDtmf(window),shimGetStats(window),shimSenderReceiverGetStats(window),fixNegotiationNeeded(window),shimRTCIceCandidate(window),shimConnectionState(window),shimMaxMessageSize(window),shimSendThrowTypeError(window),removeAllowExtmapMixed(window);break;case"firefox":if(!firefox_shim_namespaceObject||!firefox_shim_shimPeerConnection||!options.shimFirefox)return logging("Firefox shim is not included in this adapter release."),adapter;logging("adapter.js shimming firefox."),adapter.browserShim=firefox_shim_namespaceObject,firefox_getusermedia_shimGetUserMedia(window),firefox_shim_shimPeerConnection(window),firefox_shim_shimOnTrack(window),shimRemoveStream(window),shimSenderGetStats(window),shimReceiverGetStats(window),shimRTCDataChannel(window),shimAddTransceiver(window),shimCreateOffer(window),shimCreateAnswer(window),shimRTCIceCandidate(window),shimConnectionState(window),shimMaxMessageSize(window),shimSendThrowTypeError(window);break;case"edge":if(!edge_shim_namespaceObject||!edge_shim_shimPeerConnection||!options.shimEdge)return logging("MS edge shim is not included in this adapter release."),adapter;logging("adapter.js shimming edge."),adapter.browserShim=edge_shim_namespaceObject,getusermedia_shimGetUserMedia(window),getdisplaymedia_shimGetDisplayMedia(window),edge_shim_shimPeerConnection(window),shimReplaceTrack(window),shimMaxMessageSize(window),shimSendThrowTypeError(window);break;case"safari":if(!safari_shim_namespaceObject||!options.shimSafari)return logging("Safari shim is not included in this adapter release."),adapter;logging("adapter.js shimming safari."),adapter.browserShim=safari_shim_namespaceObject,shimRTCIceServerUrls(window),shimCreateOfferLegacy(window),shimCallbacksAPI(window),shimLocalStreamsAPI(window),shimRemoteStreamsAPI(window),shimTrackEventTransceiver(window),safari_shim_shimGetUserMedia(window),shimRTCIceCandidate(window),shimMaxMessageSize(window),shimSendThrowTypeError(window),removeAllowExtmapMixed(window);break;default:logging("Unsupported browser!")}return adapter}({window:window}),connectionService=__webpack_require__(235),presenceService=__webpack_require__(236),userProfileService=__webpack_require__(237),contactsService=__webpack_require__(238),pbxService=__webpack_require__(239),conversationsService=__webpack_require__(240),imService=__webpack_require__(241),webRTCService=__webpack_require__(242),bubblesService=__webpack_require__(243),conferencesService=__webpack_require__(244),groupsService=__webpack_require__(245),callsLogService=__webpack_require__(246),favoritesService=__webpack_require__(247),filesStorageService=__webpack_require__(248),capabilitiesService=__webpack_require__(249),adminService=__webpack_require__(250),channelsService=__webpack_require__(251),sdkService=__webpack_require__(252),sdkConstant=__webpack_require__(28),call_model=__webpack_require__(0);__webpack_require__(253),__webpack_require__(254),__webpack_require__(255),window.adapter=adapter_core_namespaceObject,window.emojione=null,__webpack_require__(256),__webpack_require__(257),__webpack_require__(410),__webpack_require__(28),__webpack_require__(411),angular.module("sdk").service("connectionService",connectionService.ConnectionService),angular.module("sdk").service("presenceService",presenceService.PresenceService),angular.module("sdk").service("userProfileService",userProfileService.UserProfileService),angular.module("sdk").service("contactsService",contactsService.ContactsService),angular.module("sdk").service("pbxService",pbxService.PbxService),angular.module("sdk").service("conversationsService",conversationsService.ConversationsService),angular.module("sdk").service("imService",imService.ImService),angular.module("sdk").service("webRTCService",webRTCService.WebRTCService),angular.module("sdk").service("bubblesService",bubblesService.BubblesService),angular.module("sdk").service("conferencesService",conferencesService.ConferencesService),angular.module("sdk").service("groupsService",groupsService.GroupsService),angular.module("sdk").service("callsLogService",callsLogService.CallsLogService),angular.module("sdk").service("favoritesService",favoritesService.FavoritesService),angular.module("sdk").service("filesStorageService",filesStorageService.FilesStorageService),angular.module("sdk").service("capabilitiesService",capabilitiesService.CapabilitiesService),angular.module("sdk").service("adminService",adminService.AdminService),angular.module("sdk").service("channelsService",channelsService.ChannelsService),angular.module("sdk").service("rainbowSDK",sdkService.SdkService),angular.module("sdk")||angular.bootstrap(document,["sdk"]).get("rainbowSDK"),__webpack_require__(414),__webpack_require__(415),__webpack_require__(416),__webpack_require__(417),__webpack_require__(418),__webpack_require__(419),__webpack_require__(420),__webpack_require__(421),__webpack_require__(422);var rainbowSDK=angular.injector(["sdk"]).get("rainbowSDK");rainbowSDK.Call=call_model.Call,rainbowSDK.SDK=sdkConstant.SDK,__webpack_exports__.default=rainbowSDK}]);__webpack_exports__.a=rainbow_sdk_min_rainbowSDK.default},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useForkRef}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_setRef__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26);function useForkRef(refA,refB){return react__WEBPACK_IMPORTED_MODULE_0__.useMemo((function(){return null==refA&&null==refB?null:function(refValue){Object(_setRef__WEBPACK_IMPORTED_MODULE_1__.a)(refA,refValue),Object(_setRef__WEBPACK_IMPORTED_MODULE_1__.a)(refB,refValue)}}),[refA,refB])}},function(module,exports,__webpack_require__){"use strict";!function checkDCE(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(err){console.error(err)}}(),module.exports=__webpack_require__(104)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.d(__webpack_exports__,"a",(function(){return _defineProperty}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return _objectSpread2}));var _babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(42);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){Object(_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__.a)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return getContrastRatio})),__webpack_require__.d(__webpack_exports__,"b",(function(){return emphasize})),__webpack_require__.d(__webpack_exports__,"c",(function(){return fade})),__webpack_require__.d(__webpack_exports__,"a",(function(){return darken})),__webpack_require__.d(__webpack_exports__,"e",(function(){return lighten}));var _material_ui_utils__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(92);function clamp(value){var min=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,max=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(min,value),max)}function decomposeColor(color){if(color.type)return color;if("#"===color.charAt(0))return decomposeColor(function(color){color=color.substr(1);var re=new RegExp(".{1,".concat(color.length>=6?2:1,"}"),"g"),colors=color.match(re);return colors&&1===colors[0].length&&(colors=colors.map((function(n){return n+n}))),colors?"rgb".concat(4===colors.length?"a":"","(").concat(colors.map((function(n,index){return index<3?parseInt(n,16):Math.round(parseInt(n,16)/255*1e3)/1e3})).join(", "),")"):""}(color));var marker=color.indexOf("("),type=color.substring(0,marker);if(-1===["rgb","rgba","hsl","hsla"].indexOf(type))throw new Error(Object(_material_ui_utils__WEBPACK_IMPORTED_MODULE_0__.a)(3,color));var values=color.substring(marker+1,color.length-1).split(",");return{type:type,values:values=values.map((function(value){return parseFloat(value)}))}}function recomposeColor(color){var type=color.type,values=color.values;return-1!==type.indexOf("rgb")?values=values.map((function(n,i){return i<3?parseInt(n,10):n})):-1!==type.indexOf("hsl")&&(values[1]="".concat(values[1],"%"),values[2]="".concat(values[2],"%")),"".concat(type,"(").concat(values.join(", "),")")}function getContrastRatio(foreground,background){var lumA=getLuminance(foreground),lumB=getLuminance(background);return(Math.max(lumA,lumB)+.05)/(Math.min(lumA,lumB)+.05)}function getLuminance(color){var rgb="hsl"===(color=decomposeColor(color)).type?decomposeColor(function(color){var values=(color=decomposeColor(color)).values,h=values[0],s=values[1]/100,l=values[2]/100,a=s*Math.min(l,1-l),f=function(n){var k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(n+h/30)%12;return l-a*Math.max(Math.min(k-3,9-k,1),-1)},type="rgb",rgb=[Math.round(255*f(0)),Math.round(255*f(8)),Math.round(255*f(4))];return"hsla"===color.type&&(type+="a",rgb.push(values[3])),recomposeColor({type:type,values:rgb})}(color)).values:color.values;return rgb=rgb.map((function(val){return(val/=255)<=.03928?val/12.92:Math.pow((val+.055)/1.055,2.4)})),Number((.2126*rgb[0]+.7152*rgb[1]+.0722*rgb[2]).toFixed(3))}function emphasize(color){var coefficient=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;return getLuminance(color)>.5?darken(color,coefficient):lighten(color,coefficient)}function fade(color,value){return color=decomposeColor(color),value=clamp(value),"rgb"!==color.type&&"hsl"!==color.type||(color.type+="a"),color.values[3]=value,recomposeColor(color)}function darken(color,coefficient){if(color=decomposeColor(color),coefficient=clamp(coefficient),-1!==color.type.indexOf("hsl"))color.values[2]*=1-coefficient;else if(-1!==color.type.indexOf("rgb"))for(var i=0;i<3;i+=1)color.values[i]*=1-coefficient;return recomposeColor(color)}function lighten(color,coefficient){if(color=decomposeColor(color),coefficient=clamp(coefficient),-1!==color.type.indexOf("hsl"))color.values[2]+=(100-color.values[2])*coefficient;else if(-1!==color.type.indexOf("rgb"))for(var i=0;i<3;i+=1)color.values[i]+=(255-color.values[i])*coefficient;return recomposeColor(color)}},function(module,__webpack_exports__,__webpack_require__){"use strict";function ownerDocument(node){return node&&node.ownerDocument||document}__webpack_require__.d(__webpack_exports__,"a",(function(){return ownerDocument}))},function(module,exports){module.exports=function(obj){return obj&&obj.__esModule?obj:{default:obj}}},function(module,exports,__webpack_require__){var _typeof=__webpack_require__(113);function _getRequireWildcardCache(){if("function"!==typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}module.exports=function(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!==typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _utils.createSvgIcon}});var _utils=__webpack_require__(37)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useEventCallback}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),useEnhancedEffect="undefined"!==typeof window?react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect:react__WEBPACK_IMPORTED_MODULE_0__.useEffect;function useEventCallback(fn){var ref=react__WEBPACK_IMPORTED_MODULE_0__.useRef(fn);return useEnhancedEffect((function(){ref.current=fn})),react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(){return ref.current.apply(void 0,arguments)}),[])}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return _toConsumableArray}));var arrayLikeToArray=__webpack_require__(55);var unsupportedIterableToArray=__webpack_require__(49);function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return Object(arrayLikeToArray.a)(arr)}(arr)||function(iter){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}(arr)||Object(unsupportedIterableToArray.a)(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(module,__webpack_exports__,__webpack_require__){"use strict";function formControlState(_ref){var props=_ref.props,states=_ref.states,muiFormControl=_ref.muiFormControl;return states.reduce((function(acc,state){return acc[state]=props[state],muiFormControl&&"undefined"===typeof props[state]&&(acc[state]=muiFormControl[state]),acc}),{})}__webpack_require__.d(__webpack_exports__,"a",(function(){return formControlState}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useFormControl}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_FormControlContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(40);function useFormControl(){return react__WEBPACK_IMPORTED_MODULE_0__.useContext(_FormControlContext__WEBPACK_IMPORTED_MODULE_1__.a)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return duration}));var _babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),easing={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},duration={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function formatMs(milliseconds){return"".concat(Math.round(milliseconds),"ms")}__webpack_exports__.a={easing:easing,duration:duration,create:function(){var props=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_options$duration=options.duration,durationOption=void 0===_options$duration?duration.standard:_options$duration,_options$easing=options.easing,easingOption=void 0===_options$easing?easing.easeInOut:_options$easing,_options$delay=options.delay,delay=void 0===_options$delay?0:_options$delay;Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__.a)(options,["duration","easing","delay"]);return(Array.isArray(props)?props:[props]).map((function(animatedProp){return"".concat(animatedProp," ").concat("string"===typeof durationOption?durationOption:formatMs(durationOption)," ").concat(easingOption," ").concat("string"===typeof delay?delay:formatMs(delay))})).join(",")},getAutoHeightDuration:function(height){if(!height)return 0;var constant=height/36;return Math.round(10*(4+15*Math.pow(constant,.25)+constant/5))}}},,function(module,__webpack_exports__,__webpack_require__){"use strict";function setRef(ref,value){"function"===typeof ref?ref(value):ref&&(ref.current=value)}__webpack_require__.d(__webpack_exports__,"a",(function(){return setRef}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function createChainedFunction(){for(var _len=arguments.length,funcs=new Array(_len),_key=0;_key<_len;_key++)funcs[_key]=arguments[_key];return funcs.reduce((function(acc,func){return null==func?acc:function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];acc.apply(this,args),func.apply(this,args)}}),(function(){}))}__webpack_require__.d(__webpack_exports__,"a",(function(){return createChainedFunction}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return _slicedToArray}));var arrayWithHoles=__webpack_require__(80);var unsupportedIterableToArray=__webpack_require__(61),nonIterableRest=__webpack_require__(81);function _slicedToArray(arr,i){return Object(arrayWithHoles.a)(arr)||function(arr,i){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,i)||Object(unsupportedIterableToArray.a)(arr,i)||Object(nonIterableRest.a)()}},function(module,__webpack_exports__,__webpack_require__){"use strict";var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),ListContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext({});__webpack_exports__.a=ListContext},,function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8),defaultVariantMapping={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p"},Typography=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var _props$align=props.align,align=void 0===_props$align?"inherit":_props$align,classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"initial":_props$color,component=props.component,_props$display=props.display,display=void 0===_props$display?"initial":_props$display,_props$gutterBottom=props.gutterBottom,gutterBottom=void 0!==_props$gutterBottom&&_props$gutterBottom,_props$noWrap=props.noWrap,noWrap=void 0!==_props$noWrap&&_props$noWrap,_props$paragraph=props.paragraph,paragraph=void 0!==_props$paragraph&&_props$paragraph,_props$variant=props.variant,variant=void 0===_props$variant?"body1":_props$variant,_props$variantMapping=props.variantMapping,variantMapping=void 0===_props$variantMapping?defaultVariantMapping:_props$variantMapping,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["align","classes","className","color","component","display","gutterBottom","noWrap","paragraph","variant","variantMapping"]),Component=component||(paragraph?"p":variantMapping[variant]||defaultVariantMapping[variant])||"span";return react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,"inherit"!==variant&&classes[variant],"initial"!==color&&classes["color".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__.a)(color))],noWrap&&classes.noWrap,gutterBottom&&classes.gutterBottom,paragraph&&classes.paragraph,"inherit"!==align&&classes["align".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__.a)(align))],"initial"!==display&&classes["display".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__.a)(display))]),ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){return{root:{margin:0},body2:theme.typography.body2,body1:theme.typography.body1,caption:theme.typography.caption,button:theme.typography.button,h1:theme.typography.h1,h2:theme.typography.h2,h3:theme.typography.h3,h4:theme.typography.h4,h5:theme.typography.h5,h6:theme.typography.h6,subtitle1:theme.typography.subtitle1,subtitle2:theme.typography.subtitle2,overline:theme.typography.overline,srOnly:{position:"absolute",height:1,width:1,overflow:"hidden"},alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"},alignJustify:{textAlign:"justify"},noWrap:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},gutterBottom:{marginBottom:"0.35em"},paragraph:{marginBottom:16},colorInherit:{color:"inherit"},colorPrimary:{color:theme.palette.primary.main},colorSecondary:{color:theme.palette.secondary.main},colorTextPrimary:{color:theme.palette.text.primary},colorTextSecondary:{color:theme.palette.text.secondary},colorError:{color:theme.palette.error.main},displayInline:{display:"inline"},displayBlock:{display:"block"}}}),{name:"MuiTypography"})(Typography)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}__webpack_require__.d(__webpack_exports__,"a",(function(){return _objectWithoutPropertiesLoose}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useTheme}));var _material_ui_styles__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(117),_defaultTheme__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__(1),__webpack_require__(50));function useTheme(){return Object(_material_ui_styles__WEBPACK_IMPORTED_MODULE_0__.a)()||_defaultTheme__WEBPACK_IMPORTED_MODULE_2__.a}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return isMuiElement}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function isMuiElement(element,muiNames){return react__WEBPACK_IMPORTED_MODULE_0__.isValidElement(element)&&-1!==muiNames.indexOf(element.type.muiName)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return _toConsumableArray}));var arrayLikeToArray=__webpack_require__(57);var iterableToArray=__webpack_require__(79),unsupportedIterableToArray=__webpack_require__(61);function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return Object(arrayLikeToArray.a)(arr)}(arr)||Object(iterableToArray.a)(arr)||Object(unsupportedIterableToArray.a)(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return reflow})),__webpack_require__.d(__webpack_exports__,"a",(function(){return getTransitionProps}));var reflow=function(node){return node.scrollTop};function getTransitionProps(props,options){var timeout=props.timeout,_props$style=props.style,style=void 0===_props$style?{}:_props$style;return{duration:style.transitionDuration||"number"===typeof timeout?timeout:timeout[options.mode]||0,delay:style.transitionDelay}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"capitalize",(function(){return capitalize.a})),__webpack_require__.d(__webpack_exports__,"createChainedFunction",(function(){return createChainedFunction.a})),__webpack_require__.d(__webpack_exports__,"createSvgIcon",(function(){return createSvgIcon.a})),__webpack_require__.d(__webpack_exports__,"debounce",(function(){return debounce.a})),__webpack_require__.d(__webpack_exports__,"deprecatedPropType",(function(){return deprecatedPropType})),__webpack_require__.d(__webpack_exports__,"isMuiElement",(function(){return isMuiElement.a})),__webpack_require__.d(__webpack_exports__,"ownerDocument",(function(){return ownerDocument.a})),__webpack_require__.d(__webpack_exports__,"ownerWindow",(function(){return ownerWindow.a})),__webpack_require__.d(__webpack_exports__,"requirePropFactory",(function(){return requirePropFactory.a})),__webpack_require__.d(__webpack_exports__,"setRef",(function(){return setRef.a})),__webpack_require__.d(__webpack_exports__,"unsupportedProp",(function(){return unsupportedProp.a})),__webpack_require__.d(__webpack_exports__,"useControlled",(function(){return useControlled.a})),__webpack_require__.d(__webpack_exports__,"useEventCallback",(function(){return useEventCallback.a})),__webpack_require__.d(__webpack_exports__,"useForkRef",(function(){return useForkRef.a})),__webpack_require__.d(__webpack_exports__,"unstable_useId",(function(){return useId})),__webpack_require__.d(__webpack_exports__,"useIsFocusVisible",(function(){return useIsFocusVisible.a}));var capitalize=__webpack_require__(8),createChainedFunction=__webpack_require__(27),createSvgIcon=__webpack_require__(48),debounce=__webpack_require__(45);function deprecatedPropType(validator,reason){return function(){return null}}var isMuiElement=__webpack_require__(34),ownerDocument=__webpack_require__(16),ownerWindow=__webpack_require__(47),requirePropFactory=__webpack_require__(69),setRef=__webpack_require__(26),unsupportedProp=__webpack_require__(70),useControlled=__webpack_require__(46),useEventCallback=__webpack_require__(20),useForkRef=__webpack_require__(11),react=__webpack_require__(1);function useId(idOverride){var _React$useState=react.useState(idOverride),defaultId=_React$useState[0],setDefaultId=_React$useState[1],id=idOverride||defaultId;return react.useEffect((function(){null==defaultId&&setDefaultId("mui-".concat(Math.round(1e5*Math.random())))}),[defaultId]),id}var useIsFocusVisible=__webpack_require__(60)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}__webpack_require__.d(__webpack_exports__,"a",(function(){return _typeof}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}__webpack_require__.d(__webpack_exports__,"a",(function(){return _inheritsLoose}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return useFormControl}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),FormControlContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext();function useFormControl(){return react__WEBPACK_IMPORTED_MODULE_0__.useContext(FormControlContext)}__webpack_exports__.a=FormControlContext},function(module,__webpack_exports__,__webpack_require__){"use strict";function hasValue(value){return null!=value&&!(Array.isArray(value)&&0===value.length)}function isFilled(obj){var SSR=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return obj&&(hasValue(obj.value)&&""!==obj.value||SSR&&hasValue(obj.defaultValue)&&""!==obj.defaultValue)}function isAdornedStart(obj){return obj.startAdornment}__webpack_require__.d(__webpack_exports__,"b",(function(){return isFilled})),__webpack_require__.d(__webpack_exports__,"a",(function(){return isAdornedStart}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.d(__webpack_exports__,"a",(function(){return _defineProperty}))},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"}),"Phone");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"}),"CallEnd");exports.default=_default},function(module,__webpack_exports__,__webpack_require__){"use strict";function debounce(func){var timeout,wait=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function debounced(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var that=this,later=function(){func.apply(that,args)};clearTimeout(timeout),timeout=setTimeout(later,wait)}return debounced.clear=function(){clearTimeout(timeout)},debounced}__webpack_require__.d(__webpack_exports__,"a",(function(){return debounce}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useControlled}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function useControlled(_ref){var controlled=_ref.controlled,defaultProp=_ref.default,isControlled=(_ref.name,_ref.state,react__WEBPACK_IMPORTED_MODULE_0__.useRef(void 0!==controlled).current),_React$useState=react__WEBPACK_IMPORTED_MODULE_0__.useState(defaultProp),valueState=_React$useState[0],setValue=_React$useState[1];return[isControlled?controlled:valueState,react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(newValue){isControlled||setValue(newValue)}),[])]}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ownerWindow}));var _ownerDocument__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(16);function ownerWindow(node){return Object(_ownerDocument__WEBPACK_IMPORTED_MODULE_0__.a)(node).defaultView||window}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return createSvgIcon}));var esm_extends=__webpack_require__(2),react=__webpack_require__(1),react_default=__webpack_require__.n(react),objectWithoutProperties=__webpack_require__(3),clsx_m=(__webpack_require__(6),__webpack_require__(4)),withStyles=__webpack_require__(5),capitalize=__webpack_require__(8),SvgIcon_SvgIcon=react.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"inherit":_props$color,_props$component=props.component,Component=void 0===_props$component?"svg":_props$component,_props$fontSize=props.fontSize,fontSize=void 0===_props$fontSize?"default":_props$fontSize,htmlColor=props.htmlColor,titleAccess=props.titleAccess,_props$viewBox=props.viewBox,viewBox=void 0===_props$viewBox?"0 0 24 24":_props$viewBox,other=Object(objectWithoutProperties.a)(props,["children","classes","className","color","component","fontSize","htmlColor","titleAccess","viewBox"]);return react.createElement(Component,Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,className,"inherit"!==color&&classes["color".concat(Object(capitalize.a)(color))],"default"!==fontSize&&classes["fontSize".concat(Object(capitalize.a)(fontSize))]),focusable:"false",viewBox:viewBox,color:htmlColor,"aria-hidden":!titleAccess||void 0,role:titleAccess?"img":void 0,ref:ref},other),children,titleAccess?react.createElement("title",null,titleAccess):null)}));SvgIcon_SvgIcon.muiName="SvgIcon";var esm_SvgIcon_SvgIcon=Object(withStyles.a)((function(theme){return{root:{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,fontSize:theme.typography.pxToRem(24),transition:theme.transitions.create("fill",{duration:theme.transitions.duration.shorter})},colorPrimary:{color:theme.palette.primary.main},colorSecondary:{color:theme.palette.secondary.main},colorAction:{color:theme.palette.action.active},colorError:{color:theme.palette.error.main},colorDisabled:{color:theme.palette.action.disabled},fontSizeInherit:{fontSize:"inherit"},fontSizeSmall:{fontSize:theme.typography.pxToRem(20)},fontSizeLarge:{fontSize:theme.typography.pxToRem(35)}}}),{name:"MuiSvgIcon"})(SvgIcon_SvgIcon);function createSvgIcon(path,displayName){var Component=function(props,ref){return react_default.a.createElement(esm_SvgIcon_SvgIcon,Object(esm_extends.a)({ref:ref},props),path)};return Component.muiName=esm_SvgIcon_SvgIcon.muiName,react_default.a.memo(react_default.a.forwardRef(Component))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return _unsupportedIterableToArray}));var _babel_runtime_helpers_esm_arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(55);function _unsupportedIterableToArray(o,minLen){if(o){if("string"===typeof o)return Object(_babel_runtime_helpers_esm_arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__.a)(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(_babel_runtime_helpers_esm_arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__.a)(o,minLen):void 0}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var defineProperty=__webpack_require__(13),objectWithoutProperties=__webpack_require__(3),deepmerge=__webpack_require__(149),esm_extends=__webpack_require__(2),keys=["xs","sm","md","lg","xl"];function createBreakpoints(breakpoints){var _breakpoints$values=breakpoints.values,values=void 0===_breakpoints$values?{xs:0,sm:600,md:960,lg:1280,xl:1920}:_breakpoints$values,_breakpoints$unit=breakpoints.unit,unit=void 0===_breakpoints$unit?"px":_breakpoints$unit,_breakpoints$step=breakpoints.step,step=void 0===_breakpoints$step?5:_breakpoints$step,other=Object(objectWithoutProperties.a)(breakpoints,["values","unit","step"]);function up(key){var value="number"===typeof values[key]?values[key]:key;return"@media (min-width:".concat(value).concat(unit,")")}function between(start,end){var endIndex=keys.indexOf(end);return endIndex===keys.length-1?up(start):"@media (min-width:".concat("number"===typeof values[start]?values[start]:start).concat(unit,") and ")+"(max-width:".concat((-1!==endIndex&&"number"===typeof values[keys[endIndex+1]]?values[keys[endIndex+1]]:end)-step/100).concat(unit,")")}return Object(esm_extends.a)({keys:keys,values:values,up:up,down:function(key){var endIndex=keys.indexOf(key)+1,upperbound=values[keys[endIndex]];return endIndex===keys.length?up("xs"):"@media (max-width:".concat(("number"===typeof upperbound&&endIndex>0?upperbound:key)-step/100).concat(unit,")")},between:between,only:function(key){return between(key,key)},width:function(key){return values[key]}},other)}function createMixins(breakpoints,spacing,mixins){var _toolbar;return Object(esm_extends.a)({gutters:function(){var styles=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(esm_extends.a)({paddingLeft:spacing(2),paddingRight:spacing(2)},styles,Object(defineProperty.a)({},breakpoints.up("sm"),Object(esm_extends.a)({paddingLeft:spacing(3),paddingRight:spacing(3)},styles[breakpoints.up("sm")])))},toolbar:(_toolbar={minHeight:56},Object(defineProperty.a)(_toolbar,"".concat(breakpoints.up("xs")," and (orientation: landscape)"),{minHeight:48}),Object(defineProperty.a)(_toolbar,breakpoints.up("sm"),{minHeight:64}),_toolbar)},mixins)}var formatMuiErrorMessage=__webpack_require__(92),colors_common={black:"#000",white:"#fff"},colors_grey={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"},colors_indigo={50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",A100:"#8c9eff",A200:"#536dfe",A400:"#3d5afe",A700:"#304ffe"},colors_pink={50:"#fce4ec",100:"#f8bbd0",200:"#f48fb1",300:"#f06292",400:"#ec407a",500:"#e91e63",600:"#d81b60",700:"#c2185b",800:"#ad1457",900:"#880e4f",A100:"#ff80ab",A200:"#ff4081",A400:"#f50057",A700:"#c51162"},colors_red={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},colors_orange={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},colors_blue={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},colors_green={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},colorManipulator=__webpack_require__(15),light={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:colors_common.white,default:colors_grey[50]},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},dark={text:{primary:colors_common.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",hint:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:colors_grey[800],default:"#303030"},action:{active:colors_common.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function addLightOrDark(intent,direction,shade,tonalOffset){var tonalOffsetLight=tonalOffset.light||tonalOffset,tonalOffsetDark=tonalOffset.dark||1.5*tonalOffset;intent[direction]||(intent.hasOwnProperty(shade)?intent[direction]=intent[shade]:"light"===direction?intent.light=Object(colorManipulator.e)(intent.main,tonalOffsetLight):"dark"===direction&&(intent.dark=Object(colorManipulator.a)(intent.main,tonalOffsetDark)))}function createPalette(palette){var _palette$primary=palette.primary,primary=void 0===_palette$primary?{light:colors_indigo[300],main:colors_indigo[500],dark:colors_indigo[700]}:_palette$primary,_palette$secondary=palette.secondary,secondary=void 0===_palette$secondary?{light:colors_pink.A200,main:colors_pink.A400,dark:colors_pink.A700}:_palette$secondary,_palette$error=palette.error,error=void 0===_palette$error?{light:colors_red[300],main:colors_red[500],dark:colors_red[700]}:_palette$error,_palette$warning=palette.warning,warning=void 0===_palette$warning?{light:colors_orange[300],main:colors_orange[500],dark:colors_orange[700]}:_palette$warning,_palette$info=palette.info,info=void 0===_palette$info?{light:colors_blue[300],main:colors_blue[500],dark:colors_blue[700]}:_palette$info,_palette$success=palette.success,success=void 0===_palette$success?{light:colors_green[300],main:colors_green[500],dark:colors_green[700]}:_palette$success,_palette$type=palette.type,type=void 0===_palette$type?"light":_palette$type,_palette$contrastThre=palette.contrastThreshold,contrastThreshold=void 0===_palette$contrastThre?3:_palette$contrastThre,_palette$tonalOffset=palette.tonalOffset,tonalOffset=void 0===_palette$tonalOffset?.2:_palette$tonalOffset,other=Object(objectWithoutProperties.a)(palette,["primary","secondary","error","warning","info","success","type","contrastThreshold","tonalOffset"]);function getContrastText(background){return Object(colorManipulator.d)(background,dark.text.primary)>=contrastThreshold?dark.text.primary:light.text.primary}var augmentColor=function(color){var mainShade=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,lightShade=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,darkShade=arguments.length>3&&void 0!==arguments[3]?arguments[3]:700;if(!(color=Object(esm_extends.a)({},color)).main&&color[mainShade]&&(color.main=color[mainShade]),!color.main)throw new Error(Object(formatMuiErrorMessage.a)(4,mainShade));if("string"!==typeof color.main)throw new Error(Object(formatMuiErrorMessage.a)(5,JSON.stringify(color.main)));return addLightOrDark(color,"light",lightShade,tonalOffset),addLightOrDark(color,"dark",darkShade,tonalOffset),color.contrastText||(color.contrastText=getContrastText(color.main)),color},types={dark:dark,light:light};return Object(deepmerge.a)(Object(esm_extends.a)({common:colors_common,type:type,primary:augmentColor(primary),secondary:augmentColor(secondary,"A400","A200","A700"),error:augmentColor(error),warning:augmentColor(warning),info:augmentColor(info),success:augmentColor(success),grey:colors_grey,contrastThreshold:contrastThreshold,getContrastText:getContrastText,augmentColor:augmentColor,tonalOffset:tonalOffset},types[type]),other)}function round(value){return Math.round(1e5*value)/1e5}var caseAllCaps={textTransform:"uppercase"};function createTypography(palette,typography){var _ref="function"===typeof typography?typography(palette):typography,_ref$fontFamily=_ref.fontFamily,fontFamily=void 0===_ref$fontFamily?'"Roboto", "Helvetica", "Arial", sans-serif':_ref$fontFamily,_ref$fontSize=_ref.fontSize,fontSize=void 0===_ref$fontSize?14:_ref$fontSize,_ref$fontWeightLight=_ref.fontWeightLight,fontWeightLight=void 0===_ref$fontWeightLight?300:_ref$fontWeightLight,_ref$fontWeightRegula=_ref.fontWeightRegular,fontWeightRegular=void 0===_ref$fontWeightRegula?400:_ref$fontWeightRegula,_ref$fontWeightMedium=_ref.fontWeightMedium,fontWeightMedium=void 0===_ref$fontWeightMedium?500:_ref$fontWeightMedium,_ref$fontWeightBold=_ref.fontWeightBold,fontWeightBold=void 0===_ref$fontWeightBold?700:_ref$fontWeightBold,_ref$htmlFontSize=_ref.htmlFontSize,htmlFontSize=void 0===_ref$htmlFontSize?16:_ref$htmlFontSize,allVariants=_ref.allVariants,pxToRem2=_ref.pxToRem,other=Object(objectWithoutProperties.a)(_ref,["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"]);var coef=fontSize/14,pxToRem=pxToRem2||function(size){return"".concat(size/htmlFontSize*coef,"rem")},buildVariant=function(fontWeight,size,lineHeight,letterSpacing,casing){return Object(esm_extends.a)({fontFamily:fontFamily,fontWeight:fontWeight,fontSize:pxToRem(size),lineHeight:lineHeight},'"Roboto", "Helvetica", "Arial", sans-serif'===fontFamily?{letterSpacing:"".concat(round(letterSpacing/size),"em")}:{},casing,allVariants)},variants={h1:buildVariant(fontWeightLight,96,1.167,-1.5),h2:buildVariant(fontWeightLight,60,1.2,-.5),h3:buildVariant(fontWeightRegular,48,1.167,0),h4:buildVariant(fontWeightRegular,34,1.235,.25),h5:buildVariant(fontWeightRegular,24,1.334,0),h6:buildVariant(fontWeightMedium,20,1.6,.15),subtitle1:buildVariant(fontWeightRegular,16,1.75,.15),subtitle2:buildVariant(fontWeightMedium,14,1.57,.1),body1:buildVariant(fontWeightRegular,16,1.5,.15),body2:buildVariant(fontWeightRegular,14,1.43,.15),button:buildVariant(fontWeightMedium,14,1.75,.4,caseAllCaps),caption:buildVariant(fontWeightRegular,12,1.66,.4),overline:buildVariant(fontWeightRegular,12,2.66,1,caseAllCaps)};return Object(deepmerge.a)(Object(esm_extends.a)({htmlFontSize:htmlFontSize,pxToRem:pxToRem,round:round,fontFamily:fontFamily,fontSize:fontSize,fontWeightLight:fontWeightLight,fontWeightRegular:fontWeightRegular,fontWeightMedium:fontWeightMedium,fontWeightBold:fontWeightBold},variants),other,{clone:!1})}function createShadow(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}var styles_shadows=["none",createShadow(0,2,1,-1,0,1,1,0,0,1,3,0),createShadow(0,3,1,-2,0,2,2,0,0,1,5,0),createShadow(0,3,3,-2,0,3,4,0,0,1,8,0),createShadow(0,2,4,-1,0,4,5,0,0,1,10,0),createShadow(0,3,5,-1,0,5,8,0,0,1,14,0),createShadow(0,3,5,-1,0,6,10,0,0,1,18,0),createShadow(0,4,5,-2,0,7,10,1,0,2,16,1),createShadow(0,5,5,-3,0,8,10,1,0,3,14,2),createShadow(0,5,6,-3,0,9,12,1,0,3,16,2),createShadow(0,6,6,-3,0,10,14,1,0,4,18,3),createShadow(0,6,7,-4,0,11,15,1,0,4,20,3),createShadow(0,7,8,-4,0,12,17,2,0,5,22,4),createShadow(0,7,8,-4,0,13,19,2,0,5,24,4),createShadow(0,7,9,-4,0,14,21,2,0,5,26,4),createShadow(0,8,9,-5,0,15,22,2,0,6,28,5),createShadow(0,8,10,-5,0,16,24,2,0,6,30,5),createShadow(0,8,11,-5,0,17,26,2,0,6,32,5),createShadow(0,9,11,-5,0,18,28,2,0,7,34,6),createShadow(0,9,12,-6,0,19,29,2,0,7,36,6),createShadow(0,10,13,-6,0,20,31,3,0,8,38,7),createShadow(0,10,13,-6,0,21,33,3,0,8,40,7),createShadow(0,10,14,-6,0,22,35,3,0,8,42,7),createShadow(0,11,14,-7,0,23,36,3,0,9,44,8),createShadow(0,11,15,-7,0,24,38,3,0,9,46,8)],styles_shape={borderRadius:4},slicedToArray=__webpack_require__(28),esm_typeof=(__webpack_require__(35),__webpack_require__(38));__webpack_require__(6);var esm_merge=function(acc,item){return item?Object(deepmerge.a)(acc,item,{clone:!1}):acc},breakpoints_values={xs:0,sm:600,md:960,lg:1280,xl:1920},defaultBreakpoints={keys:["xs","sm","md","lg","xl"],up:function(key){return"@media (min-width:".concat(breakpoints_values[key],"px)")}};var properties={m:"margin",p:"padding"},directions={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},aliases={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},getCssProperties=function(fn){var cache={};return function(arg){return void 0===cache[arg]&&(cache[arg]=fn(arg)),cache[arg]}}((function(prop){if(prop.length>2){if(!aliases[prop])return[prop];prop=aliases[prop]}var _prop$split=prop.split(""),_prop$split2=Object(slicedToArray.a)(_prop$split,2),a=_prop$split2[0],b=_prop$split2[1],property=properties[a],direction=directions[b]||"";return Array.isArray(direction)?direction.map((function(dir){return property+dir})):[property+direction]})),spacingKeys=["m","mt","mr","mb","ml","mx","my","p","pt","pr","pb","pl","px","py","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY"];function createUnarySpacing(theme){var themeSpacing=theme.spacing||8;return"number"===typeof themeSpacing?function(abs){return themeSpacing*abs}:Array.isArray(themeSpacing)?function(abs){return themeSpacing[abs]}:"function"===typeof themeSpacing?themeSpacing:function(){}}function getStyleFromPropValue(cssProperties,transformer){return function(propValue){return cssProperties.reduce((function(acc,cssProperty){return acc[cssProperty]=function(transformer,propValue){if("string"===typeof propValue||null==propValue)return propValue;var transformed=transformer(Math.abs(propValue));return propValue>=0?transformed:"number"===typeof transformed?-transformed:"-".concat(transformed)}(transformer,propValue),acc}),{})}}function spacing_spacing(props){var transformer=createUnarySpacing(props.theme);return Object.keys(props).map((function(prop){if(-1===spacingKeys.indexOf(prop))return null;var styleFromPropValue=getStyleFromPropValue(getCssProperties(prop),transformer),propValue=props[prop];return function(props,propValue,styleFromPropValue){if(Array.isArray(propValue)){var themeBreakpoints=props.theme.breakpoints||defaultBreakpoints;return propValue.reduce((function(acc,item,index){return acc[themeBreakpoints.up(themeBreakpoints.keys[index])]=styleFromPropValue(propValue[index]),acc}),{})}if("object"===Object(esm_typeof.a)(propValue)){var _themeBreakpoints=props.theme.breakpoints||defaultBreakpoints;return Object.keys(propValue).reduce((function(acc,breakpoint){return acc[_themeBreakpoints.up(breakpoint)]=styleFromPropValue(propValue[breakpoint]),acc}),{})}return styleFromPropValue(propValue)}(props,propValue,styleFromPropValue)})).reduce(esm_merge,{})}spacing_spacing.propTypes={},spacing_spacing.filterProps=spacingKeys;function createSpacing(){var spacingInput=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(spacingInput.mui)return spacingInput;var transform=createUnarySpacing({spacing:spacingInput}),spacing=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return 0===args.length?transform(1):1===args.length?transform(args[0]):args.map((function(argument){if("string"===typeof argument)return argument;var output=transform(argument);return"number"===typeof output?"".concat(output,"px"):output})).join(" ")};return Object.defineProperty(spacing,"unit",{get:function(){return spacingInput}}),spacing.mui=!0,spacing}var transitions=__webpack_require__(24),zIndex=__webpack_require__(62);var defaultTheme=function(){for(var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_options$breakpoints=options.breakpoints,breakpointsInput=void 0===_options$breakpoints?{}:_options$breakpoints,_options$mixins=options.mixins,mixinsInput=void 0===_options$mixins?{}:_options$mixins,_options$palette=options.palette,paletteInput=void 0===_options$palette?{}:_options$palette,spacingInput=options.spacing,_options$typography=options.typography,typographyInput=void 0===_options$typography?{}:_options$typography,other=Object(objectWithoutProperties.a)(options,["breakpoints","mixins","palette","spacing","typography"]),palette=createPalette(paletteInput),breakpoints=createBreakpoints(breakpointsInput),spacing=createSpacing(spacingInput),muiTheme=Object(deepmerge.a)({breakpoints:breakpoints,direction:"ltr",mixins:createMixins(breakpoints,spacing,mixinsInput),overrides:{},palette:palette,props:{},shadows:styles_shadows,typography:createTypography(palette,typographyInput),spacing:spacing,shape:styles_shape,transitions:transitions.a,zIndex:zIndex.a},other),_len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];return muiTheme=args.reduce((function(acc,argument){return Object(deepmerge.a)(acc,argument)}),muiTheme)}();__webpack_exports__.a=defaultTheme},function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}__webpack_require__.d(__webpack_exports__,"a",(function(){return _createClass}))},function(module,__webpack_exports__,__webpack_require__){"use strict";var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);__webpack_exports__.a=react__WEBPACK_IMPORTED_MODULE_0___default.a.createContext(null)},,function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(112)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}__webpack_require__.d(__webpack_exports__,"a",(function(){return _arrayLikeToArray}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}__webpack_require__.d(__webpack_exports__,"a",(function(){return _assertThisInitialized}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}__webpack_require__.d(__webpack_exports__,"a",(function(){return _arrayLikeToArray}))},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");exports.default=_default},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useIsFocusVisible}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),react_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12),hadKeyboardEvent=!0,hadFocusVisibleRecently=!1,hadFocusVisibleRecentlyTimeout=null,inputTypesWhitelist={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function handleKeyDown(event){event.metaKey||event.altKey||event.ctrlKey||(hadKeyboardEvent=!0)}function handlePointerDown(){hadKeyboardEvent=!1}function handleVisibilityChange(){"hidden"===this.visibilityState&&hadFocusVisibleRecently&&(hadKeyboardEvent=!0)}function isFocusVisible(event){var target=event.target;try{return target.matches(":focus-visible")}catch(error){}return hadKeyboardEvent||function(node){var type=node.type,tagName=node.tagName;return!("INPUT"!==tagName||!inputTypesWhitelist[type]||node.readOnly)||"TEXTAREA"===tagName&&!node.readOnly||!!node.isContentEditable}(target)}function handleBlurVisible(){hadFocusVisibleRecently=!0,window.clearTimeout(hadFocusVisibleRecentlyTimeout),hadFocusVisibleRecentlyTimeout=window.setTimeout((function(){hadFocusVisibleRecently=!1}),100)}function useIsFocusVisible(){return{isFocusVisible:isFocusVisible,onBlurVisible:handleBlurVisible,ref:react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(instance){var doc,node=react_dom__WEBPACK_IMPORTED_MODULE_1__.findDOMNode(instance);null!=node&&((doc=node.ownerDocument).addEventListener("keydown",handleKeyDown,!0),doc.addEventListener("mousedown",handlePointerDown,!0),doc.addEventListener("pointerdown",handlePointerDown,!0),doc.addEventListener("touchstart",handlePointerDown,!0),doc.addEventListener("visibilitychange",handleVisibilityChange,!0))}),[])}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return _unsupportedIterableToArray}));var _arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(57);function _unsupportedIterableToArray(o,minLen){if(o){if("string"===typeof o)return Object(_arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__.a)(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(_arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__.a)(o,minLen):void 0}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={mobileStepper:1e3,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500}},function(module,__webpack_exports__,__webpack_require__){"use strict";function getScrollbarSize(){var scrollDiv=document.createElement("div");scrollDiv.style.width="99px",scrollDiv.style.height="99px",scrollDiv.style.position="absolute",scrollDiv.style.top="-9999px",scrollDiv.style.overflow="scroll",document.body.appendChild(scrollDiv);var scrollbarSize=scrollDiv.offsetWidth-scrollDiv.clientWidth;return document.body.removeChild(scrollDiv),scrollbarSize}__webpack_require__.d(__webpack_exports__,"a",(function(){return getScrollbarSize}))},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"}),"FormatListBulleted");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"}),"RemoveCircle");exports.default=_default},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),react=__webpack_require__(1),react_default=__webpack_require__.n(react),react_dom=(__webpack_require__(6),__webpack_require__(12)),clsx_m=__webpack_require__(4),useForkRef=__webpack_require__(11),useEventCallback=__webpack_require__(20),withStyles=__webpack_require__(5),useIsFocusVisible=__webpack_require__(60),toConsumableArray=__webpack_require__(35),objectWithoutPropertiesLoose=__webpack_require__(32),assertThisInitialized=__webpack_require__(56),inheritsLoose=__webpack_require__(39),TransitionGroupContext=__webpack_require__(52);function getChildMapping(children,mapFn){var result=Object.create(null);return children&&react.Children.map(children,(function(c){return c})).forEach((function(child){result[child.key]=function(child){return mapFn&&Object(react.isValidElement)(child)?mapFn(child):child}(child)})),result}function getProp(child,prop,props){return null!=props[prop]?props[prop]:child.props[prop]}function getNextChildMapping(nextProps,prevChildMapping,onExited){var nextChildMapping=getChildMapping(nextProps.children),children=function(prev,next){function getValueForKey(key){return key in next?next[key]:prev[key]}prev=prev||{},next=next||{};var i,nextKeysPending=Object.create(null),pendingKeys=[];for(var prevKey in prev)prevKey in next?pendingKeys.length&&(nextKeysPending[prevKey]=pendingKeys,pendingKeys=[]):pendingKeys.push(prevKey);var childMapping={};for(var nextKey in next){if(nextKeysPending[nextKey])for(i=0;i<nextKeysPending[nextKey].length;i++){var pendingNextKey=nextKeysPending[nextKey][i];childMapping[nextKeysPending[nextKey][i]]=getValueForKey(pendingNextKey)}childMapping[nextKey]=getValueForKey(nextKey)}for(i=0;i<pendingKeys.length;i++)childMapping[pendingKeys[i]]=getValueForKey(pendingKeys[i]);return childMapping}(prevChildMapping,nextChildMapping);return Object.keys(children).forEach((function(key){var child=children[key];if(Object(react.isValidElement)(child)){var hasPrev=key in prevChildMapping,hasNext=key in nextChildMapping,prevChild=prevChildMapping[key],isLeaving=Object(react.isValidElement)(prevChild)&&!prevChild.props.in;!hasNext||hasPrev&&!isLeaving?hasNext||!hasPrev||isLeaving?hasNext&&hasPrev&&Object(react.isValidElement)(prevChild)&&(children[key]=Object(react.cloneElement)(child,{onExited:onExited.bind(null,child),in:prevChild.props.in,exit:getProp(child,"exit",nextProps),enter:getProp(child,"enter",nextProps)})):children[key]=Object(react.cloneElement)(child,{in:!1}):children[key]=Object(react.cloneElement)(child,{onExited:onExited.bind(null,child),in:!0,exit:getProp(child,"exit",nextProps),enter:getProp(child,"enter",nextProps)})}})),children}var values=Object.values||function(obj){return Object.keys(obj).map((function(k){return obj[k]}))},TransitionGroup_TransitionGroup=function(_React$Component){function TransitionGroup(props,context){var _this,handleExited=(_this=_React$Component.call(this,props,context)||this).handleExited.bind(Object(assertThisInitialized.a)(_this));return _this.state={contextValue:{isMounting:!0},handleExited:handleExited,firstRender:!0},_this}Object(inheritsLoose.a)(TransitionGroup,_React$Component);var _proto=TransitionGroup.prototype;return _proto.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},_proto.componentWillUnmount=function(){this.mounted=!1},TransitionGroup.getDerivedStateFromProps=function(nextProps,_ref){var props,onExited,prevChildMapping=_ref.children,handleExited=_ref.handleExited;return{children:_ref.firstRender?(props=nextProps,onExited=handleExited,getChildMapping(props.children,(function(child){return Object(react.cloneElement)(child,{onExited:onExited.bind(null,child),in:!0,appear:getProp(child,"appear",props),enter:getProp(child,"enter",props),exit:getProp(child,"exit",props)})}))):getNextChildMapping(nextProps,prevChildMapping,handleExited),firstRender:!1}},_proto.handleExited=function(child,node){var currentChildMapping=getChildMapping(this.props.children);child.key in currentChildMapping||(child.props.onExited&&child.props.onExited(node),this.mounted&&this.setState((function(state){var children=Object(esm_extends.a)({},state.children);return delete children[child.key],{children:children}})))},_proto.render=function(){var _this$props=this.props,Component=_this$props.component,childFactory=_this$props.childFactory,props=Object(objectWithoutPropertiesLoose.a)(_this$props,["component","childFactory"]),contextValue=this.state.contextValue,children=values(this.state.children).map(childFactory);return delete props.appear,delete props.enter,delete props.exit,null===Component?react_default.a.createElement(TransitionGroupContext.a.Provider,{value:contextValue},children):react_default.a.createElement(TransitionGroupContext.a.Provider,{value:contextValue},react_default.a.createElement(Component,props,children))},TransitionGroup}(react_default.a.Component);TransitionGroup_TransitionGroup.propTypes={},TransitionGroup_TransitionGroup.defaultProps={component:"div",childFactory:function(child){return child}};var esm_TransitionGroup=TransitionGroup_TransitionGroup,useEnhancedEffect="undefined"===typeof window?react.useEffect:react.useLayoutEffect;var ButtonBase_Ripple=function(props){var classes=props.classes,_props$pulsate=props.pulsate,pulsate=void 0!==_props$pulsate&&_props$pulsate,rippleX=props.rippleX,rippleY=props.rippleY,rippleSize=props.rippleSize,inProp=props.in,_props$onExited=props.onExited,onExited=void 0===_props$onExited?function(){}:_props$onExited,timeout=props.timeout,_React$useState=react.useState(!1),leaving=_React$useState[0],setLeaving=_React$useState[1],rippleClassName=Object(clsx_m.a)(classes.ripple,classes.rippleVisible,pulsate&&classes.ripplePulsate),rippleStyles={width:rippleSize,height:rippleSize,top:-rippleSize/2+rippleY,left:-rippleSize/2+rippleX},childClassName=Object(clsx_m.a)(classes.child,leaving&&classes.childLeaving,pulsate&&classes.childPulsate),handleExited=Object(useEventCallback.a)(onExited);return useEnhancedEffect((function(){if(!inProp){setLeaving(!0);var timeoutId=setTimeout(handleExited,timeout);return function(){clearTimeout(timeoutId)}}}),[handleExited,inProp,timeout]),react.createElement("span",{className:rippleClassName,style:rippleStyles},react.createElement("span",{className:childClassName}))},TouchRipple_TouchRipple=react.forwardRef((function(props,ref){var _props$center=props.center,centerProp=void 0!==_props$center&&_props$center,classes=props.classes,className=props.className,other=Object(objectWithoutProperties.a)(props,["center","classes","className"]),_React$useState=react.useState([]),ripples=_React$useState[0],setRipples=_React$useState[1],nextKey=react.useRef(0),rippleCallback=react.useRef(null);react.useEffect((function(){rippleCallback.current&&(rippleCallback.current(),rippleCallback.current=null)}),[ripples]);var ignoringMouseDown=react.useRef(!1),startTimer=react.useRef(null),startTimerCommit=react.useRef(null),container=react.useRef(null);react.useEffect((function(){return function(){clearTimeout(startTimer.current)}}),[]);var startCommit=react.useCallback((function(params){var pulsate=params.pulsate,rippleX=params.rippleX,rippleY=params.rippleY,rippleSize=params.rippleSize,cb=params.cb;setRipples((function(oldRipples){return[].concat(Object(toConsumableArray.a)(oldRipples),[react.createElement(ButtonBase_Ripple,{key:nextKey.current,classes:classes,timeout:550,pulsate:pulsate,rippleX:rippleX,rippleY:rippleY,rippleSize:rippleSize})])})),nextKey.current+=1,rippleCallback.current=cb}),[classes]),start=react.useCallback((function(){var event=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},cb=arguments.length>2?arguments[2]:void 0,_options$pulsate=options.pulsate,pulsate=void 0!==_options$pulsate&&_options$pulsate,_options$center=options.center,center=void 0===_options$center?centerProp||options.pulsate:_options$center,_options$fakeElement=options.fakeElement,fakeElement=void 0!==_options$fakeElement&&_options$fakeElement;if("mousedown"===event.type&&ignoringMouseDown.current)ignoringMouseDown.current=!1;else{"touchstart"===event.type&&(ignoringMouseDown.current=!0);var rippleX,rippleY,rippleSize,element=fakeElement?null:container.current,rect=element?element.getBoundingClientRect():{width:0,height:0,left:0,top:0};if(center||0===event.clientX&&0===event.clientY||!event.clientX&&!event.touches)rippleX=Math.round(rect.width/2),rippleY=Math.round(rect.height/2);else{var _ref=event.touches?event.touches[0]:event,clientX=_ref.clientX,clientY=_ref.clientY;rippleX=Math.round(clientX-rect.left),rippleY=Math.round(clientY-rect.top)}if(center)(rippleSize=Math.sqrt((2*Math.pow(rect.width,2)+Math.pow(rect.height,2))/3))%2===0&&(rippleSize+=1);else{var sizeX=2*Math.max(Math.abs((element?element.clientWidth:0)-rippleX),rippleX)+2,sizeY=2*Math.max(Math.abs((element?element.clientHeight:0)-rippleY),rippleY)+2;rippleSize=Math.sqrt(Math.pow(sizeX,2)+Math.pow(sizeY,2))}event.touches?null===startTimerCommit.current&&(startTimerCommit.current=function(){startCommit({pulsate:pulsate,rippleX:rippleX,rippleY:rippleY,rippleSize:rippleSize,cb:cb})},startTimer.current=setTimeout((function(){startTimerCommit.current&&(startTimerCommit.current(),startTimerCommit.current=null)}),80)):startCommit({pulsate:pulsate,rippleX:rippleX,rippleY:rippleY,rippleSize:rippleSize,cb:cb})}}),[centerProp,startCommit]),pulsate=react.useCallback((function(){start({},{pulsate:!0})}),[start]),stop=react.useCallback((function(event,cb){if(clearTimeout(startTimer.current),"touchend"===event.type&&startTimerCommit.current)return event.persist(),startTimerCommit.current(),startTimerCommit.current=null,void(startTimer.current=setTimeout((function(){stop(event,cb)})));startTimerCommit.current=null,setRipples((function(oldRipples){return oldRipples.length>0?oldRipples.slice(1):oldRipples})),rippleCallback.current=cb}),[]);return react.useImperativeHandle(ref,(function(){return{pulsate:pulsate,start:start,stop:stop}}),[pulsate,start,stop]),react.createElement("span",Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,className),ref:container},other),react.createElement(esm_TransitionGroup,{component:null,exit:!0},ripples))})),ButtonBase_TouchRipple=Object(withStyles.a)((function(theme){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(550,"ms ").concat(theme.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(theme.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(550,"ms ").concat(theme.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(theme.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}}),{flip:!1,name:"MuiTouchRipple"})(react.memo(TouchRipple_TouchRipple)),ButtonBase_ButtonBase=react.forwardRef((function(props,ref){var action=props.action,buttonRefProp=props.buttonRef,_props$centerRipple=props.centerRipple,centerRipple=void 0!==_props$centerRipple&&_props$centerRipple,children=props.children,classes=props.classes,className=props.className,_props$component=props.component,component=void 0===_props$component?"button":_props$component,_props$disabled=props.disabled,disabled=void 0!==_props$disabled&&_props$disabled,_props$disableRipple=props.disableRipple,disableRipple=void 0!==_props$disableRipple&&_props$disableRipple,_props$disableTouchRi=props.disableTouchRipple,disableTouchRipple=void 0!==_props$disableTouchRi&&_props$disableTouchRi,_props$focusRipple=props.focusRipple,focusRipple=void 0!==_props$focusRipple&&_props$focusRipple,focusVisibleClassName=props.focusVisibleClassName,onBlur=props.onBlur,onClick=props.onClick,onFocus=props.onFocus,onFocusVisible=props.onFocusVisible,onKeyDown=props.onKeyDown,onKeyUp=props.onKeyUp,onMouseDown=props.onMouseDown,onMouseLeave=props.onMouseLeave,onMouseUp=props.onMouseUp,onTouchEnd=props.onTouchEnd,onTouchMove=props.onTouchMove,onTouchStart=props.onTouchStart,onDragLeave=props.onDragLeave,_props$tabIndex=props.tabIndex,tabIndex=void 0===_props$tabIndex?0:_props$tabIndex,TouchRippleProps=props.TouchRippleProps,_props$type=props.type,type=void 0===_props$type?"button":_props$type,other=Object(objectWithoutProperties.a)(props,["action","buttonRef","centerRipple","children","classes","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","onBlur","onClick","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","onDragLeave","tabIndex","TouchRippleProps","type"]),buttonRef=react.useRef(null);var rippleRef=react.useRef(null),_React$useState=react.useState(!1),focusVisible=_React$useState[0],setFocusVisible=_React$useState[1];disabled&&focusVisible&&setFocusVisible(!1);var _useIsFocusVisible=Object(useIsFocusVisible.a)(),isFocusVisible=_useIsFocusVisible.isFocusVisible,onBlurVisible=_useIsFocusVisible.onBlurVisible,focusVisibleRef=_useIsFocusVisible.ref;function useRippleHandler(rippleAction,eventCallback){var skipRippleAction=arguments.length>2&&void 0!==arguments[2]?arguments[2]:disableTouchRipple;return Object(useEventCallback.a)((function(event){return eventCallback&&eventCallback(event),!skipRippleAction&&rippleRef.current&&rippleRef.current[rippleAction](event),!0}))}react.useImperativeHandle(action,(function(){return{focusVisible:function(){setFocusVisible(!0),buttonRef.current.focus()}}}),[]),react.useEffect((function(){focusVisible&&focusRipple&&!disableRipple&&rippleRef.current.pulsate()}),[disableRipple,focusRipple,focusVisible]);var handleMouseDown=useRippleHandler("start",onMouseDown),handleDragLeave=useRippleHandler("stop",onDragLeave),handleMouseUp=useRippleHandler("stop",onMouseUp),handleMouseLeave=useRippleHandler("stop",(function(event){focusVisible&&event.preventDefault(),onMouseLeave&&onMouseLeave(event)})),handleTouchStart=useRippleHandler("start",onTouchStart),handleTouchEnd=useRippleHandler("stop",onTouchEnd),handleTouchMove=useRippleHandler("stop",onTouchMove),handleBlur=useRippleHandler("stop",(function(event){focusVisible&&(onBlurVisible(event),setFocusVisible(!1)),onBlur&&onBlur(event)}),!1),handleFocus=Object(useEventCallback.a)((function(event){buttonRef.current||(buttonRef.current=event.currentTarget),isFocusVisible(event)&&(setFocusVisible(!0),onFocusVisible&&onFocusVisible(event)),onFocus&&onFocus(event)})),isNonNativeButton=function(){var button=react_dom.findDOMNode(buttonRef.current);return component&&"button"!==component&&!("A"===button.tagName&&button.href)},keydownRef=react.useRef(!1),handleKeyDown=Object(useEventCallback.a)((function(event){focusRipple&&!keydownRef.current&&focusVisible&&rippleRef.current&&" "===event.key&&(keydownRef.current=!0,event.persist(),rippleRef.current.stop(event,(function(){rippleRef.current.start(event)}))),event.target===event.currentTarget&&isNonNativeButton()&&" "===event.key&&event.preventDefault(),onKeyDown&&onKeyDown(event),event.target===event.currentTarget&&isNonNativeButton()&&"Enter"===event.key&&!disabled&&(event.preventDefault(),onClick&&onClick(event))})),handleKeyUp=Object(useEventCallback.a)((function(event){focusRipple&&" "===event.key&&rippleRef.current&&focusVisible&&!event.defaultPrevented&&(keydownRef.current=!1,event.persist(),rippleRef.current.stop(event,(function(){rippleRef.current.pulsate(event)}))),onKeyUp&&onKeyUp(event),onClick&&event.target===event.currentTarget&&isNonNativeButton()&&" "===event.key&&!event.defaultPrevented&&onClick(event)})),ComponentProp=component;"button"===ComponentProp&&other.href&&(ComponentProp="a");var buttonProps={};"button"===ComponentProp?(buttonProps.type=type,buttonProps.disabled=disabled):("a"===ComponentProp&&other.href||(buttonProps.role="button"),buttonProps["aria-disabled"]=disabled);var handleUserRef=Object(useForkRef.a)(buttonRefProp,ref),handleOwnRef=Object(useForkRef.a)(focusVisibleRef,buttonRef),handleRef=Object(useForkRef.a)(handleUserRef,handleOwnRef),_React$useState2=react.useState(!1),mountedState=_React$useState2[0],setMountedState=_React$useState2[1];react.useEffect((function(){setMountedState(!0)}),[]);var enableTouchRipple=mountedState&&!disableRipple&&!disabled;return react.createElement(ComponentProp,Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,className,focusVisible&&[classes.focusVisible,focusVisibleClassName],disabled&&classes.disabled),onBlur:handleBlur,onClick:onClick,onFocus:handleFocus,onKeyDown:handleKeyDown,onKeyUp:handleKeyUp,onMouseDown:handleMouseDown,onMouseLeave:handleMouseLeave,onMouseUp:handleMouseUp,onDragLeave:handleDragLeave,onTouchEnd:handleTouchEnd,onTouchMove:handleTouchMove,onTouchStart:handleTouchStart,ref:handleRef,tabIndex:disabled?-1:tabIndex},buttonProps,other),children,enableTouchRipple?react.createElement(ButtonBase_TouchRipple,Object(esm_extends.a)({ref:rippleRef,center:centerRipple},TouchRippleProps)):null)}));__webpack_exports__.a=Object(withStyles.a)({root:{display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle","-moz-appearance":"none","-webkit-appearance":"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},"&$disabled":{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}},disabled:{},focusVisible:{}},{name:"MuiButtonBase"})(ButtonBase_ButtonBase)},,function(module,__webpack_exports__,__webpack_require__){"use strict";function requirePropFactory(componentNameInError){return function(){return null}}__webpack_require__.d(__webpack_exports__,"a",(function(){return requirePropFactory}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function unsupportedProp(props,propName,componentName,location,propFullName){return null}__webpack_require__.d(__webpack_exports__,"a",(function(){return unsupportedProp}))},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M19 13H5v-2h14v2z"}),"Remove");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");exports.default=_default},,,,,,function(module,exports,__webpack_require__){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null===val||void 0===val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}module.exports=function(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map((function(n){return test2[n]})).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach((function(letter){test3[letter]=letter})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}()?Object.assign:function(target,source){for(var from,symbols,to=toObject(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},function(module,__webpack_exports__,__webpack_require__){"use strict";function _iterableToArray(iter){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}__webpack_require__.d(__webpack_exports__,"a",(function(){return _iterableToArray}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}__webpack_require__.d(__webpack_exports__,"a",(function(){return _arrayWithHoles}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}__webpack_require__.d(__webpack_exports__,"a",(function(){return _nonIterableRest}))},function(module,exports,__webpack_require__){"use strict";var reactIs=__webpack_require__(54),REACT_STATICS={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},KNOWN_STATICS={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},MEMO_STATICS={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},TYPE_STATICS={};function getStatics(component){return reactIs.isMemo(component)?MEMO_STATICS:TYPE_STATICS[component.$$typeof]||REACT_STATICS}TYPE_STATICS[reactIs.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},TYPE_STATICS[reactIs.Memo]=MEMO_STATICS;var defineProperty=Object.defineProperty,getOwnPropertyNames=Object.getOwnPropertyNames,getOwnPropertySymbols=Object.getOwnPropertySymbols,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,getPrototypeOf=Object.getPrototypeOf,objectPrototype=Object.prototype;module.exports=function hoistNonReactStatics(targetComponent,sourceComponent,blacklist){if("string"!==typeof sourceComponent){if(objectPrototype){var inheritedComponent=getPrototypeOf(sourceComponent);inheritedComponent&&inheritedComponent!==objectPrototype&&hoistNonReactStatics(targetComponent,inheritedComponent,blacklist)}var keys=getOwnPropertyNames(sourceComponent);getOwnPropertySymbols&&(keys=keys.concat(getOwnPropertySymbols(sourceComponent)));for(var targetStatics=getStatics(targetComponent),sourceStatics=getStatics(sourceComponent),i=0;i<keys.length;++i){var key=keys[i];if(!KNOWN_STATICS[key]&&(!blacklist||!blacklist[key])&&(!sourceStatics||!sourceStatics[key])&&(!targetStatics||!targetStatics[key])){var descriptor=getOwnPropertyDescriptor(sourceComponent,key);try{defineProperty(targetComponent,key,descriptor)}catch(e){}}}}return targetComponent}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z"}),"Headset");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}),"Help");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}),"Timer");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5z"}),"PanTool");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"}),"Menu");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"ExitToApp");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M9.93 13.5h4.14L12 7.98zM20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-4.05 16.5l-1.14-3H9.17l-1.12 3H5.96l5.11-13h1.86l5.11 13h-2.09z"}),"FontDownload");exports.default=_default},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(17),_interopRequireWildcard=__webpack_require__(18);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(__webpack_require__(1)),_default=(0,_interopRequireDefault(__webpack_require__(19)).default)(React.createElement("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"}),"Settings");exports.default=_default},function(module,__webpack_exports__,__webpack_require__){"use strict";function formatMuiErrorMessage(code){for(var url="https://material-ui.com/production-error/?code="+code,i=1;i<arguments.length;i+=1)url+="&args[]="+encodeURIComponent(arguments[i]);return"Minified Material-UI error #"+code+"; visit "+url+" for the full message."}__webpack_require__.d(__webpack_exports__,"a",(function(){return formatMuiErrorMessage}))},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),Paper=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"div":_props$component,_props$square=props.square,square=void 0!==_props$square&&_props$square,_props$elevation=props.elevation,elevation=void 0===_props$elevation?1:_props$elevation,_props$variant=props.variant,variant=void 0===_props$variant?"elevation":_props$variant,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__.a)(props,["classes","className","component","square","elevation","variant"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,"outlined"===variant?classes.outlined:classes["elevation".concat(elevation)],!square&&classes.rounded),ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){var elevations={};return theme.shadows.forEach((function(shadow,index){elevations["elevation".concat(index)]={boxShadow:shadow}})),Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__.a)({root:{backgroundColor:theme.palette.background.paper,color:theme.palette.text.primary,transition:theme.transitions.create("box-shadow")},rounded:{borderRadius:theme.shape.borderRadius},outlined:{border:"1px solid ".concat(theme.palette.divider)}},elevations)}),{name:"MuiPaper"})(Paper)},function(module,__webpack_exports__,__webpack_require__){"use strict";var objectWithoutProperties=__webpack_require__(3),esm_extends=__webpack_require__(2),formatMuiErrorMessage=__webpack_require__(92),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),formControlState=__webpack_require__(22),FormControlContext=__webpack_require__(40),withStyles=__webpack_require__(5),capitalize=__webpack_require__(8),useForkRef=__webpack_require__(11),debounce=__webpack_require__(45);function getStyleValue(computedStyle,property){return parseInt(computedStyle[property],10)||0}var useEnhancedEffect="undefined"!==typeof window?react.useLayoutEffect:react.useEffect,TextareaAutosize_styles_shadow={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"},esm_TextareaAutosize_TextareaAutosize=react.forwardRef((function(props,ref){var onChange=props.onChange,rows=props.rows,rowsMax=props.rowsMax,_props$rowsMin=props.rowsMin,rowsMinProp=void 0===_props$rowsMin?1:_props$rowsMin,style=props.style,value=props.value,other=Object(objectWithoutProperties.a)(props,["onChange","rows","rowsMax","rowsMin","style","value"]),rowsMin=rows||rowsMinProp,isControlled=react.useRef(null!=value).current,inputRef=react.useRef(null),handleRef=Object(useForkRef.a)(ref,inputRef),shadowRef=react.useRef(null),renders=react.useRef(0),_React$useState=react.useState({}),state=_React$useState[0],setState=_React$useState[1],syncHeight=react.useCallback((function(){var input=inputRef.current,computedStyle=window.getComputedStyle(input),inputShallow=shadowRef.current;inputShallow.style.width=computedStyle.width,inputShallow.value=input.value||props.placeholder||"x","\n"===inputShallow.value.slice(-1)&&(inputShallow.value+=" ");var boxSizing=computedStyle["box-sizing"],padding=getStyleValue(computedStyle,"padding-bottom")+getStyleValue(computedStyle,"padding-top"),border=getStyleValue(computedStyle,"border-bottom-width")+getStyleValue(computedStyle,"border-top-width"),innerHeight=inputShallow.scrollHeight-padding;inputShallow.value="x";var singleRowHeight=inputShallow.scrollHeight-padding,outerHeight=innerHeight;rowsMin&&(outerHeight=Math.max(Number(rowsMin)*singleRowHeight,outerHeight)),rowsMax&&(outerHeight=Math.min(Number(rowsMax)*singleRowHeight,outerHeight));var outerHeightStyle=(outerHeight=Math.max(outerHeight,singleRowHeight))+("border-box"===boxSizing?padding+border:0),overflow=Math.abs(outerHeight-innerHeight)<=1;setState((function(prevState){return renders.current<20&&(outerHeightStyle>0&&Math.abs((prevState.outerHeightStyle||0)-outerHeightStyle)>1||prevState.overflow!==overflow)?(renders.current+=1,{overflow:overflow,outerHeightStyle:outerHeightStyle}):prevState}))}),[rowsMax,rowsMin,props.placeholder]);react.useEffect((function(){var handleResize=Object(debounce.a)((function(){renders.current=0,syncHeight()}));return window.addEventListener("resize",handleResize),function(){handleResize.clear(),window.removeEventListener("resize",handleResize)}}),[syncHeight]),useEnhancedEffect((function(){syncHeight()})),react.useEffect((function(){renders.current=0}),[value]);return react.createElement(react.Fragment,null,react.createElement("textarea",Object(esm_extends.a)({value:value,onChange:function(event){renders.current=0,isControlled||syncHeight(),onChange&&onChange(event)},ref:handleRef,rows:rowsMin,style:Object(esm_extends.a)({height:state.outerHeightStyle,overflow:state.overflow?"hidden":null},style)},other)),react.createElement("textarea",{"aria-hidden":!0,className:props.className,readOnly:!0,ref:shadowRef,tabIndex:-1,style:Object(esm_extends.a)({},TextareaAutosize_styles_shadow,style)}))})),utils=__webpack_require__(41),InputBase_useEnhancedEffect="undefined"===typeof window?react.useEffect:react.useLayoutEffect,InputBase_InputBase=react.forwardRef((function(props,ref){var ariaDescribedby=props["aria-describedby"],autoComplete=props.autoComplete,autoFocus=props.autoFocus,classes=props.classes,className=props.className,defaultValue=(props.color,props.defaultValue),disabled=props.disabled,endAdornment=props.endAdornment,_props$fullWidth=(props.error,props.fullWidth),fullWidth=void 0!==_props$fullWidth&&_props$fullWidth,id=props.id,_props$inputComponent=props.inputComponent,inputComponent=void 0===_props$inputComponent?"input":_props$inputComponent,_props$inputProps=props.inputProps,inputPropsProp=void 0===_props$inputProps?{}:_props$inputProps,inputRefProp=props.inputRef,_props$multiline=(props.margin,props.multiline),multiline=void 0!==_props$multiline&&_props$multiline,name=props.name,onBlur=props.onBlur,onChange=props.onChange,onClick=props.onClick,onFocus=props.onFocus,onKeyDown=props.onKeyDown,onKeyUp=props.onKeyUp,placeholder=props.placeholder,readOnly=props.readOnly,renderSuffix=props.renderSuffix,rows=props.rows,rowsMax=props.rowsMax,rowsMin=props.rowsMin,startAdornment=props.startAdornment,_props$type=props.type,type=void 0===_props$type?"text":_props$type,valueProp=props.value,other=Object(objectWithoutProperties.a)(props,["aria-describedby","autoComplete","autoFocus","classes","className","color","defaultValue","disabled","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","rowsMax","rowsMin","startAdornment","type","value"]),value=null!=inputPropsProp.value?inputPropsProp.value:valueProp,isControlled=react.useRef(null!=value).current,inputRef=react.useRef(),handleInputRefWarning=react.useCallback((function(instance){0}),[]),handleInputPropsRefProp=Object(useForkRef.a)(inputPropsProp.ref,handleInputRefWarning),handleInputRefProp=Object(useForkRef.a)(inputRefProp,handleInputPropsRefProp),handleInputRef=Object(useForkRef.a)(inputRef,handleInputRefProp),_React$useState=react.useState(!1),focused=_React$useState[0],setFocused=_React$useState[1],muiFormControl=Object(FormControlContext.b)();var fcs=Object(formControlState.a)({props:props,muiFormControl:muiFormControl,states:["color","disabled","error","hiddenLabel","margin","required","filled"]});fcs.focused=muiFormControl?muiFormControl.focused:focused,react.useEffect((function(){!muiFormControl&&disabled&&focused&&(setFocused(!1),onBlur&&onBlur())}),[muiFormControl,disabled,focused,onBlur]);var onFilled=muiFormControl&&muiFormControl.onFilled,onEmpty=muiFormControl&&muiFormControl.onEmpty,checkDirty=react.useCallback((function(obj){Object(utils.b)(obj)?onFilled&&onFilled():onEmpty&&onEmpty()}),[onFilled,onEmpty]);InputBase_useEnhancedEffect((function(){isControlled&&checkDirty({value:value})}),[value,checkDirty,isControlled]);react.useEffect((function(){checkDirty(inputRef.current)}),[]);var InputComponent=inputComponent,inputProps=Object(esm_extends.a)({},inputPropsProp,{ref:handleInputRef});"string"!==typeof InputComponent?inputProps=Object(esm_extends.a)({inputRef:handleInputRef,type:type},inputProps,{ref:null}):multiline?!rows||rowsMax||rowsMin?(inputProps=Object(esm_extends.a)({rows:rows,rowsMax:rowsMax},inputProps),InputComponent=esm_TextareaAutosize_TextareaAutosize):InputComponent="textarea":inputProps=Object(esm_extends.a)({type:type},inputProps);return react.useEffect((function(){muiFormControl&&muiFormControl.setAdornedStart(Boolean(startAdornment))}),[muiFormControl,startAdornment]),react.createElement("div",Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,classes["color".concat(Object(capitalize.a)(fcs.color||"primary"))],className,fcs.disabled&&classes.disabled,fcs.error&&classes.error,fullWidth&&classes.fullWidth,fcs.focused&&classes.focused,muiFormControl&&classes.formControl,multiline&&classes.multiline,startAdornment&&classes.adornedStart,endAdornment&&classes.adornedEnd,"dense"===fcs.margin&&classes.marginDense),onClick:function(event){inputRef.current&&event.currentTarget===event.target&&inputRef.current.focus(),onClick&&onClick(event)},ref:ref},other),startAdornment,react.createElement(FormControlContext.a.Provider,{value:null},react.createElement(InputComponent,Object(esm_extends.a)({"aria-invalid":fcs.error,"aria-describedby":ariaDescribedby,autoComplete:autoComplete,autoFocus:autoFocus,defaultValue:defaultValue,disabled:fcs.disabled,id:id,onAnimationStart:function(event){checkDirty("mui-auto-fill-cancel"===event.animationName?inputRef.current:{value:"x"})},name:name,placeholder:placeholder,readOnly:readOnly,required:fcs.required,rows:rows,value:value,onKeyDown:onKeyDown,onKeyUp:onKeyUp},inputProps,{className:Object(clsx_m.a)(classes.input,inputPropsProp.className,fcs.disabled&&classes.disabled,multiline&&classes.inputMultiline,fcs.hiddenLabel&&classes.inputHiddenLabel,startAdornment&&classes.inputAdornedStart,endAdornment&&classes.inputAdornedEnd,"search"===type&&classes.inputTypeSearch,"dense"===fcs.margin&&classes.inputMarginDense),onBlur:function(event){onBlur&&onBlur(event),inputPropsProp.onBlur&&inputPropsProp.onBlur(event),muiFormControl&&muiFormControl.onBlur?muiFormControl.onBlur(event):setFocused(!1)},onChange:function(event){if(!isControlled){var element=event.target||inputRef.current;if(null==element)throw new Error(Object(formatMuiErrorMessage.a)(1));checkDirty({value:element.value})}for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];inputPropsProp.onChange&&inputPropsProp.onChange.apply(inputPropsProp,[event].concat(args)),onChange&&onChange.apply(void 0,[event].concat(args))},onFocus:function(event){fcs.disabled?event.stopPropagation():(onFocus&&onFocus(event),inputPropsProp.onFocus&&inputPropsProp.onFocus(event),muiFormControl&&muiFormControl.onFocus?muiFormControl.onFocus(event):setFocused(!0))}}))),endAdornment,renderSuffix?renderSuffix(Object(esm_extends.a)({},fcs,{startAdornment:startAdornment})):null)}));__webpack_exports__.a=Object(withStyles.a)((function(theme){var light="light"===theme.palette.type,placeholder={color:"currentColor",opacity:light?.42:.5,transition:theme.transitions.create("opacity",{duration:theme.transitions.duration.shorter})},placeholderHidden={opacity:"0 !important"},placeholderVisible={opacity:light?.42:.5};return{"@global":{"@keyframes mui-auto-fill":{},"@keyframes mui-auto-fill-cancel":{}},root:Object(esm_extends.a)({},theme.typography.body1,{color:theme.palette.text.primary,lineHeight:"1.1876em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center","&$disabled":{color:theme.palette.text.disabled,cursor:"default"}}),formControl:{},focused:{},disabled:{},adornedStart:{},adornedEnd:{},error:{},marginDense:{},multiline:{padding:"".concat(6,"px 0 ").concat(7,"px"),"&$marginDense":{paddingTop:3}},colorSecondary:{},fullWidth:{width:"100%"},input:{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"".concat(6,"px 0 ").concat(7,"px"),border:0,boxSizing:"content-box",background:"none",height:"1.1876em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":placeholder,"&::-moz-placeholder":placeholder,"&:-ms-input-placeholder":placeholder,"&::-ms-input-placeholder":placeholder,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{"-webkit-appearance":"none"},"label[data-shrink=false] + $formControl &":{"&::-webkit-input-placeholder":placeholderHidden,"&::-moz-placeholder":placeholderHidden,"&:-ms-input-placeholder":placeholderHidden,"&::-ms-input-placeholder":placeholderHidden,"&:focus::-webkit-input-placeholder":placeholderVisible,"&:focus::-moz-placeholder":placeholderVisible,"&:focus:-ms-input-placeholder":placeholderVisible,"&:focus::-ms-input-placeholder":placeholderVisible},"&$disabled":{opacity:1},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},inputMarginDense:{paddingTop:3},inputMultiline:{height:"auto",resize:"none",padding:0},inputTypeSearch:{"-moz-appearance":"textfield","-webkit-appearance":"textfield"},inputAdornedStart:{},inputAdornedEnd:{},inputHiddenLabel:{}}}),{name:"MuiInputBase"})(InputBase_InputBase)},,,,,,,,,function(module,exports,__webpack_require__){"use strict";var l=__webpack_require__(78),n=60103,p=60106;exports.Fragment=60107,exports.StrictMode=60108,exports.Profiler=60114;var q=60109,r=60110,t=60112;exports.Suspense=60113;var u=60115,v=60116;if("function"===typeof Symbol&&Symbol.for){var w=Symbol.for;n=w("react.element"),p=w("react.portal"),exports.Fragment=w("react.fragment"),exports.StrictMode=w("react.strict_mode"),exports.Profiler=w("react.profiler"),q=w("react.provider"),r=w("react.context"),t=w("react.forward_ref"),exports.Suspense=w("react.suspense"),u=w("react.memo"),v=w("react.lazy")}var x="function"===typeof Symbol&&Symbol.iterator;function z(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},B={};function C(a,b,c){this.props=a,this.context=b,this.refs=B,this.updater=c||A}function D(){}function E(a,b,c){this.props=a,this.context=b,this.refs=B,this.updater=c||A}C.prototype.isReactComponent={},C.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(z(85));this.updater.enqueueSetState(this,a,b,"setState")},C.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")},D.prototype=C.prototype;var F=E.prototype=new D;F.constructor=E,l(F,C.prototype),F.isPureReactComponent=!0;var G={current:null},H=Object.prototype.hasOwnProperty,I={key:!0,ref:!0,__self:!0,__source:!0};function J(a,b,c){var e,d={},k=null,h=null;if(null!=b)for(e in void 0!==b.ref&&(h=b.ref),void 0!==b.key&&(k=""+b.key),b)H.call(b,e)&&!I.hasOwnProperty(e)&&(d[e]=b[e]);var g=arguments.length-2;if(1===g)d.children=c;else if(1<g){for(var f=Array(g),m=0;m<g;m++)f[m]=arguments[m+2];d.children=f}if(a&&a.defaultProps)for(e in g=a.defaultProps)void 0===d[e]&&(d[e]=g[e]);return{$$typeof:n,type:a,key:k,ref:h,props:d,_owner:G.current}}function L(a){return"object"===typeof a&&null!==a&&a.$$typeof===n}var M=/\/+/g;function N(a,b){return"object"===typeof a&&null!==a&&null!=a.key?function(a){var b={"=":"=0",":":"=2"};return"$"+a.replace(/[=:]/g,(function(a){return b[a]}))}(""+a.key):b.toString(36)}function O(a,b,c,e,d){var k=typeof a;"undefined"!==k&&"boolean"!==k||(a=null);var h=!1;if(null===a)h=!0;else switch(k){case"string":case"number":h=!0;break;case"object":switch(a.$$typeof){case n:case p:h=!0}}if(h)return d=d(h=a),a=""===e?"."+N(h,0):e,Array.isArray(d)?(c="",null!=a&&(c=a.replace(M,"$&/")+"/"),O(d,b,c,"",(function(a){return a}))):null!=d&&(L(d)&&(d=function(a,b){return{$$typeof:n,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}(d,c+(!d.key||h&&h.key===d.key?"":(""+d.key).replace(M,"$&/")+"/")+a)),b.push(d)),1;if(h=0,e=""===e?".":e+":",Array.isArray(a))for(var g=0;g<a.length;g++){var f=e+N(k=a[g],g);h+=O(k,b,c,f,d)}else if("function"===typeof(f=function(a){return null===a||"object"!==typeof a?null:"function"===typeof(a=x&&a[x]||a["@@iterator"])?a:null}(a)))for(a=f.call(a),g=0;!(k=a.next()).done;)h+=O(k=k.value,b,c,f=e+N(k,g++),d);else if("object"===k)throw b=""+a,Error(z(31,"[object Object]"===b?"object with keys {"+Object.keys(a).join(", ")+"}":b));return h}function P(a,b,c){if(null==a)return a;var e=[],d=0;return O(a,e,"","",(function(a){return b.call(c,a,d++)})),e}function Q(a){if(-1===a._status){var b=a._result;b=b(),a._status=0,a._result=b,b.then((function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)}),(function(b){0===a._status&&(a._status=2,a._result=b)}))}if(1===a._status)return a._result;throw a._result}var R={current:null};function S(){var a=R.current;if(null===a)throw Error(z(321));return a}var T={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:G,IsSomeRendererActing:{current:!1},assign:l};exports.Children={map:P,forEach:function(a,b,c){P(a,(function(){b.apply(this,arguments)}),c)},count:function(a){var b=0;return P(a,(function(){b++})),b},toArray:function(a){return P(a,(function(a){return a}))||[]},only:function(a){if(!L(a))throw Error(z(143));return a}},exports.Component=C,exports.PureComponent=E,exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T,exports.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(z(267,a));var e=l({},a.props),d=a.key,k=a.ref,h=a._owner;if(null!=b){if(void 0!==b.ref&&(k=b.ref,h=G.current),void 0!==b.key&&(d=""+b.key),a.type&&a.type.defaultProps)var g=a.type.defaultProps;for(f in b)H.call(b,f)&&!I.hasOwnProperty(f)&&(e[f]=void 0===b[f]&&void 0!==g?g[f]:b[f])}var f=arguments.length-2;if(1===f)e.children=c;else if(1<f){g=Array(f);for(var m=0;m<f;m++)g[m]=arguments[m+2];e.children=g}return{$$typeof:n,type:a.type,key:d,ref:k,props:e,_owner:h}},exports.createContext=function(a,b){return void 0===b&&(b=null),(a={$$typeof:r,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:q,_context:a},a.Consumer=a},exports.createElement=J,exports.createFactory=function(a){var b=J.bind(null,a);return b.type=a,b},exports.createRef=function(){return{current:null}},exports.forwardRef=function(a){return{$$typeof:t,render:a}},exports.isValidElement=L,exports.lazy=function(a){return{$$typeof:v,_payload:{_status:-1,_result:a},_init:Q}},exports.memo=function(a,b){return{$$typeof:u,type:a,compare:void 0===b?null:b}},exports.useCallback=function(a,b){return S().useCallback(a,b)},exports.useContext=function(a,b){return S().useContext(a,b)},exports.useDebugValue=function(){},exports.useEffect=function(a,b){return S().useEffect(a,b)},exports.useImperativeHandle=function(a,b,c){return S().useImperativeHandle(a,b,c)},exports.useLayoutEffect=function(a,b){return S().useLayoutEffect(a,b)},exports.useMemo=function(a,b){return S().useMemo(a,b)},exports.useReducer=function(a,b,c){return S().useReducer(a,b,c)},exports.useRef=function(a){return S().useRef(a)},exports.useState=function(a){return S().useState(a)},exports.version="17.0.1"},function(module,exports,__webpack_require__){"use strict";var aa=__webpack_require__(1),m=__webpack_require__(78),r=__webpack_require__(105);function y(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!aa)throw Error(y(227));var ba=new Set,ca={};function da(a,b){ea(a,b),ea(a+"Capture",b)}function ea(a,b){for(ca[a]=b,a=0;a<b.length;a++)ba.add(b[a])}var fa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),ha=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ia=Object.prototype.hasOwnProperty,ja={},ka={};function B(a,b,c,d,e,f,g){this.acceptsBooleans=2===b||3===b||4===b,this.attributeName=d,this.attributeNamespace=e,this.mustUseProperty=c,this.propertyName=a,this.type=b,this.sanitizeURL=f,this.removeEmptyString=g}var D={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(a){D[a]=new B(a,0,!1,a,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(a){var b=a[0];D[b]=new B(b,1,!1,a[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(a){D[a]=new B(a,2,!1,a.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(a){D[a]=new B(a,2,!1,a,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(a){D[a]=new B(a,3,!1,a.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(a){D[a]=new B(a,3,!0,a,null,!1,!1)})),["capture","download"].forEach((function(a){D[a]=new B(a,4,!1,a,null,!1,!1)})),["cols","rows","size","span"].forEach((function(a){D[a]=new B(a,6,!1,a,null,!1,!1)})),["rowSpan","start"].forEach((function(a){D[a]=new B(a,5,!1,a.toLowerCase(),null,!1,!1)}));var oa=/[\-:]([a-z])/g;function pa(a){return a[1].toUpperCase()}function qa(a,b,c,d){var e=D.hasOwnProperty(b)?D[b]:null;(null!==e?0===e.type:!d&&(2<b.length&&("o"===b[0]||"O"===b[0])&&("n"===b[1]||"N"===b[1])))||(function(a,b,c,d){if(null===b||"undefined"===typeof b||function(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case"function":case"symbol":return!0;case"boolean":return!d&&(null!==c?!c.acceptsBooleans:"data-"!==(a=a.toLowerCase().slice(0,5))&&"aria-"!==a);default:return!1}}(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}(b,c,e,d)&&(c=null),d||null===e?function(a){return!!ia.call(ka,a)||!ia.call(ja,a)&&(ha.test(a)?ka[a]=!0:(ja[a]=!0,!1))}(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3!==e.type&&"":c:(b=e.attributeName,d=e.attributeNamespace,null===c?a.removeAttribute(b):(c=3===(e=e.type)||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(a){var b=a.replace(oa,pa);D[b]=new B(b,1,!1,a,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(a){var b=a.replace(oa,pa);D[b]=new B(b,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(a){var b=a.replace(oa,pa);D[b]=new B(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(a){D[a]=new B(a,1,!1,a.toLowerCase(),null,!1,!1)})),D.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(a){D[a]=new B(a,1,!1,a.toLowerCase(),null,!0,!0)}));var ra=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,sa=60103,ta=60106,ua=60107,wa=60108,xa=60114,ya=60109,za=60110,Aa=60112,Ba=60113,Ca=60120,Da=60115,Ea=60116,Fa=60121,Ga=60128,Ha=60129,Ia=60130,Ja=60131;if("function"===typeof Symbol&&Symbol.for){var E=Symbol.for;sa=E("react.element"),ta=E("react.portal"),ua=E("react.fragment"),wa=E("react.strict_mode"),xa=E("react.profiler"),ya=E("react.provider"),za=E("react.context"),Aa=E("react.forward_ref"),Ba=E("react.suspense"),Ca=E("react.suspense_list"),Da=E("react.memo"),Ea=E("react.lazy"),Fa=E("react.block"),E("react.scope"),Ga=E("react.opaque.id"),Ha=E("react.debug_trace_mode"),Ia=E("react.offscreen"),Ja=E("react.legacy_hidden")}var Ma,Ka="function"===typeof Symbol&&Symbol.iterator;function La(a){return null===a||"object"!==typeof a?null:"function"===typeof(a=Ka&&a[Ka]||a["@@iterator"])?a:null}function Na(a){if(void 0===Ma)try{throw Error()}catch(c){var b=c.stack.trim().match(/\n( *(at )?)/);Ma=b&&b[1]||""}return"\n"+Ma+a}var Oa=!1;function Pa(a,b){if(!a||Oa)return"";Oa=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(b,[])}catch(k){var d=k}Reflect.construct(a,[],b)}else{try{b.call()}catch(k){d=k}a.call(b.prototype)}else{try{throw Error()}catch(k){d=k}a()}}catch(k){if(k&&d&&"string"===typeof k.stack){for(var e=k.stack.split("\n"),f=d.stack.split("\n"),g=e.length-1,h=f.length-1;1<=g&&0<=h&&e[g]!==f[h];)h--;for(;1<=g&&0<=h;g--,h--)if(e[g]!==f[h]){if(1!==g||1!==h)do{if(g--,0>--h||e[g]!==f[h])return"\n"+e[g].replace(" at new "," at ")}while(1<=g&&0<=h);break}}}finally{Oa=!1,Error.prepareStackTrace=c}return(a=a?a.displayName||a.name:"")?Na(a):""}function Qa(a){switch(a.tag){case 5:return Na(a.type);case 16:return Na("Lazy");case 13:return Na("Suspense");case 19:return Na("SuspenseList");case 0:case 2:case 15:return a=Pa(a.type,!1);case 11:return a=Pa(a.type.render,!1);case 22:return a=Pa(a.type._render,!1);case 1:return a=Pa(a.type,!0);default:return""}}function Ra(a){if(null==a)return null;if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case ua:return"Fragment";case ta:return"Portal";case xa:return"Profiler";case wa:return"StrictMode";case Ba:return"Suspense";case Ca:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case za:return(a.displayName||"Context")+".Consumer";case ya:return(a._context.displayName||"Context")+".Provider";case Aa:var b=a.render;return b=b.displayName||b.name||"",a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Da:return Ra(a.type);case Fa:return Ra(a._render);case Ea:b=a._payload,a=a._init;try{return Ra(a(b))}catch(c){}}return null}function Sa(a){switch(typeof a){case"boolean":case"number":case"object":case"string":case"undefined":return a;default:return""}}function Ta(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function Va(a){a._valueTracker||(a._valueTracker=function(a){var b=Ta(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;return Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a,f.call(this,a)}}),Object.defineProperty(a,b,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null,delete a[b]}}}}(a))}function Wa(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue(),d="";return a&&(d=Ta(a)?a.checked?"true":"false":a.value),(a=d)!==c&&(b.setValue(a),!0)}function Xa(a){if("undefined"===typeof(a=a||("undefined"!==typeof document?document:void 0)))return null;try{return a.activeElement||a.body}catch(b){return a.body}}function Ya(a,b){var c=b.checked;return m({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=c?c:a._wrapperState.initialChecked})}function Za(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=Sa(null!=b.value?b.value:c),a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function $a(a,b){null!=(b=b.checked)&&qa(a,"checked",b,!1)}function ab(a,b){$a(a,b);var c=Sa(b.value),d=b.type;if(null!=c)"number"===d?(0===c&&""===a.value||a.value!=c)&&(a.value=""+c):a.value!==""+c&&(a.value=""+c);else if("submit"===d||"reset"===d)return void a.removeAttribute("value");b.hasOwnProperty("value")?bb(a,b.type,c):b.hasOwnProperty("defaultValue")&&bb(a,b.type,Sa(b.defaultValue)),null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function cb(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue,c||b===a.value||(a.value=b),a.defaultValue=b}""!==(c=a.name)&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,""!==c&&(a.name=c)}function bb(a,b,c){"number"===b&&Xa(a.ownerDocument)===a||(null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c))}function eb(a,b){return a=m({children:void 0},b),(b=function(a){var b="";return aa.Children.forEach(a,(function(a){null!=a&&(b+=a)})),b}(b.children))&&(a.children=b),a}function fb(a,b,c,d){if(a=a.options,b){b={};for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{for(c=""+Sa(c),b=null,e=0;e<a.length;e++){if(a[e].value===c)return a[e].selected=!0,void(d&&(a[e].defaultSelected=!0));null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function gb(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(y(91));return m({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function hb(a,b){var c=b.value;if(null==c){if(c=b.children,b=b.defaultValue,null!=c){if(null!=b)throw Error(y(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(y(93));c=c[0]}b=c}null==b&&(b=""),c=b}a._wrapperState={initialValue:Sa(c)}}function ib(a,b){var c=Sa(b.value),d=Sa(b.defaultValue);null!=c&&((c=""+c)!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c)),null!=d&&(a.defaultValue=""+d)}function jb(a){var b=a.textContent;b===a._wrapperState.initialValue&&""!==b&&null!==b&&(a.value=b)}var kb_html="http://www.w3.org/1999/xhtml",kb_svg="http://www.w3.org/2000/svg";function lb(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mb(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?lb(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}var nb,a,ob=(a=function(a,b){if(a.namespaceURI!==kb_svg||"innerHTML"in a)a.innerHTML=b;else{for((nb=nb||document.createElement("div")).innerHTML="<svg>"+b.valueOf().toString()+"</svg>",b=nb.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction((function(){return a(b,c)}))}:a);function pb(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType)return void(c.nodeValue=b)}a.textContent=b}var qb={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rb=["Webkit","ms","Moz","O"];function sb(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||qb.hasOwnProperty(a)&&qb[a]?(""+b).trim():b+"px"}function tb(a,b){for(var c in a=a.style,b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=sb(c,b[c],d);"float"===c&&(c="cssFloat"),d?a.setProperty(c,e):a[c]=e}}Object.keys(qb).forEach((function(a){rb.forEach((function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1),qb[b]=qb[a]}))}));var ub=m({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vb(a,b){if(b){if(ub[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(y(137,a));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(y(60));if("object"!==typeof b.dangerouslySetInnerHTML||!("__html"in b.dangerouslySetInnerHTML))throw Error(y(61))}if(null!=b.style&&"object"!==typeof b.style)throw Error(y(62))}}function wb(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function xb(a){return(a=a.target||a.srcElement||window).correspondingUseElement&&(a=a.correspondingUseElement),3===a.nodeType?a.parentNode:a}var yb=null,zb=null,Ab=null;function Bb(a){if(a=Cb(a)){if("function"!==typeof yb)throw Error(y(280));var b=a.stateNode;b&&(b=Db(b),yb(a.stateNode,a.type,b))}}function Eb(a){zb?Ab?Ab.push(a):Ab=[a]:zb=a}function Fb(){if(zb){var a=zb,b=Ab;if(Ab=zb=null,Bb(a),b)for(a=0;a<b.length;a++)Bb(b[a])}}function Gb(a,b){return a(b)}function Hb(a,b,c,d,e){return a(b,c,d,e)}function Ib(){}var Jb=Gb,Kb=!1,Lb=!1;function Mb(){null===zb&&null===Ab||(Ib(),Fb())}function Ob(a,b){var c=a.stateNode;if(null===c)return null;var d=Db(c);if(null===d)return null;c=d[b];a:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(d=!("button"===(a=a.type)||"input"===a||"select"===a||"textarea"===a)),a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(y(231,b,typeof c));return c}var Pb=!1;if(fa)try{var Qb={};Object.defineProperty(Qb,"passive",{get:function(){Pb=!0}}),window.addEventListener("test",Qb,Qb),window.removeEventListener("test",Qb,Qb)}catch(a){Pb=!1}function Rb(a,b,c,d,e,f,g,h,k){var l=Array.prototype.slice.call(arguments,3);try{b.apply(c,l)}catch(n){this.onError(n)}}var Sb=!1,Tb=null,Ub=!1,Vb=null,Wb={onError:function(a){Sb=!0,Tb=a}};function Xb(a,b,c,d,e,f,g,h,k){Sb=!1,Tb=null,Rb.apply(Wb,arguments)}function Zb(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do{0!==(1026&(b=a).flags)&&(c=b.return),a=b.return}while(a)}return 3===b.tag?c:null}function $b(a){if(13===a.tag){var b=a.memoizedState;if(null===b&&(null!==(a=a.alternate)&&(b=a.memoizedState)),null!==b)return b.dehydrated}return null}function ac(a){if(Zb(a)!==a)throw Error(y(188))}function cc(a){if(!(a=function(a){var b=a.alternate;if(!b){if(null===(b=Zb(a)))throw Error(y(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){if(null!==(d=e.return)){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return ac(e),a;if(f===d)return ac(e),b;f=f.sibling}throw Error(y(188))}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0,c=e,d=f;break}if(h===d){g=!0,d=e,c=f;break}h=h.sibling}if(!g){for(h=f.child;h;){if(h===c){g=!0,c=f,d=e;break}if(h===d){g=!0,d=f,c=e;break}h=h.sibling}if(!g)throw Error(y(189))}}if(c.alternate!==d)throw Error(y(190))}if(3!==c.tag)throw Error(y(188));return c.stateNode.current===c?a:b}(a)))return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}}return null}function dc(a,b){for(var c=a.alternate;null!==b;){if(b===a||b===c)return!0;b=b.return}return!1}var ec,fc,gc,hc,ic=!1,jc=[],kc=null,lc=null,mc=null,nc=new Map,oc=new Map,pc=[],qc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rc(a,b,c,d,e){return{blockedOn:a,domEventName:b,eventSystemFlags:16|c,nativeEvent:e,targetContainers:[d]}}function sc(a,b){switch(a){case"focusin":case"focusout":kc=null;break;case"dragenter":case"dragleave":lc=null;break;case"mouseover":case"mouseout":mc=null;break;case"pointerover":case"pointerout":nc.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":oc.delete(b.pointerId)}}function tc(a,b,c,d,e,f){return null===a||a.nativeEvent!==f?(a=rc(b,c,d,e,f),null!==b&&(null!==(b=Cb(b))&&fc(b)),a):(a.eventSystemFlags|=d,b=a.targetContainers,null!==e&&-1===b.indexOf(e)&&b.push(e),a)}function vc(a){var b=wc(a.target);if(null!==b){var c=Zb(b);if(null!==c)if(13===(b=c.tag)){if(null!==(b=$b(c)))return a.blockedOn=b,void hc(a.lanePriority,(function(){r.unstable_runWithPriority(a.priority,(function(){gc(c)}))}))}else if(3===b&&c.stateNode.hydrate)return void(a.blockedOn=3===c.tag?c.stateNode.containerInfo:null)}a.blockedOn=null}function xc(a){if(null!==a.blockedOn)return!1;for(var b=a.targetContainers;0<b.length;){var c=yc(a.domEventName,a.eventSystemFlags,b[0],a.nativeEvent);if(null!==c)return null!==(b=Cb(c))&&fc(b),a.blockedOn=c,!1;b.shift()}return!0}function zc(a,b,c){xc(a)&&c.delete(b)}function Ac(){for(ic=!1;0<jc.length;){var a=jc[0];if(null!==a.blockedOn){null!==(a=Cb(a.blockedOn))&&ec(a);break}for(var b=a.targetContainers;0<b.length;){var c=yc(a.domEventName,a.eventSystemFlags,b[0],a.nativeEvent);if(null!==c){a.blockedOn=c;break}b.shift()}null===a.blockedOn&&jc.shift()}null!==kc&&xc(kc)&&(kc=null),null!==lc&&xc(lc)&&(lc=null),null!==mc&&xc(mc)&&(mc=null),nc.forEach(zc),oc.forEach(zc)}function Bc(a,b){a.blockedOn===b&&(a.blockedOn=null,ic||(ic=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ac)))}function Cc(a){function b(b){return Bc(b,a)}if(0<jc.length){Bc(jc[0],a);for(var c=1;c<jc.length;c++){var d=jc[c];d.blockedOn===a&&(d.blockedOn=null)}}for(null!==kc&&Bc(kc,a),null!==lc&&Bc(lc,a),null!==mc&&Bc(mc,a),nc.forEach(b),oc.forEach(b),c=0;c<pc.length;c++)(d=pc[c]).blockedOn===a&&(d.blockedOn=null);for(;0<pc.length&&null===(c=pc[0]).blockedOn;)vc(c),null===c.blockedOn&&pc.shift()}function Dc(a,b){var c={};return c[a.toLowerCase()]=b.toLowerCase(),c["Webkit"+a]="webkit"+b,c["Moz"+a]="moz"+b,c}var Ec={animationend:Dc("Animation","AnimationEnd"),animationiteration:Dc("Animation","AnimationIteration"),animationstart:Dc("Animation","AnimationStart"),transitionend:Dc("Transition","TransitionEnd")},Fc={},Gc={};function Hc(a){if(Fc[a])return Fc[a];if(!Ec[a])return a;var c,b=Ec[a];for(c in b)if(b.hasOwnProperty(c)&&c in Gc)return Fc[a]=b[c];return a}fa&&(Gc=document.createElement("div").style,"AnimationEvent"in window||(delete Ec.animationend.animation,delete Ec.animationiteration.animation,delete Ec.animationstart.animation),"TransitionEvent"in window||delete Ec.transitionend.transition);var Ic=Hc("animationend"),Jc=Hc("animationiteration"),Kc=Hc("animationstart"),Lc=Hc("transitionend"),Mc=new Map,Nc=new Map,Oc=["abort","abort",Ic,"animationEnd",Jc,"animationIteration",Kc,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Lc,"transitionEnd","waiting","waiting"];function Pc(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1];e="on"+(e[0].toUpperCase()+e.slice(1)),Nc.set(d,b),Mc.set(d,e),da(e,[d])}}(0,r.unstable_now)();var F=8;function Rc(a){if(0!==(1&a))return F=15,1;if(0!==(2&a))return F=14,2;if(0!==(4&a))return F=13,4;var b=24&a;return 0!==b?(F=12,b):0!==(32&a)?(F=11,32):0!==(b=192&a)?(F=10,b):0!==(256&a)?(F=9,256):0!==(b=3584&a)?(F=8,b):0!==(4096&a)?(F=7,4096):0!==(b=4186112&a)?(F=6,b):0!==(b=62914560&a)?(F=5,b):67108864&a?(F=4,67108864):0!==(134217728&a)?(F=3,134217728):0!==(b=805306368&a)?(F=2,b):0!==(1073741824&a)?(F=1,1073741824):(F=8,a)}function Uc(a,b){var c=a.pendingLanes;if(0===c)return F=0;var d=0,e=0,f=a.expiredLanes,g=a.suspendedLanes,h=a.pingedLanes;if(0!==f)d=f,e=F=15;else if(0!==(f=134217727&c)){var k=f&~g;0!==k?(d=Rc(k),e=F):0!==(h&=f)&&(d=Rc(h),e=F)}else 0!==(f=c&~g)?(d=Rc(f),e=F):0!==h&&(d=Rc(h),e=F);if(0===d)return 0;if(d=c&((0>(d=31-Vc(d))?0:1<<d)<<1)-1,0!==b&&b!==d&&0===(b&g)){if(Rc(b),e<=F)return b;F=e}if(0!==(b=a.entangledLanes))for(a=a.entanglements,b&=d;0<b;)e=1<<(c=31-Vc(b)),d|=a[c],b&=~e;return d}function Wc(a){return 0!==(a=-1073741825&a.pendingLanes)?a:1073741824&a?1073741824:0}function Xc(a,b){switch(a){case 15:return 1;case 14:return 2;case 12:return 0===(a=Yc(24&~b))?Xc(10,b):a;case 10:return 0===(a=Yc(192&~b))?Xc(8,b):a;case 8:return 0===(a=Yc(3584&~b))&&(0===(a=Yc(4186112&~b))&&(a=512)),a;case 2:return 0===(b=Yc(805306368&~b))&&(b=268435456),b}throw Error(y(358,a))}function Yc(a){return a&-a}function Zc(a){for(var b=[],c=0;31>c;c++)b.push(a);return b}function $c(a,b,c){a.pendingLanes|=b;var d=b-1;a.suspendedLanes&=d,a.pingedLanes&=d,(a=a.eventTimes)[b=31-Vc(b)]=c}var Vc=Math.clz32?Math.clz32:function(a){return 0===a?32:31-(bd(a)/cd|0)|0},bd=Math.log,cd=Math.LN2;var dd=r.unstable_UserBlockingPriority,ed=r.unstable_runWithPriority,fd=!0;function gd(a,b,c,d){Kb||Ib();var e=hd,f=Kb;Kb=!0;try{Hb(e,a,b,c,d)}finally{(Kb=f)||Mb()}}function id(a,b,c,d){ed(dd,hd.bind(null,a,b,c,d))}function hd(a,b,c,d){var e;if(fd)if((e=0===(4&b))&&0<jc.length&&-1<qc.indexOf(a))a=rc(null,a,b,c,d),jc.push(a);else{var f=yc(a,b,c,d);if(null===f)e&&sc(a,d);else{if(e){if(-1<qc.indexOf(a))return a=rc(f,a,b,c,d),void jc.push(a);if(function(a,b,c,d,e){switch(b){case"focusin":return kc=tc(kc,a,b,c,d,e),!0;case"dragenter":return lc=tc(lc,a,b,c,d,e),!0;case"mouseover":return mc=tc(mc,a,b,c,d,e),!0;case"pointerover":var f=e.pointerId;return nc.set(f,tc(nc.get(f)||null,a,b,c,d,e)),!0;case"gotpointercapture":return f=e.pointerId,oc.set(f,tc(oc.get(f)||null,a,b,c,d,e)),!0}return!1}(f,a,b,c,d))return;sc(a,d)}jd(a,b,d,null,c)}}}function yc(a,b,c,d){var e=xb(d);if(null!==(e=wc(e))){var f=Zb(e);if(null===f)e=null;else{var g=f.tag;if(13===g){if(null!==(e=$b(f)))return e;e=null}else if(3===g){if(f.stateNode.hydrate)return 3===f.tag?f.stateNode.containerInfo:null;e=null}else f!==e&&(e=null)}}return jd(a,b,d,e,c),null}var kd=null,ld=null,md=null;function nd(){if(md)return md;var a,d,b=ld,c=b.length,e="value"in kd?kd.value:kd.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return md=e.slice(a,1<d?1-d:void 0)}function od(a){var b=a.keyCode;return"charCode"in a?0===(a=a.charCode)&&13===b&&(a=13):a=b,10===a&&(a=13),32<=a||13===a?a:0}function pd(){return!0}function qd(){return!1}function rd(a){function b(b,d,e,f,g){for(var c in this._reactName=b,this._targetInst=e,this.type=d,this.nativeEvent=f,this.target=g,this.currentTarget=null,a)a.hasOwnProperty(c)&&(b=a[c],this[c]=b?b(f):f[c]);return this.isDefaultPrevented=(null!=f.defaultPrevented?f.defaultPrevented:!1===f.returnValue)?pd:qd,this.isPropagationStopped=qd,this}return m(b.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),b}var wd,xd,yd,sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=m({},sd,{view:0,detail:0}),vd=rd(ud),Ad=m({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(a){return void 0===a.relatedTarget?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==yd&&(yd&&"mousemove"===a.type?(wd=a.screenX-yd.screenX,xd=a.screenY-yd.screenY):xd=wd=0,yd=a),wd)},movementY:function(a){return"movementY"in a?a.movementY:xd}}),Bd=rd(Ad),Dd=rd(m({},Ad,{dataTransfer:0})),Fd=rd(m({},ud,{relatedTarget:0})),Hd=rd(m({},sd,{animationName:0,elapsedTime:0,pseudoElement:0})),Jd=rd(m({},sd,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}})),Ld=rd(m({},sd,{data:0})),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):!!(a=Od[a])&&!!b[a]}function zd(){return Pd}var Rd=rd(m({},ud,{key:function(a){if(a.key){var b=Md[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?13===(a=od(a))?"Enter":String.fromCharCode(a):"keydown"===a.type||"keyup"===a.type?Nd[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(a){return"keypress"===a.type?od(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===a.type?od(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}})),Td=rd(m({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Vd=rd(m({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd})),Xd=rd(m({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0})),Zd=rd(m({},Ad,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0})),$d=[9,13,27,32],ae=fa&&"CompositionEvent"in window,be=null;fa&&"documentMode"in document&&(be=document.documentMode);var ce=fa&&"TextEvent"in window&&!be,de=fa&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(a,b){switch(a){case"keyup":return-1!==$d.indexOf(b.keyCode);case"keydown":return 229!==b.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(a){return"object"===typeof(a=a.detail)&&"data"in a?a.data:null}var ie=!1;var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!le[a.type]:"textarea"===b}function ne(a,b,c,d){Eb(d),0<(b=oe(b,"onChange")).length&&(c=new td("onChange","change",null,c,d),a.push({event:c,listeners:b}))}var pe=null,qe=null;function re(a){se(a,0)}function te(a){if(Wa(ue(a)))return a}function ve(a,b){if("change"===a)return b}var we=!1;if(fa){var xe;if(fa){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye="function"===typeof ze.oninput}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(a){if("value"===a.propertyName&&te(qe)){var b=[];if(ne(b,qe,a,xb(a)),a=re,Kb)a(b);else{Kb=!0;try{Gb(a,b)}finally{Kb=!1,Mb()}}}}function Ce(a,b,c){"focusin"===a?(Ae(),qe=c,(pe=b).attachEvent("onpropertychange",Be)):"focusout"===a&&Ae()}function De(a){if("selectionchange"===a||"keyup"===a||"keydown"===a)return te(qe)}function Ee(a,b){if("click"===a)return te(b)}function Fe(a,b){if("input"===a||"change"===a)return te(b)}var He="function"===typeof Object.is?Object.is:function(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b},Ie=Object.prototype.hasOwnProperty;function Je(a,b){if(He(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!Ie.call(b,c[d])||!He(a[c[d]],b[c[d]]))return!1;return!0}function Ke(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Le(a,b){var d,c=Ke(a);for(a=0;c;){if(3===c.nodeType){if(d=a+c.textContent.length,a<=b&&d>=b)return{node:c,offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=Ke(c)}}function Me(a,b){return!(!a||!b)&&(a===b||(!a||3!==a.nodeType)&&(b&&3===b.nodeType?Me(a,b.parentNode):"contains"in a?a.contains(b):!!a.compareDocumentPosition&&!!(16&a.compareDocumentPosition(b))))}function Ne(){for(var a=window,b=Xa();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(!c)break;b=Xa((a=b.contentWindow).document)}return b}function Oe(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}var Pe=fa&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(a,b,c){var d=c.window===c?c.document:9===c.nodeType?c:c.ownerDocument;Te||null==Qe||Qe!==Xa(d)||("selectionStart"in(d=Qe)&&Oe(d)?d={start:d.selectionStart,end:d.selectionEnd}:d={anchorNode:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset},Se&&Je(Se,d)||(Se=d,0<(d=oe(Re,"onSelect")).length&&(b=new td("onSelect","select",null,b,c),a.push({event:b,listeners:d}),b.target=Qe)))}Pc("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Pc("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Pc(Oc,2);for(var Ve="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),We=0;We<Ve.length;We++)Nc.set(Ve[We],0);ea("onMouseEnter",["mouseout","mouseover"]),ea("onMouseLeave",["mouseout","mouseover"]),ea("onPointerEnter",["pointerout","pointerover"]),ea("onPointerLeave",["pointerout","pointerover"]),da("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),da("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),da("onBeforeInput",["compositionend","keypress","textInput","paste"]),da("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),da("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),da("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xe="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ye=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xe));function Ze(a,b,c){var d=a.type||"unknown-event";a.currentTarget=c,function(a,b,c,d,e,f,g,h,k){if(Xb.apply(this,arguments),Sb){if(!Sb)throw Error(y(198));var l=Tb;Sb=!1,Tb=null,Ub||(Ub=!0,Vb=l)}}(d,b,void 0,a),a.currentTarget=null}function se(a,b){b=0!==(4&b);for(var c=0;c<a.length;c++){var d=a[c],e=d.event;d=d.listeners;a:{var f=void 0;if(b)for(var g=d.length-1;0<=g;g--){var h=d[g],k=h.instance,l=h.currentTarget;if(h=h.listener,k!==f&&e.isPropagationStopped())break a;Ze(e,h,l),f=k}else for(g=0;g<d.length;g++){if(k=(h=d[g]).instance,l=h.currentTarget,h=h.listener,k!==f&&e.isPropagationStopped())break a;Ze(e,h,l),f=k}}}if(Ub)throw a=Vb,Ub=!1,Vb=null,a}function G(a,b){var c=$e(b),d=a+"__bubble";c.has(d)||(af(b,a,2,!1),c.add(d))}var bf="_reactListening"+Math.random().toString(36).slice(2);function cf(a){a[bf]||(a[bf]=!0,ba.forEach((function(b){Ye.has(b)||df(b,!1,a,null),df(b,!0,a,null)})))}function df(a,b,c,d){var e=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,f=c;if("selectionchange"===a&&9!==c.nodeType&&(f=c.ownerDocument),null!==d&&!b&&Ye.has(a)){if("scroll"!==a)return;e|=2,f=d}var g=$e(f),h=a+"__"+(b?"capture":"bubble");g.has(h)||(b&&(e|=4),af(f,a,e,b),g.add(h))}function af(a,b,c,d){var e=Nc.get(b);switch(void 0===e?2:e){case 0:e=gd;break;case 1:e=id;break;default:e=hd}c=e.bind(null,b,c,a),e=void 0,!Pb||"touchstart"!==b&&"touchmove"!==b&&"wheel"!==b||(e=!0),d?void 0!==e?a.addEventListener(b,c,{capture:!0,passive:e}):a.addEventListener(b,c,!0):void 0!==e?a.addEventListener(b,c,{passive:e}):a.addEventListener(b,c,!1)}function jd(a,b,c,d,e){var f=d;if(0===(1&b)&&0===(2&b)&&null!==d)a:for(;;){if(null===d)return;var g=d.tag;if(3===g||4===g){var h=d.stateNode.containerInfo;if(h===e||8===h.nodeType&&h.parentNode===e)break;if(4===g)for(g=d.return;null!==g;){var k=g.tag;if((3===k||4===k)&&((k=g.stateNode.containerInfo)===e||8===k.nodeType&&k.parentNode===e))return;g=g.return}for(;null!==h;){if(null===(g=wc(h)))return;if(5===(k=g.tag)||6===k){d=f=g;continue a}h=h.parentNode}}d=d.return}!function(a,b,c){if(Lb)return a(b,c);Lb=!0;try{Jb(a,b,c)}finally{Lb=!1,Mb()}}((function(){var d=f,e=xb(c),g=[];a:{var h=Mc.get(a);if(void 0!==h){var k=td,x=a;switch(a){case"keypress":if(0===od(c))break a;case"keydown":case"keyup":k=Rd;break;case"focusin":x="focus",k=Fd;break;case"focusout":x="blur",k=Fd;break;case"beforeblur":case"afterblur":k=Fd;break;case"click":if(2===c.button)break a;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":k=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":k=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":k=Vd;break;case Ic:case Jc:case Kc:k=Hd;break;case Lc:k=Xd;break;case"scroll":k=vd;break;case"wheel":k=Zd;break;case"copy":case"cut":case"paste":k=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":k=Td}var w=0!==(4&b),z=!w&&"scroll"===a,u=w?null!==h?h+"Capture":null:h;w=[];for(var q,t=d;null!==t;){var v=(q=t).stateNode;if(5===q.tag&&null!==v&&(q=v,null!==u&&(null!=(v=Ob(t,u))&&w.push(ef(t,v,q)))),z)break;t=t.return}0<w.length&&(h=new k(h,x,null,c,e),g.push({event:h,listeners:w}))}}if(0===(7&b)){if(k="mouseout"===a||"pointerout"===a,(!(h="mouseover"===a||"pointerover"===a)||0!==(16&b)||!(x=c.relatedTarget||c.fromElement)||!wc(x)&&!x[ff])&&(k||h)&&(h=e.window===e?e:(h=e.ownerDocument)?h.defaultView||h.parentWindow:window,k?(k=d,null!==(x=(x=c.relatedTarget||c.toElement)?wc(x):null)&&(x!==(z=Zb(x))||5!==x.tag&&6!==x.tag)&&(x=null)):(k=null,x=d),k!==x)){if(w=Bd,v="onMouseLeave",u="onMouseEnter",t="mouse","pointerout"!==a&&"pointerover"!==a||(w=Td,v="onPointerLeave",u="onPointerEnter",t="pointer"),z=null==k?h:ue(k),q=null==x?h:ue(x),(h=new w(v,t+"leave",k,c,e)).target=z,h.relatedTarget=q,v=null,wc(e)===d&&((w=new w(u,t+"enter",x,c,e)).target=q,w.relatedTarget=z,v=w),z=v,k&&x)b:{for(u=x,t=0,q=w=k;q;q=gf(q))t++;for(q=0,v=u;v;v=gf(v))q++;for(;0<t-q;)w=gf(w),t--;for(;0<q-t;)u=gf(u),q--;for(;t--;){if(w===u||null!==u&&w===u.alternate)break b;w=gf(w),u=gf(u)}w=null}else w=null;null!==k&&hf(g,h,k,w,!1),null!==x&&null!==z&&hf(g,z,x,w,!0)}if("select"===(k=(h=d?ue(d):window).nodeName&&h.nodeName.toLowerCase())||"input"===k&&"file"===h.type)var J=ve;else if(me(h))if(we)J=Fe;else{J=De;var K=Ce}else(k=h.nodeName)&&"input"===k.toLowerCase()&&("checkbox"===h.type||"radio"===h.type)&&(J=Ee);switch(J&&(J=J(a,d))?ne(g,J,c,e):(K&&K(a,h,d),"focusout"===a&&(K=h._wrapperState)&&K.controlled&&"number"===h.type&&bb(h,"number",h.value)),K=d?ue(d):window,a){case"focusin":(me(K)||"true"===K.contentEditable)&&(Qe=K,Re=d,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(g,c,e);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(g,c,e)}var Q;if(ae)b:{switch(a){case"compositionstart":var L="onCompositionStart";break b;case"compositionend":L="onCompositionEnd";break b;case"compositionupdate":L="onCompositionUpdate";break b}L=void 0}else ie?ge(a,c)&&(L="onCompositionEnd"):"keydown"===a&&229===c.keyCode&&(L="onCompositionStart");L&&(de&&"ko"!==c.locale&&(ie||"onCompositionStart"!==L?"onCompositionEnd"===L&&ie&&(Q=nd()):(ld="value"in(kd=e)?kd.value:kd.textContent,ie=!0)),0<(K=oe(d,L)).length&&(L=new Ld(L,a,null,c,e),g.push({event:L,listeners:K}),Q?L.data=Q:null!==(Q=he(c))&&(L.data=Q))),(Q=ce?function(a,b){switch(a){case"compositionend":return he(b);case"keypress":return 32!==b.which?null:(fe=!0,ee);case"textInput":return(a=b.data)===ee&&fe?null:a;default:return null}}(a,c):function(a,b){if(ie)return"compositionend"===a||!ae&&ge(a,b)?(a=nd(),md=ld=kd=null,ie=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return de&&"ko"!==b.locale?null:b.data;default:return null}}(a,c))&&(0<(d=oe(d,"onBeforeInput")).length&&(e=new Ld("onBeforeInput","beforeinput",null,c,e),g.push({event:e,listeners:d}),e.data=Q))}se(g,b)}))}function ef(a,b,c){return{instance:a,listener:b,currentTarget:c}}function oe(a,b){for(var c=b+"Capture",d=[];null!==a;){var e=a,f=e.stateNode;5===e.tag&&null!==f&&(e=f,null!=(f=Ob(a,c))&&d.unshift(ef(a,f,e)),null!=(f=Ob(a,b))&&d.push(ef(a,f,e))),a=a.return}return d}function gf(a){if(null===a)return null;do{a=a.return}while(a&&5!==a.tag);return a||null}function hf(a,b,c,d,e){for(var f=b._reactName,g=[];null!==c&&c!==d;){var h=c,k=h.alternate,l=h.stateNode;if(null!==k&&k===d)break;5===h.tag&&null!==l&&(h=l,e?null!=(k=Ob(c,f))&&g.unshift(ef(c,k,h)):e||null!=(k=Ob(c,f))&&g.push(ef(c,k,h))),c=c.return}0!==g.length&&a.push({event:b,listeners:g})}function jf(){}var kf=null,lf=null;function mf(a,b){switch(a){case"button":case"input":case"select":case"textarea":return!!b.autoFocus}return!1}function nf(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var of="function"===typeof setTimeout?setTimeout:void 0,pf="function"===typeof clearTimeout?clearTimeout:void 0;function qf(a){1===a.nodeType?a.textContent="":9===a.nodeType&&(null!=(a=a.body)&&(a.textContent=""))}function rf(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function sf(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if("$"===c||"$!"===c||"$?"===c){if(0===b)return a;b--}else"/$"===c&&b++}a=a.previousSibling}return null}var tf=0;var vf=Math.random().toString(36).slice(2),wf="__reactFiber$"+vf,xf="__reactProps$"+vf,ff="__reactContainer$"+vf,yf="__reactEvents$"+vf;function wc(a){var b=a[wf];if(b)return b;for(var c=a.parentNode;c;){if(b=c[ff]||c[wf]){if(c=b.alternate,null!==b.child||null!==c&&null!==c.child)for(a=sf(a);null!==a;){if(c=a[wf])return c;a=sf(a)}return b}c=(a=c).parentNode}return null}function Cb(a){return!(a=a[wf]||a[ff])||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function ue(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(y(33))}function Db(a){return a[xf]||null}function $e(a){var b=a[yf];return void 0===b&&(b=a[yf]=new Set),b}var zf=[],Af=-1;function Bf(a){return{current:a}}function H(a){0>Af||(a.current=zf[Af],zf[Af]=null,Af--)}function I(a,b){Af++,zf[Af]=a.current,a.current=b}var Cf={},M=Bf(Cf),N=Bf(!1),Df=Cf;function Ef(a,b){var c=a.type.contextTypes;if(!c)return Cf;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var f,e={};for(f in c)e[f]=b[f];return d&&((a=a.stateNode).__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e),e}function Ff(a){return null!==(a=a.childContextTypes)&&void 0!==a}function Gf(){H(N),H(M)}function Hf(a,b,c){if(M.current!==Cf)throw Error(y(168));I(M,b),I(N,c)}function If(a,b,c){var d=a.stateNode;if(a=b.childContextTypes,"function"!==typeof d.getChildContext)return c;for(var e in d=d.getChildContext())if(!(e in a))throw Error(y(108,Ra(b)||"Unknown",e));return m({},c,d)}function Jf(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Cf,Df=M.current,I(M,a),I(N,N.current),!0}function Kf(a,b,c){var d=a.stateNode;if(!d)throw Error(y(169));c?(a=If(a,b,Df),d.__reactInternalMemoizedMergedChildContext=a,H(N),H(M),I(M,a)):H(N),I(N,c)}var Lf=null,Mf=null,Nf=r.unstable_runWithPriority,Of=r.unstable_scheduleCallback,Pf=r.unstable_cancelCallback,Qf=r.unstable_shouldYield,Rf=r.unstable_requestPaint,Sf=r.unstable_now,Tf=r.unstable_getCurrentPriorityLevel,Uf=r.unstable_ImmediatePriority,Vf=r.unstable_UserBlockingPriority,Wf=r.unstable_NormalPriority,Xf=r.unstable_LowPriority,Yf=r.unstable_IdlePriority,Zf={},$f=void 0!==Rf?Rf:function(){},ag=null,bg=null,cg=!1,dg=Sf(),O=1e4>dg?Sf:function(){return Sf()-dg};function eg(){switch(Tf()){case Uf:return 99;case Vf:return 98;case Wf:return 97;case Xf:return 96;case Yf:return 95;default:throw Error(y(332))}}function fg(a){switch(a){case 99:return Uf;case 98:return Vf;case 97:return Wf;case 96:return Xf;case 95:return Yf;default:throw Error(y(332))}}function gg(a,b){return a=fg(a),Nf(a,b)}function hg(a,b,c){return a=fg(a),Of(a,b,c)}function ig(){if(null!==bg){var a=bg;bg=null,Pf(a)}jg()}function jg(){if(!cg&&null!==ag){cg=!0;var a=0;try{var b=ag;gg(99,(function(){for(;a<b.length;a++){var c=b[a];do{c=c(!0)}while(null!==c)}})),ag=null}catch(c){throw null!==ag&&(ag=ag.slice(a+1)),Of(Uf,ig),c}finally{cg=!1}}}var kg=ra.ReactCurrentBatchConfig;function lg(a,b){if(a&&a.defaultProps){for(var c in b=m({},b),a=a.defaultProps)void 0===b[c]&&(b[c]=a[c]);return b}return b}var mg=Bf(null),ng=null,og=null,pg=null;function qg(){pg=og=ng=null}function rg(a){var b=mg.current;H(mg),a.type._context._currentValue=b}function sg(a,b){for(;null!==a;){var c=a.alternate;if((a.childLanes&b)===b){if(null===c||(c.childLanes&b)===b)break;c.childLanes|=b}else a.childLanes|=b,null!==c&&(c.childLanes|=b);a=a.return}}function tg(a,b){ng=a,pg=og=null,null!==(a=a.dependencies)&&null!==a.firstContext&&(0!==(a.lanes&b)&&(ug=!0),a.firstContext=null)}function vg(a,b){if(pg!==a&&!1!==b&&0!==b)if("number"===typeof b&&1073741823!==b||(pg=a,b=1073741823),b={context:a,observedBits:b,next:null},null===og){if(null===ng)throw Error(y(308));og=b,ng.dependencies={lanes:0,firstContext:b,responders:null}}else og=og.next=b;return a._currentValue}var wg=!1;function xg(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function yg(a,b){a=a.updateQueue,b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function zg(a,b){return{eventTime:a,lane:b,tag:0,payload:null,callback:null,next:null}}function Ag(a,b){if(null!==(a=a.updateQueue)){var c=(a=a.shared).pending;null===c?b.next=b:(b.next=c.next,c.next=b),a.pending=b}}function Bg(a,b){var c=a.updateQueue,d=a.alternate;if(null!==d&&c===(d=d.updateQueue)){var e=null,f=null;if(null!==(c=c.firstBaseUpdate)){do{var g={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};null===f?e=f=g:f=f.next=g,c=c.next}while(null!==c);null===f?e=f=b:f=f.next=b}else e=f=b;return c={baseState:d.baseState,firstBaseUpdate:e,lastBaseUpdate:f,shared:d.shared,effects:d.effects},void(a.updateQueue=c)}null===(a=c.lastBaseUpdate)?c.firstBaseUpdate=b:a.next=b,c.lastBaseUpdate=b}function Cg(a,b,c,d){var e=a.updateQueue;wg=!1;var f=e.firstBaseUpdate,g=e.lastBaseUpdate,h=e.shared.pending;if(null!==h){e.shared.pending=null;var k=h,l=k.next;k.next=null,null===g?f=l:g.next=l,g=k;var n=a.alternate;if(null!==n){var A=(n=n.updateQueue).lastBaseUpdate;A!==g&&(null===A?n.firstBaseUpdate=l:A.next=l,n.lastBaseUpdate=k)}}if(null!==f){for(A=e.baseState,g=0,n=l=k=null;;){h=f.lane;var p=f.eventTime;if((d&h)===h){null!==n&&(n=n.next={eventTime:p,lane:0,tag:f.tag,payload:f.payload,callback:f.callback,next:null});a:{var C=a,x=f;switch(h=b,p=c,x.tag){case 1:if("function"===typeof(C=x.payload)){A=C.call(p,A,h);break a}A=C;break a;case 3:C.flags=-4097&C.flags|64;case 0:if(null===(h="function"===typeof(C=x.payload)?C.call(p,A,h):C)||void 0===h)break a;A=m({},A,h);break a;case 2:wg=!0}}null!==f.callback&&(a.flags|=32,null===(h=e.effects)?e.effects=[f]:h.push(f))}else p={eventTime:p,lane:h,tag:f.tag,payload:f.payload,callback:f.callback,next:null},null===n?(l=n=p,k=A):n=n.next=p,g|=h;if(null===(f=f.next)){if(null===(h=e.shared.pending))break;f=h.next,h.next=null,e.lastBaseUpdate=h,e.shared.pending=null}}null===n&&(k=A),e.baseState=k,e.firstBaseUpdate=l,e.lastBaseUpdate=n,Dg|=g,a.lanes=g,a.memoizedState=A}}function Eg(a,b,c){if(a=b.effects,b.effects=null,null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){if(d.callback=null,d=c,"function"!==typeof e)throw Error(y(191,e));e.call(d)}}}var Fg=(new aa.Component).refs;function Gg(a,b,c,d){c=null===(c=c(d,b=a.memoizedState))||void 0===c?b:m({},b,c),a.memoizedState=c,0===a.lanes&&(a.updateQueue.baseState=c)}var Kg={isMounted:function(a){return!!(a=a._reactInternals)&&Zb(a)===a},enqueueSetState:function(a,b,c){a=a._reactInternals;var d=Hg(),e=Ig(a),f=zg(d,e);f.payload=b,void 0!==c&&null!==c&&(f.callback=c),Ag(a,f),Jg(a,e,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternals;var d=Hg(),e=Ig(a),f=zg(d,e);f.tag=1,f.payload=b,void 0!==c&&null!==c&&(f.callback=c),Ag(a,f),Jg(a,e,d)},enqueueForceUpdate:function(a,b){a=a._reactInternals;var c=Hg(),d=Ig(a),e=zg(c,d);e.tag=2,void 0!==b&&null!==b&&(e.callback=b),Ag(a,e),Jg(a,d,c)}};function Lg(a,b,c,d,e,f,g){return"function"===typeof(a=a.stateNode).shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):!b.prototype||!b.prototype.isPureReactComponent||(!Je(c,d)||!Je(e,f))}function Mg(a,b,c){var d=!1,e=Cf,f=b.contextType;return"object"===typeof f&&null!==f?f=vg(f):(e=Ff(b)?Df:M.current,f=(d=null!==(d=b.contextTypes)&&void 0!==d)?Ef(a,e):Cf),b=new b(c,f),a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null,b.updater=Kg,a.stateNode=b,b._reactInternals=a,d&&((a=a.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f),b}function Ng(a,b,c,d){a=b.state,"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d),"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d),b.state!==a&&Kg.enqueueReplaceState(b,b.state,null)}function Og(a,b,c,d){var e=a.stateNode;e.props=c,e.state=a.memoizedState,e.refs=Fg,xg(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=vg(f):(f=Ff(b)?Df:M.current,e.context=Ef(a,f)),Cg(a,c,e,d),e.state=a.memoizedState,"function"===typeof(f=b.getDerivedStateFromProps)&&(Gg(a,b,f,c),e.state=a.memoizedState),"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Kg.enqueueReplaceState(e,e.state,null),Cg(a,c,e,d),e.state=a.memoizedState),"function"===typeof e.componentDidMount&&(a.flags|=4)}var Pg=Array.isArray;function Qg(a,b,c){if(null!==(a=c.ref)&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){if(c=c._owner){if(1!==c.tag)throw Error(y(309));var d=c.stateNode}if(!d)throw Error(y(147,a));var e=""+a;return null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e?b.ref:((b=function(a){var b=d.refs;b===Fg&&(b=d.refs={}),null===a?delete b[e]:b[e]=a})._stringRef=e,b)}if("string"!==typeof a)throw Error(y(284));if(!c._owner)throw Error(y(290,a))}return a}function Rg(a,b){if("textarea"!==a.type)throw Error(y(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b))}function Sg(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c,c.nextEffect=null,c.flags=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,b),b=b.sibling;return a}function e(a,b){return(a=Tg(a,b)).index=0,a.sibling=null,a}function f(b,c,d){return b.index=d,a?null!==(d=b.alternate)?(d=d.index)<c?(b.flags=2,c):d:(b.flags=2,c):c}function g(b){return a&&null===b.alternate&&(b.flags=2),b}function h(a,b,c,d){return null===b||6!==b.tag?((b=Ug(c,a.mode,d)).return=a,b):((b=e(b,c)).return=a,b)}function k(a,b,c,d){return null!==b&&b.elementType===c.type?((d=e(b,c.props)).ref=Qg(a,b,c),d.return=a,d):((d=Vg(c.type,c.key,c.props,null,a.mode,d)).ref=Qg(a,b,c),d.return=a,d)}function l(a,b,c,d){return null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation?((b=Wg(c,a.mode,d)).return=a,b):((b=e(b,c.children||[])).return=a,b)}function n(a,b,c,d,f){return null===b||7!==b.tag?((b=Xg(c,a.mode,d,f)).return=a,b):((b=e(b,c)).return=a,b)}function A(a,b,c){if("string"===typeof b||"number"===typeof b)return(b=Ug(""+b,a.mode,c)).return=a,b;if("object"===typeof b&&null!==b){switch(b.$$typeof){case sa:return(c=Vg(b.type,b.key,b.props,null,a.mode,c)).ref=Qg(a,null,b),c.return=a,c;case ta:return(b=Wg(b,a.mode,c)).return=a,b}if(Pg(b)||La(b))return(b=Xg(b,a.mode,c,null)).return=a,b;Rg(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case sa:return c.key===e?c.type===ua?n(a,b,c.props.children,d,e):k(a,b,c,d):null;case ta:return c.key===e?l(a,b,c,d):null}if(Pg(c)||La(c))return null!==e?null:n(a,b,c,d,null);Rg(a,c)}return null}function C(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return h(b,a=a.get(c)||null,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case sa:return a=a.get(null===d.key?c:d.key)||null,d.type===ua?n(b,a,d.props.children,e,d.key):k(b,a,d,e);case ta:return l(b,a=a.get(null===d.key?c:d.key)||null,d,e)}if(Pg(d)||La(d))return n(b,a=a.get(c)||null,d,e,null);Rg(b,d)}return null}function x(e,g,h,k){for(var l=null,t=null,u=g,z=g=0,q=null;null!==u&&z<h.length;z++){u.index>z?(q=u,u=null):q=u.sibling;var n=p(e,u,h[z],k);if(null===n){null===u&&(u=q);break}a&&u&&null===n.alternate&&b(e,u),g=f(n,g,z),null===t?l=n:t.sibling=n,t=n,u=q}if(z===h.length)return c(e,u),l;if(null===u){for(;z<h.length;z++)null!==(u=A(e,h[z],k))&&(g=f(u,g,z),null===t?l=u:t.sibling=u,t=u);return l}for(u=d(e,u);z<h.length;z++)null!==(q=C(u,e,z,h[z],k))&&(a&&null!==q.alternate&&u.delete(null===q.key?z:q.key),g=f(q,g,z),null===t?l=q:t.sibling=q,t=q);return a&&u.forEach((function(a){return b(e,a)})),l}function w(e,g,h,k){var l=La(h);if("function"!==typeof l)throw Error(y(150));if(null==(h=l.call(h)))throw Error(y(151));for(var t=l=null,u=g,z=g=0,q=null,n=h.next();null!==u&&!n.done;z++,n=h.next()){u.index>z?(q=u,u=null):q=u.sibling;var w=p(e,u,n.value,k);if(null===w){null===u&&(u=q);break}a&&u&&null===w.alternate&&b(e,u),g=f(w,g,z),null===t?l=w:t.sibling=w,t=w,u=q}if(n.done)return c(e,u),l;if(null===u){for(;!n.done;z++,n=h.next())null!==(n=A(e,n.value,k))&&(g=f(n,g,z),null===t?l=n:t.sibling=n,t=n);return l}for(u=d(e,u);!n.done;z++,n=h.next())null!==(n=C(u,e,z,n.value,k))&&(a&&null!==n.alternate&&u.delete(null===n.key?z:n.key),g=f(n,g,z),null===t?l=n:t.sibling=n,t=n);return a&&u.forEach((function(a){return b(e,a)})),l}return function(a,d,f,h){var k="object"===typeof f&&null!==f&&f.type===ua&&null===f.key;k&&(f=f.props.children);var l="object"===typeof f&&null!==f;if(l)switch(f.$$typeof){case sa:a:{for(l=f.key,k=d;null!==k;){if(k.key===l){switch(k.tag){case 7:if(f.type===ua){c(a,k.sibling),(d=e(k,f.props.children)).return=a,a=d;break a}break;default:if(k.elementType===f.type){c(a,k.sibling),(d=e(k,f.props)).ref=Qg(a,k,f),d.return=a,a=d;break a}}c(a,k);break}b(a,k),k=k.sibling}f.type===ua?((d=Xg(f.props.children,a.mode,h,f.key)).return=a,a=d):((h=Vg(f.type,f.key,f.props,null,a.mode,h)).ref=Qg(a,d,f),h.return=a,a=h)}return g(a);case ta:a:{for(k=f.key;null!==d;){if(d.key===k){if(4===d.tag&&d.stateNode.containerInfo===f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling),(d=e(d,f.children||[])).return=a,a=d;break a}c(a,d);break}b(a,d),d=d.sibling}(d=Wg(f,a.mode,h)).return=a,a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),(d=e(d,f)).return=a,a=d):(c(a,d),(d=Ug(f,a.mode,h)).return=a,a=d),g(a);if(Pg(f))return x(a,d,f,h);if(La(f))return w(a,d,f,h);if(l&&Rg(a,f),"undefined"===typeof f&&!k)switch(a.tag){case 1:case 22:case 0:case 11:case 15:throw Error(y(152,Ra(a.type)||"Component"))}return c(a,d)}}var Yg=Sg(!0),Zg=Sg(!1),$g={},ah=Bf($g),bh=Bf($g),ch=Bf($g);function dh(a){if(a===$g)throw Error(y(174));return a}function eh(a,b){switch(I(ch,b),I(bh,a),I(ah,$g),a=b.nodeType){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:mb(null,"");break;default:b=mb(b=(a=8===a?b.parentNode:b).namespaceURI||null,a=a.tagName)}H(ah),I(ah,b)}function fh(){H(ah),H(bh),H(ch)}function gh(a){dh(ch.current);var b=dh(ah.current),c=mb(b,a.type);b!==c&&(I(bh,a),I(ah,c))}function hh(a){bh.current===a&&(H(ah),H(bh))}var P=Bf(0);function ih(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(null===(c=c.dehydrated)||"$?"===c.data||"$!"===c.data))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(64&b.flags))return b}else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var jh=null,kh=null,lh=!1;function mh(a,b){var c=nh(5,null,null,0);c.elementType="DELETED",c.type="DELETED",c.stateNode=b,c.return=a,c.flags=8,null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function oh(a,b){switch(a.tag){case 5:var c=a.type;return null!==(b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b)&&(a.stateNode=b,!0);case 6:return null!==(b=""===a.pendingProps||3!==b.nodeType?null:b)&&(a.stateNode=b,!0);case 13:default:return!1}}function ph(a){if(lh){var b=kh;if(b){var c=b;if(!oh(a,b)){if(!(b=rf(c.nextSibling))||!oh(a,b))return a.flags=-1025&a.flags|2,lh=!1,void(jh=a);mh(jh,c)}jh=a,kh=rf(b.firstChild)}else a.flags=-1025&a.flags|2,lh=!1,jh=a}}function qh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;jh=a}function rh(a){if(a!==jh)return!1;if(!lh)return qh(a),lh=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==b&&!nf(b,a.memoizedProps))for(b=kh;b;)mh(a,b),b=rf(b.nextSibling);if(qh(a),13===a.tag){if(!(a=null!==(a=a.memoizedState)?a.dehydrated:null))throw Error(y(317));a:{for(a=a.nextSibling,b=0;a;){if(8===a.nodeType){var c=a.data;if("/$"===c){if(0===b){kh=rf(a.nextSibling);break a}b--}else"$"!==c&&"$!"!==c&&"$?"!==c||b++}a=a.nextSibling}kh=null}}else kh=jh?rf(a.stateNode.nextSibling):null;return!0}function sh(){kh=jh=null,lh=!1}var th=[];function uh(){for(var a=0;a<th.length;a++)th[a]._workInProgressVersionPrimary=null;th.length=0}var vh=ra.ReactCurrentDispatcher,wh=ra.ReactCurrentBatchConfig,xh=0,R=null,S=null,T=null,yh=!1,zh=!1;function Ah(){throw Error(y(321))}function Bh(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!He(a[c],b[c]))return!1;return!0}function Ch(a,b,c,d,e,f){if(xh=f,R=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,vh.current=null===a||null===a.memoizedState?Dh:Eh,a=c(d,e),zh){f=0;do{if(zh=!1,!(25>f))throw Error(y(301));f+=1,T=S=null,b.updateQueue=null,vh.current=Fh,a=c(d,e)}while(zh)}if(vh.current=Gh,b=null!==S&&null!==S.next,xh=0,T=S=R=null,yh=!1,b)throw Error(y(300));return a}function Hh(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===T?R.memoizedState=T=a:T=T.next=a,T}function Ih(){if(null===S){var a=R.alternate;a=null!==a?a.memoizedState:null}else a=S.next;var b=null===T?R.memoizedState:T.next;if(null!==b)T=b,S=a;else{if(null===a)throw Error(y(310));a={memoizedState:(S=a).memoizedState,baseState:S.baseState,baseQueue:S.baseQueue,queue:S.queue,next:null},null===T?R.memoizedState=T=a:T=T.next=a}return T}function Jh(a,b){return"function"===typeof b?b(a):b}function Kh(a){var b=Ih(),c=b.queue;if(null===c)throw Error(y(311));c.lastRenderedReducer=a;var d=S,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next,f.next=g}d.baseQueue=e=f,c.pending=null}if(null!==e){e=e.next,d=d.baseState;var h=g=f=null,k=e;do{var l=k.lane;if((xh&l)===l)null!==h&&(h=h.next={lane:0,action:k.action,eagerReducer:k.eagerReducer,eagerState:k.eagerState,next:null}),d=k.eagerReducer===a?k.eagerState:a(d,k.action);else{var n={lane:l,action:k.action,eagerReducer:k.eagerReducer,eagerState:k.eagerState,next:null};null===h?(g=h=n,f=d):h=h.next=n,R.lanes|=l,Dg|=l}k=k.next}while(null!==k&&k!==e);null===h?f=d:h.next=g,He(d,b.memoizedState)||(ug=!0),b.memoizedState=d,b.baseState=f,b.baseQueue=h,c.lastRenderedState=d}return[b.memoizedState,c.dispatch]}function Lh(a){var b=Ih(),c=b.queue;if(null===c)throw Error(y(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do{f=a(f,g.action),g=g.next}while(g!==e);He(f,b.memoizedState)||(ug=!0),b.memoizedState=f,null===b.baseQueue&&(b.baseState=f),c.lastRenderedState=f}return[f,d]}function Mh(a,b,c){var d=b._getVersion;d=d(b._source);var e=b._workInProgressVersionPrimary;if(null!==e?a=e===d:(a=a.mutableReadLanes,(a=(xh&a)===a)&&(b._workInProgressVersionPrimary=d,th.push(b))),a)return c(b._source);throw th.push(b),Error(y(350))}function Nh(a,b,c,d){var e=U;if(null===e)throw Error(y(349));var f=b._getVersion,g=f(b._source),h=vh.current,k=h.useState((function(){return Mh(e,b,c)})),l=k[1],n=k[0];k=T;var A=a.memoizedState,p=A.refs,C=p.getSnapshot,x=A.source;A=A.subscribe;var w=R;return a.memoizedState={refs:p,source:b,subscribe:d},h.useEffect((function(){p.getSnapshot=c,p.setSnapshot=l;var a=f(b._source);if(!He(g,a)){a=c(b._source),He(n,a)||(l(a),a=Ig(w),e.mutableReadLanes|=a&e.pendingLanes),a=e.mutableReadLanes,e.entangledLanes|=a;for(var d=e.entanglements,h=a;0<h;){var k=31-Vc(h),v=1<<k;d[k]|=a,h&=~v}}}),[c,b,d]),h.useEffect((function(){return d(b._source,(function(){var a=p.getSnapshot,c=p.setSnapshot;try{c(a(b._source));var d=Ig(w);e.mutableReadLanes|=d&e.pendingLanes}catch(q){c((function(){throw q}))}}))}),[b,d]),He(C,c)&&He(x,b)&&He(A,d)||((a={pending:null,dispatch:null,lastRenderedReducer:Jh,lastRenderedState:n}).dispatch=l=Oh.bind(null,R,a),k.queue=a,k.baseQueue=null,n=Mh(e,b,c),k.memoizedState=k.baseState=n),n}function Ph(a,b,c){return Nh(Ih(),a,b,c)}function Qh(a){var b=Hh();return"function"===typeof a&&(a=a()),b.memoizedState=b.baseState=a,a=(a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Jh,lastRenderedState:a}).dispatch=Oh.bind(null,R,a),[b.memoizedState,a]}function Rh(a,b,c,d){return a={tag:a,create:b,destroy:c,deps:d,next:null},null===(b=R.updateQueue)?(b={lastEffect:null},R.updateQueue=b,b.lastEffect=a.next=a):null===(c=b.lastEffect)?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a),a}function Sh(a){return a={current:a},Hh().memoizedState=a}function Th(){return Ih().memoizedState}function Uh(a,b,c,d){var e=Hh();R.flags|=a,e.memoizedState=Rh(1|b,c,void 0,void 0===d?null:d)}function Vh(a,b,c,d){var e=Ih();d=void 0===d?null:d;var f=void 0;if(null!==S){var g=S.memoizedState;if(f=g.destroy,null!==d&&Bh(d,g.deps))return void Rh(b,c,f,d)}R.flags|=a,e.memoizedState=Rh(1|b,c,f,d)}function Wh(a,b){return Uh(516,4,a,b)}function Xh(a,b){return Vh(516,4,a,b)}function Yh(a,b){return Vh(4,2,a,b)}function Zh(a,b){return"function"===typeof b?(a=a(),b(a),function(){b(null)}):null!==b&&void 0!==b?(a=a(),b.current=a,function(){b.current=null}):void 0}function $h(a,b,c){return c=null!==c&&void 0!==c?c.concat([a]):null,Vh(4,2,Zh.bind(null,b,a),c)}function ai(){}function bi(a,b){var c=Ih();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&Bh(b,d[1])?d[0]:(c.memoizedState=[a,b],a)}function ci(a,b){var c=Ih();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&Bh(b,d[1])?d[0]:(a=a(),c.memoizedState=[a,b],a)}function di(a,b){var c=eg();gg(98>c?98:c,(function(){a(!0)})),gg(97<c?97:c,(function(){var c=wh.transition;wh.transition=1;try{a(!1),b()}finally{wh.transition=c}}))}function Oh(a,b,c){var d=Hg(),e=Ig(a),f={lane:e,action:c,eagerReducer:null,eagerState:null,next:null},g=b.pending;if(null===g?f.next=f:(f.next=g.next,g.next=f),b.pending=f,g=a.alternate,a===R||null!==g&&g===R)zh=yh=!0;else{if(0===a.lanes&&(null===g||0===g.lanes)&&null!==(g=b.lastRenderedReducer))try{var h=b.lastRenderedState,k=g(h,c);if(f.eagerReducer=g,f.eagerState=k,He(k,h))return}catch(l){}Jg(a,e,d)}}var Gh={readContext:vg,useCallback:Ah,useContext:Ah,useEffect:Ah,useImperativeHandle:Ah,useLayoutEffect:Ah,useMemo:Ah,useReducer:Ah,useRef:Ah,useState:Ah,useDebugValue:Ah,useDeferredValue:Ah,useTransition:Ah,useMutableSource:Ah,useOpaqueIdentifier:Ah,unstable_isNewReconciler:!1},Dh={readContext:vg,useCallback:function(a,b){return Hh().memoizedState=[a,void 0===b?null:b],a},useContext:vg,useEffect:Wh,useImperativeHandle:function(a,b,c){return c=null!==c&&void 0!==c?c.concat([a]):null,Uh(4,2,Zh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return Uh(4,2,a,b)},useMemo:function(a,b){var c=Hh();return b=void 0===b?null:b,a=a(),c.memoizedState=[a,b],a},useReducer:function(a,b,c){var d=Hh();return b=void 0!==c?c(b):b,d.memoizedState=d.baseState=b,a=(a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b}).dispatch=Oh.bind(null,R,a),[d.memoizedState,a]},useRef:Sh,useState:Qh,useDebugValue:ai,useDeferredValue:function(a){var b=Qh(a),c=b[0],d=b[1];return Wh((function(){var b=wh.transition;wh.transition=1;try{d(a)}finally{wh.transition=b}}),[a]),c},useTransition:function(){var a=Qh(!1),b=a[0];return Sh(a=di.bind(null,a[1])),[a,b]},useMutableSource:function(a,b,c){var d=Hh();return d.memoizedState={refs:{getSnapshot:b,setSnapshot:null},source:a,subscribe:c},Nh(d,a,b,c)},useOpaqueIdentifier:function(){if(lh){var a=!1,b=function(a){return{$$typeof:Ga,toString:a,valueOf:a}}((function(){throw a||(a=!0,c("r:"+(tf++).toString(36))),Error(y(355))})),c=Qh(b)[1];return 0===(2&R.mode)&&(R.flags|=516,Rh(5,(function(){c("r:"+(tf++).toString(36))}),void 0,null)),b}return Qh(b="r:"+(tf++).toString(36)),b},unstable_isNewReconciler:!1},Eh={readContext:vg,useCallback:bi,useContext:vg,useEffect:Xh,useImperativeHandle:$h,useLayoutEffect:Yh,useMemo:ci,useReducer:Kh,useRef:Th,useState:function(){return Kh(Jh)},useDebugValue:ai,useDeferredValue:function(a){var b=Kh(Jh),c=b[0],d=b[1];return Xh((function(){var b=wh.transition;wh.transition=1;try{d(a)}finally{wh.transition=b}}),[a]),c},useTransition:function(){var a=Kh(Jh)[0];return[Th().current,a]},useMutableSource:Ph,useOpaqueIdentifier:function(){return Kh(Jh)[0]},unstable_isNewReconciler:!1},Fh={readContext:vg,useCallback:bi,useContext:vg,useEffect:Xh,useImperativeHandle:$h,useLayoutEffect:Yh,useMemo:ci,useReducer:Lh,useRef:Th,useState:function(){return Lh(Jh)},useDebugValue:ai,useDeferredValue:function(a){var b=Lh(Jh),c=b[0],d=b[1];return Xh((function(){var b=wh.transition;wh.transition=1;try{d(a)}finally{wh.transition=b}}),[a]),c},useTransition:function(){var a=Lh(Jh)[0];return[Th().current,a]},useMutableSource:Ph,useOpaqueIdentifier:function(){return Lh(Jh)[0]},unstable_isNewReconciler:!1},ei=ra.ReactCurrentOwner,ug=!1;function fi(a,b,c,d){b.child=null===a?Zg(b,null,c,d):Yg(b,a.child,c,d)}function gi(a,b,c,d,e){c=c.render;var f=b.ref;return tg(b,e),d=Ch(a,b,c,d,f,e),null===a||ug?(b.flags|=1,fi(a,b,d,e),b.child):(b.updateQueue=a.updateQueue,b.flags&=-517,a.lanes&=~e,hi(a,b,e))}function ii(a,b,c,d,e,f){if(null===a){var g=c.type;return"function"!==typeof g||ji(g)||void 0!==g.defaultProps||null!==c.compare||void 0!==c.defaultProps?((a=Vg(c.type,null,d,b,b.mode,f)).ref=b.ref,a.return=b,b.child=a):(b.tag=15,b.type=g,ki(a,b,g,d,e,f))}return g=a.child,0===(e&f)&&(e=g.memoizedProps,(c=null!==(c=c.compare)?c:Je)(e,d)&&a.ref===b.ref)?hi(a,b,f):(b.flags|=1,(a=Tg(g,d)).ref=b.ref,a.return=b,b.child=a)}function ki(a,b,c,d,e,f){if(null!==a&&Je(a.memoizedProps,d)&&a.ref===b.ref){if(ug=!1,0===(f&e))return b.lanes=a.lanes,hi(a,b,f);0!==(16384&a.flags)&&(ug=!0)}return li(a,b,c,d,f)}function mi(a,b,c){var d=b.pendingProps,e=d.children,f=null!==a?a.memoizedState:null;if("hidden"===d.mode||"unstable-defer-without-hiding"===d.mode)if(0===(4&b.mode))b.memoizedState={baseLanes:0},ni(b,c);else{if(0===(1073741824&c))return a=null!==f?f.baseLanes|c:c,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:a},ni(b,a),null;b.memoizedState={baseLanes:0},ni(b,null!==f?f.baseLanes:c)}else null!==f?(d=f.baseLanes|c,b.memoizedState=null):d=c,ni(b,d);return fi(a,b,e,c),b.child}function oi(a,b){var c=b.ref;(null===a&&null!==c||null!==a&&a.ref!==c)&&(b.flags|=128)}function li(a,b,c,d,e){var f=Ff(c)?Df:M.current;return f=Ef(b,f),tg(b,e),c=Ch(a,b,c,d,f,e),null===a||ug?(b.flags|=1,fi(a,b,c,e),b.child):(b.updateQueue=a.updateQueue,b.flags&=-517,a.lanes&=~e,hi(a,b,e))}function pi(a,b,c,d,e){if(Ff(c)){var f=!0;Jf(b)}else f=!1;if(tg(b,e),null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.flags|=2),Mg(b,c,d),Og(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var k=g.context,l=c.contextType;"object"===typeof l&&null!==l?l=vg(l):l=Ef(b,l=Ff(c)?Df:M.current);var n=c.getDerivedStateFromProps,A="function"===typeof n||"function"===typeof g.getSnapshotBeforeUpdate;A||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Ng(b,g,d,l),wg=!1;var p=b.memoizedState;g.state=p,Cg(b,d,g,e),k=b.memoizedState,h!==d||p!==k||N.current||wg?("function"===typeof n&&(Gg(b,c,n,d),k=b.memoizedState),(h=wg||Lg(b,c,h,d,p,k,l))?(A||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.flags|=4)):("function"===typeof g.componentDidMount&&(b.flags|=4),b.memoizedProps=d,b.memoizedState=k),g.props=d,g.state=k,g.context=l,d=h):("function"===typeof g.componentDidMount&&(b.flags|=4),d=!1)}else{g=b.stateNode,yg(a,b),h=b.memoizedProps,l=b.type===b.elementType?h:lg(b.type,h),g.props=l,A=b.pendingProps,p=g.context,"object"===typeof(k=c.contextType)&&null!==k?k=vg(k):k=Ef(b,k=Ff(c)?Df:M.current);var C=c.getDerivedStateFromProps;(n="function"===typeof C||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==A||p!==k)&&Ng(b,g,d,k),wg=!1,p=b.memoizedState,g.state=p,Cg(b,d,g,e);var x=b.memoizedState;h!==A||p!==x||N.current||wg?("function"===typeof C&&(Gg(b,c,C,d),x=b.memoizedState),(l=wg||Lg(b,c,l,d,p,x,k))?(n||"function"!==typeof g.UNSAFE_componentWillUpdate&&"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,x,k),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,x,k)),"function"===typeof g.componentDidUpdate&&(b.flags|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.flags|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&p===a.memoizedState||(b.flags|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&p===a.memoizedState||(b.flags|=256),b.memoizedProps=d,b.memoizedState=x),g.props=d,g.state=x,g.context=k,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&p===a.memoizedState||(b.flags|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&p===a.memoizedState||(b.flags|=256),d=!1)}return qi(a,b,c,d,f,e)}function qi(a,b,c,d,e,f){oi(a,b);var g=0!==(64&b.flags);if(!d&&!g)return e&&Kf(b,c,!1),hi(a,b,f);d=b.stateNode,ei.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?null:d.render();return b.flags|=1,null!==a&&g?(b.child=Yg(b,a.child,null,f),b.child=Yg(b,null,h,f)):fi(a,b,h,f),b.memoizedState=d.state,e&&Kf(b,c,!0),b.child}function ri(a){var b=a.stateNode;b.pendingContext?Hf(0,b.pendingContext,b.pendingContext!==b.context):b.context&&Hf(0,b.context,!1),eh(a,b.containerInfo)}var Bi,Di,Ei,si={dehydrated:null,retryLane:0};function ti(a,b,c){var g,d=b.pendingProps,e=P.current,f=!1;return(g=0!==(64&b.flags))||(g=(null===a||null!==a.memoizedState)&&0!==(2&e)),g?(f=!0,b.flags&=-65):null!==a&&null===a.memoizedState||void 0===d.fallback||!0===d.unstable_avoidThisFallback||(e|=1),I(P,1&e),null===a?(void 0!==d.fallback&&ph(b),a=d.children,e=d.fallback,f?(a=ui(b,a,e,c),b.child.memoizedState={baseLanes:c},b.memoizedState=si,a):"number"===typeof d.unstable_expectedLoadTime?(a=ui(b,a,e,c),b.child.memoizedState={baseLanes:c},b.memoizedState=si,b.lanes=33554432,a):((c=vi({mode:"visible",children:a},b.mode,c,null)).return=b,b.child=c)):(a.memoizedState,f?(d=wi(a,b,d.children,d.fallback,c),f=b.child,e=a.child.memoizedState,f.memoizedState=null===e?{baseLanes:c}:{baseLanes:e.baseLanes|c},f.childLanes=a.childLanes&~c,b.memoizedState=si,d):(c=xi(a,b,d.children,c),b.memoizedState=null,c))}function ui(a,b,c,d){var e=a.mode,f=a.child;return b={mode:"hidden",children:b},0===(2&e)&&null!==f?(f.childLanes=0,f.pendingProps=b):f=vi(b,e,0,null),c=Xg(c,e,d,null),f.return=a,c.return=a,f.sibling=c,a.child=f,c}function xi(a,b,c,d){var e=a.child;return a=e.sibling,c=Tg(e,{mode:"visible",children:c}),0===(2&b.mode)&&(c.lanes=d),c.return=b,c.sibling=null,null!==a&&(a.nextEffect=null,a.flags=8,b.firstEffect=b.lastEffect=a),b.child=c}function wi(a,b,c,d,e){var f=b.mode,g=a.child;a=g.sibling;var h={mode:"hidden",children:c};return 0===(2&f)&&b.child!==g?((c=b.child).childLanes=0,c.pendingProps=h,null!==(g=c.lastEffect)?(b.firstEffect=c.firstEffect,b.lastEffect=g,g.nextEffect=null):b.firstEffect=b.lastEffect=null):c=Tg(g,h),null!==a?d=Tg(a,d):(d=Xg(d,f,e,null)).flags|=2,d.return=b,c.return=b,c.sibling=d,b.child=c,d}function yi(a,b){a.lanes|=b;var c=a.alternate;null!==c&&(c.lanes|=b),sg(a.return,b)}function zi(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:e,lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailMode=e,g.lastEffect=f)}function Ai(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;if(fi(a,b,d.children,c),0!==(2&(d=P.current)))d=1&d|2,b.flags|=64;else{if(null!==a&&0!==(64&a.flags))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&yi(a,c);else if(19===a.tag)yi(a,c);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}if(I(P,d),0===(2&b.mode))b.memoizedState=null;else switch(e){case"forwards":for(c=b.child,e=null;null!==c;)null!==(a=c.alternate)&&null===ih(a)&&(e=c),c=c.sibling;null===(c=e)?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null),zi(b,!1,e,c,f,b.lastEffect);break;case"backwards":for(c=null,e=b.child,b.child=null;null!==e;){if(null!==(a=e.alternate)&&null===ih(a)){b.child=e;break}a=e.sibling,e.sibling=c,c=e,e=a}zi(b,!0,c,null,f,b.lastEffect);break;case"together":zi(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function hi(a,b,c){if(null!==a&&(b.dependencies=a.dependencies),Dg|=b.lanes,0!==(c&b.childLanes)){if(null!==a&&b.child!==a.child)throw Error(y(153));if(null!==b.child){for(c=Tg(a=b.child,a.pendingProps),b.child=c,c.return=b;null!==a.sibling;)a=a.sibling,(c=c.sibling=Tg(a,a.pendingProps)).return=b;c.sibling=null}return b.child}return null}function Fi(a,b){if(!lh)switch(a.tailMode){case"hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function Gi(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Ff(b.type)&&Gf(),null;case 3:return fh(),H(N),H(M),uh(),(d=b.stateNode).pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),null!==a&&null!==a.child||(rh(b)?b.flags|=4:d.hydrate||(b.flags|=256)),null;case 5:hh(b);var e=dh(ch.current);if(c=b.type,null!==a&&null!=b.stateNode)Di(a,b,c,d),a.ref!==b.ref&&(b.flags|=128);else{if(!d){if(null===b.stateNode)throw Error(y(166));return null}if(a=dh(ah.current),rh(b)){d=b.stateNode,c=b.type;var f=b.memoizedProps;switch(d[wf]=b,d[xf]=f,c){case"dialog":G("cancel",d),G("close",d);break;case"iframe":case"object":case"embed":G("load",d);break;case"video":case"audio":for(a=0;a<Xe.length;a++)G(Xe[a],d);break;case"source":G("error",d);break;case"img":case"image":case"link":G("error",d),G("load",d);break;case"details":G("toggle",d);break;case"input":Za(d,f),G("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!f.multiple},G("invalid",d);break;case"textarea":hb(d,f),G("invalid",d)}for(var g in vb(c,f),a=null,f)f.hasOwnProperty(g)&&(e=f[g],"children"===g?"string"===typeof e?d.textContent!==e&&(a=["children",e]):"number"===typeof e&&d.textContent!==""+e&&(a=["children",""+e]):ca.hasOwnProperty(g)&&null!=e&&"onScroll"===g&&G("scroll",d));switch(c){case"input":Va(d),cb(d,f,!0);break;case"textarea":Va(d),jb(d);break;case"select":case"option":break;default:"function"===typeof f.onClick&&(d.onclick=jf)}d=a,b.updateQueue=d,null!==d&&(b.flags|=4)}else{switch(g=9===e.nodeType?e:e.ownerDocument,a===kb_html&&(a=lb(c)),a===kb_html?"script"===c?((a=g.createElement("div")).innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(c,{is:d.is}):(a=g.createElement(c),"select"===c&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,c),a[wf]=b,a[xf]=d,Bi(a,b),b.stateNode=a,g=wb(c,d),c){case"dialog":G("cancel",a),G("close",a),e=d;break;case"iframe":case"object":case"embed":G("load",a),e=d;break;case"video":case"audio":for(e=0;e<Xe.length;e++)G(Xe[e],a);e=d;break;case"source":G("error",a),e=d;break;case"img":case"image":case"link":G("error",a),G("load",a),e=d;break;case"details":G("toggle",a),e=d;break;case"input":Za(a,d),e=Ya(a,d),G("invalid",a);break;case"option":e=eb(a,d);break;case"select":a._wrapperState={wasMultiple:!!d.multiple},e=m({},d,{value:void 0}),G("invalid",a);break;case"textarea":hb(a,d),e=gb(a,d),G("invalid",a);break;default:e=d}vb(c,e);var h=e;for(f in h)if(h.hasOwnProperty(f)){var k=h[f];"style"===f?tb(a,k):"dangerouslySetInnerHTML"===f?null!=(k=k?k.__html:void 0)&&ob(a,k):"children"===f?"string"===typeof k?("textarea"!==c||""!==k)&&pb(a,k):"number"===typeof k&&pb(a,""+k):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(ca.hasOwnProperty(f)?null!=k&&"onScroll"===f&&G("scroll",a):null!=k&&qa(a,f,k,g))}switch(c){case"input":Va(a),cb(a,d,!1);break;case"textarea":Va(a),jb(a);break;case"option":null!=d.value&&a.setAttribute("value",""+Sa(d.value));break;case"select":a.multiple=!!d.multiple,null!=(f=d.value)?fb(a,!!d.multiple,f,!1):null!=d.defaultValue&&fb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof e.onClick&&(a.onclick=jf)}mf(c,d)&&(b.flags|=4)}null!==b.ref&&(b.flags|=128)}return null;case 6:if(a&&null!=b.stateNode)Ei(0,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(y(166));c=dh(ch.current),dh(ah.current),rh(b)?(d=b.stateNode,c=b.memoizedProps,d[wf]=b,d.nodeValue!==c&&(b.flags|=4)):((d=(9===c.nodeType?c:c.ownerDocument).createTextNode(d))[wf]=b,b.stateNode=d)}return null;case 13:return H(P),d=b.memoizedState,0!==(64&b.flags)?(b.lanes=c,b):(d=null!==d,c=!1,null===a?void 0!==b.memoizedProps.fallback&&rh(b):c=null!==a.memoizedState,d&&!c&&0!==(2&b.mode)&&(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||0!==(1&P.current)?0===V&&(V=3):(0!==V&&3!==V||(V=4),null===U||0===(134217727&Dg)&&0===(134217727&Hi)||Ii(U,W))),(d||c)&&(b.flags|=4),null);case 4:return fh(),null===a&&cf(b.stateNode.containerInfo),null;case 10:return rg(b),null;case 17:return Ff(b.type)&&Gf(),null;case 19:if(H(P),null===(d=b.memoizedState))return null;if(f=0!==(64&b.flags),null===(g=d.rendering))if(f)Fi(d,!1);else{if(0!==V||null!==a&&0!==(64&a.flags))for(a=b.child;null!==a;){if(null!==(g=ih(a))){for(b.flags|=64,Fi(d,!1),null!==(f=g.updateQueue)&&(b.updateQueue=f,b.flags|=4),null===d.lastEffect&&(b.firstEffect=null),b.lastEffect=d.lastEffect,d=c,c=b.child;null!==c;)a=d,(f=c).flags&=2,f.nextEffect=null,f.firstEffect=null,f.lastEffect=null,null===(g=f.alternate)?(f.childLanes=0,f.lanes=a,f.child=null,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=g.childLanes,f.lanes=g.lanes,f.child=g.child,f.memoizedProps=g.memoizedProps,f.memoizedState=g.memoizedState,f.updateQueue=g.updateQueue,f.type=g.type,a=g.dependencies,f.dependencies=null===a?null:{lanes:a.lanes,firstContext:a.firstContext}),c=c.sibling;return I(P,1&P.current|2),b.child}a=a.sibling}null!==d.tail&&O()>Ji&&(b.flags|=64,f=!0,Fi(d,!1),b.lanes=33554432)}else{if(!f)if(null!==(a=ih(g))){if(b.flags|=64,f=!0,null!==(c=a.updateQueue)&&(b.updateQueue=c,b.flags|=4),Fi(d,!0),null===d.tail&&"hidden"===d.tailMode&&!g.alternate&&!lh)return null!==(b=b.lastEffect=d.lastEffect)&&(b.nextEffect=null),null}else 2*O()-d.renderingStartTime>Ji&&1073741824!==c&&(b.flags|=64,f=!0,Fi(d,!1),b.lanes=33554432);d.isBackwards?(g.sibling=b.child,b.child=g):(null!==(c=d.last)?c.sibling=g:b.child=g,d.last=g)}return null!==d.tail?(c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=O(),c.sibling=null,b=P.current,I(P,f?1&b|2:1&b),c):null;case 23:case 24:return Ki(),null!==a&&null!==a.memoizedState!==(null!==b.memoizedState)&&"unstable-defer-without-hiding"!==d.mode&&(b.flags|=4),null}throw Error(y(156,b.tag))}function Li(a){switch(a.tag){case 1:Ff(a.type)&&Gf();var b=a.flags;return 4096&b?(a.flags=-4097&b|64,a):null;case 3:if(fh(),H(N),H(M),uh(),0!==(64&(b=a.flags)))throw Error(y(285));return a.flags=-4097&b|64,a;case 5:return hh(a),null;case 13:return H(P),4096&(b=a.flags)?(a.flags=-4097&b|64,a):null;case 19:return H(P),null;case 4:return fh(),null;case 10:return rg(a),null;case 23:case 24:return Ki(),null;default:return null}}function Mi(a,b){try{var c="",d=b;do{c+=Qa(d),d=d.return}while(d);var e=c}catch(f){e="\nError generating stack: "+f.message+"\n"+f.stack}return{value:a,source:b,stack:e}}function Ni(a,b){try{console.error(b.value)}catch(c){setTimeout((function(){throw c}))}}Bi=function(a,b){for(var c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c,c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},Di=function(a,b,c,d){var e=a.memoizedProps;if(e!==d){a=b.stateNode,dh(ah.current);var g,f=null;switch(c){case"input":e=Ya(a,e),d=Ya(a,d),f=[];break;case"option":e=eb(a,e),d=eb(a,d),f=[];break;case"select":e=m({},e,{value:void 0}),d=m({},d,{value:void 0}),f=[];break;case"textarea":e=gb(a,e),d=gb(a,d),f=[];break;default:"function"!==typeof e.onClick&&"function"===typeof d.onClick&&(a.onclick=jf)}for(l in vb(c,d),c=null,e)if(!d.hasOwnProperty(l)&&e.hasOwnProperty(l)&&null!=e[l])if("style"===l){var h=e[l];for(g in h)h.hasOwnProperty(g)&&(c||(c={}),c[g]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(ca.hasOwnProperty(l)?f||(f=[]):(f=f||[]).push(l,null));for(l in d){var k=d[l];if(h=null!=e?e[l]:void 0,d.hasOwnProperty(l)&&k!==h&&(null!=k||null!=h))if("style"===l)if(h){for(g in h)!h.hasOwnProperty(g)||k&&k.hasOwnProperty(g)||(c||(c={}),c[g]="");for(g in k)k.hasOwnProperty(g)&&h[g]!==k[g]&&(c||(c={}),c[g]=k[g])}else c||(f||(f=[]),f.push(l,c)),c=k;else"dangerouslySetInnerHTML"===l?(k=k?k.__html:void 0,h=h?h.__html:void 0,null!=k&&h!==k&&(f=f||[]).push(l,k)):"children"===l?"string"!==typeof k&&"number"!==typeof k||(f=f||[]).push(l,""+k):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(ca.hasOwnProperty(l)?(null!=k&&"onScroll"===l&&G("scroll",a),f||h===k||(f=[])):"object"===typeof k&&null!==k&&k.$$typeof===Ga?k.toString():(f=f||[]).push(l,k))}c&&(f=f||[]).push("style",c);var l=f;(b.updateQueue=l)&&(b.flags|=4)}},Ei=function(a,b,c,d){c!==d&&(b.flags|=4)};var Oi="function"===typeof WeakMap?WeakMap:Map;function Pi(a,b,c){(c=zg(-1,c)).tag=3,c.payload={element:null};var d=b.value;return c.callback=function(){Qi||(Qi=!0,Ri=d),Ni(0,b)},c}function Si(a,b,c){(c=zg(-1,c)).tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){return Ni(0,b),d(e)}}var f=a.stateNode;return null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&(null===Ti?Ti=new Set([this]):Ti.add(this),Ni(0,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})}),c}var Ui="function"===typeof WeakSet?WeakSet:Set;function Vi(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Wi(a,c)}else b.current=null}function Xi(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&b.flags&&null!==a){var c=a.memoizedProps,d=a.memoizedState;b=(a=b.stateNode).getSnapshotBeforeUpdate(b.elementType===b.type?c:lg(b.type,c),d),a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:return void(256&b.flags&&qf(b.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(y(163))}function Yi(a,b,c){switch(c.tag){case 0:case 11:case 15:case 22:if(null!==(b=null!==(b=c.updateQueue)?b.lastEffect:null)){a=b=b.next;do{if(3===(3&a.tag)){var d=a.create;a.destroy=d()}a=a.next}while(a!==b)}if(null!==(b=null!==(b=c.updateQueue)?b.lastEffect:null)){a=b=b.next;do{var e=a;d=e.next,0!==(4&(e=e.tag))&&0!==(1&e)&&(Zi(c,a),$i(c,a)),a=d}while(a!==b)}return;case 1:return a=c.stateNode,4&c.flags&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:lg(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate))),void(null!==(b=c.updateQueue)&&Eg(c,b,a));case 3:if(null!==(b=c.updateQueue)){if(a=null,null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Eg(c,b,a)}return;case 5:return a=c.stateNode,void(null===b&&4&c.flags&&mf(c.type,c.memoizedProps)&&a.focus());case 6:case 4:case 12:return;case 13:return void(null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&Cc(c)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(y(163))}function aj(a,b){for(var c=a;;){if(5===c.tag){var d=c.stateNode;if(b)"function"===typeof(d=d.style).setProperty?d.setProperty("display","none","important"):d.display="none";else{d=c.stateNode;var e=c.memoizedProps.style;e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,d.style.display=sb("display",e)}}else if(6===c.tag)c.stateNode.nodeValue=b?"":c.memoizedProps;else if((23!==c.tag&&24!==c.tag||null===c.memoizedState||c===a)&&null!==c.child){c.child.return=c,c=c.child;continue}if(c===a)break;for(;null===c.sibling;){if(null===c.return||c.return===a)return;c=c.return}c.sibling.return=c.return,c=c.sibling}}function bj(a,b){if(Mf&&"function"===typeof Mf.onCommitFiberUnmount)try{Mf.onCommitFiberUnmount(Lf,b)}catch(f){}switch(b.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(a=b.updateQueue)&&null!==(a=a.lastEffect)){var c=a=a.next;do{var d=c,e=d.destroy;if(d=d.tag,void 0!==e)if(0!==(4&d))Zi(b,c);else{d=b;try{e()}catch(f){Wi(d,f)}}c=c.next}while(c!==a)}break;case 1:if(Vi(b),"function"===typeof(a=b.stateNode).componentWillUnmount)try{a.props=b.memoizedProps,a.state=b.memoizedState,a.componentWillUnmount()}catch(f){Wi(b,f)}break;case 5:Vi(b);break;case 4:cj(a,b)}}function dj(a){a.alternate=null,a.child=null,a.dependencies=null,a.firstEffect=null,a.lastEffect=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.return=null,a.updateQueue=null}function ej(a){return 5===a.tag||3===a.tag||4===a.tag}function fj(a){a:{for(var b=a.return;null!==b;){if(ej(b))break a;b=b.return}throw Error(y(160))}var c=b;switch(b=c.stateNode,c.tag){case 5:var d=!1;break;case 3:case 4:b=b.containerInfo,d=!0;break;default:throw Error(y(161))}16&c.flags&&(pb(b,""),c.flags&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||ej(c.return)){c=null;break a}c=c.return}for(c.sibling.return=c.return,c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(2&c.flags)continue b;if(null===c.child||4===c.tag)continue b;c.child.return=c,c=c.child}if(!(2&c.flags)){c=c.stateNode;break a}}d?gj(a,c,b):hj(a,c,b)}function gj(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode).insertBefore(a,c):(b=c).appendChild(a),null!==(c=c._reactRootContainer)&&void 0!==c||null!==b.onclick||(b.onclick=jf));else if(4!==d&&null!==(a=a.child))for(gj(a,b,c),a=a.sibling;null!==a;)gj(a,b,c),a=a.sibling}function hj(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&null!==(a=a.child))for(hj(a,b,c),a=a.sibling;null!==a;)hj(a,b,c),a=a.sibling}function cj(a,b){for(var e,f,c=b,d=!1;;){if(!d){d=c.return;a:for(;;){if(null===d)throw Error(y(160));switch(e=d.stateNode,d.tag){case 5:f=!1;break a;case 3:case 4:e=e.containerInfo,f=!0;break a}d=d.return}d=!0}if(5===c.tag||6===c.tag){a:for(var g=a,h=c,k=h;;)if(bj(g,k),null!==k.child&&4!==k.tag)k.child.return=k,k=k.child;else{if(k===h)break a;for(;null===k.sibling;){if(null===k.return||k.return===h)break a;k=k.return}k.sibling.return=k.return,k=k.sibling}f?(g=e,h=c.stateNode,8===g.nodeType?g.parentNode.removeChild(h):g.removeChild(h)):e.removeChild(c.stateNode)}else if(4===c.tag){if(null!==c.child){e=c.stateNode.containerInfo,f=!0,c.child.return=c,c=c.child;continue}}else if(bj(a,c),null!==c.child){c.child.return=c,c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;4===(c=c.return).tag&&(d=!1)}c.sibling.return=c.return,c=c.sibling}}function ij(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:var c=b.updateQueue;if(null!==(c=null!==c?c.lastEffect:null)){var d=c=c.next;do{3===(3&d.tag)&&(a=d.destroy,d.destroy=void 0,void 0!==a&&a()),d=d.next}while(d!==c)}return;case 1:return;case 5:if(null!=(c=b.stateNode)){d=b.memoizedProps;var e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;if(b.updateQueue=null,null!==f){for(c[xf]=d,"input"===a&&"radio"===d.type&&null!=d.name&&$a(c,d),wb(a,e),b=wb(a,d),e=0;e<f.length;e+=2){var g=f[e],h=f[e+1];"style"===g?tb(c,h):"dangerouslySetInnerHTML"===g?ob(c,h):"children"===g?pb(c,h):qa(c,g,h,b)}switch(a){case"input":ab(c,d);break;case"textarea":ib(c,d);break;case"select":a=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,null!=(f=d.value)?fb(c,!!d.multiple,f,!1):a!==!!d.multiple&&(null!=d.defaultValue?fb(c,!!d.multiple,d.defaultValue,!0):fb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(y(162));return void(b.stateNode.nodeValue=b.memoizedProps);case 3:return void((c=b.stateNode).hydrate&&(c.hydrate=!1,Cc(c.containerInfo)));case 12:return;case 13:return null!==b.memoizedState&&(jj=O(),aj(b.child,!0)),void kj(b);case 19:return void kj(b);case 17:return;case 23:case 24:return void aj(b,null!==b.memoizedState)}throw Error(y(163))}function kj(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=new Ui),b.forEach((function(b){var d=lj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))}))}}function mj(a,b){return null!==a&&(null===(a=a.memoizedState)||null!==a.dehydrated)&&(null!==(b=b.memoizedState)&&null===b.dehydrated)}var nj=Math.ceil,oj=ra.ReactCurrentDispatcher,pj=ra.ReactCurrentOwner,X=0,U=null,Y=null,W=0,qj=0,rj=Bf(0),V=0,sj=null,tj=0,Dg=0,Hi=0,uj=0,vj=null,jj=0,Ji=1/0;function wj(){Ji=O()+500}var ck,Z=null,Qi=!1,Ri=null,Ti=null,xj=!1,yj=null,zj=90,Aj=[],Bj=[],Cj=null,Dj=0,Ej=null,Fj=-1,Gj=0,Hj=0,Ij=null,Jj=!1;function Hg(){return 0!==(48&X)?O():-1!==Fj?Fj:Fj=O()}function Ig(a){if(0===(2&(a=a.mode)))return 1;if(0===(4&a))return 99===eg()?1:2;if(0===Gj&&(Gj=tj),0!==kg.transition){0!==Hj&&(Hj=null!==vj?vj.pendingLanes:0),a=Gj;var b=4186112&~Hj;return 0===(b&=-b)&&(0===(b=(a=4186112&~a)&-a)&&(b=8192)),b}return a=eg(),0!==(4&X)&&98===a?a=Xc(12,Gj):a=Xc(a=function(a){switch(a){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(a),Gj),a}function Jg(a,b,c){if(50<Dj)throw Dj=0,Ej=null,Error(y(185));if(null===(a=Kj(a,b)))return null;$c(a,b,c),a===U&&(Hi|=b,4===V&&Ii(a,W));var d=eg();1===b?0!==(8&X)&&0===(48&X)?Lj(a):(Mj(a,c),0===X&&(wj(),ig())):(0===(4&X)||98!==d&&99!==d||(null===Cj?Cj=new Set([a]):Cj.add(a)),Mj(a,c)),vj=a}function Kj(a,b){a.lanes|=b;var c=a.alternate;for(null!==c&&(c.lanes|=b),c=a,a=a.return;null!==a;)a.childLanes|=b,null!==(c=a.alternate)&&(c.childLanes|=b),c=a,a=a.return;return 3===c.tag?c.stateNode:null}function Mj(a,b){for(var c=a.callbackNode,d=a.suspendedLanes,e=a.pingedLanes,f=a.expirationTimes,g=a.pendingLanes;0<g;){var h=31-Vc(g),k=1<<h,l=f[h];if(-1===l){if(0===(k&d)||0!==(k&e)){l=b,Rc(k);var n=F;f[h]=10<=n?l+250:6<=n?l+5e3:-1}}else l<=b&&(a.expiredLanes|=k);g&=~k}if(d=Uc(a,a===U?W:0),b=F,0===d)null!==c&&(c!==Zf&&Pf(c),a.callbackNode=null,a.callbackPriority=0);else{if(null!==c){if(a.callbackPriority===b)return;c!==Zf&&Pf(c)}15===b?(c=Lj.bind(null,a),null===ag?(ag=[c],bg=Of(Uf,jg)):ag.push(c),c=Zf):14===b?c=hg(99,Lj.bind(null,a)):c=hg(c=function(a){switch(a){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(y(358,a))}}(b),Nj.bind(null,a)),a.callbackPriority=b,a.callbackNode=c}}function Nj(a){if(Fj=-1,Hj=Gj=0,0!==(48&X))throw Error(y(327));var b=a.callbackNode;if(Oj()&&a.callbackNode!==b)return null;var c=Uc(a,a===U?W:0);if(0===c)return null;var d=c,e=X;X|=16;var f=Pj();for(U===a&&W===d||(wj(),Qj(a,d));;)try{Rj();break}catch(h){Sj(a,h)}if(qg(),oj.current=f,X=e,null!==Y?d=0:(U=null,W=0,d=V),0!==(tj&Hi))Qj(a,0);else if(0!==d){if(2===d&&(X|=64,a.hydrate&&(a.hydrate=!1,qf(a.containerInfo)),0!==(c=Wc(a))&&(d=Tj(a,c))),1===d)throw b=sj,Qj(a,0),Ii(a,c),Mj(a,O()),b;switch(a.finishedWork=a.current.alternate,a.finishedLanes=c,d){case 0:case 1:throw Error(y(345));case 2:Uj(a);break;case 3:if(Ii(a,c),(62914560&c)===c&&10<(d=jj+500-O())){if(0!==Uc(a,0))break;if(((e=a.suspendedLanes)&c)!==c){Hg(),a.pingedLanes|=a.suspendedLanes&e;break}a.timeoutHandle=of(Uj.bind(null,a),d);break}Uj(a);break;case 4:if(Ii(a,c),(4186112&c)===c)break;for(d=a.eventTimes,e=-1;0<c;){var g=31-Vc(c);f=1<<g,(g=d[g])>e&&(e=g),c&=~f}if(c=e,10<(c=(120>(c=O()-c)?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*nj(c/1960))-c)){a.timeoutHandle=of(Uj.bind(null,a),c);break}Uj(a);break;case 5:Uj(a);break;default:throw Error(y(329))}}return Mj(a,O()),a.callbackNode===b?Nj.bind(null,a):null}function Ii(a,b){for(b&=~uj,b&=~Hi,a.suspendedLanes|=b,a.pingedLanes&=~b,a=a.expirationTimes;0<b;){var c=31-Vc(b),d=1<<c;a[c]=-1,b&=~d}}function Lj(a){if(0!==(48&X))throw Error(y(327));if(Oj(),a===U&&0!==(a.expiredLanes&W)){var b=W,c=Tj(a,b);0!==(tj&Hi)&&(c=Tj(a,b=Uc(a,b)))}else c=Tj(a,b=Uc(a,0));if(0!==a.tag&&2===c&&(X|=64,a.hydrate&&(a.hydrate=!1,qf(a.containerInfo)),0!==(b=Wc(a))&&(c=Tj(a,b))),1===c)throw c=sj,Qj(a,0),Ii(a,b),Mj(a,O()),c;return a.finishedWork=a.current.alternate,a.finishedLanes=b,Uj(a),Mj(a,O()),null}function Wj(a,b){var c=X;X|=1;try{return a(b)}finally{0===(X=c)&&(wj(),ig())}}function Xj(a,b){var c=X;X&=-2,X|=8;try{return a(b)}finally{0===(X=c)&&(wj(),ig())}}function ni(a,b){I(rj,qj),qj|=b,tj|=b}function Ki(){qj=rj.current,H(rj)}function Qj(a,b){a.finishedWork=null,a.finishedLanes=0;var c=a.timeoutHandle;if(-1!==c&&(a.timeoutHandle=-1,pf(c)),null!==Y)for(c=Y.return;null!==c;){var d=c;switch(d.tag){case 1:null!==(d=d.type.childContextTypes)&&void 0!==d&&Gf();break;case 3:fh(),H(N),H(M),uh();break;case 5:hh(d);break;case 4:fh();break;case 13:case 19:H(P);break;case 10:rg(d);break;case 23:case 24:Ki()}c=c.return}U=a,Y=Tg(a.current,null),W=qj=tj=b,V=0,sj=null,uj=Hi=Dg=0}function Sj(a,b){for(;;){var c=Y;try{if(qg(),vh.current=Gh,yh){for(var d=R.memoizedState;null!==d;){var e=d.queue;null!==e&&(e.pending=null),d=d.next}yh=!1}if(xh=0,T=S=R=null,zh=!1,pj.current=null,null===c||null===c.return){V=1,sj=b,Y=null;break}a:{var f=a,g=c.return,h=c,k=b;if(b=W,h.flags|=2048,h.firstEffect=h.lastEffect=null,null!==k&&"object"===typeof k&&"function"===typeof k.then){var l=k;if(0===(2&h.mode)){var n=h.alternate;n?(h.updateQueue=n.updateQueue,h.memoizedState=n.memoizedState,h.lanes=n.lanes):(h.updateQueue=null,h.memoizedState=null)}var A=0!==(1&P.current),p=g;do{var C;if(C=13===p.tag){var x=p.memoizedState;if(null!==x)C=null!==x.dehydrated;else{var w=p.memoizedProps;C=void 0!==w.fallback&&(!0!==w.unstable_avoidThisFallback||!A)}}if(C){var z=p.updateQueue;if(null===z){var u=new Set;u.add(l),p.updateQueue=u}else z.add(l);if(0===(2&p.mode)){if(p.flags|=64,h.flags|=16384,h.flags&=-2981,1===h.tag)if(null===h.alternate)h.tag=17;else{var t=zg(-1,1);t.tag=2,Ag(h,t)}h.lanes|=1;break a}k=void 0,h=b;var q=f.pingCache;if(null===q?(q=f.pingCache=new Oi,k=new Set,q.set(l,k)):void 0===(k=q.get(l))&&(k=new Set,q.set(l,k)),!k.has(h)){k.add(h);var v=Yj.bind(null,f,l,h);l.then(v,v)}p.flags|=4096,p.lanes=b;break a}p=p.return}while(null!==p);k=Error((Ra(h.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==V&&(V=2),k=Mi(k,h),p=g;do{switch(p.tag){case 3:f=k,p.flags|=4096,b&=-b,p.lanes|=b,Bg(p,Pi(0,f,b));break a;case 1:f=k;var K=p.type,Q=p.stateNode;if(0===(64&p.flags)&&("function"===typeof K.getDerivedStateFromError||null!==Q&&"function"===typeof Q.componentDidCatch&&(null===Ti||!Ti.has(Q)))){p.flags|=4096,b&=-b,p.lanes|=b,Bg(p,Si(p,f,b));break a}}p=p.return}while(null!==p)}Zj(c)}catch(va){b=va,Y===c&&null!==c&&(Y=c=c.return);continue}break}}function Pj(){var a=oj.current;return oj.current=Gh,null===a?Gh:a}function Tj(a,b){var c=X;X|=16;var d=Pj();for(U===a&&W===b||Qj(a,b);;)try{ak();break}catch(e){Sj(a,e)}if(qg(),X=c,oj.current=d,null!==Y)throw Error(y(261));return U=null,W=0,V}function ak(){for(;null!==Y;)bk(Y)}function Rj(){for(;null!==Y&&!Qf();)bk(Y)}function bk(a){var b=ck(a.alternate,a,qj);a.memoizedProps=a.pendingProps,null===b?Zj(a):Y=b,pj.current=null}function Zj(a){var b=a;do{var c=b.alternate;if(a=b.return,0===(2048&b.flags)){if(null!==(c=Gi(c,b,qj)))return void(Y=c);if(24!==(c=b).tag&&23!==c.tag||null===c.memoizedState||0!==(1073741824&qj)||0===(4&c.mode)){for(var d=0,e=c.child;null!==e;)d|=e.lanes|e.childLanes,e=e.sibling;c.childLanes=d}null!==a&&0===(2048&a.flags)&&(null===a.firstEffect&&(a.firstEffect=b.firstEffect),null!==b.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=b.firstEffect),a.lastEffect=b.lastEffect),1<b.flags&&(null!==a.lastEffect?a.lastEffect.nextEffect=b:a.firstEffect=b,a.lastEffect=b))}else{if(null!==(c=Li(b)))return c.flags&=2047,void(Y=c);null!==a&&(a.firstEffect=a.lastEffect=null,a.flags|=2048)}if(null!==(b=b.sibling))return void(Y=b);Y=b=a}while(null!==b);0===V&&(V=5)}function Uj(a){var b=eg();return gg(99,dk.bind(null,a,b)),null}function dk(a,b){do{Oj()}while(null!==yj);if(0!==(48&X))throw Error(y(327));var c=a.finishedWork;if(null===c)return null;if(a.finishedWork=null,a.finishedLanes=0,c===a.current)throw Error(y(177));a.callbackNode=null;var d=c.lanes|c.childLanes,e=d,f=a.pendingLanes&~e;a.pendingLanes=e,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=e,a.mutableReadLanes&=e,a.entangledLanes&=e,e=a.entanglements;for(var g=a.eventTimes,h=a.expirationTimes;0<f;){var k=31-Vc(f),l=1<<k;e[k]=0,g[k]=-1,h[k]=-1,f&=~l}if(null!==Cj&&0===(24&d)&&Cj.has(a)&&Cj.delete(a),a===U&&(Y=U=null,W=0),1<c.flags?null!==c.lastEffect?(c.lastEffect.nextEffect=c,d=c.firstEffect):d=c:d=c.firstEffect,null!==d){if(e=X,X|=32,pj.current=null,kf=fd,Oe(g=Ne())){if("selectionStart"in g)h={start:g.selectionStart,end:g.selectionEnd};else a:if(h=(h=g.ownerDocument)&&h.defaultView||window,(l=h.getSelection&&h.getSelection())&&0!==l.rangeCount){h=l.anchorNode,f=l.anchorOffset,k=l.focusNode,l=l.focusOffset;try{h.nodeType,k.nodeType}catch(va){h=null;break a}var n=0,A=-1,p=-1,C=0,x=0,w=g,z=null;b:for(;;){for(var u;w!==h||0!==f&&3!==w.nodeType||(A=n+f),w!==k||0!==l&&3!==w.nodeType||(p=n+l),3===w.nodeType&&(n+=w.nodeValue.length),null!==(u=w.firstChild);)z=w,w=u;for(;;){if(w===g)break b;if(z===h&&++C===f&&(A=n),z===k&&++x===l&&(p=n),null!==(u=w.nextSibling))break;z=(w=z).parentNode}w=u}h=-1===A||-1===p?null:{start:A,end:p}}else h=null;h=h||{start:0,end:0}}else h=null;lf={focusedElem:g,selectionRange:h},fd=!1,Ij=null,Jj=!1,Z=d;do{try{ek()}catch(va){if(null===Z)throw Error(y(330));Wi(Z,va),Z=Z.nextEffect}}while(null!==Z);Ij=null,Z=d;do{try{for(g=a;null!==Z;){var t=Z.flags;if(16&t&&pb(Z.stateNode,""),128&t){var q=Z.alternate;if(null!==q){var v=q.ref;null!==v&&("function"===typeof v?v(null):v.current=null)}}switch(1038&t){case 2:fj(Z),Z.flags&=-3;break;case 6:fj(Z),Z.flags&=-3,ij(Z.alternate,Z);break;case 1024:Z.flags&=-1025;break;case 1028:Z.flags&=-1025,ij(Z.alternate,Z);break;case 4:ij(Z.alternate,Z);break;case 8:cj(g,h=Z);var J=h.alternate;dj(h),null!==J&&dj(J)}Z=Z.nextEffect}}catch(va){if(null===Z)throw Error(y(330));Wi(Z,va),Z=Z.nextEffect}}while(null!==Z);if(v=lf,q=Ne(),t=v.focusedElem,g=v.selectionRange,q!==t&&t&&t.ownerDocument&&Me(t.ownerDocument.documentElement,t)){null!==g&&Oe(t)&&(q=g.start,void 0===(v=g.end)&&(v=q),"selectionStart"in t?(t.selectionStart=q,t.selectionEnd=Math.min(v,t.value.length)):(v=(q=t.ownerDocument||document)&&q.defaultView||window).getSelection&&(v=v.getSelection(),h=t.textContent.length,J=Math.min(g.start,h),g=void 0===g.end?J:Math.min(g.end,h),!v.extend&&J>g&&(h=g,g=J,J=h),h=Le(t,J),f=Le(t,g),h&&f&&(1!==v.rangeCount||v.anchorNode!==h.node||v.anchorOffset!==h.offset||v.focusNode!==f.node||v.focusOffset!==f.offset)&&((q=q.createRange()).setStart(h.node,h.offset),v.removeAllRanges(),J>g?(v.addRange(q),v.extend(f.node,f.offset)):(q.setEnd(f.node,f.offset),v.addRange(q))))),q=[];for(v=t;v=v.parentNode;)1===v.nodeType&&q.push({element:v,left:v.scrollLeft,top:v.scrollTop});for("function"===typeof t.focus&&t.focus(),t=0;t<q.length;t++)(v=q[t]).element.scrollLeft=v.left,v.element.scrollTop=v.top}fd=!!kf,lf=kf=null,a.current=c,Z=d;do{try{for(t=a;null!==Z;){var K=Z.flags;if(36&K&&Yi(t,Z.alternate,Z),128&K){q=void 0;var Q=Z.ref;if(null!==Q){var L=Z.stateNode;switch(Z.tag){case 5:q=L;break;default:q=L}"function"===typeof Q?Q(q):Q.current=q}}Z=Z.nextEffect}}catch(va){if(null===Z)throw Error(y(330));Wi(Z,va),Z=Z.nextEffect}}while(null!==Z);Z=null,$f(),X=e}else a.current=c;if(xj)xj=!1,yj=a,zj=b;else for(Z=d;null!==Z;)b=Z.nextEffect,Z.nextEffect=null,8&Z.flags&&((K=Z).sibling=null,K.stateNode=null),Z=b;if(0===(d=a.pendingLanes)&&(Ti=null),1===d?a===Ej?Dj++:(Dj=0,Ej=a):Dj=0,c=c.stateNode,Mf&&"function"===typeof Mf.onCommitFiberRoot)try{Mf.onCommitFiberRoot(Lf,c,void 0,64===(64&c.current.flags))}catch(va){}if(Mj(a,O()),Qi)throw Qi=!1,a=Ri,Ri=null,a;return 0!==(8&X)||ig(),null}function ek(){for(;null!==Z;){var a=Z.alternate;Jj||null===Ij||(0!==(8&Z.flags)?dc(Z,Ij)&&(Jj=!0):13===Z.tag&&mj(a,Z)&&dc(Z,Ij)&&(Jj=!0));var b=Z.flags;0!==(256&b)&&Xi(a,Z),0===(512&b)||xj||(xj=!0,hg(97,(function(){return Oj(),null}))),Z=Z.nextEffect}}function Oj(){if(90!==zj){var a=97<zj?97:zj;return zj=90,gg(a,fk)}return!1}function $i(a,b){Aj.push(b,a),xj||(xj=!0,hg(97,(function(){return Oj(),null})))}function Zi(a,b){Bj.push(b,a),xj||(xj=!0,hg(97,(function(){return Oj(),null})))}function fk(){if(null===yj)return!1;var a=yj;if(yj=null,0!==(48&X))throw Error(y(331));var b=X;X|=32;var c=Bj;Bj=[];for(var d=0;d<c.length;d+=2){var e=c[d],f=c[d+1],g=e.destroy;if(e.destroy=void 0,"function"===typeof g)try{g()}catch(k){if(null===f)throw Error(y(330));Wi(f,k)}}for(c=Aj,Aj=[],d=0;d<c.length;d+=2){e=c[d],f=c[d+1];try{var h=e.create;e.destroy=h()}catch(k){if(null===f)throw Error(y(330));Wi(f,k)}}for(h=a.current.firstEffect;null!==h;)a=h.nextEffect,h.nextEffect=null,8&h.flags&&(h.sibling=null,h.stateNode=null),h=a;return X=b,ig(),!0}function gk(a,b,c){Ag(a,b=Pi(0,b=Mi(c,b),1)),b=Hg(),null!==(a=Kj(a,1))&&($c(a,1,b),Mj(a,b))}function Wi(a,b){if(3===a.tag)gk(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){gk(c,a,b);break}if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===Ti||!Ti.has(d))){var e=Si(c,a=Mi(b,a),1);if(Ag(c,e),e=Hg(),null!==(c=Kj(c,1)))$c(c,1,e),Mj(c,e);else if("function"===typeof d.componentDidCatch&&(null===Ti||!Ti.has(d)))try{d.componentDidCatch(b,a)}catch(f){}break}}c=c.return}}function Yj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b),b=Hg(),a.pingedLanes|=a.suspendedLanes&c,U===a&&(W&c)===c&&(4===V||3===V&&(62914560&W)===W&&500>O()-jj?Qj(a,0):uj|=c),Mj(a,b)}function lj(a,b){var c=a.stateNode;null!==c&&c.delete(b),0===(b=0)&&(0===(2&(b=a.mode))?b=1:0===(4&b)?b=99===eg()?1:2:(0===Gj&&(Gj=tj),0===(b=Yc(62914560&~Gj))&&(b=4194304))),c=Hg(),null!==(a=Kj(a,b))&&($c(a,b,c),Mj(a,c))}function ik(a,b,c,d){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function nh(a,b,c,d){return new ik(a,b,c,d)}function ji(a){return!(!(a=a.prototype)||!a.isReactComponent)}function Tg(a,b){var c=a.alternate;return null===c?((c=nh(a.tag,b,a.key,a.mode)).elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.type=a.type,c.flags=0,c.nextEffect=null,c.firstEffect=null,c.lastEffect=null),c.childLanes=a.childLanes,c.lanes=a.lanes,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,b=a.dependencies,c.dependencies=null===b?null:{lanes:b.lanes,firstContext:b.firstContext},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c}function Vg(a,b,c,d,e,f){var g=2;if(d=a,"function"===typeof a)ji(a)&&(g=1);else if("string"===typeof a)g=5;else a:switch(a){case ua:return Xg(c.children,e,f,b);case Ha:g=8,e|=16;break;case wa:g=8,e|=1;break;case xa:return(a=nh(12,c,b,8|e)).elementType=xa,a.type=xa,a.lanes=f,a;case Ba:return(a=nh(13,c,b,e)).type=Ba,a.elementType=Ba,a.lanes=f,a;case Ca:return(a=nh(19,c,b,e)).elementType=Ca,a.lanes=f,a;case Ia:return vi(c,e,f,b);case Ja:return(a=nh(24,c,b,e)).elementType=Ja,a.lanes=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case ya:g=10;break a;case za:g=9;break a;case Aa:g=11;break a;case Da:g=14;break a;case Ea:g=16,d=null;break a;case Fa:g=22;break a}throw Error(y(130,null==a?a:typeof a,""))}return(b=nh(g,c,b,e)).elementType=a,b.type=d,b.lanes=f,b}function Xg(a,b,c,d){return(a=nh(7,a,d,b)).lanes=c,a}function vi(a,b,c,d){return(a=nh(23,a,d,b)).elementType=Ia,a.lanes=c,a}function Ug(a,b,c){return(a=nh(6,a,null,b)).lanes=c,a}function Wg(a,b,c){return(b=nh(4,null!==a.children?a.children:[],a.key,b)).lanes=c,b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},b}function jk(a,b,c){this.tag=b,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=c,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Zc(0),this.expirationTimes=Zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Zc(0),this.mutableSourceEagerHydrationData=null}function kk(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:ta,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function lk(a,b,c,d){var e=b.current,f=Hg(),g=Ig(e);a:if(c){b:{if(Zb(c=c._reactInternals)!==c||1!==c.tag)throw Error(y(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(Ff(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(y(171))}if(1===c.tag){var k=c.type;if(Ff(k)){c=If(c,k,h);break a}}c=h}else c=Cf;return null===b.context?b.context=c:b.pendingContext=c,(b=zg(f,g)).payload={element:a},null!==(d=void 0===d?null:d)&&(b.callback=d),Ag(e,b),Jg(e,g,f),g}function mk(a){if(!(a=a.current).child)return null;switch(a.child.tag){case 5:default:return a.child.stateNode}}function nk(a,b){if(null!==(a=a.memoizedState)&&null!==a.dehydrated){var c=a.retryLane;a.retryLane=0!==c&&c<b?c:b}}function ok(a,b){nk(a,b),(a=a.alternate)&&nk(a,b)}function qk(a,b,c){var d=null!=c&&null!=c.hydrationOptions&&c.hydrationOptions.mutableSources||null;if(c=new jk(a,b,null!=c&&!0===c.hydrate),b=nh(3,null,null,2===b?7:1===b?3:0),c.current=b,b.stateNode=c,xg(b),a[ff]=c.current,cf(8===a.nodeType?a.parentNode:a),d)for(a=0;a<d.length;a++){var e=(b=d[a])._getVersion;e=e(b._source),null==c.mutableSourceEagerHydrationData?c.mutableSourceEagerHydrationData=[b,e]:c.mutableSourceEagerHydrationData.push(b,e)}this._internalRoot=c}function rk(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function tk(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;if("function"===typeof e){var h=e;e=function(){var a=mk(g);h.call(a)}}lk(b,g,a,e)}else{if(f=c._reactRootContainer=function(a,b){if(b||(b=!(!(b=a?9===a.nodeType?a.documentElement:a.firstChild:null)||1!==b.nodeType||!b.hasAttribute("data-reactroot"))),!b)for(var c;c=a.lastChild;)a.removeChild(c);return new qk(a,0,b?{hydrate:!0}:void 0)}(c,d),g=f._internalRoot,"function"===typeof e){var k=e;e=function(){var a=mk(g);k.call(a)}}Xj((function(){lk(b,g,a,e)}))}return mk(g)}function uk(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!rk(b))throw Error(y(200));return kk(a,b,null,c)}ck=function(a,b,c){var d=b.lanes;if(null!==a)if(a.memoizedProps!==b.pendingProps||N.current)ug=!0;else{if(0===(c&d)){switch(ug=!1,b.tag){case 3:ri(b),sh();break;case 5:gh(b);break;case 1:Ff(b.type)&&Jf(b);break;case 4:eh(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;var e=b.type._context;I(mg,e._currentValue),e._currentValue=d;break;case 13:if(null!==b.memoizedState)return 0!==(c&b.child.childLanes)?ti(a,b,c):(I(P,1&P.current),null!==(b=hi(a,b,c))?b.sibling:null);I(P,1&P.current);break;case 19:if(d=0!==(c&b.childLanes),0!==(64&a.flags)){if(d)return Ai(a,b,c);b.flags|=64}if(null!==(e=b.memoizedState)&&(e.rendering=null,e.tail=null,e.lastEffect=null),I(P,P.current),d)break;return null;case 23:case 24:return b.lanes=0,mi(a,b,c)}return hi(a,b,c)}ug=0!==(16384&a.flags)}else ug=!1;switch(b.lanes=0,b.tag){case 2:if(d=b.type,null!==a&&(a.alternate=null,b.alternate=null,b.flags|=2),a=b.pendingProps,e=Ef(b,M.current),tg(b,c),e=Ch(null,b,d,a,e,c),b.flags|=1,"object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){if(b.tag=1,b.memoizedState=null,b.updateQueue=null,Ff(d)){var f=!0;Jf(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,xg(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Gg(b,d,g,a),e.updater=Kg,b.stateNode=e,e._reactInternals=b,Og(b,d,a,c),b=qi(null,b,d,!0,f,c)}else b.tag=0,fi(null,b,e,c),b=b.child;return b;case 16:e=b.elementType;a:{switch(null!==a&&(a.alternate=null,b.alternate=null,b.flags|=2),a=b.pendingProps,e=(f=e._init)(e._payload),b.type=e,f=b.tag=function(a){if("function"===typeof a)return ji(a)?1:0;if(void 0!==a&&null!==a){if((a=a.$$typeof)===Aa)return 11;if(a===Da)return 14}return 2}(e),a=lg(e,a),f){case 0:b=li(null,b,e,a,c);break a;case 1:b=pi(null,b,e,a,c);break a;case 11:b=gi(null,b,e,a,c);break a;case 14:b=ii(null,b,e,lg(e.type,a),d,c);break a}throw Error(y(306,e,""))}return b;case 0:return d=b.type,e=b.pendingProps,li(a,b,d,e=b.elementType===d?e:lg(d,e),c);case 1:return d=b.type,e=b.pendingProps,pi(a,b,d,e=b.elementType===d?e:lg(d,e),c);case 3:if(ri(b),d=b.updateQueue,null===a||null===d)throw Error(y(282));if(d=b.pendingProps,e=null!==(e=b.memoizedState)?e.element:null,yg(a,b),Cg(b,d,null,c),(d=b.memoizedState.element)===e)sh(),b=hi(a,b,c);else{if((f=(e=b.stateNode).hydrate)&&(kh=rf(b.stateNode.containerInfo.firstChild),jh=b,f=lh=!0),f){if(null!=(a=e.mutableSourceEagerHydrationData))for(e=0;e<a.length;e+=2)(f=a[e])._workInProgressVersionPrimary=a[e+1],th.push(f);for(c=Zg(b,null,d,c),b.child=c;c;)c.flags=-3&c.flags|1024,c=c.sibling}else fi(a,b,d,c),sh();b=b.child}return b;case 5:return gh(b),null===a&&ph(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:null,g=e.children,nf(d,e)?g=null:null!==f&&nf(d,f)&&(b.flags|=16),oi(a,b),fi(a,b,g,c),b.child;case 6:return null===a&&ph(b),null;case 13:return ti(a,b,c);case 4:return eh(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=Yg(b,null,d,c):fi(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,gi(a,b,d,e=b.elementType===d?e:lg(d,e),c);case 7:return fi(a,b,b.pendingProps,c),b.child;case 8:case 12:return fi(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context,e=b.pendingProps,g=b.memoizedProps,f=e.value;var h=b.type._context;if(I(mg,h._currentValue),h._currentValue=f,null!==g)if(h=g.value,0===(f=He(h,f)?0:0|("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823))){if(g.children===e.children&&!N.current){b=hi(a,b,c);break a}}else for(null!==(h=b.child)&&(h.return=b);null!==h;){var k=h.dependencies;if(null!==k){g=h.child;for(var l=k.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&((l=zg(-1,c&-c)).tag=2,Ag(h,l)),h.lanes|=c,null!==(l=h.alternate)&&(l.lanes|=c),sg(h.return,c),k.lanes|=c;break}l=l.next}}else g=10===h.tag&&h.type===b.type?null:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}if(null!==(h=g.sibling)){h.return=g.return,g=h;break}g=g.return}h=g}fi(a,b,e.children,c),b=b.child}return b;case 9:return e=b.type,d=(f=b.pendingProps).children,tg(b,c),d=d(e=vg(e,f.unstable_observedBits)),b.flags|=1,fi(a,b,d,c),b.child;case 14:return f=lg(e=b.type,b.pendingProps),ii(a,b,e,f=lg(e.type,f),d,c);case 15:return ki(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:lg(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.flags|=2),b.tag=1,Ff(d)?(a=!0,Jf(b)):a=!1,tg(b,c),Mg(b,d,e),Og(b,d,e,c),qi(null,b,d,!0,a,c);case 19:return Ai(a,b,c);case 23:case 24:return mi(a,b,c)}throw Error(y(156,b.tag))},qk.prototype.render=function(a){lk(a,this._internalRoot,null,null)},qk.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;lk(null,a,null,(function(){b[ff]=null}))},ec=function(a){13===a.tag&&(Jg(a,4,Hg()),ok(a,4))},fc=function(a){13===a.tag&&(Jg(a,67108864,Hg()),ok(a,67108864))},gc=function(a){if(13===a.tag){var b=Hg(),c=Ig(a);Jg(a,c,b),ok(a,c)}},hc=function(a,b){return b()},yb=function(a,b,c){switch(b){case"input":if(ab(a,c),b=c.name,"radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]'),b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=Db(d);if(!e)throw Error(y(90));Wa(d),ab(d,e)}}}break;case"textarea":ib(a,c);break;case"select":null!=(b=c.value)&&fb(a,!!c.multiple,b,!1)}},Gb=Wj,Hb=function(a,b,c,d,e){var f=X;X|=4;try{return gg(98,a.bind(null,b,c,d,e))}finally{0===(X=f)&&(wj(),ig())}},Ib=function(){0===(49&X)&&(function(){if(null!==Cj){var a=Cj;Cj=null,a.forEach((function(a){a.expiredLanes|=24&a.pendingLanes,Mj(a,O())}))}ig()}(),Oj())},Jb=function(a,b){var c=X;X|=2;try{return a(b)}finally{0===(X=c)&&(wj(),ig())}};var vk={Events:[Cb,ue,Db,Eb,Fb,Oj,{current:!1}]},wk={findFiberByHostInstance:wc,bundleType:0,version:"17.0.1",rendererPackageName:"react-dom"},xk={bundleType:wk.bundleType,version:wk.version,rendererPackageName:wk.rendererPackageName,rendererConfig:wk.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ra.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return null===(a=cc(a))?null:a.stateNode},findFiberByHostInstance:wk.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var yk=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yk.isDisabled&&yk.supportsFiber)try{Lf=yk.inject(xk),Mf=yk}catch(a){}}exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vk,exports.createPortal=uk,exports.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternals;if(void 0===b){if("function"===typeof a.render)throw Error(y(188));throw Error(y(268,Object.keys(a)))}return a=null===(a=cc(b))?null:a.stateNode},exports.flushSync=function(a,b){var c=X;if(0!==(48&c))return a(b);X|=1;try{if(a)return gg(99,a.bind(null,b))}finally{X=c,ig()}},exports.hydrate=function(a,b,c){if(!rk(b))throw Error(y(200));return tk(null,a,b,!0,c)},exports.render=function(a,b,c){if(!rk(b))throw Error(y(200));return tk(null,a,b,!1,c)},exports.unmountComponentAtNode=function(a){if(!rk(a))throw Error(y(40));return!!a._reactRootContainer&&(Xj((function(){tk(null,null,a,!1,(function(){a._reactRootContainer=null,a[ff]=null}))})),!0)},exports.unstable_batchedUpdates=Wj,exports.unstable_createPortal=function(a,b){return uk(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},exports.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!rk(c))throw Error(y(200));if(null==a||void 0===a._reactInternals)throw Error(y(38));return tk(a,b,c,!1,d)},exports.version="17.0.1"},function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(106)},function(module,exports,__webpack_require__){"use strict";var _f,g,h,k;if("object"===typeof performance&&"function"===typeof performance.now){var l=performance;exports.unstable_now=function(){return l.now()}}else{var p=Date,q=p.now();exports.unstable_now=function(){return p.now()-q}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var t=null,u=null,w=function w(){if(null!==t)try{var a=exports.unstable_now();t(!0,a),t=null}catch(b){throw setTimeout(w,0),b}};_f=function(a){null!==t?setTimeout(_f,0,a):(t=a,setTimeout(w,0))},g=function(a,b){u=setTimeout(a,b)},h=function(){clearTimeout(u)},exports.unstable_shouldYield=function(){return!1},k=exports.unstable_forceFrameRate=function(){}}else{var x=window.setTimeout,y=window.clearTimeout;if("undefined"!==typeof console){var z=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof z&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var A=!1,B=null,C=-1,D=5,E=0;exports.unstable_shouldYield=function(){return exports.unstable_now()>=E},k=function(){},exports.unstable_forceFrameRate=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<a?Math.floor(1e3/a):5};var F=new MessageChannel,G=F.port2;F.port1.onmessage=function(){if(null!==B){var a=exports.unstable_now();E=a+D;try{B(!0,a)?G.postMessage(null):(A=!1,B=null)}catch(b){throw G.postMessage(null),b}}else A=!1},_f=function(a){B=a,A||(A=!0,G.postMessage(null))},g=function(a,b){C=x((function(){a(exports.unstable_now())}),b)},h=function(){y(C),C=-1}}function H(a,b){var c=a.length;a.push(b);a:for(;;){var d=c-1>>>1,e=a[d];if(!(void 0!==e&&0<I(e,b)))break a;a[d]=b,a[c]=e,c=d}}function J(a){return void 0===(a=a[0])?null:a}function K(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var d=0,e=a.length;d<e;){var m=2*(d+1)-1,n=a[m],v=m+1,r=a[v];if(void 0!==n&&0>I(n,c))void 0!==r&&0>I(r,n)?(a[d]=r,a[v]=c,d=v):(a[d]=n,a[m]=c,d=m);else{if(!(void 0!==r&&0>I(r,c)))break a;a[d]=r,a[v]=c,d=v}}}return b}return null}function I(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}var L=[],M=[],N=1,O=null,P=3,Q=!1,R=!1,S=!1;function T(a){for(var b=J(M);null!==b;){if(null===b.callback)K(M);else{if(!(b.startTime<=a))break;K(M),b.sortIndex=b.expirationTime,H(L,b)}b=J(M)}}function U(a){if(S=!1,T(a),!R)if(null!==J(L))R=!0,_f(V);else{var b=J(M);null!==b&&g(U,b.startTime-a)}}function V(a,b){R=!1,S&&(S=!1,h()),Q=!0;var c=P;try{for(T(b),O=J(L);null!==O&&(!(O.expirationTime>b)||a&&!exports.unstable_shouldYield());){var d=O.callback;if("function"===typeof d){O.callback=null,P=O.priorityLevel;var e=d(O.expirationTime<=b);b=exports.unstable_now(),"function"===typeof e?O.callback=e:O===J(L)&&K(L),T(b)}else K(L);O=J(L)}if(null!==O)var m=!0;else{var n=J(M);null!==n&&g(U,n.startTime-b),m=!1}return m}finally{O=null,P=c,Q=!1}}var W=k;exports.unstable_IdlePriority=5,exports.unstable_ImmediatePriority=1,exports.unstable_LowPriority=4,exports.unstable_NormalPriority=3,exports.unstable_Profiling=null,exports.unstable_UserBlockingPriority=2,exports.unstable_cancelCallback=function(a){a.callback=null},exports.unstable_continueExecution=function(){R||Q||(R=!0,_f(V))},exports.unstable_getCurrentPriorityLevel=function(){return P},exports.unstable_getFirstCallbackNode=function(){return J(L)},exports.unstable_next=function(a){switch(P){case 1:case 2:case 3:var b=3;break;default:b=P}var c=P;P=b;try{return a()}finally{P=c}},exports.unstable_pauseExecution=function(){},exports.unstable_requestPaint=W,exports.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=P;P=a;try{return b()}finally{P=c}},exports.unstable_scheduleCallback=function(a,b,c){var d=exports.unstable_now();switch("object"===typeof c&&null!==c?c="number"===typeof(c=c.delay)&&0<c?d+c:d:c=d,a){case 1:var e=-1;break;case 2:e=250;break;case 5:e=1073741823;break;case 4:e=1e4;break;default:e=5e3}return a={id:N++,callback:b,priorityLevel:a,startTime:c,expirationTime:e=c+e,sortIndex:-1},c>d?(a.sortIndex=c,H(M,a),null===J(L)&&a===J(M)&&(S?h():S=!0,g(U,c-d))):(a.sortIndex=e,H(L,a),R||Q||(R=!0,_f(V))),a},exports.unstable_wrapCallback=function(a){var b=P;return function(){var c=P;P=b;try{return a.apply(this,arguments)}finally{P=c}}}},,function(module,exports,__webpack_require__){var runtime=function(exports){"use strict";var Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"===typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){prototype[method]=function(arg){return this._invoke(method,arg)}}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"===typeof value&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(undefined===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"===typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}return GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction",exports.isGeneratorFunction=function(genFun){var ctor="function"===typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,toStringTagSymbol in genFun||(genFun[toStringTagSymbol]="GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this},exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),Gp[toStringTagSymbol]="Generator",Gp[iteratorSymbol]=function(){return this},Gp.toString=function(){return"[object Generator]"},exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel}},exports}(module.exports);try{regeneratorRuntime=runtime}catch(accidentalStrictMode){Function("r","regeneratorRuntime = r")(runtime)}},,function(module,exports,__webpack_require__){"use strict";var ReactPropTypesSecret=__webpack_require__(111);function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction,module.exports=function(){function shim(props,propName,componentName,location,propFullName,secret){if(secret!==ReactPropTypesSecret){var err=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw err.name="Invariant Violation",err}}function getShim(){return shim}shim.isRequired=shim;var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,elementType:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return ReactPropTypes.PropTypes=ReactPropTypes,ReactPropTypes}},function(module,exports,__webpack_require__){"use strict";module.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(module,exports,__webpack_require__){"use strict";var b="function"===typeof Symbol&&Symbol.for,c=b?Symbol.for("react.element"):60103,d=b?Symbol.for("react.portal"):60106,e=b?Symbol.for("react.fragment"):60107,f=b?Symbol.for("react.strict_mode"):60108,g=b?Symbol.for("react.profiler"):60114,h=b?Symbol.for("react.provider"):60109,k=b?Symbol.for("react.context"):60110,l=b?Symbol.for("react.async_mode"):60111,m=b?Symbol.for("react.concurrent_mode"):60111,n=b?Symbol.for("react.forward_ref"):60112,p=b?Symbol.for("react.suspense"):60113,q=b?Symbol.for("react.suspense_list"):60120,r=b?Symbol.for("react.memo"):60115,t=b?Symbol.for("react.lazy"):60116,v=b?Symbol.for("react.block"):60121,w=b?Symbol.for("react.fundamental"):60117,x=b?Symbol.for("react.responder"):60118,y=b?Symbol.for("react.scope"):60119;function z(a){if("object"===typeof a&&null!==a){var u=a.$$typeof;switch(u){case c:switch(a=a.type){case l:case m:case e:case g:case f:case p:return a;default:switch(a=a&&a.$$typeof){case k:case n:case t:case r:case h:return a;default:return u}}case d:return u}}}function A(a){return z(a)===m}exports.AsyncMode=l,exports.ConcurrentMode=m,exports.ContextConsumer=k,exports.ContextProvider=h,exports.Element=c,exports.ForwardRef=n,exports.Fragment=e,exports.Lazy=t,exports.Memo=r,exports.Portal=d,exports.Profiler=g,exports.StrictMode=f,exports.Suspense=p,exports.isAsyncMode=function(a){return A(a)||z(a)===l},exports.isConcurrentMode=A,exports.isContextConsumer=function(a){return z(a)===k},exports.isContextProvider=function(a){return z(a)===h},exports.isElement=function(a){return"object"===typeof a&&null!==a&&a.$$typeof===c},exports.isForwardRef=function(a){return z(a)===n},exports.isFragment=function(a){return z(a)===e},exports.isLazy=function(a){return z(a)===t},exports.isMemo=function(a){return z(a)===r},exports.isPortal=function(a){return z(a)===d},exports.isProfiler=function(a){return z(a)===g},exports.isStrictMode=function(a){return z(a)===f},exports.isSuspense=function(a){return z(a)===p},exports.isValidElementType=function(a){return"string"===typeof a||"function"===typeof a||a===e||a===m||a===g||a===f||a===p||a===q||"object"===typeof a&&null!==a&&(a.$$typeof===t||a.$$typeof===r||a.$$typeof===h||a.$$typeof===k||a.$$typeof===n||a.$$typeof===w||a.$$typeof===x||a.$$typeof===y||a.$$typeof===v)},exports.typeOf=z},function(module,exports){function _typeof(obj){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?module.exports=_typeof=function(obj){return typeof obj}:module.exports=_typeof=function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}module.exports=_typeof},,function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_ButtonBase__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(67),_utils_isMuiElement__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(34),_utils_useForkRef__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(11),_List_ListContext__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(29),react_dom__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(12),useEnhancedEffect="undefined"===typeof window?react__WEBPACK_IMPORTED_MODULE_2__.useEffect:react__WEBPACK_IMPORTED_MODULE_2__.useLayoutEffect,ListItem=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var _props$alignItems=props.alignItems,alignItems=void 0===_props$alignItems?"center":_props$alignItems,_props$autoFocus=props.autoFocus,autoFocus=void 0!==_props$autoFocus&&_props$autoFocus,_props$button=props.button,button=void 0!==_props$button&&_props$button,childrenProp=props.children,classes=props.classes,className=props.className,componentProp=props.component,_props$ContainerCompo=props.ContainerComponent,ContainerComponent=void 0===_props$ContainerCompo?"li":_props$ContainerCompo,_props$ContainerProps=props.ContainerProps,ContainerClassName=(_props$ContainerProps=void 0===_props$ContainerProps?{}:_props$ContainerProps).className,ContainerProps=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(_props$ContainerProps,["className"]),_props$dense=props.dense,dense=void 0!==_props$dense&&_props$dense,_props$disabled=props.disabled,disabled=void 0!==_props$disabled&&_props$disabled,_props$disableGutters=props.disableGutters,disableGutters=void 0!==_props$disableGutters&&_props$disableGutters,_props$divider=props.divider,divider=void 0!==_props$divider&&_props$divider,focusVisibleClassName=props.focusVisibleClassName,_props$selected=props.selected,selected=void 0!==_props$selected&&_props$selected,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["alignItems","autoFocus","button","children","classes","className","component","ContainerComponent","ContainerProps","dense","disabled","disableGutters","divider","focusVisibleClassName","selected"]),context=react__WEBPACK_IMPORTED_MODULE_2__.useContext(_List_ListContext__WEBPACK_IMPORTED_MODULE_9__.a),childContext={dense:dense||context.dense||!1,alignItems:alignItems},listItemRef=react__WEBPACK_IMPORTED_MODULE_2__.useRef(null);useEnhancedEffect((function(){autoFocus&&listItemRef.current&&listItemRef.current.focus()}),[autoFocus]);var children=react__WEBPACK_IMPORTED_MODULE_2__.Children.toArray(childrenProp),hasSecondaryAction=children.length&&Object(_utils_isMuiElement__WEBPACK_IMPORTED_MODULE_7__.a)(children[children.length-1],["ListItemSecondaryAction"]),handleOwnRef=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(instance){listItemRef.current=react_dom__WEBPACK_IMPORTED_MODULE_10__.findDOMNode(instance)}),[]),handleRef=Object(_utils_useForkRef__WEBPACK_IMPORTED_MODULE_8__.a)(handleOwnRef,ref),componentProps=Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,childContext.dense&&classes.dense,!disableGutters&&classes.gutters,divider&&classes.divider,disabled&&classes.disabled,button&&classes.button,"center"!==alignItems&&classes.alignItemsFlexStart,hasSecondaryAction&&classes.secondaryAction,selected&&classes.selected),disabled:disabled},other),Component=componentProp||"li";return button&&(componentProps.component=componentProp||"div",componentProps.focusVisibleClassName=Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.focusVisible,focusVisibleClassName),Component=_ButtonBase__WEBPACK_IMPORTED_MODULE_6__.a),hasSecondaryAction?(Component=componentProps.component||componentProp?Component:"div","li"===ContainerComponent&&("li"===Component?Component="div":"li"===componentProps.component&&(componentProps.component="div")),react__WEBPACK_IMPORTED_MODULE_2__.createElement(_List_ListContext__WEBPACK_IMPORTED_MODULE_9__.a.Provider,{value:childContext},react__WEBPACK_IMPORTED_MODULE_2__.createElement(ContainerComponent,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.container,ContainerClassName),ref:handleRef},ContainerProps),react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,componentProps,children),children.pop()))):react__WEBPACK_IMPORTED_MODULE_2__.createElement(_List_ListContext__WEBPACK_IMPORTED_MODULE_9__.a.Provider,{value:childContext},react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({ref:handleRef},componentProps),children))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){return{root:{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,"&$focusVisible":{backgroundColor:theme.palette.action.selected},"&$selected, &$selected:hover":{backgroundColor:theme.palette.action.selected},"&$disabled":{opacity:.5}},container:{position:"relative"},focusVisible:{},dense:{paddingTop:4,paddingBottom:4},alignItemsFlexStart:{alignItems:"flex-start"},disabled:{},divider:{borderBottom:"1px solid ".concat(theme.palette.divider),backgroundClip:"padding-box"},gutters:{paddingLeft:16,paddingRight:16},button:{transition:theme.transitions.create("background-color",{duration:theme.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:theme.palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}},secondaryAction:{paddingRight:48},selected:{}}}),{name:"MuiListItem"})(ListItem)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return makeStyles}));var objectWithoutProperties=__webpack_require__(3),esm_extends=__webpack_require__(2),react=__webpack_require__(1),react_default=__webpack_require__.n(react),_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},dist_module="object"===("undefined"===typeof window?"undefined":_typeof(window))&&"object"===("undefined"===typeof document?"undefined":_typeof(document))&&9===document.nodeType;var createClass=__webpack_require__(51),inheritsLoose=__webpack_require__(39),assertThisInitialized=__webpack_require__(56),objectWithoutPropertiesLoose=__webpack_require__(32),plainObjectConstrurctor={}.constructor;function cloneStyle(style){if(null==style||"object"!==typeof style)return style;if(Array.isArray(style))return style.map(cloneStyle);if(style.constructor!==plainObjectConstrurctor)return style;var newStyle={};for(var name in style)newStyle[name]=cloneStyle(style[name]);return newStyle}function createRule(name,decl,options){void 0===name&&(name="unnamed");var jss=options.jss,declCopy=cloneStyle(decl),rule=jss.plugins.onCreateRule(name,declCopy,options);return rule||(name[0],null)}var join=function(value,by){for(var result="",i=0;i<value.length&&"!important"!==value[i];i++)result&&(result+=by),result+=value[i];return result},toCssValue=function(value,ignoreImportant){if(void 0===ignoreImportant&&(ignoreImportant=!1),!Array.isArray(value))return value;var cssValue="";if(Array.isArray(value[0]))for(var i=0;i<value.length&&"!important"!==value[i];i++)cssValue&&(cssValue+=", "),cssValue+=join(value[i]," ");else cssValue=join(value,", ");return ignoreImportant||"!important"!==value[value.length-1]||(cssValue+=" !important"),cssValue};function indentStr(str,indent){for(var result="",index=0;index<indent;index++)result+="  ";return result+str}function toCss(selector,style,options){void 0===options&&(options={});var result="";if(!style)return result;var _options$indent=options.indent,indent=void 0===_options$indent?0:_options$indent,fallbacks=style.fallbacks;if(selector&&indent++,fallbacks)if(Array.isArray(fallbacks))for(var index=0;index<fallbacks.length;index++){var fallback=fallbacks[index];for(var prop in fallback){var value=fallback[prop];null!=value&&(result&&(result+="\n"),result+=""+indentStr(prop+": "+toCssValue(value)+";",indent))}}else for(var _prop in fallbacks){var _value=fallbacks[_prop];null!=_value&&(result&&(result+="\n"),result+=""+indentStr(_prop+": "+toCssValue(_value)+";",indent))}for(var _prop2 in style){var _value2=style[_prop2];null!=_value2&&"fallbacks"!==_prop2&&(result&&(result+="\n"),result+=""+indentStr(_prop2+": "+toCssValue(_value2)+";",indent))}return(result||options.allowEmpty)&&selector?(result&&(result="\n"+result+"\n"),indentStr(selector+" {"+result,--indent)+indentStr("}",indent)):result}var escapeRegex=/([[\].#*$><+~=|^:(),"'`\s])/g,nativeEscape="undefined"!==typeof CSS&&CSS.escape,jss_esm_escape=function(str){return nativeEscape?nativeEscape(str):str.replace(escapeRegex,"\\$1")},BaseStyleRule=function(){function BaseStyleRule(key,style,options){this.type="style",this.key=void 0,this.isProcessed=!1,this.style=void 0,this.renderer=void 0,this.renderable=void 0,this.options=void 0;var sheet=options.sheet,Renderer=options.Renderer;this.key=key,this.options=options,this.style=style,sheet?this.renderer=sheet.renderer:Renderer&&(this.renderer=new Renderer)}return BaseStyleRule.prototype.prop=function(name,value,options){if(void 0===value)return this.style[name];var force=!!options&&options.force;if(!force&&this.style[name]===value)return this;var newValue=value;options&&!1===options.process||(newValue=this.options.jss.plugins.onChangeValue(value,name,this));var isEmpty=null==newValue||!1===newValue,isDefined=name in this.style;if(isEmpty&&!isDefined&&!force)return this;var remove=isEmpty&&isDefined;if(remove?delete this.style[name]:this.style[name]=newValue,this.renderable&&this.renderer)return remove?this.renderer.removeProperty(this.renderable,name):this.renderer.setProperty(this.renderable,name,newValue),this;var sheet=this.options.sheet;return sheet&&sheet.attached,this},BaseStyleRule}(),jss_esm_StyleRule=function(_BaseStyleRule){function StyleRule(key,style,options){var _this;(_this=_BaseStyleRule.call(this,key,style,options)||this).selectorText=void 0,_this.id=void 0,_this.renderable=void 0;var selector=options.selector,scoped=options.scoped,sheet=options.sheet,generateId=options.generateId;return selector?_this.selectorText=selector:!1!==scoped&&(_this.id=generateId(Object(assertThisInitialized.a)(Object(assertThisInitialized.a)(_this)),sheet),_this.selectorText="."+jss_esm_escape(_this.id)),_this}Object(inheritsLoose.a)(StyleRule,_BaseStyleRule);var _proto2=StyleRule.prototype;return _proto2.applyTo=function(renderable){var renderer=this.renderer;if(renderer){var json=this.toJSON();for(var prop in json)renderer.setProperty(renderable,prop,json[prop])}return this},_proto2.toJSON=function(){var json={};for(var prop in this.style){var value=this.style[prop];"object"!==typeof value?json[prop]=value:Array.isArray(value)&&(json[prop]=toCssValue(value))}return json},_proto2.toString=function(options){var sheet=this.options.sheet,opts=!!sheet&&sheet.options.link?Object(esm_extends.a)({},options,{allowEmpty:!0}):options;return toCss(this.selectorText,this.style,opts)},Object(createClass.a)(StyleRule,[{key:"selector",set:function(selector){if(selector!==this.selectorText){this.selectorText=selector;var renderer=this.renderer,renderable=this.renderable;if(renderable&&renderer)renderer.setSelector(renderable,selector)||renderer.replaceRule(renderable,this)}},get:function(){return this.selectorText}}]),StyleRule}(BaseStyleRule),pluginStyleRule={onCreateRule:function(name,style,options){return"@"===name[0]||options.parent&&"keyframes"===options.parent.type?null:new jss_esm_StyleRule(name,style,options)}},defaultToStringOptions={indent:1,children:!0},atRegExp=/@([\w-]+)/,jss_esm_ConditionalRule=function(){function ConditionalRule(key,styles,options){this.type="conditional",this.at=void 0,this.key=void 0,this.query=void 0,this.rules=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=key;var atMatch=key.match(atRegExp);for(var name in this.at=atMatch?atMatch[1]:"unknown",this.query=options.name||"@"+this.at,this.options=options,this.rules=new jss_esm_RuleList(Object(esm_extends.a)({},options,{parent:this})),styles)this.rules.add(name,styles[name]);this.rules.process()}var _proto=ConditionalRule.prototype;return _proto.getRule=function(name){return this.rules.get(name)},_proto.indexOf=function(rule){return this.rules.indexOf(rule)},_proto.addRule=function(name,style,options){var rule=this.rules.add(name,style,options);return rule?(this.options.jss.plugins.onProcessRule(rule),rule):null},_proto.toString=function(options){if(void 0===options&&(options=defaultToStringOptions),null==options.indent&&(options.indent=defaultToStringOptions.indent),null==options.children&&(options.children=defaultToStringOptions.children),!1===options.children)return this.query+" {}";var children=this.rules.toString(options);return children?this.query+" {\n"+children+"\n}":""},ConditionalRule}(),keyRegExp=/@media|@supports\s+/,pluginConditionalRule={onCreateRule:function(key,styles,options){return keyRegExp.test(key)?new jss_esm_ConditionalRule(key,styles,options):null}},defaultToStringOptions$1={indent:1,children:!0},nameRegExp=/@keyframes\s+([\w-]+)/,jss_esm_KeyframesRule=function(){function KeyframesRule(key,frames,options){this.type="keyframes",this.at="@keyframes",this.key=void 0,this.name=void 0,this.id=void 0,this.rules=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0;var nameMatch=key.match(nameRegExp);nameMatch&&nameMatch[1]?this.name=nameMatch[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=options;var scoped=options.scoped,sheet=options.sheet,generateId=options.generateId;for(var name in this.id=!1===scoped?this.name:jss_esm_escape(generateId(this,sheet)),this.rules=new jss_esm_RuleList(Object(esm_extends.a)({},options,{parent:this})),frames)this.rules.add(name,frames[name],Object(esm_extends.a)({},options,{parent:this}));this.rules.process()}return KeyframesRule.prototype.toString=function(options){if(void 0===options&&(options=defaultToStringOptions$1),null==options.indent&&(options.indent=defaultToStringOptions$1.indent),null==options.children&&(options.children=defaultToStringOptions$1.children),!1===options.children)return this.at+" "+this.id+" {}";var children=this.rules.toString(options);return children&&(children="\n"+children+"\n"),this.at+" "+this.id+" {"+children+"}"},KeyframesRule}(),keyRegExp$1=/@keyframes\s+/,refRegExp=/\$([\w-]+)/g,findReferencedKeyframe=function(val,keyframes){return"string"===typeof val?val.replace(refRegExp,(function(match,name){return name in keyframes?keyframes[name]:match})):val},jss_esm_replaceRef=function(style,prop,keyframes){var value=style[prop],refKeyframe=findReferencedKeyframe(value,keyframes);refKeyframe!==value&&(style[prop]=refKeyframe)},jss_esm_plugin={onCreateRule:function(key,frames,options){return"string"===typeof key&&keyRegExp$1.test(key)?new jss_esm_KeyframesRule(key,frames,options):null},onProcessStyle:function(style,rule,sheet){return"style"===rule.type&&sheet?("animation-name"in style&&jss_esm_replaceRef(style,"animation-name",sheet.keyframes),"animation"in style&&jss_esm_replaceRef(style,"animation",sheet.keyframes),style):style},onChangeValue:function(val,prop,rule){var sheet=rule.options.sheet;if(!sheet)return val;switch(prop){case"animation":case"animation-name":return findReferencedKeyframe(val,sheet.keyframes);default:return val}}},jss_esm_KeyframeRule=function(_BaseStyleRule){function KeyframeRule(){for(var _this,_len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=_BaseStyleRule.call.apply(_BaseStyleRule,[this].concat(args))||this).renderable=void 0,_this}return Object(inheritsLoose.a)(KeyframeRule,_BaseStyleRule),KeyframeRule.prototype.toString=function(options){var sheet=this.options.sheet,opts=!!sheet&&sheet.options.link?Object(esm_extends.a)({},options,{allowEmpty:!0}):options;return toCss(this.key,this.style,opts)},KeyframeRule}(BaseStyleRule),pluginKeyframeRule={onCreateRule:function(key,style,options){return options.parent&&"keyframes"===options.parent.type?new jss_esm_KeyframeRule(key,style,options):null}},FontFaceRule=function(){function FontFaceRule(key,style,options){this.type="font-face",this.at="@font-face",this.key=void 0,this.style=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=key,this.style=style,this.options=options}return FontFaceRule.prototype.toString=function(options){if(Array.isArray(this.style)){for(var str="",index=0;index<this.style.length;index++)str+=toCss(this.at,this.style[index]),this.style[index+1]&&(str+="\n");return str}return toCss(this.at,this.style,options)},FontFaceRule}(),keyRegExp$2=/@font-face/,pluginFontFaceRule={onCreateRule:function(key,style,options){return keyRegExp$2.test(key)?new FontFaceRule(key,style,options):null}},ViewportRule=function(){function ViewportRule(key,style,options){this.type="viewport",this.at="@viewport",this.key=void 0,this.style=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=key,this.style=style,this.options=options}return ViewportRule.prototype.toString=function(options){return toCss(this.key,this.style,options)},ViewportRule}(),pluginViewportRule={onCreateRule:function(key,style,options){return"@viewport"===key||"@-ms-viewport"===key?new ViewportRule(key,style,options):null}},SimpleRule=function(){function SimpleRule(key,value,options){this.type="simple",this.key=void 0,this.value=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=key,this.value=value,this.options=options}return SimpleRule.prototype.toString=function(options){if(Array.isArray(this.value)){for(var str="",index=0;index<this.value.length;index++)str+=this.key+" "+this.value[index]+";",this.value[index+1]&&(str+="\n");return str}return this.key+" "+this.value+";"},SimpleRule}(),keysMap={"@charset":!0,"@import":!0,"@namespace":!0},plugins=[pluginStyleRule,pluginConditionalRule,jss_esm_plugin,pluginKeyframeRule,pluginFontFaceRule,pluginViewportRule,{onCreateRule:function(key,value,options){return key in keysMap?new SimpleRule(key,value,options):null}}],defaultUpdateOptions={process:!0},forceUpdateOptions={force:!0,process:!0},jss_esm_RuleList=function(){function RuleList(options){this.map={},this.raw={},this.index=[],this.counter=0,this.options=void 0,this.classes=void 0,this.keyframes=void 0,this.options=options,this.classes=options.classes,this.keyframes=options.keyframes}var _proto=RuleList.prototype;return _proto.add=function(name,decl,ruleOptions){var _this$options=this.options,parent=_this$options.parent,sheet=_this$options.sheet,jss=_this$options.jss,Renderer=_this$options.Renderer,generateId=_this$options.generateId,scoped=_this$options.scoped,options=Object(esm_extends.a)({classes:this.classes,parent:parent,sheet:sheet,jss:jss,Renderer:Renderer,generateId:generateId,scoped:scoped,name:name,keyframes:this.keyframes,selector:void 0},ruleOptions),key=name;name in this.raw&&(key=name+"-d"+this.counter++),this.raw[key]=decl,key in this.classes&&(options.selector="."+jss_esm_escape(this.classes[key]));var rule=createRule(key,decl,options);if(!rule)return null;this.register(rule);var index=void 0===options.index?this.index.length:options.index;return this.index.splice(index,0,rule),rule},_proto.get=function(name){return this.map[name]},_proto.remove=function(rule){this.unregister(rule),delete this.raw[rule.key],this.index.splice(this.index.indexOf(rule),1)},_proto.indexOf=function(rule){return this.index.indexOf(rule)},_proto.process=function(){var plugins=this.options.jss.plugins;this.index.slice(0).forEach(plugins.onProcessRule,plugins)},_proto.register=function(rule){this.map[rule.key]=rule,rule instanceof jss_esm_StyleRule?(this.map[rule.selector]=rule,rule.id&&(this.classes[rule.key]=rule.id)):rule instanceof jss_esm_KeyframesRule&&this.keyframes&&(this.keyframes[rule.name]=rule.id)},_proto.unregister=function(rule){delete this.map[rule.key],rule instanceof jss_esm_StyleRule?(delete this.map[rule.selector],delete this.classes[rule.key]):rule instanceof jss_esm_KeyframesRule&&delete this.keyframes[rule.name]},_proto.update=function(){var name,data,options;if("string"===typeof(arguments.length<=0?void 0:arguments[0])?(name=arguments.length<=0?void 0:arguments[0],data=arguments.length<=1?void 0:arguments[1],options=arguments.length<=2?void 0:arguments[2]):(data=arguments.length<=0?void 0:arguments[0],options=arguments.length<=1?void 0:arguments[1],name=null),name)this.updateOne(this.map[name],data,options);else for(var index=0;index<this.index.length;index++)this.updateOne(this.index[index],data,options)},_proto.updateOne=function(rule,data,options){void 0===options&&(options=defaultUpdateOptions);var _this$options2=this.options,plugins=_this$options2.jss.plugins,sheet=_this$options2.sheet;if(rule.rules instanceof RuleList)rule.rules.update(data,options);else{var styleRule=rule,style=styleRule.style;if(plugins.onUpdate(data,rule,sheet,options),options.process&&style&&style!==styleRule.style){for(var prop in plugins.onProcessStyle(styleRule.style,styleRule,sheet),styleRule.style){var nextValue=styleRule.style[prop];nextValue!==style[prop]&&styleRule.prop(prop,nextValue,forceUpdateOptions)}for(var _prop in style){var _nextValue=styleRule.style[_prop],_prevValue=style[_prop];null==_nextValue&&_nextValue!==_prevValue&&styleRule.prop(_prop,null,forceUpdateOptions)}}}},_proto.toString=function(options){for(var str="",sheet=this.options.sheet,link=!!sheet&&sheet.options.link,index=0;index<this.index.length;index++){var css=this.index[index].toString(options);(css||link)&&(str&&(str+="\n"),str+=css)}return str},RuleList}(),jss_esm_StyleSheet=function(){function StyleSheet(styles,options){for(var name in this.options=void 0,this.deployed=void 0,this.attached=void 0,this.rules=void 0,this.renderer=void 0,this.classes=void 0,this.keyframes=void 0,this.queue=void 0,this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=Object(esm_extends.a)({},options,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),options.Renderer&&(this.renderer=new options.Renderer(this)),this.rules=new jss_esm_RuleList(this.options),styles)this.rules.add(name,styles[name]);this.rules.process()}var _proto=StyleSheet.prototype;return _proto.attach=function(){return this.attached||(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy()),this},_proto.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},_proto.addRule=function(name,decl,options){var queue=this.queue;this.attached&&!queue&&(this.queue=[]);var rule=this.rules.add(name,decl,options);return rule?(this.options.jss.plugins.onProcessRule(rule),this.attached?this.deployed?(queue?queue.push(rule):(this.insertRule(rule),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0)),rule):rule:(this.deployed=!1,rule)):null},_proto.insertRule=function(rule){this.renderer&&this.renderer.insertRule(rule)},_proto.addRules=function(styles,options){var added=[];for(var name in styles){var rule=this.addRule(name,styles[name],options);rule&&added.push(rule)}return added},_proto.getRule=function(name){return this.rules.get(name)},_proto.deleteRule=function(name){var rule="object"===typeof name?name:this.rules.get(name);return!(!rule||this.attached&&!rule.renderable)&&(this.rules.remove(rule),!(this.attached&&rule.renderable&&this.renderer)||this.renderer.deleteRule(rule.renderable))},_proto.indexOf=function(rule){return this.rules.indexOf(rule)},_proto.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},_proto.update=function(){var _this$rules;return(_this$rules=this.rules).update.apply(_this$rules,arguments),this},_proto.updateOne=function(rule,data,options){return this.rules.updateOne(rule,data,options),this},_proto.toString=function(options){return this.rules.toString(options)},StyleSheet}(),PluginsRegistry=function(){function PluginsRegistry(){this.plugins={internal:[],external:[]},this.registry=void 0}var _proto=PluginsRegistry.prototype;return _proto.onCreateRule=function(name,decl,options){for(var i=0;i<this.registry.onCreateRule.length;i++){var rule=this.registry.onCreateRule[i](name,decl,options);if(rule)return rule}return null},_proto.onProcessRule=function(rule){if(!rule.isProcessed){for(var sheet=rule.options.sheet,i=0;i<this.registry.onProcessRule.length;i++)this.registry.onProcessRule[i](rule,sheet);rule.style&&this.onProcessStyle(rule.style,rule,sheet),rule.isProcessed=!0}},_proto.onProcessStyle=function(style,rule,sheet){for(var i=0;i<this.registry.onProcessStyle.length;i++)rule.style=this.registry.onProcessStyle[i](rule.style,rule,sheet)},_proto.onProcessSheet=function(sheet){for(var i=0;i<this.registry.onProcessSheet.length;i++)this.registry.onProcessSheet[i](sheet)},_proto.onUpdate=function(data,rule,sheet,options){for(var i=0;i<this.registry.onUpdate.length;i++)this.registry.onUpdate[i](data,rule,sheet,options)},_proto.onChangeValue=function(value,prop,rule){for(var processedValue=value,i=0;i<this.registry.onChangeValue.length;i++)processedValue=this.registry.onChangeValue[i](processedValue,prop,rule);return processedValue},_proto.use=function(newPlugin,options){void 0===options&&(options={queue:"external"});var plugins=this.plugins[options.queue];-1===plugins.indexOf(newPlugin)&&(plugins.push(newPlugin),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce((function(registry,plugin){for(var name in plugin)name in registry&&registry[name].push(plugin[name]);return registry}),{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},PluginsRegistry}(),registry=new(function(){function SheetsRegistry(){this.registry=[]}var _proto=SheetsRegistry.prototype;return _proto.add=function(sheet){var registry=this.registry,index=sheet.options.index;if(-1===registry.indexOf(sheet))if(0===registry.length||index>=this.index)registry.push(sheet);else for(var i=0;i<registry.length;i++)if(registry[i].options.index>index)return void registry.splice(i,0,sheet)},_proto.reset=function(){this.registry=[]},_proto.remove=function(sheet){var index=this.registry.indexOf(sheet);this.registry.splice(index,1)},_proto.toString=function(_temp){for(var _ref=void 0===_temp?{}:_temp,attached=_ref.attached,options=Object(objectWithoutPropertiesLoose.a)(_ref,["attached"]),css="",i=0;i<this.registry.length;i++){var sheet=this.registry[i];null!=attached&&sheet.attached!==attached||(css&&(css+="\n"),css+=sheet.toString(options))}return css},Object(createClass.a)(SheetsRegistry,[{key:"index",get:function(){return 0===this.registry.length?0:this.registry[this.registry.length-1].options.index}}]),SheetsRegistry}()),globalThis="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),ns="2f1acc6c3a606b082e5eef5e54414ffb";null==globalThis[ns]&&(globalThis[ns]=0);var moduleId=globalThis[ns]++,createGenerateId=function(options){void 0===options&&(options={});var ruleCounter=0;return function(rule,sheet){ruleCounter+=1;var jssId="",prefix="";return sheet&&(sheet.options.classNamePrefix&&(prefix=sheet.options.classNamePrefix),null!=sheet.options.jss.id&&(jssId=String(sheet.options.jss.id))),options.minify?""+(prefix||"c")+moduleId+jssId+ruleCounter:prefix+rule.key+"-"+moduleId+(jssId?"-"+jssId:"")+"-"+ruleCounter}},memoize=function(fn){var value;return function(){return value||(value=fn()),value}},getPropertyValue=function(cssRule,prop){try{return cssRule.attributeStyleMap?cssRule.attributeStyleMap.get(prop):cssRule.style.getPropertyValue(prop)}catch(err){return""}},setProperty=function(cssRule,prop,value){try{var cssValue=value;if(Array.isArray(value)&&(cssValue=toCssValue(value,!0),"!important"===value[value.length-1]))return cssRule.style.setProperty(prop,cssValue,"important"),!0;cssRule.attributeStyleMap?cssRule.attributeStyleMap.set(prop,cssValue):cssRule.style.setProperty(prop,cssValue)}catch(err){return!1}return!0},removeProperty=function(cssRule,prop){try{cssRule.attributeStyleMap?cssRule.attributeStyleMap.delete(prop):cssRule.style.removeProperty(prop)}catch(err){}},setSelector=function(cssRule,selectorText){return cssRule.selectorText=selectorText,cssRule.selectorText===selectorText},getHead=memoize((function(){return document.querySelector("head")}));function findPrevNode(options){var registry$1=registry.registry;if(registry$1.length>0){var sheet=function(registry,options){for(var i=0;i<registry.length;i++){var sheet=registry[i];if(sheet.attached&&sheet.options.index>options.index&&sheet.options.insertionPoint===options.insertionPoint)return sheet}return null}(registry$1,options);if(sheet&&sheet.renderer)return{parent:sheet.renderer.element.parentNode,node:sheet.renderer.element};if((sheet=function(registry,options){for(var i=registry.length-1;i>=0;i--){var sheet=registry[i];if(sheet.attached&&sheet.options.insertionPoint===options.insertionPoint)return sheet}return null}(registry$1,options))&&sheet.renderer)return{parent:sheet.renderer.element.parentNode,node:sheet.renderer.element.nextSibling}}var insertionPoint=options.insertionPoint;if(insertionPoint&&"string"===typeof insertionPoint){var comment=function(text){for(var head=getHead(),i=0;i<head.childNodes.length;i++){var node=head.childNodes[i];if(8===node.nodeType&&node.nodeValue.trim()===text)return node}return null}(insertionPoint);if(comment)return{parent:comment.parentNode,node:comment.nextSibling}}return!1}var getNonce=memoize((function(){var node=document.querySelector('meta[property="csp-nonce"]');return node?node.getAttribute("content"):null})),_insertRule=function(container,rule,index){try{if("insertRule"in container)container.insertRule(rule,index);else if("appendRule"in container){container.appendRule(rule)}}catch(err){return!1}return container.cssRules[index]},getValidRuleInsertionIndex=function(container,index){var maxIndex=container.cssRules.length;return void 0===index||index>maxIndex?maxIndex:index},DomRenderer=function(){function DomRenderer(sheet){this.getPropertyValue=getPropertyValue,this.setProperty=setProperty,this.removeProperty=removeProperty,this.setSelector=setSelector,this.element=void 0,this.sheet=void 0,this.hasInsertedRules=!1,this.cssRules=[],sheet&&registry.add(sheet),this.sheet=sheet;var _ref=this.sheet?this.sheet.options:{},media=_ref.media,meta=_ref.meta,element=_ref.element;this.element=element||function(){var el=document.createElement("style");return el.textContent="\n",el}(),this.element.setAttribute("data-jss",""),media&&this.element.setAttribute("media",media),meta&&this.element.setAttribute("data-meta",meta);var nonce=getNonce();nonce&&this.element.setAttribute("nonce",nonce)}var _proto=DomRenderer.prototype;return _proto.attach=function(){if(!this.element.parentNode&&this.sheet){!function(style,options){var insertionPoint=options.insertionPoint,nextNode=findPrevNode(options);if(!1!==nextNode&&nextNode.parent)nextNode.parent.insertBefore(style,nextNode.node);else if(insertionPoint&&"number"===typeof insertionPoint.nodeType){var insertionPointElement=insertionPoint,parentNode=insertionPointElement.parentNode;parentNode&&parentNode.insertBefore(style,insertionPointElement.nextSibling)}else getHead().appendChild(style)}(this.element,this.sheet.options);var deployed=Boolean(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&deployed&&(this.hasInsertedRules=!1,this.deploy())}},_proto.detach=function(){if(this.sheet){var parentNode=this.element.parentNode;parentNode&&parentNode.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent="\n")}},_proto.deploy=function(){var sheet=this.sheet;sheet&&(sheet.options.link?this.insertRules(sheet.rules):this.element.textContent="\n"+sheet.toString()+"\n")},_proto.insertRules=function(rules,nativeParent){for(var i=0;i<rules.index.length;i++)this.insertRule(rules.index[i],i,nativeParent)},_proto.insertRule=function(rule,index,nativeParent){if(void 0===nativeParent&&(nativeParent=this.element.sheet),rule.rules){var parent=rule,latestNativeParent=nativeParent;if("conditional"===rule.type||"keyframes"===rule.type){var _insertionIndex=getValidRuleInsertionIndex(nativeParent,index);if(!1===(latestNativeParent=_insertRule(nativeParent,parent.toString({children:!1}),_insertionIndex)))return!1;this.refCssRule(rule,_insertionIndex,latestNativeParent)}return this.insertRules(parent.rules,latestNativeParent),latestNativeParent}var ruleStr=rule.toString();if(!ruleStr)return!1;var insertionIndex=getValidRuleInsertionIndex(nativeParent,index),nativeRule=_insertRule(nativeParent,ruleStr,insertionIndex);return!1!==nativeRule&&(this.hasInsertedRules=!0,this.refCssRule(rule,insertionIndex,nativeRule),nativeRule)},_proto.refCssRule=function(rule,index,cssRule){rule.renderable=cssRule,rule.options.parent instanceof jss_esm_StyleSheet&&(this.cssRules[index]=cssRule)},_proto.deleteRule=function(cssRule){var sheet=this.element.sheet,index=this.indexOf(cssRule);return-1!==index&&(sheet.deleteRule(index),this.cssRules.splice(index,1),!0)},_proto.indexOf=function(cssRule){return this.cssRules.indexOf(cssRule)},_proto.replaceRule=function(cssRule,rule){var index=this.indexOf(cssRule);return-1!==index&&(this.element.sheet.deleteRule(index),this.cssRules.splice(index,1),this.insertRule(rule,index))},_proto.getRules=function(){return this.element.sheet.cssRules},DomRenderer}(),instanceCounter=0,jss_esm_Jss=function(){function Jss(options){this.id=instanceCounter++,this.version="10.5.1",this.plugins=new PluginsRegistry,this.options={id:{minify:!1},createGenerateId:createGenerateId,Renderer:dist_module?DomRenderer:null,plugins:[]},this.generateId=createGenerateId({minify:!1});for(var i=0;i<plugins.length;i++)this.plugins.use(plugins[i],{queue:"internal"});this.setup(options)}var _proto=Jss.prototype;return _proto.setup=function(options){return void 0===options&&(options={}),options.createGenerateId&&(this.options.createGenerateId=options.createGenerateId),options.id&&(this.options.id=Object(esm_extends.a)({},this.options.id,options.id)),(options.createGenerateId||options.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),null!=options.insertionPoint&&(this.options.insertionPoint=options.insertionPoint),"Renderer"in options&&(this.options.Renderer=options.Renderer),options.plugins&&this.use.apply(this,options.plugins),this},_proto.createStyleSheet=function(styles,options){void 0===options&&(options={});var index=options.index;"number"!==typeof index&&(index=0===registry.index?0:registry.index+1);var sheet=new jss_esm_StyleSheet(styles,Object(esm_extends.a)({},options,{jss:this,generateId:options.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:index}));return this.plugins.onProcessSheet(sheet),sheet},_proto.removeStyleSheet=function(sheet){return sheet.detach(),registry.remove(sheet),this},_proto.createRule=function(name,style,options){if(void 0===style&&(style={}),void 0===options&&(options={}),"object"===typeof name)return this.createRule(void 0,name,style);var ruleOptions=Object(esm_extends.a)({},options,{name:name,jss:this,Renderer:this.options.Renderer});ruleOptions.generateId||(ruleOptions.generateId=this.generateId),ruleOptions.classes||(ruleOptions.classes={}),ruleOptions.keyframes||(ruleOptions.keyframes={});var rule=createRule(name,style,ruleOptions);return rule&&this.plugins.onProcessRule(rule),rule},_proto.use=function(){for(var _this=this,_len=arguments.length,plugins=new Array(_len),_key=0;_key<_len;_key++)plugins[_key]=arguments[_key];return plugins.forEach((function(plugin){_this.plugins.use(plugin)})),this},Jss}();function getDynamicStyles(styles){var to=null;for(var key in styles){var value=styles[key],type=typeof value;if("function"===type)to||(to={}),to[key]=value;else if("object"===type&&null!==value&&!Array.isArray(value)){var extracted=getDynamicStyles(value);extracted&&(to||(to={}),to[key]=extracted)}}return to}var hasCSSTOMSupport="object"===typeof CSS&&null!=CSS&&"number"in CSS,jss_esm_create=function(options){return new jss_esm_Jss(options)},mergeClasses=(jss_esm_create(),__webpack_require__(148)),makeStyles_multiKeyStore={set:function(cache,key1,key2,value){var subCache=cache.get(key1);subCache||(subCache=new Map,cache.set(key1,subCache)),subCache.set(key2,value)},get:function(cache,key1,key2){var subCache=cache.get(key1);return subCache?subCache.get(key2):void 0},delete:function(cache,key1,key2){cache.get(key1).delete(key2)}},useTheme=__webpack_require__(117),nested=(__webpack_require__(6),"function"===typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__"),pseudoClasses=["checked","disabled","error","focused","focusVisible","required","expanded","selected"];var now=Date.now(),fnValuesNs="fnValues"+now,fnRuleNs="fnStyle"+ ++now,jss_plugin_rule_value_function_esm=function(){return{onCreateRule:function(name,decl,options){if("function"!==typeof decl)return null;var rule=createRule(name,{},options);return rule[fnRuleNs]=decl,rule},onProcessStyle:function(style,rule){if(fnValuesNs in rule||fnRuleNs in rule)return style;var fnValues={};for(var prop in style){var value=style[prop];"function"===typeof value&&(delete style[prop],fnValues[prop]=value)}return rule[fnValuesNs]=fnValues,style},onUpdate:function(data,rule,sheet,options){var styleRule=rule,fnRule=styleRule[fnRuleNs];fnRule&&(styleRule.style=fnRule(data)||{});var fnValues=styleRule[fnValuesNs];if(fnValues)for(var _prop in fnValues)styleRule.prop(_prop,fnValues[_prop](data),options)}}},at="@global",jss_plugin_global_esm_GlobalContainerRule=function(){function GlobalContainerRule(key,styles,options){for(var selector in this.type="global",this.at=at,this.rules=void 0,this.options=void 0,this.key=void 0,this.isProcessed=!1,this.key=key,this.options=options,this.rules=new jss_esm_RuleList(Object(esm_extends.a)({},options,{parent:this})),styles)this.rules.add(selector,styles[selector]);this.rules.process()}var _proto=GlobalContainerRule.prototype;return _proto.getRule=function(name){return this.rules.get(name)},_proto.addRule=function(name,style,options){var rule=this.rules.add(name,style,options);return rule&&this.options.jss.plugins.onProcessRule(rule),rule},_proto.indexOf=function(rule){return this.rules.indexOf(rule)},_proto.toString=function(){return this.rules.toString()},GlobalContainerRule}(),jss_plugin_global_esm_GlobalPrefixedRule=function(){function GlobalPrefixedRule(key,style,options){this.type="global",this.at=at,this.options=void 0,this.rule=void 0,this.isProcessed=!1,this.key=void 0,this.key=key,this.options=options;var selector=key.substr("@global ".length);this.rule=options.jss.createRule(selector,style,Object(esm_extends.a)({},options,{parent:this}))}return GlobalPrefixedRule.prototype.toString=function(options){return this.rule?this.rule.toString(options):""},GlobalPrefixedRule}(),separatorRegExp=/\s*,\s*/g;function addScope(selector,scope){for(var parts=selector.split(separatorRegExp),scoped="",i=0;i<parts.length;i++)scoped+=scope+" "+parts[i].trim(),parts[i+1]&&(scoped+=", ");return scoped}var jss_plugin_global_esm=function(){return{onCreateRule:function(name,styles,options){if(!name)return null;if(name===at)return new jss_plugin_global_esm_GlobalContainerRule(name,styles,options);if("@"===name[0]&&"@global "===name.substr(0,"@global ".length))return new jss_plugin_global_esm_GlobalPrefixedRule(name,styles,options);var parent=options.parent;return parent&&("global"===parent.type||parent.options.parent&&"global"===parent.options.parent.type)&&(options.scoped=!1),!1===options.scoped&&(options.selector=name),null},onProcessRule:function(rule,sheet){"style"===rule.type&&sheet&&(function(rule,sheet){var options=rule.options,style=rule.style,rules=style?style[at]:null;if(rules){for(var name in rules)sheet.addRule(name,rules[name],Object(esm_extends.a)({},options,{selector:addScope(name,rule.selector)}));delete style[at]}}(rule,sheet),function(rule,sheet){var options=rule.options,style=rule.style;for(var prop in style)if("@"===prop[0]&&prop.substr(0,at.length)===at){var selector=addScope(prop.substr(at.length),rule.selector);sheet.addRule(selector,style[prop],Object(esm_extends.a)({},options,{selector:selector})),delete style[prop]}}(rule,sheet))}}},jss_plugin_nested_esm_separatorRegExp=/\s*,\s*/g,parentRegExp=/&/g,jss_plugin_nested_esm_refRegExp=/\$([\w-]+)/g;var jss_plugin_nested_esm=function(){function getReplaceRef(container,sheet){return function(match,key){var rule=container.getRule(key)||sheet&&sheet.getRule(key);return rule?(rule=rule).selector:key}}function replaceParentRefs(nestedProp,parentProp){for(var parentSelectors=parentProp.split(jss_plugin_nested_esm_separatorRegExp),nestedSelectors=nestedProp.split(jss_plugin_nested_esm_separatorRegExp),result="",i=0;i<parentSelectors.length;i++)for(var parent=parentSelectors[i],j=0;j<nestedSelectors.length;j++){var nested=nestedSelectors[j];result&&(result+=", "),result+=-1!==nested.indexOf("&")?nested.replace(parentRegExp,parent):parent+" "+nested}return result}function getOptions(rule,container,prevOptions){if(prevOptions)return Object(esm_extends.a)({},prevOptions,{index:prevOptions.index+1});var nestingLevel=rule.options.nestingLevel;nestingLevel=void 0===nestingLevel?1:nestingLevel+1;var options=Object(esm_extends.a)({},rule.options,{nestingLevel:nestingLevel,index:container.indexOf(rule)+1});return delete options.name,options}return{onProcessStyle:function(style,rule,sheet){if("style"!==rule.type)return style;var options,replaceRef,styleRule=rule,container=styleRule.options.parent;for(var prop in style){var isNested=-1!==prop.indexOf("&"),isNestedConditional="@"===prop[0];if(isNested||isNestedConditional){if(options=getOptions(styleRule,container,options),isNested){var selector=replaceParentRefs(prop,styleRule.selector);replaceRef||(replaceRef=getReplaceRef(container,sheet)),selector=selector.replace(jss_plugin_nested_esm_refRegExp,replaceRef),container.addRule(selector,style[prop],Object(esm_extends.a)({},options,{selector:selector}))}else isNestedConditional&&container.addRule(prop,{},options).addRule(styleRule.key,style[prop],{selector:styleRule.selector});delete style[prop]}}return style}}},uppercasePattern=/[A-Z]/g,msPattern=/^ms-/,cache={};function toHyphenLower(match){return"-"+match.toLowerCase()}var hyphenate_style_name=function(name){if(cache.hasOwnProperty(name))return cache[name];var hName=name.replace(uppercasePattern,toHyphenLower);return cache[name]=msPattern.test(hName)?"-"+hName:hName};function convertCase(style){var converted={};for(var prop in style){converted[0===prop.indexOf("--")?prop:hyphenate_style_name(prop)]=style[prop]}return style.fallbacks&&(Array.isArray(style.fallbacks)?converted.fallbacks=style.fallbacks.map(convertCase):converted.fallbacks=convertCase(style.fallbacks)),converted}var jss_plugin_camel_case_esm=function(){return{onProcessStyle:function(style){if(Array.isArray(style)){for(var index=0;index<style.length;index++)style[index]=convertCase(style[index]);return style}return convertCase(style)},onChangeValue:function(value,prop,rule){if(0===prop.indexOf("--"))return value;var hyphenatedProp=hyphenate_style_name(prop);return prop===hyphenatedProp?value:(rule.prop(hyphenatedProp,value),null)}}},px=hasCSSTOMSupport&&CSS?CSS.px:"px",ms=hasCSSTOMSupport&&CSS?CSS.ms:"ms",percent=hasCSSTOMSupport&&CSS?CSS.percent:"%";function addCamelCasedVersion(obj){var regExp=/(-[a-z])/g,replace=function(str){return str[1].toUpperCase()},newObj={};for(var _key in obj)newObj[_key]=obj[_key],newObj[_key.replace(regExp,replace)]=obj[_key];return newObj}var units=addCamelCasedVersion({"animation-delay":ms,"animation-duration":ms,"background-position":px,"background-position-x":px,"background-position-y":px,"background-size":px,border:px,"border-bottom":px,"border-bottom-left-radius":px,"border-bottom-right-radius":px,"border-bottom-width":px,"border-left":px,"border-left-width":px,"border-radius":px,"border-right":px,"border-right-width":px,"border-top":px,"border-top-left-radius":px,"border-top-right-radius":px,"border-top-width":px,"border-width":px,"border-block":px,"border-block-end":px,"border-block-end-width":px,"border-block-start":px,"border-block-start-width":px,"border-block-width":px,"border-inline":px,"border-inline-end":px,"border-inline-end-width":px,"border-inline-start":px,"border-inline-start-width":px,"border-inline-width":px,"border-start-start-radius":px,"border-start-end-radius":px,"border-end-start-radius":px,"border-end-end-radius":px,margin:px,"margin-bottom":px,"margin-left":px,"margin-right":px,"margin-top":px,"margin-block":px,"margin-block-end":px,"margin-block-start":px,"margin-inline":px,"margin-inline-end":px,"margin-inline-start":px,padding:px,"padding-bottom":px,"padding-left":px,"padding-right":px,"padding-top":px,"padding-block":px,"padding-block-end":px,"padding-block-start":px,"padding-inline":px,"padding-inline-end":px,"padding-inline-start":px,"mask-position-x":px,"mask-position-y":px,"mask-size":px,height:px,width:px,"min-height":px,"max-height":px,"min-width":px,"max-width":px,bottom:px,left:px,top:px,right:px,inset:px,"inset-block":px,"inset-block-end":px,"inset-block-start":px,"inset-inline":px,"inset-inline-end":px,"inset-inline-start":px,"box-shadow":px,"text-shadow":px,"column-gap":px,"column-rule":px,"column-rule-width":px,"column-width":px,"font-size":px,"font-size-delta":px,"letter-spacing":px,"text-decoration-thickness":px,"text-indent":px,"text-stroke":px,"text-stroke-width":px,"word-spacing":px,motion:px,"motion-offset":px,outline:px,"outline-offset":px,"outline-width":px,perspective:px,"perspective-origin-x":percent,"perspective-origin-y":percent,"transform-origin":percent,"transform-origin-x":percent,"transform-origin-y":percent,"transform-origin-z":percent,"transition-delay":ms,"transition-duration":ms,"vertical-align":px,"flex-basis":px,"shape-margin":px,size:px,gap:px,grid:px,"grid-gap":px,"row-gap":px,"grid-row-gap":px,"grid-column-gap":px,"grid-template-rows":px,"grid-template-columns":px,"grid-auto-rows":px,"grid-auto-columns":px,"box-shadow-x":px,"box-shadow-y":px,"box-shadow-blur":px,"box-shadow-spread":px,"font-line-height":px,"text-shadow-x":px,"text-shadow-y":px,"text-shadow-blur":px});function iterate(prop,value,options){if(null==value)return value;if(Array.isArray(value))for(var i=0;i<value.length;i++)value[i]=iterate(prop,value[i],options);else if("object"===typeof value)if("fallbacks"===prop)for(var innerProp in value)value[innerProp]=iterate(innerProp,value[innerProp],options);else for(var _innerProp in value)value[_innerProp]=iterate(prop+"-"+_innerProp,value[_innerProp],options);else if("number"===typeof value&&!Number.isNaN(value)){var unit=options[prop]||units[prop];return!unit||0===value&&unit===px?value.toString():"function"===typeof unit?unit(value).toString():""+value+unit}return value}var jss_plugin_default_unit_esm=function(options){void 0===options&&(options={});var camelCasedOptions=addCamelCasedVersion(options);return{onProcessStyle:function(style,rule){if("style"!==rule.type)return style;for(var prop in style)style[prop]=iterate(prop,style[prop],camelCasedOptions);return style},onChangeValue:function(value,prop){return iterate(prop,value,camelCasedOptions)}}},toConsumableArray=__webpack_require__(35),js="",css_vendor_esm_css="",vendor="",browser="",isTouch=dist_module&&"ontouchstart"in document.documentElement;if(dist_module){var jsCssMap={Moz:"-moz-",ms:"-ms-",O:"-o-",Webkit:"-webkit-"},css_vendor_esm_style=document.createElement("p").style;for(var css_vendor_esm_key in jsCssMap)if(css_vendor_esm_key+"Transform"in css_vendor_esm_style){js=css_vendor_esm_key,css_vendor_esm_css=jsCssMap[css_vendor_esm_key];break}"Webkit"===js&&"msHyphens"in css_vendor_esm_style&&(js="ms",css_vendor_esm_css=jsCssMap.ms,browser="edge"),"Webkit"===js&&"-apple-trailing-word"in css_vendor_esm_style&&(vendor="apple")}var css_vendor_esm_prefix_js=js,css_vendor_esm_prefix_css=css_vendor_esm_css,css_vendor_esm_prefix_vendor=vendor,css_vendor_esm_prefix_browser=browser,css_vendor_esm_prefix_isTouch=isTouch;var appearence={noPrefill:["appearance"],supportedProperty:function(prop){return"appearance"===prop&&("ms"===css_vendor_esm_prefix_js?"-webkit-"+prop:css_vendor_esm_prefix_css+prop)}},colorAdjust={noPrefill:["color-adjust"],supportedProperty:function(prop){return"color-adjust"===prop&&("Webkit"===css_vendor_esm_prefix_js?css_vendor_esm_prefix_css+"print-"+prop:prop)}},regExp=/[-\s]+(.)?/g;function toUpper(match,c){return c?c.toUpperCase():""}function camelize(str){return str.replace(regExp,toUpper)}function pascalize(str){return camelize("-"+str)}var el,mask={noPrefill:["mask"],supportedProperty:function(prop,style){if(!/^mask/.test(prop))return!1;if("Webkit"===css_vendor_esm_prefix_js){if(camelize("mask-image")in style)return prop;if(css_vendor_esm_prefix_js+pascalize("mask-image")in style)return css_vendor_esm_prefix_css+prop}return prop}},textOrientation={noPrefill:["text-orientation"],supportedProperty:function(prop){return"text-orientation"===prop&&("apple"!==css_vendor_esm_prefix_vendor||css_vendor_esm_prefix_isTouch?prop:css_vendor_esm_prefix_css+prop)}},transform={noPrefill:["transform"],supportedProperty:function(prop,style,options){return"transform"===prop&&(options.transform?prop:css_vendor_esm_prefix_css+prop)}},transition={noPrefill:["transition"],supportedProperty:function(prop,style,options){return"transition"===prop&&(options.transition?prop:css_vendor_esm_prefix_css+prop)}},writingMode={noPrefill:["writing-mode"],supportedProperty:function(prop){return"writing-mode"===prop&&("Webkit"===css_vendor_esm_prefix_js||"ms"===css_vendor_esm_prefix_js&&"edge"!==css_vendor_esm_prefix_browser?css_vendor_esm_prefix_css+prop:prop)}},userSelect={noPrefill:["user-select"],supportedProperty:function(prop){return"user-select"===prop&&("Moz"===css_vendor_esm_prefix_js||"ms"===css_vendor_esm_prefix_js||"apple"===css_vendor_esm_prefix_vendor?css_vendor_esm_prefix_css+prop:prop)}},breakPropsOld={supportedProperty:function(prop,style){return!!/^break-/.test(prop)&&("Webkit"===css_vendor_esm_prefix_js?"WebkitColumn"+pascalize(prop)in style&&css_vendor_esm_prefix_css+"column-"+prop:"Moz"===css_vendor_esm_prefix_js&&("page"+pascalize(prop)in style&&"page-"+prop))}},inlineLogicalOld={supportedProperty:function(prop,style){if(!/^(border|margin|padding)-inline/.test(prop))return!1;if("Moz"===css_vendor_esm_prefix_js)return prop;var newProp=prop.replace("-inline","");return css_vendor_esm_prefix_js+pascalize(newProp)in style&&css_vendor_esm_prefix_css+newProp}},unprefixed={supportedProperty:function(prop,style){return camelize(prop)in style&&prop}},prefixed={supportedProperty:function(prop,style){var pascalized=pascalize(prop);return"-"===prop[0]||"-"===prop[0]&&"-"===prop[1]?prop:css_vendor_esm_prefix_js+pascalized in style?css_vendor_esm_prefix_css+prop:"Webkit"!==css_vendor_esm_prefix_js&&"Webkit"+pascalized in style&&"-webkit-"+prop}},scrollSnap={supportedProperty:function(prop){return"scroll-snap"===prop.substring(0,11)&&("ms"===css_vendor_esm_prefix_js?""+css_vendor_esm_prefix_css+prop:prop)}},overscrollBehavior={supportedProperty:function(prop){return"overscroll-behavior"===prop&&("ms"===css_vendor_esm_prefix_js?css_vendor_esm_prefix_css+"scroll-chaining":prop)}},propMap={"flex-grow":"flex-positive","flex-shrink":"flex-negative","flex-basis":"flex-preferred-size","justify-content":"flex-pack",order:"flex-order","align-items":"flex-align","align-content":"flex-line-pack"},flex2012={supportedProperty:function(prop,style){var newProp=propMap[prop];return!!newProp&&(css_vendor_esm_prefix_js+pascalize(newProp)in style&&css_vendor_esm_prefix_css+newProp)}},propMap$1={flex:"box-flex","flex-grow":"box-flex","flex-direction":["box-orient","box-direction"],order:"box-ordinal-group","align-items":"box-align","flex-flow":["box-orient","box-direction"],"justify-content":"box-pack"},propKeys=Object.keys(propMap$1),prefixCss=function(p){return css_vendor_esm_prefix_css+p},css_vendor_esm_plugins=[appearence,colorAdjust,mask,textOrientation,transform,transition,writingMode,userSelect,breakPropsOld,inlineLogicalOld,unprefixed,prefixed,scrollSnap,overscrollBehavior,flex2012,{supportedProperty:function(prop,style,_ref){var multiple=_ref.multiple;if(propKeys.indexOf(prop)>-1){var newProp=propMap$1[prop];if(!Array.isArray(newProp))return css_vendor_esm_prefix_js+pascalize(newProp)in style&&css_vendor_esm_prefix_css+newProp;if(!multiple)return!1;for(var i=0;i<newProp.length;i++)if(!(css_vendor_esm_prefix_js+pascalize(newProp[0])in style))return!1;return newProp.map(prefixCss)}return!1}}],propertyDetectors=css_vendor_esm_plugins.filter((function(p){return p.supportedProperty})).map((function(p){return p.supportedProperty})),noPrefill=css_vendor_esm_plugins.filter((function(p){return p.noPrefill})).reduce((function(a,p){return a.push.apply(a,Object(toConsumableArray.a)(p.noPrefill)),a}),[]),css_vendor_esm_cache={};if(dist_module){el=document.createElement("p");var computed=window.getComputedStyle(document.documentElement,"");for(var key$1 in computed)isNaN(key$1)||(css_vendor_esm_cache[computed[key$1]]=computed[key$1]);noPrefill.forEach((function(x){return delete css_vendor_esm_cache[x]}))}function supportedProperty(prop,options){if(void 0===options&&(options={}),!el)return prop;if(null!=css_vendor_esm_cache[prop])return css_vendor_esm_cache[prop];"transition"!==prop&&"transform"!==prop||(options[prop]=prop in el.style);for(var i=0;i<propertyDetectors.length&&(css_vendor_esm_cache[prop]=propertyDetectors[i](prop,el.style,options),!css_vendor_esm_cache[prop]);i++);try{el.style[prop]=""}catch(err){return!1}return css_vendor_esm_cache[prop]}var el$1,cache$1={},transitionProperties={transition:1,"transition-property":1,"-webkit-transition":1,"-webkit-transition-property":1},transPropsRegExp=/(^\s*[\w-]+)|, (\s*[\w-]+)(?![^()]*\))/g;function prefixTransitionCallback(match,p1,p2){if("var"===p1)return"var";if("all"===p1)return"all";if("all"===p2)return", all";var prefixedValue=p1?supportedProperty(p1):", "+supportedProperty(p2);return prefixedValue||(p1||p2)}function supportedValue(property,value){var prefixedValue=value;if(!el$1||"content"===property)return value;if("string"!==typeof prefixedValue||!isNaN(parseInt(prefixedValue,10)))return prefixedValue;var cacheKey=property+prefixedValue;if(null!=cache$1[cacheKey])return cache$1[cacheKey];try{el$1.style[property]=prefixedValue}catch(err){return cache$1[cacheKey]=!1,!1}if(transitionProperties[property])prefixedValue=prefixedValue.replace(transPropsRegExp,prefixTransitionCallback);else if(""===el$1.style[property]&&("-ms-flex"===(prefixedValue=css_vendor_esm_prefix_css+prefixedValue)&&(el$1.style[property]="-ms-flexbox"),el$1.style[property]=prefixedValue,""===el$1.style[property]))return cache$1[cacheKey]=!1,!1;return el$1.style[property]="",cache$1[cacheKey]=prefixedValue,cache$1[cacheKey]}dist_module&&(el$1=document.createElement("p"));var jss_plugin_vendor_prefixer_esm=function(){function prefixStyle(style){for(var prop in style){var value=style[prop];if("fallbacks"===prop&&Array.isArray(value))style[prop]=value.map(prefixStyle);else{var changeProp=!1,supportedProp=supportedProperty(prop);supportedProp&&supportedProp!==prop&&(changeProp=!0);var changeValue=!1,supportedValue$1=supportedValue(supportedProp,toCssValue(value));supportedValue$1&&supportedValue$1!==value&&(changeValue=!0),(changeProp||changeValue)&&(changeProp&&delete style[prop],style[supportedProp||prop]=supportedValue$1||value)}}return style}return{onProcessRule:function(rule){if("keyframes"===rule.type){var atRule=rule;atRule.at="-"===(key=atRule.at)[1]||"ms"===css_vendor_esm_prefix_js?key:"@"+css_vendor_esm_prefix_css+"keyframes"+key.substr(10)}var key},onProcessStyle:function(style,rule){return"style"!==rule.type?style:prefixStyle(style)},onChangeValue:function(value,prop){return supportedValue(prop,toCssValue(value))||value}}};var jss_plugin_props_sort_esm=function(){var sort=function(prop0,prop1){return prop0.length===prop1.length?prop0>prop1?1:-1:prop0.length-prop1.length};return{onProcessStyle:function(style,rule){if("style"!==rule.type)return style;for(var newStyle={},props=Object.keys(style).sort(sort),i=0;i<props.length;i++)newStyle[props[i]]=style[props[i]];return newStyle}}};function jssPreset(){return{plugins:[jss_plugin_rule_value_function_esm(),jss_plugin_global_esm(),jss_plugin_nested_esm(),jss_plugin_camel_case_esm(),jss_plugin_default_unit_esm(),"undefined"===typeof window?null:jss_plugin_vendor_prefixer_esm(),jss_plugin_props_sort_esm()]}}var StylesProvider_jss=jss_esm_create(jssPreset()),defaultOptions={disableGeneration:!1,generateClassName:function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_options$disableGloba=options.disableGlobal,disableGlobal=void 0!==_options$disableGloba&&_options$disableGloba,_options$productionPr=options.productionPrefix,productionPrefix=void 0===_options$productionPr?"jss":_options$productionPr,_options$seed=options.seed,seed=void 0===_options$seed?"":_options$seed,seedPrefix=""===seed?"":"".concat(seed,"-"),ruleCounter=0,getNextCounterId=function(){return ruleCounter+=1};return function(rule,styleSheet){var name=styleSheet.options.name;if(name&&0===name.indexOf("Mui")&&!styleSheet.options.link&&!disableGlobal){if(-1!==pseudoClasses.indexOf(rule.key))return"Mui-".concat(rule.key);var prefix="".concat(seedPrefix).concat(name,"-").concat(rule.key);return styleSheet.options.theme[nested]&&""===seed?"".concat(prefix,"-").concat(getNextCounterId()):prefix}return"".concat(seedPrefix).concat(productionPrefix).concat(getNextCounterId())}}(),jss:StylesProvider_jss,sheetsCache:null,sheetsManager:new Map,sheetsRegistry:null},StylesContext=react_default.a.createContext(defaultOptions);var indexCounter=-1e9;function increment(){return indexCounter+=1}__webpack_require__(38);var deepmerge=__webpack_require__(149);function getStylesCreator(stylesOrCreator){var themingEnabled="function"===typeof stylesOrCreator;return{create:function(theme,name){var styles;try{styles=themingEnabled?stylesOrCreator(theme):stylesOrCreator}catch(err){throw err}if(!name||!theme.overrides||!theme.overrides[name])return styles;var overrides=theme.overrides[name],stylesWithOverrides=Object(esm_extends.a)({},styles);return Object.keys(overrides).forEach((function(key){stylesWithOverrides[key]=Object(deepmerge.a)(stylesWithOverrides[key],overrides[key])})),stylesWithOverrides},options:{}}}var getStylesCreator_noopTheme={};function getClasses(_ref,classes,Component){var state=_ref.state;if(_ref.stylesOptions.disableGeneration)return classes||{};state.cacheClasses||(state.cacheClasses={value:null,lastProp:null,lastJSS:{}});var generate=!1;return state.classes!==state.cacheClasses.lastJSS&&(state.cacheClasses.lastJSS=state.classes,generate=!0),classes!==state.cacheClasses.lastProp&&(state.cacheClasses.lastProp=classes,generate=!0),generate&&(state.cacheClasses.value=Object(mergeClasses.a)({baseClasses:state.cacheClasses.lastJSS,newClasses:classes,Component:Component})),state.cacheClasses.value}function attach(_ref2,props){var state=_ref2.state,theme=_ref2.theme,stylesOptions=_ref2.stylesOptions,stylesCreator=_ref2.stylesCreator,name=_ref2.name;if(!stylesOptions.disableGeneration){var sheetManager=makeStyles_multiKeyStore.get(stylesOptions.sheetsManager,stylesCreator,theme);sheetManager||(sheetManager={refs:0,staticSheet:null,dynamicStyles:null},makeStyles_multiKeyStore.set(stylesOptions.sheetsManager,stylesCreator,theme,sheetManager));var options=Object(esm_extends.a)({},stylesCreator.options,stylesOptions,{theme:theme,flip:"boolean"===typeof stylesOptions.flip?stylesOptions.flip:"rtl"===theme.direction});options.generateId=options.serverGenerateClassName||options.generateClassName;var sheetsRegistry=stylesOptions.sheetsRegistry;if(0===sheetManager.refs){var staticSheet;stylesOptions.sheetsCache&&(staticSheet=makeStyles_multiKeyStore.get(stylesOptions.sheetsCache,stylesCreator,theme));var styles=stylesCreator.create(theme,name);staticSheet||((staticSheet=stylesOptions.jss.createStyleSheet(styles,Object(esm_extends.a)({link:!1},options))).attach(),stylesOptions.sheetsCache&&makeStyles_multiKeyStore.set(stylesOptions.sheetsCache,stylesCreator,theme,staticSheet)),sheetsRegistry&&sheetsRegistry.add(staticSheet),sheetManager.staticSheet=staticSheet,sheetManager.dynamicStyles=getDynamicStyles(styles)}if(sheetManager.dynamicStyles){var dynamicSheet=stylesOptions.jss.createStyleSheet(sheetManager.dynamicStyles,Object(esm_extends.a)({link:!0},options));dynamicSheet.update(props),dynamicSheet.attach(),state.dynamicSheet=dynamicSheet,state.classes=Object(mergeClasses.a)({baseClasses:sheetManager.staticSheet.classes,newClasses:dynamicSheet.classes}),sheetsRegistry&&sheetsRegistry.add(dynamicSheet)}else state.classes=sheetManager.staticSheet.classes;sheetManager.refs+=1}}function update(_ref3,props){var state=_ref3.state;state.dynamicSheet&&state.dynamicSheet.update(props)}function detach(_ref4){var state=_ref4.state,theme=_ref4.theme,stylesOptions=_ref4.stylesOptions,stylesCreator=_ref4.stylesCreator;if(!stylesOptions.disableGeneration){var sheetManager=makeStyles_multiKeyStore.get(stylesOptions.sheetsManager,stylesCreator,theme);sheetManager.refs-=1;var sheetsRegistry=stylesOptions.sheetsRegistry;0===sheetManager.refs&&(makeStyles_multiKeyStore.delete(stylesOptions.sheetsManager,stylesCreator,theme),stylesOptions.jss.removeStyleSheet(sheetManager.staticSheet),sheetsRegistry&&sheetsRegistry.remove(sheetManager.staticSheet)),state.dynamicSheet&&(stylesOptions.jss.removeStyleSheet(state.dynamicSheet),sheetsRegistry&&sheetsRegistry.remove(state.dynamicSheet))}}function useSynchronousEffect(func,values){var output,key=react_default.a.useRef([]),currentKey=react_default.a.useMemo((function(){return{}}),values);key.current!==currentKey&&(key.current=currentKey,output=func()),react_default.a.useEffect((function(){return function(){output&&output()}}),[currentKey])}function makeStyles(stylesOrCreator){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},name=options.name,classNamePrefixOption=options.classNamePrefix,Component=options.Component,_options$defaultTheme=options.defaultTheme,defaultTheme=void 0===_options$defaultTheme?getStylesCreator_noopTheme:_options$defaultTheme,stylesOptions2=Object(objectWithoutProperties.a)(options,["name","classNamePrefix","Component","defaultTheme"]),stylesCreator=getStylesCreator(stylesOrCreator),classNamePrefix=name||classNamePrefixOption||"makeStyles";stylesCreator.options={index:increment(),name:name,meta:classNamePrefix,classNamePrefix:classNamePrefix};var useStyles=function(){var props=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},theme=Object(useTheme.a)()||defaultTheme,stylesOptions=Object(esm_extends.a)({},react_default.a.useContext(StylesContext),stylesOptions2),instance=react_default.a.useRef(),shouldUpdate=react_default.a.useRef();useSynchronousEffect((function(){var current={name:name,state:{},stylesCreator:stylesCreator,stylesOptions:stylesOptions,theme:theme};return attach(current,props),shouldUpdate.current=!1,instance.current=current,function(){detach(current)}}),[theme,stylesCreator]),react_default.a.useEffect((function(){shouldUpdate.current&&update(instance.current,props),shouldUpdate.current=!0}));var classes=getClasses(instance.current,props.classes,Component);return classes};return useStyles}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useTheme}));var react=__webpack_require__(1),react_default=__webpack_require__.n(react);var useTheme_ThemeContext=react_default.a.createContext(null);function useTheme(){return react_default.a.useContext(useTheme_ThemeContext)}},function(module,__webpack_exports__,__webpack_require__){"use strict";var objectWithoutPropertiesLoose=__webpack_require__(32),inheritsLoose=__webpack_require__(39),react=(__webpack_require__(6),__webpack_require__(1)),react_default=__webpack_require__.n(react),react_dom=__webpack_require__(12),react_dom_default=__webpack_require__.n(react_dom),config_disabled=!1,TransitionGroupContext=__webpack_require__(52),Transition_Transition=function(_React$Component){function Transition(props,context){var _this;_this=_React$Component.call(this,props,context)||this;var initialStatus,appear=context&&!context.isMounting?props.enter:props.appear;return _this.appearStatus=null,props.in?appear?(initialStatus="exited",_this.appearStatus="entering"):initialStatus="entered":initialStatus=props.unmountOnExit||props.mountOnEnter?"unmounted":"exited",_this.state={status:initialStatus},_this.nextCallback=null,_this}Object(inheritsLoose.a)(Transition,_React$Component),Transition.getDerivedStateFromProps=function(_ref,prevState){return _ref.in&&"unmounted"===prevState.status?{status:"exited"}:null};var _proto=Transition.prototype;return _proto.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},_proto.componentDidUpdate=function(prevProps){var nextStatus=null;if(prevProps!==this.props){var status=this.state.status;this.props.in?"entering"!==status&&"entered"!==status&&(nextStatus="entering"):"entering"!==status&&"entered"!==status||(nextStatus="exiting")}this.updateStatus(!1,nextStatus)},_proto.componentWillUnmount=function(){this.cancelNextCallback()},_proto.getTimeouts=function(){var exit,enter,appear,timeout=this.props.timeout;return exit=enter=appear=timeout,null!=timeout&&"number"!==typeof timeout&&(exit=timeout.exit,enter=timeout.enter,appear=void 0!==timeout.appear?timeout.appear:enter),{exit:exit,enter:enter,appear:appear}},_proto.updateStatus=function(mounting,nextStatus){void 0===mounting&&(mounting=!1),null!==nextStatus?(this.cancelNextCallback(),"entering"===nextStatus?this.performEnter(mounting):this.performExit()):this.props.unmountOnExit&&"exited"===this.state.status&&this.setState({status:"unmounted"})},_proto.performEnter=function(mounting){var _this2=this,enter=this.props.enter,appearing=this.context?this.context.isMounting:mounting,_ref2=this.props.nodeRef?[appearing]:[react_dom_default.a.findDOMNode(this),appearing],maybeNode=_ref2[0],maybeAppearing=_ref2[1],timeouts=this.getTimeouts(),enterTimeout=appearing?timeouts.appear:timeouts.enter;!mounting&&!enter||config_disabled?this.safeSetState({status:"entered"},(function(){_this2.props.onEntered(maybeNode)})):(this.props.onEnter(maybeNode,maybeAppearing),this.safeSetState({status:"entering"},(function(){_this2.props.onEntering(maybeNode,maybeAppearing),_this2.onTransitionEnd(enterTimeout,(function(){_this2.safeSetState({status:"entered"},(function(){_this2.props.onEntered(maybeNode,maybeAppearing)}))}))})))},_proto.performExit=function(){var _this3=this,exit=this.props.exit,timeouts=this.getTimeouts(),maybeNode=this.props.nodeRef?void 0:react_dom_default.a.findDOMNode(this);exit&&!config_disabled?(this.props.onExit(maybeNode),this.safeSetState({status:"exiting"},(function(){_this3.props.onExiting(maybeNode),_this3.onTransitionEnd(timeouts.exit,(function(){_this3.safeSetState({status:"exited"},(function(){_this3.props.onExited(maybeNode)}))}))}))):this.safeSetState({status:"exited"},(function(){_this3.props.onExited(maybeNode)}))},_proto.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},_proto.safeSetState=function(nextState,callback){callback=this.setNextCallback(callback),this.setState(nextState,callback)},_proto.setNextCallback=function(callback){var _this4=this,active=!0;return this.nextCallback=function(event){active&&(active=!1,_this4.nextCallback=null,callback(event))},this.nextCallback.cancel=function(){active=!1},this.nextCallback},_proto.onTransitionEnd=function(timeout,handler){this.setNextCallback(handler);var node=this.props.nodeRef?this.props.nodeRef.current:react_dom_default.a.findDOMNode(this),doesNotHaveTimeoutOrListener=null==timeout&&!this.props.addEndListener;if(node&&!doesNotHaveTimeoutOrListener){if(this.props.addEndListener){var _ref3=this.props.nodeRef?[this.nextCallback]:[node,this.nextCallback],maybeNode=_ref3[0],maybeNextCallback=_ref3[1];this.props.addEndListener(maybeNode,maybeNextCallback)}null!=timeout&&setTimeout(this.nextCallback,timeout)}else setTimeout(this.nextCallback,0)},_proto.render=function(){var status=this.state.status;if("unmounted"===status)return null;var _this$props=this.props,children=_this$props.children,childProps=(_this$props.in,_this$props.mountOnEnter,_this$props.unmountOnExit,_this$props.appear,_this$props.enter,_this$props.exit,_this$props.timeout,_this$props.addEndListener,_this$props.onEnter,_this$props.onEntering,_this$props.onEntered,_this$props.onExit,_this$props.onExiting,_this$props.onExited,_this$props.nodeRef,Object(objectWithoutPropertiesLoose.a)(_this$props,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return react_default.a.createElement(TransitionGroupContext.a.Provider,{value:null},"function"===typeof children?children(status,childProps):react_default.a.cloneElement(react_default.a.Children.only(children),childProps))},Transition}(react_default.a.Component);function noop(){}Transition_Transition.contextType=TransitionGroupContext.a,Transition_Transition.propTypes={},Transition_Transition.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:noop,onEntering:noop,onEntered:noop,onExit:noop,onExiting:noop,onExited:noop},Transition_Transition.UNMOUNTED="unmounted",Transition_Transition.EXITED="exited",Transition_Transition.ENTERING="entering",Transition_Transition.ENTERED="entered",Transition_Transition.EXITING="exiting";__webpack_exports__.a=Transition_Transition},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_material_ui_styles__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(116),_defaultTheme__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(50);__webpack_exports__.a=function(stylesOrCreator){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(_material_ui_styles__WEBPACK_IMPORTED_MODULE_1__.a)(stylesOrCreator,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({defaultTheme:_defaultTheme__WEBPACK_IMPORTED_MODULE_2__.a},options))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return mergeClasses}));var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);function mergeClasses(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},baseClasses=options.baseClasses,newClasses=options.newClasses;options.Component;if(!newClasses)return baseClasses;var nextClasses=Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({},baseClasses);return Object.keys(newClasses).forEach((function(key){newClasses[key]&&(nextClasses[key]="".concat(baseClasses[key]," ").concat(newClasses[key]))})),nextClasses}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return deepmerge}));var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(38);function isPlainObject(item){return item&&"object"===Object(_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_1__.a)(item)&&item.constructor===Object}function deepmerge(target,source){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0},output=options.clone?Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({},target):target;return isPlainObject(target)&&isPlainObject(source)&&Object.keys(source).forEach((function(key){"__proto__"!==key&&(isPlainObject(source[key])&&key in target?output[key]=deepmerge(target[key],source[key],options):output[key]=source[key])})),output}},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(15),_ButtonBase__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(67),_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(8),Button=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"default":_props$color,_props$component=props.component,component=void 0===_props$component?"button":_props$component,_props$disabled=props.disabled,disabled=void 0!==_props$disabled&&_props$disabled,_props$disableElevati=props.disableElevation,disableElevation=void 0!==_props$disableElevati&&_props$disableElevati,_props$disableFocusRi=props.disableFocusRipple,disableFocusRipple=void 0!==_props$disableFocusRi&&_props$disableFocusRi,endIconProp=props.endIcon,focusVisibleClassName=props.focusVisibleClassName,_props$fullWidth=props.fullWidth,fullWidth=void 0!==_props$fullWidth&&_props$fullWidth,_props$size=props.size,size=void 0===_props$size?"medium":_props$size,startIconProp=props.startIcon,_props$type=props.type,type=void 0===_props$type?"button":_props$type,_props$variant=props.variant,variant=void 0===_props$variant?"text":_props$variant,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__.a)(props,["children","classes","className","color","component","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"]),startIcon=startIconProp&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("span",{className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.startIcon,classes["iconSize".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__.a)(size))])},startIconProp),endIcon=endIconProp&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("span",{className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.endIcon,classes["iconSize".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__.a)(size))])},endIconProp);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_ButtonBase__WEBPACK_IMPORTED_MODULE_7__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,classes[variant],className,"inherit"===color?classes.colorInherit:"default"!==color&&classes["".concat(variant).concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__.a)(color))],"medium"!==size&&[classes["".concat(variant,"Size").concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__.a)(size))],classes["size".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__.a)(size))]],disableElevation&&classes.disableElevation,disabled&&classes.disabled,fullWidth&&classes.fullWidth),component:component,disabled:disabled,focusRipple:!disableFocusRipple,focusVisibleClassName:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.focusVisible,focusVisibleClassName),ref:ref,type:type},other),react__WEBPACK_IMPORTED_MODULE_2__.createElement("span",{className:classes.label},startIcon,children,endIcon))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){return{root:Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__.a)({},theme.typography.button,{boxSizing:"border-box",minWidth:64,padding:"6px 16px",borderRadius:theme.shape.borderRadius,color:theme.palette.text.primary,transition:theme.transitions.create(["background-color","box-shadow","border"],{duration:theme.transitions.duration.short}),"&:hover":{textDecoration:"none",backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.text.primary,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"},"&$disabled":{backgroundColor:"transparent"}},"&$disabled":{color:theme.palette.action.disabled}}),label:{width:"100%",display:"inherit",alignItems:"inherit",justifyContent:"inherit"},text:{padding:"6px 8px"},textPrimary:{color:theme.palette.primary.main,"&:hover":{backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.primary.main,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},textSecondary:{color:theme.palette.secondary.main,"&:hover":{backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.secondary.main,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},outlined:{padding:"5px 15px",border:"1px solid ".concat("light"===theme.palette.type?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),"&$disabled":{border:"1px solid ".concat(theme.palette.action.disabledBackground)}},outlinedPrimary:{color:theme.palette.primary.main,border:"1px solid ".concat(Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.primary.main,.5)),"&:hover":{border:"1px solid ".concat(theme.palette.primary.main),backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.primary.main,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},outlinedSecondary:{color:theme.palette.secondary.main,border:"1px solid ".concat(Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.secondary.main,.5)),"&:hover":{border:"1px solid ".concat(theme.palette.secondary.main),backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.secondary.main,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{border:"1px solid ".concat(theme.palette.action.disabled)}},contained:{color:theme.palette.getContrastText(theme.palette.grey[300]),backgroundColor:theme.palette.grey[300],boxShadow:theme.shadows[2],"&:hover":{backgroundColor:theme.palette.grey.A100,boxShadow:theme.shadows[4],"@media (hover: none)":{boxShadow:theme.shadows[2],backgroundColor:theme.palette.grey[300]},"&$disabled":{backgroundColor:theme.palette.action.disabledBackground}},"&$focusVisible":{boxShadow:theme.shadows[6]},"&:active":{boxShadow:theme.shadows[8]},"&$disabled":{color:theme.palette.action.disabled,boxShadow:theme.shadows[0],backgroundColor:theme.palette.action.disabledBackground}},containedPrimary:{color:theme.palette.primary.contrastText,backgroundColor:theme.palette.primary.main,"&:hover":{backgroundColor:theme.palette.primary.dark,"@media (hover: none)":{backgroundColor:theme.palette.primary.main}}},containedSecondary:{color:theme.palette.secondary.contrastText,backgroundColor:theme.palette.secondary.main,"&:hover":{backgroundColor:theme.palette.secondary.dark,"@media (hover: none)":{backgroundColor:theme.palette.secondary.main}}},disableElevation:{boxShadow:"none","&:hover":{boxShadow:"none"},"&$focusVisible":{boxShadow:"none"},"&:active":{boxShadow:"none"},"&$disabled":{boxShadow:"none"}},focusVisible:{},disabled:{},colorInherit:{color:"inherit",borderColor:"currentColor"},textSizeSmall:{padding:"4px 5px",fontSize:theme.typography.pxToRem(13)},textSizeLarge:{padding:"8px 11px",fontSize:theme.typography.pxToRem(15)},outlinedSizeSmall:{padding:"3px 9px",fontSize:theme.typography.pxToRem(13)},outlinedSizeLarge:{padding:"7px 21px",fontSize:theme.typography.pxToRem(15)},containedSizeSmall:{padding:"4px 10px",fontSize:theme.typography.pxToRem(13)},containedSizeLarge:{padding:"8px 22px",fontSize:theme.typography.pxToRem(15)},sizeSmall:{},sizeLarge:{},fullWidth:{width:"100%"},startIcon:{display:"inherit",marginRight:8,marginLeft:-4,"&$iconSizeSmall":{marginLeft:-2}},endIcon:{display:"inherit",marginRight:-4,marginLeft:8,"&$iconSizeSmall":{marginRight:-2}},iconSizeSmall:{"& > *:first-child":{fontSize:18}},iconSizeMedium:{"& > *:first-child":{fontSize:20}},iconSizeLarge:{"& > *:first-child":{fontSize:22}}}}),{name:"MuiButton"})(Button)},function(module,__webpack_exports__,__webpack_require__){"use strict";function getThemeProps(params){var theme=params.theme,name=params.name,props=params.props;if(!theme||!theme.props||!theme.props[name])return props;var propName,defaultProps=theme.props[name];for(propName in defaultProps)void 0===props[propName]&&(props[propName]=defaultProps[propName]);return props}__webpack_require__.d(__webpack_exports__,"a",(function(){return getThemeProps}))},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(15),_ButtonBase__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(67),_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(8),IconButton=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var _props$edge=props.edge,edge=void 0!==_props$edge&&_props$edge,children=props.children,classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"default":_props$color,_props$disabled=props.disabled,disabled=void 0!==_props$disabled&&_props$disabled,_props$disableFocusRi=props.disableFocusRipple,disableFocusRipple=void 0!==_props$disableFocusRi&&_props$disableFocusRi,_props$size=props.size,size=void 0===_props$size?"medium":_props$size,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["edge","children","classes","className","color","disabled","disableFocusRipple","size"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_ButtonBase__WEBPACK_IMPORTED_MODULE_7__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,"default"!==color&&classes["color".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__.a)(color))],disabled&&classes.disabled,"small"===size&&classes["size".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_8__.a)(size))],{start:classes.edgeStart,end:classes.edgeEnd}[edge]),centerRipple:!0,focusRipple:!disableFocusRipple,disabled:disabled,ref:ref},other),react__WEBPACK_IMPORTED_MODULE_2__.createElement("span",{className:classes.label},children))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){return{root:{textAlign:"center",flex:"0 0 auto",fontSize:theme.typography.pxToRem(24),padding:12,borderRadius:"50%",overflow:"visible",color:theme.palette.action.active,transition:theme.transitions.create("background-color",{duration:theme.transitions.duration.shortest}),"&:hover":{backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.action.active,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{backgroundColor:"transparent",color:theme.palette.action.disabled}},edgeStart:{marginLeft:-12,"$sizeSmall&":{marginLeft:-3}},edgeEnd:{marginRight:-12,"$sizeSmall&":{marginRight:-3}},colorInherit:{color:"inherit"},colorPrimary:{color:theme.palette.primary.main,"&:hover":{backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.primary.main,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},colorSecondary:{color:theme.palette.secondary.main,"&:hover":{backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.secondary.main,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},disabled:{},sizeSmall:{padding:3,fontSize:theme.typography.pxToRem(18)},label:{width:"100%",display:"flex",alignItems:"inherit",justifyContent:"inherit"}}}),{name:"MuiIconButton"})(IconButton)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),SPACINGS=[0,1,2,3,4,5,6,7,8,9,10],GRID_SIZES=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12];function getOffset(val){var div=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,parse=parseFloat(val);return"".concat(parse/div).concat(String(val).replace(String(parse),"")||"px")}var Grid=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var _props$alignContent=props.alignContent,alignContent=void 0===_props$alignContent?"stretch":_props$alignContent,_props$alignItems=props.alignItems,alignItems=void 0===_props$alignItems?"stretch":_props$alignItems,classes=props.classes,classNameProp=props.className,_props$component=props.component,Component=void 0===_props$component?"div":_props$component,_props$container=props.container,container=void 0!==_props$container&&_props$container,_props$direction=props.direction,direction=void 0===_props$direction?"row":_props$direction,_props$item=props.item,item=void 0!==_props$item&&_props$item,_props$justify=props.justify,justify=void 0===_props$justify?"flex-start":_props$justify,_props$lg=props.lg,lg=void 0!==_props$lg&&_props$lg,_props$md=props.md,md=void 0!==_props$md&&_props$md,_props$sm=props.sm,sm=void 0!==_props$sm&&_props$sm,_props$spacing=props.spacing,spacing=void 0===_props$spacing?0:_props$spacing,_props$wrap=props.wrap,wrap=void 0===_props$wrap?"wrap":_props$wrap,_props$xl=props.xl,xl=void 0!==_props$xl&&_props$xl,_props$xs=props.xs,xs=void 0!==_props$xs&&_props$xs,_props$zeroMinWidth=props.zeroMinWidth,zeroMinWidth=void 0!==_props$zeroMinWidth&&_props$zeroMinWidth,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__.a)(props,["alignContent","alignItems","classes","className","component","container","direction","item","justify","lg","md","sm","spacing","wrap","xl","xs","zeroMinWidth"]),className=Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,classNameProp,container&&[classes.container,0!==spacing&&classes["spacing-xs-".concat(String(spacing))]],item&&classes.item,zeroMinWidth&&classes.zeroMinWidth,"row"!==direction&&classes["direction-xs-".concat(String(direction))],"wrap"!==wrap&&classes["wrap-xs-".concat(String(wrap))],"stretch"!==alignItems&&classes["align-items-xs-".concat(String(alignItems))],"stretch"!==alignContent&&classes["align-content-xs-".concat(String(alignContent))],"flex-start"!==justify&&classes["justify-xs-".concat(String(justify))],!1!==xs&&classes["grid-xs-".concat(String(xs))],!1!==sm&&classes["grid-sm-".concat(String(sm))],!1!==md&&classes["grid-md-".concat(String(md))],!1!==lg&&classes["grid-lg-".concat(String(lg))],!1!==xl&&classes["grid-xl-".concat(String(xl))]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__.a)({className:className,ref:ref},other))})),StyledGrid=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){return Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__.a)({root:{},container:{boxSizing:"border-box",display:"flex",flexWrap:"wrap",width:"100%"},item:{boxSizing:"border-box",margin:"0"},zeroMinWidth:{minWidth:0},"direction-xs-column":{flexDirection:"column"},"direction-xs-column-reverse":{flexDirection:"column-reverse"},"direction-xs-row-reverse":{flexDirection:"row-reverse"},"wrap-xs-nowrap":{flexWrap:"nowrap"},"wrap-xs-wrap-reverse":{flexWrap:"wrap-reverse"},"align-items-xs-center":{alignItems:"center"},"align-items-xs-flex-start":{alignItems:"flex-start"},"align-items-xs-flex-end":{alignItems:"flex-end"},"align-items-xs-baseline":{alignItems:"baseline"},"align-content-xs-center":{alignContent:"center"},"align-content-xs-flex-start":{alignContent:"flex-start"},"align-content-xs-flex-end":{alignContent:"flex-end"},"align-content-xs-space-between":{alignContent:"space-between"},"align-content-xs-space-around":{alignContent:"space-around"},"justify-xs-center":{justifyContent:"center"},"justify-xs-flex-end":{justifyContent:"flex-end"},"justify-xs-space-between":{justifyContent:"space-between"},"justify-xs-space-around":{justifyContent:"space-around"},"justify-xs-space-evenly":{justifyContent:"space-evenly"}},function(theme,breakpoint){var styles={};return SPACINGS.forEach((function(spacing){var themeSpacing=theme.spacing(spacing);0!==themeSpacing&&(styles["spacing-".concat(breakpoint,"-").concat(spacing)]={margin:"-".concat(getOffset(themeSpacing,2)),width:"calc(100% + ".concat(getOffset(themeSpacing),")"),"& > $item":{padding:getOffset(themeSpacing,2)}})})),styles}(theme,"xs"),theme.breakpoints.keys.reduce((function(accumulator,key){return function(globalStyles,theme,breakpoint){var styles={};GRID_SIZES.forEach((function(size){var key="grid-".concat(breakpoint,"-").concat(size);if(!0!==size)if("auto"!==size){var width="".concat(Math.round(size/12*1e8)/1e6,"%");styles[key]={flexBasis:width,flexGrow:0,maxWidth:width}}else styles[key]={flexBasis:"auto",flexGrow:0,maxWidth:"none"};else styles[key]={flexBasis:0,flexGrow:1,maxWidth:"100%"}})),"xs"===breakpoint?Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__.a)(globalStyles,styles):globalStyles[theme.breakpoints.up(breakpoint)]=styles}(accumulator,theme,key),accumulator}),{}))}),{name:"MuiGrid"})(Grid);__webpack_exports__.a=StyledGrid},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_InputBase__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(94),_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),Input=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var disableUnderline=props.disableUnderline,classes=props.classes,_props$fullWidth=props.fullWidth,fullWidth=void 0!==_props$fullWidth&&_props$fullWidth,_props$inputComponent=props.inputComponent,inputComponent=void 0===_props$inputComponent?"input":_props$inputComponent,_props$multiline=props.multiline,multiline=void 0!==_props$multiline&&_props$multiline,_props$type=props.type,type=void 0===_props$type?"text":_props$type,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["disableUnderline","classes","fullWidth","inputComponent","multiline","type"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_InputBase__WEBPACK_IMPORTED_MODULE_5__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({classes:Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({},classes,{root:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,!disableUnderline&&classes.underline),underline:null}),fullWidth:fullWidth,inputComponent:inputComponent,multiline:multiline,ref:ref,type:type},other))}));Input.muiName="Input",__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__.a)((function(theme){var bottomLineColor="light"===theme.palette.type?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return{root:{position:"relative"},formControl:{"label + &":{marginTop:16}},focused:{},disabled:{},colorSecondary:{"&$underline:after":{borderBottomColor:theme.palette.secondary.main}},underline:{"&:after":{borderBottom:"2px solid ".concat(theme.palette.primary.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:theme.transitions.create("transform",{duration:theme.transitions.duration.shorter,easing:theme.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:theme.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:"1px solid ".concat(bottomLineColor),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:theme.transitions.create("border-bottom-color",{duration:theme.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:not($disabled):before":{borderBottom:"2px solid ".concat(theme.palette.text.primary),"@media (hover: none)":{borderBottom:"1px solid ".concat(bottomLineColor)}},"&$disabled:before":{borderBottomStyle:"dotted"}},error:{},marginDense:{},multiline:{},fullWidth:{},input:{},inputMarginDense:{},inputMultiline:{},inputTypeSearch:{}}}),{name:"MuiInput"})(Input)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_InputBase__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(94),_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),FilledInput=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var disableUnderline=props.disableUnderline,classes=props.classes,_props$fullWidth=props.fullWidth,fullWidth=void 0!==_props$fullWidth&&_props$fullWidth,_props$inputComponent=props.inputComponent,inputComponent=void 0===_props$inputComponent?"input":_props$inputComponent,_props$multiline=props.multiline,multiline=void 0!==_props$multiline&&_props$multiline,_props$type=props.type,type=void 0===_props$type?"text":_props$type,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["disableUnderline","classes","fullWidth","inputComponent","multiline","type"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_InputBase__WEBPACK_IMPORTED_MODULE_5__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({classes:Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({},classes,{root:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,!disableUnderline&&classes.underline),underline:null}),fullWidth:fullWidth,inputComponent:inputComponent,multiline:multiline,ref:ref,type:type},other))}));FilledInput.muiName="Input",__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__.a)((function(theme){var light="light"===theme.palette.type,bottomLineColor=light?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",backgroundColor=light?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.09)";return{root:{position:"relative",backgroundColor:backgroundColor,borderTopLeftRadius:theme.shape.borderRadius,borderTopRightRadius:theme.shape.borderRadius,transition:theme.transitions.create("background-color",{duration:theme.transitions.duration.shorter,easing:theme.transitions.easing.easeOut}),"&:hover":{backgroundColor:light?"rgba(0, 0, 0, 0.13)":"rgba(255, 255, 255, 0.13)","@media (hover: none)":{backgroundColor:backgroundColor}},"&$focused":{backgroundColor:light?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.09)"},"&$disabled":{backgroundColor:light?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)"}},colorSecondary:{"&$underline:after":{borderBottomColor:theme.palette.secondary.main}},underline:{"&:after":{borderBottom:"2px solid ".concat(theme.palette.primary.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:theme.transitions.create("transform",{duration:theme.transitions.duration.shorter,easing:theme.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:theme.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:"1px solid ".concat(bottomLineColor),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:theme.transitions.create("border-bottom-color",{duration:theme.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:before":{borderBottom:"1px solid ".concat(theme.palette.text.primary)},"&$disabled:before":{borderBottomStyle:"dotted"}},focused:{},disabled:{},adornedStart:{paddingLeft:12},adornedEnd:{paddingRight:12},error:{},marginDense:{},multiline:{padding:"27px 12px 10px","&$marginDense":{paddingTop:23,paddingBottom:6}},input:{padding:"27px 12px 10px","&:-webkit-autofill":{WebkitBoxShadow:"light"===theme.palette.type?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===theme.palette.type?null:"#fff",caretColor:"light"===theme.palette.type?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},inputMarginDense:{paddingTop:23,paddingBottom:6},inputHiddenLabel:{paddingTop:18,paddingBottom:19,"&$inputMarginDense":{paddingTop:10,paddingBottom:11}},inputMultiline:{padding:0},inputAdornedStart:{paddingLeft:0},inputAdornedEnd:{paddingRight:0}}}),{name:"MuiFilledInput"})(FilledInput)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_InputBase_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(41),_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),_utils_capitalize__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(8),_utils_isMuiElement__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(34),_FormControlContext__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(40),FormControl=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"primary":_props$color,_props$component=props.component,Component=void 0===_props$component?"div":_props$component,_props$disabled=props.disabled,disabled=void 0!==_props$disabled&&_props$disabled,_props$error=props.error,error=void 0!==_props$error&&_props$error,_props$fullWidth=props.fullWidth,fullWidth=void 0!==_props$fullWidth&&_props$fullWidth,visuallyFocused=props.focused,_props$hiddenLabel=props.hiddenLabel,hiddenLabel=void 0!==_props$hiddenLabel&&_props$hiddenLabel,_props$margin=props.margin,margin=void 0===_props$margin?"none":_props$margin,_props$required=props.required,required=void 0!==_props$required&&_props$required,size=props.size,_props$variant=props.variant,variant=void 0===_props$variant?"standard":_props$variant,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["children","classes","className","color","component","disabled","error","fullWidth","focused","hiddenLabel","margin","required","size","variant"]),_React$useState=react__WEBPACK_IMPORTED_MODULE_2__.useState((function(){var initialAdornedStart=!1;return children&&react__WEBPACK_IMPORTED_MODULE_2__.Children.forEach(children,(function(child){if(Object(_utils_isMuiElement__WEBPACK_IMPORTED_MODULE_8__.a)(child,["Input","Select"])){var input=Object(_utils_isMuiElement__WEBPACK_IMPORTED_MODULE_8__.a)(child,["Select"])?child.props.input:child;input&&Object(_InputBase_utils__WEBPACK_IMPORTED_MODULE_5__.a)(input.props)&&(initialAdornedStart=!0)}})),initialAdornedStart})),adornedStart=_React$useState[0],setAdornedStart=_React$useState[1],_React$useState2=react__WEBPACK_IMPORTED_MODULE_2__.useState((function(){var initialFilled=!1;return children&&react__WEBPACK_IMPORTED_MODULE_2__.Children.forEach(children,(function(child){Object(_utils_isMuiElement__WEBPACK_IMPORTED_MODULE_8__.a)(child,["Input","Select"])&&Object(_InputBase_utils__WEBPACK_IMPORTED_MODULE_5__.b)(child.props,!0)&&(initialFilled=!0)})),initialFilled})),filled=_React$useState2[0],setFilled=_React$useState2[1],_React$useState3=react__WEBPACK_IMPORTED_MODULE_2__.useState(!1),_focused=_React$useState3[0],setFocused=_React$useState3[1],focused=void 0!==visuallyFocused?visuallyFocused:_focused;disabled&&focused&&setFocused(!1);var onFilled=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(){setFilled(!0)}),[]),childContext={adornedStart:adornedStart,setAdornedStart:setAdornedStart,color:color,disabled:disabled,error:error,filled:filled,focused:focused,fullWidth:fullWidth,hiddenLabel:hiddenLabel,margin:("small"===size?"dense":void 0)||margin,onBlur:function(){setFocused(!1)},onEmpty:react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(){setFilled(!1)}),[]),onFilled:onFilled,onFocus:function(){setFocused(!0)},registerEffect:undefined,required:required,variant:variant};return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_FormControlContext__WEBPACK_IMPORTED_MODULE_9__.a.Provider,{value:childContext},react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,"none"!==margin&&classes["margin".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_7__.a)(margin))],fullWidth&&classes.fullWidth),ref:ref},other),children))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__.a)({root:{display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},marginNormal:{marginTop:16,marginBottom:8},marginDense:{marginTop:8,marginBottom:4},fullWidth:{width:"100%"}},{name:"MuiFormControl"})(FormControl)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(28),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),react_transition_group__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__(6),__webpack_require__(118)),_styles_useTheme__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(33),_transitions_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(36),_utils_useForkRef__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(11);function getScale(value){return"scale(".concat(value,", ").concat(Math.pow(value,2),")")}var styles={entering:{opacity:1,transform:getScale(1)},entered:{opacity:1,transform:"none"}},Grow=react__WEBPACK_IMPORTED_MODULE_3__.forwardRef((function(props,ref){var children=props.children,_props$disableStrictM=props.disableStrictModeCompat,disableStrictModeCompat=void 0!==_props$disableStrictM&&_props$disableStrictM,inProp=props.in,onEnter=props.onEnter,onEntered=props.onEntered,onEntering=props.onEntering,onExit=props.onExit,onExited=props.onExited,onExiting=props.onExiting,style=props.style,_props$timeout=props.timeout,timeout=void 0===_props$timeout?"auto":_props$timeout,_props$TransitionComp=props.TransitionComponent,TransitionComponent=void 0===_props$TransitionComp?react_transition_group__WEBPACK_IMPORTED_MODULE_5__.a:_props$TransitionComp,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_2__.a)(props,["children","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),timer=react__WEBPACK_IMPORTED_MODULE_3__.useRef(),autoTimeout=react__WEBPACK_IMPORTED_MODULE_3__.useRef(),theme=Object(_styles_useTheme__WEBPACK_IMPORTED_MODULE_6__.a)(),enableStrictModeCompat=theme.unstable_strictMode&&!disableStrictModeCompat,nodeRef=react__WEBPACK_IMPORTED_MODULE_3__.useRef(null),foreignRef=Object(_utils_useForkRef__WEBPACK_IMPORTED_MODULE_8__.a)(children.ref,ref),handleRef=Object(_utils_useForkRef__WEBPACK_IMPORTED_MODULE_8__.a)(enableStrictModeCompat?nodeRef:void 0,foreignRef),normalizedTransitionCallback=function(callback){return function(nodeOrAppearing,maybeAppearing){if(callback){var _ref=enableStrictModeCompat?[nodeRef.current,nodeOrAppearing]:[nodeOrAppearing,maybeAppearing],_ref2=Object(_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__.a)(_ref,2),node=_ref2[0],isAppearing=_ref2[1];void 0===isAppearing?callback(node):callback(node,isAppearing)}}},handleEntering=normalizedTransitionCallback(onEntering),handleEnter=normalizedTransitionCallback((function(node,isAppearing){Object(_transitions_utils__WEBPACK_IMPORTED_MODULE_7__.b)(node);var duration,_getTransitionProps=Object(_transitions_utils__WEBPACK_IMPORTED_MODULE_7__.a)({style:style,timeout:timeout},{mode:"enter"}),transitionDuration=_getTransitionProps.duration,delay=_getTransitionProps.delay;"auto"===timeout?(duration=theme.transitions.getAutoHeightDuration(node.clientHeight),autoTimeout.current=duration):duration=transitionDuration,node.style.transition=[theme.transitions.create("opacity",{duration:duration,delay:delay}),theme.transitions.create("transform",{duration:.666*duration,delay:delay})].join(","),onEnter&&onEnter(node,isAppearing)})),handleEntered=normalizedTransitionCallback(onEntered),handleExiting=normalizedTransitionCallback(onExiting),handleExit=normalizedTransitionCallback((function(node){var duration,_getTransitionProps2=Object(_transitions_utils__WEBPACK_IMPORTED_MODULE_7__.a)({style:style,timeout:timeout},{mode:"exit"}),transitionDuration=_getTransitionProps2.duration,delay=_getTransitionProps2.delay;"auto"===timeout?(duration=theme.transitions.getAutoHeightDuration(node.clientHeight),autoTimeout.current=duration):duration=transitionDuration,node.style.transition=[theme.transitions.create("opacity",{duration:duration,delay:delay}),theme.transitions.create("transform",{duration:.666*duration,delay:delay||.333*duration})].join(","),node.style.opacity="0",node.style.transform=getScale(.75),onExit&&onExit(node)})),handleExited=normalizedTransitionCallback(onExited);return react__WEBPACK_IMPORTED_MODULE_3__.useEffect((function(){return function(){clearTimeout(timer.current)}}),[]),react__WEBPACK_IMPORTED_MODULE_3__.createElement(TransitionComponent,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({appear:!0,in:inProp,nodeRef:enableStrictModeCompat?nodeRef:void 0,onEnter:handleEnter,onEntered:handleEntered,onEntering:handleEntering,onExit:handleExit,onExited:handleExited,onExiting:handleExiting,addEndListener:function(nodeOrNext,maybeNext){var next=enableStrictModeCompat?nodeOrNext:maybeNext;"auto"===timeout&&(timer.current=setTimeout(next,autoTimeout.current||0))},timeout:"auto"===timeout?null:timeout},other),(function(state,childProps){return react__WEBPACK_IMPORTED_MODULE_3__.cloneElement(children,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({style:Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({opacity:0,transform:getScale(.75),visibility:"exited"!==state||inProp?void 0:"hidden"},styles[state],style,children.props.style),ref:handleRef},childProps))}))}));Grow.muiSupportAuto=!0,__webpack_exports__.a=Grow},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_ListContext__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(29),List=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"ul":_props$component,_props$dense=props.dense,dense=void 0!==_props$dense&&_props$dense,_props$disablePadding=props.disablePadding,disablePadding=void 0!==_props$disablePadding&&_props$disablePadding,subheader=props.subheader,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["children","classes","className","component","dense","disablePadding","subheader"]),context=react__WEBPACK_IMPORTED_MODULE_2__.useMemo((function(){return{dense:dense}}),[dense]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_ListContext__WEBPACK_IMPORTED_MODULE_6__.a.Provider,{value:context},react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,dense&&classes.dense,!disablePadding&&classes.padding,subheader&&classes.subheader),ref:ref},other),subheader,children))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)({root:{listStyle:"none",margin:0,padding:0,position:"relative"},padding:{paddingTop:8,paddingBottom:8},dense:{},subheader:{paddingTop:0}},{name:"MuiList"})(List)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8),CircularProgress=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"primary":_props$color,_props$disableShrink=props.disableShrink,disableShrink=void 0!==_props$disableShrink&&_props$disableShrink,_props$size=props.size,size=void 0===_props$size?40:_props$size,style=props.style,_props$thickness=props.thickness,thickness=void 0===_props$thickness?3.6:_props$thickness,_props$value=props.value,value=void 0===_props$value?0:_props$value,_props$variant=props.variant,variant=void 0===_props$variant?"indeterminate":_props$variant,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className","color","disableShrink","size","style","thickness","value","variant"]),circleStyle={},rootStyle={},rootProps={};if("determinate"===variant||"static"===variant){var circumference=2*Math.PI*((44-thickness)/2);circleStyle.strokeDasharray=circumference.toFixed(3),rootProps["aria-valuenow"]=Math.round(value),circleStyle.strokeDashoffset="".concat(((100-value)/100*circumference).toFixed(3),"px"),rootStyle.transform="rotate(-90deg)"}return react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,"inherit"!==color&&classes["color".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__.a)(color))],{determinate:classes.determinate,indeterminate:classes.indeterminate,static:classes.static}[variant]),style:Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({width:size,height:size},rootStyle,style),ref:ref,role:"progressbar"},rootProps,other),react__WEBPACK_IMPORTED_MODULE_2__.createElement("svg",{className:classes.svg,viewBox:"".concat(22," ").concat(22," ").concat(44," ").concat(44)},react__WEBPACK_IMPORTED_MODULE_2__.createElement("circle",{className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.circle,disableShrink&&classes.circleDisableShrink,{determinate:classes.circleDeterminate,indeterminate:classes.circleIndeterminate,static:classes.circleStatic}[variant]),style:circleStyle,cx:44,cy:44,r:(44-thickness)/2,fill:"none",strokeWidth:thickness})))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){return{root:{display:"inline-block"},static:{transition:theme.transitions.create("transform")},indeterminate:{animation:"$circular-rotate 1.4s linear infinite"},determinate:{transition:theme.transitions.create("transform")},colorPrimary:{color:theme.palette.primary.main},colorSecondary:{color:theme.palette.secondary.main},svg:{display:"block"},circle:{stroke:"currentColor"},circleStatic:{transition:theme.transitions.create("stroke-dashoffset")},circleIndeterminate:{animation:"$circular-dash 1.4s ease-in-out infinite",strokeDasharray:"80px, 200px",strokeDashoffset:"0px"},circleDeterminate:{transition:theme.transitions.create("stroke-dashoffset")},"@keyframes circular-rotate":{"0%":{transformOrigin:"50% 50%"},"100%":{transform:"rotate(360deg)"}},"@keyframes circular-dash":{"0%":{strokeDasharray:"1px, 200px",strokeDashoffset:"0px"},"50%":{strokeDasharray:"100px, 200px",strokeDashoffset:"-15px"},"100%":{strokeDasharray:"100px, 200px",strokeDashoffset:"-125px"}},circleDisableShrink:{animation:"none"}}}),{name:"MuiCircularProgress",flip:!1})(CircularProgress)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_List_ListContext__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(29),ListItemAvatar=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className"]),context=react__WEBPACK_IMPORTED_MODULE_2__.useContext(_List_ListContext__WEBPACK_IMPORTED_MODULE_6__.a);return react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,"flex-start"===context.alignItems&&classes.alignItemsFlexStart),ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)({root:{minWidth:56,flexShrink:0},alignItemsFlexStart:{marginTop:8}},{name:"MuiListItemAvatar"})(ListItemAvatar)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_Typography__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(31),_List_ListContext__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(29),ListItemText=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$disableTypogra=props.disableTypography,disableTypography=void 0!==_props$disableTypogra&&_props$disableTypogra,_props$inset=props.inset,inset=void 0!==_props$inset&&_props$inset,primaryProp=props.primary,primaryTypographyProps=props.primaryTypographyProps,secondaryProp=props.secondary,secondaryTypographyProps=props.secondaryTypographyProps,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["children","classes","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"]),dense=react__WEBPACK_IMPORTED_MODULE_2__.useContext(_List_ListContext__WEBPACK_IMPORTED_MODULE_7__.a).dense,primary=null!=primaryProp?primaryProp:children;null==primary||primary.type===_Typography__WEBPACK_IMPORTED_MODULE_6__.a||disableTypography||(primary=react__WEBPACK_IMPORTED_MODULE_2__.createElement(_Typography__WEBPACK_IMPORTED_MODULE_6__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({variant:dense?"body2":"body1",className:classes.primary,component:"span",display:"block"},primaryTypographyProps),primary));var secondary=secondaryProp;return null==secondary||secondary.type===_Typography__WEBPACK_IMPORTED_MODULE_6__.a||disableTypography||(secondary=react__WEBPACK_IMPORTED_MODULE_2__.createElement(_Typography__WEBPACK_IMPORTED_MODULE_6__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({variant:"body2",className:classes.secondary,color:"textSecondary",display:"block"},secondaryTypographyProps),secondary)),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,dense&&classes.dense,inset&&classes.inset,primary&&secondary&&classes.multiline),ref:ref},other),primary,secondary)}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)({root:{flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},multiline:{marginTop:6,marginBottom:6},dense:{},inset:{paddingLeft:56},primary:{},secondary:{}},{name:"MuiListItemText"})(ListItemText)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),ListItemSecondaryAction=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className),ref:ref},other))}));ListItemSecondaryAction.muiName="ListItemSecondaryAction",__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)({root:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"}},{name:"MuiListItemSecondaryAction"})(ListItemSecondaryAction)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_Paper__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(93),_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),Card=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$raised=props.raised,raised=void 0!==_props$raised&&_props$raised,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className","raised"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_Paper__WEBPACK_IMPORTED_MODULE_5__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className),elevation:raised?8:1,ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__.a)({root:{overflow:"hidden"}},{name:"MuiCard"})(Card)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_Typography__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(31),CardHeader=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var action=props.action,avatar=props.avatar,classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"div":_props$component,_props$disableTypogra=props.disableTypography,disableTypography=void 0!==_props$disableTypogra&&_props$disableTypogra,subheaderProp=props.subheader,subheaderTypographyProps=props.subheaderTypographyProps,titleProp=props.title,titleTypographyProps=props.titleTypographyProps,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["action","avatar","classes","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"]),title=titleProp;null==title||title.type===_Typography__WEBPACK_IMPORTED_MODULE_6__.a||disableTypography||(title=react__WEBPACK_IMPORTED_MODULE_2__.createElement(_Typography__WEBPACK_IMPORTED_MODULE_6__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({variant:avatar?"body2":"h5",className:classes.title,component:"span",display:"block"},titleTypographyProps),title));var subheader=subheaderProp;return null==subheader||subheader.type===_Typography__WEBPACK_IMPORTED_MODULE_6__.a||disableTypography||(subheader=react__WEBPACK_IMPORTED_MODULE_2__.createElement(_Typography__WEBPACK_IMPORTED_MODULE_6__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({variant:avatar?"body2":"body1",className:classes.subheader,color:"textSecondary",component:"span",display:"block"},subheaderTypographyProps),subheader)),react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className),ref:ref},other),avatar&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:classes.avatar},avatar),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:classes.content},title,subheader),action&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:classes.action},action))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)({root:{display:"flex",alignItems:"center",padding:16},avatar:{flex:"0 0 auto",marginRight:16},action:{flex:"0 0 auto",alignSelf:"flex-start",marginTop:-8,marginRight:-8},content:{flex:"1 1 auto"},title:{},subheader:{}},{name:"MuiCardHeader"})(CardHeader)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(15),Divider=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var _props$absolute=props.absolute,absolute=void 0!==_props$absolute&&_props$absolute,classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"hr":_props$component,_props$flexItem=props.flexItem,flexItem=void 0!==_props$flexItem&&_props$flexItem,_props$light=props.light,light=void 0!==_props$light&&_props$light,_props$orientation=props.orientation,orientation=void 0===_props$orientation?"horizontal":_props$orientation,_props$role=props.role,role=void 0===_props$role?"hr"!==Component?"separator":void 0:_props$role,_props$variant=props.variant,variant=void 0===_props$variant?"fullWidth":_props$variant,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["absolute","classes","className","component","flexItem","light","orientation","role","variant"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,"fullWidth"!==variant&&classes[variant],absolute&&classes.absolute,flexItem&&classes.flexItem,light&&classes.light,"vertical"===orientation&&classes.vertical),role:role,ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){return{root:{height:1,margin:0,border:"none",flexShrink:0,backgroundColor:theme.palette.divider},absolute:{position:"absolute",bottom:0,left:0,width:"100%"},inset:{marginLeft:72},light:{backgroundColor:Object(_styles_colorManipulator__WEBPACK_IMPORTED_MODULE_6__.c)(theme.palette.divider,.08)},middle:{marginLeft:theme.spacing(2),marginRight:theme.spacing(2)},vertical:{height:"100%",width:1},flexItem:{alignSelf:"stretch",height:"auto"}}}),{name:"MuiDivider"})(Divider)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),CardContent=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"div":_props$component,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className","component"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className),ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)({root:{padding:16,"&:last-child":{paddingBottom:24}}},{name:"MuiCardContent"})(CardContent)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_Typography__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(31),DialogTitle=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$disableTypogra=props.disableTypography,disableTypography=void 0!==_props$disableTypogra&&_props$disableTypogra,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["children","classes","className","disableTypography"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className),ref:ref},other),disableTypography?children:react__WEBPACK_IMPORTED_MODULE_2__.createElement(_Typography__WEBPACK_IMPORTED_MODULE_6__.a,{component:"h2",variant:"h6"},children))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(DialogTitle)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),FormGroup=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$row=props.row,row=void 0!==_props$row&&_props$row,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className","row"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,row&&classes.row),ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)({root:{display:"flex",flexDirection:"column",flexWrap:"wrap"},row:{flexDirection:"row"}},{name:"MuiFormGroup"})(FormGroup)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(13),_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),_ListItem__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(115),MenuItem=react__WEBPACK_IMPORTED_MODULE_3__.forwardRef((function(props,ref){var tabIndex,classes=props.classes,className=props.className,_props$component=props.component,component=void 0===_props$component?"li":_props$component,_props$disableGutters=props.disableGutters,disableGutters=void 0!==_props$disableGutters&&_props$disableGutters,ListItemClasses=props.ListItemClasses,_props$role=props.role,role=void 0===_props$role?"menuitem":_props$role,selected=props.selected,tabIndexProp=props.tabIndex,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__.a)(props,["classes","className","component","disableGutters","ListItemClasses","role","selected","tabIndex"]);return props.disabled||(tabIndex=void 0!==tabIndexProp?tabIndexProp:-1),react__WEBPACK_IMPORTED_MODULE_3__.createElement(_ListItem__WEBPACK_IMPORTED_MODULE_7__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_2__.a)({button:!0,role:role,tabIndex:tabIndex,component:component,selected:selected,disableGutters:disableGutters,classes:Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_2__.a)({dense:classes.dense},ListItemClasses),className:Object(clsx__WEBPACK_IMPORTED_MODULE_5__.a)(classes.root,className,selected&&classes.selected,!disableGutters&&classes.gutters),ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__.a)((function(theme){return{root:Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_2__.a)({},theme.typography.body1,Object(_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__.a)({minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",width:"auto",overflow:"hidden",whiteSpace:"nowrap"},theme.breakpoints.up("sm"),{minHeight:"auto"})),gutters:{},selected:{},dense:Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_2__.a)({},theme.typography.body2,{minHeight:"auto"})}}),{name:"MuiMenuItem"})(MenuItem)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8),_Paper__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(93),AppBar=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"primary":_props$color,_props$position=props.position,position=void 0===_props$position?"fixed":_props$position,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className","color","position"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_Paper__WEBPACK_IMPORTED_MODULE_7__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({square:!0,component:"header",elevation:4,className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,classes["position".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__.a)(position))],classes["color".concat(Object(_utils_capitalize__WEBPACK_IMPORTED_MODULE_6__.a)(color))],className,"fixed"===position&&"mui-fixed"),ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){var backgroundColorDefault="light"===theme.palette.type?theme.palette.grey[100]:theme.palette.grey[900];return{root:{display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",zIndex:theme.zIndex.appBar,flexShrink:0},positionFixed:{position:"fixed",top:0,left:"auto",right:0,"@media print":{position:"absolute"}},positionAbsolute:{position:"absolute",top:0,left:"auto",right:0},positionSticky:{position:"sticky",top:0,left:"auto",right:0},positionStatic:{position:"static"},positionRelative:{position:"relative"},colorDefault:{backgroundColor:backgroundColorDefault,color:theme.palette.getContrastText(backgroundColorDefault)},colorPrimary:{backgroundColor:theme.palette.primary.main,color:theme.palette.primary.contrastText},colorSecondary:{backgroundColor:theme.palette.secondary.main,color:theme.palette.secondary.contrastText},colorInherit:{color:"inherit"},colorTransparent:{backgroundColor:"transparent",color:"inherit"}}}),{name:"MuiAppBar"})(AppBar)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(13),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),Toolbar=react__WEBPACK_IMPORTED_MODULE_3__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"div":_props$component,_props$disableGutters=props.disableGutters,disableGutters=void 0!==_props$disableGutters&&_props$disableGutters,_props$variant=props.variant,variant=void 0===_props$variant?"regular":_props$variant,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className","component","disableGutters","variant"]);return react__WEBPACK_IMPORTED_MODULE_3__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_5__.a)(classes.root,classes[variant],className,!disableGutters&&classes.gutters),ref:ref},other))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__.a)((function(theme){return{root:{position:"relative",display:"flex",alignItems:"center"},gutters:Object(_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__.a)({paddingLeft:theme.spacing(2),paddingRight:theme.spacing(2)},theme.breakpoints.up("sm"),{paddingLeft:theme.spacing(3),paddingRight:theme.spacing(3)}),regular:theme.mixins.toolbar,dense:{minHeight:48}}}),{name:"MuiToolbar"})(Toolbar)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__(54),__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),BottomNavigation=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"div":_props$component,onChange=props.onChange,_props$showLabels=props.showLabels,showLabels=void 0!==_props$showLabels&&_props$showLabels,value=props.value,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["children","classes","className","component","onChange","showLabels","value"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(Component,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({className:Object(clsx__WEBPACK_IMPORTED_MODULE_5__.a)(classes.root,className),ref:ref},other),react__WEBPACK_IMPORTED_MODULE_2__.Children.map(children,(function(child,childIndex){if(!react__WEBPACK_IMPORTED_MODULE_2__.isValidElement(child))return null;var childValue=void 0===child.props.value?childIndex:child.props.value;return react__WEBPACK_IMPORTED_MODULE_2__.cloneElement(child,{selected:childValue===value,showLabel:void 0!==child.props.showLabel?child.props.showLabel:showLabels,value:childValue,onChange:onChange})})))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_6__.a)((function(theme){return{root:{display:"flex",justifyContent:"center",height:56,backgroundColor:theme.palette.background.paper}}}),{name:"MuiBottomNavigation"})(BottomNavigation)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),clsx__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(6),__webpack_require__(4)),_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5),_ButtonBase__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(67),BottomNavigationAction=react__WEBPACK_IMPORTED_MODULE_2__.forwardRef((function(props,ref){var classes=props.classes,className=props.className,icon=props.icon,label=props.label,onChange=props.onChange,onClick=props.onClick,selected=props.selected,showLabel=props.showLabel,value=props.value,other=Object(_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__.a)(props,["classes","className","icon","label","onChange","onClick","selected","showLabel","value"]);return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_ButtonBase__WEBPACK_IMPORTED_MODULE_6__.a,Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({ref:ref,className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.root,className,selected?classes.selected:!showLabel&&classes.iconOnly),focusRipple:!0,onClick:function(event){onChange&&onChange(event,value),onClick&&onClick(event)}},other),react__WEBPACK_IMPORTED_MODULE_2__.createElement("span",{className:classes.wrapper},icon,react__WEBPACK_IMPORTED_MODULE_2__.createElement("span",{className:Object(clsx__WEBPACK_IMPORTED_MODULE_4__.a)(classes.label,selected?classes.selected:!showLabel&&classes.iconOnly)},label)))}));__webpack_exports__.a=Object(_styles_withStyles__WEBPACK_IMPORTED_MODULE_5__.a)((function(theme){return{root:{transition:theme.transitions.create(["color","padding-top"],{duration:theme.transitions.duration.short}),padding:"6px 12px 8px",minWidth:80,maxWidth:168,color:theme.palette.text.secondary,flex:"1","&$iconOnly":{paddingTop:16},"&$selected":{paddingTop:6,color:theme.palette.primary.main}},selected:{},iconOnly:{},wrapper:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"100%",flexDirection:"column"},label:{fontFamily:theme.typography.fontFamily,fontSize:theme.typography.pxToRem(12),opacity:1,transition:"font-size 0.2s, opacity 0.2s",transitionDelay:"0.1s","&$iconOnly":{opacity:0,transitionDelay:"0s"},"&$selected":{fontSize:theme.typography.pxToRem(14)}}}}),{name:"MuiBottomNavigationAction"})(BottomNavigationAction)},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),react=__webpack_require__(1),mergeClasses=(__webpack_require__(6),__webpack_require__(148)),slicedToArray=__webpack_require__(28),esm_typeof=__webpack_require__(38),formatMuiErrorMessage=__webpack_require__(92),clsx_m=(__webpack_require__(54),__webpack_require__(4)),ownerDocument=__webpack_require__(16),capitalize=__webpack_require__(8),withStyles=__webpack_require__(5),react_dom=__webpack_require__(12),debounce=__webpack_require__(45),ownerWindow=__webpack_require__(47),createChainedFunction=__webpack_require__(27),Modal=__webpack_require__(176),Grow=__webpack_require__(157),Paper=__webpack_require__(93);function getOffsetTop(rect,vertical){var offset=0;return"number"===typeof vertical?offset=vertical:"center"===vertical?offset=rect.height/2:"bottom"===vertical&&(offset=rect.height),offset}function getOffsetLeft(rect,horizontal){var offset=0;return"number"===typeof horizontal?offset=horizontal:"center"===horizontal?offset=rect.width/2:"right"===horizontal&&(offset=rect.width),offset}function getTransformOriginValue(transformOrigin){return[transformOrigin.horizontal,transformOrigin.vertical].map((function(n){return"number"===typeof n?"".concat(n,"px"):n})).join(" ")}function getAnchorEl(anchorEl){return"function"===typeof anchorEl?anchorEl():anchorEl}var Popover_Popover=react.forwardRef((function(props,ref){var action=props.action,anchorEl=props.anchorEl,_props$anchorOrigin=props.anchorOrigin,anchorOrigin=void 0===_props$anchorOrigin?{vertical:"top",horizontal:"left"}:_props$anchorOrigin,anchorPosition=props.anchorPosition,_props$anchorReferenc=props.anchorReference,anchorReference=void 0===_props$anchorReferenc?"anchorEl":_props$anchorReferenc,children=props.children,classes=props.classes,className=props.className,containerProp=props.container,_props$elevation=props.elevation,elevation=void 0===_props$elevation?8:_props$elevation,getContentAnchorEl=props.getContentAnchorEl,_props$marginThreshol=props.marginThreshold,marginThreshold=void 0===_props$marginThreshol?16:_props$marginThreshol,onEnter=props.onEnter,onEntered=props.onEntered,onEntering=props.onEntering,onExit=props.onExit,onExited=props.onExited,onExiting=props.onExiting,open=props.open,_props$PaperProps=props.PaperProps,PaperProps=void 0===_props$PaperProps?{}:_props$PaperProps,_props$transformOrigi=props.transformOrigin,transformOrigin=void 0===_props$transformOrigi?{vertical:"top",horizontal:"left"}:_props$transformOrigi,_props$TransitionComp=props.TransitionComponent,TransitionComponent=void 0===_props$TransitionComp?Grow.a:_props$TransitionComp,_props$transitionDura=props.transitionDuration,transitionDurationProp=void 0===_props$transitionDura?"auto":_props$transitionDura,_props$TransitionProp=props.TransitionProps,TransitionProps=void 0===_props$TransitionProp?{}:_props$TransitionProp,other=Object(objectWithoutProperties.a)(props,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),paperRef=react.useRef(),getAnchorOffset=react.useCallback((function(contentAnchorOffset){if("anchorPosition"===anchorReference)return anchorPosition;var resolvedAnchorEl=getAnchorEl(anchorEl),anchorRect=(resolvedAnchorEl&&1===resolvedAnchorEl.nodeType?resolvedAnchorEl:Object(ownerDocument.a)(paperRef.current).body).getBoundingClientRect(),anchorVertical=0===contentAnchorOffset?anchorOrigin.vertical:"center";return{top:anchorRect.top+getOffsetTop(anchorRect,anchorVertical),left:anchorRect.left+getOffsetLeft(anchorRect,anchorOrigin.horizontal)}}),[anchorEl,anchorOrigin.horizontal,anchorOrigin.vertical,anchorPosition,anchorReference]),getContentAnchorOffset=react.useCallback((function(element){var contentAnchorOffset=0;if(getContentAnchorEl&&"anchorEl"===anchorReference){var contentAnchorEl=getContentAnchorEl(element);if(contentAnchorEl&&element.contains(contentAnchorEl)){var scrollTop=function(parent,child){for(var element=child,scrollTop=0;element&&element!==parent;)scrollTop+=(element=element.parentElement).scrollTop;return scrollTop}(element,contentAnchorEl);contentAnchorOffset=contentAnchorEl.offsetTop+contentAnchorEl.clientHeight/2-scrollTop||0}0}return contentAnchorOffset}),[anchorOrigin.vertical,anchorReference,getContentAnchorEl]),getTransformOrigin=react.useCallback((function(elemRect){var contentAnchorOffset=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{vertical:getOffsetTop(elemRect,transformOrigin.vertical)+contentAnchorOffset,horizontal:getOffsetLeft(elemRect,transformOrigin.horizontal)}}),[transformOrigin.horizontal,transformOrigin.vertical]),getPositioningStyle=react.useCallback((function(element){var contentAnchorOffset=getContentAnchorOffset(element),elemRect={width:element.offsetWidth,height:element.offsetHeight},elemTransformOrigin=getTransformOrigin(elemRect,contentAnchorOffset);if("none"===anchorReference)return{top:null,left:null,transformOrigin:getTransformOriginValue(elemTransformOrigin)};var anchorOffset=getAnchorOffset(contentAnchorOffset),top=anchorOffset.top-elemTransformOrigin.vertical,left=anchorOffset.left-elemTransformOrigin.horizontal,bottom=top+elemRect.height,right=left+elemRect.width,containerWindow=Object(ownerWindow.a)(getAnchorEl(anchorEl)),heightThreshold=containerWindow.innerHeight-marginThreshold,widthThreshold=containerWindow.innerWidth-marginThreshold;if(top<marginThreshold){var diff=top-marginThreshold;top-=diff,elemTransformOrigin.vertical+=diff}else if(bottom>heightThreshold){var _diff=bottom-heightThreshold;top-=_diff,elemTransformOrigin.vertical+=_diff}if(left<marginThreshold){var _diff2=left-marginThreshold;left-=_diff2,elemTransformOrigin.horizontal+=_diff2}else if(right>widthThreshold){var _diff3=right-widthThreshold;left-=_diff3,elemTransformOrigin.horizontal+=_diff3}return{top:"".concat(Math.round(top),"px"),left:"".concat(Math.round(left),"px"),transformOrigin:getTransformOriginValue(elemTransformOrigin)}}),[anchorEl,anchorReference,getAnchorOffset,getContentAnchorOffset,getTransformOrigin,marginThreshold]),setPositioningStyles=react.useCallback((function(){var element=paperRef.current;if(element){var positioning=getPositioningStyle(element);null!==positioning.top&&(element.style.top=positioning.top),null!==positioning.left&&(element.style.left=positioning.left),element.style.transformOrigin=positioning.transformOrigin}}),[getPositioningStyle]),handlePaperRef=react.useCallback((function(instance){paperRef.current=react_dom.findDOMNode(instance)}),[]);react.useEffect((function(){open&&setPositioningStyles()})),react.useImperativeHandle(action,(function(){return open?{updatePosition:function(){setPositioningStyles()}}:null}),[open,setPositioningStyles]),react.useEffect((function(){if(open){var handleResize=Object(debounce.a)((function(){setPositioningStyles()}));return window.addEventListener("resize",handleResize),function(){handleResize.clear(),window.removeEventListener("resize",handleResize)}}}),[open,setPositioningStyles]);var transitionDuration=transitionDurationProp;"auto"!==transitionDurationProp||TransitionComponent.muiSupportAuto||(transitionDuration=void 0);var container=containerProp||(anchorEl?Object(ownerDocument.a)(getAnchorEl(anchorEl)).body:void 0);return react.createElement(Modal.a,Object(esm_extends.a)({container:container,open:open,ref:ref,BackdropProps:{invisible:!0},className:Object(clsx_m.a)(classes.root,className)},other),react.createElement(TransitionComponent,Object(esm_extends.a)({appear:!0,in:open,onEnter:onEnter,onEntered:onEntered,onExit:onExit,onExited:onExited,onExiting:onExiting,timeout:transitionDuration},TransitionProps,{onEntering:Object(createChainedFunction.a)((function(element,isAppearing){onEntering&&onEntering(element,isAppearing),setPositioningStyles()}),TransitionProps.onEntering)}),react.createElement(Paper.a,Object(esm_extends.a)({elevation:elevation,ref:handlePaperRef},PaperProps,{className:Object(clsx_m.a)(classes.paper,PaperProps.className)}),children)))})),esm_Popover_Popover=Object(withStyles.a)({root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}},{name:"MuiPopover"})(Popover_Popover),List=__webpack_require__(158),getScrollbarSize=__webpack_require__(63),useForkRef=__webpack_require__(11);function nextItem(list,item,disableListWrap){return list===item?list.firstChild:item&&item.nextElementSibling?item.nextElementSibling:disableListWrap?null:list.firstChild}function previousItem(list,item,disableListWrap){return list===item?disableListWrap?list.firstChild:list.lastChild:item&&item.previousElementSibling?item.previousElementSibling:disableListWrap?null:list.lastChild}function textCriteriaMatches(nextFocus,textCriteria){if(void 0===textCriteria)return!0;var text=nextFocus.innerText;return void 0===text&&(text=nextFocus.textContent),0!==(text=text.trim().toLowerCase()).length&&(textCriteria.repeating?text[0]===textCriteria.keys[0]:0===text.indexOf(textCriteria.keys.join("")))}function moveFocus(list,currentFocus,disableListWrap,disabledItemsFocusable,traversalFunction,textCriteria){for(var wrappedOnce=!1,nextFocus=traversalFunction(list,currentFocus,!!currentFocus&&disableListWrap);nextFocus;){if(nextFocus===list.firstChild){if(wrappedOnce)return;wrappedOnce=!0}var nextFocusDisabled=!disabledItemsFocusable&&(nextFocus.disabled||"true"===nextFocus.getAttribute("aria-disabled"));if(nextFocus.hasAttribute("tabindex")&&textCriteriaMatches(nextFocus,textCriteria)&&!nextFocusDisabled)return void nextFocus.focus();nextFocus=traversalFunction(list,nextFocus,disableListWrap)}}var useEnhancedEffect="undefined"===typeof window?react.useEffect:react.useLayoutEffect,esm_MenuList_MenuList=react.forwardRef((function(props,ref){var actions=props.actions,_props$autoFocus=props.autoFocus,autoFocus=void 0!==_props$autoFocus&&_props$autoFocus,_props$autoFocusItem=props.autoFocusItem,autoFocusItem=void 0!==_props$autoFocusItem&&_props$autoFocusItem,children=props.children,className=props.className,_props$disabledItemsF=props.disabledItemsFocusable,disabledItemsFocusable=void 0!==_props$disabledItemsF&&_props$disabledItemsF,_props$disableListWra=props.disableListWrap,disableListWrap=void 0!==_props$disableListWra&&_props$disableListWra,onKeyDown=props.onKeyDown,_props$variant=props.variant,variant=void 0===_props$variant?"selectedMenu":_props$variant,other=Object(objectWithoutProperties.a)(props,["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"]),listRef=react.useRef(null),textCriteriaRef=react.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});useEnhancedEffect((function(){autoFocus&&listRef.current.focus()}),[autoFocus]),react.useImperativeHandle(actions,(function(){return{adjustStyleForScrollbar:function(containerElement,theme){var noExplicitWidth=!listRef.current.style.width;if(containerElement.clientHeight<listRef.current.clientHeight&&noExplicitWidth){var scrollbarSize="".concat(Object(getScrollbarSize.a)(!0),"px");listRef.current.style["rtl"===theme.direction?"paddingLeft":"paddingRight"]=scrollbarSize,listRef.current.style.width="calc(100% + ".concat(scrollbarSize,")")}return listRef.current}}}),[]);var handleOwnRef=react.useCallback((function(instance){listRef.current=react_dom.findDOMNode(instance)}),[]),handleRef=Object(useForkRef.a)(handleOwnRef,ref),activeItemIndex=-1;react.Children.forEach(children,(function(child,index){react.isValidElement(child)&&(child.props.disabled||("selectedMenu"===variant&&child.props.selected||-1===activeItemIndex)&&(activeItemIndex=index))}));var items=react.Children.map(children,(function(child,index){if(index===activeItemIndex){var newChildProps={};return autoFocusItem&&(newChildProps.autoFocus=!0),void 0===child.props.tabIndex&&"selectedMenu"===variant&&(newChildProps.tabIndex=0),react.cloneElement(child,newChildProps)}return child}));return react.createElement(List.a,Object(esm_extends.a)({role:"menu",ref:handleRef,className:className,onKeyDown:function(event){var list=listRef.current,key=event.key,currentFocus=Object(ownerDocument.a)(list).activeElement;if("ArrowDown"===key)event.preventDefault(),moveFocus(list,currentFocus,disableListWrap,disabledItemsFocusable,nextItem);else if("ArrowUp"===key)event.preventDefault(),moveFocus(list,currentFocus,disableListWrap,disabledItemsFocusable,previousItem);else if("Home"===key)event.preventDefault(),moveFocus(list,null,disableListWrap,disabledItemsFocusable,nextItem);else if("End"===key)event.preventDefault(),moveFocus(list,null,disableListWrap,disabledItemsFocusable,previousItem);else if(1===key.length){var criteria=textCriteriaRef.current,lowerKey=key.toLowerCase(),currTime=performance.now();criteria.keys.length>0&&(currTime-criteria.lastTime>500?(criteria.keys=[],criteria.repeating=!0,criteria.previousKeyMatched=!0):criteria.repeating&&lowerKey!==criteria.keys[0]&&(criteria.repeating=!1)),criteria.lastTime=currTime,criteria.keys.push(lowerKey);var keepFocusOnCurrent=currentFocus&&!criteria.repeating&&textCriteriaMatches(currentFocus,criteria);criteria.previousKeyMatched&&(keepFocusOnCurrent||moveFocus(list,currentFocus,!1,disabledItemsFocusable,nextItem,criteria))?event.preventDefault():criteria.previousKeyMatched=!1}onKeyDown&&onKeyDown(event)},tabIndex:autoFocus?0:-1},other),items)})),setRef=__webpack_require__(26),useTheme=__webpack_require__(33),RTL_ORIGIN={vertical:"top",horizontal:"right"},LTR_ORIGIN={vertical:"top",horizontal:"left"},Menu_Menu=react.forwardRef((function(props,ref){var _props$autoFocus=props.autoFocus,autoFocus=void 0===_props$autoFocus||_props$autoFocus,children=props.children,classes=props.classes,_props$disableAutoFoc=props.disableAutoFocusItem,disableAutoFocusItem=void 0!==_props$disableAutoFoc&&_props$disableAutoFoc,_props$MenuListProps=props.MenuListProps,MenuListProps=void 0===_props$MenuListProps?{}:_props$MenuListProps,onClose=props.onClose,onEntering=props.onEntering,open=props.open,_props$PaperProps=props.PaperProps,PaperProps=void 0===_props$PaperProps?{}:_props$PaperProps,PopoverClasses=props.PopoverClasses,_props$transitionDura=props.transitionDuration,transitionDuration=void 0===_props$transitionDura?"auto":_props$transitionDura,_props$variant=props.variant,variant=void 0===_props$variant?"selectedMenu":_props$variant,other=Object(objectWithoutProperties.a)(props,["autoFocus","children","classes","disableAutoFocusItem","MenuListProps","onClose","onEntering","open","PaperProps","PopoverClasses","transitionDuration","variant"]),theme=Object(useTheme.a)(),autoFocusItem=autoFocus&&!disableAutoFocusItem&&open,menuListActionsRef=react.useRef(null),contentAnchorRef=react.useRef(null),activeItemIndex=-1;react.Children.map(children,(function(child,index){react.isValidElement(child)&&(child.props.disabled||("menu"!==variant&&child.props.selected||-1===activeItemIndex)&&(activeItemIndex=index))}));var items=react.Children.map(children,(function(child,index){return index===activeItemIndex?react.cloneElement(child,{ref:function(instance){contentAnchorRef.current=react_dom.findDOMNode(instance),Object(setRef.a)(child.ref,instance)}}):child}));return react.createElement(esm_Popover_Popover,Object(esm_extends.a)({getContentAnchorEl:function(){return contentAnchorRef.current},classes:PopoverClasses,onClose:onClose,onEntering:function(element,isAppearing){menuListActionsRef.current&&menuListActionsRef.current.adjustStyleForScrollbar(element,theme),onEntering&&onEntering(element,isAppearing)},anchorOrigin:"rtl"===theme.direction?RTL_ORIGIN:LTR_ORIGIN,transformOrigin:"rtl"===theme.direction?RTL_ORIGIN:LTR_ORIGIN,PaperProps:Object(esm_extends.a)({},PaperProps,{classes:Object(esm_extends.a)({},PaperProps.classes,{root:classes.paper})}),open:open,ref:ref,transitionDuration:transitionDuration},other),react.createElement(esm_MenuList_MenuList,Object(esm_extends.a)({onKeyDown:function(event){"Tab"===event.key&&(event.preventDefault(),onClose&&onClose(event,"tabKeyDown"))},actions:menuListActionsRef,autoFocus:autoFocus&&(-1===activeItemIndex||disableAutoFocusItem),autoFocusItem:autoFocusItem,variant:variant},MenuListProps,{className:Object(clsx_m.a)(classes.list,MenuListProps.className)}),items))})),esm_Menu_Menu=Object(withStyles.a)({paper:{maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"},list:{outline:0}},{name:"MuiMenu"})(Menu_Menu),utils=__webpack_require__(41),useControlled=__webpack_require__(46);function areEqualValues(a,b){return"object"===Object(esm_typeof.a)(b)&&null!==b?a===b:String(a)===String(b)}var Select_SelectInput=react.forwardRef((function(props,ref){var ariaLabel=props["aria-label"],autoFocus=props.autoFocus,autoWidth=props.autoWidth,children=props.children,classes=props.classes,className=props.className,defaultValue=props.defaultValue,disabled=props.disabled,displayEmpty=props.displayEmpty,IconComponent=props.IconComponent,inputRefProp=props.inputRef,labelId=props.labelId,_props$MenuProps=props.MenuProps,MenuProps=void 0===_props$MenuProps?{}:_props$MenuProps,multiple=props.multiple,name=props.name,onBlur=props.onBlur,onChange=props.onChange,onClose=props.onClose,onFocus=props.onFocus,onOpen=props.onOpen,openProp=props.open,readOnly=props.readOnly,renderValue=props.renderValue,_props$SelectDisplayP=props.SelectDisplayProps,SelectDisplayProps=void 0===_props$SelectDisplayP?{}:_props$SelectDisplayP,tabIndexProp=props.tabIndex,valueProp=(props.type,props.value),_props$variant=props.variant,variant=void 0===_props$variant?"standard":_props$variant,other=Object(objectWithoutProperties.a)(props,["aria-label","autoFocus","autoWidth","children","classes","className","defaultValue","disabled","displayEmpty","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"]),_useControlled=Object(useControlled.a)({controlled:valueProp,default:defaultValue,name:"Select"}),_useControlled2=Object(slicedToArray.a)(_useControlled,2),value=_useControlled2[0],setValue=_useControlled2[1],inputRef=react.useRef(null),_React$useState=react.useState(null),displayNode=_React$useState[0],setDisplayNode=_React$useState[1],isOpenControlled=react.useRef(null!=openProp).current,_React$useState2=react.useState(),menuMinWidthState=_React$useState2[0],setMenuMinWidthState=_React$useState2[1],_React$useState3=react.useState(!1),openState=_React$useState3[0],setOpenState=_React$useState3[1],handleRef=Object(useForkRef.a)(ref,inputRefProp);react.useImperativeHandle(handleRef,(function(){return{focus:function(){displayNode.focus()},node:inputRef.current,value:value}}),[displayNode,value]),react.useEffect((function(){autoFocus&&displayNode&&displayNode.focus()}),[autoFocus,displayNode]),react.useEffect((function(){if(displayNode){var label=Object(ownerDocument.a)(displayNode).getElementById(labelId);if(label){var handler=function(){getSelection().isCollapsed&&displayNode.focus()};return label.addEventListener("click",handler),function(){label.removeEventListener("click",handler)}}}}),[labelId,displayNode]);var display,displaySingle,update=function(open,event){open?onOpen&&onOpen(event):onClose&&onClose(event),isOpenControlled||(setMenuMinWidthState(autoWidth?null:displayNode.clientWidth),setOpenState(open))},childrenArray=react.Children.toArray(children),handleItemClick=function(child){return function(event){var newValue;if(multiple||update(!1,event),multiple){newValue=Array.isArray(value)?value.slice():[];var itemIndex=value.indexOf(child.props.value);-1===itemIndex?newValue.push(child.props.value):newValue.splice(itemIndex,1)}else newValue=child.props.value;child.props.onClick&&child.props.onClick(event),value!==newValue&&(setValue(newValue),onChange&&(event.persist(),Object.defineProperty(event,"target",{writable:!0,value:{value:newValue,name:name}}),onChange(event,child)))}},open=null!==displayNode&&(isOpenControlled?openProp:openState);delete other["aria-invalid"];var displayMultiple=[],computeDisplay=!1;(Object(utils.b)({value:value})||displayEmpty)&&(renderValue?display=renderValue(value):computeDisplay=!0);var items=childrenArray.map((function(child){if(!react.isValidElement(child))return null;var selected;if(multiple){if(!Array.isArray(value))throw new Error(Object(formatMuiErrorMessage.a)(2));(selected=value.some((function(v){return areEqualValues(v,child.props.value)})))&&computeDisplay&&displayMultiple.push(child.props.children)}else(selected=areEqualValues(value,child.props.value))&&computeDisplay&&(displaySingle=child.props.children);return selected&&!0,react.cloneElement(child,{"aria-selected":selected?"true":void 0,onClick:handleItemClick(child),onKeyUp:function(event){" "===event.key&&event.preventDefault(),child.props.onKeyUp&&child.props.onKeyUp(event)},role:"option",selected:selected,value:void 0,"data-value":child.props.value})}));computeDisplay&&(display=multiple?displayMultiple.join(", "):displaySingle);var tabIndex,menuMinWidth=menuMinWidthState;!autoWidth&&isOpenControlled&&displayNode&&(menuMinWidth=displayNode.clientWidth),tabIndex="undefined"!==typeof tabIndexProp?tabIndexProp:disabled?null:0;var buttonId=SelectDisplayProps.id||(name?"mui-component-select-".concat(name):void 0);return react.createElement(react.Fragment,null,react.createElement("div",Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,classes.select,classes.selectMenu,classes[variant],className,disabled&&classes.disabled),ref:setDisplayNode,tabIndex:tabIndex,role:"button","aria-disabled":disabled?"true":void 0,"aria-expanded":open?"true":void 0,"aria-haspopup":"listbox","aria-label":ariaLabel,"aria-labelledby":[labelId,buttonId].filter(Boolean).join(" ")||void 0,onKeyDown:function(event){if(!readOnly){-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(event.key)&&(event.preventDefault(),update(!0,event))}},onMouseDown:disabled||readOnly?null:function(event){0===event.button&&(event.preventDefault(),displayNode.focus(),update(!0,event))},onBlur:function(event){!open&&onBlur&&(event.persist(),Object.defineProperty(event,"target",{writable:!0,value:{value:value,name:name}}),onBlur(event))},onFocus:onFocus},SelectDisplayProps,{id:buttonId}),function(display){return null==display||"string"===typeof display&&!display.trim()}(display)?react.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}}):display),react.createElement("input",Object(esm_extends.a)({value:Array.isArray(value)?value.join(","):value,name:name,ref:inputRef,"aria-hidden":!0,onChange:function(event){var index=childrenArray.map((function(child){return child.props.value})).indexOf(event.target.value);if(-1!==index){var child=childrenArray[index];setValue(child.props.value),onChange&&onChange(event,child)}},tabIndex:-1,className:classes.nativeInput,autoFocus:autoFocus},other)),react.createElement(IconComponent,{className:Object(clsx_m.a)(classes.icon,classes["icon".concat(Object(capitalize.a)(variant))],open&&classes.iconOpen,disabled&&classes.disabled)}),react.createElement(esm_Menu_Menu,Object(esm_extends.a)({id:"menu-".concat(name||""),anchorEl:displayNode,open:open,onClose:function(event){update(!1,event)}},MenuProps,{MenuListProps:Object(esm_extends.a)({"aria-labelledby":labelId,role:"listbox",disableListWrap:!0},MenuProps.MenuListProps),PaperProps:Object(esm_extends.a)({},MenuProps.PaperProps,{style:Object(esm_extends.a)({minWidth:menuMinWidth},null!=MenuProps.PaperProps?MenuProps.PaperProps.style:null)})}),items))})),formControlState=__webpack_require__(22),useFormControl=__webpack_require__(23),createSvgIcon=__webpack_require__(48),ArrowDropDown=Object(createSvgIcon.a)(react.createElement("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),Input=__webpack_require__(154),NativeSelect_NativeSelectInput=react.forwardRef((function(props,ref){var classes=props.classes,className=props.className,disabled=props.disabled,IconComponent=props.IconComponent,inputRef=props.inputRef,_props$variant=props.variant,variant=void 0===_props$variant?"standard":_props$variant,other=Object(objectWithoutProperties.a)(props,["classes","className","disabled","IconComponent","inputRef","variant"]);return react.createElement(react.Fragment,null,react.createElement("select",Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,classes.select,classes[variant],className,disabled&&classes.disabled),disabled:disabled,ref:inputRef||ref},other)),props.multiple?null:react.createElement(IconComponent,{className:Object(clsx_m.a)(classes.icon,classes["icon".concat(Object(capitalize.a)(variant))],disabled&&classes.disabled)}))})),NativeSelect_styles=function(theme){return{root:{},select:{"-moz-appearance":"none","-webkit-appearance":"none",userSelect:"none",borderRadius:0,minWidth:16,cursor:"pointer","&:focus":{backgroundColor:"light"===theme.palette.type?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",borderRadius:0},"&::-ms-expand":{display:"none"},"&$disabled":{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:theme.palette.background.paper},"&&":{paddingRight:24}},filled:{"&&":{paddingRight:32}},outlined:{borderRadius:theme.shape.borderRadius,"&&":{paddingRight:32}},selectMenu:{height:"auto",minHeight:"1.1876em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},disabled:{},icon:{position:"absolute",right:0,top:"calc(50% - 12px)",pointerEvents:"none",color:theme.palette.action.active,"&$disabled":{color:theme.palette.action.disabled}},iconOpen:{transform:"rotate(180deg)"},iconFilled:{right:7},iconOutlined:{right:7},nativeInput:{bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%"}}},defaultInput=react.createElement(Input.a,null),NativeSelect_NativeSelect=react.forwardRef((function(props,ref){var children=props.children,classes=props.classes,_props$IconComponent=props.IconComponent,IconComponent=void 0===_props$IconComponent?ArrowDropDown:_props$IconComponent,_props$input=props.input,input=void 0===_props$input?defaultInput:_props$input,inputProps=props.inputProps,other=(props.variant,Object(objectWithoutProperties.a)(props,["children","classes","IconComponent","input","inputProps","variant"])),muiFormControl=Object(useFormControl.a)(),fcs=Object(formControlState.a)({props:props,muiFormControl:muiFormControl,states:["variant"]});return react.cloneElement(input,Object(esm_extends.a)({inputComponent:NativeSelect_NativeSelectInput,inputProps:Object(esm_extends.a)({children:children,classes:classes,IconComponent:IconComponent,variant:fcs.variant,type:void 0},inputProps,input?input.props.inputProps:{}),ref:ref},other))}));NativeSelect_NativeSelect.muiName="Select";Object(withStyles.a)(NativeSelect_styles,{name:"MuiNativeSelect"})(NativeSelect_NativeSelect);var FilledInput=__webpack_require__(155),OutlinedInput=__webpack_require__(180),Select_styles=NativeSelect_styles,_ref=react.createElement(Input.a,null),_ref2=react.createElement(FilledInput.a,null),Select_Select=react.forwardRef((function Select(props,ref){var _props$autoWidth=props.autoWidth,autoWidth=void 0!==_props$autoWidth&&_props$autoWidth,children=props.children,classes=props.classes,_props$displayEmpty=props.displayEmpty,displayEmpty=void 0!==_props$displayEmpty&&_props$displayEmpty,_props$IconComponent=props.IconComponent,IconComponent=void 0===_props$IconComponent?ArrowDropDown:_props$IconComponent,id=props.id,input=props.input,inputProps=props.inputProps,label=props.label,labelId=props.labelId,_props$labelWidth=props.labelWidth,labelWidth=void 0===_props$labelWidth?0:_props$labelWidth,MenuProps=props.MenuProps,_props$multiple=props.multiple,multiple=void 0!==_props$multiple&&_props$multiple,_props$native=props.native,native=void 0!==_props$native&&_props$native,onClose=props.onClose,onOpen=props.onOpen,open=props.open,renderValue=props.renderValue,SelectDisplayProps=props.SelectDisplayProps,_props$variant=props.variant,variantProps=void 0===_props$variant?"standard":_props$variant,other=Object(objectWithoutProperties.a)(props,["autoWidth","children","classes","displayEmpty","IconComponent","id","input","inputProps","label","labelId","labelWidth","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"]),inputComponent=native?NativeSelect_NativeSelectInput:Select_SelectInput,muiFormControl=Object(useFormControl.a)(),variant=Object(formControlState.a)({props:props,muiFormControl:muiFormControl,states:["variant"]}).variant||variantProps,InputComponent=input||{standard:_ref,outlined:react.createElement(OutlinedInput.a,{label:label,labelWidth:labelWidth}),filled:_ref2}[variant];return react.cloneElement(InputComponent,Object(esm_extends.a)({inputComponent:inputComponent,inputProps:Object(esm_extends.a)({children:children,IconComponent:IconComponent,variant:variant,type:void 0,multiple:multiple},native?{id:id}:{autoWidth:autoWidth,displayEmpty:displayEmpty,labelId:labelId,MenuProps:MenuProps,onClose:onClose,onOpen:onOpen,open:open,renderValue:renderValue,SelectDisplayProps:Object(esm_extends.a)({id:id},SelectDisplayProps)},inputProps,{classes:inputProps?Object(mergeClasses.a)({baseClasses:classes,newClasses:inputProps.classes,Component:Select}):classes},input?input.props.inputProps:{}),ref:ref},other))}));Select_Select.muiName="Select";__webpack_exports__.a=Object(withStyles.a)(Select_styles,{name:"MuiSelect"})(Select_Select)},function(module,__webpack_exports__,__webpack_require__){"use strict";var objectWithoutProperties=__webpack_require__(3),esm_extends=__webpack_require__(2),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),colorManipulator=__webpack_require__(15),withStyles=__webpack_require__(5),Paper=__webpack_require__(93),createSvgIcon=__webpack_require__(48),SuccessOutlined=Object(createSvgIcon.a)(react.createElement("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),ReportProblemOutlined=Object(createSvgIcon.a)(react.createElement("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),ErrorOutline=Object(createSvgIcon.a)(react.createElement("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),InfoOutlined=Object(createSvgIcon.a)(react.createElement("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined"),Close=Object(createSvgIcon.a)(react.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),IconButton=__webpack_require__(152),capitalize=__webpack_require__(8),defaultIconMapping={success:react.createElement(SuccessOutlined,{fontSize:"inherit"}),warning:react.createElement(ReportProblemOutlined,{fontSize:"inherit"}),error:react.createElement(ErrorOutline,{fontSize:"inherit"}),info:react.createElement(InfoOutlined,{fontSize:"inherit"})},_ref=react.createElement(Close,{fontSize:"small"}),Alert_Alert=react.forwardRef((function(props,ref){var action=props.action,children=props.children,classes=props.classes,className=props.className,_props$closeText=props.closeText,closeText=void 0===_props$closeText?"Close":_props$closeText,color=props.color,icon=props.icon,_props$iconMapping=props.iconMapping,iconMapping=void 0===_props$iconMapping?defaultIconMapping:_props$iconMapping,onClose=props.onClose,_props$role=props.role,role=void 0===_props$role?"alert":_props$role,_props$severity=props.severity,severity=void 0===_props$severity?"success":_props$severity,_props$variant=props.variant,variant=void 0===_props$variant?"standard":_props$variant,other=Object(objectWithoutProperties.a)(props,["action","children","classes","className","closeText","color","icon","iconMapping","onClose","role","severity","variant"]);return react.createElement(Paper.a,Object(esm_extends.a)({role:role,square:!0,elevation:0,className:Object(clsx_m.a)(classes.root,classes["".concat(variant).concat(Object(capitalize.a)(color||severity))],className),ref:ref},other),!1!==icon?react.createElement("div",{className:classes.icon},icon||iconMapping[severity]||defaultIconMapping[severity]):null,react.createElement("div",{className:classes.message},children),null!=action?react.createElement("div",{className:classes.action},action):null,null==action&&onClose?react.createElement("div",{className:classes.action},react.createElement(IconButton.a,{size:"small","aria-label":closeText,title:closeText,color:"inherit",onClick:onClose},_ref)):null)}));__webpack_exports__.a=Object(withStyles.a)((function(theme){var getColor="light"===theme.palette.type?colorManipulator.a:colorManipulator.e,getBackgroundColor="light"===theme.palette.type?colorManipulator.e:colorManipulator.a;return{root:Object(esm_extends.a)({},theme.typography.body2,{borderRadius:theme.shape.borderRadius,backgroundColor:"transparent",display:"flex",padding:"6px 16px"}),standardSuccess:{color:getColor(theme.palette.success.main,.6),backgroundColor:getBackgroundColor(theme.palette.success.main,.9),"& $icon":{color:theme.palette.success.main}},standardInfo:{color:getColor(theme.palette.info.main,.6),backgroundColor:getBackgroundColor(theme.palette.info.main,.9),"& $icon":{color:theme.palette.info.main}},standardWarning:{color:getColor(theme.palette.warning.main,.6),backgroundColor:getBackgroundColor(theme.palette.warning.main,.9),"& $icon":{color:theme.palette.warning.main}},standardError:{color:getColor(theme.palette.error.main,.6),backgroundColor:getBackgroundColor(theme.palette.error.main,.9),"& $icon":{color:theme.palette.error.main}},outlinedSuccess:{color:getColor(theme.palette.success.main,.6),border:"1px solid ".concat(theme.palette.success.main),"& $icon":{color:theme.palette.success.main}},outlinedInfo:{color:getColor(theme.palette.info.main,.6),border:"1px solid ".concat(theme.palette.info.main),"& $icon":{color:theme.palette.info.main}},outlinedWarning:{color:getColor(theme.palette.warning.main,.6),border:"1px solid ".concat(theme.palette.warning.main),"& $icon":{color:theme.palette.warning.main}},outlinedError:{color:getColor(theme.palette.error.main,.6),border:"1px solid ".concat(theme.palette.error.main),"& $icon":{color:theme.palette.error.main}},filledSuccess:{color:"#fff",fontWeight:theme.typography.fontWeightMedium,backgroundColor:theme.palette.success.main},filledInfo:{color:"#fff",fontWeight:theme.typography.fontWeightMedium,backgroundColor:theme.palette.info.main},filledWarning:{color:"#fff",fontWeight:theme.typography.fontWeightMedium,backgroundColor:theme.palette.warning.main},filledError:{color:"#fff",fontWeight:theme.typography.fontWeightMedium,backgroundColor:theme.palette.error.main},icon:{marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9},message:{padding:"8px 0"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}}}),{name:"MuiAlert"})(Alert_Alert)},function(module,__webpack_exports__,__webpack_require__){"use strict";var objectWithoutProperties=__webpack_require__(3),esm_extends=__webpack_require__(2),react=__webpack_require__(1),react_dom=__webpack_require__(12),useTheme=(__webpack_require__(6),__webpack_require__(117)),getThemeProps=__webpack_require__(151),ownerDocument=__webpack_require__(16),setRef=__webpack_require__(26),useForkRef=__webpack_require__(11);var useEnhancedEffect="undefined"!==typeof window?react.useLayoutEffect:react.useEffect;var esm_Portal_Portal=react.forwardRef((function(props,ref){var children=props.children,container=props.container,_props$disablePortal=props.disablePortal,disablePortal=void 0!==_props$disablePortal&&_props$disablePortal,onRendered=props.onRendered,_React$useState=react.useState(null),mountNode=_React$useState[0],setMountNode=_React$useState[1],handleRef=Object(useForkRef.a)(react.isValidElement(children)?children.ref:null,ref);return useEnhancedEffect((function(){disablePortal||setMountNode(function(container){return container="function"===typeof container?container():container,react_dom.findDOMNode(container)}(container)||document.body)}),[container,disablePortal]),useEnhancedEffect((function(){if(mountNode&&!disablePortal)return Object(setRef.a)(ref,mountNode),function(){Object(setRef.a)(ref,null)}}),[ref,mountNode,disablePortal]),useEnhancedEffect((function(){onRendered&&(mountNode||disablePortal)&&onRendered()}),[onRendered,mountNode,disablePortal]),disablePortal?react.isValidElement(children)?react.cloneElement(children,{ref:handleRef}):children:mountNode?react_dom.createPortal(children,mountNode):mountNode})),createChainedFunction=__webpack_require__(27),useEventCallback=__webpack_require__(20),zIndex=__webpack_require__(62);var createClass=__webpack_require__(51),toConsumableArray=__webpack_require__(35),getScrollbarSize=__webpack_require__(63),ownerWindow=__webpack_require__(47);function ariaHidden(node,show){show?node.setAttribute("aria-hidden","true"):node.removeAttribute("aria-hidden")}function getPaddingRight(node){return parseInt(window.getComputedStyle(node)["padding-right"],10)||0}function ariaHiddenSiblings(container,mountNode,currentNode){var nodesToExclude=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],show=arguments.length>4?arguments[4]:void 0,blacklist=[mountNode,currentNode].concat(Object(toConsumableArray.a)(nodesToExclude)),blacklistTagNames=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(container.children,(function(node){1===node.nodeType&&-1===blacklist.indexOf(node)&&-1===blacklistTagNames.indexOf(node.tagName)&&ariaHidden(node,show)}))}function findIndexOf(containerInfo,callback){var idx=-1;return containerInfo.some((function(item,index){return!!callback(item)&&(idx=index,!0)})),idx}function handleContainer(containerInfo,props){var fixedNodes,restoreStyle=[],restorePaddings=[],container=containerInfo.container;if(!props.disableScrollLock){if(function(container){var doc=Object(ownerDocument.a)(container);return doc.body===container?Object(ownerWindow.a)(doc).innerWidth>doc.documentElement.clientWidth:container.scrollHeight>container.clientHeight}(container)){var scrollbarSize=Object(getScrollbarSize.a)();restoreStyle.push({value:container.style.paddingRight,key:"padding-right",el:container}),container.style["padding-right"]="".concat(getPaddingRight(container)+scrollbarSize,"px"),fixedNodes=Object(ownerDocument.a)(container).querySelectorAll(".mui-fixed"),[].forEach.call(fixedNodes,(function(node){restorePaddings.push(node.style.paddingRight),node.style.paddingRight="".concat(getPaddingRight(node)+scrollbarSize,"px")}))}var parent=container.parentElement,scrollContainer="HTML"===parent.nodeName&&"scroll"===window.getComputedStyle(parent)["overflow-y"]?parent:container;restoreStyle.push({value:scrollContainer.style.overflow,key:"overflow",el:scrollContainer}),scrollContainer.style.overflow="hidden"}return function(){fixedNodes&&[].forEach.call(fixedNodes,(function(node,i){restorePaddings[i]?node.style.paddingRight=restorePaddings[i]:node.style.removeProperty("padding-right")})),restoreStyle.forEach((function(_ref){var value=_ref.value,el=_ref.el,key=_ref.key;value?el.style.setProperty(key,value):el.style.removeProperty(key)}))}}var ModalManager_ModalManager=function(){function ModalManager(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ModalManager),this.modals=[],this.containers=[]}return Object(createClass.a)(ModalManager,[{key:"add",value:function(modal,container){var modalIndex=this.modals.indexOf(modal);if(-1!==modalIndex)return modalIndex;modalIndex=this.modals.length,this.modals.push(modal),modal.modalRef&&ariaHidden(modal.modalRef,!1);var hiddenSiblingNodes=function(container){var hiddenSiblings=[];return[].forEach.call(container.children,(function(node){node.getAttribute&&"true"===node.getAttribute("aria-hidden")&&hiddenSiblings.push(node)})),hiddenSiblings}(container);ariaHiddenSiblings(container,modal.mountNode,modal.modalRef,hiddenSiblingNodes,!0);var containerIndex=findIndexOf(this.containers,(function(item){return item.container===container}));return-1!==containerIndex?(this.containers[containerIndex].modals.push(modal),modalIndex):(this.containers.push({modals:[modal],container:container,restore:null,hiddenSiblingNodes:hiddenSiblingNodes}),modalIndex)}},{key:"mount",value:function(modal,props){var containerIndex=findIndexOf(this.containers,(function(item){return-1!==item.modals.indexOf(modal)})),containerInfo=this.containers[containerIndex];containerInfo.restore||(containerInfo.restore=handleContainer(containerInfo,props))}},{key:"remove",value:function(modal){var modalIndex=this.modals.indexOf(modal);if(-1===modalIndex)return modalIndex;var containerIndex=findIndexOf(this.containers,(function(item){return-1!==item.modals.indexOf(modal)})),containerInfo=this.containers[containerIndex];if(containerInfo.modals.splice(containerInfo.modals.indexOf(modal),1),this.modals.splice(modalIndex,1),0===containerInfo.modals.length)containerInfo.restore&&containerInfo.restore(),modal.modalRef&&ariaHidden(modal.modalRef,!0),ariaHiddenSiblings(containerInfo.container,modal.mountNode,modal.modalRef,containerInfo.hiddenSiblingNodes,!1),this.containers.splice(containerIndex,1);else{var nextTop=containerInfo.modals[containerInfo.modals.length-1];nextTop.modalRef&&ariaHidden(nextTop.modalRef,!1)}return modalIndex}},{key:"isTopModal",value:function(modal){return this.modals.length>0&&this.modals[this.modals.length-1]===modal}}]),ModalManager}();var Unstable_TrapFocus_Unstable_TrapFocus=function(props){var children=props.children,_props$disableAutoFoc=props.disableAutoFocus,disableAutoFocus=void 0!==_props$disableAutoFoc&&_props$disableAutoFoc,_props$disableEnforce=props.disableEnforceFocus,disableEnforceFocus=void 0!==_props$disableEnforce&&_props$disableEnforce,_props$disableRestore=props.disableRestoreFocus,disableRestoreFocus=void 0!==_props$disableRestore&&_props$disableRestore,getDoc=props.getDoc,isEnabled=props.isEnabled,open=props.open,ignoreNextEnforceFocus=react.useRef(),sentinelStart=react.useRef(null),sentinelEnd=react.useRef(null),nodeToRestore=react.useRef(),rootRef=react.useRef(null),handleOwnRef=react.useCallback((function(instance){rootRef.current=react_dom.findDOMNode(instance)}),[]),handleRef=Object(useForkRef.a)(children.ref,handleOwnRef),prevOpenRef=react.useRef();return react.useEffect((function(){prevOpenRef.current=open}),[open]),!prevOpenRef.current&&open&&"undefined"!==typeof window&&(nodeToRestore.current=getDoc().activeElement),react.useEffect((function(){if(open){var doc=Object(ownerDocument.a)(rootRef.current);disableAutoFocus||!rootRef.current||rootRef.current.contains(doc.activeElement)||(rootRef.current.hasAttribute("tabIndex")||rootRef.current.setAttribute("tabIndex",-1),rootRef.current.focus());var contain=function(){null!==rootRef.current&&(doc.hasFocus()&&!disableEnforceFocus&&isEnabled()&&!ignoreNextEnforceFocus.current?rootRef.current&&!rootRef.current.contains(doc.activeElement)&&rootRef.current.focus():ignoreNextEnforceFocus.current=!1)},loopFocus=function(event){!disableEnforceFocus&&isEnabled()&&9===event.keyCode&&doc.activeElement===rootRef.current&&(ignoreNextEnforceFocus.current=!0,event.shiftKey?sentinelEnd.current.focus():sentinelStart.current.focus())};doc.addEventListener("focus",contain,!0),doc.addEventListener("keydown",loopFocus,!0);var interval=setInterval((function(){contain()}),50);return function(){clearInterval(interval),doc.removeEventListener("focus",contain,!0),doc.removeEventListener("keydown",loopFocus,!0),disableRestoreFocus||(nodeToRestore.current&&nodeToRestore.current.focus&&nodeToRestore.current.focus(),nodeToRestore.current=null)}}}),[disableAutoFocus,disableEnforceFocus,disableRestoreFocus,isEnabled,open]),react.createElement(react.Fragment,null,react.createElement("div",{tabIndex:0,ref:sentinelStart,"data-test":"sentinelStart"}),react.cloneElement(children,{ref:handleRef}),react.createElement("div",{tabIndex:0,ref:sentinelEnd,"data-test":"sentinelEnd"}))},styles={root:{zIndex:-1,position:"fixed",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},invisible:{backgroundColor:"transparent"}},Modal_SimpleBackdrop=react.forwardRef((function(props,ref){var _props$invisible=props.invisible,invisible=void 0!==_props$invisible&&_props$invisible,open=props.open,other=Object(objectWithoutProperties.a)(props,["invisible","open"]);return open?react.createElement("div",Object(esm_extends.a)({"aria-hidden":!0,ref:ref},other,{style:Object(esm_extends.a)({},styles.root,invisible?styles.invisible:{},other.style)})):null}));var defaultManager=new ModalManager_ModalManager,Modal_Modal=react.forwardRef((function(inProps,ref){var theme=Object(useTheme.a)(),props=Object(getThemeProps.a)({name:"MuiModal",props:Object(esm_extends.a)({},inProps),theme:theme}),_props$BackdropCompon=props.BackdropComponent,BackdropComponent=void 0===_props$BackdropCompon?Modal_SimpleBackdrop:_props$BackdropCompon,BackdropProps=props.BackdropProps,children=props.children,_props$closeAfterTran=props.closeAfterTransition,closeAfterTransition=void 0!==_props$closeAfterTran&&_props$closeAfterTran,container=props.container,_props$disableAutoFoc=props.disableAutoFocus,disableAutoFocus=void 0!==_props$disableAutoFoc&&_props$disableAutoFoc,_props$disableBackdro=props.disableBackdropClick,disableBackdropClick=void 0!==_props$disableBackdro&&_props$disableBackdro,_props$disableEnforce=props.disableEnforceFocus,disableEnforceFocus=void 0!==_props$disableEnforce&&_props$disableEnforce,_props$disableEscapeK=props.disableEscapeKeyDown,disableEscapeKeyDown=void 0!==_props$disableEscapeK&&_props$disableEscapeK,_props$disablePortal=props.disablePortal,disablePortal=void 0!==_props$disablePortal&&_props$disablePortal,_props$disableRestore=props.disableRestoreFocus,disableRestoreFocus=void 0!==_props$disableRestore&&_props$disableRestore,_props$disableScrollL=props.disableScrollLock,disableScrollLock=void 0!==_props$disableScrollL&&_props$disableScrollL,_props$hideBackdrop=props.hideBackdrop,hideBackdrop=void 0!==_props$hideBackdrop&&_props$hideBackdrop,_props$keepMounted=props.keepMounted,keepMounted=void 0!==_props$keepMounted&&_props$keepMounted,_props$manager=props.manager,manager=void 0===_props$manager?defaultManager:_props$manager,onBackdropClick=props.onBackdropClick,onClose=props.onClose,onEscapeKeyDown=props.onEscapeKeyDown,onRendered=props.onRendered,open=props.open,other=Object(objectWithoutProperties.a)(props,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),_React$useState=react.useState(!0),exited=_React$useState[0],setExited=_React$useState[1],modal=react.useRef({}),mountNodeRef=react.useRef(null),modalRef=react.useRef(null),handleRef=Object(useForkRef.a)(modalRef,ref),hasTransition=function(props){return!!props.children&&props.children.props.hasOwnProperty("in")}(props),getDoc=function(){return Object(ownerDocument.a)(mountNodeRef.current)},getModal=function(){return modal.current.modalRef=modalRef.current,modal.current.mountNode=mountNodeRef.current,modal.current},handleMounted=function(){manager.mount(getModal(),{disableScrollLock:disableScrollLock}),modalRef.current.scrollTop=0},handleOpen=Object(useEventCallback.a)((function(){var resolvedContainer=function(container){return container="function"===typeof container?container():container,react_dom.findDOMNode(container)}(container)||getDoc().body;manager.add(getModal(),resolvedContainer),modalRef.current&&handleMounted()})),isTopModal=react.useCallback((function(){return manager.isTopModal(getModal())}),[manager]),handlePortalRef=Object(useEventCallback.a)((function(node){mountNodeRef.current=node,node&&(onRendered&&onRendered(),open&&isTopModal()?handleMounted():ariaHidden(modalRef.current,!0))})),handleClose=react.useCallback((function(){manager.remove(getModal())}),[manager]);if(react.useEffect((function(){return function(){handleClose()}}),[handleClose]),react.useEffect((function(){open?handleOpen():hasTransition&&closeAfterTransition||handleClose()}),[open,handleClose,hasTransition,closeAfterTransition,handleOpen]),!keepMounted&&!open&&(!hasTransition||exited))return null;var inlineStyle=function(theme){return{root:{position:"fixed",zIndex:theme.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}}(theme||{zIndex:zIndex.a}),childProps={};return void 0===children.props.tabIndex&&(childProps.tabIndex=children.props.tabIndex||"-1"),hasTransition&&(childProps.onEnter=Object(createChainedFunction.a)((function(){setExited(!1)}),children.props.onEnter),childProps.onExited=Object(createChainedFunction.a)((function(){setExited(!0),closeAfterTransition&&handleClose()}),children.props.onExited)),react.createElement(esm_Portal_Portal,{ref:handlePortalRef,container:container,disablePortal:disablePortal},react.createElement("div",Object(esm_extends.a)({ref:handleRef,onKeyDown:function(event){"Escape"===event.key&&isTopModal()&&(onEscapeKeyDown&&onEscapeKeyDown(event),disableEscapeKeyDown||(event.stopPropagation(),onClose&&onClose(event,"escapeKeyDown")))},role:"presentation"},other,{style:Object(esm_extends.a)({},inlineStyle.root,!open&&exited?inlineStyle.hidden:{},other.style)}),hideBackdrop?null:react.createElement(BackdropComponent,Object(esm_extends.a)({open:open,onClick:function(event){event.target===event.currentTarget&&(onBackdropClick&&onBackdropClick(event),!disableBackdropClick&&onClose&&onClose(event,"backdropClick"))}},BackdropProps)),react.createElement(Unstable_TrapFocus_Unstable_TrapFocus,{disableEnforceFocus:disableEnforceFocus,disableAutoFocus:disableAutoFocus,disableRestoreFocus:disableRestoreFocus,getDoc:getDoc,isEnabled:isTopModal,open:open},react.cloneElement(children,childProps))))}));__webpack_exports__.a=Modal_Modal},function(module,__webpack_exports__,__webpack_require__){"use strict";var objectWithoutProperties=__webpack_require__(3),defineProperty=__webpack_require__(13),esm_extends=__webpack_require__(2),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),withStyles=__webpack_require__(5),transitions=__webpack_require__(24),react_dom=__webpack_require__(12),ownerDocument=__webpack_require__(16),useForkRef=__webpack_require__(11),useEventCallback=__webpack_require__(20);function mapEventPropToEvent(eventProp){return eventProp.substring(2).toLowerCase()}var ClickAwayListener_ClickAwayListener=function(props){var children=props.children,_props$disableReactTr=props.disableReactTree,disableReactTree=void 0!==_props$disableReactTr&&_props$disableReactTr,_props$mouseEvent=props.mouseEvent,mouseEvent=void 0===_props$mouseEvent?"onClick":_props$mouseEvent,onClickAway=props.onClickAway,_props$touchEvent=props.touchEvent,touchEvent=void 0===_props$touchEvent?"onTouchEnd":_props$touchEvent,movedRef=react.useRef(!1),nodeRef=react.useRef(null),activatedRef=react.useRef(!1),syntheticEventRef=react.useRef(!1);react.useEffect((function(){return setTimeout((function(){activatedRef.current=!0}),0),function(){activatedRef.current=!1}}),[]);var handleOwnRef=react.useCallback((function(instance){nodeRef.current=react_dom.findDOMNode(instance)}),[]),handleRef=Object(useForkRef.a)(children.ref,handleOwnRef),handleClickAway=Object(useEventCallback.a)((function(event){var insideReactTree=syntheticEventRef.current;if(syntheticEventRef.current=!1,activatedRef.current&&nodeRef.current&&!function(event){return document.documentElement.clientWidth<event.clientX||document.documentElement.clientHeight<event.clientY}(event))if(movedRef.current)movedRef.current=!1;else{var insideDOM;if(event.composedPath)insideDOM=event.composedPath().indexOf(nodeRef.current)>-1;else insideDOM=!Object(ownerDocument.a)(nodeRef.current).documentElement.contains(event.target)||nodeRef.current.contains(event.target);insideDOM||!disableReactTree&&insideReactTree||onClickAway(event)}})),createHandleSynthetic=function(handlerName){return function(event){syntheticEventRef.current=!0;var childrenPropsHandler=children.props[handlerName];childrenPropsHandler&&childrenPropsHandler(event)}},childrenProps={ref:handleRef};return!1!==touchEvent&&(childrenProps[touchEvent]=createHandleSynthetic(touchEvent)),react.useEffect((function(){if(!1!==touchEvent){var mappedTouchEvent=mapEventPropToEvent(touchEvent),doc=Object(ownerDocument.a)(nodeRef.current),handleTouchMove=function(){movedRef.current=!0};return doc.addEventListener(mappedTouchEvent,handleClickAway),doc.addEventListener("touchmove",handleTouchMove),function(){doc.removeEventListener(mappedTouchEvent,handleClickAway),doc.removeEventListener("touchmove",handleTouchMove)}}}),[handleClickAway,touchEvent]),!1!==mouseEvent&&(childrenProps[mouseEvent]=createHandleSynthetic(mouseEvent)),react.useEffect((function(){if(!1!==mouseEvent){var mappedMouseEvent=mapEventPropToEvent(mouseEvent),doc=Object(ownerDocument.a)(nodeRef.current);return doc.addEventListener(mappedMouseEvent,handleClickAway),function(){doc.removeEventListener(mappedMouseEvent,handleClickAway)}}}),[handleClickAway,mouseEvent]),react.createElement(react.Fragment,null,react.cloneElement(children,childrenProps))},capitalize=__webpack_require__(8),createChainedFunction=__webpack_require__(27),Grow=__webpack_require__(157),Paper=__webpack_require__(93),colorManipulator=__webpack_require__(15),SnackbarContent_SnackbarContent=react.forwardRef((function(props,ref){var action=props.action,classes=props.classes,className=props.className,message=props.message,_props$role=props.role,role=void 0===_props$role?"alert":_props$role,other=Object(objectWithoutProperties.a)(props,["action","classes","className","message","role"]);return react.createElement(Paper.a,Object(esm_extends.a)({role:role,square:!0,elevation:6,className:Object(clsx_m.a)(classes.root,className),ref:ref},other),react.createElement("div",{className:classes.message},message),action?react.createElement("div",{className:classes.action},action):null)})),esm_SnackbarContent_SnackbarContent=Object(withStyles.a)((function(theme){var emphasis="light"===theme.palette.type?.8:.98,backgroundColor=Object(colorManipulator.b)(theme.palette.background.default,emphasis);return{root:Object(esm_extends.a)({},theme.typography.body2,Object(defineProperty.a)({color:theme.palette.getContrastText(backgroundColor),backgroundColor:backgroundColor,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:theme.shape.borderRadius,flexGrow:1},theme.breakpoints.up("sm"),{flexGrow:"initial",minWidth:288})),message:{padding:"8px 0"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}}}),{name:"MuiSnackbarContent"})(SnackbarContent_SnackbarContent),Snackbar_Snackbar=react.forwardRef((function(props,ref){var action=props.action,_props$anchorOrigin=props.anchorOrigin,vertical=(_props$anchorOrigin=void 0===_props$anchorOrigin?{vertical:"bottom",horizontal:"center"}:_props$anchorOrigin).vertical,horizontal=_props$anchorOrigin.horizontal,_props$autoHideDurati=props.autoHideDuration,autoHideDuration=void 0===_props$autoHideDurati?null:_props$autoHideDurati,children=props.children,classes=props.classes,className=props.className,ClickAwayListenerProps=props.ClickAwayListenerProps,ContentProps=props.ContentProps,_props$disableWindowB=props.disableWindowBlurListener,disableWindowBlurListener=void 0!==_props$disableWindowB&&_props$disableWindowB,message=props.message,onClose=props.onClose,onEnter=props.onEnter,onEntered=props.onEntered,onEntering=props.onEntering,onExit=props.onExit,onExited=props.onExited,onExiting=props.onExiting,onMouseEnter=props.onMouseEnter,onMouseLeave=props.onMouseLeave,open=props.open,resumeHideDuration=props.resumeHideDuration,_props$TransitionComp=props.TransitionComponent,TransitionComponent=void 0===_props$TransitionComp?Grow.a:_props$TransitionComp,_props$transitionDura=props.transitionDuration,transitionDuration=void 0===_props$transitionDura?{enter:transitions.b.enteringScreen,exit:transitions.b.leavingScreen}:_props$transitionDura,TransitionProps=props.TransitionProps,other=Object(objectWithoutProperties.a)(props,["action","anchorOrigin","autoHideDuration","children","classes","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onClose","onEnter","onEntered","onEntering","onExit","onExited","onExiting","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"]),timerAutoHide=react.useRef(),_React$useState=react.useState(!0),exited=_React$useState[0],setExited=_React$useState[1],handleClose=Object(useEventCallback.a)((function(){onClose&&onClose.apply(void 0,arguments)})),setAutoHideTimer=Object(useEventCallback.a)((function(autoHideDurationParam){onClose&&null!=autoHideDurationParam&&(clearTimeout(timerAutoHide.current),timerAutoHide.current=setTimeout((function(){handleClose(null,"timeout")}),autoHideDurationParam))}));react.useEffect((function(){return open&&setAutoHideTimer(autoHideDuration),function(){clearTimeout(timerAutoHide.current)}}),[open,autoHideDuration,setAutoHideTimer]);var handlePause=function(){clearTimeout(timerAutoHide.current)},handleResume=react.useCallback((function(){null!=autoHideDuration&&setAutoHideTimer(null!=resumeHideDuration?resumeHideDuration:.5*autoHideDuration)}),[autoHideDuration,resumeHideDuration,setAutoHideTimer]);return react.useEffect((function(){if(!disableWindowBlurListener&&open)return window.addEventListener("focus",handleResume),window.addEventListener("blur",handlePause),function(){window.removeEventListener("focus",handleResume),window.removeEventListener("blur",handlePause)}}),[disableWindowBlurListener,handleResume,open]),!open&&exited?null:react.createElement(ClickAwayListener_ClickAwayListener,Object(esm_extends.a)({onClickAway:function(event){onClose&&onClose(event,"clickaway")}},ClickAwayListenerProps),react.createElement("div",Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,classes["anchorOrigin".concat(Object(capitalize.a)(vertical)).concat(Object(capitalize.a)(horizontal))],className),onMouseEnter:function(event){onMouseEnter&&onMouseEnter(event),handlePause()},onMouseLeave:function(event){onMouseLeave&&onMouseLeave(event),handleResume()},ref:ref},other),react.createElement(TransitionComponent,Object(esm_extends.a)({appear:!0,in:open,onEnter:Object(createChainedFunction.a)((function(){setExited(!1)}),onEnter),onEntered:onEntered,onEntering:onEntering,onExit:onExit,onExited:Object(createChainedFunction.a)((function(){setExited(!0)}),onExited),onExiting:onExiting,timeout:transitionDuration,direction:"top"===vertical?"down":"up"},TransitionProps),children||react.createElement(esm_SnackbarContent_SnackbarContent,Object(esm_extends.a)({message:message,action:action},ContentProps)))))}));__webpack_exports__.a=Object(withStyles.a)((function(theme){var top1={top:8},bottom1={bottom:8},right={justifyContent:"flex-end"},left={justifyContent:"flex-start"},top3={top:24},bottom3={bottom:24},right3={right:24},left3={left:24},center={left:"50%",right:"auto",transform:"translateX(-50%)"};return{root:{zIndex:theme.zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},anchorOriginTopCenter:Object(esm_extends.a)({},top1,Object(defineProperty.a)({},theme.breakpoints.up("sm"),Object(esm_extends.a)({},top3,center))),anchorOriginBottomCenter:Object(esm_extends.a)({},bottom1,Object(defineProperty.a)({},theme.breakpoints.up("sm"),Object(esm_extends.a)({},bottom3,center))),anchorOriginTopRight:Object(esm_extends.a)({},top1,right,Object(defineProperty.a)({},theme.breakpoints.up("sm"),Object(esm_extends.a)({left:"auto"},top3,right3))),anchorOriginBottomRight:Object(esm_extends.a)({},bottom1,right,Object(defineProperty.a)({},theme.breakpoints.up("sm"),Object(esm_extends.a)({left:"auto"},bottom3,right3))),anchorOriginTopLeft:Object(esm_extends.a)({},top1,left,Object(defineProperty.a)({},theme.breakpoints.up("sm"),Object(esm_extends.a)({right:"auto"},top3,left3))),anchorOriginBottomLeft:Object(esm_extends.a)({},bottom1,left,Object(defineProperty.a)({},theme.breakpoints.up("sm"),Object(esm_extends.a)({right:"auto"},bottom3,left3)))}}),{flip:!1,name:"MuiSnackbar"})(Snackbar_Snackbar)},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),defineProperty=__webpack_require__(13),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),withStyles=__webpack_require__(5),capitalize=__webpack_require__(8),Modal=__webpack_require__(176),slicedToArray=__webpack_require__(28),Transition=__webpack_require__(118),transitions=__webpack_require__(24),useTheme=__webpack_require__(33),utils=__webpack_require__(36),useForkRef=__webpack_require__(11),Fade_styles={entering:{opacity:1},entered:{opacity:1}},defaultTimeout={enter:transitions.b.enteringScreen,exit:transitions.b.leavingScreen},esm_Fade_Fade=react.forwardRef((function(props,ref){var children=props.children,_props$disableStrictM=props.disableStrictModeCompat,disableStrictModeCompat=void 0!==_props$disableStrictM&&_props$disableStrictM,inProp=props.in,onEnter=props.onEnter,onEntered=props.onEntered,onEntering=props.onEntering,onExit=props.onExit,onExited=props.onExited,onExiting=props.onExiting,style=props.style,_props$TransitionComp=props.TransitionComponent,TransitionComponent=void 0===_props$TransitionComp?Transition.a:_props$TransitionComp,_props$timeout=props.timeout,timeout=void 0===_props$timeout?defaultTimeout:_props$timeout,other=Object(objectWithoutProperties.a)(props,["children","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","TransitionComponent","timeout"]),theme=Object(useTheme.a)(),enableStrictModeCompat=theme.unstable_strictMode&&!disableStrictModeCompat,nodeRef=react.useRef(null),foreignRef=Object(useForkRef.a)(children.ref,ref),handleRef=Object(useForkRef.a)(enableStrictModeCompat?nodeRef:void 0,foreignRef),normalizedTransitionCallback=function(callback){return function(nodeOrAppearing,maybeAppearing){if(callback){var _ref=enableStrictModeCompat?[nodeRef.current,nodeOrAppearing]:[nodeOrAppearing,maybeAppearing],_ref2=Object(slicedToArray.a)(_ref,2),node=_ref2[0],isAppearing=_ref2[1];void 0===isAppearing?callback(node):callback(node,isAppearing)}}},handleEntering=normalizedTransitionCallback(onEntering),handleEnter=normalizedTransitionCallback((function(node,isAppearing){Object(utils.b)(node);var transitionProps=Object(utils.a)({style:style,timeout:timeout},{mode:"enter"});node.style.webkitTransition=theme.transitions.create("opacity",transitionProps),node.style.transition=theme.transitions.create("opacity",transitionProps),onEnter&&onEnter(node,isAppearing)})),handleEntered=normalizedTransitionCallback(onEntered),handleExiting=normalizedTransitionCallback(onExiting),handleExit=normalizedTransitionCallback((function(node){var transitionProps=Object(utils.a)({style:style,timeout:timeout},{mode:"exit"});node.style.webkitTransition=theme.transitions.create("opacity",transitionProps),node.style.transition=theme.transitions.create("opacity",transitionProps),onExit&&onExit(node)})),handleExited=normalizedTransitionCallback(onExited);return react.createElement(TransitionComponent,Object(esm_extends.a)({appear:!0,in:inProp,nodeRef:enableStrictModeCompat?nodeRef:void 0,onEnter:handleEnter,onEntered:handleEntered,onEntering:handleEntering,onExit:handleExit,onExited:handleExited,onExiting:handleExiting,timeout:timeout},other),(function(state,childProps){return react.cloneElement(children,Object(esm_extends.a)({style:Object(esm_extends.a)({opacity:0,visibility:"exited"!==state||inProp?void 0:"hidden"},Fade_styles[state],style,children.props.style),ref:handleRef},childProps))}))})),Backdrop_Backdrop=react.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$invisible=props.invisible,invisible=void 0!==_props$invisible&&_props$invisible,open=props.open,transitionDuration=props.transitionDuration,_props$TransitionComp=props.TransitionComponent,TransitionComponent=void 0===_props$TransitionComp?esm_Fade_Fade:_props$TransitionComp,other=Object(objectWithoutProperties.a)(props,["children","classes","className","invisible","open","transitionDuration","TransitionComponent"]);return react.createElement(TransitionComponent,Object(esm_extends.a)({in:open,timeout:transitionDuration},other),react.createElement("div",{className:Object(clsx_m.a)(classes.root,className,invisible&&classes.invisible),"aria-hidden":!0,ref:ref},children))})),esm_Backdrop_Backdrop=Object(withStyles.a)({root:{zIndex:-1,position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},invisible:{backgroundColor:"transparent"}},{name:"MuiBackdrop"})(Backdrop_Backdrop),Paper=__webpack_require__(93),defaultTransitionDuration={enter:transitions.b.enteringScreen,exit:transitions.b.leavingScreen},Dialog_Dialog=react.forwardRef((function(props,ref){var BackdropProps=props.BackdropProps,children=props.children,classes=props.classes,className=props.className,_props$disableBackdro=props.disableBackdropClick,disableBackdropClick=void 0!==_props$disableBackdro&&_props$disableBackdro,_props$disableEscapeK=props.disableEscapeKeyDown,disableEscapeKeyDown=void 0!==_props$disableEscapeK&&_props$disableEscapeK,_props$fullScreen=props.fullScreen,fullScreen=void 0!==_props$fullScreen&&_props$fullScreen,_props$fullWidth=props.fullWidth,fullWidth=void 0!==_props$fullWidth&&_props$fullWidth,_props$maxWidth=props.maxWidth,maxWidth=void 0===_props$maxWidth?"sm":_props$maxWidth,onBackdropClick=props.onBackdropClick,onClose=props.onClose,onEnter=props.onEnter,onEntered=props.onEntered,onEntering=props.onEntering,onEscapeKeyDown=props.onEscapeKeyDown,onExit=props.onExit,onExited=props.onExited,onExiting=props.onExiting,open=props.open,_props$PaperComponent=props.PaperComponent,PaperComponent=void 0===_props$PaperComponent?Paper.a:_props$PaperComponent,_props$PaperProps=props.PaperProps,PaperProps=void 0===_props$PaperProps?{}:_props$PaperProps,_props$scroll=props.scroll,scroll=void 0===_props$scroll?"paper":_props$scroll,_props$TransitionComp=props.TransitionComponent,TransitionComponent=void 0===_props$TransitionComp?esm_Fade_Fade:_props$TransitionComp,_props$transitionDura=props.transitionDuration,transitionDuration=void 0===_props$transitionDura?defaultTransitionDuration:_props$transitionDura,TransitionProps=props.TransitionProps,ariaDescribedby=props["aria-describedby"],ariaLabelledby=props["aria-labelledby"],other=Object(objectWithoutProperties.a)(props,["BackdropProps","children","classes","className","disableBackdropClick","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClose","onEnter","onEntered","onEntering","onEscapeKeyDown","onExit","onExited","onExiting","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps","aria-describedby","aria-labelledby"]),mouseDownTarget=react.useRef();return react.createElement(Modal.a,Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,className),BackdropComponent:esm_Backdrop_Backdrop,BackdropProps:Object(esm_extends.a)({transitionDuration:transitionDuration},BackdropProps),closeAfterTransition:!0,disableBackdropClick:disableBackdropClick,disableEscapeKeyDown:disableEscapeKeyDown,onEscapeKeyDown:onEscapeKeyDown,onClose:onClose,open:open,ref:ref},other),react.createElement(TransitionComponent,Object(esm_extends.a)({appear:!0,in:open,timeout:transitionDuration,onEnter:onEnter,onEntering:onEntering,onEntered:onEntered,onExit:onExit,onExiting:onExiting,onExited:onExited,role:"none presentation"},TransitionProps),react.createElement("div",{className:Object(clsx_m.a)(classes.container,classes["scroll".concat(Object(capitalize.a)(scroll))]),onMouseUp:function(event){event.target===event.currentTarget&&event.target===mouseDownTarget.current&&(mouseDownTarget.current=null,onBackdropClick&&onBackdropClick(event),!disableBackdropClick&&onClose&&onClose(event,"backdropClick"))},onMouseDown:function(event){mouseDownTarget.current=event.target}},react.createElement(PaperComponent,Object(esm_extends.a)({elevation:24,role:"dialog","aria-describedby":ariaDescribedby,"aria-labelledby":ariaLabelledby},PaperProps,{className:Object(clsx_m.a)(classes.paper,classes["paperScroll".concat(Object(capitalize.a)(scroll))],classes["paperWidth".concat(Object(capitalize.a)(String(maxWidth)))],PaperProps.className,fullScreen&&classes.paperFullScreen,fullWidth&&classes.paperFullWidth)}),children))))}));__webpack_exports__.a=Object(withStyles.a)((function(theme){return{root:{"@media print":{position:"absolute !important"}},scrollPaper:{display:"flex",justifyContent:"center",alignItems:"center"},scrollBody:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&:after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}},container:{height:"100%","@media print":{height:"auto"},outline:0},paper:{margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},paperScrollPaper:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},paperScrollBody:{display:"inline-block",verticalAlign:"middle",textAlign:"left"},paperWidthFalse:{maxWidth:"calc(100% - 64px)"},paperWidthXs:{maxWidth:Math.max(theme.breakpoints.values.xs,444),"&$paperScrollBody":Object(defineProperty.a)({},theme.breakpoints.down(Math.max(theme.breakpoints.values.xs,444)+64),{maxWidth:"calc(100% - 64px)"})},paperWidthSm:{maxWidth:theme.breakpoints.values.sm,"&$paperScrollBody":Object(defineProperty.a)({},theme.breakpoints.down(theme.breakpoints.values.sm+64),{maxWidth:"calc(100% - 64px)"})},paperWidthMd:{maxWidth:theme.breakpoints.values.md,"&$paperScrollBody":Object(defineProperty.a)({},theme.breakpoints.down(theme.breakpoints.values.md+64),{maxWidth:"calc(100% - 64px)"})},paperWidthLg:{maxWidth:theme.breakpoints.values.lg,"&$paperScrollBody":Object(defineProperty.a)({},theme.breakpoints.down(theme.breakpoints.values.lg+64),{maxWidth:"calc(100% - 64px)"})},paperWidthXl:{maxWidth:theme.breakpoints.values.xl,"&$paperScrollBody":Object(defineProperty.a)({},theme.breakpoints.down(theme.breakpoints.values.xl+64),{maxWidth:"calc(100% - 64px)"})},paperFullWidth:{width:"calc(100% - 64px)"},paperFullScreen:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,"&$paperScrollBody":{margin:0,maxWidth:"100%"}}}}),{name:"MuiDialog"})(Dialog_Dialog)},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),Input=__webpack_require__(154),FilledInput=__webpack_require__(155),OutlinedInput=__webpack_require__(180),InputLabel=__webpack_require__(181),FormControl=__webpack_require__(156),formControlState=__webpack_require__(22),useFormControl=__webpack_require__(23),withStyles=__webpack_require__(5),FormHelperText_FormHelperText=react.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"p":_props$component,other=(props.disabled,props.error,props.filled,props.focused,props.margin,props.required,props.variant,Object(objectWithoutProperties.a)(props,["children","classes","className","component","disabled","error","filled","focused","margin","required","variant"])),muiFormControl=Object(useFormControl.a)(),fcs=Object(formControlState.a)({props:props,muiFormControl:muiFormControl,states:["variant","margin","disabled","error","filled","focused","required"]});return react.createElement(Component,Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,("filled"===fcs.variant||"outlined"===fcs.variant)&&classes.contained,className,fcs.disabled&&classes.disabled,fcs.error&&classes.error,fcs.filled&&classes.filled,fcs.focused&&classes.focused,fcs.required&&classes.required,"dense"===fcs.margin&&classes.marginDense),ref:ref},other)," "===children?react.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}}):children)})),esm_FormHelperText_FormHelperText=Object(withStyles.a)((function(theme){return{root:Object(esm_extends.a)({color:theme.palette.text.secondary},theme.typography.caption,{textAlign:"left",marginTop:3,margin:0,"&$disabled":{color:theme.palette.text.disabled},"&$error":{color:theme.palette.error.main}}),error:{},disabled:{},marginDense:{marginTop:4},contained:{marginLeft:14,marginRight:14},focused:{},filled:{},required:{}}}),{name:"MuiFormHelperText"})(FormHelperText_FormHelperText),Select=__webpack_require__(174),variantComponent={standard:Input.a,filled:FilledInput.a,outlined:OutlinedInput.a},TextField_TextField=react.forwardRef((function(props,ref){var autoComplete=props.autoComplete,_props$autoFocus=props.autoFocus,autoFocus=void 0!==_props$autoFocus&&_props$autoFocus,children=props.children,classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"primary":_props$color,defaultValue=props.defaultValue,_props$disabled=props.disabled,disabled=void 0!==_props$disabled&&_props$disabled,_props$error=props.error,error=void 0!==_props$error&&_props$error,FormHelperTextProps=props.FormHelperTextProps,_props$fullWidth=props.fullWidth,fullWidth=void 0!==_props$fullWidth&&_props$fullWidth,helperText=props.helperText,hiddenLabel=props.hiddenLabel,id=props.id,InputLabelProps=props.InputLabelProps,inputProps=props.inputProps,InputProps=props.InputProps,inputRef=props.inputRef,label=props.label,_props$multiline=props.multiline,multiline=void 0!==_props$multiline&&_props$multiline,name=props.name,onBlur=props.onBlur,onChange=props.onChange,onFocus=props.onFocus,placeholder=props.placeholder,_props$required=props.required,required=void 0!==_props$required&&_props$required,rows=props.rows,rowsMax=props.rowsMax,_props$select=props.select,select=void 0!==_props$select&&_props$select,SelectProps=props.SelectProps,type=props.type,value=props.value,_props$variant=props.variant,variant=void 0===_props$variant?"standard":_props$variant,other=Object(objectWithoutProperties.a)(props,["autoComplete","autoFocus","children","classes","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","hiddenLabel","id","InputLabelProps","inputProps","InputProps","inputRef","label","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","rowsMax","select","SelectProps","type","value","variant"]);var InputMore={};if("outlined"===variant&&(InputLabelProps&&"undefined"!==typeof InputLabelProps.shrink&&(InputMore.notched=InputLabelProps.shrink),label)){var _InputLabelProps$requ,displayRequired=null!==(_InputLabelProps$requ=null===InputLabelProps||void 0===InputLabelProps?void 0:InputLabelProps.required)&&void 0!==_InputLabelProps$requ?_InputLabelProps$requ:required;InputMore.label=react.createElement(react.Fragment,null,label,displayRequired&&"\xa0*")}select&&(SelectProps&&SelectProps.native||(InputMore.id=void 0),InputMore["aria-describedby"]=void 0);var helperTextId=helperText&&id?"".concat(id,"-helper-text"):void 0,inputLabelId=label&&id?"".concat(id,"-label"):void 0,InputComponent=variantComponent[variant],InputElement=react.createElement(InputComponent,Object(esm_extends.a)({"aria-describedby":helperTextId,autoComplete:autoComplete,autoFocus:autoFocus,defaultValue:defaultValue,fullWidth:fullWidth,multiline:multiline,name:name,rows:rows,rowsMax:rowsMax,type:type,value:value,id:id,inputRef:inputRef,onBlur:onBlur,onChange:onChange,onFocus:onFocus,placeholder:placeholder,inputProps:inputProps},InputMore,InputProps));return react.createElement(FormControl.a,Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,className),disabled:disabled,error:error,fullWidth:fullWidth,hiddenLabel:hiddenLabel,ref:ref,required:required,color:color,variant:variant},other),label&&react.createElement(InputLabel.a,Object(esm_extends.a)({htmlFor:id,id:inputLabelId},InputLabelProps),label),select?react.createElement(Select.a,Object(esm_extends.a)({"aria-describedby":helperTextId,id:id,labelId:inputLabelId,value:value,input:InputElement},SelectProps),children):InputElement,helperText&&react.createElement(esm_FormHelperText_FormHelperText,Object(esm_extends.a)({id:helperTextId},FormHelperTextProps),helperText))}));__webpack_exports__.a=Object(withStyles.a)({root:{}},{name:"MuiTextField"})(TextField_TextField)},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),InputBase=__webpack_require__(94),defineProperty=__webpack_require__(13),withStyles=__webpack_require__(5),useTheme=__webpack_require__(33),capitalize=__webpack_require__(8),NotchedOutline_NotchedOutline=react.forwardRef((function(props,ref){props.children;var classes=props.classes,className=props.className,label=props.label,labelWidthProp=props.labelWidth,notched=props.notched,style=props.style,other=Object(objectWithoutProperties.a)(props,["children","classes","className","label","labelWidth","notched","style"]),align="rtl"===Object(useTheme.a)().direction?"right":"left";if(void 0!==label)return react.createElement("fieldset",Object(esm_extends.a)({"aria-hidden":!0,className:Object(clsx_m.a)(classes.root,className),ref:ref,style:style},other),react.createElement("legend",{className:Object(clsx_m.a)(classes.legendLabelled,notched&&classes.legendNotched)},label?react.createElement("span",null,label):react.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}})));var labelWidth=labelWidthProp>0?.75*labelWidthProp+8:.01;return react.createElement("fieldset",Object(esm_extends.a)({"aria-hidden":!0,style:Object(esm_extends.a)(Object(defineProperty.a)({},"padding".concat(Object(capitalize.a)(align)),8),style),className:Object(clsx_m.a)(classes.root,className),ref:ref},other),react.createElement("legend",{className:classes.legend,style:{width:notched?labelWidth:.01}},react.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}})))})),OutlinedInput_NotchedOutline=Object(withStyles.a)((function(theme){return{root:{position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden"},legend:{textAlign:"left",padding:0,lineHeight:"11px",transition:theme.transitions.create("width",{duration:150,easing:theme.transitions.easing.easeOut})},legendLabelled:{display:"block",width:"auto",textAlign:"left",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:theme.transitions.create("max-width",{duration:50,easing:theme.transitions.easing.easeOut}),"& > span":{paddingLeft:5,paddingRight:5,display:"inline-block"}},legendNotched:{maxWidth:1e3,transition:theme.transitions.create("max-width",{duration:100,easing:theme.transitions.easing.easeOut,delay:50})}}}),{name:"PrivateNotchedOutline"})(NotchedOutline_NotchedOutline),OutlinedInput_OutlinedInput=react.forwardRef((function(props,ref){var classes=props.classes,_props$fullWidth=props.fullWidth,fullWidth=void 0!==_props$fullWidth&&_props$fullWidth,_props$inputComponent=props.inputComponent,inputComponent=void 0===_props$inputComponent?"input":_props$inputComponent,label=props.label,_props$labelWidth=props.labelWidth,labelWidth=void 0===_props$labelWidth?0:_props$labelWidth,_props$multiline=props.multiline,multiline=void 0!==_props$multiline&&_props$multiline,notched=props.notched,_props$type=props.type,type=void 0===_props$type?"text":_props$type,other=Object(objectWithoutProperties.a)(props,["classes","fullWidth","inputComponent","label","labelWidth","multiline","notched","type"]);return react.createElement(InputBase.a,Object(esm_extends.a)({renderSuffix:function(state){return react.createElement(OutlinedInput_NotchedOutline,{className:classes.notchedOutline,label:label,labelWidth:labelWidth,notched:"undefined"!==typeof notched?notched:Boolean(state.startAdornment||state.filled||state.focused)})},classes:Object(esm_extends.a)({},classes,{root:Object(clsx_m.a)(classes.root,classes.underline),notchedOutline:null}),fullWidth:fullWidth,inputComponent:inputComponent,multiline:multiline,ref:ref,type:type},other))}));OutlinedInput_OutlinedInput.muiName="Input";__webpack_exports__.a=Object(withStyles.a)((function(theme){var borderColor="light"===theme.palette.type?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{root:{position:"relative",borderRadius:theme.shape.borderRadius,"&:hover $notchedOutline":{borderColor:theme.palette.text.primary},"@media (hover: none)":{"&:hover $notchedOutline":{borderColor:borderColor}},"&$focused $notchedOutline":{borderColor:theme.palette.primary.main,borderWidth:2},"&$error $notchedOutline":{borderColor:theme.palette.error.main},"&$disabled $notchedOutline":{borderColor:theme.palette.action.disabled}},colorSecondary:{"&$focused $notchedOutline":{borderColor:theme.palette.secondary.main}},focused:{},disabled:{},adornedStart:{paddingLeft:14},adornedEnd:{paddingRight:14},error:{},marginDense:{},multiline:{padding:"18.5px 14px","&$marginDense":{paddingTop:10.5,paddingBottom:10.5}},notchedOutline:{borderColor:borderColor},input:{padding:"18.5px 14px","&:-webkit-autofill":{WebkitBoxShadow:"light"===theme.palette.type?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===theme.palette.type?null:"#fff",caretColor:"light"===theme.palette.type?null:"#fff",borderRadius:"inherit"}},inputMarginDense:{paddingTop:10.5,paddingBottom:10.5},inputMultiline:{padding:0},inputAdornedStart:{paddingLeft:0},inputAdornedEnd:{paddingRight:0}}}),{name:"MuiOutlinedInput"})(OutlinedInput_OutlinedInput)},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),formControlState=__webpack_require__(22),useFormControl=__webpack_require__(23),withStyles=__webpack_require__(5),capitalize=__webpack_require__(8),FormLabel_FormLabel=react.forwardRef((function(props,ref){var children=props.children,classes=props.classes,className=props.className,_props$component=(props.color,props.component),Component=void 0===_props$component?"label":_props$component,other=(props.disabled,props.error,props.filled,props.focused,props.required,Object(objectWithoutProperties.a)(props,["children","classes","className","color","component","disabled","error","filled","focused","required"])),muiFormControl=Object(useFormControl.a)(),fcs=Object(formControlState.a)({props:props,muiFormControl:muiFormControl,states:["color","required","focused","disabled","error","filled"]});return react.createElement(Component,Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,classes["color".concat(Object(capitalize.a)(fcs.color||"primary"))],className,fcs.disabled&&classes.disabled,fcs.error&&classes.error,fcs.filled&&classes.filled,fcs.focused&&classes.focused,fcs.required&&classes.required),ref:ref},other),children,fcs.required&&react.createElement("span",{"aria-hidden":!0,className:Object(clsx_m.a)(classes.asterisk,fcs.error&&classes.error)},"\u2009","*"))})),esm_FormLabel_FormLabel=Object(withStyles.a)((function(theme){return{root:Object(esm_extends.a)({color:theme.palette.text.secondary},theme.typography.body1,{lineHeight:1,padding:0,"&$focused":{color:theme.palette.primary.main},"&$disabled":{color:theme.palette.text.disabled},"&$error":{color:theme.palette.error.main}}),colorSecondary:{"&$focused":{color:theme.palette.secondary.main}},focused:{},disabled:{},error:{},filled:{},required:{},asterisk:{"&$error":{color:theme.palette.error.main}}}}),{name:"MuiFormLabel"})(FormLabel_FormLabel),InputLabel_InputLabel=react.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$disableAnimati=props.disableAnimation,disableAnimation=void 0!==_props$disableAnimati&&_props$disableAnimati,shrinkProp=(props.margin,props.shrink),other=(props.variant,Object(objectWithoutProperties.a)(props,["classes","className","disableAnimation","margin","shrink","variant"])),muiFormControl=Object(useFormControl.a)(),shrink=shrinkProp;"undefined"===typeof shrink&&muiFormControl&&(shrink=muiFormControl.filled||muiFormControl.focused||muiFormControl.adornedStart);var fcs=Object(formControlState.a)({props:props,muiFormControl:muiFormControl,states:["margin","variant"]});return react.createElement(esm_FormLabel_FormLabel,Object(esm_extends.a)({"data-shrink":shrink,className:Object(clsx_m.a)(classes.root,className,muiFormControl&&classes.formControl,!disableAnimation&&classes.animated,shrink&&classes.shrink,"dense"===fcs.margin&&classes.marginDense,{filled:classes.filled,outlined:classes.outlined}[fcs.variant]),classes:{focused:classes.focused,disabled:classes.disabled,error:classes.error,required:classes.required,asterisk:classes.asterisk},ref:ref},other))}));__webpack_exports__.a=Object(withStyles.a)((function(theme){return{root:{display:"block",transformOrigin:"top left"},focused:{},disabled:{},error:{},required:{},asterisk:{},formControl:{position:"absolute",left:0,top:0,transform:"translate(0, 24px) scale(1)"},marginDense:{transform:"translate(0, 21px) scale(1)"},shrink:{transform:"translate(0, 1.5px) scale(0.75)",transformOrigin:"top left"},animated:{transition:theme.transitions.create(["color","transform"],{duration:theme.transitions.duration.shorter,easing:theme.transitions.easing.easeOut})},filled:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 20px) scale(1)","&$marginDense":{transform:"translate(12px, 17px) scale(1)"},"&$shrink":{transform:"translate(12px, 10px) scale(0.75)","&$marginDense":{transform:"translate(12px, 7px) scale(0.75)"}}},outlined:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 20px) scale(1)","&$marginDense":{transform:"translate(14px, 12px) scale(1)"},"&$shrink":{transform:"translate(14px, -6px) scale(0.75)"}}}}),{name:"MuiInputLabel"})(InputLabel_InputLabel)},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),withStyles=__webpack_require__(5),createSvgIcon=__webpack_require__(48),Person=Object(createSvgIcon.a)(react.createElement("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");var Avatar_Avatar=react.forwardRef((function(props,ref){var alt=props.alt,childrenProp=props.children,classes=props.classes,className=props.className,_props$component=props.component,Component=void 0===_props$component?"div":_props$component,imgProps=props.imgProps,sizes=props.sizes,src=props.src,srcSet=props.srcSet,_props$variant=props.variant,variant=void 0===_props$variant?"circle":_props$variant,other=Object(objectWithoutProperties.a)(props,["alt","children","classes","className","component","imgProps","sizes","src","srcSet","variant"]),children=null,loaded=function(_ref){var src=_ref.src,srcSet=_ref.srcSet,_React$useState=react.useState(!1),loaded=_React$useState[0],setLoaded=_React$useState[1];return react.useEffect((function(){if(src||srcSet){setLoaded(!1);var active=!0,image=new Image;return image.src=src,image.srcSet=srcSet,image.onload=function(){active&&setLoaded("loaded")},image.onerror=function(){active&&setLoaded("error")},function(){active=!1}}}),[src,srcSet]),loaded}({src:src,srcSet:srcSet}),hasImg=src||srcSet,hasImgNotFailing=hasImg&&"error"!==loaded;return children=hasImgNotFailing?react.createElement("img",Object(esm_extends.a)({alt:alt,src:src,srcSet:srcSet,sizes:sizes,className:classes.img},imgProps)):null!=childrenProp?childrenProp:hasImg&&alt?alt[0]:react.createElement(Person,{className:classes.fallback}),react.createElement(Component,Object(esm_extends.a)({className:Object(clsx_m.a)(classes.root,classes.system,classes[variant],className,!hasImgNotFailing&&classes.colorDefault),ref:ref},other),children)}));__webpack_exports__.a=Object(withStyles.a)((function(theme){return{root:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:theme.typography.fontFamily,fontSize:theme.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none"},colorDefault:{color:theme.palette.background.default,backgroundColor:"light"===theme.palette.type?theme.palette.grey[400]:theme.palette.grey[600]},circle:{},circular:{},rounded:{borderRadius:theme.shape.borderRadius},square:{borderRadius:0},img:{width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4},fallback:{width:"75%",height:"75%"}}}),{name:"MuiAvatar"})(Avatar_Avatar)},function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__(2),objectWithoutProperties=__webpack_require__(3),react=__webpack_require__(1),clsx_m=(__webpack_require__(6),__webpack_require__(4)),withStyles=__webpack_require__(5),colorManipulator=__webpack_require__(15),capitalize=__webpack_require__(8),slicedToArray=__webpack_require__(28),useControlled=__webpack_require__(46),useFormControl=__webpack_require__(23),IconButton=__webpack_require__(152),SwitchBase_SwitchBase=react.forwardRef((function(props,ref){var autoFocus=props.autoFocus,checkedProp=props.checked,checkedIcon=props.checkedIcon,classes=props.classes,className=props.className,defaultChecked=props.defaultChecked,disabledProp=props.disabled,icon=props.icon,id=props.id,inputProps=props.inputProps,inputRef=props.inputRef,name=props.name,onBlur=props.onBlur,onChange=props.onChange,onFocus=props.onFocus,readOnly=props.readOnly,required=props.required,tabIndex=props.tabIndex,type=props.type,value=props.value,other=Object(objectWithoutProperties.a)(props,["autoFocus","checked","checkedIcon","classes","className","defaultChecked","disabled","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"]),_useControlled=Object(useControlled.a)({controlled:checkedProp,default:Boolean(defaultChecked),name:"SwitchBase",state:"checked"}),_useControlled2=Object(slicedToArray.a)(_useControlled,2),checked=_useControlled2[0],setCheckedState=_useControlled2[1],muiFormControl=Object(useFormControl.a)(),disabled=disabledProp;muiFormControl&&"undefined"===typeof disabled&&(disabled=muiFormControl.disabled);var hasLabelFor="checkbox"===type||"radio"===type;return react.createElement(IconButton.a,Object(esm_extends.a)({component:"span",className:Object(clsx_m.a)(classes.root,className,checked&&classes.checked,disabled&&classes.disabled),disabled:disabled,tabIndex:null,role:void 0,onFocus:function(event){onFocus&&onFocus(event),muiFormControl&&muiFormControl.onFocus&&muiFormControl.onFocus(event)},onBlur:function(event){onBlur&&onBlur(event),muiFormControl&&muiFormControl.onBlur&&muiFormControl.onBlur(event)},ref:ref},other),react.createElement("input",Object(esm_extends.a)({autoFocus:autoFocus,checked:checkedProp,defaultChecked:defaultChecked,className:classes.input,disabled:disabled,id:hasLabelFor&&id,name:name,onChange:function(event){var newChecked=event.target.checked;setCheckedState(newChecked),onChange&&onChange(event,newChecked)},readOnly:readOnly,ref:inputRef,required:required,tabIndex:tabIndex,type:type,value:value},inputProps)),checked?checkedIcon:icon)})),internal_SwitchBase=Object(withStyles.a)({root:{padding:9},checked:{},disabled:{},input:{cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}},{name:"PrivateSwitchBase"})(SwitchBase_SwitchBase),Switch_Switch=react.forwardRef((function(props,ref){var classes=props.classes,className=props.className,_props$color=props.color,color=void 0===_props$color?"secondary":_props$color,_props$edge=props.edge,edge=void 0!==_props$edge&&_props$edge,_props$size=props.size,size=void 0===_props$size?"medium":_props$size,other=Object(objectWithoutProperties.a)(props,["classes","className","color","edge","size"]),icon=react.createElement("span",{className:classes.thumb});return react.createElement("span",{className:Object(clsx_m.a)(classes.root,className,{start:classes.edgeStart,end:classes.edgeEnd}[edge],"small"===size&&classes["size".concat(Object(capitalize.a)(size))])},react.createElement(internal_SwitchBase,Object(esm_extends.a)({type:"checkbox",icon:icon,checkedIcon:icon,classes:{root:Object(clsx_m.a)(classes.switchBase,classes["color".concat(Object(capitalize.a)(color))]),input:classes.input,checked:classes.checked,disabled:classes.disabled},ref:ref},other)),react.createElement("span",{className:classes.track}))}));__webpack_exports__.a=Object(withStyles.a)((function(theme){return{root:{display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},edgeStart:{marginLeft:-8},edgeEnd:{marginRight:-8},switchBase:{position:"absolute",top:0,left:0,zIndex:1,color:"light"===theme.palette.type?theme.palette.grey[50]:theme.palette.grey[400],transition:theme.transitions.create(["left","transform"],{duration:theme.transitions.duration.shortest}),"&$checked":{transform:"translateX(20px)"},"&$disabled":{color:"light"===theme.palette.type?theme.palette.grey[400]:theme.palette.grey[800]},"&$checked + $track":{opacity:.5},"&$disabled + $track":{opacity:"light"===theme.palette.type?.12:.1}},colorPrimary:{"&$checked":{color:theme.palette.primary.main,"&:hover":{backgroundColor:Object(colorManipulator.c)(theme.palette.primary.main,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:"light"===theme.palette.type?theme.palette.grey[400]:theme.palette.grey[800]},"&$checked + $track":{backgroundColor:theme.palette.primary.main},"&$disabled + $track":{backgroundColor:"light"===theme.palette.type?theme.palette.common.black:theme.palette.common.white}},colorSecondary:{"&$checked":{color:theme.palette.secondary.main,"&:hover":{backgroundColor:Object(colorManipulator.c)(theme.palette.secondary.main,theme.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:"light"===theme.palette.type?theme.palette.grey[400]:theme.palette.grey[800]},"&$checked + $track":{backgroundColor:theme.palette.secondary.main},"&$disabled + $track":{backgroundColor:"light"===theme.palette.type?theme.palette.common.black:theme.palette.common.white}},sizeSmall:{width:40,height:24,padding:7,"& $thumb":{width:16,height:16},"& $switchBase":{padding:4,"&$checked":{transform:"translateX(16px)"}}},checked:{},disabled:{},input:{left:"-100%",width:"300%"},thumb:{boxShadow:theme.shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"},track:{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:theme.transitions.create(["opacity","background-color"],{duration:theme.transitions.duration.shortest}),backgroundColor:"light"===theme.palette.type?theme.palette.common.black:theme.palette.common.white,opacity:"light"===theme.palette.type?.38:.3}}}),{name:"MuiSwitch"})(Switch_Switch)}]]);
//# sourceMappingURL=2.c35cc653.chunk.js.map